<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>TodoLists</web>
  <name>TodoListMacro</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>TodoLists.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1388530800000</creationDate>
  <date>1388530800000</date>
  <contentUpdateDate>1388530800000</contentUpdateDate>
  <version>1.1</version>
  <title>Todolist Macro</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <attachment>
    <filename>ember-data.js</filename>
    <filesize>278834</filesize>
    <author>XWiki.Admin</author>
    <date>1391345073000</date>
    <version>1.1</version>
    <comment/>
    <content>LyohCiAqIEBvdmVydmlldyAgRW1iZXIgRGF0YQogKiBAY29weXJpZ2h0IENvcHlyaWdodCAyMDEx
LTIwMTQgVGlsZGUgSW5jLiBhbmQgY29udHJpYnV0b3JzLgogKiAgICAgICAgICAgIFBvcnRpb25z
IENvcHlyaWdodCAyMDExIExpdmluZ1NvY2lhbCBJbmMuCiAqIEBsaWNlbnNlICAgTGljZW5zZWQg
dW5kZXIgTUlUIGxpY2Vuc2UgKHNlZSBsaWNlbnNlLmpzKQogKiBAdmVyc2lvbiAgIDEuMC4wLWJl
dGEuNQogKi8KCgooZnVuY3Rpb24oKSB7CnZhciBkZWZpbmUsIHJlcXVpcmVNb2R1bGU7CgooZnVu
Y3Rpb24oKSB7CiAgdmFyIHJlZ2lzdHJ5ID0ge30sIHNlZW4gPSB7fTsKCiAgZGVmaW5lID0gZnVu
Y3Rpb24obmFtZSwgZGVwcywgY2FsbGJhY2spIHsKICAgIHJlZ2lzdHJ5W25hbWVdID0geyBkZXBz
OiBkZXBzLCBjYWxsYmFjazogY2FsbGJhY2sgfTsKICB9OwoKICByZXF1aXJlTW9kdWxlID0gZnVu
Y3Rpb24obmFtZSkgewogICAgaWYgKHNlZW5bbmFtZV0pIHsgcmV0dXJuIHNlZW5bbmFtZV07IH0K
ICAgIHNlZW5bbmFtZV0gPSB7fTsKCiAgICB2YXIgbW9kLCBkZXBzLCBjYWxsYmFjaywgcmVpZmll
ZCAsIGV4cG9ydHM7CgogICAgbW9kID0gcmVnaXN0cnlbbmFtZV07CgogICAgaWYgKCFtb2QpIHsK
ICAgICAgdGhyb3cgbmV3IEVycm9yKCJNb2R1bGUgJyIgKyBuYW1lICsgIicgbm90IGZvdW5kLiIp
OwogICAgfQoKICAgIGRlcHMgPSBtb2QuZGVwczsKICAgIGNhbGxiYWNrID0gbW9kLmNhbGxiYWNr
OwogICAgcmVpZmllZCA9IFtdOwogICAgZXhwb3J0czsKCiAgICBmb3IgKHZhciBpPTAsIGw9ZGVw
cy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgIGlmIChkZXBzW2ldID09PSAnZXhwb3J0cycpIHsK
ICAgICAgICByZWlmaWVkLnB1c2goZXhwb3J0cyA9IHt9KTsKICAgICAgfSBlbHNlIHsKICAgICAg
ICByZWlmaWVkLnB1c2gocmVxdWlyZU1vZHVsZShkZXBzW2ldKSk7CiAgICAgIH0KICAgIH0KCiAg
ICB2YXIgdmFsdWUgPSBjYWxsYmFjay5hcHBseSh0aGlzLCByZWlmaWVkKTsKICAgIHJldHVybiBz
ZWVuW25hbWVdID0gZXhwb3J0cyB8fCB2YWx1ZTsKICB9Owp9KSgpOwooZnVuY3Rpb24oKSB7Ci8q
KgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKLyoqCiAgQWxsIEVtYmVyIERhdGEgbWV0aG9kcyBh
bmQgZnVuY3Rpb25zIGFyZSBkZWZpbmVkIGluc2lkZSBvZiB0aGlzIG5hbWVzcGFjZS4KCiAgQGNs
YXNzIERTCiAgQHN0YXRpYwoqLwp2YXIgRFM7CmlmICgndW5kZWZpbmVkJyA9PT0gdHlwZW9mIERT
KSB7CiAgLyoqCiAgICBAcHJvcGVydHkgVkVSU0lPTgogICAgQHR5cGUgU3RyaW5nCiAgICBAZGVm
YXVsdCAnMS4wLjAtYmV0YS41JwogICAgQHN0YXRpYwogICovCiAgRFMgPSBFbWJlci5OYW1lc3Bh
Y2UuY3JlYXRlKHsKICAgIFZFUlNJT046ICcxLjAuMC1iZXRhLjUnCiAgfSk7CgogIGlmICgndW5k
ZWZpbmVkJyAhPT0gdHlwZW9mIHdpbmRvdykgewogICAgd2luZG93LkRTID0gRFM7CiAgfQoKICBp
ZiAoRW1iZXIubGlicmFyaWVzKSB7CiAgICBFbWJlci5saWJyYXJpZXMucmVnaXN0ZXJDb3JlTGli
cmFyeSgnRW1iZXIgRGF0YScsIERTLlZFUlNJT04pOwogIH0KfQoKfSkoKTsKCgoKKGZ1bmN0aW9u
KCkgewp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQsIGlzTm9uZSA9IEVtYmVy
LmlzTm9uZTsKCi8vIFNpbXBsZSBkaXNwYXRjaGVyIHRvIHN1cHBvcnQgb3ZlcnJpZGluZyB0aGUg
YWxpYXNlZAovLyBtZXRob2QgaW4gc3ViY2xhc3Nlcy4KZnVuY3Rpb24gYWxpYXNNZXRob2QobWV0
aG9kTmFtZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzW21ldGhvZE5h
bWVdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfQoKLyoqCiAgSW4gRW1iZXIgRGF0YSBh
IFNlcmlhbGl6ZXIgaXMgdXNlZCB0byBzZXJpYWxpemUgYW5kIGRlc2VyaWFsaXplCiAgcmVjb3Jk
cyB3aGVuIHRoZXkgYXJlIHRyYW5zZmVyZWQgaW4gYW5kIG91dCBvZiBhbiBleHRlcm5hbCBzb3Vy
Y2UuCiAgVGhpcyBwcm9jZXNzIGludm9sdmVzIG5vcm1hbGl6aW5nIHByb3BlcnR5IG5hbWVzLCB0
cmFuc2Zvcm1pbmcKICBhdHRyaWJ1dGUgdmFsdWVzIGFuZCBzZXJpYWxpemVpbmcgcmVsYXRpb25z
aGlwcy4KCiAgRm9yIG1heGltdW0gcGVyZm9ybWFuY2UgRW1iZXIgRGF0YSByZWNvbWVuZHMgeW91
IHVzZSB0aGUKICBbUkVTVFNlcmlhbGl6ZXJdKERTLlJFU1RTZXJpYWxpemVyLmh0bWwpIG9yIG9u
ZSBvZiBpdHMgc3ViY2xhc3Nlcy4KCiAgYEpTT05TZXJpYWxpemVyYCBpcyB1c2VmdWwgZm9yIHNp
bXBsZXIgb3IgbGVnYWN5IGJhY2tlbmRzIHRoYXQgbWF5CiAgbm90IHN1cHBvcnQgdGhlIGh0dHA6
Ly9qc29uYXBpLm9yZy8gc3BlYy4KCiAgQGNsYXNzIEpTT05TZXJpYWxpemVyCiAgQG5hbWVzcGFj
ZSBEUwoqLwpEUy5KU09OU2VyaWFsaXplciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogIC8qKgog
ICAgVGhlIHByaW1hcnlLZXkgaXMgdXNlZCB3aGVuIHNlcmlhbGl6aW5nIGFuZCBkZXNlcmlhbGl6
aW5nCiAgICBkYXRhLiBFbWJlciBEYXRhIGFsd2F5cyB1c2VzIHRoZSBgaWRgIHByb3BlcnkgdG8g
c3RvcmUgdGhlIGlkIG9mCiAgICB0aGUgcmVjb3JkLiBUaGUgZXh0ZXJuYWwgc291cmNlIG1heSBu
b3QgYWx3YXlzIGZvbGxvdyB0aGlzCiAgICBjb252ZW50aW9uLiBJbiB0aGVzZSBjYXNlcyBpdCBp
cyB1c2VzZnVsIHRvIG92ZXJyaWRlIHRoZQogICAgcHJpbWFyeUtleSBwcm9wZXJ0eSB0byBtYXRj
aCB0aGUgcHJpbWFyeUtleSBvZiB5b3VyIGV4dGVybmFsCiAgICBzdG9yZS4KCiAgICBFeGFtcGxl
CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLkFwcGxpY2F0aW9uU2VyaWFsaXplciA9IERTLkpT
T05TZXJpYWxpemVyLmV4dGVuZCh7CiAgICAgIHByaW1hcnlLZXk6ICdfaWQnCiAgICB9KTsKICAg
IGBgYAoKICAgIEBwcm9wZXJ0eSBwcmltYXJ5S2V5CiAgICBAdHlwZSB7U3RyaW5nfQogICAgQGRl
ZmF1bHQgJ2lkJwogICovCiAgcHJpbWFyeUtleTogJ2lkJywKCiAgLyoqCiAgIEdpdmVuIGEgc3Vi
Y2xhc3Mgb2YgYERTLk1vZGVsYCBhbmQgYSBKU09OIG9iamVjdCB0aGlzIG1ldGhvZCB3aWxsCiAg
IGl0ZXJhdGUgdGhyb3VnaCBlYWNoIGF0dHJpYnV0ZSBvZiB0aGUgYERTLk1vZGVsYCBhbmQgaW52
b2tlIHRoZQogICBgRFMuVHJhbnNmb3JtI2Rlc2VyaWFsaXplYCBtZXRob2Qgb24gdGhlIG1hdGNo
aW5nIHByb3BlcnR5IG9mIHRoZQogICBKU09OIG9iamVjdC4gIFRoaXMgbWV0aG9kIGlzIHR5cGlj
YWxseSBjYWxsZWQgYWZ0ZXIgdGhlCiAgIHNlcmlhbGl6ZXIncyBgbm9ybWFsaXplYCBtZXRob2Qu
CgogICBAbWV0aG9kIGFwcGx5VHJhbnNmb3JtcwogICBAcHJpdmF0ZQogICBAcGFyYW0ge3N1YmNs
YXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHRv
IHRyYW5zZm9ybQogICBAcmV0dXJuIHtPYmplY3R9IGRhdGEgVGhlIHRyYW5zZm9ybWVkIGRhdGEg
b2JqZWN0CiAgKi8KICBhcHBseVRyYW5zZm9ybXM6IGZ1bmN0aW9uKHR5cGUsIGRhdGEpIHsKICAg
IHR5cGUuZWFjaFRyYW5zZm9ybWVkQXR0cmlidXRlKGZ1bmN0aW9uKGtleSwgdHlwZSkgewogICAg
ICB2YXIgdHJhbnNmb3JtID0gdGhpcy50cmFuc2Zvcm1Gb3IodHlwZSk7CiAgICAgIGRhdGFba2V5
XSA9IHRyYW5zZm9ybS5kZXNlcmlhbGl6ZShkYXRhW2tleV0pOwogICAgfSwgdGhpcyk7CgogICAg
cmV0dXJuIGRhdGE7CiAgfSwKCiAgLyoqCiAgICBOb3JtYWxpemVzIGEgcGFydCBvZiB0aGUgSlNP
TiBwYXlsb2FkIHJldHVybmVkIGJ5CiAgICB0aGUgc2VydmVyLiBZb3Ugc2hvdWxkIG92ZXJyaWRl
IHRoaXMgbWV0aG9kLCBtdW5nZSB0aGUgaGFzaAogICAgYW5kIGNhbGwgc3VwZXIgaWYgeW91IGhh
dmUgZ2VuZXJpYyBub3JtYWxpemF0aW9uIHRvIGRvLgoKICAgIEl0IHRha2VzIHRoZSB0eXBlIG9m
IHRoZSByZWNvcmQgdGhhdCBpcyBiZWluZyBub3JtYWxpemVkCiAgICAoYXMgYSBEUy5Nb2RlbCBj
bGFzcyksIHRoZSBwcm9wZXJ0eSB3aGVyZSB0aGUgaGFzaCB3YXMKICAgIG9yaWdpbmFsbHkgZm91
bmQsIGFuZCB0aGUgaGFzaCB0byBub3JtYWxpemUuCgogICAgWW91IGNhbiB1c2UgdGhpcyBtZXRo
b2QsIGZvciBleGFtcGxlLCB0byBub3JtYWxpemUgdW5kZXJzY29yZWQga2V5cyB0byBjYW1lbGl6
ZWQKICAgIG9yIG90aGVyIGdlbmVyYWwtcHVycG9zZSBub3JtYWxpemF0aW9ucy4KCiAgICBFeGFt
cGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLkFwcGxpY2F0aW9uU2VyaWFsaXplciA9IERT
LkpTT05TZXJpYWxpemVyLmV4dGVuZCh7CiAgICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24odHlwZSwg
aGFzaCkgewogICAgICAgIHZhciBmaWVsZHMgPSBFbWJlci5nZXQodHlwZSwgJ2ZpZWxkcycpOwog
ICAgICAgIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uKGZpZWxkKSB7CiAgICAgICAgICB2YXIgcGF5
bG9hZEZpZWxkID0gRW1iZXIuU3RyaW5nLnVuZGVyc2NvcmUoZmllbGQpOwogICAgICAgICAgaWYg
KGZpZWxkID09PSBwYXlsb2FkRmllbGQpIHsgcmV0dXJuOyB9CgogICAgICAgICAgaGFzaFtmaWVs
ZF0gPSBoYXNoW3BheWxvYWRGaWVsZF07CiAgICAgICAgICBkZWxldGUgaGFzaFtwYXlsb2FkRmll
bGRdOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBh
cmd1bWVudHMpOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2Qgbm9ybWFsaXpl
CiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVj
dH0gaGFzaAogICAgQHJldHVybiB7T2JqZWN0fQogICovCiAgbm9ybWFsaXplOiBmdW5jdGlvbih0
eXBlLCBoYXNoKSB7CiAgICBpZiAoIWhhc2gpIHsgcmV0dXJuIGhhc2g7IH0KCiAgICB0aGlzLmFw
cGx5VHJhbnNmb3Jtcyh0eXBlLCBoYXNoKTsKICAgIHJldHVybiBoYXNoOwogIH0sCgogIC8vIFNF
UklBTElaRQogIC8qKgogICAgQ2FsbGVkIHdoZW4gYSByZWNvcmQgaXMgc2F2ZWQgaW4gb3JkZXIg
dG8gY29udmVydCB0aGUKICAgIHJlY29yZCBpbnRvIEpTT04uCgogICAgQnkgZGVmYXVsdCwgaXQg
Y3JlYXRlcyBhIEpTT04gb2JqZWN0IHdpdGggYSBrZXkgZm9yCiAgICBlYWNoIGF0dHJpYnV0ZSBh
bmQgYmVsb25nc1RvIHJlbGF0aW9uc2hpcC4KCiAgICBGb3IgZXhhbXBsZSwgY29uc2lkZXIgdGhp
cyBtb2RlbDoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQ29tbWVudCA9IERTLk1vZGVsLmV4
dGVuZCh7CiAgICAgIHRpdGxlOiBEUy5hdHRyKCksCiAgICAgIGJvZHk6IERTLmF0dHIoKSwKCiAg
ICAgIGF1dGhvcjogRFMuYmVsb25nc1RvKCd1c2VyJykKICAgIH0pOwogICAgYGBgCgogICAgVGhl
IGRlZmF1bHQgc2VyaWFsaXphdGlvbiB3b3VsZCBjcmVhdGUgYSBKU09OIG9iamVjdCBsaWtlOgoK
ICAgIGBgYGphdmFzY3JpcHQKICAgIHsKICAgICAgInRpdGxlIjogIlJhaWxzIGlzIHVuYWdpIiwK
ICAgICAgImJvZHkiOiAiUmFpbHM/IE9tYWthc2U/IE9fTyIsCiAgICAgICJhdXRob3IiOiAxMgog
ICAgfQogICAgYGBgCgogICAgQnkgZGVmYXVsdCwgYXR0cmlidXRlcyBhcmUgcGFzc2VkIHRocm91
Z2ggYXMtaXMsIHVubGVzcwogICAgeW91IHNwZWNpZmllZCBhbiBhdHRyaWJ1dGUgdHlwZSAoYERT
LmF0dHIoJ2RhdGUnKWApLiBJZgogICAgeW91IHNwZWNpZnkgYSB0cmFuc2Zvcm0sIHRoZSBKYXZh
U2NyaXB0IHZhbHVlIHdpbGwgYmUKICAgIHNlcmlhbGl6ZWQgd2hlbiBpbnNlcnRlZCBpbnRvIHRo
ZSBKU09OIGhhc2guCgogICAgQnkgZGVmYXVsdCwgYmVsb25ncy10byByZWxhdGlvbnNoaXBzIGFy
ZSBjb252ZXJ0ZWQgaW50bwogICAgSURzIHdoZW4gaW5zZXJ0ZWQgaW50byB0aGUgSlNPTiBoYXNo
LgoKICAgICMjIElEcwoKICAgIGBzZXJpYWxpemVgIHRha2VzIGFuIG9wdGlvbnMgaGFzaCB3aXRo
IGEgc2luZ2xlIG9wdGlvbjoKICAgIGBpbmNsdWRlSWRgLiBJZiB0aGlzIG9wdGlvbiBpcyBgdHJ1
ZWAsIGBzZXJpYWxpemVgIHdpbGwsCiAgICBieSBkZWZhdWx0IGluY2x1ZGUgdGhlIElEIGluIHRo
ZSBKU09OIG9iamVjdCBpdCBidWlsZHMuCgogICAgVGhlIGFkYXB0ZXIgcGFzc2VzIGluIGBpbmNs
dWRlSWQ6IHRydWVgIHdoZW4gc2VyaWFsaXppbmcKICAgIGEgcmVjb3JkIGZvciBgY3JlYXRlUmVj
b3JkYCwgYnV0IG5vdCBmb3IgYHVwZGF0ZVJlY29yZGAuCgogICAgIyMgQ3VzdG9taXphdGlvbgoK
ICAgIFlvdXIgc2VydmVyIG1heSBleHBlY3QgYSBkaWZmZXJlbnQgSlNPTiBmb3JtYXQgdGhhbiB0
aGUKICAgIGJ1aWx0LWluIHNlcmlhbGl6YXRpb24gZm9ybWF0LgoKICAgIEluIHRoYXQgY2FzZSwg
eW91IGNhbiBpbXBsZW1lbnQgYHNlcmlhbGl6ZWAgeW91cnNlbGYgYW5kCiAgICByZXR1cm4gYSBK
U09OIGhhc2ggb2YgeW91ciBjaG9vc2luZy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUG9z
dFNlcmlhbGl6ZXIgPSBEUy5KU09OU2VyaWFsaXplci5leHRlbmQoewogICAgICBzZXJpYWxpemU6
IGZ1bmN0aW9uKHBvc3QsIG9wdGlvbnMpIHsKICAgICAgICB2YXIganNvbiA9IHsKICAgICAgICAg
IFBPU1RfVFRMOiBwb3N0LmdldCgndGl0bGUnKSwKICAgICAgICAgIFBPU1RfQkRZOiBwb3N0Lmdl
dCgnYm9keScpLAogICAgICAgICAgUE9TVF9DTVM6IHBvc3QuZ2V0KCdjb21tZW50cycpLm1hcFBy
b3BlcnR5KCdpZCcpCiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5pbmNsdWRlSWQpIHsK
ICAgICAgICAgIGpzb24uUE9TVF9JRF8gPSBwb3N0LmdldCgnaWQnKTsKICAgICAgICB9CgogICAg
ICAgIHJldHVybiBqc29uOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgICMjIEN1c3RvbWl6
aW5nIGFuIEFwcC1XaWRlIFNlcmlhbGl6ZXIKCiAgICBJZiB5b3Ugd2FudCB0byBkZWZpbmUgYSBz
ZXJpYWxpemVyIGZvciB5b3VyIGVudGlyZQogICAgYXBwbGljYXRpb24sIHlvdSdsbCBwcm9iYWJs
eSB3YW50IHRvIHVzZSBgZWFjaEF0dHJpYnV0ZWAKICAgIGFuZCBgZWFjaFJlbGF0aW9uc2hpcGAg
b24gdGhlIHJlY29yZC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQXBwbGljYXRpb25TZXJp
YWxpemVyID0gRFMuSlNPTlNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgc2VyaWFsaXplOiBmdW5j
dGlvbihyZWNvcmQsIG9wdGlvbnMpIHsKICAgICAgICB2YXIganNvbiA9IHt9OwoKICAgICAgICBy
ZWNvcmQuZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgICBqc29uW3NlcnZl
ckF0dHJpYnV0ZU5hbWUobmFtZSldID0gcmVjb3JkLmdldChuYW1lKTsKICAgICAgICB9KQoKICAg
ICAgICByZWNvcmQuZWFjaFJlbGF0aW9uc2hpcChmdW5jdGlvbihuYW1lLCByZWxhdGlvbnNoaXAp
IHsKICAgICAgICAgIGlmIChyZWxhdGlvbnNoaXAua2luZCA9PT0gJ2hhc01hbnknKSB7CiAgICAg
ICAgICAgIGpzb25bc2VydmVySGFzTWFueU5hbWUobmFtZSldID0gcmVjb3JkLmdldChuYW1lKS5t
YXBCeSgnaWQnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKG9wdGlvbnMu
aW5jbHVkZUlkKSB7CiAgICAgICAgICBqc29uLklEXyA9IHJlY29yZC5nZXQoJ2lkJyk7CiAgICAg
ICAgfQoKICAgICAgICByZXR1cm4ganNvbjsKICAgICAgfQogICAgfSk7CgogICAgZnVuY3Rpb24g
c2VydmVyQXR0cmlidXRlTmFtZShhdHRyaWJ1dGUpIHsKICAgICAgcmV0dXJuIGF0dHJpYnV0ZS51
bmRlcnNjb3JlKCkudG9VcHBlckNhc2UoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXJ2ZXJIYXNN
YW55TmFtZShuYW1lKSB7CiAgICAgIHJldHVybiBzZXJ2ZXJBdHRyaWJ1dGVOYW1lKG5hbWUuc2lu
Z3VsYXJpemUoKSkgKyAiX0lEUyI7CiAgICB9CiAgICBgYGAKCiAgICBUaGlzIHNlcmlhbGl6ZXIg
d2lsbCBnZW5lcmF0ZSBKU09OIHRoYXQgbG9va3MgbGlrZSB0aGlzOgoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIHsKICAgICAgIlRJVExFIjogIlJhaWxzIGlzIG9tYWthc2UiLAogICAgICAiQk9EWSI6
ICJZZXAuIE9tYWthc2UuIiwKICAgICAgIkNPTU1FTlRfSURTIjogWyAxLCAyLCAzIF0KICAgIH0K
ICAgIGBgYAoKICAgICMjIFR3ZWFraW5nIHRoZSBEZWZhdWx0IEpTT04KCiAgICBJZiB5b3UganVz
dCB3YW50IHRvIGRvIHNvbWUgc21hbGwgdHdlYWtzIG9uIHRoZSBkZWZhdWx0IEpTT04sCiAgICB5
b3UgY2FuIGNhbGwgc3VwZXIgZmlyc3QgYW5kIG1ha2UgdGhlIHR3ZWFrcyBvbiB0aGUgcmV0dXJu
ZWQKICAgIEpTT04uCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlBvc3RTZXJpYWxpemVyID0g
RFMuSlNPTlNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbihyZWNv
cmQsIG9wdGlvbnMpIHsKICAgICAgICB2YXIganNvbiA9IHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMs
IGFyZ3VtZW50cyk7CgogICAgICAgIGpzb24uc3ViamVjdCA9IGpzb24udGl0bGU7CiAgICAgICAg
ZGVsZXRlIGpzb24udGl0bGU7CgogICAgICAgIHJldHVybiBqc29uOwogICAgICB9CiAgICB9KTsK
ICAgIGBgYAoKICAgIEBtZXRob2Qgc2VyaWFsaXplCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERT
Lk1vZGVsfSByZWNvcmQKICAgIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICBAcmV0dXJuIHtP
YmplY3R9IGpzb24KICAqLwogIHNlcmlhbGl6ZTogZnVuY3Rpb24ocmVjb3JkLCBvcHRpb25zKSB7
CiAgICB2YXIganNvbiA9IHt9OwoKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaW5jbHVkZUlk
KSB7CiAgICAgIHZhciBpZCA9IGdldChyZWNvcmQsICdpZCcpOwoKICAgICAgaWYgKGlkKSB7CiAg
ICAgICAganNvbltnZXQodGhpcywgJ3ByaW1hcnlLZXknKV0gPSBpZDsKICAgICAgfQogICAgfQoK
ICAgIHJlY29yZC5lYWNoQXR0cmlidXRlKGZ1bmN0aW9uKGtleSwgYXR0cmlidXRlKSB7CiAgICAg
IHRoaXMuc2VyaWFsaXplQXR0cmlidXRlKHJlY29yZCwganNvbiwga2V5LCBhdHRyaWJ1dGUpOwog
ICAgfSwgdGhpcyk7CgogICAgcmVjb3JkLmVhY2hSZWxhdGlvbnNoaXAoZnVuY3Rpb24oa2V5LCBy
ZWxhdGlvbnNoaXApIHsKICAgICAgaWYgKHJlbGF0aW9uc2hpcC5raW5kID09PSAnYmVsb25nc1Rv
JykgewogICAgICAgIHRoaXMuc2VyaWFsaXplQmVsb25nc1RvKHJlY29yZCwganNvbiwgcmVsYXRp
b25zaGlwKTsKICAgICAgfSBlbHNlIGlmIChyZWxhdGlvbnNoaXAua2luZCA9PT0gJ2hhc01hbnkn
KSB7CiAgICAgICAgdGhpcy5zZXJpYWxpemVIYXNNYW55KHJlY29yZCwganNvbiwgcmVsYXRpb25z
aGlwKTsKICAgICAgfQogICAgfSwgdGhpcyk7CgogICAgcmV0dXJuIGpzb247CiAgfSwKCiAgLyoq
CiAgIGBzZXJpYWxpemVBdHRyaWJ1dGVgIGNhbiBiZSB1c2VkIHRvIGN1c3RvbWl6ZSBob3cgYERT
LmF0dHJgCiAgIHByb3BlcnRpZXMgYXJlIHNlcmlhbGl6ZWQKCiAgIEZvciBleGFtcGxlIGlmIHlv
dSB3YW50ZWQgdG8gZW5zdXJlIGFsbCB5b3UgYXR0cmlidXRlcyB3ZXJlIGFsd2F5cwogICBzZXJp
YWxpemVkIGFzIHByb3BlcnRpZXMgb24gYW4gYGF0dHJpYnV0ZXNgIG9iamVjdCB5b3UgY291bGQK
ICAgd3JpdGU6CgogICBgYGBqYXZhc2NyaXB0CiAgIEFwcC5BcHBsaWNhdGlvblNlcmlhbGl6ZXIg
PSBEUy5KU09OU2VyaWFsaXplci5leHRlbmQoewogICAgIHNlcmlhbGl6ZUF0dHJpYnV0ZTogZnVu
Y3Rpb24ocmVjb3JkLCBqc29uLCBrZXksIGF0dHJpYnV0ZXMpIHsKICAgICAgIGpzb24uYXR0cmli
dXRlcyA9IGpzb24uYXR0cmlidXRlcyB8fCB7fTsKICAgICAgIHRoaXMuX3N1cGVyKHJlY29yZCwg
anNvbi5hdHRyaWJ1dGVzLCBrZXksIGF0dHJpYnV0ZXMpOwogICAgIH0KICAgfSk7CiAgIGBgYAoK
ICAgQG1ldGhvZCBzZXJpYWxpemVBdHRyaWJ1dGUKICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3Jk
CiAgIEBwYXJhbSB7T2JqZWN0fSBqc29uCiAgIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgQHBhcmFt
IHtPYmplY3R9IGF0dHJpYnV0ZQogICovCiAgc2VyaWFsaXplQXR0cmlidXRlOiBmdW5jdGlvbihy
ZWNvcmQsIGpzb24sIGtleSwgYXR0cmlidXRlKSB7CiAgICB2YXIgYXR0cnMgPSBnZXQodGhpcywg
J2F0dHJzJyk7CiAgICB2YXIgdmFsdWUgPSBnZXQocmVjb3JkLCBrZXkpLCB0eXBlID0gYXR0cmli
dXRlLnR5cGU7CgogICAgaWYgKHR5cGUpIHsKICAgICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMudHJh
bnNmb3JtRm9yKHR5cGUpOwogICAgICB2YWx1ZSA9IHRyYW5zZm9ybS5zZXJpYWxpemUodmFsdWUp
OwogICAgfQoKICAgIC8vIGlmIHByb3ZpZGVkLCB1c2UgdGhlIG1hcHBpbmcgcHJvdmlkZWQgYnkg
YGF0dHJzYCBpbgogICAgLy8gdGhlIHNlcmlhbGl6ZXIKICAgIGtleSA9IGF0dHJzICYmIGF0dHJz
W2tleV0gfHwgKHRoaXMua2V5Rm9yQXR0cmlidXRlID8gdGhpcy5rZXlGb3JBdHRyaWJ1dGUoa2V5
KSA6IGtleSk7CgogICAganNvbltrZXldID0gdmFsdWU7CiAgfSwKCiAgLyoqCiAgIGBzZXJpYWxp
emVCZWxvbmdzVG9gIGNhbiBiZSB1c2VkIHRvIGN1c3RvbWl6ZSBob3cgYERTLmJlbG9uZ3NUb2AK
ICAgcHJvcGVydGllcyBhcmUgc2VyaWFsaXplZC4KCiAgIEV4YW1wbGUKCiAgIGBgYGphdmFzY3Jp
cHQKICAgQXBwLlBvc3RTZXJpYWxpemVyID0gRFMuSlNPTlNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAg
ICBzZXJpYWxpemVCZWxvbmdzVG86IGZ1bmN0aW9uKHJlY29yZCwganNvbiwgcmVsYXRpb25zaGlw
KSB7CiAgICAgICB2YXIga2V5ID0gcmVsYXRpb25zaGlwLmtleTsKCiAgICAgICB2YXIgYmVsb25n
c1RvID0gZ2V0KHJlY29yZCwga2V5KTsKCiAgICAgICBrZXkgPSB0aGlzLmtleUZvclJlbGF0aW9u
c2hpcCA/IHRoaXMua2V5Rm9yUmVsYXRpb25zaGlwKGtleSwgImJlbG9uZ3NUbyIpIDoga2V5OwoK
ICAgICAgIGpzb25ba2V5XSA9IEVtYmVyLmlzTm9uZShiZWxvbmdzVG8pID8gYmVsb25nc1RvIDog
YmVsb25nc1RvLnRvSlNPTigpOwogICAgIH0KICAgfSk7CiAgIGBgYAoKICAgQG1ldGhvZCBzZXJp
YWxpemVCZWxvbmdzVG8KICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgIEBwYXJhbSB7T2Jq
ZWN0fSBqc29uCiAgIEBwYXJhbSB7T2JqZWN0fSByZWxhdGlvbnNoaXAKICAqLwogIHNlcmlhbGl6
ZUJlbG9uZ3NUbzogZnVuY3Rpb24ocmVjb3JkLCBqc29uLCByZWxhdGlvbnNoaXApIHsKICAgIHZh
ciBrZXkgPSByZWxhdGlvbnNoaXAua2V5OwoKICAgIHZhciBiZWxvbmdzVG8gPSBnZXQocmVjb3Jk
LCBrZXkpOwoKICAgIGtleSA9IHRoaXMua2V5Rm9yUmVsYXRpb25zaGlwID8gdGhpcy5rZXlGb3JS
ZWxhdGlvbnNoaXAoa2V5LCAiYmVsb25nc1RvIikgOiBrZXk7CgogICAgaWYgKGlzTm9uZShiZWxv
bmdzVG8pKSB7CiAgICAgIGpzb25ba2V5XSA9IGJlbG9uZ3NUbzsKICAgIH0gZWxzZSB7CiAgICAg
IGpzb25ba2V5XSA9IGdldChiZWxvbmdzVG8sICdpZCcpOwogICAgfQoKICAgIGlmIChyZWxhdGlv
bnNoaXAub3B0aW9ucy5wb2x5bW9ycGhpYykgewogICAgICB0aGlzLnNlcmlhbGl6ZVBvbHltb3Jw
aGljVHlwZShyZWNvcmQsIGpzb24sIHJlbGF0aW9uc2hpcCk7CiAgICB9CiAgfSwKCiAgLyoqCiAg
IGBzZXJpYWxpemVIYXNNYW55YCBjYW4gYmUgdXNlZCB0byBjdXN0b21pemUgaG93IGBEUy5oYXNN
YW55YAogICBwcm9wZXJ0aWVzIGFyZSBzZXJpYWxpemVkLgoKICAgRXhhbXBsZQoKICAgYGBgamF2
YXNjcmlwdAogICBBcHAuUG9zdFNlcmlhbGl6ZXIgPSBEUy5KU09OU2VyaWFsaXplci5leHRlbmQo
ewogICAgIHNlcmlhbGl6ZUhhc01hbnk6IGZ1bmN0aW9uKHJlY29yZCwganNvbiwgcmVsYXRpb25z
aGlwKSB7CiAgICAgICB2YXIga2V5ID0gcmVsYXRpb25zaGlwLmtleTsKICAgICAgIGlmIChrZXkg
PT09ICdjb21tZW50cycpIHsKICAgICAgICAgcmV0dXJuOwogICAgICAgfSBlbHNlIHsKICAgICAg
ICAgdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgIH0KICAgICB9CiAg
IH0pOwogICBgYGAKCiAgIEBtZXRob2Qgc2VyaWFsaXplSGFzTWFueQogICBAcGFyYW0ge0RTLk1v
ZGVsfSByZWNvcmQKICAgQHBhcmFtIHtPYmplY3R9IGpzb24KICAgQHBhcmFtIHtPYmplY3R9IHJl
bGF0aW9uc2hpcAogICovCiAgc2VyaWFsaXplSGFzTWFueTogZnVuY3Rpb24ocmVjb3JkLCBqc29u
LCByZWxhdGlvbnNoaXApIHsKICAgIHZhciBrZXkgPSByZWxhdGlvbnNoaXAua2V5OwoKICAgIHZh
ciByZWxhdGlvbnNoaXBUeXBlID0gRFMuUmVsYXRpb25zaGlwQ2hhbmdlLmRldGVybWluZVJlbGF0
aW9uc2hpcFR5cGUocmVjb3JkLmNvbnN0cnVjdG9yLCByZWxhdGlvbnNoaXApOwoKICAgIGlmIChy
ZWxhdGlvbnNoaXBUeXBlID09PSAnbWFueVRvTm9uZScgfHwgcmVsYXRpb25zaGlwVHlwZSA9PT0g
J21hbnlUb01hbnknKSB7CiAgICAgIGpzb25ba2V5XSA9IGdldChyZWNvcmQsIGtleSkubWFwQnko
J2lkJyk7CiAgICAgIC8vIFRPRE8gc3VwcG9ydCBmb3IgcG9seW1vcnBoaWMgbWFueVRvTm9uZSBh
bmQgbWFueVRvTWFueSByZWxhdGlvbnNoaXBzCiAgICB9CiAgfSwKCiAgLyoqCiAgICBZb3UgY2Fu
IHVzZSB0aGlzIG1ldGhvZCB0byBjdXN0b21pemUgaG93IHBvbHltb3JwaGljIG9iamVjdHMgYXJl
CiAgICBzZXJpYWxpemVkLiBPYmplY3RzIGFyZSBjb25zaWRlcmVkIHRvIGJlIHBvbHltb3JwaGlj
IGlmCiAgICBge3BvbHltb3JwaGljOiB0cnVlfWAgaXMgcGFzcyBhcyB0aGUgc2Vjb25kIGFyZ3Vt
ZW50IHRvIHRoZQogICAgYERTLmJlbG9uZ3NUb2AgZnVuY3Rpb24uCgogICAgRXhhbXBsZQoKICAg
IGBgYGphdmFzY3JpcHQKICAgIEFwcC5Db21tZW50U2VyaWFsaXplciA9IERTLkpTT05TZXJpYWxp
emVyLmV4dGVuZCh7CiAgICAgIHNlcmlhbGl6ZVBvbHltb3JwaGljVHlwZTogZnVuY3Rpb24ocmVj
b3JkLCBqc29uLCByZWxhdGlvbnNoaXApIHsKICAgICAgICB2YXIga2V5ID0gcmVsYXRpb25zaGlw
LmtleSwKICAgICAgICAgICAgYmVsb25nc1RvID0gZ2V0KHJlY29yZCwga2V5KTsKICAgICAgICBr
ZXkgPSB0aGlzLmtleUZvckF0dHJpYnV0ZSA/IHRoaXMua2V5Rm9yQXR0cmlidXRlKGtleSkgOiBr
ZXk7CiAgICAgICAganNvbltrZXkgKyAiX3R5cGUiXSA9IGJlbG9uZ3NUby5jb25zdHJ1Y3Rvci50
eXBlS2V5OwogICAgICB9CiAgICB9KTsKICAgYGBgCgogICAgQG1ldGhvZCBzZXJpYWxpemVQb2x5
bW9ycGhpY1R5cGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHBhcmFtIHtPYmpl
Y3R9IGpzb24KICAgIEBwYXJhbSB7T2JqZWN0fSByZWxhdGlvbnNoaXAKICAqLwogIHNlcmlhbGl6
ZVBvbHltb3JwaGljVHlwZTogRW1iZXIuSywKCiAgLy8gRVhUUkFDVAoKICAvKioKICAgIFRoZSBg
ZXh0cmFjdGAgbWV0aG9kIGlzIHVzZWQgdG8gZGVzZXJpYWxpemUgcGF5bG9hZCBkYXRhIGZyb20g
dGhlCiAgICBzZXJ2ZXIuIEJ5IGRlZmF1bHQgdGhlIGBKU09OU2VyaWFsaXplcmAgZG9lcyBub3Qg
cHVzaCB0aGUgcmVjb3JkcwogICAgaW50byB0aGUgc3RvcmUuIEhvd2V2ZXIgcmVjb3JkcyB0aGF0
IHN1YmNsYXNzIGBKU09OU2VyaWFsaXplcmAKICAgIHN1Y2ggYXMgdGhlIGBSRVNUU2VyaWFsaXpl
cmAgbWF5IHB1c2ggcmVjb3JkcyBpbnRvIHRoZSBzdG9yZSBhcwogICAgcGFydCBvZiB0aGUgZXh0
cmFjdCBjYWxsLgoKICAgIFRoaXMgbWV0aG9kIGRlbGV0ZWdhdGVzIHRvIGEgbW9yZSBzcGVjaWZp
YyBleHRyYWN0IG1ldGhvZCBiYXNlZCBvbgogICAgdGhlIGByZXF1ZXN0VHlwZWAuCgogICAgRXhh
bXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBnZXQgPSBFbWJlci5nZXQ7CiAgICBzb2Nr
ZXQub24oJ21lc3NhZ2UnLCBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgIHZhciBtb2RlbE5hbWUg
PSBtZXNzYWdlLm1vZGVsOwogICAgICB2YXIgZGF0YSA9IG1lc3NhZ2UuZGF0YTsKICAgICAgdmFy
IHR5cGUgPSBzdG9yZS5tb2RlbEZvcihtb2RlbE5hbWUpOwogICAgICB2YXIgc2VyaWFsaXplciA9
IHN0b3JlLnNlcmlhbGl6ZXJGb3IodHlwZS50eXBlS2V5KTsKICAgICAgdmFyIHJlY29yZCA9IHNl
cmlhbGl6ZXIuZXh0cmFjdChzdG9yZSwgdHlwZSwgZGF0YSwgZ2V0KGRhdGEsICdpZCcpLCAnc2lu
Z2xlJyk7CiAgICAgIHN0b3JlLnB1c2gobW9kZWxOYW1lLCByZWNvcmQpOwogICAgfSk7CiAgICBg
YGAKCiAgICBAbWV0aG9kIGV4dHJhY3QKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBA
cGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gcGF5
bG9hZAogICAgQHBhcmFtIHtTdHJpbmcgb3IgTnVtYmVyfSBpZAogICAgQHBhcmFtIHtTdHJpbmd9
IHJlcXVlc3RUeXBlCiAgICBAcmV0dXJuIHtPYmplY3R9IGpzb24gVGhlIGRlc2VyaWFsaXplZCBw
YXlsb2FkCiAgKi8KICBleHRyYWN0OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgcGF5bG9hZCwgaWQs
IHJlcXVlc3RUeXBlKSB7CiAgICB0aGlzLmV4dHJhY3RNZXRhKHN0b3JlLCB0eXBlLCBwYXlsb2Fk
KTsKCiAgICB2YXIgc3BlY2lmaWNFeHRyYWN0ID0gImV4dHJhY3QiICsgcmVxdWVzdFR5cGUuY2hh
ckF0KDApLnRvVXBwZXJDYXNlKCkgKyByZXF1ZXN0VHlwZS5zdWJzdHIoMSk7CiAgICByZXR1cm4g
dGhpc1tzcGVjaWZpY0V4dHJhY3RdKHN0b3JlLCB0eXBlLCBwYXlsb2FkLCBpZCwgcmVxdWVzdFR5
cGUpOwogIH0sCgogIC8qKgogICAgYGV4dHJhY3RGaW5kQWxsYCBpcyBhIGhvb2sgaW50byB0aGUg
ZXh0cmFjdCBtZXRob2QgdXNlZCB3aGVuIGEKICAgIGNhbGwgaXMgbWFkZSB0byBgRFMuU3RvcmUj
ZmluZEFsbGAuIEJ5IGRlZmF1bHQgdGhpcyBtZXRob2QgaXMgYW4KICAgIGFsaWFzIGZvciBbZXh0
cmFjdEFycmF5XSgjbWV0aG9kX2V4dHJhY3RBcnJheSkuCgogICAgQG1ldGhvZCBleHRyYWN0Rmlu
ZEFsbAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2Yg
RFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBAcmV0dXJuIHtB
cnJheX0gYXJyYXkgQW4gYXJyYXkgb2YgZGVzZXJpYWxpemVkIG9iamVjdHMKICAqLwogIGV4dHJh
Y3RGaW5kQWxsOiBhbGlhc01ldGhvZCgnZXh0cmFjdEFycmF5JyksCiAgLyoqCiAgICBgZXh0cmFj
dEZpbmRRdWVyeWAgaXMgYSBob29rIGludG8gdGhlIGV4dHJhY3QgbWV0aG9kIHVzZWQgd2hlbiBh
CiAgICBjYWxsIGlzIG1hZGUgdG8gYERTLlN0b3JlI2ZpbmRRdWVyeWAuIEJ5IGRlZmF1bHQgdGhp
cyBtZXRob2QgaXMgYW4KICAgIGFsaWFzIGZvciBbZXh0cmFjdEFycmF5XSgjbWV0aG9kX2V4dHJh
Y3RBcnJheSkuCgogICAgQG1ldGhvZCBleHRyYWN0RmluZFF1ZXJ5CiAgICBAcGFyYW0ge0RTLlN0
b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBh
cmFtIHtPYmplY3R9IHBheWxvYWQKICAgIEByZXR1cm4ge0FycmF5fSBhcnJheSBBbiBhcnJheSBv
ZiBkZXNlcmlhbGl6ZWQgb2JqZWN0cwogICovCiAgZXh0cmFjdEZpbmRRdWVyeTogYWxpYXNNZXRo
b2QoJ2V4dHJhY3RBcnJheScpLAogIC8qKgogICAgYGV4dHJhY3RGaW5kTWFueWAgaXMgYSBob29r
IGludG8gdGhlIGV4dHJhY3QgbWV0aG9kIHVzZWQgd2hlbiBhCiAgICBjYWxsIGlzIG1hZGUgdG8g
YERTLlN0b3JlI2ZpbmRNYW55YC4gQnkgZGVmYXVsdCB0aGlzIG1ldGhvZCBpcwogICAgYWxpYXMg
Zm9yIFtleHRyYWN0QXJyYXldKCNtZXRob2RfZXh0cmFjdEFycmF5KS4KCiAgICBAbWV0aG9kIGV4
dHJhY3RGaW5kTWFueQogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3Vi
Y2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBA
cmV0dXJuIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgb2YgZGVzZXJpYWxpemVkIG9iamVjdHMKICAq
LwogIGV4dHJhY3RGaW5kTWFueTogYWxpYXNNZXRob2QoJ2V4dHJhY3RBcnJheScpLAogIC8qKgog
ICAgYGV4dHJhY3RGaW5kSGFzTWFueWAgaXMgYSBob29rIGludG8gdGhlIGV4dHJhY3QgbWV0aG9k
IHVzZWQgd2hlbiBhCiAgICBjYWxsIGlzIG1hZGUgdG8gYERTLlN0b3JlI2ZpbmRIYXNNYW55YC4g
QnkgZGVmYXVsdCB0aGlzIG1ldGhvZCBpcwogICAgYWxpYXMgZm9yIFtleHRyYWN0QXJyYXldKCNt
ZXRob2RfZXh0cmFjdEFycmF5KS4KCiAgICBAbWV0aG9kIGV4dHJhY3RGaW5kSGFzTWFueQogICAg
QHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9
IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBAcmV0dXJuIHtBcnJheX0gYXJy
YXkgQW4gYXJyYXkgb2YgZGVzZXJpYWxpemVkIG9iamVjdHMKICAqLwogIGV4dHJhY3RGaW5kSGFz
TWFueTogYWxpYXNNZXRob2QoJ2V4dHJhY3RBcnJheScpLAoKICAvKioKICAgIGBleHRyYWN0Q3Jl
YXRlUmVjb3JkYCBpcyBhIGhvb2sgaW50byB0aGUgZXh0cmFjdCBtZXRob2QgdXNlZCB3aGVuIGEK
ICAgIGNhbGwgaXMgbWFkZSB0byBgRFMuU3RvcmUjY3JlYXRlUmVjb3JkYC4gQnkgZGVmYXVsdCB0
aGlzIG1ldGhvZCBpcwogICAgYWxpYXMgZm9yIFtleHRyYWN0U2F2ZV0oI21ldGhvZF9leHRyYWN0
U2F2ZSkuCgogICAgQG1ldGhvZCBleHRyYWN0Q3JlYXRlUmVjb3JkCiAgICBAcGFyYW0ge0RTLlN0
b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBh
cmFtIHtPYmplY3R9IHBheWxvYWQKICAgIEByZXR1cm4ge09iamVjdH0ganNvbiBUaGUgZGVzZXJp
YWxpemVkIHBheWxvYWQKICAqLwogIGV4dHJhY3RDcmVhdGVSZWNvcmQ6IGFsaWFzTWV0aG9kKCdl
eHRyYWN0U2F2ZScpLAogIC8qKgogICAgYGV4dHJhY3RVcGRhdGVSZWNvcmRgIGlzIGEgaG9vayBp
bnRvIHRoZSBleHRyYWN0IG1ldGhvZCB1c2VkIHdoZW4KICAgIGEgY2FsbCBpcyBtYWRlIHRvIGBE
Uy5TdG9yZSN1cGRhdGVgLiBCeSBkZWZhdWx0IHRoaXMgbWV0aG9kIGlzIGFsaWFzCiAgICBmb3Ig
W2V4dHJhY3RTYXZlXSgjbWV0aG9kX2V4dHJhY3RTYXZlKS4KCiAgICBAbWV0aG9kIGV4dHJhY3RV
cGRhdGVSZWNvcmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNs
YXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gcGF5bG9hZAogICAgQHJl
dHVybiB7T2JqZWN0fSBqc29uIFRoZSBkZXNlcmlhbGl6ZWQgcGF5bG9hZAogICovCiAgZXh0cmFj
dFVwZGF0ZVJlY29yZDogYWxpYXNNZXRob2QoJ2V4dHJhY3RTYXZlJyksCiAgLyoqCiAgICBgZXh0
cmFjdERlbGV0ZVJlY29yZGAgaXMgYSBob29rIGludG8gdGhlIGV4dHJhY3QgbWV0aG9kIHVzZWQg
d2hlbgogICAgYSBjYWxsIGlzIG1hZGUgdG8gYERTLlN0b3JlI2RlbGV0ZVJlY29yZGAuIEJ5IGRl
ZmF1bHQgdGhpcyBtZXRob2QgaXMKICAgIGFsaWFzIGZvciBbZXh0cmFjdFNhdmVdKCNtZXRob2Rf
ZXh0cmFjdFNhdmUpLgoKICAgIEBtZXRob2QgZXh0cmFjdERlbGV0ZVJlY29yZAogICAgQHBhcmFt
IHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUK
ICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBAcmV0dXJuIHtPYmplY3R9IGpzb24gVGhl
IGRlc2VyaWFsaXplZCBwYXlsb2FkCiAgKi8KICBleHRyYWN0RGVsZXRlUmVjb3JkOiBhbGlhc01l
dGhvZCgnZXh0cmFjdFNhdmUnKSwKCiAgLyoqCiAgICBgZXh0cmFjdEZpbmRgIGlzIGEgaG9vayBp
bnRvIHRoZSBleHRyYWN0IG1ldGhvZCB1c2VkIHdoZW4KICAgIGEgY2FsbCBpcyBtYWRlIHRvIGBE
Uy5TdG9yZSNmaW5kYC4gQnkgZGVmYXVsdCB0aGlzIG1ldGhvZCBpcwogICAgYWxpYXMgZm9yIFtl
eHRyYWN0U2luZ2xlXSgjbWV0aG9kX2V4dHJhY3RTaW5nbGUpLgoKICAgIEBtZXRob2QgZXh0cmFj
dEZpbmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9m
IERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gcGF5bG9hZAogICAgQHJldHVybiB7
T2JqZWN0fSBqc29uIFRoZSBkZXNlcmlhbGl6ZWQgcGF5bG9hZAogICovCiAgZXh0cmFjdEZpbmQ6
IGFsaWFzTWV0aG9kKCdleHRyYWN0U2luZ2xlJyksCiAgLyoqCiAgICBgZXh0cmFjdEZpbmRCZWxv
bmdzVG9gIGlzIGEgaG9vayBpbnRvIHRoZSBleHRyYWN0IG1ldGhvZCB1c2VkIHdoZW4KICAgIGEg
Y2FsbCBpcyBtYWRlIHRvIGBEUy5TdG9yZSNmaW5kQmVsb25nc1RvYC4gQnkgZGVmYXVsdCB0aGlz
IG1ldGhvZCBpcwogICAgYWxpYXMgZm9yIFtleHRyYWN0U2luZ2xlXSgjbWV0aG9kX2V4dHJhY3RT
aW5nbGUpLgoKICAgIEBtZXRob2QgZXh0cmFjdEZpbmRCZWxvbmdzVG8KICAgIEBwYXJhbSB7RFMu
U3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBA
cGFyYW0ge09iamVjdH0gcGF5bG9hZAogICAgQHJldHVybiB7T2JqZWN0fSBqc29uIFRoZSBkZXNl
cmlhbGl6ZWQgcGF5bG9hZAogICovCiAgZXh0cmFjdEZpbmRCZWxvbmdzVG86IGFsaWFzTWV0aG9k
KCdleHRyYWN0U2luZ2xlJyksCiAgLyoqCiAgICBgZXh0cmFjdFNhdmVgIGlzIGEgaG9vayBpbnRv
IHRoZSBleHRyYWN0IG1ldGhvZCB1c2VkIHdoZW4gYSBjYWxsCiAgICBpcyBtYWRlIHRvIGBEUy5N
b2RlbCNzYXZlYC4gQnkgZGVmYXVsdCB0aGlzIG1ldGhvZCBpcyBhbGlhcwogICAgZm9yIFtleHRy
YWN0U2luZ2xlXSgjbWV0aG9kX2V4dHJhY3RTaW5nbGUpLgoKICAgIEBtZXRob2QgZXh0cmFjdFNh
dmUKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERT
Lk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gcGF5bG9hZAogICAgQHJldHVybiB7T2Jq
ZWN0fSBqc29uIFRoZSBkZXNlcmlhbGl6ZWQgcGF5bG9hZAogICovCiAgZXh0cmFjdFNhdmU6IGFs
aWFzTWV0aG9kKCdleHRyYWN0U2luZ2xlJyksCgogIC8qKgogICAgYGV4dHJhY3RTaW5nbGVgIGlz
IHVzZWQgdG8gZGVzZXJpYWxpemUgYSBzaW5nbGUgcmVjb3JkIHJldHVybmVkCiAgICBmcm9tIHRo
ZSBhZGFwdGVyLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUG9zdFNl
cmlhbGl6ZXIgPSBEUy5KU09OU2VyaWFsaXplci5leHRlbmQoewogICAgICBleHRyYWN0U2luZ2xl
OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgcGF5bG9hZCkgewogICAgICAgIHBheWxvYWQuY29tbWVu
dHMgPSBwYXlsb2FkLl9lbWJlZGRlZC5jb21tZW50OwogICAgICAgIGRlbGV0ZSBwYXlsb2FkLl9l
bWJlZGRlZDsKCiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKHN0b3JlLCB0eXBlLCBwYXlsb2Fk
KTsKICAgICAgfSwKICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCBleHRyYWN0U2luZ2xlCiAg
ICBAcGFyYW0ge0RTLlN0b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2Rl
bH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICAgIEByZXR1cm4ge09iamVjdH0g
anNvbiBUaGUgZGVzZXJpYWxpemVkIHBheWxvYWQKICAqLwogIGV4dHJhY3RTaW5nbGU6IGZ1bmN0
aW9uKHN0b3JlLCB0eXBlLCBwYXlsb2FkKSB7CiAgICByZXR1cm4gdGhpcy5ub3JtYWxpemUodHlw
ZSwgcGF5bG9hZCk7CiAgfSwKCiAgLyoqCiAgICBgZXh0cmFjdEFycmF5YCBpcyB1c2VkIHRvIGRl
c2VyaWFsaXplIGFuIGFycmF5IG9mIHJlY29yZHMKICAgIHJldHVybmVkIGZyb20gdGhlIGFkYXB0
ZXIuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5Qb3N0U2VyaWFsaXpl
ciA9IERTLkpTT05TZXJpYWxpemVyLmV4dGVuZCh7CiAgICAgIGV4dHJhY3RBcnJheTogZnVuY3Rp
b24oc3RvcmUsIHR5cGUsIHBheWxvYWQpIHsKICAgICAgICByZXR1cm4gcGF5bG9hZC5tYXAoZnVu
Y3Rpb24oanNvbikgewogICAgICAgICAgcmV0dXJuIHRoaXMuZXh0cmFjdFNpbmdsZShqc29uKTsK
ICAgICAgICB9LCB0aGlzKTsKICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIGV4
dHJhY3RBcnJheQogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xh
c3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBAcmV0
dXJuIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgb2YgZGVzZXJpYWxpemVkIG9iamVjdHMKICAqLwog
IGV4dHJhY3RBcnJheTogZnVuY3Rpb24oc3RvcmUsIHR5cGUsIHBheWxvYWQpIHsKICAgIHJldHVy
biB0aGlzLm5vcm1hbGl6ZSh0eXBlLCBwYXlsb2FkKTsKICB9LAoKICAvKioKICAgIGBleHRyYWN0
TWV0YWAgaXMgdXNlZCB0byBkZXNlcmlhbGl6ZSBhbnkgbWV0YSBpbmZvcm1hdGlvbiBpbiB0aGUK
ICAgIGFkYXB0ZXIgcGF5bG9hZC4gQnkgZGVmYXVsdCBFbWJlciBEYXRhIGV4cGVjdHMgbWV0YSBp
bmZvcm1hdGlvbiB0bwogICAgYmUgbG9jYXRlZCBvbiB0aGUgYG1ldGFgIHByb3BlcnR5IG9mIHRo
ZSBwYXlsb2FkIG9iamVjdC4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBw
LlBvc3RTZXJpYWxpemVyID0gRFMuSlNPTlNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgZXh0cmFj
dE1ldGE6IGZ1bmN0aW9uKHN0b3JlLCB0eXBlLCBwYXlsb2FkKSB7CiAgICAgICAgaWYgKHBheWxv
YWQgJiYgcGF5bG9hZC5fcGFnaW5hdGlvbikgewogICAgICAgICAgc3RvcmUubWV0YUZvclR5cGUo
dHlwZSwgcGF5bG9hZC5fcGFnaW5hdGlvbik7CiAgICAgICAgICBkZWxldGUgcGF5bG9hZC5fcGFn
aW5hdGlvbjsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCBl
eHRyYWN0TWV0YQogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xh
c3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgKi8KICBl
eHRyYWN0TWV0YTogZnVuY3Rpb24oc3RvcmUsIHR5cGUsIHBheWxvYWQpIHsKICAgIGlmIChwYXls
b2FkICYmIHBheWxvYWQubWV0YSkgewogICAgICBzdG9yZS5tZXRhRm9yVHlwZSh0eXBlLCBwYXls
b2FkLm1ldGEpOwogICAgICBkZWxldGUgcGF5bG9hZC5tZXRhOwogICAgfQogIH0sCgogIC8qKgog
ICBga2V5Rm9yQXR0cmlidXRlYCBjYW4gYmUgdXNlZCB0byBkZWZpbmUgcnVsZXMgZm9yIGhvdyB0
byBjb252ZXJ0IGFuCiAgIGF0dHJpYnV0ZSBuYW1lIGluIHlvdXIgbW9kZWwgdG8gYSBrZXkgaW4g
eW91ciBKU09OLgoKICAgRXhhbXBsZQoKICAgYGBgamF2YXNjcmlwdAogICBBcHAuQXBwbGljYXRp
b25TZXJpYWxpemVyID0gRFMuUkVTVFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICBrZXlGb3JBdHRy
aWJ1dGU6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgIHJldHVybiBFbWJlci5TdHJpbmcudW5kZXJz
Y29yZShhdHRyKS50b1VwcGVyQ2FzZSgpOwogICAgIH0KICAgfSk7CiAgIGBgYAoKICAgQG1ldGhv
ZCBrZXlGb3JBdHRyaWJ1dGUKICAgQHBhcmFtIHtTdHJpbmd9IGtleQogICBAcmV0dXJuIHtTdHJp
bmd9IG5vcm1hbGl6ZWQga2V5CiAgKi8KCgogIC8qKgogICBga2V5Rm9yUmVsYXRpb25zaGlwYCBj
YW4gYmUgdXNlZCB0byBkZWZpbmUgYSBjdXN0b20ga2V5IHdoZW4KICAgc2VyaWFsaXplaW5nIHJl
bGF0aW9uc2hpcCBwcm9wZXJ0aWVzLiBCeSBkZWZhdWx0IGBKU09OU2VyaWFsaXplcmAKICAgZG9l
cyBub3QgcHJvdmlkZSBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIG1ldGhvZC4KCiAgIEV4YW1w
bGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUG9zdFNlcmlhbGl6ZXIgPSBEUy5KU09OU2Vy
aWFsaXplci5leHRlbmQoewogICAgICBrZXlGb3JSZWxhdGlvbnNoaXA6IGZ1bmN0aW9uKGtleSwg
cmVsYXRpb25zaGlwKSB7CiAgICAgICAgIHJldHVybiAncmVsXycgKyBFbWJlci5TdHJpbmcudW5k
ZXJzY29yZShrZXkpOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgQG1ldGhvZCBrZXlGb3JS
ZWxhdGlvbnNoaXAKICAgQHBhcmFtIHtTdHJpbmd9IGtleQogICBAcGFyYW0ge1N0cmluZ30gcmVs
YXRpb25zaGlwIHR5cGUKICAgQHJldHVybiB7U3RyaW5nfSBub3JtYWxpemVkIGtleQogICovCgog
IC8vIEhFTFBFUlMKCiAgLyoqCiAgIEBtZXRob2QgdHJhbnNmb3JtRm9yCiAgIEBwcml2YXRlCiAg
IEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGVUeXBlCiAgIEBwYXJhbSB7Qm9vbGVhbn0gc2tpcEFz
c2VydGlvbgogICBAcmV0dXJuIHtEUy5UcmFuc2Zvcm19IHRyYW5zZm9ybQogICovCiAgdHJhbnNm
b3JtRm9yOiBmdW5jdGlvbihhdHRyaWJ1dGVUeXBlLCBza2lwQXNzZXJ0aW9uKSB7CiAgICB2YXIg
dHJhbnNmb3JtID0gdGhpcy5jb250YWluZXIubG9va3VwKCd0cmFuc2Zvcm06JyArIGF0dHJpYnV0
ZVR5cGUpOwogICAgRW1iZXIuYXNzZXJ0KCJVbmFibGUgdG8gZmluZCB0cmFuc2Zvcm0gZm9yICci
ICsgYXR0cmlidXRlVHlwZSArICInIiwgc2tpcEFzc2VydGlvbiB8fCAhIXRyYW5zZm9ybSk7CiAg
ICByZXR1cm4gdHJhbnNmb3JtOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgog
IEBtb2R1bGUgZW1iZXItZGF0YQoqLwp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBjYXBpdGFsaXplID0g
RW1iZXIuU3RyaW5nLmNhcGl0YWxpemUsIHVuZGVyc2NvcmUgPSBFbWJlci5TdHJpbmcudW5kZXJz
Y29yZSwgRFMgPSB3aW5kb3cuRFMgOwoKLyoqCiAgRXh0ZW5kIGBFbWJlci5EYXRhQWRhcHRlcmAg
d2l0aCBFRCBzcGVjaWZpYyBjb2RlLgoKICBAY2xhc3MgRGVidWdBZGFwdGVyCiAgQG5hbWVzcGFj
ZSBEUwogIEBleHRlbmRzIEVtYmVyLkRhdGFBZGFwdGVyCiAgQHByaXZhdGUKKi8KRFMuRGVidWdB
ZGFwdGVyID0gRW1iZXIuRGF0YUFkYXB0ZXIuZXh0ZW5kKHsKICBnZXRGaWx0ZXJzOiBmdW5jdGlv
bigpIHsKICAgIHJldHVybiBbCiAgICAgIHsgbmFtZTogJ2lzTmV3JywgZGVzYzogJ05ldycgfSwK
ICAgICAgeyBuYW1lOiAnaXNNb2RpZmllZCcsIGRlc2M6ICdNb2RpZmllZCcgfSwKICAgICAgeyBu
YW1lOiAnaXNDbGVhbicsIGRlc2M6ICdDbGVhbicgfQogICAgXTsKICB9LAoKICBkZXRlY3Q6IGZ1
bmN0aW9uKGtsYXNzKSB7CiAgICByZXR1cm4ga2xhc3MgIT09IERTLk1vZGVsICYmIERTLk1vZGVs
LmRldGVjdChrbGFzcyk7CiAgfSwKCiAgY29sdW1uc0ZvclR5cGU6IGZ1bmN0aW9uKHR5cGUpIHsK
ICAgIHZhciBjb2x1bW5zID0gW3sgbmFtZTogJ2lkJywgZGVzYzogJ0lkJyB9XSwgY291bnQgPSAw
LCBzZWxmID0gdGhpczsKICAgIGdldCh0eXBlLCAnYXR0cmlidXRlcycpLmZvckVhY2goZnVuY3Rp
b24obmFtZSwgbWV0YSkgewogICAgICAgIGlmIChjb3VudCsrID4gc2VsZi5hdHRyaWJ1dGVMaW1p
dCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICB2YXIgZGVzYyA9IGNhcGl0YWxpemUodW5kZXJz
Y29yZShuYW1lKS5yZXBsYWNlKCdfJywgJyAnKSk7CiAgICAgICAgY29sdW1ucy5wdXNoKHsgbmFt
ZTogbmFtZSwgZGVzYzogZGVzYyB9KTsKICAgIH0pOwogICAgcmV0dXJuIGNvbHVtbnM7CiAgfSwK
CiAgZ2V0UmVjb3JkczogZnVuY3Rpb24odHlwZSkgewogICAgcmV0dXJuIHRoaXMuZ2V0KCdzdG9y
ZScpLmFsbCh0eXBlKTsKICB9LAoKICBnZXRSZWNvcmRDb2x1bW5WYWx1ZXM6IGZ1bmN0aW9uKHJl
Y29yZCkgewogICAgdmFyIHNlbGYgPSB0aGlzLCBjb3VudCA9IDAsCiAgICAgICAgY29sdW1uVmFs
dWVzID0geyBpZDogZ2V0KHJlY29yZCwgJ2lkJykgfTsKCiAgICByZWNvcmQuZWFjaEF0dHJpYnV0
ZShmdW5jdGlvbihrZXkpIHsKICAgICAgaWYgKGNvdW50KysgPiBzZWxmLmF0dHJpYnV0ZUxpbWl0
KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciB2YWx1ZSA9IGdldChy
ZWNvcmQsIGtleSk7CiAgICAgIGNvbHVtblZhbHVlc1trZXldID0gdmFsdWU7CiAgICB9KTsKICAg
IHJldHVybiBjb2x1bW5WYWx1ZXM7CiAgfSwKCiAgZ2V0UmVjb3JkS2V5d29yZHM6IGZ1bmN0aW9u
KHJlY29yZCkgewogICAgdmFyIGtleXdvcmRzID0gW10sIGtleXMgPSBFbWJlci5BKFsnaWQnXSk7
CiAgICByZWNvcmQuZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihrZXkpIHsKICAgICAga2V5cy5wdXNo
KGtleSk7CiAgICB9KTsKICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAga2V5
d29yZHMucHVzaChnZXQocmVjb3JkLCBrZXkpKTsKICAgIH0pOwogICAgcmV0dXJuIGtleXdvcmRz
OwogIH0sCgogIGdldFJlY29yZEZpbHRlclZhbHVlczogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICBy
ZXR1cm4gewogICAgICBpc05ldzogcmVjb3JkLmdldCgnaXNOZXcnKSwKICAgICAgaXNNb2RpZmll
ZDogcmVjb3JkLmdldCgnaXNEaXJ0eScpICYmICFyZWNvcmQuZ2V0KCdpc05ldycpLAogICAgICBp
c0NsZWFuOiAhcmVjb3JkLmdldCgnaXNEaXJ0eScpCiAgICB9OwogIH0sCgogIGdldFJlY29yZENv
bG9yOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgIHZhciBjb2xvciA9ICdibGFjayc7CiAgICBpZiAo
cmVjb3JkLmdldCgnaXNOZXcnKSkgewogICAgICBjb2xvciA9ICdncmVlbic7CiAgICB9IGVsc2Ug
aWYgKHJlY29yZC5nZXQoJ2lzRGlydHknKSkgewogICAgICBjb2xvciA9ICdibHVlJzsKICAgIH0K
ICAgIHJldHVybiBjb2xvcjsKICB9LAoKICBvYnNlcnZlUmVjb3JkOiBmdW5jdGlvbihyZWNvcmQs
IHJlY29yZFVwZGF0ZWQpIHsKICAgIHZhciByZWxlYXNlTWV0aG9kcyA9IEVtYmVyLkEoKSwgc2Vs
ZiA9IHRoaXMsCiAgICAgICAga2V5c1RvT2JzZXJ2ZSA9IEVtYmVyLkEoWydpZCcsICdpc05ldycs
ICdpc0RpcnR5J10pOwoKICAgIHJlY29yZC5lYWNoQXR0cmlidXRlKGZ1bmN0aW9uKGtleSkgewog
ICAgICBrZXlzVG9PYnNlcnZlLnB1c2goa2V5KTsKICAgIH0pOwoKICAgIGtleXNUb09ic2VydmUu
Zm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbigpIHsK
ICAgICAgICByZWNvcmRVcGRhdGVkKHNlbGYud3JhcFJlY29yZChyZWNvcmQpKTsKICAgICAgfTsK
ICAgICAgRW1iZXIuYWRkT2JzZXJ2ZXIocmVjb3JkLCBrZXksIGhhbmRsZXIpOwogICAgICByZWxl
YXNlTWV0aG9kcy5wdXNoKGZ1bmN0aW9uKCkgewogICAgICAgIEVtYmVyLnJlbW92ZU9ic2VydmVy
KHJlY29yZCwga2V5LCBoYW5kbGVyKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICB2YXIgcmVsZWFz
ZSA9IGZ1bmN0aW9uKCkgewogICAgICByZWxlYXNlTWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uKGZu
KSB7IGZuKCk7IH0gKTsKICAgIH07CgogICAgcmV0dXJuIHJlbGVhc2U7CiAgfQoKfSk7Cgp9KSgp
OwoKCgooZnVuY3Rpb24oKSB7Ci8qKgogIFRoZSBgRFMuVHJhbnNmb3JtYCBjbGFzcyBpcyB1c2Vk
IHRvIHNlcmlhbGl6ZSBhbmQgZGVzZXJpYWxpemUgbW9kZWwKICBhdHRyaWJ1dGVzIHdoZW4gdGhl
eSBhcmUgc2F2ZWQgb3IgbG9hZGVkIGZyb20gYW4KICBhZGFwdGVyLiBTdWJjbGFzc2luZyBgRFMu
VHJhbnNmb3JtYCBpcyB1c2VmdWwgZm9yIGNyZWF0aW5nIGN1c3RvbQogIGF0dHJpYnV0ZXMuIEFs
bCBzdWJjbGFzc2VzIG9mIGBEUy5UcmFuc2Zvcm1gIG11c3QgaW1wbGVtZW50IGEKICBgc2VyaWFs
aXplYCBhbmQgYSBgZGVzZXJpYWxpemVgIG1ldGhvZC4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2Ny
aXB0CiAgQXBwLlJhd1RyYW5zZm9ybSA9IERTLlRyYW5zZm9ybS5leHRlbmQoewogICAgZGVzZXJp
YWxpemU6IGZ1bmN0aW9uKHNlcmlhbGl6ZWQpIHsKICAgICAgcmV0dXJuIHNlcmlhbGl6ZWQ7CiAg
ICB9LAogICAgc2VyaWFsaXplOiBmdW5jdGlvbihkZXNlcmlhbGl6ZWQpIHsKICAgICAgcmV0dXJu
IGRlc2VyaWFsaXplZDsKICAgIH0KICB9KTsKICBgYGAKCiAgVXNhZ2UKCiAgYGBgamF2YXNjcmlw
dAogIHZhciBhdHRyID0gRFMuYXR0cjsKICBBcHAuUmVxdWlyZW1lbnQgPSBEUy5Nb2RlbC5leHRl
bmQoewogICAgbmFtZTogYXR0cignc3RyaW5nJyksCiAgICBvcHRpb25zQXJyYXk6IGF0dHIoJ3Jh
dycpCiAgfSk7CiAgYGBgCgogIEBjbGFzcyBUcmFuc2Zvcm0KICBAbmFtZXNwYWNlIERTCiAqLwpE
Uy5UcmFuc2Zvcm0gPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAvKioKICAgIFdoZW4gZ2l2ZW4g
YSBkZXNlcmlhbGl6ZWQgdmFsdWUgZnJvbSBhIHJlY29yZCBhdHRyaWJ1dGUgdGhpcwogICAgbWV0
aG9kIG11c3QgcmV0dXJuIHRoZSBzZXJpYWxpemVkIHZhbHVlLgoKICAgIEV4YW1wbGUKCiAgICBg
YGBqYXZhc2NyaXB0CiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKGRlc2VyaWFsaXplZCkgewogICAg
ICByZXR1cm4gRW1iZXIuaXNFbXB0eShkZXNlcmlhbGl6ZWQpID8gbnVsbCA6IE51bWJlcihkZXNl
cmlhbGl6ZWQpOwogICAgfQogICAgYGBgCgogICAgQG1ldGhvZCBzZXJpYWxpemUKICAgIEBwYXJh
bSBkZXNlcmlhbGl6ZWQgVGhlIGRlc2VyaWFsaXplZCB2YWx1ZQogICAgQHJldHVybiBUaGUgc2Vy
aWFsaXplZCB2YWx1ZQogICovCiAgc2VyaWFsaXplOiBFbWJlci5yZXF1aXJlZCgpLAoKICAvKioK
ICAgIFdoZW4gZ2l2ZW4gYSBzZXJpYWxpemUgdmFsdWUgZnJvbSBhIEpTT04gb2JqZWN0IHRoaXMg
bWV0aG9kIG11c3QKICAgIHJldHVybiB0aGUgZGVzZXJpYWxpemVkIHZhbHVlIGZvciB0aGUgcmVj
b3JkIGF0dHJpYnV0ZS4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgZGVzZXJp
YWxpemU6IGZ1bmN0aW9uKHNlcmlhbGl6ZWQpIHsKICAgICAgcmV0dXJuIGVtcHR5KHNlcmlhbGl6
ZWQpID8gbnVsbCA6IE51bWJlcihzZXJpYWxpemVkKTsKICAgIH0KICAgIGBgYAoKICAgIEBtZXRo
b2QgZGVzZXJpYWxpemUKICAgIEBwYXJhbSBzZXJpYWxpemVkIFRoZSBzZXJpYWxpemVkIHZhbHVl
CiAgICBAcmV0dXJuIFRoZSBkZXNlcmlhbGl6ZWQgdmFsdWUKICAqLwogIGRlc2VyaWFsaXplOiBF
bWJlci5yZXF1aXJlZCgpCgp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKCi8qKgogIFRoZSBg
RFMuQm9vbGVhblRyYW5zZm9ybWAgY2xhc3MgaXMgdXNlZCB0byBzZXJpYWxpemUgYW5kIGRlc2Vy
aWFsaXplCiAgYm9vbGVhbiBhdHRyaWJ1dGVzIG9uIEVtYmVyIERhdGEgcmVjb3JkIG9iamVjdHMu
IFRoaXMgdHJhbnNmb3JtIGlzCiAgdXNlZCB3aGVuIGBib29sZWFuYCBpcyBwYXNzZWQgYXMgdGhl
IHR5cGUgcGFyYW1ldGVyIHRvIHRoZQogIFtEUy5hdHRyXSguLi8uLi9kYXRhI21ldGhvZF9hdHRy
KSBmdW5jdGlvbi4KCiAgVXNhZ2UKCiAgYGBgamF2YXNjcmlwdAogIHZhciBhdHRyID0gRFMuYXR0
cjsKICBBcHAuVXNlciA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICBpc0FkbWluOiBhdHRyKCdib29s
ZWFuJyksCiAgICBuYW1lOiBhdHRyKCdzdHJpbmcnKSwKICAgIGVtYWlsOiBhdHRyKCdzdHJpbmcn
KQogIH0pOwogIGBgYAoKICBAY2xhc3MgQm9vbGVhblRyYW5zZm9ybQogIEBleHRlbmRzIERTLlRy
YW5zZm9ybQogIEBuYW1lc3BhY2UgRFMKICovCkRTLkJvb2xlYW5UcmFuc2Zvcm0gPSBEUy5UcmFu
c2Zvcm0uZXh0ZW5kKHsKICBkZXNlcmlhbGl6ZTogZnVuY3Rpb24oc2VyaWFsaXplZCkgewogICAg
dmFyIHR5cGUgPSB0eXBlb2Ygc2VyaWFsaXplZDsKCiAgICBpZiAodHlwZSA9PT0gImJvb2xlYW4i
KSB7CiAgICAgIHJldHVybiBzZXJpYWxpemVkOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAic3Ry
aW5nIikgewogICAgICByZXR1cm4gc2VyaWFsaXplZC5tYXRjaCgvXnRydWUkfF50JHxeMSQvaSkg
IT09IG51bGw7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJudW1iZXIiKSB7CiAgICAgIHJldHVy
biBzZXJpYWxpemVkID09PSAxOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAg
fQogIH0sCgogIHNlcmlhbGl6ZTogZnVuY3Rpb24oZGVzZXJpYWxpemVkKSB7CiAgICByZXR1cm4g
Qm9vbGVhbihkZXNlcmlhbGl6ZWQpOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8q
KgogIFRoZSBgRFMuRGF0ZVRyYW5zZm9ybWAgY2xhc3MgaXMgdXNlZCB0byBzZXJpYWxpemUgYW5k
IGRlc2VyaWFsaXplCiAgZGF0ZSBhdHRyaWJ1dGVzIG9uIEVtYmVyIERhdGEgcmVjb3JkIG9iamVj
dHMuIFRoaXMgdHJhbnNmb3JtIGlzIHVzZWQKICB3aGVuIGBkYXRlYCBpcyBwYXNzZWQgYXMgdGhl
IHR5cGUgcGFyYW1ldGVyIHRvIHRoZQogIFtEUy5hdHRyXSguLi8uLi9kYXRhI21ldGhvZF9hdHRy
KSBmdW5jdGlvbi4KCiAgYGBgamF2YXNjcmlwdAogIHZhciBhdHRyID0gRFMuYXR0cjsKICBBcHAu
U2NvcmUgPSBEUy5Nb2RlbC5leHRlbmQoewogICAgdmFsdWU6IGF0dHIoJ251bWJlcicpLAogICAg
cGxheWVyOiBEUy5iZWxvbmdzVG8oJ3BsYXllcicpLAogICAgZGF0ZTogYXR0cignZGF0ZScpCiAg
fSk7CiAgYGBgCgogIEBjbGFzcyBEYXRlVHJhbnNmb3JtCiAgQGV4dGVuZHMgRFMuVHJhbnNmb3Jt
CiAgQG5hbWVzcGFjZSBEUwogKi8KRFMuRGF0ZVRyYW5zZm9ybSA9IERTLlRyYW5zZm9ybS5leHRl
bmQoewoKICBkZXNlcmlhbGl6ZTogZnVuY3Rpb24oc2VyaWFsaXplZCkgewogICAgdmFyIHR5cGUg
PSB0eXBlb2Ygc2VyaWFsaXplZDsKCiAgICBpZiAodHlwZSA9PT0gInN0cmluZyIpIHsKICAgICAg
cmV0dXJuIG5ldyBEYXRlKEVtYmVyLkRhdGUucGFyc2Uoc2VyaWFsaXplZCkpOwogICAgfSBlbHNl
IGlmICh0eXBlID09PSAibnVtYmVyIikgewogICAgICByZXR1cm4gbmV3IERhdGUoc2VyaWFsaXpl
ZCk7CiAgICB9IGVsc2UgaWYgKHNlcmlhbGl6ZWQgPT09IG51bGwgfHwgc2VyaWFsaXplZCA9PT0g
dW5kZWZpbmVkKSB7CiAgICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBub3QgcHJlc2VudCBpbiB0aGUg
ZGF0YSwKICAgICAgLy8gcmV0dXJuIHVuZGVmaW5lZCwgbm90IG51bGwuCiAgICAgIHJldHVybiBz
ZXJpYWxpemVkOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwKCiAg
c2VyaWFsaXplOiBmdW5jdGlvbihkYXRlKSB7CiAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUp
IHsKICAgICAgdmFyIGRheXMgPSBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAi
RnJpIiwgIlNhdCJdOwogICAgICB2YXIgbW9udGhzID0gWyJKYW4iLCAiRmViIiwgIk1hciIsICJB
cHIiLCAiTWF5IiwgIkp1biIsICJKdWwiLCAiQXVnIiwgIlNlcCIsICJPY3QiLCAiTm92IiwgIkRl
YyJdOwoKICAgICAgdmFyIHBhZCA9IGZ1bmN0aW9uKG51bSkgewogICAgICAgIHJldHVybiBudW0g
PCAxMCA/ICIwIitudW0gOiAiIitudW07CiAgICAgIH07CgogICAgICB2YXIgdXRjWWVhciA9IGRh
dGUuZ2V0VVRDRnVsbFllYXIoKSwKICAgICAgICAgIHV0Y01vbnRoID0gZGF0ZS5nZXRVVENNb250
aCgpLAogICAgICAgICAgdXRjRGF5T2ZNb250aCA9IGRhdGUuZ2V0VVRDRGF0ZSgpLAogICAgICAg
ICAgdXRjRGF5ID0gZGF0ZS5nZXRVVENEYXkoKSwKICAgICAgICAgIHV0Y0hvdXJzID0gZGF0ZS5n
ZXRVVENIb3VycygpLAogICAgICAgICAgdXRjTWludXRlcyA9IGRhdGUuZ2V0VVRDTWludXRlcygp
LAogICAgICAgICAgdXRjU2Vjb25kcyA9IGRhdGUuZ2V0VVRDU2Vjb25kcygpOwoKCiAgICAgIHZh
ciBkYXlPZldlZWsgPSBkYXlzW3V0Y0RheV07CiAgICAgIHZhciBkYXlPZk1vbnRoID0gcGFkKHV0
Y0RheU9mTW9udGgpOwogICAgICB2YXIgbW9udGggPSBtb250aHNbdXRjTW9udGhdOwoKICAgICAg
cmV0dXJuIGRheU9mV2VlayArICIsICIgKyBkYXlPZk1vbnRoICsgIiAiICsgbW9udGggKyAiICIg
KyB1dGNZZWFyICsgIiAiICsKICAgICAgICAgICAgIHBhZCh1dGNIb3VycykgKyAiOiIgKyBwYWQo
dXRjTWludXRlcykgKyAiOiIgKyBwYWQodXRjU2Vjb25kcykgKyAiIEdNVCI7CiAgICB9IGVsc2Ug
ewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9IAoKfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7CnZhciBlbXB0eSA9IEVtYmVyLmlzRW1wdHk7Ci8qKgogIFRoZSBgRFMuTnVtYmVyVHJhbnNm
b3JtYCBjbGFzcyBpcyB1c2VkIHRvIHNlcmlhbGl6ZSBhbmQgZGVzZXJpYWxpemUKICBudW1lcmlj
IGF0dHJpYnV0ZXMgb24gRW1iZXIgRGF0YSByZWNvcmQgb2JqZWN0cy4gVGhpcyB0cmFuc2Zvcm0g
aXMKICB1c2VkIHdoZW4gYG51bWJlcmAgaXMgcGFzc2VkIGFzIHRoZSB0eXBlIHBhcmFtZXRlciB0
byB0aGUKICBbRFMuYXR0cl0oLi4vLi4vZGF0YSNtZXRob2RfYXR0cikgZnVuY3Rpb24uCgogIFVz
YWdlCgogIGBgYGphdmFzY3JpcHQKICB2YXIgYXR0ciA9IERTLmF0dHI7CiAgQXBwLlNjb3JlID0g
RFMuTW9kZWwuZXh0ZW5kKHsKICAgIHZhbHVlOiBhdHRyKCdudW1iZXInKSwKICAgIHBsYXllcjog
RFMuYmVsb25nc1RvKCdwbGF5ZXInKSwKICAgIGRhdGU6IGF0dHIoJ2RhdGUnKQogIH0pOwogIGBg
YAoKICBAY2xhc3MgTnVtYmVyVHJhbnNmb3JtCiAgQGV4dGVuZHMgRFMuVHJhbnNmb3JtCiAgQG5h
bWVzcGFjZSBEUwogKi8KRFMuTnVtYmVyVHJhbnNmb3JtID0gRFMuVHJhbnNmb3JtLmV4dGVuZCh7
CgogIGRlc2VyaWFsaXplOiBmdW5jdGlvbihzZXJpYWxpemVkKSB7CiAgICByZXR1cm4gZW1wdHko
c2VyaWFsaXplZCkgPyBudWxsIDogTnVtYmVyKHNlcmlhbGl6ZWQpOwogIH0sCgogIHNlcmlhbGl6
ZTogZnVuY3Rpb24oZGVzZXJpYWxpemVkKSB7CiAgICByZXR1cm4gZW1wdHkoZGVzZXJpYWxpemVk
KSA/IG51bGwgOiBOdW1iZXIoZGVzZXJpYWxpemVkKTsKICB9Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0
aW9uKCkgewp2YXIgbm9uZSA9IEVtYmVyLmlzTm9uZTsKCi8qKgogIFRoZSBgRFMuU3RyaW5nVHJh
bnNmb3JtYCBjbGFzcyBpcyB1c2VkIHRvIHNlcmlhbGl6ZSBhbmQgZGVzZXJpYWxpemUKICBzdHJp
bmcgYXR0cmlidXRlcyBvbiBFbWJlciBEYXRhIHJlY29yZCBvYmplY3RzLiBUaGlzIHRyYW5zZm9y
bSBpcwogIHVzZWQgd2hlbiBgc3RyaW5nYCBpcyBwYXNzZWQgYXMgdGhlIHR5cGUgcGFyYW1ldGVy
IHRvIHRoZQogIFtEUy5hdHRyXSguLi8uLi9kYXRhI21ldGhvZF9hdHRyKSBmdW5jdGlvbi4KCiAg
VXNhZ2UKCiAgYGBgamF2YXNjcmlwdAogIHZhciBhdHRyID0gRFMuYXR0cjsKICBBcHAuVXNlciA9
IERTLk1vZGVsLmV4dGVuZCh7CiAgICBpc0FkbWluOiBhdHRyKCdib29sZWFuJyksCiAgICBuYW1l
OiBhdHRyKCdzdHJpbmcnKSwKICAgIGVtYWlsOiBhdHRyKCdzdHJpbmcnKQogIH0pOwogIGBgYAoK
ICBAY2xhc3MgU3RyaW5nVHJhbnNmb3JtCiAgQGV4dGVuZHMgRFMuVHJhbnNmb3JtCiAgQG5hbWVz
cGFjZSBEUwogKi8KRFMuU3RyaW5nVHJhbnNmb3JtID0gRFMuVHJhbnNmb3JtLmV4dGVuZCh7Cgog
IGRlc2VyaWFsaXplOiBmdW5jdGlvbihzZXJpYWxpemVkKSB7CiAgICByZXR1cm4gbm9uZShzZXJp
YWxpemVkKSA/IG51bGwgOiBTdHJpbmcoc2VyaWFsaXplZCk7CiAgfSwKCiAgc2VyaWFsaXplOiBm
dW5jdGlvbihkZXNlcmlhbGl6ZWQpIHsKICAgIHJldHVybiBub25lKGRlc2VyaWFsaXplZCkgPyBu
dWxsIDogU3RyaW5nKGRlc2VyaWFsaXplZCk7CiAgfQoKfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoK
dmFyIHNldCA9IEVtYmVyLnNldDsKCi8qCiAgVGhpcyBjb2RlIHJlZ2lzdGVycyBhbiBpbmplY3Rp
b24gZm9yIEVtYmVyLkFwcGxpY2F0aW9uLgoKICBJZiBhbiBFbWJlci5qcyBkZXZlbG9wZXIgZGVm
aW5lcyBhIHN1YmNsYXNzIG9mIERTLlN0b3JlIG9uIHRoZWlyIGFwcGxpY2F0aW9uLAogIHRoaXMg
Y29kZSB3aWxsIGF1dG9tYXRpY2FsbHkgaW5zdGFudGlhdGUgaXQgYW5kIG1ha2UgaXQgYXZhaWxh
YmxlIG9uIHRoZQogIHJvdXRlci4KCiAgQWRkaXRpb25hbGx5LCBhZnRlciBhbiBhcHBsaWNhdGlv
bidzIGNvbnRyb2xsZXJzIGhhdmUgYmVlbiBpbmplY3RlZCwgdGhleSB3aWxsCiAgZWFjaCBoYXZl
IHRoZSBzdG9yZSBtYWRlIGF2YWlsYWJsZSB0byB0aGVtLgoKICBGb3IgZXhhbXBsZSwgaW1hZ2lu
ZSBhbiBFbWJlci5qcyBhcHBsaWNhdGlvbiB3aXRoIHRoZSBmb2xsb3dpbmcgY2xhc3NlczoKCiAg
QXBwLlN0b3JlID0gRFMuU3RvcmUuZXh0ZW5kKHsKICAgIGFkYXB0ZXI6ICdjdXN0b20nCiAgfSk7
CgogIEFwcC5Qb3N0c0NvbnRyb2xsZXIgPSBFbWJlci5BcnJheUNvbnRyb2xsZXIuZXh0ZW5kKHsK
ICAgIC8vIC4uLgogIH0pOwoKICBXaGVuIHRoZSBhcHBsaWNhdGlvbiBpcyBpbml0aWFsaXplZCwg
YEFwcC5TdG9yZWAgd2lsbCBhdXRvbWF0aWNhbGx5IGJlCiAgaW5zdGFudGlhdGVkLCBhbmQgdGhl
IGluc3RhbmNlIG9mIGBBcHAuUG9zdHNDb250cm9sbGVyYCB3aWxsIGhhdmUgaXRzIGBzdG9yZWAK
ICBwcm9wZXJ0eSBzZXQgdG8gdGhhdCBpbnN0YW5jZS4KCiAgTm90ZSB0aGF0IHRoaXMgY29kZSB3
aWxsIG9ubHkgYmUgcnVuIGlmIHRoZSBgZW1iZXItYXBwbGljYXRpb25gIHBhY2thZ2UgaXMKICBs
b2FkZWQuIElmIEVtYmVyIERhdGEgaXMgYmVpbmcgdXNlZCBpbiBhbiBlbnZpcm9ubWVudCBvdGhl
ciB0aGFuIGEKICB0eXBpY2FsIGFwcGxpY2F0aW9uIChlLmcuLCBub2RlLmpzIHdoZXJlIG9ubHkg
YGVtYmVyLXJ1bnRpbWVgIGlzIGF2YWlsYWJsZSksCiAgdGhpcyBjb2RlIHdpbGwgYmUgaWdub3Jl
ZC4KKi8KCkVtYmVyLm9uTG9hZCgnRW1iZXIuQXBwbGljYXRpb24nLCBmdW5jdGlvbihBcHBsaWNh
dGlvbikgewogIEFwcGxpY2F0aW9uLmluaXRpYWxpemVyKHsKICAgIG5hbWU6ICJzdG9yZSIsCgog
ICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29udGFpbmVyLCBhcHBsaWNhdGlvbikgewogICAgICBh
cHBsaWNhdGlvbi5yZWdpc3Rlcignc3RvcmU6bWFpbicsIGFwcGxpY2F0aW9uLlN0b3JlIHx8IERT
LlN0b3JlKTsKICAgICAgYXBwbGljYXRpb24ucmVnaXN0ZXIoJ3NlcmlhbGl6ZXI6X2RlZmF1bHQn
LCBEUy5KU09OU2VyaWFsaXplcik7CiAgICAgIGFwcGxpY2F0aW9uLnJlZ2lzdGVyKCdzZXJpYWxp
emVyOl9yZXN0JywgRFMuUkVTVFNlcmlhbGl6ZXIpOwogICAgICBhcHBsaWNhdGlvbi5yZWdpc3Rl
cignYWRhcHRlcjpfcmVzdCcsIERTLlJFU1RBZGFwdGVyKTsKCiAgICAgIC8vIEVhZ2VybHkgZ2Vu
ZXJhdGUgdGhlIHN0b3JlIHNvIGRlZmF1bHRTdG9yZSBpcyBwb3B1bGF0ZWQuCiAgICAgIC8vIFRP
RE86IERvIHRoaXMgaW4gYSBmaW5pc2hlciBob29rCiAgICAgIGNvbnRhaW5lci5sb29rdXAoJ3N0
b3JlOm1haW4nKTsKICAgIH0KICB9KTsKCiAgQXBwbGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAg
bmFtZTogInRyYW5zZm9ybXMiLAogICAgYmVmb3JlOiAic3RvcmUiLAoKICAgIGluaXRpYWxpemU6
IGZ1bmN0aW9uKGNvbnRhaW5lciwgYXBwbGljYXRpb24pIHsKICAgICAgYXBwbGljYXRpb24ucmVn
aXN0ZXIoJ3RyYW5zZm9ybTpib29sZWFuJywgRFMuQm9vbGVhblRyYW5zZm9ybSk7CiAgICAgIGFw
cGxpY2F0aW9uLnJlZ2lzdGVyKCd0cmFuc2Zvcm06ZGF0ZScsIERTLkRhdGVUcmFuc2Zvcm0pOwog
ICAgICBhcHBsaWNhdGlvbi5yZWdpc3RlcigndHJhbnNmb3JtOm51bWJlcicsIERTLk51bWJlclRy
YW5zZm9ybSk7CiAgICAgIGFwcGxpY2F0aW9uLnJlZ2lzdGVyKCd0cmFuc2Zvcm06c3RyaW5nJywg
RFMuU3RyaW5nVHJhbnNmb3JtKTsKICAgIH0KICB9KTsKCiAgQXBwbGljYXRpb24uaW5pdGlhbGl6
ZXIoewogICAgbmFtZTogImRhdGFBZGFwdGVyIiwKICAgIGJlZm9yZTogInN0b3JlIiwKCiAgICBp
bml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgIGFwcGxp
Y2F0aW9uLnJlZ2lzdGVyKCdkYXRhQWRhcHRlcjptYWluJywgRFMuRGVidWdBZGFwdGVyKTsKICAg
IH0KICB9KTsKCiAgQXBwbGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAgbmFtZTogImluamVjdFN0
b3JlIiwKICAgIGJlZm9yZTogInN0b3JlIiwKCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250
YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgIGFwcGxpY2F0aW9uLmluamVjdCgnY29udHJvbGxl
cicsICdzdG9yZScsICdzdG9yZTptYWluJyk7CiAgICAgIGFwcGxpY2F0aW9uLmluamVjdCgncm91
dGUnLCAnc3RvcmUnLCAnc3RvcmU6bWFpbicpOwogICAgICBhcHBsaWNhdGlvbi5pbmplY3QoJ3Nl
cmlhbGl6ZXInLCAnc3RvcmUnLCAnc3RvcmU6bWFpbicpOwogICAgICBhcHBsaWNhdGlvbi5pbmpl
Y3QoJ2RhdGFBZGFwdGVyJywgJ3N0b3JlJywgJ3N0b3JlOm1haW4nKTsKICAgIH0KICB9KTsKCn0p
OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKICBAbW9kdWxlIGVtYmVyLWRhdGEKKi8KCi8q
KgogIERhdGUucGFyc2Ugd2l0aCBwcm9ncmVzc2l2ZSBlbmhhbmNlbWVudCBmb3IgSVNPIDg2MDEg
PGh0dHBzOi8vZ2l0aHViLmNvbS9jc25vdmVyL2pzLWlzbzg2MDE+CgogIMKpIDIwMTEgQ29saW4g
U25vdmVyIDxodHRwOi8vemV0YWZsZWV0LmNvbT4KCiAgUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vu
c2UuCgogIEBjbGFzcyBEYXRlCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBzdGF0aWMKKi8KRW1iZXIu
RGF0ZSA9IEVtYmVyLkRhdGUgfHwge307Cgp2YXIgb3JpZ1BhcnNlID0gRGF0ZS5wYXJzZSwgbnVt
ZXJpY0tleXMgPSBbIDEsIDQsIDUsIDYsIDcsIDEwLCAxMSBdOwoKLyoqCiAgQG1ldGhvZCBwYXJz
ZQogIEBwYXJhbSBkYXRlCiovCkVtYmVyLkRhdGUucGFyc2UgPSBmdW5jdGlvbiAoZGF0ZSkgewog
ICAgdmFyIHRpbWVzdGFtcCwgc3RydWN0LCBtaW51dGVzT2Zmc2V0ID0gMDsKCiAgICAvLyBFUzUg
wqcxNS45LjQuMiBzdGF0ZXMgdGhhdCB0aGUgc3RyaW5nIHNob3VsZCBhdHRlbXB0IHRvIGJlIHBh
cnNlZCBhcyBhIERhdGUgVGltZSBTdHJpbmcgRm9ybWF0IHN0cmluZwogICAgLy8gYmVmb3JlIGZh
bGxpbmcgYmFjayB0byBhbnkgaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgZGF0ZSBwYXJzaW5nLCBz
byB0aGF04oCZcyB3aGF0IHdlIGRvLCBldmVuIGlmIG5hdGl2ZQogICAgLy8gaW1wbGVtZW50YXRp
b25zIGNvdWxkIGJlIGZhc3RlcgogICAgLy8gICAgICAgICAgICAgIDEgWVlZWSAgICAgICAgICAg
ICAgICAyIE1NICAgICAgIDMgREQgICAgICAgICAgIDQgSEggICAgNSBtbSAgICAgICA2IHNzICAg
ICAgICA3IG1zZWMgICAgICAgIDggWiA5IMKxICAgIDEwIHR6SEggICAgMTEgdHptbQogICAgaWYg
KChzdHJ1Y3QgPSAvXihcZHs0fXxbK1wtXVxkezZ9KSg/Oi0oXGR7Mn0pKD86LShcZHsyfSkpPyk/
KD86VChcZHsyfSk6KFxkezJ9KSg/OjooXGR7Mn0pKD86XC4oXGR7M30pKT8pPyg/OihaKXwoWytc
LV0pKFxkezJ9KSg/OjooXGR7Mn0pKT8pPyk/JC8uZXhlYyhkYXRlKSkpIHsKICAgICAgICAvLyBh
dm9pZCBOYU4gdGltZXN0YW1wcyBjYXVzZWQgYnkg4oCcdW5kZWZpbmVk4oCdIHZhbHVlcyBiZWlu
ZyBwYXNzZWQgdG8gRGF0ZS5VVEMKICAgICAgICBmb3IgKHZhciBpID0gMCwgazsgKGsgPSBudW1l
cmljS2V5c1tpXSk7ICsraSkgewogICAgICAgICAgICBzdHJ1Y3Rba10gPSArc3RydWN0W2tdIHx8
IDA7CiAgICAgICAgfQoKICAgICAgICAvLyBhbGxvdyB1bmRlZmluZWQgZGF5cyBhbmQgbW9udGhz
CiAgICAgICAgc3RydWN0WzJdID0gKCtzdHJ1Y3RbMl0gfHwgMSkgLSAxOwogICAgICAgIHN0cnVj
dFszXSA9ICtzdHJ1Y3RbM10gfHwgMTsKCiAgICAgICAgaWYgKHN0cnVjdFs4XSAhPT0gJ1onICYm
IHN0cnVjdFs5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG1pbnV0ZXNPZmZzZXQgPSBz
dHJ1Y3RbMTBdICogNjAgKyBzdHJ1Y3RbMTFdOwoKICAgICAgICAgICAgaWYgKHN0cnVjdFs5XSA9
PT0gJysnKSB7CiAgICAgICAgICAgICAgICBtaW51dGVzT2Zmc2V0ID0gMCAtIG1pbnV0ZXNPZmZz
ZXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRpbWVzdGFtcCA9IERhdGUuVVRD
KHN0cnVjdFsxXSwgc3RydWN0WzJdLCBzdHJ1Y3RbM10sIHN0cnVjdFs0XSwgc3RydWN0WzVdICsg
bWludXRlc09mZnNldCwgc3RydWN0WzZdLCBzdHJ1Y3RbN10pOwogICAgfQogICAgZWxzZSB7CiAg
ICAgICAgdGltZXN0YW1wID0gb3JpZ1BhcnNlID8gb3JpZ1BhcnNlKGRhdGUpIDogTmFOOwogICAg
fQoKICAgIHJldHVybiB0aW1lc3RhbXA7Cn07CgppZiAoRW1iZXIuRVhURU5EX1BST1RPVFlQRVMg
PT09IHRydWUgfHwgRW1iZXIuRVhURU5EX1BST1RPVFlQRVMuRGF0ZSkgewogIERhdGUucGFyc2Ug
PSBFbWJlci5EYXRlLnBhcnNlOwp9Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Cgp9KSgpOwoKCgoo
ZnVuY3Rpb24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKdmFyIGdldCA9IEVtYmVy
LmdldCwgc2V0ID0gRW1iZXIuc2V0OwoKLyoqCiAgQSByZWNvcmQgYXJyYXkgaXMgYW4gYXJyYXkg
dGhhdCBjb250YWlucyByZWNvcmRzIG9mIGEgY2VydGFpbiB0eXBlLiBUaGUgcmVjb3JkCiAgYXJy
YXkgbWF0ZXJpYWxpemVzIHJlY29yZHMgYXMgbmVlZGVkIHdoZW4gdGhleSBhcmUgcmV0cmlldmVk
IGZvciB0aGUgZmlyc3QKICB0aW1lLiBZb3Ugc2hvdWxkIG5vdCBjcmVhdGUgcmVjb3JkIGFycmF5
cyB5b3Vyc2VsZi4gSW5zdGVhZCwgYW4gaW5zdGFuY2Ugb2YKICBgRFMuUmVjb3JkQXJyYXlgIG9y
IGl0cyBzdWJjbGFzc2VzIHdpbGwgYmUgcmV0dXJuZWQgYnkgeW91ciBhcHBsaWNhdGlvbidzIHN0
b3JlCiAgaW4gcmVzcG9uc2UgdG8gcXVlcmllcy4KCiAgQGNsYXNzIFJlY29yZEFycmF5CiAgQG5h
bWVzcGFjZSBEUwogIEBleHRlbmRzIEVtYmVyLkFycmF5UHJveHkKICBAdXNlcyBFbWJlci5FdmVu
dGVkCiovCgpEUy5SZWNvcmRBcnJheSA9IEVtYmVyLkFycmF5UHJveHkuZXh0ZW5kKEVtYmVyLkV2
ZW50ZWQsIHsKICAvKioKICAgIFRoZSBtb2RlbCB0eXBlIGNvbnRhaW5lZCBieSB0aGlzIHJlY29y
ZCBhcnJheS4KCiAgICBAcHJvcGVydHkgdHlwZQogICAgQHR5cGUgRFMuTW9kZWwKICAqLwogIHR5
cGU6IG51bGwsCgogIC8qKgogICAgVGhlIGFycmF5IG9mIGNsaWVudCBpZHMgYmFja2luZyB0aGUg
cmVjb3JkIGFycmF5LiBXaGVuIGEKICAgIHJlY29yZCBpcyByZXF1ZXN0ZWQgZnJvbSB0aGUgcmVj
b3JkIGFycmF5LCB0aGUgcmVjb3JkCiAgICBmb3IgdGhlIGNsaWVudCBpZCBhdCB0aGUgc2FtZSBp
bmRleCBpcyBtYXRlcmlhbGl6ZWQsIGlmCiAgICBuZWNlc3NhcnksIGJ5IHRoZSBzdG9yZS4KCiAg
ICBAcHJvcGVydHkgY29udGVudAogICAgQHByaXZhdGUKICAgIEB0eXBlIEVtYmVyLkFycmF5CiAg
Ki8KICBjb250ZW50OiBudWxsLAoKICAvKioKICAgIFRoZSBmbGFnIHRvIHNpZ25hbCBhIGBSZWNv
cmRBcnJheWAgaXMgY3VycmVudGx5IGxvYWRpbmcgZGF0YS4KCiAgICBFeGFtcGxlCgogICAgYGBg
amF2YXNjcmlwdAogICAgdmFyIHBlb3BsZSA9IHN0b3JlLmFsbChBcHAuUGVyc29uKTsKICAgIHBl
b3BsZS5nZXQoJ2lzTG9hZGVkJyk7IC8vIHRydWUKICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBpc0xv
YWRlZAogICAgQHR5cGUgQm9vbGVhbgogICovCiAgaXNMb2FkZWQ6IGZhbHNlLAogIC8qKgogICAg
VGhlIGZsYWcgdG8gc2lnbmFsIGEgYFJlY29yZEFycmF5YCBpcyBjdXJyZW50bHkgbG9hZGluZyBk
YXRhLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgcGVvcGxlID0gc3Rv
cmUuYWxsKEFwcC5QZXJzb24pOwogICAgcGVvcGxlLmdldCgnaXNVcGRhdGluZycpOyAvLyBmYWxz
ZQogICAgcGVvcGxlLnVwZGF0ZSgpOwogICAgcGVvcGxlLmdldCgnaXNVcGRhdGluZycpOyAvLyB0
cnVlCiAgICBgYGAKCiAgICBAcHJvcGVydHkgaXNVcGRhdGluZwogICAgQHR5cGUgQm9vbGVhbgog
ICovCiAgaXNVcGRhdGluZzogZmFsc2UsCgogIC8qKgogICAgVGhlIHN0b3JlIHRoYXQgY3JlYXRl
ZCB0aGlzIHJlY29yZCBhcnJheS4KCiAgICBAcHJvcGVydHkgc3RvcmUKICAgIEBwcml2YXRlCiAg
ICBAdHlwZSBEUy5TdG9yZQogICovCiAgc3RvcmU6IG51bGwsCgogIC8qKgogICAgUmV0cmlldmVz
IGFuIG9iamVjdCBmcm9tIHRoZSBjb250ZW50IGJ5IGluZGV4LgoKICAgIEBtZXRob2Qgb2JqZWN0
QXRDb250ZW50CiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICBAcmV0
dXJuIHtEUy5Nb2RlbH0gcmVjb3JkCiAgKi8KICBvYmplY3RBdENvbnRlbnQ6IGZ1bmN0aW9uKGlu
ZGV4KSB7CiAgICB2YXIgY29udGVudCA9IGdldCh0aGlzLCAnY29udGVudCcpOwoKICAgIHJldHVy
biBjb250ZW50Lm9iamVjdEF0KGluZGV4KTsKICB9LAoKICAvKioKICAgIFVzZWQgdG8gZ2V0IHRo
ZSBsYXRlc3QgdmVyc2lvbiBvZiBhbGwgb2YgdGhlIHJlY29yZHMgaW4gdGhpcyBhcnJheQogICAg
ZnJvbSB0aGUgYWRhcHRlci4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFy
IHBlb3BsZSA9IHN0b3JlLmFsbChBcHAuUGVyc29uKTsKICAgIHBlb3BsZS5nZXQoJ2lzVXBkYXRp
bmcnKTsgLy8gZmFsc2UKICAgIHBlb3BsZS51cGRhdGUoKTsKICAgIHBlb3BsZS5nZXQoJ2lzVXBk
YXRpbmcnKTsgLy8gdHJ1ZQogICAgYGBgCgogICAgQG1ldGhvZCB1cGRhdGUKICAqLwogIHVwZGF0
ZTogZnVuY3Rpb24oKSB7CiAgICBpZiAoZ2V0KHRoaXMsICdpc1VwZGF0aW5nJykpIHsgcmV0dXJu
OyB9CgogICAgdmFyIHN0b3JlID0gZ2V0KHRoaXMsICdzdG9yZScpLAogICAgICAgIHR5cGUgPSBn
ZXQodGhpcywgJ3R5cGUnKTsKCiAgICBzdG9yZS5mZXRjaEFsbCh0eXBlLCB0aGlzKTsKICB9LAoK
ICAvKioKICAgIEFkZHMgYSByZWNvcmQgdG8gdGhlIGBSZWNvcmRBcnJheWAuCgogICAgQG1ldGhv
ZCBhZGRSZWNvcmQKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNvcmQKICAq
LwogIGFkZFJlY29yZDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICBnZXQodGhpcywgJ2NvbnRlbnQn
KS5hZGRPYmplY3QocmVjb3JkKTsKICB9LAoKICAvKioKICAgIFJlbW92ZXMgYSByZWNvcmQgdG8g
dGhlIGBSZWNvcmRBcnJheWAuCgogICAgQG1ldGhvZCByZW1vdmVSZWNvcmQKICAgIEBwcml2YXRl
CiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNvcmQKICAqLwogIHJlbW92ZVJlY29yZDogZnVuY3Rp
b24ocmVjb3JkKSB7CiAgICBnZXQodGhpcywgJ2NvbnRlbnQnKS5yZW1vdmVPYmplY3QocmVjb3Jk
KTsKICB9LAoKICAvKioKICAgIFNhdmVzIGFsbCBvZiB0aGUgcmVjb3JkcyBpbiB0aGUgYFJlY29y
ZEFycmF5YC4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIG1lc3NhZ2Vz
ID0gc3RvcmUuYWxsKEFwcC5NZXNzYWdlKTsKICAgIG1lc3NhZ2VzLmZvckVhY2goZnVuY3Rpb24o
bWVzc2FnZSkgewogICAgICBtZXNzYWdlLnNldCgnaGFzQmVlblNlZW4nLCB0cnVlKTsKICAgIH0p
OwogICAgbWVzc2FnZXMuc2F2ZSgpOwogICAgYGBgCgogICAgQG1ldGhvZCBzYXZlCiAgICBAcmV0
dXJuIHtEUy5Qcm9taXNlQXJyYXl9IHByb21pc2UKICAqLwogIHNhdmU6IGZ1bmN0aW9uKCkgewog
ICAgdmFyIHByb21pc2VMYWJlbCA9ICJEUzogUmVjb3JkQXJyYXkjc2F2ZSAiICsgZ2V0KHRoaXMs
ICd0eXBlJyk7CiAgICB2YXIgcHJvbWlzZSA9IEVtYmVyLlJTVlAuYWxsKHRoaXMuaW52b2tlKCJz
YXZlIiksIHByb21pc2VMYWJlbCkudGhlbihmdW5jdGlvbihhcnJheSkgewogICAgICByZXR1cm4g
RW1iZXIuQShhcnJheSk7CiAgICB9LCBudWxsLCAiRFM6IFJlY29yZEFycmF5I3NhdmUgYXBwbHkg
RW1iZXIuTmF0aXZlQXJyYXkiKTsKCiAgICByZXR1cm4gRFMuUHJvbWlzZUFycmF5LmNyZWF0ZSh7
IHByb21pc2U6IHByb21pc2UgfSk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoq
CiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0OwoKLyoqCiAgUmVw
cmVzZW50cyBhIGxpc3Qgb2YgcmVjb3JkcyB3aG9zZSBtZW1iZXJzaGlwIGlzIGRldGVybWluZWQg
YnkgdGhlCiAgc3RvcmUuIEFzIHJlY29yZHMgYXJlIGNyZWF0ZWQsIGxvYWRlZCwgb3IgbW9kaWZp
ZWQsIHRoZSBzdG9yZQogIGV2YWx1YXRlcyB0aGVtIHRvIGRldGVybWluZSBpZiB0aGV5IHNob3Vs
ZCBiZSBwYXJ0IG9mIHRoZSByZWNvcmQKICBhcnJheS4KCiAgQGNsYXNzIEZpbHRlcmVkUmVjb3Jk
QXJyYXkKICBAbmFtZXNwYWNlIERTCiAgQGV4dGVuZHMgRFMuUmVjb3JkQXJyYXkKKi8KRFMuRmls
dGVyZWRSZWNvcmRBcnJheSA9IERTLlJlY29yZEFycmF5LmV4dGVuZCh7CiAgLyoqCiAgICBUaGUg
ZmlsdGVyRnVuY3Rpb24gaXMgYSBmdW5jdGlvbiB1c2VkIHRvIHRlc3QgcmVjb3JkcyBmcm9tIHRo
ZSBzdG9yZSB0bwogICAgZGV0ZXJtaW5lIGlmIHRoZXkgc2hvdWxkIGJlIHBhcnQgb2YgdGhlIHJl
Y29yZCBhcnJheS4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGFsbFBl
b3BsZSA9IHN0b3JlLmFsbCgncGVyc29uJyk7CiAgICBhbGxQZW9wbGUubWFwQnkoJ25hbWUnKTsg
Ly8gWyJUb20gRGFsZSIsICJZZWh1ZGEgS2F0eiIsICJUcmVrIEdsb3dhY2tpIl0KCiAgICB2YXIg
cGVvcGxlID0gc3RvcmUuZmlsdGVyKCdwZXJzb24nLCBmdW5jdGlvbihwZXJzb24pIHsKICAgICAg
aWYgKHBlcnNvbi5nZXQoJ25hbWUnKS5tYXRjaCgvS2F0eiQvKSkgeyByZXR1cm4gdHJ1ZTsgfQog
ICAgfSk7CiAgICBwZW9wbGUubWFwQnkoJ25hbWUnKTsgLy8gWyJZZWh1ZGEgS2F0eiJdCgogICAg
dmFyIG5vdEthdHpGaWx0ZXIgPSBmdW5jdGlvbihwZXJzb24pIHsKICAgICAgcmV0dXJuICFwZXJz
b24uZ2V0KCduYW1lJykubWF0Y2goL0thdHokLyk7CiAgICB9OwogICAgcGVvcGxlLnNldCgnZmls
dGVyRnVuY3Rpb24nLCBub3RLYXR6RmlsdGVyKTsKICAgIHBlb3BsZS5tYXBCeSgnbmFtZScpOyAv
LyBbIlRvbSBEYWxlIiwgIlRyZWsgR2xvd2Fja2kiXQogICAgYGBgCgogICAgQG1ldGhvZCBmaWx0
ZXJGdW5jdGlvbgogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBAcmV0dXJuIHtCb29s
ZWFufSBgdHJ1ZWAgaWYgdGhlIHJlY29yZCBzaG91bGQgYmUgaW4gdGhlIGFycmF5CiAgKi8KICBm
aWx0ZXJGdW5jdGlvbjogbnVsbCwKICBpc0xvYWRlZDogdHJ1ZSwKCiAgcmVwbGFjZTogZnVuY3Rp
b24oKSB7CiAgICB2YXIgdHlwZSA9IGdldCh0aGlzLCAndHlwZScpLnRvU3RyaW5nKCk7CiAgICB0
aHJvdyBuZXcgRXJyb3IoIlRoZSByZXN1bHQgb2YgYSBjbGllbnQtc2lkZSBmaWx0ZXIgKG9uICIg
KyB0eXBlICsgIikgaXMgaW1tdXRhYmxlLiIpOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCB1cGRh
dGVGaWx0ZXIKICAgIEBwcml2YXRlCiAgKi8KICB1cGRhdGVGaWx0ZXI6IEVtYmVyLm9ic2VydmVy
KGZ1bmN0aW9uKCkgewogICAgdmFyIG1hbmFnZXIgPSBnZXQodGhpcywgJ21hbmFnZXInKTsKICAg
IG1hbmFnZXIudXBkYXRlRmlsdGVyKHRoaXMsIGdldCh0aGlzLCAndHlwZScpLCBnZXQodGhpcywg
J2ZpbHRlckZ1bmN0aW9uJykpOwogIH0sICdmaWx0ZXJGdW5jdGlvbicpCn0pOwoKfSkoKTsKCgoK
KGZ1bmN0aW9uKCkgewovKioKICBAbW9kdWxlIGVtYmVyLWRhdGEKKi8KCnZhciBnZXQgPSBFbWJl
ci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCi8qKgogIFJlcHJlc2VudHMgYW4gb3JkZXJlZCBsaXN0
IG9mIHJlY29yZHMgd2hvc2Ugb3JkZXIgYW5kIG1lbWJlcnNoaXAgaXMKICBkZXRlcm1pbmVkIGJ5
IHRoZSBhZGFwdGVyLiBGb3IgZXhhbXBsZSwgYSBxdWVyeSBzZW50IHRvIHRoZSBhZGFwdGVyCiAg
bWF5IHRyaWdnZXIgYSBzZWFyY2ggb24gdGhlIHNlcnZlciwgd2hvc2UgcmVzdWx0cyB3b3VsZCBi
ZSBsb2FkZWQKICBpbnRvIGFuIGluc3RhbmNlIG9mIHRoZSBgQWRhcHRlclBvcHVsYXRlZFJlY29y
ZEFycmF5YC4KCiAgQGNsYXNzIEFkYXB0ZXJQb3B1bGF0ZWRSZWNvcmRBcnJheQogIEBuYW1lc3Bh
Y2UgRFMKICBAZXh0ZW5kcyBEUy5SZWNvcmRBcnJheQoqLwpEUy5BZGFwdGVyUG9wdWxhdGVkUmVj
b3JkQXJyYXkgPSBEUy5SZWNvcmRBcnJheS5leHRlbmQoewogIHF1ZXJ5OiBudWxsLAoKICByZXBs
YWNlOiBmdW5jdGlvbigpIHsKICAgIHZhciB0eXBlID0gZ2V0KHRoaXMsICd0eXBlJykudG9TdHJp
bmcoKTsKICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHJlc3VsdCBvZiBhIHNlcnZlciBxdWVyeSAo
b24gIiArIHR5cGUgKyAiKSBpcyBpbW11dGFibGUuIik7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9k
IGxvYWQKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge0FycmF5fSBkYXRhCiAgKi8KICBsb2FkOiBm
dW5jdGlvbihkYXRhKSB7CiAgICB2YXIgc3RvcmUgPSBnZXQodGhpcywgJ3N0b3JlJyksCiAgICAg
ICAgdHlwZSA9IGdldCh0aGlzLCAndHlwZScpLAogICAgICAgIHJlY29yZHMgPSBzdG9yZS5wdXNo
TWFueSh0eXBlLCBkYXRhKSwKICAgICAgICBtZXRhID0gc3RvcmUubWV0YWRhdGFGb3IodHlwZSk7
CgogICAgdGhpcy5zZXRQcm9wZXJ0aWVzKHsKICAgICAgY29udGVudDogRW1iZXIuQShyZWNvcmRz
KSwKICAgICAgaXNMb2FkZWQ6IHRydWUsCiAgICAgIG1ldGE6IG1ldGEKICAgIH0pOwoKICAgIC8v
IFRPRE86IGRvZXMgdHJpZ2dlcmluZyBkaWRMb2FkIGV2ZW50IHNob3VsZCBiZSB0aGUgbGFzdCBh
Y3Rpb24gb2YgdGhlIHJ1bkxvb3A/CiAgICBFbWJlci5ydW4ub25jZSh0aGlzLCAndHJpZ2dlcics
ICdkaWRMb2FkJyk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVs
ZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CnZh
ciBtYXAgPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMubWFwOwoKLyoqCiAgQSBgTWFueUFycmF5YCBp
cyBhIGBSZWNvcmRBcnJheWAgdGhhdCByZXByZXNlbnRzIHRoZSBjb250ZW50cyBvZiBhIGhhcy1t
YW55CiAgcmVsYXRpb25zaGlwLgoKICBUaGUgYE1hbnlBcnJheWAgaXMgaW5zdGFudGlhdGVkIGxh
emlseSB0aGUgZmlyc3QgdGltZSB0aGUgcmVsYXRpb25zaGlwIGlzCiAgcmVxdWVzdGVkLgoKICAj
IyMgSW52ZXJzZXMKCiAgT2Z0ZW4sIHRoZSByZWxhdGlvbnNoaXBzIGluIEVtYmVyIERhdGEgYXBw
bGljYXRpb25zIHdpbGwgaGF2ZQogIGFuIGludmVyc2UuIEZvciBleGFtcGxlLCBpbWFnaW5lIHRo
ZSBmb2xsb3dpbmcgbW9kZWxzIGFyZQogIGRlZmluZWQ6CgogIGBgYGphdmFzY3JpcHQKICBBcHAu
UG9zdCA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICBjb21tZW50czogRFMuaGFzTWFueSgnY29tbWVu
dCcpCiAgfSk7CgogIEFwcC5Db21tZW50ID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgIHBvc3Q6IERT
LmJlbG9uZ3NUbygncG9zdCcpCiAgfSk7CiAgYGBgCgogIElmIHlvdSBjcmVhdGVkIGEgbmV3IGlu
c3RhbmNlIG9mIGBBcHAuUG9zdGAgYW5kIGFkZGVkCiAgYSBgQXBwLkNvbW1lbnRgIHJlY29yZCB0
byBpdHMgYGNvbW1lbnRzYCBoYXMtbWFueQogIHJlbGF0aW9uc2hpcCwgeW91IHdvdWxkIGV4cGVj
dCB0aGUgY29tbWVudCdzIGBwb3N0YAogIHByb3BlcnR5IHRvIGJlIHNldCB0byB0aGUgcG9zdCB0
aGF0IGNvbnRhaW5lZAogIHRoZSBoYXMtbWFueS4KCiAgV2UgY2FsbCB0aGUgcmVjb3JkIHRvIHdo
aWNoIGEgcmVsYXRpb25zaGlwIGJlbG9uZ3MgdGhlCiAgcmVsYXRpb25zaGlwJ3MgX293bmVyXy4K
CiAgQGNsYXNzIE1hbnlBcnJheQogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBEUy5SZWNvcmRB
cnJheQoqLwpEUy5NYW55QXJyYXkgPSBEUy5SZWNvcmRBcnJheS5leHRlbmQoewogIGluaXQ6IGZ1
bmN0aW9uKCkgewogICAgdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIHRo
aXMuX2NoYW5nZXNUb1N5bmMgPSBFbWJlci5PcmRlcmVkU2V0LmNyZWF0ZSgpOwogIH0sCgogIC8q
KgogICAgVGhlIHByb3BlcnR5IG5hbWUgb2YgdGhlIHJlbGF0aW9uc2hpcAoKICAgIEBwcm9wZXJ0
eSB7U3RyaW5nfSBuYW1lCiAgICBAcHJpdmF0ZQogICovCiAgbmFtZTogbnVsbCwKCiAgLyoqCiAg
ICBUaGUgcmVjb3JkIHRvIHdoaWNoIHRoaXMgcmVsYXRpb25zaGlwIGJlbG9uZ3MuCgogICAgQHBy
b3BlcnR5IHtEUy5Nb2RlbH0gb3duZXIKICAgIEBwcml2YXRlCiAgKi8KICBvd25lcjogbnVsbCwK
CiAgLyoqCiAgICBgdHJ1ZWAgaWYgdGhlIHJlbGF0aW9uc2hpcCBpcyBwb2x5bW9ycGhpYywgYGZh
bHNlYCBvdGhlcndpc2UuCgogICAgQHByb3BlcnR5IHtCb29sZWFufSBpc1BvbHltb3JwaGljCiAg
ICBAcHJpdmF0ZQogICovCiAgaXNQb2x5bW9ycGhpYzogZmFsc2UsCgogIC8vIExPQURJTkcgU1RB
VEUKCiAgaXNMb2FkZWQ6IGZhbHNlLAoKICAvKioKICAgIFVzZWQgZm9yIGFzeW5jIGBoYXNNYW55
YCBhcnJheXMKICAgIHRvIGtlZXAgdHJhY2sgb2Ygd2hlbiB0aGV5IHdpbGwgcmVzb2x2ZS4KCiAg
ICBAcHJvcGVydHkge0VtYmVyLlJTVlAuUHJvbWlzZX0gcHJvbWlzZQogICAgQHByaXZhdGUKICAq
LwogIHByb21pc2U6IG51bGwsCgogIC8qKgogICAgQG1ldGhvZCBsb2FkaW5nUmVjb3Jkc0NvdW50
CiAgICBAcGFyYW0ge051bWJlcn0gY291bnQKICAgIEBwcml2YXRlCiAgKi8KICBsb2FkaW5nUmVj
b3Jkc0NvdW50OiBmdW5jdGlvbihjb3VudCkgewogICAgdGhpcy5sb2FkaW5nUmVjb3Jkc0NvdW50
ID0gY291bnQ7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGxvYWRlZFJlY29yZAogICAgQHByaXZh
dGUKICAqLwogIGxvYWRlZFJlY29yZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmxvYWRpbmdSZWNv
cmRzQ291bnQtLTsKICAgIGlmICh0aGlzLmxvYWRpbmdSZWNvcmRzQ291bnQgPT09IDApIHsKICAg
ICAgc2V0KHRoaXMsICdpc0xvYWRlZCcsIHRydWUpOwogICAgICB0aGlzLnRyaWdnZXIoJ2RpZExv
YWQnKTsKICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRob2QgZmV0Y2gKICAgIEBwcml2YXRlCiAg
Ki8KICBmZXRjaDogZnVuY3Rpb24oKSB7CiAgICB2YXIgcmVjb3JkcyA9IGdldCh0aGlzLCAnY29u
dGVudCcpLAogICAgICAgIHN0b3JlID0gZ2V0KHRoaXMsICdzdG9yZScpLAogICAgICAgIG93bmVy
ID0gZ2V0KHRoaXMsICdvd25lcicpLAogICAgICAgIHJlc29sdmVyID0gRW1iZXIuUlNWUC5kZWZl
cigiRFM6IE1hbnlBcnJheSNmZXRjaCAiICsgZ2V0KHRoaXMsICd0eXBlJykpOwoKICAgIHZhciB1
bmxvYWRlZFJlY29yZHMgPSByZWNvcmRzLmZpbHRlclByb3BlcnR5KCdpc0VtcHR5JywgdHJ1ZSk7
CiAgICBzdG9yZS5mZXRjaE1hbnkodW5sb2FkZWRSZWNvcmRzLCBvd25lciwgcmVzb2x2ZXIpOwog
IH0sCgogIC8vIE92ZXJyaWRlcyBFbWJlci5BcnJheSdzIHJlcGxhY2UgbWV0aG9kIHRvIGltcGxl
bWVudAogIHJlcGxhY2VDb250ZW50OiBmdW5jdGlvbihpbmRleCwgcmVtb3ZlZCwgYWRkZWQpIHsK
ICAgIC8vIE1hcCB0aGUgYXJyYXkgb2YgcmVjb3JkIG9iamVjdHMgaW50byBhbiBhcnJheSBvZiAg
Y2xpZW50IGlkcy4KICAgIGFkZGVkID0gbWFwKGFkZGVkLCBmdW5jdGlvbihyZWNvcmQpIHsKICAg
ICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2Fubm90IGFkZCAnIiArIHJlY29yZC5jb25zdHJ1Y3Rvci50
eXBlS2V5ICsgIicgcmVjb3JkcyB0byB0aGlzIHJlbGF0aW9uc2hpcCAob25seSAnIiArIHRoaXMu
dHlwZS50eXBlS2V5ICsgIicgYWxsb3dlZCkiLCAhdGhpcy50eXBlIHx8IHJlY29yZCBpbnN0YW5j
ZW9mIHRoaXMudHlwZSk7CiAgICAgIHJldHVybiByZWNvcmQ7CiAgICB9LCB0aGlzKTsKCiAgICB0
aGlzLl9zdXBlcihpbmRleCwgcmVtb3ZlZCwgYWRkZWQpOwogIH0sCgogIGFycmFuZ2VkQ29udGVu
dERpZENoYW5nZTogZnVuY3Rpb24oKSB7CiAgICBFbWJlci5ydW4ub25jZSh0aGlzLCAnZmV0Y2gn
KTsKICB9LAoKICBhcnJheUNvbnRlbnRXaWxsQ2hhbmdlOiBmdW5jdGlvbihpbmRleCwgcmVtb3Zl
ZCwgYWRkZWQpIHsKICAgIHZhciBvd25lciA9IGdldCh0aGlzLCAnb3duZXInKSwKICAgICAgICBu
YW1lID0gZ2V0KHRoaXMsICduYW1lJyk7CgogICAgaWYgKCFvd25lci5fc3VzcGVuZGVkUmVsYXRp
b25zaGlwcykgewogICAgICAvLyBUaGlzIGNvZGUgaXMgdGhlIGZpcnN0IGhhbGYgb2YgY29kZSB0
aGF0IGNvbnRpbnVlcyBpbnNpZGUKICAgICAgLy8gb2YgYXJyYXlDb250ZW50RGlkQ2hhbmdlLiBJ
dCBnZXRzIG9yIGNyZWF0ZXMgYSBjaGFuZ2UgZnJvbQogICAgICAvLyB0aGUgY2hpbGQgb2JqZWN0
LCBhZGRzIHRoZSBjdXJyZW50IG93bmVyIGFzIHRoZSBvbGQKICAgICAgLy8gcGFyZW50IGlmIHRo
aXMgaXMgdGhlIGZpcnN0IHRpbWUgdGhlIG9iamVjdCB3YXMgcmVtb3ZlZAogICAgICAvLyBmcm9t
IGEgTWFueUFycmF5LCBhbmQgc2V0cyBgbmV3UGFyZW50YCB0byBudWxsLgogICAgICAvLwogICAg
ICAvLyBMYXRlciwgaWYgdGhlIG9iamVjdCBpcyBhZGRlZCB0byBhbm90aGVyIE1hbnlBcnJheSwK
ICAgICAgLy8gdGhlIGBhcnJheUNvbnRlbnREaWRDaGFuZ2VgIHdpbGwgc2V0IGBuZXdQYXJlbnRg
IG9uCiAgICAgIC8vIHRoZSBjaGFuZ2UuCiAgICAgIGZvciAodmFyIGk9aW5kZXg7IGk8aW5kZXgr
cmVtb3ZlZDsgaSsrKSB7CiAgICAgICAgdmFyIHJlY29yZCA9IGdldCh0aGlzLCAnY29udGVudCcp
Lm9iamVjdEF0KGkpOwoKICAgICAgICB2YXIgY2hhbmdlID0gRFMuUmVsYXRpb25zaGlwQ2hhbmdl
LmNyZWF0ZUNoYW5nZShvd25lciwgcmVjb3JkLCBnZXQodGhpcywgJ3N0b3JlJyksIHsKICAgICAg
ICAgIHBhcmVudFR5cGU6IG93bmVyLmNvbnN0cnVjdG9yLAogICAgICAgICAgY2hhbmdlVHlwZTog
InJlbW92ZSIsCiAgICAgICAgICBraW5kOiAiaGFzTWFueSIsCiAgICAgICAgICBrZXk6IG5hbWUK
ICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5fY2hhbmdlc1RvU3luYy5hZGQoY2hhbmdlKTsKICAg
ICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMp
OwogIH0sCgogIGFycmF5Q29udGVudERpZENoYW5nZTogZnVuY3Rpb24oaW5kZXgsIHJlbW92ZWQs
IGFkZGVkKSB7CiAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgIHZh
ciBvd25lciA9IGdldCh0aGlzLCAnb3duZXInKSwKICAgICAgICBuYW1lID0gZ2V0KHRoaXMsICdu
YW1lJyksCiAgICAgICAgc3RvcmUgPSBnZXQodGhpcywgJ3N0b3JlJyk7CgogICAgaWYgKCFvd25l
ci5fc3VzcGVuZGVkUmVsYXRpb25zaGlwcykgewogICAgICAvLyBUaGlzIGNvZGUgaXMgdGhlIHNl
Y29uZCBoYWxmIG9mIGNvZGUgdGhhdCBzdGFydGVkIGluCiAgICAgIC8vIGBhcnJheUNvbnRlbnRX
aWxsQ2hhbmdlYC4gSXQgZ2V0cyBvciBjcmVhdGVzIGEgY2hhbmdlCiAgICAgIC8vIGZyb20gdGhl
IGNoaWxkIG9iamVjdCwgYW5kIGFkZHMgdGhlIGN1cnJlbnQgb3duZXIgYXMKICAgICAgLy8gdGhl
IG5ldyBwYXJlbnQuCiAgICAgIGZvciAodmFyIGk9aW5kZXg7IGk8aW5kZXgrYWRkZWQ7IGkrKykg
ewogICAgICAgIHZhciByZWNvcmQgPSBnZXQodGhpcywgJ2NvbnRlbnQnKS5vYmplY3RBdChpKTsK
CiAgICAgICAgdmFyIGNoYW5nZSA9IERTLlJlbGF0aW9uc2hpcENoYW5nZS5jcmVhdGVDaGFuZ2Uo
b3duZXIsIHJlY29yZCwgc3RvcmUsIHsKICAgICAgICAgIHBhcmVudFR5cGU6IG93bmVyLmNvbnN0
cnVjdG9yLAogICAgICAgICAgY2hhbmdlVHlwZTogImFkZCIsCiAgICAgICAgICBraW5kOiJoYXNN
YW55IiwKICAgICAgICAgIGtleTogbmFtZQogICAgICAgIH0pOwogICAgICAgIGNoYW5nZS5oYXNN
YW55TmFtZSA9IG5hbWU7CgogICAgICAgIHRoaXMuX2NoYW5nZXNUb1N5bmMuYWRkKGNoYW5nZSk7
CiAgICAgIH0KCiAgICAgIC8vIFdlIHdhaXQgdW50aWwgdGhlIGFycmF5IGhhcyBmaW5pc2hlZCBi
ZWluZwogICAgICAvLyBtdXRhdGVkIGJlZm9yZSBzeW5jaW5nIHRoZSBPbmVUb01hbnlDaGFuZ2Vz
IGNyZWF0ZWQKICAgICAgLy8gaW4gYXJyYXlDb250ZW50V2lsbENoYW5nZSwgc28gdGhhdCB0aGUg
YXJyYXkKICAgICAgLy8gbWVtYmVyc2hpcCB0ZXN0IGluIHRoZSBzeW5jKCkgbG9naWMgb3BlcmF0
ZXMKICAgICAgLy8gb24gdGhlIGZpbmFsIHJlc3VsdHMuCiAgICAgIHRoaXMuX2NoYW5nZXNUb1N5
bmMuZm9yRWFjaChmdW5jdGlvbihjaGFuZ2UpIHsKICAgICAgICBjaGFuZ2Uuc3luYygpOwogICAg
ICB9KTsKCiAgICAgIHRoaXMuX2NoYW5nZXNUb1N5bmMuY2xlYXIoKTsKICAgIH0KICB9LAoKICAv
KioKICAgIENyZWF0ZSBhIGNoaWxkIHJlY29yZCB3aXRoaW4gdGhlIG93bmVyCgogICAgQG1ldGhv
ZCBjcmVhdGVSZWNvcmQKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge09iamVjdH0gaGFzaAogICAg
QHJldHVybiB7RFMuTW9kZWx9IHJlY29yZAogICovCiAgY3JlYXRlUmVjb3JkOiBmdW5jdGlvbiho
YXNoKSB7CiAgICB2YXIgb3duZXIgPSBnZXQodGhpcywgJ293bmVyJyksCiAgICAgICAgc3RvcmUg
PSBnZXQob3duZXIsICdzdG9yZScpLAogICAgICAgIHR5cGUgPSBnZXQodGhpcywgJ3R5cGUnKSwK
ICAgICAgICByZWNvcmQ7CgogICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2Fubm90IGFkZCAnIiArIHR5
cGUudHlwZUtleSArICInIHJlY29yZHMgdG8gdGhpcyBwb2x5bW9ycGhpYyByZWxhdGlvbnNoaXAu
IiwgIWdldCh0aGlzLCAnaXNQb2x5bW9ycGhpYycpKTsKCiAgICByZWNvcmQgPSBzdG9yZS5jcmVh
dGVSZWNvcmQuY2FsbChzdG9yZSwgdHlwZSwgaGFzaCk7CiAgICB0aGlzLnB1c2hPYmplY3QocmVj
b3JkKTsKCiAgICByZXR1cm4gcmVjb3JkOwogIH0KCn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkg
ewovKioKICBAbW9kdWxlIGVtYmVyLWRhdGEKKi8KCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLypn
bG9iYWxzIEVtYmVyKi8KLypqc2hpbnQgZXFudWxsOnRydWUqLwovKioKICBAbW9kdWxlIGVtYmVy
LWRhdGEKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKdmFyIG9uY2Ug
PSBFbWJlci5ydW4ub25jZTsKdmFyIGlzTm9uZSA9IEVtYmVyLmlzTm9uZTsKdmFyIGZvckVhY2gg
PSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaDsKdmFyIGluZGV4T2YgPSBFbWJlci5FbnVt
ZXJhYmxlVXRpbHMuaW5kZXhPZjsKdmFyIG1hcCA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5tYXA7
CnZhciByZXNvbHZlID0gRW1iZXIuUlNWUC5yZXNvbHZlOwp2YXIgY29weSA9IEVtYmVyLmNvcHk7
CgovLyBJbXBsZW1lbnRvcnMgTm90ZToKLy8KLy8gICBUaGUgdmFyaWFibGVzIGluIHRoaXMgZmls
ZSBhcmUgY29uc2lzdGVudGx5IG5hbWVkIGFjY29yZGluZyB0byB0aGUgZm9sbG93aW5nCi8vICAg
c2NoZW1lOgovLwovLyAgICogK2lkKyBtZWFucyBhbiBpZGVudGlmaWVyIG1hbmFnZWQgYnkgYW4g
ZXh0ZXJuYWwgc291cmNlLCBwcm92aWRlZCBpbnNpZGUKLy8gICAgIHRoZSBkYXRhIHByb3ZpZGVk
IGJ5IHRoYXQgc291cmNlLiBUaGVzZSBhcmUgYWx3YXlzIGNvZXJjZWQgdG8gYmUgc3RyaW5ncwov
LyAgICAgYmVmb3JlIGJlaW5nIHVzZWQgaW50ZXJuYWxseS4KLy8gICAqICtjbGllbnRJZCsgbWVh
bnMgYSB0cmFuc2llbnQgbnVtZXJpY2FsIGlkZW50aWZpZXIgZ2VuZXJhdGVkIGF0IHJ1bnRpbWUg
YnkKLy8gICAgIHRoZSBkYXRhIHN0b3JlLiBJdCBpcyBpbXBvcnRhbnQgcHJpbWFyaWx5IGJlY2F1
c2UgbmV3bHkgY3JlYXRlZCBvYmplY3RzIG1heQovLyAgICAgbm90IHlldCBoYXZlIGFuIGV4dGVy
bmFsbHkgZ2VuZXJhdGVkIGlkLgovLyAgICogK3JlZmVyZW5jZSsgbWVhbnMgYSByZWNvcmQgcmVm
ZXJlbmNlIG9iamVjdCwgd2hpY2ggaG9sZHMgbWV0YWRhdGEgYWJvdXQgYQovLyAgICAgcmVjb3Jk
LCBldmVuIGlmIGl0IGhhcyBub3QgeWV0IGJlZW4gZnVsbHkgbWF0ZXJpYWxpemVkLgovLyAgICog
K3R5cGUrIG1lYW5zIGEgc3ViY2xhc3Mgb2YgRFMuTW9kZWwuCgovLyBVc2VkIGJ5IHRoZSBzdG9y
ZSB0byBub3JtYWxpemUgSURzIGVudGVyaW5nIHRoZSBzdG9yZS4gIERlc3BpdGUgdGhlIGZhY3QK
Ly8gdGhhdCBkZXZlbG9wZXJzIG1heSBwcm92aWRlIElEcyBhcyBudW1iZXJzIChlLmcuLCBgc3Rv
cmUuZmluZChQZXJzb24sIDEpYCksCi8vIGl0IGlzIGltcG9ydGFudCB0aGF0IGludGVybmFsbHkg
d2UgdXNlIHN0cmluZ3MsIHNpbmNlIElEcyBtYXkgYmUgc2VyaWFsaXplZAovLyBhbmQgbG9zZSB0
eXBlIGluZm9ybWF0aW9uLiAgRm9yIGV4YW1wbGUsIEVtYmVyJ3Mgcm91dGVyIG1heSBwdXQgYSBy
ZWNvcmQncwovLyBJRCBpbnRvIHRoZSBVUkwsIGFuZCBpZiB3ZSBsYXRlciB0cnkgdG8gZGVzZXJp
YWxpemUgdGhhdCBVUkwgYW5kIGZpbmQgdGhlCi8vIGNvcnJlc3BvbmRpbmcgcmVjb3JkLCB3ZSB3
aWxsIG5vdCBrbm93IGlmIGl0IGlzIGEgc3RyaW5nIG9yIGEgbnVtYmVyLgp2YXIgY29lcmNlSWQg
PSBmdW5jdGlvbihpZCkgewogIHJldHVybiBpZCA9PSBudWxsID8gbnVsbCA6IGlkKycnOwp9OwoK
LyoqCiAgVGhlIHN0b3JlIGNvbnRhaW5zIGFsbCBvZiB0aGUgZGF0YSBmb3IgcmVjb3JkcyBsb2Fk
ZWQgZnJvbSB0aGUgc2VydmVyLgogIEl0IGlzIGFsc28gcmVzcG9uc2libGUgZm9yIGNyZWF0aW5n
IGluc3RhbmNlcyBvZiBgRFMuTW9kZWxgIHRoYXQgd3JhcAogIHRoZSBpbmRpdmlkdWFsIGRhdGEg
Zm9yIGEgcmVjb3JkLCBzbyB0aGF0IHRoZXkgY2FuIGJlIGJvdW5kIHRvIGluIHlvdXIKICBIYW5k
bGViYXJzIHRlbXBsYXRlcy4KCiAgRGVmaW5lIHlvdXIgYXBwbGljYXRpb24ncyBzdG9yZSBsaWtl
IHRoaXM6CgogIGBgYGphdmFzY3JpcHQKICBNeUFwcC5TdG9yZSA9IERTLlN0b3JlLmV4dGVuZCgp
OwogIGBgYAoKICBNb3N0IEVtYmVyLmpzIGFwcGxpY2F0aW9ucyB3aWxsIG9ubHkgaGF2ZSBhIHNp
bmdsZSBgRFMuU3RvcmVgIHRoYXQgaXMKICBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgYnkgdGhlaXIg
YEVtYmVyLkFwcGxpY2F0aW9uYC4KCiAgWW91IGNhbiByZXRyaWV2ZSBtb2RlbHMgZnJvbSB0aGUg
c3RvcmUgaW4gc2V2ZXJhbCB3YXlzLiBUbyByZXRyaWV2ZSBhIHJlY29yZAogIGZvciBhIHNwZWNp
ZmljIGlkLCB1c2UgYERTLlN0b3JlYCdzIGBmaW5kKClgIG1ldGhvZDoKCiAgYGBgamF2YXNjcmlw
dAogIHZhciBwZXJzb24gPSBzdG9yZS5maW5kKCdwZXJzb24nLCAxMjMpOwogIGBgYAoKICBJZiB5
b3VyIGFwcGxpY2F0aW9uIGhhcyBtdWx0aXBsZSBgRFMuU3RvcmVgIGluc3RhbmNlcyAoYW4gdW51
c3VhbCBjYXNlKSwgeW91IGNhbgogIHNwZWNpZnkgd2hpY2ggc3RvcmUgc2hvdWxkIGJlIHVzZWQ6
CgogIGBgYGphdmFzY3JpcHQKICB2YXIgcGVyc29uID0gc3RvcmUuZmluZChBcHAuUGVyc29uLCAx
MjMpOwogIGBgYAoKICBCeSBkZWZhdWx0LCB0aGUgc3RvcmUgd2lsbCB0YWxrIHRvIHlvdXIgYmFj
a2VuZCB1c2luZyBhIHN0YW5kYXJkCiAgUkVTVCBtZWNoYW5pc20uIFlvdSBjYW4gY3VzdG9taXpl
IGhvdyB0aGUgc3RvcmUgdGFsa3MgdG8geW91cgogIGJhY2tlbmQgYnkgc3BlY2lmeWluZyBhIGN1
c3RvbSBhZGFwdGVyOgoKICBgYGBqYXZhc2NyaXB0CiAgIE15QXBwLnN0b3JlID0gRFMuU3RvcmUu
Y3JlYXRlKHsKICAgICBhZGFwdGVyOiAnTXlBcHAuQ3VzdG9tQWRhcHRlcicKICAgfSk7CiAgIGBg
YAoKICBZb3UgY2FuIGxlYXJuIG1vcmUgYWJvdXQgd3JpdGluZyBhIGN1c3RvbSBhZGFwdGVyIGJ5
IHJlYWRpbmcgdGhlIGBEUy5BZGFwdGVyYAogIGRvY3VtZW50YXRpb24uCgogIEBjbGFzcyBTdG9y
ZQogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKKi8KRFMuU3RvcmUgPSBF
bWJlci5PYmplY3QuZXh0ZW5kKHsKCiAgLyoqCiAgICBAbWV0aG9kIGluaXQKICAgIEBwcml2YXRl
CiAgKi8KICBpbml0OiBmdW5jdGlvbigpIHsKICAgIC8vIGludGVybmFsIGJvb2trZWVwaW5nOyBu
b3Qgb2JzZXJ2YWJsZQogICAgdGhpcy50eXBlTWFwcyA9IHt9OwogICAgdGhpcy5yZWNvcmRBcnJh
eU1hbmFnZXIgPSBEUy5SZWNvcmRBcnJheU1hbmFnZXIuY3JlYXRlKHsKICAgICAgc3RvcmU6IHRo
aXMKICAgIH0pOwogICAgdGhpcy5fcmVsYXRpb25zaGlwQ2hhbmdlcyA9IHt9OwogICAgdGhpcy5f
cGVuZGluZ1NhdmUgPSBbXTsKICB9LAoKICAvKioKICAgIFRoZSBhZGFwdGVyIHRvIHVzZSB0byBj
b21tdW5pY2F0ZSB0byBhIGJhY2tlbmQgc2VydmVyIG9yIG90aGVyIHBlcnNpc3RlbmNlIGxheWVy
LgoKICAgIFRoaXMgY2FuIGJlIHNwZWNpZmllZCBhcyBhbiBpbnN0YW5jZSwgY2xhc3MsIG9yIHN0
cmluZy4KCiAgICBJZiB5b3Ugd2FudCB0byBzcGVjaWZ5IGBBcHAuQ3VzdG9tQWRhcHRlcmAgYXMg
YSBzdHJpbmcsIGRvOgoKICAgIGBgYGpzCiAgICBhZGFwdGVyOiAnY3VzdG9tJwogICAgYGBgCgog
ICAgQHByb3BlcnR5IGFkYXB0ZXIKICAgIEBkZWZhdWx0IERTLlJFU1RBZGFwdGVyCiAgICBAdHlw
ZSB7RFMuQWRhcHRlcnxTdHJpbmd9CiAgKi8KICBhZGFwdGVyOiAnX3Jlc3QnLAoKICAvKioKICAg
IFJldHVybnMgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZWNvcmQgdXNpbmcgYSBjdXN0
b20KICAgIHR5cGUtc3BlY2lmaWMgc2VyaWFsaXplciwgaWYgb25lIGV4aXN0cy4KCiAgICBUaGUg
YXZhaWxhYmxlIG9wdGlvbnMgYXJlOgoKICAgICogYGluY2x1ZGVJZGA6IGB0cnVlYCBpZiB0aGUg
cmVjb3JkJ3MgSUQgc2hvdWxkIGJlIGluY2x1ZGVkIGluCiAgICAgIHRoZSBKU09OIHJlcHJlc2Vu
dGF0aW9uCgogICAgQG1ldGhvZCBzZXJpYWxpemUKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge0RT
Lk1vZGVsfSByZWNvcmQgdGhlIHJlY29yZCB0byBzZXJpYWxpemUKICAgIEBwYXJhbSB7T2JqZWN0
fSBvcHRpb25zIGFuIG9wdGlvbnMgaGFzaAogICovCiAgc2VyaWFsaXplOiBmdW5jdGlvbihyZWNv
cmQsIG9wdGlvbnMpIHsKICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZXJGb3IocmVjb3JkLmNvbnN0
cnVjdG9yLnR5cGVLZXkpLnNlcmlhbGl6ZShyZWNvcmQsIG9wdGlvbnMpOwogIH0sCgogIC8qKgog
ICAgVGhpcyBwcm9wZXJ0eSByZXR1cm5zIHRoZSBhZGFwdGVyLCBhZnRlciByZXNvbHZpbmcgYSBw
b3NzaWJsZQogICAgc3RyaW5nIGtleS4KCiAgICBJZiB0aGUgc3VwcGxpZWQgYGFkYXB0ZXJgIHdh
cyBhIGNsYXNzLCBvciBhIFN0cmluZyBwcm9wZXJ0eQogICAgcGF0aCByZXNvbHZlZCB0byBhIGNs
YXNzLCB0aGlzIHByb3BlcnR5IHdpbGwgaW5zdGFudGlhdGUgdGhlCiAgICBjbGFzcy4KCiAgICBU
aGlzIHByb3BlcnR5IGlzIGNhY2hlYWJsZSwgc28gdGhlIHNhbWUgaW5zdGFuY2Ugb2YgYSBzcGVj
aWZpZWQKICAgIGFkYXB0ZXIgY2xhc3Mgc2hvdWxkIGJlIHVzZWQgZm9yIHRoZSBsaWZldGltZSBv
ZiB0aGUgc3RvcmUuCgogICAgQHByb3BlcnR5IGRlZmF1bHRBZGFwdGVyCiAgICBAcHJpdmF0ZQog
ICAgQHJldHVybnMgRFMuQWRhcHRlcgogICovCiAgZGVmYXVsdEFkYXB0ZXI6IEVtYmVyLmNvbXB1
dGVkKCdhZGFwdGVyJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgYWRhcHRlciA9IGdldCh0aGlzLCAn
YWRhcHRlcicpOwoKICAgIEVtYmVyLmFzc2VydCgnWW91IHRyaWVkIHRvIHNldCBgYWRhcHRlcmAg
cHJvcGVydHkgdG8gYW4gaW5zdGFuY2Ugb2YgYERTLkFkYXB0ZXJgLCB3aGVyZSBpdCBzaG91bGQg
YmUgYSBuYW1lIG9yIGEgZmFjdG9yeScsICEoYWRhcHRlciBpbnN0YW5jZW9mIERTLkFkYXB0ZXIp
KTsKCiAgICBpZiAodHlwZW9mIGFkYXB0ZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgIGFkYXB0ZXIg
PSB0aGlzLmNvbnRhaW5lci5sb29rdXAoJ2FkYXB0ZXI6JyArIGFkYXB0ZXIpIHx8IHRoaXMuY29u
dGFpbmVyLmxvb2t1cCgnYWRhcHRlcjphcHBsaWNhdGlvbicpIHx8IHRoaXMuY29udGFpbmVyLmxv
b2t1cCgnYWRhcHRlcjpfcmVzdCcpOwogICAgfQoKICAgIGlmIChEUy5BZGFwdGVyLmRldGVjdChh
ZGFwdGVyKSkgewogICAgICBhZGFwdGVyID0gYWRhcHRlci5jcmVhdGUoeyBjb250YWluZXI6IHRo
aXMuY29udGFpbmVyIH0pOwogICAgfQoKICAgIHJldHVybiBhZGFwdGVyOwogIH0pLAoKICAvLyAu
Li4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyAuIENSRUFURSBORVcgUkVDT1JEIC4KICAvLyAuLi4u
Li4uLi4uLi4uLi4uLi4uLi4KCiAgLyoqCiAgICBDcmVhdGUgYSBuZXcgcmVjb3JkIGluIHRoZSBj
dXJyZW50IHN0b3JlLiBUaGUgcHJvcGVydGllcyBwYXNzZWQKICAgIHRvIHRoaXMgbWV0aG9kIGFy
ZSBzZXQgb24gdGhlIG5ld2x5IGNyZWF0ZWQgcmVjb3JkLgoKICAgIFRvIGNyZWF0ZSBhIG5ldyBp
bnN0YW5jZSBvZiBgQXBwLlBvc3RgOgoKICAgIGBgYGpzCiAgICBzdG9yZS5jcmVhdGVSZWNvcmQo
J3Bvc3QnLCB7CiAgICAgIHRpdGxlOiAiUmFpbHMgaXMgb21ha2FzZSIKICAgIH0pOwogICAgYGBg
CgogICAgQG1ldGhvZCBjcmVhdGVSZWNvcmQKICAgIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICBA
cGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBhIGhhc2ggb2YgcHJvcGVydGllcyB0byBzZXQgb24g
dGhlCiAgICAgIG5ld2x5IGNyZWF0ZWQgcmVjb3JkLgogICAgQHJldHVybnMge0RTLk1vZGVsfSBy
ZWNvcmQKICAqLwogIGNyZWF0ZVJlY29yZDogZnVuY3Rpb24odHlwZSwgcHJvcGVydGllcykgewog
ICAgdHlwZSA9IHRoaXMubW9kZWxGb3IodHlwZSk7CgogICAgcHJvcGVydGllcyA9IGNvcHkocHJv
cGVydGllcykgfHwge307CgogICAgLy8gSWYgdGhlIHBhc3NlZCBwcm9wZXJ0aWVzIGRvIG5vdCBp
bmNsdWRlIGEgcHJpbWFyeSBrZXksCiAgICAvLyBnaXZlIHRoZSBhZGFwdGVyIGFuIG9wcG9ydHVu
aXR5IHRvIGdlbmVyYXRlIG9uZS4gVHlwaWNhbGx5LAogICAgLy8gY2xpZW50LXNpZGUgSUQgZ2Vu
ZXJhdG9ycyB3aWxsIHVzZSBzb21ldGhpbmcgbGlrZSB1dWlkLmpzCiAgICAvLyB0byBhdm9pZCBj
b25mbGljdHMuCgogICAgaWYgKGlzTm9uZShwcm9wZXJ0aWVzLmlkKSkgewogICAgICBwcm9wZXJ0
aWVzLmlkID0gdGhpcy5fZ2VuZXJhdGVJZCh0eXBlKTsKICAgIH0KCiAgICAvLyBDb2VyY2UgSUQg
dG8gYSBzdHJpbmcKICAgIHByb3BlcnRpZXMuaWQgPSBjb2VyY2VJZChwcm9wZXJ0aWVzLmlkKTsK
CiAgICB2YXIgcmVjb3JkID0gdGhpcy5idWlsZFJlY29yZCh0eXBlLCBwcm9wZXJ0aWVzLmlkKTsK
CiAgICAvLyBNb3ZlIHRoZSByZWNvcmQgb3V0IG9mIGl0cyBpbml0aWFsIGBlbXB0eWAgc3RhdGUg
aW50bwogICAgLy8gdGhlIGBsb2FkZWRgIHN0YXRlLgogICAgcmVjb3JkLmxvYWRlZERhdGEoKTsK
CiAgICAvLyBTZXQgdGhlIHByb3BlcnRpZXMgc3BlY2lmaWVkIG9uIHRoZSByZWNvcmQuCiAgICBy
ZWNvcmQuc2V0UHJvcGVydGllcyhwcm9wZXJ0aWVzKTsKCiAgICByZXR1cm4gcmVjb3JkOwogIH0s
CgogIC8qKgogICAgSWYgcG9zc2libGUsIHRoaXMgbWV0aG9kIGFza3MgdGhlIGFkYXB0ZXIgdG8g
Z2VuZXJhdGUgYW4gSUQgZm9yCiAgICBhIG5ld2x5IGNyZWF0ZWQgcmVjb3JkLgoKICAgIEBtZXRo
b2QgX2dlbmVyYXRlSWQKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAg
QHJldHVybnMge1N0cmluZ30gaWYgdGhlIGFkYXB0ZXIgY2FuIGdlbmVyYXRlIG9uZSwgYW4gSUQK
ICAqLwogIF9nZW5lcmF0ZUlkOiBmdW5jdGlvbih0eXBlKSB7CiAgICB2YXIgYWRhcHRlciA9IHRo
aXMuYWRhcHRlckZvcih0eXBlKTsKCiAgICBpZiAoYWRhcHRlciAmJiBhZGFwdGVyLmdlbmVyYXRl
SWRGb3JSZWNvcmQpIHsKICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2VuZXJhdGVJZEZvclJlY29yZCh0
aGlzKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4u
LgogIC8vIC4gREVMRVRFIFJFQ09SRCAuCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4KCiAgLyoqCiAg
ICBGb3Igc3ltbWV0cnksIGEgcmVjb3JkIGNhbiBiZSBkZWxldGVkIHZpYSB0aGUgc3RvcmUuCgog
ICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBwb3N0ID0gc3RvcmUuY3JlYXRl
UmVjb3JkKCdwb3N0JywgewogICAgICB0aXRsZTogIlJhaWxzIGlzIG9tYWthc2UiCiAgICB9KTsK
CiAgICBzdG9yZS5kZWxldGVkUmVjb3JkKHBvc3QpOwogICAgYGBgCgogICAgQG1ldGhvZCBkZWxl
dGVSZWNvcmQKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICovCiAgZGVsZXRlUmVjb3Jk
OiBmdW5jdGlvbihyZWNvcmQpIHsKICAgIHJlY29yZC5kZWxldGVSZWNvcmQoKTsKICB9LAoKICAv
KioKICAgIEZvciBzeW1tZXRyeSwgYSByZWNvcmQgY2FuIGJlIHVubG9hZGVkIHZpYSB0aGUgc3Rv
cmUuIE9ubHkKICAgIG5vbi1kaXJ0eSByZWNvcmRzIGNhbiBiZSB1bmxvYWRlZC4KCiAgICBFeGFt
cGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgc3RvcmUuZmluZCgncG9zdCcsIDEpLnRoZW4oZnVu
Y3Rpb24ocG9zdCkgewogICAgICBzdG9yZS51bmxvYWRSZWNvcmQocG9zdCk7CiAgICB9KTsKICAg
IGBgYAoKICAgIEBtZXRob2QgdW5sb2FkUmVjb3JkCiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNv
cmQKICAqLwogIHVubG9hZFJlY29yZDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICByZWNvcmQudW5s
b2FkUmVjb3JkKCk7CiAgfSwKCiAgLy8gLi4uLi4uLi4uLi4uLi4uLgogIC8vIC4gRklORCBSRUNP
UkRTIC4KICAvLyAuLi4uLi4uLi4uLi4uLi4uCgogIC8qKgogICAgVGhpcyBpcyB0aGUgbWFpbiBl
bnRyeSBwb2ludCBpbnRvIGZpbmRpbmcgcmVjb3Jkcy4gVGhlIGZpcnN0IHBhcmFtZXRlciB0bwog
ICAgdGhpcyBtZXRob2QgaXMgdGhlIG1vZGVsJ3MgbmFtZSBhcyBhIHN0cmluZy4KCiAgICAtLS0K
CiAgICBUbyBmaW5kIGEgcmVjb3JkIGJ5IElELCBwYXNzIHRoZSBgaWRgIGFzIHRoZSBzZWNvbmQg
cGFyYW1ldGVyOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHN0b3JlLmZpbmQoJ3BlcnNvbicsIDEp
OwogICAgYGBgCgogICAgVGhlIGBmaW5kYCBtZXRob2Qgd2lsbCBhbHdheXMgcmV0dXJuIGEgKipw
cm9taXNlKiogdGhhdCB3aWxsIGJlIHJlc29sdmVkCiAgICB3aXRoIHRoZSByZWNvcmQuIElmIHRo
ZSByZWNvcmQgd2FzIGFscmVhZHkgaW4gdGhlIHN0b3JlLCB0aGUgcHJvbWlzZSB3aWxsCiAgICBi
ZSByZXNvbHZlZCBpbW1lZGlhdGVseS4gT3RoZXJ3aXNlLCB0aGUgc3RvcmUgd2lsbCBhc2sgdGhl
IGFkYXB0ZXIncyBgZmluZGAKICAgIG1ldGhvZCB0byBmaW5kIHRoZSBuZWNlc3NhcnkgZGF0YS4K
CiAgICBUaGUgYGZpbmRgIG1ldGhvZCB3aWxsIGFsd2F5cyByZXNvbHZlIGl0cyBwcm9taXNlIHdp
dGggdGhlIHNhbWUgb2JqZWN0IGZvcgogICAgYSBnaXZlbiB0eXBlIGFuZCBgaWRgLgoKICAgIC0t
LQoKICAgIFRvIGZpbmQgYWxsIHJlY29yZHMgZm9yIGEgdHlwZSwgY2FsbCBgZmluZGAgd2l0aCBu
byBhZGRpdGlvbmFsIHBhcmFtZXRlcnM6CgogICAgYGBgamF2YXNjcmlwdAogICAgc3RvcmUuZmlu
ZCgncGVyc29uJyk7CiAgICBgYGAKCiAgICBUaGlzIHdpbGwgYXNrIHRoZSBhZGFwdGVyJ3MgYGZp
bmRBbGxgIG1ldGhvZCB0byBmaW5kIHRoZSByZWNvcmRzIGZvciB0aGUKICAgIGdpdmVuIHR5cGUs
IGFuZCByZXR1cm4gYSBwcm9taXNlIHRoYXQgd2lsbCBiZSByZXNvbHZlZCBvbmNlIHRoZSBzZXJ2
ZXIKICAgIHJldHVybnMgdGhlIHZhbHVlcy4KCiAgICAtLS0KCiAgICBUbyBmaW5kIGEgcmVjb3Jk
IGJ5IGEgcXVlcnksIGNhbGwgYGZpbmRgIHdpdGggYSBoYXNoIGFzIHRoZSBzZWNvbmQKICAgIHBh
cmFtZXRlcjoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBzdG9yZS5maW5kKEFwcC5QZXJzb24sIHsg
cGFnZTogMSB9KTsKICAgIGBgYAoKICAgIFRoaXMgd2lsbCBhc2sgdGhlIGFkYXB0ZXIncyBgZmlu
ZFF1ZXJ5YCBtZXRob2QgdG8gZmluZCB0aGUgcmVjb3JkcyBmb3IKICAgIHRoZSBxdWVyeSwgYW5k
IHJldHVybiBhIHByb21pc2UgdGhhdCB3aWxsIGJlIHJlc29sdmVkIG9uY2UgdGhlIHNlcnZlcgog
ICAgcmVzcG9uZHMuCgogICAgQG1ldGhvZCBmaW5kCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJj
bGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R8U3RyaW5nfEludGVnZXJ8
bnVsbH0gaWQKICAgIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UKICAqLwogIGZpbmQ6IGZ1bmN0
aW9uKHR5cGUsIGlkKSB7CiAgICBpZiAoaWQgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4g
dGhpcy5maW5kQWxsKHR5cGUpOwogICAgfQoKICAgIC8vIFdlIGFyZSBwYXNzZWQgYSBxdWVyeSBp
bnN0ZWFkIG9mIGFuIGlkLgogICAgaWYgKEVtYmVyLnR5cGVPZihpZCkgPT09ICdvYmplY3QnKSB7
CiAgICAgIHJldHVybiB0aGlzLmZpbmRRdWVyeSh0eXBlLCBpZCk7CiAgICB9CgogICAgcmV0dXJu
IHRoaXMuZmluZEJ5SWQodHlwZSwgY29lcmNlSWQoaWQpKTsKICB9LAoKICAvKioKICAgIFRoaXMg
bWV0aG9kIHJldHVybnMgYSByZWNvcmQgZm9yIGEgZ2l2ZW4gdHlwZSBhbmQgaWQgY29tYmluYXRp
b24uCgogICAgQG1ldGhvZCBmaW5kQnlJZAogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7U3RyaW5n
IG9yIHN1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge1N0cmluZ3xJbnRlZ2Vy
fSBpZAogICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgZmluZEJ5SWQ6IGZ1bmN0
aW9uKHR5cGUsIGlkKSB7CiAgICB0eXBlID0gdGhpcy5tb2RlbEZvcih0eXBlKTsKCiAgICB2YXIg
cmVjb3JkID0gdGhpcy5yZWNvcmRGb3JJZCh0eXBlLCBpZCk7CgogICAgdmFyIHByb21pc2UgPSB0
aGlzLmZldGNoUmVjb3JkKHJlY29yZCkgfHwgcmVzb2x2ZShyZWNvcmQsICJEUzogU3RvcmUjZmlu
ZEJ5SWQgIiArIHR5cGUgKyAiIHdpdGggaWQ6ICIgKyBpZCk7CiAgICByZXR1cm4gcHJvbWlzZU9i
amVjdChwcm9taXNlKTsKICB9LAoKICAvKioKICAgIFRoaXMgbWV0aG9kIG1ha2VzIGEgc2VyaWVz
IG9mIHJlcXVlc3RzIHRvIHRoZSBhZGFwdGVyJ3MgYGZpbmRgIG1ldGhvZAogICAgYW5kIHJldHVy
bnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgb25jZSB0aGV5IGFyZSBhbGwgbG9hZGVkLgoKICAg
IEBwcml2YXRlCiAgICBAbWV0aG9kIGZpbmRCeUlkcwogICAgQHBhcmFtIHtTdHJpbmd9IHR5cGUK
ICAgIEBwYXJhbSB7QXJyYXl9IGlkcwogICAgQHJldHVybnMge1Byb21pc2V9IHByb21pc2UKICAq
LwogIGZpbmRCeUlkczogZnVuY3Rpb24odHlwZSwgaWRzKSB7CiAgICB2YXIgc3RvcmUgPSB0aGlz
OwogICAgdmFyIHByb21pc2VMYWJlbCA9ICJEUzogU3RvcmUjZmluZEJ5SWRzICIgKyB0eXBlOwog
ICAgcmV0dXJuIHByb21pc2VBcnJheShFbWJlci5SU1ZQLmFsbChtYXAoaWRzLCBmdW5jdGlvbihp
ZCkgewogICAgICByZXR1cm4gc3RvcmUuZmluZEJ5SWQodHlwZSwgaWQpOwogICAgfSkpLnRoZW4o
RW1iZXIuQSwgbnVsbCwgIkRTOiBTdG9yZSNmaW5kQnlJZHMgb2YgIiArIHR5cGUgKyAiIGNvbXBs
ZXRlIikpOwogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgaXMgY2FsbGVkIGJ5IGBmaW5kQnlJ
ZGAgaWYgaXQgZGlzY292ZXJzIHRoYXQgYSBwYXJ0aWN1bGFyCiAgICB0eXBlL2lkIHBhaXIgaGFz
bid0IGJlZW4gbG9hZGVkIHlldCB0byBraWNrIG9mZiBhIHJlcXVlc3QgdG8gdGhlCiAgICBhZGFw
dGVyLgoKICAgIEBtZXRob2QgZmV0Y2hSZWNvcmQKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge0RT
Lk1vZGVsfSByZWNvcmQKICAgIEByZXR1cm5zIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBmZXRj
aFJlY29yZDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICBpZiAoaXNOb25lKHJlY29yZCkpIHsgcmV0
dXJuIG51bGw7IH0KICAgIGlmIChyZWNvcmQuX2xvYWRpbmdQcm9taXNlKSB7IHJldHVybiByZWNv
cmQuX2xvYWRpbmdQcm9taXNlOyB9CiAgICBpZiAoIWdldChyZWNvcmQsICdpc0VtcHR5JykpIHsg
cmV0dXJuIG51bGw7IH0KCiAgICB2YXIgdHlwZSA9IHJlY29yZC5jb25zdHJ1Y3RvciwKICAgICAg
ICBpZCA9IGdldChyZWNvcmQsICdpZCcpOwoKICAgIHZhciBhZGFwdGVyID0gdGhpcy5hZGFwdGVy
Rm9yKHR5cGUpOwoKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIGZpbmQgYSByZWNvcmQg
YnV0IHlvdSBoYXZlIG5vIGFkYXB0ZXIgKGZvciAiICsgdHlwZSArICIpIiwgYWRhcHRlcik7CiAg
ICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBmaW5kIGEgcmVjb3JkIGJ1dCB5b3VyIGFkYXB0
ZXIgKGZvciAiICsgdHlwZSArICIpIGRvZXMgbm90IGltcGxlbWVudCAnZmluZCciLCBhZGFwdGVy
LmZpbmQpOwoKICAgIHZhciBwcm9taXNlID0gX2ZpbmQoYWRhcHRlciwgdGhpcywgdHlwZSwgaWQp
OwogICAgcmVjb3JkLmxvYWRpbmdEYXRhKHByb21pc2UpOwogICAgcmV0dXJuIHByb21pc2U7CiAg
fSwKCiAgLyoqCiAgICBHZXQgYSByZWNvcmQgYnkgYSBnaXZlbiB0eXBlIGFuZCBJRCB3aXRob3V0
IHRyaWdnZXJpbmcgYSBmZXRjaC4KCiAgICBUaGlzIG1ldGhvZCB3aWxsIHN5bmNocm9ub3VzbHkg
cmV0dXJuIHRoZSByZWNvcmQgaWYgaXQncyBhdmFpbGFibGUuCiAgICBPdGhlcndpc2UsIGl0IHdp
bGwgcmV0dXJuIG51bGwuCgogICAgYGBganMKICAgIHZhciBwb3N0ID0gc3RvcmUuZ2V0QnlJZCgn
cG9zdCcsIDEpOwogICAgYGBgCgogICAgQG1ldGhvZCBnZXRCeUlkCiAgICBAcGFyYW0ge1N0cmlu
ZyBvciBzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtTdHJpbmd8SW50ZWdl
cn0gaWQKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICovCiAgZ2V0QnlJZDogZnVuY3Rp
b24odHlwZSwgaWQpIHsKICAgIGlmICh0aGlzLmhhc1JlY29yZEZvcklkKHR5cGUsIGlkKSkgewog
ICAgICByZXR1cm4gdGhpcy5yZWNvcmRGb3JJZCh0eXBlLCBpZCk7CiAgICB9IGVsc2UgewogICAg
ICByZXR1cm4gbnVsbDsKICAgIH0KICB9LAoKICAvKioKICAgIFRoaXMgbWV0aG9kIGlzIGNhbGxl
ZCBieSB0aGUgcmVjb3JkJ3MgYHJlbG9hZGAgbWV0aG9kLgoKICAgIFRoaXMgbWV0aG9kIGNhbGxz
IHRoZSBhZGFwdGVyJ3MgYGZpbmRgIG1ldGhvZCwgd2hpY2ggcmV0dXJucyBhIHByb21pc2UuIFdo
ZW4KICAgICoqdGhhdCoqIHByb21pc2UgcmVzb2x2ZXMsIGByZWxvYWRSZWNvcmRgIHdpbGwgcmVz
b2x2ZSB0aGUgcHJvbWlzZSByZXR1cm5lZAogICAgYnkgdGhlIHJlY29yZCdzIGByZWxvYWRgLgoK
ICAgIEBtZXRob2QgcmVsb2FkUmVjb3JkCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtEUy5Nb2Rl
bH0gcmVjb3JkCiAgICBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICByZWxvYWRSZWNv
cmQ6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgdmFyIHR5cGUgPSByZWNvcmQuY29uc3RydWN0b3Is
CiAgICAgICAgYWRhcHRlciA9IHRoaXMuYWRhcHRlckZvcih0eXBlKSwKICAgICAgICBpZCA9IGdl
dChyZWNvcmQsICdpZCcpOwoKICAgIEVtYmVyLmFzc2VydCgiWW91IGNhbm5vdCByZWxvYWQgYSBy
ZWNvcmQgd2l0aG91dCBhbiBJRCIsIGlkKTsKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRv
IHJlbG9hZCBhIHJlY29yZCBidXQgeW91IGhhdmUgbm8gYWRhcHRlciAoZm9yICIgKyB0eXBlICsg
IikiLCBhZGFwdGVyKTsKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIHJlbG9hZCBhIHJl
Y29yZCBidXQgeW91ciBhZGFwdGVyIGRvZXMgbm90IGltcGxlbWVudCBgZmluZGAiLCBhZGFwdGVy
LmZpbmQpOwoKICAgIHJldHVybiBfZmluZChhZGFwdGVyLCB0aGlzLCB0eXBlLCBpZCk7CiAgfSwK
CiAgLyoqCiAgICBUaGlzIG1ldGhvZCB0YWtlcyBhIGxpc3Qgb2YgcmVjb3JkcywgZ3JvdXBzIHRo
ZSByZWNvcmRzIGJ5IHR5cGUsCiAgICBjb252ZXJ0cyB0aGUgcmVjb3JkcyBpbnRvIElEcywgYW5k
IHRoZW4gaW52b2tlcyB0aGUgYWRhcHRlcidzIGBmaW5kTWFueWAKICAgIG1ldGhvZC4KCiAgICBU
aGUgcmVjb3JkcyBhcmUgZ3JvdXBlZCBieSB0eXBlIHRvIGludm9rZSBgZmluZE1hbnlgIG9uIGFk
YXB0ZXJzCiAgICBmb3IgZWFjaCB1bmlxdWUgdHlwZSBpbiByZWNvcmRzLgoKICAgIEl0IGlzIHVz
ZWQgYm90aCBieSBhIGJyYW5kIG5ldyByZWxhdGlvbnNoaXAgKHZpYSB0aGUgYGZpbmRNYW55YAog
ICAgbWV0aG9kKSBvciB3aGVuIHRoZSBkYXRhIHVuZGVybHlpbmcgYW4gZXhpc3RpbmcgcmVsYXRp
b25zaGlwCiAgICBjaGFuZ2VzLgoKICAgIEBtZXRob2QgZmV0Y2hNYW55CiAgICBAcHJpdmF0ZQog
ICAgQHBhcmFtIHtBcnJheX0gcmVjb3JkcwogICAgQHBhcmFtIHtEUy5Nb2RlbH0gb3duZXIKICAg
IEBwYXJhbSB7UmVzb2x2ZXJ9IHJlc29sdmVyCiAgKi8KICBmZXRjaE1hbnk6IGZ1bmN0aW9uKHJl
Y29yZHMsIG93bmVyLCByZXNvbHZlcikgewogICAgaWYgKCFyZWNvcmRzLmxlbmd0aCkgeyByZXR1
cm47IH0KCiAgICAvLyBHcm91cCBCeSBUeXBlCiAgICB2YXIgcmVjb3Jkc0J5VHlwZU1hcCA9IEVt
YmVyLk1hcFdpdGhEZWZhdWx0LmNyZWF0ZSh7CiAgICAgIGRlZmF1bHRWYWx1ZTogZnVuY3Rpb24o
KSB7IHJldHVybiBFbWJlci5BKCk7IH0KICAgIH0pOwoKICAgIGZvckVhY2gocmVjb3JkcywgZnVu
Y3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZHNCeVR5cGVNYXAuZ2V0KHJlY29yZC5jb25zdHJ1
Y3RvcikucHVzaChyZWNvcmQpOwogICAgfSk7CgogICAgZm9yRWFjaChyZWNvcmRzQnlUeXBlTWFw
LCBmdW5jdGlvbih0eXBlLCByZWNvcmRzKSB7CiAgICAgIHZhciBpZHMgPSByZWNvcmRzLm1hcFBy
b3BlcnR5KCdpZCcpLAogICAgICAgICAgYWRhcHRlciA9IHRoaXMuYWRhcHRlckZvcih0eXBlKTsK
CiAgICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIGxvYWQgbWFueSByZWNvcmRzIGJ1dCB5
b3UgaGF2ZSBubyBhZGFwdGVyIChmb3IgIiArIHR5cGUgKyAiKSIsIGFkYXB0ZXIpOwogICAgICBF
bWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBsb2FkIG1hbnkgcmVjb3JkcyBidXQgeW91ciBhZGFw
dGVyIGRvZXMgbm90IGltcGxlbWVudCBgZmluZE1hbnlgIiwgYWRhcHRlci5maW5kTWFueSk7Cgog
ICAgICByZXNvbHZlci5yZXNvbHZlKF9maW5kTWFueShhZGFwdGVyLCB0aGlzLCB0eXBlLCBpZHMs
IG93bmVyKSk7CiAgICB9LCB0aGlzKTsKICB9LAoKICAvKioKICAgIFJldHVybnMgdHJ1ZSBpZiBh
IHJlY29yZCBmb3IgYSBnaXZlbiB0eXBlIGFuZCBJRCBpcyBhbHJlYWR5IGxvYWRlZC4KCiAgICBA
bWV0aG9kIGhhc1JlY29yZEZvcklkCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFzcyBvZiBE
Uy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtTdHJpbmd8SW50ZWdlcn0gaWQKICAgIEByZXR1cm5z
IHtCb29sZWFufQogICovCiAgaGFzUmVjb3JkRm9ySWQ6IGZ1bmN0aW9uKHR5cGUsIGlkKSB7CiAg
ICBpZCA9IGNvZXJjZUlkKGlkKTsKICAgIHR5cGUgPSB0aGlzLm1vZGVsRm9yKHR5cGUpOwogICAg
cmV0dXJuICEhdGhpcy50eXBlTWFwRm9yKHR5cGUpLmlkVG9SZWNvcmRbaWRdOwogIH0sCgogIC8q
KgogICAgUmV0dXJucyBpZCByZWNvcmQgZm9yIGEgZ2l2ZW4gdHlwZSBhbmQgSUQuIElmIG9uZSBp
c24ndCBhbHJlYWR5IGxvYWRlZCwKICAgIGl0IGJ1aWxkcyBhIG5ldyByZWNvcmQgYW5kIGxlYXZl
cyBpdCBpbiB0aGUgYGVtcHR5YCBzdGF0ZS4KCiAgICBAbWV0aG9kIHJlY29yZEZvcklkCiAgICBA
cHJpdmF0ZQogICAgQHBhcmFtIHtTdHJpbmcgb3Igc3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUK
ICAgIEBwYXJhbSB7U3RyaW5nfEludGVnZXJ9IGlkCiAgICBAcmV0dXJucyB7RFMuTW9kZWx9IHJl
Y29yZAogICovCiAgcmVjb3JkRm9ySWQ6IGZ1bmN0aW9uKHR5cGUsIGlkKSB7CiAgICB0eXBlID0g
dGhpcy5tb2RlbEZvcih0eXBlKTsKCiAgICBpZCA9IGNvZXJjZUlkKGlkKTsKCiAgICB2YXIgcmVj
b3JkID0gdGhpcy50eXBlTWFwRm9yKHR5cGUpLmlkVG9SZWNvcmRbaWRdOwoKICAgIGlmICghcmVj
b3JkKSB7CiAgICAgIHJlY29yZCA9IHRoaXMuYnVpbGRSZWNvcmQodHlwZSwgaWQpOwogICAgfQoK
ICAgIHJldHVybiByZWNvcmQ7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGZpbmRNYW55CiAgICBA
cHJpdmF0ZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gb3duZXIKICAgIEBwYXJhbSB7QXJyYXl9IHJl
Y29yZHMKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAg
ICBAcGFyYW0ge1Jlc29sdmVyfSByZXNvbHZlcgogICAgQHJldHVybiB7RFMuTWFueUFycmF5fSBy
ZWNvcmRzCiAgKi8KICBmaW5kTWFueTogZnVuY3Rpb24ob3duZXIsIHJlY29yZHMsIHR5cGUsIHJl
c29sdmVyKSB7CiAgICB0eXBlID0gdGhpcy5tb2RlbEZvcih0eXBlKTsKCiAgICByZWNvcmRzID0g
RW1iZXIuQShyZWNvcmRzKTsKCiAgICB2YXIgdW5sb2FkZWRSZWNvcmRzID0gcmVjb3Jkcy5maWx0
ZXJQcm9wZXJ0eSgnaXNFbXB0eScsIHRydWUpLAogICAgICAgIG1hbnlBcnJheSA9IHRoaXMucmVj
b3JkQXJyYXlNYW5hZ2VyLmNyZWF0ZU1hbnlBcnJheSh0eXBlLCByZWNvcmRzKTsKCiAgICBmb3JF
YWNoKHVubG9hZGVkUmVjb3JkcywgZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC5sb2Fk
aW5nRGF0YSgpOwogICAgfSk7CgogICAgbWFueUFycmF5LmxvYWRpbmdSZWNvcmRzQ291bnQgPSB1
bmxvYWRlZFJlY29yZHMubGVuZ3RoOwoKICAgIGlmICh1bmxvYWRlZFJlY29yZHMubGVuZ3RoKSB7
CiAgICAgIGZvckVhY2godW5sb2FkZWRSZWNvcmRzLCBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAg
ICB0aGlzLnJlY29yZEFycmF5TWFuYWdlci5yZWdpc3RlcldhaXRpbmdSZWNvcmRBcnJheShyZWNv
cmQsIG1hbnlBcnJheSk7CiAgICAgIH0sIHRoaXMpOwoKICAgICAgdGhpcy5mZXRjaE1hbnkodW5s
b2FkZWRSZWNvcmRzLCBvd25lciwgcmVzb2x2ZXIpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHJl
c29sdmVyKSB7IHJlc29sdmVyLnJlc29sdmUoKTsgfQogICAgICBtYW55QXJyYXkuc2V0KCdpc0xv
YWRlZCcsIHRydWUpOwogICAgICBFbWJlci5ydW4ub25jZShtYW55QXJyYXksICd0cmlnZ2VyJywg
J2RpZExvYWQnKTsKICAgIH0KCiAgICByZXR1cm4gbWFueUFycmF5OwogIH0sCgogIC8qKgogICAg
SWYgYSByZWxhdGlvbnNoaXAgd2FzIG9yaWdpbmFsbHkgcG9wdWxhdGVkIGJ5IHRoZSBhZGFwdGVy
IGFzIGEgbGluawogICAgKGFzIG9wcG9zZWQgdG8gYSBsaXN0IG9mIElEcyksIHRoaXMgbWV0aG9k
IGlzIGNhbGxlZCB3aGVuIHRoZQogICAgcmVsYXRpb25zaGlwIGlzIGZldGNoZWQuCgogICAgVGhl
IGxpbmsgKHdoaWNoIGlzIHVzdWFsbHkgYSBVUkwpIGlzIHBhc3NlZCB0aHJvdWdoIHVuY2hhbmdl
ZCwgc28gdGhlCiAgICBhZGFwdGVyIGNhbiBtYWtlIHdoYXRldmVyIHJlcXVlc3QgaXQgd2FudHMu
CgogICAgVGhlIHVzdWFsIHVzZS1jYXNlIGlzIGZvciB0aGUgc2VydmVyIHRvIHJlZ2lzdGVyIGEg
VVJMIGFzIGEgbGluaywgYW5kCiAgICB0aGVuIHVzZSB0aGF0IFVSTCBpbiB0aGUgZnV0dXJlIHRv
IG1ha2UgYSByZXF1ZXN0IGZvciB0aGUgcmVsYXRpb25zaGlwLgoKICAgIEBtZXRob2QgZmluZEhh
c01hbnkKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge0RTLk1vZGVsfSBvd25lcgogICAgQHBhcmFt
IHthbnl9IGxpbmsKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVsfSB0
eXBlCiAgICBAcGFyYW0ge1Jlc29sdmVyfSByZXNvbHZlcgogICAgQHJldHVybiB7RFMuTWFueUFy
cmF5fQogICovCiAgZmluZEhhc01hbnk6IGZ1bmN0aW9uKG93bmVyLCBsaW5rLCByZWxhdGlvbnNo
aXAsIHJlc29sdmVyKSB7CiAgICB2YXIgYWRhcHRlciA9IHRoaXMuYWRhcHRlckZvcihvd25lci5j
b25zdHJ1Y3Rvcik7CgogICAgRW1iZXIuYXNzZXJ0KCJZb3UgdHJpZWQgdG8gbG9hZCBhIGhhc01h
bnkgcmVsYXRpb25zaGlwIGJ1dCB5b3UgaGF2ZSBubyBhZGFwdGVyIChmb3IgIiArIG93bmVyLmNv
bnN0cnVjdG9yICsgIikiLCBhZGFwdGVyKTsKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRv
IGxvYWQgYSBoYXNNYW55IHJlbGF0aW9uc2hpcCBmcm9tIGEgc3BlY2lmaWVkIGBsaW5rYCBpbiB0
aGUgb3JpZ2luYWwgcGF5bG9hZCBidXQgeW91ciBhZGFwdGVyIGRvZXMgbm90IGltcGxlbWVudCBg
ZmluZEhhc01hbnlgIiwgYWRhcHRlci5maW5kSGFzTWFueSk7CgogICAgdmFyIHJlY29yZHMgPSB0
aGlzLnJlY29yZEFycmF5TWFuYWdlci5jcmVhdGVNYW55QXJyYXkocmVsYXRpb25zaGlwLnR5cGUs
IEVtYmVyLkEoW10pKTsKICAgIHJlc29sdmVyLnJlc29sdmUoX2ZpbmRIYXNNYW55KGFkYXB0ZXIs
IHRoaXMsIG93bmVyLCBsaW5rLCByZWxhdGlvbnNoaXApKTsKICAgIHJldHVybiByZWNvcmRzOwog
IH0sCgogIC8qKgogICAgQG1ldGhvZCBmaW5kQmVsb25nc1RvCiAgICBAcHJpdmF0ZQogICAgQHBh
cmFtIHtEUy5Nb2RlbH0gb3duZXIKICAgIEBwYXJhbSB7YW55fSBsaW5rCiAgICBAcGFyYW0ge1Jl
bGF0aW9uc2hpcH0gcmVsYXRpb25zaGlwCiAgICBAcGFyYW0ge1Jlc29sdmVyfSByZXNvbHZlcgog
ICovCiAgZmluZEJlbG9uZ3NUbzogZnVuY3Rpb24ob3duZXIsIGxpbmssIHJlbGF0aW9uc2hpcCwg
cmVzb2x2ZXIpIHsKICAgIHZhciBhZGFwdGVyID0gdGhpcy5hZGFwdGVyRm9yKG93bmVyLmNvbnN0
cnVjdG9yKTsKCiAgICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBsb2FkIGEgYmVsb25nc1Rv
IHJlbGF0aW9uc2hpcCBidXQgeW91IGhhdmUgbm8gYWRhcHRlciAoZm9yICIgKyBvd25lci5jb25z
dHJ1Y3RvciArICIpIiwgYWRhcHRlcik7CiAgICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBs
b2FkIGEgYmVsb25nc1RvIHJlbGF0aW9uc2hpcCBmcm9tIGEgc3BlY2lmaWVkIGBsaW5rYCBpbiB0
aGUgb3JpZ2luYWwgcGF5bG9hZCBidXQgeW91ciBhZGFwdGVyIGRvZXMgbm90IGltcGxlbWVudCBg
ZmluZEJlbG9uZ3NUb2AiLCBhZGFwdGVyLmZpbmRCZWxvbmdzVG8pOwoKICAgIHJlc29sdmVyLnJl
c29sdmUoX2ZpbmRCZWxvbmdzVG8oYWRhcHRlciwgdGhpcywgb3duZXIsIGxpbmssIHJlbGF0aW9u
c2hpcCkpOwogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgZGVsZWdhdGVzIGEgcXVlcnkgdG8g
dGhlIGFkYXB0ZXIuIFRoaXMgaXMgdGhlIG9uZSBwbGFjZSB3aGVyZQogICAgYWRhcHRlci1sZXZl
bCBzZW1hbnRpY3MgYXJlIGV4cG9zZWQgdG8gdGhlIGFwcGxpY2F0aW9uLgoKICAgIEV4cG9zaW5n
IHF1ZXJpZXMgdGhpcyB3YXkgc2VlbXMgcHJlZmVyYWJsZSB0byBjcmVhdGluZyBhbiBhYnN0cmFj
dCBxdWVyeQogICAgbGFuZ3VhZ2UgZm9yIGFsbCBzZXJ2ZXItc2lkZSBxdWVyaWVzLCBhbmQgdGhl
biByZXF1aXJlIGFsbCBhZGFwdGVycyB0bwogICAgaW1wbGVtZW50IHRoZW0uCgogICAgVGhpcyBt
ZXRob2QgcmV0dXJucyBhIHByb21pc2UsIHdoaWNoIGlzIHJlc29sdmVkIHdpdGggYSBgUmVjb3Jk
QXJyYXlgCiAgICBvbmNlIHRoZSBzZXJ2ZXIgcmV0dXJucy4KCiAgICBAbWV0aG9kIGZpbmRRdWVy
eQogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVs
fSB0eXBlCiAgICBAcGFyYW0ge2FueX0gcXVlcnkgYW4gb3BhcXVlIHF1ZXJ5IHRvIGJlIHVzZWQg
YnkgdGhlIGFkYXB0ZXIKICAgIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UKICAqLwogIGZpbmRR
dWVyeTogZnVuY3Rpb24odHlwZSwgcXVlcnkpIHsKICAgIHR5cGUgPSB0aGlzLm1vZGVsRm9yKHR5
cGUpOwoKICAgIHZhciBhcnJheSA9IHRoaXMucmVjb3JkQXJyYXlNYW5hZ2VyCiAgICAgIC5jcmVh
dGVBZGFwdGVyUG9wdWxhdGVkUmVjb3JkQXJyYXkodHlwZSwgcXVlcnkpOwoKICAgIHZhciBhZGFw
dGVyID0gdGhpcy5hZGFwdGVyRm9yKHR5cGUpLAogICAgICAgIHByb21pc2VMYWJlbCA9ICJEUzog
U3RvcmUjZmluZFF1ZXJ5ICIgKyB0eXBlLAogICAgICAgIHJlc29sdmVyID0gRW1iZXIuUlNWUC5k
ZWZlcihwcm9taXNlTGFiZWwpOwoKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIGxvYWQg
YSBxdWVyeSBidXQgeW91IGhhdmUgbm8gYWRhcHRlciAoZm9yICIgKyB0eXBlICsgIikiLCBhZGFw
dGVyKTsKICAgIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIGxvYWQgYSBxdWVyeSBidXQgeW91
ciBhZGFwdGVyIGRvZXMgbm90IGltcGxlbWVudCBgZmluZFF1ZXJ5YCIsIGFkYXB0ZXIuZmluZFF1
ZXJ5KTsKCiAgICByZXNvbHZlci5yZXNvbHZlKF9maW5kUXVlcnkoYWRhcHRlciwgdGhpcywgdHlw
ZSwgcXVlcnksIGFycmF5KSk7CgogICAgcmV0dXJuIHByb21pc2VBcnJheShyZXNvbHZlci5wcm9t
aXNlKTsKICB9LAoKICAvKioKICAgIFRoaXMgbWV0aG9kIHJldHVybnMgYW4gYXJyYXkgb2YgYWxs
IHJlY29yZHMgYWRhcHRlciBjYW4gZmluZC4KICAgIEl0IHRyaWdnZXJzIHRoZSBhZGFwdGVyJ3Mg
YGZpbmRBbGxgIG1ldGhvZCB0byBnaXZlIGl0IGFuIG9wcG9ydHVuaXR5IHRvIHBvcHVsYXRlCiAg
ICB0aGUgYXJyYXkgd2l0aCByZWNvcmRzIG9mIHRoYXQgdHlwZS4KCiAgICBAbWV0aG9kIGZpbmRB
bGwKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFzcyBvZiBEUy5Nb2Rl
bH0gdHlwZQogICAgQHJldHVybiB7RFMuQWRhcHRlclBvcHVsYXRlZFJlY29yZEFycmF5fQogICov
CiAgZmluZEFsbDogZnVuY3Rpb24odHlwZSkgewogICAgdHlwZSA9IHRoaXMubW9kZWxGb3IodHlw
ZSk7CgogICAgcmV0dXJuIHRoaXMuZmV0Y2hBbGwodHlwZSwgdGhpcy5hbGwodHlwZSkpOwogIH0s
CgogIC8qKgogICAgQG1ldGhvZCBmZXRjaEFsbAogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7RFMu
TW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7RFMuUmVjb3JkQXJyYXl9IGFycmF5CiAgICBAcmV0dXJu
cyB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgZmV0Y2hBbGw6IGZ1bmN0aW9uKHR5cGUsIGFycmF5
KSB7CiAgICB2YXIgYWRhcHRlciA9IHRoaXMuYWRhcHRlckZvcih0eXBlKSwKICAgICAgICBzaW5j
ZVRva2VuID0gdGhpcy50eXBlTWFwRm9yKHR5cGUpLm1ldGFkYXRhLnNpbmNlOwoKICAgIHNldChh
cnJheSwgJ2lzVXBkYXRpbmcnLCB0cnVlKTsKCiAgICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0
byBsb2FkIGFsbCByZWNvcmRzIGJ1dCB5b3UgaGF2ZSBubyBhZGFwdGVyIChmb3IgIiArIHR5cGUg
KyAiKSIsIGFkYXB0ZXIpOwogICAgRW1iZXIuYXNzZXJ0KCJZb3UgdHJpZWQgdG8gbG9hZCBhbGwg
cmVjb3JkcyBidXQgeW91ciBhZGFwdGVyIGRvZXMgbm90IGltcGxlbWVudCBgZmluZEFsbGAiLCBh
ZGFwdGVyLmZpbmRBbGwpOwoKICAgIHJldHVybiBwcm9taXNlQXJyYXkoX2ZpbmRBbGwoYWRhcHRl
ciwgdGhpcywgdHlwZSwgc2luY2VUb2tlbikpOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBkaWRV
cGRhdGVBbGwKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHR5cGUKICAqLwogIGRpZFVwZGF0ZUFsbDog
ZnVuY3Rpb24odHlwZSkgewogICAgdmFyIGZpbmRBbGxDYWNoZSA9IHRoaXMudHlwZU1hcEZvcih0
eXBlKS5maW5kQWxsQ2FjaGU7CiAgICBzZXQoZmluZEFsbENhY2hlLCAnaXNVcGRhdGluZycsIGZh
bHNlKTsKICB9LAoKICAvKioKICAgIFRoaXMgbWV0aG9kIHJldHVybnMgYSBmaWx0ZXJlZCBhcnJh
eSB0aGF0IGNvbnRhaW5zIGFsbCBvZiB0aGUga25vd24gcmVjb3JkcwogICAgZm9yIGEgZ2l2ZW4g
dHlwZS4KCiAgICBOb3RlIHRoYXQgYmVjYXVzZSBpdCdzIGp1c3QgYSBmaWx0ZXIsIGl0IHdpbGwg
aGF2ZSBhbnkgbG9jYWxseQogICAgY3JlYXRlZCByZWNvcmRzIG9mIHRoZSB0eXBlLgoKICAgIEFs
c28gbm90ZSB0aGF0IG11bHRpcGxlIGNhbGxzIHRvIGBhbGxgIGZvciBhIGdpdmVuIHR5cGUgd2ls
bCBhbHdheXMKICAgIHJldHVybiB0aGUgc2FtZSBSZWNvcmRBcnJheS4KCiAgICBFeGFtcGxlCgog
ICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGxvY2FsX3Bvc3RzID0gc3RvcmUuYWxsKEFwcC5Qb3N0
KTsKICAgIGBgYAoKICAgIEBtZXRob2QgYWxsCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFz
cyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHJldHVybiB7RFMuUmVjb3JkQXJyYXl9CiAgKi8KICBh
bGw6IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHR5cGUgPSB0aGlzLm1vZGVsRm9yKHR5cGUpOwoKICAg
IHZhciB0eXBlTWFwID0gdGhpcy50eXBlTWFwRm9yKHR5cGUpLAogICAgICAgIGZpbmRBbGxDYWNo
ZSA9IHR5cGVNYXAuZmluZEFsbENhY2hlOwoKICAgIGlmIChmaW5kQWxsQ2FjaGUpIHsgcmV0dXJu
IGZpbmRBbGxDYWNoZTsgfQoKICAgIHZhciBhcnJheSA9IHRoaXMucmVjb3JkQXJyYXlNYW5hZ2Vy
LmNyZWF0ZVJlY29yZEFycmF5KHR5cGUpOwoKICAgIHR5cGVNYXAuZmluZEFsbENhY2hlID0gYXJy
YXk7CiAgICByZXR1cm4gYXJyYXk7CiAgfSwKCgogIC8qKgogICAgVGhpcyBtZXRob2QgdW5sb2Fk
cyBhbGwgb2YgdGhlIGtub3duIHJlY29yZHMgZm9yIGEgZ2l2ZW4gdHlwZS4KCiAgICBgYGBqYXZh
c2NyaXB0CiAgICBzdG9yZS51bmxvYWRBbGwoQXBwLlBvc3QpOwogICAgYGBgCgogICAgQG1ldGhv
ZCB1bmxvYWRBbGwKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVsfSB0
eXBlCiAgKi8KICB1bmxvYWRBbGw6IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHR5cGUgPSB0aGlzLm1v
ZGVsRm9yKHR5cGUpOwoKICAgIHZhciB0eXBlTWFwID0gdGhpcy50eXBlTWFwRm9yKHR5cGUpLAog
ICAgICAgIHJlY29yZHMgPSB0eXBlTWFwLnJlY29yZHMsIHJlY29yZDsKCiAgICB3aGlsZShyZWNv
cmQgPSByZWNvcmRzLnBvcCgpKSB7CiAgICAgIHJlY29yZC51bmxvYWRSZWNvcmQoKTsKICAgIH0K
CiAgICB0eXBlTWFwLmZpbmRBbGxDYWNoZSA9IG51bGw7CiAgfSwKCiAgLyoqCiAgICBUYWtlcyBh
IHR5cGUgYW5kIGZpbHRlciBmdW5jdGlvbiwgYW5kIHJldHVybnMgYSBsaXZlIFJlY29yZEFycmF5
IHRoYXQKICAgIHJlbWFpbnMgdXAgdG8gZGF0ZSBhcyBuZXcgcmVjb3JkcyBhcmUgbG9hZGVkIGlu
dG8gdGhlIHN0b3JlIG9yIGNyZWF0ZWQKICAgIGxvY2FsbHkuCgogICAgVGhlIGNhbGxiYWNrIGZ1
bmN0aW9uIHRha2VzIGEgbWF0ZXJpYWxpemVkIHJlY29yZCwgYW5kIHJldHVybnMgdHJ1ZQogICAg
aWYgdGhlIHJlY29yZCBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIGZpbHRlciBhbmQgZmFsc2Ug
aWYgaXQgc2hvdWxkCiAgICBub3QuCgogICAgVGhlIGZpbHRlciBmdW5jdGlvbiBpcyBjYWxsZWQg
b25jZSBvbiBhbGwgcmVjb3JkcyBmb3IgdGhlIHR5cGUgd2hlbgogICAgaXQgaXMgY3JlYXRlZCwg
YW5kIHRoZW4gb25jZSBvbiBlYWNoIG5ld2x5IGxvYWRlZCBvciBjcmVhdGVkIHJlY29yZC4KCiAg
ICBJZiBhbnkgb2YgYSByZWNvcmQncyBwcm9wZXJ0aWVzIGNoYW5nZSwgb3IgaWYgaXQgY2hhbmdl
cyBzdGF0ZSwgdGhlCiAgICBmaWx0ZXIgZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFnYWluIHRv
IGRldGVybWluZSB3aGV0aGVyIGl0IHNob3VsZAogICAgc3RpbGwgYmUgaW4gdGhlIGFycmF5LgoK
ICAgIE9wdGlvbmFsbHkgeW91IGNhbiBwYXNzIGEgcXVlcnkgd2hpY2ggd2lsbCBiZSB0cmlnZ2Vy
ZWQgYXQgZmlyc3QuIFRoZQogICAgcmVzdWx0cyByZXR1cm5lZCBieSB0aGUgc2VydmVyIGNvdWxk
IHRoZW4gYXBwZWFyIGluIHRoZSBmaWx0ZXIgaWYgdGhleQogICAgbWF0Y2ggdGhlIGZpbHRlciBm
dW5jdGlvbi4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgc3RvcmUuZmlsdGVy
KEFwcC5Qb3N0LCB7dW5yZWFkOiB0cnVlfSwgZnVuY3Rpb24ocG9zdCkgewogICAgICByZXR1cm4g
cG9zdC5nZXQoJ3VucmVhZCcpOwogICAgfSkudGhlbihmdW5jdGlvbih1bnJlYWRQb3N0cykgewog
ICAgICB1bnJlYWRQb3N0cy5nZXQoJ2xlbmd0aCcpOyAvLyA1CiAgICAgIHZhciB1bnJlYWRQb3N0
ID0gdW5yZWFkUG9zdHMub2JqZWN0QXQoMCk7CiAgICAgIHVucmVhZFBvc3RzLnNldCgndW5yZWFk
JywgZmFsc2UpOwogICAgICB1bnJlYWRQb3N0cy5nZXQoJ2xlbmd0aCcpOyAvLyA0CiAgICB9KTsK
ICAgIGBgYAoKICAgIEBtZXRob2QgZmlsdGVyCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFz
cyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IG9wdGlvbmFsIHF1
ZXJ5CiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBmaWx0ZXIKICAgIEByZXR1cm4ge0RTLlByb21pc2VB
cnJheX0KICAqLwogIGZpbHRlcjogZnVuY3Rpb24odHlwZSwgcXVlcnksIGZpbHRlcikgewogICAg
dmFyIHByb21pc2U7CgogICAgLy8gYWxsb3cgYW4gb3B0aW9uYWwgc2VydmVyIHF1ZXJ5CiAgICBp
ZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMykgewogICAgICBwcm9taXNlID0gdGhpcy5maW5kUXVl
cnkodHlwZSwgcXVlcnkpOwogICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7
CiAgICAgIGZpbHRlciA9IHF1ZXJ5OwogICAgfQoKICAgIHR5cGUgPSB0aGlzLm1vZGVsRm9yKHR5
cGUpOwoKICAgIHZhciBhcnJheSA9IHRoaXMucmVjb3JkQXJyYXlNYW5hZ2VyCiAgICAgIC5jcmVh
dGVGaWx0ZXJlZFJlY29yZEFycmF5KHR5cGUsIGZpbHRlcik7CiAgICBwcm9taXNlID0gcHJvbWlz
ZSB8fCByZXNvbHZlKGFycmF5KTsKCiAgICByZXR1cm4gcHJvbWlzZUFycmF5KHByb21pc2UudGhl
bihmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfSwgbnVsbCwgIkRTOiBTdG9y
ZSNmaWx0ZXIgb2YgIiArIHR5cGUpKTsKICB9LAoKICAvKioKICAgIFRoaXMgbWV0aG9kIHJldHVy
bnMgaWYgYSBjZXJ0YWluIHJlY29yZCBpcyBhbHJlYWR5IGxvYWRlZAogICAgaW4gdGhlIHN0b3Jl
LiBVc2UgdGhpcyBmdW5jdGlvbiB0byBrbm93IGJlZm9yZWhhbmQgaWYgYSBmaW5kKCkKICAgIHdp
bGwgcmVzdWx0IGluIGEgcmVxdWVzdCBvciB0aGF0IGl0IHdpbGwgYmUgYSBjYWNoZSBoaXQuCgog
ICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBzdG9yZS5yZWNvcmRJc0xvYWRlZChB
cHAuUG9zdCwgMSk7IC8vIGZhbHNlCiAgICBzdG9yZS5maW5kKEFwcC5Qb3N0LCAxKS50aGVuKGZ1
bmN0aW9uKCkgewogICAgICBzdG9yZS5yZWNvcmRJc0xvYWRlZChBcHAuUG9zdCwgMSk7IC8vIHRy
dWUKICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCByZWNvcmRJc0xvYWRlZAogICAgQHBhcmFt
IHtTdHJpbmcgb3Igc3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7c3RyaW5n
fSBpZAogICAgQHJldHVybiB7Ym9vbGVhbn0KICAqLwogIHJlY29yZElzTG9hZGVkOiBmdW5jdGlv
bih0eXBlLCBpZCkgewogICAgaWYgKCF0aGlzLmhhc1JlY29yZEZvcklkKHR5cGUsIGlkKSkgeyBy
ZXR1cm4gZmFsc2U7IH0KICAgIHJldHVybiAhZ2V0KHRoaXMucmVjb3JkRm9ySWQodHlwZSwgaWQp
LCAnaXNFbXB0eScpOwogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgcmV0dXJucyB0aGUgbWV0
YWRhdGEgZm9yIGEgc3BlY2lmaWMgdHlwZS4KCiAgICBAbWV0aG9kIG1ldGFkYXRhRm9yCiAgICBA
cGFyYW0ge1N0cmluZyBvciBzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHJldHVybiB7
b2JqZWN0fQogICovCiAgbWV0YWRhdGFGb3I6IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHR5cGUgPSB0
aGlzLm1vZGVsRm9yKHR5cGUpOwogICAgcmV0dXJuIHRoaXMudHlwZU1hcEZvcih0eXBlKS5tZXRh
ZGF0YTsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4KICAvLyAuIFVQREFUSU5HIC4KICAvLyAuLi4u
Li4uLi4uLi4KCiAgLyoqCiAgICBJZiB0aGUgYWRhcHRlciB1cGRhdGVzIGF0dHJpYnV0ZXMgb3Ig
YWNrbm93bGVkZ2VzIGNyZWF0aW9uCiAgICBvciBkZWxldGlvbiwgdGhlIHJlY29yZCB3aWxsIG5v
dGlmeSB0aGUgc3RvcmUgdG8gdXBkYXRlIGl0cwogICAgbWVtYmVyc2hpcCBpbiBhbnkgZmlsdGVy
cy4KICAgIFRvIGF2b2lkIHRocmFzaGluZywgdGhpcyBtZXRob2QgaXMgaW52b2tlZCBvbmx5IG9u
Y2UgcGVyCgogICAgcnVuIGxvb3AgcGVyIHJlY29yZC4KCiAgICBAbWV0aG9kIGRhdGFXYXNVcGRh
dGVkCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtDbGFzc30gdHlwZQogICAgQHBhcmFtIHtEUy5N
b2RlbH0gcmVjb3JkCiAgKi8KICBkYXRhV2FzVXBkYXRlZDogZnVuY3Rpb24odHlwZSwgcmVjb3Jk
KSB7CiAgICB0aGlzLnJlY29yZEFycmF5TWFuYWdlci5yZWNvcmREaWRDaGFuZ2UocmVjb3JkKTsK
ICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLgogIC8vIC4gUEVSU0lTVElORyAuCiAgLy8gLi4uLi4u
Li4uLi4uLi4KCiAgLyoqCiAgICBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYnkgYHJlY29yZC5zYXZl
YCwgYW5kIGdldHMgcGFzc2VkIGEKICAgIHJlc29sdmVyIGZvciB0aGUgcHJvbWlzZSB0aGF0IGBy
ZWNvcmQuc2F2ZWAgcmV0dXJucy4KCiAgICBJdCBzY2hlZHVsZXMgc2F2aW5nIHRvIGhhcHBlbiBh
dCB0aGUgZW5kIG9mIHRoZSBydW4gbG9vcC4KCiAgICBAbWV0aG9kIHNjaGVkdWxlU2F2ZQogICAg
QHByaXZhdGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHBhcmFtIHtSZXNvbHZl
cn0gcmVzb2x2ZXIKICAqLwogIHNjaGVkdWxlU2F2ZTogZnVuY3Rpb24ocmVjb3JkLCByZXNvbHZl
cikgewogICAgcmVjb3JkLmFkYXB0ZXJXaWxsQ29tbWl0KCk7CiAgICB0aGlzLl9wZW5kaW5nU2F2
ZS5wdXNoKFtyZWNvcmQsIHJlc29sdmVyXSk7CiAgICBvbmNlKHRoaXMsICdmbHVzaFBlbmRpbmdT
YXZlJyk7CiAgfSwKCiAgLyoqCiAgICBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYXQgdGhlIGVuZCBv
ZiB0aGUgcnVuIGxvb3AsIGFuZAogICAgZmx1c2hlcyBhbnkgcmVjb3JkcyBwYXNzZWQgaW50byBg
c2NoZWR1bGVTYXZlYAoKICAgIEBtZXRob2QgZmx1c2hQZW5kaW5nU2F2ZQogICAgQHByaXZhdGUK
ICAqLwogIGZsdXNoUGVuZGluZ1NhdmU6IGZ1bmN0aW9uKCkgewogICAgdmFyIHBlbmRpbmcgPSB0
aGlzLl9wZW5kaW5nU2F2ZS5zbGljZSgpOwogICAgdGhpcy5fcGVuZGluZ1NhdmUgPSBbXTsKCiAg
ICBmb3JFYWNoKHBlbmRpbmcsIGZ1bmN0aW9uKHR1cGxlKSB7CiAgICAgIHZhciByZWNvcmQgPSB0
dXBsZVswXSwgcmVzb2x2ZXIgPSB0dXBsZVsxXSwKICAgICAgICAgIGFkYXB0ZXIgPSB0aGlzLmFk
YXB0ZXJGb3IocmVjb3JkLmNvbnN0cnVjdG9yKSwKICAgICAgICAgIG9wZXJhdGlvbjsKCiAgICAg
IGlmIChnZXQocmVjb3JkLCAnaXNOZXcnKSkgewogICAgICAgIG9wZXJhdGlvbiA9ICdjcmVhdGVS
ZWNvcmQnOwogICAgICB9IGVsc2UgaWYgKGdldChyZWNvcmQsICdpc0RlbGV0ZWQnKSkgewogICAg
ICAgIG9wZXJhdGlvbiA9ICdkZWxldGVSZWNvcmQnOwogICAgICB9IGVsc2UgewogICAgICAgIG9w
ZXJhdGlvbiA9ICd1cGRhdGVSZWNvcmQnOwogICAgICB9CgogICAgICByZXNvbHZlci5yZXNvbHZl
KF9jb21taXQoYWRhcHRlciwgdGhpcywgb3BlcmF0aW9uLCByZWNvcmQpKTsKICAgIH0sIHRoaXMp
OwogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgaXMgY2FsbGVkIG9uY2UgdGhlIHByb21pc2Ug
cmV0dXJuZWQgYnkgYW4KICAgIGFkYXB0ZXIncyBgY3JlYXRlUmVjb3JkYCwgYHVwZGF0ZVJlY29y
ZGAgb3IgYGRlbGV0ZVJlY29yZGAKICAgIGlzIHJlc29sdmVkLgoKICAgIElmIHRoZSBkYXRhIHBy
b3ZpZGVzIGEgc2VydmVyLWdlbmVyYXRlZCBJRCwgaXQgd2lsbAogICAgdXBkYXRlIHRoZSByZWNv
cmQgYW5kIHRoZSBzdG9yZSdzIGluZGV4ZXMuCgogICAgQG1ldGhvZCBkaWRTYXZlUmVjb3JkCiAg
ICBAcHJpdmF0ZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkIHRoZSBpbi1mbGlnaHQgcmVj
b3JkCiAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBvcHRpb25hbCBkYXRhIChzZWUgYWJvdmUpCiAg
Ki8KICBkaWRTYXZlUmVjb3JkOiBmdW5jdGlvbihyZWNvcmQsIGRhdGEpIHsKICAgIGlmIChkYXRh
KSB7CiAgICAgIC8vIG5vcm1hbGl6ZSByZWxhdGlvbnNoaXAgSURzIGludG8gcmVjb3JkcwogICAg
ICBkYXRhID0gbm9ybWFsaXplUmVsYXRpb25zaGlwcyh0aGlzLCByZWNvcmQuY29uc3RydWN0b3Is
IGRhdGEsIHJlY29yZCk7CgogICAgICB0aGlzLnVwZGF0ZUlkKHJlY29yZCwgZGF0YSk7CiAgICB9
CgogICAgcmVjb3JkLmFkYXB0ZXJEaWRDb21taXQoZGF0YSk7CiAgfSwKCiAgLyoqCiAgICBUaGlz
IG1ldGhvZCBpcyBjYWxsZWQgb25jZSB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSBhbgogICAgYWRh
cHRlcidzIGBjcmVhdGVSZWNvcmRgLCBgdXBkYXRlUmVjb3JkYCBvciBgZGVsZXRlUmVjb3JkYAog
ICAgaXMgcmVqZWN0ZWQgd2l0aCBhIGBEUy5JbnZhbGlkRXJyb3JgLgoKICAgIEBtZXRob2QgcmVj
b3JkV2FzSW52YWxpZAogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAog
ICAgQHBhcmFtIHtPYmplY3R9IGVycm9ycwogICovCiAgcmVjb3JkV2FzSW52YWxpZDogZnVuY3Rp
b24ocmVjb3JkLCBlcnJvcnMpIHsKICAgIHJlY29yZC5hZGFwdGVyRGlkSW52YWxpZGF0ZShlcnJv
cnMpOwogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgaXMgY2FsbGVkIG9uY2UgdGhlIHByb21p
c2UgcmV0dXJuZWQgYnkgYW4KICAgIGFkYXB0ZXIncyBgY3JlYXRlUmVjb3JkYCwgYHVwZGF0ZVJl
Y29yZGAgb3IgYGRlbGV0ZVJlY29yZGAKICAgIGlzIHJlamVjdGVkICh3aXRoIGFueXRoaW5nIG90
aGVyIHRoYW4gYSBgRFMuSW52YWxpZEVycm9yYCkuCgogICAgQG1ldGhvZCByZWNvcmRXYXNFcnJv
cgogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICovCiAgcmVjb3Jk
V2FzRXJyb3I6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgcmVjb3JkLmFkYXB0ZXJEaWRFcnJvcigp
OwogIH0sCgogIC8qKgogICAgV2hlbiBhbiBhZGFwdGVyJ3MgYGNyZWF0ZVJlY29yZGAsIGB1cGRh
dGVSZWNvcmRgIG9yIGBkZWxldGVSZWNvcmRgCiAgICByZXNvbHZlcyB3aXRoIGRhdGEsIHRoaXMg
bWV0aG9kIGV4dHJhY3RzIHRoZSBJRCBmcm9tIHRoZSBzdXBwbGllZAogICAgZGF0YS4KCiAgICBA
bWV0aG9kIHVwZGF0ZUlkCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3Jk
CiAgICBAcGFyYW0ge09iamVjdH0gZGF0YQogICovCiAgdXBkYXRlSWQ6IGZ1bmN0aW9uKHJlY29y
ZCwgZGF0YSkgewogICAgdmFyIG9sZElkID0gZ2V0KHJlY29yZCwgJ2lkJyksCiAgICAgICAgaWQg
PSBjb2VyY2VJZChkYXRhLmlkKTsKCiAgICBFbWJlci5hc3NlcnQoIkFuIGFkYXB0ZXIgY2Fubm90
IGFzc2lnbiBhIG5ldyBpZCB0byBhIHJlY29yZCB0aGF0IGFscmVhZHkgaGFzIGFuIGlkLiAiICsg
cmVjb3JkICsgIiBoYWQgaWQ6ICIgKyBvbGRJZCArICIgYW5kIHlvdSB0cmllZCB0byB1cGRhdGUg
aXQgd2l0aCAiICsgaWQgKyAiLiBUaGlzIGxpa2VseSBoYXBwZW5lZCBiZWNhdXNlIHlvdXIgc2Vy
dmVyIHJldHVybmVkIGRhdGEgaW4gcmVzcG9uc2UgdG8gYSBmaW5kIG9yIHVwZGF0ZSB0aGF0IGhh
ZCBhIGRpZmZlcmVudCBpZCB0aGFuIHRoZSBvbmUgeW91IHNlbnQuIiwgb2xkSWQgPT09IG51bGwg
fHwgaWQgPT09IG9sZElkKTsKCiAgICB0aGlzLnR5cGVNYXBGb3IocmVjb3JkLmNvbnN0cnVjdG9y
KS5pZFRvUmVjb3JkW2lkXSA9IHJlY29yZDsKCiAgICBzZXQocmVjb3JkLCAnaWQnLCBpZCk7CiAg
fSwKCiAgLyoqCiAgICBSZXR1cm5zIGEgbWFwIG9mIElEcyB0byBjbGllbnQgSURzIGZvciBhIGdp
dmVuIHR5cGUuCgogICAgQG1ldGhvZCB0eXBlTWFwRm9yCiAgICBAcHJpdmF0ZQogICAgQHBhcmFt
IHR5cGUKICAgIEByZXR1cm4ge09iamVjdH0gdHlwZU1hcAogICovCiAgdHlwZU1hcEZvcjogZnVu
Y3Rpb24odHlwZSkgewogICAgdmFyIHR5cGVNYXBzID0gZ2V0KHRoaXMsICd0eXBlTWFwcycpLAog
ICAgICAgIGd1aWQgPSBFbWJlci5ndWlkRm9yKHR5cGUpLAogICAgICAgIHR5cGVNYXA7CgogICAg
dHlwZU1hcCA9IHR5cGVNYXBzW2d1aWRdOwoKICAgIGlmICh0eXBlTWFwKSB7IHJldHVybiB0eXBl
TWFwOyB9CgogICAgdHlwZU1hcCA9IHsKICAgICAgaWRUb1JlY29yZDoge30sCiAgICAgIHJlY29y
ZHM6IFtdLAogICAgICBtZXRhZGF0YToge30KICAgIH07CgogICAgdHlwZU1hcHNbZ3VpZF0gPSB0
eXBlTWFwOwoKICAgIHJldHVybiB0eXBlTWFwOwogIH0sCgogIC8vIC4uLi4uLi4uLi4uLi4uLi4K
ICAvLyAuIExPQURJTkcgREFUQSAuCiAgLy8gLi4uLi4uLi4uLi4uLi4uLgoKICAvKioKICAgIFRo
aXMgaW50ZXJuYWwgbWV0aG9kIGlzIHVzZWQgYnkgYHB1c2hgLgoKICAgIEBtZXRob2QgX2xvYWQK
ICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFzcyBvZiBEUy5Nb2RlbH0g
dHlwZQogICAgQHBhcmFtIHtPYmplY3R9IGRhdGEKICAgIEBwYXJhbSB7Qm9vbGVhbn0gcGFydGlh
bCB0aGUgZGF0YSBzaG91bGQgYmUgbWVyZ2VkIGludG8KICAgICAgdGhlIGV4aXN0aW5nIGRhdGEs
IG5vdCByZXBsYWNlIGl0LgogICovCiAgX2xvYWQ6IGZ1bmN0aW9uKHR5cGUsIGRhdGEsIHBhcnRp
YWwpIHsKICAgIHZhciBpZCA9IGNvZXJjZUlkKGRhdGEuaWQpLAogICAgICAgIHJlY29yZCA9IHRo
aXMucmVjb3JkRm9ySWQodHlwZSwgaWQpOwoKICAgIHJlY29yZC5zZXR1cERhdGEoZGF0YSwgcGFy
dGlhbCk7CiAgICB0aGlzLnJlY29yZEFycmF5TWFuYWdlci5yZWNvcmREaWRDaGFuZ2UocmVjb3Jk
KTsKCiAgICByZXR1cm4gcmVjb3JkOwogIH0sCgogIC8qKgogICAgUmV0dXJucyBhIG1vZGVsIGNs
YXNzIGZvciBhIHBhcnRpY3VsYXIga2V5LiBVc2VkIGJ5CiAgICBtZXRob2RzIHRoYXQgdGFrZSBh
IHR5cGUga2V5IChsaWtlIGBmaW5kYCwgYGNyZWF0ZVJlY29yZGAsCiAgICBldGMuKQoKICAgIEBt
ZXRob2QgbW9kZWxGb3IKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVs
fSBrZXkKICAgIEByZXR1cm5zIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0KICAqLwogIG1vZGVsRm9y
OiBmdW5jdGlvbihrZXkpIHsKICAgIHZhciBmYWN0b3J5OwoKCiAgICBpZiAodHlwZW9mIGtleSA9
PT0gJ3N0cmluZycpIHsKICAgICAgdmFyIG5vcm1hbGl6ZWRLZXkgPSB0aGlzLmNvbnRhaW5lci5u
b3JtYWxpemUoJ21vZGVsOicgKyBrZXkpOwoKICAgICAgZmFjdG9yeSA9IHRoaXMuY29udGFpbmVy
Lmxvb2t1cEZhY3Rvcnkobm9ybWFsaXplZEtleSk7CiAgICAgIGlmICghZmFjdG9yeSkgeyB0aHJv
dyBuZXcgRW1iZXIuRXJyb3IoIk5vIG1vZGVsIHdhcyBmb3VuZCBmb3IgJyIgKyBrZXkgKyAiJyIp
OyB9CiAgICAgIGZhY3RvcnkudHlwZUtleSA9IG5vcm1hbGl6ZWRLZXkuc3BsaXQoJzonLCAyKVsx
XTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIEEgZmFjdG9yeSBhbHJlYWR5IHN1cHBsaWVkLgogICAg
ICBmYWN0b3J5ID0ga2V5OwogICAgfQoKICAgIGZhY3Rvcnkuc3RvcmUgPSB0aGlzOwogICAgcmV0
dXJuIGZhY3Rvcnk7CiAgfSwKCiAgLyoqCiAgICBQdXNoIHNvbWUgZGF0YSBmb3IgYSBnaXZlbiB0
eXBlIGludG8gdGhlIHN0b3JlLgoKICAgIFRoaXMgbWV0aG9kIGV4cGVjdHMgbm9ybWFsaXplZCBk
YXRhOgoKICAgICogVGhlIElEIGlzIGEga2V5IG5hbWVkIGBpZGAgKGFuIElEIGlzIG1hbmRhdG9y
eSkKICAgICogVGhlIG5hbWVzIG9mIGF0dHJpYnV0ZXMgYXJlIHRoZSBvbmVzIHlvdSB1c2VkIGlu
CiAgICAgIHlvdXIgbW9kZWwncyBgRFMuYXR0cmBzLgogICAgKiBZb3VyIHJlbGF0aW9uc2hpcHMg
bXVzdCBiZToKICAgICAgKiByZXByZXNlbnRlZCBhcyBJRHMgb3IgQXJyYXlzIG9mIElEcwogICAg
ICAqIHJlcHJlc2VudGVkIGFzIG1vZGVsIGluc3RhbmNlcwogICAgICAqIHJlcHJlc2VudGVkIGFz
IFVSTHMsIHVuZGVyIHRoZSBgbGlua3NgIGtleQoKICAgIEZvciB0aGlzIG1vZGVsOgoKICAgIGBg
YGpzCiAgICBBcHAuUGVyc29uID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgICAgZmlyc3ROYW1lOiBE
Uy5hdHRyKCksCiAgICAgIGxhc3ROYW1lOiBEUy5hdHRyKCksCgogICAgICBjaGlsZHJlbjogRFMu
aGFzTWFueSgncGVyc29uJykKICAgIH0pOwogICAgYGBgCgogICAgVG8gcmVwcmVzZW50IHRoZSBj
aGlsZHJlbiBhcyBJRHM6CgogICAgYGBganMKICAgIHsKICAgICAgaWQ6IDEsCiAgICAgIGZpcnN0
TmFtZTogIlRvbSIsCiAgICAgIGxhc3ROYW1lOiAiRGFsZSIsCiAgICAgIGNoaWxkcmVuOiBbMSwg
MiwgM10KICAgIH0KICAgIGBgYAoKICAgIFRvIHJlcHJlc2VudCB0aGUgY2hpbGRyZW4gcmVsYXRp
b25zaGlwIGFzIGEgVVJMOgoKICAgIGBgYGpzCiAgICB7CiAgICAgIGlkOiAxLAogICAgICBmaXJz
dE5hbWU6ICJUb20iLAogICAgICBsYXN0TmFtZTogIkRhbGUiLAogICAgICBsaW5rczogewogICAg
ICAgIGNoaWxkcmVuOiAiL3Blb3BsZS8xL2NoaWxkcmVuIgogICAgICB9CiAgICB9CiAgICBgYGAK
CiAgICBJZiB5b3UncmUgc3RyZWFtaW5nIGRhdGEgb3IgaW1wbGVtZW50aW5nIGFuIGFkYXB0ZXIs
CiAgICBtYWtlIHN1cmUgdGhhdCB5b3UgaGF2ZSBjb252ZXJ0ZWQgdGhlIGluY29taW5nIGRhdGEK
ICAgIGludG8gdGhpcyBmb3JtLgoKICAgIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJvdGggdG8g
cHVzaCBpbiBicmFuZCBuZXcKICAgIHJlY29yZHMsIGFzIHdlbGwgYXMgdG8gdXBkYXRlIGV4aXN0
aW5nIHJlY29yZHMuCgogICAgQG1ldGhvZCBwdXNoCiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJj
bGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IGRhdGEKICAgIEByZXR1
cm5zIHtEUy5Nb2RlbH0gdGhlIHJlY29yZCB0aGF0IHdhcyBjcmVhdGVkIG9yCiAgICAgIHVwZGF0
ZWQuCiAgKi8KICBwdXNoOiBmdW5jdGlvbih0eXBlLCBkYXRhLCBfcGFydGlhbCkgewogICAgLy8g
X3BhcnRpYWwgaXMgYW4gaW50ZXJuYWwgcGFyYW0gdXNlZCBieSBgdXBkYXRlYC4KICAgIC8vIElm
IHBhc3NlZCwgaXQgbWVhbnMgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUKICAgIC8vIG1lcmdlZCBp
bnRvIHRoZSBleGlzdGluZyBkYXRhLCBub3QgcmVwbGFjZSBpdC4KCiAgICBFbWJlci5hc3NlcnQo
IllvdSBtdXN0IGluY2x1ZGUgYW4gYGlkYCBpbiBhIGhhc2ggcGFzc2VkIHRvIGBwdXNoYCIsIGRh
dGEuaWQgIT0gbnVsbCk7CgogICAgdHlwZSA9IHRoaXMubW9kZWxGb3IodHlwZSk7CgogICAgLy8g
bm9ybWFsaXplIHJlbGF0aW9uc2hpcCBJRHMgaW50byByZWNvcmRzCiAgICBkYXRhID0gbm9ybWFs
aXplUmVsYXRpb25zaGlwcyh0aGlzLCB0eXBlLCBkYXRhKTsKCiAgICB0aGlzLl9sb2FkKHR5cGUs
IGRhdGEsIF9wYXJ0aWFsKTsKCiAgICByZXR1cm4gdGhpcy5yZWNvcmRGb3JJZCh0eXBlLCBkYXRh
LmlkKTsKICB9LAoKICAvKioKICAgIFB1c2ggc29tZSByYXcgZGF0YSBpbnRvIHRoZSBzdG9yZS4K
CiAgICBUaGUgZGF0YSB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZGVzZXJpYWxpemVkIHVzaW5nIHRo
ZQogICAgc2VyaWFsaXplciBmb3IgdGhlIGB0eXBlYCBwYXJhbS4KCiAgICBUaGlzIG1ldGhvZCBj
YW4gYmUgdXNlZCBib3RoIHRvIHB1c2ggaW4gYnJhbmQgbmV3CiAgICByZWNvcmRzLCBhcyB3ZWxs
IGFzIHRvIHVwZGF0ZSBleGlzdGluZyByZWNvcmRzLgoKICAgIFlvdSBjYW4gcHVzaCBpbiBtb3Jl
IHRoYW4gb25lIHR5cGUgb2Ygb2JqZWN0IGF0IG9uY2UuCiAgICBBbGwgb2JqZWN0cyBzaG91bGQg
YmUgaW4gdGhlIGZvcm1hdCBleHBlY3RlZCBieSB0aGUKICAgIHNlcmlhbGl6ZXIuCgogICAgYGBg
anMKICAgIEFwcC5BcHBsaWNhdGlvblNlcmlhbGl6ZXIgPSBEUy5BY3RpdmVNb2RlbFNlcmlhbGl6
ZXI7CgogICAgdmFyIHB1c2hEYXRhID0gewogICAgICBwb3N0czogWwogICAgICAgIHtpZDogMSwg
cG9zdF90aXRsZTogIkdyZWF0IHBvc3QiLCBjb21tZW50X2lkczogWzJdfQogICAgICBdLAogICAg
ICBjb21tZW50czogWwogICAgICAgIHtpZDogMiwgY29tbWVudF9ib2R5OiAiSW5zaWdodGZ1bCBj
b21tZW50In0KICAgICAgXQogICAgfQoKICAgIHN0b3JlLnB1c2hQYXlsb2FkKCdwb3N0JywgcHVz
aERhdGEpOwogICAgYGBgCgogICAgQG1ldGhvZCBwdXNoUGF5bG9hZAogICAgQHBhcmFtIHtTdHJp
bmd9IHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICBAcmV0dXJuIHtEUy5Nb2Rl
bH0gdGhlIHJlY29yZCB0aGF0IHdhcyBjcmVhdGVkIG9yIHVwZGF0ZWQuCiAgKi8KICBwdXNoUGF5
bG9hZDogZnVuY3Rpb24gKHR5cGUsIHBheWxvYWQpIHsKICAgIHZhciBzZXJpYWxpemVyOwogICAg
aWYgKCFwYXlsb2FkKSB7CiAgICAgIHBheWxvYWQgPSB0eXBlOwogICAgICBzZXJpYWxpemVyID0g
ZGVmYXVsdFNlcmlhbGl6ZXIodGhpcy5jb250YWluZXIpOwogICAgICBFbWJlci5hc3NlcnQoIllv
dSBjYW5ub3QgdXNlIGBzdG9yZSNwdXNoUGF5bG9hZGAgd2l0aG91dCBhIHR5cGUgdW5sZXNzIHlv
dXIgZGVmYXVsdCBzZXJpYWxpemVyIGRlZmluZXMgYHB1c2hQYXlsb2FkYCIsIHNlcmlhbGl6ZXIu
cHVzaFBheWxvYWQpOwogICAgfSBlbHNlIHsKICAgICAgc2VyaWFsaXplciA9IHRoaXMuc2VyaWFs
aXplckZvcih0eXBlKTsKICAgIH0KICAgIHNlcmlhbGl6ZXIucHVzaFBheWxvYWQodGhpcywgcGF5
bG9hZCk7CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbih0eXBlLCBkYXRhKSB7CiAgICBFbWJlci5h
c3NlcnQoIllvdSBtdXN0IGluY2x1ZGUgYW4gYGlkYCBpbiBhIGhhc2ggcGFzc2VkIHRvIGB1cGRh
dGVgIiwgZGF0YS5pZCAhPSBudWxsKTsKCiAgICByZXR1cm4gdGhpcy5wdXNoKHR5cGUsIGRhdGEs
IHRydWUpOwogIH0sCgogIC8qKgogICAgSWYgeW91IGhhdmUgYW4gQXJyYXkgb2Ygbm9ybWFsaXpl
ZCBkYXRhIHRvIHB1c2gsCiAgICB5b3UgY2FuIGNhbGwgYHB1c2hNYW55YCB3aXRoIHRoZSBBcnJh
eSwgYW5kIGl0IHdpbGwKICAgIGNhbGwgYHB1c2hgIHJlcGVhdGVkbHkgZm9yIHlvdS4KCiAgICBA
bWV0aG9kIHB1c2hNYW55CiAgICBAcGFyYW0ge1N0cmluZyBvciBzdWJjbGFzcyBvZiBEUy5Nb2Rl
bH0gdHlwZQogICAgQHBhcmFtIHtBcnJheX0gZGF0YXMKICAgIEByZXR1cm4ge0FycmF5fQogICov
CiAgcHVzaE1hbnk6IGZ1bmN0aW9uKHR5cGUsIGRhdGFzKSB7CiAgICByZXR1cm4gbWFwKGRhdGFz
LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHJldHVybiB0aGlzLnB1c2godHlwZSwgZGF0YSk7CiAg
ICB9LCB0aGlzKTsKICB9LAoKICAvKioKICAgIElmIHlvdSBoYXZlIHNvbWUgbWV0YWRhdGEgdG8g
c2V0IGZvciBhIHR5cGUKICAgIHlvdSBjYW4gY2FsbCBgbWV0YUZvclR5cGVgLgoKICAgIEBtZXRo
b2QgbWV0YUZvclR5cGUKICAgIEBwYXJhbSB7U3RyaW5nIG9yIHN1YmNsYXNzIG9mIERTLk1vZGVs
fSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gbWV0YWRhdGEKICAqLwogIG1ldGFGb3JUeXBlOiBm
dW5jdGlvbih0eXBlLCBtZXRhZGF0YSkgewogICAgdHlwZSA9IHRoaXMubW9kZWxGb3IodHlwZSk7
CgogICAgRW1iZXIubWVyZ2UodGhpcy50eXBlTWFwRm9yKHR5cGUpLm1ldGFkYXRhLCBtZXRhZGF0
YSk7CiAgfSwKCiAgLyoqCiAgICBCdWlsZCBhIGJyYW5kIG5ldyByZWNvcmQgZm9yIGEgZ2l2ZW4g
dHlwZSwgSUQsIGFuZAogICAgaW5pdGlhbCBkYXRhLgoKICAgIEBtZXRob2QgYnVpbGRSZWNvcmQK
ICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBA
cGFyYW0ge1N0cmluZ30gaWQKICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICBAcmV0dXJucyB7
RFMuTW9kZWx9IHJlY29yZAogICovCiAgYnVpbGRSZWNvcmQ6IGZ1bmN0aW9uKHR5cGUsIGlkLCBk
YXRhKSB7CiAgICB2YXIgdHlwZU1hcCA9IHRoaXMudHlwZU1hcEZvcih0eXBlKSwKICAgICAgICBp
ZFRvUmVjb3JkID0gdHlwZU1hcC5pZFRvUmVjb3JkOwoKICAgIEVtYmVyLmFzc2VydCgnVGhlIGlk
ICcgKyBpZCArICcgaGFzIGFscmVhZHkgYmVlbiB1c2VkIHdpdGggYW5vdGhlciByZWNvcmQgb2Yg
dHlwZSAnICsgdHlwZS50b1N0cmluZygpICsgJy4nLCAhaWQgfHwgIWlkVG9SZWNvcmRbaWRdKTsK
CiAgICAvLyBsb29rdXBGYWN0b3J5IHNob3VsZCByZWFsbHkgcmV0dXJuIGFuIG9iamVjdCB0aGF0
IGNyZWF0ZXMKICAgIC8vIGluc3RhbmNlcyB3aXRoIHRoZSBpbmplY3Rpb25zIGFwcGxpZWQKICAg
IHZhciByZWNvcmQgPSB0eXBlLl9jcmVhdGUoewogICAgICBpZDogaWQsCiAgICAgIHN0b3JlOiB0
aGlzLAogICAgICBjb250YWluZXI6IHRoaXMuY29udGFpbmVyCiAgICB9KTsKCiAgICBpZiAoZGF0
YSkgewogICAgICByZWNvcmQuc2V0dXBEYXRhKGRhdGEpOwogICAgfQoKICAgIC8vIGlmIHdlJ3Jl
IGNyZWF0aW5nIGFuIGl0ZW0sIHRoaXMgcHJvY2VzcyB3aWxsIGJlIGRvbmUKICAgIC8vIGxhdGVy
LCBvbmNlIHRoZSBvYmplY3QgaGFzIGJlZW4gcGVyc2lzdGVkLgogICAgaWYgKGlkKSB7CiAgICAg
IGlkVG9SZWNvcmRbaWRdID0gcmVjb3JkOwogICAgfQoKICAgIHR5cGVNYXAucmVjb3Jkcy5wdXNo
KHJlY29yZCk7CgogICAgcmV0dXJuIHJlY29yZDsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4K
ICAvLyAuIERFU1RSVUNUSU9OIC4KICAvLyAuLi4uLi4uLi4uLi4uLi4KCiAgLyoqCiAgICBXaGVu
IGEgcmVjb3JkIGlzIGRlc3Ryb3llZCwgdGhpcyB1bi1pbmRleGVzIGl0IGFuZAogICAgcmVtb3Zl
cyBpdCBmcm9tIGFueSByZWNvcmQgYXJyYXlzIHNvIGl0IGNhbiBiZSBHQ2VkLgoKICAgIEBtZXRo
b2QgZGVtYXRlcmlhbGl6ZVJlY29yZAogICAgQHByaXZhdGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9
IHJlY29yZAogICovCiAgZGVtYXRlcmlhbGl6ZVJlY29yZDogZnVuY3Rpb24ocmVjb3JkKSB7CiAg
ICB2YXIgdHlwZSA9IHJlY29yZC5jb25zdHJ1Y3RvciwKICAgICAgICB0eXBlTWFwID0gdGhpcy50
eXBlTWFwRm9yKHR5cGUpLAogICAgICAgIGlkID0gZ2V0KHJlY29yZCwgJ2lkJyk7CgogICAgcmVj
b3JkLnVwZGF0ZVJlY29yZEFycmF5cygpOwoKICAgIGlmIChpZCkgewogICAgICBkZWxldGUgdHlw
ZU1hcC5pZFRvUmVjb3JkW2lkXTsKICAgIH0KCiAgICB2YXIgbG9jID0gaW5kZXhPZih0eXBlTWFw
LnJlY29yZHMsIHJlY29yZCk7CiAgICB0eXBlTWFwLnJlY29yZHMuc3BsaWNlKGxvYywgMSk7CiAg
fSwKCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgLy8gLiBSRUxBVElPTlNISVAgQ0hB
TkdFUyAuCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCgogIGFkZFJlbGF0aW9uc2hpcENo
YW5nZUZvcjogZnVuY3Rpb24oY2hpbGRSZWNvcmQsIGNoaWxkS2V5LCBwYXJlbnRSZWNvcmQsIHBh
cmVudEtleSwgY2hhbmdlKSB7CiAgICB2YXIgY2xpZW50SWQgPSBjaGlsZFJlY29yZC5jbGllbnRJ
ZCwKICAgICAgICBwYXJlbnRDbGllbnRJZCA9IHBhcmVudFJlY29yZCA/IHBhcmVudFJlY29yZCA6
IHBhcmVudFJlY29yZDsKICAgIHZhciBrZXkgPSBjaGlsZEtleSArIHBhcmVudEtleTsKICAgIHZh
ciBjaGFuZ2VzID0gdGhpcy5fcmVsYXRpb25zaGlwQ2hhbmdlczsKICAgIGlmICghKGNsaWVudElk
IGluIGNoYW5nZXMpKSB7CiAgICAgIGNoYW5nZXNbY2xpZW50SWRdID0ge307CiAgICB9CiAgICBp
ZiAoIShwYXJlbnRDbGllbnRJZCBpbiBjaGFuZ2VzW2NsaWVudElkXSkpIHsKICAgICAgY2hhbmdl
c1tjbGllbnRJZF1bcGFyZW50Q2xpZW50SWRdID0ge307CiAgICB9CiAgICBpZiAoIShrZXkgaW4g
Y2hhbmdlc1tjbGllbnRJZF1bcGFyZW50Q2xpZW50SWRdKSkgewogICAgICBjaGFuZ2VzW2NsaWVu
dElkXVtwYXJlbnRDbGllbnRJZF1ba2V5XSA9IHt9OwogICAgfQogICAgY2hhbmdlc1tjbGllbnRJ
ZF1bcGFyZW50Q2xpZW50SWRdW2tleV1bY2hhbmdlLmNoYW5nZVR5cGVdID0gY2hhbmdlOwogIH0s
CgogIHJlbW92ZVJlbGF0aW9uc2hpcENoYW5nZUZvcjogZnVuY3Rpb24oY2xpZW50UmVjb3JkLCBj
aGlsZEtleSwgcGFyZW50UmVjb3JkLCBwYXJlbnRLZXksIHR5cGUpIHsKICAgIHZhciBjbGllbnRJ
ZCA9IGNsaWVudFJlY29yZC5jbGllbnRJZCwKICAgICAgICBwYXJlbnRDbGllbnRJZCA9IHBhcmVu
dFJlY29yZCA/IHBhcmVudFJlY29yZC5jbGllbnRJZCA6IHBhcmVudFJlY29yZDsKICAgIHZhciBj
aGFuZ2VzID0gdGhpcy5fcmVsYXRpb25zaGlwQ2hhbmdlczsKICAgIHZhciBrZXkgPSBjaGlsZEtl
eSArIHBhcmVudEtleTsKICAgIGlmICghKGNsaWVudElkIGluIGNoYW5nZXMpIHx8ICEocGFyZW50
Q2xpZW50SWQgaW4gY2hhbmdlc1tjbGllbnRJZF0pIHx8ICEoa2V5IGluIGNoYW5nZXNbY2xpZW50
SWRdW3BhcmVudENsaWVudElkXSkpewogICAgICByZXR1cm47CiAgICB9CiAgICBkZWxldGUgY2hh
bmdlc1tjbGllbnRJZF1bcGFyZW50Q2xpZW50SWRdW2tleV1bdHlwZV07CiAgfSwKCiAgcmVsYXRp
b25zaGlwQ2hhbmdlUGFpcnNGb3I6IGZ1bmN0aW9uKHJlY29yZCl7CiAgICB2YXIgdG9SZXR1cm4g
PSBbXTsKCiAgICBpZiggIXJlY29yZCApIHsgcmV0dXJuIHRvUmV0dXJuOyB9CgogICAgLy9UT0RP
KElnb3IpIFdoYXQgYWJvdXQgdGhlIG90aGVyIHNpZGUKICAgIHZhciBjaGFuZ2VzT2JqZWN0ID0g
dGhpcy5fcmVsYXRpb25zaGlwQ2hhbmdlc1tyZWNvcmQuY2xpZW50SWRdOwogICAgZm9yICh2YXIg
b2JqS2V5IGluIGNoYW5nZXNPYmplY3QpewogICAgICBpZihjaGFuZ2VzT2JqZWN0Lmhhc093blBy
b3BlcnR5KG9iaktleSkpewogICAgICAgIGZvciAodmFyIGNoYW5nZUtleSBpbiBjaGFuZ2VzT2Jq
ZWN0W29iaktleV0pewogICAgICAgICAgaWYoY2hhbmdlc09iamVjdFtvYmpLZXldLmhhc093blBy
b3BlcnR5KGNoYW5nZUtleSkpewogICAgICAgICAgICB0b1JldHVybi5wdXNoKGNoYW5nZXNPYmpl
Y3Rbb2JqS2V5XVtjaGFuZ2VLZXldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAg
IH0KICAgIHJldHVybiB0b1JldHVybjsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4u
CiAgLy8gLiBQRVItVFlQRSBBREFQVEVSUwogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KCiAg
LyoqCiAgICBSZXR1cm5zIHRoZSBhZGFwdGVyIGZvciBhIGdpdmVuIHR5cGUuCgogICAgQG1ldGhv
ZCBhZGFwdGVyRm9yCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2Rl
bH0gdHlwZQogICAgQHJldHVybnMgRFMuQWRhcHRlcgogICovCiAgYWRhcHRlckZvcjogZnVuY3Rp
b24odHlwZSkgewogICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLCBhZGFwdGVyOwoK
ICAgIGlmIChjb250YWluZXIpIHsKICAgICAgYWRhcHRlciA9IGNvbnRhaW5lci5sb29rdXAoJ2Fk
YXB0ZXI6JyArIHR5cGUudHlwZUtleSkgfHwgY29udGFpbmVyLmxvb2t1cCgnYWRhcHRlcjphcHBs
aWNhdGlvbicpOwogICAgfQoKICAgIHJldHVybiBhZGFwdGVyIHx8IGdldCh0aGlzLCAnZGVmYXVs
dEFkYXB0ZXInKTsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAv
LyAuIFJFQ09SRCBDSEFOR0UgTk9USUZJQ0FUSU9OIC4KICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4KCiAgLyoqCiAgICBSZXR1cm5zIGFuIGluc3RhbmNlIG9mIHRoZSBzZXJpYWxp
emVyIGZvciBhIGdpdmVuIHR5cGUuIEZvcgogICAgZXhhbXBsZSwgYHNlcmlhbGl6ZXJGb3IoJ3Bl
cnNvbicpYCB3aWxsIHJldHVybiBhbiBpbnN0YW5jZSBvZgogICAgYEFwcC5QZXJzb25TZXJpYWxp
emVyYC4KCiAgICBJZiBubyBgQXBwLlBlcnNvblNlcmlhbGl6ZXJgIGlzIGZvdW5kLCB0aGlzIG1l
dGhvZCB3aWxsIGxvb2sKICAgIGZvciBhbiBgQXBwLkFwcGxpY2F0aW9uU2VyaWFsaXplcmAgKHRo
ZSBkZWZhdWx0IHNlcmlhbGl6ZXIgZm9yCiAgICB5b3VyIGVudGlyZSBhcHBsaWNhdGlvbikuCgog
ICAgSWYgbm8gYEFwcC5BcHBsaWNhdGlvblNlcmlhbGl6ZXJgIGlzIGZvdW5kLCBpdCB3aWxsIGZh
bGwgYmFjawogICAgdG8gYW4gaW5zdGFuY2Ugb2YgYERTLkpTT05TZXJpYWxpemVyYC4KCiAgICBA
bWV0aG9kIHNlcmlhbGl6ZXJGb3IKICAgIEBwcml2YXRlCiAgICBAcGFyYW0ge1N0cmluZ30gdHlw
ZSB0aGUgcmVjb3JkIHRvIHNlcmlhbGl6ZQogICAgQHJldHVybiB7RFMuU2VyaWFsaXplcn0KICAq
LwogIHNlcmlhbGl6ZXJGb3I6IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHR5cGUgPSB0aGlzLm1vZGVs
Rm9yKHR5cGUpOwogICAgdmFyIGFkYXB0ZXIgPSB0aGlzLmFkYXB0ZXJGb3IodHlwZSk7CgogICAg
cmV0dXJuIHNlcmlhbGl6ZXJGb3IodGhpcy5jb250YWluZXIsIHR5cGUudHlwZUtleSwgYWRhcHRl
ciAmJiBhZGFwdGVyLmRlZmF1bHRTZXJpYWxpemVyKTsKICB9Cn0pOwoKZnVuY3Rpb24gbm9ybWFs
aXplUmVsYXRpb25zaGlwcyhzdG9yZSwgdHlwZSwgZGF0YSwgcmVjb3JkKSB7CiAgdHlwZS5lYWNo
UmVsYXRpb25zaGlwKGZ1bmN0aW9uKGtleSwgcmVsYXRpb25zaGlwKSB7CiAgICAvLyBBIGxpbmsg
KHVzdWFsbHkgYSBVUkwpIHdhcyBhbHJlYWR5IHByb3ZpZGVkIGluCiAgICAvLyBub3JtYWxpemVk
IGZvcm0KICAgIGlmIChkYXRhLmxpbmtzICYmIGRhdGEubGlua3Nba2V5XSkgewogICAgICBpZiAo
cmVjb3JkICYmIHJlbGF0aW9uc2hpcC5vcHRpb25zLmFzeW5jKSB7IHJlY29yZC5fcmVsYXRpb25z
aGlwc1trZXldID0gbnVsbDsgfQogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGtpbmQgPSBy
ZWxhdGlvbnNoaXAua2luZCwKICAgICAgICB2YWx1ZSA9IGRhdGFba2V5XTsKCiAgICBpZiAodmFs
dWUgPT0gbnVsbCkgeyByZXR1cm47IH0KCiAgICBpZiAoa2luZCA9PT0gJ2JlbG9uZ3NUbycpIHsK
ICAgICAgZGVzZXJpYWxpemVSZWNvcmRJZChzdG9yZSwgZGF0YSwga2V5LCByZWxhdGlvbnNoaXAs
IHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoa2luZCA9PT0gJ2hhc01hbnknKSB7CiAgICAgIGRlc2Vy
aWFsaXplUmVjb3JkSWRzKHN0b3JlLCBkYXRhLCBrZXksIHJlbGF0aW9uc2hpcCwgdmFsdWUpOwog
ICAgICBhZGRVbnNhdmVkUmVjb3JkcyhyZWNvcmQsIGtleSwgdmFsdWUpOwogICAgfQogIH0pOwoK
ICByZXR1cm4gZGF0YTsKfQoKZnVuY3Rpb24gZGVzZXJpYWxpemVSZWNvcmRJZChzdG9yZSwgZGF0
YSwga2V5LCByZWxhdGlvbnNoaXAsIGlkKSB7CiAgaWYgKGlzTm9uZShpZCkgfHwgaWQgaW5zdGFu
Y2VvZiBEUy5Nb2RlbCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIHR5cGU7CgogIGlmICh0eXBl
b2YgaWQgPT09ICdudW1iZXInIHx8IHR5cGVvZiBpZCA9PT0gJ3N0cmluZycpIHsKICAgIHR5cGUg
PSB0eXBlRm9yKHJlbGF0aW9uc2hpcCwga2V5LCBkYXRhKTsKICAgIGRhdGFba2V5XSA9IHN0b3Jl
LnJlY29yZEZvcklkKHR5cGUsIGlkKTsKICB9IGVsc2UgaWYgKHR5cGVvZiBpZCA9PT0gJ29iamVj
dCcpIHsKICAgIC8vIHBvbHltb3JwaGljCiAgICBkYXRhW2tleV0gPSBzdG9yZS5yZWNvcmRGb3JJ
ZChpZC50eXBlLCBpZC5pZCk7CiAgfQp9CgpmdW5jdGlvbiB0eXBlRm9yKHJlbGF0aW9uc2hpcCwg
a2V5LCBkYXRhKSB7CiAgaWYgKHJlbGF0aW9uc2hpcC5vcHRpb25zLnBvbHltb3JwaGljKSB7CiAg
ICByZXR1cm4gZGF0YVtrZXkgKyAiVHlwZSJdOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcmVsYXRp
b25zaGlwLnR5cGU7CiAgfQp9CgpmdW5jdGlvbiBkZXNlcmlhbGl6ZVJlY29yZElkcyhzdG9yZSwg
ZGF0YSwga2V5LCByZWxhdGlvbnNoaXAsIGlkcykgewogIGZvciAodmFyIGk9MCwgbD1pZHMubGVu
Z3RoOyBpPGw7IGkrKykgewogICAgZGVzZXJpYWxpemVSZWNvcmRJZChzdG9yZSwgaWRzLCBpLCBy
ZWxhdGlvbnNoaXAsIGlkc1tpXSk7CiAgfQp9CgovLyBJZiB0aGVyZSBhcmUgYW55IHVuc2F2ZWQg
cmVjb3JkcyB0aGF0IGFyZSBpbiBhIGhhc01hbnkgdGhleSB3b24ndCBiZQovLyBpbiB0aGUgcGF5
bG9hZCwgc28gYWRkIHRoZW0gYmFjayBpbiBtYW51YWxseS4KZnVuY3Rpb24gYWRkVW5zYXZlZFJl
Y29yZHMocmVjb3JkLCBrZXksIGRhdGEpIHsKICBpZihyZWNvcmQpIHsKICAgIGRhdGEucHVzaE9i
amVjdHMocmVjb3JkLmdldChrZXkpLmZpbHRlckJ5KCdpc05ldycpKTsKICB9Cn0KCi8vIERlbGVn
YXRpb24gdG8gdGhlIGFkYXB0ZXIgYW5kIHByb21pc2UgbWFuYWdlbWVudAovKioKICBBIGBQcm9t
aXNlQXJyYXlgIGlzIGFuIG9iamVjdCB0aGF0IGFjdHMgbGlrZSBib3RoIGFuIGBFbWJlci5BcnJh
eWAKICBhbmQgYSBwcm9taXNlLiBXaGVuIHRoZSBwcm9taXNlIGlzIHJlc29sdmVkIHRoZSB0aGUg
cmVzdWx0aW5nIHZhbHVlCiAgd2lsbCBiZSBzZXQgdG8gdGhlIGBQcm9taXNlQXJyYXlgJ3MgYGNv
bnRlbnRgIHByb3BlcnR5LiBUaGlzIG1ha2VzCiAgaXQgZWFzeSB0byBjcmVhdGUgZGF0YSBiaW5k
aW5ncyB3aXRoIHRoZSBgUHJvbWlzZUFycmF5YCB0aGF0IHdpbGwgYmUKICB1cGRhdGVkIHdoZW4g
dGhlIHByb21pc2UgcmVzb2x2ZXMuCgogIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgW0Vt
YmVyLlByb21pc2VQcm94eU1peGluCiAgZG9jdW1lbnRhdGlvbl0oL2FwaS9jbGFzc2VzL0VtYmVy
LlByb21pc2VQcm94eU1peGluLmh0bWwpLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3JpcHQKICB2
YXIgcHJvbWlzZUFycmF5ID0gRFMuUHJvbWlzZUFycmF5LmNyZWF0ZSh7CiAgICBwcm9taXNlOiAk
LmdldEpTT04oJy9zb21lL3JlbW90ZS9kYXRhLmpzb24nKQogIH0pOwoKICBwcm9taXNlQXJyYXku
Z2V0KCdsZW5ndGgnKTsgLy8gMAoKICBwcm9taXNlQXJyYXkudGhlbihmdW5jdGlvbigpIHsKICAg
IHByb21pc2VBcnJheS5nZXQoJ2xlbmd0aCcpOyAvLyAxMDAKICB9KTsKICBgYGAKCiAgQGNsYXNz
IFByb21pc2VBcnJheQogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBFbWJlci5BcnJheVByb3h5
CiAgQHVzZXMgRW1iZXIuUHJvbWlzZVByb3h5TWl4aW4KKi8KRFMuUHJvbWlzZUFycmF5ID0gRW1i
ZXIuQXJyYXlQcm94eS5leHRlbmQoRW1iZXIuUHJvbWlzZVByb3h5TWl4aW4pOwovKioKICBBIGBQ
cm9taXNlT2JqZWN0YCBpcyBhbiBvYmplY3QgdGhhdCBhY3RzIGxpa2UgYm90aCBhbiBgRW1iZXIu
T2JqZWN0YAogIGFuZCBhIHByb21pc2UuIFdoZW4gdGhlIHByb21pc2UgaXMgcmVzb2x2ZWQgdGhl
IHRoZSByZXN1bHRpbmcgdmFsdWUKICB3aWxsIGJlIHNldCB0byB0aGUgYFByb21pc2VPYmplY3Rg
J3MgYGNvbnRlbnRgIHByb3BlcnR5LiBUaGlzIG1ha2VzCiAgaXQgZWFzeSB0byBjcmVhdGUgZGF0
YSBiaW5kaW5ncyB3aXRoIHRoZSBgUHJvbWlzZU9iamVjdGAgdGhhdCB3aWxsCiAgYmUgdXBkYXRl
ZCB3aGVuIHRoZSBwcm9taXNlIHJlc29sdmVzLgoKICBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUg
dGhlIFtFbWJlci5Qcm9taXNlUHJveHlNaXhpbgogIGRvY3VtZW50YXRpb25dKC9hcGkvY2xhc3Nl
cy9FbWJlci5Qcm9taXNlUHJveHlNaXhpbi5odG1sKS4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2Ny
aXB0CiAgdmFyIHByb21pc2VPYmplY3QgPSBEUy5Qcm9taXNlT2JqZWN0LmNyZWF0ZSh7CiAgICBw
cm9taXNlOiAkLmdldEpTT04oJy9zb21lL3JlbW90ZS9kYXRhLmpzb24nKQogIH0pOwoKICBwcm9t
aXNlT2JqZWN0LmdldCgnbmFtZScpOyAvLyBudWxsCgogIHByb21pc2VPYmplY3QudGhlbihmdW5j
dGlvbigpIHsKICAgIHByb21pc2VPYmplY3QuZ2V0KCduYW1lJyk7IC8vICdUb21zdGVyJwogIH0p
OwogIGBgYAoKICBAY2xhc3MgUHJvbWlzZU9iamVjdAogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5k
cyBFbWJlci5PYmplY3RQcm94eQogIEB1c2VzIEVtYmVyLlByb21pc2VQcm94eU1peGluCiovCkRT
LlByb21pc2VPYmplY3QgPSBFbWJlci5PYmplY3RQcm94eS5leHRlbmQoRW1iZXIuUHJvbWlzZVBy
b3h5TWl4aW4pOwoKZnVuY3Rpb24gcHJvbWlzZU9iamVjdChwcm9taXNlKSB7CiAgcmV0dXJuIERT
LlByb21pc2VPYmplY3QuY3JlYXRlKHsgcHJvbWlzZTogcHJvbWlzZSB9KTsKfQoKZnVuY3Rpb24g
cHJvbWlzZUFycmF5KHByb21pc2UpIHsKICByZXR1cm4gRFMuUHJvbWlzZUFycmF5LmNyZWF0ZSh7
IHByb21pc2U6IHByb21pc2UgfSk7Cn0KCmZ1bmN0aW9uIGlzVGhlbmFibGUob2JqZWN0KSB7CiAg
cmV0dXJuIG9iamVjdCAmJiB0eXBlb2Ygb2JqZWN0LnRoZW4gPT09ICdmdW5jdGlvbic7Cn0KCmZ1
bmN0aW9uIHNlcmlhbGl6ZXJGb3IoY29udGFpbmVyLCB0eXBlLCBkZWZhdWx0U2VyaWFsaXplcikg
ewogIHJldHVybiBjb250YWluZXIubG9va3VwKCdzZXJpYWxpemVyOicrdHlwZSkgfHwKICAgICAg
ICAgICAgICAgICBjb250YWluZXIubG9va3VwKCdzZXJpYWxpemVyOmFwcGxpY2F0aW9uJykgfHwK
ICAgICAgICAgICAgICAgICBjb250YWluZXIubG9va3VwKCdzZXJpYWxpemVyOicgKyBkZWZhdWx0
U2VyaWFsaXplcikgfHwKICAgICAgICAgICAgICAgICBjb250YWluZXIubG9va3VwKCdzZXJpYWxp
emVyOl9kZWZhdWx0Jyk7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRTZXJpYWxpemVyKGNvbnRhaW5lcikg
ewogIHJldHVybiBjb250YWluZXIubG9va3VwKCdzZXJpYWxpemVyOmFwcGxpY2F0aW9uJykgfHwK
ICAgICAgICAgY29udGFpbmVyLmxvb2t1cCgnc2VyaWFsaXplcjpfZGVmYXVsdCcpOwp9CgpmdW5j
dGlvbiBzZXJpYWxpemVyRm9yQWRhcHRlcihhZGFwdGVyLCB0eXBlKSB7CiAgdmFyIHNlcmlhbGl6
ZXIgPSBhZGFwdGVyLnNlcmlhbGl6ZXIsCiAgICAgIGRlZmF1bHRTZXJpYWxpemVyID0gYWRhcHRl
ci5kZWZhdWx0U2VyaWFsaXplciwKICAgICAgY29udGFpbmVyID0gYWRhcHRlci5jb250YWluZXI7
CgogIGlmIChjb250YWluZXIgJiYgc2VyaWFsaXplciA9PT0gdW5kZWZpbmVkKSB7CiAgICBzZXJp
YWxpemVyID0gc2VyaWFsaXplckZvcihjb250YWluZXIsIHR5cGUudHlwZUtleSwgZGVmYXVsdFNl
cmlhbGl6ZXIpOwogIH0KCiAgaWYgKHNlcmlhbGl6ZXIgPT09IG51bGwgfHwgc2VyaWFsaXplciA9
PT0gdW5kZWZpbmVkKSB7CiAgICBzZXJpYWxpemVyID0gewogICAgICBleHRyYWN0OiBmdW5jdGlv
bihzdG9yZSwgdHlwZSwgcGF5bG9hZCkgeyByZXR1cm4gcGF5bG9hZDsgfQogICAgfTsKICB9Cgog
IHJldHVybiBzZXJpYWxpemVyOwp9CgpmdW5jdGlvbiBfZmluZChhZGFwdGVyLCBzdG9yZSwgdHlw
ZSwgaWQpIHsKICB2YXIgcHJvbWlzZSA9IGFkYXB0ZXIuZmluZChzdG9yZSwgdHlwZSwgaWQpLAog
ICAgICBzZXJpYWxpemVyID0gc2VyaWFsaXplckZvckFkYXB0ZXIoYWRhcHRlciwgdHlwZSk7Cgog
IHJldHVybiByZXNvbHZlKHByb21pc2UsICJEUzogSGFuZGxlIEFkYXB0ZXIjZmluZCBvZiAiICsg
dHlwZSArICIgd2l0aCBpZDogIiArIGlkKS50aGVuKGZ1bmN0aW9uKHBheWxvYWQpIHsKICAgIEVt
YmVyLmFzc2VydCgiWW91IG1hZGUgYSByZXF1ZXN0IGZvciBhICIgKyB0eXBlLnR5cGVLZXkgKyAi
IHdpdGggaWQgIiArIGlkICsgIiwgYnV0IHRoZSBhZGFwdGVyJ3MgcmVzcG9uc2UgZGlkIG5vdCBo
YXZlIGFueSBkYXRhIiwgcGF5bG9hZCk7CiAgICBwYXlsb2FkID0gc2VyaWFsaXplci5leHRyYWN0
KHN0b3JlLCB0eXBlLCBwYXlsb2FkLCBpZCwgJ2ZpbmQnKTsKCiAgICByZXR1cm4gc3RvcmUucHVz
aCh0eXBlLCBwYXlsb2FkKTsKICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgdmFyIHJlY29yZCA9
IHN0b3JlLmdldEJ5SWQodHlwZSwgaWQpOwogICAgcmVjb3JkLm5vdEZvdW5kKCk7CiAgICB0aHJv
dyBlcnJvcjsKICB9LCAiRFM6IEV4dHJhY3QgcGF5bG9hZCBvZiAnIiArIHR5cGUgKyAiJyIpOwp9
CgpmdW5jdGlvbiBfZmluZE1hbnkoYWRhcHRlciwgc3RvcmUsIHR5cGUsIGlkcywgb3duZXIpIHsK
ICB2YXIgcHJvbWlzZSA9IGFkYXB0ZXIuZmluZE1hbnkoc3RvcmUsIHR5cGUsIGlkcywgb3duZXIp
LAogICAgICBzZXJpYWxpemVyID0gc2VyaWFsaXplckZvckFkYXB0ZXIoYWRhcHRlciwgdHlwZSk7
CgogIHJldHVybiByZXNvbHZlKHByb21pc2UsICJEUzogSGFuZGxlIEFkYXB0ZXIjZmluZE1hbnkg
b2YgIiArIHR5cGUpLnRoZW4oZnVuY3Rpb24ocGF5bG9hZCkgewogICAgcGF5bG9hZCA9IHNlcmlh
bGl6ZXIuZXh0cmFjdChzdG9yZSwgdHlwZSwgcGF5bG9hZCwgbnVsbCwgJ2ZpbmRNYW55Jyk7Cgog
ICAgRW1iZXIuYXNzZXJ0KCJUaGUgcmVzcG9uc2UgZnJvbSBhIGZpbmRNYW55IG11c3QgYmUgYW4g
QXJyYXksIG5vdCAiICsgRW1iZXIuaW5zcGVjdChwYXlsb2FkKSwgRW1iZXIudHlwZU9mKHBheWxv
YWQpID09PSAnYXJyYXknKTsKCiAgICBzdG9yZS5wdXNoTWFueSh0eXBlLCBwYXlsb2FkKTsKICB9
LCBudWxsLCAiRFM6IEV4dHJhY3QgcGF5bG9hZCBvZiAiICsgdHlwZSk7Cn0KCmZ1bmN0aW9uIF9m
aW5kSGFzTWFueShhZGFwdGVyLCBzdG9yZSwgcmVjb3JkLCBsaW5rLCByZWxhdGlvbnNoaXApIHsK
ICB2YXIgcHJvbWlzZSA9IGFkYXB0ZXIuZmluZEhhc01hbnkoc3RvcmUsIHJlY29yZCwgbGluaywg
cmVsYXRpb25zaGlwKSwKICAgICAgc2VyaWFsaXplciA9IHNlcmlhbGl6ZXJGb3JBZGFwdGVyKGFk
YXB0ZXIsIHJlbGF0aW9uc2hpcC50eXBlKTsKCiAgcmV0dXJuIHJlc29sdmUocHJvbWlzZSwgIkRT
OiBIYW5kbGUgQWRhcHRlciNmaW5kSGFzTWFueSBvZiAiICsgcmVjb3JkICsgIiA6ICIgKyByZWxh
dGlvbnNoaXAudHlwZSkudGhlbihmdW5jdGlvbihwYXlsb2FkKSB7CiAgICBwYXlsb2FkID0gc2Vy
aWFsaXplci5leHRyYWN0KHN0b3JlLCByZWxhdGlvbnNoaXAudHlwZSwgcGF5bG9hZCwgbnVsbCwg
J2ZpbmRIYXNNYW55Jyk7CgogICAgRW1iZXIuYXNzZXJ0KCJUaGUgcmVzcG9uc2UgZnJvbSBhIGZp
bmRIYXNNYW55IG11c3QgYmUgYW4gQXJyYXksIG5vdCAiICsgRW1iZXIuaW5zcGVjdChwYXlsb2Fk
KSwgRW1iZXIudHlwZU9mKHBheWxvYWQpID09PSAnYXJyYXknKTsKCiAgICB2YXIgcmVjb3JkcyA9
IHN0b3JlLnB1c2hNYW55KHJlbGF0aW9uc2hpcC50eXBlLCBwYXlsb2FkKTsKICAgIHJlY29yZC51
cGRhdGVIYXNNYW55KHJlbGF0aW9uc2hpcC5rZXksIHJlY29yZHMpOwogIH0sIG51bGwsICJEUzog
RXh0cmFjdCBwYXlsb2FkIG9mICIgKyByZWNvcmQgKyAiIDogaGFzTWFueSAiICsgcmVsYXRpb25z
aGlwLnR5cGUpOwp9CgpmdW5jdGlvbiBfZmluZEJlbG9uZ3NUbyhhZGFwdGVyLCBzdG9yZSwgcmVj
b3JkLCBsaW5rLCByZWxhdGlvbnNoaXApIHsKICB2YXIgcHJvbWlzZSA9IGFkYXB0ZXIuZmluZEJl
bG9uZ3NUbyhzdG9yZSwgcmVjb3JkLCBsaW5rLCByZWxhdGlvbnNoaXApLAogICAgICBzZXJpYWxp
emVyID0gc2VyaWFsaXplckZvckFkYXB0ZXIoYWRhcHRlciwgcmVsYXRpb25zaGlwLnR5cGUpOwoK
ICByZXR1cm4gcmVzb2x2ZShwcm9taXNlLCAiRFM6IEhhbmRsZSBBZGFwdGVyI2ZpbmRCZWxvbmdz
VG8gb2YgIiArIHJlY29yZCArICIgOiAiICsgcmVsYXRpb25zaGlwLnR5cGUpLnRoZW4oZnVuY3Rp
b24ocGF5bG9hZCkgewogICAgcGF5bG9hZCA9IHNlcmlhbGl6ZXIuZXh0cmFjdChzdG9yZSwgcmVs
YXRpb25zaGlwLnR5cGUsIHBheWxvYWQsIG51bGwsICdmaW5kQmVsb25nc1RvJyk7CgogICAgdmFy
IHJlY29yZCA9IHN0b3JlLnB1c2gocmVsYXRpb25zaGlwLnR5cGUsIHBheWxvYWQpOwogICAgcmVj
b3JkLnVwZGF0ZUJlbG9uZ3NUbyhyZWxhdGlvbnNoaXAua2V5LCByZWNvcmQpOwogICAgcmV0dXJu
IHJlY29yZDsKICB9LCBudWxsLCAiRFM6IEV4dHJhY3QgcGF5bG9hZCBvZiAiICsgcmVjb3JkICsg
IiA6ICIgKyByZWxhdGlvbnNoaXAudHlwZSk7Cn0KCmZ1bmN0aW9uIF9maW5kQWxsKGFkYXB0ZXIs
IHN0b3JlLCB0eXBlLCBzaW5jZVRva2VuKSB7CiAgdmFyIHByb21pc2UgPSBhZGFwdGVyLmZpbmRB
bGwoc3RvcmUsIHR5cGUsIHNpbmNlVG9rZW4pLAogICAgICBzZXJpYWxpemVyID0gc2VyaWFsaXpl
ckZvckFkYXB0ZXIoYWRhcHRlciwgdHlwZSk7CgogIHJldHVybiByZXNvbHZlKHByb21pc2UsICJE
UzogSGFuZGxlIEFkYXB0ZXIjZmluZEFsbCBvZiAiICsgdHlwZSkudGhlbihmdW5jdGlvbihwYXls
b2FkKSB7CiAgICBwYXlsb2FkID0gc2VyaWFsaXplci5leHRyYWN0KHN0b3JlLCB0eXBlLCBwYXls
b2FkLCBudWxsLCAnZmluZEFsbCcpOwoKICAgIEVtYmVyLmFzc2VydCgiVGhlIHJlc3BvbnNlIGZy
b20gYSBmaW5kQWxsIG11c3QgYmUgYW4gQXJyYXksIG5vdCAiICsgRW1iZXIuaW5zcGVjdChwYXls
b2FkKSwgRW1iZXIudHlwZU9mKHBheWxvYWQpID09PSAnYXJyYXknKTsKCiAgICBzdG9yZS5wdXNo
TWFueSh0eXBlLCBwYXlsb2FkKTsKICAgIHN0b3JlLmRpZFVwZGF0ZUFsbCh0eXBlKTsKICAgIHJl
dHVybiBzdG9yZS5hbGwodHlwZSk7CiAgfSwgbnVsbCwgIkRTOiBFeHRyYWN0IHBheWxvYWQgb2Yg
ZmluZEFsbCAiICsgdHlwZSk7Cn0KCmZ1bmN0aW9uIF9maW5kUXVlcnkoYWRhcHRlciwgc3RvcmUs
IHR5cGUsIHF1ZXJ5LCByZWNvcmRBcnJheSkgewogIHZhciBwcm9taXNlID0gYWRhcHRlci5maW5k
UXVlcnkoc3RvcmUsIHR5cGUsIHF1ZXJ5LCByZWNvcmRBcnJheSksCiAgICAgIHNlcmlhbGl6ZXIg
PSBzZXJpYWxpemVyRm9yQWRhcHRlcihhZGFwdGVyLCB0eXBlKTsKCiAgcmV0dXJuIHJlc29sdmUo
cHJvbWlzZSwgIkRTOiBIYW5kbGUgQWRhcHRlciNmaW5kUXVlcnkgb2YgIiArIHR5cGUpLnRoZW4o
ZnVuY3Rpb24ocGF5bG9hZCkgewogICAgcGF5bG9hZCA9IHNlcmlhbGl6ZXIuZXh0cmFjdChzdG9y
ZSwgdHlwZSwgcGF5bG9hZCwgbnVsbCwgJ2ZpbmRRdWVyeScpOwoKICAgIEVtYmVyLmFzc2VydCgi
VGhlIHJlc3BvbnNlIGZyb20gYSBmaW5kUXVlcnkgbXVzdCBiZSBhbiBBcnJheSwgbm90ICIgKyBF
bWJlci5pbnNwZWN0KHBheWxvYWQpLCBFbWJlci50eXBlT2YocGF5bG9hZCkgPT09ICdhcnJheScp
OwoKICAgIHJlY29yZEFycmF5LmxvYWQocGF5bG9hZCk7CiAgICByZXR1cm4gcmVjb3JkQXJyYXk7
CiAgfSwgbnVsbCwgIkRTOiBFeHRyYWN0IHBheWxvYWQgb2YgZmluZFF1ZXJ5ICIgKyB0eXBlKTsK
fQoKZnVuY3Rpb24gX2NvbW1pdChhZGFwdGVyLCBzdG9yZSwgb3BlcmF0aW9uLCByZWNvcmQpIHsK
ICB2YXIgdHlwZSA9IHJlY29yZC5jb25zdHJ1Y3RvciwKICAgICAgcHJvbWlzZSA9IGFkYXB0ZXJb
b3BlcmF0aW9uXShzdG9yZSwgdHlwZSwgcmVjb3JkKSwKICAgICAgc2VyaWFsaXplciA9IHNlcmlh
bGl6ZXJGb3JBZGFwdGVyKGFkYXB0ZXIsIHR5cGUpOwoKICBFbWJlci5hc3NlcnQoIllvdXIgYWRh
cHRlcidzICciICsgb3BlcmF0aW9uICsgIicgbWV0aG9kIG11c3QgcmV0dXJuIGEgcHJvbWlzZSwg
YnV0IGl0IHJldHVybmVkICIgKyBwcm9taXNlLCBpc1RoZW5hYmxlKHByb21pc2UpKTsKCiAgcmV0
dXJuIHByb21pc2UudGhlbihmdW5jdGlvbihwYXlsb2FkKSB7CiAgICBpZiAocGF5bG9hZCkgeyBw
YXlsb2FkID0gc2VyaWFsaXplci5leHRyYWN0KHN0b3JlLCB0eXBlLCBwYXlsb2FkLCBnZXQocmVj
b3JkLCAnaWQnKSwgb3BlcmF0aW9uKTsgfQogICAgc3RvcmUuZGlkU2F2ZVJlY29yZChyZWNvcmQs
IHBheWxvYWQpOwogICAgcmV0dXJuIHJlY29yZDsKICB9LCBmdW5jdGlvbihyZWFzb24pIHsKICAg
IGlmIChyZWFzb24gaW5zdGFuY2VvZiBEUy5JbnZhbGlkRXJyb3IpIHsKICAgICAgc3RvcmUucmVj
b3JkV2FzSW52YWxpZChyZWNvcmQsIHJlYXNvbi5lcnJvcnMpOwogICAgfSBlbHNlIHsKICAgICAg
c3RvcmUucmVjb3JkV2FzRXJyb3IocmVjb3JkLCByZWFzb24pOwogICAgfQoKICAgIHRocm93IHJl
YXNvbjsKICB9LCAiRFM6IEV4dHJhY3QgYW5kIG5vdGlmeSBhYm91dCAiICsgb3BlcmF0aW9uICsg
IiBjb21wbGV0aW9uIG9mICIgKyByZWNvcmQpOwp9Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8q
KgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1i
ZXIuc2V0OwovKgogIFRoaXMgZmlsZSBlbmNhcHN1bGF0ZXMgdGhlIHZhcmlvdXMgc3RhdGVzIHRo
YXQgYSByZWNvcmQgY2FuIHRyYW5zaXRpb24KICB0aHJvdWdoIGR1cmluZyBpdHMgbGlmZWN5Y2xl
LgoqLwovKioKICAjIyMgU3RhdGUKCiAgRWFjaCByZWNvcmQgaGFzIGEgYGN1cnJlbnRTdGF0ZWAg
cHJvcGVydHkgdGhhdCBleHBsaWNpdGx5IHRyYWNrcyB3aGF0CiAgc3RhdGUgYSByZWNvcmQgaXMg
aW4gYXQgYW55IGdpdmVuIHRpbWUuIEZvciBpbnN0YW5jZSwgaWYgYSByZWNvcmQgaXMKICBuZXds
eSBjcmVhdGVkIGFuZCBoYXMgbm90IHlldCBiZWVuIHNlbnQgdG8gdGhlIGFkYXB0ZXIgdG8gYmUg
c2F2ZWQsCiAgaXQgd291bGQgYmUgaW4gdGhlIGByb290LmxvYWRlZC5jcmVhdGVkLnVuY29tbWl0
dGVkYCBzdGF0ZS4gIElmIGEKICByZWNvcmQgaGFzIGhhZCBsb2NhbCBtb2RpZmljYXRpb25zIG1h
ZGUgdG8gaXQgdGhhdCBhcmUgaW4gdGhlCiAgcHJvY2VzcyBvZiBiZWluZyBzYXZlZCwgdGhlIHJl
Y29yZCB3b3VsZCBiZSBpbiB0aGUKICBgcm9vdC5sb2FkZWQudXBkYXRlZC5pbkZsaWdodGAgc3Rh
dGUuIChUaGVzZSBzdGF0ZSBwYXRocyB3aWxsIGJlCiAgZXhwbGFpbmVkIGluIG1vcmUgZGV0YWls
IGJlbG93LikKCiAgRXZlbnRzIGFyZSBzZW50IGJ5IHRoZSByZWNvcmQgb3IgaXRzIHN0b3JlIHRv
IHRoZSByZWNvcmQncwogIGBjdXJyZW50U3RhdGVgIHByb3BlcnR5LiBIb3cgdGhlIHN0YXRlIHJl
YWN0cyB0byB0aGVzZSBldmVudHMgaXMKICBkZXBlbmRlbnQgb24gd2hpY2ggc3RhdGUgaXQgaXMg
aW4uIEluIHNvbWUgc3RhdGVzLCBjZXJ0YWluIGV2ZW50cwogIHdpbGwgYmUgaW52YWxpZCBhbmQg
d2lsbCBjYXVzZSBhbiBleGNlcHRpb24gdG8gYmUgcmFpc2VkLgoKICBTdGF0ZXMgYXJlIGhpZXJh
cmNoaWNhbCBhbmQgZXZlcnkgc3RhdGUgaXMgYSBzdWJzdGF0ZSBvZiB0aGUKICBgUm9vdFN0YXRl
YC4gRm9yIGV4YW1wbGUsIGEgcmVjb3JkIGNhbiBiZSBpbiB0aGUKICBgcm9vdC5kZWxldGVkLnVu
Y29tbWl0dGVkYCBzdGF0ZSwgdGhlbiB0cmFuc2l0aW9uIGludG8gdGhlCiAgYHJvb3QuZGVsZXRl
ZC5pbkZsaWdodGAgc3RhdGUuIElmIGEgY2hpbGQgc3RhdGUgZG9lcyBub3QgaW1wbGVtZW50CiAg
YW4gZXZlbnQgaGFuZGxlciwgdGhlIHN0YXRlIG1hbmFnZXIgd2lsbCBhdHRlbXB0IHRvIGludm9r
ZSB0aGUgZXZlbnQKICBvbiBhbGwgcGFyZW50IHN0YXRlcyB1bnRpbCB0aGUgcm9vdCBzdGF0ZSBp
cyByZWFjaGVkLiBUaGUgc3RhdGUKICBoaWVyYXJjaHkgb2YgYSByZWNvcmQgaXMgZGVzY3JpYmVk
IGluIHRlcm1zIG9mIGEgcGF0aCBzdHJpbmcuIFlvdQogIGNhbiBkZXRlcm1pbmUgYSByZWNvcmQn
cyBjdXJyZW50IHN0YXRlIGJ5IGdldHRpbmcgdGhlIHN0YXRlJ3MKICBgc3RhdGVOYW1lYCBwcm9w
ZXJ0eToKCiAgYGBgamF2YXNjcmlwdAogIHJlY29yZC5nZXQoJ2N1cnJlbnRTdGF0ZS5zdGF0ZU5h
bWUnKTsKICAvLz0+ICJyb290LmNyZWF0ZWQudW5jb21taXR0ZWQiCiAgIGBgYAoKICBUaGUgaGll
cmFyY2h5IG9mIHZhbGlkIHN0YXRlcyB0aGF0IHNoaXAgd2l0aCBlbWJlciBkYXRhIGxvb2tzIGxp
a2UKICB0aGlzOgoKICBgYGB0ZXh0CiAgKiByb290CiAgICAqIGRlbGV0ZWQKICAgICAgKiBzYXZl
ZAogICAgICAqIHVuY29tbWl0dGVkCiAgICAgICogaW5GbGlnaHQKICAgICogZW1wdHkKICAgICog
bG9hZGVkCiAgICAgICogY3JlYXRlZAogICAgICAgICogdW5jb21taXR0ZWQKICAgICAgICAqIGlu
RmxpZ2h0CiAgICAgICogc2F2ZWQKICAgICAgKiB1cGRhdGVkCiAgICAgICAgKiB1bmNvbW1pdHRl
ZAogICAgICAgICogaW5GbGlnaHQKICAgICogbG9hZGluZwogIGBgYAoKICBUaGUgYERTLk1vZGVs
YCBzdGF0ZXMgYXJlIHRoZW1zZWx2ZXMgc3RhdGVsZXNzLiBXaGF0IHdlIG1lYW4gaXMKICB0aGF0
LCB0aGUgaGllcmFyY2hpY2FsIHN0YXRlcyB0aGF0IGVhY2ggb2YgKnRob3NlKiBwb2ludHMgdG8g
aXMgYQogIHNoYXJlZCBkYXRhIHN0cnVjdHVyZS4gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMsIGlu
c3RlYWQgb2YgZWFjaAogIHJlY29yZCBnZXR0aW5nIGl0cyBvd24gY29weSBvZiB0aGUgaGllcmFy
Y2h5IG9mIHN0YXRlcywgZWFjaCByZWNvcmQKICBwb2ludHMgdG8gdGhpcyBnbG9iYWwsIGltbXV0
YWJsZSBzaGFyZWQgaW5zdGFuY2UuIEhvdyBkb2VzIGEgc3RhdGUKICBrbm93IHdoaWNoIHJlY29y
ZCBpdCBzaG91bGQgYmUgYWN0aW5nIG9uPyBXZSBwYXNzIHRoZSByZWNvcmQKICBpbnN0YW5jZSBp
bnRvIHRoZSBzdGF0ZSdzIGV2ZW50IGhhbmRsZXJzIGFzIHRoZSBmaXJzdCBhcmd1bWVudC4KCiAg
VGhlIHJlY29yZCBwYXNzZWQgYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBpcyB3aGVyZSB5b3Ugc2hv
dWxkIHN0YXNoCiAgc3RhdGUgYWJvdXQgdGhlIHJlY29yZCBpZiBuZWVkZWQ7IHlvdSBzaG91bGQg
bmV2ZXIgc3RvcmUgZGF0YSBvbiB0aGUgc3RhdGUKICBvYmplY3QgaXRzZWxmLgoKICAjIyMgRXZl
bnRzIGFuZCBGbGFncwoKICBBIHN0YXRlIG1heSBpbXBsZW1lbnQgemVybyBvciBtb3JlIGV2ZW50
cyBhbmQgZmxhZ3MuCgogICMjIyMgRXZlbnRzCgogIEV2ZW50cyBhcmUgbmFtZWQgZnVuY3Rpb25z
IHRoYXQgYXJlIGludm9rZWQgd2hlbiBzZW50IHRvIGEgcmVjb3JkLiBUaGUKICByZWNvcmQgd2ls
bCBmaXJzdCBsb29rIGZvciBhIG1ldGhvZCB3aXRoIHRoZSBnaXZlbiBuYW1lIG9uIHRoZQogIGN1
cnJlbnQgc3RhdGUuIElmIG5vIG1ldGhvZCBpcyBmb3VuZCwgaXQgd2lsbCBzZWFyY2ggdGhlIGN1
cnJlbnQKICBzdGF0ZSdzIHBhcmVudCwgYW5kIHRoZW4gaXRzIGdyYW5kcGFyZW50LCBhbmQgc28g
b24gdW50aWwgcmVhY2hpbmcKICB0aGUgdG9wIG9mIHRoZSBoaWVyYXJjaHkuIElmIHRoZSByb290
IGlzIHJlYWNoZWQgd2l0aG91dCBhbiBldmVudAogIGhhbmRsZXIgYmVpbmcgZm91bmQsIGFuIGV4
Y2VwdGlvbiB3aWxsIGJlIHJhaXNlZC4gVGhpcyBjYW4gYmUgdmVyeQogIGhlbHBmdWwgd2hlbiBk
ZWJ1Z2dpbmcgbmV3IGZlYXR1cmVzLgoKICBIZXJlJ3MgYW4gZXhhbXBsZSBpbXBsZW1lbnRhdGlv
biBvZiBhIHN0YXRlIHdpdGggYSBgbXlFdmVudGAgZXZlbnQgaGFuZGxlcjoKCiAgYGBgamF2YXNj
cmlwdAogIGFTdGF0ZTogRFMuU3RhdGUuY3JlYXRlKHsKICAgIG15RXZlbnQ6IGZ1bmN0aW9uKG1h
bmFnZXIsIHBhcmFtKSB7CiAgICAgIGNvbnNvbGUubG9nKCJSZWNlaXZlZCBteUV2ZW50IHdpdGgi
LCBwYXJhbSk7CiAgICB9CiAgfSkKICBgYGAKCiAgVG8gdHJpZ2dlciB0aGlzIGV2ZW50OgoKICBg
YGBqYXZhc2NyaXB0CiAgcmVjb3JkLnNlbmQoJ215RXZlbnQnLCAnZm9vJyk7CiAgLy89PiAiUmVj
ZWl2ZWQgbXlFdmVudCB3aXRoIGZvbyIKICBgYGAKCiAgTm90ZSB0aGF0IGFuIG9wdGlvbmFsIHBh
cmFtZXRlciBjYW4gYmUgc2VudCB0byBhIHJlY29yZCdzIGBzZW5kKClgIG1ldGhvZCwKICB3aGlj
aCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB0byB0aGUgZXZlbnQgaGFu
ZGxlci4KCiAgRXZlbnRzIHNob3VsZCB0cmFuc2l0aW9uIHRvIGEgZGlmZmVyZW50IHN0YXRlIGlm
IGFwcHJvcHJpYXRlLiBUaGlzIGNhbiBiZQogIGRvbmUgYnkgY2FsbGluZyB0aGUgcmVjb3JkJ3Mg
YHRyYW5zaXRpb25UbygpYCBtZXRob2Qgd2l0aCBhIHBhdGggdG8gdGhlCiAgZGVzaXJlZCBzdGF0
ZS4gVGhlIHN0YXRlIG1hbmFnZXIgd2lsbCBhdHRlbXB0IHRvIHJlc29sdmUgdGhlIHN0YXRlIHBh
dGgKICByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBzdGF0ZS4gSWYgbm8gc3RhdGUgaXMgZm91bmQg
YXQgdGhhdCBwYXRoLCBpdCB3aWxsCiAgYXR0ZW1wdCB0byByZXNvbHZlIGl0IHJlbGF0aXZlIHRv
IHRoZSBjdXJyZW50IHN0YXRlJ3MgcGFyZW50LCBhbmQgdGhlbiBpdHMKICBwYXJlbnQsIGFuZCBz
byBvbiB1bnRpbCB0aGUgcm9vdCBpcyByZWFjaGVkLiBGb3IgZXhhbXBsZSwgaW1hZ2luZSBhIGhp
ZXJhcmNoeQogIGxpa2UgdGhpczoKCiAgICAgICogY3JlYXRlZAogICAgICAgICogdW5jb21taXR0
ZWQgPC0tIGN1cnJlbnRTdGF0ZQogICAgICAgICogaW5GbGlnaHQKICAgICAgKiB1cGRhdGVkCiAg
ICAgICAgKiBpbkZsaWdodAoKICBJZiB3ZSBhcmUgY3VycmVudGx5IGluIHRoZSBgdW5jb21taXR0
ZWRgIHN0YXRlLCBjYWxsaW5nCiAgYHRyYW5zaXRpb25UbygnaW5GbGlnaHQnKWAgd291bGQgdHJh
bnNpdGlvbiB0byB0aGUgYGNyZWF0ZWQuaW5GbGlnaHRgIHN0YXRlLAogIHdoaWxlIGNhbGxpbmcg
YHRyYW5zaXRpb25UbygndXBkYXRlZC5pbkZsaWdodCcpYCB3b3VsZCB0cmFuc2l0aW9uIHRvCiAg
dGhlIGB1cGRhdGVkLmluRmxpZ2h0YCBzdGF0ZS4KCiAgUmVtZW1iZXIgdGhhdCAqb25seSBldmVu
dHMqIHNob3VsZCBldmVyIGNhdXNlIGEgc3RhdGUgdHJhbnNpdGlvbi4gWW91IHNob3VsZAogIG5l
dmVyIGNhbGwgYHRyYW5zaXRpb25UbygpYCBmcm9tIG91dHNpZGUgYSBzdGF0ZSdzIGV2ZW50IGhh
bmRsZXIuIElmIHlvdSBhcmUKICB0ZW1wdGVkIHRvIGRvIHNvLCBjcmVhdGUgYSBuZXcgZXZlbnQg
YW5kIHNlbmQgdGhhdCB0byB0aGUgc3RhdGUgbWFuYWdlci4KCiAgIyMjIyBGbGFncwoKICBGbGFn
cyBhcmUgQm9vbGVhbiB2YWx1ZXMgdGhhdCBjYW4gYmUgdXNlZCB0byBpbnRyb3NwZWN0IGEgcmVj
b3JkJ3MgY3VycmVudAogIHN0YXRlIGluIGEgbW9yZSB1c2VyLWZyaWVuZGx5IHdheSB0aGFuIGV4
YW1pbmluZyBpdHMgc3RhdGUgcGF0aC4gRm9yIGV4YW1wbGUsCiAgaW5zdGVhZCBvZiBkb2luZyB0
aGlzOgoKICBgYGBqYXZhc2NyaXB0CiAgdmFyIHN0YXRlUGF0aCA9IHJlY29yZC5nZXQoJ3N0YXRl
TWFuYWdlci5jdXJyZW50UGF0aCcpOwogIGlmIChzdGF0ZVBhdGggPT09ICdjcmVhdGVkLmluRmxp
Z2h0JykgewogICAgZG9Tb21ldGhpbmcoKTsKICB9CiAgYGBgCgogIFlvdSBjYW4gc2F5OgoKICBg
YGBqYXZhc2NyaXB0CiAgaWYgKHJlY29yZC5nZXQoJ2lzTmV3JykgJiYgcmVjb3JkLmdldCgnaXNT
YXZpbmcnKSkgewogICAgZG9Tb21ldGhpbmcoKTsKICB9CiAgYGBgCgogIElmIHlvdXIgc3RhdGUg
ZG9lcyBub3Qgc2V0IGEgdmFsdWUgZm9yIGEgZ2l2ZW4gZmxhZywgdGhlIHZhbHVlIHdpbGwKICBi
ZSBpbmhlcml0ZWQgZnJvbSBpdHMgcGFyZW50IChvciB0aGUgZmlyc3QgcGxhY2UgaW4gdGhlIHN0
YXRlIGhpZXJhcmNoeQogIHdoZXJlIGl0IGlzIGRlZmluZWQpLgoKICBUaGUgY3VycmVudCBzZXQg
b2YgZmxhZ3MgYXJlIGRlZmluZWQgYmVsb3cuIElmIHlvdSB3YW50IHRvIGFkZCBhIG5ldyBmbGFn
LAogIGluIGFkZGl0aW9uIHRvIHRoZSBhcmVhIGJlbG93LCB5b3Ugd2lsbCBhbHNvIG5lZWQgdG8g
ZGVjbGFyZSBpdCBpbiB0aGUKICBgRFMuTW9kZWxgIGNsYXNzLgoKCiAgICogW2lzRW1wdHldKERT
Lk1vZGVsLmh0bWwjcHJvcGVydHlfaXNFbXB0eSkKICAgKiBbaXNMb2FkaW5nXShEUy5Nb2RlbC5o
dG1sI3Byb3BlcnR5X2lzTG9hZGluZykKICAgKiBbaXNMb2FkZWRdKERTLk1vZGVsLmh0bWwjcHJv
cGVydHlfaXNMb2FkZWQpCiAgICogW2lzRGlydHldKERTLk1vZGVsLmh0bWwjcHJvcGVydHlfaXNE
aXJ0eSkKICAgKiBbaXNTYXZpbmddKERTLk1vZGVsLmh0bWwjcHJvcGVydHlfaXNTYXZpbmcpCiAg
ICogW2lzRGVsZXRlZF0oRFMuTW9kZWwuaHRtbCNwcm9wZXJ0eV9pc0RlbGV0ZWQpCiAgICogW2lz
TmV3XShEUy5Nb2RlbC5odG1sI3Byb3BlcnR5X2lzTmV3KQogICAqIFtpc1ZhbGlkXShEUy5Nb2Rl
bC5odG1sI3Byb3BlcnR5X2lzVmFsaWQpCgogIEBuYW1lc3BhY2UgRFMKICBAY2xhc3MgUm9vdFN0
YXRlCiovCgp2YXIgaGFzRGVmaW5lZFByb3BlcnRpZXMgPSBmdW5jdGlvbihvYmplY3QpIHsKICAv
LyBJZ25vcmUgaW50ZXJuYWwgcHJvcGVydHkgZGVmaW5lZCBieSBzaW11bGF0ZWQgYEVtYmVyLmNy
ZWF0ZWAuCiAgdmFyIG5hbWVzID0gRW1iZXIua2V5cyhvYmplY3QpOwogIHZhciBpLCBsLCBuYW1l
OwogIGZvciAoaSA9IDAsIGwgPSBuYW1lcy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CiAgICBuYW1l
ID0gbmFtZXNbaV07CiAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KG5hbWUpICYmIG9iamVj
dFtuYW1lXSkgeyByZXR1cm4gdHJ1ZTsgfQogIH0KCiAgcmV0dXJuIGZhbHNlOwp9OwoKdmFyIGRp
ZFNldFByb3BlcnR5ID0gZnVuY3Rpb24ocmVjb3JkLCBjb250ZXh0KSB7CiAgaWYgKGNvbnRleHQu
dmFsdWUgPT09IGNvbnRleHQub3JpZ2luYWxWYWx1ZSkgewogICAgZGVsZXRlIHJlY29yZC5fYXR0
cmlidXRlc1tjb250ZXh0Lm5hbWVdOwogICAgcmVjb3JkLnNlbmQoJ3Byb3BlcnR5V2FzUmVzZXQn
LCBjb250ZXh0Lm5hbWUpOwogIH0gZWxzZSBpZiAoY29udGV4dC52YWx1ZSAhPT0gY29udGV4dC5v
bGRWYWx1ZSkgewogICAgcmVjb3JkLnNlbmQoJ2JlY29tZURpcnR5Jyk7CiAgfQoKICByZWNvcmQu
dXBkYXRlUmVjb3JkQXJyYXlzTGF0ZXIoKTsKfTsKCi8vIEltcGxlbWVudGF0aW9uIG5vdGVzOgov
LwovLyBFYWNoIHN0YXRlIGhhcyBhIGJvb2xlYW4gdmFsdWUgZm9yIGFsbCBvZiB0aGUgZm9sbG93
aW5nIGZsYWdzOgovLwovLyAqIGlzTG9hZGVkOiBUaGUgcmVjb3JkIGhhcyBhIHBvcHVsYXRlZCBg
ZGF0YWAgcHJvcGVydHkuIFdoZW4gYQovLyAgIHJlY29yZCBpcyBsb2FkZWQgdmlhIGBzdG9yZS5m
aW5kYCwgYGlzTG9hZGVkYCBpcyBmYWxzZQovLyAgIHVudGlsIHRoZSBhZGFwdGVyIHNldHMgaXQu
IFdoZW4gYSByZWNvcmQgaXMgY3JlYXRlZCBsb2NhbGx5LAovLyAgIGl0cyBgaXNMb2FkZWRgIHBy
b3BlcnR5IGlzIGFsd2F5cyB0cnVlLgovLyAqIGlzRGlydHk6IFRoZSByZWNvcmQgaGFzIGxvY2Fs
IGNoYW5nZXMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbgovLyAgIHNhdmVkIGJ5IHRoZSBhZGFwdGVy
LiBUaGlzIGluY2x1ZGVzIHJlY29yZHMgdGhhdCBoYXZlIGJlZW4KLy8gICBjcmVhdGVkIChidXQg
bm90IHlldCBzYXZlZCkgb3IgZGVsZXRlZC4KLy8gKiBpc1NhdmluZzogVGhlIHJlY29yZCBoYXMg
YmVlbiBjb21taXR0ZWQsIGJ1dAovLyAgIHRoZSBhZGFwdGVyIGhhcyBub3QgeWV0IGFja25vd2xl
ZGdlZCB0aGF0IHRoZSBjaGFuZ2VzIGhhdmUKLy8gICBiZWVuIHBlcnNpc3RlZCB0byB0aGUgYmFj
a2VuZC4KLy8gKiBpc0RlbGV0ZWQ6IFRoZSByZWNvcmQgd2FzIG1hcmtlZCBmb3IgZGVsZXRpb24u
IFdoZW4gYGlzRGVsZXRlZGAKLy8gICBpcyB0cnVlIGFuZCBgaXNEaXJ0eWAgaXMgdHJ1ZSwgdGhl
IHJlY29yZCBpcyBkZWxldGVkIGxvY2FsbHkKLy8gICBidXQgdGhlIGRlbGV0aW9uIHdhcyBub3Qg
eWV0IHBlcnNpc3RlZC4gV2hlbiBgaXNTYXZpbmdgIGlzCi8vICAgdHJ1ZSwgdGhlIGNoYW5nZSBp
cyBpbi1mbGlnaHQuIFdoZW4gYm90aCBgaXNEaXJ0eWAgYW5kCi8vICAgYGlzU2F2aW5nYCBhcmUg
ZmFsc2UsIHRoZSBjaGFuZ2UgaGFzIHBlcnNpc3RlZC4KLy8gKiBpc0Vycm9yOiBUaGUgYWRhcHRl
ciByZXBvcnRlZCB0aGF0IGl0IHdhcyB1bmFibGUgdG8gc2F2ZQovLyAgIGxvY2FsIGNoYW5nZXMg
dG8gdGhlIGJhY2tlbmQuIFRoaXMgbWF5IGFsc28gcmVzdWx0IGluIHRoZQovLyAgIHJlY29yZCBo
YXZpbmcgaXRzIGBpc1ZhbGlkYCBwcm9wZXJ0eSBiZWNvbWUgZmFsc2UgaWYgdGhlCi8vICAgYWRh
cHRlciByZXBvcnRlZCB0aGF0IHNlcnZlci1zaWRlIHZhbGlkYXRpb25zIGZhaWxlZC4KLy8gKiBp
c05ldzogVGhlIHJlY29yZCB3YXMgY3JlYXRlZCBvbiB0aGUgY2xpZW50IGFuZCB0aGUgYWRhcHRl
cgovLyAgIGRpZCBub3QgeWV0IHJlcG9ydCB0aGF0IGl0IHdhcyBzdWNjZXNzZnVsbHkgc2F2ZWQu
Ci8vICogaXNWYWxpZDogTm8gY2xpZW50LXNpZGUgdmFsaWRhdGlvbnMgaGF2ZSBmYWlsZWQgYW5k
IHRoZQovLyAgIGFkYXB0ZXIgZGlkIG5vdCByZXBvcnQgYW55IHNlcnZlci1zaWRlIHZhbGlkYXRp
b24gZmFpbHVyZXMuCgovLyBUaGUgZGlydHkgc3RhdGUgaXMgYSBhYnN0cmFjdCBzdGF0ZSB3aG9z
ZSBmdW5jdGlvbmFsaXR5IGlzCi8vIHNoYXJlZCBiZXR3ZWVuIHRoZSBgY3JlYXRlZGAgYW5kIGB1
cGRhdGVkYCBzdGF0ZXMuCi8vCi8vIFRoZSBkZWxldGVkIHN0YXRlIHNoYXJlcyB0aGUgYGlzRGly
dHlgIGZsYWcgd2l0aCB0aGUKLy8gc3ViY2xhc3NlcyBvZiBgRGlydHlTdGF0ZWAsIGJ1dCB3aXRo
IGEgdmVyeSBkaWZmZXJlbnQKLy8gaW1wbGVtZW50YXRpb24uCi8vCi8vIERpcnR5IHN0YXRlcyBo
YXZlIHRocmVlIGNoaWxkIHN0YXRlczoKLy8KLy8gYHVuY29tbWl0dGVkYDogdGhlIHN0b3JlIGhh
cyBub3QgeWV0IGhhbmRlZCBvZmYgdGhlIHJlY29yZAovLyAgIHRvIGJlIHNhdmVkLgovLyBgaW5G
bGlnaHRgOiB0aGUgc3RvcmUgaGFzIGhhbmRlZCBvZmYgdGhlIHJlY29yZCB0byBiZSBzYXZlZCwK
Ly8gICBidXQgdGhlIGFkYXB0ZXIgaGFzIG5vdCB5ZXQgYWNrbm93bGVkZ2VkIHN1Y2Nlc3MuCi8v
IGBpbnZhbGlkYDogdGhlIHJlY29yZCBoYXMgaW52YWxpZCBpbmZvcm1hdGlvbiBhbmQgY2Fubm90
IGJlCi8vICAgc2VuZCB0byB0aGUgYWRhcHRlciB5ZXQuCnZhciBEaXJ0eVN0YXRlID0gewogIGlu
aXRpYWxTdGF0ZTogJ3VuY29tbWl0dGVkJywKCiAgLy8gRkxBR1MKICBpc0RpcnR5OiB0cnVlLAoK
ICAvLyBTVUJTVEFURVMKCiAgLy8gV2hlbiBhIHJlY29yZCBmaXJzdCBiZWNvbWVzIGRpcnR5LCBp
dCBpcyBgdW5jb21taXR0ZWRgLgogIC8vIFRoaXMgbWVhbnMgdGhhdCB0aGVyZSBhcmUgbG9jYWwg
cGVuZGluZyBjaGFuZ2VzLCBidXQgdGhleQogIC8vIGhhdmUgbm90IHlldCBiZWd1biB0byBiZSBz
YXZlZCwgYW5kIGFyZSBub3QgaW52YWxpZC4KICB1bmNvbW1pdHRlZDogewogICAgLy8gRVZFTlRT
CiAgICBkaWRTZXRQcm9wZXJ0eTogZGlkU2V0UHJvcGVydHksCgogICAgcHJvcGVydHlXYXNSZXNl
dDogZnVuY3Rpb24ocmVjb3JkLCBuYW1lKSB7CiAgICAgIHZhciBzdGlsbERpcnR5ID0gZmFsc2U7
CgogICAgICBmb3IgKHZhciBwcm9wIGluIHJlY29yZC5fYXR0cmlidXRlcykgewogICAgICAgIHN0
aWxsRGlydHkgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBpZiAoIXN0aWxs
RGlydHkpIHsgcmVjb3JkLnNlbmQoJ3JvbGxlZEJhY2snKTsgfQogICAgfSwKCiAgICBwdXNoZWRE
YXRhOiBFbWJlci5LLAoKICAgIGJlY29tZURpcnR5OiBFbWJlci5LLAoKICAgIHdpbGxDb21taXQ6
IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICByZWNvcmQudHJhbnNpdGlvblRvKCdpbkZsaWdodCcp
OwogICAgfSwKCiAgICByZWxvYWRSZWNvcmQ6IGZ1bmN0aW9uKHJlY29yZCwgcmVzb2x2ZSkgewog
ICAgICByZXNvbHZlKGdldChyZWNvcmQsICdzdG9yZScpLnJlbG9hZFJlY29yZChyZWNvcmQpKTsK
ICAgIH0sCgogICAgcm9sbGVkQmFjazogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC50
cmFuc2l0aW9uVG8oJ2xvYWRlZC5zYXZlZCcpOwogICAgfSwKCiAgICBiZWNhbWVJbnZhbGlkOiBm
dW5jdGlvbihyZWNvcmQpIHsKICAgICAgcmVjb3JkLnRyYW5zaXRpb25UbygnaW52YWxpZCcpOwog
ICAgfSwKCiAgICByb2xsYmFjazogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC5yb2xs
YmFjaygpOwogICAgfQogIH0sCgogIC8vIE9uY2UgYSByZWNvcmQgaGFzIGJlZW4gaGFuZGVkIG9m
ZiB0byB0aGUgYWRhcHRlciB0byBiZQogIC8vIHNhdmVkLCBpdCBpcyBpbiB0aGUgJ2luIGZsaWdo
dCcgc3RhdGUuIENoYW5nZXMgdG8gdGhlCiAgLy8gcmVjb3JkIGNhbm5vdCBiZSBtYWRlIGR1cmlu
ZyB0aGlzIHdpbmRvdy4KICBpbkZsaWdodDogewogICAgLy8gRkxBR1MKICAgIGlzU2F2aW5nOiB0
cnVlLAoKICAgIC8vIEVWRU5UUwogICAgZGlkU2V0UHJvcGVydHk6IGRpZFNldFByb3BlcnR5LAog
ICAgYmVjb21lRGlydHk6IEVtYmVyLkssCiAgICBwdXNoZWREYXRhOiBFbWJlci5LLAoKICAgIC8v
IFRPRE86IE1vcmUgcm9idXN0IHNlbWFudGljcyBhcm91bmQgc2F2ZS13aGlsZS1pbi1mbGlnaHQK
ICAgIHdpbGxDb21taXQ6IEVtYmVyLkssCgogICAgZGlkQ29tbWl0OiBmdW5jdGlvbihyZWNvcmQp
IHsKICAgICAgdmFyIGRpcnR5VHlwZSA9IGdldCh0aGlzLCAnZGlydHlUeXBlJyk7CgogICAgICBy
ZWNvcmQudHJhbnNpdGlvblRvKCdzYXZlZCcpOwogICAgICByZWNvcmQuc2VuZCgnaW52b2tlTGlm
ZWN5Y2xlQ2FsbGJhY2tzJywgZGlydHlUeXBlKTsKICAgIH0sCgogICAgYmVjYW1lSW52YWxpZDog
ZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC50cmFuc2l0aW9uVG8oJ2ludmFsaWQnKTsK
ICAgICAgcmVjb3JkLnNlbmQoJ2ludm9rZUxpZmVjeWNsZUNhbGxiYWNrcycpOwogICAgfSwKCiAg
ICBiZWNhbWVFcnJvcjogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC50cmFuc2l0aW9u
VG8oJ3VuY29tbWl0dGVkJyk7CiAgICAgIHJlY29yZC50cmlnZ2VyTGF0ZXIoJ2JlY2FtZUVycm9y
JywgcmVjb3JkKTsKICAgIH0KICB9LAoKICAvLyBBIHJlY29yZCBpcyBpbiB0aGUgYGludmFsaWRg
IHN0YXRlIHdoZW4gaXRzIGNsaWVudC1zaWRlCiAgLy8gaW52YWxpZGF0aW9ucyBoYXZlIGZhaWxl
ZCwgb3IgaWYgdGhlIGFkYXB0ZXIgaGFzIGluZGljYXRlZAogIC8vIHRoZSB0aGUgcmVjb3JkIGZh
aWxlZCBzZXJ2ZXItc2lkZSBpbnZhbGlkYXRpb25zLgogIGludmFsaWQ6IHsKICAgIC8vIEZMQUdT
CiAgICBpc1ZhbGlkOiBmYWxzZSwKCiAgICAvLyBFVkVOVFMKICAgIGRlbGV0ZVJlY29yZDogZnVu
Y3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC50cmFuc2l0aW9uVG8oJ2RlbGV0ZWQudW5jb21t
aXR0ZWQnKTsKICAgICAgcmVjb3JkLmNsZWFyUmVsYXRpb25zaGlwcygpOwogICAgfSwKCiAgICBk
aWRTZXRQcm9wZXJ0eTogZnVuY3Rpb24ocmVjb3JkLCBjb250ZXh0KSB7CiAgICAgIGdldChyZWNv
cmQsICdlcnJvcnMnKS5yZW1vdmUoY29udGV4dC5uYW1lKTsKCiAgICAgIGRpZFNldFByb3BlcnR5
KHJlY29yZCwgY29udGV4dCk7CiAgICB9LAoKICAgIGJlY29tZURpcnR5OiBFbWJlci5LLAoKICAg
IHJvbGxlZEJhY2s6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICBnZXQocmVjb3JkLCAnZXJyb3Jz
JykuY2xlYXIoKTsKICAgIH0sCgogICAgYmVjYW1lVmFsaWQ6IGZ1bmN0aW9uKHJlY29yZCkgewog
ICAgICByZWNvcmQudHJhbnNpdGlvblRvKCd1bmNvbW1pdHRlZCcpOwogICAgfSwKCiAgICBpbnZv
a2VMaWZlY3ljbGVDYWxsYmFja3M6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICByZWNvcmQudHJp
Z2dlckxhdGVyKCdiZWNhbWVJbnZhbGlkJywgcmVjb3JkKTsKICAgIH0KICB9Cn07CgovLyBUaGUg
Y3JlYXRlZCBhbmQgdXBkYXRlZCBzdGF0ZXMgYXJlIGNyZWF0ZWQgb3V0c2lkZSB0aGUgc3RhdGUK
Ly8gY2hhcnQgc28gd2UgY2FuIHJlb3BlbiB0aGVpciBzdWJzdGF0ZXMgYW5kIGFkZCBtaXhpbnMg
YXMKLy8gbmVjZXNzYXJ5LgoKZnVuY3Rpb24gZGVlcENsb25lKG9iamVjdCkgewogIHZhciBjbG9u
ZSA9IHt9LCB2YWx1ZTsKCiAgZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHsKICAgIHZhbHVlID0g
b2JqZWN0W3Byb3BdOwogICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcp
IHsKICAgICAgY2xvbmVbcHJvcF0gPSBkZWVwQ2xvbmUodmFsdWUpOwogICAgfSBlbHNlIHsKICAg
ICAgY2xvbmVbcHJvcF0gPSB2YWx1ZTsKICAgIH0KICB9CgogIHJldHVybiBjbG9uZTsKfQoKZnVu
Y3Rpb24gbWl4aW4ob3JpZ2luYWwsIGhhc2gpIHsKICBmb3IgKHZhciBwcm9wIGluIGhhc2gpIHsK
ICAgIG9yaWdpbmFsW3Byb3BdID0gaGFzaFtwcm9wXTsKICB9CgogIHJldHVybiBvcmlnaW5hbDsK
fQoKZnVuY3Rpb24gZGlydHlTdGF0ZShvcHRpb25zKSB7CiAgdmFyIG5ld1N0YXRlID0gZGVlcENs
b25lKERpcnR5U3RhdGUpOwogIHJldHVybiBtaXhpbihuZXdTdGF0ZSwgb3B0aW9ucyk7Cn0KCnZh
ciBjcmVhdGVkU3RhdGUgPSBkaXJ0eVN0YXRlKHsKICBkaXJ0eVR5cGU6ICdjcmVhdGVkJywKCiAg
Ly8gRkxBR1MKICBpc05ldzogdHJ1ZQp9KTsKCmNyZWF0ZWRTdGF0ZS51bmNvbW1pdHRlZC5yb2xs
ZWRCYWNrID0gZnVuY3Rpb24ocmVjb3JkKSB7CiAgcmVjb3JkLnRyYW5zaXRpb25UbygnZGVsZXRl
ZC5zYXZlZCcpOwp9OwoKdmFyIHVwZGF0ZWRTdGF0ZSA9IGRpcnR5U3RhdGUoewogIGRpcnR5VHlw
ZTogJ3VwZGF0ZWQnCn0pOwoKY3JlYXRlZFN0YXRlLnVuY29tbWl0dGVkLmRlbGV0ZVJlY29yZCA9
IGZ1bmN0aW9uKHJlY29yZCkgewogIHJlY29yZC5jbGVhclJlbGF0aW9uc2hpcHMoKTsKICByZWNv
cmQudHJhbnNpdGlvblRvKCdkZWxldGVkLnNhdmVkJyk7Cn07CgpjcmVhdGVkU3RhdGUudW5jb21t
aXR0ZWQucm9sbGJhY2sgPSBmdW5jdGlvbihyZWNvcmQpIHsKICBEaXJ0eVN0YXRlLnVuY29tbWl0
dGVkLnJvbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgcmVjb3JkLnRyYW5zaXRpb25U
bygnZGVsZXRlZC5zYXZlZCcpOwp9OwoKdXBkYXRlZFN0YXRlLnVuY29tbWl0dGVkLmRlbGV0ZVJl
Y29yZCA9IGZ1bmN0aW9uKHJlY29yZCkgewogIHJlY29yZC50cmFuc2l0aW9uVG8oJ2RlbGV0ZWQu
dW5jb21taXR0ZWQnKTsKICByZWNvcmQuY2xlYXJSZWxhdGlvbnNoaXBzKCk7Cn07Cgp2YXIgUm9v
dFN0YXRlID0gewogIC8vIEZMQUdTCiAgaXNFbXB0eTogZmFsc2UsCiAgaXNMb2FkaW5nOiBmYWxz
ZSwKICBpc0xvYWRlZDogZmFsc2UsCiAgaXNEaXJ0eTogZmFsc2UsCiAgaXNTYXZpbmc6IGZhbHNl
LAogIGlzRGVsZXRlZDogZmFsc2UsCiAgaXNOZXc6IGZhbHNlLAogIGlzVmFsaWQ6IHRydWUsCgog
IC8vIERFRkFVTFQgRVZFTlRTCgogIC8vIFRyeWluZyB0byByb2xsIGJhY2sgaWYgeW91J3JlIG5v
dCBpbiB0aGUgZGlydHkgc3RhdGUKICAvLyBkb2Vzbid0IGNoYW5nZSB5b3VyIHN0YXRlLiBGb3Ig
ZXhhbXBsZSwgaWYgeW91J3JlIGluIHRoZQogIC8vIGluLWZsaWdodCBzdGF0ZSwgcm9sbGluZyBi
YWNrIHRoZSByZWNvcmQgZG9lc24ndCBtb3ZlCiAgLy8geW91IG91dCBvZiB0aGUgaW4tZmxpZ2h0
IHN0YXRlLgogIHJvbGxlZEJhY2s6IEVtYmVyLkssCgogIHByb3BlcnR5V2FzUmVzZXQ6IEVtYmVy
LkssCgogIC8vIFNVQlNUQVRFUwoKICAvLyBBIHJlY29yZCBiZWdpbnMgaXRzIGxpZmVjeWNsZSBp
biB0aGUgYGVtcHR5YCBzdGF0ZS4KICAvLyBJZiBpdHMgZGF0YSB3aWxsIGNvbWUgZnJvbSB0aGUg
YWRhcHRlciwgaXQgd2lsbAogIC8vIHRyYW5zaXRpb24gaW50byB0aGUgYGxvYWRpbmdgIHN0YXRl
LiBPdGhlcndpc2UsIGlmCiAgLy8gdGhlIHJlY29yZCBpcyBiZWluZyBjcmVhdGVkIG9uIHRoZSBj
bGllbnQsIGl0IHdpbGwKICAvLyB0cmFuc2l0aW9uIGludG8gdGhlIGBjcmVhdGVkYCBzdGF0ZS4K
ICBlbXB0eTogewogICAgaXNFbXB0eTogdHJ1ZSwKCiAgICAvLyBFVkVOVFMKICAgIGxvYWRpbmdE
YXRhOiBmdW5jdGlvbihyZWNvcmQsIHByb21pc2UpIHsKICAgICAgcmVjb3JkLl9sb2FkaW5nUHJv
bWlzZSA9IHByb21pc2U7CiAgICAgIHJlY29yZC50cmFuc2l0aW9uVG8oJ2xvYWRpbmcnKTsKICAg
IH0sCgogICAgbG9hZGVkRGF0YTogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC50cmFu
c2l0aW9uVG8oJ2xvYWRlZC5jcmVhdGVkLnVuY29tbWl0dGVkJyk7CgogICAgICByZWNvcmQuc3Vz
cGVuZFJlbGF0aW9uc2hpcE9ic2VydmVycyhmdW5jdGlvbigpIHsKICAgICAgICByZWNvcmQubm90
aWZ5UHJvcGVydHlDaGFuZ2UoJ2RhdGEnKTsKICAgICAgfSk7CiAgICB9LAoKICAgIHB1c2hlZERh
dGE6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICByZWNvcmQudHJhbnNpdGlvblRvKCdsb2FkZWQu
c2F2ZWQnKTsKICAgICAgcmVjb3JkLnRyaWdnZXJMYXRlcignZGlkTG9hZCcpOwogICAgfQogIH0s
CgogIC8vIEEgcmVjb3JkIGVudGVycyB0aGlzIHN0YXRlIHdoZW4gdGhlIHN0b3JlIGFza2VzCiAg
Ly8gdGhlIGFkYXB0ZXIgZm9yIGl0cyBkYXRhLiBJdCByZW1haW5zIGluIHRoaXMgc3RhdGUKICAv
LyB1bnRpbCB0aGUgYWRhcHRlciBwcm92aWRlcyB0aGUgcmVxdWVzdGVkIGRhdGEuCiAgLy8KICAv
LyBVc3VhbGx5LCB0aGlzIHByb2Nlc3MgaXMgYXN5bmNocm9ub3VzLCB1c2luZyBhbgogIC8vIFhI
UiB0byByZXRyaWV2ZSB0aGUgZGF0YS4KICBsb2FkaW5nOiB7CiAgICAvLyBGTEFHUwogICAgaXNM
b2FkaW5nOiB0cnVlLAoKICAgIGV4aXQ6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICByZWNvcmQu
X2xvYWRpbmdQcm9taXNlID0gbnVsbDsKICAgIH0sCgogICAgLy8gRVZFTlRTCiAgICBwdXNoZWRE
YXRhOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAgcmVjb3JkLnRyYW5zaXRpb25UbygnbG9hZGVk
LnNhdmVkJyk7CiAgICAgIHJlY29yZC50cmlnZ2VyTGF0ZXIoJ2RpZExvYWQnKTsKICAgICAgc2V0
KHJlY29yZCwgJ2lzRXJyb3InLCBmYWxzZSk7CiAgICB9LAoKICAgIGJlY2FtZUVycm9yOiBmdW5j
dGlvbihyZWNvcmQpIHsKICAgICAgcmVjb3JkLnRyaWdnZXJMYXRlcignYmVjYW1lRXJyb3InLCBy
ZWNvcmQpOwogICAgfSwKCiAgICBub3RGb3VuZDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgIHJl
Y29yZC50cmFuc2l0aW9uVG8oJ2VtcHR5Jyk7CiAgICB9CiAgfSwKCiAgLy8gQSByZWNvcmQgZW50
ZXJzIHRoaXMgc3RhdGUgd2hlbiBpdHMgZGF0YSBpcyBwb3B1bGF0ZWQuCiAgLy8gTW9zdCBvZiBh
IHJlY29yZCdzIGxpZmVjeWNsZSBpcyBzcGVudCBpbnNpZGUgc3Vic3RhdGVzCiAgLy8gb2YgdGhl
IGBsb2FkZWRgIHN0YXRlLgogIGxvYWRlZDogewogICAgaW5pdGlhbFN0YXRlOiAnc2F2ZWQnLAoK
ICAgIC8vIEZMQUdTCiAgICBpc0xvYWRlZDogdHJ1ZSwKCiAgICAvLyBTVUJTVEFURVMKCiAgICAv
LyBJZiB0aGVyZSBhcmUgbm8gbG9jYWwgY2hhbmdlcyB0byBhIHJlY29yZCwgaXQgcmVtYWlucwog
ICAgLy8gaW4gdGhlIGBzYXZlZGAgc3RhdGUuCiAgICBzYXZlZDogewogICAgICBzZXR1cDogZnVu
Y3Rpb24ocmVjb3JkKSB7CiAgICAgICAgdmFyIGF0dHJzID0gcmVjb3JkLl9hdHRyaWJ1dGVzLAog
ICAgICAgICAgICBpc0RpcnR5ID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIHByb3AgaW4gYXR0
cnMpIHsKICAgICAgICAgIGlmIChhdHRycy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAg
ICAgICBpc0RpcnR5ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAg
ICAgfQoKICAgICAgICBpZiAoaXNEaXJ0eSkgewogICAgICAgICAgcmVjb3JkLmFkYXB0ZXJEaWRE
aXJ0eSgpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8vIEVWRU5UUwogICAgICBkaWRTZXRQ
cm9wZXJ0eTogZGlkU2V0UHJvcGVydHksCgogICAgICBwdXNoZWREYXRhOiBFbWJlci5LLAoKICAg
ICAgYmVjb21lRGlydHk6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgIHJlY29yZC50cmFuc2l0
aW9uVG8oJ3VwZGF0ZWQudW5jb21taXR0ZWQnKTsKICAgICAgfSwKCiAgICAgIHdpbGxDb21taXQ6
IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgIHJlY29yZC50cmFuc2l0aW9uVG8oJ3VwZGF0ZWQu
aW5GbGlnaHQnKTsKICAgICAgfSwKCiAgICAgIHJlbG9hZFJlY29yZDogZnVuY3Rpb24ocmVjb3Jk
LCByZXNvbHZlKSB7CiAgICAgICAgcmVzb2x2ZShnZXQocmVjb3JkLCAnc3RvcmUnKS5yZWxvYWRS
ZWNvcmQocmVjb3JkKSk7CiAgICAgIH0sCgogICAgICBkZWxldGVSZWNvcmQ6IGZ1bmN0aW9uKHJl
Y29yZCkgewogICAgICAgIHJlY29yZC50cmFuc2l0aW9uVG8oJ2RlbGV0ZWQudW5jb21taXR0ZWQn
KTsKICAgICAgICByZWNvcmQuY2xlYXJSZWxhdGlvbnNoaXBzKCk7CiAgICAgIH0sCgogICAgICB1
bmxvYWRSZWNvcmQ6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgIC8vIGNsZWFyIHJlbGF0aW9u
c2hpcHMgYmVmb3JlIG1vdmluZyB0byBkZWxldGVkIHN0YXRlCiAgICAgICAgLy8gb3RoZXJ3aXNl
IGl0IGZhaWxzCiAgICAgICAgcmVjb3JkLmNsZWFyUmVsYXRpb25zaGlwcygpOwogICAgICAgIHJl
Y29yZC50cmFuc2l0aW9uVG8oJ2RlbGV0ZWQuc2F2ZWQnKTsKICAgICAgfSwKCiAgICAgIGRpZENv
bW1pdDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgICAgcmVjb3JkLnNlbmQoJ2ludm9rZUxpZmVj
eWNsZUNhbGxiYWNrcycsIGdldChyZWNvcmQsICdsYXN0RGlydHlUeXBlJykpOwogICAgICB9LAoK
ICAgICAgLy8gbG9hZGVkLnNhdmVkLm5vdEZvdW5kIHdvdWxkIGJlIHRyaWdnZXJlZCBieSBhIGZh
aWxlZAogICAgICAvLyBgcmVsb2FkKClgIG9uIGFuIHVuY2hhbmdlZCByZWNvcmQKICAgICAgbm90
Rm91bmQ6IEVtYmVyLksKCiAgICB9LAoKICAgIC8vIEEgcmVjb3JkIGlzIGluIHRoaXMgc3RhdGUg
YWZ0ZXIgaXQgaGFzIGJlZW4gbG9jYWxseQogICAgLy8gY3JlYXRlZCBidXQgYmVmb3JlIHRoZSBh
ZGFwdGVyIGhhcyBpbmRpY2F0ZWQgdGhhdAogICAgLy8gaXQgaGFzIGJlZW4gc2F2ZWQuCiAgICBj
cmVhdGVkOiBjcmVhdGVkU3RhdGUsCgogICAgLy8gQSByZWNvcmQgaXMgaW4gdGhpcyBzdGF0ZSBp
ZiBpdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAvLyBzYXZlZCB0byB0aGUgc2VydmVyLCBidXQgdGhl
cmUgYXJlIG5ldyBsb2NhbCBjaGFuZ2VzCiAgICAvLyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIHNh
dmVkLgogICAgdXBkYXRlZDogdXBkYXRlZFN0YXRlCiAgfSwKCiAgLy8gQSByZWNvcmQgaXMgaW4g
dGhpcyBzdGF0ZSBpZiBpdCB3YXMgZGVsZXRlZCBmcm9tIHRoZSBzdG9yZS4KICBkZWxldGVkOiB7
CiAgICBpbml0aWFsU3RhdGU6ICd1bmNvbW1pdHRlZCcsCiAgICBkaXJ0eVR5cGU6ICdkZWxldGVk
JywKCiAgICAvLyBGTEFHUwogICAgaXNEZWxldGVkOiB0cnVlLAogICAgaXNMb2FkZWQ6IHRydWUs
CiAgICBpc0RpcnR5OiB0cnVlLAoKICAgIC8vIFRSQU5TSVRJT05TCiAgICBzZXR1cDogZnVuY3Rp
b24ocmVjb3JkKSB7CiAgICAgIHJlY29yZC51cGRhdGVSZWNvcmRBcnJheXMoKTsKICAgIH0sCgog
ICAgLy8gU1VCU1RBVEVTCgogICAgLy8gV2hlbiBhIHJlY29yZCBpcyBkZWxldGVkLCBpdCBlbnRl
cnMgdGhlIGBzdGFydGAKICAgIC8vIHN0YXRlLiBJdCB3aWxsIGV4aXQgdGhpcyBzdGF0ZSB3aGVu
IHRoZSByZWNvcmQKICAgIC8vIHN0YXJ0cyB0byBjb21taXQuCiAgICB1bmNvbW1pdHRlZDogewoK
ICAgICAgLy8gRVZFTlRTCgogICAgICB3aWxsQ29tbWl0OiBmdW5jdGlvbihyZWNvcmQpIHsKICAg
ICAgICByZWNvcmQudHJhbnNpdGlvblRvKCdpbkZsaWdodCcpOwogICAgICB9LAoKICAgICAgcm9s
bGJhY2s6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgIHJlY29yZC5yb2xsYmFjaygpOwogICAg
ICB9LAoKICAgICAgYmVjb21lRGlydHk6IEVtYmVyLkssCiAgICAgIGRlbGV0ZVJlY29yZDogRW1i
ZXIuSywKCiAgICAgIHJvbGxlZEJhY2s6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgIHJlY29y
ZC50cmFuc2l0aW9uVG8oJ2xvYWRlZC5zYXZlZCcpOwogICAgICB9CiAgICB9LAoKICAgIC8vIEFm
dGVyIGEgcmVjb3JkIHN0YXJ0cyBjb21taXR0aW5nLCBidXQKICAgIC8vIGJlZm9yZSB0aGUgYWRh
cHRlciBpbmRpY2F0ZXMgdGhhdCB0aGUgZGVsZXRpb24KICAgIC8vIGhhcyBzYXZlZCB0byB0aGUg
c2VydmVyLCBhIHJlY29yZCBpcyBpbiB0aGUKICAgIC8vIGBpbkZsaWdodGAgc3Vic3RhdGUgb2Yg
YGRlbGV0ZWRgLgogICAgaW5GbGlnaHQ6IHsKICAgICAgLy8gRkxBR1MKICAgICAgaXNTYXZpbmc6
IHRydWUsCgogICAgICAvLyBFVkVOVFMKCiAgICAgIC8vIFRPRE86IE1vcmUgcm9idXN0IHNlbWFu
dGljcyBhcm91bmQgc2F2ZS13aGlsZS1pbi1mbGlnaHQKICAgICAgd2lsbENvbW1pdDogRW1iZXIu
SywKICAgICAgZGlkQ29tbWl0OiBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAgICByZWNvcmQudHJh
bnNpdGlvblRvKCdzYXZlZCcpOwoKICAgICAgICByZWNvcmQuc2VuZCgnaW52b2tlTGlmZWN5Y2xl
Q2FsbGJhY2tzJyk7CiAgICAgIH0sCgogICAgICBiZWNhbWVFcnJvcjogZnVuY3Rpb24ocmVjb3Jk
KSB7CiAgICAgICAgcmVjb3JkLnRyYW5zaXRpb25UbygndW5jb21taXR0ZWQnKTsKICAgICAgICBy
ZWNvcmQudHJpZ2dlckxhdGVyKCdiZWNhbWVFcnJvcicsIHJlY29yZCk7CiAgICAgIH0KICAgIH0s
CgogICAgLy8gT25jZSB0aGUgYWRhcHRlciBpbmRpY2F0ZXMgdGhhdCB0aGUgZGVsZXRpb24gaGFz
CiAgICAvLyBiZWVuIHNhdmVkLCB0aGUgcmVjb3JkIGVudGVycyB0aGUgYHNhdmVkYCBzdWJzdGF0
ZQogICAgLy8gb2YgYGRlbGV0ZWRgLgogICAgc2F2ZWQ6IHsKICAgICAgLy8gRkxBR1MKICAgICAg
aXNEaXJ0eTogZmFsc2UsCgogICAgICBzZXR1cDogZnVuY3Rpb24ocmVjb3JkKSB7CiAgICAgICAg
dmFyIHN0b3JlID0gZ2V0KHJlY29yZCwgJ3N0b3JlJyk7CiAgICAgICAgc3RvcmUuZGVtYXRlcmlh
bGl6ZVJlY29yZChyZWNvcmQpOwogICAgICB9LAoKICAgICAgaW52b2tlTGlmZWN5Y2xlQ2FsbGJh
Y2tzOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAgICByZWNvcmQudHJpZ2dlckxhdGVyKCdkaWRE
ZWxldGUnLCByZWNvcmQpOwogICAgICAgIHJlY29yZC50cmlnZ2VyTGF0ZXIoJ2RpZENvbW1pdCcs
IHJlY29yZCk7CiAgICAgIH0KICAgIH0KICB9LAoKICBpbnZva2VMaWZlY3ljbGVDYWxsYmFja3M6
IGZ1bmN0aW9uKHJlY29yZCwgZGlydHlUeXBlKSB7CiAgICBpZiAoZGlydHlUeXBlID09PSAnY3Jl
YXRlZCcpIHsKICAgICAgcmVjb3JkLnRyaWdnZXJMYXRlcignZGlkQ3JlYXRlJywgcmVjb3JkKTsK
ICAgIH0gZWxzZSB7CiAgICAgIHJlY29yZC50cmlnZ2VyTGF0ZXIoJ2RpZFVwZGF0ZScsIHJlY29y
ZCk7CiAgICB9CgogICAgcmVjb3JkLnRyaWdnZXJMYXRlcignZGlkQ29tbWl0JywgcmVjb3JkKTsK
ICB9Cn07CgpmdW5jdGlvbiB3aXJlU3RhdGUob2JqZWN0LCBwYXJlbnQsIG5hbWUpIHsKICAvKmpz
aGludCBwcm90bzp0cnVlKi8KICAvLyBUT0RPOiBVc2UgT2JqZWN0LmNyZWF0ZSBhbmQgY29weSBp
bnN0ZWFkCiAgb2JqZWN0ID0gbWl4aW4ocGFyZW50ID8gRW1iZXIuY3JlYXRlKHBhcmVudCkgOiB7
fSwgb2JqZWN0KTsKICBvYmplY3QucGFyZW50U3RhdGUgPSBwYXJlbnQ7CiAgb2JqZWN0LnN0YXRl
TmFtZSA9IG5hbWU7CgogIGZvciAodmFyIHByb3AgaW4gb2JqZWN0KSB7CiAgICBpZiAoIW9iamVj
dC5oYXNPd25Qcm9wZXJ0eShwcm9wKSB8fCBwcm9wID09PSAncGFyZW50U3RhdGUnIHx8IHByb3Ag
PT09ICdzdGF0ZU5hbWUnKSB7IGNvbnRpbnVlOyB9CiAgICBpZiAodHlwZW9mIG9iamVjdFtwcm9w
XSA9PT0gJ29iamVjdCcpIHsKICAgICAgb2JqZWN0W3Byb3BdID0gd2lyZVN0YXRlKG9iamVjdFtw
cm9wXSwgb2JqZWN0LCBuYW1lICsgIi4iICsgcHJvcCk7CiAgICB9CiAgfQoKICByZXR1cm4gb2Jq
ZWN0Owp9CgpSb290U3RhdGUgPSB3aXJlU3RhdGUoUm9vdFN0YXRlLCBudWxsLCAicm9vdCIpOwoK
RFMuUm9vdFN0YXRlID0gUm9vdFN0YXRlOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgZ2V0
ID0gRW1iZXIuZ2V0LCBpc0VtcHR5ID0gRW1iZXIuaXNFbXB0eTsKCi8qKgpAbW9kdWxlIGVtYmVy
LWRhdGEKKi8KCi8qKgogIEhvbGRzIHZhbGlkYXRpb24gZXJyb3JzIGZvciBhIGdpdmVuIHJlY29y
ZCBvcmdhbml6ZWQgYnkgYXR0cmlidXRlIG5hbWVzLgoKICBAY2xhc3MgRXJyb3JzCiAgQG5hbWVz
cGFjZSBEUwogIEBleHRlbmRzIEVtYmVyLk9iamVjdAogIEB1c2VzIEVtYmVyLkVudW1lcmFibGUK
ICBAdXNlcyBFbWJlci5FdmVudGVkCiAqLwpEUy5FcnJvcnMgPSBFbWJlci5PYmplY3QuZXh0ZW5k
KEVtYmVyLkVudW1lcmFibGUsIEVtYmVyLkV2ZW50ZWQsIHsKICAvKioKICAgIFJlZ2lzdGVyIHdp
dGggdGFyZ2V0IGhhbmRsZXIKCiAgICBAbWV0aG9kIHJlZ2lzdGVySGFuZGxlcnMKICAgIEBwYXJh
bSB7T2JqZWN0fSB0YXJnZXQKICAgIEBwYXJhbSB7RnVuY3Rpb259IGJlY2FtZUludmFsaWQKICAg
IEBwYXJhbSB7RnVuY3Rpb259IGJlY2FtZVZhbGlkCiAgKi8KICByZWdpc3RlckhhbmRsZXJzOiBm
dW5jdGlvbih0YXJnZXQsIGJlY2FtZUludmFsaWQsIGJlY2FtZVZhbGlkKSB7CiAgICB0aGlzLm9u
KCdiZWNhbWVJbnZhbGlkJywgdGFyZ2V0LCBiZWNhbWVJbnZhbGlkKTsKICAgIHRoaXMub24oJ2Jl
Y2FtZVZhbGlkJywgdGFyZ2V0LCBiZWNhbWVWYWxpZCk7CiAgfSwKCiAgLyoqCiAgICBAcHJvcGVy
dHkgZXJyb3JzQnlBdHRyaWJ1dGVOYW1lCiAgICBAdHlwZSB7RW1iZXIuTWFwV2l0aERlZmF1bHR9
CiAgICBAcHJpdmF0ZQogICovCiAgZXJyb3JzQnlBdHRyaWJ1dGVOYW1lOiBFbWJlci5yZWR1Y2VD
b21wdXRlZCgiY29udGVudCIsIHsKICAgIGluaXRpYWxWYWx1ZTogZnVuY3Rpb24oKSB7CiAgICAg
IHJldHVybiBFbWJlci5NYXBXaXRoRGVmYXVsdC5jcmVhdGUoewogICAgICAgIGRlZmF1bHRWYWx1
ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gRW1iZXIuQSgpOwogICAgICAgIH0KICAg
ICAgfSk7CiAgICB9LAoKICAgIGFkZGVkSXRlbTogZnVuY3Rpb24oZXJyb3JzLCBlcnJvcikgewog
ICAgICBlcnJvcnMuZ2V0KGVycm9yLmF0dHJpYnV0ZSkucHVzaE9iamVjdChlcnJvcik7CgogICAg
ICByZXR1cm4gZXJyb3JzOwogICAgfSwKCiAgICByZW1vdmVkSXRlbTogZnVuY3Rpb24oZXJyb3Jz
LCBlcnJvcikgewogICAgICBlcnJvcnMuZ2V0KGVycm9yLmF0dHJpYnV0ZSkucmVtb3ZlT2JqZWN0
KGVycm9yKTsKCiAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9CiAgfSksCgogIC8qKgogICAgUmV0
dXJucyBlcnJvcnMgZm9yIGEgZ2l2ZW4gYXR0cmlidXRlCgogICAgQG1ldGhvZCBlcnJvcnNGb3IK
ICAgIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUKICAgIEByZXR1cm5zIHtBcnJheX0KICAqLwog
IGVycm9yc0ZvcjogZnVuY3Rpb24oYXR0cmlidXRlKSB7CiAgICByZXR1cm4gZ2V0KHRoaXMsICdl
cnJvcnNCeUF0dHJpYnV0ZU5hbWUnKS5nZXQoYXR0cmlidXRlKTsKICB9LAoKICAvKioKICAqLwog
IG1lc3NhZ2VzOiBFbWJlci5jb21wdXRlZC5tYXBCeSgnY29udGVudCcsICdtZXNzYWdlJyksCgog
IC8qKgogICAgQHByb3BlcnR5IGNvbnRlbnQKICAgIEB0eXBlIHtBcnJheX0KICAgIEBwcml2YXRl
CiAgKi8KICBjb250ZW50OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsKICAgIHJldHVybiBF
bWJlci5BKCk7CiAgfSksCgogIC8qKgogICAgQG1ldGhvZCB1bmtub3duUHJvcGVydHkKICAgIEBw
cml2YXRlCiAgKi8KICB1bmtub3duUHJvcGVydHk6IGZ1bmN0aW9uKGF0dHJpYnV0ZSkgewogICAg
dmFyIGVycm9ycyA9IHRoaXMuZXJyb3JzRm9yKGF0dHJpYnV0ZSk7CiAgICBpZiAoaXNFbXB0eShl
cnJvcnMpKSB7IHJldHVybiBudWxsOyB9CiAgICByZXR1cm4gZXJyb3JzOwogIH0sCgogIC8qKgog
ICAgQG1ldGhvZCBuZXh0T2JqZWN0CiAgICBAcHJpdmF0ZQogICovCiAgbmV4dE9iamVjdDogZnVu
Y3Rpb24oaW5kZXgsIHByZXZpb3VzT2JqZWN0LCBjb250ZXh0KSB7CiAgICByZXR1cm4gZ2V0KHRo
aXMsICdjb250ZW50Jykub2JqZWN0QXQoaW5kZXgpOwogIH0sCgogIC8qKgogICAgVG90YWwgbnVt
YmVyIG9mIGVycm9ycy4KCiAgICBAcHJvcGVydHkgbGVuZ3RoCiAgICBAdHlwZSB7TnVtYmVyfQog
ICAgQHJlYWRPbmx5CiAgKi8KICBsZW5ndGg6IEVtYmVyLmNvbXB1dGVkLm9uZVdheSgnY29udGVu
dC5sZW5ndGgnKS5yZWFkT25seSgpLAoKICAvKioKICAgIEBwcm9wZXJ0eSBpc0VtcHR5CiAgICBA
dHlwZSB7Qm9vbGVhbn0KICAgIEByZWFkT25seQogICovCiAgaXNFbXB0eTogRW1iZXIuY29tcHV0
ZWQubm90KCdsZW5ndGgnKS5yZWFkT25seSgpLAoKICAvKioKICAgIEFkZHMgZXJyb3IgbWVzc2Fn
ZXMgdG8gYSBnaXZlbiBhdHRyaWJ1dGUgYW5kIHNlbmRzCiAgICBgYmVjYW1lSW52YWxpZGAgZXZl
bnQgdG8gdGhlIHJlY29yZC4KCiAgICBAbWV0aG9kIGFkZAogICAgQHBhcmFtIHtTdHJpbmd9IGF0
dHJpYnV0ZQogICAgQHBhcmFtIHtBcnJheXxTdHJpbmd9IG1lc3NhZ2VzCiAgKi8KICBhZGQ6IGZ1
bmN0aW9uKGF0dHJpYnV0ZSwgbWVzc2FnZXMpIHsKICAgIHZhciB3YXNFbXB0eSA9IGdldCh0aGlz
LCAnaXNFbXB0eScpOwoKICAgIG1lc3NhZ2VzID0gdGhpcy5fZmluZE9yQ3JlYXRlTWVzc2FnZXMo
YXR0cmlidXRlLCBtZXNzYWdlcyk7CiAgICBnZXQodGhpcywgJ2NvbnRlbnQnKS5hZGRPYmplY3Rz
KG1lc3NhZ2VzKTsKCiAgICB0aGlzLm5vdGlmeVByb3BlcnR5Q2hhbmdlKGF0dHJpYnV0ZSk7CiAg
ICB0aGlzLmVudW1lcmFibGVDb250ZW50RGlkQ2hhbmdlKCk7CgogICAgaWYgKHdhc0VtcHR5ICYm
ICFnZXQodGhpcywgJ2lzRW1wdHknKSkgewogICAgICB0aGlzLnRyaWdnZXIoJ2JlY2FtZUludmFs
aWQnKTsKICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRob2QgX2ZpbmRPckNyZWF0ZU1lc3NhZ2Vz
CiAgICBAcHJpdmF0ZQogICovCiAgX2ZpbmRPckNyZWF0ZU1lc3NhZ2VzOiBmdW5jdGlvbihhdHRy
aWJ1dGUsIG1lc3NhZ2VzKSB7CiAgICB2YXIgZXJyb3JzID0gdGhpcy5lcnJvcnNGb3IoYXR0cmli
dXRlKTsKCiAgICByZXR1cm4gRW1iZXIubWFrZUFycmF5KG1lc3NhZ2VzKS5tYXAoZnVuY3Rpb24o
bWVzc2FnZSkgewogICAgICByZXR1cm4gZXJyb3JzLmZpbmRCeSgnbWVzc2FnZScsIG1lc3NhZ2Up
IHx8IHsKICAgICAgICBhdHRyaWJ1dGU6IGF0dHJpYnV0ZSwKICAgICAgICBtZXNzYWdlOiBtZXNz
YWdlCiAgICAgIH07CiAgICB9KTsKICB9LAoKICAvKioKICAgIFJlbW92ZXMgYWxsIGVycm9yIG1l
c3NhZ2VzIGZyb20gdGhlIGdpdmVuIGF0dHJpYnV0ZSBhbmQgc2VuZHMKICAgIGBiZWNhbWVWYWxp
ZGAgZXZlbnQgdG8gdGhlIHJlY29yZCBpZiB0aGVyZSBubyBtb3JlIGVycm9ycyBsZWZ0LgoKICAg
IEBtZXRob2QgcmVtb3ZlCiAgICBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlCiAgKi8KICByZW1v
dmU6IGZ1bmN0aW9uKGF0dHJpYnV0ZSkgewogICAgaWYgKGdldCh0aGlzLCAnaXNFbXB0eScpKSB7
IHJldHVybjsgfQoKICAgIHZhciBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50JykucmVqZWN0
QnkoJ2F0dHJpYnV0ZScsIGF0dHJpYnV0ZSk7CiAgICBnZXQodGhpcywgJ2NvbnRlbnQnKS5zZXRP
YmplY3RzKGNvbnRlbnQpOwoKICAgIHRoaXMubm90aWZ5UHJvcGVydHlDaGFuZ2UoYXR0cmlidXRl
KTsKICAgIHRoaXMuZW51bWVyYWJsZUNvbnRlbnREaWRDaGFuZ2UoKTsKCiAgICBpZiAoZ2V0KHRo
aXMsICdpc0VtcHR5JykpIHsKICAgICAgdGhpcy50cmlnZ2VyKCdiZWNhbWVWYWxpZCcpOwogICAg
fQogIH0sCgogIC8qKgogICAgUmVtb3ZlcyBhbGwgZXJyb3IgbWVzc2FnZXMgYW5kIHNlbmRzIGBi
ZWNhbWVWYWxpZGAgZXZlbnQKICAgIHRvIHRoZSByZWNvcmQuCgogICAgQG1ldGhvZCBjbGVhcgog
ICovCiAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgaWYgKGdldCh0aGlzLCAnaXNFbXB0eScpKSB7
IHJldHVybjsgfQoKICAgIGdldCh0aGlzLCAnY29udGVudCcpLmNsZWFyKCk7CiAgICB0aGlzLmVu
dW1lcmFibGVDb250ZW50RGlkQ2hhbmdlKCk7CgogICAgdGhpcy50cmlnZ2VyKCdiZWNhbWVWYWxp
ZCcpOwogIH0sCgogIC8qKgogICAgQ2hlY2tzIGlmIHRoZXJlIGlzIGVycm9yIG1lc3NhZ2VzIGZv
ciB0aGUgZ2l2ZW4gYXR0cmlidXRlLgoKICAgIEBtZXRob2QgaGFzCiAgICBAcGFyYW0ge1N0cmlu
Z30gYXR0cmlidXRlCiAgICBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGVyZSBzb21lIGVy
cm9ycyBvbiBnaXZlbiBhdHRyaWJ1dGUKICAqLwogIGhhczogZnVuY3Rpb24oYXR0cmlidXRlKSB7
CiAgICByZXR1cm4gIWlzRW1wdHkodGhpcy5lcnJvcnNGb3IoYXR0cmlidXRlKSk7CiAgfQp9KTsK
Cn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIg
Z2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQsCiAgICBtZXJnZSA9IEVtYmVyLm1lcmdl
LCBvbmNlID0gRW1iZXIucnVuLm9uY2U7Cgp2YXIgcmV0cmlldmVGcm9tQ3VycmVudFN0YXRlID0g
RW1iZXIuY29tcHV0ZWQoJ2N1cnJlbnRTdGF0ZScsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICBy
ZXR1cm4gZ2V0KGdldCh0aGlzLCAnY3VycmVudFN0YXRlJyksIGtleSk7Cn0pLnJlYWRPbmx5KCk7
CgovKioKCiAgVGhlIG1vZGVsIGNsYXNzIHRoYXQgYWxsIEVtYmVyIERhdGEgcmVjb3JkcyBkZXNj
ZW5kIGZyb20uCgogIEBjbGFzcyBNb2RlbAogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBFbWJl
ci5PYmplY3QKICBAdXNlcyBFbWJlci5FdmVudGVkCiovCkRTLk1vZGVsID0gRW1iZXIuT2JqZWN0
LmV4dGVuZChFbWJlci5FdmVudGVkLCB7CiAgLyoqCiAgICBJZiB0aGlzIHByb3BlcnR5IGlzIGB0
cnVlYCB0aGUgcmVjb3JkIGlzIGluIHRoZSBgZW1wdHlgCiAgICBzdGF0ZS4gRW1wdHkgaXMgdGhl
IGZpcnN0IHN0YXRlIGFsbCByZWNvcmRzIGVudGVyIGFmdGVyIHRoZXkgaGF2ZQogICAgYmVlbiBj
cmVhdGVkLiBNb3N0IHJlY29yZHMgY3JlYXRlZCBieSB0aGUgc3RvcmUgd2lsbCBxdWlja2x5CiAg
ICB0cmFuc2l0aW9uIHRvIHRoZSBgbG9hZGluZ2Agc3RhdGUgaWYgZGF0YSBuZWVkcyB0byBiZSBm
ZXRjaGVkIGZyb20KICAgIHRoZSBzZXJ2ZXIgb3IgdGhlIGBjcmVhdGVkYCBzdGF0ZSBpZiB0aGUg
cmVjb3JkIGlzIGNyZWF0ZWQgb24gdGhlCiAgICBjbGllbnQuIEEgcmVjb3JkIGNhbiBhbHNvIGVu
dGVyIHRoZSBlbXB0eSBzdGF0ZSBpZiB0aGUgYWRhcHRlciBpcwogICAgdW5hYmxlIHRvIGxvY2F0
ZSB0aGUgcmVjb3JkLgoKICAgIEBwcm9wZXJ0eSBpc0VtcHR5CiAgICBAdHlwZSB7Qm9vbGVhbn0K
ICAgIEByZWFkT25seQogICovCiAgaXNFbXB0eTogcmV0cmlldmVGcm9tQ3VycmVudFN0YXRlLAog
IC8qKgogICAgSWYgdGhpcyBwcm9wZXJ0eSBpcyBgdHJ1ZWAgdGhlIHJlY29yZCBpcyBpbiB0aGUg
YGxvYWRpbmdgIHN0YXRlLiBBCiAgICByZWNvcmQgZW50ZXJzIHRoaXMgc3RhdGUgd2hlbiB0aGUg
c3RvcmUgYXNrZXMgdGhlIGFkYXB0ZXIgZm9yIGl0cwogICAgZGF0YS4gSXQgcmVtYWlucyBpbiB0
aGlzIHN0YXRlIHVudGlsIHRoZSBhZGFwdGVyIHByb3ZpZGVzIHRoZQogICAgcmVxdWVzdGVkIGRh
dGEuCgogICAgQHByb3BlcnR5IGlzTG9hZGluZwogICAgQHR5cGUge0Jvb2xlYW59CiAgICBAcmVh
ZE9ubHkKICAqLwogIGlzTG9hZGluZzogcmV0cmlldmVGcm9tQ3VycmVudFN0YXRlLAogIC8qKgog
ICAgSWYgdGhpcyBwcm9wZXJ0eSBpcyBgdHJ1ZWAgdGhlIHJlY29yZCBpcyBpbiB0aGUgYGxvYWRl
ZGAgc3RhdGUuIEEKICAgIHJlY29yZCBlbnRlcnMgdGhpcyBzdGF0ZSB3aGVuIGl0cyBkYXRhIGlz
IHBvcHVsYXRlZC4gTW9zdCBvZiBhCiAgICByZWNvcmQncyBsaWZlY3ljbGUgaXMgc3BlbnQgaW5z
aWRlIHN1YnN0YXRlcyBvZiB0aGUgYGxvYWRlZGAKICAgIHN0YXRlLgoKICAgIEV4YW1wbGUKCiAg
ICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgcmVjb3JkID0gc3RvcmUuY3JlYXRlUmVjb3JkKEFwcC5N
b2RlbCk7CiAgICByZWNvcmQuZ2V0KCdpc0xvYWRlZCcpOyAvLyB0cnVlCgogICAgc3RvcmUuZmlu
ZCgnbW9kZWwnLCAxKS50aGVuKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgIG1vZGVsLmdldCgnaXNM
b2FkZWQnKTsgLy8gdHJ1ZQogICAgfSk7CiAgICBgYGAKCiAgICBAcHJvcGVydHkgaXNMb2FkZWQK
ICAgIEB0eXBlIHtCb29sZWFufQogICAgQHJlYWRPbmx5CiAgKi8KICBpc0xvYWRlZDogcmV0cmll
dmVGcm9tQ3VycmVudFN0YXRlLAogIC8qKgogICAgSWYgdGhpcyBwcm9wZXJ0eSBpcyBgdHJ1ZWAg
dGhlIHJlY29yZCBpcyBpbiB0aGUgYGRpcnR5YCBzdGF0ZS4gVGhlCiAgICByZWNvcmQgaGFzIGxv
Y2FsIGNoYW5nZXMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBzYXZlZCBieSB0aGUKICAgIGFkYXB0
ZXIuIFRoaXMgaW5jbHVkZXMgcmVjb3JkcyB0aGF0IGhhdmUgYmVlbiBjcmVhdGVkIChidXQgbm90
IHlldAogICAgc2F2ZWQpIG9yIGRlbGV0ZWQuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIHZhciByZWNvcmQgPSBzdG9yZS5jcmVhdGVSZWNvcmQoQXBwLk1vZGVsKTsKICAgIHJl
Y29yZC5nZXQoJ2lzRGlydHknKTsgLy8gdHJ1ZQoKICAgIHN0b3JlLmZpbmQoJ21vZGVsJywgMSku
dGhlbihmdW5jdGlvbihtb2RlbCkgewogICAgICBtb2RlbC5nZXQoJ2lzRGlydHknKTsgLy8gZmFs
c2UKICAgICAgbW9kZWwuc2V0KCdmb28nLCAnc29tZSB2YWx1ZScpOwogICAgICBtb2RlbC5zZXQo
J2lzRGlydHknKTsgLy8gdHJ1ZQogICAgfSk7CiAgICBgYGAKCiAgICBAcHJvcGVydHkgaXNEaXJ0
eQogICAgQHR5cGUge0Jvb2xlYW59CiAgICBAcmVhZE9ubHkKICAqLwogIGlzRGlydHk6IHJldHJp
ZXZlRnJvbUN1cnJlbnRTdGF0ZSwKICAvKioKICAgIElmIHRoaXMgcHJvcGVydHkgaXMgYHRydWVg
IHRoZSByZWNvcmQgaXMgaW4gdGhlIGBzYXZpbmdgIHN0YXRlLiBBCiAgICByZWNvcmQgZW50ZXJz
IHRoZSBzYXZpbmcgc3RhdGUgd2hlbiBgc2F2ZWAgaXMgY2FsbGVkLCBidXQgdGhlCiAgICBhZGFw
dGVyIGhhcyBub3QgeWV0IGFja25vd2xlZGdlZCB0aGF0IHRoZSBjaGFuZ2VzIGhhdmUgYmVlbgog
ICAgcGVyc2lzdGVkIHRvIHRoZSBiYWNrZW5kLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2Ny
aXB0CiAgICB2YXIgcmVjb3JkID0gc3RvcmUuY3JlYXRlUmVjb3JkKEFwcC5Nb2RlbCk7CiAgICBy
ZWNvcmQuZ2V0KCdpc1NhdmluZycpOyAvLyBmYWxzZQogICAgdmFyIHByb21pc2UgPSByZWNvcmQu
c2F2ZSgpOwogICAgcmVjb3JkLmdldCgnaXNTYXZpbmcnKTsgLy8gdHJ1ZQogICAgcHJvbWlzZS50
aGVuKGZ1bmN0aW9uKCkgewogICAgICByZWNvcmQuZ2V0KCdpc1NhdmluZycpOyAvLyBmYWxzZQog
ICAgfSk7CiAgICBgYGAKCiAgICBAcHJvcGVydHkgaXNTYXZpbmcKICAgIEB0eXBlIHtCb29sZWFu
fQogICAgQHJlYWRPbmx5CiAgKi8KICBpc1NhdmluZzogcmV0cmlldmVGcm9tQ3VycmVudFN0YXRl
LAogIC8qKgogICAgSWYgdGhpcyBwcm9wZXJ0eSBpcyBgdHJ1ZWAgdGhlIHJlY29yZCBpcyBpbiB0
aGUgYGRlbGV0ZWRgIHN0YXRlCiAgICBhbmQgaGFzIGJlZW4gbWFya2VkIGZvciBkZWxldGlvbi4g
V2hlbiBgaXNEZWxldGVkYCBpcyB0cnVlIGFuZAogICAgYGlzRGlydHlgIGlzIHRydWUsIHRoZSBy
ZWNvcmQgaXMgZGVsZXRlZCBsb2NhbGx5IGJ1dCB0aGUgZGVsZXRpb24KICAgIHdhcyBub3QgeWV0
IHBlcnNpc3RlZC4gV2hlbiBgaXNTYXZpbmdgIGlzIHRydWUsIHRoZSBjaGFuZ2UgaXMKICAgIGlu
LWZsaWdodC4gV2hlbiBib3RoIGBpc0RpcnR5YCBhbmQgYGlzU2F2aW5nYCBhcmUgZmFsc2UsIHRo
ZQogICAgY2hhbmdlIGhhcyBwZXJzaXN0ZWQuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIHZhciByZWNvcmQgPSBzdG9yZS5jcmVhdGVSZWNvcmQoQXBwLk1vZGVsKTsKICAgIHJl
Y29yZC5nZXQoJ2lzRGVsZXRlZCcpOyAvLyBmYWxzZQogICAgcmVjb3JkLmRlbGV0ZVJlY29yZCgp
OwogICAgcmVjb3JkLmdldCgnaXNEZWxldGVkJyk7IC8vIHRydWUKICAgIGBgYAoKICAgIEBwcm9w
ZXJ0eSBpc0RlbGV0ZWQKICAgIEB0eXBlIHtCb29sZWFufQogICAgQHJlYWRPbmx5CiAgKi8KICBp
c0RlbGV0ZWQ6IHJldHJpZXZlRnJvbUN1cnJlbnRTdGF0ZSwKICAvKioKICAgIElmIHRoaXMgcHJv
cGVydHkgaXMgYHRydWVgIHRoZSByZWNvcmQgaXMgaW4gdGhlIGBuZXdgIHN0YXRlLiBBCiAgICBy
ZWNvcmQgd2lsbCBiZSBpbiB0aGUgYG5ld2Agc3RhdGUgd2hlbiBpdCBoYXMgYmVlbiBjcmVhdGVk
IG9uIHRoZQogICAgY2xpZW50IGFuZCB0aGUgYWRhcHRlciBoYXMgbm90IHlldCByZXBvcnQgdGhh
dCBpdCB3YXMgc3VjY2Vzc2Z1bGx5CiAgICBzYXZlZC4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2
YXNjcmlwdAogICAgdmFyIHJlY29yZCA9IHN0b3JlLmNyZWF0ZVJlY29yZChBcHAuTW9kZWwpOwog
ICAgcmVjb3JkLmdldCgnaXNOZXcnKTsgLy8gdHJ1ZQoKICAgIHN0b3JlLmZpbmQoJ21vZGVsJywg
MSkudGhlbihmdW5jdGlvbihtb2RlbCkgewogICAgICBtb2RlbC5nZXQoJ2lzTmV3Jyk7IC8vIGZh
bHNlCiAgICB9KTsKICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBpc05ldwogICAgQHR5cGUge0Jvb2xl
YW59CiAgICBAcmVhZE9ubHkKICAqLwogIGlzTmV3OiByZXRyaWV2ZUZyb21DdXJyZW50U3RhdGUs
CiAgLyoqCiAgICBJZiB0aGlzIHByb3BlcnR5IGlzIGB0cnVlYCB0aGUgcmVjb3JkIGlzIGluIHRo
ZSBgdmFsaWRgIHN0YXRlLiBBCiAgICByZWNvcmQgd2lsbCBiZSBpbiB0aGUgYHZhbGlkYCBzdGF0
ZSB3aGVuIG5vIGNsaWVudC1zaWRlCiAgICB2YWxpZGF0aW9ucyBoYXZlIGZhaWxlZCBhbmQgdGhl
IGFkYXB0ZXIgZGlkIG5vdCByZXBvcnQgYW55CiAgICBzZXJ2ZXItc2lkZSB2YWxpZGF0aW9uIGZh
aWx1cmVzLgoKICAgIEBwcm9wZXJ0eSBpc1ZhbGlkCiAgICBAdHlwZSB7Qm9vbGVhbn0KICAgIEBy
ZWFkT25seQogICovCiAgaXNWYWxpZDogcmV0cmlldmVGcm9tQ3VycmVudFN0YXRlLAogIC8qKgog
ICAgSWYgdGhlIHJlY29yZCBpcyBpbiB0aGUgZGlydHkgc3RhdGUgdGhpcyBwcm9wZXJ0eSB3aWxs
IHJlcG9ydCB3aGF0CiAgICBraW5kIG9mIGNoYW5nZSBoYXMgY2F1c2VkIGl0IHRvIG1vdmUgaW50
byB0aGUgZGlydHkKICAgIHN0YXRlLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOgoKICAgIC0gYGNyZWF0
ZWRgIFRoZSByZWNvcmQgaGFzIGJlZW4gY3JlYXRlZCBieSB0aGUgY2xpZW50IGFuZCBub3QgeWV0
IHNhdmVkIHRvIHRoZSBhZGFwdGVyLgogICAgLSBgdXBkYXRlZGAgVGhlIHJlY29yZCBoYXMgYmVl
biB1cGRhdGVkIGJ5IHRoZSBjbGllbnQgYW5kIG5vdCB5ZXQgc2F2ZWQgdG8gdGhlIGFkYXB0ZXIu
CiAgICAtIGBkZWxldGVkYCBUaGUgcmVjb3JkIGhhcyBiZWVuIGRlbGV0ZWQgYnkgdGhlIGNsaWVu
dCBhbmQgbm90IHlldCBzYXZlZCB0byB0aGUgYWRhcHRlci4KCiAgICBFeGFtcGxlCgogICAgYGBg
amF2YXNjcmlwdAogICAgdmFyIHJlY29yZCA9IHN0b3JlLmNyZWF0ZVJlY29yZChBcHAuTW9kZWwp
OwogICAgcmVjb3JkLmdldCgnZGlydHlUeXBlJyk7IC8vICdjcmVhdGVkJwogICAgYGBgCgogICAg
QHByb3BlcnR5IGRpcnR5VHlwZQogICAgQHR5cGUge1N0cmluZ30KICAgIEByZWFkT25seQogICov
CiAgZGlydHlUeXBlOiByZXRyaWV2ZUZyb21DdXJyZW50U3RhdGUsCgogIC8qKgogICAgSWYgYHRy
dWVgIHRoZSBhZGFwdGVyIHJlcG9ydGVkIHRoYXQgaXQgd2FzIHVuYWJsZSB0byBzYXZlIGxvY2Fs
CiAgICBjaGFuZ2VzIHRvIHRoZSBiYWNrZW5kLiBUaGlzIG1heSBhbHNvIHJlc3VsdCBpbiB0aGUg
cmVjb3JkIGhhdmluZwogICAgaXRzIGBpc1ZhbGlkYCBwcm9wZXJ0eSBiZWNvbWUgZmFsc2UgaWYg
dGhlIGFkYXB0ZXIgcmVwb3J0ZWQgdGhhdAogICAgc2VydmVyLXNpZGUgdmFsaWRhdGlvbnMgZmFp
bGVkLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICByZWNvcmQuZ2V0KCdpc0Vy
cm9yJyk7IC8vIGZhbHNlCiAgICByZWNvcmQuc2V0KCdmb28nLCAnaW52YWxpZCB2YWx1ZScpOwog
ICAgcmVjb3JkLnNhdmUoKS50aGVuKG51bGwsIGZ1bmN0aW9uKCkgewogICAgICByZWNvcmQuZ2V0
KCdpc0Vycm9yJyk7IC8vIHRydWUKICAgIH0pOwogICAgYGBgCgogICAgQHByb3BlcnR5IGlzRXJy
b3IKICAgIEB0eXBlIHtCb29sZWFufQogICAgQHJlYWRPbmx5CiAgKi8KICBpc0Vycm9yOiBmYWxz
ZSwKICAvKioKICAgIElmIGB0cnVlYCB0aGUgc3RvcmUgaXMgYXR0ZW1wdGluZyB0byByZWxvYWQg
dGhlIHJlY29yZCBmb3JtIHRoZSBhZGFwdGVyLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2Ny
aXB0CiAgICByZWNvcmQuZ2V0KCdpc1JlbG9hZGluZycpOyAvLyBmYWxzZQogICAgcmVjb3JkLnJl
bG9hZCgpOwogICAgcmVjb3JkLmdldCgnaXNSZWxvYWRpbmcnKTsgLy8gdHJ1ZQogICAgYGBgCgog
ICAgQHByb3BlcnR5IGlzUmVsb2FkaW5nCiAgICBAdHlwZSB7Qm9vbGVhbn0KICAgIEByZWFkT25s
eQogICovCiAgaXNSZWxvYWRpbmc6IGZhbHNlLAoKICAvKioKICAgIFRoZSBgY2xpZW50SWRgIHBy
b3BlcnR5IGlzIGEgdHJhbnNpZW50IG51bWVyaWNhbCBpZGVudGlmaWVyCiAgICBnZW5lcmF0ZWQg
YXQgcnVudGltZSBieSB0aGUgZGF0YSBzdG9yZS4gSXQgaXMgaW1wb3J0YW50CiAgICBwcmltYXJp
bHkgYmVjYXVzZSBuZXdseSBjcmVhdGVkIG9iamVjdHMgbWF5IG5vdCB5ZXQgaGF2ZSBhbgogICAg
ZXh0ZXJuYWxseSBnZW5lcmF0ZWQgaWQuCgogICAgQHByb3BlcnR5IGNsaWVudElkCiAgICBAcHJp
dmF0ZQogICAgQHR5cGUge051bWJlcnxTdHJpbmd9CiAgKi8KICBjbGllbnRJZDogbnVsbCwKICAv
KioKICAgIEFsbCBlbWJlciBtb2RlbHMgaGF2ZSBhbiBpZCBwcm9wZXJ0eS4gVGhpcyBpcyBhbiBp
ZGVudGlmaWVyCiAgICBtYW5hZ2VkIGJ5IGFuIGV4dGVybmFsIHNvdXJjZS4gVGhlc2UgYXJlIGFs
d2F5cyBjb2VyY2VkIHRvIGJlCiAgICBzdHJpbmdzIGJlZm9yZSBiZWluZyB1c2VkIGludGVybmFs
bHkuIE5vdGUgd2hlbiBkZWNsYXJpbmcgdGhlCiAgICBhdHRyaWJ1dGVzIGZvciBhIG1vZGVsIGl0
IGlzIGFuIGVycm9yIHRvIGRlY2xhcmUgYW4gaWQKICAgIGF0dHJpYnV0ZS4KCiAgICBgYGBqYXZh
c2NyaXB0CiAgICB2YXIgcmVjb3JkID0gc3RvcmUuY3JlYXRlUmVjb3JkKEFwcC5Nb2RlbCk7CiAg
ICByZWNvcmQuZ2V0KCdpZCcpOyAvLyBudWxsCgogICAgc3RvcmUuZmluZCgnbW9kZWwnLCAxKS50
aGVuKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgIG1vZGVsLmdldCgnaWQnKTsgLy8gJzEnCiAgICB9
KTsKICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBpZAogICAgQHR5cGUge1N0cmluZ30KICAqLwogIGlk
OiBudWxsLAogIHRyYW5zYWN0aW9uOiBudWxsLAogIC8qKgogICAgQHByb3BlcnR5IGN1cnJlbnRT
dGF0ZQogICAgQHByaXZhdGUKICAgIEB0eXBlIHtPYmplY3R9CiAgKi8KICBjdXJyZW50U3RhdGU6
IG51bGwsCiAgLyoqCiAgICBXaGVuIHRoZSByZWNvcmQgaXMgaW4gdGhlIGBpbnZhbGlkYCBzdGF0
ZSB0aGlzIG9iamVjdCB3aWxsIGNvbnRhaW4KICAgIGFueSBlcnJvcnMgcmV0dXJuZWQgYnkgdGhl
IGFkYXB0ZXIuIFdoZW4gcHJlc2VudCB0aGUgZXJyb3JzIGhhc2gKICAgIHR5cGljYWxseSBjb250
YWlucyBrZXlzIGNvcmVzcG9uZGluZyB0byB0aGUgaW52YWxpZCBwcm9wZXJ0eSBuYW1lcwogICAg
YW5kIHZhbHVlcyB3aGljaCBhcmUgYW4gYXJyYXkgb2YgZXJyb3IgbWVzc2FnZXMuCgogICAgYGBg
amF2YXNjcmlwdAogICAgcmVjb3JkLmdldCgnZXJyb3JzLmxlbmd0aCcpOyAvLyAwCiAgICByZWNv
cmQuc2V0KCdmb28nLCAnaW52YWxpZCB2YWx1ZScpOwogICAgcmVjb3JkLnNhdmUoKS50aGVuKG51
bGwsIGZ1bmN0aW9uKCkgewogICAgICByZWNvcmQuZ2V0KCdlcnJvcnMnKS5nZXQoJ2ZvbycpOyAv
LyBbJ2ZvbyBzaG91bGQgYmUgYSBudW1iZXIuJ10KICAgIH0pOwogICAgYGBgCgogICAgQHByb3Bl
cnR5IGVycm9ycwogICAgQHR5cGUge09iamVjdH0KICAqLwogIGVycm9yczogbnVsbCwKCiAgLyoq
CiAgICBDcmVhdGUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZWNvcmQsIHVzaW5nIHRo
ZSBzZXJpYWxpemF0aW9uCiAgICBzdHJhdGVneSBvZiB0aGUgc3RvcmUncyBhZGFwdGVyLgoKICAg
YHNlcmlhbGl6ZWAgdGFrZXMgYW4gb3B0aW9uYWwgaGFzaCBhcyBhIHBhcmFtZXRlciwgY3VycmVu
dGx5CiAgICBzdXBwb3J0ZWQgb3B0aW9ucyBhcmU6CgogICAtIGBpbmNsdWRlSWRgOiBgdHJ1ZWAg
aWYgdGhlIHJlY29yZCdzIElEIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUKICAgICAgSlNPTiBy
ZXByZXNlbnRhdGlvbi4KCiAgICBAbWV0aG9kIHNlcmlhbGl6ZQogICAgQHBhcmFtIHtPYmplY3R9
IG9wdGlvbnMKICAgIEByZXR1cm5zIHtPYmplY3R9IGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJl
IHByaW1pdGl2ZSBKU09OIHZhbHVlcyBvbmx5CiAgKi8KICBzZXJpYWxpemU6IGZ1bmN0aW9uKG9w
dGlvbnMpIHsKICAgIHZhciBzdG9yZSA9IGdldCh0aGlzLCAnc3RvcmUnKTsKICAgIHJldHVybiBz
dG9yZS5zZXJpYWxpemUodGhpcywgb3B0aW9ucyk7CiAgfSwKCiAgLyoqCiAgICBVc2UgW0RTLkpT
T05TZXJpYWxpemVyXShEUy5KU09OU2VyaWFsaXplci5odG1sKSB0bwogICAgZ2V0IHRoZSBKU09O
IHJlcHJlc2VudGF0aW9uIG9mIGEgcmVjb3JkLgoKICAgIGB0b0pTT05gIHRha2VzIGFuIG9wdGlv
bmFsIGhhc2ggYXMgYSBwYXJhbWV0ZXIsIGN1cnJlbnRseQogICAgc3VwcG9ydGVkIG9wdGlvbnMg
YXJlOgoKICAgIC0gYGluY2x1ZGVJZGA6IGB0cnVlYCBpZiB0aGUgcmVjb3JkJ3MgSUQgc2hvdWxk
IGJlIGluY2x1ZGVkIGluIHRoZQogICAgICBKU09OIHJlcHJlc2VudGF0aW9uLgoKICAgIEBtZXRo
b2QgdG9KU09OCiAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgQHJldHVybnMge09iamVj
dH0gQSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuCiAgKi8KICB0b0pTT046IGZ1
bmN0aW9uKG9wdGlvbnMpIHsKICAgIC8vIGNvbnRhaW5lciBpcyBmb3IgbGF6eSB0cmFuc2Zvcm0g
bG9va3VwcwogICAgdmFyIHNlcmlhbGl6ZXIgPSBEUy5KU09OU2VyaWFsaXplci5jcmVhdGUoeyBj
b250YWluZXI6IHRoaXMuY29udGFpbmVyIH0pOwogICAgcmV0dXJuIHNlcmlhbGl6ZXIuc2VyaWFs
aXplKHRoaXMsIG9wdGlvbnMpOwogIH0sCgogIC8qKgogICAgRmlyZWQgd2hlbiB0aGUgcmVjb3Jk
IGlzIGxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXIuCgogICAgQGV2ZW50IGRpZExvYWQKICAqLwogIGRp
ZExvYWQ6IEVtYmVyLkssCgogIC8qKgogICAgRmlyZWQgd2hlbiB0aGUgcmVjb3JkIGlzIHVwZGF0
ZWQuCgogICAgQGV2ZW50IGRpZFVwZGF0ZQogICovCiAgZGlkVXBkYXRlOiBFbWJlci5LLAoKICAv
KioKICAgIEZpcmVkIHdoZW4gdGhlIHJlY29yZCBpcyBjcmVhdGVkLgoKICAgIEBldmVudCBkaWRD
cmVhdGUKICAqLwogIGRpZENyZWF0ZTogRW1iZXIuSywKCiAgLyoqCiAgICBGaXJlZCB3aGVuIHRo
ZSByZWNvcmQgaXMgZGVsZXRlZC4KCiAgICBAZXZlbnQgZGlkRGVsZXRlCiAgKi8KICBkaWREZWxl
dGU6IEVtYmVyLkssCgogIC8qKgogICAgRmlyZWQgd2hlbiB0aGUgcmVjb3JkIGJlY29tZXMgaW52
YWxpZC4KCiAgICBAZXZlbnQgYmVjYW1lSW52YWxpZAogICovCiAgYmVjYW1lSW52YWxpZDogRW1i
ZXIuSywKCiAgLyoqCiAgICBGaXJlZCB3aGVuIHRoZSByZWNvcmQgZW50ZXJzIHRoZSBlcnJvciBz
dGF0ZS4KCiAgICBAZXZlbnQgYmVjYW1lRXJyb3IKICAqLwogIGJlY2FtZUVycm9yOiBFbWJlci5L
LAoKICAvKioKICAgIEBwcm9wZXJ0eSBkYXRhCiAgICBAcHJpdmF0ZQogICAgQHR5cGUge09iamVj
dH0KICAqLwogIGRhdGE6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgdGhpcy5fZGF0
YSA9IHRoaXMuX2RhdGEgfHwge307CiAgICByZXR1cm4gdGhpcy5fZGF0YTsKICB9KS5wcm9wZXJ0
eSgpLAoKICBfZGF0YTogbnVsbCwKCiAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICBzZXQodGhpcywg
J2N1cnJlbnRTdGF0ZScsIERTLlJvb3RTdGF0ZS5lbXB0eSk7CiAgICB2YXIgZXJyb3JzID0gRFMu
RXJyb3JzLmNyZWF0ZSgpOwogICAgZXJyb3JzLnJlZ2lzdGVySGFuZGxlcnModGhpcywgZnVuY3Rp
b24oKSB7CiAgICAgIHRoaXMuc2VuZCgnYmVjYW1lSW52YWxpZCcpOwogICAgfSwgZnVuY3Rpb24o
KSB7CiAgICAgIHRoaXMuc2VuZCgnYmVjYW1lVmFsaWQnKTsKICAgIH0pOwogICAgc2V0KHRoaXMs
ICdlcnJvcnMnLCBlcnJvcnMpOwogICAgdGhpcy5fc3VwZXIoKTsKICAgIHRoaXMuX3NldHVwKCk7
CiAgfSwKCiAgX3NldHVwOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2NoYW5nZXNUb1N5bmMgPSB7
fTsKICAgIHRoaXMuX2RlZmVycmVkVHJpZ2dlcnMgPSBbXTsKICAgIHRoaXMuX2RhdGEgPSB7fTsK
ICAgIHRoaXMuX2F0dHJpYnV0ZXMgPSB7fTsKICAgIHRoaXMuX2luRmxpZ2h0QXR0cmlidXRlcyA9
IHt9OwogICAgdGhpcy5fcmVsYXRpb25zaGlwcyA9IHt9OwogIH0sCgogIC8qKgogICAgQG1ldGhv
ZCBzZW5kCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUKICAgIEBwYXJhbSB7
T2JqZWN0fSBjb250ZXh0CiAgKi8KICBzZW5kOiBmdW5jdGlvbihuYW1lLCBjb250ZXh0KSB7CiAg
ICB2YXIgY3VycmVudFN0YXRlID0gZ2V0KHRoaXMsICdjdXJyZW50U3RhdGUnKTsKCiAgICBpZiAo
IWN1cnJlbnRTdGF0ZVtuYW1lXSkgewogICAgICB0aGlzLl91bmhhbmRsZWRFdmVudChjdXJyZW50
U3RhdGUsIG5hbWUsIGNvbnRleHQpOwogICAgfQoKICAgIHJldHVybiBjdXJyZW50U3RhdGVbbmFt
ZV0odGhpcywgY29udGV4dCk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIHRyYW5zaXRpb25Ubwog
ICAgQHByaXZhdGUKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgKi8KICB0cmFuc2l0aW9uVG86
IGZ1bmN0aW9uKG5hbWUpIHsKICAgIC8vIFBPU1NJQkxFIFRPRE86IFJlbW92ZSB0aGlzIGNvZGUg
YW5kIHJlcGxhY2Ugd2l0aAogICAgLy8gYWx3YXlzIGhhdmluZyBkaXJlY3QgcmVmZXJlbmNlcyB0
byBzdGF0ZSBvYmplY3RzCgogICAgdmFyIHBpdm90TmFtZSA9IG5hbWUuc3BsaXQoIi4iLCAxKSwK
ICAgICAgICBjdXJyZW50U3RhdGUgPSBnZXQodGhpcywgJ2N1cnJlbnRTdGF0ZScpLAogICAgICAg
IHN0YXRlID0gY3VycmVudFN0YXRlOwoKICAgIGRvIHsKICAgICAgaWYgKHN0YXRlLmV4aXQpIHsg
c3RhdGUuZXhpdCh0aGlzKTsgfQogICAgICBzdGF0ZSA9IHN0YXRlLnBhcmVudFN0YXRlOwogICAg
fSB3aGlsZSAoIXN0YXRlLmhhc093blByb3BlcnR5KHBpdm90TmFtZSkpOwoKICAgIHZhciBwYXRo
ID0gbmFtZS5zcGxpdCgiLiIpOwoKICAgIHZhciBzZXR1cHMgPSBbXSwgZW50ZXJzID0gW10sIGks
IGw7CgogICAgZm9yIChpPTAsIGw9cGF0aC5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgIHN0YXRl
ID0gc3RhdGVbcGF0aFtpXV07CgogICAgICBpZiAoc3RhdGUuZW50ZXIpIHsgZW50ZXJzLnB1c2go
c3RhdGUpOyB9CiAgICAgIGlmIChzdGF0ZS5zZXR1cCkgeyBzZXR1cHMucHVzaChzdGF0ZSk7IH0K
ICAgIH0KCiAgICBmb3IgKGk9MCwgbD1lbnRlcnMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICBl
bnRlcnNbaV0uZW50ZXIodGhpcyk7CiAgICB9CgogICAgc2V0KHRoaXMsICdjdXJyZW50U3RhdGUn
LCBzdGF0ZSk7CgogICAgZm9yIChpPTAsIGw9c2V0dXBzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAg
ICAgc2V0dXBzW2ldLnNldHVwKHRoaXMpOwogICAgfQoKICAgIHRoaXMudXBkYXRlUmVjb3JkQXJy
YXlzTGF0ZXIoKTsKICB9LAoKICBfdW5oYW5kbGVkRXZlbnQ6IGZ1bmN0aW9uKHN0YXRlLCBuYW1l
LCBjb250ZXh0KSB7CiAgICB2YXIgZXJyb3JNZXNzYWdlID0gIkF0dGVtcHRlZCB0byBoYW5kbGUg
ZXZlbnQgYCIgKyBuYW1lICsgImAgIjsKICAgIGVycm9yTWVzc2FnZSAgICArPSAib24gIiArIFN0
cmluZyh0aGlzKSArICIgd2hpbGUgaW4gc3RhdGUgIjsKICAgIGVycm9yTWVzc2FnZSAgICArPSBz
dGF0ZS5zdGF0ZU5hbWUgKyAiLiAiOwoKICAgIGlmIChjb250ZXh0ICE9PSB1bmRlZmluZWQpIHsK
ICAgICAgZXJyb3JNZXNzYWdlICArPSAiQ2FsbGVkIHdpdGggIiArIEVtYmVyLmluc3BlY3QoY29u
dGV4dCkgKyAiLiI7CiAgICB9CgogICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKGVycm9yTWVzc2Fn
ZSk7CiAgfSwKCiAgd2l0aFRyYW5zYWN0aW9uOiBmdW5jdGlvbihmbikgewogICAgdmFyIHRyYW5z
YWN0aW9uID0gZ2V0KHRoaXMsICd0cmFuc2FjdGlvbicpOwogICAgaWYgKHRyYW5zYWN0aW9uKSB7
IGZuKHRyYW5zYWN0aW9uKTsgfQogIH0sCgogIC8qKgogICAgQG1ldGhvZCBsb2FkaW5nRGF0YQog
ICAgQHByaXZhdGUKICAgIEBwYXJhbSB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgbG9hZGluZ0Rh
dGE6IGZ1bmN0aW9uKHByb21pc2UpIHsKICAgIHRoaXMuc2VuZCgnbG9hZGluZ0RhdGEnLCBwcm9t
aXNlKTsKICB9LAoKICAvKioKICAgIEBtZXRob2QgbG9hZGVkRGF0YQogICAgQHByaXZhdGUKICAq
LwogIGxvYWRlZERhdGE6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zZW5kKCdsb2FkZWREYXRhJyk7
CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIG5vdEZvdW5kCiAgICBAcHJpdmF0ZQogICovCiAgbm90
Rm91bmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zZW5kKCdub3RGb3VuZCcpOwogIH0sCgogIC8q
KgogICAgQG1ldGhvZCBwdXNoZWREYXRhCiAgICBAcHJpdmF0ZQogICovCiAgcHVzaGVkRGF0YTog
ZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNlbmQoJ3B1c2hlZERhdGEnKTsKICB9LAoKICAvKioKICAg
IE1hcmtzIHRoZSByZWNvcmQgYXMgZGVsZXRlZCBidXQgZG9lcyBub3Qgc2F2ZSBpdC4gWW91IG11
c3QgY2FsbAogICAgYHNhdmVgIGFmdGVyd2FyZHMgaWYgeW91IHdhbnQgdG8gcGVyc2lzdCBpdC4g
WW91IG1pZ2h0IHVzZSB0aGlzCiAgICBtZXRob2QgaWYgeW91IHdhbnQgdG8gYWxsb3cgdGhlIHVz
ZXIgdG8gc3RpbGwgYHJvbGxiYWNrKClgIGEKICAgIGRlbGV0ZSBhZnRlciBpdCB3YXMgbWFkZS4K
CiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLk1vZGVsRGVsZXRlUm91dGUg
PSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgc29mdERlbGV0
ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmdldCgnbW9kZWwnKS5kZWxldGVSZWNvcmQo
KTsKICAgICAgICB9LAogICAgICAgIGNvbmZpcm06IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhp
cy5nZXQoJ21vZGVsJykuc2F2ZSgpOwogICAgICAgIH0sCiAgICAgICAgdW5kbzogZnVuY3Rpb24o
KSB7CiAgICAgICAgICB0aGlzLmdldCgnbW9kZWwnKS5yb2xsYmFjaygpOwogICAgICAgIH0KICAg
ICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIGRlbGV0ZVJlY29yZAogICovCiAgZGVs
ZXRlUmVjb3JkOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc2VuZCgnZGVsZXRlUmVjb3JkJyk7CiAg
fSwKCiAgLyoqCiAgICBTYW1lIGFzIGBkZWxldGVSZWNvcmRgLCBidXQgc2F2ZXMgdGhlIHJlY29y
ZCBpbW1lZGlhdGVseS4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLk1v
ZGVsRGVsZXRlUm91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAg
ICAgICAgZGVsZXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBjb250cm9sbGVyID0gdGhp
cy5jb250cm9sbGVyOwogICAgICAgICAgdGhpcy5nZXQoJ21vZGVsJykuZGVzdHJveVJlY29yZCgp
LnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNpdGlvblRvUm91
dGUoJ21vZGVsLmluZGV4Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0p
OwogICAgYGBgCgogICAgQG1ldGhvZCBkZXN0cm95UmVjb3JkCiAgICBAcmV0dXJuIHtQcm9taXNl
fSBhIHByb21pc2UgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdoZW4gdGhlIGFkYXB0ZXIgcmV0dXJu
cwogICAgc3VjY2Vzc2Z1bGx5IG9yIHJlamVjdGVkIGlmIHRoZSBhZGFwdGVyIHJldHVybnMgd2l0
aCBhbiBlcnJvci4KICAqLwogIGRlc3Ryb3lSZWNvcmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5k
ZWxldGVSZWNvcmQoKTsKICAgIHJldHVybiB0aGlzLnNhdmUoKTsKICB9LAoKICAvKioKICAgIEBt
ZXRob2QgdW5sb2FkUmVjb3JkCiAgICBAcHJpdmF0ZQogICovCiAgdW5sb2FkUmVjb3JkOiBmdW5j
dGlvbigpIHsKICAgIEVtYmVyLmFzc2VydCgiWW91IGNhbiBvbmx5IHVubG9hZCBhIGxvYWRlZCwg
bm9uLWRpcnR5IHJlY29yZC4iLCAhZ2V0KHRoaXMsICdpc0RpcnR5JykpOwoKICAgIHRoaXMuc2Vu
ZCgndW5sb2FkUmVjb3JkJyk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGNsZWFyUmVsYXRpb25z
aGlwcwogICAgQHByaXZhdGUKICAqLwogIGNsZWFyUmVsYXRpb25zaGlwczogZnVuY3Rpb24oKSB7
CiAgICB0aGlzLmVhY2hSZWxhdGlvbnNoaXAoZnVuY3Rpb24obmFtZSwgcmVsYXRpb25zaGlwKSB7
CiAgICAgIGlmIChyZWxhdGlvbnNoaXAua2luZCA9PT0gJ2JlbG9uZ3NUbycpIHsKICAgICAgICBz
ZXQodGhpcywgbmFtZSwgbnVsbCk7CiAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLmtpbmQg
PT09ICdoYXNNYW55JykgewogICAgICAgIHZhciBoYXNNYW55ID0gdGhpcy5fcmVsYXRpb25zaGlw
c1tyZWxhdGlvbnNoaXAubmFtZV07CiAgICAgICAgaWYgKGhhc01hbnkpIHsgaGFzTWFueS5jbGVh
cigpOyB9CiAgICAgIH0KICAgIH0sIHRoaXMpOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCB1cGRh
dGVSZWNvcmRBcnJheXMKICAgIEBwcml2YXRlCiAgKi8KICB1cGRhdGVSZWNvcmRBcnJheXM6IGZ1
bmN0aW9uKCkgewogICAgZ2V0KHRoaXMsICdzdG9yZScpLmRhdGFXYXNVcGRhdGVkKHRoaXMuY29u
c3RydWN0b3IsIHRoaXMpOwogIH0sCgogIC8qKgogICAgUmV0dXJucyBhbiBvYmplY3QsIHdob3Nl
IGtleXMgYXJlIGNoYW5nZWQgcHJvcGVydGllcywgYW5kIHZhbHVlIGlzCiAgICBhbiBbb2xkUHJv
cCwgbmV3UHJvcF0gYXJyYXkuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFw
cC5NYXNjb3QgPSBEUy5Nb2RlbC5leHRlbmQoewogICAgICBuYW1lOiBhdHRyKCdzdHJpbmcnKQog
ICAgfSk7CgogICAgdmFyIHBlcnNvbiA9IHN0b3JlLmNyZWF0ZVJlY29yZCgncGVyc29uJyk7CiAg
ICBwZXJzb24uY2hhbmdlZEF0dHJpYnV0ZXMoKTsgLy8ge30KICAgIHBlcnNvbi5zZXQoJ25hbWUn
LCAnVG9tc3RlcicpOwogICAgcGVyc29uLmNoYW5nZWRBdHRyaWJ1dGVzKCk7IC8vIHtuYW1lOiBb
dW5kZWZpbmVkLCAnVG9tc3RlciddfQogICAgYGBgCgogICAgQG1ldGhvZCBjaGFuZ2VkQXR0cmli
dXRlcwogICAgQHJldHVybiB7T2JqZWN0fSBhbiBvYmplY3QsIHdob3NlIGtleXMgYXJlIGNoYW5n
ZWQgcHJvcGVydGllcywKICAgICAgYW5kIHZhbHVlIGlzIGFuIFtvbGRQcm9wLCBuZXdQcm9wXSBh
cnJheS4KICAqLwogIGNoYW5nZWRBdHRyaWJ1dGVzOiBmdW5jdGlvbigpIHsKICAgIHZhciBvbGRE
YXRhID0gZ2V0KHRoaXMsICdfZGF0YScpLAogICAgICAgIG5ld0RhdGEgPSBnZXQodGhpcywgJ19h
dHRyaWJ1dGVzJyksCiAgICAgICAgZGlmZkRhdGEgPSB7fSwKICAgICAgICBwcm9wOwoKICAgIGZv
ciAocHJvcCBpbiBuZXdEYXRhKSB7CiAgICAgIGRpZmZEYXRhW3Byb3BdID0gW29sZERhdGFbcHJv
cF0sIG5ld0RhdGFbcHJvcF1dOwogICAgfQoKICAgIHJldHVybiBkaWZmRGF0YTsKICB9LAoKICAv
KioKICAgIEBtZXRob2QgYWRhcHRlcldpbGxDb21taXQKICAgIEBwcml2YXRlCiAgKi8KICBhZGFw
dGVyV2lsbENvbW1pdDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNlbmQoJ3dpbGxDb21taXQnKTsK
ICB9LAoKICAvKioKICAgIElmIHRoZSBhZGFwdGVyIGRpZCBub3QgcmV0dXJuIGEgaGFzaCBpbiBy
ZXNwb25zZSB0byBhIGNvbW1pdCwKICAgIG1lcmdlIHRoZSBjaGFuZ2VkIGF0dHJpYnV0ZXMgYW5k
IHJlbGF0aW9uc2hpcHMgaW50byB0aGUgZXhpc3RpbmcKICAgIHNhdmVkIGRhdGEuCgogICAgQG1l
dGhvZCBhZGFwdGVyRGlkQ29tbWl0CiAgKi8KICBhZGFwdGVyRGlkQ29tbWl0OiBmdW5jdGlvbihk
YXRhKSB7CiAgICBzZXQodGhpcywgJ2lzRXJyb3InLCBmYWxzZSk7CgogICAgaWYgKGRhdGEpIHsK
ICAgICAgdGhpcy5fZGF0YSA9IGRhdGE7CiAgICB9IGVsc2UgewogICAgICBFbWJlci5taXhpbih0
aGlzLl9kYXRhLCB0aGlzLl9pbkZsaWdodEF0dHJpYnV0ZXMpOwogICAgfQoKICAgIHRoaXMuX2lu
RmxpZ2h0QXR0cmlidXRlcyA9IHt9OwoKICAgIHRoaXMuc2VuZCgnZGlkQ29tbWl0Jyk7CiAgICB0
aGlzLnVwZGF0ZVJlY29yZEFycmF5c0xhdGVyKCk7CgogICAgaWYgKCFkYXRhKSB7IHJldHVybjsg
fQoKICAgIHRoaXMuc3VzcGVuZFJlbGF0aW9uc2hpcE9ic2VydmVycyhmdW5jdGlvbigpIHsKICAg
ICAgdGhpcy5ub3RpZnlQcm9wZXJ0eUNoYW5nZSgnZGF0YScpOwogICAgfSk7CiAgfSwKCiAgLyoq
CiAgICBAbWV0aG9kIGFkYXB0ZXJEaWREaXJ0eQogICAgQHByaXZhdGUKICAqLwogIGFkYXB0ZXJE
aWREaXJ0eTogZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNlbmQoJ2JlY29tZURpcnR5Jyk7CiAgICB0
aGlzLnVwZGF0ZVJlY29yZEFycmF5c0xhdGVyKCk7CiAgfSwKCiAgZGF0YURpZENoYW5nZTogRW1i
ZXIub2JzZXJ2ZXIoZnVuY3Rpb24oKSB7CiAgICB0aGlzLnJlbG9hZEhhc01hbnlzKCk7CiAgfSwg
J2RhdGEnKSwKCiAgcmVsb2FkSGFzTWFueXM6IGZ1bmN0aW9uKCkgewogICAgdmFyIHJlbGF0aW9u
c2hpcHMgPSBnZXQodGhpcy5jb25zdHJ1Y3RvciwgJ3JlbGF0aW9uc2hpcHNCeU5hbWUnKTsKICAg
IHRoaXMudXBkYXRlUmVjb3JkQXJyYXlzTGF0ZXIoKTsKICAgIHJlbGF0aW9uc2hpcHMuZm9yRWFj
aChmdW5jdGlvbihuYW1lLCByZWxhdGlvbnNoaXApIHsKICAgICAgaWYgKHRoaXMuX2RhdGEubGlu
a3MgJiYgdGhpcy5fZGF0YS5saW5rc1tuYW1lXSkgeyByZXR1cm47IH0KICAgICAgaWYgKHJlbGF0
aW9uc2hpcC5raW5kID09PSAnaGFzTWFueScpIHsKICAgICAgICB0aGlzLmhhc01hbnlEaWRDaGFu
Z2UocmVsYXRpb25zaGlwLmtleSk7CiAgICAgIH0KICAgIH0sIHRoaXMpOwogIH0sCgogIGhhc01h
bnlEaWRDaGFuZ2U6IGZ1bmN0aW9uKGtleSkgewogICAgdmFyIGhhc01hbnkgPSB0aGlzLl9yZWxh
dGlvbnNoaXBzW2tleV07CgogICAgaWYgKGhhc01hbnkpIHsKICAgICAgdmFyIHJlY29yZHMgPSB0
aGlzLl9kYXRhW2tleV0gfHwgW107CgogICAgICBzZXQoaGFzTWFueSwgJ2NvbnRlbnQnLCBFbWJl
ci5BKHJlY29yZHMpKTsKICAgICAgc2V0KGhhc01hbnksICdpc0xvYWRlZCcsIHRydWUpOwogICAg
ICBoYXNNYW55LnRyaWdnZXIoJ2RpZExvYWQnKTsKICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRo
b2QgdXBkYXRlUmVjb3JkQXJyYXlzTGF0ZXIKICAgIEBwcml2YXRlCiAgKi8KICB1cGRhdGVSZWNv
cmRBcnJheXNMYXRlcjogZnVuY3Rpb24oKSB7CiAgICBFbWJlci5ydW4ub25jZSh0aGlzLCB0aGlz
LnVwZGF0ZVJlY29yZEFycmF5cyk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIHNldHVwRGF0YQog
ICAgQHByaXZhdGUKICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICBAcGFyYW0ge0Jvb2xlYW59
IHBhcnRpYWwgdGhlIGRhdGEgc2hvdWxkIGJlIG1lcmdlZCBpbnRvCiAgICAgIHRoZSBleGlzdGlu
ZyBkYXRhLCBub3QgcmVwbGFjZSBpdC4KICAqLwogIHNldHVwRGF0YTogZnVuY3Rpb24oZGF0YSwg
cGFydGlhbCkgewogICAgaWYgKHBhcnRpYWwpIHsKICAgICAgRW1iZXIubWVyZ2UodGhpcy5fZGF0
YSwgZGF0YSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgIH0KCiAg
ICB2YXIgcmVsYXRpb25zaGlwcyA9IHRoaXMuX3JlbGF0aW9uc2hpcHM7CgogICAgdGhpcy5lYWNo
UmVsYXRpb25zaGlwKGZ1bmN0aW9uKG5hbWUsIHJlbCkgewogICAgICBpZiAoZGF0YS5saW5rcyAm
JiBkYXRhLmxpbmtzW25hbWVdKSB7IHJldHVybjsgfQogICAgICBpZiAocmVsLm9wdGlvbnMuYXN5
bmMpIHsgcmVsYXRpb25zaGlwc1tuYW1lXSA9IG51bGw7IH0KICAgIH0pOwoKICAgIGlmIChkYXRh
KSB7IHRoaXMucHVzaGVkRGF0YSgpOyB9CgogICAgdGhpcy5zdXNwZW5kUmVsYXRpb25zaGlwT2Jz
ZXJ2ZXJzKGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm5vdGlmeVByb3BlcnR5Q2hhbmdlKCdkYXRh
Jyk7CiAgICB9KTsKICB9LAoKICBtYXRlcmlhbGl6ZUlkOiBmdW5jdGlvbihpZCkgewogICAgc2V0
KHRoaXMsICdpZCcsIGlkKTsKICB9LAoKICBtYXRlcmlhbGl6ZUF0dHJpYnV0ZXM6IGZ1bmN0aW9u
KGF0dHJpYnV0ZXMpIHsKICAgIEVtYmVyLmFzc2VydCgiTXVzdCBwYXNzIGEgaGFzaCBvZiBhdHRy
aWJ1dGVzIHRvIG1hdGVyaWFsaXplQXR0cmlidXRlcyIsICEhYXR0cmlidXRlcyk7CiAgICBtZXJn
ZSh0aGlzLl9kYXRhLCBhdHRyaWJ1dGVzKTsKICB9LAoKICBtYXRlcmlhbGl6ZUF0dHJpYnV0ZTog
ZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIHRoaXMuX2RhdGFbbmFtZV0gPSB2YWx1ZTsKICB9
LAoKICAvKioKICAgIEBtZXRob2QgdXBkYXRlSGFzTWFueQogICAgQHByaXZhdGUKICAgIEBwYXJh
bSB7U3RyaW5nfSBuYW1lCiAgICBAcGFyYW0ge0FycmF5fSByZWNvcmRzCiAgKi8KICB1cGRhdGVI
YXNNYW55OiBmdW5jdGlvbihuYW1lLCByZWNvcmRzKSB7CiAgICB0aGlzLl9kYXRhW25hbWVdID0g
cmVjb3JkczsKICAgIHRoaXMuaGFzTWFueURpZENoYW5nZShuYW1lKTsKICB9LAoKICAvKioKICAg
IEBtZXRob2QgdXBkYXRlQmVsb25nc1RvCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIHtTdHJpbmd9
IG5hbWUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICovCiAgdXBkYXRlQmVsb25nc1Rv
OiBmdW5jdGlvbihuYW1lLCByZWNvcmQpIHsKICAgIHRoaXMuX2RhdGFbbmFtZV0gPSByZWNvcmQ7
CiAgfSwKCiAgLyoqCiAgICBJZiB0aGUgbW9kZWwgYGlzRGlydHlgIHRoaXMgZnVuY3Rpb24gd2ls
bCB3aGljaCBkaXNjYXJkIGFueSB1bnNhdmVkCiAgICBjaGFuZ2VzCgogICAgRXhhbXBsZQoKICAg
IGBgYGphdmFzY3JpcHQKICAgIHJlY29yZC5nZXQoJ25hbWUnKTsgLy8gJ1VudGl0bGVkIERvY3Vt
ZW50JwogICAgcmVjb3JkLnNldCgnbmFtZScsICdEb2MgMScpOwogICAgcmVjb3JkLmdldCgnbmFt
ZScpOyAvLyAnRG9jIDEnCiAgICByZWNvcmQucm9sbGJhY2soKTsKICAgIHJlY29yZC5nZXQoJ25h
bWUnKTsgLy8gJ1VudGl0bGVkIERvY3VtZW50JwogICAgYGBgCgogICAgQG1ldGhvZCByb2xsYmFj
awogICovCiAgcm9sbGJhY2s6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fYXR0cmlidXRlcyA9IHt9
OwoKICAgIGlmIChnZXQodGhpcywgJ2lzRXJyb3InKSkgewogICAgICB0aGlzLl9pbkZsaWdodEF0
dHJpYnV0ZXMgPSB7fTsKICAgICAgc2V0KHRoaXMsICdpc0Vycm9yJywgZmFsc2UpOwogICAgfQoK
ICAgIGlmICghZ2V0KHRoaXMsICdpc1ZhbGlkJykpIHsKICAgICAgdGhpcy5faW5GbGlnaHRBdHRy
aWJ1dGVzID0ge307CiAgICB9CgogICAgdGhpcy5zZW5kKCdyb2xsZWRCYWNrJyk7CgogICAgdGhp
cy5zdXNwZW5kUmVsYXRpb25zaGlwT2JzZXJ2ZXJzKGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm5v
dGlmeVByb3BlcnR5Q2hhbmdlKCdkYXRhJyk7CiAgICB9KTsKICB9LAoKICB0b1N0cmluZ0V4dGVu
c2lvbjogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZ2V0KHRoaXMsICdpZCcpOwogIH0sCgogIC8q
KgogICAgVGhlIGdvYWwgb2YgdGhpcyBtZXRob2QgaXMgdG8gdGVtcG9yYXJpbHkgZGlzYWJsZSBz
cGVjaWZpYyBvYnNlcnZlcnMKICAgIHRoYXQgdGFrZSBhY3Rpb24gaW4gcmVzcG9uc2UgdG8gYXBw
bGljYXRpb24gY2hhbmdlcy4KCiAgICBUaGlzIGFsbG93cyB0aGUgc3lzdGVtIHRvIG1ha2UgY2hh
bmdlcyAoc3VjaCBhcyBtYXRlcmlhbGl6YXRpb24gYW5kCiAgICByb2xsYmFjaykgdGhhdCBzaG91
bGQgbm90IHRyaWdnZXIgc2Vjb25kYXJ5IGJlaGF2aW9yIChzdWNoIGFzIHNldHRpbmcgYW4KICAg
IGludmVyc2UgcmVsYXRpb25zaGlwIG9yIG1hcmtpbmcgcmVjb3JkcyBhcyBkaXJ0eSkuCgogICAg
VGhlIHNwZWNpZmljIGltcGxlbWVudGF0aW9uIHdpbGwgbGlrZWx5IGNoYW5nZSBhcyBFbWJlciBw
cm9wZXIgcHJvdmlkZXMKICAgIGJldHRlciBpbmZyYXN0cnVjdHVyZSBmb3Igc3VzcGVuZGluZyBn
cm91cHMgb2Ygb2JzZXJ2ZXJzLCBhbmQgaWYgQXJyYXkKICAgIG9ic2VydmF0aW9uIGJlY29tZXMg
bW9yZSB1bmlmaWVkIHdpdGggcmVndWxhciBvYnNlcnZlcnMuCgogICAgQG1ldGhvZCBzdXNwZW5k
UmVsYXRpb25zaGlwT2JzZXJ2ZXJzCiAgICBAcHJpdmF0ZQogICAgQHBhcmFtIGNhbGxiYWNrCiAg
ICBAcGFyYW0gYmluZGluZwogICovCiAgc3VzcGVuZFJlbGF0aW9uc2hpcE9ic2VydmVyczogZnVu
Y3Rpb24oY2FsbGJhY2ssIGJpbmRpbmcpIHsKICAgIHZhciBvYnNlcnZlcnMgPSBnZXQodGhpcy5j
b25zdHJ1Y3RvciwgJ3JlbGF0aW9uc2hpcE5hbWVzJykuYmVsb25nc1RvOwogICAgdmFyIHNlbGYg
PSB0aGlzOwoKICAgIHRyeSB7CiAgICAgIHRoaXMuX3N1c3BlbmRlZFJlbGF0aW9uc2hpcHMgPSB0
cnVlOwogICAgICBFbWJlci5fc3VzcGVuZE9ic2VydmVycyhzZWxmLCBvYnNlcnZlcnMsIG51bGws
ICdiZWxvbmdzVG9EaWRDaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBFbWJlci5fc3VzcGVu
ZEJlZm9yZU9ic2VydmVycyhzZWxmLCBvYnNlcnZlcnMsIG51bGwsICdiZWxvbmdzVG9XaWxsQ2hh
bmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBjYWxsYmFjay5jYWxsKGJpbmRpbmcgfHwgc2Vs
Zik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSBmaW5hbGx5IHsKICAgICAgdGhpcy5fc3Vz
cGVuZGVkUmVsYXRpb25zaGlwcyA9IGZhbHNlOwogICAgfQogIH0sCgogIC8qKgogICAgU2F2ZSB0
aGUgcmVjb3JkIGFuZCBwZXJzaXN0IGFueSBjaGFuZ2VzIHRvIHRoZSByZWNvcmQgdG8gYW4KICAg
IGV4dGVuYWwgc291cmNlIHZpYSB0aGUgYWRhcHRlci4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2
YXNjcmlwdAogICAgcmVjb3JkLnNldCgnbmFtZScsICdUb21zdGVyJyk7CiAgICByZWNvcmQuc2F2
ZSgpLnRoZW4oZnVuY3Rpb24oKXsKICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgfSwgZnVu
Y3Rpb24oKSB7CiAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICB9KTsKICAgIGBgYAogICAgQG1l
dGhvZCBzYXZlCiAgICBAcmV0dXJuIHtQcm9taXNlfSBhIHByb21pc2UgdGhhdCB3aWxsIGJlIHJl
c29sdmVkIHdoZW4gdGhlIGFkYXB0ZXIgcmV0dXJucwogICAgc3VjY2Vzc2Z1bGx5IG9yIHJlamVj
dGVkIGlmIHRoZSBhZGFwdGVyIHJldHVybnMgd2l0aCBhbiBlcnJvci4KICAqLwogIHNhdmU6IGZ1
bmN0aW9uKCkgewogICAgdmFyIHByb21pc2VMYWJlbCA9ICJEUzogTW9kZWwjc2F2ZSAiICsgdGhp
czsKICAgIHZhciByZXNvbHZlciA9IEVtYmVyLlJTVlAuZGVmZXIocHJvbWlzZUxhYmVsKTsKCiAg
ICB0aGlzLmdldCgnc3RvcmUnKS5zY2hlZHVsZVNhdmUodGhpcywgcmVzb2x2ZXIpOwogICAgdGhp
cy5faW5GbGlnaHRBdHRyaWJ1dGVzID0gdGhpcy5fYXR0cmlidXRlczsKICAgIHRoaXMuX2F0dHJp
YnV0ZXMgPSB7fTsKCiAgICByZXR1cm4gRFMuUHJvbWlzZU9iamVjdC5jcmVhdGUoeyBwcm9taXNl
OiByZXNvbHZlci5wcm9taXNlIH0pOwogIH0sCgogIC8qKgogICAgUmVsb2FkIHRoZSByZWNvcmQg
ZnJvbSB0aGUgYWRhcHRlci4KCiAgICBUaGlzIHdpbGwgb25seSB3b3JrIGlmIHRoZSByZWNvcmQg
aGFzIGFscmVhZHkgZmluaXNoZWQgbG9hZGluZwogICAgYW5kIGhhcyBub3QgeWV0IGJlZW4gbW9k
aWZpZWQgKGBpc0xvYWRlZGAgYnV0IG5vdCBgaXNEaXJ0eWAsCiAgICBvciBgaXNTYXZpbmdgKS4K
CiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLk1vZGVsVmlld1JvdXRlID0g
RW1iZXIuUm91dGUuZXh0ZW5kKHsKICAgICAgYWN0aW9uczogewogICAgICAgIHJlbG9hZDogZnVu
Y3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmdldCgnbW9kZWwnKS5yZWxvYWQoKTsKICAgICAgICB9
CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCByZWxvYWQKICAgIEByZXR1cm4g
e1Byb21pc2V9IGEgcHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgcmVjb3Jk
IHdoZW4gdGhlCiAgICBhZGFwdGVyIHJldHVybnMgc3VjY2Vzc2Z1bGx5IG9yIHJlamVjdGVkIGlm
IHRoZSBhZGFwdGVyIHJldHVybnMKICAgIHdpdGggYW4gZXJyb3IuCiAgKi8KICByZWxvYWQ6IGZ1
bmN0aW9uKCkgewogICAgc2V0KHRoaXMsICdpc1JlbG9hZGluZycsIHRydWUpOwoKICAgIHZhciAg
cmVjb3JkID0gdGhpczsKCiAgICB2YXIgcHJvbWlzZUxhYmVsID0gIkRTOiBNb2RlbCNyZWxvYWQg
b2YgIiArIHRoaXM7CiAgICB2YXIgcHJvbWlzZSA9IG5ldyBFbWJlci5SU1ZQLlByb21pc2UoZnVu
Y3Rpb24ocmVzb2x2ZSl7CiAgICAgICByZWNvcmQuc2VuZCgncmVsb2FkUmVjb3JkJywgcmVzb2x2
ZSk7CiAgICB9LCBwcm9taXNlTGFiZWwpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgIHJlY29yZC5z
ZXQoJ2lzUmVsb2FkaW5nJywgZmFsc2UpOwogICAgICByZWNvcmQuc2V0KCdpc0Vycm9yJywgZmFs
c2UpOwogICAgICByZXR1cm4gcmVjb3JkOwogICAgfSwgZnVuY3Rpb24ocmVhc29uKSB7CiAgICAg
IHJlY29yZC5zZXQoJ2lzRXJyb3InLCB0cnVlKTsKICAgICAgdGhyb3cgcmVhc29uOwogICAgfSwg
IkRTOiBNb2RlbCNyZWxvYWQgY29tcGxldGUsIHVwZGF0ZSBmbGFncyIpOwoKICAgIHJldHVybiBE
Uy5Qcm9taXNlT2JqZWN0LmNyZWF0ZSh7IHByb21pc2U6IHByb21pc2UgfSk7CiAgfSwKCiAgLy8g
Rk9SIFVTRSBEVVJJTkcgQ09NTUlUIFBST0NFU1MKCiAgYWRhcHRlckRpZFVwZGF0ZUF0dHJpYnV0
ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSwgdmFsdWUpIHsKCiAgICAvLyBJZiBhIHZhbHVlIGlz
IHBhc3NlZCBpbiwgdXBkYXRlIHRoZSBpbnRlcm5hbCBhdHRyaWJ1dGVzIGFuZCBjbGVhcgogICAg
Ly8gdGhlIGF0dHJpYnV0ZSBjYWNoZSBzbyBpdCBwaWNrcyB1cCB0aGUgbmV3IHZhbHVlLiBPdGhl
cndpc2UsCiAgICAvLyBjb2xsYXBzZSB0aGUgY3VycmVudCB2YWx1ZSBpbnRvIHRoZSBpbnRlcm5h
bCBhdHRyaWJ1dGVzIGJlY2F1c2UKICAgIC8vIHRoZSBhZGFwdGVyIGhhcyBhY2tub3dsZWRnZWQg
aXQuCiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLl9kYXRhW2F0dHJp
YnV0ZU5hbWVdID0gdmFsdWU7CiAgICAgIHRoaXMubm90aWZ5UHJvcGVydHlDaGFuZ2UoYXR0cmli
dXRlTmFtZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9kYXRhW2F0dHJpYnV0ZU5hbWVdID0g
dGhpcy5faW5GbGlnaHRBdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdOwogICAgfQoKICAgIHRoaXMu
dXBkYXRlUmVjb3JkQXJyYXlzTGF0ZXIoKTsKICB9LAoKICAvKioKICAgIEBtZXRob2QgYWRhcHRl
ckRpZEludmFsaWRhdGUKICAgIEBwcml2YXRlCiAgKi8KICBhZGFwdGVyRGlkSW52YWxpZGF0ZTog
ZnVuY3Rpb24oZXJyb3JzKSB7CiAgICB2YXIgcmVjb3JkRXJyb3JzID0gZ2V0KHRoaXMsICdlcnJv
cnMnKTsKICAgIGZ1bmN0aW9uIGFkZEVycm9yKG5hbWUpIHsKICAgICAgaWYgKGVycm9yc1tuYW1l
XSkgewogICAgICAgIHJlY29yZEVycm9ycy5hZGQobmFtZSwgZXJyb3JzW25hbWVdKTsKICAgICAg
fQogICAgfQoKICAgIHRoaXMuZWFjaEF0dHJpYnV0ZShhZGRFcnJvcik7CiAgICB0aGlzLmVhY2hS
ZWxhdGlvbnNoaXAoYWRkRXJyb3IpOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBhZGFwdGVyRGlk
RXJyb3IKICAgIEBwcml2YXRlCiAgKi8KICBhZGFwdGVyRGlkRXJyb3I6IGZ1bmN0aW9uKCkgewog
ICAgdGhpcy5zZW5kKCdiZWNhbWVFcnJvcicpOwogICAgc2V0KHRoaXMsICdpc0Vycm9yJywgdHJ1
ZSk7CiAgfSwKCiAgLyoqCiAgICBPdmVycmlkZSB0aGUgZGVmYXVsdCBldmVudCBmaXJpbmcgZnJv
bSBFbWJlci5FdmVudGVkIHRvCiAgICBhbHNvIGNhbGwgbWV0aG9kcyB3aXRoIHRoZSBnaXZlbiBu
YW1lLgoKICAgIEBtZXRob2QgdHJpZ2dlcgogICAgQHByaXZhdGUKICAgIEBwYXJhbSBuYW1lCiAg
Ki8KICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAgICBFbWJlci50cnlJbnZva2UodGhpcywg
bmFtZSwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIHRoaXMuX3N1cGVyLmFwcGx5
KHRoaXMsIGFyZ3VtZW50cyk7CiAgfSwKCiAgdHJpZ2dlckxhdGVyOiBmdW5jdGlvbigpIHsKICAg
IHRoaXMuX2RlZmVycmVkVHJpZ2dlcnMucHVzaChhcmd1bWVudHMpOwogICAgb25jZSh0aGlzLCAn
X3RyaWdnZXJEZWZlcnJlZFRyaWdnZXJzJyk7CiAgfSwKCiAgX3RyaWdnZXJEZWZlcnJlZFRyaWdn
ZXJzOiBmdW5jdGlvbigpIHsKICAgIGZvciAodmFyIGk9MCwgbD10aGlzLl9kZWZlcnJlZFRyaWdn
ZXJzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIHRo
aXMuX2RlZmVycmVkVHJpZ2dlcnNbaV0pOwogICAgfQoKICAgIHRoaXMuX2RlZmVycmVkVHJpZ2dl
cnMgPSBbXTsKICB9Cn0pOwoKRFMuTW9kZWwucmVvcGVuQ2xhc3MoewoKICAvKioKICAgIEFsaWFz
IERTLk1vZGVsJ3MgYGNyZWF0ZWAgbWV0aG9kIHRvIGBfY3JlYXRlYC4gVGhpcyBhbGxvd3MgdXMg
dG8gY3JlYXRlIERTLk1vZGVsCiAgICBpbnN0YW5jZXMgZnJvbSB3aXRoaW4gdGhlIHN0b3JlLCBi
dXQgaWYgZW5kIHVzZXJzIGFjY2lkZW50YWxseSBjYWxsIGBjcmVhdGUoKWAKICAgIChpbnN0ZWFk
IG9mIGBjcmVhdGVSZWNvcmQoKWApLCB3ZSBjYW4gcmFpc2UgYW4gZXJyb3IuCgogICAgQG1ldGhv
ZCBfY3JlYXRlCiAgICBAcHJpdmF0ZQogICAgQHN0YXRpYwogICovCiAgX2NyZWF0ZTogRFMuTW9k
ZWwuY3JlYXRlLAoKICAvKioKICAgIE92ZXJyaWRlIHRoZSBjbGFzcycgYGNyZWF0ZSgpYCBtZXRo
b2QgdG8gcmFpc2UgYW4gZXJyb3IuIFRoaXMKICAgIHByZXZlbnRzIGVuZCB1c2VycyBmcm9tIGlu
YWR2ZXJ0ZW50bHkgY2FsbGluZyBgY3JlYXRlKClgIGluc3RlYWQKICAgIG9mIGBjcmVhdGVSZWNv
cmQoKWAuIFRoZSBzdG9yZSBpcyBzdGlsbCBhYmxlIHRvIGNyZWF0ZSBpbnN0YW5jZXMKICAgIGJ5
IGNhbGxpbmcgdGhlIGBfY3JlYXRlKClgIG1ldGhvZC4gVG8gY3JlYXRlIGFuIGluc3RhbmNlIG9m
IGEKICAgIGBEUy5Nb2RlbGAgdXNlIFtzdG9yZS5jcmVhdGVSZWNvcmRdKERTLlN0b3JlLmh0bWwj
bWV0aG9kX2NyZWF0ZVJlY29yZCkuCgogICAgQG1ldGhvZCBjcmVhdGUKICAgIEBwcml2YXRlCiAg
ICBAc3RhdGljCiAgKi8KICBjcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVtYmVy
LkVycm9yKCJZb3Ugc2hvdWxkIG5vdCBjYWxsIGBjcmVhdGVgIG9uIGEgbW9kZWwuIEluc3RlYWQs
IGNhbGwgYHN0b3JlLmNyZWF0ZVJlY29yZGAgd2l0aCB0aGUgYXR0cmlidXRlcyB5b3Ugd291bGQg
bGlrZSB0byBzZXQuIik7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1v
ZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0OwoKLyoqCiAgQGNsYXNzIE1v
ZGVsCiAgQG5hbWVzcGFjZSBEUwoqLwpEUy5Nb2RlbC5yZW9wZW5DbGFzcyh7CiAgLyoqCiAgICBB
IG1hcCB3aG9zZSBrZXlzIGFyZSB0aGUgYXR0cmlidXRlcyBvZiB0aGUgbW9kZWwgKHByb3BlcnRp
ZXMKICAgIGRlc2NyaWJlZCBieSBEUy5hdHRyKSBhbmQgd2hvc2UgdmFsdWVzIGFyZSB0aGUgbWV0
YSBvYmplY3QgZm9yIHRoZQogICAgcHJvcGVydHkuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFz
Y3JpcHQKCiAgICBBcHAuUGVyc29uID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgICAgZmlyc3ROYW1l
OiBhdHRyKCdzdHJpbmcnKSwKICAgICAgbGFzdE5hbWU6IGF0dHIoJ3N0cmluZycpLAogICAgICBi
aXJ0aGRheTogYXR0cignZGF0ZScpCiAgICB9KTsKCiAgICB2YXIgYXR0cmlidXRlcyA9IEVtYmVy
LmdldChBcHAuUGVyc29uLCAnYXR0cmlidXRlcycpCgogICAgYXR0cmlidXRlcy5mb3JFYWNoKGZ1
bmN0aW9uKG5hbWUsIG1ldGEpIHsKICAgICAgY29uc29sZS5sb2cobmFtZSwgbWV0YSk7CiAgICB9
KTsKCiAgICAvLyBwcmludHM6CiAgICAvLyBmaXJzdE5hbWUge3R5cGU6ICJzdHJpbmciLCBpc0F0
dHJpYnV0ZTogdHJ1ZSwgb3B0aW9uczogT2JqZWN0LCBwYXJlbnRUeXBlOiBmdW5jdGlvbiwgbmFt
ZTogImZpcnN0TmFtZSJ9CiAgICAvLyBsYXN0TmFtZSB7dHlwZTogInN0cmluZyIsIGlzQXR0cmli
dXRlOiB0cnVlLCBvcHRpb25zOiBPYmplY3QsIHBhcmVudFR5cGU6IGZ1bmN0aW9uLCBuYW1lOiAi
bGFzdE5hbWUifQogICAgLy8gYmlydGhkYXkge3R5cGU6ICJkYXRlIiwgaXNBdHRyaWJ1dGU6IHRy
dWUsIG9wdGlvbnM6IE9iamVjdCwgcGFyZW50VHlwZTogZnVuY3Rpb24sIG5hbWU6ICJiaXJ0aGRh
eSJ9CiAgICBgYGAKCiAgICBAcHJvcGVydHkgYXR0cmlidXRlcwogICAgQHN0YXRpYwogICAgQHR5
cGUge0VtYmVyLk1hcH0KICAgIEByZWFkT25seQogICovCiAgYXR0cmlidXRlczogRW1iZXIuY29t
cHV0ZWQoZnVuY3Rpb24oKSB7CiAgICB2YXIgbWFwID0gRW1iZXIuTWFwLmNyZWF0ZSgpOwoKICAg
IHRoaXMuZWFjaENvbXB1dGVkUHJvcGVydHkoZnVuY3Rpb24obmFtZSwgbWV0YSkgewogICAgICBp
ZiAobWV0YS5pc0F0dHJpYnV0ZSkgewogICAgICAgIEVtYmVyLmFzc2VydCgiWW91IG1heSBub3Qg
c2V0IGBpZGAgYXMgYW4gYXR0cmlidXRlIG9uIHlvdXIgbW9kZWwuIFBsZWFzZSByZW1vdmUgYW55
IGxpbmVzIHRoYXQgbG9vayBsaWtlOiBgaWQ6IERTLmF0dHIoJzx0eXBlPicpYCBmcm9tICIgKyB0
aGlzLnRvU3RyaW5nKCksIG5hbWUgIT09ICdpZCcpOwoKICAgICAgICBtZXRhLm5hbWUgPSBuYW1l
OwogICAgICAgIG1hcC5zZXQobmFtZSwgbWV0YSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVy
biBtYXA7CiAgfSksCgogIC8qKgogICAgQSBtYXAgd2hvc2Uga2V5cyBhcmUgdGhlIGF0dHJpYnV0
ZXMgb2YgdGhlIG1vZGVsIChwcm9wZXJ0aWVzCiAgICBkZXNjcmliZWQgYnkgRFMuYXR0cikgYW5k
IHdob3NlIHZhbHVlcyBhcmUgdHlwZSBvZiB0cmFuc2Zvcm1hdGlvbgogICAgYXBwbGllZCB0byBl
YWNoIGF0dHJpYnV0ZS4gVGhpcyBtYXAgZG9lcyBub3QgaW5jbHVkZSBhbnkKICAgIGF0dHJpYnV0
ZXMgdGhhdCBkbyBub3QgaGF2ZSBhbiB0cmFuc2Zvcm1hdGlvbiB0eXBlLgoKICAgIEV4YW1wbGUK
CiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUGVyc29uID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAg
ICAgZmlyc3ROYW1lOiBhdHRyKCksCiAgICAgIGxhc3ROYW1lOiBhdHRyKCdzdHJpbmcnKSwKICAg
ICAgYmlydGhkYXk6IGF0dHIoJ2RhdGUnKQogICAgfSk7CgogICAgdmFyIHRyYW5zZm9ybWVkQXR0
cmlidXRlcyA9IEVtYmVyLmdldChBcHAuUGVyc29uLCAndHJhbnNmb3JtZWRBdHRyaWJ1dGVzJykK
CiAgICB0cmFuc2Zvcm1lZEF0dHJpYnV0ZXMuZm9yRWFjaChmdW5jdGlvbihmaWVsZCwgdHlwZSkg
ewogICAgICBjb25zb2xlLmxvZyhmaWVsZCwgdHlwZSk7CiAgICB9KTsKCiAgICAvLyBwcmludHM6
CiAgICAvLyBsYXN0TmFtZSBzdHJpbmcKICAgIC8vIGJpcnRoZGF5IGRhdGUKICAgIGBgYAoKICAg
IEBwcm9wZXJ0eSB0cmFuc2Zvcm1lZEF0dHJpYnV0ZXMKICAgIEBzdGF0aWMKICAgIEB0eXBlIHtF
bWJlci5NYXB9CiAgICBAcmVhZE9ubHkKICAqLwogIHRyYW5zZm9ybWVkQXR0cmlidXRlczogRW1i
ZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICB2YXIgbWFwID0gRW1iZXIuTWFwLmNyZWF0ZSgp
OwoKICAgIHRoaXMuZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihrZXksIG1ldGEpIHsKICAgICAgaWYg
KG1ldGEudHlwZSkgewogICAgICAgIG1hcC5zZXQoa2V5LCBtZXRhLnR5cGUpOwogICAgICB9CiAg
ICB9KTsKCiAgICByZXR1cm4gbWFwOwogIH0pLAoKICAvKioKICAgIEl0ZXJhdGVzIHRocm91Z2gg
dGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsLCBjYWxsaW5nIHRoZSBwYXNzZWQgZnVuY3Rpb24g
b24gZWFjaAogICAgYXR0cmlidXRlLgoKICAgIFRoZSBjYWxsYmFjayBtZXRob2QgeW91IHByb3Zp
ZGUgc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBzaWduYXR1cmUgKGFsbAogICAgcGFyYW1ldGVy
cyBhcmUgb3B0aW9uYWwpOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIGZ1bmN0aW9uKG5hbWUsIG1l
dGEpOwogICAgYGBgCgogICAgLSBgbmFtZWAgdGhlIG5hbWUgb2YgdGhlIGN1cnJlbnQgcHJvcGVy
dHkgaW4gdGhlIGl0ZXJhdGlvbgogICAgLSBgbWV0YWAgdGhlIG1ldGEgb2JqZWN0IGZvciB0aGUg
YXR0cmlidXRlIHByb3BlcnR5IGluIHRoZSBpdGVyYXRpb24KCiAgICBOb3RlIHRoYXQgaW4gYWRk
aXRpb24gdG8gYSBjYWxsYmFjaywgeW91IGNhbiBhbHNvIHBhc3MgYW4gb3B0aW9uYWwgdGFyZ2V0
CiAgICBvYmplY3QgdGhhdCB3aWxsIGJlIHNldCBhcyBgdGhpc2Agb24gdGhlIGNvbnRleHQuCgog
ICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5QZXJzb24gPSBEUy5Nb2RlbC5l
eHRlbmQoewogICAgICBmaXJzdE5hbWU6IGF0dHIoJ3N0cmluZycpLAogICAgICBsYXN0TmFtZTog
YXR0cignc3RyaW5nJyksCiAgICAgIGJpcnRoZGF5OiBhdHRyKCdkYXRlJykKICAgIH0pOwoKICAg
IEFwcC5QZXJzb24uZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihuYW1lLCBtZXRhKSB7CiAgICAgIGNv
bnNvbGUubG9nKG5hbWUsIG1ldGEpOwogICAgfSk7CgogICAgLy8gcHJpbnRzOgogICAgLy8gZmly
c3ROYW1lIHt0eXBlOiAic3RyaW5nIiwgaXNBdHRyaWJ1dGU6IHRydWUsIG9wdGlvbnM6IE9iamVj
dCwgcGFyZW50VHlwZTogZnVuY3Rpb24sIG5hbWU6ICJmaXJzdE5hbWUifQogICAgLy8gbGFzdE5h
bWUge3R5cGU6ICJzdHJpbmciLCBpc0F0dHJpYnV0ZTogdHJ1ZSwgb3B0aW9uczogT2JqZWN0LCBw
YXJlbnRUeXBlOiBmdW5jdGlvbiwgbmFtZTogImxhc3ROYW1lIn0KICAgIC8vIGJpcnRoZGF5IHt0
eXBlOiAiZGF0ZSIsIGlzQXR0cmlidXRlOiB0cnVlLCBvcHRpb25zOiBPYmplY3QsIHBhcmVudFR5
cGU6IGZ1bmN0aW9uLCBuYW1lOiAiYmlydGhkYXkifQogICBgYGAKCiAgICBAbWV0aG9kIGVhY2hB
dHRyaWJ1dGUKICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBl
eGVjdXRlCiAgICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIHRhcmdldCBvYmplY3QgdG8g
dXNlCiAgICBAc3RhdGljCiAgKi8KICBlYWNoQXR0cmlidXRlOiBmdW5jdGlvbihjYWxsYmFjaywg
YmluZGluZykgewogICAgZ2V0KHRoaXMsICdhdHRyaWJ1dGVzJykuZm9yRWFjaChmdW5jdGlvbihu
YW1lLCBtZXRhKSB7CiAgICAgIGNhbGxiYWNrLmNhbGwoYmluZGluZywgbmFtZSwgbWV0YSk7CiAg
ICB9LCBiaW5kaW5nKTsKICB9LAoKICAvKioKICAgIEl0ZXJhdGVzIHRocm91Z2ggdGhlIHRyYW5z
Zm9ybWVkQXR0cmlidXRlcyBvZiB0aGUgbW9kZWwsIGNhbGxpbmcKICAgIHRoZSBwYXNzZWQgZnVu
Y3Rpb24gb24gZWFjaCBhdHRyaWJ1dGUuIE5vdGUgdGhlIGNhbGxiYWNrIHdpbGwgbm90IGJlCiAg
ICBjYWxsZWQgZm9yIGFueSBhdHRyaWJ1dGVzIHRoYXQgZG8gbm90IGhhdmUgYW4gdHJhbnNmb3Jt
YXRpb24gdHlwZS4KCiAgICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3VsZCBo
YXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlIChhbGwKICAgIHBhcmFtZXRlcnMgYXJlIG9wdGlv
bmFsKToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBmdW5jdGlvbihuYW1lLCB0eXBlKTsKICAgIGBg
YAoKICAgIC0gYG5hbWVgIHRoZSBuYW1lIG9mIHRoZSBjdXJyZW50IHByb3BlcnR5IGluIHRoZSBp
dGVyYXRpb24KICAgIC0gYHR5cGVgIGEgdHJpbmcgY29udHJpbmluZyB0aGUgbmFtZSBvZiB0aGUg
dHlwZSBvZiB0cmFuc2Zvcm1lZAogICAgICBhcHBsaWVkIHRvIHRoZSBhdHRyaWJ1dGUKCiAgICBO
b3RlIHRoYXQgaW4gYWRkaXRpb24gdG8gYSBjYWxsYmFjaywgeW91IGNhbiBhbHNvIHBhc3MgYW4g
b3B0aW9uYWwgdGFyZ2V0CiAgICBvYmplY3QgdGhhdCB3aWxsIGJlIHNldCBhcyBgdGhpc2Agb24g
dGhlIGNvbnRleHQuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5QZXJz
b24gPSBEUy5Nb2RlbC5leHRlbmQoewogICAgICBmaXJzdE5hbWU6IGF0dHIoKSwKICAgICAgbGFz
dE5hbWU6IGF0dHIoJ3N0cmluZycpLAogICAgICBiaXJ0aGRheTogYXR0cignZGF0ZScpCiAgICB9
KTsKCiAgICBBcHAuUGVyc29uLmVhY2hUcmFuc2Zvcm1lZEF0dHJpYnV0ZShmdW5jdGlvbihuYW1l
LCB0eXBlKSB7CiAgICAgIGNvbnNvbGUubG9nKG5hbWUsIHR5cGUpOwogICAgfSk7CgogICAgLy8g
cHJpbnRzOgogICAgLy8gbGFzdE5hbWUgc3RyaW5nCiAgICAvLyBiaXJ0aGRheSBkYXRlCiAgIGBg
YAoKICAgIEBtZXRob2QgZWFjaFRyYW5zZm9ybWVkQXR0cmlidXRlCiAgICBAcGFyYW0ge0Z1bmN0
aW9ufSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdG8gZXhlY3V0ZQogICAgQHBhcmFtIHtPYmplY3R9
IFt0YXJnZXRdIFRoZSB0YXJnZXQgb2JqZWN0IHRvIHVzZQogICAgQHN0YXRpYwogICovCiAgZWFj
aFRyYW5zZm9ybWVkQXR0cmlidXRlOiBmdW5jdGlvbihjYWxsYmFjaywgYmluZGluZykgewogICAg
Z2V0KHRoaXMsICd0cmFuc2Zvcm1lZEF0dHJpYnV0ZXMnKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUs
IHR5cGUpIHsKICAgICAgY2FsbGJhY2suY2FsbChiaW5kaW5nLCBuYW1lLCB0eXBlKTsKICAgIH0p
OwogIH0KfSk7CgoKRFMuTW9kZWwucmVvcGVuKHsKICBlYWNoQXR0cmlidXRlOiBmdW5jdGlvbihj
YWxsYmFjaywgYmluZGluZykgewogICAgdGhpcy5jb25zdHJ1Y3Rvci5lYWNoQXR0cmlidXRlKGNh
bGxiYWNrLCBiaW5kaW5nKTsKICB9Cn0pOwoKZnVuY3Rpb24gZ2V0RGVmYXVsdFZhbHVlKHJlY29y
ZCwgb3B0aW9ucywga2V5KSB7CiAgaWYgKHR5cGVvZiBvcHRpb25zLmRlZmF1bHRWYWx1ZSA9PT0g
ImZ1bmN0aW9uIikgewogICAgcmV0dXJuIG9wdGlvbnMuZGVmYXVsdFZhbHVlKCk7CiAgfSBlbHNl
IHsKICAgIHJldHVybiBvcHRpb25zLmRlZmF1bHRWYWx1ZTsKICB9Cn0KCmZ1bmN0aW9uIGhhc1Zh
bHVlKHJlY29yZCwga2V5KSB7CiAgcmV0dXJuIHJlY29yZC5fYXR0cmlidXRlcy5oYXNPd25Qcm9w
ZXJ0eShrZXkpIHx8CiAgICAgICAgIHJlY29yZC5faW5GbGlnaHRBdHRyaWJ1dGVzLmhhc093blBy
b3BlcnR5KGtleSkgfHwKICAgICAgICAgcmVjb3JkLl9kYXRhLmhhc093blByb3BlcnR5KGtleSk7
Cn0KCmZ1bmN0aW9uIGdldFZhbHVlKHJlY29yZCwga2V5KSB7CiAgaWYgKHJlY29yZC5fYXR0cmli
dXRlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICByZXR1cm4gcmVjb3JkLl9hdHRyaWJ1dGVz
W2tleV07CiAgfSBlbHNlIGlmIChyZWNvcmQuX2luRmxpZ2h0QXR0cmlidXRlcy5oYXNPd25Qcm9w
ZXJ0eShrZXkpKSB7CiAgICByZXR1cm4gcmVjb3JkLl9pbkZsaWdodEF0dHJpYnV0ZXNba2V5XTsK
ICB9IGVsc2UgewogICAgcmV0dXJuIHJlY29yZC5fZGF0YVtrZXldOwogIH0KfQoKLyoqCiAgYERT
LmF0dHJgIGRlZmluZXMgYW4gYXR0cmlidXRlIG9uIGEgW0RTLk1vZGVsXShEUy5Nb2RlbC5odG1s
KS4KICBCeSBkZWZhdWx0LCBhdHRyaWJ1dGVzIGFyZSBwYXNzZWQgdGhyb3VnaCBhcy1pcywgaG93
ZXZlciB5b3UgY2FuIHNwZWNpZnkgYW4KICBvcHRpb25hbCB0eXBlIHRvIGhhdmUgdGhlIHZhbHVl
IGF1dG9tYXRpY2FsbHkgdHJhbnNmb3JtZWQuCiAgRW1iZXIgRGF0YSBzaGlwcyB3aXRoIGZvdXIg
YmFzaWMgdHJhbnNmb3JtIHR5cGVzOiBgc3RyaW5nYCwgYG51bWJlcmAsCiAgYGJvb2xlYW5gIGFu
ZCBgZGF0ZWAuIFlvdSBjYW4gZGVmaW5lIHlvdXIgb3duIHRyYW5zZm9ybXMgYnkgc3ViY2xhc3Np
bmcKICBbRFMuVHJhbnNmb3JtXShEUy5UcmFuc2Zvcm0uaHRtbCkuCgogIGBEUy5hdHRyYCB0YWtl
cyBhbiBvcHRpb25hbCBoYXNoIGFzIGEgc2Vjb25kIHBhcmFtZXRlciwgY3VycmVudGx5CiAgc3Vw
cG9ydGVkIG9wdGlvbnMgYXJlOgoKICAtIGBkZWZhdWx0VmFsdWVgOiBQYXNzIGEgc3RyaW5nIG9y
IGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHRvIHNldCB0aGUgYXR0cmlidXRlCiAgICAgICAgICAg
ICAgICAgICAgdG8gYSBkZWZhdWx0IHZhbHVlIGlmIG5vbmUgaXMgc3VwcGxpZWQuCgogIEV4YW1w
bGUKCiAgYGBgamF2YXNjcmlwdAogIHZhciBhdHRyID0gRFMuYXR0cjsKCiAgQXBwLlVzZXIgPSBE
Uy5Nb2RlbC5leHRlbmQoewogICAgdXNlcm5hbWU6IGF0dHIoJ3N0cmluZycpLAogICAgZW1haWw6
IGF0dHIoJ3N0cmluZycpLAogICAgdmVyaWZpZWQ6IGF0dHIoJ2Jvb2xlYW4nLCB7ZGVmYXVsdFZh
bHVlOiBmYWxzZX0pCiAgfSk7CiAgYGBgCgogIEBuYW1lc3BhY2UKICBAbWV0aG9kIGF0dHIKICBA
Zm9yIERTCiAgQHBhcmFtIHtTdHJpbmd9IHR5cGUgdGhlIGF0dHJpYnV0ZSB0eXBlCiAgQHBhcmFt
IHtPYmplY3R9IG9wdGlvbnMgYSBoYXNoIG9mIG9wdGlvbnMKICBAcmV0dXJuIHtBdHRyaWJ1dGV9
CiovCgpEUy5hdHRyID0gZnVuY3Rpb24odHlwZSwgb3B0aW9ucykgewogIG9wdGlvbnMgPSBvcHRp
b25zIHx8IHt9OwoKICB2YXIgbWV0YSA9IHsKICAgIHR5cGU6IHR5cGUsCiAgICBpc0F0dHJpYnV0
ZTogdHJ1ZSwKICAgIG9wdGlvbnM6IG9wdGlvbnMKICB9OwoKICByZXR1cm4gRW1iZXIuY29tcHV0
ZWQoZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7
CiAgICAgIEVtYmVyLmFzc2VydCgiWW91IG1heSBub3Qgc2V0IGBpZGAgYXMgYW4gYXR0cmlidXRl
IG9uIHlvdXIgbW9kZWwuIFBsZWFzZSByZW1vdmUgYW55IGxpbmVzIHRoYXQgbG9vayBsaWtlOiBg
aWQ6IERTLmF0dHIoJzx0eXBlPicpYCBmcm9tICIgKyB0aGlzLmNvbnN0cnVjdG9yLnRvU3RyaW5n
KCksIGtleSAhPT0gJ2lkJyk7CiAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuX2F0dHJpYnV0ZXNb
a2V5XSB8fCB0aGlzLl9pbkZsaWdodEF0dHJpYnV0ZXNba2V5XSB8fCB0aGlzLl9kYXRhW2tleV07
CgogICAgICB0aGlzLnNlbmQoJ2RpZFNldFByb3BlcnR5JywgewogICAgICAgIG5hbWU6IGtleSwK
ICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWUsCiAgICAgICAgb3JpZ2luYWxWYWx1ZTogdGhpcy5f
ZGF0YVtrZXldLAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9KTsKCiAgICAgIHRoaXMuX2F0
dHJpYnV0ZXNba2V5XSA9IHZhbHVlOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYg
KGhhc1ZhbHVlKHRoaXMsIGtleSkpIHsKICAgICAgcmV0dXJuIGdldFZhbHVlKHRoaXMsIGtleSk7
CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZ2V0RGVmYXVsdFZhbHVlKHRoaXMsIG9wdGlvbnMs
IGtleSk7CiAgICB9CgogIC8vIGBkYXRhYCBpcyBuZXZlciBzZXQgZGlyZWN0bHkuIEhvd2V2ZXIs
IGl0IG1heSBiZQogIC8vIGludmFsaWRhdGVkIGZyb20gdGhlIHN0YXRlIG1hbmFnZXIncyBzZXRE
YXRhCiAgLy8gZXZlbnQuCiAgfSkucHJvcGVydHkoJ2RhdGEnKS5tZXRhKG1ldGEpOwp9OwoKCn0p
KCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKLyoqCiAgQW4gQXR0
cmlidXRlQ2hhbmdlIG9iamVjdCBpcyBjcmVhdGVkIHdoZW5ldmVyIGEgcmVjb3JkJ3MKICBhdHRy
aWJ1dGUgY2hhbmdlcyB2YWx1ZS4gSXQgaXMgdXNlZCB0byB0cmFjayBjaGFuZ2VzIHRvIGEKICBy
ZWNvcmQgYmV0d2VlbiB0cmFuc2FjdGlvbiBjb21taXRzLgoKICBAY2xhc3MgQXR0cmlidXRlQ2hh
bmdlCiAgQG5hbWVzcGFjZSBEUwogIEBwcml2YXRlCiAgQGNvbnN0cnVjdG9yCiovCnZhciBBdHRy
aWJ1dGVDaGFuZ2UgPSBEUy5BdHRyaWJ1dGVDaGFuZ2UgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAg
dGhpcy5yZWNvcmQgPSBvcHRpb25zLnJlY29yZDsKICB0aGlzLnN0b3JlID0gb3B0aW9ucy5zdG9y
ZTsKICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7CiAgdGhpcy52YWx1ZSA9IG9wdGlvbnMudmFs
dWU7CiAgdGhpcy5vbGRWYWx1ZSA9IG9wdGlvbnMub2xkVmFsdWU7Cn07CgpBdHRyaWJ1dGVDaGFu
Z2UuY3JlYXRlQ2hhbmdlID0gZnVuY3Rpb24ob3B0aW9ucykgewogIHJldHVybiBuZXcgQXR0cmli
dXRlQ2hhbmdlKG9wdGlvbnMpOwp9OwoKQXR0cmlidXRlQ2hhbmdlLnByb3RvdHlwZSA9IHsKICBz
eW5jOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLnZhbHVlICE9PSB0aGlzLm9sZFZhbHVlKSB7
CiAgICAgIHRoaXMucmVjb3JkLnNlbmQoJ2JlY29tZURpcnR5Jyk7CiAgICAgIHRoaXMucmVjb3Jk
LnVwZGF0ZVJlY29yZEFycmF5c0xhdGVyKCk7CiAgICB9CgogICAgLy8gVE9ETzogVXNlIHRoaXMg
b2JqZWN0IGluIHRoZSBjb21taXQgcHJvY2VzcwogICAgdGhpcy5kZXN0cm95KCk7CiAgfSwKCiAg
LyoqCiAgICBJZiB0aGUgQXR0cmlidXRlQ2hhbmdlIGlzIGRlc3Ryb3llZCAoZWl0aGVyIGJ5IGJl
aW5nIHJvbGxlZCBiYWNrCiAgICBvciBiZWluZyBjb21taXR0ZWQpLCByZW1vdmUgaXQgZnJvbSB0
aGUgbGlzdCBvZiBwZW5kaW5nIGNoYW5nZXMKICAgIG9uIHRoZSByZWNvcmQuCgogICAgQG1ldGhv
ZCBkZXN0cm95CiAgKi8KICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIGRlbGV0ZSB0aGlzLnJl
Y29yZC5fY2hhbmdlc1RvU3luY1t0aGlzLm5hbWVdOwogIH0KfTsKCn0pKCk7CgoKCihmdW5jdGlv
bigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBz
ZXQgPSBFbWJlci5zZXQ7CnZhciBmb3JFYWNoID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmZvckVh
Y2g7CgovKioKICBAY2xhc3MgUmVsYXRpb25zaGlwQ2hhbmdlCiAgQG5hbWVzcGFjZSBEUwogIEBw
cml2YXRlCiAgQGNvbnN0cnV0b3IKKi8KRFMuUmVsYXRpb25zaGlwQ2hhbmdlID0gZnVuY3Rpb24o
b3B0aW9ucykgewogIHRoaXMucGFyZW50UmVjb3JkID0gb3B0aW9ucy5wYXJlbnRSZWNvcmQ7CiAg
dGhpcy5jaGlsZFJlY29yZCA9IG9wdGlvbnMuY2hpbGRSZWNvcmQ7CiAgdGhpcy5maXJzdFJlY29y
ZCA9IG9wdGlvbnMuZmlyc3RSZWNvcmQ7CiAgdGhpcy5maXJzdFJlY29yZEtpbmQgPSBvcHRpb25z
LmZpcnN0UmVjb3JkS2luZDsKICB0aGlzLmZpcnN0UmVjb3JkTmFtZSA9IG9wdGlvbnMuZmlyc3RS
ZWNvcmROYW1lOwogIHRoaXMuc2Vjb25kUmVjb3JkID0gb3B0aW9ucy5zZWNvbmRSZWNvcmQ7CiAg
dGhpcy5zZWNvbmRSZWNvcmRLaW5kID0gb3B0aW9ucy5zZWNvbmRSZWNvcmRLaW5kOwogIHRoaXMu
c2Vjb25kUmVjb3JkTmFtZSA9IG9wdGlvbnMuc2Vjb25kUmVjb3JkTmFtZTsKICB0aGlzLmNoYW5n
ZVR5cGUgPSBvcHRpb25zLmNoYW5nZVR5cGU7CiAgdGhpcy5zdG9yZSA9IG9wdGlvbnMuc3RvcmU7
CgogIHRoaXMuY29tbWl0dGVkID0ge307Cn07CgovKioKICBAY2xhc3MgUmVsYXRpb25zaGlwQ2hh
bmdlQWRkCiAgQG5hbWVzcGFjZSBEUwogIEBwcml2YXRlCiAgQGNvbnN0cnV0b3IKKi8KRFMuUmVs
YXRpb25zaGlwQ2hhbmdlQWRkID0gZnVuY3Rpb24ob3B0aW9ucyl7CiAgRFMuUmVsYXRpb25zaGlw
Q2hhbmdlLmNhbGwodGhpcywgb3B0aW9ucyk7Cn07CgovKioKICBAY2xhc3MgUmVsYXRpb25zaGlw
Q2hhbmdlUmVtb3ZlCiAgQG5hbWVzcGFjZSBEUwogIEBwcml2YXRlCiAgQGNvbnN0cnV0b3IKKi8K
RFMuUmVsYXRpb25zaGlwQ2hhbmdlUmVtb3ZlID0gZnVuY3Rpb24ob3B0aW9ucyl7CiAgRFMuUmVs
YXRpb25zaGlwQ2hhbmdlLmNhbGwodGhpcywgb3B0aW9ucyk7Cn07CgpEUy5SZWxhdGlvbnNoaXBD
aGFuZ2UuY3JlYXRlID0gZnVuY3Rpb24ob3B0aW9ucykgewogIHJldHVybiBuZXcgRFMuUmVsYXRp
b25zaGlwQ2hhbmdlKG9wdGlvbnMpOwp9OwoKRFMuUmVsYXRpb25zaGlwQ2hhbmdlQWRkLmNyZWF0
ZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICByZXR1cm4gbmV3IERTLlJlbGF0aW9uc2hpcENoYW5n
ZUFkZChvcHRpb25zKTsKfTsKCkRTLlJlbGF0aW9uc2hpcENoYW5nZVJlbW92ZS5jcmVhdGUgPSBm
dW5jdGlvbihvcHRpb25zKSB7CiAgcmV0dXJuIG5ldyBEUy5SZWxhdGlvbnNoaXBDaGFuZ2VSZW1v
dmUob3B0aW9ucyk7Cn07CgpEUy5PbmVUb01hbnlDaGFuZ2UgPSB7fTsKRFMuT25lVG9Ob25lQ2hh
bmdlID0ge307CkRTLk1hbnlUb05vbmVDaGFuZ2UgPSB7fTsKRFMuT25lVG9PbmVDaGFuZ2UgPSB7
fTsKRFMuTWFueVRvTWFueUNoYW5nZSA9IHt9OwoKRFMuUmVsYXRpb25zaGlwQ2hhbmdlLl9jcmVh
dGVDaGFuZ2UgPSBmdW5jdGlvbihvcHRpb25zKXsKICBpZihvcHRpb25zLmNoYW5nZVR5cGUgPT09
ICJhZGQiKXsKICAgIHJldHVybiBEUy5SZWxhdGlvbnNoaXBDaGFuZ2VBZGQuY3JlYXRlKG9wdGlv
bnMpOwogIH0KICBpZihvcHRpb25zLmNoYW5nZVR5cGUgPT09ICJyZW1vdmUiKXsKICAgIHJldHVy
biBEUy5SZWxhdGlvbnNoaXBDaGFuZ2VSZW1vdmUuY3JlYXRlKG9wdGlvbnMpOwogIH0KfTsKCgpE
Uy5SZWxhdGlvbnNoaXBDaGFuZ2UuZGV0ZXJtaW5lUmVsYXRpb25zaGlwVHlwZSA9IGZ1bmN0aW9u
KHJlY29yZFR5cGUsIGtub3duU2lkZSl7CiAgdmFyIGtub3duS2V5ID0ga25vd25TaWRlLmtleSwg
a2V5LCBvdGhlcktpbmQ7CiAgdmFyIGtub3duS2luZCA9IGtub3duU2lkZS5raW5kOwoKICB2YXIg
aW52ZXJzZSA9IHJlY29yZFR5cGUuaW52ZXJzZUZvcihrbm93bktleSk7CgogIGlmIChpbnZlcnNl
KXsKICAgIGtleSA9IGludmVyc2UubmFtZTsKICAgIG90aGVyS2luZCA9IGludmVyc2Uua2luZDsK
ICB9CgogIGlmICghaW52ZXJzZSl7CiAgICByZXR1cm4ga25vd25LaW5kID09PSAiYmVsb25nc1Rv
IiA/ICJvbmVUb05vbmUiIDogIm1hbnlUb05vbmUiOwogIH0KICBlbHNlewogICAgaWYob3RoZXJL
aW5kID09PSAiYmVsb25nc1RvIil7CiAgICAgIHJldHVybiBrbm93bktpbmQgPT09ICJiZWxvbmdz
VG8iID8gIm9uZVRvT25lIiA6ICJtYW55VG9PbmUiOwogICAgfQogICAgZWxzZXsKICAgICAgcmV0
dXJuIGtub3duS2luZCA9PT0gImJlbG9uZ3NUbyIgPyAib25lVG9NYW55IiA6ICJtYW55VG9NYW55
IjsKICAgIH0KICB9Cgp9OwoKRFMuUmVsYXRpb25zaGlwQ2hhbmdlLmNyZWF0ZUNoYW5nZSA9IGZ1
bmN0aW9uKGZpcnN0UmVjb3JkLCBzZWNvbmRSZWNvcmQsIHN0b3JlLCBvcHRpb25zKXsKICAvLyBH
ZXQgdGhlIHR5cGUgb2YgdGhlIGNoaWxkIGJhc2VkIG9uIHRoZSBjaGlsZCdzIGNsaWVudCBJRAog
IHZhciBmaXJzdFJlY29yZFR5cGUgPSBmaXJzdFJlY29yZC5jb25zdHJ1Y3RvciwgY2hhbmdlVHlw
ZTsKICBjaGFuZ2VUeXBlID0gRFMuUmVsYXRpb25zaGlwQ2hhbmdlLmRldGVybWluZVJlbGF0aW9u
c2hpcFR5cGUoZmlyc3RSZWNvcmRUeXBlLCBvcHRpb25zKTsKICBpZiAoY2hhbmdlVHlwZSA9PT0g
Im9uZVRvTWFueSIpewogICAgcmV0dXJuIERTLk9uZVRvTWFueUNoYW5nZS5jcmVhdGVDaGFuZ2Uo
Zmlyc3RSZWNvcmQsIHNlY29uZFJlY29yZCwgc3RvcmUsIG9wdGlvbnMpOwogIH0KICBlbHNlIGlm
IChjaGFuZ2VUeXBlID09PSAibWFueVRvT25lIil7CiAgICByZXR1cm4gRFMuT25lVG9NYW55Q2hh
bmdlLmNyZWF0ZUNoYW5nZShzZWNvbmRSZWNvcmQsIGZpcnN0UmVjb3JkLCBzdG9yZSwgb3B0aW9u
cyk7CiAgfQogIGVsc2UgaWYgKGNoYW5nZVR5cGUgPT09ICJvbmVUb05vbmUiKXsKICAgIHJldHVy
biBEUy5PbmVUb05vbmVDaGFuZ2UuY3JlYXRlQ2hhbmdlKGZpcnN0UmVjb3JkLCBzZWNvbmRSZWNv
cmQsIHN0b3JlLCBvcHRpb25zKTsKICB9CiAgZWxzZSBpZiAoY2hhbmdlVHlwZSA9PT0gIm1hbnlU
b05vbmUiKXsKICAgIHJldHVybiBEUy5NYW55VG9Ob25lQ2hhbmdlLmNyZWF0ZUNoYW5nZShmaXJz
dFJlY29yZCwgc2Vjb25kUmVjb3JkLCBzdG9yZSwgb3B0aW9ucyk7CiAgfQogIGVsc2UgaWYgKGNo
YW5nZVR5cGUgPT09ICJvbmVUb09uZSIpewogICAgcmV0dXJuIERTLk9uZVRvT25lQ2hhbmdlLmNy
ZWF0ZUNoYW5nZShmaXJzdFJlY29yZCwgc2Vjb25kUmVjb3JkLCBzdG9yZSwgb3B0aW9ucyk7CiAg
fQogIGVsc2UgaWYgKGNoYW5nZVR5cGUgPT09ICJtYW55VG9NYW55Iil7CiAgICByZXR1cm4gRFMu
TWFueVRvTWFueUNoYW5nZS5jcmVhdGVDaGFuZ2UoZmlyc3RSZWNvcmQsIHNlY29uZFJlY29yZCwg
c3RvcmUsIG9wdGlvbnMpOwogIH0KfTsKCkRTLk9uZVRvTm9uZUNoYW5nZS5jcmVhdGVDaGFuZ2Ug
PSBmdW5jdGlvbihjaGlsZFJlY29yZCwgcGFyZW50UmVjb3JkLCBzdG9yZSwgb3B0aW9ucykgewog
IHZhciBrZXkgPSBvcHRpb25zLmtleTsKICB2YXIgY2hhbmdlID0gRFMuUmVsYXRpb25zaGlwQ2hh
bmdlLl9jcmVhdGVDaGFuZ2UoewogICAgICBwYXJlbnRSZWNvcmQ6IHBhcmVudFJlY29yZCwKICAg
ICAgY2hpbGRSZWNvcmQ6IGNoaWxkUmVjb3JkLAogICAgICBmaXJzdFJlY29yZDogY2hpbGRSZWNv
cmQsCiAgICAgIHN0b3JlOiBzdG9yZSwKICAgICAgY2hhbmdlVHlwZTogb3B0aW9ucy5jaGFuZ2VU
eXBlLAogICAgICBmaXJzdFJlY29yZE5hbWU6IGtleSwKICAgICAgZmlyc3RSZWNvcmRLaW5kOiAi
YmVsb25nc1RvIgogIH0pOwoKICBzdG9yZS5hZGRSZWxhdGlvbnNoaXBDaGFuZ2VGb3IoY2hpbGRS
ZWNvcmQsIGtleSwgcGFyZW50UmVjb3JkLCBudWxsLCBjaGFuZ2UpOwoKICByZXR1cm4gY2hhbmdl
Owp9OwoKRFMuTWFueVRvTm9uZUNoYW5nZS5jcmVhdGVDaGFuZ2UgPSBmdW5jdGlvbihjaGlsZFJl
Y29yZCwgcGFyZW50UmVjb3JkLCBzdG9yZSwgb3B0aW9ucykgewogIHZhciBrZXkgPSBvcHRpb25z
LmtleTsKICB2YXIgY2hhbmdlID0gRFMuUmVsYXRpb25zaGlwQ2hhbmdlLl9jcmVhdGVDaGFuZ2Uo
ewogICAgICBwYXJlbnRSZWNvcmQ6IGNoaWxkUmVjb3JkLAogICAgICBjaGlsZFJlY29yZDogcGFy
ZW50UmVjb3JkLAogICAgICBzZWNvbmRSZWNvcmQ6IGNoaWxkUmVjb3JkLAogICAgICBzdG9yZTog
c3RvcmUsCiAgICAgIGNoYW5nZVR5cGU6IG9wdGlvbnMuY2hhbmdlVHlwZSwKICAgICAgc2Vjb25k
UmVjb3JkTmFtZTogb3B0aW9ucy5rZXksCiAgICAgIHNlY29uZFJlY29yZEtpbmQ6ICJoYXNNYW55
IgogIH0pOwoKICBzdG9yZS5hZGRSZWxhdGlvbnNoaXBDaGFuZ2VGb3IoY2hpbGRSZWNvcmQsIGtl
eSwgcGFyZW50UmVjb3JkLCBudWxsLCBjaGFuZ2UpOwogIHJldHVybiBjaGFuZ2U7Cn07CgoKRFMu
TWFueVRvTWFueUNoYW5nZS5jcmVhdGVDaGFuZ2UgPSBmdW5jdGlvbihjaGlsZFJlY29yZCwgcGFy
ZW50UmVjb3JkLCBzdG9yZSwgb3B0aW9ucykgewogIC8vIElmIHRoZSBuYW1lIG9mIHRoZSBiZWxv
bmdzVG8gc2lkZSBvZiB0aGUgcmVsYXRpb25zaGlwIGlzIHNwZWNpZmllZCwKICAvLyB1c2UgdGhh
dAogIC8vIElmIHRoZSB0eXBlIG9mIHRoZSBwYXJlbnQgaXMgc3BlY2lmaWVkLCBsb29rIGl0IHVw
IG9uIHRoZSBjaGlsZCdzIHR5cGUKICAvLyBkZWZpbml0aW9uLgogIHZhciBrZXkgPSBvcHRpb25z
LmtleTsKCiAgdmFyIGNoYW5nZSA9IERTLlJlbGF0aW9uc2hpcENoYW5nZS5fY3JlYXRlQ2hhbmdl
KHsKICAgICAgcGFyZW50UmVjb3JkOiBwYXJlbnRSZWNvcmQsCiAgICAgIGNoaWxkUmVjb3JkOiBj
aGlsZFJlY29yZCwKICAgICAgZmlyc3RSZWNvcmQ6IGNoaWxkUmVjb3JkLAogICAgICBzZWNvbmRS
ZWNvcmQ6IHBhcmVudFJlY29yZCwKICAgICAgZmlyc3RSZWNvcmRLaW5kOiAiaGFzTWFueSIsCiAg
ICAgIHNlY29uZFJlY29yZEtpbmQ6ICJoYXNNYW55IiwKICAgICAgc3RvcmU6IHN0b3JlLAogICAg
ICBjaGFuZ2VUeXBlOiBvcHRpb25zLmNoYW5nZVR5cGUsCiAgICAgIGZpcnN0UmVjb3JkTmFtZTog
IGtleQogIH0pOwoKICBzdG9yZS5hZGRSZWxhdGlvbnNoaXBDaGFuZ2VGb3IoY2hpbGRSZWNvcmQs
IGtleSwgcGFyZW50UmVjb3JkLCBudWxsLCBjaGFuZ2UpOwoKCiAgcmV0dXJuIGNoYW5nZTsKfTsK
CkRTLk9uZVRvT25lQ2hhbmdlLmNyZWF0ZUNoYW5nZSA9IGZ1bmN0aW9uKGNoaWxkUmVjb3JkLCBw
YXJlbnRSZWNvcmQsIHN0b3JlLCBvcHRpb25zKSB7CiAgdmFyIGtleTsKCiAgLy8gSWYgdGhlIG5h
bWUgb2YgdGhlIGJlbG9uZ3NUbyBzaWRlIG9mIHRoZSByZWxhdGlvbnNoaXAgaXMgc3BlY2lmaWVk
LAogIC8vIHVzZSB0aGF0CiAgLy8gSWYgdGhlIHR5cGUgb2YgdGhlIHBhcmVudCBpcyBzcGVjaWZp
ZWQsIGxvb2sgaXQgdXAgb24gdGhlIGNoaWxkJ3MgdHlwZQogIC8vIGRlZmluaXRpb24uCiAgaWYg
KG9wdGlvbnMucGFyZW50VHlwZSkgewogICAga2V5ID0gb3B0aW9ucy5wYXJlbnRUeXBlLmludmVy
c2VGb3Iob3B0aW9ucy5rZXkpLm5hbWU7CiAgfSBlbHNlIGlmIChvcHRpb25zLmtleSkgewogICAg
a2V5ID0gb3B0aW9ucy5rZXk7CiAgfSBlbHNlIHsKICAgIEVtYmVyLmFzc2VydCgiWW91IG11c3Qg
cGFzcyBlaXRoZXIgYSBwYXJlbnRUeXBlIG9yIGJlbG9uZ3NUb05hbWUgb3B0aW9uIHRvIE9uZVRv
TWFueUNoYW5nZS5mb3JDaGlsZEFuZFBhcmVudCIsIGZhbHNlKTsKICB9CgogIHZhciBjaGFuZ2Ug
PSBEUy5SZWxhdGlvbnNoaXBDaGFuZ2UuX2NyZWF0ZUNoYW5nZSh7CiAgICAgIHBhcmVudFJlY29y
ZDogcGFyZW50UmVjb3JkLAogICAgICBjaGlsZFJlY29yZDogY2hpbGRSZWNvcmQsCiAgICAgIGZp
cnN0UmVjb3JkOiBjaGlsZFJlY29yZCwKICAgICAgc2Vjb25kUmVjb3JkOiBwYXJlbnRSZWNvcmQs
CiAgICAgIGZpcnN0UmVjb3JkS2luZDogImJlbG9uZ3NUbyIsCiAgICAgIHNlY29uZFJlY29yZEtp
bmQ6ICJiZWxvbmdzVG8iLAogICAgICBzdG9yZTogc3RvcmUsCiAgICAgIGNoYW5nZVR5cGU6IG9w
dGlvbnMuY2hhbmdlVHlwZSwKICAgICAgZmlyc3RSZWNvcmROYW1lOiAga2V5CiAgfSk7CgogIHN0
b3JlLmFkZFJlbGF0aW9uc2hpcENoYW5nZUZvcihjaGlsZFJlY29yZCwga2V5LCBwYXJlbnRSZWNv
cmQsIG51bGwsIGNoYW5nZSk7CgoKICByZXR1cm4gY2hhbmdlOwp9OwoKRFMuT25lVG9PbmVDaGFu
Z2UubWFpbnRhaW5JbnZhcmlhbnQgPSBmdW5jdGlvbihvcHRpb25zLCBzdG9yZSwgY2hpbGRSZWNv
cmQsIGtleSl7CiAgaWYgKG9wdGlvbnMuY2hhbmdlVHlwZSA9PT0gImFkZCIgJiYgc3RvcmUucmVj
b3JkSXNNYXRlcmlhbGl6ZWQoY2hpbGRSZWNvcmQpKSB7CiAgICB2YXIgb2xkUGFyZW50ID0gZ2V0
KGNoaWxkUmVjb3JkLCBrZXkpOwogICAgaWYgKG9sZFBhcmVudCl7CiAgICAgIHZhciBjb3JyZXNw
b25kaW5nQ2hhbmdlID0gRFMuT25lVG9PbmVDaGFuZ2UuY3JlYXRlQ2hhbmdlKGNoaWxkUmVjb3Jk
LCBvbGRQYXJlbnQsIHN0b3JlLCB7CiAgICAgICAgICBwYXJlbnRUeXBlOiBvcHRpb25zLnBhcmVu
dFR5cGUsCiAgICAgICAgICBoYXNNYW55TmFtZTogb3B0aW9ucy5oYXNNYW55TmFtZSwKICAgICAg
ICAgIGNoYW5nZVR5cGU6ICJyZW1vdmUiLAogICAgICAgICAga2V5OiBvcHRpb25zLmtleQogICAg
ICAgIH0pOwogICAgICBzdG9yZS5hZGRSZWxhdGlvbnNoaXBDaGFuZ2VGb3IoY2hpbGRSZWNvcmQs
IGtleSwgb3B0aW9ucy5wYXJlbnRSZWNvcmQgLCBudWxsLCBjb3JyZXNwb25kaW5nQ2hhbmdlKTsK
ICAgICBjb3JyZXNwb25kaW5nQ2hhbmdlLnN5bmMoKTsKICAgIH0KICB9Cn07CgpEUy5PbmVUb01h
bnlDaGFuZ2UuY3JlYXRlQ2hhbmdlID0gZnVuY3Rpb24oY2hpbGRSZWNvcmQsIHBhcmVudFJlY29y
ZCwgc3RvcmUsIG9wdGlvbnMpIHsKICB2YXIga2V5OwoKICAvLyBJZiB0aGUgbmFtZSBvZiB0aGUg
YmVsb25nc1RvIHNpZGUgb2YgdGhlIHJlbGF0aW9uc2hpcCBpcyBzcGVjaWZpZWQsCiAgLy8gdXNl
IHRoYXQKICAvLyBJZiB0aGUgdHlwZSBvZiB0aGUgcGFyZW50IGlzIHNwZWNpZmllZCwgbG9vayBp
dCB1cCBvbiB0aGUgY2hpbGQncyB0eXBlCiAgLy8gZGVmaW5pdGlvbi4KICBpZiAob3B0aW9ucy5w
YXJlbnRUeXBlKSB7CiAgICBrZXkgPSBvcHRpb25zLnBhcmVudFR5cGUuaW52ZXJzZUZvcihvcHRp
b25zLmtleSkubmFtZTsKICAgIERTLk9uZVRvTWFueUNoYW5nZS5tYWludGFpbkludmFyaWFudCgg
b3B0aW9ucywgc3RvcmUsIGNoaWxkUmVjb3JkLCBrZXkgKTsKICB9IGVsc2UgaWYgKG9wdGlvbnMu
a2V5KSB7CiAgICBrZXkgPSBvcHRpb25zLmtleTsKICB9IGVsc2UgewogICAgRW1iZXIuYXNzZXJ0
KCJZb3UgbXVzdCBwYXNzIGVpdGhlciBhIHBhcmVudFR5cGUgb3IgYmVsb25nc1RvTmFtZSBvcHRp
b24gdG8gT25lVG9NYW55Q2hhbmdlLmZvckNoaWxkQW5kUGFyZW50IiwgZmFsc2UpOwogIH0KCiAg
dmFyIGNoYW5nZSA9IERTLlJlbGF0aW9uc2hpcENoYW5nZS5fY3JlYXRlQ2hhbmdlKHsKICAgICAg
cGFyZW50UmVjb3JkOiBwYXJlbnRSZWNvcmQsCiAgICAgIGNoaWxkUmVjb3JkOiBjaGlsZFJlY29y
ZCwKICAgICAgZmlyc3RSZWNvcmQ6IGNoaWxkUmVjb3JkLAogICAgICBzZWNvbmRSZWNvcmQ6IHBh
cmVudFJlY29yZCwKICAgICAgZmlyc3RSZWNvcmRLaW5kOiAiYmVsb25nc1RvIiwKICAgICAgc2Vj
b25kUmVjb3JkS2luZDogImhhc01hbnkiLAogICAgICBzdG9yZTogc3RvcmUsCiAgICAgIGNoYW5n
ZVR5cGU6IG9wdGlvbnMuY2hhbmdlVHlwZSwKICAgICAgZmlyc3RSZWNvcmROYW1lOiAga2V5CiAg
fSk7CgogIHN0b3JlLmFkZFJlbGF0aW9uc2hpcENoYW5nZUZvcihjaGlsZFJlY29yZCwga2V5LCBw
YXJlbnRSZWNvcmQsIGNoYW5nZS5nZXRTZWNvbmRSZWNvcmROYW1lKCksIGNoYW5nZSk7CgoKICBy
ZXR1cm4gY2hhbmdlOwp9OwoKCkRTLk9uZVRvTWFueUNoYW5nZS5tYWludGFpbkludmFyaWFudCA9
IGZ1bmN0aW9uKG9wdGlvbnMsIHN0b3JlLCBjaGlsZFJlY29yZCwga2V5KXsKICBpZiAob3B0aW9u
cy5jaGFuZ2VUeXBlID09PSAiYWRkIiAmJiBjaGlsZFJlY29yZCkgewogICAgdmFyIG9sZFBhcmVu
dCA9IGdldChjaGlsZFJlY29yZCwga2V5KTsKICAgIGlmIChvbGRQYXJlbnQpewogICAgICB2YXIg
Y29ycmVzcG9uZGluZ0NoYW5nZSA9IERTLk9uZVRvTWFueUNoYW5nZS5jcmVhdGVDaGFuZ2UoY2hp
bGRSZWNvcmQsIG9sZFBhcmVudCwgc3RvcmUsIHsKICAgICAgICAgIHBhcmVudFR5cGU6IG9wdGlv
bnMucGFyZW50VHlwZSwKICAgICAgICAgIGhhc01hbnlOYW1lOiBvcHRpb25zLmhhc01hbnlOYW1l
LAogICAgICAgICAgY2hhbmdlVHlwZTogInJlbW92ZSIsCiAgICAgICAgICBrZXk6IG9wdGlvbnMu
a2V5CiAgICAgICAgfSk7CiAgICAgIHN0b3JlLmFkZFJlbGF0aW9uc2hpcENoYW5nZUZvcihjaGls
ZFJlY29yZCwga2V5LCBvcHRpb25zLnBhcmVudFJlY29yZCwgY29ycmVzcG9uZGluZ0NoYW5nZS5n
ZXRTZWNvbmRSZWNvcmROYW1lKCksIGNvcnJlc3BvbmRpbmdDaGFuZ2UpOwogICAgICBjb3JyZXNw
b25kaW5nQ2hhbmdlLnN5bmMoKTsKICAgIH0KICB9Cn07CgovKioKICBAY2xhc3MgUmVsYXRpb25z
aGlwQ2hhbmdlCiAgQG5hbWVzcGFjZSBEUwoqLwpEUy5SZWxhdGlvbnNoaXBDaGFuZ2UucHJvdG90
eXBlID0gewoKICBnZXRTZWNvbmRSZWNvcmROYW1lOiBmdW5jdGlvbigpIHsKICAgIHZhciBuYW1l
ID0gdGhpcy5zZWNvbmRSZWNvcmROYW1lLCBwYXJlbnQ7CgogICAgaWYgKCFuYW1lKSB7CiAgICAg
IHBhcmVudCA9IHRoaXMuc2Vjb25kUmVjb3JkOwogICAgICBpZiAoIXBhcmVudCkgeyByZXR1cm47
IH0KCiAgICAgIHZhciBjaGlsZFR5cGUgPSB0aGlzLmZpcnN0UmVjb3JkLmNvbnN0cnVjdG9yOwog
ICAgICB2YXIgaW52ZXJzZSA9IGNoaWxkVHlwZS5pbnZlcnNlRm9yKHRoaXMuZmlyc3RSZWNvcmRO
YW1lKTsKICAgICAgdGhpcy5zZWNvbmRSZWNvcmROYW1lID0gaW52ZXJzZS5uYW1lOwogICAgfQoK
ICAgIHJldHVybiB0aGlzLnNlY29uZFJlY29yZE5hbWU7CiAgfSwKCiAgLyoqCiAgICBHZXQgdGhl
IG5hbWUgb2YgdGhlIHJlbGF0aW9uc2hpcCBvbiB0aGUgYmVsb25nc1RvIHNpZGUuCgogICAgQG1l
dGhvZCBnZXRGaXJzdFJlY29yZE5hbWUKICAgIEByZXR1cm4ge1N0cmluZ30KICAqLwogIGdldEZp
cnN0UmVjb3JkTmFtZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgbmFtZSA9IHRoaXMuZmlyc3RSZWNv
cmROYW1lOwogICAgcmV0dXJuIG5hbWU7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGRlc3Ryb3kK
ICAgIEBwcml2YXRlCiAgKi8KICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIHZhciBjaGlsZFJl
Y29yZCA9IHRoaXMuY2hpbGRSZWNvcmQsCiAgICAgICAgYmVsb25nc1RvTmFtZSA9IHRoaXMuZ2V0
Rmlyc3RSZWNvcmROYW1lKCksCiAgICAgICAgaGFzTWFueU5hbWUgPSB0aGlzLmdldFNlY29uZFJl
Y29yZE5hbWUoKSwKICAgICAgICBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgc3RvcmUucmVtb3Zl
UmVsYXRpb25zaGlwQ2hhbmdlRm9yKGNoaWxkUmVjb3JkLCBiZWxvbmdzVG9OYW1lLCB0aGlzLnBh
cmVudFJlY29yZCwgaGFzTWFueU5hbWUsIHRoaXMuY2hhbmdlVHlwZSk7CiAgfSwKCiAgZ2V0U2Vj
b25kUmVjb3JkOiBmdW5jdGlvbigpewogICAgcmV0dXJuIHRoaXMuc2Vjb25kUmVjb3JkOwogIH0s
CgogIC8qKgogICAgQG1ldGhvZCBnZXRGaXJzdFJlY29yZAogICAgQHByaXZhdGUKICAqLwogIGdl
dEZpcnN0UmVjb3JkOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmZpcnN0UmVjb3JkOwog
IH0sCgogIGNvYWxlc2NlOiBmdW5jdGlvbigpewogICAgdmFyIHJlbGF0aW9uc2hpcFBhaXJzID0g
dGhpcy5zdG9yZS5yZWxhdGlvbnNoaXBDaGFuZ2VQYWlyc0Zvcih0aGlzLmZpcnN0UmVjb3JkKTsK
ICAgIGZvckVhY2gocmVsYXRpb25zaGlwUGFpcnMsIGZ1bmN0aW9uKHBhaXIpewogICAgICB2YXIg
YWRkZWRDaGFuZ2UgPSBwYWlyWyJhZGQiXTsKICAgICAgdmFyIHJlbW92ZWRDaGFuZ2UgPSBwYWly
WyJyZW1vdmUiXTsKICAgICAgaWYoYWRkZWRDaGFuZ2UgJiYgcmVtb3ZlZENoYW5nZSkgewogICAg
ICAgIGFkZGVkQ2hhbmdlLmRlc3Ryb3koKTsKICAgICAgICByZW1vdmVkQ2hhbmdlLmRlc3Ryb3ko
KTsKICAgICAgfQogICAgfSk7CiAgfQp9OwoKRFMuUmVsYXRpb25zaGlwQ2hhbmdlQWRkLnByb3Rv
dHlwZSA9IEVtYmVyLmNyZWF0ZShEUy5SZWxhdGlvbnNoaXBDaGFuZ2UuY3JlYXRlKHt9KSk7CkRT
LlJlbGF0aW9uc2hpcENoYW5nZVJlbW92ZS5wcm90b3R5cGUgPSBFbWJlci5jcmVhdGUoRFMuUmVs
YXRpb25zaGlwQ2hhbmdlLmNyZWF0ZSh7fSkpOwoKLy8gdGhlIG9iamVjdCBpcyBhIHZhbHVlLCBh
bmQgbm90IGEgcHJvbWlzZQpmdW5jdGlvbiBpc1ZhbHVlKG9iamVjdCkgewogIHJldHVybiB0eXBl
b2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiAoIW9iamVjdC50aGVuIHx8IHR5cGVvZiBvYmplY3Qu
dGhlbiAhPT0gJ2Z1bmN0aW9uJyk7Cn0KCkRTLlJlbGF0aW9uc2hpcENoYW5nZUFkZC5wcm90b3R5
cGUuY2hhbmdlVHlwZSA9ICJhZGQiOwpEUy5SZWxhdGlvbnNoaXBDaGFuZ2VBZGQucHJvdG90eXBl
LnN5bmMgPSBmdW5jdGlvbigpIHsKICB2YXIgc2Vjb25kUmVjb3JkTmFtZSA9IHRoaXMuZ2V0U2Vj
b25kUmVjb3JkTmFtZSgpLAogICAgICBmaXJzdFJlY29yZE5hbWUgPSB0aGlzLmdldEZpcnN0UmVj
b3JkTmFtZSgpLAogICAgICBmaXJzdFJlY29yZCA9IHRoaXMuZ2V0Rmlyc3RSZWNvcmQoKSwKICAg
ICAgc2Vjb25kUmVjb3JkID0gdGhpcy5nZXRTZWNvbmRSZWNvcmQoKTsKCiAgLy9FbWJlci5hc3Nl
cnQoIllvdSBzcGVjaWZpZWQgYSBoYXNNYW55ICgiICsgaGFzTWFueU5hbWUgKyAiKSBvbiAiICsg
KCFiZWxvbmdzVG9OYW1lICYmIChuZXdQYXJlbnQgfHwgb2xkUGFyZW50IHx8IHRoaXMubGFzdFBh
cmVudCkuY29uc3RydWN0b3IpICsgIiBidXQgZGlkIG5vdCBzcGVjaWZ5IGFuIGludmVyc2UgYmVs
b25nc1RvIG9uICIgKyBjaGlsZC5jb25zdHJ1Y3RvciwgYmVsb25nc1RvTmFtZSk7CiAgLy9FbWJl
ci5hc3NlcnQoIllvdSBzcGVjaWZpZWQgYSBiZWxvbmdzVG8gKCIgKyBiZWxvbmdzVG9OYW1lICsg
Iikgb24gIiArIGNoaWxkLmNvbnN0cnVjdG9yICsgIiBidXQgZGlkIG5vdCBzcGVjaWZ5IGFuIGlu
dmVyc2UgaGFzTWFueSBvbiAiICsgKCFoYXNNYW55TmFtZSAmJiAobmV3UGFyZW50IHx8IG9sZFBh
cmVudCB8fCB0aGlzLmxhc3RQYXJlbnRSZWNvcmQpLmNvbnN0cnVjdG9yKSwgaGFzTWFueU5hbWUp
OwoKICBpZiAoc2Vjb25kUmVjb3JkIGluc3RhbmNlb2YgRFMuTW9kZWwgJiYgZmlyc3RSZWNvcmQg
aW5zdGFuY2VvZiBEUy5Nb2RlbCkgewogICAgaWYodGhpcy5zZWNvbmRSZWNvcmRLaW5kID09PSAi
YmVsb25nc1RvIil7CiAgICAgIHNlY29uZFJlY29yZC5zdXNwZW5kUmVsYXRpb25zaGlwT2JzZXJ2
ZXJzKGZ1bmN0aW9uKCl7CiAgICAgICAgc2V0KHNlY29uZFJlY29yZCwgc2Vjb25kUmVjb3JkTmFt
ZSwgZmlyc3RSZWNvcmQpOwogICAgICB9KTsKCiAgICAgfQogICAgIGVsc2UgaWYodGhpcy5zZWNv
bmRSZWNvcmRLaW5kID09PSAiaGFzTWFueSIpewogICAgICBzZWNvbmRSZWNvcmQuc3VzcGVuZFJl
bGF0aW9uc2hpcE9ic2VydmVycyhmdW5jdGlvbigpewogICAgICAgIHZhciByZWxhdGlvbnNoaXAg
PSBnZXQoc2Vjb25kUmVjb3JkLCBzZWNvbmRSZWNvcmROYW1lKTsKICAgICAgICBpZiAoaXNWYWx1
ZShyZWxhdGlvbnNoaXApKSB7IHJlbGF0aW9uc2hpcC5hZGRPYmplY3QoZmlyc3RSZWNvcmQpOyB9
CiAgICAgIH0pOwogICAgfQogIH0KCiAgaWYgKGZpcnN0UmVjb3JkIGluc3RhbmNlb2YgRFMuTW9k
ZWwgJiYgc2Vjb25kUmVjb3JkIGluc3RhbmNlb2YgRFMuTW9kZWwgJiYgZ2V0KGZpcnN0UmVjb3Jk
LCBmaXJzdFJlY29yZE5hbWUpICE9PSBzZWNvbmRSZWNvcmQpIHsKICAgIGlmKHRoaXMuZmlyc3RS
ZWNvcmRLaW5kID09PSAiYmVsb25nc1RvIil7CiAgICAgIGZpcnN0UmVjb3JkLnN1c3BlbmRSZWxh
dGlvbnNoaXBPYnNlcnZlcnMoZnVuY3Rpb24oKXsKICAgICAgICBzZXQoZmlyc3RSZWNvcmQsIGZp
cnN0UmVjb3JkTmFtZSwgc2Vjb25kUmVjb3JkKTsKICAgICAgfSk7CiAgICB9CiAgICBlbHNlIGlm
KHRoaXMuZmlyc3RSZWNvcmRLaW5kID09PSAiaGFzTWFueSIpewogICAgICBmaXJzdFJlY29yZC5z
dXNwZW5kUmVsYXRpb25zaGlwT2JzZXJ2ZXJzKGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIHJlbGF0
aW9uc2hpcCA9IGdldChmaXJzdFJlY29yZCwgZmlyc3RSZWNvcmROYW1lKTsKICAgICAgICBpZiAo
aXNWYWx1ZShyZWxhdGlvbnNoaXApKSB7IHJlbGF0aW9uc2hpcC5hZGRPYmplY3Qoc2Vjb25kUmVj
b3JkKTsgfQogICAgICB9KTsKICAgIH0KICB9CgogIHRoaXMuY29hbGVzY2UoKTsKfTsKCkRTLlJl
bGF0aW9uc2hpcENoYW5nZVJlbW92ZS5wcm90b3R5cGUuY2hhbmdlVHlwZSA9ICJyZW1vdmUiOwpE
Uy5SZWxhdGlvbnNoaXBDaGFuZ2VSZW1vdmUucHJvdG90eXBlLnN5bmMgPSBmdW5jdGlvbigpIHsK
ICB2YXIgc2Vjb25kUmVjb3JkTmFtZSA9IHRoaXMuZ2V0U2Vjb25kUmVjb3JkTmFtZSgpLAogICAg
ICBmaXJzdFJlY29yZE5hbWUgPSB0aGlzLmdldEZpcnN0UmVjb3JkTmFtZSgpLAogICAgICBmaXJz
dFJlY29yZCA9IHRoaXMuZ2V0Rmlyc3RSZWNvcmQoKSwKICAgICAgc2Vjb25kUmVjb3JkID0gdGhp
cy5nZXRTZWNvbmRSZWNvcmQoKTsKCiAgLy9FbWJlci5hc3NlcnQoIllvdSBzcGVjaWZpZWQgYSBo
YXNNYW55ICgiICsgaGFzTWFueU5hbWUgKyAiKSBvbiAiICsgKCFiZWxvbmdzVG9OYW1lICYmIChu
ZXdQYXJlbnQgfHwgb2xkUGFyZW50IHx8IHRoaXMubGFzdFBhcmVudCkuY29uc3RydWN0b3IpICsg
IiBidXQgZGlkIG5vdCBzcGVjaWZ5IGFuIGludmVyc2UgYmVsb25nc1RvIG9uICIgKyBjaGlsZC5j
b25zdHJ1Y3RvciwgYmVsb25nc1RvTmFtZSk7CiAgLy9FbWJlci5hc3NlcnQoIllvdSBzcGVjaWZp
ZWQgYSBiZWxvbmdzVG8gKCIgKyBiZWxvbmdzVG9OYW1lICsgIikgb24gIiArIGNoaWxkLmNvbnN0
cnVjdG9yICsgIiBidXQgZGlkIG5vdCBzcGVjaWZ5IGFuIGludmVyc2UgaGFzTWFueSBvbiAiICsg
KCFoYXNNYW55TmFtZSAmJiAobmV3UGFyZW50IHx8IG9sZFBhcmVudCB8fCB0aGlzLmxhc3RQYXJl
bnRSZWNvcmQpLmNvbnN0cnVjdG9yKSwgaGFzTWFueU5hbWUpOwoKICBpZiAoc2Vjb25kUmVjb3Jk
IGluc3RhbmNlb2YgRFMuTW9kZWwgJiYgZmlyc3RSZWNvcmQgaW5zdGFuY2VvZiBEUy5Nb2RlbCkg
ewogICAgaWYodGhpcy5zZWNvbmRSZWNvcmRLaW5kID09PSAiYmVsb25nc1RvIil7CiAgICAgIHNl
Y29uZFJlY29yZC5zdXNwZW5kUmVsYXRpb25zaGlwT2JzZXJ2ZXJzKGZ1bmN0aW9uKCl7CiAgICAg
ICAgc2V0KHNlY29uZFJlY29yZCwgc2Vjb25kUmVjb3JkTmFtZSwgbnVsbCk7CiAgICAgIH0pOwog
ICAgfQogICAgZWxzZSBpZih0aGlzLnNlY29uZFJlY29yZEtpbmQgPT09ICJoYXNNYW55Iil7CiAg
ICAgIHNlY29uZFJlY29yZC5zdXNwZW5kUmVsYXRpb25zaGlwT2JzZXJ2ZXJzKGZ1bmN0aW9uKCl7
CiAgICAgICAgdmFyIHJlbGF0aW9uc2hpcCA9IGdldChzZWNvbmRSZWNvcmQsIHNlY29uZFJlY29y
ZE5hbWUpOwogICAgICAgIGlmIChpc1ZhbHVlKHJlbGF0aW9uc2hpcCkpIHsgcmVsYXRpb25zaGlw
LnJlbW92ZU9iamVjdChmaXJzdFJlY29yZCk7IH0KICAgICAgfSk7CiAgICB9CiAgfQoKICBpZiAo
Zmlyc3RSZWNvcmQgaW5zdGFuY2VvZiBEUy5Nb2RlbCAmJiBnZXQoZmlyc3RSZWNvcmQsIGZpcnN0
UmVjb3JkTmFtZSkpIHsKICAgIGlmKHRoaXMuZmlyc3RSZWNvcmRLaW5kID09PSAiYmVsb25nc1Rv
Iil7CiAgICAgIGZpcnN0UmVjb3JkLnN1c3BlbmRSZWxhdGlvbnNoaXBPYnNlcnZlcnMoZnVuY3Rp
b24oKXsKICAgICAgICBzZXQoZmlyc3RSZWNvcmQsIGZpcnN0UmVjb3JkTmFtZSwgbnVsbCk7CiAg
ICAgIH0pOwogICAgIH0KICAgICBlbHNlIGlmKHRoaXMuZmlyc3RSZWNvcmRLaW5kID09PSAiaGFz
TWFueSIpewogICAgICAgZmlyc3RSZWNvcmQuc3VzcGVuZFJlbGF0aW9uc2hpcE9ic2VydmVycyhm
dW5jdGlvbigpewogICAgICAgICB2YXIgcmVsYXRpb25zaGlwID0gZ2V0KGZpcnN0UmVjb3JkLCBm
aXJzdFJlY29yZE5hbWUpOwogICAgICAgICBpZiAoaXNWYWx1ZShyZWxhdGlvbnNoaXApKSB7IHJl
bGF0aW9uc2hpcC5yZW1vdmVPYmplY3Qoc2Vjb25kUmVjb3JkKTsgfQogICAgICB9KTsKICAgIH0K
ICB9CgogIHRoaXMuY29hbGVzY2UoKTsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAg
QG1vZHVsZSBlbWJlci1kYXRhCiovCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBnZXQgPSBF
bWJlci5nZXQsIHNldCA9IEVtYmVyLnNldCwKICAgIGlzTm9uZSA9IEVtYmVyLmlzTm9uZTsKCi8q
KgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKZnVuY3Rpb24gYXN5bmNCZWxvbmdzVG8odHlwZSwg
b3B0aW9ucywgbWV0YSkgewogIHJldHVybiBFbWJlci5jb21wdXRlZChmdW5jdGlvbihrZXksIHZh
bHVlKSB7CiAgICB2YXIgZGF0YSA9IGdldCh0aGlzLCAnZGF0YScpLAogICAgICAgIHN0b3JlID0g
Z2V0KHRoaXMsICdzdG9yZScpLAogICAgICAgIHByb21pc2VMYWJlbCA9ICJEUzogQXN5bmMgYmVs
b25nc1RvICIgKyB0aGlzICsgIiA6ICIgKyBrZXk7CgogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgg
PT09IDIpIHsKICAgICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2FuIG9ubHkgYWRkIGEgJyIgKyB0eXBl
ICsgIicgcmVjb3JkIHRvIHRoaXMgcmVsYXRpb25zaGlwIiwgIXZhbHVlIHx8IHZhbHVlIGluc3Rh
bmNlb2Ygc3RvcmUubW9kZWxGb3IodHlwZSkpOwogICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVm
aW5lZCA/IG51bGwgOiBEUy5Qcm9taXNlT2JqZWN0LmNyZWF0ZSh7IHByb21pc2U6IEVtYmVyLlJT
VlAucmVzb2x2ZSh2YWx1ZSwgcHJvbWlzZUxhYmVsKSB9KTsKICAgIH0KCiAgICB2YXIgbGluayA9
IGRhdGEubGlua3MgJiYgZGF0YS5saW5rc1trZXldLAogICAgICAgIGJlbG9uZ3NUbyA9IGRhdGFb
a2V5XTsKCiAgICBpZighaXNOb25lKGJlbG9uZ3NUbykpIHsKICAgICAgdmFyIHByb21pc2UgPSBz
dG9yZS5mZXRjaFJlY29yZChiZWxvbmdzVG8pIHx8IEVtYmVyLlJTVlAucmVzb2x2ZShiZWxvbmdz
VG8sIHByb21pc2VMYWJlbCk7CiAgICAgIHJldHVybiBEUy5Qcm9taXNlT2JqZWN0LmNyZWF0ZSh7
IHByb21pc2U6IHByb21pc2V9KTsKICAgIH0gZWxzZSBpZiAobGluaykgewogICAgICB2YXIgcmVz
b2x2ZXIgPSBFbWJlci5SU1ZQLmRlZmVyKCJEUzogQXN5bmMgYmVsb25nc1RvIChsaW5rKSAiICsg
dGhpcyArICIgOiAiICsga2V5KTsKICAgICAgc3RvcmUuZmluZEJlbG9uZ3NUbyh0aGlzLCBsaW5r
LCBtZXRhLCByZXNvbHZlcik7CiAgICAgIHJldHVybiBEUy5Qcm9taXNlT2JqZWN0LmNyZWF0ZSh7
IHByb21pc2U6IHJlc29sdmVyLnByb21pc2UgfSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4g
bnVsbDsKICAgIH0KICB9KS5wcm9wZXJ0eSgnZGF0YScpLm1ldGEobWV0YSk7Cn0KCi8qKgogIGBE
Uy5iZWxvbmdzVG9gIGlzIHVzZWQgdG8gZGVmaW5lIE9uZS1Uby1PbmUgYW5kIE9uZS1Uby1NYW55
CiAgcmVsYXRpb25zaGlwcyBvbiBhIFtEUy5Nb2RlbF0oRFMuTW9kZWwuaHRtbCkuCgoKICBgRFMu
YmVsb25nc1RvYCB0YWtlcyBhbiBvcHRpb25hbCBoYXNoIGFzIGEgc2Vjb25kIHBhcmFtZXRlciwg
Y3VycmVudGx5CiAgc3VwcG9ydGVkIG9wdGlvbnMgYXJlOgoKICAtIGBhc3luY2A6IEEgYm9vbGVh
biB2YWx1ZSB1c2VkIHRvIGV4cGxpY2l0bHkgZGVjbGFyZSB0aGlzIHRvIGJlIGFuIGFzeW5jIHJl
bGF0aW9uc2hpcC4KICAtIGBpbnZlcnNlYDogQSBzdHJpbmcgdXNlZCB0byBpZGVudGlmeSB0aGUg
aW52ZXJzZSBwcm9wZXJ0eSBvbiBhCiAgICByZWxhdGVkIG1vZGVsIGluIGEgT25lLVRvLU1hbnkg
cmVsYXRpb25zaGlwLiBTZWUgW0V4cGxpY2l0IEludmVyc2VzXSgjdG9jX2V4cGxpY2l0LWludmVy
c2VzKQoKICAjIyMjIE9uZS1Uby1PbmUKICBUbyBkZWNsYXJlIGEgb25lLXRvLW9uZSByZWxhdGlv
bnNoaXAgYmV0d2VlbiB0d28gbW9kZWxzLCB1c2UKICBgRFMuYmVsb25nc1RvYDoKCiAgYGBgamF2
YXNjcmlwdAogIEFwcC5Vc2VyID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgIHByb2ZpbGU6IERTLmJl
bG9uZ3NUbygncHJvZmlsZScpCiAgfSk7CgogIEFwcC5Qcm9maWxlID0gRFMuTW9kZWwuZXh0ZW5k
KHsKICAgIHVzZXI6IERTLmJlbG9uZ3NUbygndXNlcicpCiAgfSk7CiAgYGBgCgogICMjIyMgT25l
LVRvLU1hbnkKICBUbyBkZWNsYXJlIGEgb25lLXRvLW1hbnkgcmVsYXRpb25zaGlwIGJldHdlZW4g
dHdvIG1vZGVscywgdXNlCiAgYERTLmJlbG9uZ3NUb2AgaW4gY29tYmluYXRpb24gd2l0aCBgRFMu
aGFzTWFueWAsIGxpa2UgdGhpczoKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5Qb3N0ID0gRFMuTW9k
ZWwuZXh0ZW5kKHsKICAgIGNvbW1lbnRzOiBEUy5oYXNNYW55KCdjb21tZW50JykKICB9KTsKCiAg
QXBwLkNvbW1lbnQgPSBEUy5Nb2RlbC5leHRlbmQoewogICAgcG9zdDogRFMuYmVsb25nc1RvKCdw
b3N0JykKICB9KTsKICBgYGAKCiAgQG5hbWVzcGFjZQogIEBtZXRob2QgYmVsb25nc1RvCiAgQGZv
ciBEUwogIEBwYXJhbSB7U3RyaW5nIG9yIERTLk1vZGVsfSB0eXBlIHRoZSBtb2RlbCB0eXBlIG9m
IHRoZSByZWxhdGlvbnNoaXAKICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBhIGhhc2ggb2Ygb3B0
aW9ucwogIEByZXR1cm4ge0VtYmVyLmNvbXB1dGVkfSByZWxhdGlvbnNoaXAKKi8KRFMuYmVsb25n
c1RvID0gZnVuY3Rpb24odHlwZSwgb3B0aW9ucykgewogIGlmICh0eXBlb2YgdHlwZSA9PT0gJ29i
amVjdCcpIHsKICAgIG9wdGlvbnMgPSB0eXBlOwogICAgdHlwZSA9IHVuZGVmaW5lZDsKICB9IGVs
c2UgewogICAgRW1iZXIuYXNzZXJ0KCJUaGUgZmlyc3QgYXJndW1lbnQgRFMuYmVsb25nc1RvIG11
c3QgYmUgYSBtb2RlbCB0eXBlIG9yIHN0cmluZywgbGlrZSBEUy5iZWxvbmdzVG8oQXBwLlBlcnNv
bikiLCAhIXR5cGUgJiYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJyB8fCBEUy5Nb2RlbC5kZXRl
Y3QodHlwZSkpKTsKICB9CgogIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICB2YXIgbWV0YSA9
IHsgdHlwZTogdHlwZSwgaXNSZWxhdGlvbnNoaXA6IHRydWUsIG9wdGlvbnM6IG9wdGlvbnMsIGtp
bmQ6ICdiZWxvbmdzVG8nIH07CgogIGlmIChvcHRpb25zLmFzeW5jKSB7CiAgICByZXR1cm4gYXN5
bmNCZWxvbmdzVG8odHlwZSwgb3B0aW9ucywgbWV0YSk7CiAgfQoKICByZXR1cm4gRW1iZXIuY29t
cHV0ZWQoZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSBnZXQodGhpcywgJ2Rh
dGEnKSwKICAgICAgICBzdG9yZSA9IGdldCh0aGlzLCAnc3RvcmUnKSwgYmVsb25nc1RvLCB0eXBl
Q2xhc3M7CgogICAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykgewogICAgICB0eXBlQ2xh
c3MgPSBzdG9yZS5tb2RlbEZvcih0eXBlKTsKICAgIH0gZWxzZSB7CiAgICAgIHR5cGVDbGFzcyA9
IHR5cGU7CiAgICB9CgogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgRW1i
ZXIuYXNzZXJ0KCJZb3UgY2FuIG9ubHkgYWRkIGEgJyIgKyB0eXBlICsgIicgcmVjb3JkIHRvIHRo
aXMgcmVsYXRpb25zaGlwIiwgIXZhbHVlIHx8IHZhbHVlIGluc3RhbmNlb2YgdHlwZUNsYXNzKTsK
ICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyBudWxsIDogdmFsdWU7CiAgICB9Cgog
ICAgYmVsb25nc1RvID0gZGF0YVtrZXldOwoKICAgIGlmIChpc05vbmUoYmVsb25nc1RvKSkgeyBy
ZXR1cm4gbnVsbDsgfQoKICAgIHN0b3JlLmZldGNoUmVjb3JkKGJlbG9uZ3NUbyk7CgogICAgcmV0
dXJuIGJlbG9uZ3NUbzsKICB9KS5wcm9wZXJ0eSgnZGF0YScpLm1ldGEobWV0YSk7Cn07CgovKioK
ICBUaGVzZSBvYnNlcnZlcnMgb2JzZXJ2ZSBhbGwgYGJlbG9uZ3NUb2AgcmVsYXRpb25zaGlwcyBv
biB0aGUgcmVjb3JkLiBTZWUKICBgcmVsYXRpb25zaGlwcy9leHRgIHRvIHNlZSBob3cgdGhlc2Ug
b2JzZXJ2ZXJzIGdldCB0aGVpciBkZXBlbmRlbmNpZXMuCgogIEBjbGFzcyBNb2RlbAogIEBuYW1l
c3BhY2UgRFMKKi8KRFMuTW9kZWwucmVvcGVuKHsKCiAgLyoqCiAgICBAbWV0aG9kIGJlbG9uZ3NU
b1dpbGxDaGFuZ2UKICAgIEBwcml2YXRlCiAgICBAc3RhdGljCiAgICBAcGFyYW0gcmVjb3JkCiAg
ICBAcGFyYW0ga2V5CiAgKi8KICBiZWxvbmdzVG9XaWxsQ2hhbmdlOiBFbWJlci5iZWZvcmVPYnNl
cnZlcihmdW5jdGlvbihyZWNvcmQsIGtleSkgewogICAgaWYgKGdldChyZWNvcmQsICdpc0xvYWRl
ZCcpKSB7CiAgICAgIHZhciBvbGRQYXJlbnQgPSBnZXQocmVjb3JkLCBrZXkpOwoKICAgICAgaWYg
KG9sZFBhcmVudCkgewogICAgICAgIHZhciBzdG9yZSA9IGdldChyZWNvcmQsICdzdG9yZScpLAog
ICAgICAgICAgICBjaGFuZ2UgPSBEUy5SZWxhdGlvbnNoaXBDaGFuZ2UuY3JlYXRlQ2hhbmdlKHJl
Y29yZCwgb2xkUGFyZW50LCBzdG9yZSwgeyBrZXk6IGtleSwga2luZDogImJlbG9uZ3NUbyIsIGNo
YW5nZVR5cGU6ICJyZW1vdmUiIH0pOwoKICAgICAgICBjaGFuZ2Uuc3luYygpOwogICAgICAgIHRo
aXMuX2NoYW5nZXNUb1N5bmNba2V5XSA9IGNoYW5nZTsKICAgICAgfQogICAgfQogIH0pLAoKICAv
KioKICAgIEBtZXRob2QgYmVsb25nc1RvRGlkQ2hhbmdlCiAgICBAcHJpdmF0ZQogICAgQHN0YXRp
YwogICAgQHBhcmFtIHJlY29yZAogICAgQHBhcmFtIGtleQogICovCiAgYmVsb25nc1RvRGlkQ2hh
bmdlOiBFbWJlci5pbW1lZGlhdGVPYnNlcnZlcihmdW5jdGlvbihyZWNvcmQsIGtleSkgewogICAg
aWYgKGdldChyZWNvcmQsICdpc0xvYWRlZCcpKSB7CiAgICAgIHZhciBuZXdQYXJlbnQgPSBnZXQo
cmVjb3JkLCBrZXkpOwoKICAgICAgaWYgKG5ld1BhcmVudCkgewogICAgICAgIHZhciBzdG9yZSA9
IGdldChyZWNvcmQsICdzdG9yZScpLAogICAgICAgICAgICBjaGFuZ2UgPSBEUy5SZWxhdGlvbnNo
aXBDaGFuZ2UuY3JlYXRlQ2hhbmdlKHJlY29yZCwgbmV3UGFyZW50LCBzdG9yZSwgeyBrZXk6IGtl
eSwga2luZDogImJlbG9uZ3NUbyIsIGNoYW5nZVR5cGU6ICJhZGQiIH0pOwoKICAgICAgICBjaGFu
Z2Uuc3luYygpOwogICAgICB9CiAgICB9CgogICAgZGVsZXRlIHRoaXMuX2NoYW5nZXNUb1N5bmNb
a2V5XTsKICB9KQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJl
ci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQsIHNldFByb3Bl
cnRpZXMgPSBFbWJlci5zZXRQcm9wZXJ0aWVzOwoKZnVuY3Rpb24gYXN5bmNIYXNNYW55KHR5cGUs
IG9wdGlvbnMsIG1ldGEpIHsKICByZXR1cm4gRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oa2V5LCB2
YWx1ZSkgewogICAgdmFyIHJlbGF0aW9uc2hpcCA9IHRoaXMuX3JlbGF0aW9uc2hpcHNba2V5XSwK
ICAgICAgICBwcm9taXNlTGFiZWwgPSAiRFM6IEFzeW5jIGhhc01hbnkgIiArIHRoaXMgKyAiIDog
IiArIGtleTsKCiAgICBpZiAoIXJlbGF0aW9uc2hpcCkgewogICAgICB2YXIgcmVzb2x2ZXIgPSBF
bWJlci5SU1ZQLmRlZmVyKHByb21pc2VMYWJlbCk7CiAgICAgIHJlbGF0aW9uc2hpcCA9IGJ1aWxk
UmVsYXRpb25zaGlwKHRoaXMsIGtleSwgb3B0aW9ucywgZnVuY3Rpb24oc3RvcmUsIGRhdGEpIHsK
ICAgICAgICB2YXIgbGluayA9IGRhdGEubGlua3MgJiYgZGF0YS5saW5rc1trZXldOwogICAgICAg
IHZhciByZWw7CiAgICAgICAgaWYgKGxpbmspIHsKICAgICAgICAgIHJlbCA9IHN0b3JlLmZpbmRI
YXNNYW55KHRoaXMsIGxpbmssIG1ldGEsIHJlc29sdmVyKTsKICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgcmVsID0gc3RvcmUuZmluZE1hbnkodGhpcywgZGF0YVtrZXldLCBtZXRhLnR5cGUsIHJl
c29sdmVyKTsKICAgICAgICB9CiAgICAgICAgLy8gY2FjaGUgdGhlIHByb21pc2Ugc28gd2UgY2Fu
IHVzZSBpdAogICAgICAgIC8vIHdoZW4gd2UgY29tZSBiYWNrIGFuZCBkb24ndCBuZWVkIHRvIHJl
YnVpbGQKICAgICAgICAvLyB0aGUgcmVsYXRpb25zaGlwLgogICAgICAgIHNldChyZWwsICdwcm9t
aXNlJywgcmVzb2x2ZXIucHJvbWlzZSk7CiAgICAgICAgcmV0dXJuIHJlbDsKICAgICAgfSk7CiAg
ICB9CgogICAgdmFyIHByb21pc2UgPSByZWxhdGlvbnNoaXAuZ2V0KCdwcm9taXNlJykudGhlbihm
dW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJlbGF0aW9uc2hpcDsKICAgIH0sIG51bGwsICJEUzog
QXN5bmMgaGFzTWFueSByZWNvcmRzIHJlY2VpdmVkIik7CgogICAgcmV0dXJuIERTLlByb21pc2VB
cnJheS5jcmVhdGUoeyBwcm9taXNlOiBwcm9taXNlIH0pOwogIH0pLnByb3BlcnR5KCdkYXRhJyku
bWV0YShtZXRhKTsKfQoKZnVuY3Rpb24gYnVpbGRSZWxhdGlvbnNoaXAocmVjb3JkLCBrZXksIG9w
dGlvbnMsIGNhbGxiYWNrKSB7CiAgdmFyIHJlbHMgPSByZWNvcmQuX3JlbGF0aW9uc2hpcHM7Cgog
IGlmIChyZWxzW2tleV0pIHsgcmV0dXJuIHJlbHNba2V5XTsgfQoKICB2YXIgZGF0YSA9IGdldChy
ZWNvcmQsICdkYXRhJyksCiAgICAgIHN0b3JlID0gZ2V0KHJlY29yZCwgJ3N0b3JlJyk7CgogIHZh
ciByZWxhdGlvbnNoaXAgPSByZWxzW2tleV0gPSBjYWxsYmFjay5jYWxsKHJlY29yZCwgc3RvcmUs
IGRhdGEpOwoKICByZXR1cm4gc2V0UHJvcGVydGllcyhyZWxhdGlvbnNoaXAsIHsKICAgIG93bmVy
OiByZWNvcmQsIG5hbWU6IGtleSwgaXNQb2x5bW9ycGhpYzogb3B0aW9ucy5wb2x5bW9ycGhpYwog
IH0pOwp9CgpmdW5jdGlvbiBoYXNSZWxhdGlvbnNoaXAodHlwZSwgb3B0aW9ucykgewogIG9wdGlv
bnMgPSBvcHRpb25zIHx8IHt9OwoKICB2YXIgbWV0YSA9IHsgdHlwZTogdHlwZSwgaXNSZWxhdGlv
bnNoaXA6IHRydWUsIG9wdGlvbnM6IG9wdGlvbnMsIGtpbmQ6ICdoYXNNYW55JyB9OwoKICBpZiAo
b3B0aW9ucy5hc3luYykgewogICAgcmV0dXJuIGFzeW5jSGFzTWFueSh0eXBlLCBvcHRpb25zLCBt
ZXRhKTsKICB9CgogIHJldHVybiBFbWJlci5jb21wdXRlZChmdW5jdGlvbihrZXksIHZhbHVlKSB7
CiAgICByZXR1cm4gYnVpbGRSZWxhdGlvbnNoaXAodGhpcywga2V5LCBvcHRpb25zLCBmdW5jdGlv
bihzdG9yZSwgZGF0YSkgewogICAgICB2YXIgcmVjb3JkcyA9IGRhdGFba2V5XTsKICAgICAgRW1i
ZXIuYXNzZXJ0KCJZb3UgbG9va2VkIHVwIHRoZSAnIiArIGtleSArICInIHJlbGF0aW9uc2hpcCBv
biAnIiArIHRoaXMgKyAiJyBidXQgc29tZSBvZiB0aGUgYXNzb2NpYXRlZCByZWNvcmRzIHdlcmUg
bm90IGxvYWRlZC4gRWl0aGVyIG1ha2Ugc3VyZSB0aGV5IGFyZSBhbGwgbG9hZGVkIHRvZ2V0aGVy
IHdpdGggdGhlIHBhcmVudCByZWNvcmQsIG9yIHNwZWNpZnkgdGhhdCB0aGUgcmVsYXRpb25zaGlw
IGlzIGFzeW5jIChgRFMuaGFzTWFueSh7IGFzeW5jOiB0cnVlIH0pYCkiLCBFbWJlci5BKHJlY29y
ZHMpLmV2ZXJ5UHJvcGVydHkoJ2lzRW1wdHknLCBmYWxzZSkpOwogICAgICByZXR1cm4gc3RvcmUu
ZmluZE1hbnkodGhpcywgZGF0YVtrZXldLCBtZXRhLnR5cGUpOwogICAgfSk7CiAgfSkucHJvcGVy
dHkoJ2RhdGEnKS5tZXRhKG1ldGEpOwp9CgovKioKICBgRFMuaGFzTWFueWAgaXMgdXNlZCB0byBk
ZWZpbmUgT25lLVRvLU1hbnkgYW5kIE1hbnktVG8tTWFueQogIHJlbGF0aW9uc2hpcHMgb24gYSBb
RFMuTW9kZWxdKERTLk1vZGVsLmh0bWwpLgoKICBgRFMuaGFzTWFueWAgdGFrZXMgYW4gb3B0aW9u
YWwgaGFzaCBhcyBhIHNlY29uZCBwYXJhbWV0ZXIsIGN1cnJlbnRseQogIHN1cHBvcnRlZCBvcHRp
b25zIGFyZToKCiAgLSBgYXN5bmNgOiBBIGJvb2xlYW4gdmFsdWUgdXNlZCB0byBleHBsaWNpdGx5
IGRlY2xhcmUgdGhpcyB0byBiZSBhbiBhc3luYyByZWxhdGlvbnNoaXAuCiAgLSBgaW52ZXJzZWA6
IEEgc3RyaW5nIHVzZWQgdG8gaWRlbnRpZnkgdGhlIGludmVyc2UgcHJvcGVydHkgb24gYSByZWxh
dGVkIG1vZGVsLgoKICAjIyMjIE9uZS1Uby1NYW55CiAgVG8gZGVjbGFyZSBhIG9uZS10by1tYW55
IHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHR3byBtb2RlbHMsIHVzZQogIGBEUy5iZWxvbmdzVG9gIGlu
IGNvbWJpbmF0aW9uIHdpdGggYERTLmhhc01hbnlgLCBsaWtlIHRoaXM6CgogIGBgYGphdmFzY3Jp
cHQKICBBcHAuUG9zdCA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICBjb21tZW50czogRFMuaGFzTWFu
eSgnY29tbWVudCcpCiAgfSk7CgogIEFwcC5Db21tZW50ID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAg
IHBvc3Q6IERTLmJlbG9uZ3NUbygncG9zdCcpCiAgfSk7CiAgYGBgCgogICMjIyMgTWFueS1Uby1N
YW55CiAgVG8gZGVjbGFyZSBhIG1hbnktdG8tbWFueSByZWxhdGlvbnNoaXAgYmV0d2VlbiB0d28g
bW9kZWxzLCB1c2UKICBgRFMuaGFzTWFueWA6CgogIGBgYGphdmFzY3JpcHQKICBBcHAuUG9zdCA9
IERTLk1vZGVsLmV4dGVuZCh7CiAgICB0YWdzOiBEUy5oYXNNYW55KCd0YWcnKQogIH0pOwoKICBB
cHAuVGFnID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgIHBvc3RzOiBEUy5oYXNNYW55KCdwb3N0JykK
ICB9KTsKICBgYGAKCiAgIyMjIyBFeHBsaWNpdCBJbnZlcnNlcwoKICBFbWJlciBEYXRhIHdpbGwg
ZG8gaXRzIGJlc3QgdG8gZGlzY292ZXIgd2hpY2ggcmVsYXRpb25zaGlwcyBtYXAgdG8KICBvbmUg
YW5vdGhlci4gSW4gdGhlIG9uZS10by1tYW55IGNvZGUgYWJvdmUsIGZvciBleGFtcGxlLCBFbWJl
ciBEYXRhCiAgY2FuIGZpZ3VyZSBvdXQgdGhhdCBjaGFuZ2luZyB0aGUgYGNvbW1lbnRzYCByZWxh
dGlvbnNoaXAgc2hvdWxkIHVwZGF0ZQogIHRoZSBgcG9zdGAgcmVsYXRpb25zaGlwIG9uIHRoZSBp
bnZlcnNlIGJlY2F1c2UgcG9zdCBpcyB0aGUgb25seQogIHJlbGF0aW9uc2hpcCB0byB0aGF0IG1v
ZGVsLgoKICBIb3dldmVyLCBzb21ldGltZXMgeW91IG1heSBoYXZlIG11bHRpcGxlIGBiZWxvbmdz
VG9gL2BoYXNNYW55c2AgZm9yIHRoZQogIHNhbWUgdHlwZS4gWW91IGNhbiBzcGVjaWZ5IHdoaWNo
IHByb3BlcnR5IG9uIHRoZSByZWxhdGVkIG1vZGVsIGlzCiAgdGhlIGludmVyc2UgdXNpbmcgYERT
Lmhhc01hbnlgJ3MgYGludmVyc2VgIG9wdGlvbjoKCiAgYGBgamF2YXNjcmlwdAogIHZhciBiZWxv
bmdzVG8gPSBEUy5iZWxvbmdzVG8sCiAgICAgIGhhc01hbnkgPSBEUy5oYXNNYW55OwoKICBBcHAu
Q29tbWVudCA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICBvbmVQb3N0OiBiZWxvbmdzVG8oJ3Bvc3Qn
KSwKICAgIHR3b1Bvc3Q6IGJlbG9uZ3NUbygncG9zdCcpLAogICAgcmVkUG9zdDogYmVsb25nc1Rv
KCdwb3N0JyksCiAgICBibHVlUG9zdDogYmVsb25nc1RvKCdwb3N0JykKICB9KTsKCiAgQXBwLlBv
c3QgPSBEUy5Nb2RlbC5leHRlbmQoewogICAgY29tbWVudHM6IGhhc01hbnkoJ2NvbW1lbnQnLCB7
CiAgICAgIGludmVyc2U6ICdyZWRQb3N0JwogICAgfSkKICB9KTsKICBgYGAKCiAgWW91IGNhbiBh
bHNvIHNwZWNpZnkgYW4gaW52ZXJzZSBvbiBhIGBiZWxvbmdzVG9gLCB3aGljaCB3b3JrcyBob3cK
ICB5b3UnZCBleHBlY3QuCgogIEBuYW1lc3BhY2UKICBAbWV0aG9kIGhhc01hbnkKICBAZm9yIERT
CiAgQHBhcmFtIHtTdHJpbmcgb3IgRFMuTW9kZWx9IHR5cGUgdGhlIG1vZGVsIHR5cGUgb2YgdGhl
IHJlbGF0aW9uc2hpcAogIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIGEgaGFzaCBvZiBvcHRpb25z
CiAgQHJldHVybiB7RW1iZXIuY29tcHV0ZWR9IHJlbGF0aW9uc2hpcAoqLwpEUy5oYXNNYW55ID0g
ZnVuY3Rpb24odHlwZSwgb3B0aW9ucykgewogIGlmICh0eXBlb2YgdHlwZSA9PT0gJ29iamVjdCcp
IHsKICAgIG9wdGlvbnMgPSB0eXBlOwogICAgdHlwZSA9IHVuZGVmaW5lZDsKICB9CiAgcmV0dXJu
IGhhc1JlbGF0aW9uc2hpcCh0eXBlLCBvcHRpb25zKTsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0OwoKLyoqCiAgQG1vZHVsZSBl
bWJlci1kYXRhCiovCgovKgogIFRoaXMgZmlsZSBkZWZpbmVzIHNldmVyYWwgZXh0ZW5zaW9ucyB0
byB0aGUgYmFzZSBgRFMuTW9kZWxgIGNsYXNzIHRoYXQKICBhZGQgc3VwcG9ydCBmb3Igb25lLXRv
LW1hbnkgcmVsYXRpb25zaGlwcy4KKi8KCi8qKgogIEBjbGFzcyBNb2RlbAogIEBuYW1lc3BhY2Ug
RFMKKi8KRFMuTW9kZWwucmVvcGVuKHsKCiAgLyoqCiAgICBUaGlzIEVtYmVyLmpzIGhvb2sgYWxs
b3dzIGFuIG9iamVjdCB0byBiZSBub3RpZmllZCB3aGVuIGEgcHJvcGVydHkKICAgIGlzIGRlZmlu
ZWQuCgogICAgSW4gdGhpcyBjYXNlLCB3ZSB1c2UgaXQgdG8gYmUgbm90aWZpZWQgd2hlbiBhbiBF
bWJlciBEYXRhIHVzZXIgZGVmaW5lcyBhCiAgICBiZWxvbmdzLXRvIHJlbGF0aW9uc2hpcC4gSW4g
dGhhdCBjYXNlLCB3ZSBuZWVkIHRvIHNldCB1cCBvYnNlcnZlcnMgZm9yCiAgICBlYWNoIG9uZSwg
YWxsb3dpbmcgdXMgdG8gdHJhY2sgcmVsYXRpb25zaGlwIGNoYW5nZXMgYW5kIGF1dG9tYXRpY2Fs
bHkKICAgIHJlZmxlY3QgY2hhbmdlcyBpbiB0aGUgaW52ZXJzZSBoYXMtbWFueSBhcnJheS4KCiAg
ICBUaGlzIGhvb2sgcGFzc2VzIHRoZSBjbGFzcyBiZWluZyBzZXQgdXAsIGFzIHdlbGwgYXMgdGhl
IGtleSBhbmQgdmFsdWUKICAgIGJlaW5nIGRlZmluZWQuIFNvLCBmb3IgZXhhbXBsZSwgd2hlbiB0
aGUgdXNlciBkb2VzIHRoaXM6CgogICAgYGBgamF2YXNjcmlwdAogICAgRFMuTW9kZWwuZXh0ZW5k
KHsKICAgICAgcGFyZW50OiBEUy5iZWxvbmdzVG8oJ3VzZXInKQogICAgfSk7CiAgICBgYGAKCiAg
ICBUaGlzIGhvb2sgd291bGQgYmUgY2FsbGVkIHdpdGggInBhcmVudCIgYXMgdGhlIGtleSBhbmQg
dGhlIGNvbXB1dGVkCiAgICBwcm9wZXJ0eSByZXR1cm5lZCBieSBgRFMuYmVsb25nc1RvYCBhcyB0
aGUgdmFsdWUuCgogICAgQG1ldGhvZCBkaWREZWZpbmVQcm9wZXJ0eQogICAgQHBhcmFtIHByb3Rv
CiAgICBAcGFyYW0ga2V5CiAgICBAcGFyYW0gdmFsdWUKICAqLwogIGRpZERlZmluZVByb3BlcnR5
OiBmdW5jdGlvbihwcm90bywga2V5LCB2YWx1ZSkgewogICAgLy8gQ2hlY2sgaWYgdGhlIHZhbHVl
IGJlaW5nIHNldCBpcyBhIGNvbXB1dGVkIHByb3BlcnR5LgogICAgaWYgKHZhbHVlIGluc3RhbmNl
b2YgRW1iZXIuRGVzY3JpcHRvcikgewoKICAgICAgLy8gSWYgaXQgaXMsIGdldCB0aGUgbWV0YWRh
dGEgZm9yIHRoZSByZWxhdGlvbnNoaXAuIFRoaXMgaXMKICAgICAgLy8gcG9wdWxhdGVkIGJ5IHRo
ZSBgRFMuYmVsb25nc1RvYCBoZWxwZXIgd2hlbiBpdCBpcyBjcmVhdGluZwogICAgICAvLyB0aGUg
Y29tcHV0ZWQgcHJvcGVydHkuCiAgICAgIHZhciBtZXRhID0gdmFsdWUubWV0YSgpOwoKICAgICAg
aWYgKG1ldGEuaXNSZWxhdGlvbnNoaXAgJiYgbWV0YS5raW5kID09PSAnYmVsb25nc1RvJykgewog
ICAgICAgIEVtYmVyLmFkZE9ic2VydmVyKHByb3RvLCBrZXksIG51bGwsICdiZWxvbmdzVG9EaWRD
aGFuZ2UnKTsKICAgICAgICBFbWJlci5hZGRCZWZvcmVPYnNlcnZlcihwcm90bywga2V5LCBudWxs
LCAnYmVsb25nc1RvV2lsbENoYW5nZScpOwogICAgICB9CgogICAgICBtZXRhLnBhcmVudFR5cGUg
PSBwcm90by5jb25zdHJ1Y3RvcjsKICAgIH0KICB9Cn0pOwoKLyoKICBUaGVzZSBEUy5Nb2RlbCBl
eHRlbnNpb25zIGFkZCBjbGFzcyBtZXRob2RzIHRoYXQgcHJvdmlkZSByZWxhdGlvbnNoaXAKICBp
bnRyb3NwZWN0aW9uIGFiaWxpdGllcyBhYm91dCByZWxhdGlvbnNoaXBzLgoKICBBIG5vdGUgYWJv
dXQgdGhlIGNvbXB1dGVkIHByb3BlcnRpZXMgY29udGFpbmVkIGhlcmU6CgogICoqVGhlc2UgcHJv
cGVydGllcyBhcmUgZWZmZWN0aXZlbHkgc2VhbGVkIG9uY2UgY2FsbGVkIGZvciB0aGUgZmlyc3Qg
dGltZS4qKgogIFRvIGF2b2lkIHJlcGVhdGVkbHkgZG9pbmcgZXhwZW5zaXZlIGl0ZXJhdGlvbiBv
dmVyIGEgbW9kZWwncyBmaWVsZHMsIHRoZXNlCiAgdmFsdWVzIGFyZSBjb21wdXRlZCBvbmNlIGFu
ZCB0aGVuIGNhY2hlZCBmb3IgdGhlIHJlbWFpbmRlciBvZiB0aGUgcnVudGltZSBvZgogIHlvdXIg
YXBwbGljYXRpb24uCgogIElmIHlvdXIgYXBwbGljYXRpb24gbmVlZHMgdG8gbW9kaWZ5IGEgY2xh
c3MgYWZ0ZXIgaXRzIGluaXRpYWwgZGVmaW5pdGlvbgogIChmb3IgZXhhbXBsZSwgdXNpbmcgYHJl
b3BlbigpYCB0byBhZGQgYWRkaXRpb25hbCBhdHRyaWJ1dGVzKSwgbWFrZSBzdXJlIHlvdQogIGRv
IGl0IGJlZm9yZSB1c2luZyB5b3VyIG1vZGVsIHdpdGggdGhlIHN0b3JlLCB3aGljaCB1c2VzIHRo
ZXNlIHByb3BlcnRpZXMKICBleHRlbnNpdmVseS4KKi8KCkRTLk1vZGVsLnJlb3BlbkNsYXNzKHsK
ICAvKioKICAgIEZvciBhIGdpdmVuIHJlbGF0aW9uc2hpcCBuYW1lLCByZXR1cm5zIHRoZSBtb2Rl
bCB0eXBlIG9mIHRoZSByZWxhdGlvbnNoaXAuCgogICAgRm9yIGV4YW1wbGUsIGlmIHlvdSBkZWZp
bmUgYSBtb2RlbCBsaWtlIHRoaXM6CgogICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUG9zdCA9IERT
Lk1vZGVsLmV4dGVuZCh7CiAgICAgIGNvbW1lbnRzOiBEUy5oYXNNYW55KCdjb21tZW50JykKICAg
IH0pOwogICBgYGAKCiAgICBDYWxsaW5nIGBBcHAuUG9zdC50eXBlRm9yUmVsYXRpb25zaGlwKCdj
b21tZW50cycpYCB3aWxsIHJldHVybiBgQXBwLkNvbW1lbnRgLgoKICAgIEBtZXRob2QgdHlwZUZv
clJlbGF0aW9uc2hpcAogICAgQHN0YXRpYwogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIG5h
bWUgb2YgdGhlIHJlbGF0aW9uc2hpcAogICAgQHJldHVybiB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9
IHRoZSB0eXBlIG9mIHRoZSByZWxhdGlvbnNoaXAsIG9yIHVuZGVmaW5lZAogICovCiAgdHlwZUZv
clJlbGF0aW9uc2hpcDogZnVuY3Rpb24obmFtZSkgewogICAgdmFyIHJlbGF0aW9uc2hpcCA9IGdl
dCh0aGlzLCAncmVsYXRpb25zaGlwc0J5TmFtZScpLmdldChuYW1lKTsKICAgIHJldHVybiByZWxh
dGlvbnNoaXAgJiYgcmVsYXRpb25zaGlwLnR5cGU7CiAgfSwKCiAgaW52ZXJzZUZvcjogZnVuY3Rp
b24obmFtZSkgewogICAgdmFyIGludmVyc2VUeXBlID0gdGhpcy50eXBlRm9yUmVsYXRpb25zaGlw
KG5hbWUpOwoKICAgIGlmICghaW52ZXJzZVR5cGUpIHsgcmV0dXJuIG51bGw7IH0KCiAgICB2YXIg
b3B0aW9ucyA9IHRoaXMubWV0YUZvclByb3BlcnR5KG5hbWUpLm9wdGlvbnM7CgogICAgaWYgKG9w
dGlvbnMuaW52ZXJzZSA9PT0gbnVsbCkgeyByZXR1cm4gbnVsbDsgfQogICAgCiAgICB2YXIgaW52
ZXJzZU5hbWUsIGludmVyc2VLaW5kOwoKICAgIGlmIChvcHRpb25zLmludmVyc2UpIHsKICAgICAg
aW52ZXJzZU5hbWUgPSBvcHRpb25zLmludmVyc2U7CiAgICAgIGludmVyc2VLaW5kID0gRW1iZXIu
Z2V0KGludmVyc2VUeXBlLCAncmVsYXRpb25zaGlwc0J5TmFtZScpLmdldChpbnZlcnNlTmFtZSku
a2luZDsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBwb3NzaWJsZVJlbGF0aW9uc2hpcHMgPSBmaW5k
UG9zc2libGVJbnZlcnNlcyh0aGlzLCBpbnZlcnNlVHlwZSk7CgogICAgICBpZiAocG9zc2libGVS
ZWxhdGlvbnNoaXBzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gbnVsbDsgfQoKICAgICAgRW1iZXIu
YXNzZXJ0KCJZb3UgZGVmaW5lZCB0aGUgJyIgKyBuYW1lICsgIicgcmVsYXRpb25zaGlwIG9uICIg
KyB0aGlzICsgIiwgYnV0IG11bHRpcGxlIHBvc3NpYmxlIGludmVyc2UgcmVsYXRpb25zaGlwcyBv
ZiB0eXBlICIgKyB0aGlzICsgIiB3ZXJlIGZvdW5kIG9uICIgKyBpbnZlcnNlVHlwZSArICIuIExv
b2sgYXQgaHR0cDovL2VtYmVyanMuY29tL2d1aWRlcy9tb2RlbHMvZGVmaW5pbmctbW9kZWxzLyN0
b2NfZXhwbGljaXQtaW52ZXJzZXMgZm9yIGhvdyB0byBleHBsaWNpdGx5IHNwZWNpZnkgaW52ZXJz
ZXMiLCBwb3NzaWJsZVJlbGF0aW9uc2hpcHMubGVuZ3RoID09PSAxKTsKCiAgICAgIGludmVyc2VO
YW1lID0gcG9zc2libGVSZWxhdGlvbnNoaXBzWzBdLm5hbWU7CiAgICAgIGludmVyc2VLaW5kID0g
cG9zc2libGVSZWxhdGlvbnNoaXBzWzBdLmtpbmQ7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZFBv
c3NpYmxlSW52ZXJzZXModHlwZSwgaW52ZXJzZVR5cGUsIHBvc3NpYmxlUmVsYXRpb25zaGlwcykg
ewogICAgICBwb3NzaWJsZVJlbGF0aW9uc2hpcHMgPSBwb3NzaWJsZVJlbGF0aW9uc2hpcHMgfHwg
W107CgogICAgICB2YXIgcmVsYXRpb25zaGlwTWFwID0gZ2V0KGludmVyc2VUeXBlLCAncmVsYXRp
b25zaGlwcycpOwogICAgICBpZiAoIXJlbGF0aW9uc2hpcE1hcCkgeyByZXR1cm47IH0KCiAgICAg
IHZhciByZWxhdGlvbnNoaXBzID0gcmVsYXRpb25zaGlwTWFwLmdldCh0eXBlKTsKICAgICAgaWYg
KHJlbGF0aW9uc2hpcHMpIHsKICAgICAgICBwb3NzaWJsZVJlbGF0aW9uc2hpcHMucHVzaC5hcHBs
eShwb3NzaWJsZVJlbGF0aW9uc2hpcHMsIHJlbGF0aW9uc2hpcE1hcC5nZXQodHlwZSkpOwogICAg
ICB9CgogICAgICBpZiAodHlwZS5zdXBlcmNsYXNzKSB7CiAgICAgICAgZmluZFBvc3NpYmxlSW52
ZXJzZXModHlwZS5zdXBlcmNsYXNzLCBpbnZlcnNlVHlwZSwgcG9zc2libGVSZWxhdGlvbnNoaXBz
KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3NpYmxlUmVsYXRpb25zaGlwczsKICAgIH0KCiAg
ICByZXR1cm4gewogICAgICB0eXBlOiBpbnZlcnNlVHlwZSwKICAgICAgbmFtZTogaW52ZXJzZU5h
bWUsCiAgICAgIGtpbmQ6IGludmVyc2VLaW5kCiAgICB9OwogIH0sCgogIC8qKgogICAgVGhlIG1v
ZGVsJ3MgcmVsYXRpb25zaGlwcyBhcyBhIG1hcCwga2V5ZWQgb24gdGhlIHR5cGUgb2YgdGhlCiAg
ICByZWxhdGlvbnNoaXAuIFRoZSB2YWx1ZSBvZiBlYWNoIGVudHJ5IGlzIGFuIGFycmF5IGNvbnRh
aW5pbmcgYSBkZXNjcmlwdG9yCiAgICBmb3IgZWFjaCByZWxhdGlvbnNoaXAgd2l0aCB0aGF0IHR5
cGUsIGRlc2NyaWJpbmcgdGhlIG5hbWUgb2YgdGhlIHJlbGF0aW9uc2hpcAogICAgYXMgd2VsbCBh
cyB0aGUgdHlwZS4KCiAgICBGb3IgZXhhbXBsZSwgZ2l2ZW4gdGhlIGZvbGxvd2luZyBtb2RlbCBk
ZWZpbml0aW9uOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5CbG9nID0gRFMuTW9kZWwuZXh0
ZW5kKHsKICAgICAgdXNlcnM6IERTLmhhc01hbnkoJ3VzZXInKSwKICAgICAgb3duZXI6IERTLmJl
bG9uZ3NUbygndXNlcicpLAogICAgICBwb3N0czogRFMuaGFzTWFueSgncG9zdCcpCiAgICB9KTsK
ICAgIGBgYAoKICAgIFRoaXMgY29tcHV0ZWQgcHJvcGVydHkgd291bGQgcmV0dXJuIGEgbWFwIGRl
c2NyaWJpbmcgdGhlc2UKICAgIHJlbGF0aW9uc2hpcHMsIGxpa2UgdGhpczoKCiAgICBgYGBqYXZh
c2NyaXB0CiAgICB2YXIgcmVsYXRpb25zaGlwcyA9IEVtYmVyLmdldChBcHAuQmxvZywgJ3JlbGF0
aW9uc2hpcHMnKTsKICAgIHJlbGF0aW9uc2hpcHMuZ2V0KEFwcC5Vc2VyKTsKICAgIC8vPT4gWyB7
IG5hbWU6ICd1c2VycycsIGtpbmQ6ICdoYXNNYW55JyB9LAogICAgLy8gICAgIHsgbmFtZTogJ293
bmVyJywga2luZDogJ2JlbG9uZ3NUbycgfSBdCiAgICByZWxhdGlvbnNoaXBzLmdldChBcHAuUG9z
dCk7CiAgICAvLz0+IFsgeyBuYW1lOiAncG9zdHMnLCBraW5kOiAnaGFzTWFueScgfSBdCiAgICBg
YGAKCiAgICBAcHJvcGVydHkgcmVsYXRpb25zaGlwcwogICAgQHN0YXRpYwogICAgQHR5cGUgRW1i
ZXIuTWFwCiAgICBAcmVhZE9ubHkKICAqLwogIHJlbGF0aW9uc2hpcHM6IEVtYmVyLmNvbXB1dGVk
KGZ1bmN0aW9uKCkgewogICAgdmFyIG1hcCA9IG5ldyBFbWJlci5NYXBXaXRoRGVmYXVsdCh7CiAg
ICAgIGRlZmF1bHRWYWx1ZTogZnVuY3Rpb24oKSB7IHJldHVybiBbXTsgfQogICAgfSk7CgogICAg
Ly8gTG9vcCB0aHJvdWdoIGVhY2ggY29tcHV0ZWQgcHJvcGVydHkgb24gdGhlIGNsYXNzCiAgICB0
aGlzLmVhY2hDb21wdXRlZFByb3BlcnR5KGZ1bmN0aW9uKG5hbWUsIG1ldGEpIHsKCiAgICAgIC8v
IElmIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSBpcyBhIHJlbGF0aW9uc2hpcCwgYWRkCiAgICAgIC8v
IGl0IHRvIHRoZSBtYXAuCiAgICAgIGlmIChtZXRhLmlzUmVsYXRpb25zaGlwKSB7CiAgICAgICAg
aWYgKHR5cGVvZiBtZXRhLnR5cGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtZXRhLnR5cGUg
PSB0aGlzLnN0b3JlLm1vZGVsRm9yKG1ldGEudHlwZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIg
cmVsYXRpb25zaGlwc0ZvclR5cGUgPSBtYXAuZ2V0KG1ldGEudHlwZSk7CgogICAgICAgIHJlbGF0
aW9uc2hpcHNGb3JUeXBlLnB1c2goeyBuYW1lOiBuYW1lLCBraW5kOiBtZXRhLmtpbmQgfSk7CiAg
ICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBtYXA7CiAgfSksCgogIC8qKgogICAgQSBoYXNoIGNv
bnRhaW5pbmcgbGlzdHMgb2YgdGhlIG1vZGVsJ3MgcmVsYXRpb25zaGlwcywgZ3JvdXBlZAogICAg
YnkgdGhlIHJlbGF0aW9uc2hpcCBraW5kLiBGb3IgZXhhbXBsZSwgZ2l2ZW4gYSBtb2RlbCB3aXRo
IHRoaXMKICAgIGRlZmluaXRpb246CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLkJsb2cgPSBE
Uy5Nb2RlbC5leHRlbmQoewogICAgICB1c2VyczogRFMuaGFzTWFueSgndXNlcicpLAogICAgICBv
d25lcjogRFMuYmVsb25nc1RvKCd1c2VyJyksCgogICAgICBwb3N0czogRFMuaGFzTWFueSgncG9z
dCcpCiAgICB9KTsKICAgIGBgYAoKICAgIFRoaXMgcHJvcGVydHkgd291bGQgY29udGFpbiB0aGUg
Zm9sbG93aW5nOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciByZWxhdGlvbnNoaXBOYW1lcyA9
IEVtYmVyLmdldChBcHAuQmxvZywgJ3JlbGF0aW9uc2hpcE5hbWVzJyk7CiAgICByZWxhdGlvbnNo
aXBOYW1lcy5oYXNNYW55OwogICAgLy89PiBbJ3VzZXJzJywgJ3Bvc3RzJ10KICAgIHJlbGF0aW9u
c2hpcE5hbWVzLmJlbG9uZ3NUbzsKICAgIC8vPT4gWydvd25lciddCiAgICBgYGAKCiAgICBAcHJv
cGVydHkgcmVsYXRpb25zaGlwTmFtZXMKICAgIEBzdGF0aWMKICAgIEB0eXBlIE9iamVjdAogICAg
QHJlYWRPbmx5CiAgKi8KICByZWxhdGlvbnNoaXBOYW1lczogRW1iZXIuY29tcHV0ZWQoZnVuY3Rp
b24oKSB7CiAgICB2YXIgbmFtZXMgPSB7IGhhc01hbnk6IFtdLCBiZWxvbmdzVG86IFtdIH07Cgog
ICAgdGhpcy5lYWNoQ29tcHV0ZWRQcm9wZXJ0eShmdW5jdGlvbihuYW1lLCBtZXRhKSB7CiAgICAg
IGlmIChtZXRhLmlzUmVsYXRpb25zaGlwKSB7CiAgICAgICAgbmFtZXNbbWV0YS5raW5kXS5wdXNo
KG5hbWUpOwogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gbmFtZXM7CiAgfSksCgogIC8qKgog
ICAgQW4gYXJyYXkgb2YgdHlwZXMgZGlyZWN0bHkgcmVsYXRlZCB0byBhIG1vZGVsLiBFYWNoIHR5
cGUgd2lsbCBiZQogICAgaW5jbHVkZWQgb25jZSwgcmVnYXJkbGVzcyBvZiB0aGUgbnVtYmVyIG9m
IHJlbGF0aW9uc2hpcHMgaXQgaGFzIHdpdGgKICAgIHRoZSBtb2RlbC4KCiAgICBGb3IgZXhhbXBs
ZSwgZ2l2ZW4gYSBtb2RlbCB3aXRoIHRoaXMgZGVmaW5pdGlvbjoKCiAgICBgYGBqYXZhc2NyaXB0
CiAgICBBcHAuQmxvZyA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICAgIHVzZXJzOiBEUy5oYXNNYW55
KCd1c2VyJyksCiAgICAgIG93bmVyOiBEUy5iZWxvbmdzVG8oJ3VzZXInKSwKCiAgICAgIHBvc3Rz
OiBEUy5oYXNNYW55KCdwb3N0JykKICAgIH0pOwogICAgYGBgCgogICAgVGhpcyBwcm9wZXJ0eSB3
b3VsZCBjb250YWluIHRoZSBmb2xsb3dpbmc6CgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIHJl
bGF0ZWRUeXBlcyA9IEVtYmVyLmdldChBcHAuQmxvZywgJ3JlbGF0ZWRUeXBlcycpOwogICAgLy89
PiBbIEFwcC5Vc2VyLCBBcHAuUG9zdCBdCiAgICBgYGAKCiAgICBAcHJvcGVydHkgcmVsYXRlZFR5
cGVzCiAgICBAc3RhdGljCiAgICBAdHlwZSBFbWJlci5BcnJheQogICAgQHJlYWRPbmx5CiAgKi8K
ICByZWxhdGVkVHlwZXM6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgdmFyIHR5cGUs
CiAgICAgICAgdHlwZXMgPSBFbWJlci5BKCk7CgogICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggY29t
cHV0ZWQgcHJvcGVydHkgb24gdGhlIGNsYXNzLAogICAgLy8gYW5kIGNyZWF0ZSBhbiBhcnJheSBv
ZiB0aGUgdW5pcXVlIHR5cGVzIGludm9sdmVkCiAgICAvLyBpbiByZWxhdGlvbnNoaXBzCiAgICB0
aGlzLmVhY2hDb21wdXRlZFByb3BlcnR5KGZ1bmN0aW9uKG5hbWUsIG1ldGEpIHsKICAgICAgaWYg
KG1ldGEuaXNSZWxhdGlvbnNoaXApIHsKICAgICAgICB0eXBlID0gbWV0YS50eXBlOwoKICAgICAg
ICBpZiAodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB0eXBlID0gZ2V0KHRo
aXMsIHR5cGUsIGZhbHNlKSB8fCB0aGlzLnN0b3JlLm1vZGVsRm9yKHR5cGUpOwogICAgICAgIH0K
CiAgICAgICAgRW1iZXIuYXNzZXJ0KCJZb3Ugc3BlY2lmaWVkIGEgaGFzTWFueSAoIiArIG1ldGEu
dHlwZSArICIpIG9uICIgKyBtZXRhLnBhcmVudFR5cGUgKyAiIGJ1dCAiICsgbWV0YS50eXBlICsg
IiB3YXMgbm90IGZvdW5kLiIsICB0eXBlKTsKCiAgICAgICAgaWYgKCF0eXBlcy5jb250YWlucyh0
eXBlKSkgewogICAgICAgICAgRW1iZXIuYXNzZXJ0KCJUcnlpbmcgdG8gc2lkZWxvYWQgIiArIG5h
bWUgKyAiIG9uICIgKyB0aGlzLnRvU3RyaW5nKCkgKyAiIGJ1dCB0aGUgdHlwZSBkb2Vzbid0IGV4
aXN0LiIsICEhdHlwZSk7CiAgICAgICAgICB0eXBlcy5wdXNoKHR5cGUpOwogICAgICAgIH0KICAg
ICAgfQogICAgfSk7CgogICAgcmV0dXJuIHR5cGVzOwogIH0pLAoKICAvKioKICAgIEEgbWFwIHdo
b3NlIGtleXMgYXJlIHRoZSByZWxhdGlvbnNoaXBzIG9mIGEgbW9kZWwgYW5kIHdob3NlIHZhbHVl
cyBhcmUKICAgIHJlbGF0aW9uc2hpcCBkZXNjcmlwdG9ycy4KCiAgICBGb3IgZXhhbXBsZSwgZ2l2
ZW4gYSBtb2RlbCB3aXRoIHRoaXMKICAgIGRlZmluaXRpb246CgogICAgYGBgamF2YXNjcmlwdAog
ICAgQXBwLkJsb2cgPSBEUy5Nb2RlbC5leHRlbmQoewogICAgICB1c2VyczogRFMuaGFzTWFueSgn
dXNlcicpLAogICAgICBvd25lcjogRFMuYmVsb25nc1RvKCd1c2VyJyksCgogICAgICBwb3N0czog
RFMuaGFzTWFueSgncG9zdCcpCiAgICB9KTsKICAgIGBgYAoKICAgIFRoaXMgcHJvcGVydHkgd291
bGQgY29udGFpbiB0aGUgZm9sbG93aW5nOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciByZWxh
dGlvbnNoaXBzQnlOYW1lID0gRW1iZXIuZ2V0KEFwcC5CbG9nLCAncmVsYXRpb25zaGlwc0J5TmFt
ZScpOwogICAgcmVsYXRpb25zaGlwc0J5TmFtZS5nZXQoJ3VzZXJzJyk7CiAgICAvLz0+IHsga2V5
OiAndXNlcnMnLCBraW5kOiAnaGFzTWFueScsIHR5cGU6IEFwcC5Vc2VyIH0KICAgIHJlbGF0aW9u
c2hpcHNCeU5hbWUuZ2V0KCdvd25lcicpOwogICAgLy89PiB7IGtleTogJ293bmVyJywga2luZDog
J2JlbG9uZ3NUbycsIHR5cGU6IEFwcC5Vc2VyIH0KICAgIGBgYAoKICAgIEBwcm9wZXJ0eSByZWxh
dGlvbnNoaXBzQnlOYW1lCiAgICBAc3RhdGljCiAgICBAdHlwZSBFbWJlci5NYXAKICAgIEByZWFk
T25seQogICovCiAgcmVsYXRpb25zaGlwc0J5TmFtZTogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24o
KSB7CiAgICB2YXIgbWFwID0gRW1iZXIuTWFwLmNyZWF0ZSgpLCB0eXBlOwoKICAgIHRoaXMuZWFj
aENvbXB1dGVkUHJvcGVydHkoZnVuY3Rpb24obmFtZSwgbWV0YSkgewogICAgICBpZiAobWV0YS5p
c1JlbGF0aW9uc2hpcCkgewogICAgICAgIG1ldGEua2V5ID0gbmFtZTsKICAgICAgICB0eXBlID0g
bWV0YS50eXBlOwoKICAgICAgICBpZiAoIXR5cGUgJiYgbWV0YS5raW5kID09PSAnaGFzTWFueScp
IHsKICAgICAgICAgIHR5cGUgPSBFbWJlci5TdHJpbmcuc2luZ3VsYXJpemUobmFtZSk7CiAgICAg
ICAgfSBlbHNlIGlmICghdHlwZSkgewogICAgICAgICAgdHlwZSA9IG5hbWU7CiAgICAgICAgfQoK
ICAgICAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtZXRhLnR5
cGUgPSB0aGlzLnN0b3JlLm1vZGVsRm9yKHR5cGUpOwogICAgICAgIH0KCiAgICAgICAgbWFwLnNl
dChuYW1lLCBtZXRhKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIG1hcDsKICB9KSwKCiAg
LyoqCiAgICBBIG1hcCB3aG9zZSBrZXlzIGFyZSB0aGUgZmllbGRzIG9mIHRoZSBtb2RlbCBhbmQg
d2hvc2UgdmFsdWVzIGFyZSBzdHJpbmdzCiAgICBkZXNjcmliaW5nIHRoZSBraW5kIG9mIHRoZSBm
aWVsZC4gQSBtb2RlbCdzIGZpZWxkcyBhcmUgdGhlIHVuaW9uIG9mIGFsbCBvZiBpdHMKICAgIGF0
dHJpYnV0ZXMgYW5kIHJlbGF0aW9uc2hpcHMuCgogICAgRm9yIGV4YW1wbGU6CgogICAgYGBgamF2
YXNjcmlwdAoKICAgIEFwcC5CbG9nID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgICAgdXNlcnM6IERT
Lmhhc01hbnkoJ3VzZXInKSwKICAgICAgb3duZXI6IERTLmJlbG9uZ3NUbygndXNlcicpLAoKICAg
ICAgcG9zdHM6IERTLmhhc01hbnkoJ3Bvc3QnKSwKCiAgICAgIHRpdGxlOiBEUy5hdHRyKCdzdHJp
bmcnKQogICAgfSk7CgogICAgdmFyIGZpZWxkcyA9IEVtYmVyLmdldChBcHAuQmxvZywgJ2ZpZWxk
cycpOwogICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24oZmllbGQsIGtpbmQpIHsKICAgICAgY29u
c29sZS5sb2coZmllbGQsIGtpbmQpOwogICAgfSk7CgogICAgLy8gcHJpbnRzOgogICAgLy8gdXNl
cnMsIGhhc01hbnkKICAgIC8vIG93bmVyLCBiZWxvbmdzVG8KICAgIC8vIHBvc3RzLCBoYXNNYW55
CiAgICAvLyB0aXRsZSwgYXR0cmlidXRlCiAgICBgYGAKCiAgICBAcHJvcGVydHkgZmllbGRzCiAg
ICBAc3RhdGljCiAgICBAdHlwZSBFbWJlci5NYXAKICAgIEByZWFkT25seQogICovCiAgZmllbGRz
OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsKICAgIHZhciBtYXAgPSBFbWJlci5NYXAuY3Jl
YXRlKCk7CgogICAgdGhpcy5lYWNoQ29tcHV0ZWRQcm9wZXJ0eShmdW5jdGlvbihuYW1lLCBtZXRh
KSB7CiAgICAgIGlmIChtZXRhLmlzUmVsYXRpb25zaGlwKSB7CiAgICAgICAgbWFwLnNldChuYW1l
LCBtZXRhLmtpbmQpOwogICAgICB9IGVsc2UgaWYgKG1ldGEuaXNBdHRyaWJ1dGUpIHsKICAgICAg
ICBtYXAuc2V0KG5hbWUsICdhdHRyaWJ1dGUnKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJu
IG1hcDsKICB9KSwKCiAgLyoqCiAgICBHaXZlbiBhIGNhbGxiYWNrLCBpdGVyYXRlcyBvdmVyIGVh
Y2ggb2YgdGhlIHJlbGF0aW9uc2hpcHMgaW4gdGhlIG1vZGVsLAogICAgaW52b2tpbmcgdGhlIGNh
bGxiYWNrIHdpdGggdGhlIG5hbWUgb2YgZWFjaCByZWxhdGlvbnNoaXAgYW5kIGl0cyByZWxhdGlv
bnNoaXAKICAgIGRlc2NyaXB0b3IuCgogICAgQG1ldGhvZCBlYWNoUmVsYXRpb25zaGlwCiAgICBA
c3RhdGljCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayB0aGUgY2FsbGJhY2sgdG8gaW52
b2tlCiAgICBAcGFyYW0ge2FueX0gYmluZGluZyB0aGUgdmFsdWUgdG8gd2hpY2ggdGhlIGNhbGxi
YWNrJ3MgYHRoaXNgIHNob3VsZCBiZSBib3VuZAogICovCiAgZWFjaFJlbGF0aW9uc2hpcDogZnVu
Y3Rpb24oY2FsbGJhY2ssIGJpbmRpbmcpIHsKICAgIGdldCh0aGlzLCAncmVsYXRpb25zaGlwc0J5
TmFtZScpLmZvckVhY2goZnVuY3Rpb24obmFtZSwgcmVsYXRpb25zaGlwKSB7CiAgICAgIGNhbGxi
YWNrLmNhbGwoYmluZGluZywgbmFtZSwgcmVsYXRpb25zaGlwKTsKICAgIH0pOwogIH0sCgogIC8q
KgogICAgR2l2ZW4gYSBjYWxsYmFjaywgaXRlcmF0ZXMgb3ZlciBlYWNoIG9mIHRoZSB0eXBlcyBy
ZWxhdGVkIHRvIGEgbW9kZWwsCiAgICBpbnZva2luZyB0aGUgY2FsbGJhY2sgd2l0aCB0aGUgcmVs
YXRlZCB0eXBlJ3MgY2xhc3MuIEVhY2ggdHlwZSB3aWxsIGJlCiAgICByZXR1cm5lZCBqdXN0IG9u
Y2UsIHJlZ2FyZGxlc3Mgb2YgaG93IG1hbnkgZGlmZmVyZW50IHJlbGF0aW9uc2hpcHMgaXQgaGFz
CiAgICB3aXRoIGEgbW9kZWwuCgogICAgQG1ldGhvZCBlYWNoUmVsYXRlZFR5cGUKICAgIEBzdGF0
aWMKICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIHRoZSBjYWxsYmFjayB0byBpbnZva2UK
ICAgIEBwYXJhbSB7YW55fSBiaW5kaW5nIHRoZSB2YWx1ZSB0byB3aGljaCB0aGUgY2FsbGJhY2sn
cyBgdGhpc2Agc2hvdWxkIGJlIGJvdW5kCiAgKi8KICBlYWNoUmVsYXRlZFR5cGU6IGZ1bmN0aW9u
KGNhbGxiYWNrLCBiaW5kaW5nKSB7CiAgICBnZXQodGhpcywgJ3JlbGF0ZWRUeXBlcycpLmZvckVh
Y2goZnVuY3Rpb24odHlwZSkgewogICAgICBjYWxsYmFjay5jYWxsKGJpbmRpbmcsIHR5cGUpOwog
ICAgfSk7CiAgfQp9KTsKCkRTLk1vZGVsLnJlb3Blbih7CiAgLyoqCiAgICBHaXZlbiBhIGNhbGxi
YWNrLCBpdGVyYXRlcyBvdmVyIGVhY2ggb2YgdGhlIHJlbGF0aW9uc2hpcHMgaW4gdGhlIG1vZGVs
LAogICAgaW52b2tpbmcgdGhlIGNhbGxiYWNrIHdpdGggdGhlIG5hbWUgb2YgZWFjaCByZWxhdGlv
bnNoaXAgYW5kIGl0cyByZWxhdGlvbnNoaXAKICAgIGRlc2NyaXB0b3IuCgogICAgQG1ldGhvZCBl
YWNoUmVsYXRpb25zaGlwCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayB0aGUgY2FsbGJh
Y2sgdG8gaW52b2tlCiAgICBAcGFyYW0ge2FueX0gYmluZGluZyB0aGUgdmFsdWUgdG8gd2hpY2gg
dGhlIGNhbGxiYWNrJ3MgYHRoaXNgIHNob3VsZCBiZSBib3VuZAogICovCiAgZWFjaFJlbGF0aW9u
c2hpcDogZnVuY3Rpb24oY2FsbGJhY2ssIGJpbmRpbmcpIHsKICAgIHRoaXMuY29uc3RydWN0b3Iu
ZWFjaFJlbGF0aW9uc2hpcChjYWxsYmFjaywgYmluZGluZyk7CiAgfQp9KTsKCn0pKCk7CgoKCihm
dW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp9KSgpOwoKCgooZnVuY3Rp
b24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwg
c2V0ID0gRW1iZXIuc2V0Owp2YXIgb25jZSA9IEVtYmVyLnJ1bi5vbmNlOwp2YXIgZm9yRWFjaCA9
IEVtYmVyLkVudW1lcmFibGVVdGlscy5mb3JFYWNoOwoKLyoqCiAgQGNsYXNzIFJlY29yZEFycmF5
TWFuYWdlcgogIEBuYW1lc3BhY2UgRFMKICBAcHJpdmF0ZQogIEBleHRlbmRzIEVtYmVyLk9iamVj
dAoqLwpEUy5SZWNvcmRBcnJheU1hbmFnZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICBpbml0
OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuZmlsdGVyZWRSZWNvcmRBcnJheXMgPSBFbWJlci5NYXBX
aXRoRGVmYXVsdC5jcmVhdGUoewogICAgICBkZWZhdWx0VmFsdWU6IGZ1bmN0aW9uKCkgeyByZXR1
cm4gW107IH0KICAgIH0pOwoKICAgIHRoaXMuY2hhbmdlZFJlY29yZHMgPSBbXTsKICB9LAoKICBy
ZWNvcmREaWRDaGFuZ2U6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgdGhpcy5jaGFuZ2VkUmVjb3Jk
cy5wdXNoKHJlY29yZCk7CiAgICBvbmNlKHRoaXMsIHRoaXMudXBkYXRlUmVjb3JkQXJyYXlzKTsK
ICB9LAoKICByZWNvcmRBcnJheXNGb3JSZWNvcmQ6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgcmVj
b3JkLl9yZWNvcmRBcnJheXMgPSByZWNvcmQuX3JlY29yZEFycmF5cyB8fCBFbWJlci5PcmRlcmVk
U2V0LmNyZWF0ZSgpOwogICAgcmV0dXJuIHJlY29yZC5fcmVjb3JkQXJyYXlzOwogIH0sCgogIC8q
KgogICAgVGhpcyBtZXRob2QgaXMgaW52b2tlZCB3aGVuZXZlciBkYXRhIGlzIGxvYWRlZCBpbnRv
IHRoZSBzdG9yZSBieSB0aGUKICAgIGFkYXB0ZXIgb3IgdXBkYXRlZCBieSB0aGUgYWRhcHRlciwg
b3Igd2hlbiBhIHJlY29yZCBoYXMgY2hhbmdlZC4KCiAgICBJdCB1cGRhdGVzIGFsbCByZWNvcmQg
YXJyYXlzIHRoYXQgYSByZWNvcmQgYmVsb25ncyB0by4KCiAgICBUbyBhdm9pZCB0aHJhc2hpbmcs
IGl0IG9ubHkgcnVucyBhdCBtb3N0IG9uY2UgcGVyIHJ1biBsb29wLgoKICAgIEBtZXRob2QgdXBk
YXRlUmVjb3JkQXJyYXlzCiAgICBAcGFyYW0ge0NsYXNzfSB0eXBlCiAgICBAcGFyYW0ge051bWJl
cnxTdHJpbmd9IGNsaWVudElkCiAgKi8KICB1cGRhdGVSZWNvcmRBcnJheXM6IGZ1bmN0aW9uKCkg
ewogICAgZm9yRWFjaCh0aGlzLmNoYW5nZWRSZWNvcmRzLCBmdW5jdGlvbihyZWNvcmQpIHsKICAg
ICAgaWYgKGdldChyZWNvcmQsICdpc0RlbGV0ZWQnKSkgewogICAgICAgIHRoaXMuX3JlY29yZFdh
c0RlbGV0ZWQocmVjb3JkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9yZWNvcmRXYXND
aGFuZ2VkKHJlY29yZCk7CiAgICAgIH0KICAgIH0sIHRoaXMpOwoKICAgIHRoaXMuY2hhbmdlZFJl
Y29yZHMgPSBbXTsKICB9LAoKICBfcmVjb3JkV2FzRGVsZXRlZDogZnVuY3Rpb24gKHJlY29yZCkg
ewogICAgdmFyIHJlY29yZEFycmF5cyA9IHJlY29yZC5fcmVjb3JkQXJyYXlzOwoKICAgIGlmICgh
cmVjb3JkQXJyYXlzKSB7IHJldHVybjsgfQoKICAgIGZvckVhY2gocmVjb3JkQXJyYXlzLCBmdW5j
dGlvbihhcnJheSkgewogICAgICBhcnJheS5yZW1vdmVSZWNvcmQocmVjb3JkKTsKICAgIH0pOwog
IH0sCgogIF9yZWNvcmRXYXNDaGFuZ2VkOiBmdW5jdGlvbiAocmVjb3JkKSB7CiAgICB2YXIgdHlw
ZSA9IHJlY29yZC5jb25zdHJ1Y3RvciwKICAgICAgICByZWNvcmRBcnJheXMgPSB0aGlzLmZpbHRl
cmVkUmVjb3JkQXJyYXlzLmdldCh0eXBlKSwKICAgICAgICBmaWx0ZXI7CgogICAgZm9yRWFjaChy
ZWNvcmRBcnJheXMsIGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGZpbHRlciA9IGdldChhcnJheSwg
J2ZpbHRlckZ1bmN0aW9uJyk7CiAgICAgIHRoaXMudXBkYXRlUmVjb3JkQXJyYXkoYXJyYXksIGZp
bHRlciwgdHlwZSwgcmVjb3JkKTsKICAgIH0sIHRoaXMpOwoKICAgIC8vIGxvb3AgdGhyb3VnaCBh
bGwgbWFueUFycmF5cyBjb250YWluaW5nIGFuIHVubG9hZGVkIGNvcHkgb2YgdGhpcwogICAgLy8g
Y2xpZW50SWQgYW5kIG5vdGlmeSB0aGVtIHRoYXQgdGhlIHJlY29yZCB3YXMgbG9hZGVkLgogICAg
dmFyIG1hbnlBcnJheXMgPSByZWNvcmQuX2xvYWRpbmdSZWNvcmRBcnJheXM7CgogICAgaWYgKG1h
bnlBcnJheXMpIHsKICAgICAgZm9yICh2YXIgaT0wLCBsPW1hbnlBcnJheXMubGVuZ3RoOyBpPGw7
IGkrKykgewogICAgICAgIG1hbnlBcnJheXNbaV0ubG9hZGVkUmVjb3JkKCk7CiAgICAgIH0KCiAg
ICAgIHJlY29yZC5fbG9hZGluZ1JlY29yZEFycmF5cyA9IFtdOwogICAgfQogIH0sCgogIC8qKgog
ICAgVXBkYXRlIGFuIGluZGl2aWR1YWwgZmlsdGVyLgoKICAgIEBtZXRob2QgdXBkYXRlUmVjb3Jk
QXJyYXkKICAgIEBwYXJhbSB7RFMuRmlsdGVyZWRSZWNvcmRBcnJheX0gYXJyYXkKICAgIEBwYXJh
bSB7RnVuY3Rpb259IGZpbHRlcgogICAgQHBhcmFtIHtDbGFzc30gdHlwZQogICAgQHBhcmFtIHtO
dW1iZXJ8U3RyaW5nfSBjbGllbnRJZAogICovCiAgdXBkYXRlUmVjb3JkQXJyYXk6IGZ1bmN0aW9u
KGFycmF5LCBmaWx0ZXIsIHR5cGUsIHJlY29yZCkgewogICAgdmFyIHNob3VsZEJlSW5BcnJheTsK
CiAgICBpZiAoIWZpbHRlcikgewogICAgICBzaG91bGRCZUluQXJyYXkgPSB0cnVlOwogICAgfSBl
bHNlIHsKICAgICAgc2hvdWxkQmVJbkFycmF5ID0gZmlsdGVyKHJlY29yZCk7CiAgICB9CgogICAg
dmFyIHJlY29yZEFycmF5cyA9IHRoaXMucmVjb3JkQXJyYXlzRm9yUmVjb3JkKHJlY29yZCk7Cgog
ICAgaWYgKHNob3VsZEJlSW5BcnJheSkgewogICAgICByZWNvcmRBcnJheXMuYWRkKGFycmF5KTsK
ICAgICAgYXJyYXkuYWRkUmVjb3JkKHJlY29yZCk7CiAgICB9IGVsc2UgaWYgKCFzaG91bGRCZUlu
QXJyYXkpIHsKICAgICAgcmVjb3JkQXJyYXlzLnJlbW92ZShhcnJheSk7CiAgICAgIGFycmF5LnJl
bW92ZVJlY29yZChyZWNvcmQpOwogICAgfQogIH0sCgogIC8qKgogICAgVGhpcyBtZXRob2QgaXMg
aW52b2tlZCBpZiB0aGUgYGZpbHRlckZ1bmN0aW9uYCBwcm9wZXJ0eSBpcwogICAgY2hhbmdlZCBv
biBhIGBEUy5GaWx0ZXJlZFJlY29yZEFycmF5YC4KCiAgICBJdCBlc3NlbnRpYWxseSByZS1ydW5z
IHRoZSBmaWx0ZXIgZnJvbSBzY3JhdGNoLiBUaGlzIHNhbWUKICAgIG1ldGhvZCBpcyBpbnZva2Vk
IHdoZW4gdGhlIGZpbHRlciBpcyBjcmVhdGVkIGluIHRoIGZpcnN0IHBsYWNlLgoKICAgIEBtZXRo
b2QgdXBkYXRlRmlsdGVyCiAgICBAcGFyYW0gYXJyYXkKICAgIEBwYXJhbSB0eXBlCiAgICBAcGFy
YW0gZmlsdGVyCiAgKi8KICB1cGRhdGVGaWx0ZXI6IGZ1bmN0aW9uKGFycmF5LCB0eXBlLCBmaWx0
ZXIpIHsKICAgIHZhciB0eXBlTWFwID0gdGhpcy5zdG9yZS50eXBlTWFwRm9yKHR5cGUpLAogICAg
ICAgIHJlY29yZHMgPSB0eXBlTWFwLnJlY29yZHMsIHJlY29yZDsKCiAgICBmb3IgKHZhciBpPTAs
IGw9cmVjb3Jkcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgIHJlY29yZCA9IHJlY29yZHNbaV07
CgogICAgICBpZiAoIWdldChyZWNvcmQsICdpc0RlbGV0ZWQnKSAmJiAhZ2V0KHJlY29yZCwgJ2lz
RW1wdHknKSkgewogICAgICAgIHRoaXMudXBkYXRlUmVjb3JkQXJyYXkoYXJyYXksIGZpbHRlciwg
dHlwZSwgcmVjb3JkKTsKICAgICAgfQogICAgfQogIH0sCgogIC8qKgogICAgQ3JlYXRlIGEgYERT
Lk1hbnlBcnJheWAgZm9yIGEgdHlwZSBhbmQgbGlzdCBvZiByZWNvcmQgcmVmZXJlbmNlcywgYW5k
IGluZGV4CiAgICB0aGUgYE1hbnlBcnJheWAgdW5kZXIgZWFjaCByZWZlcmVuY2UuIFRoaXMgYWxs
b3dzIHVzIHRvIGVmZmljaWVudGx5IHJlbW92ZQogICAgcmVjb3JkcyBmcm9tIGBNYW55QXJyYXlg
cyB3aGVuIHRoZXkgYXJlIGRlbGV0ZWQuCgogICAgQG1ldGhvZCBjcmVhdGVNYW55QXJyYXkKICAg
IEBwYXJhbSB7Q2xhc3N9IHR5cGUKICAgIEBwYXJhbSB7QXJyYXl9IHJlZmVyZW5jZXMKICAgIEBy
ZXR1cm4ge0RTLk1hbnlBcnJheX0KICAqLwogIGNyZWF0ZU1hbnlBcnJheTogZnVuY3Rpb24odHlw
ZSwgcmVjb3JkcykgewogICAgdmFyIG1hbnlBcnJheSA9IERTLk1hbnlBcnJheS5jcmVhdGUoewog
ICAgICB0eXBlOiB0eXBlLAogICAgICBjb250ZW50OiByZWNvcmRzLAogICAgICBzdG9yZTogdGhp
cy5zdG9yZQogICAgfSk7CgogICAgZm9yRWFjaChyZWNvcmRzLCBmdW5jdGlvbihyZWNvcmQpIHsK
ICAgICAgdmFyIGFycmF5cyA9IHRoaXMucmVjb3JkQXJyYXlzRm9yUmVjb3JkKHJlY29yZCk7CiAg
ICAgIGFycmF5cy5hZGQobWFueUFycmF5KTsKICAgIH0sIHRoaXMpOwoKICAgIHJldHVybiBtYW55
QXJyYXk7CiAgfSwKCiAgLyoqCiAgICBDcmVhdGUgYSBgRFMuUmVjb3JkQXJyYXlgIGZvciBhIHR5
cGUgYW5kIHJlZ2lzdGVyIGl0IGZvciB1cGRhdGVzLgoKICAgIEBtZXRob2QgY3JlYXRlUmVjb3Jk
QXJyYXkKICAgIEBwYXJhbSB7Q2xhc3N9IHR5cGUKICAgIEByZXR1cm4ge0RTLlJlY29yZEFycmF5
fQogICovCiAgY3JlYXRlUmVjb3JkQXJyYXk6IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHZhciBhcnJh
eSA9IERTLlJlY29yZEFycmF5LmNyZWF0ZSh7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGNvbnRl
bnQ6IEVtYmVyLkEoKSwKICAgICAgc3RvcmU6IHRoaXMuc3RvcmUsCiAgICAgIGlzTG9hZGVkOiB0
cnVlCiAgICB9KTsKCiAgICB0aGlzLnJlZ2lzdGVyRmlsdGVyZWRSZWNvcmRBcnJheShhcnJheSwg
dHlwZSk7CgogICAgcmV0dXJuIGFycmF5OwogIH0sCgogIC8qKgogICAgQ3JlYXRlIGEgYERTLkZp
bHRlcmVkUmVjb3JkQXJyYXlgIGZvciBhIHR5cGUgYW5kIHJlZ2lzdGVyIGl0IGZvciB1cGRhdGVz
LgoKICAgIEBtZXRob2QgY3JlYXRlRmlsdGVyZWRSZWNvcmRBcnJheQogICAgQHBhcmFtIHtDbGFz
c30gdHlwZQogICAgQHBhcmFtIHtGdW5jdGlvbn0gZmlsdGVyCiAgICBAcmV0dXJuIHtEUy5GaWx0
ZXJlZFJlY29yZEFycmF5fQogICovCiAgY3JlYXRlRmlsdGVyZWRSZWNvcmRBcnJheTogZnVuY3Rp
b24odHlwZSwgZmlsdGVyKSB7CiAgICB2YXIgYXJyYXkgPSBEUy5GaWx0ZXJlZFJlY29yZEFycmF5
LmNyZWF0ZSh7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGNvbnRlbnQ6IEVtYmVyLkEoKSwKICAg
ICAgc3RvcmU6IHRoaXMuc3RvcmUsCiAgICAgIG1hbmFnZXI6IHRoaXMsCiAgICAgIGZpbHRlckZ1
bmN0aW9uOiBmaWx0ZXIKICAgIH0pOwoKICAgIHRoaXMucmVnaXN0ZXJGaWx0ZXJlZFJlY29yZEFy
cmF5KGFycmF5LCB0eXBlLCBmaWx0ZXIpOwoKICAgIHJldHVybiBhcnJheTsKICB9LAoKICAvKioK
ICAgIENyZWF0ZSBhIGBEUy5BZGFwdGVyUG9wdWxhdGVkUmVjb3JkQXJyYXlgIGZvciBhIHR5cGUg
d2l0aCBnaXZlbiBxdWVyeS4KCiAgICBAbWV0aG9kIGNyZWF0ZUFkYXB0ZXJQb3B1bGF0ZWRSZWNv
cmRBcnJheQogICAgQHBhcmFtIHtDbGFzc30gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IHF1ZXJ5
CiAgICBAcmV0dXJuIHtEUy5BZGFwdGVyUG9wdWxhdGVkUmVjb3JkQXJyYXl9CiAgKi8KICBjcmVh
dGVBZGFwdGVyUG9wdWxhdGVkUmVjb3JkQXJyYXk6IGZ1bmN0aW9uKHR5cGUsIHF1ZXJ5KSB7CiAg
ICByZXR1cm4gRFMuQWRhcHRlclBvcHVsYXRlZFJlY29yZEFycmF5LmNyZWF0ZSh7CiAgICAgIHR5
cGU6IHR5cGUsCiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgY29udGVudDogRW1iZXIuQSgpLAog
ICAgICBzdG9yZTogdGhpcy5zdG9yZQogICAgfSk7CiAgfSwKCiAgLyoqCiAgICBSZWdpc3RlciBh
IFJlY29yZEFycmF5IGZvciBhIGdpdmVuIHR5cGUgdG8gYmUgYmFja2VkIGJ5CiAgICBhIGZpbHRl
ciBmdW5jdGlvbi4gVGhpcyB3aWxsIGNhdXNlIHRoZSBhcnJheSB0byB1cGRhdGUKICAgIGF1dG9t
YXRpY2FsbHkgd2hlbiByZWNvcmRzIG9mIHRoYXQgdHlwZSBjaGFuZ2UgYXR0cmlidXRlCiAgICB2
YWx1ZXMgb3Igc3RhdGVzLgoKICAgIEBtZXRob2QgcmVnaXN0ZXJGaWx0ZXJlZFJlY29yZEFycmF5
CiAgICBAcGFyYW0ge0RTLlJlY29yZEFycmF5fSBhcnJheQogICAgQHBhcmFtIHtDbGFzc30gdHlw
ZQogICAgQHBhcmFtIHtGdW5jdGlvbn0gZmlsdGVyCiAgKi8KICByZWdpc3RlckZpbHRlcmVkUmVj
b3JkQXJyYXk6IGZ1bmN0aW9uKGFycmF5LCB0eXBlLCBmaWx0ZXIpIHsKICAgIHZhciByZWNvcmRB
cnJheXMgPSB0aGlzLmZpbHRlcmVkUmVjb3JkQXJyYXlzLmdldCh0eXBlKTsKICAgIHJlY29yZEFy
cmF5cy5wdXNoKGFycmF5KTsKCiAgICB0aGlzLnVwZGF0ZUZpbHRlcihhcnJheSwgdHlwZSwgZmls
dGVyKTsKICB9LAoKICAvLyBJbnRlcm5hbGx5LCB3ZSBtYWludGFpbiBhIG1hcCBvZiBhbGwgdW5s
b2FkZWQgSURzIHJlcXVlc3RlZCBieQogIC8vIGEgTWFueUFycmF5LiBBcyB0aGUgYWRhcHRlciBs
b2FkcyBkYXRhIGludG8gdGhlIHN0b3JlLCB0aGUKICAvLyBzdG9yZSBub3RpZmllcyBhbnkgaW50
ZXJlc3RlZCBNYW55QXJyYXlzLiBXaGVuIHRoZSBNYW55QXJyYXkncwogIC8vIHRvdGFsIG51bWJl
ciBvZiBsb2FkaW5nIHJlY29yZHMgZHJvcHMgdG8gemVybywgaXQgYmVjb21lcwogIC8vIGBpc0xv
YWRlZGAgYW5kIGZpcmVzIGEgYGRpZExvYWRgIGV2ZW50LgogIHJlZ2lzdGVyV2FpdGluZ1JlY29y
ZEFycmF5OiBmdW5jdGlvbihyZWNvcmQsIGFycmF5KSB7CiAgICB2YXIgbG9hZGluZ1JlY29yZEFy
cmF5cyA9IHJlY29yZC5fbG9hZGluZ1JlY29yZEFycmF5cyB8fCBbXTsKICAgIGxvYWRpbmdSZWNv
cmRBcnJheXMucHVzaChhcnJheSk7CiAgICByZWNvcmQuX2xvYWRpbmdSZWNvcmRBcnJheXMgPSBs
b2FkaW5nUmVjb3JkQXJyYXlzOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgog
IEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIu
c2V0Owp2YXIgbWFwID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMubWFwOwoKdmFyIGVycm9yUHJvcHMg
PSBbJ2Rlc2NyaXB0aW9uJywgJ2ZpbGVOYW1lJywgJ2xpbmVOdW1iZXInLCAnbWVzc2FnZScsICdu
YW1lJywgJ251bWJlcicsICdzdGFjayddOwoKLyoqCiAgQSBgRFMuSW52YWxpZEVycm9yYCBpcyB1
c2VkIGJ5IGFuIGFkYXB0ZXIgdG8gc2lnbmFsIHRoZSBleHRlcm5hbCBBUEkKICB3YXMgdW5hYmxl
IHRvIHByb2Nlc3MgYSByZXF1ZXN0IGJlY2F1c2UgdGhlIGNvbnRlbnQgd2FzIG5vdAogIHNlbWFu
dGljYWxseSBjb3JyZWN0IG9yIG1lYW5pbmdmdWwgcGVyIHRoZSBBUEkuIFVzdWFsbHkgdGhpcyBt
ZWFucyBhCiAgcmVjb3JkIGZhaWxlZCBzb21lIGZvcm0gb2Ygc2VydmVyIHNpZGUgdmFsaWRhdGlv
bi4gV2hlbiBhIHByb21pc2UKICBmcm9tIGFuIGFkYXB0ZXIgaXMgcmVqZWN0ZWQgd2l0aCBhIGBE
Uy5JbnZhbGlkRXJyb3JgIHRoZSByZWNvcmQgd2lsbAogIHRyYW5zaXRpb24gdG8gdGhlIGBpbnZh
bGlkYCBzdGF0ZSBhbmQgdGhlIGVycm9ycyB3aWxsIGJlIHNldCB0byB0aGUKICBgZXJyb3JzYCBw
cm9wZXJ0eSBvbiB0aGUgcmVjb3JkLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3JpcHQKICBBcHAu
QXBwbGljYXRpb25BZGFwdGVyID0gRFMuUkVTVEFkYXB0ZXIuZXh0ZW5kKHsKICAgIGFqYXhFcnJv
cjogZnVuY3Rpb24oanFYSFIpIHsKICAgICAgdmFyIGVycm9yID0gdGhpcy5fc3VwZXIoanFYSFIp
OwoKICAgICAgaWYgKGpxWEhSICYmIGpxWEhSLnN0YXR1cyA9PT0gNDIyKSB7CiAgICAgICAgdmFy
IGpzb25FcnJvcnMgPSBFbWJlci4kLnBhcnNlSlNPTihqcVhIUi5yZXNwb25zZVRleHQpWyJlcnJv
cnMiXTsKICAgICAgICByZXR1cm4gbmV3IERTLkludmFsaWRFcnJvcihqc29uRXJyb3JzKTsKICAg
ICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgIH0KICAgIH0KICB9KTsKICBg
YGAKCiAgQGNsYXNzIEludmFsaWRFcnJvcgogIEBuYW1lc3BhY2UgRFMKKi8KRFMuSW52YWxpZEVy
cm9yID0gZnVuY3Rpb24oZXJyb3JzKSB7CiAgdmFyIHRtcCA9IEVycm9yLnByb3RvdHlwZS5jb25z
dHJ1Y3Rvci5jYWxsKHRoaXMsICJUaGUgYmFja2VuZCByZWplY3RlZCB0aGUgY29tbWl0IGJlY2F1
c2UgaXQgd2FzIGludmFsaWQ6ICIgKyBFbWJlci5pbnNwZWN0KGVycm9ycykpOwogIHRoaXMuZXJy
b3JzID0gZXJyb3JzOwoKICBmb3IgKHZhciBpPTAsIGw9ZXJyb3JQcm9wcy5sZW5ndGg7IGk8bDsg
aSsrKSB7CiAgICB0aGlzW2Vycm9yUHJvcHNbaV1dID0gdG1wW2Vycm9yUHJvcHNbaV1dOwogIH0K
fTsKRFMuSW52YWxpZEVycm9yLnByb3RvdHlwZSA9IEVtYmVyLmNyZWF0ZShFcnJvci5wcm90b3R5
cGUpOwoKLyoqCiAgQW4gYWRhcHRlciBpcyBhbiBvYmplY3QgdGhhdCByZWNlaXZlcyByZXF1ZXN0
cyBmcm9tIGEgc3RvcmUgYW5kCiAgdHJhbnNsYXRlcyB0aGVtIGludG8gdGhlIGFwcHJvcHJpYXRl
IGFjdGlvbiB0byB0YWtlIGFnYWluc3QgeW91cgogIHBlcnNpc3RlbmNlIGxheWVyLiBUaGUgcGVy
c2lzdGVuY2UgbGF5ZXIgaXMgdXN1YWxseSBhbiBIVFRQIEFQSSwgYnV0CiAgbWF5IGJlIGFueXRo
aW5nLCBzdWNoIGFzIHRoZSBicm93c2VyJ3MgbG9jYWwgc3RvcmFnZS4gVHlwaWNhbGx5IHRoZQog
IGFkYXB0ZXIgaXMgbm90IGludm9rZWQgZGlyZWN0bHkgaW5zdGVhZCBpdHMgZnVuY3Rpb25hbGl0
eSBpcyBhY2Nlc3NlZAogIHRocm91Z2ggdGhlIGBzdG9yZWAuCgogICMjIyBDcmVhdGluZyBhbiBB
ZGFwdGVyCgogIEZpcnN0LCBjcmVhdGUgYSBuZXcgc3ViY2xhc3Mgb2YgYERTLkFkYXB0ZXJgOgoK
ICBgYGBqYXZhc2NyaXB0CiAgQXBwLk15QWRhcHRlciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAg
IC8vIC4uLnlvdXIgY29kZSBoZXJlCiAgfSk7CiAgYGBgCgogIFRvIHRlbGwgeW91ciBzdG9yZSB3
aGljaCBhZGFwdGVyIHRvIHVzZSwgc2V0IGl0cyBgYWRhcHRlcmAgcHJvcGVydHk6CgogIGBgYGph
dmFzY3JpcHQKICBBcHAuc3RvcmUgPSBEUy5TdG9yZS5jcmVhdGUoewogICAgYWRhcHRlcjogQXBw
Lk15QWRhcHRlci5jcmVhdGUoKQogIH0pOwogIGBgYAoKICBgRFMuQWRhcHRlcmAgaXMgYW4gYWJz
dHJhY3QgYmFzZSBjbGFzcyB0aGF0IHlvdSBzaG91bGQgb3ZlcnJpZGUgaW4geW91cgogIGFwcGxp
Y2F0aW9uIHRvIGN1c3RvbWl6ZSBpdCBmb3IgeW91ciBiYWNrZW5kLiBUaGUgbWluaW11bSBzZXQg
b2YgbWV0aG9kcwogIHRoYXQgeW91IHNob3VsZCBpbXBsZW1lbnQgaXM6CgogICAgKiBgZmluZCgp
YAogICAgKiBgY3JlYXRlUmVjb3JkKClgCiAgICAqIGB1cGRhdGVSZWNvcmQoKWAKICAgICogYGRl
bGV0ZVJlY29yZCgpYAogICAgKiBgZmluZEFsbCgpYAogICAgKiBgZmluZFF1ZXJ5KClgCgogIFRv
IGltcHJvdmUgdGhlIG5ldHdvcmsgcGVyZm9ybWFuY2Ugb2YgeW91ciBhcHBsaWNhdGlvbiwgeW91
IGNhbiBvcHRpbWl6ZQogIHlvdXIgYWRhcHRlciBieSBvdmVycmlkaW5nIHRoZXNlIGxvd2VyLWxl
dmVsIG1ldGhvZHM6CgogICAgKiBgZmluZE1hbnkoKWAKCgogIEZvciBhbiBleGFtcGxlIGltcGxl
bWVudGF0aW9uLCBzZWUgYERTLlJFU1RBZGFwdGVyYCwgdGhlCiAgaW5jbHVkZWQgUkVTVCBhZGFw
dGVyLgoKICBAY2xhc3MgQWRhcHRlcgogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBFbWJlci5P
YmplY3QKKi8KCkRTLkFkYXB0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKCiAgLyoqCiAgICBJ
ZiB5b3Ugd291bGQgbGlrZSB5b3VyIGFkYXB0ZXIgdG8gdXNlIGEgY3VzdG9tIHNlcmlhbGl6ZXIg
eW91IGNhbgogICAgc2V0IHRoZSBgZGVmYXVsdFNlcmlhbGl6ZXJgIHByb3BlcnR5IHRvIGJlIHRo
ZSBuYW1lIG9mIHRoZSBjdXN0b20KICAgIHNlcmlhbGl6ZXIuCgogICAgTm90ZSB0aGUgYGRlZmF1
bHRTZXJpYWxpemVyYCBzZXJpYWxpemVyIGhhcyBhIGxvd2VyIHByaW9yaXR5IHRoZW4KICAgIGEg
bW9kZWwgc3BlY2lmaWMgc2VyaWFsaXplciAoaS5lLiBgUG9zdFNlcmlhbGl6ZXJgKSBvciB0aGUK
ICAgIGBhcHBsaWNhdGlvbmAgc2VyaWFsaXplci4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIg
RGphbmdvQWRhcHRlciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAgICAgZGVmYXVsdFNlcmlhbGl6
ZXI6ICdkamFuZ28nCiAgICB9KTsKICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBkZWZhdWx0U2VyaWFs
aXplcgogICAgQHR5cGUge1N0cmluZ30KICAqLwoKICAvKioKICAgIFRoZSBgZmluZCgpYCBtZXRo
b2QgaXMgaW52b2tlZCB3aGVuIHRoZSBzdG9yZSBpcyBhc2tlZCBmb3IgYSByZWNvcmQgdGhhdAog
ICAgaGFzIG5vdCBwcmV2aW91c2x5IGJlZW4gbG9hZGVkLiBJbiByZXNwb25zZSB0byBgZmluZCgp
YCBiZWluZyBjYWxsZWQsIHlvdQogICAgc2hvdWxkIHF1ZXJ5IHlvdXIgcGVyc2lzdGVuY2UgbGF5
ZXIgZm9yIGEgcmVjb3JkIHdpdGggdGhlIGdpdmVuIElELiBPbmNlCiAgICBmb3VuZCwgeW91IGNh
biBhc3luY2hyb25vdXNseSBjYWxsIHRoZSBzdG9yZSdzIGBwdXNoKClgIG1ldGhvZCB0byBwdXNo
CiAgICB0aGUgcmVjb3JkIGludG8gdGhlIHN0b3JlLgoKICAgIEhlcmUgaXMgYW4gZXhhbXBsZSBg
ZmluZGAgaW1wbGVtZW50YXRpb246CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLkFwcGxpY2F0
aW9uQWRhcHRlciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAgICAgZmluZDogZnVuY3Rpb24oc3Rv
cmUsIHR5cGUsIGlkKSB7CiAgICAgICAgdmFyIHVybCA9IFt0eXBlLCBpZF0uam9pbignLycpOwoK
ICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCBy
ZWplY3QpIHsKICAgICAgICAgIGpRdWVyeS5nZXRKU09OKHVybCkudGhlbihmdW5jdGlvbihkYXRh
KSB7CiAgICAgICAgICAgIEVtYmVyLnJ1bihudWxsLCByZXNvbHZlLCBkYXRhKTsKICAgICAgICAg
IH0sIGZ1bmN0aW9uKGpxWEhSKSB7CiAgICAgICAgICAgIGpxWEhSLnRoZW4gPSBudWxsOyAvLyB0
YW1lIGpRdWVyeSdzIGlsbCBtYW5uZXJlZCBwcm9taXNlcwogICAgICAgICAgICBFbWJlci5ydW4o
bnVsbCwgcmVqZWN0LCBqcVhIUik7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQog
ICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIGZpbmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0
b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge1N0
cmluZ30gaWQKICAgIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UKICAqLwogIGZpbmQ6IEVtYmVy
LnJlcXVpcmVkKEZ1bmN0aW9uKSwKCiAgLyoqCiAgICBUaGUgYGZpbmRBbGwoKWAgbWV0aG9kIGlz
IGNhbGxlZCB3aGVuIHlvdSBjYWxsIGBmaW5kYCBvbiB0aGUgc3RvcmUKICAgIHdpdGhvdXQgYW4g
SUQgKGkuZS4gYHN0b3JlLmZpbmQoJ3Bvc3QnKWApLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZh
c2NyaXB0CiAgICBBcHAuQXBwbGljYXRpb25BZGFwdGVyID0gRFMuQWRhcHRlci5leHRlbmQoewog
ICAgICBmaW5kQWxsOiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgc2luY2VUb2tlbikgewogICAgICAg
IHZhciB1cmwgPSB0eXBlOwogICAgICAgIHZhciBxdWVyeSA9IHsgc2luY2U6IHNpbmNlVG9rZW4g
fTsKICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZl
LCByZWplY3QpIHsKICAgICAgICAgIGpRdWVyeS5nZXRKU09OKHVybCwgcXVlcnkpLnRoZW4oZnVu
Y3Rpb24oZGF0YSkgewogICAgICAgICAgICBFbWJlci5ydW4obnVsbCwgcmVzb2x2ZSwgZGF0YSk7
CiAgICAgICAgICB9LCBmdW5jdGlvbihqcVhIUikgewogICAgICAgICAgICBqcVhIUi50aGVuID0g
bnVsbDsgLy8gdGFtZSBqUXVlcnkncyBpbGwgbWFubmVyZWQgcHJvbWlzZXMKICAgICAgICAgICAg
RW1iZXIucnVuKG51bGwsIHJlamVjdCwganFYSFIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7
CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQHByaXZhdGUKICAgIEBtZXRob2QgZmluZEFs
bAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMu
TW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7U3RyaW5nfSBzaW5jZVRva2VuCiAgICBAcmV0dXJuIHtQ
cm9taXNlfSBwcm9taXNlCiAgKi8KICBmaW5kQWxsOiBudWxsLAoKICAvKioKICAgIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCB3aGVuIHlvdSBjYWxsIGBmaW5kYCBvbiB0aGUgc3RvcmUgd2l0aCBhCiAg
ICBxdWVyeSBvYmplY3QgYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIgKGkuZS4gYHN0b3JlLmZpbmQo
J3BlcnNvbicsIHsKICAgIHBhZ2U6IDEgfSlgKS4KCiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNj
cmlwdAogICAgQXBwLkFwcGxpY2F0aW9uQWRhcHRlciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAg
ICAgZmluZFF1ZXJ5OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgcXVlcnkpIHsKICAgICAgICB2YXIg
dXJsID0gdHlwZTsKICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAuUHJvbWlzZShmdW5jdGlv
bihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIGpRdWVyeS5nZXRKU09OKHVybCwgcXVlcnkp
LnRoZW4oZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICBFbWJlci5ydW4obnVsbCwgcmVzb2x2
ZSwgZGF0YSk7CiAgICAgICAgICB9LCBmdW5jdGlvbihqcVhIUikgewogICAgICAgICAgICBqcVhI
Ui50aGVuID0gbnVsbDsgLy8gdGFtZSBqUXVlcnkncyBpbGwgbWFubmVyZWQgcHJvbWlzZXMKICAg
ICAgICAgICAgRW1iZXIucnVuKG51bGwsIHJlamVjdCwganFYSFIpOwogICAgICAgICAgfSk7CiAg
ICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQHByaXZhdGUKICAgIEBtZXRo
b2QgZmluZFF1ZXJ5CiAgICBAcGFyYW0ge0RTLlN0b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJj
bGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IHF1ZXJ5CiAgICBAcGFy
YW0ge0RTLkFkYXB0ZXJQb3B1bGF0ZWRSZWNvcmRBcnJheX0gcmVjb3JkQXJyYXkKICAgIEByZXR1
cm4ge1Byb21pc2V9IHByb21pc2UKICAqLwogIGZpbmRRdWVyeTogbnVsbCwKCiAgLyoqCiAgICBJ
ZiB0aGUgZ2xvYmFsbHkgdW5pcXVlIElEcyBmb3IgeW91ciByZWNvcmRzIHNob3VsZCBiZSBnZW5l
cmF0ZWQgb24gdGhlIGNsaWVudCwKICAgIGltcGxlbWVudCB0aGUgYGdlbmVyYXRlSWRGb3JSZWNv
cmQoKWAgbWV0aG9kLiBUaGlzIG1ldGhvZCB3aWxsIGJlIGludm9rZWQKICAgIGVhY2ggdGltZSB5
b3UgY3JlYXRlIGEgbmV3IHJlY29yZCwgYW5kIHRoZSB2YWx1ZSByZXR1cm5lZCBmcm9tIGl0IHdp
bGwgYmUKICAgIGFzc2lnbmVkIHRvIHRoZSByZWNvcmQncyBgcHJpbWFyeUtleWAuCgogICAgTW9z
dCB0cmFkaXRpb25hbCBSRVNULWxpa2UgSFRUUCBBUElzIHdpbGwgbm90IHVzZSB0aGlzIG1ldGhv
ZC4gSW5zdGVhZCwgdGhlIElECiAgICBvZiB0aGUgcmVjb3JkIHdpbGwgYmUgc2V0IGJ5IHRoZSBz
ZXJ2ZXIsIGFuZCB5b3VyIGFkYXB0ZXIgd2lsbCB1cGRhdGUgdGhlIHN0b3JlCiAgICB3aXRoIHRo
ZSBuZXcgSUQgd2hlbiBpdCBjYWxscyBgZGlkQ3JlYXRlUmVjb3JkKClgLiBPbmx5IGltcGxlbWVu
dCB0aGlzIG1ldGhvZCBpZgogICAgeW91IGludGVuZCB0byBnZW5lcmF0ZSByZWNvcmQgSURzIG9u
IHRoZSBjbGllbnQtc2lkZS4KCiAgICBUaGUgYGdlbmVyYXRlSWRGb3JSZWNvcmQoKWAgbWV0aG9k
IHdpbGwgYmUgaW52b2tlZCB3aXRoIHRoZSByZXF1ZXN0aW5nIHN0b3JlIGFzCiAgICB0aGUgZmly
c3QgcGFyYW1ldGVyIGFuZCB0aGUgbmV3bHkgY3JlYXRlZCByZWNvcmQgYXMgdGhlIHNlY29uZCBw
YXJhbWV0ZXI6CgogICAgYGBgamF2YXNjcmlwdAogICAgZ2VuZXJhdGVJZEZvclJlY29yZDogZnVu
Y3Rpb24oc3RvcmUsIHJlY29yZCkgewogICAgICB2YXIgdXVpZCA9IEFwcC5nZW5lcmF0ZVVVSURX
aXRoU3RhdGlzdGljYWxseUxvd09kZHNPZkNvbGxpc2lvbigpOwogICAgICByZXR1cm4gdXVpZDsK
ICAgIH0KICAgIGBgYAoKICAgIEBtZXRob2QgZ2VuZXJhdGVJZEZvclJlY29yZAogICAgQHBhcmFt
IHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHJldHVy
biB7U3RyaW5nfE51bWJlcn0gaWQKICAqLwogIGdlbmVyYXRlSWRGb3JSZWNvcmQ6IG51bGwsCgog
IC8qKgogICAgUHJveGllcyB0byB0aGUgc2VyaWFsaXplcidzIGBzZXJpYWxpemVgIG1ldGhvZC4K
CiAgICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLkFwcGxpY2F0aW9uQWRhcHRl
ciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAgICAgY3JlYXRlUmVjb3JkOiBmdW5jdGlvbihzdG9y
ZSwgdHlwZSwgcmVjb3JkKSB7CiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnNlcmlhbGl6ZShyZWNv
cmQsIHsgaW5jbHVkZUlkOiB0cnVlIH0pOwogICAgICAgIHZhciB1cmwgPSB0eXBlOwoKICAgICAg
ICAvLyAuLi4KICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIHNlcmlhbGl6ZQog
ICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBAcGFyYW0ge09iamVjdH0gICBvcHRpb25z
CiAgICBAcmV0dXJuIHtPYmplY3R9IHNlcmlhbGl6ZWQgcmVjb3JkCiAgKi8KICBzZXJpYWxpemU6
IGZ1bmN0aW9uKHJlY29yZCwgb3B0aW9ucykgewogICAgcmV0dXJuIGdldChyZWNvcmQsICdzdG9y
ZScpLnNlcmlhbGl6ZXJGb3IocmVjb3JkLmNvbnN0cnVjdG9yLnR5cGVLZXkpLnNlcmlhbGl6ZShy
ZWNvcmQsIG9wdGlvbnMpOwogIH0sCgogIC8qKgogICAgSW1wbGVtZW50IHRoaXMgbWV0aG9kIGlu
IGEgc3ViY2xhc3MgdG8gaGFuZGxlIHRoZSBjcmVhdGlvbiBvZgogICAgbmV3IHJlY29yZHMuCgog
ICAgU2VyaWFsaXplcyB0aGUgcmVjb3JkIGFuZCBzZW5kIGl0IHRvIHRoZSBzZXJ2ZXIuCgogICAg
RXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5BcHBsaWNhdGlvbkFkYXB0ZXIgPSBE
Uy5BZGFwdGVyLmV4dGVuZCh7CiAgICAgIGNyZWF0ZVJlY29yZDogZnVuY3Rpb24oc3RvcmUsIHR5
cGUsIHJlY29yZCkgewogICAgICAgIHZhciBkYXRhID0gdGhpcy5zZXJpYWxpemUocmVjb3JkLCB7
IGluY2x1ZGVJZDogdHJ1ZSB9KTsKICAgICAgICB2YXIgdXJsID0gdHlwZTsKCiAgICAgICAgcmV0
dXJuIG5ldyBFbWJlci5SU1ZQLlByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAg
ICAgICAgICBqUXVlcnkuYWpheCh7CiAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAg
ICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgIGRh
dGE6IGRhdGEKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICBF
bWJlci5ydW4obnVsbCwgcmVzb2x2ZSwgZGF0YSk7CiAgICAgICAgICB9LCBmdW5jdGlvbihqcVhI
UikgewogICAgICAgICAgICBqcVhIUi50aGVuID0gbnVsbDsgLy8gdGFtZSBqUXVlcnkncyBpbGwg
bWFubmVyZWQgcHJvbWlzZXMKICAgICAgICAgICAgRW1iZXIucnVuKG51bGwsIHJlamVjdCwganFY
SFIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgog
ICAgQG1ldGhvZCBjcmVhdGVSZWNvcmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBA
cGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlICAgdGhlIERTLk1vZGVsIGNsYXNzIG9m
IHRoZSByZWNvcmQKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHJldHVybiB7UHJv
bWlzZX0gcHJvbWlzZQogICovCiAgY3JlYXRlUmVjb3JkOiBFbWJlci5yZXF1aXJlZChGdW5jdGlv
biksCgogIC8qKgogICAgSW1wbGVtZW50IHRoaXMgbWV0aG9kIGluIGEgc3ViY2xhc3MgdG8gaGFu
ZGxlIHRoZSB1cGRhdGluZyBvZgogICAgYSByZWNvcmQuCgogICAgU2VyaWFsaXplcyB0aGUgcmVj
b3JkIHVwZGF0ZSBhbmQgc2VuZCBpdCB0byB0aGUgc2VydmVyLgoKICAgIEV4YW1wbGUKCiAgICBg
YGBqYXZhc2NyaXB0CiAgICBBcHAuQXBwbGljYXRpb25BZGFwdGVyID0gRFMuQWRhcHRlci5leHRl
bmQoewogICAgICB1cGRhdGVSZWNvcmQ6IGZ1bmN0aW9uKHN0b3JlLCB0eXBlLCByZWNvcmQpIHsK
ICAgICAgICB2YXIgZGF0YSA9IHRoaXMuc2VyaWFsaXplKHJlY29yZCwgeyBpbmNsdWRlSWQ6IHRy
dWUgfSk7CiAgICAgICAgdmFyIGlkID0gcmVjb3JkLmdldCgnaWQnKTsKICAgICAgICB2YXIgdXJs
ID0gW3R5cGUsIGlkXS5qb2luKCcvJyk7CgogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5Q
cm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgalF1ZXJ5LmFqYXgo
ewogICAgICAgICAgICB0eXBlOiAnUFVUJywKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAg
ICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgIH0p
LnRoZW4oZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICBFbWJlci5ydW4obnVsbCwgcmVzb2x2
ZSwgZGF0YSk7CiAgICAgICAgICB9LCBmdW5jdGlvbihqcVhIUikgewogICAgICAgICAgICBqcVhI
Ui50aGVuID0gbnVsbDsgLy8gdGFtZSBqUXVlcnkncyBpbGwgbWFubmVyZWQgcHJvbWlzZXMKICAg
ICAgICAgICAgRW1iZXIucnVuKG51bGwsIHJlamVjdCwganFYSFIpOwogICAgICAgICAgfSk7CiAg
ICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCB1cGRhdGVSZWNv
cmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERT
Lk1vZGVsfSB0eXBlICAgdGhlIERTLk1vZGVsIGNsYXNzIG9mIHRoZSByZWNvcmQKICAgIEBwYXJh
bSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAg
dXBkYXRlUmVjb3JkOiBFbWJlci5yZXF1aXJlZChGdW5jdGlvbiksCgogIC8qKgogICAgSW1wbGVt
ZW50IHRoaXMgbWV0aG9kIGluIGEgc3ViY2xhc3MgdG8gaGFuZGxlIHRoZSBkZWxldGlvbiBvZgog
ICAgYSByZWNvcmQuCgogICAgU2VuZHMgYSBkZWxldGUgcmVxdWVzdCBmb3IgdGhlIHJlY29yZCB0
byB0aGUgc2VydmVyLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQXBw
bGljYXRpb25BZGFwdGVyID0gRFMuQWRhcHRlci5leHRlbmQoewogICAgICBkZWxldGVSZWNvcmQ6
IGZ1bmN0aW9uKHN0b3JlLCB0eXBlLCByZWNvcmQpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMu
c2VyaWFsaXplKHJlY29yZCwgeyBpbmNsdWRlSWQ6IHRydWUgfSk7CiAgICAgICAgdmFyIGlkID0g
cmVjb3JkLmdldCgnaWQnKTsKICAgICAgICB2YXIgdXJsID0gW3R5cGUsIGlkXS5qb2luKCcvJyk7
CgogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUs
IHJlamVjdCkgewogICAgICAgICAgalF1ZXJ5LmFqYXgoewogICAgICAgICAgICB0eXBlOiAnREVM
RVRFJywKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbics
CiAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkg
ewogICAgICAgICAgICBFbWJlci5ydW4obnVsbCwgcmVzb2x2ZSwgZGF0YSk7CiAgICAgICAgICB9
LCBmdW5jdGlvbihqcVhIUikgewogICAgICAgICAgICBqcVhIUi50aGVuID0gbnVsbDsgLy8gdGFt
ZSBqUXVlcnkncyBpbGwgbWFubmVyZWQgcHJvbWlzZXMKICAgICAgICAgICAgRW1iZXIucnVuKG51
bGwsIHJlamVjdCwganFYSFIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAg
IH0pOwogICAgYGBgCgogICAgQG1ldGhvZCBkZWxldGVSZWNvcmQKICAgIEBwYXJhbSB7RFMuU3Rv
cmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlICAgdGhlIERT
Lk1vZGVsIGNsYXNzIG9mIHRoZSByZWNvcmQKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAog
ICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgZGVsZXRlUmVjb3JkOiBFbWJlci5y
ZXF1aXJlZChGdW5jdGlvbiksCgogIC8qKgogICAgRmluZCBtdWx0aXBsZSByZWNvcmRzIGF0IG9u
Y2UuCgogICAgQnkgZGVmYXVsdCwgaXQgbG9vcHMgb3ZlciB0aGUgcHJvdmlkZWQgaWRzIGFuZCBj
YWxscyBgZmluZGAgb24gZWFjaC4KICAgIE1heSBiZSBvdmVyd3JpdHRlbiB0byBpbXByb3ZlIHBl
cmZvcm1hbmNlIGFuZCByZWR1Y2UgdGhlIG51bWJlciBvZgogICAgc2VydmVyIHJlcXVlc3RzLgoK
ICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQXBwbGljYXRpb25BZGFwdGVy
ID0gRFMuQWRhcHRlci5leHRlbmQoewogICAgICBmaW5kTWFueTogZnVuY3Rpb24oc3RvcmUsIHR5
cGUsIGlkcykgewogICAgICAgIHZhciB1cmwgPSB0eXBlOwogICAgICAgIHJldHVybiBuZXcgRW1i
ZXIuUlNWUC5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgalF1
ZXJ5LmdldEpTT04odXJsLCB7aWRzOiBpZHN9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAg
ICAgICAgRW1iZXIucnVuKG51bGwsIHJlc29sdmUsIGRhdGEpOwogICAgICAgICAgfSwgZnVuY3Rp
b24oanFYSFIpIHsKICAgICAgICAgICAganFYSFIudGhlbiA9IG51bGw7IC8vIHRhbWUgalF1ZXJ5
J3MgaWxsIG1hbm5lcmVkIHByb21pc2VzCiAgICAgICAgICAgIEVtYmVyLnJ1bihudWxsLCByZWpl
Y3QsIGpxWEhSKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAg
IGBgYAoKICAgIEBtZXRob2QgZmluZE1hbnkKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAg
ICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlICAgdGhlIERTLk1vZGVsIGNsYXNz
IG9mIHRoZSByZWNvcmRzCiAgICBAcGFyYW0ge0FycmF5fSAgICBpZHMKICAgIEByZXR1cm4ge1By
b21pc2V9IHByb21pc2UKICAqLwogIGZpbmRNYW55OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgaWRz
KSB7CiAgICB2YXIgcHJvbWlzZXMgPSBtYXAuY2FsbChpZHMsIGZ1bmN0aW9uKGlkKSB7CiAgICAg
IHJldHVybiB0aGlzLmZpbmQoc3RvcmUsIHR5cGUsIGlkKTsKICAgIH0sIHRoaXMpOwoKICAgIHJl
dHVybiBFbWJlci5SU1ZQLmFsbChwcm9taXNlcyk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlv
bigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBm
bXQgPSBFbWJlci5TdHJpbmcuZm10LAogICAgaW5kZXhPZiA9IEVtYmVyLkVudW1lcmFibGVVdGls
cy5pbmRleE9mOwoKdmFyIGNvdW50ZXIgPSAwOwoKLyoqCiAgYERTLkZpeHR1cmVBZGFwdGVyYCBp
cyBhbiBhZGFwdGVyIHRoYXQgbG9hZHMgcmVjb3JkcyBmcm9tIG1lbW9yeS4KICBJdHMgcHJpbWFy
aWx5IHVzZWQgZm9yIGRldmVsb3BtZW50IGFuZCB0ZXN0aW5nLiBZb3UgY2FuIGFsc28gdXNlCiAg
YERTLkZpeHR1cmVBZGFwdGVyYCB3aGlsZSB3b3JraW5nIG9uIHRoZSBBUEkgYnV0IGFyZSBub3Qg
cmVhZHkgdG8KICBpbnRlZ3JhdGUgeWV0LiBJdCBpcyBhIGZ1bGx5IGZ1bmN0aW9uaW5nIGFkYXB0
ZXIuIEFsbCBDUlVEIG1ldGhvZHMKICBhcmUgaW1wbGVtZW50ZWQuIFlvdSBjYW4gYWxzbyBpbXBs
ZW1lbnQgcXVlcnkgbG9naWMgdGhhdCBhIHJlbW90ZQogIHN5c3RlbSB3b3VsZCBkby4gSXRzIHBv
c3NpYmxlIHRvIGRvIGRldmVsb3AgeW91ciBlbnRpcmUgYXBwbGljYXRpb24KICB3aXRoIGBEUy5G
aXh0dXJlQWRhcHRlcmAuCgogIEZvciBpbmZvcm1hdGlvbiBvbiBob3cgdG8gdXNlIHRoZSBgRml4
dHVyZUFkYXB0ZXJgIGluIHlvdXIKICBhcHBsaWNhdGlvbiBwbGVhc2Ugc2VlIHRoZSBbRml4dHVy
ZUFkYXB0ZXIKICBndWlkZV0oL2d1aWRlcy9tb2RlbHMvdGhlLWZpeHR1cmUtYWRhcHRlci8pLgoK
ICBAY2xhc3MgRml4dHVyZUFkYXB0ZXIKICBAbmFtZXNwYWNlIERTCiAgQGV4dGVuZHMgRFMuQWRh
cHRlcgoqLwpEUy5GaXh0dXJlQWRhcHRlciA9IERTLkFkYXB0ZXIuZXh0ZW5kKHsKICAvLyBieSBk
ZWZhdWx0LCBmaXh0dXJlcyBhcmUgYWxyZWFkeSBpbiBub3JtYWxpemVkIGZvcm0KICBzZXJpYWxp
emVyOiBudWxsLAoKICAvKioKICAgIElmIGBzaW11bGF0ZVJlbW90ZVJlc3BvbnNlYCBpcyBgdHJ1
ZWAgdGhlIGBGaXh0dXJlQWRhcHRlcmAgd2lsbAogICAgd2FpdCBhIG51bWJlciBvZiBtaWxsaXNl
Y29uZHMgYmVmb3JlIHJlc29sdmluZyBwcm9taXNlcyB3aXRoIHRoZQogICAgZml4dHVyZSB2YWx1
ZXMuIFRoZSB3YWl0IHRpbWUgY2FuIGJlIGNvbmZpZ3VyZWQgdmlhIHRoZSBgbGF0ZW5jeWAKICAg
IHByb3BlcnR5LgoKICAgIEBwcm9wZXJ0eSBzaW11bGF0ZVJlbW90ZVJlc3BvbnNlCiAgICBAdHlw
ZSB7Qm9vbGVhbn0KICAgIEBkZWZhdWx0IHRydWUKICAqLwogIHNpbXVsYXRlUmVtb3RlUmVzcG9u
c2U6IHRydWUsCgogIC8qKgogICAgQnkgZGVmYXVsdCB0aGUgYEZpeHR1cmVBZGFwdGVyYCB3aWxs
IHNpbXVsYXRlIGEgd2FpdCBvZiB0aGUKICAgIGBsYXRlbmN5YCBtaWxsaXNlY29uZHMgYmVmb3Jl
IHJlc29sdmluZyBwcm9taXNlcyB3aXRoIHRoZSBmaXh0dXJlCiAgICB2YWx1ZXMuIFRoaXMgYmVo
YXZpb3IgY2FuIGJlIHR1cm5lZCBvZmYgdmlhIHRoZQogICAgYHNpbXVsYXRlUmVtb3RlUmVzcG9u
c2VgIHByb3BlcnR5LgoKICAgIEBwcm9wZXJ0eSBsYXRlbmN5CiAgICBAdHlwZSB7TnVtYmVyfQog
ICAgQGRlZmF1bHQgNTAKICAqLwogIGxhdGVuY3k6IDUwLAoKICAvKioKICAgIEltcGxlbWVudCB0
aGlzIG1ldGhvZCBpbiBvcmRlciB0byBwcm92aWRlIGRhdGEgYXNzb2NpYXRlZCB3aXRoIGEgdHlw
ZQoKICAgIEBtZXRob2QgZml4dHVyZXNGb3JUeXBlCiAgICBAcGFyYW0ge1N1YmNsYXNzIG9mIERT
Lk1vZGVsfSB0eXBlCiAgICBAcmV0dXJuIHtBcnJheX0KICAqLwogIGZpeHR1cmVzRm9yVHlwZTog
ZnVuY3Rpb24odHlwZSkgewogICAgaWYgKHR5cGUuRklYVFVSRVMpIHsKICAgICAgdmFyIGZpeHR1
cmVzID0gRW1iZXIuQSh0eXBlLkZJWFRVUkVTKTsKICAgICAgcmV0dXJuIGZpeHR1cmVzLm1hcChm
dW5jdGlvbihmaXh0dXJlKXsKICAgICAgICB2YXIgZml4dHVyZUlkVHlwZSA9IHR5cGVvZiBmaXh0
dXJlLmlkOwogICAgICAgIGlmKGZpeHR1cmVJZFR5cGUgIT09ICJudW1iZXIiICYmIGZpeHR1cmVJ
ZFR5cGUgIT09ICJzdHJpbmciKXsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmbXQoJ3RoZSBp
ZCBwcm9wZXJ0eSBtdXN0IGJlIGRlZmluZWQgYXMgYSBudW1iZXIgb3Igc3RyaW5nIGZvciBmaXh0
dXJlICVAJywgW2ZpeHR1cmVdKSk7CiAgICAgICAgfQogICAgICAgIGZpeHR1cmUuaWQgPSBmaXh0
dXJlLmlkICsgJyc7CiAgICAgICAgcmV0dXJuIGZpeHR1cmU7CiAgICAgIH0pOwogICAgfQogICAg
cmV0dXJuIG51bGw7CiAgfSwKCiAgLyoqCiAgICBJbXBsZW1lbnQgdGhpcyBtZXRob2QgaW4gb3Jk
ZXIgdG8gcXVlcnkgZml4dHVyZXMgZGF0YQoKICAgIEBtZXRob2QgcXVlcnlGaXh0dXJlcwogICAg
QHBhcmFtIHtBcnJheX0gZml4dHVyZQogICAgQHBhcmFtIHtPYmplY3R9IHF1ZXJ5CiAgICBAcGFy
YW0ge1N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcmV0dXJuIHtQcm9taXNlfEFycmF5
fQogICovCiAgcXVlcnlGaXh0dXJlczogZnVuY3Rpb24oZml4dHVyZXMsIHF1ZXJ5LCB0eXBlKSB7
CiAgICBFbWJlci5hc3NlcnQoJ05vdCBpbXBsZW1lbnRlZDogWW91IG11c3Qgb3ZlcnJpZGUgdGhl
IERTLkZpeHR1cmVBZGFwdGVyOjpxdWVyeUZpeHR1cmVzIG1ldGhvZCB0byBzdXBwb3J0IHF1ZXJ5
aW5nIHRoZSBmaXh0dXJlIHN0b3JlLicpOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCB1cGRhdGVG
aXh0dXJlcwogICAgQHBhcmFtIHtTdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFt
IHtBcnJheX0gZml4dHVyZQogICovCiAgdXBkYXRlRml4dHVyZXM6IGZ1bmN0aW9uKHR5cGUsIGZp
eHR1cmUpIHsKICAgIGlmKCF0eXBlLkZJWFRVUkVTKSB7CiAgICAgIHR5cGUuRklYVFVSRVMgPSBb
XTsKICAgIH0KCiAgICB2YXIgZml4dHVyZXMgPSB0eXBlLkZJWFRVUkVTOwoKICAgIHRoaXMuZGVs
ZXRlTG9hZGVkRml4dHVyZSh0eXBlLCBmaXh0dXJlKTsKCiAgICBmaXh0dXJlcy5wdXNoKGZpeHR1
cmUpOwogIH0sCgogIC8qKgogICAgSW1wbGVtZW50IHRoaXMgbWV0aG9kIGluIG9yZGVyIHRvIHBy
b3ZpZGUganNvbiBmb3IgQ1JVRCBtZXRob2RzCgogICAgQG1ldGhvZCBtb2NrSlNPTgogICAgQHBh
cmFtIHtTdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVj
b3JkCiAgKi8KICBtb2NrSlNPTjogZnVuY3Rpb24oc3RvcmUsIHR5cGUsIHJlY29yZCkgewogICAg
cmV0dXJuIHN0b3JlLnNlcmlhbGl6ZXJGb3IodHlwZSkuc2VyaWFsaXplKHJlY29yZCwgeyBpbmNs
dWRlSWQ6IHRydWUgfSk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGdlbmVyYXRlSWRGb3JSZWNv
cmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNv
cmQKICAgIEByZXR1cm4ge1N0cmluZ30gaWQKICAqLwogIGdlbmVyYXRlSWRGb3JSZWNvcmQ6IGZ1
bmN0aW9uKHN0b3JlKSB7CiAgICByZXR1cm4gImZpeHR1cmUtIiArIGNvdW50ZXIrKzsKICB9LAoK
ICAvKioKICAgIEBtZXRob2QgZmluZAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBw
YXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7U3RyaW5nfSBpZAog
ICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgZmluZDogZnVuY3Rpb24oc3RvcmUs
IHR5cGUsIGlkKSB7CiAgICB2YXIgZml4dHVyZXMgPSB0aGlzLmZpeHR1cmVzRm9yVHlwZSh0eXBl
KSwKICAgICAgICBmaXh0dXJlOwoKICAgIEVtYmVyLmFzc2VydCgiVW5hYmxlIHRvIGZpbmQgZml4
dHVyZXMgZm9yIG1vZGVsIHR5cGUgIit0eXBlLnRvU3RyaW5nKCksIGZpeHR1cmVzKTsKCiAgICBp
ZiAoZml4dHVyZXMpIHsKICAgICAgZml4dHVyZSA9IEVtYmVyLkEoZml4dHVyZXMpLmZpbmRQcm9w
ZXJ0eSgnaWQnLCBpZCk7CiAgICB9CgogICAgaWYgKGZpeHR1cmUpIHsKICAgICAgcmV0dXJuIHRo
aXMuc2ltdWxhdGVSZW1vdGVDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBmaXh0dXJl
OwogICAgICB9LCB0aGlzKTsKICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRob2QgZmluZE1hbnkK
ICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1v
ZGVsfSB0eXBlCiAgICBAcGFyYW0ge0FycmF5fSBpZHMKICAgIEByZXR1cm4ge1Byb21pc2V9IHBy
b21pc2UKICAqLwogIGZpbmRNYW55OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgaWRzKSB7CiAgICB2
YXIgZml4dHVyZXMgPSB0aGlzLmZpeHR1cmVzRm9yVHlwZSh0eXBlKTsKCiAgICBFbWJlci5hc3Nl
cnQoIlVuYWJsZSB0byBmaW5kIGZpeHR1cmVzIGZvciBtb2RlbCB0eXBlICIrdHlwZS50b1N0cmlu
ZygpLCBmaXh0dXJlcyk7CgogICAgaWYgKGZpeHR1cmVzKSB7CiAgICAgIGZpeHR1cmVzID0gZml4
dHVyZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaW5kZXhPZihpZHMs
IGl0ZW0uaWQpICE9PSAtMTsKICAgICAgfSk7CiAgICB9CgogICAgaWYgKGZpeHR1cmVzKSB7CiAg
ICAgIHJldHVybiB0aGlzLnNpbXVsYXRlUmVtb3RlQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICBy
ZXR1cm4gZml4dHVyZXM7CiAgICAgIH0sIHRoaXMpOwogICAgfQogIH0sCgogIC8qKgogICAgQHBy
aXZhdGUKICAgIEBtZXRob2QgZmluZEFsbAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAg
IEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7U3RyaW5nfSBz
aW5jZVRva2VuCiAgICBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBmaW5kQWxsOiBm
dW5jdGlvbihzdG9yZSwgdHlwZSkgewogICAgdmFyIGZpeHR1cmVzID0gdGhpcy5maXh0dXJlc0Zv
clR5cGUodHlwZSk7CgogICAgRW1iZXIuYXNzZXJ0KCJVbmFibGUgdG8gZmluZCBmaXh0dXJlcyBm
b3IgbW9kZWwgdHlwZSAiK3R5cGUudG9TdHJpbmcoKSwgZml4dHVyZXMpOwoKICAgIHJldHVybiB0
aGlzLnNpbXVsYXRlUmVtb3RlQ2FsbChmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZpeHR1cmVz
OwogICAgfSwgdGhpcyk7CiAgfSwKCiAgLyoqCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBmaW5k
UXVlcnkKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9m
IERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0gcXVlcnkKICAgIEBwYXJhbSB7RFMu
QWRhcHRlclBvcHVsYXRlZFJlY29yZEFycmF5fSByZWNvcmRBcnJheQogICAgQHJldHVybiB7UHJv
bWlzZX0gcHJvbWlzZQogICovCiAgZmluZFF1ZXJ5OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgcXVl
cnksIGFycmF5KSB7CiAgICB2YXIgZml4dHVyZXMgPSB0aGlzLmZpeHR1cmVzRm9yVHlwZSh0eXBl
KTsKCiAgICBFbWJlci5hc3NlcnQoIlVuYWJsZSB0byBmaW5kIGZpeHR1cmVzIGZvciBtb2RlbCB0
eXBlICIrdHlwZS50b1N0cmluZygpLCBmaXh0dXJlcyk7CgogICAgZml4dHVyZXMgPSB0aGlzLnF1
ZXJ5Rml4dHVyZXMoZml4dHVyZXMsIHF1ZXJ5LCB0eXBlKTsKCiAgICBpZiAoZml4dHVyZXMpIHsK
ICAgICAgcmV0dXJuIHRoaXMuc2ltdWxhdGVSZW1vdGVDYWxsKGZ1bmN0aW9uKCkgewogICAgICAg
IHJldHVybiBmaXh0dXJlczsKICAgICAgfSwgdGhpcyk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBA
bWV0aG9kIGNyZWF0ZVJlY29yZAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJh
bSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29y
ZAogICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgY3JlYXRlUmVjb3JkOiBmdW5j
dGlvbihzdG9yZSwgdHlwZSwgcmVjb3JkKSB7CiAgICB2YXIgZml4dHVyZSA9IHRoaXMubW9ja0pT
T04oc3RvcmUsIHR5cGUsIHJlY29yZCk7CgogICAgdGhpcy51cGRhdGVGaXh0dXJlcyh0eXBlLCBm
aXh0dXJlKTsKCiAgICByZXR1cm4gdGhpcy5zaW11bGF0ZVJlbW90ZUNhbGwoZnVuY3Rpb24oKSB7
CiAgICAgIHJldHVybiBmaXh0dXJlOwogICAgfSwgdGhpcyk7CiAgfSwKCiAgLyoqCiAgICBAbWV0
aG9kIHVwZGF0ZVJlY29yZAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7
c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAog
ICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgdXBkYXRlUmVjb3JkOiBmdW5jdGlv
bihzdG9yZSwgdHlwZSwgcmVjb3JkKSB7CiAgICB2YXIgZml4dHVyZSA9IHRoaXMubW9ja0pTT04o
c3RvcmUsIHR5cGUsIHJlY29yZCk7CgogICAgdGhpcy51cGRhdGVGaXh0dXJlcyh0eXBlLCBmaXh0
dXJlKTsKCiAgICByZXR1cm4gdGhpcy5zaW11bGF0ZVJlbW90ZUNhbGwoZnVuY3Rpb24oKSB7CiAg
ICAgIHJldHVybiBmaXh0dXJlOwogICAgfSwgdGhpcyk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9k
IGRlbGV0ZVJlY29yZAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3Vi
Y2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAg
QHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAgZGVsZXRlUmVjb3JkOiBmdW5jdGlvbihz
dG9yZSwgdHlwZSwgcmVjb3JkKSB7CiAgICB2YXIgZml4dHVyZSA9IHRoaXMubW9ja0pTT04oc3Rv
cmUsIHR5cGUsIHJlY29yZCk7CgogICAgdGhpcy5kZWxldGVMb2FkZWRGaXh0dXJlKHR5cGUsIGZp
eHR1cmUpOwoKICAgIHJldHVybiB0aGlzLnNpbXVsYXRlUmVtb3RlQ2FsbChmdW5jdGlvbigpIHsK
ICAgICAgLy8gbm8gcGF5bG9hZCBpbiBhIGRlbGV0aW9uCiAgICAgIHJldHVybiBudWxsOwogICAg
fSk7CiAgfSwKCiAgLyoKICAgIEBtZXRob2QgZGVsZXRlTG9hZGVkRml4dHVyZQogICAgQHByaXZh
dGUKICAgIEBwYXJhbSB0eXBlCiAgICBAcGFyYW0gcmVjb3JkCiAgKi8KICBkZWxldGVMb2FkZWRG
aXh0dXJlOiBmdW5jdGlvbih0eXBlLCByZWNvcmQpIHsKICAgIHZhciBleGlzdGluZ0ZpeHR1cmUg
PSB0aGlzLmZpbmRFeGlzdGluZ0ZpeHR1cmUodHlwZSwgcmVjb3JkKTsKCiAgICBpZihleGlzdGlu
Z0ZpeHR1cmUpIHsKICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZih0eXBlLkZJWFRVUkVTLCBleGlz
dGluZ0ZpeHR1cmUpOwogICAgICB0eXBlLkZJWFRVUkVTLnNwbGljZShpbmRleCwgMSk7CiAgICAg
IHJldHVybiB0cnVlOwogICAgfQogIH0sCgogIC8qCiAgICBAbWV0aG9kIGZpbmRFeGlzdGluZ0Zp
eHR1cmUKICAgIEBwcml2YXRlCiAgICBAcGFyYW0gdHlwZQogICAgQHBhcmFtIHJlY29yZAogICov
CiAgZmluZEV4aXN0aW5nRml4dHVyZTogZnVuY3Rpb24odHlwZSwgcmVjb3JkKSB7CiAgICB2YXIg
Zml4dHVyZXMgPSB0aGlzLmZpeHR1cmVzRm9yVHlwZSh0eXBlKTsKICAgIHZhciBpZCA9IGdldChy
ZWNvcmQsICdpZCcpOwoKICAgIHJldHVybiB0aGlzLmZpbmRGaXh0dXJlQnlJZChmaXh0dXJlcywg
aWQpOwogIH0sCgogIC8qCiAgICBAbWV0aG9kIGZpbmRGaXh0dXJlQnlJZAogICAgQHByaXZhdGUK
ICAgIEBwYXJhbSBmaXh0dXJlcwogICAgQHBhcmFtIGlkCiAgKi8KICBmaW5kRml4dHVyZUJ5SWQ6
IGZ1bmN0aW9uKGZpeHR1cmVzLCBpZCkgewogICAgcmV0dXJuIEVtYmVyLkEoZml4dHVyZXMpLmZp
bmQoZnVuY3Rpb24ocikgewogICAgICBpZignJytnZXQociwgJ2lkJykgPT09ICcnK2lkKSB7CiAg
ICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog
ICAgICB9CiAgICB9KTsKICB9LAoKICAvKgogICAgQG1ldGhvZCBzaW11bGF0ZVJlbW90ZUNhbGwK
ICAgIEBwcml2YXRlCiAgICBAcGFyYW0gY2FsbGJhY2sKICAgIEBwYXJhbSBjb250ZXh0CiAgKi8K
ICBzaW11bGF0ZVJlbW90ZUNhbGw6IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICB2
YXIgYWRhcHRlciA9IHRoaXM7CgogICAgcmV0dXJuIG5ldyBFbWJlci5SU1ZQLlByb21pc2UoZnVu
Y3Rpb24ocmVzb2x2ZSkgewogICAgICBpZiAoZ2V0KGFkYXB0ZXIsICdzaW11bGF0ZVJlbW90ZVJl
c3BvbnNlJykpIHsKICAgICAgICAvLyBTY2hlZHVsZSB3aXRoIHNldFRpbWVvdXQKICAgICAgICBF
bWJlci5ydW4ubGF0ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXNvbHZlKGNhbGxiYWNrLmNh
bGwoY29udGV4dCkpOwogICAgICAgIH0sIGdldChhZGFwdGVyLCAnbGF0ZW5jeScpKTsKICAgICAg
fSBlbHNlIHsKICAgICAgICAvLyBBc3luY2hyb25vdXMsIGJ1dCBhdCB0aGUgb2YgdGhlIHJ1bmxv
b3Agd2l0aCB6ZXJvIGxhdGVuY3kKICAgICAgICBFbWJlci5ydW4uc2NoZWR1bGUoJ2FjdGlvbnMn
LCBudWxsLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJlc29sdmUoY2FsbGJhY2suY2FsbChjb250
ZXh0KSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sICJEUzogRml4dHVyZUFkYXB0ZXIjc2lt
dWxhdGVSZW1vdGVDYWxsIik7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAg
QG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5z
ZXQ7CnZhciBmb3JFYWNoID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMuZm9yRWFjaDsKdmFyIG1hcCA9
IEVtYmVyLkFycmF5UG9seWZpbGxzLm1hcDsKCmZ1bmN0aW9uIGNvZXJjZUlkKGlkKSB7CiAgcmV0
dXJuIGlkID09IG51bGwgPyBudWxsIDogaWQrJyc7Cn0KCi8qKgogIE5vcm1hbGx5LCBhcHBsaWNh
dGlvbnMgd2lsbCB1c2UgdGhlIGBSRVNUU2VyaWFsaXplcmAgYnkgaW1wbGVtZW50aW5nCiAgdGhl
IGBub3JtYWxpemVgIG1ldGhvZCBhbmQgaW5kaXZpZHVhbCBub3JtYWxpemF0aW9ucyB1bmRlcgog
IGBub3JtYWxpemVIYXNoYC4KCiAgVGhpcyBhbGxvd3MgeW91IHRvIGRvIHdoYXRldmVyIGtpbmQg
b2YgbXVuZ2luZyB5b3UgbmVlZCwgYW5kIGlzCiAgZXNwZWNpYWxseSB1c2VmdWwgaWYgeW91ciBz
ZXJ2ZXIgaXMgaW5jb25zaXN0ZW50IGFuZCB5b3UgbmVlZCB0bwogIGRvIG11bmdpbmcgZGlmZmVy
ZW50bHkgZm9yIG1hbnkgZGlmZmVyZW50IGtpbmRzIG9mIHJlc3BvbnNlcy4KCiAgU2VlIHRoZSBg
bm9ybWFsaXplYCBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uLgoKICAjIyBBY3Jv
c3MgdGhlIEJvYXJkIE5vcm1hbGl6YXRpb24KCiAgVGhlcmUgYXJlIGFsc28gYSBudW1iZXIgb2Yg
aG9va3MgdGhhdCB5b3UgbWlnaHQgZmluZCB1c2VmdWwgdG8gZGVmaW5lZAogIGFjcm9zcy10aGUt
Ym9hcmQgcnVsZXMgZm9yIHlvdXIgcGF5bG9hZC4gVGhlc2UgcnVsZXMgd2lsbCBiZSB1c2VmdWwK
ICBpZiB5b3VyIHNlcnZlciBpcyBjb25zaXN0ZW50LCBvciBpZiB5b3UncmUgYnVpbGRpbmcgYW4g
YWRhcHRlciBmb3IKICBhbiBpbmZyYXN0cnVjdHVyZSBzZXJ2aWNlLCBsaWtlIFBhcnNlLCBhbmQg
d2FudCB0byBlbmNvZGUgc2VydmljZQogIGNvbnZlbnRpb25zLgoKICBGb3IgZXhhbXBsZSwgaWYg
YWxsIG9mIHlvdXIga2V5cyBhcmUgdW5kZXJzY29yZWQgYW5kIGFsbC1jYXBzLCBidXQKICBvdGhl
cndpc2UgY29uc2lzdGVudCB3aXRoIHRoZSBuYW1lcyB5b3UgdXNlIGluIHlvdXIgbW9kZWxzLCB5
b3UKICBjYW4gaW1wbGVtZW50IGFjcm9zcy10aGUtYm9hcmQgcnVsZXMgZm9yIGhvdyB0byBjb252
ZXJ0IGFuIGF0dHJpYnV0ZQogIG5hbWUgaW4geW91ciBtb2RlbCB0byBhIGtleSBpbiB5b3VyIEpT
T04uCgogIGBgYGpzCiAgQXBwLkFwcGxpY2F0aW9uU2VyaWFsaXplciA9IERTLlJFU1RTZXJpYWxp
emVyLmV4dGVuZCh7CiAgICBrZXlGb3JBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAg
cmV0dXJuIEVtYmVyLlN0cmluZy51bmRlcnNjb3JlKGF0dHIpLnRvVXBwZXJDYXNlKCk7CiAgICB9
CiAgfSk7CiAgYGBgCgogIFlvdSBjYW4gYWxzbyBpbXBsZW1lbnQgYGtleUZvclJlbGF0aW9uc2hp
cGAsIHdoaWNoIHRha2VzIHRoZSBuYW1lCiAgb2YgdGhlIHJlbGF0aW9uc2hpcCBhcyB0aGUgZmly
c3QgcGFyYW1ldGVyLCBhbmQgdGhlIGtpbmQgb2YKICByZWxhdGlvbnNoaXAgKGBoYXNNYW55YCBv
ciBgYmVsb25nc1RvYCkgYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIuCgogIEBjbGFzcyBSRVNUU2Vy
aWFsaXplcgogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBEUy5KU09OU2VyaWFsaXplcgoqLwpE
Uy5SRVNUU2VyaWFsaXplciA9IERTLkpTT05TZXJpYWxpemVyLmV4dGVuZCh7CiAgLyoqCiAgICBJ
ZiB5b3Ugd2FudCB0byBkbyBub3JtYWxpemF0aW9ucyBzcGVjaWZpYyB0byBzb21lIHBhcnQgb2Yg
dGhlIHBheWxvYWQsIHlvdQogICAgY2FuIHNwZWNpZnkgdGhvc2UgdW5kZXIgYG5vcm1hbGl6ZUhh
c2hgLgoKICAgIEZvciBleGFtcGxlLCBnaXZlbiB0aGUgZm9sbG93aW5nIGpzb24gd2hlcmUgdGhl
IHRoZSBgSURzYCB1bmRlcgogICAgYCJjb21tZW50cyJgIGFyZSBwcm92aWRlZCBhcyBgX2lkYCBp
bnN0ZWFkIG9mIGBpZGAuCgogICAgYGBgamF2YXNjcmlwdAogICAgewogICAgICAicG9zdCI6IHsK
ICAgICAgICAiaWQiOiAxLAogICAgICAgICJ0aXRsZSI6ICJSYWlscyBpcyBvbWFrYXNlIiwKICAg
ICAgICAiY29tbWVudHMiOiBbIDEsIDIgXQogICAgICB9LAogICAgICAiY29tbWVudHMiOiBbewog
ICAgICAgICJfaWQiOiAxLAogICAgICAgICJib2R5IjogIkZJUlNUIgogICAgICB9LCB7CiAgICAg
ICAgIl9pZCI6IDIsCiAgICAgICAgImJvZHkiOiAiUmFpbHMgaXMgdW5hZ2kiCiAgICAgIH1dCiAg
ICB9CiAgICBgYGAKCiAgICBZb3UgdXNlIGBub3JtYWxpemVIYXNoYCB0byBub3JtYWxpemUganVz
dCB0aGUgY29tbWVudHM6CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlBvc3RTZXJpYWxpemVy
ID0gRFMuUkVTVFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgbm9ybWFsaXplSGFzaDogewogICAg
ICAgIGNvbW1lbnRzOiBmdW5jdGlvbihoYXNoKSB7CiAgICAgICAgICBoYXNoLmlkID0gaGFzaC5f
aWQ7CiAgICAgICAgICBkZWxldGUgaGFzaC5faWQ7CiAgICAgICAgICByZXR1cm4gaGFzaDsKICAg
ICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgVGhlIGtleSB1bmRlciBgbm9ybWFs
aXplSGFzaGAgaXMgdXN1YWxseSBqdXN0IHRoZSBvcmlnaW5hbCBrZXkKICAgIHRoYXQgd2FzIGlu
IHRoZSBvcmlnaW5hbCBwYXlsb2FkLiBIb3dldmVyLCBrZXkgbmFtZXMgd2lsbCBiZQogICAgaW1w
YWN0ZWQgYnkgYW55IG1vZGlmaWNhdGlvbnMgZG9uZSBpbiB0aGUgYG5vcm1hbGl6ZVBheWxvYWRg
CiAgICBtZXRob2QuIFRoZSBgRFMuUkVTVFNlcmlhbGl6ZXJgJ3MgZGVmYXVsdCBpbXBsZW1lbnRp
b24gbWFrZXMgbm8KICAgIGNoYW5nZXMgdG8gdGhlIHBheWxvYWQga2V5cy4KCiAgICBAcHJvcGVy
dHkgbm9ybWFsaXplSGFzaAogICAgQHR5cGUge09iamVjdH0KICAgIEBkZWZhdWx0IHVuZGVmaW5l
ZAogICovCgogIC8qKgogICAgTm9ybWFsaXplcyBhIHBhcnQgb2YgdGhlIEpTT04gcGF5bG9hZCBy
ZXR1cm5lZCBieQogICAgdGhlIHNlcnZlci4gWW91IHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhv
ZCwgbXVuZ2UgdGhlIGhhc2gKICAgIGFuZCBjYWxsIHN1cGVyIGlmIHlvdSBoYXZlIGdlbmVyaWMg
bm9ybWFsaXphdGlvbiB0byBkby4KCiAgICBJdCB0YWtlcyB0aGUgdHlwZSBvZiB0aGUgcmVjb3Jk
IHRoYXQgaXMgYmVpbmcgbm9ybWFsaXplZAogICAgKGFzIGEgRFMuTW9kZWwgY2xhc3MpLCB0aGUg
cHJvcGVydHkgd2hlcmUgdGhlIGhhc2ggd2FzCiAgICBvcmlnaW5hbGx5IGZvdW5kLCBhbmQgdGhl
IGhhc2ggdG8gbm9ybWFsaXplLgoKICAgIEZvciBleGFtcGxlLCBpZiB5b3UgaGF2ZSBhIHBheWxv
YWQgdGhhdCBsb29rcyBsaWtlIHRoaXM6CgogICAgYGBganMKICAgIHsKICAgICAgInBvc3QiOiB7
CiAgICAgICAgImlkIjogMSwKICAgICAgICAidGl0bGUiOiAiUmFpbHMgaXMgb21ha2FzZSIsCiAg
ICAgICAgImNvbW1lbnRzIjogWyAxLCAyIF0KICAgICAgfSwKICAgICAgImNvbW1lbnRzIjogW3sK
ICAgICAgICAiaWQiOiAxLAogICAgICAgICJib2R5IjogIkZJUlNUIgogICAgICB9LCB7CiAgICAg
ICAgImlkIjogMiwKICAgICAgICAiYm9keSI6ICJSYWlscyBpcyB1bmFnaSIKICAgICAgfV0KICAg
IH0KICAgIGBgYAoKICAgIFRoZSBgbm9ybWFsaXplYCBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgdGhy
ZWUgdGltZXM6CgogICAgKiBXaXRoIGBBcHAuUG9zdGAsIGAicG9zdHMiYCBhbmQgYHsgaWQ6IDEs
IHRpdGxlOiAiUmFpbHMgaXMgb21ha2FzZSIsIC4uLiB9YAogICAgKiBXaXRoIGBBcHAuQ29tbWVu
dGAsIGAiY29tbWVudHMiYCBhbmQgYHsgaWQ6IDEsIGJvZHk6ICJGSVJTVCIgfWAKICAgICogV2l0
aCBgQXBwLkNvbW1lbnRgLCBgImNvbW1lbnRzImAgYW5kIGB7IGlkOiAyLCBib2R5OiAiUmFpbHMg
aXMgdW5hZ2kiIH1gCgogICAgWW91IGNhbiB1c2UgdGhpcyBtZXRob2QsIGZvciBleGFtcGxlLCB0
byBub3JtYWxpemUgdW5kZXJzY29yZWQga2V5cyB0byBjYW1lbGl6ZWQKICAgIG9yIG90aGVyIGdl
bmVyYWwtcHVycG9zZSBub3JtYWxpemF0aW9ucy4KCiAgICBJZiB5b3Ugd2FudCB0byBkbyBub3Jt
YWxpemF0aW9ucyBzcGVjaWZpYyB0byBzb21lIHBhcnQgb2YgdGhlIHBheWxvYWQsIHlvdQogICAg
Y2FuIHNwZWNpZnkgdGhvc2UgdW5kZXIgYG5vcm1hbGl6ZUhhc2hgLgoKICAgIEZvciBleGFtcGxl
LCBpZiB0aGUgYElEc2AgdW5kZXIgYCJjb21tZW50cyJgIGFyZSBwcm92aWRlZCBhcyBgX2lkYCBp
bnN0ZWFkIG9mCiAgICBgaWRgLCB5b3UgY2FuIHNwZWNpZnkgaG93IHRvIG5vcm1hbGl6ZSBqdXN0
IHRoZSBjb21tZW50czoKCiAgICBgYGBqcwogICAgQXBwLlBvc3RTZXJpYWxpemVyID0gRFMuUkVT
VFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgbm9ybWFsaXplSGFzaDogewogICAgICAgIGNvbW1l
bnRzOiBmdW5jdGlvbihoYXNoKSB7CiAgICAgICAgICBoYXNoLmlkID0gaGFzaC5faWQ7CiAgICAg
ICAgICBkZWxldGUgaGFzaC5faWQ7CiAgICAgICAgICByZXR1cm4gaGFzaDsKICAgICAgICB9CiAg
ICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgVGhlIGtleSB1bmRlciBgbm9ybWFsaXplSGFzaGAg
aXMganVzdCB0aGUgb3JpZ2luYWwga2V5IHRoYXQgd2FzIGluIHRoZSBvcmlnaW5hbAogICAgcGF5
bG9hZC4KCiAgICBAbWV0aG9kIG5vcm1hbGl6ZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5N
b2RlbH0gdHlwZQogICAgQHBhcmFtIHtPYmplY3R9IGhhc2gKICAgIEBwYXJhbSB7U3RyaW5nfSBw
cm9wCiAgICBAcmV0dXJucyB7T2JqZWN0fQogICovCiAgbm9ybWFsaXplOiBmdW5jdGlvbih0eXBl
LCBoYXNoLCBwcm9wKSB7CiAgICB0aGlzLm5vcm1hbGl6ZUlkKGhhc2gpOwogICAgdGhpcy5ub3Jt
YWxpemVBdHRyaWJ1dGVzKHR5cGUsIGhhc2gpOwogICAgdGhpcy5ub3JtYWxpemVSZWxhdGlvbnNo
aXBzKHR5cGUsIGhhc2gpOwoKICAgIHRoaXMubm9ybWFsaXplVXNpbmdEZWNsYXJlZE1hcHBpbmco
dHlwZSwgaGFzaCk7CgogICAgaWYgKHRoaXMubm9ybWFsaXplSGFzaCAmJiB0aGlzLm5vcm1hbGl6
ZUhhc2hbcHJvcF0pIHsKICAgICAgdGhpcy5ub3JtYWxpemVIYXNoW3Byb3BdKGhhc2gpOwogICAg
fQoKICAgIHJldHVybiB0aGlzLl9zdXBlcih0eXBlLCBoYXNoLCBwcm9wKTsKICB9LAoKICAvKioK
ICAgIFlvdSBjYW4gdXNlIHRoaXMgbWV0aG9kIHRvIG5vcm1hbGl6ZSBhbGwgcGF5bG9hZHMsIHJl
Z2FyZGxlc3Mgb2Ygd2hldGhlciB0aGV5CiAgICByZXByZXNlbnQgc2luZ2xlIHJlY29yZHMgb3Ig
YW4gYXJyYXkuCgogICAgRm9yIGV4YW1wbGUsIHlvdSBtaWdodCB3YW50IHRvIHJlbW92ZSBzb21l
IGV4dHJhbmVvdXMgZGF0YSBmcm9tIHRoZSBwYXlsb2FkOgoKICAgIGBgYGpzCiAgICBBcHAuQXBw
bGljYXRpb25TZXJpYWxpemVyID0gRFMuUkVTVFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAgICAgbm9y
bWFsaXplUGF5bG9hZDogZnVuY3Rpb24odHlwZSwgcGF5bG9hZCkgewogICAgICAgIGRlbGV0ZSBw
YXlsb2FkLnZlcnNpb247CiAgICAgICAgZGVsZXRlIHBheWxvYWQuc3RhdHVzOwogICAgICAgIHJl
dHVybiBwYXlsb2FkOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2Qgbm9ybWFs
aXplUGF5bG9hZAogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBh
cmFtIHtPYmplY3R9IGhhc2gKICAgIEByZXR1cm5zIHtPYmplY3R9IHRoZSBub3JtYWxpemVkIHBh
eWxvYWQKICAqLwogIG5vcm1hbGl6ZVBheWxvYWQ6IGZ1bmN0aW9uKHR5cGUsIHBheWxvYWQpIHsK
ICAgIHJldHVybiBwYXlsb2FkOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBub3JtYWxpemVJZAog
ICAgQHByaXZhdGUKICAqLwogIG5vcm1hbGl6ZUlkOiBmdW5jdGlvbihoYXNoKSB7CiAgICB2YXIg
cHJpbWFyeUtleSA9IGdldCh0aGlzLCAncHJpbWFyeUtleScpOwoKICAgIGlmIChwcmltYXJ5S2V5
ID09PSAnaWQnKSB7IHJldHVybjsgfQoKICAgIGhhc2guaWQgPSBoYXNoW3ByaW1hcnlLZXldOwog
ICAgZGVsZXRlIGhhc2hbcHJpbWFyeUtleV07CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIG5vcm1h
bGl6ZVVzaW5nRGVjbGFyZWRNYXBwaW5nCiAgICBAcHJpdmF0ZQogICovCiAgbm9ybWFsaXplVXNp
bmdEZWNsYXJlZE1hcHBpbmc6IGZ1bmN0aW9uKHR5cGUsIGhhc2gpIHsKICAgIHZhciBhdHRycyA9
IGdldCh0aGlzLCAnYXR0cnMnKSwgcGF5bG9hZEtleSwga2V5OwoKICAgIGlmIChhdHRycykgewog
ICAgICBmb3IgKGtleSBpbiBhdHRycykgewogICAgICAgIHBheWxvYWRLZXkgPSBhdHRyc1trZXld
OwogICAgICAgIGlmIChwYXlsb2FkS2V5ICYmIHBheWxvYWRLZXkua2V5KSB7CiAgICAgICAgICBw
YXlsb2FkS2V5ID0gcGF5bG9hZEtleS5rZXk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Yg
cGF5bG9hZEtleSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGhhc2hba2V5XSA9IGhhc2hbcGF5
bG9hZEtleV07CiAgICAgICAgICBkZWxldGUgaGFzaFtwYXlsb2FkS2V5XTsKICAgICAgICB9CiAg
ICAgIH0KICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRob2Qgbm9ybWFsaXplQXR0cmlidXRlcwog
ICAgQHByaXZhdGUKICAqLwogIG5vcm1hbGl6ZUF0dHJpYnV0ZXM6IGZ1bmN0aW9uKHR5cGUsIGhh
c2gpIHsKICAgIHZhciBwYXlsb2FkS2V5LCBrZXk7CgogICAgaWYgKHRoaXMua2V5Rm9yQXR0cmli
dXRlKSB7CiAgICAgIHR5cGUuZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihrZXkpIHsKICAgICAgICBw
YXlsb2FkS2V5ID0gdGhpcy5rZXlGb3JBdHRyaWJ1dGUoa2V5KTsKICAgICAgICBpZiAoa2V5ID09
PSBwYXlsb2FkS2V5KSB7IHJldHVybjsgfQoKICAgICAgICBoYXNoW2tleV0gPSBoYXNoW3BheWxv
YWRLZXldOwogICAgICAgIGRlbGV0ZSBoYXNoW3BheWxvYWRLZXldOwogICAgICB9LCB0aGlzKTsK
ICAgIH0KICB9LAoKICAvKioKICAgIEBtZXRob2Qgbm9ybWFsaXplUmVsYXRpb25zaGlwcwogICAg
QHByaXZhdGUKICAqLwogIG5vcm1hbGl6ZVJlbGF0aW9uc2hpcHM6IGZ1bmN0aW9uKHR5cGUsIGhh
c2gpIHsKICAgIHZhciBwYXlsb2FkS2V5LCBrZXk7CgogICAgaWYgKHRoaXMua2V5Rm9yUmVsYXRp
b25zaGlwKSB7CiAgICAgIHR5cGUuZWFjaFJlbGF0aW9uc2hpcChmdW5jdGlvbihrZXksIHJlbGF0
aW9uc2hpcCkgewogICAgICAgIHBheWxvYWRLZXkgPSB0aGlzLmtleUZvclJlbGF0aW9uc2hpcChr
ZXksIHJlbGF0aW9uc2hpcC5raW5kKTsKICAgICAgICBpZiAoa2V5ID09PSBwYXlsb2FkS2V5KSB7
IHJldHVybjsgfQoKICAgICAgICBoYXNoW2tleV0gPSBoYXNoW3BheWxvYWRLZXldOwogICAgICAg
IGRlbGV0ZSBoYXNoW3BheWxvYWRLZXldOwogICAgICB9LCB0aGlzKTsKICAgIH0KICB9LAoKICAv
KioKICAgIENhbGxlZCB3aGVuIHRoZSBzZXJ2ZXIgaGFzIHJldHVybmVkIGEgcGF5bG9hZCByZXBy
ZXNlbnRpbmcKICAgIGEgc2luZ2xlIHJlY29yZCwgc3VjaCBhcyBpbiByZXNwb25zZSB0byBhIGBm
aW5kYCBvciBgc2F2ZWAuCgogICAgSXQgaXMgeW91ciBvcHBvcnR1bml0eSB0byBjbGVhbiB1cCB0
aGUgc2VydmVyJ3MgcmVzcG9uc2UgaW50byB0aGUgbm9ybWFsaXplZAogICAgZm9ybSBleHBlY3Rl
ZCBieSBFbWJlciBEYXRhLgoKICAgIElmIHlvdSB3YW50LCB5b3UgY2FuIGp1c3QgcmVzdHJ1Y3R1
cmUgdGhlIHRvcC1sZXZlbCBvZiB5b3VyIHBheWxvYWQsIGFuZAogICAgZG8gbW9yZSBmaW5lLWdy
YWluZWQgbm9ybWFsaXphdGlvbiBpbiB0aGUgYG5vcm1hbGl6ZWAgbWV0aG9kLgoKICAgIEZvciBl
eGFtcGxlLCBpZiB5b3UgaGF2ZSBhIHBheWxvYWQgbGlrZSB0aGlzIGluIHJlc3BvbnNlIHRvIGEg
cmVxdWVzdCBmb3IKICAgIHBvc3QgMToKCiAgICBgYGBqcwogICAgewogICAgICAiaWQiOiAxLAog
ICAgICAidGl0bGUiOiAiUmFpbHMgaXMgb21ha2FzZSIsCgogICAgICAiX2VtYmVkZGVkIjogewog
ICAgICAgICJjb21tZW50IjogW3sKICAgICAgICAgICJfaWQiOiAxLAogICAgICAgICAgImNvbW1l
bnRfdGl0bGUiOiAiRklSU1QiCiAgICAgICAgfSwgewogICAgICAgICAgIl9pZCI6IDIsCiAgICAg
ICAgICAiY29tbWVudF90aXRsZSI6ICJSYWlscyBpcyB1bmFnaSIKICAgICAgICB9XQogICAgICB9
CiAgICB9CiAgICBgYGAKCiAgICBZb3UgY291bGQgaW1wbGVtZW50IGEgc2VyaWFsaXplciB0aGF0
IGxvb2tzIGxpa2UgdGhpcyB0byBnZXQgeW91ciBwYXlsb2FkCiAgICBpbnRvIHNoYXBlOgoKICAg
IGBgYGpzCiAgICBBcHAuUG9zdFNlcmlhbGl6ZXIgPSBEUy5SRVNUU2VyaWFsaXplci5leHRlbmQo
ewogICAgICAvLyBGaXJzdCwgcmVzdHJ1Y3R1cmUgdGhlIHRvcC1sZXZlbCBzbyBpdCdzIG9yZ2Fu
aXplZCBieSB0eXBlCiAgICAgIGV4dHJhY3RTaW5nbGU6IGZ1bmN0aW9uKHN0b3JlLCB0eXBlLCBw
YXlsb2FkLCBpZCwgcmVxdWVzdFR5cGUpIHsKICAgICAgICB2YXIgY29tbWVudHMgPSBwYXlsb2Fk
Ll9lbWJlZGRlZC5jb21tZW50OwogICAgICAgIGRlbGV0ZSBwYXlsb2FkLl9lbWJlZGRlZDsKCiAg
ICAgICAgcGF5bG9hZCA9IHsgY29tbWVudHM6IGNvbW1lbnRzLCBwb3N0OiBwYXlsb2FkIH07CiAg
ICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKHN0b3JlLCB0eXBlLCBwYXlsb2FkLCBpZCwgcmVxdWVz
dFR5cGUpOwogICAgICB9LAoKICAgICAgbm9ybWFsaXplSGFzaDogewogICAgICAgIC8vIE5leHQs
IG5vcm1hbGl6ZSBpbmRpdmlkdWFsIGNvbW1lbnRzLCB3aGljaCAoYWZ0ZXIgYGV4dHJhY3RgKQog
ICAgICAgIC8vIGFyZSBub3cgbG9jYXRlZCB1bmRlciBgY29tbWVudHNgCiAgICAgICAgY29tbWVu
dHM6IGZ1bmN0aW9uKGhhc2gpIHsKICAgICAgICAgIGhhc2guaWQgPSBoYXNoLl9pZDsKICAgICAg
ICAgIGhhc2gudGl0bGUgPSBoYXNoLmNvbW1lbnRfdGl0bGU7CiAgICAgICAgICBkZWxldGUgaGFz
aC5faWQ7CiAgICAgICAgICBkZWxldGUgaGFzaC5jb21tZW50X3RpdGxlOwogICAgICAgICAgcmV0
dXJuIGhhc2g7CiAgICAgICAgfQogICAgICB9CiAgICB9KQogICAgYGBgCgogICAgV2hlbiB5b3Ug
Y2FsbCBzdXBlciBmcm9tIHlvdXIgb3duIGltcGxlbWVudGF0aW9uIG9mIGBleHRyYWN0U2luZ2xl
YCwgdGhlCiAgICBidWlsdC1pbiBpbXBsZW1lbnRhdGlvbiB3aWxsIGZpbmQgdGhlIHByaW1hcnkg
cmVjb3JkIGluIHlvdXIgbm9ybWFsaXplZAogICAgcGF5bG9hZCBhbmQgcHVzaCB0aGUgcmVtYWlu
aW5nIHJlY29yZHMgaW50byB0aGUgc3RvcmUuCgogICAgVGhlIHByaW1hcnkgcmVjb3JkIGlzIHRo
ZSBzaW5nbGUgaGFzaCBmb3VuZCB1bmRlciBgcG9zdGAgb3IgdGhlIGZpcnN0CiAgICBlbGVtZW50
IG9mIHRoZSBgcG9zdHNgIGFycmF5LgoKICAgIFRoZSBwcmltYXJ5IHJlY29yZCBoYXMgc3BlY2lh
bCBtZWFuaW5nIHdoZW4gdGhlIHJlY29yZCBpcyBiZWluZyBjcmVhdGVkCiAgICBmb3IgdGhlIGZp
cnN0IHRpbWUgb3IgdXBkYXRlZCAoYGNyZWF0ZVJlY29yZGAgb3IgYHVwZGF0ZVJlY29yZGApLiBJ
bgogICAgcGFydGljdWxhciwgaXQgd2lsbCB1cGRhdGUgdGhlIHByb3BlcnRpZXMgb2YgdGhlIHJl
Y29yZCB0aGF0IHdhcyBzYXZlZC4KCiAgICBAbWV0aG9kIGV4dHJhY3RTaW5nbGUKICAgIEBwYXJh
bSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBl
CiAgICBAcGFyYW0ge09iamVjdH0gcGF5bG9hZAogICAgQHBhcmFtIHtTdHJpbmd9IGlkCiAgICBA
cGFyYW0geydmaW5kJ3wnY3JlYXRlUmVjb3JkJ3wndXBkYXRlUmVjb3JkJ3wnZGVsZXRlUmVjb3Jk
J30gcmVxdWVzdFR5cGUKICAgIEByZXR1cm5zIHtPYmplY3R9IHRoZSBwcmltYXJ5IHJlc3BvbnNl
IHRvIHRoZSBvcmlnaW5hbCByZXF1ZXN0CiAgKi8KICBleHRyYWN0U2luZ2xlOiBmdW5jdGlvbihz
dG9yZSwgcHJpbWFyeVR5cGUsIHBheWxvYWQsIHJlY29yZElkLCByZXF1ZXN0VHlwZSkgewogICAg
cGF5bG9hZCA9IHRoaXMubm9ybWFsaXplUGF5bG9hZChwcmltYXJ5VHlwZSwgcGF5bG9hZCk7Cgog
ICAgdmFyIHByaW1hcnlUeXBlTmFtZSA9IHByaW1hcnlUeXBlLnR5cGVLZXksCiAgICAgICAgcHJp
bWFyeVJlY29yZDsKCiAgICBmb3IgKHZhciBwcm9wIGluIHBheWxvYWQpIHsKICAgICAgdmFyIHR5
cGVOYW1lICA9IHRoaXMudHlwZUZvclJvb3QocHJvcCksCiAgICAgICAgICBpc1ByaW1hcnkgPSB0
eXBlTmFtZSA9PT0gcHJpbWFyeVR5cGVOYW1lOwoKICAgICAgLy8gbGVnYWN5IHN1cHBvcnQgZm9y
IHNpbmd1bGFyIHJlc291cmNlcwogICAgICBpZiAoaXNQcmltYXJ5ICYmIEVtYmVyLnR5cGVPZihw
YXlsb2FkW3Byb3BdKSAhPT0gImFycmF5IiApIHsKICAgICAgICBwcmltYXJ5UmVjb3JkID0gdGhp
cy5ub3JtYWxpemUocHJpbWFyeVR5cGUsIHBheWxvYWRbcHJvcF0sIHByb3ApOwogICAgICAgIGNv
bnRpbnVlOwogICAgICB9CgogICAgICB2YXIgdHlwZSA9IHN0b3JlLm1vZGVsRm9yKHR5cGVOYW1l
KTsKCiAgICAgIC8qanNoaW50IGxvb3BmdW5jOnRydWUqLwogICAgICBmb3JFYWNoLmNhbGwocGF5
bG9hZFtwcm9wXSwgZnVuY3Rpb24oaGFzaCkgewogICAgICAgIHZhciB0eXBlTmFtZSA9IHRoaXMu
dHlwZUZvclJvb3QocHJvcCksCiAgICAgICAgICAgIHR5cGUgPSBzdG9yZS5tb2RlbEZvcih0eXBl
TmFtZSksCiAgICAgICAgICAgIHR5cGVTZXJpYWxpemVyID0gc3RvcmUuc2VyaWFsaXplckZvcih0
eXBlKTsKCiAgICAgICAgaGFzaCA9IHR5cGVTZXJpYWxpemVyLm5vcm1hbGl6ZSh0eXBlLCBoYXNo
LCBwcm9wKTsKCiAgICAgICAgdmFyIGlzRmlyc3RDcmVhdGVkUmVjb3JkID0gaXNQcmltYXJ5ICYm
ICFyZWNvcmRJZCAmJiAhcHJpbWFyeVJlY29yZCwKICAgICAgICAgICAgaXNVcGRhdGVkUmVjb3Jk
ID0gaXNQcmltYXJ5ICYmIGNvZXJjZUlkKGhhc2guaWQpID09PSByZWNvcmRJZDsKCiAgICAgICAg
Ly8gZmluZCB0aGUgcHJpbWFyeSByZWNvcmQuCiAgICAgICAgLy8KICAgICAgICAvLyBJdCdzIGVp
dGhlcjoKICAgICAgICAvLyAqIHRoZSByZWNvcmQgd2l0aCB0aGUgc2FtZSBJRCBhcyB0aGUgb3Jp
Z2luYWwgcmVxdWVzdAogICAgICAgIC8vICogaW4gdGhlIGNhc2Ugb2YgYSBuZXdseSBjcmVhdGVk
IHJlY29yZCB0aGF0IGRpZG4ndCBoYXZlIGFuIElELCB0aGUgZmlyc3QKICAgICAgICAvLyAgIHJl
Y29yZCBpbiB0aGUgQXJyYXkKICAgICAgICBpZiAoaXNGaXJzdENyZWF0ZWRSZWNvcmQgfHwgaXNV
cGRhdGVkUmVjb3JkKSB7CiAgICAgICAgICBwcmltYXJ5UmVjb3JkID0gaGFzaDsKICAgICAgICB9
IGVsc2UgewogICAgICAgICAgc3RvcmUucHVzaCh0eXBlTmFtZSwgaGFzaCk7CiAgICAgICAgfQog
ICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICByZXR1cm4gcHJpbWFyeVJlY29yZDsKICB9LAoKICAv
KioKICAgIENhbGxlZCB3aGVuIHRoZSBzZXJ2ZXIgaGFzIHJldHVybmVkIGEgcGF5bG9hZCByZXBy
ZXNlbnRpbmcKICAgIG11bHRpcGxlIHJlY29yZHMsIHN1Y2ggYXMgaW4gcmVzcG9uc2UgdG8gYSBg
ZmluZEFsbGAgb3IgYGZpbmRRdWVyeWAuCgogICAgSXQgaXMgeW91ciBvcHBvcnR1bml0eSB0byBj
bGVhbiB1cCB0aGUgc2VydmVyJ3MgcmVzcG9uc2UgaW50byB0aGUgbm9ybWFsaXplZAogICAgZm9y
bSBleHBlY3RlZCBieSBFbWJlciBEYXRhLgoKICAgIElmIHlvdSB3YW50LCB5b3UgY2FuIGp1c3Qg
cmVzdHJ1Y3R1cmUgdGhlIHRvcC1sZXZlbCBvZiB5b3VyIHBheWxvYWQsIGFuZAogICAgZG8gbW9y
ZSBmaW5lLWdyYWluZWQgbm9ybWFsaXphdGlvbiBpbiB0aGUgYG5vcm1hbGl6ZWAgbWV0aG9kLgoK
ICAgIEZvciBleGFtcGxlLCBpZiB5b3UgaGF2ZSBhIHBheWxvYWQgbGlrZSB0aGlzIGluIHJlc3Bv
bnNlIHRvIGEgcmVxdWVzdCBmb3IKICAgIGFsbCBwb3N0czoKCiAgICBgYGBqcwogICAgewogICAg
ICAiX2VtYmVkZGVkIjogewogICAgICAgICJwb3N0IjogW3sKICAgICAgICAgICJpZCI6IDEsCiAg
ICAgICAgICAidGl0bGUiOiAiUmFpbHMgaXMgb21ha2FzZSIKICAgICAgICB9LCB7CiAgICAgICAg
ICAiaWQiOiAyLAogICAgICAgICAgInRpdGxlIjogIlRoZSBQYXJsZXkgTGV0dGVyIgogICAgICAg
IH1dLAogICAgICAgICJjb21tZW50IjogW3sKICAgICAgICAgICJfaWQiOiAxLAogICAgICAgICAg
ImNvbW1lbnRfdGl0bGUiOiAiUmFpbHMgaXMgdW5hZ2kiCiAgICAgICAgICAicG9zdF9pZCI6IDEK
ICAgICAgICB9LCB7CiAgICAgICAgICAiX2lkIjogMiwKICAgICAgICAgICJjb21tZW50X3RpdGxl
IjogIkRvbid0IHRyZWFkIG9uIG1lIiwKICAgICAgICAgICJwb3N0X2lkIjogMgogICAgICAgIH1d
CiAgICAgIH0KICAgIH0KICAgIGBgYAoKICAgIFlvdSBjb3VsZCBpbXBsZW1lbnQgYSBzZXJpYWxp
emVyIHRoYXQgbG9va3MgbGlrZSB0aGlzIHRvIGdldCB5b3VyIHBheWxvYWQKICAgIGludG8gc2hh
cGU6CgogICAgYGBganMKICAgIEFwcC5Qb3N0U2VyaWFsaXplciA9IERTLlJFU1RTZXJpYWxpemVy
LmV4dGVuZCh7CiAgICAgIC8vIEZpcnN0LCByZXN0cnVjdHVyZSB0aGUgdG9wLWxldmVsIHNvIGl0
J3Mgb3JnYW5pemVkIGJ5IHR5cGUKICAgICAgLy8gYW5kIHRoZSBjb21tZW50cyBhcmUgbGlzdGVk
IHVuZGVyIGEgcG9zdCdzIGBjb21tZW50c2Aga2V5LgogICAgICBleHRyYWN0QXJyYXk6IGZ1bmN0
aW9uKHN0b3JlLCB0eXBlLCBwYXlsb2FkLCBpZCwgcmVxdWVzdFR5cGUpIHsKICAgICAgICB2YXIg
cG9zdHMgPSBwYXlsb2FkLl9lbWJlZGRlZC5wb3N0OwogICAgICAgIHZhciBjb21tZW50cyA9IFtd
OwogICAgICAgIHZhciBwb3N0Q2FjaGUgPSB7fTsKCiAgICAgICAgcG9zdHMuZm9yRWFjaChmdW5j
dGlvbihwb3N0KSB7CiAgICAgICAgICBwb3N0LmNvbW1lbnRzID0gW107CiAgICAgICAgICBwb3N0
Q2FjaGVbcG9zdC5pZF0gPSBwb3N0OwogICAgICAgIH0pOwoKICAgICAgICBwYXlsb2FkLl9lbWJl
ZGRlZC5jb21tZW50LmZvckVhY2goZnVuY3Rpb24oY29tbWVudCkgewogICAgICAgICAgY29tbWVu
dHMucHVzaChjb21tZW50KTsKICAgICAgICAgIHBvc3RDYWNoZVtjb21tZW50LnBvc3RfaWRdLmNv
bW1lbnRzLnB1c2goY29tbWVudCk7CiAgICAgICAgICBkZWxldGUgY29tbWVudC5wb3N0X2lkOwog
ICAgICAgIH0KCiAgICAgICAgcGF5bG9hZCA9IHsgY29tbWVudHM6IGNvbW1lbnRzLCBwb3N0czog
cGF5bG9hZCB9OwoKICAgICAgICByZXR1cm4gdGhpcy5fc3VwZXIoc3RvcmUsIHR5cGUsIHBheWxv
YWQsIGlkLCByZXF1ZXN0VHlwZSk7CiAgICAgIH0sCgogICAgICBub3JtYWxpemVIYXNoOiB7CiAg
ICAgICAgLy8gTmV4dCwgbm9ybWFsaXplIGluZGl2aWR1YWwgY29tbWVudHMsIHdoaWNoIChhZnRl
ciBgZXh0cmFjdGApCiAgICAgICAgLy8gYXJlIG5vdyBsb2NhdGVkIHVuZGVyIGBjb21tZW50c2AK
ICAgICAgICBjb21tZW50czogZnVuY3Rpb24oaGFzaCkgewogICAgICAgICAgaGFzaC5pZCA9IGhh
c2guX2lkOwogICAgICAgICAgaGFzaC50aXRsZSA9IGhhc2guY29tbWVudF90aXRsZTsKICAgICAg
ICAgIGRlbGV0ZSBoYXNoLl9pZDsKICAgICAgICAgIGRlbGV0ZSBoYXNoLmNvbW1lbnRfdGl0bGU7
CiAgICAgICAgICByZXR1cm4gaGFzaDsKICAgICAgICB9CiAgICAgIH0KICAgIH0pCiAgICBgYGAK
CiAgICBXaGVuIHlvdSBjYWxsIHN1cGVyIGZyb20geW91ciBvd24gaW1wbGVtZW50YXRpb24gb2Yg
YGV4dHJhY3RBcnJheWAsIHRoZQogICAgYnVpbHQtaW4gaW1wbGVtZW50YXRpb24gd2lsbCBmaW5k
IHRoZSBwcmltYXJ5IGFycmF5IGluIHlvdXIgbm9ybWFsaXplZAogICAgcGF5bG9hZCBhbmQgcHVz
aCB0aGUgcmVtYWluaW5nIHJlY29yZHMgaW50byB0aGUgc3RvcmUuCgogICAgVGhlIHByaW1hcnkg
YXJyYXkgaXMgdGhlIGFycmF5IGZvdW5kIHVuZGVyIGBwb3N0c2AuCgogICAgVGhlIHByaW1hcnkg
cmVjb3JkIGhhcyBzcGVjaWFsIG1lYW5pbmcgd2hlbiByZXNwb25kaW5nIHRvIGBmaW5kUXVlcnlg
CiAgICBvciBgZmluZEhhc01hbnlgLiBJbiBwYXJ0aWN1bGFyLCB0aGUgcHJpbWFyeSBhcnJheSB3
aWxsIGJlY29tZSB0aGUKICAgIGxpc3Qgb2YgcmVjb3JkcyBpbiB0aGUgcmVjb3JkIGFycmF5IHRo
YXQga2lja2VkIG9mZiB0aGUgcmVxdWVzdC4KCiAgICBJZiB5b3VyIHByaW1hcnkgYXJyYXkgY29u
dGFpbnMgc2Vjb25kYXJ5IChlbWJlZGRlZCkgcmVjb3JkcyBvZiB0aGUgc2FtZSB0eXBlLAogICAg
eW91IGNhbm5vdCBwbGFjZSB0aGVzZSBpbnRvIHRoZSBwcmltYXJ5IGFycmF5IGBwb3N0c2AuIElu
c3RlYWQsIHBsYWNlIHRoZQogICAgc2Vjb25kYXJ5IGl0ZW1zIGludG8gYW4gdW5kZXJzY29yZSBw
cmVmaXhlZCBwcm9wZXJ0eSBgX3Bvc3RzYCwgd2hpY2ggd2lsbAogICAgcHVzaCB0aGVzZSBpdGVt
cyBpbnRvIHRoZSBzdG9yZSBhbmQgd2lsbCBub3QgYWZmZWN0IHRoZSByZXN1bHRpbmcgcXVlcnku
CgogICAgQG1ldGhvZCBleHRyYWN0QXJyYXkKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAg
ICBAcGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge09iamVjdH0g
cGF5bG9hZAogICAgQHBhcmFtIHsnZmluZEFsbCd8J2ZpbmRNYW55J3wnZmluZEhhc01hbnknfCdm
aW5kUXVlcnknfSByZXF1ZXN0VHlwZQogICAgQHJldHVybnMge0FycmF5fSBUaGUgcHJpbWFyeSBh
cnJheSB0aGF0IHdhcyByZXR1cm5lZCBpbiByZXNwb25zZQogICAgICB0byB0aGUgb3JpZ2luYWwg
cXVlcnkuCiAgKi8KICBleHRyYWN0QXJyYXk6IGZ1bmN0aW9uKHN0b3JlLCBwcmltYXJ5VHlwZSwg
cGF5bG9hZCkgewogICAgcGF5bG9hZCA9IHRoaXMubm9ybWFsaXplUGF5bG9hZChwcmltYXJ5VHlw
ZSwgcGF5bG9hZCk7CgogICAgdmFyIHByaW1hcnlUeXBlTmFtZSA9IHByaW1hcnlUeXBlLnR5cGVL
ZXksCiAgICAgICAgcHJpbWFyeUFycmF5OwoKICAgIGZvciAodmFyIHByb3AgaW4gcGF5bG9hZCkg
ewogICAgICB2YXIgdHlwZUtleSA9IHByb3AsCiAgICAgICAgICBmb3JjZWRTZWNvbmRhcnkgPSBm
YWxzZTsKCiAgICAgIGlmIChwcm9wLmNoYXJBdCgwKSA9PT0gJ18nKSB7CiAgICAgICAgZm9yY2Vk
U2Vjb25kYXJ5ID0gdHJ1ZTsKICAgICAgICB0eXBlS2V5ID0gcHJvcC5zdWJzdHIoMSk7CiAgICAg
IH0KCiAgICAgIHZhciB0eXBlTmFtZSA9IHRoaXMudHlwZUZvclJvb3QodHlwZUtleSksCiAgICAg
ICAgICB0eXBlID0gc3RvcmUubW9kZWxGb3IodHlwZU5hbWUpLAogICAgICAgICAgdHlwZVNlcmlh
bGl6ZXIgPSBzdG9yZS5zZXJpYWxpemVyRm9yKHR5cGUpLAogICAgICAgICAgaXNQcmltYXJ5ID0g
KCFmb3JjZWRTZWNvbmRhcnkgJiYgKHR5cGVOYW1lID09PSBwcmltYXJ5VHlwZU5hbWUpKTsKCiAg
ICAgIC8qanNoaW50IGxvb3BmdW5jOnRydWUqLwogICAgICB2YXIgbm9ybWFsaXplZEFycmF5ID0g
bWFwLmNhbGwocGF5bG9hZFtwcm9wXSwgZnVuY3Rpb24oaGFzaCkgewogICAgICAgIHJldHVybiB0
eXBlU2VyaWFsaXplci5ub3JtYWxpemUodHlwZSwgaGFzaCwgcHJvcCk7CiAgICAgIH0sIHRoaXMp
OwoKICAgICAgaWYgKGlzUHJpbWFyeSkgewogICAgICAgIHByaW1hcnlBcnJheSA9IG5vcm1hbGl6
ZWRBcnJheTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdG9yZS5wdXNoTWFueSh0eXBlTmFtZSwg
bm9ybWFsaXplZEFycmF5KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBwcmltYXJ5QXJyYXk7
CiAgfSwKCiAgLyoqCiAgICBUaGlzIG1ldGhvZCBhbGxvd3MgeW91IHRvIHB1c2ggYSBwYXlsb2Fk
IGNvbnRhaW5pbmcgdG9wLWxldmVsCiAgICBjb2xsZWN0aW9ucyBvZiByZWNvcmRzIG9yZ2FuaXpl
ZCBwZXIgdHlwZS4KCiAgICBgYGBqcwogICAgewogICAgICAicG9zdHMiOiBbewogICAgICAgICJp
ZCI6ICIxIiwKICAgICAgICAidGl0bGUiOiAiUmFpbHMgaXMgb21ha2FzZSIsCiAgICAgICAgImF1
dGhvciIsICIxIiwKICAgICAgICAiY29tbWVudHMiOiBbICIxIiBdCiAgICAgIH1dLAogICAgICAi
Y29tbWVudHMiOiBbewogICAgICAgICJpZCI6ICIxIiwKICAgICAgICAiYm9keSI6ICJGSVJTVCIK
ICAgICAgfV0sCiAgICAgICJ1c2VycyI6IFt7CiAgICAgICAgImlkIjogIjEiLAogICAgICAgICJu
YW1lIjogIkBkMmgiCiAgICAgIH1dCiAgICB9CiAgICBgYGAKCiAgICBJdCB3aWxsIGZpcnN0IG5v
cm1hbGl6ZSB0aGUgcGF5bG9hZCwgc28geW91IGNhbiB1c2UgdGhpcyB0byBwdXNoCiAgICBpbiBk
YXRhIHN0cmVhbWluZyBpbiBmcm9tIHlvdXIgc2VydmVyIHN0cnVjdHVyZWQgdGhlIHNhbWUgd2F5
CiAgICB0aGF0IGZldGNoZXMgYW5kIHNhdmVzIGFyZSBzdHJ1Y3R1cmVkLgoKICAgIEBtZXRob2Qg
cHVzaFBheWxvYWQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBAcGFyYW0ge09iamVj
dH0gcGF5bG9hZAogICovCiAgcHVzaFBheWxvYWQ6IGZ1bmN0aW9uKHN0b3JlLCBwYXlsb2FkKSB7
CiAgICBwYXlsb2FkID0gdGhpcy5ub3JtYWxpemVQYXlsb2FkKG51bGwsIHBheWxvYWQpOwoKICAg
IGZvciAodmFyIHByb3AgaW4gcGF5bG9hZCkgewogICAgICB2YXIgdHlwZU5hbWUgPSB0aGlzLnR5
cGVGb3JSb290KHByb3ApLAogICAgICAgICAgdHlwZSA9IHN0b3JlLm1vZGVsRm9yKHR5cGVOYW1l
KTsKCiAgICAgIC8qanNoaW50IGxvb3BmdW5jOnRydWUqLwogICAgICB2YXIgbm9ybWFsaXplZEFy
cmF5ID0gbWFwLmNhbGwoRW1iZXIubWFrZUFycmF5KHBheWxvYWRbcHJvcF0pLCBmdW5jdGlvbiho
YXNoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubm9ybWFsaXplKHR5cGUsIGhhc2gsIHByb3ApOwog
ICAgICB9LCB0aGlzKTsKCiAgICAgIHN0b3JlLnB1c2hNYW55KHR5cGVOYW1lLCBub3JtYWxpemVk
QXJyYXkpOwogICAgfQogIH0sCgogIC8qKgogICAgWW91IGNhbiB1c2UgdGhpcyBtZXRob2QgdG8g
bm9ybWFsaXplIHRoZSBKU09OIHJvb3Qga2V5cyByZXR1cm5lZAogICAgaW50byB0aGUgbW9kZWwg
dHlwZSBleHBlY3RlZCBieSB5b3VyIHN0b3JlLgoKICAgIEZvciBleGFtcGxlLCB5b3VyIHNlcnZl
ciBtYXkgcmV0dXJuIHVuZGVyc2NvcmVkIHJvb3Qga2V5cyByYXRoZXIgdGhhbgogICAgdGhlIGV4
cGVjdGVkIGNhbWVsY2FzZWQgdmVyc2lvbnMuCgogICAgYGBganMKICAgIEFwcC5BcHBsaWNhdGlv
blNlcmlhbGl6ZXIgPSBEUy5SRVNUU2VyaWFsaXplci5leHRlbmQoewogICAgICB0eXBlRm9yUm9v
dDogZnVuY3Rpb24ocm9vdCkgewogICAgICAgIHZhciBjYW1lbGl6ZWQgPSBFbWJlci5TdHJpbmcu
Y2FtZWxpemUocm9vdCk7CiAgICAgICAgcmV0dXJuIEVtYmVyLlN0cmluZy5zaW5ndWxhcml6ZShj
YW1lbGl6ZWQpOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2QgdHlwZUZvclJv
b3QKICAgIEBwYXJhbSB7U3RyaW5nfSByb290CiAgICBAcmV0dXJucyB7U3RyaW5nfSB0aGUgbW9k
ZWwncyB0eXBlS2V5CiAgKi8KICB0eXBlRm9yUm9vdDogZnVuY3Rpb24ocm9vdCkgewogICAgcmV0
dXJuIEVtYmVyLlN0cmluZy5zaW5ndWxhcml6ZShyb290KTsKICB9LAoKICAvLyBTRVJJQUxJWkUK
CiAgLyoqCiAgICBDYWxsZWQgd2hlbiBhIHJlY29yZCBpcyBzYXZlZCBpbiBvcmRlciB0byBjb252
ZXJ0IHRoZQogICAgcmVjb3JkIGludG8gSlNPTi4KCiAgICBCeSBkZWZhdWx0LCBpdCBjcmVhdGVz
IGEgSlNPTiBvYmplY3Qgd2l0aCBhIGtleSBmb3IKICAgIGVhY2ggYXR0cmlidXRlIGFuZCBiZWxv
bmdzVG8gcmVsYXRpb25zaGlwLgoKICAgIEZvciBleGFtcGxlLCBjb25zaWRlciB0aGlzIG1vZGVs
OgoKICAgIGBgYGpzCiAgICBBcHAuQ29tbWVudCA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICAgIHRp
dGxlOiBEUy5hdHRyKCksCiAgICAgIGJvZHk6IERTLmF0dHIoKSwKCiAgICAgIGF1dGhvcjogRFMu
YmVsb25nc1RvKCd1c2VyJykKICAgIH0pOwogICAgYGBgCgogICAgVGhlIGRlZmF1bHQgc2VyaWFs
aXphdGlvbiB3b3VsZCBjcmVhdGUgYSBKU09OIG9iamVjdCBsaWtlOgoKICAgIGBgYGpzCiAgICB7
CiAgICAgICJ0aXRsZSI6ICJSYWlscyBpcyB1bmFnaSIsCiAgICAgICJib2R5IjogIlJhaWxzPyBP
bWFrYXNlPyBPX08iLAogICAgICAiYXV0aG9yIjogMTIKICAgIH0KICAgIGBgYAoKICAgIEJ5IGRl
ZmF1bHQsIGF0dHJpYnV0ZXMgYXJlIHBhc3NlZCB0aHJvdWdoIGFzLWlzLCB1bmxlc3MKICAgIHlv
dSBzcGVjaWZpZWQgYW4gYXR0cmlidXRlIHR5cGUgKGBEUy5hdHRyKCdkYXRlJylgKS4gSWYKICAg
IHlvdSBzcGVjaWZ5IGEgdHJhbnNmb3JtLCB0aGUgSmF2YVNjcmlwdCB2YWx1ZSB3aWxsIGJlCiAg
ICBzZXJpYWxpemVkIHdoZW4gaW5zZXJ0ZWQgaW50byB0aGUgSlNPTiBoYXNoLgoKICAgIEJ5IGRl
ZmF1bHQsIGJlbG9uZ3MtdG8gcmVsYXRpb25zaGlwcyBhcmUgY29udmVydGVkIGludG8KICAgIElE
cyB3aGVuIGluc2VydGVkIGludG8gdGhlIEpTT04gaGFzaC4KCiAgICAjIyBJRHMKCiAgICBgc2Vy
aWFsaXplYCB0YWtlcyBhbiBvcHRpb25zIGhhc2ggd2l0aCBhIHNpbmdsZSBvcHRpb246CiAgICBg
aW5jbHVkZUlkYC4gSWYgdGhpcyBvcHRpb24gaXMgYHRydWVgLCBgc2VyaWFsaXplYCB3aWxsLAog
ICAgYnkgZGVmYXVsdCBpbmNsdWRlIHRoZSBJRCBpbiB0aGUgSlNPTiBvYmplY3QgaXQgYnVpbGRz
LgoKICAgIFRoZSBhZGFwdGVyIHBhc3NlcyBpbiBgaW5jbHVkZUlkOiB0cnVlYCB3aGVuIHNlcmlh
bGl6aW5nCiAgICBhIHJlY29yZCBmb3IgYGNyZWF0ZVJlY29yZGAsIGJ1dCBub3QgZm9yIGB1cGRh
dGVSZWNvcmRgLgoKICAgICMjIEN1c3RvbWl6YXRpb24KCiAgICBZb3VyIHNlcnZlciBtYXkgZXhw
ZWN0IGEgZGlmZmVyZW50IEpTT04gZm9ybWF0IHRoYW4gdGhlCiAgICBidWlsdC1pbiBzZXJpYWxp
emF0aW9uIGZvcm1hdC4KCiAgICBJbiB0aGF0IGNhc2UsIHlvdSBjYW4gaW1wbGVtZW50IGBzZXJp
YWxpemVgIHlvdXJzZWxmIGFuZAogICAgcmV0dXJuIGEgSlNPTiBoYXNoIG9mIHlvdXIgY2hvb3Np
bmcuCgogICAgYGBganMKICAgIEFwcC5Qb3N0U2VyaWFsaXplciA9IERTLlJFU1RTZXJpYWxpemVy
LmV4dGVuZCh7CiAgICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24ocG9zdCwgb3B0aW9ucykgewogICAg
ICAgIHZhciBqc29uID0gewogICAgICAgICAgUE9TVF9UVEw6IHBvc3QuZ2V0KCd0aXRsZScpLAog
ICAgICAgICAgUE9TVF9CRFk6IHBvc3QuZ2V0KCdib2R5JyksCiAgICAgICAgICBQT1NUX0NNUzog
cG9zdC5nZXQoJ2NvbW1lbnRzJykubWFwUHJvcGVydHkoJ2lkJykKICAgICAgICB9CgogICAgICAg
IGlmIChvcHRpb25zLmluY2x1ZGVJZCkgewogICAgICAgICAganNvbi5QT1NUX0lEXyA9IHBvc3Qu
Z2V0KCdpZCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGpzb247CiAgICAgIH0KICAgIH0p
OwogICAgYGBgCgogICAgIyMgQ3VzdG9taXppbmcgYW4gQXBwLVdpZGUgU2VyaWFsaXplcgoKICAg
IElmIHlvdSB3YW50IHRvIGRlZmluZSBhIHNlcmlhbGl6ZXIgZm9yIHlvdXIgZW50aXJlCiAgICBh
cHBsaWNhdGlvbiwgeW91J2xsIHByb2JhYmx5IHdhbnQgdG8gdXNlIGBlYWNoQXR0cmlidXRlYAog
ICAgYW5kIGBlYWNoUmVsYXRpb25zaGlwYCBvbiB0aGUgcmVjb3JkLgoKICAgIGBgYGpzCiAgICBB
cHAuQXBwbGljYXRpb25TZXJpYWxpemVyID0gRFMuUkVTVFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAg
ICAgc2VyaWFsaXplOiBmdW5jdGlvbihyZWNvcmQsIG9wdGlvbnMpIHsKICAgICAgICB2YXIganNv
biA9IHt9OwoKICAgICAgICByZWNvcmQuZWFjaEF0dHJpYnV0ZShmdW5jdGlvbihuYW1lKSB7CiAg
ICAgICAgICBqc29uW3NlcnZlckF0dHJpYnV0ZU5hbWUobmFtZSldID0gcmVjb3JkLmdldChuYW1l
KTsKICAgICAgICB9KQoKICAgICAgICByZWNvcmQuZWFjaFJlbGF0aW9uc2hpcChmdW5jdGlvbihu
YW1lLCByZWxhdGlvbnNoaXApIHsKICAgICAgICAgIGlmIChyZWxhdGlvbnNoaXAua2luZCA9PT0g
J2hhc01hbnknKSB7CiAgICAgICAgICAgIGpzb25bc2VydmVySGFzTWFueU5hbWUobmFtZSldID0g
cmVjb3JkLmdldChuYW1lKS5tYXBCeSgnaWQnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAg
ICAgICAgaWYgKG9wdGlvbnMuaW5jbHVkZUlkKSB7CiAgICAgICAgICBqc29uLklEXyA9IHJlY29y
ZC5nZXQoJ2lkJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ganNvbjsKICAgICAgfQogICAg
fSk7CgogICAgZnVuY3Rpb24gc2VydmVyQXR0cmlidXRlTmFtZShhdHRyaWJ1dGUpIHsKICAgICAg
cmV0dXJuIGF0dHJpYnV0ZS51bmRlcnNjb3JlKCkudG9VcHBlckNhc2UoKTsKICAgIH0KCiAgICBm
dW5jdGlvbiBzZXJ2ZXJIYXNNYW55TmFtZShuYW1lKSB7CiAgICAgIHJldHVybiBzZXJ2ZXJBdHRy
aWJ1dGVOYW1lKG5hbWUuc2luZ3VsYXJpemUoKSkgKyAiX0lEUyI7CiAgICB9CiAgICBgYGAKCiAg
ICBUaGlzIHNlcmlhbGl6ZXIgd2lsbCBnZW5lcmF0ZSBKU09OIHRoYXQgbG9va3MgbGlrZSB0aGlz
OgoKICAgIGBgYGpzCiAgICB7CiAgICAgICJUSVRMRSI6ICJSYWlscyBpcyBvbWFrYXNlIiwKICAg
ICAgIkJPRFkiOiAiWWVwLiBPbWFrYXNlLiIsCiAgICAgICJDT01NRU5UX0lEUyI6IFsgMSwgMiwg
MyBdCiAgICB9CiAgICBgYGAKCiAgICAjIyBUd2Vha2luZyB0aGUgRGVmYXVsdCBKU09OCgogICAg
SWYgeW91IGp1c3Qgd2FudCB0byBkbyBzb21lIHNtYWxsIHR3ZWFrcyBvbiB0aGUgZGVmYXVsdCBK
U09OLAogICAgeW91IGNhbiBjYWxsIHN1cGVyIGZpcnN0IGFuZCBtYWtlIHRoZSB0d2Vha3Mgb24g
dGhlIHJldHVybmVkCiAgICBKU09OLgoKICAgIGBgYGpzCiAgICBBcHAuUG9zdFNlcmlhbGl6ZXIg
PSBEUy5SRVNUU2VyaWFsaXplci5leHRlbmQoewogICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKHJl
Y29yZCwgb3B0aW9ucykgewogICAgICAgIHZhciBqc29uID0gdGhpcy5fc3VwZXIocmVjb3JkLCBv
cHRpb25zKTsKCiAgICAgICAganNvbi5zdWJqZWN0ID0ganNvbi50aXRsZTsKICAgICAgICBkZWxl
dGUganNvbi50aXRsZTsKCiAgICAgICAgcmV0dXJuIGpzb247CiAgICAgIH0KICAgIH0pOwogICAg
YGBgCgogICAgQG1ldGhvZCBzZXJpYWxpemUKICAgIEBwYXJhbSByZWNvcmQKICAgIEBwYXJhbSBv
cHRpb25zCiAgKi8KICBzZXJpYWxpemU6IGZ1bmN0aW9uKHJlY29yZCwgb3B0aW9ucykgewogICAg
cmV0dXJuIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAg
ICBZb3UgY2FuIHVzZSB0aGlzIG1ldGhvZCB0byBjdXN0b21pemUgdGhlIHJvb3Qga2V5cyBzZXJp
YWxpemVkIGludG8gdGhlIEpTT04uCiAgICBCeSBkZWZhdWx0IHRoZSBSRVNUIFNlcmlhbGl6ZXIg
c2VuZHMgY2FtZWxpemVkIHJvb3Qga2V5cy4KICAgIEZvciBleGFtcGxlLCB5b3VyIHNlcnZlciBt
YXkgZXhwZWN0IHVuZGVyc2NvcmVkIHJvb3Qgb2JqZWN0cy4KCiAgICBgYGBqcwogICAgQXBwLkFw
cGxpY2F0aW9uU2VyaWFsaXplciA9IERTLlJFU1RTZXJpYWxpemVyLmV4dGVuZCh7CiAgICAgIHNl
cmlhbGl6ZUludG9IYXNoOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByZWNvcmQsIG9wdGlvbnMpIHsK
ICAgICAgICB2YXIgcm9vdCA9IEVtYmVyLlN0cmluZy5kZWNhbWVsaXplKHR5cGUudHlwZUtleSk7
CiAgICAgICAgZGF0YVtyb290XSA9IHRoaXMuc2VyaWFsaXplKHJlY29yZCwgb3B0aW9ucyk7CiAg
ICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQG1ldGhvZCBzZXJpYWxpemVJbnRvSGFzaAogICAg
QHBhcmFtIHtPYmplY3R9IGhhc2gKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5
cGUKICAgIEBwYXJhbSB7RFMuTW9kZWx9IHJlY29yZAogICAgQHBhcmFtIHtPYmplY3R9IG9wdGlv
bnMKICAqLwogIHNlcmlhbGl6ZUludG9IYXNoOiBmdW5jdGlvbihoYXNoLCB0eXBlLCByZWNvcmQs
IG9wdGlvbnMpIHsKICAgIGhhc2hbdHlwZS50eXBlS2V5XSA9IHRoaXMuc2VyaWFsaXplKHJlY29y
ZCwgb3B0aW9ucyk7CiAgfSwKCiAgLyoqCiAgICBZb3UgY2FuIHVzZSB0aGlzIG1ldGhvZCB0byBj
dXN0b21pemUgaG93IHBvbHltb3JwaGljIG9iamVjdHMgYXJlIHNlcmlhbGl6ZWQuCiAgICBCeSBk
ZWZhdWx0IHRoZSBKU09OIFNlcmlhbGl6ZXIgY3JlYXRlcyB0aGUga2V5IGJ5IGFwcGVuZGluZyBg
VHlwZWAgdG8KICAgIHRoZSBhdHRyaWJ1dGUgYW5kIHZhbHVlIGZyb20gdGhlIG1vZGVsJ3MgY2Ft
ZWxjYXNlZCBtb2RlbCBuYW1lLgoKICAgIEBtZXRob2Qgc2VyaWFsaXplUG9seW1vcnBoaWNUeXBl
CiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNvcmQKICAgIEBwYXJhbSB7T2JqZWN0fSBqc29uCiAg
ICBAcGFyYW0ge09iamVjdH0gcmVsYXRpb25zaGlwCiAgKi8KICBzZXJpYWxpemVQb2x5bW9ycGhp
Y1R5cGU6IGZ1bmN0aW9uKHJlY29yZCwganNvbiwgcmVsYXRpb25zaGlwKSB7CiAgICB2YXIga2V5
ID0gcmVsYXRpb25zaGlwLmtleSwKICAgICAgICBiZWxvbmdzVG8gPSBnZXQocmVjb3JkLCBrZXkp
OwogICAga2V5ID0gdGhpcy5rZXlGb3JBdHRyaWJ1dGUgPyB0aGlzLmtleUZvckF0dHJpYnV0ZShr
ZXkpIDoga2V5OwogICAganNvbltrZXkgKyAiVHlwZSJdID0gYmVsb25nc1RvLmNvbnN0cnVjdG9y
LnR5cGVLZXk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBl
bWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CnZhciBm
b3JFYWNoID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMuZm9yRWFjaDsKCi8qKgogIFRoZSBSRVNUIGFk
YXB0ZXIgYWxsb3dzIHlvdXIgc3RvcmUgdG8gY29tbXVuaWNhdGUgd2l0aCBhbiBIVFRQIHNlcnZl
ciBieQogIHRyYW5zbWl0dGluZyBKU09OIHZpYSBYSFIuIE1vc3QgRW1iZXIuanMgYXBwcyB0aGF0
IGNvbnN1bWUgYSBKU09OIEFQSQogIHNob3VsZCB1c2UgdGhlIFJFU1QgYWRhcHRlci4KCiAgVGhp
cyBhZGFwdGVyIGlzIGRlc2lnbmVkIGFyb3VuZCB0aGUgaWRlYSB0aGF0IHRoZSBKU09OIGV4Y2hh
bmdlZCB3aXRoCiAgdGhlIHNlcnZlciBzaG91bGQgYmUgY29udmVudGlvbmFsLgoKICAjIyBKU09O
IFN0cnVjdHVyZQoKICBUaGUgUkVTVCBhZGFwdGVyIGV4cGVjdHMgdGhlIEpTT04gcmV0dXJuZWQg
ZnJvbSB5b3VyIHNlcnZlciB0byBmb2xsb3cKICB0aGVzZSBjb252ZW50aW9ucy4KCiAgIyMjIE9i
amVjdCBSb290CgogIFRoZSBKU09OIHBheWxvYWQgc2hvdWxkIGJlIGFuIG9iamVjdCB0aGF0IGNv
bnRhaW5zIHRoZSByZWNvcmQgaW5zaWRlIGEKICByb290IHByb3BlcnR5LiBGb3IgZXhhbXBsZSwg
aW4gcmVzcG9uc2UgdG8gYSBgR0VUYCByZXF1ZXN0IGZvcgogIGAvcG9zdHMvMWAsIHRoZSBKU09O
IHNob3VsZCBsb29rIGxpa2UgdGhpczoKCiAgYGBganMKICB7CiAgICAicG9zdCI6IHsKICAgICAg
InRpdGxlIjogIkknbSBSdW5uaW5nIHRvIFJlZm9ybSB0aGUgVzNDJ3MgVGFnIiwKICAgICAgImF1
dGhvciI6ICJZZWh1ZGEgS2F0eiIKICAgIH0KICB9CiAgYGBgCgogICMjIyBDb252ZW50aW9uYWwg
TmFtZXMKCiAgQXR0cmlidXRlIG5hbWVzIGluIHlvdXIgSlNPTiBwYXlsb2FkIHNob3VsZCBiZSB0
aGUgY2FtZWxDYXNlZCB2ZXJzaW9ucyBvZgogIHRoZSBhdHRyaWJ1dGVzIGluIHlvdXIgRW1iZXIu
anMgbW9kZWxzLgoKICBGb3IgZXhhbXBsZSwgaWYgeW91IGhhdmUgYSBgUGVyc29uYCBtb2RlbDoK
CiAgYGBganMKICBBcHAuUGVyc29uID0gRFMuTW9kZWwuZXh0ZW5kKHsKICAgIGZpcnN0TmFtZTog
RFMuYXR0cignc3RyaW5nJyksCiAgICBsYXN0TmFtZTogRFMuYXR0cignc3RyaW5nJyksCiAgICBv
Y2N1cGF0aW9uOiBEUy5hdHRyKCdzdHJpbmcnKQogIH0pOwogIGBgYAoKICBUaGUgSlNPTiByZXR1
cm5lZCBzaG91bGQgbG9vayBsaWtlIHRoaXM6CgogIGBgYGpzCiAgewogICAgInBlcnNvbiI6IHsK
ICAgICAgImZpcnN0TmFtZSI6ICJCYXJhY2siLAogICAgICAibGFzdE5hbWUiOiAiT2JhbWEiLAog
ICAgICAib2NjdXBhdGlvbiI6ICJQcmVzaWRlbnQiCiAgICB9CiAgfQogIGBgYAoKICAjIyBDdXN0
b21pemF0aW9uCgogICMjIyBFbmRwb2ludCBwYXRoIGN1c3RvbWl6YXRpb24KCiAgRW5kcG9pbnQg
cGF0aHMgY2FuIGJlIHByZWZpeGVkIHdpdGggYSBgbmFtZXNwYWNlYCBieSBzZXR0aW5nIHRoZSBu
YW1lc3BhY2UKICBwcm9wZXJ0eSBvbiB0aGUgYWRhcHRlcjoKCiAgYGBganMKICBEUy5SRVNUQWRh
cHRlci5yZW9wZW4oewogICAgbmFtZXNwYWNlOiAnYXBpLzEnCiAgfSk7CiAgYGBgCiAgUmVxdWVz
dHMgZm9yIGBBcHAuUGVyc29uYCB3b3VsZCBub3cgdGFyZ2V0IGAvYXBpLzEvcGVvcGxlLzFgLgoK
ICAjIyMgSG9zdCBjdXN0b21pemF0aW9uCgogIEFuIGFkYXB0ZXIgY2FuIHRhcmdldCBvdGhlciBo
b3N0cyBieSBzZXR0aW5nIHRoZSBgaG9zdGAgcHJvcGVydHkuCgogIGBgYGpzCiAgRFMuUkVTVEFk
YXB0ZXIucmVvcGVuKHsKICAgIGhvc3Q6ICdodHRwczovL2FwaS5leGFtcGxlLmNvbScKICB9KTsK
ICBgYGAKCiAgIyMjIEhlYWRlcnMgY3VzdG9taXphdGlvbgoKICBTb21lIEFQSXMgcmVxdWlyZSBI
VFRQIGhlYWRlcnMsIGUuZy4gdG8gcHJvdmlkZSBhbiBBUEkga2V5LiBBbiBhcnJheSBvZgogIGhl
YWRlcnMgY2FuIGJlIGFkZGVkIHRvIHRoZSBhZGFwdGVyIHdoaWNoIGFyZSBwYXNzZWQgd2l0aCBl
dmVyeSByZXF1ZXN0OgoKICBgYGBqcwogIERTLlJFU1RBZGFwdGVyLnJlb3Blbih7CiAgICBoZWFk
ZXJzOiB7CiAgICAgICJBUElfS0VZIjogInNlY3JldCBrZXkiLAogICAgICAiQU5PVEhFUl9IRUFE
RVIiOiAiU29tZSBoZWFkZXIgdmFsdWUiCiAgICB9CiAgfSk7CiAgYGBgCgogIEBjbGFzcyBSRVNU
QWRhcHRlcgogIEBjb25zdHJ1Y3RvcgogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBEUy5BZGFw
dGVyCiovCkRTLlJFU1RBZGFwdGVyID0gRFMuQWRhcHRlci5leHRlbmQoewogIGRlZmF1bHRTZXJp
YWxpemVyOiAnX3Jlc3QnLAoKCiAgLyoqCiAgICBFbmRwb2ludCBwYXRocyBjYW4gYmUgcHJlZml4
ZWQgd2l0aCBhIGBuYW1lc3BhY2VgIGJ5IHNldHRpbmcgdGhlIG5hbWVzcGFjZQogICAgcHJvcGVy
dHkgb24gdGhlIGFkYXB0ZXI6CgogICAgYGBgamF2YXNjcmlwdAogICAgRFMuUkVTVEFkYXB0ZXIu
cmVvcGVuKHsKICAgICAgbmFtZXNwYWNlOiAnYXBpLzEnCiAgICB9KTsKICAgIGBgYAoKICAgIFJl
cXVlc3RzIGZvciBgQXBwLlBvc3RgIHdvdWxkIG5vdyB0YXJnZXQgYC9hcGkvMS9wb3N0L2AuCgog
ICAgQHByb3BlcnR5IG5hbWVzcGFjZQogICAgQHR5cGUge1N0cmluZ30KICAqLwoKICAvKioKICAg
IEFuIGFkYXB0ZXIgY2FuIHRhcmdldCBvdGhlciBob3N0cyBieSBzZXR0aW5nIHRoZSBgaG9zdGAg
cHJvcGVydHkuCgogICAgYGBgamF2YXNjcmlwdAogICAgRFMuUkVTVEFkYXB0ZXIucmVvcGVuKHsK
ICAgICAgaG9zdDogJ2h0dHBzOi8vYXBpLmV4YW1wbGUuY29tJwogICAgfSk7CiAgICBgYGAKCiAg
ICBSZXF1ZXN0cyBmb3IgYEFwcC5Qb3N0YCB3b3VsZCBub3cgdGFyZ2V0IGBodHRwczovL2FwaS5l
eGFtcGxlLmNvbS9wb3N0L2AuCgogICAgQHByb3BlcnR5IGhvc3QKICAgIEB0eXBlIHtTdHJpbmd9
CiAgKi8KCiAgLyoqCiAgICBTb21lIEFQSXMgcmVxdWlyZSBIVFRQIGhlYWRlcnMsIGUuZy4gdG8g
cHJvdmlkZSBhbiBBUEkga2V5LiBBbiBhcnJheSBvZgogICAgaGVhZGVycyBjYW4gYmUgYWRkZWQg
dG8gdGhlIGFkYXB0ZXIgd2hpY2ggYXJlIHBhc3NlZCB3aXRoIGV2ZXJ5IHJlcXVlc3Q6CgogICAg
YGBgamF2YXNjcmlwdAogICAgRFMuUkVTVEFkYXB0ZXIucmVvcGVuKHsKICAgICAgaGVhZGVyczog
ewogICAgICAgICJBUElfS0VZIjogInNlY3JldCBrZXkiLAogICAgICAgICJBTk9USEVSX0hFQURF
UiI6ICJTb21lIGhlYWRlciB2YWx1ZSIKICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAcHJv
cGVydHkgaGVhZGVycwogICAgQHR5cGUge09iamVjdH0KICAqLwoKICAvKioKICAgIENhbGxlZCBi
eSB0aGUgc3RvcmUgaW4gb3JkZXIgdG8gZmV0Y2ggdGhlIEpTT04gZm9yIGEgZ2l2ZW4KICAgIHR5
cGUgYW5kIElELgoKICAgIFRoZSBgZmluZGAgbWV0aG9kIG1ha2VzIGFuIEFqYXggcmVxdWVzdCB0
byBhIFVSTCBjb21wdXRlZCBieSBgYnVpbGRVUkxgLCBhbmQgcmV0dXJucyBhCiAgICBwcm9taXNl
IGZvciB0aGUgcmVzdWx0aW5nIHBheWxvYWQuCgogICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgYW4g
SFRUUCBgR0VUYCByZXF1ZXN0IHdpdGggdGhlIGlkIHByb3ZpZGVkIGFzIHBhcnQgb2YgdGhlIHF1
ZXJ5c3RyaW5nLgoKICAgIEBtZXRob2QgZmluZAogICAgQHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUK
ICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUKICAgIEBwYXJhbSB7U3RyaW5n
fSBpZAogICAgQHJldHVybnMge1Byb21pc2V9IHByb21pc2UKICAqLwogIGZpbmQ6IGZ1bmN0aW9u
KHN0b3JlLCB0eXBlLCBpZCkgewogICAgcmV0dXJuIHRoaXMuYWpheCh0aGlzLmJ1aWxkVVJMKHR5
cGUudHlwZUtleSwgaWQpLCAnR0VUJyk7CiAgfSwKCiAgLyoqCiAgICBDYWxsZWQgYnkgdGhlIHN0
b3JlIGluIG9yZGVyIHRvIGZldGNoIGEgSlNPTiBhcnJheSBmb3IgYWxsCiAgICBvZiB0aGUgcmVj
b3JkcyBmb3IgYSBnaXZlbiB0eXBlLgoKICAgIFRoZSBgZmluZEFsbGAgbWV0aG9kIG1ha2VzIGFu
IEFqYXggKEhUVFAgR0VUKSByZXF1ZXN0IHRvIGEgVVJMIGNvbXB1dGVkIGJ5IGBidWlsZFVSTGAs
IGFuZCByZXR1cm5zIGEKICAgIHByb21pc2UgZm9yIHRoZSByZXN1bHRpbmcgcGF5bG9hZC4KCiAg
ICBAcHJpdmF0ZQogICAgQG1ldGhvZCBmaW5kQWxsCiAgICBAcGFyYW0ge0RTLlN0b3JlfSBzdG9y
ZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtTdHJp
bmd9IHNpbmNlVG9rZW4KICAgIEByZXR1cm5zIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBmaW5k
QWxsOiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgc2luY2VUb2tlbikgewogICAgdmFyIHF1ZXJ5OwoK
ICAgIGlmIChzaW5jZVRva2VuKSB7CiAgICAgIHF1ZXJ5ID0geyBzaW5jZTogc2luY2VUb2tlbiB9
OwogICAgfQoKICAgIHJldHVybiB0aGlzLmFqYXgodGhpcy5idWlsZFVSTCh0eXBlLnR5cGVLZXkp
LCAnR0VUJywgeyBkYXRhOiBxdWVyeSB9KTsKICB9LAoKICAvKioKICAgIENhbGxlZCBieSB0aGUg
c3RvcmUgaW4gb3JkZXIgdG8gZmV0Y2ggYSBKU09OIGFycmF5IGZvcgogICAgdGhlIHJlY29yZHMg
dGhhdCBtYXRjaCBhIHBhcnRpY3VsYXIgcXVlcnkuCgogICAgVGhlIGBmaW5kUXVlcnlgIG1ldGhv
ZCBtYWtlcyBhbiBBamF4IChIVFRQIEdFVCkgcmVxdWVzdCB0byBhIFVSTCBjb21wdXRlZCBieSBg
YnVpbGRVUkxgLCBhbmQgcmV0dXJucyBhCiAgICBwcm9taXNlIGZvciB0aGUgcmVzdWx0aW5nIHBh
eWxvYWQuCgogICAgVGhlIGBxdWVyeWAgYXJndW1lbnQgaXMgYSBzaW1wbGUgSmF2YVNjcmlwdCBv
YmplY3QgdGhhdCB3aWxsIGJlIHBhc3NlZCBkaXJlY3RseQogICAgdG8gdGhlIHNlcnZlciBhcyBw
YXJhbWV0ZXJzLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGZpbmRRdWVyeQogICAgQHBhcmFt
IHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9IHR5cGUK
ICAgIEBwYXJhbSB7T2JqZWN0fSBxdWVyeQogICAgQHJldHVybnMge1Byb21pc2V9IHByb21pc2UK
ICAqLwogIGZpbmRRdWVyeTogZnVuY3Rpb24oc3RvcmUsIHR5cGUsIHF1ZXJ5KSB7CiAgICByZXR1
cm4gdGhpcy5hamF4KHRoaXMuYnVpbGRVUkwodHlwZS50eXBlS2V5KSwgJ0dFVCcsIHsgZGF0YTog
cXVlcnkgfSk7CiAgfSwKCiAgLyoqCiAgICBDYWxsZWQgYnkgdGhlIHN0b3JlIGluIG9yZGVyIHRv
IGZldGNoIGEgSlNPTiBhcnJheSBmb3IKICAgIHRoZSB1bmxvYWRlZCByZWNvcmRzIGluIGEgaGFz
LW1hbnkgcmVsYXRpb25zaGlwIHRoYXQgd2VyZSBvcmlnaW5hbGx5CiAgICBzcGVjaWZpZWQgYXMg
SURzLgoKICAgIEZvciBleGFtcGxlLCBpZiB0aGUgb3JpZ2luYWwgcGF5bG9hZCBsb29rcyBsaWtl
OgoKICAgIGBgYGpzCiAgICB7CiAgICAgICJpZCI6IDEsCiAgICAgICJ0aXRsZSI6ICJSYWlscyBp
cyBvbWFrYXNlIiwKICAgICAgImNvbW1lbnRzIjogWyAxLCAyLCAzIF0KICAgIH0KICAgIGBgYAoK
ICAgIFRoZSBJRHMgd2lsbCBiZSBwYXNzZWQgYXMgYSBVUkwtZW5jb2RlZCBBcnJheSBvZiBJRHMs
IGluIHRoaXMgZm9ybToKCiAgICBgYGAKICAgIGlkc1tdPTEmaWRzW109MiZpZHNbXT0zCiAgICBg
YGAKCiAgICBNYW55IHNlcnZlcnMsIHN1Y2ggYXMgUmFpbHMgYW5kIFBIUCwgd2lsbCBhdXRvbWF0
aWNhbGx5IGNvbnZlcnQgdGhpcyBVUkwtZW5jb2RlZCBhcnJheQogICAgaW50byBhbiBBcnJheSBm
b3IgeW91IG9uIHRoZSBzZXJ2ZXItc2lkZS4gSWYgeW91IHdhbnQgdG8gZW5jb2RlIHRoZQogICAg
SURzLCBkaWZmZXJlbnRseSwganVzdCBvdmVycmlkZSB0aGlzIChvbmUtbGluZSkgbWV0aG9kLgoK
ICAgIFRoZSBgZmluZE1hbnlgIG1ldGhvZCBtYWtlcyBhbiBBamF4IChIVFRQIEdFVCkgcmVxdWVz
dCB0byBhIFVSTCBjb21wdXRlZCBieSBgYnVpbGRVUkxgLCBhbmQgcmV0dXJucyBhCiAgICBwcm9t
aXNlIGZvciB0aGUgcmVzdWx0aW5nIHBheWxvYWQuCgogICAgQG1ldGhvZCBmaW5kTWFueQogICAg
QHBhcmFtIHtEUy5TdG9yZX0gc3RvcmUKICAgIEBwYXJhbSB7c3ViY2xhc3Mgb2YgRFMuTW9kZWx9
IHR5cGUKICAgIEBwYXJhbSB7QXJyYXl9IGlkcwogICAgQHJldHVybnMge1Byb21pc2V9IHByb21p
c2UKICAqLwogIGZpbmRNYW55OiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgaWRzKSB7CiAgICByZXR1
cm4gdGhpcy5hamF4KHRoaXMuYnVpbGRVUkwodHlwZS50eXBlS2V5KSwgJ0dFVCcsIHsgZGF0YTog
eyBpZHM6IGlkcyB9IH0pOwogIH0sCgogIC8qKgogICAgQ2FsbGVkIGJ5IHRoZSBzdG9yZSBpbiBv
cmRlciB0byBmZXRjaCBhIEpTT04gYXJyYXkgZm9yCiAgICB0aGUgdW5sb2FkZWQgcmVjb3JkcyBp
biBhIGhhcy1tYW55IHJlbGF0aW9uc2hpcCB0aGF0IHdlcmUgb3JpZ2luYWxseQogICAgc3BlY2lm
aWVkIGFzIGEgVVJMIChpbnNpZGUgb2YgYGxpbmtzYCkuCgogICAgRm9yIGV4YW1wbGUsIGlmIHlv
dXIgb3JpZ2luYWwgcGF5bG9hZCBsb29rcyBsaWtlIHRoaXM6CgogICAgYGBganMKICAgIHsKICAg
ICAgInBvc3QiOiB7CiAgICAgICAgImlkIjogMSwKICAgICAgICAidGl0bGUiOiAiUmFpbHMgaXMg
b21ha2FzZSIsCiAgICAgICAgImxpbmtzIjogeyAiY29tbWVudHMiOiAiL3Bvc3RzLzEvY29tbWVu
dHMiIH0KICAgICAgfQogICAgfQogICAgYGBgCgogICAgVGhpcyBtZXRob2Qgd2lsbCBiZSBjYWxs
ZWQgd2l0aCB0aGUgcGFyZW50IHJlY29yZCBhbmQgYC9wb3N0cy8xL2NvbW1lbnRzYC4KCiAgICBU
aGUgYGZpbmRIYXNNYW55YCBtZXRob2Qgd2lsbCBtYWtlIGFuIEFqYXggKEhUVFAgR0VUKSByZXF1
ZXN0IHRvIHRoZSBvcmlnaW5hbGx5IHNwZWNpZmllZCBVUkwuCiAgICBJZiB0aGUgVVJMIGlzIGhv
c3QtcmVsYXRpdmUgKHN0YXJ0aW5nIHdpdGggYSBzaW5nbGUgc2xhc2gpLCB0aGUKICAgIHJlcXVl
c3Qgd2lsbCB1c2UgdGhlIGhvc3Qgc3BlY2lmaWVkIG9uIHRoZSBhZGFwdGVyIChpZiBhbnkpLgoK
ICAgIEBtZXRob2QgZmluZEhhc01hbnkKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBA
cGFyYW0ge0RTLk1vZGVsfSByZWNvcmQKICAgIEBwYXJhbSB7U3RyaW5nfSB1cmwKICAgIEByZXR1
cm5zIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBmaW5kSGFzTWFueTogZnVuY3Rpb24oc3RvcmUs
IHJlY29yZCwgdXJsKSB7CiAgICB2YXIgaG9zdCA9IGdldCh0aGlzLCAnaG9zdCcpLAogICAgICAg
IGlkICAgPSBnZXQocmVjb3JkLCAnaWQnKSwKICAgICAgICB0eXBlID0gcmVjb3JkLmNvbnN0cnVj
dG9yLnR5cGVLZXk7CgogICAgaWYgKGhvc3QgJiYgdXJsLmNoYXJBdCgwKSA9PT0gJy8nICYmIHVy
bC5jaGFyQXQoMSkgIT09ICcvJykgewogICAgICB1cmwgPSBob3N0ICsgdXJsOwogICAgfQoKICAg
IHJldHVybiB0aGlzLmFqYXgodGhpcy51cmxQcmVmaXgodXJsLCB0aGlzLmJ1aWxkVVJMKHR5cGUs
IGlkKSksICdHRVQnKTsKICB9LAoKICAvKioKICAgIENhbGxlZCBieSB0aGUgc3RvcmUgaW4gb3Jk
ZXIgdG8gZmV0Y2ggYSBKU09OIGFycmF5IGZvcgogICAgdGhlIHVubG9hZGVkIHJlY29yZHMgaW4g
YSBiZWxvbmdzLXRvIHJlbGF0aW9uc2hpcCB0aGF0IHdlcmUgb3JpZ2luYWxseQogICAgc3BlY2lm
aWVkIGFzIGEgVVJMIChpbnNpZGUgb2YgYGxpbmtzYCkuCgogICAgRm9yIGV4YW1wbGUsIGlmIHlv
dXIgb3JpZ2luYWwgcGF5bG9hZCBsb29rcyBsaWtlIHRoaXM6CgogICAgYGBganMKICAgIHsKICAg
ICAgInBlcnNvbiI6IHsKICAgICAgICAiaWQiOiAxLAogICAgICAgICJuYW1lIjogIlRvbSBEYWxl
IiwKICAgICAgICAibGlua3MiOiB7ICJncm91cCI6ICIvcGVvcGxlLzEvZ3JvdXAiIH0KICAgICAg
fQogICAgfQogICAgYGBgCgogICAgVGhpcyBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUg
cGFyZW50IHJlY29yZCBhbmQgYC9wZW9wbGUvMS9ncm91cGAuCgogICAgVGhlIGBmaW5kQmVsb25n
c1RvYCBtZXRob2Qgd2lsbCBtYWtlIGFuIEFqYXggKEhUVFAgR0VUKSByZXF1ZXN0IHRvIHRoZSBv
cmlnaW5hbGx5IHNwZWNpZmllZCBVUkwuCgogICAgQG1ldGhvZCBmaW5kQmVsb25nc1RvCiAgICBA
cGFyYW0ge0RTLlN0b3JlfSBzdG9yZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBA
cGFyYW0ge1N0cmluZ30gdXJsCiAgICBAcmV0dXJucyB7UHJvbWlzZX0gcHJvbWlzZQogICovCiAg
ZmluZEJlbG9uZ3NUbzogZnVuY3Rpb24oc3RvcmUsIHJlY29yZCwgdXJsKSB7CiAgICB2YXIgaWQg
ICA9IGdldChyZWNvcmQsICdpZCcpLAogICAgICAgIHR5cGUgPSByZWNvcmQuY29uc3RydWN0b3Iu
dHlwZUtleTsKCiAgICByZXR1cm4gdGhpcy5hamF4KHRoaXMudXJsUHJlZml4KHVybCwgdGhpcy5i
dWlsZFVSTCh0eXBlLCBpZCkpLCAnR0VUJyk7CiAgfSwKCiAgLyoqCiAgICBDYWxsZWQgYnkgdGhl
IHN0b3JlIHdoZW4gYSBuZXdseSBjcmVhdGVkIHJlY29yZCBpcwogICAgc2F2ZWQgdmlhIHRoZSBg
c2F2ZWAgbWV0aG9kIG9uIGEgbW9kZWwgcmVjb3JkIGluc3RhbmNlLgoKICAgIFRoZSBgY3JlYXRl
UmVjb3JkYCBtZXRob2Qgc2VyaWFsaXplcyB0aGUgcmVjb3JkIGFuZCBtYWtlcyBhbiBBamF4IChI
VFRQIFBPU1QpIHJlcXVlc3QKICAgIHRvIGEgVVJMIGNvbXB1dGVkIGJ5IGBidWlsZFVSTGAuCgog
ICAgU2VlIGBzZXJpYWxpemVgIGZvciBpbmZvcm1hdGlvbiBvbiBob3cgdG8gY3VzdG9taXplIHRo
ZSBzZXJpYWxpemVkIGZvcm0KICAgIG9mIGEgcmVjb3JkLgoKICAgIEBtZXRob2QgY3JlYXRlUmVj
b3JkCiAgICBAcGFyYW0ge0RTLlN0b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBE
Uy5Nb2RlbH0gdHlwZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBAcmV0dXJucyB7
UHJvbWlzZX0gcHJvbWlzZQogICovCiAgY3JlYXRlUmVjb3JkOiBmdW5jdGlvbihzdG9yZSwgdHlw
ZSwgcmVjb3JkKSB7CiAgICB2YXIgZGF0YSA9IHt9OwogICAgdmFyIHNlcmlhbGl6ZXIgPSBzdG9y
ZS5zZXJpYWxpemVyRm9yKHR5cGUudHlwZUtleSk7CgogICAgc2VyaWFsaXplci5zZXJpYWxpemVJ
bnRvSGFzaChkYXRhLCB0eXBlLCByZWNvcmQsIHsgaW5jbHVkZUlkOiB0cnVlIH0pOwoKICAgIHJl
dHVybiB0aGlzLmFqYXgodGhpcy5idWlsZFVSTCh0eXBlLnR5cGVLZXkpLCAiUE9TVCIsIHsgZGF0
YTogZGF0YSB9KTsKICB9LAoKICAvKioKICAgIENhbGxlZCBieSB0aGUgc3RvcmUgd2hlbiBhbiBl
eGlzdGluZyByZWNvcmQgaXMgc2F2ZWQKICAgIHZpYSB0aGUgYHNhdmVgIG1ldGhvZCBvbiBhIG1v
ZGVsIHJlY29yZCBpbnN0YW5jZS4KCiAgICBUaGUgYHVwZGF0ZVJlY29yZGAgbWV0aG9kIHNlcmlh
bGl6ZXMgdGhlIHJlY29yZCBhbmQgbWFrZXMgYW4gQWpheCAoSFRUUCBQVVQpIHJlcXVlc3QKICAg
IHRvIGEgVVJMIGNvbXB1dGVkIGJ5IGBidWlsZFVSTGAuCgogICAgU2VlIGBzZXJpYWxpemVgIGZv
ciBpbmZvcm1hdGlvbiBvbiBob3cgdG8gY3VzdG9taXplIHRoZSBzZXJpYWxpemVkIGZvcm0KICAg
IG9mIGEgcmVjb3JkLgoKICAgIEBtZXRob2QgdXBkYXRlUmVjb3JkCiAgICBAcGFyYW0ge0RTLlN0
b3JlfSBzdG9yZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQogICAgQHBh
cmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBAcmV0dXJucyB7UHJvbWlzZX0gcHJvbWlzZQogICov
CiAgdXBkYXRlUmVjb3JkOiBmdW5jdGlvbihzdG9yZSwgdHlwZSwgcmVjb3JkKSB7CiAgICB2YXIg
ZGF0YSA9IHt9OwogICAgdmFyIHNlcmlhbGl6ZXIgPSBzdG9yZS5zZXJpYWxpemVyRm9yKHR5cGUu
dHlwZUtleSk7CgogICAgc2VyaWFsaXplci5zZXJpYWxpemVJbnRvSGFzaChkYXRhLCB0eXBlLCBy
ZWNvcmQpOwoKICAgIHZhciBpZCA9IGdldChyZWNvcmQsICdpZCcpOwoKICAgIHJldHVybiB0aGlz
LmFqYXgodGhpcy5idWlsZFVSTCh0eXBlLnR5cGVLZXksIGlkKSwgIlBVVCIsIHsgZGF0YTogZGF0
YSB9KTsKICB9LAoKICAvKioKICAgIENhbGxlZCBieSB0aGUgc3RvcmUgd2hlbiBhIHJlY29yZCBp
cyBkZWxldGVkLgoKICAgIFRoZSBgZGVsZXRlUmVjb3JkYCBtZXRob2QgIG1ha2VzIGFuIEFqYXgg
KEhUVFAgREVMRVRFKSByZXF1ZXN0IHRvIGEgVVJMIGNvbXB1dGVkIGJ5IGBidWlsZFVSTGAuCgog
ICAgQG1ldGhvZCBkZWxldGVSZWNvcmQKICAgIEBwYXJhbSB7RFMuU3RvcmV9IHN0b3JlCiAgICBA
cGFyYW0ge3N1YmNsYXNzIG9mIERTLk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge0RTLk1vZGVsfSBy
ZWNvcmQKICAgIEByZXR1cm5zIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBkZWxldGVSZWNvcmQ6
IGZ1bmN0aW9uKHN0b3JlLCB0eXBlLCByZWNvcmQpIHsKICAgIHZhciBpZCA9IGdldChyZWNvcmQs
ICdpZCcpOwoKICAgIHJldHVybiB0aGlzLmFqYXgodGhpcy5idWlsZFVSTCh0eXBlLnR5cGVLZXks
IGlkKSwgIkRFTEVURSIpOwogIH0sCgogIC8qKgogICAgQnVpbGRzIGEgVVJMIGZvciBhIGdpdmVu
IHR5cGUgYW5kIG9wdGlvbmFsIElELgoKICAgIEJ5IGRlZmF1bHQsIGl0IHBsdXJhbGl6ZXMgdGhl
IHR5cGUncyBuYW1lIChmb3IgZXhhbXBsZSwgJ3Bvc3QnCiAgICBiZWNvbWVzICdwb3N0cycgYW5k
ICdwZXJzb24nIGJlY29tZXMgJ3Blb3BsZScpLiBUbyBvdmVycmlkZSB0aGUKICAgIHBsdXJhbGl6
YXRpb24gc2VlIFtwYXRoRm9yVHlwZV0oI21ldGhvZF9wYXRoRm9yVHlwZSkuCgogICAgSWYgYW4g
SUQgaXMgc3BlY2lmaWVkLCBpdCBhZGRzIHRoZSBJRCB0byB0aGUgcGF0aCBnZW5lcmF0ZWQKICAg
IGZvciB0aGUgdHlwZSwgc2VwYXJhdGVkIGJ5IGEgYC9gLgoKICAgIEBtZXRob2QgYnVpbGRVUkwK
ICAgIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICBAcGFyYW0ge1N0cmluZ30gaWQKICAgIEByZXR1
cm5zIHtTdHJpbmd9IHVybAogICovCiAgYnVpbGRVUkw6IGZ1bmN0aW9uKHR5cGUsIGlkKSB7CiAg
ICB2YXIgdXJsID0gW10sCiAgICAgICAgaG9zdCA9IGdldCh0aGlzLCAnaG9zdCcpLAogICAgICAg
IHByZWZpeCA9IHRoaXMudXJsUHJlZml4KCk7CgogICAgaWYgKHR5cGUpIHsgdXJsLnB1c2godGhp
cy5wYXRoRm9yVHlwZSh0eXBlKSk7IH0KICAgIGlmIChpZCkgeyB1cmwucHVzaChpZCk7IH0KCiAg
ICBpZiAocHJlZml4KSB7IHVybC51bnNoaWZ0KHByZWZpeCk7IH0KCiAgICB1cmwgPSB1cmwuam9p
bignLycpOwogICAgaWYgKCFob3N0ICYmIHVybCkgeyB1cmwgPSAnLycgKyB1cmw7IH0KCiAgICBy
ZXR1cm4gdXJsOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCB1cmxQcmVmaXgKICAgIEBwcml2YXRl
CiAgICBAcGFyYW0ge1N0cmluZ30gcGF0aAogICAgQHBhcmFtIHtTdHJpbmd9IHBhcmVudFVybAog
ICAgQHJldHVybiB7U3RyaW5nfSB1cmxQcmVmaXgKICAqLwogIHVybFByZWZpeDogZnVuY3Rpb24o
cGF0aCwgcGFyZW50VVJMKSB7CiAgICB2YXIgaG9zdCA9IGdldCh0aGlzLCAnaG9zdCcpLAogICAg
ICAgIG5hbWVzcGFjZSA9IGdldCh0aGlzLCAnbmFtZXNwYWNlJyksCiAgICAgICAgdXJsID0gW107
CgogICAgaWYgKHBhdGgpIHsKICAgICAgLy8gQWJzb2x1dGUgcGF0aAogICAgICBpZiAocGF0aC5j
aGFyQXQoMCkgPT09ICcvJykgewogICAgICAgIGlmIChob3N0KSB7CiAgICAgICAgICBwYXRoID0g
cGF0aC5zbGljZSgxKTsKICAgICAgICAgIHVybC5wdXNoKGhvc3QpOwogICAgICAgIH0KICAgICAg
Ly8gUmVsYXRpdmUgcGF0aAogICAgICB9IGVsc2UgaWYgKCEvXmh0dHAocyk/OlwvXC8vLnRlc3Qo
cGF0aCkpIHsKICAgICAgICB1cmwucHVzaChwYXJlbnRVUkwpOwogICAgICB9CiAgICB9IGVsc2Ug
ewogICAgICBpZiAoaG9zdCkgeyB1cmwucHVzaChob3N0KTsgfQogICAgICBpZiAobmFtZXNwYWNl
KSB7IHVybC5wdXNoKG5hbWVzcGFjZSk7IH0KICAgIH0KCiAgICBpZiAocGF0aCkgewogICAgICB1
cmwucHVzaChwYXRoKTsKICAgIH0KCiAgICByZXR1cm4gdXJsLmpvaW4oJy8nKTsKICB9LAoKICAv
KioKICAgIERldGVybWluZXMgdGhlIHBhdGhuYW1lIGZvciBhIGdpdmVuIHR5cGUuCgogICAgQnkg
ZGVmYXVsdCwgaXQgcGx1cmFsaXplcyB0aGUgdHlwZSdzIG5hbWUgKGZvciBleGFtcGxlLAogICAg
J3Bvc3QnIGJlY29tZXMgJ3Bvc3RzJyBhbmQgJ3BlcnNvbicgYmVjb21lcyAncGVvcGxlJykuCgog
ICAgIyMjIFBhdGhuYW1lIGN1c3RvbWl6YXRpb24KCiAgICBGb3IgZXhhbXBsZSBpZiB5b3UgaGF2
ZSBhbiBvYmplY3QgTGluZUl0ZW0gd2l0aCBhbgogICAgZW5kcG9pbnQgb2YgIi9saW5lX2l0ZW1z
LyIuCgogICAgYGBganMKICAgIERTLlJFU1RBZGFwdGVyLnJlb3Blbih7CiAgICAgIHBhdGhGb3JU
eXBlOiBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgdmFyIGRlY2FtZWxpemVkID0gRW1iZXIuU3Ry
aW5nLmRlY2FtZWxpemUodHlwZSk7CiAgICAgICAgcmV0dXJuIEVtYmVyLlN0cmluZy5wbHVyYWxp
emUoZGVjYW1lbGl6ZWQpOwogICAgICB9OwogICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIHBh
dGhGb3JUeXBlCiAgICBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAgQHJldHVybnMge1N0cmluZ30g
cGF0aAogICoqLwogIHBhdGhGb3JUeXBlOiBmdW5jdGlvbih0eXBlKSB7CiAgICByZXR1cm4gRW1i
ZXIuU3RyaW5nLnBsdXJhbGl6ZSh0eXBlKTsKICB9LAoKICAvKioKICAgIFRha2VzIGFuIGFqYXgg
cmVzcG9uc2UsIGFuZCByZXR1cm5zIGEgcmVsYXZhbnQgZXJyb3IuCgogICAgUmV0dXJuaW5nIGEg
YERTLkludmFsaWRFcnJvcmAgZnJvbSB0aGlzIG1ldGhvZCB3aWxsIGNhdXNlIHRoZQogICAgcmVj
b3JkIHRvIHRyYW5zaXRpb24gaW50byB0aGUgYGludmFsaWRgIHN0YXRlIGFuZCBtYWtlIHRoZQog
ICAgYGVycm9yc2Agb2JqZWN0IGF2YWlsYWJsZSBvbiB0aGUgcmVjb3JkLgoKICAgIGBgYGphdmFz
Y3JpcHQKICAgIEFwcC5BcHBsaWNhdGlvbkFkYXB0ZXIgPSBEUy5SRVNUQWRhcHRlci5leHRlbmQo
ewogICAgICBhamF4RXJyb3I6IGZ1bmN0aW9uKGpxWEhSKSB7CiAgICAgICAgdmFyIGVycm9yID0g
dGhpcy5fc3VwZXIoanFYSFIpOwoKICAgICAgICBpZiAoanFYSFIgJiYganFYSFIuc3RhdHVzID09
PSA0MjIpIHsKICAgICAgICAgIHZhciBqc29uRXJyb3JzID0gRW1iZXIuJC5wYXJzZUpTT04oanFY
SFIucmVzcG9uc2VUZXh0KVsiZXJyb3JzIl07CgogICAgICAgICAgcmV0dXJuIG5ldyBEUy5JbnZh
bGlkRXJyb3IoanNvbkVycm9ycyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBl
cnJvcjsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgTm90ZTogQXMgYSBj
b3JyZWN0bmVzcyBvcHRpbWl6YXRpb24sIHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mCiAg
ICB0aGUgYGFqYXhFcnJvcmAgbWV0aG9kIHN0cmlwcyBvdXQgdGhlIGB0aGVuYCBtZXRob2QgZnJv
bSBqcXVlcnkncwogICAgYWpheCByZXNwb25zZSAoanFYSFIpLiBUaGlzIGlzIGltcG9ydGFudCBi
ZWNhdXNlIHRoZSBqcVhIUidzCiAgICBgdGhlbmAgbWV0aG9kIGZ1bGZpbGxzIHRoZSBwcm9taXNl
IHdpdGggaXRzZWxmIHJlc3VsdGluZyBpbiBhCiAgICBjaXJjdWxhciAidGhlbmFibGUiIGNoYWlu
IHdoaWNoIG1heSBjYXVzZSBwcm9ibGVtcyBmb3Igc29tZQogICAgcHJvbWlzZSBsaWJyYXJpZXMu
CgogICAgQG1ldGhvZCBhamF4RXJyb3IKICAgIEBwYXJhbSAge09iamVjdH0ganFYSFIKICAgIEBy
ZXR1cm4ge09iamVjdH0ganFYSFIKICAqLwogIGFqYXhFcnJvcjogZnVuY3Rpb24oanFYSFIpIHsK
ICAgIGlmIChqcVhIUikgewogICAgICBqcVhIUi50aGVuID0gbnVsbDsKICAgIH0KCiAgICByZXR1
cm4ganFYSFI7CiAgfSwKCiAgLyoqCiAgICBUYWtlcyBhIFVSTCwgYW4gSFRUUCBtZXRob2QgYW5k
IGEgaGFzaCBvZiBkYXRhLCBhbmQgbWFrZXMgYW4KICAgIEhUVFAgcmVxdWVzdC4KCiAgICBXaGVu
IHRoZSBzZXJ2ZXIgcmVzcG9uZHMgd2l0aCBhIHBheWxvYWQsIEVtYmVyIERhdGEgd2lsbCBjYWxs
IGludG8gYGV4dHJhY3RTaW5nbGVgCiAgICBvciBgZXh0cmFjdEFycmF5YCAoZGVwZW5kaW5nIG9u
IHdoZXRoZXIgdGhlIG9yaWdpbmFsIHF1ZXJ5IHdhcyBmb3Igb25lIHJlY29yZCBvcgogICAgbWFu
eSByZWNvcmRzKS4KCiAgICBCeSBkZWZhdWx0LCBgYWpheGAgbWV0aG9kIGhhcyB0aGUgZm9sbG93
aW5nIGJlaGF2aW9yOgoKICAgICogSXQgc2V0cyB0aGUgcmVzcG9uc2UgYGRhdGFUeXBlYCB0byBg
Impzb24iYAogICAgKiBJZiB0aGUgSFRUUCBtZXRob2QgaXMgbm90IGAiR0VUImAsIGl0IHNldHMg
dGhlIGBDb250ZW50LVR5cGVgIHRvIGJlCiAgICAgIGBhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0
PXV0Zi04YAogICAgKiBJZiB0aGUgSFRUUCBtZXRob2QgaXMgbm90IGAiR0VUImAsIGl0IHN0cmlu
Z2lmaWVzIHRoZSBkYXRhIHBhc3NlZCBpbi4gVGhlCiAgICAgIGRhdGEgaXMgdGhlIHNlcmlhbGl6
ZWQgcmVjb3JkIGluIHRoZSBjYXNlIG9mIGEgc2F2ZS4KICAgICogUmVnaXN0ZXJzIHN1Y2Nlc3Mg
YW5kIGZhaWx1cmUgaGFuZGxlcnMuCgogICAgQG1ldGhvZCBhamF4CiAgICBAcHJpdmF0ZQogICAg
QHBhcmFtIHtTdHJpbmd9IHVybAogICAgQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHJlcXVlc3Qg
dHlwZSBHRVQsIFBPU1QsIFBVVCwgREVMRVRFIGVjdC4KICAgIEBwYXJhbSB7T2JqZWN0fSBoYXNo
CiAgICBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlCiAgKi8KICBhamF4OiBmdW5jdGlvbih1cmws
IHR5cGUsIGhhc2gpIHsKICAgIHZhciBhZGFwdGVyID0gdGhpczsKCiAgICByZXR1cm4gbmV3IEVt
YmVyLlJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgaGFzaCA9
IGFkYXB0ZXIuYWpheE9wdGlvbnModXJsLCB0eXBlLCBoYXNoKTsKCiAgICAgIGhhc2guc3VjY2Vz
cyA9IGZ1bmN0aW9uKGpzb24pIHsKICAgICAgICBFbWJlci5ydW4obnVsbCwgcmVzb2x2ZSwganNv
bik7CiAgICAgIH07CgogICAgICBoYXNoLmVycm9yID0gZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0
dXMsIGVycm9yVGhyb3duKSB7CiAgICAgICAgRW1iZXIucnVuKG51bGwsIHJlamVjdCwgYWRhcHRl
ci5hamF4RXJyb3IoanFYSFIpKTsKICAgICAgfTsKCiAgICAgIEVtYmVyLiQuYWpheChoYXNoKTsK
ICAgIH0sICJEUzogUmVzdEFkYXB0ZXIjYWpheCAiICsgdHlwZSArICIgdG8gIiArIHVybCk7CiAg
fSwKCiAgLyoqCiAgICBAbWV0aG9kIGFqYXhPcHRpb25zCiAgICBAcHJpdmF0ZQogICAgQHBhcmFt
IHtTdHJpbmd9IHVybAogICAgQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHJlcXVlc3QgdHlwZSBH
RVQsIFBPU1QsIFBVVCwgREVMRVRFIGVjdC4KICAgIEBwYXJhbSB7T2JqZWN0fSBoYXNoCiAgICBA
cmV0dXJuIHtPYmplY3R9IGhhc2gKICAqLwogIGFqYXhPcHRpb25zOiBmdW5jdGlvbih1cmwsIHR5
cGUsIGhhc2gpIHsKICAgIGhhc2ggPSBoYXNoIHx8IHt9OwogICAgaGFzaC51cmwgPSB1cmw7CiAg
ICBoYXNoLnR5cGUgPSB0eXBlOwogICAgaGFzaC5kYXRhVHlwZSA9ICdqc29uJzsKICAgIGhhc2gu
Y29udGV4dCA9IHRoaXM7CgogICAgaWYgKGhhc2guZGF0YSAmJiB0eXBlICE9PSAnR0VUJykgewog
ICAgICBoYXNoLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgn
OwogICAgICBoYXNoLmRhdGEgPSBKU09OLnN0cmluZ2lmeShoYXNoLmRhdGEpOwogICAgfQoKICAg
IGlmICh0aGlzLmhlYWRlcnMgIT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgaGVhZGVycyA9IHRo
aXMuaGVhZGVyczsKICAgICAgaGFzaC5iZWZvcmVTZW5kID0gZnVuY3Rpb24gKHhocikgewogICAg
ICAgIGZvckVhY2guY2FsbChFbWJlci5rZXlzKGhlYWRlcnMpLCBmdW5jdGlvbihrZXkpIHsKICAg
ICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldKTsKICAgICAgICB9
KTsKICAgICAgfTsKICAgIH0KCgogICAgcmV0dXJuIGhhc2g7CiAgfQoKfSk7Cgp9KSgpOwoKCgoo
ZnVuY3Rpb24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXItZGF0YQoqLwoKfSkoKTsKCgoKKGZ1bmN0
aW9uKCkgewpEUy5Nb2RlbC5yZW9wZW4oewoKICAvKioKICAgIFByb3ZpZGVzIGluZm8gYWJvdXQg
dGhlIG1vZGVsIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMKICAgIGJ5IGdyb3VwaW5nIHRoZSBwcm9w
ZXJ0aWVzIGludG8gbW9yZSBzZW1hbnRpYyBncm91cHMuCgogICAgTWVhbnQgdG8gYmUgdXNlZCBi
eSBkZWJ1Z2dpbmcgdG9vbHMgc3VjaCBhcyB0aGUgQ2hyb21lIEVtYmVyIEV4dGVuc2lvbi4KCiAg
ICAtIEdyb3VwcyBhbGwgYXR0cmlidXRlcyBpbiAiQXR0cmlidXRlcyIgZ3JvdXAuCiAgICAtIEdy
b3VwcyBhbGwgYmVsb25nc1RvIHJlbGF0aW9uc2hpcHMgaW4gIkJlbG9uZ3MgVG8iIGdyb3VwLgog
ICAgLSBHcm91cHMgYWxsIGhhc01hbnkgcmVsYXRpb25zaGlwcyBpbiAiSGFzIE1hbnkiIGdyb3Vw
LgogICAgLSBHcm91cHMgYWxsIGZsYWdzIGluICJGbGFncyIgZ3JvdXAuCiAgICAtIEZsYWdzIHJl
bGF0aW9uc2hpcCBDUHMgYXMgZXhwZW5zaXZlIHByb3BlcnRpZXMuCgogICAgQG1ldGhvZCBfZGVi
dWdJbmZvCiAgICBAZm9yIERTLk1vZGVsCiAgICBAcHJpdmF0ZQogICovCiAgX2RlYnVnSW5mbzog
ZnVuY3Rpb24oKSB7CiAgICB2YXIgYXR0cmlidXRlcyA9IFsnaWQnXSwKICAgICAgICByZWxhdGlv
bnNoaXBzID0geyBiZWxvbmdzVG86IFtdLCBoYXNNYW55OiBbXSB9LAogICAgICAgIGV4cGVuc2l2
ZVByb3BlcnRpZXMgPSBbXTsKCiAgICB0aGlzLmVhY2hBdHRyaWJ1dGUoZnVuY3Rpb24obmFtZSwg
bWV0YSkgewogICAgICBhdHRyaWJ1dGVzLnB1c2gobmFtZSk7CiAgICB9LCB0aGlzKTsKCiAgICB0
aGlzLmVhY2hSZWxhdGlvbnNoaXAoZnVuY3Rpb24obmFtZSwgcmVsYXRpb25zaGlwKSB7CiAgICAg
IHJlbGF0aW9uc2hpcHNbcmVsYXRpb25zaGlwLmtpbmRdLnB1c2gobmFtZSk7CiAgICAgIGV4cGVu
c2l2ZVByb3BlcnRpZXMucHVzaChuYW1lKTsKICAgIH0pOwoKICAgIHZhciBncm91cHMgPSBbCiAg
ICAgIHsKICAgICAgICBuYW1lOiAnQXR0cmlidXRlcycsCiAgICAgICAgcHJvcGVydGllczogYXR0
cmlidXRlcywKICAgICAgICBleHBhbmQ6IHRydWUKICAgICAgfSwKICAgICAgewogICAgICAgIG5h
bWU6ICdCZWxvbmdzIFRvJywKICAgICAgICBwcm9wZXJ0aWVzOiByZWxhdGlvbnNoaXBzLmJlbG9u
Z3NUbywKICAgICAgICBleHBhbmQ6IHRydWUKICAgICAgfSwKICAgICAgewogICAgICAgIG5hbWU6
ICdIYXMgTWFueScsCiAgICAgICAgcHJvcGVydGllczogcmVsYXRpb25zaGlwcy5oYXNNYW55LAog
ICAgICAgIGV4cGFuZDogdHJ1ZQogICAgICB9LAogICAgICB7CiAgICAgICAgbmFtZTogJ0ZsYWdz
JywKICAgICAgICBwcm9wZXJ0aWVzOiBbJ2lzTG9hZGVkJywgJ2lzRGlydHknLCAnaXNTYXZpbmcn
LCAnaXNEZWxldGVkJywgJ2lzRXJyb3InLCAnaXNOZXcnLCAnaXNWYWxpZCddCiAgICAgIH0KICAg
IF07CgogICAgcmV0dXJuIHsKICAgICAgcHJvcGVydHlJbmZvOiB7CiAgICAgICAgLy8gaW5jbHVk
ZSBhbGwgb3RoZXIgbWl4aW5zIC8gcHJvcGVydGllcyAobm90IGp1c3QgdGhlIGdyb3VwZWQgb25l
cykKICAgICAgICBpbmNsdWRlT3RoZXJQcm9wZXJ0aWVzOiB0cnVlLAogICAgICAgIGdyb3Vwczog
Z3JvdXBzLAogICAgICAgIC8vIGRvbid0IHByZS1jYWxjdWxhdGUgdW5sZXNzIGNhY2hlZAogICAg
ICAgIGV4cGVuc2l2ZVByb3BlcnRpZXM6IGV4cGVuc2l2ZVByb3BlcnRpZXMKICAgICAgfQogICAg
fTsKICB9Cgp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlci1k
YXRhCiovCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgogIEVtYmVyIERhdGEKCiAgQG1vZHVs
ZSBlbWJlci1kYXRhCiAgQG1haW4gZW1iZXItZGF0YQoqLwoKfSkoKTsKCihmdW5jdGlvbigpIHsK
RW1iZXIuU3RyaW5nLnBsdXJhbGl6ZSA9IGZ1bmN0aW9uKHdvcmQpIHsKICByZXR1cm4gRW1iZXIu
SW5mbGVjdG9yLmluZmxlY3Rvci5wbHVyYWxpemUod29yZCk7Cn07CgpFbWJlci5TdHJpbmcuc2lu
Z3VsYXJpemUgPSBmdW5jdGlvbih3b3JkKSB7CiAgcmV0dXJuIEVtYmVyLkluZmxlY3Rvci5pbmZs
ZWN0b3Iuc2luZ3VsYXJpemUod29yZCk7Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBC
TEFOS19SRUdFWCA9IC9eXHMqJC87CgpmdW5jdGlvbiBsb2FkVW5jb3VudGFibGUocnVsZXMsIHVu
Y291bnRhYmxlKSB7CiAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHVuY291bnRhYmxlLmxlbmd0
aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICBydWxlcy51bmNvdW50YWJsZVt1bmNvdW50YWJsZVtp
XS50b0xvd2VyQ2FzZSgpXSA9IHRydWU7CiAgfQp9CgpmdW5jdGlvbiBsb2FkSXJyZWd1bGFyKHJ1
bGVzLCBpcnJlZ3VsYXJQYWlycykgewogIHZhciBwYWlyOwoKICBmb3IgKHZhciBpID0gMCwgbGVu
Z3RoID0gaXJyZWd1bGFyUGFpcnMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIHBhaXIg
PSBpcnJlZ3VsYXJQYWlyc1tpXTsKCiAgICBydWxlcy5pcnJlZ3VsYXJbcGFpclswXS50b0xvd2Vy
Q2FzZSgpXSA9IHBhaXJbMV07CiAgICBydWxlcy5pcnJlZ3VsYXJJbnZlcnNlW3BhaXJbMV0udG9M
b3dlckNhc2UoKV0gPSBwYWlyWzBdOwogIH0KfQoKLyoqCiAgSW5mbGVjdG9yLkVtYmVyIHByb3Zp
ZGVzIGEgbWVjaGFuaXNtIGZvciBzdXBwbHlpbmcgaW5mbGVjdGlvbiBydWxlcyBmb3IgeW91cgog
IGFwcGxpY2F0aW9uLiBFbWJlciBpbmNsdWRlcyBhIGRlZmF1bHQgc2V0IG9mIGluZmxlY3Rpb24g
cnVsZXMsIGFuZCBwcm92aWRlcyBhbgogIEFQSSBmb3IgcHJvdmlkaW5nIGFkZGl0aW9uYWwgcnVs
ZXMuCgogIEV4YW1wbGVzOgoKICBDcmVhdGluZyBhbiBpbmZsZWN0b3Igd2l0aCBubyBydWxlcy4K
CiAgYGBganMKICB2YXIgaW5mbGVjdG9yID0gbmV3IEVtYmVyLkluZmxlY3RvcigpOwogIGBgYAoK
ICBDcmVhdGluZyBhbiBpbmZsZWN0b3Igd2l0aCB0aGUgZGVmYXVsdCBlbWJlciBydWxlc2V0LgoK
ICBgYGBqcwogIHZhciBpbmZsZWN0b3IgPSBuZXcgRW1iZXIuSW5mbGVjdG9yKEVtYmVyLkluZmxl
Y3Rvci5kZWZhdWx0UnVsZXMpOwoKICBpbmZsZWN0b3IucGx1cmFsaXplKCdjb3cnKSAvLz0+ICdr
aW5lJwogIGluZmxlY3Rvci5zaW5ndWxhcml6ZSgna2luZScpIC8vPT4gJ2NvdycKICBgYGAKCiAg
Q3JlYXRpbmcgYW4gaW5mbGVjdG9yIGFuZCBhZGRpbmcgcnVsZXMgbGF0ZXIuCgogIGBgYGphdmFz
Y3JpcHQKICB2YXIgaW5mbGVjdG9yID0gRW1iZXIuSW5mbGVjdG9yLmluZmxlY3RvcjsKCiAgaW5m
bGVjdG9yLnBsdXJhbGl6ZSgnYWR2aWNlJykgLy8gPT4gJ2FkdmljZXMnCiAgaW5mbGVjdG9yLnVu
Y291bnRhYmxlKCdhZHZpY2UnKTsKICBpbmZsZWN0b3IucGx1cmFsaXplKCdhZHZpY2UnKSAvLyA9
PiAnYWR2aWNlJwoKICBpbmZsZWN0b3IucGx1cmFsaXplKCdmb3JtdWxhJykgLy8gPT4gJ2Zvcm11
bGFzJwogIGluZmxlY3Rvci5pcnJlZ3VsYXIoJ2Zvcm11bGEnLCAnZm9ybXVsYWUnKTsKICBpbmZs
ZWN0b3IucGx1cmFsaXplKCdmb3JtdWxhJykgLy8gPT4gJ2Zvcm11bGFlJwoKICAvLyB5b3Ugd291
bGQgbm90IG5lZWQgdG8gYWRkIHRoZXNlIGFzIHRoZXkgYXJlIHRoZSBkZWZhdWx0IHJ1bGVzCiAg
aW5mbGVjdG9yLnBsdXJhbCgvJC8sICdzJyk7CiAgaW5mbGVjdG9yLnNpbmd1bGFyKC9zJC9pLCAn
Jyk7CiAgYGBgCgogIENyZWF0aW5nIGFuIGluZmxlY3RvciB3aXRoIGEgbm9uZGVmYXVsdCBydWxl
c2V0LgoKICBgYGBqYXZhc2NyaXB0CiAgdmFyIHJ1bGVzID0gewogICAgcGx1cmFsczogIFsgLyQv
LCAncycgXSwKICAgIHNpbmd1bGFyOiBbIC9ccyQvLCAnJyBdLAogICAgaXJyZWd1bGFyUGFpcnM6
IFsKICAgICAgWyAnY293JywgJ2tpbmUnIF0KICAgIF0sCiAgICB1bmNvdW50YWJsZTogWyAnZmlz
aCcgXQogIH07CgogIHZhciBpbmZsZWN0b3IgPSBuZXcgRW1iZXIuSW5mbGVjdG9yKHJ1bGVzKTsK
ICBgYGAKCiAgQGNsYXNzIEluZmxlY3RvcgogIEBuYW1lc3BhY2UgRW1iZXIKKi8KZnVuY3Rpb24g
SW5mbGVjdG9yKHJ1bGVTZXQpIHsKICBydWxlU2V0ID0gcnVsZVNldCB8fCB7fTsKICBydWxlU2V0
LnVuY291bnRhYmxlID0gcnVsZVNldC51bmNvdW50YWJsZSB8fCB7fTsKICBydWxlU2V0LmlycmVn
dWxhclBhaXJzID0gcnVsZVNldC5pcnJlZ3VsYXJQYWlycyB8fCB7fTsKCiAgdmFyIHJ1bGVzID0g
dGhpcy5ydWxlcyA9IHsKICAgIHBsdXJhbHM6ICBydWxlU2V0LnBsdXJhbHMgfHwgW10sCiAgICBz
aW5ndWxhcjogcnVsZVNldC5zaW5ndWxhciB8fCBbXSwKICAgIGlycmVndWxhcjoge30sCiAgICBp
cnJlZ3VsYXJJbnZlcnNlOiB7fSwKICAgIHVuY291bnRhYmxlOiB7fQogIH07CgogIGxvYWRVbmNv
dW50YWJsZShydWxlcywgcnVsZVNldC51bmNvdW50YWJsZSk7CiAgbG9hZElycmVndWxhcihydWxl
cywgcnVsZVNldC5pcnJlZ3VsYXJQYWlycyk7Cn0KCkluZmxlY3Rvci5wcm90b3R5cGUgPSB7CiAg
LyoqCiAgICBAbWV0aG9kIHBsdXJhbAogICAgQHBhcmFtIHtSZWdFeHB9IHJlZ2V4CiAgICBAcGFy
YW0ge1N0cmluZ30gc3RyaW5nCiAgKi8KICBwbHVyYWw6IGZ1bmN0aW9uKHJlZ2V4LCBzdHJpbmcp
IHsKICAgIHRoaXMucnVsZXMucGx1cmFscy5wdXNoKFtyZWdleCwgc3RyaW5nLnRvTG93ZXJDYXNl
KCldKTsKICB9LAoKICAvKioKICAgIEBtZXRob2Qgc2luZ3VsYXIKICAgIEBwYXJhbSB7UmVnRXhw
fSByZWdleAogICAgQHBhcmFtIHtTdHJpbmd9IHN0cmluZwogICovCiAgc2luZ3VsYXI6IGZ1bmN0
aW9uKHJlZ2V4LCBzdHJpbmcpIHsKICAgIHRoaXMucnVsZXMuc2luZ3VsYXIucHVzaChbcmVnZXgs
IHN0cmluZy50b0xvd2VyQ2FzZSgpXSk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIHVuY291bnRh
YmxlCiAgICBAcGFyYW0ge1N0cmluZ30gcmVnZXgKICAqLwogIHVuY291bnRhYmxlOiBmdW5jdGlv
bihzdHJpbmcpIHsKICAgIGxvYWRVbmNvdW50YWJsZSh0aGlzLnJ1bGVzLCBbc3RyaW5nLnRvTG93
ZXJDYXNlKCldKTsKICB9LAoKICAvKioKICAgIEBtZXRob2QgaXJyZWd1bGFyCiAgICBAcGFyYW0g
e1N0cmluZ30gc2luZ3VsYXIKICAgIEBwYXJhbSB7U3RyaW5nfSBwbHVyYWwKICAqLwogIGlycmVn
dWxhcjogZnVuY3Rpb24gKHNpbmd1bGFyLCBwbHVyYWwpIHsKICAgIGxvYWRJcnJlZ3VsYXIodGhp
cy5ydWxlcywgW1tzaW5ndWxhciwgcGx1cmFsXV0pOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBw
bHVyYWxpemUKICAgIEBwYXJhbSB7U3RyaW5nfSB3b3JkCiAgKi8KICBwbHVyYWxpemU6IGZ1bmN0
aW9uKHdvcmQpIHsKICAgIHJldHVybiB0aGlzLmluZmxlY3Qod29yZCwgdGhpcy5ydWxlcy5wbHVy
YWxzLCB0aGlzLnJ1bGVzLmlycmVndWxhcik7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIHNpbmd1
bGFyaXplCiAgICBAcGFyYW0ge1N0cmluZ30gd29yZAogICovCiAgc2luZ3VsYXJpemU6IGZ1bmN0
aW9uKHdvcmQpIHsKICAgIHJldHVybiB0aGlzLmluZmxlY3Qod29yZCwgdGhpcy5ydWxlcy5zaW5n
dWxhciwgIHRoaXMucnVsZXMuaXJyZWd1bGFySW52ZXJzZSk7CiAgfSwKCiAgLyoqCiAgICBAcHJv
dGVjdGVkCgogICAgQG1ldGhvZCBpbmZsZWN0CiAgICBAcGFyYW0ge1N0cmluZ30gd29yZAogICAg
QHBhcmFtIHtPYmplY3R9IHR5cGVSdWxlcwogICAgQHBhcmFtIHtPYmplY3R9IGlycmVndWxhcgog
ICovCiAgaW5mbGVjdDogZnVuY3Rpb24od29yZCwgdHlwZVJ1bGVzLCBpcnJlZ3VsYXIpIHsKICAg
IHZhciBpbmZsZWN0aW9uLCBzdWJzdGl0dXRpb24sIHJlc3VsdCwgbG93ZXJjYXNlLCBpc0JsYW5r
LAogICAgaXNVbmNvdW50YWJsZSwgaXNJcnJlZ3VsYXIsIGlzSXJyZWd1bGFySW52ZXJzZSwgcnVs
ZTsKCiAgICBpc0JsYW5rID0gQkxBTktfUkVHRVgudGVzdCh3b3JkKTsKCiAgICBpZiAoaXNCbGFu
aykgewogICAgICByZXR1cm4gd29yZDsKICAgIH0KCiAgICBsb3dlcmNhc2UgPSB3b3JkLnRvTG93
ZXJDYXNlKCk7CgogICAgaXNVbmNvdW50YWJsZSA9IHRoaXMucnVsZXMudW5jb3VudGFibGVbbG93
ZXJjYXNlXTsKCiAgICBpZiAoaXNVbmNvdW50YWJsZSkgewogICAgICByZXR1cm4gd29yZDsKICAg
IH0KCiAgICBpc0lycmVndWxhciA9IGlycmVndWxhciAmJiBpcnJlZ3VsYXJbbG93ZXJjYXNlXTsK
CiAgICBpZiAoaXNJcnJlZ3VsYXIpIHsKICAgICAgcmV0dXJuIGlzSXJyZWd1bGFyOwogICAgfQoK
ICAgIGZvciAodmFyIGkgPSB0eXBlUnVsZXMubGVuZ3RoLCBtaW4gPSAwOyBpID4gbWluOyBpLS0p
IHsKICAgICAgIGluZmxlY3Rpb24gPSB0eXBlUnVsZXNbaS0xXTsKICAgICAgIHJ1bGUgPSBpbmZs
ZWN0aW9uWzBdOwoKICAgICAgaWYgKHJ1bGUudGVzdCh3b3JkKSkgewogICAgICAgIGJyZWFrOwog
ICAgICB9CiAgICB9CgogICAgaW5mbGVjdGlvbiA9IGluZmxlY3Rpb24gfHwgW107CgogICAgcnVs
ZSA9IGluZmxlY3Rpb25bMF07CiAgICBzdWJzdGl0dXRpb24gPSBpbmZsZWN0aW9uWzFdOwoKICAg
IHJlc3VsdCA9IHdvcmQucmVwbGFjZShydWxlLCBzdWJzdGl0dXRpb24pOwoKICAgIHJldHVybiBy
ZXN1bHQ7CiAgfQp9OwoKRW1iZXIuSW5mbGVjdG9yID0gSW5mbGVjdG9yOwoKfSkoKTsKCgoKKGZ1
bmN0aW9uKCkgewpFbWJlci5JbmZsZWN0b3IuZGVmYXVsdFJ1bGVzID0gewogIHBsdXJhbHM6IFsK
ICAgIFsvJC8sICdzJ10sCiAgICBbL3MkL2ksICdzJ10sCiAgICBbL14oYXh8dGVzdClpcyQvaSwg
JyQxZXMnXSwKICAgIFsvKG9jdG9wfHZpcil1cyQvaSwgJyQxaSddLAogICAgWy8ob2N0b3B8dmly
KWkkL2ksICckMWknXSwKICAgIFsvKGFsaWFzfHN0YXR1cykkL2ksICckMWVzJ10sCiAgICBbLyhi
dSlzJC9pLCAnJDFzZXMnXSwKICAgIFsvKGJ1ZmZhbHx0b21hdClvJC9pLCAnJDFvZXMnXSwKICAg
IFsvKFt0aV0pdW0kL2ksICckMWEnXSwKICAgIFsvKFt0aV0pYSQvaSwgJyQxYSddLAogICAgWy9z
aXMkL2ksICdzZXMnXSwKICAgIFsvKD86KFteZl0pZmV8KFtscl0pZikkL2ksICckMSQydmVzJ10s
CiAgICBbLyhoaXZlKSQvaSwgJyQxcyddLAogICAgWy8oW15hZWlvdXldfHF1KXkkL2ksICckMWll
cyddLAogICAgWy8oeHxjaHxzc3xzaCkkL2ksICckMWVzJ10sCiAgICBbLyhtYXRyfHZlcnR8aW5k
KSg/Oml4fGV4KSQvaSwgJyQxaWNlcyddLAogICAgWy9eKG18bClvdXNlJC9pLCAnJDFpY2UnXSwK
ICAgIFsvXihtfGwpaWNlJC9pLCAnJDFpY2UnXSwKICAgIFsvXihveCkkL2ksICckMWVuJ10sCiAg
ICBbL14ob3hlbikkL2ksICckMSddLAogICAgWy8ocXVpeikkL2ksICckMXplcyddCiAgXSwKCiAg
c2luZ3VsYXI6IFsKICAgIFsvcyQvaSwgJyddLAogICAgWy8oc3MpJC9pLCAnJDEnXSwKICAgIFsv
KG4pZXdzJC9pLCAnJDFld3MnXSwKICAgIFsvKFt0aV0pYSQvaSwgJyQxdW0nXSwKICAgIFsvKChh
KW5hbHl8KGIpYXwoZClpYWdub3wocClhcmVudGhlfChwKXJvZ25vfChzKXlub3B8KHQpaGUpKHNp
c3xzZXMpJC9pLCAnJDFzaXMnXSwKICAgIFsvKF5hbmFseSkoc2lzfHNlcykkL2ksICckMXNpcydd
LAogICAgWy8oW15mXSl2ZXMkL2ksICckMWZlJ10sCiAgICBbLyhoaXZlKXMkL2ksICckMSddLAog
ICAgWy8odGl2ZSlzJC9pLCAnJDEnXSwKICAgIFsvKFtscl0pdmVzJC9pLCAnJDFmJ10sCiAgICBb
LyhbXmFlaW91eV18cXUpaWVzJC9pLCAnJDF5J10sCiAgICBbLyhzKWVyaWVzJC9pLCAnJDFlcmll
cyddLAogICAgWy8obSlvdmllcyQvaSwgJyQxb3ZpZSddLAogICAgWy8oeHxjaHxzc3xzaCllcyQv
aSwgJyQxJ10sCiAgICBbL14obXxsKWljZSQvaSwgJyQxb3VzZSddLAogICAgWy8oYnVzKShlcyk/
JC9pLCAnJDEnXSwKICAgIFsvKG8pZXMkL2ksICckMSddLAogICAgWy8oc2hvZSlzJC9pLCAnJDEn
XSwKICAgIFsvKGNyaXN8dGVzdCkoaXN8ZXMpJC9pLCAnJDFpcyddLAogICAgWy9eKGEpeFtpZV1z
JC9pLCAnJDF4aXMnXSwKICAgIFsvKG9jdG9wfHZpcikodXN8aSkkL2ksICckMXVzJ10sCiAgICBb
LyhhbGlhc3xzdGF0dXMpKGVzKT8kL2ksICckMSddLAogICAgWy9eKG94KWVuL2ksICckMSddLAog
ICAgWy8odmVydHxpbmQpaWNlcyQvaSwgJyQxZXgnXSwKICAgIFsvKG1hdHIpaWNlcyQvaSwgJyQx
aXgnXSwKICAgIFsvKHF1aXopemVzJC9pLCAnJDEnXSwKICAgIFsvKGRhdGFiYXNlKXMkL2ksICck
MSddCiAgXSwKCiAgaXJyZWd1bGFyUGFpcnM6IFsKICAgIFsncGVyc29uJywgJ3Blb3BsZSddLAog
ICAgWydtYW4nLCAnbWVuJ10sCiAgICBbJ2NoaWxkJywgJ2NoaWxkcmVuJ10sCiAgICBbJ3NleCcs
ICdzZXhlcyddLAogICAgWydtb3ZlJywgJ21vdmVzJ10sCiAgICBbJ2NvdycsICdraW5lJ10sCiAg
ICBbJ3pvbWJpZScsICd6b21iaWVzJ10KICBdLAoKICB1bmNvdW50YWJsZTogWwogICAgJ2VxdWlw
bWVudCcsCiAgICAnaW5mb3JtYXRpb24nLAogICAgJ3JpY2UnLAogICAgJ21vbmV5JywKICAgICdz
cGVjaWVzJywKICAgICdzZXJpZXMnLAogICAgJ2Zpc2gnLAogICAgJ3NoZWVwJywKICAgICdqZWFu
cycsCiAgICAncG9saWNlJwogIF0KfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKaWYgKEVtYmVy
LkVYVEVORF9QUk9UT1RZUEVTID09PSB0cnVlIHx8IEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTLlN0
cmluZykgewogIC8qKgogICAgU2VlIHt7I2Nyb3NzTGluayAiRW1iZXIuU3RyaW5nL3BsdXJhbGl6
ZSJ9fXt7L2Nyb3NzTGlua319CgogICAgQG1ldGhvZCBwbHVyYWxpemUKICAgIEBmb3IgU3RyaW5n
CiAgKi8KICBTdHJpbmcucHJvdG90eXBlLnBsdXJhbGl6ZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0
dXJuIEVtYmVyLlN0cmluZy5wbHVyYWxpemUodGhpcyk7CiAgfTsKCiAgLyoqCiAgICBTZWUge3sj
Y3Jvc3NMaW5rICJFbWJlci5TdHJpbmcvc2luZ3VsYXJpemUifX17ey9jcm9zc0xpbmt9fQoKICAg
IEBtZXRob2Qgc2luZ3VsYXJpemUKICAgIEBmb3IgU3RyaW5nCiAgKi8KICBTdHJpbmcucHJvdG90
eXBlLnNpbmd1bGFyaXplID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gRW1iZXIuU3RyaW5nLnNp
bmd1bGFyaXplKHRoaXMpOwogIH07Cn0KCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKRW1iZXIuSW5m
bGVjdG9yLmluZmxlY3RvciA9IG5ldyBFbWJlci5JbmZsZWN0b3IoRW1iZXIuSW5mbGVjdG9yLmRl
ZmF1bHRSdWxlcyk7DQoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCihmdW5jdGlvbigp
IHsKLyoqCiAgQG1vZHVsZSBlbWJlci1kYXRhCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0Owp2YXIg
Zm9yRWFjaCA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5mb3JFYWNoOwoKRFMuQWN0aXZlTW9kZWxT
ZXJpYWxpemVyID0gRFMuUkVTVFNlcmlhbGl6ZXIuZXh0ZW5kKHsKICAvLyBTRVJJQUxJWkUKCiAg
LyoqCiAgICBDb252ZXJ0cyBjYW1lbGNhc2VkIGF0dHJpYnV0ZXMgdG8gdW5kZXJzY29yZWQgd2hl
biBzZXJpYWxpemluZy4KCiAgICBAbWV0aG9kIGtleUZvckF0dHJpYnV0ZQogICAgQHBhcmFtIHtT
dHJpbmd9IGF0dHJpYnV0ZQogICAgQHJldHVybnMgU3RyaW5nCiAgKi8KICBrZXlGb3JBdHRyaWJ1
dGU6IGZ1bmN0aW9uKGF0dHIpIHsKICAgIHJldHVybiBFbWJlci5TdHJpbmcuZGVjYW1lbGl6ZShh
dHRyKTsKICB9LAoKICAvKioKICAgIFVuZGVyc2NvcmVzIHJlbGF0aW9uc2hpcCBuYW1lcyBhbmQg
YXBwZW5kcyAiX2lkIiBvciAiX2lkcyIgd2hlbiBzZXJpYWxpemluZwogICAgcmVsYXRpb25zaGlw
IGtleXMuCgogICAgQG1ldGhvZCBrZXlGb3JSZWxhdGlvbnNoaXAKICAgIEBwYXJhbSB7U3RyaW5n
fSBrZXkKICAgIEBwYXJhbSB7U3RyaW5nfSBraW5kCiAgICBAcmV0dXJucyBTdHJpbmcKICAqLwog
IGtleUZvclJlbGF0aW9uc2hpcDogZnVuY3Rpb24oa2V5LCBraW5kKSB7CiAgICBrZXkgPSBFbWJl
ci5TdHJpbmcuZGVjYW1lbGl6ZShrZXkpOwogICAgaWYgKGtpbmQgPT09ICJiZWxvbmdzVG8iKSB7
CiAgICAgIHJldHVybiBrZXkgKyAiX2lkIjsKICAgIH0gZWxzZSBpZiAoa2luZCA9PT0gImhhc01h
bnkiKSB7CiAgICAgIHJldHVybiBFbWJlci5TdHJpbmcuc2luZ3VsYXJpemUoa2V5KSArICJfaWRz
IjsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBrZXk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBE
b2VzIG5vdCBzZXJpYWxpemUgaGFzTWFueSByZWxhdGlvbnNoaXBzIGJ5IGRlZmF1bHQuCiAgKi8K
ICBzZXJpYWxpemVIYXNNYW55OiBFbWJlci5LLAoKICAvKioKICAgIFVuZGVyc2NvcmVzIHRoZSBK
U09OIHJvb3Qga2V5cyB3aGVuIHNlcmlhbGl6aW5nLgoKICAgIEBtZXRob2Qgc2VyaWFsaXplSW50
b0hhc2gKICAgIEBwYXJhbSB7T2JqZWN0fSBoYXNoCiAgICBAcGFyYW0ge3N1YmNsYXNzIG9mIERT
Lk1vZGVsfSB0eXBlCiAgICBAcGFyYW0ge0RTLk1vZGVsfSByZWNvcmQKICAgIEBwYXJhbSB7T2Jq
ZWN0fSBvcHRpb25zCiAgKi8KICBzZXJpYWxpemVJbnRvSGFzaDogZnVuY3Rpb24oZGF0YSwgdHlw
ZSwgcmVjb3JkLCBvcHRpb25zKSB7CiAgICB2YXIgcm9vdCA9IEVtYmVyLlN0cmluZy5kZWNhbWVs
aXplKHR5cGUudHlwZUtleSk7CiAgICBkYXRhW3Jvb3RdID0gdGhpcy5zZXJpYWxpemUocmVjb3Jk
LCBvcHRpb25zKTsKICB9LAoKICAvKioKICAgIFNlcmlhbGl6ZXMgYSBwb2x5bW9ycGhpYyB0eXBl
IGFzIGEgZnVsbHkgY2FwaXRhbGl6ZWQgbW9kZWwgbmFtZS4KCiAgICBAbWV0aG9kIHNlcmlhbGl6
ZVBvbHltb3JwaGljVHlwZQogICAgQHBhcmFtIHtEUy5Nb2RlbH0gcmVjb3JkCiAgICBAcGFyYW0g
e09iamVjdH0ganNvbgogICAgQHBhcmFtIHJlbGF0aW9uc2hpcAogICovCiAgc2VyaWFsaXplUG9s
eW1vcnBoaWNUeXBlOiBmdW5jdGlvbihyZWNvcmQsIGpzb24sIHJlbGF0aW9uc2hpcCkgewogICAg
dmFyIGtleSA9IHJlbGF0aW9uc2hpcC5rZXksCiAgICAgICAgYmVsb25nc1RvID0gZ2V0KHJlY29y
ZCwga2V5KTsKICAgIGtleSA9IHRoaXMua2V5Rm9yQXR0cmlidXRlKGtleSk7CiAgICBqc29uW2tl
eSArICJfdHlwZSJdID0gRW1iZXIuU3RyaW5nLmNhcGl0YWxpemUoYmVsb25nc1RvLmNvbnN0cnVj
dG9yLnR5cGVLZXkpOwogIH0sCgogIC8vIEVYVFJBQ1QKCiAgLyoqCiAgICBFeHRyYWN0cyB0aGUg
bW9kZWwgdHlwZUtleSBmcm9tIHVuZGVyc2NvcmVkIHJvb3Qgb2JqZWN0cy4KCiAgICBAbWV0aG9k
IHR5cGVGb3JSb290CiAgICBAcGFyYW0ge1N0cmluZ30gcm9vdAogICAgQHJldHVybnMgU3RyaW5n
IHRoZSBtb2RlbCdzIHR5cGVLZXkKICAqLwogIHR5cGVGb3JSb290OiBmdW5jdGlvbihyb290KSB7
CiAgICB2YXIgY2FtZWxpemVkID0gRW1iZXIuU3RyaW5nLmNhbWVsaXplKHJvb3QpOwogICAgcmV0
dXJuIEVtYmVyLlN0cmluZy5zaW5ndWxhcml6ZShjYW1lbGl6ZWQpOwogIH0sCgogIC8qKgogICAg
QWRkIGV4dHJhIHN0ZXAgdG8gYERTLlJFU1RTZXJpYWxpemVyLm5vcm1hbGl6ZWAgc28gbGlua3Mg
YXJlCiAgICBub3JtYWxpemVkLgoKICAgIElmIHlvdXIgcGF5bG9hZCBsb29rcyBsaWtlIHRoaXMK
CiAgICBgYGBqcwogICAgewogICAgICAicG9zdCI6IHsKICAgICAgICAiaWQiOiAxLAogICAgICAg
ICJ0aXRsZSI6ICJSYWlscyBpcyBvbWFrYXNlIiwKICAgICAgICAibGlua3MiOiB7ICJmbGFnZ2Vk
X2NvbW1lbnRzIjogImFwaS9jb21tZW50cy9mbGFnZ2VkIiB9CiAgICAgIH0KICAgIH0KICAgIGBg
YAogICAgVGhlIG5vcm1hbGl6ZWQgdmVyc2lvbiB3b3VsZCBsb29rIGxpa2UgdGhpcwoKICAgIGBg
YGpzCiAgICB7CiAgICAgICJwb3N0IjogewogICAgICAgICJpZCI6IDEsCiAgICAgICAgInRpdGxl
IjogIlJhaWxzIGlzIG9tYWthc2UiLAogICAgICAgICJsaW5rcyI6IHsgImZsYWdnZWRDb21tZW50
cyI6ICJhcGkvY29tbWVudHMvZmxhZ2dlZCIgfQogICAgICB9CiAgICB9CiAgICBgYGAKCiAgICBA
bWV0aG9kIG5vcm1hbGl6ZQogICAgQHBhcmFtIHtzdWJjbGFzcyBvZiBEUy5Nb2RlbH0gdHlwZQog
ICAgQHBhcmFtIHtPYmplY3R9IGhhc2gKICAgIEBwYXJhbSB7U3RyaW5nfSBwcm9wCiAgICBAcmV0
dXJucyBPYmplY3QKICAqLwoKICBub3JtYWxpemU6IGZ1bmN0aW9uKHR5cGUsIGhhc2gsIHByb3Ap
IHsKICAgIHRoaXMubm9ybWFsaXplTGlua3MoaGFzaCk7CgogICAgcmV0dXJuIHRoaXMuX3N1cGVy
KHR5cGUsIGhhc2gsIHByb3ApOwogIH0sCgogIC8qKgogICAgQ29udmVydCBgc25ha2VfY2FzZWRg
IGxpbmtzICB0byBgY2FtZWxDYXNlYAoKICAgIEBtZXRob2Qgbm9ybWFsaXplTGlua3MKICAgIEBw
YXJhbSB7T2JqZWN0fSBoYXNoCiAgKi8KCiAgbm9ybWFsaXplTGlua3M6IGZ1bmN0aW9uKGRhdGEp
ewogICAgaWYgKGRhdGEubGlua3MpIHsKICAgICAgdmFyIGxpbmtzID0gZGF0YS5saW5rczsKCiAg
ICAgIGZvciAodmFyIGxpbmsgaW4gbGlua3MpIHsKICAgICAgICB2YXIgY2FtZWxpemVkTGluayA9
IEVtYmVyLlN0cmluZy5jYW1lbGl6ZShsaW5rKTsKCiAgICAgICAgaWYgKGNhbWVsaXplZExpbmsg
IT09IGxpbmspIHsKICAgICAgICAgIGxpbmtzW2NhbWVsaXplZExpbmtdID0gbGlua3NbbGlua107
CiAgICAgICAgICBkZWxldGUgbGlua3NbbGlua107CiAgICAgICAgfQogICAgICB9CiAgICB9CiAg
fSwKCiAgLyoqCiAgICBOb3JtYWxpemUgdGhlIHBvbHltb3JwaGljIHR5cGUgZnJvbSB0aGUgSlNP
Ti4KCiAgICBOb3JtYWxpemU6CiAgICBgYGBqcwogICAgICB7CiAgICAgICAgaWQ6ICIxIgogICAg
ICAgIG1pbmlvbjogeyB0eXBlOiAiZXZpbF9taW5pb24iLCBpZDogIjEyIn0KICAgICAgfQogICAg
YGBgCgogICAgVG86CiAgICBgYGBqcwogICAgICB7CiAgICAgICAgaWQ6ICIxIgogICAgICAgIG1p
bmlvbjogeyB0eXBlOiAiZXZpbE1pbmlvbiIsIGlkOiAiMTIifQogICAgICB9CiAgICBgYGAKCiAg
ICBAbWV0aG9kIG5vcm1hbGl6ZVJlbGF0aW9uc2hpcHMKICAgIEBwcml2YXRlCiAgKi8KICBub3Jt
YWxpemVSZWxhdGlvbnNoaXBzOiBmdW5jdGlvbih0eXBlLCBoYXNoKSB7CiAgICB2YXIgcGF5bG9h
ZEtleSwgcGF5bG9hZDsKCiAgICBpZiAodGhpcy5rZXlGb3JSZWxhdGlvbnNoaXApIHsKICAgICAg
dHlwZS5lYWNoUmVsYXRpb25zaGlwKGZ1bmN0aW9uKGtleSwgcmVsYXRpb25zaGlwKSB7CiAgICAg
ICAgaWYgKHJlbGF0aW9uc2hpcC5vcHRpb25zLnBvbHltb3JwaGljKSB7CiAgICAgICAgICBwYXls
b2FkS2V5ID0gdGhpcy5rZXlGb3JBdHRyaWJ1dGUoa2V5KTsKICAgICAgICAgIHBheWxvYWQgPSBo
YXNoW3BheWxvYWRLZXldOwogICAgICAgICAgaWYgKHBheWxvYWQgJiYgcGF5bG9hZC50eXBlKSB7
CiAgICAgICAgICAgIHBheWxvYWQudHlwZSA9IHRoaXMudHlwZUZvclJvb3QocGF5bG9hZC50eXBl
KTsKICAgICAgICAgIH0gZWxzZSBpZiAocGF5bG9hZCAmJiByZWxhdGlvbnNoaXAua2luZCA9PT0g
Imhhc01hbnkiKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgZm9y
RWFjaChwYXlsb2FkLCBmdW5jdGlvbihzaW5nbGUpIHsKICAgICAgICAgICAgICBzaW5nbGUudHlw
ZSA9IHNlbGYudHlwZUZvclJvb3Qoc2luZ2xlLnR5cGUpOwogICAgICAgICAgICB9KTsKICAgICAg
ICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGF5bG9hZEtleSA9IHRoaXMua2V5Rm9y
UmVsYXRpb25zaGlwKGtleSwgcmVsYXRpb25zaGlwLmtpbmQpOwogICAgICAgICAgcGF5bG9hZCA9
IGhhc2hbcGF5bG9hZEtleV07CiAgICAgICAgfQoKICAgICAgICBoYXNoW2tleV0gPSBwYXlsb2Fk
OwoKICAgICAgICBpZiAoa2V5ICE9PSBwYXlsb2FkS2V5KSB7CiAgICAgICAgICBkZWxldGUgaGFz
aFtwYXlsb2FkS2V5XTsKICAgICAgICB9CiAgICAgIH0sIHRoaXMpOwogICAgfQogIH0KfSk7Cgp9
KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBnZXQgPSBFbWJlci5nZXQ7CnZhciBmb3JFYWNoID0g
RW1iZXIuRW51bWVyYWJsZVV0aWxzLmZvckVhY2g7CgovKioKICBUaGUgRW1iZWRkZWRSZWNvcmRz
TWl4aW4gYWxsb3dzIHlvdSB0byBhZGQgZW1iZWRkZWQgcmVjb3JkIHN1cHBvcnQgdG8geW91cgog
IHNlcmlhbGl6ZXJzLgogIFRvIHNldCB1cCBlbWJlZGRlZCByZWNvcmRzLCB5b3UgaW5jbHVkZSB0
aGUgbWl4aW4gaW50byB0aGUgc2VyaWFsaXplciBhbmQgdGhlbgogIGRlZmluZSB5b3VyIGVtYmVk
ZGVkIHJlbGF0aW9ucy4KCiAgYGBganMKICBBcHAuUG9zdFNlcmlhbGl6ZXIgPSBEUy5BY3RpdmVN
b2RlbFNlcmlhbGl6ZXIuZXh0ZW5kKERTLkVtYmVkZGVkUmVjb3Jkc01peGluLCB7CiAgICBhdHRy
czogewogICAgICBjb21tZW50czoge2VtYmVkZGVkOiAnYWx3YXlzJ30KICAgIH0KICB9KQogIGBg
YAoKICBDdXJyZW50bHkgb25seSBge2VtYmVkZGVkOiAnYWx3YXlzJ31gIHJlY29yZHMgYXJlIHN1
cHBvcnRlZC4KCiAgQGNsYXNzIEVtYmVkZGVkUmVjb3Jkc01peGluCiAgQG5hbWVzcGFjZSBEUwoq
LwpEUy5FbWJlZGRlZFJlY29yZHNNaXhpbiA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CgogIC8qKgog
ICAgU2VyaWFsaXplIGhhcy1tYXkgcmVsYXRpb25zaGlwIHdoZW4gaXQgaXMgY29uZmlndXJlZCBh
cyBlbWJlZGRlZCBvYmplY3RzLgoKICAgIEBtZXRob2Qgc2VyaWFsaXplSGFzTWFueQogICovCiAg
c2VyaWFsaXplSGFzTWFueTogZnVuY3Rpb24ocmVjb3JkLCBqc29uLCByZWxhdGlvbnNoaXApIHsK
ICAgIHZhciBrZXkgICA9IHJlbGF0aW9uc2hpcC5rZXksCiAgICAgICAgYXR0cnMgPSBnZXQodGhp
cywgJ2F0dHJzJyksCiAgICAgICAgZW1iZWQgPSBhdHRycyAmJiBhdHRyc1trZXldICYmIGF0dHJz
W2tleV0uZW1iZWRkZWQgPT09ICdhbHdheXMnOwoKICAgIGlmIChlbWJlZCkgewogICAgICBqc29u
W3RoaXMua2V5Rm9yQXR0cmlidXRlKGtleSldID0gZ2V0KHJlY29yZCwga2V5KS5tYXAoZnVuY3Rp
b24ocmVsYXRpb24pIHsKICAgICAgICB2YXIgZGF0YSA9IHJlbGF0aW9uLnNlcmlhbGl6ZSgpLAog
ICAgICAgICAgICBwcmltYXJ5S2V5ID0gZ2V0KHRoaXMsICdwcmltYXJ5S2V5Jyk7CgogICAgICAg
IGRhdGFbcHJpbWFyeUtleV0gPSBnZXQocmVsYXRpb24sIHByaW1hcnlLZXkpOwoKICAgICAgICBy
ZXR1cm4gZGF0YTsKICAgICAgfSwgdGhpcyk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBFeHRyYWN0
IGVtYmVkZGVkIG9iamVjdHMgb3V0IG9mIHRoZSBwYXlsb2FkIGZvciBhIHNpbmdsZSBvYmplY3QK
ICAgIGFuZCBhZGQgdGhlbSBhcyBzaWRlbG9hZGVkIG9iamVjdHMgaW5zdGVhZC4KCiAgICBAbWV0
aG9kIGV4dHJhY3RTaW5nbGUKICAqLwogIGV4dHJhY3RTaW5nbGU6IGZ1bmN0aW9uKHN0b3JlLCBw
cmltYXJ5VHlwZSwgcGF5bG9hZCwgcmVjb3JkSWQsIHJlcXVlc3RUeXBlKSB7CiAgICB2YXIgcm9v
dCA9IHRoaXMua2V5Rm9yQXR0cmlidXRlKHByaW1hcnlUeXBlLnR5cGVLZXkpLAogICAgICAgIHBh
cnRpYWwgPSBwYXlsb2FkW3Jvb3RdOwoKICAgIHVwZGF0ZVBheWxvYWRXaXRoRW1iZWRkZWQoc3Rv
cmUsIHRoaXMsIHByaW1hcnlUeXBlLCBwYXJ0aWFsLCBwYXlsb2FkKTsKCiAgICByZXR1cm4gdGhp
cy5fc3VwZXIoc3RvcmUsIHByaW1hcnlUeXBlLCBwYXlsb2FkLCByZWNvcmRJZCwgcmVxdWVzdFR5
cGUpOwogIH0sCgogIC8qKgogICAgRXh0cmFjdCBlbWJlZGRlZCBvYmplY3RzIG91dCBvZiBhIHN0
YW5kYXJkIHBheWxvYWQKICAgIGFuZCBhZGQgdGhlbSBhcyBzaWRlbG9hZGVkIG9iamVjdHMgaW5z
dGVhZC4KCiAgICBAbWV0aG9kIGV4dHJhY3RBcnJheQogICovCiAgZXh0cmFjdEFycmF5OiBmdW5j
dGlvbihzdG9yZSwgdHlwZSwgcGF5bG9hZCkgewogICAgdmFyIHJvb3QgPSB0aGlzLmtleUZvckF0
dHJpYnV0ZSh0eXBlLnR5cGVLZXkpLAogICAgICAgIHBhcnRpYWxzID0gcGF5bG9hZFtFbWJlci5T
dHJpbmcucGx1cmFsaXplKHJvb3QpXTsKCiAgICBmb3JFYWNoKHBhcnRpYWxzLCBmdW5jdGlvbihw
YXJ0aWFsKSB7CiAgICAgIHVwZGF0ZVBheWxvYWRXaXRoRW1iZWRkZWQoc3RvcmUsIHRoaXMsIHR5
cGUsIHBhcnRpYWwsIHBheWxvYWQpOwogICAgfSwgdGhpcyk7CgogICAgcmV0dXJuIHRoaXMuX3N1
cGVyKHN0b3JlLCB0eXBlLCBwYXlsb2FkKTsKICB9Cn0pOwoKZnVuY3Rpb24gdXBkYXRlUGF5bG9h
ZFdpdGhFbWJlZGRlZChzdG9yZSwgc2VyaWFsaXplciwgdHlwZSwgcGFydGlhbCwgcGF5bG9hZCkg
ewogIHZhciBhdHRycyA9IGdldChzZXJpYWxpemVyLCAnYXR0cnMnKTsKCiAgaWYgKCFhdHRycykg
ewogICAgcmV0dXJuOwogIH0KCiAgdHlwZS5lYWNoUmVsYXRpb25zaGlwKGZ1bmN0aW9uKGtleSwg
cmVsYXRpb25zaGlwKSB7CiAgICB2YXIgZXhwYW5kZWRLZXksIGVtYmVkZGVkVHlwZUtleSwgYXR0
cmlidXRlLCBpZHMsCiAgICAgICAgY29uZmlnID0gYXR0cnNba2V5XSwKICAgICAgICBzZXJpYWxp
emVyID0gc3RvcmUuc2VyaWFsaXplckZvcihyZWxhdGlvbnNoaXAudHlwZS50eXBlS2V5KSwKICAg
ICAgICBwcmltYXJ5S2V5ID0gZ2V0KHNlcmlhbGl6ZXIsICJwcmltYXJ5S2V5Iik7CgogICAgaWYg
KHJlbGF0aW9uc2hpcC5raW5kICE9PSAiaGFzTWFueSIpIHsKICAgICAgcmV0dXJuOwogICAgfQoK
ICAgIGlmIChjb25maWcgJiYgKGNvbmZpZy5lbWJlZGRlZCA9PT0gJ2Fsd2F5cycgfHwgY29uZmln
LmVtYmVkZGVkID09PSAnbG9hZCcpKSB7CiAgICAgIC8vIHVuZGVyc2NvcmUgZm9yY2VzIHRoZSBl
bWJlZGRlZCByZWNvcmRzIHRvIGJlIHNpZGUgbG9hZGVkLgogICAgICAvLyBpdCBpcyBuZWVkZWQg
d2hlbiBtYWluIHR5cGUgPT09IHJlbGF0aW9uc2hpcC50eXBlCiAgICAgIGVtYmVkZGVkVHlwZUtl
eSA9ICdfJyArIEVtYmVyLlN0cmluZy5wbHVyYWxpemUocmVsYXRpb25zaGlwLnR5cGUudHlwZUtl
eSk7CiAgICAgIGV4cGFuZGVkS2V5ID0gdGhpcy5rZXlGb3JSZWxhdGlvbnNoaXAoa2V5LCByZWxh
dGlvbnNoaXAua2luZCk7CiAgICAgIGF0dHJpYnV0ZSAgPSB0aGlzLmtleUZvckF0dHJpYnV0ZShr
ZXkpOwogICAgICBpZHMgPSBbXTsKCiAgICAgIGlmICghcGFydGlhbFthdHRyaWJ1dGVdKSB7CiAg
ICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBwYXlsb2FkW2VtYmVkZGVkVHlwZUtleV0gPSBw
YXlsb2FkW2VtYmVkZGVkVHlwZUtleV0gfHwgW107CgogICAgICBmb3JFYWNoKHBhcnRpYWxbYXR0
cmlidXRlXSwgZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciBlbWJlZGRlZFR5cGUgPSBzdG9y
ZS5tb2RlbEZvcihyZWxhdGlvbnNoaXAudHlwZS50eXBlS2V5KTsKICAgICAgICB1cGRhdGVQYXls
b2FkV2l0aEVtYmVkZGVkKHN0b3JlLCBzZXJpYWxpemVyLCBlbWJlZGRlZFR5cGUsIGRhdGEsIHBh
eWxvYWQpOwogICAgICAgIGlkcy5wdXNoKGRhdGFbcHJpbWFyeUtleV0pOwogICAgICAgIHBheWxv
YWRbZW1iZWRkZWRUeXBlS2V5XS5wdXNoKGRhdGEpOwogICAgICB9KTsKCiAgICAgIHBhcnRpYWxb
ZXhwYW5kZWRLZXldID0gaWRzOwogICAgICBkZWxldGUgcGFydGlhbFthdHRyaWJ1dGVdOwogICAg
fQogIH0sIHNlcmlhbGl6ZXIpOwp9Cn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVs
ZSBlbWJlci1kYXRhCiovCgp2YXIgZm9yRWFjaCA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5mb3JF
YWNoOwoKLyoqCiAgVGhlIEFjdGl2ZU1vZGVsQWRhcHRlciBpcyBhIHN1YmNsYXNzIG9mIHRoZSBS
RVNUQWRhcHRlciBkZXNpZ25lZCB0byBpbnRlZ3JhdGUKICB3aXRoIGEgSlNPTiBBUEkgdGhhdCB1
c2VzIGFuIHVuZGVyc2NvcmVkIG5hbWluZyBjb252ZW50aW9uIGluc3RlYWQgb2YgY2FtZWxjYXNp
bmcuCiAgSXQgaGFzIGJlZW4gZGVzaWduZWQgdG8gd29yayBvdXQgb2YgdGhlIGJveCB3aXRoIHRo
ZQogIFthY3RpdmVfbW9kZWxfc2VyaWFsaXplcnNdKGh0dHA6Ly9naXRodWIuY29tL3JhaWxzLWFw
aS9hY3RpdmVfbW9kZWxfc2VyaWFsaXplcnMpCiAgUnVieSBnZW0uCgogIFRoaXMgYWRhcHRlciBl
eHRlbmRzIHRoZSBEUy5SRVNUQWRhcHRlciBieSBtYWtpbmcgY29uc2lzdGVudCB1c2Ugb2YgdGhl
IGNhbWVsaXphdGlvbiwKICBkZWNhbWVsaXphdGlvbiBhbmQgcGx1cmFsaXphdGlvbiBtZXRob2Rz
IHRvIG5vcm1hbGl6ZSB0aGUgc2VyaWFsaXplZCBKU09OIGludG8gYQogIGZvcm1hdCB0aGF0IGlz
IGNvbXBhdGlibGUgd2l0aCBhIGNvbnZlbnRpb25hbCBSYWlscyBiYWNrZW5kIGFuZCBFbWJlciBE
YXRhLgoKICAjIyBKU09OIFN0cnVjdHVyZQoKICBUaGUgQWN0aXZlTW9kZWxBZGFwdGVyIGV4cGVj
dHMgdGhlIEpTT04gcmV0dXJuZWQgZnJvbSB5b3VyIHNlcnZlciB0byBmb2xsb3cKICB0aGUgUkVT
VCBhZGFwdGVyIGNvbnZlbnRpb25zIHN1YnN0aXR1dGluZyB1bmRlcnNjb3JlZCBrZXlzIGZvciBj
YW1lbGNhc2VkIG9uZXMuCgogICMjIyBDb252ZW50aW9uYWwgTmFtZXMKCiAgQXR0cmlidXRlIG5h
bWVzIGluIHlvdXIgSlNPTiBwYXlsb2FkIHNob3VsZCBiZSB0aGUgdW5kZXJzY29yZWQgdmVyc2lv
bnMgb2YKICB0aGUgYXR0cmlidXRlcyBpbiB5b3VyIEVtYmVyLmpzIG1vZGVscy4KCiAgRm9yIGV4
YW1wbGUsIGlmIHlvdSBoYXZlIGEgYFBlcnNvbmAgbW9kZWw6CgogIGBgYGpzCiAgQXBwLkZhbW91
c1BlcnNvbiA9IERTLk1vZGVsLmV4dGVuZCh7CiAgICBmaXJzdE5hbWU6IERTLmF0dHIoJ3N0cmlu
ZycpLAogICAgbGFzdE5hbWU6IERTLmF0dHIoJ3N0cmluZycpLAogICAgb2NjdXBhdGlvbjogRFMu
YXR0cignc3RyaW5nJykKICB9KTsKICBgYGAKCiAgVGhlIEpTT04gcmV0dXJuZWQgc2hvdWxkIGxv
b2sgbGlrZSB0aGlzOgoKICBgYGBqcwogIHsKICAgICJmYW1vdXNfcGVyc29uIjogewogICAgICAi
Zmlyc3RfbmFtZSI6ICJCYXJhY2siLAogICAgICAibGFzdF9uYW1lIjogIk9iYW1hIiwKICAgICAg
Im9jY3VwYXRpb24iOiAiUHJlc2lkZW50IgogICAgfQogIH0KICBgYGAKCiAgQGNsYXNzIEFjdGl2
ZU1vZGVsQWRhcHRlcgogIEBjb25zdHJ1Y3RvcgogIEBuYW1lc3BhY2UgRFMKICBAZXh0ZW5kcyBE
Uy5BZGFwdGVyCioqLwoKRFMuQWN0aXZlTW9kZWxBZGFwdGVyID0gRFMuUkVTVEFkYXB0ZXIuZXh0
ZW5kKHsKICBkZWZhdWx0U2VyaWFsaXplcjogJ19hbXMnLAogIC8qKgogICAgVGhlIEFjdGl2ZU1v
ZGVsQWRhcHRlciBvdmVycmlkZXMgdGhlIGBwYXRoRm9yVHlwZWAgbWV0aG9kIHRvIGJ1aWxkCiAg
ICB1bmRlcnNjb3JlZCBVUkxzIGJ5IGRlY2FtZWxpemluZyBhbmQgcGx1cmFsaXppbmcgdGhlIG9i
amVjdCB0eXBlIG5hbWUuCgogICAgYGBganMKICAgICAgdGhpcy5wYXRoRm9yVHlwZSgiZmFtb3Vz
UGVyc29uIik7CiAgICAgIC8vPT4gImZhbW91c19wZW9wbGUiCiAgICBgYGAKCiAgICBAbWV0aG9k
IHBhdGhGb3JUeXBlCiAgICBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAgQHJldHVybnMgU3RyaW5n
CiAgKi8KICBwYXRoRm9yVHlwZTogZnVuY3Rpb24odHlwZSkgewogICAgdmFyIGRlY2FtZWxpemVk
ID0gRW1iZXIuU3RyaW5nLmRlY2FtZWxpemUodHlwZSk7CiAgICByZXR1cm4gRW1iZXIuU3RyaW5n
LnBsdXJhbGl6ZShkZWNhbWVsaXplZCk7CiAgfSwKCiAgLyoqCiAgICBUaGUgQWN0aXZlTW9kZWxB
ZGFwdGVyIG92ZXJyaWRlcyB0aGUgYGFqYXhFcnJvcmAgbWV0aG9kCiAgICB0byByZXR1cm4gYSBE
Uy5JbnZhbGlkRXJyb3IgZm9yIGFsbCA0MjIgVW5wcm9jZXNzYWJsZSBFbnRpdHkKICAgIHJlc3Bv
bnNlcy4KCiAgICBBIDQyMiBIVFRQIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciBnZW5lcmFsbHkg
aW1wbGllcyB0aGF0IHRoZSByZXF1ZXN0CiAgICB3YXMgd2VsbCBmb3JtZWQgYnV0IHRoZSBBUEkg
d2FzIHVuYWJsZSB0byBwcm9jZXNzIGl0IGJlY2F1c2UgdGhlCiAgICBjb250ZW50IHdhcyBub3Qg
c2VtYW50aWNhbGx5IGNvcnJlY3Qgb3IgbWVhbmluZ2Z1bCBwZXIgdGhlIEFQSS4KCiAgICBGb3Ig
bW9yZSBpbmZvcm1hdGlvbiBvbiA0MjIgSFRUUCBFcnJvciBjb2RlIHNlZSAxMS4yIFdlYkRBViBS
RkMgNDkxOAogICAgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzQ5MTgjc2VjdGlvbi0x
MS4yCgogICAgQG1ldGhvZCBhamF4RXJyb3IKICAgIEBwYXJhbSBqcVhIUgogICAgQHJldHVybnMg
ZXJyb3IKICAqLwogIGFqYXhFcnJvcjogZnVuY3Rpb24oanFYSFIpIHsKICAgIHZhciBlcnJvciA9
IHRoaXMuX3N1cGVyKGpxWEhSKTsKCiAgICBpZiAoanFYSFIgJiYganFYSFIuc3RhdHVzID09PSA0
MjIpIHsKICAgICAgdmFyIGpzb25FcnJvcnMgPSBFbWJlci4kLnBhcnNlSlNPTihqcVhIUi5yZXNw
b25zZVRleHQpWyJlcnJvcnMiXSwKICAgICAgICAgIGVycm9ycyA9IHt9OwoKICAgICAgZm9yRWFj
aChFbWJlci5rZXlzKGpzb25FcnJvcnMpLCBmdW5jdGlvbihrZXkpIHsKICAgICAgICBlcnJvcnNb
RW1iZXIuU3RyaW5nLmNhbWVsaXplKGtleSldID0ganNvbkVycm9yc1trZXldOwogICAgICB9KTsK
CiAgICAgIHJldHVybiBuZXcgRFMuSW52YWxpZEVycm9yKGVycm9ycyk7CiAgICB9IGVsc2Ugewog
ICAgICByZXR1cm4gZXJyb3I7CiAgICB9CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsK
Cn0pKCk7CgoKCihmdW5jdGlvbigpIHsKRW1iZXIub25Mb2FkKCdFbWJlci5BcHBsaWNhdGlvbics
IGZ1bmN0aW9uKEFwcGxpY2F0aW9uKSB7CiAgQXBwbGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAg
bmFtZTogImFjdGl2ZU1vZGVsQWRhcHRlciIsCgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29u
dGFpbmVyLCBhcHBsaWNhdGlvbikgewogICAgICBhcHBsaWNhdGlvbi5yZWdpc3Rlcignc2VyaWFs
aXplcjpfYW1zJywgRFMuQWN0aXZlTW9kZWxTZXJpYWxpemVyKTsKICAgICAgYXBwbGljYXRpb24u
cmVnaXN0ZXIoJ2FkYXB0ZXI6X2FtcycsIERTLkFjdGl2ZU1vZGVsQWRhcHRlcik7CiAgICB9CiAg
fSk7Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgp9KSgpOwo=
</content>
  </attachment>
  <attachment>
    <filename>ember.js</filename>
    <filesize>1149896</filesize>
    <author>XWiki.Admin</author>
    <date>1391345074000</date>
    <version>1.1</version>
    <comment/>
    <content>LyohCiAqIEBvdmVydmlldyAgRW1iZXIgLSBKYXZhU2NyaXB0IEFwcGxpY2F0aW9uIEZyYW1ld29y
awogKiBAY29weXJpZ2h0IENvcHlyaWdodCAyMDExLTIwMTQgVGlsZGUgSW5jLiBhbmQgY29udHJp
YnV0b3JzCiAqICAgICAgICAgICAgUG9ydGlvbnMgQ29weXJpZ2h0IDIwMDYtMjAxMSBTdHJvYmUg
SW5jLgogKiAgICAgICAgICAgIFBvcnRpb25zIENvcHlyaWdodCAyMDA4LTIwMTEgQXBwbGUgSW5j
LiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBAbGljZW5zZSAgIExpY2Vuc2VkIHVuZGVyIE1JVCBs
aWNlbnNlCiAqICAgICAgICAgICAgU2VlIGh0dHBzOi8vcmF3LmdpdGh1Yi5jb20vZW1iZXJqcy9l
bWJlci5qcy9tYXN0ZXIvTElDRU5TRQogKiBAdmVyc2lvbiAgIDEuMy4xCiAqLwoKCihmdW5jdGlv
bigpIHsKLypnbG9iYWwgX19mYWlsX18qLwoKLyoqCkVtYmVyIERlYnVnCgpAbW9kdWxlIGVtYmVy
CkBzdWJtb2R1bGUgZW1iZXItZGVidWcKKi8KCi8qKgpAY2xhc3MgRW1iZXIKKi8KCmlmICgndW5k
ZWZpbmVkJyA9PT0gdHlwZW9mIEVtYmVyKSB7CiAgRW1iZXIgPSB7fTsKCiAgaWYgKCd1bmRlZmlu
ZWQnICE9PSB0eXBlb2Ygd2luZG93KSB7CiAgICB3aW5kb3cuRW0gPSB3aW5kb3cuRW1iZXIgPSBF
bSA9IEVtYmVyOwogIH0KfQoKLy8gVGhpcyBuZWVkcyB0byBiZSBrZXB0IGluIHN5bmMgd2l0aCB0
aGUgbG9naWMgaW4KLy8gYHBhY2thZ2VzL2VtYmVyLW1ldGFsL2xpYi9jb3JlLmpzYC4KLy8KLy8g
VGhpcyBpcyBkdXBsaWNhdGVkIGhlcmUgdG8gZW5zdXJlIHRoYXQgYEVtYmVyLkVOVmAKLy8gaXMg
c2V0dXAgZXZlbiBpZiBgRW1iZXJgIGlzIG5vdCBsb2FkZWQgeWV0LgppZiAoRW1iZXIuRU5WKSB7
CiAgLy8gZG8gbm90aGluZyBpZiBFbWJlci5FTlYgaXMgYWxyZWFkeSBzZXR1cAp9IGVsc2UgaWYg
KCd1bmRlZmluZWQnICE9PSB0eXBlb2YgRW1iZXJFTlYpIHsKICBFbWJlci5FTlYgPSBFbWJlckVO
VjsKfSBlbHNlIGlmKCd1bmRlZmluZWQnICE9PSB0eXBlb2YgRU5WKSB7CiAgRW1iZXIuRU5WID0g
RU5WOwp9IGVsc2UgewogIEVtYmVyLkVOViA9IHt9Owp9CgppZiAoISgnTUFOREFUT1JZX1NFVFRF
UicgaW4gRW1iZXIuRU5WKSkgewogIEVtYmVyLkVOVi5NQU5EQVRPUllfU0VUVEVSID0gdHJ1ZTsg
Ly8gZGVmYXVsdCB0byB0cnVlIGZvciBkZWJ1ZyBkaXN0Cn0KCi8qKgogIERlZmluZSBhbiBhc3Nl
cnRpb24gdGhhdCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbiBpZiB0aGUgY29uZGl0aW9uIGlzIG5v
dAogIG1ldC4gRW1iZXIgYnVpbGQgdG9vbHMgd2lsbCByZW1vdmUgYW55IGNhbGxzIHRvIGBFbWJl
ci5hc3NlcnQoKWAgd2hlbgogIGRvaW5nIGEgcHJvZHVjdGlvbiBidWlsZC4gRXhhbXBsZToKCiAg
YGBgamF2YXNjcmlwdAogIC8vIFRlc3QgZm9yIHRydXRoaW5lc3MKICBFbWJlci5hc3NlcnQoJ011
c3QgcGFzcyBhIHZhbGlkIG9iamVjdCcsIG9iaik7CiAgLy8gRmFpbCB1bmNvbmRpdGlvbmFsbHkK
ICBFbWJlci5hc3NlcnQoJ1RoaXMgY29kZSBwYXRoIHNob3VsZCBuZXZlciBiZSBydW4nKQogIGBg
YAoKICBAbWV0aG9kIGFzc2VydAogIEBwYXJhbSB7U3RyaW5nfSBkZXNjIEEgZGVzY3JpcHRpb24g
b2YgdGhlIGFzc2VydGlvbi4gVGhpcyB3aWxsIGJlY29tZQogICAgdGhlIHRleHQgb2YgdGhlIEVy
cm9yIHRocm93biBpZiB0aGUgYXNzZXJ0aW9uIGZhaWxzLgogIEBwYXJhbSB7Qm9vbGVhbn0gdGVz
dCBNdXN0IGJlIHRydXRoeSBmb3IgdGhlIGFzc2VydGlvbiB0byBwYXNzLiBJZgogICAgZmFsc3ks
IGFuIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93bi4KKi8KRW1iZXIuYXNzZXJ0ID0gZnVuY3Rpb24o
ZGVzYywgdGVzdCkgewogIGlmICghdGVzdCkgewogICAgRW1iZXIuTG9nZ2VyLmFzc2VydCh0ZXN0
LCBkZXNjKTsKICB9CgogIGlmIChFbWJlci50ZXN0aW5nICYmICF0ZXN0KSB7CiAgICAvLyB3aGVu
IHRlc3RpbmcsIGVuc3VyZSB0ZXN0IGZhaWx1cmVzIHdoZW4gYXNzZXJ0aW9ucyBmYWlsCiAgICB0
aHJvdyBuZXcgRW1iZXIuRXJyb3IoIkFzc2VydGlvbiBGYWlsZWQ6ICIgKyBkZXNjKTsKICB9Cn07
CgoKLyoqCiAgRGlzcGxheSBhIHdhcm5pbmcgd2l0aCB0aGUgcHJvdmlkZWQgbWVzc2FnZS4gRW1i
ZXIgYnVpbGQgdG9vbHMgd2lsbAogIHJlbW92ZSBhbnkgY2FsbHMgdG8gYEVtYmVyLndhcm4oKWAg
d2hlbiBkb2luZyBhIHByb2R1Y3Rpb24gYnVpbGQuCgogIEBtZXRob2Qgd2FybgogIEBwYXJhbSB7
U3RyaW5nfSBtZXNzYWdlIEEgd2FybmluZyB0byBkaXNwbGF5LgogIEBwYXJhbSB7Qm9vbGVhbn0g
dGVzdCBBbiBvcHRpb25hbCBib29sZWFuLiBJZiBmYWxzeSwgdGhlIHdhcm5pbmcKICAgIHdpbGwg
YmUgZGlzcGxheWVkLgoqLwpFbWJlci53YXJuID0gZnVuY3Rpb24obWVzc2FnZSwgdGVzdCkgewog
IGlmICghdGVzdCkgewogICAgRW1iZXIuTG9nZ2VyLndhcm4oIldBUk5JTkc6ICIrbWVzc2FnZSk7
CiAgICBpZiAoJ3RyYWNlJyBpbiBFbWJlci5Mb2dnZXIpIEVtYmVyLkxvZ2dlci50cmFjZSgpOwog
IH0KfTsKCi8qKgogIERpc3BsYXkgYSBkZWJ1ZyBub3RpY2UuIEVtYmVyIGJ1aWxkIHRvb2xzIHdp
bGwgcmVtb3ZlIGFueSBjYWxscyB0bwogIGBFbWJlci5kZWJ1ZygpYCB3aGVuIGRvaW5nIGEgcHJv
ZHVjdGlvbiBidWlsZC4KCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLmRlYnVnKCJJJ20gYSBkZWJ1
ZyBub3RpY2UhIik7CiAgYGBgCgogIEBtZXRob2QgZGVidWcKICBAcGFyYW0ge1N0cmluZ30gbWVz
c2FnZSBBIGRlYnVnIG1lc3NhZ2UgdG8gZGlzcGxheS4KKi8KRW1iZXIuZGVidWcgPSBmdW5jdGlv
bihtZXNzYWdlKSB7CiAgRW1iZXIuTG9nZ2VyLmRlYnVnKCJERUJVRzogIittZXNzYWdlKTsKfTsK
Ci8qKgogIERpc3BsYXkgYSBkZXByZWNhdGlvbiB3YXJuaW5nIHdpdGggdGhlIHByb3ZpZGVkIG1l
c3NhZ2UgYW5kIGEgc3RhY2sgdHJhY2UKICAoQ2hyb21lIGFuZCBGaXJlZm94IG9ubHkpLiBFbWJl
ciBidWlsZCB0b29scyB3aWxsIHJlbW92ZSBhbnkgY2FsbHMgdG8KICBgRW1iZXIuZGVwcmVjYXRl
KClgIHdoZW4gZG9pbmcgYSBwcm9kdWN0aW9uIGJ1aWxkLgoKICBAbWV0aG9kIGRlcHJlY2F0ZQog
IEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIEEgZGVzY3JpcHRpb24gb2YgdGhlIGRlcHJlY2F0aW9u
LgogIEBwYXJhbSB7Qm9vbGVhbn0gdGVzdCBBbiBvcHRpb25hbCBib29sZWFuLiBJZiBmYWxzeSwg
dGhlIGRlcHJlY2F0aW9uCiAgICB3aWxsIGJlIGRpc3BsYXllZC4KKi8KRW1iZXIuZGVwcmVjYXRl
ID0gZnVuY3Rpb24obWVzc2FnZSwgdGVzdCkgewogIGlmIChFbWJlci5URVNUSU5HX0RFUFJFQ0FU
SU9OKSB7IHJldHVybjsgfQoKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgeyB0ZXN0ID0g
ZmFsc2U7IH0KICBpZiAodGVzdCkgeyByZXR1cm47IH0KCiAgaWYgKEVtYmVyLkVOVi5SQUlTRV9P
Tl9ERVBSRUNBVElPTikgeyB0aHJvdyBuZXcgRW1iZXIuRXJyb3IobWVzc2FnZSk7IH0KCiAgdmFy
IGVycm9yOwoKICAvLyBXaGVuIHVzaW5nIG5ldyBFcnJvciwgd2UgY2FuJ3QgZG8gdGhlIGFyZ3Vt
ZW50cyBjaGVjayBmb3IgQ2hyb21lLiBBbHRlcm5hdGl2ZXMgYXJlIHdlbGNvbWUKICB0cnkgeyBf
X2ZhaWxfXy5mYWlsKCk7IH0gY2F0Y2ggKGUpIHsgZXJyb3IgPSBlOyB9CgogIGlmIChFbWJlci5M
T0dfU1RBQ0tUUkFDRV9PTl9ERVBSRUNBVElPTiAmJiBlcnJvci5zdGFjaykgewogICAgdmFyIHN0
YWNrLCBzdGFja1N0ciA9ICcnOwogICAgaWYgKGVycm9yWydhcmd1bWVudHMnXSkgewogICAgICAv
LyBDaHJvbWUKICAgICAgc3RhY2sgPSBlcnJvci5zdGFjay5yZXBsYWNlKC9eXHMrYXRccysvZ20s
ICcnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlKC9eKFteXChdKz8pKFtcbiRd
KS9nbSwgJ3thbm9ueW1vdXN9KCQxKSQyJykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVw
bGFjZSgvXk9iamVjdC48YW5vbnltb3VzPlxzKlwoKFteXCldKylcKS9nbSwgJ3thbm9ueW1vdXN9
KCQxKScpLnNwbGl0KCdcbicpOwogICAgICBzdGFjay5zaGlmdCgpOwogICAgfSBlbHNlIHsKICAg
ICAgLy8gRmlyZWZveAogICAgICBzdGFjayA9IGVycm9yLnN0YWNrLnJlcGxhY2UoLyg/OlxuQDow
KT9ccyskL20sICcnKS4KICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlKC9eXCgvZ20s
ICd7YW5vbnltb3VzfSgnKS5zcGxpdCgnXG4nKTsKICAgIH0KCiAgICBzdGFja1N0ciA9ICJcbiAg
ICAiICsgc3RhY2suc2xpY2UoMikuam9pbigiXG4gICAgIik7CiAgICBtZXNzYWdlID0gbWVzc2Fn
ZSArIHN0YWNrU3RyOwogIH0KCiAgRW1iZXIuTG9nZ2VyLndhcm4oIkRFUFJFQ0FUSU9OOiAiK21l
c3NhZ2UpOwp9OwoKCgovKioKICBBbGlhcyBhbiBvbGQsIGRlcHJlY2F0ZWQgbWV0aG9kIHdpdGgg
aXRzIG5ldyBjb3VudGVycGFydC4KCiAgRGlzcGxheSBhIGRlcHJlY2F0aW9uIHdhcm5pbmcgd2l0
aCB0aGUgcHJvdmlkZWQgbWVzc2FnZSBhbmQgYSBzdGFjayB0cmFjZQogIChDaHJvbWUgYW5kIEZp
cmVmb3ggb25seSkgd2hlbiB0aGUgYXNzaWduZWQgbWV0aG9kIGlzIGNhbGxlZC4KCiAgRW1iZXIg
YnVpbGQgdG9vbHMgd2lsbCBub3QgcmVtb3ZlIGNhbGxzIHRvIGBFbWJlci5kZXByZWNhdGVGdW5j
KClgLCB0aG91Z2gKICBubyB3YXJuaW5ncyB3aWxsIGJlIHNob3duIGluIHByb2R1Y3Rpb24uCgog
IGBgYGphdmFzY3JpcHQKICBFbWJlci5vbGRNZXRob2QgPSBFbWJlci5kZXByZWNhdGVGdW5jKCJQ
bGVhc2UgdXNlIHRoZSBuZXcsIHVwZGF0ZWQgbWV0aG9kIiwgRW1iZXIubmV3TWV0aG9kKTsKICBg
YGAKCiAgQG1ldGhvZCBkZXByZWNhdGVGdW5jCiAgQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgQSBk
ZXNjcmlwdGlvbiBvZiB0aGUgZGVwcmVjYXRpb24uCiAgQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBU
aGUgbmV3IGZ1bmN0aW9uIGNhbGxlZCB0byByZXBsYWNlIGl0cyBkZXByZWNhdGVkIGNvdW50ZXJw
YXJ0LgogIEByZXR1cm4ge0Z1bmN0aW9ufSBhIG5ldyBmdW5jdGlvbiB0aGF0IHdyYXBwZWQgdGhl
IG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggYSBkZXByZWNhdGlvbiB3YXJuaW5nCiovCkVtYmVyLmRl
cHJlY2F0ZUZ1bmMgPSBmdW5jdGlvbihtZXNzYWdlLCBmdW5jKSB7CiAgcmV0dXJuIGZ1bmN0aW9u
KCkgewogICAgRW1iZXIuZGVwcmVjYXRlKG1lc3NhZ2UpOwogICAgcmV0dXJuIGZ1bmMuYXBwbHko
dGhpcywgYXJndW1lbnRzKTsKICB9Owp9OwoKCi8vIEluZm9ybSB0aGUgZGV2ZWxvcGVyIGFib3V0
IHRoZSBFbWJlciBJbnNwZWN0b3IgaWYgbm90IGluc3RhbGxlZC4KaWYgKCFFbWJlci50ZXN0aW5n
KSB7CiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5jaHJvbWUg
JiYgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVy
KCJsb2FkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5ib2R5ICYmIGRvY3VtZW50
LmJvZHkuZGF0YXNldCAmJiAhZG9jdW1lbnQuYm9keS5kYXRhc2V0LmVtYmVyRXh0ZW5zaW9uKSB7
CiAgICAgICAgRW1iZXIuZGVidWcoJ0ZvciBtb3JlIGFkdmFuY2VkIGRlYnVnZ2luZywgaW5zdGFs
bCB0aGUgRW1iZXIgSW5zcGVjdG9yIGZyb20gaHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJz
dG9yZS9kZXRhaWwvZW1iZXItaW5zcGVjdG9yL2JtZGJsbmNlZ2tlbmthY2llaWhmaHBqZnBwb2Nv
bmhpJyk7CiAgICAgIH0KICAgIH0sIGZhbHNlKTsKICB9Cn0KCn0pKCk7CgovKiEKICogQG92ZXJ2
aWV3ICBFbWJlciAtIEphdmFTY3JpcHQgQXBwbGljYXRpb24gRnJhbWV3b3JrCiAqIEBjb3B5cmln
aHQgQ29weXJpZ2h0IDIwMTEtMjAxNCBUaWxkZSBJbmMuIGFuZCBjb250cmlidXRvcnMKICogICAg
ICAgICAgICBQb3J0aW9ucyBDb3B5cmlnaHQgMjAwNi0yMDExIFN0cm9iZSBJbmMuCiAqICAgICAg
ICAgICAgUG9ydGlvbnMgQ29weXJpZ2h0IDIwMDgtMjAxMSBBcHBsZSBJbmMuIEFsbCByaWdodHMg
cmVzZXJ2ZWQuCiAqIEBsaWNlbnNlICAgTGljZW5zZWQgdW5kZXIgTUlUIGxpY2Vuc2UKICogICAg
ICAgICAgICBTZWUgaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9lbWJlcmpzL2VtYmVyLmpzL21hc3Rl
ci9MSUNFTlNFCiAqIEB2ZXJzaW9uICAgMS4zLjEKICovCgoKKGZ1bmN0aW9uKCkgewp2YXIgZGVm
aW5lLCByZXF1aXJlTW9kdWxlLCByZXF1aXJlLCByZXF1aXJlanM7CgooZnVuY3Rpb24oKSB7CiAg
dmFyIHJlZ2lzdHJ5ID0ge30sIHNlZW4gPSB7fTsKCiAgZGVmaW5lID0gZnVuY3Rpb24obmFtZSwg
ZGVwcywgY2FsbGJhY2spIHsKICAgIHJlZ2lzdHJ5W25hbWVdID0geyBkZXBzOiBkZXBzLCBjYWxs
YmFjazogY2FsbGJhY2sgfTsKICB9OwoKICByZXF1aXJlanMgPSByZXF1aXJlID0gcmVxdWlyZU1v
ZHVsZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICByZXF1aXJlanMuX2Vha19zZWVuID0gcmVnaXN0cnk7
CgogICAgaWYgKHNlZW5bbmFtZV0pIHsgcmV0dXJuIHNlZW5bbmFtZV07IH0KICAgIHNlZW5bbmFt
ZV0gPSB7fTsKCiAgICBpZiAoIXJlZ2lzdHJ5W25hbWVdKSB7CiAgICAgIHRocm93IG5ldyBFcnJv
cigiQ291bGQgbm90IGZpbmQgbW9kdWxlICIgKyBuYW1lKTsKICAgIH0KCiAgICB2YXIgbW9kID0g
cmVnaXN0cnlbbmFtZV0sCiAgICAgICAgZGVwcyA9IG1vZC5kZXBzLAogICAgICAgIGNhbGxiYWNr
ID0gbW9kLmNhbGxiYWNrLAogICAgICAgIHJlaWZpZWQgPSBbXSwKICAgICAgICBleHBvcnRzOwoK
ICAgIGZvciAodmFyIGk9MCwgbD1kZXBzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgaWYgKGRl
cHNbaV0gPT09ICdleHBvcnRzJykgewogICAgICAgIHJlaWZpZWQucHVzaChleHBvcnRzID0ge30p
OwogICAgICB9IGVsc2UgewogICAgICAgIHJlaWZpZWQucHVzaChyZXF1aXJlTW9kdWxlKHJlc29s
dmUoZGVwc1tpXSkpKTsKICAgICAgfQogICAgfQoKICAgIHZhciB2YWx1ZSA9IGNhbGxiYWNrLmFw
cGx5KHRoaXMsIHJlaWZpZWQpOwogICAgcmV0dXJuIHNlZW5bbmFtZV0gPSBleHBvcnRzIHx8IHZh
bHVlOwoKICAgIGZ1bmN0aW9uIHJlc29sdmUoY2hpbGQpIHsKICAgICAgaWYgKGNoaWxkLmNoYXJB
dCgwKSAhPT0gJy4nKSB7IHJldHVybiBjaGlsZDsgfQogICAgICB2YXIgcGFydHMgPSBjaGlsZC5z
cGxpdCgiLyIpOwogICAgICB2YXIgcGFyZW50QmFzZSA9IG5hbWUuc3BsaXQoIi8iKS5zbGljZSgw
LCAtMSk7CgogICAgICBmb3IgKHZhciBpPTAsIGw9cGFydHMubGVuZ3RoOyBpPGw7IGkrKykgewog
ICAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CgogICAgICAgIGlmIChwYXJ0ID09PSAnLi4nKSB7
IHBhcmVudEJhc2UucG9wKCk7IH0KICAgICAgICBlbHNlIGlmIChwYXJ0ID09PSAnLicpIHsgY29u
dGludWU7IH0KICAgICAgICBlbHNlIHsgcGFyZW50QmFzZS5wdXNoKHBhcnQpOyB9CiAgICAgIH0K
CiAgICAgIHJldHVybiBwYXJlbnRCYXNlLmpvaW4oIi8iKTsKICAgIH0KICB9Owp9KSgpOwooZnVu
Y3Rpb24oKSB7Ci8qZ2xvYmFscyBFbTp0cnVlIEVOViBFbWJlckVOViBNZXRhbW9ycGhFTlY6dHJ1
ZSAqLwoKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1tZXRhbAoqLwoKLyoqCiAg
QWxsIEVtYmVyIG1ldGhvZHMgYW5kIGZ1bmN0aW9ucyBhcmUgZGVmaW5lZCBpbnNpZGUgb2YgdGhp
cyBuYW1lc3BhY2UuIFlvdQogIGdlbmVyYWxseSBzaG91bGQgbm90IGFkZCBuZXcgcHJvcGVydGll
cyB0byB0aGlzIG5hbWVzcGFjZSBhcyBpdCBtYXkgYmUKICBvdmVyd3JpdHRlbiBieSBmdXR1cmUg
dmVyc2lvbnMgb2YgRW1iZXIuCgogIFlvdSBjYW4gYWxzbyB1c2UgdGhlIHNob3J0aGFuZCBgRW1g
IGluc3RlYWQgb2YgYEVtYmVyYC4KCiAgRW1iZXItUnVudGltZSBpcyBhIGZyYW1ld29yayB0aGF0
IHByb3ZpZGVzIGNvcmUgZnVuY3Rpb25zIGZvciBFbWJlciBpbmNsdWRpbmcKICBjcm9zcy1wbGF0
Zm9ybSBmdW5jdGlvbnMsIHN1cHBvcnQgZm9yIHByb3BlcnR5IG9ic2VydmluZyBhbmQgb2JqZWN0
cy4gSXRzCiAgZm9jdXMgaXMgb24gc21hbGwgc2l6ZSBhbmQgcGVyZm9ybWFuY2UuIFlvdSBjYW4g
dXNlIHRoaXMgaW4gcGxhY2Ugb2Ygb3IKICBhbG9uZy1zaWRlIG90aGVyIGNyb3NzLXBsYXRmb3Jt
IGxpYnJhcmllcyBzdWNoIGFzIGpRdWVyeS4KCiAgVGhlIGNvcmUgUnVudGltZSBmcmFtZXdvcmsg
aXMgYmFzZWQgb24gdGhlIGpRdWVyeSBBUEkgd2l0aCBhIG51bWJlciBvZgogIHBlcmZvcm1hbmNl
IG9wdGltaXphdGlvbnMuCgogIEBjbGFzcyBFbWJlcgogIEBzdGF0aWMKICBAdmVyc2lvbiAxLjMu
MQoqLwoKaWYgKCd1bmRlZmluZWQnID09PSB0eXBlb2YgRW1iZXIpIHsKICAvLyBDcmVhdGUgY29y
ZSBvYmplY3QuIE1ha2UgaXQgYWN0IGxpa2UgYW4gaW5zdGFuY2Ugb2YgRW1iZXIuTmFtZXNwYWNl
IHNvIHRoYXQKICAvLyBvYmplY3RzIGFzc2lnbmVkIHRvIGl0IGFyZSBnaXZlbiBhIHNhbmUgc3Ry
aW5nIHJlcHJlc2VudGF0aW9uLgogIEVtYmVyID0ge307Cn0KCi8vIERlZmF1bHQgaW1wb3J0cywg
ZXhwb3J0cyBhbmQgbG9va3VwIHRvIHRoZSBnbG9iYWwgb2JqZWN0Owp2YXIgaW1wb3J0cyA9IEVt
YmVyLmltcG9ydHMgPSBFbWJlci5pbXBvcnRzIHx8IHRoaXM7CnZhciBleHBvcnRzID0gRW1iZXIu
ZXhwb3J0cyA9IEVtYmVyLmV4cG9ydHMgfHwgdGhpczsKdmFyIGxvb2t1cCAgPSBFbWJlci5sb29r
dXAgID0gRW1iZXIubG9va3VwICB8fCB0aGlzOwoKLy8gYWxpYXNlcyBuZWVkZWQgdG8ga2VlcCBt
aW5pZmllcnMgZnJvbSByZW1vdmluZyB0aGUgZ2xvYmFsIGNvbnRleHQKZXhwb3J0cy5FbSA9IGV4
cG9ydHMuRW1iZXIgPSBFbSA9IEVtYmVyOwoKLy8gTWFrZSBzdXJlIHRoZXNlIGFyZSBzZXQgd2hl
dGhlciBFbWJlciB3YXMgYWxyZWFkeSBkZWZpbmVkIG9yIG5vdAoKRW1iZXIuaXNOYW1lc3BhY2Ug
PSB0cnVlOwoKRW1iZXIudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsgcmV0dXJuICJFbWJlciI7IH07
CgoKLyoqCiAgQHByb3BlcnR5IFZFUlNJT04KICBAdHlwZSBTdHJpbmcKICBAZGVmYXVsdCAnMS4z
LjEnCiAgQHN0YXRpYwoqLwpFbWJlci5WRVJTSU9OID0gJzEuMy4xJzsKCi8qKgogIFN0YW5kYXJk
IGVudmlyb25tZW50YWwgdmFyaWFibGVzLiBZb3UgY2FuIGRlZmluZSB0aGVzZSBpbiBhIGdsb2Jh
bCBgRW1iZXJFTlZgCiAgdmFyaWFibGUgYmVmb3JlIGxvYWRpbmcgRW1iZXIgdG8gY29udHJvbCB2
YXJpb3VzIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MuCgogIEZvciBiYWNrd2FyZHMgY29tcGF0aWJp
bGl0eSB3aXRoIGVhcmxpZXIgdmVyc2lvbnMgb2YgRW1iZXIgdGhlIGdsb2JhbCBgRU5WYAogIHZh
cmlhYmxlIHdpbGwgYmUgdXNlZCBpZiBgRW1iZXJFTlZgIGlzIG5vdCBkZWZpbmVkLgoKICBAcHJv
cGVydHkgRU5WCiAgQHR5cGUgSGFzaAoqLwoKLy8gVGhpcyBuZWVkcyB0byBiZSBrZXB0IGluIHN5
bmMgd2l0aCB0aGUgbG9naWMgaW4KLy8gYHBhY2thZ2VzL2VtYmVyLWRlYnVnL2xpYi9tYWluLmpz
YC4KaWYgKEVtYmVyLkVOVikgewogIC8vIGRvIG5vdGhpbmcgaWYgRW1iZXIuRU5WIGlzIGFscmVh
ZHkgc2V0dXAKfSBlbHNlIGlmICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIEVtYmVyRU5WKSB7CiAg
RW1iZXIuRU5WID0gRW1iZXJFTlY7Cn0gZWxzZSBpZigndW5kZWZpbmVkJyAhPT0gdHlwZW9mIEVO
VikgewogIEVtYmVyLkVOViA9IEVOVjsKfSBlbHNlIHsKICBFbWJlci5FTlYgPSB7fTsKfQoKRW1i
ZXIuY29uZmlnID0gRW1iZXIuY29uZmlnIHx8IHt9OwoKLy8gV2UgZGlzYWJsZSB0aGUgUkFOR0Ug
QVBJIGJ5IGRlZmF1bHQgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMKaWYgKCd1bmRlZmluZWQnID09
PSB0eXBlb2YgRW1iZXIuRU5WLkRJU0FCTEVfUkFOR0VfQVBJKSB7CiAgRW1iZXIuRU5WLkRJU0FC
TEVfUkFOR0VfQVBJID0gdHJ1ZTsKfQoKaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgTWV0YW1v
cnBoRU5WKSB7CiAgZXhwb3J0cy5NZXRhbW9ycGhFTlYgPSB7fTsKfQoKTWV0YW1vcnBoRU5WLkRJ
U0FCTEVfUkFOR0VfQVBJID0gRW1iZXIuRU5WLkRJU0FCTEVfUkFOR0VfQVBJOwoKLyoqCiAgSGFz
aCBvZiBlbmFibGVkIENhbmFyeSBmZWF0dXJlcy4gQWRkIHRvIGJlZm9yZSBjcmVhdGluZyB5b3Vy
IGFwcGxpY2F0aW9uLgoKICBZb3UgY2FuIGFsc28gZGVmaW5lIGBFTlYuRkVBVFVSRVNgIGlmIHlv
dSBuZWVkIHRvIGVuYWJsZSBmZWF0dXJlcyBmbGFnZ2VkIGF0IHJ1bnRpbWUuCgogIEBwcm9wZXJ0
eSBGRUFUVVJFUwogIEB0eXBlIEhhc2gKKi8KCkVtYmVyLkZFQVRVUkVTID0gRW1iZXIuRU5WLkZF
QVRVUkVTIHx8IHt9OwoKLyoqCiAgVGVzdCB0aGF0IGEgZmVhdHVyZSBpcyBlbmFibGVkLiBQYXJz
ZWQgYnkgRW1iZXIncyBidWlsZCB0b29scyB0byBsZWF2ZQogIGV4cGVyaW1lbnRhbCBmZWF0dXJl
cyBvdXQgb2YgYmV0YS9zdGFibGUgYnVpbGRzLgoKICBZb3UgY2FuIGRlZmluZSB0aGUgZm9sbG93
aW5nIGNvbmZpZ3VyYXRpb24gb3B0aW9uczoKCiAgKiBgRU5WLkVOQUJMRV9BTExfRkVBVFVSRVNg
IC0gZm9yY2UgYWxsIGZlYXR1cmVzIHRvIGJlIGVuYWJsZWQuCiAgKiBgRU5WLkVOQUJMRV9PUFRJ
T05BTF9GRUFUVVJFU2AgLSBlbmFibGUgYW55IGZlYXR1cmVzIHRoYXQgaGF2ZSBub3QgYmVlbiBl
eHBsaWNpdGx5CiAgICBlbmFibGVkL2Rpc2FibGVkLgoKICBAbWV0aG9kIGlzRW5hYmxlZAogIEBw
YXJhbSB7c3RyaW5nfSBmZWF0dXJlCiovCgpFbWJlci5GRUFUVVJFUy5pc0VuYWJsZWQgPSBmdW5j
dGlvbihmZWF0dXJlKSB7CiAgdmFyIGZlYXR1cmVWYWx1ZSA9IEVtYmVyLkZFQVRVUkVTW2ZlYXR1
cmVdOwoKICBpZiAoRW1iZXIuRU5WLkVOQUJMRV9BTExfRkVBVFVSRVMpIHsKICAgIHJldHVybiB0
cnVlOwogIH0gZWxzZSBpZiAoZmVhdHVyZVZhbHVlID09PSB0cnVlIHx8IGZlYXR1cmVWYWx1ZSA9
PT0gZmFsc2UgfHwgZmVhdHVyZVZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBmZWF0
dXJlVmFsdWU7CiAgfSBlbHNlIGlmIChFbWJlci5FTlYuRU5BQkxFX09QVElPTkFMX0ZFQVRVUkVT
KSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfTsK
Ci8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4KLy8gQk9PVFNUUkFQCi8vCgovKioKICBEZXRlcm1pbmVzIHdoZXRoZXIgRW1iZXIgc2hv
dWxkIGVuaGFuY2VzIHNvbWUgYnVpbHQtaW4gb2JqZWN0IHByb3RvdHlwZXMgdG8KICBwcm92aWRl
IGEgbW9yZSBmcmllbmRseSBBUEkuIElmIGVuYWJsZWQsIGEgZmV3IG1ldGhvZHMgd2lsbCBiZSBh
ZGRlZCB0bwogIGBGdW5jdGlvbmAsIGBTdHJpbmdgLCBhbmQgYEFycmF5YC4gYE9iamVjdC5wcm90
b3R5cGVgIHdpbGwgbm90IGJlIGVuaGFuY2VkLAogIHdoaWNoIGlzIHRoZSBvbmUgdGhhdCBjYXVz
ZXMgbW9zdCB0cm91YmxlIGZvciBwZW9wbGUuCgogIEluIGdlbmVyYWwgd2UgcmVjb21tZW5kIGxl
YXZpbmcgdGhpcyBvcHRpb24gc2V0IHRvIHRydWUgc2luY2UgaXQgcmFyZWx5CiAgY29uZmxpY3Rz
IHdpdGggb3RoZXIgY29kZS4gSWYgeW91IG5lZWQgdG8gdHVybiBpdCBvZmYgaG93ZXZlciwgeW91
IGNhbgogIGRlZmluZSBhbiBgRU5WLkVYVEVORF9QUk9UT1RZUEVTYCBjb25maWcgdG8gZGlzYWJs
ZSBpdC4KCiAgQHByb3BlcnR5IEVYVEVORF9QUk9UT1RZUEVTCiAgQHR5cGUgQm9vbGVhbgogIEBk
ZWZhdWx0IHRydWUKKi8KRW1iZXIuRVhURU5EX1BST1RPVFlQRVMgPSBFbWJlci5FTlYuRVhURU5E
X1BST1RPVFlQRVM7CgppZiAodHlwZW9mIEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTID09PSAndW5k
ZWZpbmVkJykgewogIEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTID0gdHJ1ZTsKfQoKLyoqCiAgRGV0
ZXJtaW5lcyB3aGV0aGVyIEVtYmVyIGxvZ3MgYSBmdWxsIHN0YWNrIHRyYWNlIGR1cmluZyBkZXBy
ZWNhdGlvbiB3YXJuaW5ncwoKICBAcHJvcGVydHkgTE9HX1NUQUNLVFJBQ0VfT05fREVQUkVDQVRJ
T04KICBAdHlwZSBCb29sZWFuCiAgQGRlZmF1bHQgdHJ1ZQoqLwpFbWJlci5MT0dfU1RBQ0tUUkFD
RV9PTl9ERVBSRUNBVElPTiA9IChFbWJlci5FTlYuTE9HX1NUQUNLVFJBQ0VfT05fREVQUkVDQVRJ
T04gIT09IGZhbHNlKTsKCi8qKgogIERldGVybWluZXMgd2hldGhlciBFbWJlciBzaG91bGQgYWRk
IEVDTUFTY3JpcHQgNSBzaGltcyB0byBvbGRlciBicm93c2Vycy4KCiAgQHByb3BlcnR5IFNISU1f
RVM1CiAgQHR5cGUgQm9vbGVhbgogIEBkZWZhdWx0IEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTCiov
CkVtYmVyLlNISU1fRVM1ID0gKEVtYmVyLkVOVi5TSElNX0VTNSA9PT0gZmFsc2UpID8gZmFsc2Ug
OiBFbWJlci5FWFRFTkRfUFJPVE9UWVBFUzsKCi8qKgogIERldGVybWluZXMgd2hldGhlciBFbWJl
ciBsb2dzIGluZm8gYWJvdXQgdmVyc2lvbiBvZiB1c2VkIGxpYnJhcmllcwoKICBAcHJvcGVydHkg
TE9HX1ZFUlNJT04KICBAdHlwZSBCb29sZWFuCiAgQGRlZmF1bHQgdHJ1ZQoqLwpFbWJlci5MT0df
VkVSU0lPTiA9IChFbWJlci5FTlYuTE9HX1ZFUlNJT04gPT09IGZhbHNlKSA/IGZhbHNlIDogdHJ1
ZTsKCi8qKgogIEVtcHR5IGZ1bmN0aW9uLiBVc2VmdWwgZm9yIHNvbWUgb3BlcmF0aW9ucy4gQWx3
YXlzIHJldHVybnMgYHRoaXNgLgoKICBAbWV0aG9kIEsKICBAcHJpdmF0ZQogIEByZXR1cm4ge09i
amVjdH0KKi8KRW1iZXIuSyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfTsKCgovLyBTdHVi
IG91dCB0aGUgbWV0aG9kcyBkZWZpbmVkIGJ5IHRoZSBlbWJlci1kZWJ1ZyBwYWNrYWdlIGluIGNh
c2UgaXQncyBub3QgbG9hZGVkCgppZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBFbWJlci5hc3Nl
cnQpIHsgRW1iZXIuYXNzZXJ0ID0gRW1iZXIuSzsgfQppZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVv
ZiBFbWJlci53YXJuKSB7IEVtYmVyLndhcm4gPSBFbWJlci5LOyB9CmlmICgndW5kZWZpbmVkJyA9
PT0gdHlwZW9mIEVtYmVyLmRlYnVnKSB7IEVtYmVyLmRlYnVnID0gRW1iZXIuSzsgfQppZiAoJ3Vu
ZGVmaW5lZCcgPT09IHR5cGVvZiBFbWJlci5kZXByZWNhdGUpIHsgRW1iZXIuZGVwcmVjYXRlID0g
RW1iZXIuSzsgfQppZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBFbWJlci5kZXByZWNhdGVGdW5j
KSB7CiAgRW1iZXIuZGVwcmVjYXRlRnVuYyA9IGZ1bmN0aW9uKF8sIGZ1bmMpIHsgcmV0dXJuIGZ1
bmM7IH07Cn0KCi8qKgogIFByZXZpb3VzbHkgd2UgdXNlZCBgRW1iZXIuJC51dWlkYCwgaG93ZXZl
ciBgJC51dWlkYCBoYXMgYmVlbiByZW1vdmVkIGZyb20KICBqUXVlcnkgbWFzdGVyLiBXZSdsbCBq
dXN0IGJvb3RzdHJhcCBvdXIgb3duIHV1aWQgbm93LgoKICBAcHJvcGVydHkgdXVpZAogIEB0eXBl
IE51bWJlcgogIEBwcml2YXRlCiovCkVtYmVyLnV1aWQgPSAwOwoKLyoqCiAgTWVyZ2UgdGhlIGNv
bnRlbnRzIG9mIHR3byBvYmplY3RzIHRvZ2V0aGVyIGludG8gdGhlIGZpcnN0IG9iamVjdC4KCiAg
YGBgamF2YXNjcmlwdAogIEVtYmVyLm1lcmdlKHtmaXJzdDogJ1RvbSd9LCB7bGFzdDogJ0RhbGUn
fSk7IC8vIHtmaXJzdDogJ1RvbScsIGxhc3Q6ICdEYWxlJ30KICB2YXIgYSA9IHtmaXJzdDogJ1ll
aHVkYSd9LCBiID0ge2xhc3Q6ICdLYXR6J307CiAgRW1iZXIubWVyZ2UoYSwgYik7IC8vIGEgPT0g
e2ZpcnN0OiAnWWVodWRhJywgbGFzdDogJ0thdHonfSwgYiA9PSB7bGFzdDogJ0thdHonfQogIGBg
YAoKICBAbWV0aG9kIG1lcmdlCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7T2JqZWN0fSBvcmlnaW5h
bCBUaGUgb2JqZWN0IHRvIG1lcmdlIGludG8KICBAcGFyYW0ge09iamVjdH0gdXBkYXRlcyBUaGUg
b2JqZWN0IHRvIGNvcHkgcHJvcGVydGllcyBmcm9tCiAgQHJldHVybiB7T2JqZWN0fQoqLwpFbWJl
ci5tZXJnZSA9IGZ1bmN0aW9uKG9yaWdpbmFsLCB1cGRhdGVzKSB7CiAgZm9yICh2YXIgcHJvcCBp
biB1cGRhdGVzKSB7CiAgICBpZiAoIXVwZGF0ZXMuaGFzT3duUHJvcGVydHkocHJvcCkpIHsgY29u
dGludWU7IH0KICAgIG9yaWdpbmFsW3Byb3BdID0gdXBkYXRlc1twcm9wXTsKICB9CiAgcmV0dXJu
IG9yaWdpbmFsOwp9OwoKLyoqCiAgUmV0dXJucyB0cnVlIGlmIHRoZSBwYXNzZWQgdmFsdWUgaXMg
bnVsbCBvciB1bmRlZmluZWQuIFRoaXMgYXZvaWRzIGVycm9ycwogIGZyb20gSlNMaW50IGNvbXBs
YWluaW5nIGFib3V0IHVzZSBvZiA9PSwgd2hpY2ggY2FuIGJlIHRlY2huaWNhbGx5CiAgY29uZnVz
aW5nLgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuaXNOb25lKCk7ICAgICAgICAgICAgICAvLyB0
cnVlCiAgRW1iZXIuaXNOb25lKG51bGwpOyAgICAgICAgICAvLyB0cnVlCiAgRW1iZXIuaXNOb25l
KHVuZGVmaW5lZCk7ICAgICAvLyB0cnVlCiAgRW1iZXIuaXNOb25lKCcnKTsgICAgICAgICAgICAv
LyBmYWxzZQogIEVtYmVyLmlzTm9uZShbXSk7ICAgICAgICAgICAgLy8gZmFsc2UKICBFbWJlci5p
c05vbmUoZnVuY3Rpb24oKSB7fSk7ICAvLyBmYWxzZQogIGBgYAoKICBAbWV0aG9kIGlzTm9uZQog
IEBmb3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gb2JqIFZhbHVlIHRvIHRlc3QKICBAcmV0dXJu
IHtCb29sZWFufQoqLwpFbWJlci5pc05vbmUgPSBmdW5jdGlvbihvYmopIHsKICByZXR1cm4gb2Jq
ID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkOwp9OwpFbWJlci5ub25lID0gRW1iZXIuZGVw
cmVjYXRlRnVuYygiRW1iZXIubm9uZSBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIEVtYmVyLmlz
Tm9uZSBpbnN0ZWFkLiIsIEVtYmVyLmlzTm9uZSk7CgovKioKICBWZXJpZmllcyB0aGF0IGEgdmFs
dWUgaXMgYG51bGxgIG9yIGFuIGVtcHR5IHN0cmluZywgZW1wdHkgYXJyYXksCiAgb3IgZW1wdHkg
ZnVuY3Rpb24uCgogIENvbnN0cmFpbnMgdGhlIHJ1bGVzIG9uIGBFbWJlci5pc05vbmVgIGJ5IHJl
dHVybmluZyBmYWxzZSBmb3IgZW1wdHkKICBzdHJpbmcgYW5kIGVtcHR5IGFycmF5cy4KCiAgYGBg
amF2YXNjcmlwdAogIEVtYmVyLmlzRW1wdHkoKTsgICAgICAgICAgICAgICAgLy8gdHJ1ZQogIEVt
YmVyLmlzRW1wdHkobnVsbCk7ICAgICAgICAgICAgLy8gdHJ1ZQogIEVtYmVyLmlzRW1wdHkodW5k
ZWZpbmVkKTsgICAgICAgLy8gdHJ1ZQogIEVtYmVyLmlzRW1wdHkoJycpOyAgICAgICAgICAgICAg
Ly8gdHJ1ZQogIEVtYmVyLmlzRW1wdHkoW10pOyAgICAgICAgICAgICAgLy8gdHJ1ZQogIEVtYmVy
LmlzRW1wdHkoJ0FkYW0gSGF3a2lucycpOyAgLy8gZmFsc2UKICBFbWJlci5pc0VtcHR5KFswLDEs
Ml0pOyAgICAgICAgIC8vIGZhbHNlCiAgYGBgCgogIEBtZXRob2QgaXNFbXB0eQogIEBmb3IgRW1i
ZXIKICBAcGFyYW0ge09iamVjdH0gb2JqIFZhbHVlIHRvIHRlc3QKICBAcmV0dXJuIHtCb29sZWFu
fQoqLwpFbWJlci5pc0VtcHR5ID0gZnVuY3Rpb24ob2JqKSB7CiAgcmV0dXJuIEVtYmVyLmlzTm9u
ZShvYmopIHx8IChvYmoubGVuZ3RoID09PSAwICYmIHR5cGVvZiBvYmogIT09ICdmdW5jdGlvbicp
IHx8ICh0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBFbWJlci5nZXQob2JqLCAnbGVuZ3RoJykg
PT09IDApOwp9OwpFbWJlci5lbXB0eSA9IEVtYmVyLmRlcHJlY2F0ZUZ1bmMoIkVtYmVyLmVtcHR5
IGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgRW1iZXIuaXNFbXB0eSBpbnN0ZWFkLiIsIEVtYmVy
LmlzRW1wdHkpIDsKCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qZ2xvYmFscyBOb2RlICovCi8q
KgpAbW9kdWxlIGVtYmVyLW1ldGFsCiovCgovKioKICBQbGF0Zm9ybSBzcGVjaWZpYyBtZXRob2Rz
IGFuZCBmZWF0dXJlIGRldGVjdG9ycyBuZWVkZWQgYnkgdGhlIGZyYW1ld29yay4KCiAgQGNsYXNz
IHBsYXRmb3JtCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBzdGF0aWMKKi8KdmFyIHBsYXRmb3JtID0g
RW1iZXIucGxhdGZvcm0gPSB7fTsKCgovKioKICBJZGVudGljYWwgdG8gYE9iamVjdC5jcmVhdGUo
KWAuIEltcGxlbWVudHMgaWYgbm90IGF2YWlsYWJsZSBuYXRpdmVseS4KCiAgQG1ldGhvZCBjcmVh
dGUKICBAZm9yIEVtYmVyCiovCkVtYmVyLmNyZWF0ZSA9IE9iamVjdC5jcmVhdGU7CgovLyBJRTgg
aGFzIE9iamVjdC5jcmVhdGUgYnV0IGl0IGNvdWxkbid0IHRyZWF0IHByb3BlcnR5IGRlc2NyaXB0
b3JzLgppZiAoRW1iZXIuY3JlYXRlKSB7CiAgaWYgKEVtYmVyLmNyZWF0ZSh7YTogMX0sIHthOiB7
dmFsdWU6IDJ9fSkuYSAhPT0gMikgewogICAgRW1iZXIuY3JlYXRlID0gbnVsbDsKICB9Cn0KCi8v
IFNUVUJfT0JKRUNUX0NSRUFURSBhbGxvd3MgdXMgdG8gb3ZlcnJpZGUgb3RoZXIgbGlicmFyaWVz
IHRoYXQgc3R1YgovLyBPYmplY3QuY3JlYXRlIGRpZmZlcmVudCB0aGFuIHdlIHdvdWxkIHByZWZl
cgppZiAoIUVtYmVyLmNyZWF0ZSB8fCBFbWJlci5FTlYuU1RVQl9PQkpFQ1RfQ1JFQVRFKSB7CiAg
dmFyIEsgPSBmdW5jdGlvbigpIHt9OwoKICBFbWJlci5jcmVhdGUgPSBmdW5jdGlvbihvYmosIHBy
b3BzKSB7CiAgICBLLnByb3RvdHlwZSA9IG9iajsKICAgIG9iaiA9IG5ldyBLKCk7CiAgICBpZiAo
cHJvcHMpIHsKICAgICAgSy5wcm90b3R5cGUgPSBvYmo7CiAgICAgIGZvciAodmFyIHByb3AgaW4g
cHJvcHMpIHsKICAgICAgICBLLnByb3RvdHlwZVtwcm9wXSA9IHByb3BzW3Byb3BdLnZhbHVlOwog
ICAgICB9CiAgICAgIG9iaiA9IG5ldyBLKCk7CiAgICB9CiAgICBLLnByb3RvdHlwZSA9IG51bGw7
CgogICAgcmV0dXJuIG9iajsKICB9OwoKICBFbWJlci5jcmVhdGUuaXNTaW11bGF0ZWQgPSB0cnVl
Owp9Cgp2YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CnZhciBjYW5S
ZWRlZmluZVByb3BlcnRpZXMsIGNhbkRlZmluZVByb3BlcnR5T25ET007CgovLyBDYXRjaCBJRTgg
d2hlcmUgT2JqZWN0LmRlZmluZVByb3BlcnR5IGV4aXN0cyBidXQgb25seSB3b3JrcyBvbiBET00g
ZWxlbWVudHMKaWYgKGRlZmluZVByb3BlcnR5KSB7CiAgdHJ5IHsKICAgIGRlZmluZVByb3BlcnR5
KHt9LCAnYScse2dldDpmdW5jdGlvbigpIHt9fSk7CiAgfSBjYXRjaCAoZSkgewogICAgZGVmaW5l
UHJvcGVydHkgPSBudWxsOwogIH0KfQoKaWYgKGRlZmluZVByb3BlcnR5KSB7CiAgLy8gRGV0ZWN0
cyBhIGJ1ZyBpbiBBbmRyb2lkIDwzLjIgd2hlcmUgeW91IGNhbm5vdCByZWRlZmluZSBhIHByb3Bl
cnR5IHVzaW5nCiAgLy8gT2JqZWN0LmRlZmluZVByb3BlcnR5IG9uY2UgYWNjZXNzb3JzIGhhdmUg
YWxyZWFkeSBiZWVuIHNldC4KICBjYW5SZWRlZmluZVByb3BlcnRpZXMgPSAoZnVuY3Rpb24oKSB7
CiAgICB2YXIgb2JqID0ge307CgogICAgZGVmaW5lUHJvcGVydHkob2JqLCAnYScsIHsKICAgICAg
Y29uZmlndXJhYmxlOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1
bmN0aW9uKCkgeyB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKCkgeyB9CiAgICB9KTsKCiAgICBkZWZp
bmVQcm9wZXJ0eShvYmosICdhJywgewogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGVu
dW1lcmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogdHJ1ZQog
ICAgfSk7CgogICAgcmV0dXJuIG9iai5hID09PSB0cnVlOwogIH0pKCk7CgogIC8vIFRoaXMgaXMg
Zm9yIFNhZmFyaSA1LjAsIHdoaWNoIHN1cHBvcnRzIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgYnV0
IG5vdAogIC8vIG9uIERPTSBub2Rlcy4KICBjYW5EZWZpbmVQcm9wZXJ0eU9uRE9NID0gKGZ1bmN0
aW9uKCkgewogICAgdHJ5IHsKICAgICAgZGVmaW5lUHJvcGVydHkoZG9jdW1lbnQuY3JlYXRlRWxl
bWVudCgnZGl2JyksICdkZWZpbmVQcm9wZXJ0eU9uRE9NJywge30pOwogICAgICByZXR1cm4gdHJ1
ZTsKICAgIH0gY2F0Y2goZSkgeyB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0pKCk7CgogIGlmICgh
Y2FuUmVkZWZpbmVQcm9wZXJ0aWVzKSB7CiAgICBkZWZpbmVQcm9wZXJ0eSA9IG51bGw7CiAgfSBl
bHNlIGlmICghY2FuRGVmaW5lUHJvcGVydHlPbkRPTSkgewogICAgZGVmaW5lUHJvcGVydHkgPSBm
dW5jdGlvbihvYmosIGtleU5hbWUsIGRlc2MpIHsKICAgICAgdmFyIGlzTm9kZTsKCiAgICAgIGlm
ICh0eXBlb2YgTm9kZSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBpc05vZGUgPSBvYmogaW5zdGFu
Y2VvZiBOb2RlOwogICAgICB9IGVsc2UgewogICAgICAgIGlzTm9kZSA9IHR5cGVvZiBvYmogPT09
ICJvYmplY3QiICYmIHR5cGVvZiBvYmoubm9kZVR5cGUgPT09ICJudW1iZXIiICYmIHR5cGVvZiBv
Ymoubm9kZU5hbWUgPT09ICJzdHJpbmciOwogICAgICB9CgogICAgICBpZiAoaXNOb2RlKSB7CiAg
ICAgICAgLy8gVE9ETzogU2hvdWxkIHdlIGhhdmUgYSB3YXJuaW5nIGhlcmU/CiAgICAgICAgcmV0
dXJuIChvYmpba2V5TmFtZV0gPSBkZXNjLnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBy
ZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5TmFtZSwgZGVzYyk7CiAgICAgIH0K
ICAgIH07CiAgfQp9CgovKioKQGNsYXNzIHBsYXRmb3JtCkBuYW1lc3BhY2UgRW1iZXIKKi8KCi8q
KgogIElkZW50aWNhbCB0byBgT2JqZWN0LmRlZmluZVByb3BlcnR5KClgLiBJbXBsZW1lbnRzIGFz
IG11Y2ggZnVuY3Rpb25hbGl0eQogIGFzIHBvc3NpYmxlIGlmIG5vdCBhdmFpbGFibGUgbmF0aXZl
bHkuCgogIEBtZXRob2QgZGVmaW5lUHJvcGVydHkKICBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBv
YmplY3QgdG8gbW9kaWZ5CiAgQHBhcmFtIHtTdHJpbmd9IGtleU5hbWUgcHJvcGVydHkgbmFtZSB0
byBtb2RpZnkKICBAcGFyYW0ge09iamVjdH0gZGVzYyBkZXNjcmlwdG9yIGhhc2gKICBAcmV0dXJu
IHt2b2lkfQoqLwpwbGF0Zm9ybS5kZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5OwoKLyoq
CiAgU2V0IHRvIHRydWUgaWYgdGhlIHBsYXRmb3JtIHN1cHBvcnRzIG5hdGl2ZSBnZXR0ZXJzIGFu
ZCBzZXR0ZXJzLgoKICBAcHJvcGVydHkgaGFzUHJvcGVydHlBY2Nlc3NvcnMKICBAZmluYWwKKi8K
cGxhdGZvcm0uaGFzUHJvcGVydHlBY2Nlc3NvcnMgPSB0cnVlOwoKaWYgKCFwbGF0Zm9ybS5kZWZp
bmVQcm9wZXJ0eSkgewogIHBsYXRmb3JtLmhhc1Byb3BlcnR5QWNjZXNzb3JzID0gZmFsc2U7Cgog
IHBsYXRmb3JtLmRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24ob2JqLCBrZXlOYW1lLCBkZXNjKSB7
CiAgICBpZiAoIWRlc2MuZ2V0KSB7IG9ialtrZXlOYW1lXSA9IGRlc2MudmFsdWU7IH0KICB9OwoK
ICBwbGF0Zm9ybS5kZWZpbmVQcm9wZXJ0eS5pc1NpbXVsYXRlZCA9IHRydWU7Cn0KCmlmIChFbWJl
ci5FTlYuTUFOREFUT1JZX1NFVFRFUiAmJiAhcGxhdGZvcm0uaGFzUHJvcGVydHlBY2Nlc3NvcnMp
IHsKICBFbWJlci5FTlYuTUFOREFUT1JZX1NFVFRFUiA9IGZhbHNlOwp9Cgp9KSgpOwoKCgooZnVu
Y3Rpb24oKSB7Ci8qanNoaW50IG5ld2NhcDpmYWxzZSovCi8qKgpAbW9kdWxlIGVtYmVyLW1ldGFs
CiovCgovLyBOT1RFOiBUaGVyZSBpcyBhIGJ1ZyBpbiBqc2hpbnQgdGhhdCBkb2Vzbid0IHJlY29n
bml6ZSBgT2JqZWN0KClgIHdpdGhvdXQgYG5ld2AKLy8gYXMgYmVpbmcgb2sgdW5sZXNzIGJvdGgg
YG5ld2NhcDpmYWxzZWAgYW5kIG5vdCBgdXNlIHN0cmljdGAuCi8vIGh0dHBzOi8vZ2l0aHViLmNv
bS9qc2hpbnQvanNoaW50L2lzc3Vlcy8zOTIKCi8vIFRlc3RpbmcgdGhpcyBpcyBub3QgaWRlYWws
IGJ1dCB3ZSB3YW50IHRvIHVzZSBuYXRpdmUgZnVuY3Rpb25zCi8vIGlmIGF2YWlsYWJsZSwgYnV0
IG5vdCB0byB1c2UgdmVyc2lvbnMgY3JlYXRlZCBieSBsaWJyYXJpZXMgbGlrZSBQcm90b3R5cGUK
dmFyIGlzTmF0aXZlRnVuYyA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAvLyBUaGlzIHNob3VsZCBwcm9i
YWJseSB3b3JrIGluIGFsbCBicm93c2VycyBsaWtlbHkgdG8gaGF2ZSBFUzUgYXJyYXkgbWV0aG9k
cwogIHJldHVybiBmdW5jICYmIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGZ1bmMp
LmluZGV4T2YoJ1tuYXRpdmUgY29kZV0nKSA+IC0xOwp9OwoKLy8gRnJvbTogaHR0cHM6Ly9kZXZl
bG9wZXIubW96aWxsYS5vcmcvZW4vSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMv
YXJyYXkvbWFwCnZhciBhcnJheU1hcCA9IGlzTmF0aXZlRnVuYyhBcnJheS5wcm90b3R5cGUubWFw
KSA/IEFycmF5LnByb3RvdHlwZS5tYXAgOiBmdW5jdGlvbihmdW4gLyosIHRoaXNwICovKSB7CiAg
Ly8idXNlIHN0cmljdCI7CgogIGlmICh0aGlzID09PSB2b2lkIDAgfHwgdGhpcyA9PT0gbnVsbCkg
ewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogIH0KCiAgdmFyIHQgPSBPYmplY3QodGhpcyk7
CiAgdmFyIGxlbiA9IHQubGVuZ3RoID4+PiAwOwogIGlmICh0eXBlb2YgZnVuICE9PSAiZnVuY3Rp
b24iKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgfQoKICB2YXIgcmVzID0gbmV3IEFy
cmF5KGxlbik7CiAgdmFyIHRoaXNwID0gYXJndW1lbnRzWzFdOwogIGZvciAodmFyIGkgPSAwOyBp
IDwgbGVuOyBpKyspIHsKICAgIGlmIChpIGluIHQpIHsKICAgICAgcmVzW2ldID0gZnVuLmNhbGwo
dGhpc3AsIHRbaV0sIGksIHQpOwogICAgfQogIH0KCiAgcmV0dXJuIHJlczsKfTsKCi8vIEZyb206
IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHQvUmVmZXJlbmNlL0ds
b2JhbF9PYmplY3RzL2FycmF5L2ZvcmVhY2gKdmFyIGFycmF5Rm9yRWFjaCA9IGlzTmF0aXZlRnVu
YyhBcnJheS5wcm90b3R5cGUuZm9yRWFjaCkgPyBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA6IGZ1
bmN0aW9uKGZ1biAvKiwgdGhpc3AgKi8pIHsKICAvLyJ1c2Ugc3RyaWN0IjsKCiAgaWYgKHRoaXMg
PT09IHZvaWQgMCB8fCB0aGlzID09PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7
CiAgfQoKICB2YXIgdCA9IE9iamVjdCh0aGlzKTsKICB2YXIgbGVuID0gdC5sZW5ndGggPj4+IDA7
CiAgaWYgKHR5cGVvZiBmdW4gIT09ICJmdW5jdGlvbiIpIHsKICAgIHRocm93IG5ldyBUeXBlRXJy
b3IoKTsKICB9CgogIHZhciB0aGlzcCA9IGFyZ3VtZW50c1sxXTsKICBmb3IgKHZhciBpID0gMDsg
aSA8IGxlbjsgaSsrKSB7CiAgICBpZiAoaSBpbiB0KSB7CiAgICAgIGZ1bi5jYWxsKHRoaXNwLCB0
W2ldLCBpLCB0KTsKICAgIH0KICB9Cn07Cgp2YXIgYXJyYXlJbmRleE9mID0gaXNOYXRpdmVGdW5j
KEFycmF5LnByb3RvdHlwZS5pbmRleE9mKSA/IEFycmF5LnByb3RvdHlwZS5pbmRleE9mIDogZnVu
Y3Rpb24gKG9iaiwgZnJvbUluZGV4KSB7CiAgaWYgKGZyb21JbmRleCA9PT0gbnVsbCB8fCBmcm9t
SW5kZXggPT09IHVuZGVmaW5lZCkgeyBmcm9tSW5kZXggPSAwOyB9CiAgZWxzZSBpZiAoZnJvbUlu
ZGV4IDwgMCkgeyBmcm9tSW5kZXggPSBNYXRoLm1heCgwLCB0aGlzLmxlbmd0aCArIGZyb21JbmRl
eCk7IH0KICBmb3IgKHZhciBpID0gZnJvbUluZGV4LCBqID0gdGhpcy5sZW5ndGg7IGkgPCBqOyBp
KyspIHsKICAgIGlmICh0aGlzW2ldID09PSBvYmopIHsgcmV0dXJuIGk7IH0KICB9CiAgcmV0dXJu
IC0xOwp9OwoKLyoqCiAgQXJyYXkgcG9seWZpbGxzIHRvIHN1cHBvcnQgRVM1IGZlYXR1cmVzIGlu
IG9sZGVyIGJyb3dzZXJzLgoKICBAbmFtZXNwYWNlIEVtYmVyCiAgQHByb3BlcnR5IEFycmF5UG9s
eWZpbGxzCiovCkVtYmVyLkFycmF5UG9seWZpbGxzID0gewogIG1hcDogYXJyYXlNYXAsCiAgZm9y
RWFjaDogYXJyYXlGb3JFYWNoLAogIGluZGV4T2Y6IGFycmF5SW5kZXhPZgp9OwoKaWYgKEVtYmVy
LlNISU1fRVM1KSB7CiAgaWYgKCFBcnJheS5wcm90b3R5cGUubWFwKSB7CiAgICBBcnJheS5wcm90
b3R5cGUubWFwID0gYXJyYXlNYXA7CiAgfQoKICBpZiAoIUFycmF5LnByb3RvdHlwZS5mb3JFYWNo
KSB7CiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA9IGFycmF5Rm9yRWFjaDsKICB9CgogIGlm
ICghQXJyYXkucHJvdG90eXBlLmluZGV4T2YpIHsKICAgIEFycmF5LnByb3RvdHlwZS5pbmRleE9m
ID0gYXJyYXlJbmRleE9mOwogIH0KfQoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgZXJyb3JQ
cm9wcyA9IFsnZGVzY3JpcHRpb24nLCAnZmlsZU5hbWUnLCAnbGluZU51bWJlcicsICdtZXNzYWdl
JywgJ25hbWUnLCAnbnVtYmVyJywgJ3N0YWNrJ107CgovKioKICBBIHN1YmNsYXNzIG9mIHRoZSBK
YXZhU2NyaXB0IEVycm9yIG9iamVjdCBmb3IgdXNlIGluIEVtYmVyLgoKICBAY2xhc3MgRXJyb3IK
ICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRXJyb3IKICBAY29uc3RydWN0b3IKKi8KRW1i
ZXIuRXJyb3IgPSBmdW5jdGlvbigpIHsKICB2YXIgdG1wID0gRXJyb3IuYXBwbHkodGhpcywgYXJn
dW1lbnRzKTsKCiAgLy8gQWRkcyBhIGBzdGFja2AgcHJvcGVydHkgdG8gdGhlIGdpdmVuIGVycm9y
IG9iamVjdCB0aGF0IHdpbGwgeWllbGQgdGhlCiAgLy8gc3RhY2sgdHJhY2UgYXQgdGhlIHRpbWUg
Y2FwdHVyZVN0YWNrVHJhY2Ugd2FzIGNhbGxlZC4KICAvLyBXaGVuIGNvbGxlY3RpbmcgdGhlIHN0
YWNrIHRyYWNlIGFsbCBmcmFtZXMgYWJvdmUgdGhlIHRvcG1vc3QgY2FsbAogIC8vIHRvIHRoaXMg
ZnVuY3Rpb24sIGluY2x1ZGluZyB0aGF0IGNhbGwsIHdpbGwgYmUgbGVmdCBvdXQgb2YgdGhlCiAg
Ly8gc3RhY2sgdHJhY2UuCiAgLy8gVGhpcyBpcyB1c2VmdWwgYmVjYXVzZSB3ZSBjYW4gaGlkZSBF
bWJlciBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzCiAgLy8gdGhhdCBhcmUgbm90IHZlcnkgaGVscGZ1
bCBmb3IgdGhlIHVzZXIuCiAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgICBFcnJv
ci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBFbWJlci5FcnJvcik7CiAgfQogIC8vIFVuZm9ydHVu
YXRlbHkgZXJyb3JzIGFyZSBub3QgZW51bWVyYWJsZSBpbiBDaHJvbWUgKGF0IGxlYXN0KSwgc28g
YGZvciBwcm9wIGluIHRtcGAgZG9lc24ndCB3b3JrLgogIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8
IGVycm9yUHJvcHMubGVuZ3RoOyBpZHgrKykgewogICAgdGhpc1tlcnJvclByb3BzW2lkeF1dID0g
dG1wW2Vycm9yUHJvcHNbaWR4XV07CiAgfQp9OwoKRW1iZXIuRXJyb3IucHJvdG90eXBlID0gRW1i
ZXIuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7CgovLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCi8vIEVSUk9SIEhBTkRMSU5HCi8vCgov
KioKICBBIGZ1bmN0aW9uIG1heSBiZSBhc3NpZ25lZCB0byBgRW1iZXIub25lcnJvcmAgdG8gYmUg
Y2FsbGVkIHdoZW4gRW1iZXIKICBpbnRlcm5hbHMgZW5jb3VudGVyIGFuIGVycm9yLiBUaGlzIGlz
IHVzZWZ1bCBmb3Igc3BlY2lhbGl6ZWQgZXJyb3IgaGFuZGxpbmcKICBhbmQgcmVwb3J0aW5nIGNv
ZGUuCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5vbmVycm9yID0gZnVuY3Rpb24oZXJyb3IpIHsK
ICAgIEVtLiQuYWpheCgnL3JlcG9ydC1lcnJvcicsICdQT1NUJywgewogICAgICBzdGFjazogZXJy
b3Iuc3RhY2ssCiAgICAgIG90aGVySW5mb3JtYXRpb246ICd3aGF0ZXZlciBhcHAgc3RhdGUgeW91
IHdhbnQgdG8gcHJvdmlkZScKICAgIH0pOwogIH07CiAgYGBgCgogIEBldmVudCBvbmVycm9yCiAg
QGZvciBFbWJlcgogIEBwYXJhbSB7RXhjZXB0aW9ufSBlcnJvciB0aGUgZXJyb3Igb2JqZWN0Ciov
CkVtYmVyLm9uZXJyb3IgPSBudWxsOwoKLyoqCiAgV3JhcCBjb2RlIGJsb2NrIGluIGEgdHJ5L2Nh
dGNoIGlmIGBFbWJlci5vbmVycm9yYCBpcyBzZXQuCgogIEBwcml2YXRlCiAgQG1ldGhvZCBoYW5k
bGVFcnJvcnMKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtGdW5jdGlvbn0gZnVuYwogIEBwYXJhbSBb
Y29udGV4dF0KKi8KRW1iZXIuaGFuZGxlRXJyb3JzID0gZnVuY3Rpb24oZnVuYywgY29udGV4dCkg
ewogIC8vIFVuZm9ydHVuYXRlbHkgaW4gc29tZSBicm93c2VycyB3ZSBsb3NlIHRoZSBiYWNrdHJh
Y2UgaWYgd2UgcmV0aHJvdyB0aGUgZXhpc3RpbmcgZXJyb3IsCiAgLy8gc28gaW4gdGhlIGV2ZW50
IHRoYXQgd2UgZG9uJ3QgaGF2ZSBhbiBgb25lcnJvcmAgaGFuZGxlciB3ZSBkb24ndCB3cmFwIGlu
IGEgdHJ5L2NhdGNoCiAgaWYgKCdmdW5jdGlvbicgPT09IHR5cGVvZiBFbWJlci5vbmVycm9yKSB7
CiAgICB0cnkgewogICAgICByZXR1cm4gZnVuYy5jYWxsKGNvbnRleHQgfHwgdGhpcyk7CiAgICB9
IGNhdGNoIChlcnJvcikgewogICAgICBFbWJlci5vbmVycm9yKGVycm9yKTsKICAgIH0KICB9IGVs
c2UgewogICAgcmV0dXJuIGZ1bmMuY2FsbChjb250ZXh0IHx8IHRoaXMpOwogIH0KfTsKCn0pKCk7
CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXItbWV0YWwKKi8KCi8qKgogIFByZWZp
eCB1c2VkIGZvciBndWlkcyB0aHJvdWdoIG91dCBFbWJlci4KICBAcHJpdmF0ZQoqLwpFbWJlci5H
VUlEX1BSRUZJWCA9ICdlbWJlcic7CgoKdmFyIG9fZGVmaW5lUHJvcGVydHkgPSBFbWJlci5wbGF0
Zm9ybS5kZWZpbmVQcm9wZXJ0eSwKICAgIG9fY3JlYXRlID0gRW1iZXIuY3JlYXRlLAogICAgLy8g
VXNlZCBmb3IgZ3VpZCBnZW5lcmF0aW9uLi4uCiAgICBHVUlEX0tFWSA9ICdfX2VtYmVyJysgKCsg
bmV3IERhdGUoKSksCiAgICB1dWlkICAgICAgICAgPSAwLAogICAgbnVtYmVyQ2FjaGUgID0gW10s
CiAgICBzdHJpbmdDYWNoZSAgPSB7fTsKCnZhciBNQU5EQVRPUllfU0VUVEVSID0gRW1iZXIuRU5W
Lk1BTkRBVE9SWV9TRVRURVI7CgovKioKICBBIHVuaXF1ZSBrZXkgdXNlZCB0byBhc3NpZ24gZ3Vp
ZHMgYW5kIG90aGVyIHByaXZhdGUgbWV0YWRhdGEgdG8gb2JqZWN0cy4KICBJZiB5b3UgaW5zcGVj
dCBhbiBvYmplY3QgaW4geW91ciBicm93c2VyIGRlYnVnZ2VyIHlvdSB3aWxsIG9mdGVuIHNlZSB0
aGVzZS4KICBUaGV5IGNhbiBiZSBzYWZlbHkgaWdub3JlZC4KCiAgT24gYnJvd3NlcnMgdGhhdCBz
dXBwb3J0IGl0LCB0aGVzZSBwcm9wZXJ0aWVzIGFyZSBhZGRlZCB3aXRoIGVudW1lcmF0aW9uCiAg
ZGlzYWJsZWQgc28gdGhleSB3b24ndCBzaG93IHVwIHdoZW4geW91IGl0ZXJhdGUgb3ZlciB5b3Vy
IHByb3BlcnRpZXMuCgogIEBwcml2YXRlCiAgQHByb3BlcnR5IEdVSURfS0VZCiAgQGZvciBFbWJl
cgogIEB0eXBlIFN0cmluZwogIEBmaW5hbAoqLwpFbWJlci5HVUlEX0tFWSA9IEdVSURfS0VZOwoK
dmFyIEdVSURfREVTQyA9IHsKICB3cml0YWJsZTogICAgZmFsc2UsCiAgY29uZmlndXJhYmxlOiBm
YWxzZSwKICBlbnVtZXJhYmxlOiAgZmFsc2UsCiAgdmFsdWU6IG51bGwKfTsKCi8qKgogIEdlbmVy
YXRlcyBhIG5ldyBndWlkLCBvcHRpb25hbGx5IHNhdmluZyB0aGUgZ3VpZCB0byB0aGUgb2JqZWN0
IHRoYXQgeW91CiAgcGFzcyBpbi4gWW91IHdpbGwgcmFyZWx5IG5lZWQgdG8gdXNlIHRoaXMgbWV0
aG9kLiBJbnN0ZWFkIHlvdSBzaG91bGQKICBjYWxsIGBFbWJlci5ndWlkRm9yKG9iailgLCB3aGlj
aCByZXR1cm4gYW4gZXhpc3RpbmcgZ3VpZCBpZiBhdmFpbGFibGUuCgogIEBwcml2YXRlCiAgQG1l
dGhvZCBnZW5lcmF0ZUd1aWQKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IFtvYmpdIE9i
amVjdCB0aGUgZ3VpZCB3aWxsIGJlIHVzZWQgZm9yLiBJZiBwYXNzZWQgaW4sIHRoZSBndWlkIHdp
bGwKICAgIGJlIHNhdmVkIG9uIHRoZSBvYmplY3QgYW5kIHJldXNlZCB3aGVuZXZlciB5b3UgcGFz
cyB0aGUgc2FtZSBvYmplY3QKICAgIGFnYWluLgoKICAgIElmIG5vIG9iamVjdCBpcyBwYXNzZWQs
IGp1c3QgZ2VuZXJhdGUgYSBuZXcgZ3VpZC4KICBAcGFyYW0ge1N0cmluZ30gW3ByZWZpeF0gUHJl
Zml4IHRvIHBsYWNlIGluIGZyb250IG9mIHRoZSBndWlkLiBVc2VmdWwgd2hlbiB5b3Ugd2FudCB0
bwogICAgc2VwYXJhdGUgdGhlIGd1aWQgaW50byBzZXBhcmF0ZSBuYW1lc3BhY2VzLgogIEByZXR1
cm4ge1N0cmluZ30gdGhlIGd1aWQKKi8KRW1iZXIuZ2VuZXJhdGVHdWlkID0gZnVuY3Rpb24gZ2Vu
ZXJhdGVHdWlkKG9iaiwgcHJlZml4KSB7CiAgaWYgKCFwcmVmaXgpIHByZWZpeCA9IEVtYmVyLkdV
SURfUFJFRklYOwogIHZhciByZXQgPSAocHJlZml4ICsgKHV1aWQrKykpOwogIGlmIChvYmopIHsK
ICAgIEdVSURfREVTQy52YWx1ZSA9IHJldDsKICAgIG9fZGVmaW5lUHJvcGVydHkob2JqLCBHVUlE
X0tFWSwgR1VJRF9ERVNDKTsKICB9CiAgcmV0dXJuIHJldDsKfTsKCi8qKgogIFJldHVybnMgYSB1
bmlxdWUgaWQgZm9yIHRoZSBvYmplY3QuIElmIHRoZSBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUg
YSBndWlkLAogIG9uZSB3aWxsIGJlIGFzc2lnbmVkIHRvIGl0LiBZb3UgY2FuIGNhbGwgdGhpcyBv
biBhbnkgb2JqZWN0LAogIGBFbWJlci5PYmplY3RgLWJhc2VkIG9yIG5vdCwgYnV0IGJlIGF3YXJl
IHRoYXQgaXQgd2lsbCBhZGQgYSBgX2d1aWRgCiAgcHJvcGVydHkuCgogIFlvdSBjYW4gYWxzbyB1
c2UgdGhpcyBtZXRob2Qgb24gRE9NIEVsZW1lbnQgb2JqZWN0cy4KCiAgQHByaXZhdGUKICBAbWV0
aG9kIGd1aWRGb3IKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBhbnkgb2JqZWN0
LCBzdHJpbmcsIG51bWJlciwgRWxlbWVudCwgb3IgcHJpbWl0aXZlCiAgQHJldHVybiB7U3RyaW5n
fSB0aGUgdW5pcXVlIGd1aWQgZm9yIHRoaXMgaW5zdGFuY2UuCiovCkVtYmVyLmd1aWRGb3IgPSBm
dW5jdGlvbiBndWlkRm9yKG9iaikgewoKICAvLyBzcGVjaWFsIGNhc2VzIHdoZXJlIHdlIGRvbid0
IHdhbnQgdG8gYWRkIGEga2V5IHRvIG9iamVjdAogIGlmIChvYmogPT09IHVuZGVmaW5lZCkgcmV0
dXJuICIodW5kZWZpbmVkKSI7CiAgaWYgKG9iaiA9PT0gbnVsbCkgcmV0dXJuICIobnVsbCkiOwoK
ICB2YXIgcmV0OwogIHZhciB0eXBlID0gdHlwZW9mIG9iajsKCiAgLy8gRG9uJ3QgYWxsb3cgcHJv
dG90eXBlIGNoYW5nZXMgdG8gU3RyaW5nIGV0Yy4gdG8gY2hhbmdlIHRoZSBndWlkRm9yCiAgc3dp
dGNoKHR5cGUpIHsKICAgIGNhc2UgJ251bWJlcic6CiAgICAgIHJldCA9IG51bWJlckNhY2hlW29i
al07CiAgICAgIGlmICghcmV0KSByZXQgPSBudW1iZXJDYWNoZVtvYmpdID0gJ251JytvYmo7CiAg
ICAgIHJldHVybiByZXQ7CgogICAgY2FzZSAnc3RyaW5nJzoKICAgICAgcmV0ID0gc3RyaW5nQ2Fj
aGVbb2JqXTsKICAgICAgaWYgKCFyZXQpIHJldCA9IHN0cmluZ0NhY2hlW29ial0gPSAnc3QnKyh1
dWlkKyspOwogICAgICByZXR1cm4gcmV0OwoKICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICByZXR1
cm4gb2JqID8gJyh0cnVlKScgOiAnKGZhbHNlKSc7CgogICAgZGVmYXVsdDoKICAgICAgaWYgKG9i
altHVUlEX0tFWV0pIHJldHVybiBvYmpbR1VJRF9LRVldOwogICAgICBpZiAob2JqID09PSBPYmpl
Y3QpIHJldHVybiAnKE9iamVjdCknOwogICAgICBpZiAob2JqID09PSBBcnJheSkgIHJldHVybiAn
KEFycmF5KSc7CiAgICAgIHJldCA9ICdlbWJlcicrKHV1aWQrKyk7CiAgICAgIEdVSURfREVTQy52
YWx1ZSA9IHJldDsKICAgICAgb19kZWZpbmVQcm9wZXJ0eShvYmosIEdVSURfS0VZLCBHVUlEX0RF
U0MpOwogICAgICByZXR1cm4gcmV0OwogIH0KfTsKCi8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KLy8gTUVUQQovLwoKdmFyIE1FVEFf
REVTQyA9IHsKICB3cml0YWJsZTogICAgdHJ1ZSwKICBjb25maWd1cmFibGU6IGZhbHNlLAogIGVu
dW1lcmFibGU6ICBmYWxzZSwKICB2YWx1ZTogbnVsbAp9OwoKdmFyIE1FVEFfS0VZID0gRW1iZXIu
R1VJRF9LRVkrJ19tZXRhJzsKCi8qKgogIFRoZSBrZXkgdXNlZCB0byBzdG9yZSBtZXRhIGluZm9y
bWF0aW9uIG9uIG9iamVjdCBmb3IgcHJvcGVydHkgb2JzZXJ2aW5nLgoKICBAcHJvcGVydHkgTUVU
QV9LRVkKICBAZm9yIEVtYmVyCiAgQHByaXZhdGUKICBAZmluYWwKICBAdHlwZSBTdHJpbmcKKi8K
RW1iZXIuTUVUQV9LRVkgPSBNRVRBX0tFWTsKCnZhciBpc0RlZmluZVByb3BlcnR5U2ltdWxhdGVk
ID0gRW1iZXIucGxhdGZvcm0uZGVmaW5lUHJvcGVydHkuaXNTaW11bGF0ZWQ7CgpmdW5jdGlvbiBN
ZXRhKG9iaikgewogIHRoaXMuZGVzY3MgPSB7fTsKICB0aGlzLndhdGNoaW5nID0ge307CiAgdGhp
cy5jYWNoZSA9IHt9OwogIHRoaXMuc291cmNlID0gb2JqOwp9CgpNZXRhLnByb3RvdHlwZSA9IHsK
ICBkZXNjczogbnVsbCwKICBkZXBzOiBudWxsLAogIHdhdGNoaW5nOiBudWxsLAogIGxpc3RlbmVy
czogbnVsbCwKICBjYWNoZTogbnVsbCwKICBzb3VyY2U6IG51bGwsCiAgbWl4aW5zOiBudWxsLAog
IGJpbmRpbmdzOiBudWxsLAogIGNoYWluczogbnVsbCwKICBjaGFpbldhdGNoZXJzOiBudWxsLAog
IHZhbHVlczogbnVsbAp9OwoKaWYgKGlzRGVmaW5lUHJvcGVydHlTaW11bGF0ZWQpIHsKICAvLyBv
biBwbGF0Zm9ybXMgdGhhdCBkb24ndCBzdXBwb3J0IGVudW1lcmFibGUgZmFsc2UKICAvLyBtYWtl
IG1ldGEgZmFpbCBqUXVlcnkuaXNQbGFpbk9iamVjdCgpIHRvIGhpZGUgZnJvbQogIC8vIGpRdWVy
eS5leHRlbmQoKSBieSBoYXZpbmcgYSBwcm9wZXJ0eSB0aGF0IGZhaWxzCiAgLy8gaGFzT3duUHJv
cGVydHkgY2hlY2suCiAgTWV0YS5wcm90b3R5cGUuX19wcmV2ZW50UGxhaW5PYmplY3RfXyA9IHRy
dWU7CgogIC8vIFdpdGhvdXQgbm9uLWVudW1lcmFibGUgcHJvcGVydGllcywgbWV0YSBvYmplY3Rz
IHdpbGwgYmUgb3V0cHV0IGluIEpTT04KICAvLyB1bmxlc3MgZXhwbGljaXRseSBzdXBwcmVzc2Vk
CiAgTWV0YS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkgeyB9Owp9CgovLyBQbGFjZWhv
bGRlciBmb3Igbm9uLXdyaXRhYmxlIG1ldGFzLgp2YXIgRU1QVFlfTUVUQSA9IG5ldyBNZXRhKG51
bGwpOwoKaWYgKE1BTkRBVE9SWV9TRVRURVIpIHsgRU1QVFlfTUVUQS52YWx1ZXMgPSB7fTsgfQoK
RW1iZXIuRU1QVFlfTUVUQSA9IEVNUFRZX01FVEE7CgovKioKICBSZXRyaWV2ZXMgdGhlIG1ldGEg
aGFzaCBmb3IgYW4gb2JqZWN0LiBJZiBgd3JpdGFibGVgIGlzIHRydWUgZW5zdXJlcyB0aGUKICBo
YXNoIGlzIHdyaXRhYmxlIGZvciB0aGlzIG9iamVjdCBhcyB3ZWxsLgoKICBUaGUgbWV0YSBvYmpl
Y3QgY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgY29tcHV0ZWQgcHJvcGVydHkgZGVzY3JpcHRv
cnMgYXMKICB3ZWxsIGFzIGFueSB3YXRjaGVkIHByb3BlcnRpZXMgYW5kIG90aGVyIGluZm9ybWF0
aW9uLiBZb3UgZ2VuZXJhbGx5IHdpbGwKICBub3QgYWNjZXNzIHRoaXMgaW5mb3JtYXRpb24gZGly
ZWN0bHkgYnV0IGluc3RlYWQgd29yayB3aXRoIGhpZ2hlciBsZXZlbAogIG1ldGhvZHMgdGhhdCBt
YW5pcHVsYXRlIHRoaXMgaGFzaCBpbmRpcmVjdGx5LgoKICBAbWV0aG9kIG1ldGEKICBAZm9yIEVt
YmVyCiAgQHByaXZhdGUKCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHJldHJp
ZXZlIG1ldGEgZm9yCiAgQHBhcmFtIHtCb29sZWFufSBbd3JpdGFibGU9dHJ1ZV0gUGFzcyBgZmFs
c2VgIGlmIHlvdSBkbyBub3QgaW50ZW5kIHRvIG1vZGlmeQogICAgdGhlIG1ldGEgaGFzaCwgYWxs
b3dpbmcgdGhlIG1ldGhvZCB0byBhdm9pZCBtYWtpbmcgYW4gdW5uZWNlc3NhcnkgY29weS4KICBA
cmV0dXJuIHtPYmplY3R9IHRoZSBtZXRhIGhhc2ggZm9yIGFuIG9iamVjdAoqLwpFbWJlci5tZXRh
ID0gZnVuY3Rpb24gbWV0YShvYmosIHdyaXRhYmxlKSB7CgogIHZhciByZXQgPSBvYmpbTUVUQV9L
RVldOwogIGlmICh3cml0YWJsZT09PWZhbHNlKSByZXR1cm4gcmV0IHx8IEVNUFRZX01FVEE7Cgog
IGlmICghcmV0KSB7CiAgICBpZiAoIWlzRGVmaW5lUHJvcGVydHlTaW11bGF0ZWQpIG9fZGVmaW5l
UHJvcGVydHkob2JqLCBNRVRBX0tFWSwgTUVUQV9ERVNDKTsKCiAgICByZXQgPSBuZXcgTWV0YShv
YmopOwoKICAgIGlmIChNQU5EQVRPUllfU0VUVEVSKSB7IHJldC52YWx1ZXMgPSB7fTsgfQoKICAg
IG9ialtNRVRBX0tFWV0gPSByZXQ7CgogICAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGFjY2lkZW50
YWxseSB0cnkgdG8gY3JlYXRlIGNvbnN0cnVjdG9yIGxpa2UgZGVzYwogICAgcmV0LmRlc2NzLmNv
bnN0cnVjdG9yID0gbnVsbDsKCiAgfSBlbHNlIGlmIChyZXQuc291cmNlICE9PSBvYmopIHsKICAg
IGlmICghaXNEZWZpbmVQcm9wZXJ0eVNpbXVsYXRlZCkgb19kZWZpbmVQcm9wZXJ0eShvYmosIE1F
VEFfS0VZLCBNRVRBX0RFU0MpOwoKICAgIHJldCA9IG9fY3JlYXRlKHJldCk7CiAgICByZXQuZGVz
Y3MgICAgPSBvX2NyZWF0ZShyZXQuZGVzY3MpOwogICAgcmV0LndhdGNoaW5nID0gb19jcmVhdGUo
cmV0LndhdGNoaW5nKTsKICAgIHJldC5jYWNoZSAgICA9IHt9OwogICAgcmV0LnNvdXJjZSAgID0g
b2JqOwoKICAgIGlmIChNQU5EQVRPUllfU0VUVEVSKSB7IHJldC52YWx1ZXMgPSBvX2NyZWF0ZShy
ZXQudmFsdWVzKTsgfQoKICAgIG9ialtNRVRBX0tFWV0gPSByZXQ7CiAgfQogIHJldHVybiByZXQ7
Cn07CgpFbWJlci5nZXRNZXRhID0gZnVuY3Rpb24gZ2V0TWV0YShvYmosIHByb3BlcnR5KSB7CiAg
dmFyIG1ldGEgPSBFbWJlci5tZXRhKG9iaiwgZmFsc2UpOwogIHJldHVybiBtZXRhW3Byb3BlcnR5
XTsKfTsKCkVtYmVyLnNldE1ldGEgPSBmdW5jdGlvbiBzZXRNZXRhKG9iaiwgcHJvcGVydHksIHZh
bHVlKSB7CiAgdmFyIG1ldGEgPSBFbWJlci5tZXRhKG9iaiwgdHJ1ZSk7CiAgbWV0YVtwcm9wZXJ0
eV0gPSB2YWx1ZTsKICByZXR1cm4gdmFsdWU7Cn07CgovKioKICBAZGVwcmVjYXRlZAogIEBwcml2
YXRlCgogIEluIG9yZGVyIHRvIHN0b3JlIGRlZmF1bHRzIGZvciBhIGNsYXNzLCBhIHByb3RvdHlw
ZSBtYXkgbmVlZCB0byBjcmVhdGUKICBhIGRlZmF1bHQgbWV0YSBvYmplY3QsIHdoaWNoIHdpbGwg
YmUgaW5oZXJpdGVkIGJ5IGFueSBvYmplY3RzIGluc3RhbnRpYXRlZAogIGZyb20gdGhlIGNsYXNz
J3MgY29uc3RydWN0b3IuCgogIEhvd2V2ZXIsIHRoZSBwcm9wZXJ0aWVzIG9mIHRoYXQgbWV0YSBv
YmplY3QgYXJlIG9ubHkgc2hhbGxvdy1jbG9uZWQsCiAgc28gaWYgYSBwcm9wZXJ0eSBpcyBhIGhh
c2ggKGxpa2UgdGhlIGV2ZW50IHN5c3RlbSdzIGBsaXN0ZW5lcnNgIGhhc2gpLAogIGl0IHdpbGwg
YnkgZGVmYXVsdCBiZSBzaGFyZWQgYWNyb3NzIGFsbCBpbnN0YW5jZXMgb2YgdGhhdCBjbGFzcy4K
CiAgVGhpcyBtZXRob2QgYWxsb3dzIGV4dGVuc2lvbnMgdG8gZGVlcGx5IGNsb25lIGEgc2VyaWVz
IG9mIG5lc3RlZCBoYXNoZXMgb3IKICBvdGhlciBjb21wbGV4IG9iamVjdHMuIEZvciBpbnN0YW5j
ZSwgdGhlIGV2ZW50IHN5c3RlbSBtaWdodCBwYXNzCiAgYFsnbGlzdGVuZXJzJywgJ2ZvbzpjaGFu
Z2UnLCAnZW1iZXIxNTcnXWAgdG8gYHByZXBhcmVNZXRhUGF0aGAsIHdoaWNoIHdpbGwKICB3YWxr
IGRvd24gdGhlIGtleXMgcHJvdmlkZWQuCgogIEZvciBlYWNoIGtleSwgaWYgdGhlIGtleSBkb2Vz
IG5vdCBleGlzdCwgaXQgaXMgY3JlYXRlZC4gSWYgaXQgYWxyZWFkeQogIGV4aXN0cyBhbmQgaXQg
d2FzIGluaGVyaXRlZCBmcm9tIGl0cyBjb25zdHJ1Y3RvciwgdGhlIGNvbnN0cnVjdG9yJ3MKICBr
ZXkgaXMgY2xvbmVkLgoKICBZb3UgY2FuIGFsc28gcGFzcyBmYWxzZSBmb3IgYHdyaXRhYmxlYCwg
d2hpY2ggd2lsbCBzaW1wbHkgcmV0dXJuCiAgdW5kZWZpbmVkIGlmIGBwcmVwYXJlTWV0YVBhdGhg
IGRpc2NvdmVycyBhbnkgcGFydCBvZiB0aGUgcGF0aCB0aGF0CiAgc2hhcmVkIG9yIHVuZGVmaW5l
ZC4KCiAgQG1ldGhvZCBtZXRhUGF0aAogIEBmb3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gb2Jq
IFRoZSBvYmplY3Qgd2hvc2UgbWV0YSB3ZSBhcmUgZXhhbWluaW5nCiAgQHBhcmFtIHtBcnJheX0g
cGF0aCBBbiBhcnJheSBvZiBrZXlzIHRvIHdhbGsgZG93bgogIEBwYXJhbSB7Qm9vbGVhbn0gd3Jp
dGFibGUgd2hldGhlciBvciBub3QgdG8gY3JlYXRlIGEgbmV3IG1ldGEKICAgIChvciBtZXRhIHBy
b3BlcnR5KSBpZiBvbmUgZG9lcyBub3QgYWxyZWFkeSBleGlzdCBvciBpZiBpdCdzCiAgICBzaGFy
ZWQgd2l0aCBpdHMgY29uc3RydWN0b3IKKi8KRW1iZXIubWV0YVBhdGggPSBmdW5jdGlvbiBtZXRh
UGF0aChvYmosIHBhdGgsIHdyaXRhYmxlKSB7CiAgRW1iZXIuZGVwcmVjYXRlKCJFbWJlci5tZXRh
UGF0aCBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgZnJvbSBmdXR1cmUgcmVsZWFz
ZXMuIik7CiAgdmFyIG1ldGEgPSBFbWJlci5tZXRhKG9iaiwgd3JpdGFibGUpLCBrZXlOYW1lLCB2
YWx1ZTsKCiAgZm9yICh2YXIgaT0wLCBsPXBhdGgubGVuZ3RoOyBpPGw7IGkrKykgewogICAga2V5
TmFtZSA9IHBhdGhbaV07CiAgICB2YWx1ZSA9IG1ldGFba2V5TmFtZV07CgogICAgaWYgKCF2YWx1
ZSkgewogICAgICBpZiAoIXdyaXRhYmxlKSB7IHJldHVybiB1bmRlZmluZWQ7IH0KICAgICAgdmFs
dWUgPSBtZXRhW2tleU5hbWVdID0geyBfX2VtYmVyX3NvdXJjZV9fOiBvYmogfTsKICAgIH0gZWxz
ZSBpZiAodmFsdWUuX19lbWJlcl9zb3VyY2VfXyAhPT0gb2JqKSB7CiAgICAgIGlmICghd3JpdGFi
bGUpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfQogICAgICB2YWx1ZSA9IG1ldGFba2V5TmFtZV0gPSBv
X2NyZWF0ZSh2YWx1ZSk7CiAgICAgIHZhbHVlLl9fZW1iZXJfc291cmNlX18gPSBvYmo7CiAgICB9
CgogICAgbWV0YSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIHZhbHVlOwp9OwoKLyoqCiAgV3JhcHMg
dGhlIHBhc3NlZCBmdW5jdGlvbiBzbyB0aGF0IGB0aGlzLl9zdXBlcmAgd2lsbCBwb2ludCB0byB0
aGUgc3VwZXJGdW5jCiAgd2hlbiB0aGUgZnVuY3Rpb24gaXMgaW52b2tlZC4gVGhpcyBpcyB0aGUg
cHJpbWl0aXZlIHdlIHVzZSB0byBpbXBsZW1lbnQKICBjYWxscyB0byBzdXBlci4KCiAgQHByaXZh
dGUKICBAbWV0aG9kIHdyYXAKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBU
aGUgZnVuY3Rpb24gdG8gY2FsbAogIEBwYXJhbSB7RnVuY3Rpb259IHN1cGVyRnVuYyBUaGUgc3Vw
ZXIgZnVuY3Rpb24uCiAgQHJldHVybiB7RnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24uCiovCkVt
YmVyLndyYXAgPSBmdW5jdGlvbihmdW5jLCBzdXBlckZ1bmMpIHsKICBmdW5jdGlvbiBLKCkge30K
CiAgZnVuY3Rpb24gc3VwZXJXcmFwcGVyKCkgewogICAgdmFyIHJldCwgc3VwID0gdGhpcy5fc3Vw
ZXI7CiAgICB0aGlzLl9zdXBlciA9IHN1cGVyRnVuYyB8fCBLOwogICAgcmV0ID0gZnVuYy5hcHBs
eSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5fc3VwZXIgPSBzdXA7CiAgICByZXR1cm4gcmV0
OwogIH0KCiAgc3VwZXJXcmFwcGVyLndyYXBwZWRGdW5jdGlvbiA9IGZ1bmM7CiAgc3VwZXJXcmFw
cGVyLl9fZW1iZXJfb2JzZXJ2ZXNfXyA9IGZ1bmMuX19lbWJlcl9vYnNlcnZlc19fOwogIHN1cGVy
V3JhcHBlci5fX2VtYmVyX29ic2VydmVzQmVmb3JlX18gPSBmdW5jLl9fZW1iZXJfb2JzZXJ2ZXNC
ZWZvcmVfXzsKICBzdXBlcldyYXBwZXIuX19lbWJlcl9saXN0ZW5zX18gPSBmdW5jLl9fZW1iZXJf
bGlzdGVuc19fOwoKICByZXR1cm4gc3VwZXJXcmFwcGVyOwp9OwoKLyoqCiAgUmV0dXJucyB0cnVl
IGlmIHRoZSBwYXNzZWQgb2JqZWN0IGlzIGFuIGFycmF5IG9yIEFycmF5LWxpa2UuCgogIEVtYmVy
IEFycmF5IFByb3RvY29sOgoKICAgIC0gdGhlIG9iamVjdCBoYXMgYW4gb2JqZWN0QXQgcHJvcGVy
dHkKICAgIC0gdGhlIG9iamVjdCBpcyBhIG5hdGl2ZSBBcnJheQogICAgLSB0aGUgb2JqZWN0IGlz
IGFuIE9iamVjdCwgYW5kIGhhcyBhIGxlbmd0aCBwcm9wZXJ0eQoKICBVbmxpa2UgYEVtYmVyLnR5
cGVPZmAgdGhpcyBtZXRob2QgcmV0dXJucyB0cnVlIGV2ZW4gaWYgdGhlIHBhc3NlZCBvYmplY3Qg
aXMKICBub3QgZm9ybWFsbHkgYXJyYXkgYnV0IGFwcGVhcnMgdG8gYmUgYXJyYXktbGlrZSAoaS5l
LiBpbXBsZW1lbnRzIGBFbWJlci5BcnJheWApCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5pc0Fy
cmF5KCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmYWxz
ZQogIEVtYmVyLmlzQXJyYXkoW10pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC8vIHRydWUKICBFbWJlci5pc0FycmF5KCBFbWJlci5BcnJheVByb3h5LmNyZWF0ZSh7
IGNvbnRlbnQ6IFtdIH0pICk7ICAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgaXNBcnJheQogIEBm
b3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gdGVzdAogIEByZXR1
cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIHBhc3NlZCBvYmplY3QgaXMgYW4gYXJyYXkgb3IgQXJy
YXktbGlrZQoqLwpFbWJlci5pc0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgaWYgKCFvYmogfHwg
b2JqLnNldEludGVydmFsKSB7IHJldHVybiBmYWxzZTsgfQogIGlmIChBcnJheS5pc0FycmF5ICYm
IEFycmF5LmlzQXJyYXkob2JqKSkgeyByZXR1cm4gdHJ1ZTsgfQogIGlmIChFbWJlci5BcnJheSAm
JiBFbWJlci5BcnJheS5kZXRlY3Qob2JqKSkgeyByZXR1cm4gdHJ1ZTsgfQogIGlmICgob2JqLmxl
bmd0aCAhPT0gdW5kZWZpbmVkKSAmJiAnb2JqZWN0Jz09PXR5cGVvZiBvYmopIHsgcmV0dXJuIHRy
dWU7IH0KICByZXR1cm4gZmFsc2U7Cn07CgovKioKICBGb3JjZXMgdGhlIHBhc3NlZCBvYmplY3Qg
dG8gYmUgcGFydCBvZiBhbiBhcnJheS4gSWYgdGhlIG9iamVjdCBpcyBhbHJlYWR5CiAgYW4gYXJy
YXkgb3IgYXJyYXktbGlrZSwgcmV0dXJucyB0aGUgb2JqZWN0LiBPdGhlcndpc2UgYWRkcyB0aGUg
b2JqZWN0IHRvCiAgYW4gYXJyYXkuIElmIG9iaiBpcyBgbnVsbGAgb3IgYHVuZGVmaW5lZGAsIHJl
dHVybnMgYW4gZW1wdHkgYXJyYXkuCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5tYWtlQXJyYXko
KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBbXQogIEVtYmVyLm1ha2VBcnJheShudWxs
KTsgICAgICAgICAgICAgICAgICAgICAgIC8vIFtdCiAgRW1iZXIubWFrZUFycmF5KHVuZGVmaW5l
ZCk7ICAgICAgICAgICAgICAgICAgLy8gW10KICBFbWJlci5tYWtlQXJyYXkoJ2xpbmRzYXknKTsg
ICAgICAgICAgICAgICAgICAvLyBbJ2xpbmRzYXknXQogIEVtYmVyLm1ha2VBcnJheShbMSwyLDQy
XSk7ICAgICAgICAgICAgICAgICAgIC8vIFsxLDIsNDJdCgogIHZhciBjb250cm9sbGVyID0gRW1i
ZXIuQXJyYXlQcm94eS5jcmVhdGUoeyBjb250ZW50OiBbXSB9KTsKICBFbWJlci5tYWtlQXJyYXko
Y29udHJvbGxlcikgPT09IGNvbnRyb2xsZXI7ICAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgbWFr
ZUFycmF5CiAgQGZvciBFbWJlcgogIEBwYXJhbSB7T2JqZWN0fSBvYmogdGhlIG9iamVjdAogIEBy
ZXR1cm4ge0FycmF5fQoqLwpFbWJlci5tYWtlQXJyYXkgPSBmdW5jdGlvbihvYmopIHsKICBpZiAo
b2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiBbXTsgfQogIHJldHVy
biBFbWJlci5pc0FycmF5KG9iaikgPyBvYmogOiBbb2JqXTsKfTsKCmZ1bmN0aW9uIGNhbkludm9r
ZShvYmosIG1ldGhvZE5hbWUpIHsKICByZXR1cm4gISEob2JqICYmIHR5cGVvZiBvYmpbbWV0aG9k
TmFtZV0gPT09ICdmdW5jdGlvbicpOwp9CgovKioKICBDaGVja3MgdG8gc2VlIGlmIHRoZSBgbWV0
aG9kTmFtZWAgZXhpc3RzIG9uIHRoZSBgb2JqYC4KCiAgYGBgamF2YXNjcmlwdAogIHZhciBmb28g
PSB7YmFyOiBFbWJlci5LLCBiYXo6IG51bGx9OwogIEVtYmVyLmNhbkludm9rZShmb28sICdiYXIn
KTsgLy8gdHJ1ZQogIEVtYmVyLmNhbkludm9rZShmb28sICdiYXonKTsgLy8gZmFsc2UKICBFbWJl
ci5jYW5JbnZva2UoZm9vLCAnYmF0Jyk7IC8vIGZhbHNlCiAgYGBgCgogIEBtZXRob2QgY2FuSW52
b2tlCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byBjaGVj
ayBmb3IgdGhlIG1ldGhvZAogIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lIFRoZSBtZXRob2Qg
bmFtZSB0byBjaGVjayBmb3IKICBAcmV0dXJuIHtCb29sZWFufQoqLwpFbWJlci5jYW5JbnZva2Ug
PSBjYW5JbnZva2U7CgovKioKICBDaGVja3MgdG8gc2VlIGlmIHRoZSBgbWV0aG9kTmFtZWAgZXhp
c3RzIG9uIHRoZSBgb2JqYCwKICBhbmQgaWYgaXQgZG9lcywgaW52b2tlcyBpdCB3aXRoIHRoZSBh
cmd1bWVudHMgcGFzc2VkLgoKICBgYGBqYXZhc2NyaXB0CiAgdmFyIGQgPSBuZXcgRGF0ZSgnMDMv
MTUvMjAxMycpOwogIEVtYmVyLnRyeUludm9rZShkLCAnZ2V0VGltZScpOyAvLyAxMzYzMzIwMDAw
MDAwCiAgRW1iZXIudHJ5SW52b2tlKGQsICdzZXRGdWxsWWVhcicsIFsyMDE0XSk7IC8vIDEzOTQ4
NTYwMDAwMDAKICBFbWJlci50cnlJbnZva2UoZCwgJ25vU3VjaE1ldGhvZCcsIFsyMDE0XSk7IC8v
IHVuZGVmaW5lZAogIGBgYAoKICBAbWV0aG9kIHRyeUludm9rZQogIEBmb3IgRW1iZXIKICBAcGFy
YW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gY2hlY2sgZm9yIHRoZSBtZXRob2QKICBAcGFy
YW0ge1N0cmluZ30gbWV0aG9kTmFtZSBUaGUgbWV0aG9kIG5hbWUgdG8gY2hlY2sgZm9yCiAgQHBh
cmFtIHtBcnJheX0gW2FyZ3NdIFRoZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kCiAg
QHJldHVybiB7Kn0gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgaW52b2tlZCBtZXRob2Qgb3IgdW5k
ZWZpbmVkIGlmIGl0IGNhbm5vdCBiZSBpbnZva2VkCiovCkVtYmVyLnRyeUludm9rZSA9IGZ1bmN0
aW9uKG9iaiwgbWV0aG9kTmFtZSwgYXJncykgewogIGlmIChjYW5JbnZva2Uob2JqLCBtZXRob2RO
YW1lKSkgewogICAgcmV0dXJuIG9ialttZXRob2ROYW1lXS5hcHBseShvYmosIGFyZ3MgfHwgW10p
OwogIH0KfTsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lbWJlcmpzL2VtYmVyLmpzL3B1bGwvMTYx
Nwp2YXIgbmVlZHNGaW5hbGx5Rml4ID0gKGZ1bmN0aW9uKCkgewogIHZhciBjb3VudCA9IDA7CiAg
dHJ5ewogICAgdHJ5IHsgfQogICAgZmluYWxseSB7CiAgICAgIGNvdW50Kys7CiAgICAgIHRocm93
IG5ldyBFcnJvcignbmVlZHNGaW5hbGx5Rml4VGVzdCcpOwogICAgfQogIH0gY2F0Y2ggKGUpIHt9
CgogIHJldHVybiBjb3VudCAhPT0gMTsKfSkoKTsKCi8qKgogIFByb3ZpZGVzIHRyeSB7IH0gZmlu
YWxseSB7IH0gZnVuY3Rpb25hbGl0eSwgd2hpbGUgd29ya2luZwogIGFyb3VuZCBTYWZhcmkncyBk
b3VibGUgZmluYWxseSBidWcuCgogIGBgYGphdmFzY3JpcHQKICB2YXIgdHJ5YWJsZSA9IGZ1bmN0
aW9uKCkgewogICAgc29tZVJlc291cmNlLmxvY2soKTsKICAgIHJ1bkNhbGxiYWNrKCk7IC8vIE1h
eSB0aHJvdyBlcnJvci4KICB9OwogIHZhciBmaW5hbGl6ZXIgPSBmdW5jdGlvbigpIHsKICAgIHNv
bWVSZXNvdXJjZS51bmxvY2soKTsKICB9OwogIEVtYmVyLnRyeUZpbmFsbHkodHJ5YWJsZSwgZmlu
YWxpemVyKTsKICBgYGAKCiAgQG1ldGhvZCB0cnlGaW5hbGx5CiAgQGZvciBFbWJlcgogIEBwYXJh
bSB7RnVuY3Rpb259IHRyeWFibGUgVGhlIGZ1bmN0aW9uIHRvIHJ1biB0aGUgdHJ5IGNhbGxiYWNr
CiAgQHBhcmFtIHtGdW5jdGlvbn0gZmluYWxpemVyIFRoZSBmdW5jdGlvbiB0byBydW4gdGhlIGZp
bmFsbHkgY2FsbGJhY2sKICBAcGFyYW0ge09iamVjdH0gW2JpbmRpbmddIFRoZSBvcHRpb25hbCBj
YWxsaW5nIG9iamVjdC4gRGVmYXVsdHMgdG8gJ3RoaXMnCiAgQHJldHVybiB7Kn0gVGhlIHJldHVy
biB2YWx1ZSBpcyB0aGUgdGhhdCBvZiB0aGUgZmluYWxpemVyLAogIHVubGVzcyB0aGF0IHZhbHVl
IGlzIHVuZGVmaW5lZCwgaW4gd2hpY2ggY2FzZSBpdCBpcyB0aGUgcmV0dXJuIHZhbHVlCiAgb2Yg
dGhlIHRyeWFibGUKKi8KCmlmIChuZWVkc0ZpbmFsbHlGaXgpIHsKICBFbWJlci50cnlGaW5hbGx5
ID0gZnVuY3Rpb24odHJ5YWJsZSwgZmluYWxpemVyLCBiaW5kaW5nKSB7CiAgICB2YXIgcmVzdWx0
LCBmaW5hbFJlc3VsdCwgZmluYWxFcnJvcjsKCiAgICBiaW5kaW5nID0gYmluZGluZyB8fCB0aGlz
OwoKICAgIHRyeSB7CiAgICAgIHJlc3VsdCA9IHRyeWFibGUuY2FsbChiaW5kaW5nKTsKICAgIH0g
ZmluYWxseSB7CiAgICAgIHRyeSB7CiAgICAgICAgZmluYWxSZXN1bHQgPSBmaW5hbGl6ZXIuY2Fs
bChiaW5kaW5nKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGZpbmFsRXJyb3IgPSBlOwog
ICAgICB9CiAgICB9CgogICAgaWYgKGZpbmFsRXJyb3IpIHsgdGhyb3cgZmluYWxFcnJvcjsgfQoK
ICAgIHJldHVybiAoZmluYWxSZXN1bHQgPT09IHVuZGVmaW5lZCkgPyByZXN1bHQgOiBmaW5hbFJl
c3VsdDsKICB9Owp9IGVsc2UgewogIEVtYmVyLnRyeUZpbmFsbHkgPSBmdW5jdGlvbih0cnlhYmxl
LCBmaW5hbGl6ZXIsIGJpbmRpbmcpIHsKICAgIHZhciByZXN1bHQsIGZpbmFsUmVzdWx0OwoKICAg
IGJpbmRpbmcgPSBiaW5kaW5nIHx8IHRoaXM7CgogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gdHJ5
YWJsZS5jYWxsKGJpbmRpbmcpOwogICAgfSBmaW5hbGx5IHsKICAgICAgZmluYWxSZXN1bHQgPSBm
aW5hbGl6ZXIuY2FsbChiaW5kaW5nKTsKICAgIH0KCiAgICByZXR1cm4gKGZpbmFsUmVzdWx0ID09
PSB1bmRlZmluZWQpID8gcmVzdWx0IDogZmluYWxSZXN1bHQ7CiAgfTsKfQoKLyoqCiAgUHJvdmlk
ZXMgdHJ5IHsgfSBjYXRjaCBmaW5hbGx5IHsgfSBmdW5jdGlvbmFsaXR5LCB3aGlsZSB3b3JraW5n
CiAgYXJvdW5kIFNhZmFyaSdzIGRvdWJsZSBmaW5hbGx5IGJ1Zy4KCiAgYGBgamF2YXNjcmlwdAog
IHZhciB0cnlhYmxlID0gZnVuY3Rpb24oKSB7CiAgICBmb3IgKGk9MCwgbD1saXN0ZW5lcnMubGVu
Z3RoOyBpPGw7IGkrKykgewogICAgICBsaXN0ZW5lciA9IGxpc3RlbmVyc1tpXTsKICAgICAgYmVm
b3JlVmFsdWVzW2ldID0gbGlzdGVuZXIuYmVmb3JlKG5hbWUsIHRpbWUoKSwgcGF5bG9hZCk7CiAg
ICB9CgogICAgcmV0dXJuIGNhbGxiYWNrLmNhbGwoYmluZGluZyk7CiAgfTsKCiAgdmFyIGNhdGNo
YWJsZSA9IGZ1bmN0aW9uKGUpIHsKICAgIHBheWxvYWQgPSBwYXlsb2FkIHx8IHt9OwogICAgcGF5
bG9hZC5leGNlcHRpb24gPSBlOwogIH07CgogIHZhciBmaW5hbGl6ZXIgPSBmdW5jdGlvbigpIHsK
ICAgIGZvciAoaT0wLCBsPWxpc3RlbmVycy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgIGxpc3Rl
bmVyID0gbGlzdGVuZXJzW2ldOwogICAgICBsaXN0ZW5lci5hZnRlcihuYW1lLCB0aW1lKCksIHBh
eWxvYWQsIGJlZm9yZVZhbHVlc1tpXSk7CiAgICB9CiAgfTsKICBFbWJlci50cnlDYXRjaEZpbmFs
bHkodHJ5YWJsZSwgY2F0Y2hhYmxlLCBmaW5hbGl6ZXIpOwogIGBgYAoKICBAbWV0aG9kIHRyeUNh
dGNoRmluYWxseQogIEBmb3IgRW1iZXIKICBAcGFyYW0ge0Z1bmN0aW9ufSB0cnlhYmxlIFRoZSBm
dW5jdGlvbiB0byBydW4gdGhlIHRyeSBjYWxsYmFjawogIEBwYXJhbSB7RnVuY3Rpb259IGNhdGNo
YWJsZSBUaGUgZnVuY3Rpb24gdG8gcnVuIHRoZSBjYXRjaGFibGUgY2FsbGJhY2sKICBAcGFyYW0g
e0Z1bmN0aW9ufSBmaW5hbGl6ZXIgVGhlIGZ1bmN0aW9uIHRvIHJ1biB0aGUgZmluYWxseSBjYWxs
YmFjawogIEBwYXJhbSB7T2JqZWN0fSBbYmluZGluZ10gVGhlIG9wdGlvbmFsIGNhbGxpbmcgb2Jq
ZWN0LiBEZWZhdWx0cyB0byAndGhpcycKICBAcmV0dXJuIHsqfSBUaGUgcmV0dXJuIHZhbHVlIGlz
IHRoZSB0aGF0IG9mIHRoZSBmaW5hbGl6ZXIsCiAgdW5sZXNzIHRoYXQgdmFsdWUgaXMgdW5kZWZp
bmVkLCBpbiB3aGljaCBjYXNlIGl0IGlzIHRoZSByZXR1cm4gdmFsdWUKICBvZiB0aGUgdHJ5YWJs
ZS4KKi8KaWYgKG5lZWRzRmluYWxseUZpeCkgewogIEVtYmVyLnRyeUNhdGNoRmluYWxseSA9IGZ1
bmN0aW9uKHRyeWFibGUsIGNhdGNoYWJsZSwgZmluYWxpemVyLCBiaW5kaW5nKSB7CiAgICB2YXIg
cmVzdWx0LCBmaW5hbFJlc3VsdCwgZmluYWxFcnJvcjsKCiAgICBiaW5kaW5nID0gYmluZGluZyB8
fCB0aGlzOwoKICAgIHRyeSB7CiAgICAgIHJlc3VsdCA9IHRyeWFibGUuY2FsbChiaW5kaW5nKTsK
ICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgcmVzdWx0ID0gY2F0Y2hhYmxlLmNhbGwoYmluZGlu
ZywgZXJyb3IpOwogICAgfSBmaW5hbGx5IHsKICAgICAgdHJ5IHsKICAgICAgICBmaW5hbFJlc3Vs
dCA9IGZpbmFsaXplci5jYWxsKGJpbmRpbmcpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAg
ZmluYWxFcnJvciA9IGU7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZmluYWxFcnJvcikgeyB0aHJv
dyBmaW5hbEVycm9yOyB9CgogICAgcmV0dXJuIChmaW5hbFJlc3VsdCA9PT0gdW5kZWZpbmVkKSA/
IHJlc3VsdCA6IGZpbmFsUmVzdWx0OwogIH07Cn0gZWxzZSB7CiAgRW1iZXIudHJ5Q2F0Y2hGaW5h
bGx5ID0gZnVuY3Rpb24odHJ5YWJsZSwgY2F0Y2hhYmxlLCBmaW5hbGl6ZXIsIGJpbmRpbmcpIHsK
ICAgIHZhciByZXN1bHQsIGZpbmFsUmVzdWx0OwoKICAgIGJpbmRpbmcgPSBiaW5kaW5nIHx8IHRo
aXM7CgogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gdHJ5YWJsZS5jYWxsKGJpbmRpbmcpOwogICAg
fSBjYXRjaChlcnJvcikgewogICAgICByZXN1bHQgPSBjYXRjaGFibGUuY2FsbChiaW5kaW5nLCBl
cnJvcik7CiAgICB9IGZpbmFsbHkgewogICAgICBmaW5hbFJlc3VsdCA9IGZpbmFsaXplci5jYWxs
KGJpbmRpbmcpOwogICAgfQoKICAgIHJldHVybiAoZmluYWxSZXN1bHQgPT09IHVuZGVmaW5lZCkg
PyByZXN1bHQgOiBmaW5hbFJlc3VsdDsKICB9Owp9CgovLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uCi8vIFRZUElORyAmIEFSUkFZIE1FU1NBR0lORwovLwoKdmFyIFRZ
UEVfTUFQID0ge307CnZhciB0ID0gIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJh
eSBEYXRlIFJlZ0V4cCBPYmplY3QiLnNwbGl0KCIgIik7CkVtYmVyLkFycmF5UG9seWZpbGxzLmZv
ckVhY2guY2FsbCh0LCBmdW5jdGlvbihuYW1lKSB7CiAgVFlQRV9NQVBbICJbb2JqZWN0ICIgKyBu
YW1lICsgIl0iIF0gPSBuYW1lLnRvTG93ZXJDYXNlKCk7Cn0pOwoKdmFyIHRvU3RyaW5nID0gT2Jq
ZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCi8qKgogIFJldHVybnMgYSBjb25zaXN0ZW50IHR5cGUg
Zm9yIHRoZSBwYXNzZWQgaXRlbS4KCiAgVXNlIHRoaXMgaW5zdGVhZCBvZiB0aGUgYnVpbHQtaW4g
YHR5cGVvZmAgdG8gZ2V0IHRoZSB0eXBlIG9mIGFuIGl0ZW0uCiAgSXQgd2lsbCByZXR1cm4gdGhl
IHNhbWUgcmVzdWx0IGFjcm9zcyBhbGwgYnJvd3NlcnMgYW5kIGluY2x1ZGVzIGEgYml0CiAgbW9y
ZSBkZXRhaWwuIEhlcmUgaXMgd2hhdCB3aWxsIGJlIHJldHVybmVkOgoKICAgICAgfCBSZXR1cm4g
VmFsdWUgIHwgTWVhbmluZyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB8CiAgICAgIHwtLS0tLS0tLS0tLS0tLS18LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogICAgICB8ICdzdHJpbmcnICAgICAgfCBTdHJp
bmcgcHJpbWl0aXZlIG9yIFN0cmluZyBvYmplY3QuICAgICAgICAgICAgICAgICAgIHwKICAgICAg
fCAnbnVtYmVyJyAgICAgIHwgTnVtYmVyIHByaW1pdGl2ZSBvciBOdW1iZXIgb2JqZWN0LiAgICAg
ICAgICAgICAgICAgICB8CiAgICAgIHwgJ2Jvb2xlYW4nICAgICB8IEJvb2xlYW4gcHJpbWl0aXZl
IG9yIEJvb2xlYW4gb2JqZWN0LiAgICAgICAgICAgICAgICAgfAogICAgICB8ICdudWxsJyAgICAg
ICAgfCBOdWxsIHZhbHVlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHwKICAgICAgfCAndW5kZWZpbmVkJyAgIHwgVW5kZWZpbmVkIHZhbHVlICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB8CiAgICAgIHwgJ2Z1bmN0aW9uJyAgICB8IEEgZnVuY3Rp
b24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgICB8ICdh
cnJheScgICAgICAgfCBBbiBpbnN0YW5jZSBvZiBBcnJheSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwKICAgICAgfCAncmVnZXhwJyAgICAgIHwgQW4gaW5zdGFuY2Ugb2YgUmVnRXhw
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICAgIHwgJ2RhdGUnICAgICAgICB8
IEFuIGluc3RhbmNlIG9mIERhdGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAog
ICAgICB8ICdjbGFzcycgICAgICAgfCBBbiBFbWJlciBjbGFzcyAoY3JlYXRlZCB1c2luZyBFbWJl
ci5PYmplY3QuZXh0ZW5kKCkpIHwKICAgICAgfCAnaW5zdGFuY2UnICAgIHwgQW4gRW1iZXIgb2Jq
ZWN0IGluc3RhbmNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICAgIHwgJ2Vycm9y
JyAgICAgICB8IEFuIGluc3RhbmNlIG9mIHRoZSBFcnJvciBvYmplY3QgICAgICAgICAgICAgICAg
ICAgICAgfAogICAgICB8ICdvYmplY3QnICAgICAgfCBBIEphdmFTY3JpcHQgb2JqZWN0IG5vdCBp
bmhlcml0aW5nIGZyb20gRW1iZXIuT2JqZWN0IHwKCiAgRXhhbXBsZXM6CgogIGBgYGphdmFzY3Jp
cHQKICBFbWJlci50eXBlT2YoKTsgICAgICAgICAgICAgICAgICAgICAgIC8vICd1bmRlZmluZWQn
CiAgRW1iZXIudHlwZU9mKG51bGwpOyAgICAgICAgICAgICAgICAgICAvLyAnbnVsbCcKICBFbWJl
ci50eXBlT2YodW5kZWZpbmVkKTsgICAgICAgICAgICAgIC8vICd1bmRlZmluZWQnCiAgRW1iZXIu
dHlwZU9mKCdtaWNoYWVsJyk7ICAgICAgICAgICAgICAvLyAnc3RyaW5nJwogIEVtYmVyLnR5cGVP
ZihuZXcgU3RyaW5nKCdtaWNoYWVsJykpOyAgLy8gJ3N0cmluZycKICBFbWJlci50eXBlT2YoMTAx
KTsgICAgICAgICAgICAgICAgICAgIC8vICdudW1iZXInCiAgRW1iZXIudHlwZU9mKG5ldyBOdW1i
ZXIoMTAxKSk7ICAgICAgICAvLyAnbnVtYmVyJwogIEVtYmVyLnR5cGVPZih0cnVlKTsgICAgICAg
ICAgICAgICAgICAgLy8gJ2Jvb2xlYW4nCiAgRW1iZXIudHlwZU9mKG5ldyBCb29sZWFuKHRydWUp
KTsgICAgICAvLyAnYm9vbGVhbicKICBFbWJlci50eXBlT2YoRW1iZXIubWFrZUFycmF5KTsgICAg
ICAgIC8vICdmdW5jdGlvbicKICBFbWJlci50eXBlT2YoWzEsMiw5MF0pOyAgICAgICAgICAgICAg
IC8vICdhcnJheScKICBFbWJlci50eXBlT2YoL2FiYy8pOyAgICAgICAgICAgICAgICAgIC8vICdy
ZWdleHAnCiAgRW1iZXIudHlwZU9mKG5ldyBEYXRlKCkpOyAgICAgICAgICAgICAvLyAnZGF0ZScK
ICBFbWJlci50eXBlT2YoRW1iZXIuT2JqZWN0LmV4dGVuZCgpKTsgIC8vICdjbGFzcycKICBFbWJl
ci50eXBlT2YoRW1iZXIuT2JqZWN0LmNyZWF0ZSgpKTsgIC8vICdpbnN0YW5jZScKICBFbWJlci50
eXBlT2YobmV3IEVycm9yKCd0ZWFtb2NpbCcpKTsgIC8vICdlcnJvcicKCiAgLy8gIm5vcm1hbCIg
SmF2YVNjcmlwdCBvYmplY3QKICBFbWJlci50eXBlT2Yoe2E6ICdiJ30pOyAgICAgICAgICAgICAg
Ly8gJ29iamVjdCcKICBgYGAKCiAgQG1ldGhvZCB0eXBlT2YKICBAZm9yIEVtYmVyCiAgQHBhcmFt
IHtPYmplY3R9IGl0ZW0gdGhlIGl0ZW0gdG8gY2hlY2sKICBAcmV0dXJuIHtTdHJpbmd9IHRoZSB0
eXBlCiovCkVtYmVyLnR5cGVPZiA9IGZ1bmN0aW9uKGl0ZW0pIHsKICB2YXIgcmV0OwoKICByZXQg
PSAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB1bmRlZmluZWQpID8gU3RyaW5nKGl0ZW0pIDog
VFlQRV9NQVBbdG9TdHJpbmcuY2FsbChpdGVtKV0gfHwgJ29iamVjdCc7CgogIGlmIChyZXQgPT09
ICdmdW5jdGlvbicpIHsKICAgIGlmIChFbWJlci5PYmplY3QgJiYgRW1iZXIuT2JqZWN0LmRldGVj
dChpdGVtKSkgcmV0ID0gJ2NsYXNzJzsKICB9IGVsc2UgaWYgKHJldCA9PT0gJ29iamVjdCcpIHsK
ICAgIGlmIChpdGVtIGluc3RhbmNlb2YgRXJyb3IpIHJldCA9ICdlcnJvcic7CiAgICBlbHNlIGlm
IChFbWJlci5PYmplY3QgJiYgaXRlbSBpbnN0YW5jZW9mIEVtYmVyLk9iamVjdCkgcmV0ID0gJ2lu
c3RhbmNlJzsKICAgIGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBEYXRlKSByZXQgPSAnZGF0ZSc7
CiAgfQoKICByZXR1cm4gcmV0Owp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovLyBFbWJlci50
cnlDYXRjaEZpbmFsbHkKCi8qKgogIFRoZSBwdXJwb3NlIG9mIHRoZSBFbWJlciBJbnN0cnVtZW50
YXRpb24gbW9kdWxlIGlzCiAgdG8gcHJvdmlkZSBlZmZpY2llbnQsIGdlbmVyYWwtcHVycG9zZSBp
bnN0cnVtZW50YXRpb24KICBmb3IgRW1iZXIuCgogIFN1YnNjcmliZSB0byBhIGxpc3RlbmVyIGJ5
IHVzaW5nIGBFbWJlci5zdWJzY3JpYmVgOgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuc3Vic2Ny
aWJlKCJyZW5kZXIiLCB7CiAgICBiZWZvcmU6IGZ1bmN0aW9uKG5hbWUsIHRpbWVzdGFtcCwgcGF5
bG9hZCkgewoKICAgIH0sCgogICAgYWZ0ZXI6IGZ1bmN0aW9uKG5hbWUsIHRpbWVzdGFtcCwgcGF5
bG9hZCkgewoKICAgIH0KICB9KTsKICBgYGAKCiAgSWYgeW91IHJldHVybiBhIHZhbHVlIGZyb20g
dGhlIGBiZWZvcmVgIGNhbGxiYWNrLCB0aGF0IHNhbWUKICB2YWx1ZSB3aWxsIGJlIHBhc3NlZCBh
cyBhIGZvdXJ0aCBwYXJhbWV0ZXIgdG8gdGhlIGBhZnRlcmAKICBjYWxsYmFjay4KCiAgSW5zdHJ1
bWVudCBhIGJsb2NrIG9mIGNvZGUgYnkgdXNpbmcgYEVtYmVyLmluc3RydW1lbnRgOgoKICBgYGBq
YXZhc2NyaXB0CiAgRW1iZXIuaW5zdHJ1bWVudCgicmVuZGVyLmhhbmRsZWJhcnMiLCBwYXlsb2Fk
LCBmdW5jdGlvbigpIHsKICAgIC8vIHJlbmRlcmluZyBsb2dpYwogIH0sIGJpbmRpbmcpOwogIGBg
YAoKICBFdmVudCBuYW1lcyBwYXNzZWQgdG8gYEVtYmVyLmluc3RydW1lbnRgIGFyZSBuYW1lc3Bh
Y2VkCiAgYnkgcGVyaW9kcywgZnJvbSBtb3JlIGdlbmVyYWwgdG8gbW9yZSBzcGVjaWZpYy4gU3Vi
c2NyaWJlcnMKICBjYW4gbGlzdGVuIGZvciBldmVudHMgYnkgd2hhdGV2ZXIgbGV2ZWwgb2YgZ3Jh
bnVsYXJpdHkgdGhleQogIGFyZSBpbnRlcmVzdGVkIGluLgoKICBJbiB0aGUgYWJvdmUgZXhhbXBs
ZSwgdGhlIGV2ZW50IGlzIGByZW5kZXIuaGFuZGxlYmFyc2AsCiAgYW5kIHRoZSBzdWJzY3JpYmVy
IGxpc3RlbmVkIGZvciBhbGwgZXZlbnRzIGJlZ2lubmluZyB3aXRoCiAgYHJlbmRlcmAuIEl0IHdv
dWxkIHJlY2VpdmUgY2FsbGJhY2tzIGZvciBldmVudHMgbmFtZWQKICBgcmVuZGVyYCwgYHJlbmRl
ci5oYW5kbGViYXJzYCwgYHJlbmRlci5jb250YWluZXJgLCBvcgogIGV2ZW4gYHJlbmRlci5oYW5k
bGViYXJzLmxheW91dGAuCgogIEBjbGFzcyBJbnN0cnVtZW50YXRpb24KICBAbmFtZXNwYWNlIEVt
YmVyCiAgQHN0YXRpYwoqLwpFbWJlci5JbnN0cnVtZW50YXRpb24gPSB7fTsKCnZhciBzdWJzY3Jp
YmVycyA9IFtdLCBjYWNoZSA9IHt9OwoKdmFyIHBvcHVsYXRlTGlzdGVuZXJzID0gZnVuY3Rpb24o
bmFtZSkgewogIHZhciBsaXN0ZW5lcnMgPSBbXSwgc3Vic2NyaWJlcjsKCiAgZm9yICh2YXIgaT0w
LCBsPXN1YnNjcmliZXJzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgIHN1YnNjcmliZXIgPSBzdWJz
Y3JpYmVyc1tpXTsKICAgIGlmIChzdWJzY3JpYmVyLnJlZ2V4LnRlc3QobmFtZSkpIHsKICAgICAg
bGlzdGVuZXJzLnB1c2goc3Vic2NyaWJlci5vYmplY3QpOwogICAgfQogIH0KCiAgY2FjaGVbbmFt
ZV0gPSBsaXN0ZW5lcnM7CiAgcmV0dXJuIGxpc3RlbmVyczsKfTsKCnZhciB0aW1lID0gKGZ1bmN0
aW9uKCkgewogIHZhciBwZXJmID0gJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB3aW5kb3cgPyB3aW5k
b3cucGVyZm9ybWFuY2UgfHwge30gOiB7fTsKICB2YXIgZm4gPSBwZXJmLm5vdyB8fCBwZXJmLm1v
ek5vdyB8fCBwZXJmLndlYmtpdE5vdyB8fCBwZXJmLm1zTm93IHx8IHBlcmYub05vdzsKICAvLyBm
bi5iaW5kIHdpbGwgYmUgYXZhaWxhYmxlIGluIGFsbCB0aGUgYnJvd3NlcnMgdGhhdCBzdXBwb3J0
IHRoZSBhZHZhbmNlZCB3aW5kb3cucGVyZm9ybWFuY2UuLi4gOy0pCiAgcmV0dXJuIGZuID8gZm4u
YmluZChwZXJmKSA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gK25ldyBEYXRlKCk7IH07Cn0pKCk7Cgov
KioKICBOb3RpZmllcyBldmVudCdzIHN1YnNjcmliZXJzLCBjYWxscyBgYmVmb3JlYCBhbmQgYGFm
dGVyYCBob29rcy4KCiAgQG1ldGhvZCBpbnN0cnVtZW50CiAgQG5hbWVzcGFjZSBFbWJlci5JbnN0
cnVtZW50YXRpb24KCiAgQHBhcmFtIHtTdHJpbmd9IFtuYW1lXSBOYW1lc3BhY2VkIGV2ZW50IG5h
bWUuCiAgQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFj
ayBGdW5jdGlvbiB0aGF0IHlvdSdyZSBpbnN0cnVtZW50aW5nLgogIEBwYXJhbSB7T2JqZWN0fSBi
aW5kaW5nIENvbnRleHQgdGhhdCBpbnN0cnVtZW50IGZ1bmN0aW9uIGlzIGNhbGxlZCB3aXRoLgoq
LwpFbWJlci5JbnN0cnVtZW50YXRpb24uaW5zdHJ1bWVudCA9IGZ1bmN0aW9uKG5hbWUsIHBheWxv
YWQsIGNhbGxiYWNrLCBiaW5kaW5nKSB7CiAgdmFyIGxpc3RlbmVycyA9IGNhY2hlW25hbWVdLCB0
aW1lTmFtZSwgcmV0OwoKICBpZiAoRW1iZXIuU1RSVUNUVVJFRF9QUk9GSUxFKSB7CiAgICB0aW1l
TmFtZSA9IG5hbWUgKyAiOiAiICsgcGF5bG9hZC5vYmplY3Q7CiAgICBjb25zb2xlLnRpbWUodGlt
ZU5hbWUpOwogIH0KCiAgaWYgKCFsaXN0ZW5lcnMpIHsKICAgIGxpc3RlbmVycyA9IHBvcHVsYXRl
TGlzdGVuZXJzKG5hbWUpOwogIH0KCiAgaWYgKGxpc3RlbmVycy5sZW5ndGggPT09IDApIHsKICAg
IHJldCA9IGNhbGxiYWNrLmNhbGwoYmluZGluZyk7CiAgICBpZiAoRW1iZXIuU1RSVUNUVVJFRF9Q
Uk9GSUxFKSB7IGNvbnNvbGUudGltZUVuZCh0aW1lTmFtZSk7IH0KICAgIHJldHVybiByZXQ7CiAg
fQoKICB2YXIgYmVmb3JlVmFsdWVzID0gW10sIGxpc3RlbmVyLCBpLCBsOwoKICBmdW5jdGlvbiB0
cnlhYmxlKCkgewogICAgZm9yIChpPTAsIGw9bGlzdGVuZXJzLmxlbmd0aDsgaTxsOyBpKyspIHsK
ICAgICAgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07CiAgICAgIGJlZm9yZVZhbHVlc1tpXSA9IGxp
c3RlbmVyLmJlZm9yZShuYW1lLCB0aW1lKCksIHBheWxvYWQpOwogICAgfQoKICAgIHJldHVybiBj
YWxsYmFjay5jYWxsKGJpbmRpbmcpOwogIH0KCiAgZnVuY3Rpb24gY2F0Y2hhYmxlKGUpIHsKICAg
IHBheWxvYWQgPSBwYXlsb2FkIHx8IHt9OwogICAgcGF5bG9hZC5leGNlcHRpb24gPSBlOwogIH0K
CiAgZnVuY3Rpb24gZmluYWxpemVyKCkgewogICAgZm9yIChpPTAsIGw9bGlzdGVuZXJzLmxlbmd0
aDsgaTxsOyBpKyspIHsKICAgICAgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07CiAgICAgIGxpc3Rl
bmVyLmFmdGVyKG5hbWUsIHRpbWUoKSwgcGF5bG9hZCwgYmVmb3JlVmFsdWVzW2ldKTsKICAgIH0K
CiAgICBpZiAoRW1iZXIuU1RSVUNUVVJFRF9QUk9GSUxFKSB7CiAgICAgIGNvbnNvbGUudGltZUVu
ZCh0aW1lTmFtZSk7CiAgICB9CiAgfQoKICByZXR1cm4gRW1iZXIudHJ5Q2F0Y2hGaW5hbGx5KHRy
eWFibGUsIGNhdGNoYWJsZSwgZmluYWxpemVyKTsKfTsKCi8qKgogIFN1YnNjcmliZXMgdG8gYSBw
YXJ0aWN1bGFyIGV2ZW50IG9yIGluc3RydW1lbnRlZCBibG9jayBvZiBjb2RlLgoKICBAbWV0aG9k
IHN1YnNjcmliZQogIEBuYW1lc3BhY2UgRW1iZXIuSW5zdHJ1bWVudGF0aW9uCgogIEBwYXJhbSB7
U3RyaW5nfSBbcGF0dGVybl0gTmFtZXNwYWNlZCBldmVudCBuYW1lLgogIEBwYXJhbSB7T2JqZWN0
fSBbb2JqZWN0XSBCZWZvcmUgYW5kIEFmdGVyIGhvb2tzLgoKICBAcmV0dXJuIHtTdWJzY3JpYmVy
fQoqLwpFbWJlci5JbnN0cnVtZW50YXRpb24uc3Vic2NyaWJlID0gZnVuY3Rpb24ocGF0dGVybiwg
b2JqZWN0KSB7CiAgdmFyIHBhdGhzID0gcGF0dGVybi5zcGxpdCgiLiIpLCBwYXRoLCByZWdleCA9
IFtdOwoKICBmb3IgKHZhciBpPTAsIGw9cGF0aHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgcGF0
aCA9IHBhdGhzW2ldOwogICAgaWYgKHBhdGggPT09ICIqIikgewogICAgICByZWdleC5wdXNoKCJb
XlxcLl0qIik7CiAgICB9IGVsc2UgewogICAgICByZWdleC5wdXNoKHBhdGgpOwogICAgfQogIH0K
CiAgcmVnZXggPSByZWdleC5qb2luKCJcXC4iKTsKICByZWdleCA9IHJlZ2V4ICsgIihcXC4uKik/
IjsKCiAgdmFyIHN1YnNjcmliZXIgPSB7CiAgICBwYXR0ZXJuOiBwYXR0ZXJuLAogICAgcmVnZXg6
IG5ldyBSZWdFeHAoIl4iICsgcmVnZXggKyAiJCIpLAogICAgb2JqZWN0OiBvYmplY3QKICB9OwoK
ICBzdWJzY3JpYmVycy5wdXNoKHN1YnNjcmliZXIpOwogIGNhY2hlID0ge307CgogIHJldHVybiBz
dWJzY3JpYmVyOwp9OwoKLyoqCiAgVW5zdWJzY3JpYmVzIGZyb20gYSBwYXJ0aWN1bGFyIGV2ZW50
IG9yIGluc3RydW1lbnRlZCBibG9jayBvZiBjb2RlLgoKICBAbWV0aG9kIHVuc3Vic2NyaWJlCiAg
QG5hbWVzcGFjZSBFbWJlci5JbnN0cnVtZW50YXRpb24KCiAgQHBhcmFtIHtPYmplY3R9IFtzdWJz
Y3JpYmVyXQoqLwpFbWJlci5JbnN0cnVtZW50YXRpb24udW5zdWJzY3JpYmUgPSBmdW5jdGlvbihz
dWJzY3JpYmVyKSB7CiAgdmFyIGluZGV4OwoKICBmb3IgKHZhciBpPTAsIGw9c3Vic2NyaWJlcnMu
bGVuZ3RoOyBpPGw7IGkrKykgewogICAgaWYgKHN1YnNjcmliZXJzW2ldID09PSBzdWJzY3JpYmVy
KSB7CiAgICAgIGluZGV4ID0gaTsKICAgIH0KICB9CgogIHN1YnNjcmliZXJzLnNwbGljZShpbmRl
eCwgMSk7CiAgY2FjaGUgPSB7fTsKfTsKCi8qKgogIFJlc2V0cyBgRW1iZXIuSW5zdHJ1bWVudGF0
aW9uYCBieSBmbHVzaGluZyBsaXN0IG9mIHN1YnNjcmliZXJzLgoKICBAbWV0aG9kIHJlc2V0CiAg
QG5hbWVzcGFjZSBFbWJlci5JbnN0cnVtZW50YXRpb24KKi8KRW1iZXIuSW5zdHJ1bWVudGF0aW9u
LnJlc2V0ID0gZnVuY3Rpb24oKSB7CiAgc3Vic2NyaWJlcnMgPSBbXTsKICBjYWNoZSA9IHt9Owp9
OwoKRW1iZXIuaW5zdHJ1bWVudCA9IEVtYmVyLkluc3RydW1lbnRhdGlvbi5pbnN0cnVtZW50OwpF
bWJlci5zdWJzY3JpYmUgPSBFbWJlci5JbnN0cnVtZW50YXRpb24uc3Vic2NyaWJlOwp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7CnZhciBtYXAsIGZvckVhY2gsIGluZGV4T2YsIHNwbGljZTsKbWFwICAg
ICA9IEFycmF5LnByb3RvdHlwZS5tYXAgICAgIHx8IEVtYmVyLkFycmF5UG9seWZpbGxzLm1hcDsK
Zm9yRWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoIHx8IEVtYmVyLkFycmF5UG9seWZpbGxz
LmZvckVhY2g7CmluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiB8fCBFbWJlci5BcnJh
eVBvbHlmaWxscy5pbmRleE9mOwpzcGxpY2UgPSBBcnJheS5wcm90b3R5cGUuc3BsaWNlOwoKdmFy
IHV0aWxzID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzID0gewogIG1hcDogZnVuY3Rpb24ob2JqLCBj
YWxsYmFjaywgdGhpc0FyZykgewogICAgcmV0dXJuIG9iai5tYXAgPyBvYmoubWFwLmNhbGwob2Jq
LCBjYWxsYmFjaywgdGhpc0FyZykgOiBtYXAuY2FsbChvYmosIGNhbGxiYWNrLCB0aGlzQXJnKTsK
ICB9LAoKICBmb3JFYWNoOiBmdW5jdGlvbihvYmosIGNhbGxiYWNrLCB0aGlzQXJnKSB7CiAgICBy
ZXR1cm4gb2JqLmZvckVhY2ggPyBvYmouZm9yRWFjaC5jYWxsKG9iaiwgY2FsbGJhY2ssIHRoaXNB
cmcpIDogZm9yRWFjaC5jYWxsKG9iaiwgY2FsbGJhY2ssIHRoaXNBcmcpOwogIH0sCgogIGluZGV4
T2Y6IGZ1bmN0aW9uKG9iaiwgZWxlbWVudCwgaW5kZXgpIHsKICAgIHJldHVybiBvYmouaW5kZXhP
ZiA/IG9iai5pbmRleE9mLmNhbGwob2JqLCBlbGVtZW50LCBpbmRleCkgOiBpbmRleE9mLmNhbGwo
b2JqLCBlbGVtZW50LCBpbmRleCk7CiAgfSwKCiAgaW5kZXhlc09mOiBmdW5jdGlvbihvYmosIGVs
ZW1lbnRzKSB7CiAgICByZXR1cm4gZWxlbWVudHMgPT09IHVuZGVmaW5lZCA/IFtdIDogdXRpbHMu
bWFwKGVsZW1lbnRzLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiB1dGlscy5pbmRleE9m
KG9iaiwgaXRlbSk7CiAgICB9KTsKICB9LAoKICBhZGRPYmplY3Q6IGZ1bmN0aW9uKGFycmF5LCBp
dGVtKSB7CiAgICB2YXIgaW5kZXggPSB1dGlscy5pbmRleE9mKGFycmF5LCBpdGVtKTsKICAgIGlm
IChpbmRleCA9PT0gLTEpIHsgYXJyYXkucHVzaChpdGVtKTsgfQogIH0sCgogIHJlbW92ZU9iamVj
dDogZnVuY3Rpb24oYXJyYXksIGl0ZW0pIHsKICAgIHZhciBpbmRleCA9IHV0aWxzLmluZGV4T2Yo
YXJyYXksIGl0ZW0pOwogICAgaWYgKGluZGV4ICE9PSAtMSkgeyBhcnJheS5zcGxpY2UoaW5kZXgs
IDEpOyB9CiAgfSwKCiAgX3JlcGxhY2U6IGZ1bmN0aW9uKGFycmF5LCBpZHgsIGFtdCwgb2JqZWN0
cykgewogICAgdmFyIGFyZ3MgPSBbXS5jb25jYXQob2JqZWN0cyksIGNodW5rLCByZXQgPSBbXSwK
ICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRh
aWw/aWQ9NTY1ODgKICAgICAgICBzaXplID0gNjAwMDAsIHN0YXJ0ID0gaWR4LCBlbmRzID0gYW10
LCBjb3VudDsKCiAgICB3aGlsZSAoYXJncy5sZW5ndGgpIHsKICAgICAgY291bnQgPSBlbmRzID4g
c2l6ZSA/IHNpemUgOiBlbmRzOwogICAgICBpZiAoY291bnQgPD0gMCkgeyBjb3VudCA9IDA7IH0K
CiAgICAgIGNodW5rID0gYXJncy5zcGxpY2UoMCwgc2l6ZSk7CiAgICAgIGNodW5rID0gW3N0YXJ0
LCBjb3VudF0uY29uY2F0KGNodW5rKTsKCiAgICAgIHN0YXJ0ICs9IHNpemU7CiAgICAgIGVuZHMg
LT0gY291bnQ7CgogICAgICByZXQgPSByZXQuY29uY2F0KHNwbGljZS5hcHBseShhcnJheSwgY2h1
bmspKTsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfSwKCiAgcmVwbGFjZTogZnVuY3Rpb24oYXJy
YXksIGlkeCwgYW10LCBvYmplY3RzKSB7CiAgICBpZiAoYXJyYXkucmVwbGFjZSkgewogICAgICBy
ZXR1cm4gYXJyYXkucmVwbGFjZShpZHgsIGFtdCwgb2JqZWN0cyk7CiAgICB9IGVsc2UgewogICAg
ICByZXR1cm4gdXRpbHMuX3JlcGxhY2UoYXJyYXksIGlkeCwgYW10LCBvYmplY3RzKTsKICAgIH0K
ICB9LAoKICBpbnRlcnNlY3Rpb246IGZ1bmN0aW9uKGFycmF5MSwgYXJyYXkyKSB7CiAgICB2YXIg
aW50ZXJzZWN0aW9uID0gW107CgogICAgdXRpbHMuZm9yRWFjaChhcnJheTEsIGZ1bmN0aW9uKGVs
ZW1lbnQpIHsKICAgICAgaWYgKHV0aWxzLmluZGV4T2YoYXJyYXkyLCBlbGVtZW50KSA+PSAwKSB7
CiAgICAgICAgaW50ZXJzZWN0aW9uLnB1c2goZWxlbWVudCk7CiAgICAgIH0KICAgIH0pOwoKICAg
IHJldHVybiBpbnRlcnNlY3Rpb247CiAgfQp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioK
QG1vZHVsZSBlbWJlci1tZXRhbAoqLwoKdmFyIE1FVEFfS0VZID0gRW1iZXIuTUVUQV9LRVksIGdl
dDsKCnZhciBNQU5EQVRPUllfU0VUVEVSID0gRW1iZXIuRU5WLk1BTkRBVE9SWV9TRVRURVI7Cgp2
YXIgSVNfR0xPQkFMX1BBVEggPSAvXihbQS1aJF18KFswLTldW0EtWiRdKSkuKltcLlwqXS87CnZh
ciBIQVNfVEhJUyAgPSAvXnRoaXNbXC5cKl0vOwp2YXIgRklSU1RfS0VZID0gL14oW15cLlwqXSsp
LzsKCi8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4KLy8gR0VUIEFORCBTRVQKLy8KLy8gSWYgd2UgYXJlIG9uIGEgcGxhdGZvcm0gdGhh
dCBzdXBwb3J0cyBhY2Nlc3NvcnMgd2UgY2FuIHVzZSB0aG9zZS4KLy8gT3RoZXJ3aXNlIHNpbXVs
YXRlIGFjY2Vzc29ycyBieSBsb29raW5nIHVwIHRoZSBwcm9wZXJ0eSBkaXJlY3RseSBvbiB0aGUK
Ly8gb2JqZWN0LgoKLyoqCiAgR2V0cyB0aGUgdmFsdWUgb2YgYSBwcm9wZXJ0eSBvbiBhbiBvYmpl
Y3QuIElmIHRoZSBwcm9wZXJ0eSBpcyBjb21wdXRlZCwKICB0aGUgZnVuY3Rpb24gd2lsbCBiZSBp
bnZva2VkLiBJZiB0aGUgcHJvcGVydHkgaXMgbm90IGRlZmluZWQgYnV0IHRoZQogIG9iamVjdCBp
bXBsZW1lbnRzIHRoZSBgdW5rbm93blByb3BlcnR5YCBtZXRob2QgdGhlbiB0aGF0IHdpbGwgYmUg
aW52b2tlZC4KCiAgSWYgeW91IHBsYW4gdG8gcnVuIG9uIElFOCBhbmQgb2xkZXIgYnJvd3NlcnMg
dGhlbiB5b3Ugc2hvdWxkIHVzZSB0aGlzCiAgbWV0aG9kIGFueXRpbWUgeW91IHdhbnQgdG8gcmV0
cmlldmUgYSBwcm9wZXJ0eSBvbiBhbiBvYmplY3QgdGhhdCB5b3UgZG9uJ3QKICBrbm93IGZvciBz
dXJlIGlzIHByaXZhdGUuIChQcm9wZXJ0aWVzIGJlZ2lubmluZyB3aXRoIGFuIHVuZGVyc2NvcmUg
J18nCiAgYXJlIGNvbnNpZGVyZWQgcHJpdmF0ZS4pCgogIE9uIGFsbCBuZXdlciBicm93c2Vycywg
eW91IG9ubHkgbmVlZCB0byB1c2UgdGhpcyBtZXRob2QgdG8gcmV0cmlldmUKICBwcm9wZXJ0aWVz
IGlmIHRoZSBwcm9wZXJ0eSBtaWdodCBub3QgYmUgZGVmaW5lZCBvbiB0aGUgb2JqZWN0IGFuZCB5
b3Ugd2FudAogIHRvIHJlc3BlY3QgdGhlIGB1bmtub3duUHJvcGVydHlgIGhhbmRsZXIuIE90aGVy
d2lzZSB5b3UgY2FuIGlnbm9yZSB0aGlzCiAgbWV0aG9kLgoKICBOb3RlIHRoYXQgaWYgdGhlIG9i
amVjdCBpdHNlbGYgaXMgYHVuZGVmaW5lZGAsIHRoaXMgbWV0aG9kIHdpbGwgdGhyb3cKICBhbiBl
cnJvci4KCiAgQG1ldGhvZCBnZXQKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBU
aGUgb2JqZWN0IHRvIHJldHJpZXZlIGZyb20uCiAgQHBhcmFtIHtTdHJpbmd9IGtleU5hbWUgVGhl
IHByb3BlcnR5IGtleSB0byByZXRyaWV2ZQogIEByZXR1cm4ge09iamVjdH0gdGhlIHByb3BlcnR5
IHZhbHVlIG9yIGBudWxsYC4KKi8KZ2V0ID0gZnVuY3Rpb24gZ2V0KG9iaiwga2V5TmFtZSkgewog
IC8vIEhlbHBlcnMgdGhhdCBvcGVyYXRlIHdpdGggJ3RoaXMnIHdpdGhpbiBhbiAjZWFjaAogIGlm
IChrZXlOYW1lID09PSAnJykgewogICAgcmV0dXJuIG9iajsKICB9CgogIGlmICgha2V5TmFtZSAm
JiAnc3RyaW5nJz09PXR5cGVvZiBvYmopIHsKICAgIGtleU5hbWUgPSBvYmo7CiAgICBvYmogPSBu
dWxsOwogIH0KCiAgRW1iZXIuYXNzZXJ0KCJDYW5ub3QgY2FsbCBnZXQgd2l0aCAiKyBrZXlOYW1l
ICsiIGtleS4iLCAhIWtleU5hbWUpOwogIEVtYmVyLmFzc2VydCgiQ2Fubm90IGNhbGwgZ2V0IHdp
dGggJyIrIGtleU5hbWUgKyInIG9uIGFuIHVuZGVmaW5lZCBvYmplY3QuIiwgb2JqICE9PSB1bmRl
ZmluZWQpOwoKICBpZiAob2JqID09PSBudWxsIHx8IGtleU5hbWUuaW5kZXhPZignLicpICE9PSAt
MSkgewogICAgcmV0dXJuIGdldFBhdGgob2JqLCBrZXlOYW1lKTsKICB9CgogIHZhciBtZXRhID0g
b2JqW01FVEFfS0VZXSwgZGVzYyA9IG1ldGEgJiYgbWV0YS5kZXNjc1trZXlOYW1lXSwgcmV0Owog
IGlmIChkZXNjKSB7CiAgICByZXR1cm4gZGVzYy5nZXQob2JqLCBrZXlOYW1lKTsKICB9IGVsc2Ug
ewogICAgaWYgKE1BTkRBVE9SWV9TRVRURVIgJiYgbWV0YSAmJiBtZXRhLndhdGNoaW5nW2tleU5h
bWVdID4gMCkgewogICAgICByZXQgPSBtZXRhLnZhbHVlc1trZXlOYW1lXTsKICAgIH0gZWxzZSB7
CiAgICAgIHJldCA9IG9ialtrZXlOYW1lXTsKICAgIH0KCiAgICBpZiAocmV0ID09PSB1bmRlZmlu
ZWQgJiYKICAgICAgICAnb2JqZWN0JyA9PT0gdHlwZW9mIG9iaiAmJiAhKGtleU5hbWUgaW4gb2Jq
KSAmJiAnZnVuY3Rpb24nID09PSB0eXBlb2Ygb2JqLnVua25vd25Qcm9wZXJ0eSkgewogICAgICBy
ZXR1cm4gb2JqLnVua25vd25Qcm9wZXJ0eShrZXlOYW1lKTsKICAgIH0KCiAgICByZXR1cm4gcmV0
OwogIH0KfTsKCi8vIEN1cnJlbnRseSB1c2VkIG9ubHkgYnkgRW1iZXIgRGF0YSB0ZXN0cwppZiAo
RW1iZXIuY29uZmlnLm92ZXJyaWRlQWNjZXNzb3JzKSB7CiAgRW1iZXIuZ2V0ID0gZ2V0OwogIEVt
YmVyLmNvbmZpZy5vdmVycmlkZUFjY2Vzc29ycygpOwogIGdldCA9IEVtYmVyLmdldDsKfQoKLyoq
CiAgTm9ybWFsaXplcyBhIHRhcmdldC9wYXRoIHBhaXIgdG8gcmVmbGVjdCB0aGF0IGFjdHVhbCB0
YXJnZXQvcGF0aCB0aGF0IHNob3VsZAogIGJlIG9ic2VydmVkLCBldGMuIFRoaXMgdGFrZXMgaW50
byBhY2NvdW50IHBhc3NpbmcgaW4gZ2xvYmFsIHByb3BlcnR5CiAgcGF0aHMgKGkuZS4gYSBwYXRo
IGJlZ2lubmluZyB3aXRoIGEgY2FwdGlhbCBsZXR0ZXIgbm90IGRlZmluZWQgb24gdGhlCiAgdGFy
Z2V0KSBhbmQgKiBzZXBhcmF0b3JzLgoKICBAcHJpdmF0ZQogIEBtZXRob2Qgbm9ybWFsaXplVHVw
bGUKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgY3VycmVudCB0YXJn
ZXQuIE1heSBiZSBgbnVsbGAuCiAgQHBhcmFtIHtTdHJpbmd9IHBhdGggQSBwYXRoIG9uIHRoZSB0
YXJnZXQgb3IgYSBnbG9iYWwgcHJvcGVydHkgcGF0aC4KICBAcmV0dXJuIHtBcnJheX0gYSB0ZW1w
b3JhcnkgYXJyYXkgd2l0aCB0aGUgbm9ybWFsaXplZCB0YXJnZXQvcGF0aCBwYWlyLgoqLwp2YXIg
bm9ybWFsaXplVHVwbGUgPSBFbWJlci5ub3JtYWxpemVUdXBsZSA9IGZ1bmN0aW9uKHRhcmdldCwg
cGF0aCkgewogIHZhciBoYXNUaGlzICA9IEhBU19USElTLnRlc3QocGF0aCksCiAgICAgIGlzR2xv
YmFsID0gIWhhc1RoaXMgJiYgSVNfR0xPQkFMX1BBVEgudGVzdChwYXRoKSwKICAgICAga2V5OwoK
ICBpZiAoIXRhcmdldCB8fCBpc0dsb2JhbCkgdGFyZ2V0ID0gRW1iZXIubG9va3VwOwogIGlmICho
YXNUaGlzKSBwYXRoID0gcGF0aC5zbGljZSg1KTsKCiAgaWYgKHRhcmdldCA9PT0gRW1iZXIubG9v
a3VwKSB7CiAgICBrZXkgPSBwYXRoLm1hdGNoKEZJUlNUX0tFWSlbMF07CiAgICB0YXJnZXQgPSBn
ZXQodGFyZ2V0LCBrZXkpOwogICAgcGF0aCAgID0gcGF0aC5zbGljZShrZXkubGVuZ3RoKzEpOwog
IH0KCiAgLy8gbXVzdCByZXR1cm4gc29tZSBraW5kIG9mIHBhdGggdG8gYmUgdmFsaWQgZWxzZSBv
dGhlciB0aGluZ3Mgd2lsbCBicmVhay4KICBpZiAoIXBhdGggfHwgcGF0aC5sZW5ndGg9PT0wKSB0
aHJvdyBuZXcgRW1iZXIuRXJyb3IoJ0ludmFsaWQgUGF0aCcpOwoKICByZXR1cm4gWyB0YXJnZXQs
IHBhdGggXTsKfTsKCnZhciBnZXRQYXRoID0gRW1iZXIuX2dldFBhdGggPSBmdW5jdGlvbihyb290
LCBwYXRoKSB7CiAgdmFyIGhhc1RoaXMsIHBhcnRzLCB0dXBsZSwgaWR4LCBsZW47CgogIC8vIElm
IHRoZXJlIGlzIG5vIHJvb3QgYW5kIHBhdGggaXMgYSBrZXkgbmFtZSwgcmV0dXJuIHRoYXQKICAv
LyBwcm9wZXJ0eSBmcm9tIHRoZSBnbG9iYWwgb2JqZWN0LgogIC8vIEUuZy4gZ2V0KCdFbWJlcicp
IC0+IEVtYmVyCiAgaWYgKHJvb3QgPT09IG51bGwgJiYgcGF0aC5pbmRleE9mKCcuJykgPT09IC0x
KSB7IHJldHVybiBnZXQoRW1iZXIubG9va3VwLCBwYXRoKTsgfQoKICAvLyBkZXRlY3QgY29tcGxp
Y2F0ZWQgcGF0aHMgYW5kIG5vcm1hbGl6ZSB0aGVtCiAgaGFzVGhpcyAgPSBIQVNfVEhJUy50ZXN0
KHBhdGgpOwoKICBpZiAoIXJvb3QgfHwgaGFzVGhpcykgewogICAgdHVwbGUgPSBub3JtYWxpemVU
dXBsZShyb290LCBwYXRoKTsKICAgIHJvb3QgPSB0dXBsZVswXTsKICAgIHBhdGggPSB0dXBsZVsx
XTsKICAgIHR1cGxlLmxlbmd0aCA9IDA7CiAgfQoKICBwYXJ0cyA9IHBhdGguc3BsaXQoIi4iKTsK
ICBsZW4gPSBwYXJ0cy5sZW5ndGg7CiAgZm9yIChpZHggPSAwOyByb290ICE9IG51bGwgJiYgaWR4
IDwgbGVuOyBpZHgrKykgewogICAgcm9vdCA9IGdldChyb290LCBwYXJ0c1tpZHhdLCB0cnVlKTsK
ICAgIGlmIChyb290ICYmIHJvb3QuaXNEZXN0cm95ZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfQog
IH0KICByZXR1cm4gcm9vdDsKfTsKCkVtYmVyLmdldFdpdGhEZWZhdWx0ID0gZnVuY3Rpb24ocm9v
dCwga2V5LCBkZWZhdWx0VmFsdWUpIHsKICB2YXIgdmFsdWUgPSBnZXQocm9vdCwga2V5KTsKCiAg
aWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIGRlZmF1bHRWYWx1ZTsgfQogIHJldHVy
biB2YWx1ZTsKfTsKCgpFbWJlci5nZXQgPSBnZXQ7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8q
KgpAbW9kdWxlIGVtYmVyLW1ldGFsCiovCgp2YXIgb19jcmVhdGUgPSBFbWJlci5jcmVhdGUsCiAg
ICBtZXRhRm9yID0gRW1iZXIubWV0YSwKICAgIE1FVEFfS0VZID0gRW1iZXIuTUVUQV9LRVksCiAg
ICBhX3NsaWNlID0gW10uc2xpY2UsCiAgICAvKiBsaXN0ZW5lciBmbGFncyAqLwogICAgT05DRSA9
IDEsIFNVU1BFTkRFRCA9IDI7CgovKgogIFRoZSBldmVudCBzeXN0ZW0gdXNlcyBhIHNlcmllcyBv
ZiBuZXN0ZWQgaGFzaGVzIHRvIHN0b3JlIGxpc3RlbmVycyBvbiBhbgogIG9iamVjdC4gV2hlbiBh
IGxpc3RlbmVyIGlzIHJlZ2lzdGVyZWQsIG9yIHdoZW4gYW4gZXZlbnQgYXJyaXZlcywgdGhlc2UK
ICBoYXNoZXMgYXJlIGNvbnN1bHRlZCB0byBkZXRlcm1pbmUgd2hpY2ggdGFyZ2V0IGFuZCBhY3Rp
b24gcGFpciB0byBpbnZva2UuCgogIFRoZSBoYXNoZXMgYXJlIHN0b3JlZCBpbiB0aGUgb2JqZWN0
J3MgbWV0YSBoYXNoLCBhbmQgbG9vayBsaWtlIHRoaXM6CgogICAgICAvLyBPYmplY3QncyBtZXRh
IGhhc2gKICAgICAgewogICAgICAgIGxpc3RlbmVyczogeyAgICAgICAvLyB2YXJpYWJsZSBuYW1l
OiBgbGlzdGVuZXJTZXRgCiAgICAgICAgICAiZm9vOmNoYW5nZWQiOiBbIC8vIHZhcmlhYmxlIG5h
bWU6IGBhY3Rpb25zYAogICAgICAgICAgICB0YXJnZXQsIG1ldGhvZCwgZmxhZ3MKICAgICAgICAg
IF0KICAgICAgICB9CiAgICAgIH0KCiovCgpmdW5jdGlvbiBpbmRleE9mKGFycmF5LCB0YXJnZXQs
IG1ldGhvZCkgewogIHZhciBpbmRleCA9IC0xOwogIGZvciAodmFyIGkgPSAwLCBsID0gYXJyYXku
bGVuZ3RoOyBpIDwgbDsgaSArPSAzKSB7CiAgICBpZiAodGFyZ2V0ID09PSBhcnJheVtpXSAmJiBt
ZXRob2QgPT09IGFycmF5W2krMV0pIHsgaW5kZXggPSBpOyBicmVhazsgfQogIH0KICByZXR1cm4g
aW5kZXg7Cn0KCmZ1bmN0aW9uIGFjdGlvbnNGb3Iob2JqLCBldmVudE5hbWUpIHsKICB2YXIgbWV0
YSA9IG1ldGFGb3Iob2JqLCB0cnVlKSwKICAgICAgYWN0aW9uczsKCiAgaWYgKCFtZXRhLmxpc3Rl
bmVycykgeyBtZXRhLmxpc3RlbmVycyA9IHt9OyB9CgogIGlmICghbWV0YS5oYXNPd25Qcm9wZXJ0
eSgnbGlzdGVuZXJzJykpIHsKICAgIC8vIHNldHVwIGluaGVyaXRlZCBjb3B5IG9mIHRoZSBsaXN0
ZW5lcnMgb2JqZWN0CiAgICBtZXRhLmxpc3RlbmVycyA9IG9fY3JlYXRlKG1ldGEubGlzdGVuZXJz
KTsKICB9CgogIGFjdGlvbnMgPSBtZXRhLmxpc3RlbmVyc1tldmVudE5hbWVdOwoKICAvLyBpZiB0
aGVyZSBhcmUgYWN0aW9ucywgYnV0IHRoZSBldmVudE5hbWUgZG9lc24ndCBleGlzdCBpbiBvdXIg
bGlzdGVuZXJzLCB0aGVuIGNvcHkgdGhlbSBmcm9tIHRoZSBwcm90b3R5cGUKICBpZiAoYWN0aW9u
cyAmJiAhbWV0YS5saXN0ZW5lcnMuaGFzT3duUHJvcGVydHkoZXZlbnROYW1lKSkgewogICAgYWN0
aW9ucyA9IG1ldGEubGlzdGVuZXJzW2V2ZW50TmFtZV0gPSBtZXRhLmxpc3RlbmVyc1tldmVudE5h
bWVdLnNsaWNlKCk7CiAgfSBlbHNlIGlmICghYWN0aW9ucykgewogICAgYWN0aW9ucyA9IG1ldGEu
bGlzdGVuZXJzW2V2ZW50TmFtZV0gPSBbXTsKICB9CgogIHJldHVybiBhY3Rpb25zOwp9CgpmdW5j
dGlvbiBhY3Rpb25zVW5pb24ob2JqLCBldmVudE5hbWUsIG90aGVyQWN0aW9ucykgewogIHZhciBt
ZXRhID0gb2JqW01FVEFfS0VZXSwKICAgICAgYWN0aW9ucyA9IG1ldGEgJiYgbWV0YS5saXN0ZW5l
cnMgJiYgbWV0YS5saXN0ZW5lcnNbZXZlbnROYW1lXTsKCiAgaWYgKCFhY3Rpb25zKSB7IHJldHVy
bjsgfQogIGZvciAodmFyIGkgPSBhY3Rpb25zLmxlbmd0aCAtIDM7IGkgPj0gMDsgaSAtPSAzKSB7
CiAgICB2YXIgdGFyZ2V0ID0gYWN0aW9uc1tpXSwKICAgICAgICBtZXRob2QgPSBhY3Rpb25zW2kr
MV0sCiAgICAgICAgZmxhZ3MgPSBhY3Rpb25zW2krMl0sCiAgICAgICAgYWN0aW9uSW5kZXggPSBp
bmRleE9mKG90aGVyQWN0aW9ucywgdGFyZ2V0LCBtZXRob2QpOwoKICAgIGlmIChhY3Rpb25JbmRl
eCA9PT0gLTEpIHsKICAgICAgb3RoZXJBY3Rpb25zLnB1c2godGFyZ2V0LCBtZXRob2QsIGZsYWdz
KTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGFjdGlvbnNEaWZmKG9iaiwgZXZlbnROYW1lLCBvdGhl
ckFjdGlvbnMpIHsKICB2YXIgbWV0YSA9IG9ialtNRVRBX0tFWV0sCiAgICAgIGFjdGlvbnMgPSBt
ZXRhICYmIG1ldGEubGlzdGVuZXJzICYmIG1ldGEubGlzdGVuZXJzW2V2ZW50TmFtZV0sCiAgICAg
IGRpZmZBY3Rpb25zID0gW107CgogIGlmICghYWN0aW9ucykgeyByZXR1cm47IH0KICBmb3IgKHZh
ciBpID0gYWN0aW9ucy5sZW5ndGggLSAzOyBpID49IDA7IGkgLT0gMykgewogICAgdmFyIHRhcmdl
dCA9IGFjdGlvbnNbaV0sCiAgICAgICAgbWV0aG9kID0gYWN0aW9uc1tpKzFdLAogICAgICAgIGZs
YWdzID0gYWN0aW9uc1tpKzJdLAogICAgICAgIGFjdGlvbkluZGV4ID0gaW5kZXhPZihvdGhlckFj
dGlvbnMsIHRhcmdldCwgbWV0aG9kKTsKCiAgICBpZiAoYWN0aW9uSW5kZXggIT09IC0xKSB7IGNv
bnRpbnVlOyB9CgogICAgb3RoZXJBY3Rpb25zLnB1c2godGFyZ2V0LCBtZXRob2QsIGZsYWdzKTsK
ICAgIGRpZmZBY3Rpb25zLnB1c2godGFyZ2V0LCBtZXRob2QsIGZsYWdzKTsKICB9CgogIHJldHVy
biBkaWZmQWN0aW9uczsKfQoKLyoqCiAgQWRkIGFuIGV2ZW50IGxpc3RlbmVyCgogIEBtZXRob2Qg
YWRkTGlzdGVuZXIKICBAZm9yIEVtYmVyCiAgQHBhcmFtIG9iagogIEBwYXJhbSB7U3RyaW5nfSBl
dmVudE5hbWUKICBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gdGFyZ2V0T3JNZXRob2QgQSB0YXJn
ZXQgb2JqZWN0IG9yIGEgZnVuY3Rpb24KICBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gbWV0aG9k
IEEgZnVuY3Rpb24gb3IgdGhlIG5hbWUgb2YgYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb24gYHRh
cmdldGAKICBAcGFyYW0ge0Jvb2xlYW59IG9uY2UgQSBmbGFnIHdoZXRoZXIgYSBmdW5jdGlvbiBz
aG91bGQgb25seSBiZSBjYWxsZWQgb25jZQoqLwpmdW5jdGlvbiBhZGRMaXN0ZW5lcihvYmosIGV2
ZW50TmFtZSwgdGFyZ2V0LCBtZXRob2QsIG9uY2UpIHsKICBFbWJlci5hc3NlcnQoIllvdSBtdXN0
IHBhc3MgYXQgbGVhc3QgYW4gb2JqZWN0IGFuZCBldmVudCBuYW1lIHRvIEVtYmVyLmFkZExpc3Rl
bmVyIiwgISFvYmogJiYgISFldmVudE5hbWUpOwoKICBpZiAoIW1ldGhvZCAmJiAnZnVuY3Rpb24n
ID09PSB0eXBlb2YgdGFyZ2V0KSB7CiAgICBtZXRob2QgPSB0YXJnZXQ7CiAgICB0YXJnZXQgPSBu
dWxsOwogIH0KCiAgdmFyIGFjdGlvbnMgPSBhY3Rpb25zRm9yKG9iaiwgZXZlbnROYW1lKSwKICAg
ICAgYWN0aW9uSW5kZXggPSBpbmRleE9mKGFjdGlvbnMsIHRhcmdldCwgbWV0aG9kKSwKICAgICAg
ZmxhZ3MgPSAwOwoKICBpZiAob25jZSkgZmxhZ3MgfD0gT05DRTsKCiAgaWYgKGFjdGlvbkluZGV4
ICE9PSAtMSkgeyByZXR1cm47IH0KCiAgYWN0aW9ucy5wdXNoKHRhcmdldCwgbWV0aG9kLCBmbGFn
cyk7CgogIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2Ygb2JqLmRpZEFkZExpc3RlbmVyKSB7CiAg
ICBvYmouZGlkQWRkTGlzdGVuZXIoZXZlbnROYW1lLCB0YXJnZXQsIG1ldGhvZCk7CiAgfQp9Cgov
KioKICBSZW1vdmUgYW4gZXZlbnQgbGlzdGVuZXIKCiAgQXJndW1lbnRzIHNob3VsZCBtYXRjaCB0
aG9zZSBwYXNzZWQgdG8gYEVtYmVyLmFkZExpc3RlbmVyYC4KCiAgQG1ldGhvZCByZW1vdmVMaXN0
ZW5lcgogIEBmb3IgRW1iZXIKICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFt
ZQogIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSB0YXJnZXRPck1ldGhvZCBBIHRhcmdldCBvYmpl
Y3Qgb3IgYSBmdW5jdGlvbgogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBtZXRob2QgQSBmdW5j
dGlvbiBvciB0aGUgbmFtZSBvZiBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbiBgdGFyZ2V0YAoq
LwpmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcihvYmosIGV2ZW50TmFtZSwgdGFyZ2V0LCBtZXRob2Qp
IHsKICBFbWJlci5hc3NlcnQoIllvdSBtdXN0IHBhc3MgYXQgbGVhc3QgYW4gb2JqZWN0IGFuZCBl
dmVudCBuYW1lIHRvIEVtYmVyLnJlbW92ZUxpc3RlbmVyIiwgISFvYmogJiYgISFldmVudE5hbWUp
OwoKICBpZiAoIW1ldGhvZCAmJiAnZnVuY3Rpb24nID09PSB0eXBlb2YgdGFyZ2V0KSB7CiAgICBt
ZXRob2QgPSB0YXJnZXQ7CiAgICB0YXJnZXQgPSBudWxsOwogIH0KCiAgZnVuY3Rpb24gX3JlbW92
ZUxpc3RlbmVyKHRhcmdldCwgbWV0aG9kKSB7CiAgICB2YXIgYWN0aW9ucyA9IGFjdGlvbnNGb3Io
b2JqLCBldmVudE5hbWUpLAogICAgICAgIGFjdGlvbkluZGV4ID0gaW5kZXhPZihhY3Rpb25zLCB0
YXJnZXQsIG1ldGhvZCk7CgogICAgLy8gYWN0aW9uIGRvZXNuJ3QgZXhpc3QsIGdpdmUgdXAgc2ls
ZW50bHkKICAgIGlmIChhY3Rpb25JbmRleCA9PT0gLTEpIHsgcmV0dXJuOyB9CgogICAgYWN0aW9u
cy5zcGxpY2UoYWN0aW9uSW5kZXgsIDMpOwoKICAgIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2Yg
b2JqLmRpZFJlbW92ZUxpc3RlbmVyKSB7CiAgICAgIG9iai5kaWRSZW1vdmVMaXN0ZW5lcihldmVu
dE5hbWUsIHRhcmdldCwgbWV0aG9kKTsKICAgIH0KICB9CgogIGlmIChtZXRob2QpIHsKICAgIF9y
ZW1vdmVMaXN0ZW5lcih0YXJnZXQsIG1ldGhvZCk7CiAgfSBlbHNlIHsKICAgIHZhciBtZXRhID0g
b2JqW01FVEFfS0VZXSwKICAgICAgICBhY3Rpb25zID0gbWV0YSAmJiBtZXRhLmxpc3RlbmVycyAm
JiBtZXRhLmxpc3RlbmVyc1tldmVudE5hbWVdOwoKICAgIGlmICghYWN0aW9ucykgeyByZXR1cm47
IH0KICAgIGZvciAodmFyIGkgPSBhY3Rpb25zLmxlbmd0aCAtIDM7IGkgPj0gMDsgaSAtPSAzKSB7
CiAgICAgIF9yZW1vdmVMaXN0ZW5lcihhY3Rpb25zW2ldLCBhY3Rpb25zW2krMV0pOwogICAgfQog
IH0KfQoKLyoqCiAgU3VzcGVuZCBsaXN0ZW5lciBkdXJpbmcgY2FsbGJhY2suCgogIFRoaXMgc2hv
dWxkIG9ubHkgYmUgdXNlZCBieSB0aGUgdGFyZ2V0IG9mIHRoZSBldmVudCBsaXN0ZW5lcgogIHdo
ZW4gaXQgaXMgdGFraW5nIGFuIGFjdGlvbiB0aGF0IHdvdWxkIGNhdXNlIHRoZSBldmVudCwgZS5n
LgogIGFuIG9iamVjdCBtaWdodCBzdXNwZW5kIGl0cyBwcm9wZXJ0eSBjaGFuZ2UgbGlzdGVuZXIg
d2hpbGUgaXQgaXMKICBzZXR0aW5nIHRoYXQgcHJvcGVydHkuCgogIEBwcml2YXRlCiAgQG1ldGhv
ZCBzdXNwZW5kTGlzdGVuZXIKICBAZm9yIEVtYmVyCiAgQHBhcmFtIG9iagogIEBwYXJhbSB7U3Ry
aW5nfSBldmVudE5hbWUKICBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gdGFyZ2V0T3JNZXRob2Qg
QSB0YXJnZXQgb2JqZWN0IG9yIGEgZnVuY3Rpb24KICBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30g
bWV0aG9kIEEgZnVuY3Rpb24gb3IgdGhlIG5hbWUgb2YgYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQg
b24gYHRhcmdldGAKICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawoqLwpmdW5jdGlvbiBzdXNw
ZW5kTGlzdGVuZXIob2JqLCBldmVudE5hbWUsIHRhcmdldCwgbWV0aG9kLCBjYWxsYmFjaykgewog
IGlmICghbWV0aG9kICYmICdmdW5jdGlvbicgPT09IHR5cGVvZiB0YXJnZXQpIHsKICAgIG1ldGhv
ZCA9IHRhcmdldDsKICAgIHRhcmdldCA9IG51bGw7CiAgfQoKICB2YXIgYWN0aW9ucyA9IGFjdGlv
bnNGb3Iob2JqLCBldmVudE5hbWUpLAogICAgICBhY3Rpb25JbmRleCA9IGluZGV4T2YoYWN0aW9u
cywgdGFyZ2V0LCBtZXRob2QpOwoKICBpZiAoYWN0aW9uSW5kZXggIT09IC0xKSB7CiAgICBhY3Rp
b25zW2FjdGlvbkluZGV4KzJdIHw9IFNVU1BFTkRFRDsgLy8gbWFyayB0aGUgYWN0aW9uIGFzIHN1
c3BlbmRlZAogIH0KCiAgZnVuY3Rpb24gdHJ5YWJsZSgpICAgeyByZXR1cm4gY2FsbGJhY2suY2Fs
bCh0YXJnZXQpOyB9CiAgZnVuY3Rpb24gZmluYWxpemVyKCkgeyBpZiAoYWN0aW9uSW5kZXggIT09
IC0xKSB7IGFjdGlvbnNbYWN0aW9uSW5kZXgrMl0gJj0gflNVU1BFTkRFRDsgfSB9CgogIHJldHVy
biBFbWJlci50cnlGaW5hbGx5KHRyeWFibGUsIGZpbmFsaXplcik7Cn0KCi8qKgogIFN1c3BlbmRz
IG11bHRpcGxlIGxpc3RlbmVycyBkdXJpbmcgYSBjYWxsYmFjay4KCiAgQHByaXZhdGUKICBAbWV0
aG9kIHN1c3BlbmRMaXN0ZW5lcnMKICBAZm9yIEVtYmVyCiAgQHBhcmFtIG9iagogIEBwYXJhbSB7
QXJyYXl9IGV2ZW50TmFtZSBBcnJheSBvZiBldmVudCBuYW1lcwogIEBwYXJhbSB7T2JqZWN0fEZ1
bmN0aW9ufSB0YXJnZXRPck1ldGhvZCBBIHRhcmdldCBvYmplY3Qgb3IgYSBmdW5jdGlvbgogIEBw
YXJhbSB7RnVuY3Rpb258U3RyaW5nfSBtZXRob2QgQSBmdW5jdGlvbiBvciB0aGUgbmFtZSBvZiBh
IGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbiBgdGFyZ2V0YAogIEBwYXJhbSB7RnVuY3Rpb259IGNh
bGxiYWNrCiovCmZ1bmN0aW9uIHN1c3BlbmRMaXN0ZW5lcnMob2JqLCBldmVudE5hbWVzLCB0YXJn
ZXQsIG1ldGhvZCwgY2FsbGJhY2spIHsKICBpZiAoIW1ldGhvZCAmJiAnZnVuY3Rpb24nID09PSB0
eXBlb2YgdGFyZ2V0KSB7CiAgICBtZXRob2QgPSB0YXJnZXQ7CiAgICB0YXJnZXQgPSBudWxsOwog
IH0KCiAgdmFyIHN1c3BlbmRlZEFjdGlvbnMgPSBbXSwKICAgICAgYWN0aW9uc0xpc3QgPSBbXSwK
ICAgICAgZXZlbnROYW1lLCBhY3Rpb25zLCBpLCBsOwoKICBmb3IgKGk9MCwgbD1ldmVudE5hbWVz
Lmxlbmd0aDsgaTxsOyBpKyspIHsKICAgIGV2ZW50TmFtZSA9IGV2ZW50TmFtZXNbaV07CiAgICBh
Y3Rpb25zID0gYWN0aW9uc0ZvcihvYmosIGV2ZW50TmFtZSk7CiAgICB2YXIgYWN0aW9uSW5kZXgg
PSBpbmRleE9mKGFjdGlvbnMsIHRhcmdldCwgbWV0aG9kKTsKCiAgICBpZiAoYWN0aW9uSW5kZXgg
IT09IC0xKSB7CiAgICAgIGFjdGlvbnNbYWN0aW9uSW5kZXgrMl0gfD0gU1VTUEVOREVEOwogICAg
ICBzdXNwZW5kZWRBY3Rpb25zLnB1c2goYWN0aW9uSW5kZXgpOwogICAgICBhY3Rpb25zTGlzdC5w
dXNoKGFjdGlvbnMpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdHJ5YWJsZSgpIHsgcmV0dXJuIGNh
bGxiYWNrLmNhbGwodGFyZ2V0KTsgfQoKICBmdW5jdGlvbiBmaW5hbGl6ZXIoKSB7CiAgICBmb3Ig
KHZhciBpID0gMCwgbCA9IHN1c3BlbmRlZEFjdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAg
ICAgIHZhciBhY3Rpb25JbmRleCA9IHN1c3BlbmRlZEFjdGlvbnNbaV07CiAgICAgIGFjdGlvbnNM
aXN0W2ldW2FjdGlvbkluZGV4KzJdICY9IH5TVVNQRU5ERUQ7CiAgICB9CiAgfQoKICByZXR1cm4g
RW1iZXIudHJ5RmluYWxseSh0cnlhYmxlLCBmaW5hbGl6ZXIpOwp9CgovKioKICBSZXR1cm4gYSBs
aXN0IG9mIGN1cnJlbnRseSB3YXRjaGVkIGV2ZW50cwoKICBAcHJpdmF0ZQogIEBtZXRob2Qgd2F0
Y2hlZEV2ZW50cwogIEBmb3IgRW1iZXIKICBAcGFyYW0gb2JqCiovCmZ1bmN0aW9uIHdhdGNoZWRF
dmVudHMob2JqKSB7CiAgdmFyIGxpc3RlbmVycyA9IG9ialtNRVRBX0tFWV0ubGlzdGVuZXJzLCBy
ZXQgPSBbXTsKCiAgaWYgKGxpc3RlbmVycykgewogICAgZm9yKHZhciBldmVudE5hbWUgaW4gbGlz
dGVuZXJzKSB7CiAgICAgIGlmIChsaXN0ZW5lcnNbZXZlbnROYW1lXSkgeyByZXQucHVzaChldmVu
dE5hbWUpOyB9CiAgICB9CiAgfQogIHJldHVybiByZXQ7Cn0KCi8qKgogIFNlbmQgYW4gZXZlbnQu
IFRoZSBleGVjdXRpb24gb2Ygc3VzcGVuZGVkIGxpc3RlbmVycwogIGlzIHNraXBwZWQsIGFuZCBv
bmNlIGxpc3RlbmVycyBhcmUgcmVtb3ZlZC4gQSBsaXN0ZW5lciB3aXRob3V0CiAgYSB0YXJnZXQg
aXMgZXhlY3V0ZWQgb24gdGhlIHBhc3NlZCBvYmplY3QuIElmIGFuIGFycmF5IG9mIGFjdGlvbnMK
ICBpcyBub3QgcGFzc2VkLCB0aGUgYWN0aW9ucyBzdG9yZWQgb24gdGhlIHBhc3NlZCBvYmplY3Qg
YXJlIGludm9rZWQuCgogIEBtZXRob2Qgc2VuZEV2ZW50CiAgQGZvciBFbWJlcgogIEBwYXJhbSBv
YmoKICBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lCiAgQHBhcmFtIHtBcnJheX0gcGFyYW1zIE9w
dGlvbmFsIHBhcmFtZXRlcnMgZm9yIGVhY2ggbGlzdGVuZXIuCiAgQHBhcmFtIHtBcnJheX0gYWN0
aW9ucyBPcHRpb25hbCBhcnJheSBvZiBhY3Rpb25zIChsaXN0ZW5lcnMpLgogIEByZXR1cm4gdHJ1
ZQoqLwpmdW5jdGlvbiBzZW5kRXZlbnQob2JqLCBldmVudE5hbWUsIHBhcmFtcywgYWN0aW9ucykg
ewogIC8vIGZpcnN0IGdpdmUgb2JqZWN0IGEgY2hhbmNlIHRvIGhhbmRsZSBpdAogIGlmIChvYmog
IT09IEVtYmVyICYmICdmdW5jdGlvbicgPT09IHR5cGVvZiBvYmouc2VuZEV2ZW50KSB7CiAgICBv
Ymouc2VuZEV2ZW50KGV2ZW50TmFtZSwgcGFyYW1zKTsKICB9CgogIGlmICghYWN0aW9ucykgewog
ICAgdmFyIG1ldGEgPSBvYmpbTUVUQV9LRVldOwogICAgYWN0aW9ucyA9IG1ldGEgJiYgbWV0YS5s
aXN0ZW5lcnMgJiYgbWV0YS5saXN0ZW5lcnNbZXZlbnROYW1lXTsKICB9CgogIGlmICghYWN0aW9u
cykgeyByZXR1cm47IH0KCiAgZm9yICh2YXIgaSA9IGFjdGlvbnMubGVuZ3RoIC0gMzsgaSA+PSAw
OyBpIC09IDMpIHsgLy8gbG9vcGluZyBpbiByZXZlcnNlIGZvciBvbmNlIGxpc3RlbmVycwogICAg
dmFyIHRhcmdldCA9IGFjdGlvbnNbaV0sIG1ldGhvZCA9IGFjdGlvbnNbaSsxXSwgZmxhZ3MgPSBh
Y3Rpb25zW2krMl07CiAgICBpZiAoIW1ldGhvZCkgeyBjb250aW51ZTsgfQogICAgaWYgKGZsYWdz
ICYgU1VTUEVOREVEKSB7IGNvbnRpbnVlOyB9CiAgICBpZiAoZmxhZ3MgJiBPTkNFKSB7IHJlbW92
ZUxpc3RlbmVyKG9iaiwgZXZlbnROYW1lLCB0YXJnZXQsIG1ldGhvZCk7IH0KICAgIGlmICghdGFy
Z2V0KSB7IHRhcmdldCA9IG9iajsgfQogICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2YgbWV0aG9k
KSB7IG1ldGhvZCA9IHRhcmdldFttZXRob2RdOyB9CiAgICBpZiAocGFyYW1zKSB7CiAgICAgIG1l
dGhvZC5hcHBseSh0YXJnZXQsIHBhcmFtcyk7CiAgICB9IGVsc2UgewogICAgICBtZXRob2QuY2Fs
bCh0YXJnZXQpOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQoKLyoqCiAgQHByaXZhdGUKICBA
bWV0aG9kIGhhc0xpc3RlbmVycwogIEBmb3IgRW1iZXIKICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtT
dHJpbmd9IGV2ZW50TmFtZQoqLwpmdW5jdGlvbiBoYXNMaXN0ZW5lcnMob2JqLCBldmVudE5hbWUp
IHsKICB2YXIgbWV0YSA9IG9ialtNRVRBX0tFWV0sCiAgICAgIGFjdGlvbnMgPSBtZXRhICYmIG1l
dGEubGlzdGVuZXJzICYmIG1ldGEubGlzdGVuZXJzW2V2ZW50TmFtZV07CgogIHJldHVybiAhIShh
Y3Rpb25zICYmIGFjdGlvbnMubGVuZ3RoKTsKfQoKLyoqCiAgQHByaXZhdGUKICBAbWV0aG9kIGxp
c3RlbmVyc0ZvcgogIEBmb3IgRW1iZXIKICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtTdHJpbmd9IGV2
ZW50TmFtZQoqLwpmdW5jdGlvbiBsaXN0ZW5lcnNGb3Iob2JqLCBldmVudE5hbWUpIHsKICB2YXIg
cmV0ID0gW107CiAgdmFyIG1ldGEgPSBvYmpbTUVUQV9LRVldLAogICAgICBhY3Rpb25zID0gbWV0
YSAmJiBtZXRhLmxpc3RlbmVycyAmJiBtZXRhLmxpc3RlbmVyc1tldmVudE5hbWVdOwoKICBpZiAo
IWFjdGlvbnMpIHsgcmV0dXJuIHJldDsgfQoKICBmb3IgKHZhciBpID0gMCwgbCA9IGFjdGlvbnMu
bGVuZ3RoOyBpIDwgbDsgaSArPSAzKSB7CiAgICB2YXIgdGFyZ2V0ID0gYWN0aW9uc1tpXSwKICAg
ICAgICBtZXRob2QgPSBhY3Rpb25zW2krMV07CiAgICByZXQucHVzaChbdGFyZ2V0LCBtZXRob2Rd
KTsKICB9CgogIHJldHVybiByZXQ7Cn0KCi8qKgogIERlZmluZSBhIHByb3BlcnR5IGFzIGEgZnVu
Y3Rpb24gdGhhdCBzaG91bGQgYmUgZXhlY3V0ZWQgd2hlbgogIGEgc3BlY2lmaWVkIGV2ZW50IG9y
IGV2ZW50cyBhcmUgdHJpZ2dlcmVkLgoKCiAgYGBgIGphdmFzY3JpcHQKICB2YXIgSm9iID0gRW1i
ZXIuT2JqZWN0LmV4dGVuZCh7CiAgICBsb2dDb21wbGV0ZWQ6IEVtYmVyLm9uKCdjb21wbGV0ZWQn
LCBmdW5jdGlvbigpewogICAgICBjb25zb2xlLmxvZygnSm9iIGNvbXBsZXRlZCEnKTsKICAgIH0p
CiAgfSk7CiAgdmFyIGpvYiA9IEpvYi5jcmVhdGUoKTsKICBFbWJlci5zZW5kRXZlbnQoam9iLCAn
Y29tcGxldGVkJyk7IC8vIExvZ3MgIkpvYiBjb21wbGV0ZWQhIgogYGBgCgogIEBtZXRob2Qgb24K
ICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZXMqCiAgQHBhcmFtIHtGdW5j
dGlvbn0gZnVuYwogIEByZXR1cm4gZnVuYwoqLwpFbWJlci5vbiA9IGZ1bmN0aW9uKCl7CiAgdmFy
IGZ1bmMgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAtMSlbMF0sCiAgICAgIGV2ZW50cyA9IGFf
c2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIC0xKTsKICBmdW5jLl9fZW1iZXJfbGlzdGVuc19fID0g
ZXZlbnRzOwogIHJldHVybiBmdW5jOwp9OwoKRW1iZXIuYWRkTGlzdGVuZXIgPSBhZGRMaXN0ZW5l
cjsKRW1iZXIucmVtb3ZlTGlzdGVuZXIgPSByZW1vdmVMaXN0ZW5lcjsKRW1iZXIuX3N1c3BlbmRM
aXN0ZW5lciA9IHN1c3BlbmRMaXN0ZW5lcjsKRW1iZXIuX3N1c3BlbmRMaXN0ZW5lcnMgPSBzdXNw
ZW5kTGlzdGVuZXJzOwpFbWJlci5zZW5kRXZlbnQgPSBzZW5kRXZlbnQ7CkVtYmVyLmhhc0xpc3Rl
bmVycyA9IGhhc0xpc3RlbmVyczsKRW1iZXIud2F0Y2hlZEV2ZW50cyA9IHdhdGNoZWRFdmVudHM7
CkVtYmVyLmxpc3RlbmVyc0ZvciA9IGxpc3RlbmVyc0ZvcjsKRW1iZXIubGlzdGVuZXJzRGlmZiA9
IGFjdGlvbnNEaWZmOwpFbWJlci5saXN0ZW5lcnNVbmlvbiA9IGFjdGlvbnNVbmlvbjsKCn0pKCk7
CgoKCihmdW5jdGlvbigpIHsKdmFyIGd1aWRGb3IgPSBFbWJlci5ndWlkRm9yLAogICAgc2VuZEV2
ZW50ID0gRW1iZXIuc2VuZEV2ZW50OwoKLyoKICB0aGlzLm9ic2VydmVyU2V0ID0gewogICAgW3Nl
bmRlckd1aWRdOiB7IC8vIHZhcmlhYmxlIG5hbWU6IGBrZXlTZXRgCiAgICAgIFtrZXlOYW1lXTog
bGlzdEluZGV4CiAgICB9CiAgfSwKICB0aGlzLm9ic2VydmVycyA9IFsKICAgIHsKICAgICAgc2Vu
ZGVyOiBvYmosCiAgICAgIGtleU5hbWU6IGtleU5hbWUsCiAgICAgIGV2ZW50TmFtZTogZXZlbnRO
YW1lLAogICAgICBsaXN0ZW5lcnM6IFsKICAgICAgICBbdGFyZ2V0LCBtZXRob2QsIGZsYWdzXQog
ICAgICBdCiAgICB9LAogICAgLi4uCiAgXQoqLwp2YXIgT2JzZXJ2ZXJTZXQgPSBFbWJlci5fT2Jz
ZXJ2ZXJTZXQgPSBmdW5jdGlvbigpIHsKICB0aGlzLmNsZWFyKCk7Cn07CgpPYnNlcnZlclNldC5w
cm90b3R5cGUuYWRkID0gZnVuY3Rpb24oc2VuZGVyLCBrZXlOYW1lLCBldmVudE5hbWUpIHsKICB2
YXIgb2JzZXJ2ZXJTZXQgPSB0aGlzLm9ic2VydmVyU2V0LAogICAgICBvYnNlcnZlcnMgPSB0aGlz
Lm9ic2VydmVycywKICAgICAgc2VuZGVyR3VpZCA9IGd1aWRGb3Ioc2VuZGVyKSwKICAgICAga2V5
U2V0ID0gb2JzZXJ2ZXJTZXRbc2VuZGVyR3VpZF0sCiAgICAgIGluZGV4OwoKICBpZiAoIWtleVNl
dCkgewogICAgb2JzZXJ2ZXJTZXRbc2VuZGVyR3VpZF0gPSBrZXlTZXQgPSB7fTsKICB9CiAgaW5k
ZXggPSBrZXlTZXRba2V5TmFtZV07CiAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHsKICAgIGlu
ZGV4ID0gb2JzZXJ2ZXJzLnB1c2goewogICAgICBzZW5kZXI6IHNlbmRlciwKICAgICAga2V5TmFt
ZToga2V5TmFtZSwKICAgICAgZXZlbnROYW1lOiBldmVudE5hbWUsCiAgICAgIGxpc3RlbmVyczog
W10KICAgIH0pIC0gMTsKICAgIGtleVNldFtrZXlOYW1lXSA9IGluZGV4OwogIH0KICByZXR1cm4g
b2JzZXJ2ZXJzW2luZGV4XS5saXN0ZW5lcnM7Cn07CgpPYnNlcnZlclNldC5wcm90b3R5cGUuZmx1
c2ggPSBmdW5jdGlvbigpIHsKICB2YXIgb2JzZXJ2ZXJzID0gdGhpcy5vYnNlcnZlcnMsIGksIGxl
biwgb2JzZXJ2ZXIsIHNlbmRlcjsKICB0aGlzLmNsZWFyKCk7CiAgZm9yIChpPTAsIGxlbj1vYnNl
cnZlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJzW2ld
OwogICAgc2VuZGVyID0gb2JzZXJ2ZXIuc2VuZGVyOwogICAgaWYgKHNlbmRlci5pc0Rlc3Ryb3lp
bmcgfHwgc2VuZGVyLmlzRGVzdHJveWVkKSB7IGNvbnRpbnVlOyB9CiAgICBzZW5kRXZlbnQoc2Vu
ZGVyLCBvYnNlcnZlci5ldmVudE5hbWUsIFtzZW5kZXIsIG9ic2VydmVyLmtleU5hbWVdLCBvYnNl
cnZlci5saXN0ZW5lcnMpOwogIH0KfTsKCk9ic2VydmVyU2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1
bmN0aW9uKCkgewogIHRoaXMub2JzZXJ2ZXJTZXQgPSB7fTsKICB0aGlzLm9ic2VydmVycyA9IFtd
Owp9Owp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBtZXRhRm9yID0gRW1iZXIubWV0YSwKICAg
IGd1aWRGb3IgPSBFbWJlci5ndWlkRm9yLAogICAgdHJ5RmluYWxseSA9IEVtYmVyLnRyeUZpbmFs
bHksCiAgICBzZW5kRXZlbnQgPSBFbWJlci5zZW5kRXZlbnQsCiAgICBsaXN0ZW5lcnNVbmlvbiA9
IEVtYmVyLmxpc3RlbmVyc1VuaW9uLAogICAgbGlzdGVuZXJzRGlmZiA9IEVtYmVyLmxpc3RlbmVy
c0RpZmYsCiAgICBPYnNlcnZlclNldCA9IEVtYmVyLl9PYnNlcnZlclNldCwKICAgIGJlZm9yZU9i
c2VydmVyU2V0ID0gbmV3IE9ic2VydmVyU2V0KCksCiAgICBvYnNlcnZlclNldCA9IG5ldyBPYnNl
cnZlclNldCgpLAogICAgZGVmZXJyZWQgPSAwOwoKLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgovLyBQUk9QRVJUWSBDSEFOR0VTCi8v
CgovKioKICBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBqdXN0IGJlZm9yZSBhbiBvYmplY3QgcHJv
cGVydHkgaXMgYWJvdXQgdG8gY2hhbmdlLgogIEl0IHdpbGwgbm90aWZ5IGFueSBiZWZvcmUgb2Jz
ZXJ2ZXJzIGFuZCBwcmVwYXJlIGNhY2hlcyBhbW9uZyBvdGhlciB0aGluZ3MuCgogIE5vcm1hbGx5
IHlvdSB3aWxsIG5vdCBuZWVkIHRvIGNhbGwgdGhpcyBtZXRob2QgZGlyZWN0bHkgYnV0IGlmIGZv
ciBzb21lCiAgcmVhc29uIHlvdSBjYW4ndCBkaXJlY3RseSB3YXRjaCBhIHByb3BlcnR5IHlvdSBj
YW4gaW52b2tlIHRoaXMgbWV0aG9kCiAgbWFudWFsbHkgYWxvbmcgd2l0aCBgRW1iZXIucHJvcGVy
dHlEaWRDaGFuZ2UoKWAgd2hpY2ggeW91IHNob3VsZCBjYWxsIGp1c3QKICBhZnRlciB0aGUgcHJv
cGVydHkgdmFsdWUgY2hhbmdlcy4KCiAgQG1ldGhvZCBwcm9wZXJ0eVdpbGxDaGFuZ2UKICBAZm9y
IEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHdpdGggdGhlIHByb3BlcnR5
IHRoYXQgd2lsbCBjaGFuZ2UKICBAcGFyYW0ge1N0cmluZ30ga2V5TmFtZSBUaGUgcHJvcGVydHkg
a2V5IChvciBwYXRoKSB0aGF0IHdpbGwgY2hhbmdlLgogIEByZXR1cm4ge3ZvaWR9CiovCmZ1bmN0
aW9uIHByb3BlcnR5V2lsbENoYW5nZShvYmosIGtleU5hbWUpIHsKICB2YXIgbSA9IG1ldGFGb3Io
b2JqLCBmYWxzZSksCiAgICAgIHdhdGNoaW5nID0gbS53YXRjaGluZ1trZXlOYW1lXSA+IDAgfHwg
a2V5TmFtZSA9PT0gJ2xlbmd0aCcsCiAgICAgIHByb3RvID0gbS5wcm90bywKICAgICAgZGVzYyA9
IG0uZGVzY3Nba2V5TmFtZV07CgogIGlmICghd2F0Y2hpbmcpIHsgcmV0dXJuOyB9CiAgaWYgKHBy
b3RvID09PSBvYmopIHsgcmV0dXJuOyB9CiAgaWYgKGRlc2MgJiYgZGVzYy53aWxsQ2hhbmdlKSB7
IGRlc2Mud2lsbENoYW5nZShvYmosIGtleU5hbWUpOyB9CiAgZGVwZW5kZW50S2V5c1dpbGxDaGFu
Z2Uob2JqLCBrZXlOYW1lLCBtKTsKICBjaGFpbnNXaWxsQ2hhbmdlKG9iaiwga2V5TmFtZSwgbSk7
CiAgbm90aWZ5QmVmb3JlT2JzZXJ2ZXJzKG9iaiwga2V5TmFtZSk7Cn0KRW1iZXIucHJvcGVydHlX
aWxsQ2hhbmdlID0gcHJvcGVydHlXaWxsQ2hhbmdlOwoKLyoqCiAgVGhpcyBmdW5jdGlvbiBpcyBj
YWxsZWQganVzdCBhZnRlciBhbiBvYmplY3QgcHJvcGVydHkgaGFzIGNoYW5nZWQuCiAgSXQgd2ls
bCBub3RpZnkgYW55IG9ic2VydmVycyBhbmQgY2xlYXIgY2FjaGVzIGFtb25nIG90aGVyIHRoaW5n
cy4KCiAgTm9ybWFsbHkgeW91IHdpbGwgbm90IG5lZWQgdG8gY2FsbCB0aGlzIG1ldGhvZCBkaXJl
Y3RseSBidXQgaWYgZm9yIHNvbWUKICByZWFzb24geW91IGNhbid0IGRpcmVjdGx5IHdhdGNoIGEg
cHJvcGVydHkgeW91IGNhbiBpbnZva2UgdGhpcyBtZXRob2QKICBtYW51YWxseSBhbG9uZyB3aXRo
IGBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UoKWAgd2hpY2ggeW91IHNob3VsZCBjYWxsIGp1c3QK
ICBiZWZvcmUgdGhlIHByb3BlcnR5IHZhbHVlIGNoYW5nZXMuCgogIEBtZXRob2QgcHJvcGVydHlE
aWRDaGFuZ2UKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHdp
dGggdGhlIHByb3BlcnR5IHRoYXQgd2lsbCBjaGFuZ2UKICBAcGFyYW0ge1N0cmluZ30ga2V5TmFt
ZSBUaGUgcHJvcGVydHkga2V5IChvciBwYXRoKSB0aGF0IHdpbGwgY2hhbmdlLgogIEByZXR1cm4g
e3ZvaWR9CiovCmZ1bmN0aW9uIHByb3BlcnR5RGlkQ2hhbmdlKG9iaiwga2V5TmFtZSkgewogIHZh
ciBtID0gbWV0YUZvcihvYmosIGZhbHNlKSwKICAgICAgd2F0Y2hpbmcgPSBtLndhdGNoaW5nW2tl
eU5hbWVdID4gMCB8fCBrZXlOYW1lID09PSAnbGVuZ3RoJywKICAgICAgcHJvdG8gPSBtLnByb3Rv
LAogICAgICBkZXNjID0gbS5kZXNjc1trZXlOYW1lXTsKCiAgaWYgKHByb3RvID09PSBvYmopIHsg
cmV0dXJuOyB9CgogIC8vIHNob3VsZG4ndCB0aGlzIG1lYW4gdGhhdCB3ZSdyZSB3YXRjaGluZyB0
aGlzIGtleT8KICBpZiAoZGVzYyAmJiBkZXNjLmRpZENoYW5nZSkgeyBkZXNjLmRpZENoYW5nZShv
YmosIGtleU5hbWUpOyB9CiAgaWYgKCF3YXRjaGluZyAmJiBrZXlOYW1lICE9PSAnbGVuZ3RoJykg
eyByZXR1cm47IH0KCiAgZGVwZW5kZW50S2V5c0RpZENoYW5nZShvYmosIGtleU5hbWUsIG0pOwog
IGNoYWluc0RpZENoYW5nZShvYmosIGtleU5hbWUsIG0sIGZhbHNlKTsKICBub3RpZnlPYnNlcnZl
cnMob2JqLCBrZXlOYW1lKTsKfQpFbWJlci5wcm9wZXJ0eURpZENoYW5nZSA9IHByb3BlcnR5RGlk
Q2hhbmdlOwoKdmFyIFdJTExfU0VFTiwgRElEX1NFRU47CgovLyBjYWxsZWQgd2hlbmV2ZXIgYSBw
cm9wZXJ0eSBpcyBhYm91dCB0byBjaGFuZ2UgdG8gY2xlYXIgdGhlIGNhY2hlIG9mIGFueSBkZXBl
bmRlbnQga2V5cyAoYW5kIG5vdGlmeSB0aG9zZSBwcm9wZXJ0aWVzIG9mIGNoYW5nZXMsIGV0Yy4u
LikKZnVuY3Rpb24gZGVwZW5kZW50S2V5c1dpbGxDaGFuZ2Uob2JqLCBkZXBLZXksIG1ldGEpIHsK
ICBpZiAob2JqLmlzRGVzdHJveWluZykgeyByZXR1cm47IH0KCiAgdmFyIHNlZW4gPSBXSUxMX1NF
RU4sIHRvcCA9ICFzZWVuOwogIGlmICh0b3ApIHsgc2VlbiA9IFdJTExfU0VFTiA9IHt9OyB9CiAg
aXRlckRlcHMocHJvcGVydHlXaWxsQ2hhbmdlLCBvYmosIGRlcEtleSwgc2VlbiwgbWV0YSk7CiAg
aWYgKHRvcCkgeyBXSUxMX1NFRU4gPSBudWxsOyB9Cn0KCi8vIGNhbGxlZCB3aGVuZXZlciBhIHBy
b3BlcnR5IGhhcyBqdXN0IGNoYW5nZWQgdG8gdXBkYXRlIGRlcGVuZGVudCBrZXlzCmZ1bmN0aW9u
IGRlcGVuZGVudEtleXNEaWRDaGFuZ2Uob2JqLCBkZXBLZXksIG1ldGEpIHsKICBpZiAob2JqLmlz
RGVzdHJveWluZykgeyByZXR1cm47IH0KCiAgdmFyIHNlZW4gPSBESURfU0VFTiwgdG9wID0gIXNl
ZW47CiAgaWYgKHRvcCkgeyBzZWVuID0gRElEX1NFRU4gPSB7fTsgfQogIGl0ZXJEZXBzKHByb3Bl
cnR5RGlkQ2hhbmdlLCBvYmosIGRlcEtleSwgc2VlbiwgbWV0YSk7CiAgaWYgKHRvcCkgeyBESURf
U0VFTiA9IG51bGw7IH0KfQoKZnVuY3Rpb24gaXRlckRlcHMobWV0aG9kLCBvYmosIGRlcEtleSwg
c2VlbiwgbWV0YSkgewogIHZhciBndWlkID0gZ3VpZEZvcihvYmopOwogIGlmICghc2VlbltndWlk
XSkgc2VlbltndWlkXSA9IHt9OwogIGlmIChzZWVuW2d1aWRdW2RlcEtleV0pIHJldHVybjsKICBz
ZWVuW2d1aWRdW2RlcEtleV0gPSB0cnVlOwoKICB2YXIgZGVwcyA9IG1ldGEuZGVwczsKICBkZXBz
ID0gZGVwcyAmJiBkZXBzW2RlcEtleV07CiAgaWYgKGRlcHMpIHsKICAgIGZvcih2YXIga2V5IGlu
IGRlcHMpIHsKICAgICAgdmFyIGRlc2MgPSBtZXRhLmRlc2NzW2tleV07CiAgICAgIGlmIChkZXNj
ICYmIGRlc2MuX3N1c3BlbmRlZCA9PT0gb2JqKSBjb250aW51ZTsKICAgICAgbWV0aG9kKG9iaiwg
a2V5KTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGNoYWluc1dpbGxDaGFuZ2Uob2JqLCBrZXlOYW1l
LCBtKSB7CiAgaWYgKCEobS5oYXNPd25Qcm9wZXJ0eSgnY2hhaW5XYXRjaGVycycpICYmCiAgICAg
ICAgbS5jaGFpbldhdGNoZXJzW2tleU5hbWVdKSkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIG5v
ZGVzID0gbS5jaGFpbldhdGNoZXJzW2tleU5hbWVdLAogICAgICBldmVudHMgPSBbXSwKICAgICAg
aSwgbDsKCiAgZm9yKGkgPSAwLCBsID0gbm9kZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICBu
b2Rlc1tpXS53aWxsQ2hhbmdlKGV2ZW50cyk7CiAgfQoKICBmb3IgKGkgPSAwLCBsID0gZXZlbnRz
Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgcHJvcGVydHlXaWxsQ2hhbmdlKGV2ZW50c1tp
XSwgZXZlbnRzW2krMV0pOwogIH0KfQoKZnVuY3Rpb24gY2hhaW5zRGlkQ2hhbmdlKG9iaiwga2V5
TmFtZSwgbSwgc3VwcHJlc3NFdmVudHMpIHsKICBpZiAoIShtLmhhc093blByb3BlcnR5KCdjaGFp
bldhdGNoZXJzJykgJiYKICAgICAgICBtLmNoYWluV2F0Y2hlcnNba2V5TmFtZV0pKSB7CiAgICBy
ZXR1cm47CiAgfQoKICB2YXIgbm9kZXMgPSBtLmNoYWluV2F0Y2hlcnNba2V5TmFtZV0sCiAgICAg
IGV2ZW50cyA9IHN1cHByZXNzRXZlbnRzID8gbnVsbCA6IFtdLAogICAgICBpLCBsOwoKICBmb3Io
aSA9IDAsIGwgPSBub2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgIG5vZGVzW2ldLmRpZENo
YW5nZShldmVudHMpOwogIH0KCiAgaWYgKHN1cHByZXNzRXZlbnRzKSB7CiAgICByZXR1cm47CiAg
fQoKICBmb3IgKGkgPSAwLCBsID0gZXZlbnRzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAg
cHJvcGVydHlEaWRDaGFuZ2UoZXZlbnRzW2ldLCBldmVudHNbaSsxXSk7CiAgfQp9CgpFbWJlci5v
dmVycmlkZUNoYWlucyA9IGZ1bmN0aW9uKG9iaiwga2V5TmFtZSwgbSkgewogIGNoYWluc0RpZENo
YW5nZShvYmosIGtleU5hbWUsIG0sIHRydWUpOwp9OwoKLyoqCiAgQG1ldGhvZCBiZWdpblByb3Bl
cnR5Q2hhbmdlcwogIEBjaGFpbmFibGUKICBAcHJpdmF0ZQoqLwpmdW5jdGlvbiBiZWdpblByb3Bl
cnR5Q2hhbmdlcygpIHsKICBkZWZlcnJlZCsrOwp9CgpFbWJlci5iZWdpblByb3BlcnR5Q2hhbmdl
cyA9IGJlZ2luUHJvcGVydHlDaGFuZ2VzOwoKLyoqCiAgQG1ldGhvZCBlbmRQcm9wZXJ0eUNoYW5n
ZXMKICBAcHJpdmF0ZQoqLwpmdW5jdGlvbiBlbmRQcm9wZXJ0eUNoYW5nZXMoKSB7CiAgZGVmZXJy
ZWQtLTsKICBpZiAoZGVmZXJyZWQ8PTApIHsKICAgIGJlZm9yZU9ic2VydmVyU2V0LmNsZWFyKCk7
CiAgICBvYnNlcnZlclNldC5mbHVzaCgpOwogIH0KfQoKRW1iZXIuZW5kUHJvcGVydHlDaGFuZ2Vz
ID0gZW5kUHJvcGVydHlDaGFuZ2VzOwoKLyoqCiAgTWFrZSBhIHNlcmllcyBvZiBwcm9wZXJ0eSBj
aGFuZ2VzIHRvZ2V0aGVyIGluIGFuCiAgZXhjZXB0aW9uLXNhZmUgd2F5LgoKICBgYGBqYXZhc2Ny
aXB0CiAgRW1iZXIuY2hhbmdlUHJvcGVydGllcyhmdW5jdGlvbigpIHsKICAgIG9iajEuc2V0KCdm
b28nLCBtYXlCbG93VXBXaGVuU2V0KTsKICAgIG9iajIuc2V0KCdiYXInLCBiYXopOwogIH0pOwog
IGBgYAoKICBAbWV0aG9kIGNoYW5nZVByb3BlcnRpZXMKICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxs
YmFjawogIEBwYXJhbSBbYmluZGluZ10KKi8KRW1iZXIuY2hhbmdlUHJvcGVydGllcyA9IGZ1bmN0
aW9uKGNiLCBiaW5kaW5nKSB7CiAgYmVnaW5Qcm9wZXJ0eUNoYW5nZXMoKTsKICB0cnlGaW5hbGx5
KGNiLCBlbmRQcm9wZXJ0eUNoYW5nZXMsIGJpbmRpbmcpOwp9OwoKZnVuY3Rpb24gbm90aWZ5QmVm
b3JlT2JzZXJ2ZXJzKG9iaiwga2V5TmFtZSkgewogIGlmIChvYmouaXNEZXN0cm95aW5nKSB7IHJl
dHVybjsgfQoKICB2YXIgZXZlbnROYW1lID0ga2V5TmFtZSArICc6YmVmb3JlJywgbGlzdGVuZXJz
LCBkaWZmOwogIGlmIChkZWZlcnJlZCkgewogICAgbGlzdGVuZXJzID0gYmVmb3JlT2JzZXJ2ZXJT
ZXQuYWRkKG9iaiwga2V5TmFtZSwgZXZlbnROYW1lKTsKICAgIGRpZmYgPSBsaXN0ZW5lcnNEaWZm
KG9iaiwgZXZlbnROYW1lLCBsaXN0ZW5lcnMpOwogICAgc2VuZEV2ZW50KG9iaiwgZXZlbnROYW1l
LCBbb2JqLCBrZXlOYW1lXSwgZGlmZik7CiAgfSBlbHNlIHsKICAgIHNlbmRFdmVudChvYmosIGV2
ZW50TmFtZSwgW29iaiwga2V5TmFtZV0pOwogIH0KfQoKZnVuY3Rpb24gbm90aWZ5T2JzZXJ2ZXJz
KG9iaiwga2V5TmFtZSkgewogIGlmIChvYmouaXNEZXN0cm95aW5nKSB7IHJldHVybjsgfQoKICB2
YXIgZXZlbnROYW1lID0ga2V5TmFtZSArICc6Y2hhbmdlJywgbGlzdGVuZXJzOwogIGlmIChkZWZl
cnJlZCkgewogICAgbGlzdGVuZXJzID0gb2JzZXJ2ZXJTZXQuYWRkKG9iaiwga2V5TmFtZSwgZXZl
bnROYW1lKTsKICAgIGxpc3RlbmVyc1VuaW9uKG9iaiwgZXZlbnROYW1lLCBsaXN0ZW5lcnMpOwog
IH0gZWxzZSB7CiAgICBzZW5kRXZlbnQob2JqLCBldmVudE5hbWUsIFtvYmosIGtleU5hbWVdKTsK
ICB9Cn0KCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLy8gTUVUQV9LRVkKLy8gX2dldFBhdGgKLy8g
cHJvcGVydHlXaWxsQ2hhbmdlLCBwcm9wZXJ0eURpZENoYW5nZQoKdmFyIE1FVEFfS0VZID0gRW1i
ZXIuTUVUQV9LRVksCiAgICBNQU5EQVRPUllfU0VUVEVSID0gRW1iZXIuRU5WLk1BTkRBVE9SWV9T
RVRURVIsCiAgICBJU19HTE9CQUwgPSAvXihbQS1aJF18KFswLTldW0EtWiRdKSkvLAogICAgZ2V0
UGF0aCA9IEVtYmVyLl9nZXRQYXRoOwoKLyoqCiAgU2V0cyB0aGUgdmFsdWUgb2YgYSBwcm9wZXJ0
eSBvbiBhbiBvYmplY3QsIHJlc3BlY3RpbmcgY29tcHV0ZWQgcHJvcGVydGllcwogIGFuZCBub3Rp
Znlpbmcgb2JzZXJ2ZXJzIGFuZCBvdGhlciBsaXN0ZW5lcnMgb2YgdGhlIGNoYW5nZS4gSWYgdGhl
CiAgcHJvcGVydHkgaXMgbm90IGRlZmluZWQgYnV0IHRoZSBvYmplY3QgaW1wbGVtZW50cyB0aGUg
YHNldFVua25vd25Qcm9wZXJ0eWAKICBtZXRob2QgdGhlbiB0aGF0IHdpbGwgYmUgaW52b2tlZCBh
cyB3ZWxsLgoKICBJZiB5b3UgcGxhbiB0byBydW4gb24gSUU4IGFuZCBvbGRlciBicm93c2VycyB0
aGVuIHlvdSBzaG91bGQgdXNlIHRoaXMKICBtZXRob2QgYW55dGltZSB5b3Ugd2FudCB0byBzZXQg
YSBwcm9wZXJ0eSBvbiBhbiBvYmplY3QgdGhhdCB5b3UgZG9uJ3QKICBrbm93IGZvciBzdXJlIGlz
IHByaXZhdGUuIChQcm9wZXJ0aWVzIGJlZ2lubmluZyB3aXRoIGFuIHVuZGVyc2NvcmUgJ18nCiAg
YXJlIGNvbnNpZGVyZWQgcHJpdmF0ZS4pCgogIE9uIGFsbCBuZXdlciBicm93c2VycywgeW91IG9u
bHkgbmVlZCB0byB1c2UgdGhpcyBtZXRob2QgdG8gc2V0CiAgcHJvcGVydGllcyBpZiB0aGUgcHJv
cGVydHkgbWlnaHQgbm90IGJlIGRlZmluZWQgb24gdGhlIG9iamVjdCBhbmQgeW91IHdhbnQKICB0
byByZXNwZWN0IHRoZSBgc2V0VW5rbm93blByb3BlcnR5YCBoYW5kbGVyLiBPdGhlcndpc2UgeW91
IGNhbiBpZ25vcmUgdGhpcwogIG1ldGhvZC4KCiAgQG1ldGhvZCBzZXQKICBAZm9yIEVtYmVyCiAg
QHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICBAcGFyYW0ge1N0cmlu
Z30ga2V5TmFtZSBUaGUgcHJvcGVydHkga2V5IHRvIHNldAogIEBwYXJhbSB7T2JqZWN0fSB2YWx1
ZSBUaGUgdmFsdWUgdG8gc2V0CiAgQHJldHVybiB7T2JqZWN0fSB0aGUgcGFzc2VkIHZhbHVlLgoq
Lwp2YXIgc2V0ID0gZnVuY3Rpb24gc2V0KG9iaiwga2V5TmFtZSwgdmFsdWUsIHRvbGVyYW50KSB7
CiAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSB7CiAgICBFbWJlci5hc3NlcnQoIlBhdGgg
JyIgKyBvYmogKyAiJyBtdXN0IGJlIGdsb2JhbCBpZiBubyBvYmogaXMgZ2l2ZW4uIiwgSVNfR0xP
QkFMLnRlc3Qob2JqKSk7CiAgICB2YWx1ZSA9IGtleU5hbWU7CiAgICBrZXlOYW1lID0gb2JqOwog
ICAgb2JqID0gbnVsbDsKICB9CgogIEVtYmVyLmFzc2VydCgiQ2Fubm90IGNhbGwgc2V0IHdpdGgg
Iisga2V5TmFtZSArIiBrZXkuIiwgISFrZXlOYW1lKTsKCiAgaWYgKCFvYmogfHwga2V5TmFtZS5p
bmRleE9mKCcuJykgIT09IC0xKSB7CiAgICByZXR1cm4gc2V0UGF0aChvYmosIGtleU5hbWUsIHZh
bHVlLCB0b2xlcmFudCk7CiAgfQoKICBFbWJlci5hc3NlcnQoIllvdSBuZWVkIHRvIHByb3ZpZGUg
YW4gb2JqZWN0IGFuZCBrZXkgdG8gYHNldGAuIiwgISFvYmogJiYga2V5TmFtZSAhPT0gdW5kZWZp
bmVkKTsKICBFbWJlci5hc3NlcnQoJ2NhbGxpbmcgc2V0IG9uIGRlc3Ryb3llZCBvYmplY3QnLCAh
b2JqLmlzRGVzdHJveWVkKTsKCiAgdmFyIG1ldGEgPSBvYmpbTUVUQV9LRVldLCBkZXNjID0gbWV0
YSAmJiBtZXRhLmRlc2NzW2tleU5hbWVdLAogICAgICBpc1Vua25vd24sIGN1cnJlbnRWYWx1ZTsK
ICBpZiAoZGVzYykgewogICAgZGVzYy5zZXQob2JqLCBrZXlOYW1lLCB2YWx1ZSk7CiAgfSBlbHNl
IHsKICAgIGlzVW5rbm93biA9ICdvYmplY3QnID09PSB0eXBlb2Ygb2JqICYmICEoa2V5TmFtZSBp
biBvYmopOwoKICAgIC8vIHNldFVua25vd25Qcm9wZXJ0eSBpcyBjYWxsZWQgaWYgYG9iamAgaXMg
YW4gb2JqZWN0LAogICAgLy8gdGhlIHByb3BlcnR5IGRvZXMgbm90IGFscmVhZHkgZXhpc3QsIGFu
ZCB0aGUKICAgIC8vIGBzZXRVbmtub3duUHJvcGVydHlgIG1ldGhvZCBleGlzdHMgb24gdGhlIG9i
amVjdAogICAgaWYgKGlzVW5rbm93biAmJiAnZnVuY3Rpb24nID09PSB0eXBlb2Ygb2JqLnNldFVu
a25vd25Qcm9wZXJ0eSkgewogICAgICBvYmouc2V0VW5rbm93blByb3BlcnR5KGtleU5hbWUsIHZh
bHVlKTsKICAgIH0gZWxzZSBpZiAobWV0YSAmJiBtZXRhLndhdGNoaW5nW2tleU5hbWVdID4gMCkg
ewogICAgICBpZiAoTUFOREFUT1JZX1NFVFRFUikgewogICAgICAgIGN1cnJlbnRWYWx1ZSA9IG1l
dGEudmFsdWVzW2tleU5hbWVdOwogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRWYWx1ZSA9
IG9ialtrZXlOYW1lXTsKICAgICAgfQogICAgICAvLyBvbmx5IHRyaWdnZXIgYSBjaGFuZ2UgaWYg
dGhlIHZhbHVlIGhhcyBjaGFuZ2VkCiAgICAgIGlmICh2YWx1ZSAhPT0gY3VycmVudFZhbHVlKSB7
CiAgICAgICAgRW1iZXIucHJvcGVydHlXaWxsQ2hhbmdlKG9iaiwga2V5TmFtZSk7CiAgICAgICAg
aWYgKE1BTkRBVE9SWV9TRVRURVIpIHsKICAgICAgICAgIGlmICgoY3VycmVudFZhbHVlID09PSB1
bmRlZmluZWQgJiYgIShrZXlOYW1lIGluIG9iaikpIHx8ICFvYmoucHJvcGVydHlJc0VudW1lcmFi
bGUoa2V5TmFtZSkpIHsKICAgICAgICAgICAgRW1iZXIuZGVmaW5lUHJvcGVydHkob2JqLCBrZXlO
YW1lLCBudWxsLCB2YWx1ZSk7IC8vIHNldHVwIG1hbmRhdG9yeSBzZXR0ZXIKICAgICAgICAgIH0g
ZWxzZSB7CiAgICAgICAgICAgIG1ldGEudmFsdWVzW2tleU5hbWVdID0gdmFsdWU7CiAgICAgICAg
ICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9ialtrZXlOYW1lXSA9IHZhbHVlOwogICAg
ICAgIH0KICAgICAgICBFbWJlci5wcm9wZXJ0eURpZENoYW5nZShvYmosIGtleU5hbWUpOwogICAg
ICB9CiAgICB9IGVsc2UgewogICAgICBvYmpba2V5TmFtZV0gPSB2YWx1ZTsKICAgIH0KICB9CiAg
cmV0dXJuIHZhbHVlOwp9OwoKLy8gQ3VycmVudGx5IHVzZWQgb25seSBieSBFbWJlciBEYXRhIHRl
c3RzCmlmIChFbWJlci5jb25maWcub3ZlcnJpZGVBY2Nlc3NvcnMpIHsKICBFbWJlci5zZXQgPSBz
ZXQ7CiAgRW1iZXIuY29uZmlnLm92ZXJyaWRlQWNjZXNzb3JzKCk7CiAgc2V0ID0gRW1iZXIuc2V0
Owp9CgpmdW5jdGlvbiBzZXRQYXRoKHJvb3QsIHBhdGgsIHZhbHVlLCB0b2xlcmFudCkgewogIHZh
ciBrZXlOYW1lOwoKICAvLyBnZXQgdGhlIGxhc3QgcGFydCBvZiB0aGUgcGF0aAogIGtleU5hbWUg
PSBwYXRoLnNsaWNlKHBhdGgubGFzdEluZGV4T2YoJy4nKSArIDEpOwoKICAvLyBnZXQgdGhlIGZp
cnN0IHBhcnQgb2YgdGhlIHBhcnQKICBwYXRoICAgID0gKHBhdGggPT09IGtleU5hbWUpID8ga2V5
TmFtZSA6IHBhdGguc2xpY2UoMCwgcGF0aC5sZW5ndGgtKGtleU5hbWUubGVuZ3RoKzEpKTsKCiAg
Ly8gdW5sZXNzIHRoZSBwYXRoIGlzIHRoaXMsIGxvb2sgdXAgdGhlIGZpcnN0IHBhcnQgdG8KICAv
LyBnZXQgdGhlIHJvb3QKICBpZiAocGF0aCAhPT0gJ3RoaXMnKSB7CiAgICByb290ID0gZ2V0UGF0
aChyb290LCBwYXRoKTsKICB9CgogIGlmICgha2V5TmFtZSB8fCBrZXlOYW1lLmxlbmd0aCA9PT0g
MCkgewogICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCdQcm9wZXJ0eSBzZXQgZmFpbGVkOiBZb3Ug
cGFzc2VkIGFuIGVtcHR5IHBhdGgnKTsKICB9CgogIGlmICghcm9vdCkgewogICAgaWYgKHRvbGVy
YW50KSB7IHJldHVybjsgfQogICAgZWxzZSB7IHRocm93IG5ldyBFbWJlci5FcnJvcignUHJvcGVy
dHkgc2V0IGZhaWxlZDogb2JqZWN0IGluIHBhdGggIicrcGF0aCsnIiBjb3VsZCBub3QgYmUgZm91
bmQgb3Igd2FzIGRlc3Ryb3llZC4nKTsgfQogIH0KCiAgcmV0dXJuIHNldChyb290LCBrZXlOYW1l
LCB2YWx1ZSk7Cn0KCkVtYmVyLnNldCA9IHNldDsKCi8qKgogIEVycm9yLXRvbGVyYW50IGZvcm0g
b2YgYEVtYmVyLnNldGAuIFdpbGwgbm90IGJsb3cgdXAgaWYgYW55IHBhcnQgb2YgdGhlCiAgY2hh
aW4gaXMgYHVuZGVmaW5lZGAsIGBudWxsYCwgb3IgZGVzdHJveWVkLgoKICBUaGlzIGlzIHByaW1h
cmlseSB1c2VkIHdoZW4gc3luY2luZyBiaW5kaW5ncywgd2hpY2ggbWF5IHRyeSB0byB1cGRhdGUg
YWZ0ZXIKICBhbiBvYmplY3QgaGFzIGJlZW4gZGVzdHJveWVkLgoKICBAbWV0aG9kIHRyeVNldAog
IEBmb3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gbW9kaWZ5Lgog
IEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBwcm9wZXJ0eSBwYXRoIHRvIHNldAogIEBwYXJhbSB7
T2JqZWN0fSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0CiovCkVtYmVyLnRyeVNldCA9IGZ1bmN0aW9u
KHJvb3QsIHBhdGgsIHZhbHVlKSB7CiAgcmV0dXJuIHNldChyb290LCBwYXRoLCB2YWx1ZSwgdHJ1
ZSk7Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyLW1ldGFsCiov
CgovKgogIEphdmFTY3JpcHQgKGJlZm9yZSBFUzYpIGRvZXMgbm90IGhhdmUgYSBNYXAgaW1wbGVt
ZW50YXRpb24uIE9iamVjdHMsCiAgd2hpY2ggYXJlIG9mdGVuIHVzZWQgYXMgZGljdGlvbmFyaWVz
LCBtYXkgb25seSBoYXZlIFN0cmluZ3MgYXMga2V5cy4KCiAgQmVjYXVzZSBFbWJlciBoYXMgYSB3
YXkgdG8gZ2V0IGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIGV2ZXJ5IG9iamVjdAogIHZpYSBgRW1i
ZXIuZ3VpZEZvcmAsIHdlIGNhbiBpbXBsZW1lbnQgYSBwZXJmb3JtYW50IE1hcCB3aXRoIGFyYml0
cmFyeQogIGtleXMuIEJlY2F1c2UgaXQgaXMgY29tbW9ubHkgdXNlZCBpbiBsb3ctbGV2ZWwgYm9v
a2tlZXBpbmcsIE1hcCBpcwogIGltcGxlbWVudGVkIGFzIGEgcHVyZSBKYXZhU2NyaXB0IG9iamVj
dCBmb3IgcGVyZm9ybWFuY2UuCgogIFRoaXMgaW1wbGVtZW50YXRpb24gZm9sbG93cyB0aGUgY3Vy
cmVudCBpdGVyYXRpb24gb2YgdGhlIEVTNiBwcm9wb3NhbCBmb3IKICBtYXBzIChodHRwOi8vd2lr
aS5lY21hc2NyaXB0Lm9yZy9kb2t1LnBocD9pZD1oYXJtb255OnNpbXBsZV9tYXBzX2FuZF9zZXRz
KSwKICB3aXRoIHR3byBleGNlcHRpb25zLiBGaXJzdCwgYmVjYXVzZSB3ZSBuZWVkIG91ciBpbXBs
ZW1lbnRhdGlvbiB0byBiZSBwbGVhc2FudAogIG9uIG9sZGVyIGJyb3dzZXJzLCB3ZSBkbyBub3Qg
dXNlIHRoZSBgZGVsZXRlYCBuYW1lICh1c2luZyBgcmVtb3ZlYCBpbnN0ZWFkKS4KICBTZWNvbmQs
IGFzIHdlIGRvIG5vdCBoYXZlIHRoZSBsdXh1cnkgb2YgaW4tVk0gaXRlcmF0aW9uLCB3ZSBpbXBs
ZW1lbnQgYQogIGZvckVhY2ggbWV0aG9kIGZvciBpdGVyYXRpb24uCgogIE1hcCBpcyBtb2NrZWQg
b3V0IHRvIGxvb2sgbGlrZSBhbiBFbWJlciBvYmplY3QsIHNvIHlvdSBjYW4gZG8KICBgRW1iZXIu
TWFwLmNyZWF0ZSgpYCBmb3Igc3ltbWV0cnkgd2l0aCBvdGhlciBFbWJlciBjbGFzc2VzLgoqLwp2
YXIgc2V0ID0gRW1iZXIuc2V0LAogICAgZ3VpZEZvciA9IEVtYmVyLmd1aWRGb3IsCiAgICBpbmRl
eE9mID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMuaW5kZXhPZjsKCnZhciBjb3B5ID0gZnVuY3Rpb24o
b2JqKSB7CiAgdmFyIG91dHB1dCA9IHt9OwoKICBmb3IgKHZhciBwcm9wIGluIG9iaikgewogICAg
aWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgeyBvdXRwdXRbcHJvcF0gPSBvYmpbcHJvcF07
IH0KICB9CgogIHJldHVybiBvdXRwdXQ7Cn07Cgp2YXIgY29weU1hcCA9IGZ1bmN0aW9uKG9yaWdp
bmFsLCBuZXdPYmplY3QpIHsKICB2YXIga2V5cyA9IG9yaWdpbmFsLmtleXMuY29weSgpLAogICAg
ICB2YWx1ZXMgPSBjb3B5KG9yaWdpbmFsLnZhbHVlcyk7CgogIG5ld09iamVjdC5rZXlzID0ga2V5
czsKICBuZXdPYmplY3QudmFsdWVzID0gdmFsdWVzOwogIG5ld09iamVjdC5sZW5ndGggPSBvcmln
aW5hbC5sZW5ndGg7CgogIHJldHVybiBuZXdPYmplY3Q7Cn07CgovKioKICBUaGlzIGNsYXNzIGlz
IHVzZWQgaW50ZXJuYWxseSBieSBFbWJlciBhbmQgRW1iZXIgRGF0YS4KICBQbGVhc2UgZG8gbm90
IHVzZSBpdCBhdCB0aGlzIHRpbWUuIFdlIHBsYW4gdG8gY2xlYW4gaXQgdXAKICBhbmQgYWRkIG1h
bnkgdGVzdHMgc29vbi4KCiAgQGNsYXNzIE9yZGVyZWRTZXQKICBAbmFtZXNwYWNlIEVtYmVyCiAg
QGNvbnN0cnVjdG9yCiAgQHByaXZhdGUKKi8KdmFyIE9yZGVyZWRTZXQgPSBFbWJlci5PcmRlcmVk
U2V0ID0gZnVuY3Rpb24oKSB7CiAgdGhpcy5jbGVhcigpOwp9OwoKLyoqCiAgQG1ldGhvZCBjcmVh
dGUKICBAc3RhdGljCiAgQHJldHVybiB7RW1iZXIuT3JkZXJlZFNldH0KKi8KT3JkZXJlZFNldC5j
cmVhdGUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gbmV3IE9yZGVyZWRTZXQoKTsKfTsKCgpPcmRl
cmVkU2V0LnByb3RvdHlwZSA9IHsKICAvKioKICAgIEBtZXRob2QgY2xlYXIKICAqLwogIGNsZWFy
OiBmdW5jdGlvbigpIHsKICAgIHRoaXMucHJlc2VuY2VTZXQgPSB7fTsKICAgIHRoaXMubGlzdCA9
IFtdOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBhZGQKICAgIEBwYXJhbSBvYmoKICAqLwogIGFk
ZDogZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgZ3VpZCA9IGd1aWRGb3Iob2JqKSwKICAgICAgICBw
cmVzZW5jZVNldCA9IHRoaXMucHJlc2VuY2VTZXQsCiAgICAgICAgbGlzdCA9IHRoaXMubGlzdDsK
CiAgICBpZiAoZ3VpZCBpbiBwcmVzZW5jZVNldCkgeyByZXR1cm47IH0KCiAgICBwcmVzZW5jZVNl
dFtndWlkXSA9IHRydWU7CiAgICBsaXN0LnB1c2gob2JqKTsKICB9LAoKICAvKioKICAgIEBtZXRo
b2QgcmVtb3ZlCiAgICBAcGFyYW0gb2JqCiAgKi8KICByZW1vdmU6IGZ1bmN0aW9uKG9iaikgewog
ICAgdmFyIGd1aWQgPSBndWlkRm9yKG9iaiksCiAgICAgICAgcHJlc2VuY2VTZXQgPSB0aGlzLnBy
ZXNlbmNlU2V0LAogICAgICAgIGxpc3QgPSB0aGlzLmxpc3Q7CgogICAgZGVsZXRlIHByZXNlbmNl
U2V0W2d1aWRdOwoKICAgIHZhciBpbmRleCA9IGluZGV4T2YuY2FsbChsaXN0LCBvYmopOwogICAg
aWYgKGluZGV4ID4gLTEpIHsKICAgICAgbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgfQogIH0s
CgogIC8qKgogICAgQG1ldGhvZCBpc0VtcHR5CiAgICBAcmV0dXJuIHtCb29sZWFufQogICovCiAg
aXNFbXB0eTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5saXN0Lmxlbmd0aCA9PT0gMDsK
ICB9LAoKICAvKioKICAgIEBtZXRob2QgaGFzCiAgICBAcGFyYW0gb2JqCiAgICBAcmV0dXJuIHtC
b29sZWFufQogICovCiAgaGFzOiBmdW5jdGlvbihvYmopIHsKICAgIHZhciBndWlkID0gZ3VpZEZv
cihvYmopLAogICAgICAgIHByZXNlbmNlU2V0ID0gdGhpcy5wcmVzZW5jZVNldDsKCiAgICByZXR1
cm4gZ3VpZCBpbiBwcmVzZW5jZVNldDsKICB9LAoKICAvKioKICAgIEBtZXRob2QgZm9yRWFjaAog
ICAgQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgIEBwYXJhbSBzZWxmCiAgKi8KICBmb3JFYWNoOiBm
dW5jdGlvbihmbiwgc2VsZikgewogICAgLy8gYWxsb3cgbXV0YXRpb24gZHVyaW5nIGl0ZXJhdGlv
bgogICAgdmFyIGxpc3QgPSB0aGlzLnRvQXJyYXkoKTsKCiAgICBmb3IgKHZhciBpID0gMCwgaiA9
IGxpc3QubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgIGZuLmNhbGwoc2VsZiwgbGlzdFtpXSk7
CiAgICB9CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIHRvQXJyYXkKICAgIEByZXR1cm4ge0FycmF5
fQogICovCiAgdG9BcnJheTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5saXN0LnNsaWNl
KCk7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGNvcHkKICAgIEByZXR1cm4ge0VtYmVyLk9yZGVy
ZWRTZXR9CiAgKi8KICBjb3B5OiBmdW5jdGlvbigpIHsKICAgIHZhciBzZXQgPSBuZXcgT3JkZXJl
ZFNldCgpOwoKICAgIHNldC5wcmVzZW5jZVNldCA9IGNvcHkodGhpcy5wcmVzZW5jZVNldCk7CiAg
ICBzZXQubGlzdCA9IHRoaXMudG9BcnJheSgpOwoKICAgIHJldHVybiBzZXQ7CiAgfQp9OwoKLyoq
CiAgQSBNYXAgc3RvcmVzIHZhbHVlcyBpbmRleGVkIGJ5IGtleXMuIFVubGlrZSBKYXZhU2NyaXB0
J3MKICBkZWZhdWx0IE9iamVjdHMsIHRoZSBrZXlzIG9mIGEgTWFwIGNhbiBiZSBhbnkgSmF2YVNj
cmlwdAogIG9iamVjdC4KCiAgSW50ZXJuYWxseSwgYSBNYXAgaGFzIHR3byBkYXRhIHN0cnVjdHVy
ZXM6CgogIDEuIGBrZXlzYDogYW4gT3JkZXJlZFNldCBvZiBhbGwgb2YgdGhlIGV4aXN0aW5nIGtl
eXMKICAyLiBgdmFsdWVzYDogYSBKYXZhU2NyaXB0IE9iamVjdCBpbmRleGVkIGJ5IHRoZSBgRW1i
ZXIuZ3VpZEZvcihrZXkpYAoKICBXaGVuIGEga2V5L3ZhbHVlIHBhaXIgaXMgYWRkZWQgZm9yIHRo
ZSBmaXJzdCB0aW1lLCB3ZQogIGFkZCB0aGUga2V5IHRvIHRoZSBga2V5c2AgT3JkZXJlZFNldCwg
YW5kIGNyZWF0ZSBvcgogIHJlcGxhY2UgYW4gZW50cnkgaW4gYHZhbHVlc2AuIFdoZW4gYW4gZW50
cnkgaXMgZGVsZXRlZCwKICB3ZSBkZWxldGUgaXRzIGVudHJ5IGluIGBrZXlzYCBhbmQgYHZhbHVl
c2AuCgogIEBjbGFzcyBNYXAKICBAbmFtZXNwYWNlIEVtYmVyCiAgQHByaXZhdGUKICBAY29uc3Ry
dWN0b3IKKi8KdmFyIE1hcCA9IEVtYmVyLk1hcCA9IGZ1bmN0aW9uKCkgewogIHRoaXMua2V5cyA9
IEVtYmVyLk9yZGVyZWRTZXQuY3JlYXRlKCk7CiAgdGhpcy52YWx1ZXMgPSB7fTsKfTsKCi8qKgog
IEBtZXRob2QgY3JlYXRlCiAgQHN0YXRpYwoqLwpNYXAuY3JlYXRlID0gZnVuY3Rpb24oKSB7CiAg
cmV0dXJuIG5ldyBNYXAoKTsKfTsKCk1hcC5wcm90b3R5cGUgPSB7CiAgLyoqCiAgICBUaGlzIHBy
b3BlcnR5IHdpbGwgY2hhbmdlIGFzIHRoZSBudW1iZXIgb2Ygb2JqZWN0cyBpbiB0aGUgbWFwIGNo
YW5nZXMuCiAgIAogICAgQHByb3BlcnR5IGxlbmd0aAogICAgQHR5cGUgbnVtYmVyCiAgICBAZGVm
YXVsdCAwCiAgKi8KICBsZW5ndGg6IDAsCiAgICAKICAgIAogIC8qKgogICAgUmV0cmlldmUgdGhl
IHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIGtleS4KCiAgICBAbWV0aG9kIGdldAogICAg
QHBhcmFtIHsqfSBrZXkKICAgIEByZXR1cm4geyp9IHRoZSB2YWx1ZSBhc3NvY2lhdGVkIHdpdGgg
dGhlIGtleSwgb3IgYHVuZGVmaW5lZGAKICAqLwogIGdldDogZnVuY3Rpb24oa2V5KSB7CiAgICB2
YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgZ3VpZCA9IGd1aWRGb3Ioa2V5KTsKCiAg
ICByZXR1cm4gdmFsdWVzW2d1aWRdOwogIH0sCgogIC8qKgogICAgQWRkcyBhIHZhbHVlIHRvIHRo
ZSBtYXAuIElmIGEgdmFsdWUgZm9yIHRoZSBnaXZlbiBrZXkgaGFzIGFscmVhZHkgYmVlbgogICAg
cHJvdmlkZWQsIHRoZSBuZXcgdmFsdWUgd2lsbCByZXBsYWNlIHRoZSBvbGQgdmFsdWUuCgogICAg
QG1ldGhvZCBzZXQKICAgIEBwYXJhbSB7Kn0ga2V5CiAgICBAcGFyYW0geyp9IHZhbHVlCiAgKi8K
ICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIHZhciBrZXlzID0gdGhpcy5rZXlzLAog
ICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgIGd1aWQgPSBndWlkRm9yKGtleSk7
CgogICAga2V5cy5hZGQoa2V5KTsKICAgIHZhbHVlc1tndWlkXSA9IHZhbHVlOwogICAgc2V0KHRo
aXMsICdsZW5ndGgnLCBrZXlzLmxpc3QubGVuZ3RoKTsKICB9LAoKICAvKioKICAgIFJlbW92ZXMg
YSB2YWx1ZSBmcm9tIHRoZSBtYXAgZm9yIGFuIGFzc29jaWF0ZWQga2V5LgoKICAgIEBtZXRob2Qg
cmVtb3ZlCiAgICBAcGFyYW0geyp9IGtleQogICAgQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBh
biBpdGVtIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndpc2UKICAqLwogIHJlbW92ZTogZnVuY3Rp
b24oa2V5KSB7CiAgICAvLyBkb24ndCB1c2UgRVM2ICJkZWxldGUiIGJlY2F1c2UgaXQgd2lsbCBi
ZSBhbm5veWluZwogICAgLy8gdG8gdXNlIGluIGJyb3dzZXJzIHRoYXQgYXJlIG5vdCBFUzYgZnJp
ZW5kbHk7CiAgICB2YXIga2V5cyA9IHRoaXMua2V5cywKICAgICAgICB2YWx1ZXMgPSB0aGlzLnZh
bHVlcywKICAgICAgICBndWlkID0gZ3VpZEZvcihrZXkpOwoKICAgIGlmICh2YWx1ZXMuaGFzT3du
UHJvcGVydHkoZ3VpZCkpIHsKICAgICAga2V5cy5yZW1vdmUoa2V5KTsKICAgICAgZGVsZXRlIHZh
bHVlc1tndWlkXTsKICAgICAgc2V0KHRoaXMsICdsZW5ndGgnLCBrZXlzLmxpc3QubGVuZ3RoKTsK
ICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9
CiAgfSwKCiAgLyoqCiAgICBDaGVjayB3aGV0aGVyIGEga2V5IGlzIHByZXNlbnQuCgogICAgQG1l
dGhvZCBoYXMKICAgIEBwYXJhbSB7Kn0ga2V5CiAgICBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlm
IHRoZSBpdGVtIHdhcyBwcmVzZW50LCBmYWxzZSBvdGhlcndpc2UKICAqLwogIGhhczogZnVuY3Rp
b24oa2V5KSB7CiAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgZ3VpZCA9IGd1
aWRGb3Ioa2V5KTsKCiAgICByZXR1cm4gdmFsdWVzLmhhc093blByb3BlcnR5KGd1aWQpOwogIH0s
CgogIC8qKgogICAgSXRlcmF0ZSBvdmVyIGFsbCB0aGUga2V5cyBhbmQgdmFsdWVzLiBDYWxscyB0
aGUgZnVuY3Rpb24gb25jZQogICAgZm9yIGVhY2gga2V5LCBwYXNzaW5nIGluIHRoZSBrZXkgYW5k
IHZhbHVlLCBpbiB0aGF0IG9yZGVyLgoKICAgIFRoZSBrZXlzIGFyZSBndWFyYW50ZWVkIHRvIGJl
IGl0ZXJhdGVkIG92ZXIgaW4gaW5zZXJ0aW9uIG9yZGVyLgoKICAgIEBtZXRob2QgZm9yRWFjaAog
ICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgIEBwYXJhbSB7Kn0gc2VsZiBpZiBwYXNz
ZWQsIHRoZSBgdGhpc2AgdmFsdWUgaW5zaWRlIHRoZQogICAgICBjYWxsYmFjay4gQnkgZGVmYXVs
dCwgYHRoaXNgIGlzIHRoZSBtYXAuCiAgKi8KICBmb3JFYWNoOiBmdW5jdGlvbihjYWxsYmFjaywg
c2VsZikgewogICAgdmFyIGtleXMgPSB0aGlzLmtleXMsCiAgICAgICAgdmFsdWVzID0gdGhpcy52
YWx1ZXM7CgogICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICB2YXIgZ3VpZCA9
IGd1aWRGb3Ioa2V5KTsKICAgICAgY2FsbGJhY2suY2FsbChzZWxmLCBrZXksIHZhbHVlc1tndWlk
XSk7CiAgICB9KTsKICB9LAoKICAvKioKICAgIEBtZXRob2QgY29weQogICAgQHJldHVybiB7RW1i
ZXIuTWFwfQogICovCiAgY29weTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gY29weU1hcCh0aGlz
LCBuZXcgTWFwKCkpOwogIH0KfTsKCi8qKgogIEBjbGFzcyBNYXBXaXRoRGVmYXVsdAogIEBuYW1l
c3BhY2UgRW1iZXIKICBAZXh0ZW5kcyBFbWJlci5NYXAKICBAcHJpdmF0ZQogIEBjb25zdHJ1Y3Rv
cgogIEBwYXJhbSBbb3B0aW9uc10KICAgIEBwYXJhbSB7Kn0gW29wdGlvbnMuZGVmYXVsdFZhbHVl
XQoqLwp2YXIgTWFwV2l0aERlZmF1bHQgPSBFbWJlci5NYXBXaXRoRGVmYXVsdCA9IGZ1bmN0aW9u
KG9wdGlvbnMpIHsKICBNYXAuY2FsbCh0aGlzKTsKICB0aGlzLmRlZmF1bHRWYWx1ZSA9IG9wdGlv
bnMuZGVmYXVsdFZhbHVlOwp9OwoKLyoqCiAgQG1ldGhvZCBjcmVhdGUKICBAc3RhdGljCiAgQHBh
cmFtIFtvcHRpb25zXQogICAgQHBhcmFtIHsqfSBbb3B0aW9ucy5kZWZhdWx0VmFsdWVdCiAgQHJl
dHVybiB7RW1iZXIuTWFwV2l0aERlZmF1bHR8RW1iZXIuTWFwfSBJZiBvcHRpb25zIGFyZSBwYXNz
ZWQsIHJldHVybnMKICAgIGBFbWJlci5NYXBXaXRoRGVmYXVsdGAgb3RoZXJ3aXNlIHJldHVybnMg
YEVtYmVyLk1hcGAKKi8KTWFwV2l0aERlZmF1bHQuY3JlYXRlID0gZnVuY3Rpb24ob3B0aW9ucykg
ewogIGlmIChvcHRpb25zKSB7CiAgICByZXR1cm4gbmV3IE1hcFdpdGhEZWZhdWx0KG9wdGlvbnMp
OwogIH0gZWxzZSB7CiAgICByZXR1cm4gbmV3IE1hcCgpOwogIH0KfTsKCk1hcFdpdGhEZWZhdWx0
LnByb3RvdHlwZSA9IEVtYmVyLmNyZWF0ZShNYXAucHJvdG90eXBlKTsKCi8qKgogIFJldHJpZXZl
IHRoZSB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggYSBnaXZlbiBrZXkuCgogIEBtZXRob2QgZ2V0CiAg
QHBhcmFtIHsqfSBrZXkKICBAcmV0dXJuIHsqfSB0aGUgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRo
ZSBrZXksIG9yIHRoZSBkZWZhdWx0IHZhbHVlCiovCk1hcFdpdGhEZWZhdWx0LnByb3RvdHlwZS5n
ZXQgPSBmdW5jdGlvbihrZXkpIHsKICB2YXIgaGFzVmFsdWUgPSB0aGlzLmhhcyhrZXkpOwoKICBp
ZiAoaGFzVmFsdWUpIHsKICAgIHJldHVybiBNYXAucHJvdG90eXBlLmdldC5jYWxsKHRoaXMsIGtl
eSk7CiAgfSBlbHNlIHsKICAgIHZhciBkZWZhdWx0VmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZShr
ZXkpOwogICAgdGhpcy5zZXQoa2V5LCBkZWZhdWx0VmFsdWUpOwogICAgcmV0dXJuIGRlZmF1bHRW
YWx1ZTsKICB9Cn07CgovKioKICBAbWV0aG9kIGNvcHkKICBAcmV0dXJuIHtFbWJlci5NYXBXaXRo
RGVmYXVsdH0KKi8KTWFwV2l0aERlZmF1bHQucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbigpIHsK
ICByZXR1cm4gY29weU1hcCh0aGlzLCBuZXcgTWFwV2l0aERlZmF1bHQoewogICAgZGVmYXVsdFZh
bHVlOiB0aGlzLmRlZmF1bHRWYWx1ZQogIH0pKTsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsK
ZnVuY3Rpb24gY29uc29sZU1ldGhvZChuYW1lKSB7CiAgdmFyIGNvbnNvbGVPYmosIGxvZ1RvQ29u
c29sZTsKICBpZiAoRW1iZXIuaW1wb3J0cy5jb25zb2xlKSB7CiAgICBjb25zb2xlT2JqID0gRW1i
ZXIuaW1wb3J0cy5jb25zb2xlOwogIH0gZWxzZSBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRl
ZmluZWQnKSB7CiAgICBjb25zb2xlT2JqID0gY29uc29sZTsKICB9CgogIHZhciBtZXRob2QgPSB0
eXBlb2YgY29uc29sZU9iaiA9PT0gJ29iamVjdCcgPyBjb25zb2xlT2JqW25hbWVdIDogbnVsbDsK
CiAgaWYgKG1ldGhvZCkgewogICAgLy8gT2xkZXIgSUUgZG9lc24ndCBzdXBwb3J0IGFwcGx5LCBi
dXQgQ2hyb21lIG5lZWRzIGl0CiAgICBpZiAobWV0aG9kLmFwcGx5KSB7CiAgICAgIGxvZ1RvQ29u
c29sZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1ldGhvZC5hcHBseShjb25zb2xlT2JqLCBhcmd1
bWVudHMpOwogICAgICB9OwogICAgICBsb2dUb0NvbnNvbGUuZGlzcGxheU5hbWUgPSAnY29uc29s
ZS4nICsgbmFtZTsKICAgICAgcmV0dXJuIGxvZ1RvQ29uc29sZTsKICAgIH0gZWxzZSB7CiAgICAg
IHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbWVzc2FnZSA9IEFycmF5LnByb3RvdHlw
ZS5qb2luLmNhbGwoYXJndW1lbnRzLCAnLCAnKTsKICAgICAgICBtZXRob2QobWVzc2FnZSk7CiAg
ICAgIH07CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBhc3NlcnRQb2x5ZmlsbCh0ZXN0LCBtZXNzYWdl
KSB7CiAgaWYgKCF0ZXN0KSB7CiAgICB0cnkgewogICAgICAvLyBhdHRlbXB0IHRvIHByZXNlcnZl
IHRoZSBzdGFjawogICAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoImFzc2VydGlvbiBmYWlsZWQ6
ICIgKyBtZXNzYWdlKTsKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgc2V0VGltZW91dChmdW5j
dGlvbigpIHsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfSwgMCk7CiAgICB9CiAgfQp9Cgov
KioKICBJbnNpZGUgRW1iZXItTWV0YWwsIHNpbXBseSB1c2VzIHRoZSBtZXRob2RzIGZyb20gYGlt
cG9ydHMuY29uc29sZWAuCiAgT3ZlcnJpZGUgdGhpcyB0byBwcm92aWRlIG1vcmUgcm9idXN0IGxv
Z2dpbmcgZnVuY3Rpb25hbGl0eS4KCiAgQGNsYXNzIExvZ2dlcgogIEBuYW1lc3BhY2UgRW1iZXIK
Ki8KRW1iZXIuTG9nZ2VyID0gewogIC8qKgogICBMb2dzIHRoZSBhcmd1bWVudHMgdG8gdGhlIGNv
bnNvbGUuCiAgIFlvdSBjYW4gcGFzcyBhcyBtYW55IGFyZ3VtZW50cyBhcyB5b3Ugd2FudCBhbmQg
dGhleSB3aWxsIGJlIGpvaW5lZCB0b2dldGhlciB3aXRoIGEgc3BhY2UuCgogICAgYGBgamF2YXNj
cmlwdAogICAgdmFyIGZvbyA9IDE7CiAgICBFbWJlci5Mb2dnZXIubG9nKCdsb2cgdmFsdWUgb2Yg
Zm9vOicsIGZvbyk7IC8vICJsb2cgdmFsdWUgb2YgZm9vOiAxIiB3aWxsIGJlIHByaW50ZWQgdG8g
dGhlIGNvbnNvbGUKICAgIGBgYAoKICAgQG1ldGhvZCBsb2cKICAgQGZvciBFbWJlci5Mb2dnZXIK
ICAgQHBhcmFtIHsqfSBhcmd1bWVudHMKICAqLwogIGxvZzogICBjb25zb2xlTWV0aG9kKCdsb2cn
KSAgIHx8IEVtYmVyLkssCgogIC8qKgogICBQcmludHMgdGhlIGFyZ3VtZW50cyB0byB0aGUgY29u
c29sZSB3aXRoIGEgd2FybmluZyBpY29uLgogICBZb3UgY2FuIHBhc3MgYXMgbWFueSBhcmd1bWVu
dHMgYXMgeW91IHdhbnQgYW5kIHRoZXkgd2lsbCBiZSBqb2luZWQgdG9nZXRoZXIgd2l0aCBhIHNw
YWNlLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLkxvZ2dlci53YXJuKCdTb21ldGhpbmcg
aGFwcGVuZWQhJyk7IC8vICJTb21ldGhpbmcgaGFwcGVuZWQhIiB3aWxsIGJlIHByaW50ZWQgdG8g
dGhlIGNvbnNvbGUgd2l0aCBhIHdhcm5pbmcgaWNvbi4KICAgIGBgYAoKICAgQG1ldGhvZCB3YXJu
CiAgIEBmb3IgRW1iZXIuTG9nZ2VyCiAgIEBwYXJhbSB7Kn0gYXJndW1lbnRzCiAgKi8KICB3YXJu
OiAgY29uc29sZU1ldGhvZCgnd2FybicpICB8fCBFbWJlci5LLAoKICAvKioKICAgUHJpbnRzIHRo
ZSBhcmd1bWVudHMgdG8gdGhlIGNvbnNvbGUgd2l0aCBhbiBlcnJvciBpY29uLCByZWQgdGV4dCBh
bmQgYSBzdGFjayB0cmFjZS4KICAgWW91IGNhbiBwYXNzIGFzIG1hbnkgYXJndW1lbnRzIGFzIHlv
dSB3YW50IGFuZCB0aGV5IHdpbGwgYmUgam9pbmVkIHRvZ2V0aGVyIHdpdGggYSBzcGFjZS4KCiAg
ICBgYGBqYXZhc2NyaXB0CiAgICBFbWJlci5Mb2dnZXIuZXJyb3IoJ0RhbmdlciEgRGFuZ2VyIScp
OyAvLyAiRGFuZ2VyISBEYW5nZXIhIiB3aWxsIGJlIHByaW50ZWQgdG8gdGhlIGNvbnNvbGUgaW4g
cmVkIHRleHQuCiAgICBgYGAKCiAgIEBtZXRob2QgZXJyb3IKICAgQGZvciBFbWJlci5Mb2dnZXIK
ICAgQHBhcmFtIHsqfSBhcmd1bWVudHMKICAqLwogIGVycm9yOiBjb25zb2xlTWV0aG9kKCdlcnJv
cicpIHx8IEVtYmVyLkssCgogIC8qKgogICBMb2dzIHRoZSBhcmd1bWVudHMgdG8gdGhlIGNvbnNv
bGUuCiAgIFlvdSBjYW4gcGFzcyBhcyBtYW55IGFyZ3VtZW50cyBhcyB5b3Ugd2FudCBhbmQgdGhl
eSB3aWxsIGJlIGpvaW5lZCB0b2dldGhlciB3aXRoIGEgc3BhY2UuCgogICAgYGBgamF2YXNjcmlw
dAogICAgdmFyIGZvbyA9IDE7CiAgICBFbWJlci5Mb2dnZXIuaW5mbygnbG9nIHZhbHVlIG9mIGZv
bzonLCBmb28pOyAvLyAibG9nIHZhbHVlIG9mIGZvbzogMSIgd2lsbCBiZSBwcmludGVkIHRvIHRo
ZSBjb25zb2xlCiAgICBgYGAKCiAgIEBtZXRob2QgaW5mbwogICBAZm9yIEVtYmVyLkxvZ2dlcgog
ICBAcGFyYW0geyp9IGFyZ3VtZW50cwogICovCiAgaW5mbzogIGNvbnNvbGVNZXRob2QoJ2luZm8n
KSAgfHwgRW1iZXIuSywKCiAgLyoqCiAgIExvZ3MgdGhlIGFyZ3VtZW50cyB0byB0aGUgY29uc29s
ZSBpbiBibHVlIHRleHQuCiAgIFlvdSBjYW4gcGFzcyBhcyBtYW55IGFyZ3VtZW50cyBhcyB5b3Ug
d2FudCBhbmQgdGhleSB3aWxsIGJlIGpvaW5lZCB0b2dldGhlciB3aXRoIGEgc3BhY2UuCgogICAg
YGBgamF2YXNjcmlwdAogICAgdmFyIGZvbyA9IDE7CiAgICBFbWJlci5Mb2dnZXIuZGVidWcoJ2xv
ZyB2YWx1ZSBvZiBmb286JywgZm9vKTsgLy8gImxvZyB2YWx1ZSBvZiBmb286IDEiIHdpbGwgYmUg
cHJpbnRlZCB0byB0aGUgY29uc29sZQogICAgYGBgCgogICBAbWV0aG9kIGRlYnVnCiAgIEBmb3Ig
RW1iZXIuTG9nZ2VyCiAgIEBwYXJhbSB7Kn0gYXJndW1lbnRzCiAgKi8KICBkZWJ1ZzogY29uc29s
ZU1ldGhvZCgnZGVidWcnKSB8fCBjb25zb2xlTWV0aG9kKCdpbmZvJykgfHwgRW1iZXIuSywKCiAg
LyoqCiAgIElmIHRoZSB2YWx1ZSBwYXNzZWQgaW50byBgRW1iZXIuTG9nZ2VyLmFzc2VydGAgaXMg
bm90IHRydXRoeSBpdCB3aWxsIHRocm93IGFuIGVycm9yIHdpdGggYSBzdGFjayB0cmFjZS4KCiAg
ICBgYGBqYXZhc2NyaXB0CiAgICBFbWJlci5Mb2dnZXIuYXNzZXJ0KHRydWUpOyAvLyB1bmRlZmlu
ZWQKICAgIEVtYmVyLkxvZ2dlci5hc3NlcnQodHJ1ZSA9PT0gZmFsc2UpOyAvLyBUaHJvd3MgYW4g
QXNzZXJ0aW9uIGZhaWxlZCBlcnJvci4KICAgIGBgYAoKICAgQG1ldGhvZCBhc3NlcnQKICAgQGZv
ciBFbWJlci5Mb2dnZXIKICAgQHBhcmFtIHtCb29sZWFufSBib29sIFZhbHVlIHRvIHRlc3QKICAq
LwogIGFzc2VydDogY29uc29sZU1ldGhvZCgnYXNzZXJ0JykgfHwgYXNzZXJ0UG9seWZpbGwKfTsK
Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyLW1ldGFsCiovCgp2YXIg
TUVUQV9LRVkgPSBFbWJlci5NRVRBX0tFWSwKICAgIG1ldGFGb3IgPSBFbWJlci5tZXRhLAogICAg
b2JqZWN0RGVmaW5lUHJvcGVydHkgPSBFbWJlci5wbGF0Zm9ybS5kZWZpbmVQcm9wZXJ0eTsKCnZh
ciBNQU5EQVRPUllfU0VUVEVSID0gRW1iZXIuRU5WLk1BTkRBVE9SWV9TRVRURVI7CgovLyAuLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCi8v
IERFU0NSSVBUT1IKLy8KCi8qKgogIE9iamVjdHMgb2YgdGhpcyB0eXBlIGNhbiBpbXBsZW1lbnQg
YW4gaW50ZXJmYWNlIHRvIHJlc3BvbmQgdG8gcmVxdWVzdHMgdG8KICBnZXQgYW5kIHNldC4gVGhl
IGRlZmF1bHQgaW1wbGVtZW50YXRpb24gaGFuZGxlcyBzaW1wbGUgcHJvcGVydGllcy4KCiAgWW91
IGdlbmVyYWxseSB3b24ndCBuZWVkIHRvIGNyZWF0ZSBvciBzdWJjbGFzcyB0aGlzIGRpcmVjdGx5
LgoKICBAY2xhc3MgRGVzY3JpcHRvcgogIEBuYW1lc3BhY2UgRW1iZXIKICBAcHJpdmF0ZQogIEBj
b25zdHJ1Y3RvcgoqLwpFbWJlci5EZXNjcmlwdG9yID0gZnVuY3Rpb24oKSB7fTsKCi8vIC4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KLy8g
REVGSU5JTkcgUFJPUEVSVElFUyBBUEkKLy8KCnZhciBNQU5EQVRPUllfU0VUVEVSX0ZVTkNUSU9O
ID0gRW1iZXIuTUFOREFUT1JZX1NFVFRFUl9GVU5DVElPTiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAg
RW1iZXIuYXNzZXJ0KCJZb3UgbXVzdCB1c2UgRW1iZXIuc2V0KCkgdG8gYWNjZXNzIHRoaXMgcHJv
cGVydHkgKG9mICIgKyB0aGlzICsgIikiLCBmYWxzZSk7Cn07Cgp2YXIgREVGQVVMVF9HRVRURVJf
RlVOQ1RJT04gPSBFbWJlci5ERUZBVUxUX0dFVFRFUl9GVU5DVElPTiA9IGZ1bmN0aW9uKG5hbWUp
IHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgbWV0YSA9IHRoaXNbTUVUQV9LRVldOwog
ICAgcmV0dXJuIG1ldGEgJiYgbWV0YS52YWx1ZXNbbmFtZV07CiAgfTsKfTsKCi8qKgogIE5PVEU6
IFRoaXMgaXMgYSBsb3ctbGV2ZWwgbWV0aG9kIHVzZWQgYnkgb3RoZXIgcGFydHMgb2YgdGhlIEFQ
SS4gWW91IGFsbW9zdAogIG5ldmVyIHdhbnQgdG8gY2FsbCB0aGlzIG1ldGhvZCBkaXJlY3RseS4g
SW5zdGVhZCB5b3Ugc2hvdWxkIHVzZQogIGBFbWJlci5taXhpbigpYCB0byBkZWZpbmUgbmV3IHBy
b3BlcnRpZXMuCgogIERlZmluZXMgYSBwcm9wZXJ0eSBvbiBhbiBvYmplY3QuIFRoaXMgbWV0aG9k
IHdvcmtzIG11Y2ggbGlrZSB0aGUgRVM1CiAgYE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgpYCBtZXRo
b2QgZXhjZXB0IHRoYXQgaXQgY2FuIGFsc28gYWNjZXB0IGNvbXB1dGVkCiAgcHJvcGVydGllcyBh
bmQgb3RoZXIgc3BlY2lhbCBkZXNjcmlwdG9ycy4KCiAgTm9ybWFsbHkgdGhpcyBtZXRob2QgdGFr
ZXMgb25seSB0aHJlZSBwYXJhbWV0ZXJzLiBIb3dldmVyIGlmIHlvdSBwYXNzIGFuCiAgaW5zdGFu
Y2Ugb2YgYEVtYmVyLkRlc2NyaXB0b3JgIGFzIHRoZSB0aGlyZCBwYXJhbSB0aGVuIHlvdSBjYW4g
cGFzcyBhbgogIG9wdGlvbmFsIHZhbHVlIGFzIHRoZSBmb3VydGggcGFyYW1ldGVyLiBUaGlzIGlz
IG9mdGVuIG1vcmUgZWZmaWNpZW50IHRoYW4KICBjcmVhdGluZyBuZXcgZGVzY3JpcHRvciBoYXNo
ZXMgZm9yIGVhY2ggcHJvcGVydHkuCgogICMjIEV4YW1wbGVzCgogIGBgYGphdmFzY3JpcHQKICAv
LyBFUzUgY29tcGF0aWJsZSBtb2RlCiAgRW1iZXIuZGVmaW5lUHJvcGVydHkoY29udGFjdCwgJ2Zp
cnN0TmFtZScsIHsKICAgIHdyaXRhYmxlOiB0cnVlLAogICAgY29uZmlndXJhYmxlOiBmYWxzZSwK
ICAgIGVudW1lcmFibGU6IHRydWUsCiAgICB2YWx1ZTogJ0NoYXJsZXMnCiAgfSk7CgogIC8vIGRl
ZmluZSBhIHNpbXBsZSBwcm9wZXJ0eQogIEVtYmVyLmRlZmluZVByb3BlcnR5KGNvbnRhY3QsICds
YXN0TmFtZScsIHVuZGVmaW5lZCwgJ0pvbGxleScpOwoKICAvLyBkZWZpbmUgYSBjb21wdXRlZCBw
cm9wZXJ0eQogIEVtYmVyLmRlZmluZVByb3BlcnR5KGNvbnRhY3QsICdmdWxsTmFtZScsIEVtYmVy
LmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZmlyc3ROYW1lKycgJyt0aGlz
Lmxhc3ROYW1lOwogIH0pLnByb3BlcnR5KCdmaXJzdE5hbWUnLCAnbGFzdE5hbWUnKSk7CiAgYGBg
CgogIEBwcml2YXRlCiAgQG1ldGhvZCBkZWZpbmVQcm9wZXJ0eQogIEBmb3IgRW1iZXIKICBAcGFy
YW0ge09iamVjdH0gb2JqIHRoZSBvYmplY3QgdG8gZGVmaW5lIHRoaXMgcHJvcGVydHkgb24uIFRo
aXMgbWF5IGJlIGEgcHJvdG90eXBlLgogIEBwYXJhbSB7U3RyaW5nfSBrZXlOYW1lIHRoZSBuYW1l
IG9mIHRoZSBwcm9wZXJ0eQogIEBwYXJhbSB7RW1iZXIuRGVzY3JpcHRvcn0gW2Rlc2NdIGFuIGlu
c3RhbmNlIG9mIGBFbWJlci5EZXNjcmlwdG9yYCAodHlwaWNhbGx5IGEKICAgIGNvbXB1dGVkIHBy
b3BlcnR5KSBvciBhbiBFUzUgZGVzY3JpcHRvci4KICAgIFlvdSBtdXN0IHByb3ZpZGUgdGhpcyBv
ciBgZGF0YWAgYnV0IG5vdCBib3RoLgogIEBwYXJhbSB7Kn0gW2RhdGFdIHNvbWV0aGluZyBvdGhl
ciB0aGFuIGEgZGVzY3JpcHRvciwgdGhhdCB3aWxsCiAgICBiZWNvbWUgdGhlIGV4cGxpY2l0IHZh
bHVlIG9mIHRoaXMgcHJvcGVydHkuCiovCkVtYmVyLmRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24o
b2JqLCBrZXlOYW1lLCBkZXNjLCBkYXRhLCBtZXRhKSB7CiAgdmFyIGRlc2NzLCBleGlzdGluZ0Rl
c2MsIHdhdGNoaW5nLCB2YWx1ZTsKCiAgaWYgKCFtZXRhKSBtZXRhID0gbWV0YUZvcihvYmopOwog
IGRlc2NzID0gbWV0YS5kZXNjczsKICBleGlzdGluZ0Rlc2MgPSBtZXRhLmRlc2NzW2tleU5hbWVd
OwogIHdhdGNoaW5nID0gbWV0YS53YXRjaGluZ1trZXlOYW1lXSA+IDA7CgogIGlmIChleGlzdGlu
Z0Rlc2MgaW5zdGFuY2VvZiBFbWJlci5EZXNjcmlwdG9yKSB7CiAgICBleGlzdGluZ0Rlc2MudGVh
cmRvd24ob2JqLCBrZXlOYW1lKTsKICB9CgogIGlmIChkZXNjIGluc3RhbmNlb2YgRW1iZXIuRGVz
Y3JpcHRvcikgewogICAgdmFsdWUgPSBkZXNjOwoKICAgIGRlc2NzW2tleU5hbWVdID0gZGVzYzsK
ICAgIGlmIChNQU5EQVRPUllfU0VUVEVSICYmIHdhdGNoaW5nKSB7CiAgICAgIG9iamVjdERlZmlu
ZVByb3BlcnR5KG9iaiwga2V5TmFtZSwgewogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAg
ICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZh
bHVlOiB1bmRlZmluZWQgLy8gbWFrZSBlbnVtZXJhYmxlCiAgICAgIH0pOwogICAgfSBlbHNlIHsK
ICAgICAgb2JqW2tleU5hbWVdID0gdW5kZWZpbmVkOyAvLyBtYWtlIGVudW1lcmFibGUKICAgIH0K
ICB9IGVsc2UgewogICAgZGVzY3Nba2V5TmFtZV0gPSB1bmRlZmluZWQ7IC8vIHNoYWRvdyBkZXNj
cmlwdG9yIGluIHByb3RvCiAgICBpZiAoZGVzYyA9PSBudWxsKSB7CiAgICAgIHZhbHVlID0gZGF0
YTsKCiAgICAgIGlmIChNQU5EQVRPUllfU0VUVEVSICYmIHdhdGNoaW5nKSB7CiAgICAgICAgbWV0
YS52YWx1ZXNba2V5TmFtZV0gPSBkYXRhOwogICAgICAgIG9iamVjdERlZmluZVByb3BlcnR5KG9i
aiwga2V5TmFtZSwgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgZW51
bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIHNldDogTUFOREFUT1JZX1NFVFRFUl9GVU5DVElPTiwK
ICAgICAgICAgIGdldDogREVGQVVMVF9HRVRURVJfRlVOQ1RJT04oa2V5TmFtZSkKICAgICAgICB9
KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvYmpba2V5TmFtZV0gPSBkYXRhOwogICAgICB9CiAg
ICB9IGVsc2UgewogICAgICB2YWx1ZSA9IGRlc2M7CgogICAgICAvLyBjb21wYXRpYmlsaXR5IHdp
dGggRVM1CiAgICAgIG9iamVjdERlZmluZVByb3BlcnR5KG9iaiwga2V5TmFtZSwgZGVzYyk7CiAg
ICB9CiAgfQoKICAvLyBpZiBrZXkgaXMgYmVpbmcgd2F0Y2hlZCwgb3ZlcnJpZGUgY2hhaW5zIHRo
YXQKICAvLyB3ZXJlIGluaXRpYWxpemVkIHdpdGggdGhlIHByb3RvdHlwZQogIGlmICh3YXRjaGlu
ZykgeyBFbWJlci5vdmVycmlkZUNoYWlucyhvYmosIGtleU5hbWUsIG1ldGEpOyB9CgogIC8vIFRo
ZSBgdmFsdWVgIHBhc3NlZCB0byB0aGUgYGRpZERlZmluZVByb3BlcnR5YCBob29rIGlzCiAgLy8g
ZWl0aGVyIHRoZSBkZXNjcmlwdG9yIG9yIGRhdGEsIHdoaWNoZXZlciB3YXMgcGFzc2VkLgogIGlm
IChvYmouZGlkRGVmaW5lUHJvcGVydHkpIHsgb2JqLmRpZERlZmluZVByb3BlcnR5KG9iaiwga2V5
TmFtZSwgdmFsdWUpOyB9CgogIHJldHVybiB0aGlzOwp9OwoKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKdmFyIGdldCA9IEVtYmVyLmdldDsKCi8qKgogIFRvIGdldCBtdWx0aXBsZSBwcm9wZXJ0aWVz
IGF0IG9uY2UsIGNhbGwgYEVtYmVyLmdldFByb3BlcnRpZXNgCiAgd2l0aCBhbiBvYmplY3QgZm9s
bG93ZWQgYnkgYSBsaXN0IG9mIHN0cmluZ3Mgb3IgYW4gYXJyYXk6CgogIGBgYGphdmFzY3JpcHQK
ICBFbWJlci5nZXRQcm9wZXJ0aWVzKHJlY29yZCwgJ2ZpcnN0TmFtZScsICdsYXN0TmFtZScsICd6
aXBDb2RlJyk7ICAvLyB7IGZpcnN0TmFtZTogJ0pvaG4nLCBsYXN0TmFtZTogJ0RvZScsIHppcENv
ZGU6ICcxMDAxMScgfQogIGBgYAoKICBpcyBlcXVpdmFsZW50IHRvOgoKICBgYGBqYXZhc2NyaXB0
CiAgRW1iZXIuZ2V0UHJvcGVydGllcyhyZWNvcmQsIFsnZmlyc3ROYW1lJywgJ2xhc3ROYW1lJywg
J3ppcENvZGUnXSk7ICAvLyB7IGZpcnN0TmFtZTogJ0pvaG4nLCBsYXN0TmFtZTogJ0RvZScsIHpp
cENvZGU6ICcxMDAxMScgfQogIGBgYAoKICBAbWV0aG9kIGdldFByb3BlcnRpZXMKICBAcGFyYW0g
b2JqCiAgQHBhcmFtIHtTdHJpbmcuLi58QXJyYXl9IGxpc3Qgb2Yga2V5cyB0byBnZXQKICBAcmV0
dXJuIHtIYXNofQoqLwpFbWJlci5nZXRQcm9wZXJ0aWVzID0gZnVuY3Rpb24ob2JqKSB7CiAgdmFy
IHJldCA9IHt9LAogICAgICBwcm9wZXJ0eU5hbWVzID0gYXJndW1lbnRzLAogICAgICBpID0gMTsK
CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgRW1iZXIudHlwZU9mKGFyZ3VtZW50c1sx
XSkgPT09ICdhcnJheScpIHsKICAgIGkgPSAwOwogICAgcHJvcGVydHlOYW1lcyA9IGFyZ3VtZW50
c1sxXTsKICB9CiAgZm9yKHZhciBsZW4gPSBwcm9wZXJ0eU5hbWVzLmxlbmd0aDsgaSA8IGxlbjsg
aSsrKSB7CiAgICByZXRbcHJvcGVydHlOYW1lc1tpXV0gPSBnZXQob2JqLCBwcm9wZXJ0eU5hbWVz
W2ldKTsKICB9CiAgcmV0dXJuIHJldDsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKdmFyIGNo
YW5nZVByb3BlcnRpZXMgPSBFbWJlci5jaGFuZ2VQcm9wZXJ0aWVzLAogICAgc2V0ID0gRW1iZXIu
c2V0OwoKLyoqCiAgU2V0IGEgbGlzdCBvZiBwcm9wZXJ0aWVzIG9uIGFuIG9iamVjdC4gVGhlc2Ug
cHJvcGVydGllcyBhcmUgc2V0IGluc2lkZQogIGEgc2luZ2xlIGBiZWdpblByb3BlcnR5Q2hhbmdl
c2AgYW5kIGBlbmRQcm9wZXJ0eUNoYW5nZXNgIGJhdGNoLCBzbwogIG9ic2VydmVycyB3aWxsIGJl
IGJ1ZmZlcmVkLgoKICBgYGBqYXZhc2NyaXB0CiAgYW5PYmplY3Quc2V0UHJvcGVydGllcyh7CiAg
ICBmaXJzdE5hbWU6ICJTdGFubGV5IiwKICAgIGxhc3ROYW1lOiAiU3R1YXJ0IiwKICAgIGFnZTog
IjIxIgogIH0pCiAgYGBgCgogIEBtZXRob2Qgc2V0UHJvcGVydGllcwogIEBwYXJhbSBzZWxmCiAg
QHBhcmFtIHtPYmplY3R9IGhhc2gKICBAcmV0dXJuIHNlbGYKKi8KRW1iZXIuc2V0UHJvcGVydGll
cyA9IGZ1bmN0aW9uKHNlbGYsIGhhc2gpIHsKICBjaGFuZ2VQcm9wZXJ0aWVzKGZ1bmN0aW9uKCkg
ewogICAgZm9yKHZhciBwcm9wIGluIGhhc2gpIHsKICAgICAgaWYgKGhhc2guaGFzT3duUHJvcGVy
dHkocHJvcCkpIHsgc2V0KHNlbGYsIHByb3AsIGhhc2hbcHJvcF0pOyB9CiAgICB9CiAgfSk7CiAg
cmV0dXJuIHNlbGY7Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBtZXRhRm9yID0gRW1i
ZXIubWV0YSwgLy8gdXRpbHMuanMKICAgIHR5cGVPZiA9IEVtYmVyLnR5cGVPZiwgLy8gdXRpbHMu
anMKICAgIE1BTkRBVE9SWV9TRVRURVIgPSBFbWJlci5FTlYuTUFOREFUT1JZX1NFVFRFUiwKICAg
IG9fZGVmaW5lUHJvcGVydHkgPSBFbWJlci5wbGF0Zm9ybS5kZWZpbmVQcm9wZXJ0eTsKCkVtYmVy
LndhdGNoS2V5ID0gZnVuY3Rpb24ob2JqLCBrZXlOYW1lKSB7CiAgLy8gY2FuJ3Qgd2F0Y2ggbGVu
Z3RoIG9uIEFycmF5IC0gaXQgaXMgc3BlY2lhbC4uLgogIGlmIChrZXlOYW1lID09PSAnbGVuZ3Ro
JyAmJiB0eXBlT2Yob2JqKSA9PT0gJ2FycmF5JykgeyByZXR1cm47IH0KCiAgdmFyIG0gPSBtZXRh
Rm9yKG9iaiksIHdhdGNoaW5nID0gbS53YXRjaGluZzsKCiAgLy8gYWN0aXZhdGUgd2F0Y2hpbmcg
Zmlyc3QgdGltZQogIGlmICghd2F0Y2hpbmdba2V5TmFtZV0pIHsKICAgIHdhdGNoaW5nW2tleU5h
bWVdID0gMTsKCiAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIG9iai53aWxsV2F0Y2hQcm9w
ZXJ0eSkgewogICAgICBvYmoud2lsbFdhdGNoUHJvcGVydHkoa2V5TmFtZSk7CiAgICB9CgogICAg
aWYgKE1BTkRBVE9SWV9TRVRURVIgJiYga2V5TmFtZSBpbiBvYmopIHsKICAgICAgbS52YWx1ZXNb
a2V5TmFtZV0gPSBvYmpba2V5TmFtZV07CiAgICAgIG9fZGVmaW5lUHJvcGVydHkob2JqLCBrZXlO
YW1lLCB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IG9i
ai5wcm9wZXJ0eUlzRW51bWVyYWJsZShrZXlOYW1lKSwKICAgICAgICBzZXQ6IEVtYmVyLk1BTkRB
VE9SWV9TRVRURVJfRlVOQ1RJT04sCiAgICAgICAgZ2V0OiBFbWJlci5ERUZBVUxUX0dFVFRFUl9G
VU5DVElPTihrZXlOYW1lKQogICAgICB9KTsKICAgIH0KICB9IGVsc2UgewogICAgd2F0Y2hpbmdb
a2V5TmFtZV0gPSAod2F0Y2hpbmdba2V5TmFtZV0gfHwgMCkgKyAxOwogIH0KfTsKCgpFbWJlci51
bndhdGNoS2V5ID0gZnVuY3Rpb24ob2JqLCBrZXlOYW1lKSB7CiAgdmFyIG0gPSBtZXRhRm9yKG9i
aiksIHdhdGNoaW5nID0gbS53YXRjaGluZzsKCiAgaWYgKHdhdGNoaW5nW2tleU5hbWVdID09PSAx
KSB7CiAgICB3YXRjaGluZ1trZXlOYW1lXSA9IDA7CgogICAgaWYgKCdmdW5jdGlvbicgPT09IHR5
cGVvZiBvYmouZGlkVW53YXRjaFByb3BlcnR5KSB7CiAgICAgIG9iai5kaWRVbndhdGNoUHJvcGVy
dHkoa2V5TmFtZSk7CiAgICB9CgogICAgaWYgKE1BTkRBVE9SWV9TRVRURVIgJiYga2V5TmFtZSBp
biBvYmopIHsKICAgICAgb19kZWZpbmVQcm9wZXJ0eShvYmosIGtleU5hbWUsIHsKICAgICAgICBj
b25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZW51bWVyYWJsZTogb2JqLnByb3BlcnR5SXNFbnVt
ZXJhYmxlKGtleU5hbWUpLAogICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICAv
LyByZWRlZmluZSB0byBzZXQgYXMgZW51bWVyYWJsZQogICAgICAgICAgb19kZWZpbmVQcm9wZXJ0
eShvYmosIGtleU5hbWUsIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAg
ICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAg
ICAgICAgdmFsdWU6IHZhbAogICAgICAgICAgfSk7CiAgICAgICAgICBkZWxldGUgbS52YWx1ZXNb
a2V5TmFtZV07CiAgICAgICAgfSwKICAgICAgICBnZXQ6IEVtYmVyLkRFRkFVTFRfR0VUVEVSX0ZV
TkNUSU9OKGtleU5hbWUpCiAgICAgIH0pOwogICAgfQogIH0gZWxzZSBpZiAod2F0Y2hpbmdba2V5
TmFtZV0gPiAxKSB7CiAgICB3YXRjaGluZ1trZXlOYW1lXS0tOwogIH0KfTsKCn0pKCk7CgoKCihm
dW5jdGlvbigpIHsKdmFyIG1ldGFGb3IgPSBFbWJlci5tZXRhLCAvLyB1dGlscy5qcwogICAgZ2V0
ID0gRW1iZXIuZ2V0LCAvLyBwcm9wZXJ0eV9nZXQuanMKICAgIG5vcm1hbGl6ZVR1cGxlID0gRW1i
ZXIubm9ybWFsaXplVHVwbGUsIC8vIHByb3BlcnR5X2dldC5qcwogICAgZm9yRWFjaCA9IEVtYmVy
LkFycmF5UG9seWZpbGxzLmZvckVhY2gsIC8vIGFycmF5LmpzCiAgICB3YXJuID0gRW1iZXIud2Fy
biwKICAgIHdhdGNoS2V5ID0gRW1iZXIud2F0Y2hLZXksCiAgICB1bndhdGNoS2V5ID0gRW1iZXIu
dW53YXRjaEtleSwKICAgIEZJUlNUX0tFWSA9IC9eKFteXC5cKl0rKS87CgpmdW5jdGlvbiBmaXJz
dEtleShwYXRoKSB7CiAgcmV0dXJuIHBhdGgubWF0Y2goRklSU1RfS0VZKVswXTsKfQoKdmFyIHBl
bmRpbmdRdWV1ZSA9IFtdOwoKLy8gYXR0ZW1wdHMgdG8gYWRkIHRoZSBwZW5kaW5nUXVldWUgY2hh
aW5zIGFnYWluLiBJZiBzb21lIG9mIHRoZW0gZW5kIHVwCi8vIGJhY2sgaW4gdGhlIHF1ZXVlIGFu
ZCByZXNjaGVkdWxlIGlzIHRydWUsIHNjaGVkdWxlcyBhIHRpbWVvdXQgdG8gdHJ5Ci8vIGFnYWlu
LgpFbWJlci5mbHVzaFBlbmRpbmdDaGFpbnMgPSBmdW5jdGlvbigpIHsKICBpZiAocGVuZGluZ1F1
ZXVlLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH0gLy8gbm90aGluZyB0byBkbwoKICB2YXIgcXVl
dWUgPSBwZW5kaW5nUXVldWU7CiAgcGVuZGluZ1F1ZXVlID0gW107CgogIGZvckVhY2guY2FsbChx
dWV1ZSwgZnVuY3Rpb24ocSkgeyBxWzBdLmFkZChxWzFdKTsgfSk7CgogIHdhcm4oJ1dhdGNoaW5n
IGFuIHVuZGVmaW5lZCBnbG9iYWwsIEVtYmVyIGV4cGVjdHMgd2F0Y2hlZCBnbG9iYWxzIHRvIGJl
IHNldHVwIGJ5IHRoZSB0aW1lIHRoZSBydW4gbG9vcCBpcyBmbHVzaGVkLCBjaGVjayBmb3IgdHlw
b3MnLCBwZW5kaW5nUXVldWUubGVuZ3RoID09PSAwKTsKfTsKCgpmdW5jdGlvbiBhZGRDaGFpbldh
dGNoZXIob2JqLCBrZXlOYW1lLCBub2RlKSB7CiAgaWYgKCFvYmogfHwgKCdvYmplY3QnICE9PSB0
eXBlb2Ygb2JqKSkgeyByZXR1cm47IH0gLy8gbm90aGluZyB0byBkbwoKICB2YXIgbSA9IG1ldGFG
b3Iob2JqKSwgbm9kZXMgPSBtLmNoYWluV2F0Y2hlcnM7CgogIGlmICghbS5oYXNPd25Qcm9wZXJ0
eSgnY2hhaW5XYXRjaGVycycpKSB7CiAgICBub2RlcyA9IG0uY2hhaW5XYXRjaGVycyA9IHt9Owog
IH0KCiAgaWYgKCFub2Rlc1trZXlOYW1lXSkgeyBub2Rlc1trZXlOYW1lXSA9IFtdOyB9CiAgbm9k
ZXNba2V5TmFtZV0ucHVzaChub2RlKTsKICB3YXRjaEtleShvYmosIGtleU5hbWUpOwp9Cgp2YXIg
cmVtb3ZlQ2hhaW5XYXRjaGVyID0gRW1iZXIucmVtb3ZlQ2hhaW5XYXRjaGVyID0gZnVuY3Rpb24o
b2JqLCBrZXlOYW1lLCBub2RlKSB7CiAgaWYgKCFvYmogfHwgJ29iamVjdCcgIT09IHR5cGVvZiBv
YmopIHsgcmV0dXJuOyB9IC8vIG5vdGhpbmcgdG8gZG8KCiAgdmFyIG0gPSBtZXRhRm9yKG9iaiwg
ZmFsc2UpOwogIGlmICghbS5oYXNPd25Qcm9wZXJ0eSgnY2hhaW5XYXRjaGVycycpKSB7IHJldHVy
bjsgfSAvLyBub3RoaW5nIHRvIGRvCgogIHZhciBub2RlcyA9IG0uY2hhaW5XYXRjaGVyczsKCiAg
aWYgKG5vZGVzW2tleU5hbWVdKSB7CiAgICBub2RlcyA9IG5vZGVzW2tleU5hbWVdOwogICAgZm9y
ICh2YXIgaSA9IDAsIGwgPSBub2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaWYgKG5v
ZGVzW2ldID09PSBub2RlKSB7IG5vZGVzLnNwbGljZShpLCAxKTsgfQogICAgfQogIH0KICB1bndh
dGNoS2V5KG9iaiwga2V5TmFtZSk7Cn07CgovLyBBIENoYWluTm9kZSB3YXRjaGVzIGEgc2luZ2xl
IGtleSBvbiBhbiBvYmplY3QuIElmIHlvdSBwcm92aWRlIGEgc3RhcnRpbmcKLy8gdmFsdWUgZm9y
IHRoZSBrZXkgdGhlbiB0aGUgbm9kZSB3b24ndCBhY3R1YWxseSB3YXRjaCBpdC4gRm9yIGEgcm9v
dCBub2RlCi8vIHBhc3MgbnVsbCBmb3IgcGFyZW50IGFuZCBrZXkgYW5kIG9iamVjdCBmb3IgdmFs
dWUuCnZhciBDaGFpbk5vZGUgPSBFbWJlci5fQ2hhaW5Ob2RlID0gZnVuY3Rpb24ocGFyZW50LCBr
ZXksIHZhbHVlKSB7CiAgdGhpcy5fcGFyZW50ID0gcGFyZW50OwogIHRoaXMuX2tleSAgICA9IGtl
eTsKCiAgLy8gX3dhdGNoaW5nIGlzIHRydWUgd2hlbiBjYWxsaW5nIGdldCh0aGlzLl9wYXJlbnQs
IHRoaXMuX2tleSkgd2lsbAogIC8vIHJldHVybiB0aGUgdmFsdWUgb2YgdGhpcyBub2RlLgogIC8v
CiAgLy8gSXQgaXMgZmFsc2UgZm9yIHRoZSByb290IG9mIGEgY2hhaW4gKGJlY2F1c2Ugd2UgaGF2
ZSBubyBwYXJlbnQpCiAgLy8gYW5kIGZvciBnbG9iYWwgcGF0aHMgKGJlY2F1c2UgdGhlIHBhcmVu
dCBub2RlIGlzIHRoZSBvYmplY3Qgd2l0aAogIC8vIHRoZSBvYnNlcnZlciBvbiBpdCkKICB0aGlz
Ll93YXRjaGluZyA9IHZhbHVlPT09dW5kZWZpbmVkOwoKICB0aGlzLl92YWx1ZSAgPSB2YWx1ZTsK
ICB0aGlzLl9wYXRocyA9IHt9OwogIGlmICh0aGlzLl93YXRjaGluZykgewogICAgdGhpcy5fb2Jq
ZWN0ID0gcGFyZW50LnZhbHVlKCk7CiAgICBpZiAodGhpcy5fb2JqZWN0KSB7IGFkZENoYWluV2F0
Y2hlcih0aGlzLl9vYmplY3QsIHRoaXMuX2tleSwgdGhpcyk7IH0KICB9CgogIC8vIFNwZWNpYWwt
Y2FzZTogdGhlIEVhY2hQcm94eSByZWxpZXMgb24gaW1tZWRpYXRlIGV2YWx1YXRpb24gdG8KICAv
LyBlc3RhYmxpc2ggaXRzIG9ic2VydmVycy4KICAvLwogIC8vIFRPRE86IFJlcGxhY2UgdGhpcyB3
aXRoIGFuIGVmZmljaWVudCBjYWxsYmFjayB0aGF0IHRoZSBFYWNoUHJveHkKICAvLyBjYW4gaW1w
bGVtZW50LgogIGlmICh0aGlzLl9wYXJlbnQgJiYgdGhpcy5fcGFyZW50Ll9rZXkgPT09ICdAZWFj
aCcpIHsKICAgIHRoaXMudmFsdWUoKTsKICB9Cn07Cgp2YXIgQ2hhaW5Ob2RlUHJvdG90eXBlID0g
Q2hhaW5Ob2RlLnByb3RvdHlwZTsKCmZ1bmN0aW9uIGxhenlHZXQob2JqLCBrZXkpIHsKICBpZiAo
IW9iaikgcmV0dXJuIHVuZGVmaW5lZDsKCiAgdmFyIG1ldGEgPSBtZXRhRm9yKG9iaiwgZmFsc2Up
OwogIC8vIGNoZWNrIGlmIG9iamVjdCBtZWFudCBvbmx5IHRvIGJlIGEgcHJvdG90eXBlCiAgaWYg
KG1ldGEucHJvdG8gPT09IG9iaikgcmV0dXJuIHVuZGVmaW5lZDsKCiAgaWYgKGtleSA9PT0gIkBl
YWNoIikgcmV0dXJuIGdldChvYmosIGtleSk7CgogIC8vIGlmIGEgQ1Agb25seSByZXR1cm4gY2Fj
aGVkIHZhbHVlCiAgdmFyIGRlc2MgPSBtZXRhLmRlc2NzW2tleV07CiAgaWYgKGRlc2MgJiYgZGVz
Yy5fY2FjaGVhYmxlKSB7CiAgICBpZiAoa2V5IGluIG1ldGEuY2FjaGUpIHsKICAgICAgcmV0dXJu
IG1ldGEuY2FjaGVba2V5XTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAg
ICB9CiAgfQoKICByZXR1cm4gZ2V0KG9iaiwga2V5KTsKfQoKQ2hhaW5Ob2RlUHJvdG90eXBlLnZh
bHVlID0gZnVuY3Rpb24oKSB7CiAgaWYgKHRoaXMuX3ZhbHVlID09PSB1bmRlZmluZWQgJiYgdGhp
cy5fd2F0Y2hpbmcpIHsKICAgIHZhciBvYmogPSB0aGlzLl9wYXJlbnQudmFsdWUoKTsKICAgIHRo
aXMuX3ZhbHVlID0gbGF6eUdldChvYmosIHRoaXMuX2tleSk7CiAgfQogIHJldHVybiB0aGlzLl92
YWx1ZTsKfTsKCkNoYWluTm9kZVByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgaWYg
KHRoaXMuX3dhdGNoaW5nKSB7CiAgICB2YXIgb2JqID0gdGhpcy5fb2JqZWN0OwogICAgaWYgKG9i
aikgeyByZW1vdmVDaGFpbldhdGNoZXIob2JqLCB0aGlzLl9rZXksIHRoaXMpOyB9CiAgICB0aGlz
Ll93YXRjaGluZyA9IGZhbHNlOyAvLyBzbyBmdXR1cmUgY2FsbHMgZG8gbm90aGluZwogIH0KfTsK
Ci8vIGNvcGllcyBhIHRvcCBsZXZlbCBvYmplY3Qgb25seQpDaGFpbk5vZGVQcm90b3R5cGUuY29w
eSA9IGZ1bmN0aW9uKG9iaikgewogIHZhciByZXQgPSBuZXcgQ2hhaW5Ob2RlKG51bGwsIG51bGws
IG9iaiksCiAgICAgIHBhdGhzID0gdGhpcy5fcGF0aHMsIHBhdGg7CiAgZm9yIChwYXRoIGluIHBh
dGhzKSB7CiAgICBpZiAocGF0aHNbcGF0aF0gPD0gMCkgeyBjb250aW51ZTsgfSAvLyB0aGlzIGNo
ZWNrIHdpbGwgYWxzbyBjYXRjaCBub24tbnVtYmVyIHZhbHMuCiAgICByZXQuYWRkKHBhdGgpOwog
IH0KICByZXR1cm4gcmV0Owp9OwoKLy8gY2FsbGVkIG9uIHRoZSByb290IG5vZGUgb2YgYSBjaGFp
biB0byBzZXR1cCB3YXRjaGVycyBvbiB0aGUgc3BlY2lmaWVkCi8vIHBhdGguCkNoYWluTm9kZVBy
b3RvdHlwZS5hZGQgPSBmdW5jdGlvbihwYXRoKSB7CiAgdmFyIG9iaiwgdHVwbGUsIGtleSwgc3Jj
LCBwYXRoczsKCiAgcGF0aHMgPSB0aGlzLl9wYXRoczsKICBwYXRoc1twYXRoXSA9IChwYXRoc1tw
YXRoXSB8fCAwKSArIDE7CgogIG9iaiA9IHRoaXMudmFsdWUoKTsKICB0dXBsZSA9IG5vcm1hbGl6
ZVR1cGxlKG9iaiwgcGF0aCk7CgogIC8vIHRoZSBwYXRoIHdhcyBhIGxvY2FsIHBhdGgKICBpZiAo
dHVwbGVbMF0gJiYgdHVwbGVbMF0gPT09IG9iaikgewogICAgcGF0aCA9IHR1cGxlWzFdOwogICAg
a2V5ICA9IGZpcnN0S2V5KHBhdGgpOwogICAgcGF0aCA9IHBhdGguc2xpY2Uoa2V5Lmxlbmd0aCsx
KTsKCiAgLy8gZ2xvYmFsIHBhdGgsIGJ1dCBvYmplY3QgZG9lcyBub3QgZXhpc3QgeWV0LgogIC8v
IHB1dCBpbnRvIGEgcXVldWUgYW5kIHRyeSB0byBjb25uZWN0IGxhdGVyLgogIH0gZWxzZSBpZiAo
IXR1cGxlWzBdKSB7CiAgICBwZW5kaW5nUXVldWUucHVzaChbdGhpcywgcGF0aF0pOwogICAgdHVw
bGUubGVuZ3RoID0gMDsKICAgIHJldHVybjsKCiAgLy8gZ2xvYmFsIHBhdGgsIGFuZCBvYmplY3Qg
YWxyZWFkeSBleGlzdHMKICB9IGVsc2UgewogICAgc3JjICA9IHR1cGxlWzBdOwogICAga2V5ICA9
IHBhdGguc2xpY2UoMCwgMC0odHVwbGVbMV0ubGVuZ3RoKzEpKTsKICAgIHBhdGggPSB0dXBsZVsx
XTsKICB9CgogIHR1cGxlLmxlbmd0aCA9IDA7CiAgdGhpcy5jaGFpbihrZXksIHBhdGgsIHNyYyk7
Cn07CgovLyBjYWxsZWQgb24gdGhlIHJvb3Qgbm9kZSBvZiBhIGNoYWluIHRvIHRlYXJkb3duIHdh
dGNoZXIgb24gdGhlIHNwZWNpZmllZAovLyBwYXRoCkNoYWluTm9kZVByb3RvdHlwZS5yZW1vdmUg
PSBmdW5jdGlvbihwYXRoKSB7CiAgdmFyIG9iaiwgdHVwbGUsIGtleSwgc3JjLCBwYXRoczsKCiAg
cGF0aHMgPSB0aGlzLl9wYXRoczsKICBpZiAocGF0aHNbcGF0aF0gPiAwKSB7IHBhdGhzW3BhdGhd
LS07IH0KCiAgb2JqID0gdGhpcy52YWx1ZSgpOwogIHR1cGxlID0gbm9ybWFsaXplVHVwbGUob2Jq
LCBwYXRoKTsKICBpZiAodHVwbGVbMF0gPT09IG9iaikgewogICAgcGF0aCA9IHR1cGxlWzFdOwog
ICAga2V5ICA9IGZpcnN0S2V5KHBhdGgpOwogICAgcGF0aCA9IHBhdGguc2xpY2Uoa2V5Lmxlbmd0
aCsxKTsKICB9IGVsc2UgewogICAgc3JjICA9IHR1cGxlWzBdOwogICAga2V5ICA9IHBhdGguc2xp
Y2UoMCwgMC0odHVwbGVbMV0ubGVuZ3RoKzEpKTsKICAgIHBhdGggPSB0dXBsZVsxXTsKICB9Cgog
IHR1cGxlLmxlbmd0aCA9IDA7CiAgdGhpcy51bmNoYWluKGtleSwgcGF0aCk7Cn07CgpDaGFpbk5v
ZGVQcm90b3R5cGUuY291bnQgPSAwOwoKQ2hhaW5Ob2RlUHJvdG90eXBlLmNoYWluID0gZnVuY3Rp
b24oa2V5LCBwYXRoLCBzcmMpIHsKICB2YXIgY2hhaW5zID0gdGhpcy5fY2hhaW5zLCBub2RlOwog
IGlmICghY2hhaW5zKSB7IGNoYWlucyA9IHRoaXMuX2NoYWlucyA9IHt9OyB9CgogIG5vZGUgPSBj
aGFpbnNba2V5XTsKICBpZiAoIW5vZGUpIHsgbm9kZSA9IGNoYWluc1trZXldID0gbmV3IENoYWlu
Tm9kZSh0aGlzLCBrZXksIHNyYyk7IH0KICBub2RlLmNvdW50Kys7IC8vIGNvdW50IGNoYWlucy4u
LgoKICAvLyBjaGFpbiByZXN0IG9mIHBhdGggaWYgdGhlcmUgaXMgb25lCiAgaWYgKHBhdGggJiYg
cGF0aC5sZW5ndGg+MCkgewogICAga2V5ID0gZmlyc3RLZXkocGF0aCk7CiAgICBwYXRoID0gcGF0
aC5zbGljZShrZXkubGVuZ3RoKzEpOwogICAgbm9kZS5jaGFpbihrZXksIHBhdGgpOyAvLyBOT1RF
OiBubyBzcmMgbWVhbnMgaXQgd2lsbCBvYnNlcnZlIGNoYW5nZXMuLi4KICB9Cn07CgpDaGFpbk5v
ZGVQcm90b3R5cGUudW5jaGFpbiA9IGZ1bmN0aW9uKGtleSwgcGF0aCkgewogIHZhciBjaGFpbnMg
PSB0aGlzLl9jaGFpbnMsIG5vZGUgPSBjaGFpbnNba2V5XTsKCiAgLy8gdW5jaGFpbiByZXN0IG9m
IHBhdGggZmlyc3QuLi4KICBpZiAocGF0aCAmJiBwYXRoLmxlbmd0aD4xKSB7CiAgICBrZXkgID0g
Zmlyc3RLZXkocGF0aCk7CiAgICBwYXRoID0gcGF0aC5zbGljZShrZXkubGVuZ3RoKzEpOwogICAg
bm9kZS51bmNoYWluKGtleSwgcGF0aCk7CiAgfQoKICAvLyBkZWxldGUgbm9kZSBpZiBuZWVkZWQu
CiAgbm9kZS5jb3VudC0tOwogIGlmIChub2RlLmNvdW50PD0wKSB7CiAgICBkZWxldGUgY2hhaW5z
W25vZGUuX2tleV07CiAgICBub2RlLmRlc3Ryb3koKTsKICB9Cgp9OwoKQ2hhaW5Ob2RlUHJvdG90
eXBlLndpbGxDaGFuZ2UgPSBmdW5jdGlvbihldmVudHMpIHsKICB2YXIgY2hhaW5zID0gdGhpcy5f
Y2hhaW5zOwogIGlmIChjaGFpbnMpIHsKICAgIGZvcih2YXIga2V5IGluIGNoYWlucykgewogICAg
ICBpZiAoIWNoYWlucy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7IGNvbnRpbnVlOyB9CiAgICAgIGNo
YWluc1trZXldLndpbGxDaGFuZ2UoZXZlbnRzKTsKICAgIH0KICB9CgogIGlmICh0aGlzLl9wYXJl
bnQpIHsgdGhpcy5fcGFyZW50LmNoYWluV2lsbENoYW5nZSh0aGlzLCB0aGlzLl9rZXksIDEsIGV2
ZW50cyk7IH0KfTsKCkNoYWluTm9kZVByb3RvdHlwZS5jaGFpbldpbGxDaGFuZ2UgPSBmdW5jdGlv
bihjaGFpbiwgcGF0aCwgZGVwdGgsIGV2ZW50cykgewogIGlmICh0aGlzLl9rZXkpIHsgcGF0aCA9
IHRoaXMuX2tleSArICcuJyArIHBhdGg7IH0KCiAgaWYgKHRoaXMuX3BhcmVudCkgewogICAgdGhp
cy5fcGFyZW50LmNoYWluV2lsbENoYW5nZSh0aGlzLCBwYXRoLCBkZXB0aCsxLCBldmVudHMpOwog
IH0gZWxzZSB7CiAgICBpZiAoZGVwdGggPiAxKSB7CiAgICAgIGV2ZW50cy5wdXNoKHRoaXMudmFs
dWUoKSwgcGF0aCk7CiAgICB9CiAgICBwYXRoID0gJ3RoaXMuJyArIHBhdGg7CiAgICBpZiAodGhp
cy5fcGF0aHNbcGF0aF0gPiAwKSB7CiAgICAgIGV2ZW50cy5wdXNoKHRoaXMudmFsdWUoKSwgcGF0
aCk7CiAgICB9CiAgfQp9OwoKQ2hhaW5Ob2RlUHJvdG90eXBlLmNoYWluRGlkQ2hhbmdlID0gZnVu
Y3Rpb24oY2hhaW4sIHBhdGgsIGRlcHRoLCBldmVudHMpIHsKICBpZiAodGhpcy5fa2V5KSB7IHBh
dGggPSB0aGlzLl9rZXkgKyAnLicgKyBwYXRoOyB9CiAgaWYgKHRoaXMuX3BhcmVudCkgewogICAg
dGhpcy5fcGFyZW50LmNoYWluRGlkQ2hhbmdlKHRoaXMsIHBhdGgsIGRlcHRoKzEsIGV2ZW50cyk7
CiAgfSBlbHNlIHsKICAgIGlmIChkZXB0aCA+IDEpIHsKICAgICAgZXZlbnRzLnB1c2godGhpcy52
YWx1ZSgpLCBwYXRoKTsKICAgIH0KICAgIHBhdGggPSAndGhpcy4nICsgcGF0aDsKICAgIGlmICh0
aGlzLl9wYXRoc1twYXRoXSA+IDApIHsKICAgICAgZXZlbnRzLnB1c2godGhpcy52YWx1ZSgpLCBw
YXRoKTsKICAgIH0KICB9Cn07CgpDaGFpbk5vZGVQcm90b3R5cGUuZGlkQ2hhbmdlID0gZnVuY3Rp
b24oZXZlbnRzKSB7CiAgLy8gaW52YWxpZGF0ZSBteSBvd24gdmFsdWUgZmlyc3QuCiAgaWYgKHRo
aXMuX3dhdGNoaW5nKSB7CiAgICB2YXIgb2JqID0gdGhpcy5fcGFyZW50LnZhbHVlKCk7CiAgICBp
ZiAob2JqICE9PSB0aGlzLl9vYmplY3QpIHsKICAgICAgcmVtb3ZlQ2hhaW5XYXRjaGVyKHRoaXMu
X29iamVjdCwgdGhpcy5fa2V5LCB0aGlzKTsKICAgICAgdGhpcy5fb2JqZWN0ID0gb2JqOwogICAg
ICBhZGRDaGFpbldhdGNoZXIob2JqLCB0aGlzLl9rZXksIHRoaXMpOwogICAgfQogICAgdGhpcy5f
dmFsdWUgID0gdW5kZWZpbmVkOwoKICAgIC8vIFNwZWNpYWwtY2FzZTogdGhlIEVhY2hQcm94eSBy
ZWxpZXMgb24gaW1tZWRpYXRlIGV2YWx1YXRpb24gdG8KICAgIC8vIGVzdGFibGlzaCBpdHMgb2Jz
ZXJ2ZXJzLgogICAgaWYgKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuX2tleSA9PT0gJ0Bl
YWNoJykKICAgICAgdGhpcy52YWx1ZSgpOwogIH0KCiAgLy8gdGhlbiBub3RpZnkgY2hhaW5zLi4u
CiAgdmFyIGNoYWlucyA9IHRoaXMuX2NoYWluczsKICBpZiAoY2hhaW5zKSB7CiAgICBmb3IodmFy
IGtleSBpbiBjaGFpbnMpIHsKICAgICAgaWYgKCFjaGFpbnMuaGFzT3duUHJvcGVydHkoa2V5KSkg
eyBjb250aW51ZTsgfQogICAgICBjaGFpbnNba2V5XS5kaWRDaGFuZ2UoZXZlbnRzKTsKICAgIH0K
ICB9CgogIC8vIGlmIG5vIGV2ZW50cyBhcmUgcGFzc2VkIGluIHRoZW4gd2Ugb25seSBjYXJlIGFi
b3V0IHRoZSBhYm92ZSB3aXJpbmcgdXBkYXRlCiAgaWYgKGV2ZW50cyA9PT0gbnVsbCkgeyByZXR1
cm47IH0KCiAgLy8gYW5kIGZpbmFsbHkgdGVsbCBwYXJlbnQgYWJvdXQgbXkgcGF0aCBjaGFuZ2lu
Zy4uLgogIGlmICh0aGlzLl9wYXJlbnQpIHsgdGhpcy5fcGFyZW50LmNoYWluRGlkQ2hhbmdlKHRo
aXMsIHRoaXMuX2tleSwgMSwgZXZlbnRzKTsgfQp9OwoKRW1iZXIuZmluaXNoQ2hhaW5zID0gZnVu
Y3Rpb24ob2JqKSB7CiAgdmFyIG0gPSBtZXRhRm9yKG9iaiwgZmFsc2UpLCBjaGFpbnMgPSBtLmNo
YWluczsKICBpZiAoY2hhaW5zKSB7CiAgICBpZiAoY2hhaW5zLnZhbHVlKCkgIT09IG9iaikgewog
ICAgICBtLmNoYWlucyA9IGNoYWlucyA9IGNoYWlucy5jb3B5KG9iaik7CiAgICB9CiAgICBjaGFp
bnMuZGlkQ2hhbmdlKG51bGwpOwogIH0KfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKCn0pKCk7
CgoKCihmdW5jdGlvbigpIHsKdmFyIG1ldGFGb3IgPSBFbWJlci5tZXRhLCAvLyB1dGlscy5qcwog
ICAgdHlwZU9mID0gRW1iZXIudHlwZU9mLCAvLyB1dGlscy5qcwogICAgQ2hhaW5Ob2RlID0gRW1i
ZXIuX0NoYWluTm9kZTsgLy8gY2hhaW5zLmpzCgovLyBnZXQgdGhlIGNoYWlucyBmb3IgdGhlIGN1
cnJlbnQgb2JqZWN0LiBJZiB0aGUgY3VycmVudCBvYmplY3QgaGFzCi8vIGNoYWlucyBpbmhlcml0
ZWQgZnJvbSB0aGUgcHJvdG8gdGhleSB3aWxsIGJlIGNsb25lZCBhbmQgcmVjb25maWd1cmVkIGZv
cgovLyB0aGUgY3VycmVudCBvYmplY3QuCmZ1bmN0aW9uIGNoYWluc0ZvcihvYmopIHsKICB2YXIg
bSA9IG1ldGFGb3Iob2JqKSwgcmV0ID0gbS5jaGFpbnM7CiAgaWYgKCFyZXQpIHsKICAgIHJldCA9
IG0uY2hhaW5zID0gbmV3IENoYWluTm9kZShudWxsLCBudWxsLCBvYmopOwogIH0gZWxzZSBpZiAo
cmV0LnZhbHVlKCkgIT09IG9iaikgewogICAgcmV0ID0gbS5jaGFpbnMgPSByZXQuY29weShvYmop
OwogIH0KICByZXR1cm4gcmV0Owp9CgpFbWJlci53YXRjaFBhdGggPSBmdW5jdGlvbihvYmosIGtl
eVBhdGgpIHsKICAvLyBjYW4ndCB3YXRjaCBsZW5ndGggb24gQXJyYXkgLSBpdCBpcyBzcGVjaWFs
Li4uCiAgaWYgKGtleVBhdGggPT09ICdsZW5ndGgnICYmIHR5cGVPZihvYmopID09PSAnYXJyYXkn
KSB7IHJldHVybjsgfQoKICB2YXIgbSA9IG1ldGFGb3Iob2JqKSwgd2F0Y2hpbmcgPSBtLndhdGNo
aW5nOwoKICBpZiAoIXdhdGNoaW5nW2tleVBhdGhdKSB7IC8vIGFjdGl2YXRlIHdhdGNoaW5nIGZp
cnN0IHRpbWUKICAgIHdhdGNoaW5nW2tleVBhdGhdID0gMTsKICAgIGNoYWluc0ZvcihvYmopLmFk
ZChrZXlQYXRoKTsKICB9IGVsc2UgewogICAgd2F0Y2hpbmdba2V5UGF0aF0gPSAod2F0Y2hpbmdb
a2V5UGF0aF0gfHwgMCkgKyAxOwogIH0KfTsKCkVtYmVyLnVud2F0Y2hQYXRoID0gZnVuY3Rpb24o
b2JqLCBrZXlQYXRoKSB7CiAgdmFyIG0gPSBtZXRhRm9yKG9iaiksIHdhdGNoaW5nID0gbS53YXRj
aGluZzsKCiAgaWYgKHdhdGNoaW5nW2tleVBhdGhdID09PSAxKSB7CiAgICB3YXRjaGluZ1trZXlQ
YXRoXSA9IDA7CiAgICBjaGFpbnNGb3Iob2JqKS5yZW1vdmUoa2V5UGF0aCk7CiAgfSBlbHNlIGlm
ICh3YXRjaGluZ1trZXlQYXRoXSA+IDEpIHsKICAgIHdhdGNoaW5nW2tleVBhdGhdLS07CiAgfQp9
Owp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyLW1ldGFsCiovCgp2YXIg
bWV0YUZvciA9IEVtYmVyLm1ldGEsIC8vIHV0aWxzLmpzCiAgICBHVUlEX0tFWSA9IEVtYmVyLkdV
SURfS0VZLCAvLyB1dGlscy5qcwogICAgTUVUQV9LRVkgPSBFbWJlci5NRVRBX0tFWSwgLy8gdXRp
bHMuanMKICAgIHJlbW92ZUNoYWluV2F0Y2hlciA9IEVtYmVyLnJlbW92ZUNoYWluV2F0Y2hlciwK
ICAgIHdhdGNoS2V5ID0gRW1iZXIud2F0Y2hLZXksIC8vIHdhdGNoX2tleS5qcwogICAgdW53YXRj
aEtleSA9IEVtYmVyLnVud2F0Y2hLZXksCiAgICB3YXRjaFBhdGggPSBFbWJlci53YXRjaFBhdGgs
IC8vIHdhdGNoX3BhdGguanMKICAgIHVud2F0Y2hQYXRoID0gRW1iZXIudW53YXRjaFBhdGgsCiAg
ICB0eXBlT2YgPSBFbWJlci50eXBlT2YsIC8vIHV0aWxzLmpzCiAgICBnZW5lcmF0ZUd1aWQgPSBF
bWJlci5nZW5lcmF0ZUd1aWQsCiAgICBJU19QQVRIID0gL1tcLlwqXS87CgovLyByZXR1cm5zIHRy
dWUgaWYgdGhlIHBhc3NlZCBwYXRoIGlzIGp1c3QgYSBrZXlOYW1lCmZ1bmN0aW9uIGlzS2V5TmFt
ZShwYXRoKSB7CiAgcmV0dXJuIHBhdGg9PT0nKicgfHwgIUlTX1BBVEgudGVzdChwYXRoKTsKfQoK
LyoqCiAgU3RhcnRzIHdhdGNoaW5nIGEgcHJvcGVydHkgb24gYW4gb2JqZWN0LiBXaGVuZXZlciB0
aGUgcHJvcGVydHkgY2hhbmdlcywKICBpbnZva2VzIGBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2Vg
IGFuZCBgRW1iZXIucHJvcGVydHlEaWRDaGFuZ2VgLiBUaGlzIGlzIHRoZQogIHByaW1pdGl2ZSB1
c2VkIGJ5IG9ic2VydmVycyBhbmQgZGVwZW5kZW50IGtleXM7IHVzdWFsbHkgeW91IHdpbGwgbmV2
ZXIgY2FsbAogIHRoaXMgbWV0aG9kIGRpcmVjdGx5IGJ1dCBpbnN0ZWFkIHVzZSBoaWdoZXIgbGV2
ZWwgbWV0aG9kcyBsaWtlCiAgYEVtYmVyLmFkZE9ic2VydmVyKClgCgogIEBwcml2YXRlCiAgQG1l
dGhvZCB3YXRjaAogIEBmb3IgRW1iZXIKICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtTdHJpbmd9IGtl
eU5hbWUKKi8KRW1iZXIud2F0Y2ggPSBmdW5jdGlvbihvYmosIF9rZXlQYXRoKSB7CiAgLy8gY2Fu
J3Qgd2F0Y2ggbGVuZ3RoIG9uIEFycmF5IC0gaXQgaXMgc3BlY2lhbC4uLgogIGlmIChfa2V5UGF0
aCA9PT0gJ2xlbmd0aCcgJiYgdHlwZU9mKG9iaikgPT09ICdhcnJheScpIHsgcmV0dXJuOyB9Cgog
IGlmIChpc0tleU5hbWUoX2tleVBhdGgpKSB7CiAgICB3YXRjaEtleShvYmosIF9rZXlQYXRoKTsK
ICB9IGVsc2UgewogICAgd2F0Y2hQYXRoKG9iaiwgX2tleVBhdGgpOwogIH0KfTsKCkVtYmVyLmlz
V2F0Y2hpbmcgPSBmdW5jdGlvbiBpc1dhdGNoaW5nKG9iaiwga2V5KSB7CiAgdmFyIG1ldGEgPSBv
YmpbTUVUQV9LRVldOwogIHJldHVybiAobWV0YSAmJiBtZXRhLndhdGNoaW5nW2tleV0pID4gMDsK
fTsKCkVtYmVyLndhdGNoLmZsdXNoUGVuZGluZyA9IEVtYmVyLmZsdXNoUGVuZGluZ0NoYWluczsK
CkVtYmVyLnVud2F0Y2ggPSBmdW5jdGlvbihvYmosIF9rZXlQYXRoKSB7CiAgLy8gY2FuJ3Qgd2F0
Y2ggbGVuZ3RoIG9uIEFycmF5IC0gaXQgaXMgc3BlY2lhbC4uLgogIGlmIChfa2V5UGF0aCA9PT0g
J2xlbmd0aCcgJiYgdHlwZU9mKG9iaikgPT09ICdhcnJheScpIHsgcmV0dXJuOyB9CgogIGlmIChp
c0tleU5hbWUoX2tleVBhdGgpKSB7CiAgICB1bndhdGNoS2V5KG9iaiwgX2tleVBhdGgpOwogIH0g
ZWxzZSB7CiAgICB1bndhdGNoUGF0aChvYmosIF9rZXlQYXRoKTsKICB9Cn07CgovKioKICBDYWxs
IG9uIGFuIG9iamVjdCB3aGVuIHlvdSBmaXJzdCBiZWdldCBpdCBmcm9tIGFub3RoZXIgb2JqZWN0
LiBUaGlzIHdpbGwKICBzZXR1cCBhbnkgY2hhaW5lZCB3YXRjaGVycyBvbiB0aGUgb2JqZWN0IGlu
c3RhbmNlIGFzIG5lZWRlZC4gVGhpcyBtZXRob2QgaXMKICBzYWZlIHRvIGNhbGwgbXVsdGlwbGUg
dGltZXMuCgogIEBwcml2YXRlCiAgQG1ldGhvZCByZXdhdGNoCiAgQGZvciBFbWJlcgogIEBwYXJh
bSBvYmoKKi8KRW1iZXIucmV3YXRjaCA9IGZ1bmN0aW9uKG9iaikgewogIHZhciBtID0gbWV0YUZv
cihvYmosIGZhbHNlKSwgY2hhaW5zID0gbS5jaGFpbnM7CgogIC8vIG1ha2Ugc3VyZSB0aGUgb2Jq
ZWN0IGhhcyBpdHMgb3duIGd1aWQuCiAgaWYgKEdVSURfS0VZIGluIG9iaiAmJiAhb2JqLmhhc093
blByb3BlcnR5KEdVSURfS0VZKSkgewogICAgZ2VuZXJhdGVHdWlkKG9iaik7CiAgfQoKICAvLyBt
YWtlIHN1cmUgYW55IGNoYWluZWQgd2F0Y2hlcnMgdXBkYXRlLgogIGlmIChjaGFpbnMgJiYgY2hh
aW5zLnZhbHVlKCkgIT09IG9iaikgewogICAgbS5jaGFpbnMgPSBjaGFpbnMuY29weShvYmopOwog
IH0KfTsKCnZhciBOT0RFX1NUQUNLID0gW107CgovKioKICBUZWFycyBkb3duIHRoZSBtZXRhIG9u
IGFuIG9iamVjdCBzbyB0aGF0IGl0IGNhbiBiZSBnYXJiYWdlIGNvbGxlY3RlZC4KICBNdWx0aXBs
ZSBjYWxscyB3aWxsIGhhdmUgbm8gZWZmZWN0LgoKICBAbWV0aG9kIGRlc3Ryb3kKICBAZm9yIEVt
YmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiAgdGhlIG9iamVjdCB0byBkZXN0cm95CiAgQHJldHVy
biB7dm9pZH0KKi8KRW1iZXIuZGVzdHJveSA9IGZ1bmN0aW9uIChvYmopIHsKICB2YXIgbWV0YSA9
IG9ialtNRVRBX0tFWV0sIG5vZGUsIG5vZGVzLCBrZXksIG5vZGVPYmplY3Q7CiAgaWYgKG1ldGEp
IHsKICAgIG9ialtNRVRBX0tFWV0gPSBudWxsOwogICAgLy8gcmVtb3ZlIGNoYWluV2F0Y2hlcnMg
dG8gcmVtb3ZlIGNpcmN1bGFyIHJlZmVyZW5jZXMgdGhhdCB3b3VsZCBwcmV2ZW50IEdDCiAgICBu
b2RlID0gbWV0YS5jaGFpbnM7CiAgICBpZiAobm9kZSkgewogICAgICBOT0RFX1NUQUNLLnB1c2go
bm9kZSk7CiAgICAgIC8vIHByb2Nlc3MgdHJlZQogICAgICB3aGlsZSAoTk9ERV9TVEFDSy5sZW5n
dGggPiAwKSB7CiAgICAgICAgbm9kZSA9IE5PREVfU1RBQ0sucG9wKCk7CiAgICAgICAgLy8gcHVz
aCBjaGlsZHJlbgogICAgICAgIG5vZGVzID0gbm9kZS5fY2hhaW5zOwogICAgICAgIGlmIChub2Rl
cykgewogICAgICAgICAgZm9yIChrZXkgaW4gbm9kZXMpIHsKICAgICAgICAgICAgaWYgKG5vZGVz
Lmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBOT0RFX1NUQUNLLnB1c2gobm9k
ZXNba2V5XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8g
cmVtb3ZlIGNoYWluV2F0Y2hlciBpbiBub2RlIG9iamVjdAogICAgICAgIGlmIChub2RlLl93YXRj
aGluZykgewogICAgICAgICAgbm9kZU9iamVjdCA9IG5vZGUuX29iamVjdDsKICAgICAgICAgIGlm
IChub2RlT2JqZWN0KSB7CiAgICAgICAgICAgIHJlbW92ZUNoYWluV2F0Y2hlcihub2RlT2JqZWN0
LCBub2RlLl9rZXksIG5vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQog
IH0KfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXItbWV0YWwKKi8K
CkVtYmVyLndhcm4oIlRoZSBDUF9ERUZBVUxUX0NBQ0hFQUJMRSBmbGFnIGhhcyBiZWVuIHJlbW92
ZWQgYW5kIGNvbXB1dGVkIHByb3BlcnRpZXMgYXJlIGFsd2F5cyBjYWNoZWQgYnkgZGVmYXVsdC4g
VXNlIGB2b2xhdGlsZWAgaWYgeW91IGRvbid0IHdhbnQgY2FjaGluZy4iLCBFbWJlci5FTlYuQ1Bf
REVGQVVMVF9DQUNIRUFCTEUgIT09IGZhbHNlKTsKCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LAogICAg
c2V0ID0gRW1iZXIuc2V0LAogICAgbWV0YUZvciA9IEVtYmVyLm1ldGEsCiAgICBhX3NsaWNlID0g
W10uc2xpY2UsCiAgICBvX2NyZWF0ZSA9IEVtYmVyLmNyZWF0ZSwKICAgIE1FVEFfS0VZID0gRW1i
ZXIuTUVUQV9LRVksCiAgICB3YXRjaCA9IEVtYmVyLndhdGNoLAogICAgdW53YXRjaCA9IEVtYmVy
LnVud2F0Y2g7CgoKLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLgovLyBERVBFTkRFTlQgS0VZUwovLwoKLy8gZGF0YSBzdHJ1Y3R1cmU6
Ci8vICBtZXRhLmRlcHMgPSB7Ci8vICAgJ2RlcEtleSc6IHsKLy8gICAgICdrZXlOYW1lJzogY291
bnQsCi8vICAgfQovLyAgfQoKLyoKICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgYSBtYXAgb2YgdW5p
cXVlIGRlcGVuZGVuY2llcyBmb3IgYQogIGdpdmVuIG9iamVjdCBhbmQga2V5LgoqLwpmdW5jdGlv
biBrZXlzRm9yRGVwKGRlcHNNZXRhLCBkZXBLZXkpIHsKICB2YXIga2V5cyA9IGRlcHNNZXRhW2Rl
cEtleV07CiAgaWYgKCFrZXlzKSB7CiAgICAvLyBpZiB0aGVyZSBhcmUgbm8gZGVwZW5kZW5jaWVz
IHlldCBmb3IgYSB0aGUgZ2l2ZW4ga2V5CiAgICAvLyBjcmVhdGUgYSBuZXcgZW1wdHkgbGlzdCBv
ZiBkZXBlbmRlbmNpZXMgZm9yIHRoZSBrZXkKICAgIGtleXMgPSBkZXBzTWV0YVtkZXBLZXldID0g
e307CiAgfSBlbHNlIGlmICghZGVwc01ldGEuaGFzT3duUHJvcGVydHkoZGVwS2V5KSkgewogICAg
Ly8gb3RoZXJ3aXNlIGlmIHRoZSBkZXBlbmRlbmN5IGxpc3QgaXMgaW5oZXJpdGVkIGZyb20KICAg
IC8vIGEgc3VwZXJjbGFzcywgY2xvbmUgdGhlIGhhc2gKICAgIGtleXMgPSBkZXBzTWV0YVtkZXBL
ZXldID0gb19jcmVhdGUoa2V5cyk7CiAgfQogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBtZXRh
Rm9yRGVwcyhtZXRhKSB7CiAgcmV0dXJuIGtleXNGb3JEZXAobWV0YSwgJ2RlcHMnKTsKfQoKZnVu
Y3Rpb24gYWRkRGVwZW5kZW50S2V5cyhkZXNjLCBvYmosIGtleU5hbWUsIG1ldGEpIHsKICAvLyB0
aGUgZGVzY3JpcHRvciBoYXMgYSBsaXN0IG9mIGRlcGVuZGVudCBrZXlzLCBzbwogIC8vIGFkZCBh
bGwgb2YgaXRzIGRlcGVuZGVudCBrZXlzLgogIHZhciBkZXBLZXlzID0gZGVzYy5fZGVwZW5kZW50
S2V5cywgZGVwc01ldGEsIGlkeCwgbGVuLCBkZXBLZXksIGtleXM7CiAgaWYgKCFkZXBLZXlzKSBy
ZXR1cm47CgogIGRlcHNNZXRhID0gbWV0YUZvckRlcHMobWV0YSk7CgogIGZvcihpZHggPSAwLCBs
ZW4gPSBkZXBLZXlzLmxlbmd0aDsgaWR4IDwgbGVuOyBpZHgrKykgewogICAgZGVwS2V5ID0gZGVw
S2V5c1tpZHhdOwogICAgLy8gTG9va3VwIGtleXMgbWV0YSBmb3IgZGVwS2V5CiAgICBrZXlzID0g
a2V5c0ZvckRlcChkZXBzTWV0YSwgZGVwS2V5KTsKICAgIC8vIEluY3JlbWVudCB0aGUgbnVtYmVy
IG9mIHRpbWVzIGRlcEtleSBkZXBlbmRzIG9uIGtleU5hbWUuCiAgICBrZXlzW2tleU5hbWVdID0g
KGtleXNba2V5TmFtZV0gfHwgMCkgKyAxOwogICAgLy8gV2F0Y2ggdGhlIGRlcEtleQogICAgd2F0
Y2gob2JqLCBkZXBLZXkpOwogIH0KfQoKZnVuY3Rpb24gcmVtb3ZlRGVwZW5kZW50S2V5cyhkZXNj
LCBvYmosIGtleU5hbWUsIG1ldGEpIHsKICAvLyB0aGUgZGVzY3JpcHRvciBoYXMgYSBsaXN0IG9m
IGRlcGVuZGVudCBrZXlzLCBzbwogIC8vIGFkZCBhbGwgb2YgaXRzIGRlcGVuZGVudCBrZXlzLgog
IHZhciBkZXBLZXlzID0gZGVzYy5fZGVwZW5kZW50S2V5cywgZGVwc01ldGEsIGlkeCwgbGVuLCBk
ZXBLZXksIGtleXM7CiAgaWYgKCFkZXBLZXlzKSByZXR1cm47CgogIGRlcHNNZXRhID0gbWV0YUZv
ckRlcHMobWV0YSk7CgogIGZvcihpZHggPSAwLCBsZW4gPSBkZXBLZXlzLmxlbmd0aDsgaWR4IDwg
bGVuOyBpZHgrKykgewogICAgZGVwS2V5ID0gZGVwS2V5c1tpZHhdOwogICAgLy8gTG9va3VwIGtl
eXMgbWV0YSBmb3IgZGVwS2V5CiAgICBrZXlzID0ga2V5c0ZvckRlcChkZXBzTWV0YSwgZGVwS2V5
KTsKICAgIC8vIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIHRpbWVzIGRlcEtleSBkZXBlbmRzIG9u
IGtleU5hbWUuCiAgICBrZXlzW2tleU5hbWVdID0gKGtleXNba2V5TmFtZV0gfHwgMCkgLSAxOwog
ICAgLy8gV2F0Y2ggdGhlIGRlcEtleQogICAgdW53YXRjaChvYmosIGRlcEtleSk7CiAgfQp9Cgov
LyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uCi8vIENPTVBVVEVEIFBST1BFUlRZCi8vCgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRy
YW5zZm9ybXMgYW4gb2JqZWN0cyBmdW5jdGlvbiBpbnRvIGEgcHJvcGVydHkuCgogIEJ5IGRlZmF1
bHQgdGhlIGZ1bmN0aW9uIGJhY2tpbmcgdGhlIGNvbXB1dGVkIHByb3BlcnR5IHdpbGwgb25seSBi
ZSBjYWxsZWQKICBvbmNlIGFuZCB0aGUgcmVzdWx0IHdpbGwgYmUgY2FjaGVkLiBZb3UgY2FuIHNw
ZWNpZnkgdmFyaW91cyBwcm9wZXJ0aWVzCiAgdGhhdCB5b3VyIGNvbXB1dGVkIHByb3BlcnR5IGlz
IGRlcGVuZGVudCBvbi4gVGhpcyB3aWxsIGZvcmNlIHRoZSBjYWNoZWQKICByZXN1bHQgdG8gYmUg
cmVjb21wdXRlZCBpZiB0aGUgZGVwZW5kZW5jaWVzIGFyZSBtb2RpZmllZC4KCiAgSW4gdGhlIGZv
bGxvd2luZyBleGFtcGxlIHdlIGRlY2xhcmUgYSBjb21wdXRlZCBwcm9wZXJ0eSAoYnkgY2FsbGlu
ZwogIGAucHJvcGVydHkoKWAgb24gdGhlIGZ1bGxOYW1lIGZ1bmN0aW9uKSBhbmQgc2V0dXAgdGhl
IHByb3BlcnRpZXMKICBkZXBlbmRlbmNpZXMgKGRlcGVuZGluZyBvbiBmaXJzdE5hbWUgYW5kIGxh
c3ROYW1lKS4gVGhlIGZ1bGxOYW1lIGZ1bmN0aW9uCiAgd2lsbCBiZSBjYWxsZWQgb25jZSAocmVn
YXJkbGVzcyBvZiBob3cgbWFueSB0aW1lcyBpdCBpcyBhY2Nlc3NlZCkgYXMgbG9uZwogIGFzIGl0
J3MgZGVwZW5kZW5jaWVzIGhhdmUgbm90IGJlZW4gY2hhbmdlZC4gT25jZSBmaXJzdE5hbWUgb3Ig
bGFzdE5hbWUgYXJlIHVwZGF0ZWQKICBhbnkgZnV0dXJlIGNhbGxzIChvciBhbnl0aGluZyBib3Vu
ZCkgdG8gZnVsbE5hbWUgd2lsbCBpbmNvcnBvcmF0ZSB0aGUgbmV3CiAgdmFsdWVzLgoKICBgYGBq
YXZhc2NyaXB0CiAgUGVyc29uID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICAvLyB0aGVzZSB3
aWxsIGJlIHN1cHBsaWVkIGJ5IGBjcmVhdGVgCiAgICBmaXJzdE5hbWU6IG51bGwsCiAgICBsYXN0
TmFtZTogbnVsbCwKCiAgICBmdWxsTmFtZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmaXJzdE5h
bWUgPSB0aGlzLmdldCgnZmlyc3ROYW1lJyk7CiAgICAgIHZhciBsYXN0TmFtZSA9IHRoaXMuZ2V0
KCdsYXN0TmFtZScpOwoKICAgICByZXR1cm4gZmlyc3ROYW1lICsgJyAnICsgbGFzdE5hbWU7CiAg
ICB9LnByb3BlcnR5KCdmaXJzdE5hbWUnLCAnbGFzdE5hbWUnKQogIH0pOwoKICB2YXIgdG9tID0g
UGVyc29uLmNyZWF0ZSh7CiAgICBmaXJzdE5hbWU6ICJUb20iLAogICAgbGFzdE5hbWU6ICJEYWxl
IgogIH0pOwoKICB0b20uZ2V0KCdmdWxsTmFtZScpIC8vICJUb20gRGFsZSIKICBgYGAKCiAgWW91
IGNhbiBhbHNvIGRlZmluZSB3aGF0IEVtYmVyIHNob3VsZCBkbyB3aGVuIHNldHRpbmcgYSBjb21w
dXRlZCBwcm9wZXJ0eS4KICBJZiB5b3UgdHJ5IHRvIHNldCBhIGNvbXB1dGVkIHByb3BlcnR5LCBp
dCB3aWxsIGJlIGludm9rZWQgd2l0aCB0aGUga2V5IGFuZAogIHZhbHVlIHlvdSB3YW50IHRvIHNl
dCBpdCB0by4gWW91IGNhbiBhbHNvIGFjY2VwdCB0aGUgcHJldmlvdXMgdmFsdWUgYXMgdGhlCiAg
dGhpcmQgcGFyYW1ldGVyLgoKICBgYGBqYXZhc2NyaXB0CgogUGVyc29uID0gRW1iZXIuT2JqZWN0
LmV4dGVuZCh7CiAgICAvLyB0aGVzZSB3aWxsIGJlIHN1cHBsaWVkIGJ5IGBjcmVhdGVgCiAgICBm
aXJzdE5hbWU6IG51bGwsCiAgICBsYXN0TmFtZTogbnVsbCwKCiAgICBmdWxsTmFtZTogZnVuY3Rp
b24oa2V5LCB2YWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgLy8gZ2V0dGVyCiAgICAgIGlmIChhcmd1
bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdmFyIGZpcnN0TmFtZSA9IHRoaXMuZ2V0KCdm
aXJzdE5hbWUnKTsKICAgICAgICB2YXIgbGFzdE5hbWUgPSB0aGlzLmdldCgnbGFzdE5hbWUnKTsK
CiAgICAgICAgcmV0dXJuIGZpcnN0TmFtZSArICcgJyArIGxhc3ROYW1lOwoKICAgICAgLy8gc2V0
dGVyCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG5hbWUgPSB2YWx1ZS5zcGxpdCgiICIpOwoK
ICAgICAgICB0aGlzLnNldCgnZmlyc3ROYW1lJywgbmFtZVswXSk7CiAgICAgICAgdGhpcy5zZXQo
J2xhc3ROYW1lJywgbmFtZVsxXSk7CgogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAg
fS5wcm9wZXJ0eSgnZmlyc3ROYW1lJywgJ2xhc3ROYW1lJykKICB9KTsKCiAgdmFyIHBlcnNvbiA9
IFBlcnNvbi5jcmVhdGUoKTsKICBwZXJzb24uc2V0KCdmdWxsTmFtZScsICJQZXRlciBXYWdlbmV0
Iik7CiAgcGVyc29uLmdldCgnZmlyc3ROYW1lJykgLy8gUGV0ZXIKICBwZXJzb24uZ2V0KCdsYXN0
TmFtZScpIC8vIFdhZ2VuZXQKICBgYGAKCiAgQGNsYXNzIENvbXB1dGVkUHJvcGVydHkKICBAbmFt
ZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuRGVzY3JpcHRvcgogIEBjb25zdHJ1Y3Rvcgoq
LwpmdW5jdGlvbiBDb21wdXRlZFByb3BlcnR5KGZ1bmMsIG9wdHMpIHsKICB0aGlzLmZ1bmMgPSBm
dW5jOwoKICB0aGlzLl9jYWNoZWFibGUgPSAob3B0cyAmJiBvcHRzLmNhY2hlYWJsZSAhPT0gdW5k
ZWZpbmVkKSA/IG9wdHMuY2FjaGVhYmxlIDogdHJ1ZTsKICB0aGlzLl9kZXBlbmRlbnRLZXlzID0g
b3B0cyAmJiBvcHRzLmRlcGVuZGVudEtleXM7CiAgdGhpcy5fcmVhZE9ubHkgPSBvcHRzICYmIChv
cHRzLnJlYWRPbmx5ICE9PSB1bmRlZmluZWQgfHwgISFvcHRzLnJlYWRPbmx5KTsKfQoKRW1iZXIu
Q29tcHV0ZWRQcm9wZXJ0eSA9IENvbXB1dGVkUHJvcGVydHk7CkNvbXB1dGVkUHJvcGVydHkucHJv
dG90eXBlID0gbmV3IEVtYmVyLkRlc2NyaXB0b3IoKTsKCnZhciBDb21wdXRlZFByb3BlcnR5UHJv
dG90eXBlID0gQ29tcHV0ZWRQcm9wZXJ0eS5wcm90b3R5cGU7CgovKioKICBQcm9wZXJ0aWVzIGFy
ZSBjYWNoZWFibGUgYnkgZGVmYXVsdC4gQ29tcHV0ZWQgcHJvcGVydHkgd2lsbCBhdXRvbWF0aWNh
bGx5CiAgY2FjaGUgdGhlIHJldHVybiB2YWx1ZSBvZiB5b3VyIGZ1bmN0aW9uIHVudGlsIG9uZSBv
ZiB0aGUgZGVwZW5kZW50IGtleXMgY2hhbmdlcy4KCiAgQ2FsbCBgdm9sYXRpbGUoKWAgdG8gc2V0
IGl0IGludG8gbm9uLWNhY2hlZCBtb2RlLiBXaGVuIGluIHRoaXMgbW9kZQogIHRoZSBjb21wdXRl
ZCBwcm9wZXJ0eSB3aWxsIG5vdCBhdXRvbWF0aWNhbGx5IGNhY2hlIHRoZSByZXR1cm4gdmFsdWUu
CgogIEhvd2V2ZXIsIGlmIGEgcHJvcGVydHkgaXMgcHJvcGVybHkgb2JzZXJ2YWJsZSwgdGhlcmUg
aXMgbm8gcmVhc29uIHRvIGRpc2FibGUKICBjYWNoaW5nLgoKICBAbWV0aG9kIGNhY2hlYWJsZQog
IEBwYXJhbSB7Qm9vbGVhbn0gYUZsYWcgb3B0aW9uYWwgc2V0IHRvIGBmYWxzZWAgdG8gZGlzYWJs
ZSBjYWNoaW5nCiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gdGhpcwogIEBjaGFp
bmFibGUKKi8KQ29tcHV0ZWRQcm9wZXJ0eVByb3RvdHlwZS5jYWNoZWFibGUgPSBmdW5jdGlvbihh
RmxhZykgewogIHRoaXMuX2NhY2hlYWJsZSA9IGFGbGFnICE9PSBmYWxzZTsKICByZXR1cm4gdGhp
czsKfTsKCi8qKgogIENhbGwgb24gYSBjb21wdXRlZCBwcm9wZXJ0eSB0byBzZXQgaXQgaW50byBu
b24tY2FjaGVkIG1vZGUuIFdoZW4gaW4gdGhpcwogIG1vZGUgdGhlIGNvbXB1dGVkIHByb3BlcnR5
IHdpbGwgbm90IGF1dG9tYXRpY2FsbHkgY2FjaGUgdGhlIHJldHVybiB2YWx1ZS4KCiAgYGBgamF2
YXNjcmlwdAogIE15QXBwLm91dHNpZGVTZXJ2aWNlID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAg
ICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBPdXRzaWRlU2VydmljZS5nZXRWYWx1
ZSgpOwogICAgfS5wcm9wZXJ0eSgpLnZvbGF0aWxlKCkKICB9KS5jcmVhdGUoKTsKICBgYGAKCiAg
QG1ldGhvZCB2b2xhdGlsZQogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IHRoaXMK
ICBAY2hhaW5hYmxlCiovCkNvbXB1dGVkUHJvcGVydHlQcm90b3R5cGUudm9sYXRpbGUgPSBmdW5j
dGlvbigpIHsKICByZXR1cm4gdGhpcy5jYWNoZWFibGUoZmFsc2UpOwp9OwoKLyoqCiAgQ2FsbCBv
biBhIGNvbXB1dGVkIHByb3BlcnR5IHRvIHNldCBpdCBpbnRvIHJlYWQtb25seSBtb2RlLiBXaGVu
IGluIHRoaXMKICBtb2RlIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSB3aWxsIHRocm93IGFuIGVycm9y
IHdoZW4gc2V0LgoKICBgYGBqYXZhc2NyaXB0CiAgTXlBcHAuUGVyc29uID0gRW1iZXIuT2JqZWN0
LmV4dGVuZCh7CiAgICBndWlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICdndWlkLWd1aWQt
Z3VpZCc7CiAgICB9LnByb3BlcnR5KCkucmVhZE9ubHkoKQogIH0pOwoKICBNeUFwcC5wZXJzb24g
PSBNeUFwcC5QZXJzb24uY3JlYXRlKCk7CgogIE15QXBwLnBlcnNvbi5zZXQoJ2d1aWQnLCAnbmV3
LWd1aWQnKTsgLy8gd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KICBgYGAKCiAgQG1ldGhvZCByZWFk
T25seQogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IHRoaXMKICBAY2hhaW5hYmxl
CiovCkNvbXB1dGVkUHJvcGVydHlQcm90b3R5cGUucmVhZE9ubHkgPSBmdW5jdGlvbihyZWFkT25s
eSkgewogIHRoaXMuX3JlYWRPbmx5ID0gcmVhZE9ubHkgPT09IHVuZGVmaW5lZCB8fCAhIXJlYWRP
bmx5OwogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAgU2V0cyB0aGUgZGVwZW5kZW50IGtleXMgb24g
dGhpcyBjb21wdXRlZCBwcm9wZXJ0eS4gUGFzcyBhbnkgbnVtYmVyIG9mCiAgYXJndW1lbnRzIGNv
bnRhaW5pbmcga2V5IHBhdGhzIHRoYXQgdGhpcyBjb21wdXRlZCBwcm9wZXJ0eSBkZXBlbmRzIG9u
LgoKICBgYGBqYXZhc2NyaXB0CiAgTXlBcHAuUHJlc2lkZW50ID0gRW1iZXIuT2JqZWN0LmV4dGVu
ZCh7CiAgICBmdWxsTmFtZTogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVy
biB0aGlzLmdldCgnZmlyc3ROYW1lJykgKyAnICcgKyB0aGlzLmdldCgnbGFzdE5hbWUnKTsKCiAg
ICAgIC8vIFRlbGwgRW1iZXIgdGhhdCB0aGlzIGNvbXB1dGVkIHByb3BlcnR5IGRlcGVuZHMgb24g
Zmlyc3ROYW1lCiAgICAgIC8vIGFuZCBsYXN0TmFtZQogICAgfSkucHJvcGVydHkoJ2ZpcnN0TmFt
ZScsICdsYXN0TmFtZScpCiAgfSk7CgogIE15QXBwLnByZXNpZGVudCA9IE15QXBwLlByZXNpZGVu
dC5jcmVhdGUoewogICAgZmlyc3ROYW1lOiAnQmFyYWNrJywKICAgIGxhc3ROYW1lOiAnT2JhbWEn
LAogIH0pOwogIE15QXBwLnByZXNpZGVudC5nZXQoJ2Z1bGxOYW1lJyk7IC8vIEJhcmFjayBPYmFt
YQogIGBgYAoKICBAbWV0aG9kIHByb3BlcnR5CiAgQHBhcmFtIHtTdHJpbmd9IHBhdGgqIHplcm8g
b3IgbW9yZSBwcm9wZXJ0eSBwYXRocwogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9
IHRoaXMKICBAY2hhaW5hYmxlCiovCkNvbXB1dGVkUHJvcGVydHlQcm90b3R5cGUucHJvcGVydHkg
PSBmdW5jdGlvbigpIHsKICB2YXIgYXJnczsKCiAgCiAgICBhcmdzID0gYV9zbGljZS5jYWxsKGFy
Z3VtZW50cyk7CiAgCgogIHRoaXMuX2RlcGVuZGVudEtleXMgPSBhcmdzOwogIHJldHVybiB0aGlz
Owp9OwoKLyoqCiAgSW4gc29tZSBjYXNlcywgeW91IG1heSB3YW50IHRvIGFubm90YXRlIGNvbXB1
dGVkIHByb3BlcnRpZXMgd2l0aCBhZGRpdGlvbmFsCiAgbWV0YWRhdGEgYWJvdXQgaG93IHRoZXkg
ZnVuY3Rpb24gb3Igd2hhdCB2YWx1ZXMgdGhleSBvcGVyYXRlIG9uLiBGb3IgZXhhbXBsZSwKICBj
b21wdXRlZCBwcm9wZXJ0eSBmdW5jdGlvbnMgbWF5IGNsb3NlIG92ZXIgdmFyaWFibGVzIHRoYXQg
YXJlIHRoZW4gbm8gbG9uZ2VyCiAgYXZhaWxhYmxlIGZvciBpbnRyb3NwZWN0aW9uLgoKICBZb3Ug
Y2FuIHBhc3MgYSBoYXNoIG9mIHRoZXNlIHZhbHVlcyB0byBhIGNvbXB1dGVkIHByb3BlcnR5IGxp
a2UgdGhpczoKCiAgYGBgCiAgcGVyc29uOiBmdW5jdGlvbigpIHsKICAgIHZhciBwZXJzb25JZCA9
IHRoaXMuZ2V0KCdwZXJzb25JZCcpOwogICAgcmV0dXJuIEFwcC5QZXJzb24uY3JlYXRlKHsgaWQ6
IHBlcnNvbklkIH0pOwogIH0ucHJvcGVydHkoKS5tZXRhKHsgdHlwZTogQXBwLlBlcnNvbiB9KQog
IGBgYAoKICBUaGUgaGFzaCB0aGF0IHlvdSBwYXNzIHRvIHRoZSBgbWV0YSgpYCBmdW5jdGlvbiB3
aWxsIGJlIHNhdmVkIG9uIHRoZQogIGNvbXB1dGVkIHByb3BlcnR5IGRlc2NyaXB0b3IgdW5kZXIg
dGhlIGBfbWV0YWAga2V5LiBFbWJlciBydW50aW1lCiAgZXhwb3NlcyBhIHB1YmxpYyBBUEkgZm9y
IHJldHJpZXZpbmcgdGhlc2UgdmFsdWVzIGZyb20gY2xhc3NlcywKICB2aWEgdGhlIGBtZXRhRm9y
UHJvcGVydHkoKWAgZnVuY3Rpb24uCgogIEBtZXRob2QgbWV0YQogIEBwYXJhbSB7SGFzaH0gbWV0
YQogIEBjaGFpbmFibGUKKi8KCkNvbXB1dGVkUHJvcGVydHlQcm90b3R5cGUubWV0YSA9IGZ1bmN0
aW9uKG1ldGEpIHsKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHRo
aXMuX21ldGEgfHwge307CiAgfSBlbHNlIHsKICAgIHRoaXMuX21ldGEgPSBtZXRhOwogICAgcmV0
dXJuIHRoaXM7CiAgfQp9OwoKLyogaW1wbCBkZXNjcmlwdG9yIEFQSSAqLwpDb21wdXRlZFByb3Bl
cnR5UHJvdG90eXBlLmRpZENoYW5nZSA9IGZ1bmN0aW9uKG9iaiwga2V5TmFtZSkgewogIC8vIF9z
dXNwZW5kZWQgaXMgc2V0IHZpYSBhIENQLnNldCB0byBlbnN1cmUgd2UgZG9uJ3QgY2xlYXIKICAv
LyB0aGUgY2FjaGVkIHZhbHVlIHNldCBieSB0aGUgc2V0dGVyCiAgaWYgKHRoaXMuX2NhY2hlYWJs
ZSAmJiB0aGlzLl9zdXNwZW5kZWQgIT09IG9iaikgewogICAgdmFyIG1ldGEgPSBtZXRhRm9yKG9i
aik7CiAgICBpZiAoa2V5TmFtZSBpbiBtZXRhLmNhY2hlKSB7CiAgICAgIGRlbGV0ZSBtZXRhLmNh
Y2hlW2tleU5hbWVdOwogICAgICByZW1vdmVEZXBlbmRlbnRLZXlzKHRoaXMsIG9iaiwga2V5TmFt
ZSwgbWV0YSk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gZmluaXNoQ2hhaW5zKGNoYWluTm9kZXMp
CnsKICBmb3IgKHZhciBpPTAsIGw9Y2hhaW5Ob2Rlcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICBj
aGFpbk5vZGVzW2ldLmRpZENoYW5nZShudWxsKTsKICB9Cn0KCi8qKgogIEFjY2VzcyB0aGUgdmFs
dWUgb2YgdGhlIGZ1bmN0aW9uIGJhY2tpbmcgdGhlIGNvbXB1dGVkIHByb3BlcnR5LgogIElmIHRo
aXMgcHJvcGVydHkgaGFzIGFscmVhZHkgYmVlbiBjYWNoZWQsIHJldHVybiB0aGUgY2FjaGVkIHJl
c3VsdC4KICBPdGhlcndpc2UsIGNhbGwgdGhlIGZ1bmN0aW9uIHBhc3NpbmcgdGhlIHByb3BlcnR5
IG5hbWUgYXMgYW4gYXJndW1lbnQuCgogIGBgYGphdmFzY3JpcHQKICBQZXJzb24gPSBFbWJlci5P
YmplY3QuZXh0ZW5kKHsKICAgIGZ1bGxOYW1lOiBmdW5jdGlvbihrZXlOYW1lKSB7CiAgICAgIC8v
IHRoZSBrZXlOYW1lIHBhcmFtZXRlciBpcyAnZnVsbE5hbWUnIGluIHRoaXMgY2FzZS4KCiAgICAg
IHJldHVybiB0aGlzLmdldCgnZmlyc3ROYW1lJykgKyAnICcgKyB0aGlzLmdldCgnbGFzdE5hbWUn
KTsKICAgIH0ucHJvcGVydHkoJ2ZpcnN0TmFtZScsICdsYXN0TmFtZScpCiAgfSk7CgoKICB2YXIg
dG9tID0gUGVyc29uLmNyZWF0ZSh7CiAgICBmaXJzdE5hbWU6ICJUb20iLAogICAgbGFzdE5hbWU6
ICJEYWxlIgogIH0pOwoKICB0b20uZ2V0KCdmdWxsTmFtZScpIC8vICJUb20gRGFsZSIKICBgYGAK
CiAgQG1ldGhvZCBnZXQKICBAcGFyYW0ge1N0cmluZ30ga2V5TmFtZSBUaGUga2V5IGJlaW5nIGFj
Y2Vzc2VkLgogIEByZXR1cm4ge09iamVjdH0gVGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rp
b24gYmFja2luZyB0aGUgQ1AuCiovCkNvbXB1dGVkUHJvcGVydHlQcm90b3R5cGUuZ2V0ID0gZnVu
Y3Rpb24ob2JqLCBrZXlOYW1lKSB7CiAgdmFyIHJldCwgY2FjaGUsIG1ldGEsIGNoYWluTm9kZXM7
CiAgaWYgKHRoaXMuX2NhY2hlYWJsZSkgewogICAgbWV0YSA9IG1ldGFGb3Iob2JqKTsKICAgIGNh
Y2hlID0gbWV0YS5jYWNoZTsKICAgIGlmIChrZXlOYW1lIGluIGNhY2hlKSB7IHJldHVybiBjYWNo
ZVtrZXlOYW1lXTsgfQogICAgcmV0ID0gY2FjaGVba2V5TmFtZV0gPSB0aGlzLmZ1bmMuY2FsbChv
YmosIGtleU5hbWUpOwogICAgY2hhaW5Ob2RlcyA9IG1ldGEuY2hhaW5XYXRjaGVycyAmJiBtZXRh
LmNoYWluV2F0Y2hlcnNba2V5TmFtZV07CiAgICBpZiAoY2hhaW5Ob2RlcykgeyBmaW5pc2hDaGFp
bnMoY2hhaW5Ob2Rlcyk7IH0KICAgIGFkZERlcGVuZGVudEtleXModGhpcywgb2JqLCBrZXlOYW1l
LCBtZXRhKTsKICB9IGVsc2UgewogICAgcmV0ID0gdGhpcy5mdW5jLmNhbGwob2JqLCBrZXlOYW1l
KTsKICB9CiAgcmV0dXJuIHJldDsKfTsKCi8qKgogIFNldCB0aGUgdmFsdWUgb2YgYSBjb21wdXRl
ZCBwcm9wZXJ0eS4gSWYgdGhlIGZ1bmN0aW9uIHRoYXQgYmFja3MgeW91cgogIGNvbXB1dGVkIHBy
b3BlcnR5IGRvZXMgbm90IGFjY2VwdCBhcmd1bWVudHMgdGhlbiB0aGUgZGVmYXVsdCBhY3Rpb24g
Zm9yCiAgc2V0dGluZyB3b3VsZCBiZSB0byBkZWZpbmUgdGhlIHByb3BlcnR5IG9uIHRoZSBjdXJy
ZW50IG9iamVjdCwgYW5kIHNldAogIHRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgdG8gdGhlIHZh
bHVlIGJlaW5nIHNldC4KCiAgR2VuZXJhbGx5IHNwZWFraW5nIGlmIHlvdSBpbnRlbmQgZm9yIHlv
dXIgY29tcHV0ZWQgcHJvcGVydHkgdG8gYmUgc2V0CiAgeW91ciBiYWNraW5nIGZ1bmN0aW9uIHNo
b3VsZCBhY2NlcHQgZWl0aGVyIHR3byBvciB0aHJlZSBhcmd1bWVudHMuCgogIEBtZXRob2Qgc2V0
CiAgQHBhcmFtIHtTdHJpbmd9IGtleU5hbWUgVGhlIGtleSBiZWluZyBhY2Nlc3NlZC4KICBAcGFy
YW0ge09iamVjdH0gbmV3VmFsdWUgVGhlIG5ldyB2YWx1ZSBiZWluZyBhc3NpZ25lZC4KICBAcGFy
YW0ge1N0cmluZ30gb2xkVmFsdWUgVGhlIG9sZCB2YWx1ZSBiZWluZyByZXBsYWNlZC4KICBAcmV0
dXJuIHtPYmplY3R9IFRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIGJhY2tpbmcgdGhl
IENQLgoqLwpDb21wdXRlZFByb3BlcnR5UHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKG9iaiwga2V5
TmFtZSwgdmFsdWUpIHsKICB2YXIgY2FjaGVhYmxlID0gdGhpcy5fY2FjaGVhYmxlLAogICAgICBm
dW5jID0gdGhpcy5mdW5jLAogICAgICBtZXRhID0gbWV0YUZvcihvYmosIGNhY2hlYWJsZSksCiAg
ICAgIHdhdGNoZWQgPSBtZXRhLndhdGNoaW5nW2tleU5hbWVdLAogICAgICBvbGRTdXNwZW5kZWQg
PSB0aGlzLl9zdXNwZW5kZWQsCiAgICAgIGhhZENhY2hlZFZhbHVlID0gZmFsc2UsCiAgICAgIGNh
Y2hlID0gbWV0YS5jYWNoZSwKICAgICAgZnVuY0FyZ0xlbmd0aCwgY2FjaGVkVmFsdWUsIHJldDsK
CiAgaWYgKHRoaXMuX3JlYWRPbmx5KSB7CiAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoJ0Nhbm5v
dCBTZXQ6ICcgKyBrZXlOYW1lICsgJyBvbjogJyArIG9iai50b1N0cmluZygpICk7CiAgfQoKICB0
aGlzLl9zdXNwZW5kZWQgPSBvYmo7CgogIHRyeSB7CgogICAgaWYgKGNhY2hlYWJsZSAmJiBjYWNo
ZS5oYXNPd25Qcm9wZXJ0eShrZXlOYW1lKSkgewogICAgICBjYWNoZWRWYWx1ZSA9IGNhY2hlW2tl
eU5hbWVdOwogICAgICBoYWRDYWNoZWRWYWx1ZSA9IHRydWU7CiAgICB9CgogICAgLy8gQ2hlY2sg
aWYgdGhlIENQIGhhcyBiZWVuIHdyYXBwZWQuIElmIGlmIGhhcywgdXNlIHRoZQogICAgLy8gbGVu
Z3RoIGZyb20gdGhlIHdyYXBwZWQgZnVuY3Rpb24uCiAgICBmdW5jQXJnTGVuZ3RoID0gKGZ1bmMu
d3JhcHBlZEZ1bmN0aW9uID8gZnVuYy53cmFwcGVkRnVuY3Rpb24ubGVuZ3RoIDogZnVuYy5sZW5n
dGgpOwoKICAgIC8vIEZvciBiYWNrd2FyZHMtY29tcGF0aWJpbGl0eSB3aXRoIGNvbXB1dGVkIHBy
b3BlcnRpZXMKICAgIC8vIHRoYXQgY2hlY2sgZm9yIGFyZ3VtZW50cy5sZW5ndGggPT09IDIgdG8g
ZGV0ZXJtaW5lIGlmCiAgICAvLyB0aGV5IGFyZSBiZWluZyBnZXQgb3Igc2V0LCBvbmx5IHBhc3Mg
dGhlIG9sZCBjYWNoZWQKICAgIC8vIHZhbHVlIGlmIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSBvcHRz
IGludG8gYSB0aGlyZAogICAgLy8gYXJndW1lbnQuCiAgICBpZiAoZnVuY0FyZ0xlbmd0aCA9PT0g
MykgewogICAgICByZXQgPSBmdW5jLmNhbGwob2JqLCBrZXlOYW1lLCB2YWx1ZSwgY2FjaGVkVmFs
dWUpOwogICAgfSBlbHNlIGlmIChmdW5jQXJnTGVuZ3RoID09PSAyKSB7CiAgICAgIHJldCA9IGZ1
bmMuY2FsbChvYmosIGtleU5hbWUsIHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIEVtYmVyLmRl
ZmluZVByb3BlcnR5KG9iaiwga2V5TmFtZSwgbnVsbCwgY2FjaGVkVmFsdWUpOwogICAgICBFbWJl
ci5zZXQob2JqLCBrZXlOYW1lLCB2YWx1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAo
aGFkQ2FjaGVkVmFsdWUgJiYgY2FjaGVkVmFsdWUgPT09IHJldCkgeyByZXR1cm47IH0KCiAgICBp
ZiAod2F0Y2hlZCkgeyBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2Uob2JqLCBrZXlOYW1lKTsgfQoK
ICAgIGlmIChoYWRDYWNoZWRWYWx1ZSkgewogICAgICBkZWxldGUgY2FjaGVba2V5TmFtZV07CiAg
ICB9CgogICAgaWYgKGNhY2hlYWJsZSkgewogICAgICBpZiAoIWhhZENhY2hlZFZhbHVlKSB7CiAg
ICAgICAgYWRkRGVwZW5kZW50S2V5cyh0aGlzLCBvYmosIGtleU5hbWUsIG1ldGEpOwogICAgICB9
CiAgICAgIGNhY2hlW2tleU5hbWVdID0gcmV0OwogICAgfQoKICAgIGlmICh3YXRjaGVkKSB7IEVt
YmVyLnByb3BlcnR5RGlkQ2hhbmdlKG9iaiwga2V5TmFtZSk7IH0KICB9IGZpbmFsbHkgewogICAg
dGhpcy5fc3VzcGVuZGVkID0gb2xkU3VzcGVuZGVkOwogIH0KICByZXR1cm4gcmV0Owp9OwoKLyog
Y2FsbGVkIGJlZm9yZSBwcm9wZXJ0eSBpcyBvdmVycmlkZGVuICovCkNvbXB1dGVkUHJvcGVydHlQ
cm90b3R5cGUudGVhcmRvd24gPSBmdW5jdGlvbihvYmosIGtleU5hbWUpIHsKICB2YXIgbWV0YSA9
IG1ldGFGb3Iob2JqKTsKCiAgaWYgKGtleU5hbWUgaW4gbWV0YS5jYWNoZSkgewogICAgcmVtb3Zl
RGVwZW5kZW50S2V5cyh0aGlzLCBvYmosIGtleU5hbWUsIG1ldGEpOwogIH0KCiAgaWYgKHRoaXMu
X2NhY2hlYWJsZSkgeyBkZWxldGUgbWV0YS5jYWNoZVtrZXlOYW1lXTsgfQoKICByZXR1cm4gbnVs
bDsgLy8gbm8gdmFsdWUgdG8gcmVzdG9yZQp9OwoKCi8qKgogIFRoaXMgaGVscGVyIHJldHVybnMg
YSBuZXcgcHJvcGVydHkgZGVzY3JpcHRvciB0aGF0IHdyYXBzIHRoZSBwYXNzZWQKICBjb21wdXRl
ZCBwcm9wZXJ0eSBmdW5jdGlvbi4gWW91IGNhbiB1c2UgdGhpcyBoZWxwZXIgdG8gZGVmaW5lIHBy
b3BlcnRpZXMKICB3aXRoIG1peGlucyBvciB2aWEgYEVtYmVyLmRlZmluZVByb3BlcnR5KClgLgoK
ICBUaGUgZnVuY3Rpb24geW91IHBhc3Mgd2lsbCBiZSB1c2VkIHRvIGJvdGggZ2V0IGFuZCBzZXQg
cHJvcGVydHkgdmFsdWVzLgogIFRoZSBmdW5jdGlvbiBzaG91bGQgYWNjZXB0IHR3byBwYXJhbWV0
ZXJzLCBrZXkgYW5kIHZhbHVlLiBJZiB2YWx1ZSBpcyBub3QKICB1bmRlZmluZWQgeW91IHNob3Vs
ZCBzZXQgdGhlIHZhbHVlIGZpcnN0LiBJbiBlaXRoZXIgY2FzZSByZXR1cm4gdGhlCiAgY3VycmVu
dCB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuCiAgQG1ldGhvZCBjb21wdXRlZAogIEBmb3IgRW1iZXIK
ICBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBjb21wdXRlZCBwcm9wZXJ0eSBmdW5jdGlvbi4K
ICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBwcm9wZXJ0eSBkZXNjcmlwdG9yIGlu
c3RhbmNlCiovCkVtYmVyLmNvbXB1dGVkID0gZnVuY3Rpb24oZnVuYykgewogIHZhciBhcmdzOwoK
ICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgIGFyZ3MgPSBhX3NsaWNlLmNhbGwoYXJn
dW1lbnRzLCAwLCAtMSk7CiAgICBmdW5jID0gYV9zbGljZS5jYWxsKGFyZ3VtZW50cywgLTEpWzBd
OwogIH0KCiAgaWYgKHR5cGVvZiBmdW5jICE9PSAiZnVuY3Rpb24iKSB7CiAgICB0aHJvdyBuZXcg
RW1iZXIuRXJyb3IoIkNvbXB1dGVkIFByb3BlcnR5IGRlY2xhcmVkIHdpdGhvdXQgYSBwcm9wZXJ0
eSBmdW5jdGlvbiIpOwogIH0KCiAgdmFyIGNwID0gbmV3IENvbXB1dGVkUHJvcGVydHkoZnVuYyk7
CgogIGlmIChhcmdzKSB7CiAgICBjcC5wcm9wZXJ0eS5hcHBseShjcCwgYXJncyk7CiAgfQoKICBy
ZXR1cm4gY3A7Cn07CgovKioKICBSZXR1cm5zIHRoZSBjYWNoZWQgdmFsdWUgZm9yIGEgcHJvcGVy
dHksIGlmIG9uZSBleGlzdHMuCiAgVGhpcyBjYW4gYmUgdXNlZnVsIGZvciBwZWVraW5nIGF0IHRo
ZSB2YWx1ZSBvZiBhIGNvbXB1dGVkCiAgcHJvcGVydHkgdGhhdCBpcyBnZW5lcmF0ZWQgbGF6aWx5
LCB3aXRob3V0IGFjY2lkZW50YWxseSBjYXVzaW5nCiAgaXQgdG8gYmUgY3JlYXRlZC4KCiAgQG1l
dGhvZCBjYWNoZUZvcgogIEBmb3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gb2JqIHRoZSBvYmpl
Y3Qgd2hvc2UgcHJvcGVydHkgeW91IHdhbnQgdG8gY2hlY2sKICBAcGFyYW0ge1N0cmluZ30ga2V5
IHRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB3aG9zZSBjYWNoZWQgdmFsdWUgeW91IHdhbnQKICAg
IHRvIHJldHVybgogIEByZXR1cm4ge09iamVjdH0gdGhlIGNhY2hlZCB2YWx1ZQoqLwpFbWJlci5j
YWNoZUZvciA9IGZ1bmN0aW9uIGNhY2hlRm9yKG9iaiwga2V5KSB7CiAgdmFyIGNhY2hlID0gbWV0
YUZvcihvYmosIGZhbHNlKS5jYWNoZTsKCiAgaWYgKGNhY2hlICYmIGtleSBpbiBjYWNoZSkgewog
ICAgcmV0dXJuIGNhY2hlW2tleV07CiAgfQp9OwoKZnVuY3Rpb24gZ2V0UHJvcGVydGllcyhzZWxm
LCBwcm9wZXJ0eU5hbWVzKSB7CiAgdmFyIHJldCA9IHt9OwogIGZvcih2YXIgaSA9IDA7IGkgPCBw
cm9wZXJ0eU5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICByZXRbcHJvcGVydHlOYW1lc1tpXV0gPSBn
ZXQoc2VsZiwgcHJvcGVydHlOYW1lc1tpXSk7CiAgfQogIHJldHVybiByZXQ7Cn0KCmZ1bmN0aW9u
IHJlZ2lzdGVyQ29tcHV0ZWQobmFtZSwgbWFjcm8pIHsKICBFbWJlci5jb21wdXRlZFtuYW1lXSA9
IGZ1bmN0aW9uKGRlcGVuZGVudEtleSkgewogICAgdmFyIGFyZ3MgPSBhX3NsaWNlLmNhbGwoYXJn
dW1lbnRzKTsKICAgIHJldHVybiBFbWJlci5jb21wdXRlZChkZXBlbmRlbnRLZXksIGZ1bmN0aW9u
KCkgewogICAgICByZXR1cm4gbWFjcm8uYXBwbHkodGhpcywgYXJncyk7CiAgICB9KTsKICB9Owp9
CgpmdW5jdGlvbiByZWdpc3RlckNvbXB1dGVkV2l0aFByb3BlcnRpZXMobmFtZSwgbWFjcm8pIHsK
ICBFbWJlci5jb21wdXRlZFtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHByb3BlcnRpZXMg
PSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzKTsKCiAgICB2YXIgY29tcHV0ZWQgPSBFbWJlci5jb21w
dXRlZChmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG1hY3JvLmFwcGx5KHRoaXMsIFtnZXRQcm9w
ZXJ0aWVzKHRoaXMsIHByb3BlcnRpZXMpXSk7CiAgICB9KTsKCiAgICByZXR1cm4gY29tcHV0ZWQu
cHJvcGVydHkuYXBwbHkoY29tcHV0ZWQsIHByb3BlcnRpZXMpOwogIH07Cn0KCi8qKgogIEEgY29t
cHV0ZWQgcHJvcGVydHkgdGhhdCByZXR1cm5zIHRydWUgaWYgdGhlIHZhbHVlIG9mIHRoZSBkZXBl
bmRlbnQKICBwcm9wZXJ0eSBpcyBudWxsLCBhbiBlbXB0eSBzdHJpbmcsIGVtcHR5IGFycmF5LCBv
ciBlbXB0eSBmdW5jdGlvbi4KCiAgTm90ZTogV2hlbiB1c2luZyBgRW1iZXIuY29tcHV0ZWQuZW1w
dHlgIHRvIHdhdGNoIGFuIGFycmF5IG1ha2Ugc3VyZSB0bwogIHVzZSB0aGUgYGFycmF5LltdYCBz
eW50YXggc28gdGhlIGNvbXB1dGVkIGNhbiBzdWJzY3JpYmUgdG8gdHJhbnNpdGlvbnMKICBmcm9t
IGVtcHR5IHRvIG5vbi1lbXB0eSBzdGF0ZXMuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAog
IHZhciBUb0RvTGlzdCA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgZG9uZTogRW1iZXIuY29t
cHV0ZWQuZW1wdHkoJ3RvZG9zLltdJykgLy8gZGV0ZWN0IGFycmF5IGNoYW5nZXMKICB9KTsKICB2
YXIgdG9kb0xpc3QgPSBUb0RvTGlzdC5jcmVhdGUoe3RvZG9zOiBbJ1VuaXQgVGVzdCcsICdEb2N1
bWVudGF0aW9uJywgJ1JlbGVhc2UnXX0pOwogIHRvZG9MaXN0LmdldCgnZG9uZScpOyAvLyBmYWxz
ZQogIHRvZG9MaXN0LmdldCgndG9kb3MnKS5jbGVhcigpOyAvLyBbXQogIHRvZG9MaXN0LmdldCgn
ZG9uZScpOyAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQuZW1wdHkKICBAZm9yIEVt
YmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleQogIEByZXR1cm4ge0VtYmVyLkNvbXB1
dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3BlcnR5IHdoaWNoIG5lZ2F0ZQogIHRoZSBvcmlnaW5h
bCB2YWx1ZSBmb3IgcHJvcGVydHkKKi8KcmVnaXN0ZXJDb21wdXRlZCgnZW1wdHknLCBmdW5jdGlv
bihkZXBlbmRlbnRLZXkpIHsKICByZXR1cm4gRW1iZXIuaXNFbXB0eShnZXQodGhpcywgZGVwZW5k
ZW50S2V5KSk7Cn0pOwoKLyoqCiAgQSBjb21wdXRlZCBwcm9wZXJ0eSB0aGF0IHJldHVybnMgdHJ1
ZSBpZiB0aGUgdmFsdWUgb2YgdGhlIGRlcGVuZGVudAogIHByb3BlcnR5IGlzIE5PVCBudWxsLCBh
biBlbXB0eSBzdHJpbmcsIGVtcHR5IGFycmF5LCBvciBlbXB0eSBmdW5jdGlvbi4KCiAgTm90ZTog
V2hlbiB1c2luZyBgRW1iZXIuY29tcHV0ZWQubm90RW1wdHlgIHRvIHdhdGNoIGFuIGFycmF5IG1h
a2Ugc3VyZSB0bwogIHVzZSB0aGUgYGFycmF5LltdYCBzeW50YXggc28gdGhlIGNvbXB1dGVkIGNh
biBzdWJzY3JpYmUgdG8gdHJhbnNpdGlvbnMKICBmcm9tIGVtcHR5IHRvIG5vbi1lbXB0eSBzdGF0
ZXMuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIHZhciBIYW1zdGVyID0gRW1iZXIuT2Jq
ZWN0LmV4dGVuZCh7CiAgICBoYXNTdHVmZjogRW1iZXIuY29tcHV0ZWQubm90RW1wdHkoJ2JhY2tw
YWNrLltdJykKICB9KTsKICB2YXIgaGFtc3RlciA9IEhhbXN0ZXIuY3JlYXRlKHtiYWNrcGFjazog
WydGb29kJywgJ1NsZWVwaW5nIEJhZycsICdUZW50J119KTsKICBoYW1zdGVyLmdldCgnaGFzU3R1
ZmYnKTsgLy8gdHJ1ZQogIGhhbXN0ZXIuZ2V0KCdiYWNrcGFjaycpLmNsZWFyKCk7IC8vIFtdCiAg
aGFtc3Rlci5nZXQoJ2hhc1N0dWZmJyk7IC8vIGZhbHNlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0
ZWQubm90RW1wdHkKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleQog
IEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3BlcnR5IHdoaWNo
IHJldHVybnMgdHJ1ZSBpZgogIG9yaWdpbmFsIHZhbHVlIGZvciBwcm9wZXJ0eSBpcyBub3QgZW1w
dHkuCiovCnJlZ2lzdGVyQ29tcHV0ZWQoJ25vdEVtcHR5JywgZnVuY3Rpb24oZGVwZW5kZW50S2V5
KSB7CiAgcmV0dXJuICFFbWJlci5pc0VtcHR5KGdldCh0aGlzLCBkZXBlbmRlbnRLZXkpKTsKfSk7
CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRoYXQgcmV0dXJucyB0cnVlIGlmIHRoZSB2YWx1
ZSBvZiB0aGUgZGVwZW5kZW50CiAgcHJvcGVydHkgaXMgbnVsbCBvciB1bmRlZmluZWQuIFRoaXMg
YXZvaWRzIGVycm9ycyBmcm9tIEpTTGludCBjb21wbGFpbmluZwogIGFib3V0IHVzZSBvZiA9PSwg
d2hpY2ggY2FuIGJlIHRlY2huaWNhbGx5IGNvbmZ1c2luZy4KCiAgRXhhbXBsZQoKICBgYGBqYXZh
c2NyaXB0CiAgdmFyIEhhbXN0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGlzSHVuZ3J5
OiBFbWJlci5jb21wdXRlZC5ub25lKCdmb29kJykKICB9KTsKICB2YXIgaGFtc3RlciA9IEhhbXN0
ZXIuY3JlYXRlKCk7CiAgaGFtc3Rlci5nZXQoJ2lzSHVuZ3J5Jyk7IC8vIHRydWUKICBoYW1zdGVy
LnNldCgnZm9vZCcsICdCYW5hbmEnKTsKICBoYW1zdGVyLmdldCgnaXNIdW5ncnknKTsgLy8gZmFs
c2UKICBoYW1zdGVyLnNldCgnZm9vZCcsIG51bGwpOwogIGhhbXN0ZXIuZ2V0KCdpc0h1bmdyeScp
OyAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQubm9uZQogIEBmb3IgRW1iZXIKICBA
cGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5CiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9w
ZXJ0eX0gY29tcHV0ZWQgcHJvcGVydHkgd2hpY2gKICByZXR1cm5zIHRydWUgaWYgb3JpZ2luYWwg
dmFsdWUgZm9yIHByb3BlcnR5IGlzIG51bGwgb3IgdW5kZWZpbmVkLgoqLwpyZWdpc3RlckNvbXB1
dGVkKCdub25lJywgZnVuY3Rpb24oZGVwZW5kZW50S2V5KSB7CiAgcmV0dXJuIEVtYmVyLmlzTm9u
ZShnZXQodGhpcywgZGVwZW5kZW50S2V5KSk7Cn0pOwoKLyoqCiAgQSBjb21wdXRlZCBwcm9wZXJ0
eSB0aGF0IHJldHVybnMgdGhlIGludmVyc2UgYm9vbGVhbiB2YWx1ZQogIG9mIHRoZSBvcmlnaW5h
bCB2YWx1ZSBmb3IgdGhlIGRlcGVuZGVudCBwcm9wZXJ0eS4KCiAgRXhhbXBsZQoKICBgYGBqYXZh
c2NyaXB0CiAgdmFyIFVzZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGlzQW5vbnltb3Vz
OiBFbWJlci5jb21wdXRlZC5ub3QoJ2xvZ2dlZEluJykKICB9KTsKICB2YXIgdXNlciA9IFVzZXIu
Y3JlYXRlKHtsb2dnZWRJbjogZmFsc2V9KTsKICB1c2VyLmdldCgnaXNBbm9ueW1vdXMnKTsgLy8g
dHJ1ZQogIHVzZXIuc2V0KCdsb2dnZWRJbicsIHRydWUpOwogIHVzZXIuZ2V0KCdpc0Fub255bW91
cycpOyAvLyBmYWxzZQogIGBgYAoKICBAbWV0aG9kIGNvbXB1dGVkLm5vdAogIEBmb3IgRW1iZXIK
ICBAcGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5CiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQ
cm9wZXJ0eX0gY29tcHV0ZWQgcHJvcGVydHkgd2hpY2ggcmV0dXJucwogIGludmVyc2Ugb2YgdGhl
IG9yaWdpbmFsIHZhbHVlIGZvciBwcm9wZXJ0eQoqLwpyZWdpc3RlckNvbXB1dGVkKCdub3QnLCBm
dW5jdGlvbihkZXBlbmRlbnRLZXkpIHsKICByZXR1cm4gIWdldCh0aGlzLCBkZXBlbmRlbnRLZXkp
Owp9KTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgdGhhdCBjb252ZXJ0cyB0aGUgcHJvdmlk
ZWQgZGVwZW5kZW50IHByb3BlcnR5CiAgaW50byBhIGJvb2xlYW4gdmFsdWUuCgogIGBgYGphdmFz
Y3JpcHQKICB2YXIgSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgaGFzQmFuYW5h
czogRW1iZXIuY29tcHV0ZWQuYm9vbCgnbnVtQmFuYW5hcycpCiAgfSk7CiAgdmFyIGhhbXN0ZXIg
PSBIYW1zdGVyLmNyZWF0ZSgpOwogIGhhbXN0ZXIuZ2V0KCdoYXNCYW5hbmFzJyk7IC8vIGZhbHNl
CiAgaGFtc3Rlci5zZXQoJ251bUJhbmFuYXMnLCAwKTsKICBoYW1zdGVyLmdldCgnaGFzQmFuYW5h
cycpOyAvLyBmYWxzZQogIGhhbXN0ZXIuc2V0KCdudW1CYW5hbmFzJywgMSk7CiAgaGFtc3Rlci5n
ZXQoJ2hhc0JhbmFuYXMnKTsgLy8gdHJ1ZQogIGhhbXN0ZXIuc2V0KCdudW1CYW5hbmFzJywgbnVs
bCk7CiAgaGFtc3Rlci5nZXQoJ2hhc0JhbmFuYXMnKTsgLy8gZmFsc2UKICBgYGAKCiAgQG1ldGhv
ZCBjb21wdXRlZC5ib29sCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRL
ZXkKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRlZCBwcm9wZXJ0eSB3
aGljaCBjb252ZXJ0cwogIHRvIGJvb2xlYW4gdGhlIG9yaWdpbmFsIHZhbHVlIGZvciBwcm9wZXJ0
eQoqLwpyZWdpc3RlckNvbXB1dGVkKCdib29sJywgZnVuY3Rpb24oZGVwZW5kZW50S2V5KSB7CiAg
cmV0dXJuICEhZ2V0KHRoaXMsIGRlcGVuZGVudEtleSk7Cn0pOwoKLyoqCiAgQSBjb21wdXRlZCBw
cm9wZXJ0eSB3aGljaCBtYXRjaGVzIHRoZSBvcmlnaW5hbCB2YWx1ZSBmb3IgdGhlCiAgZGVwZW5k
ZW50IHByb3BlcnR5IGFnYWluc3QgYSBnaXZlbiBSZWdFeHAsIHJldHVybmluZyBgdHJ1ZWAKICBp
ZiB0aGV5IHZhbHVlcyBtYXRjaGVzIHRoZSBSZWdFeHAgYW5kIGBmYWxzZWAgaWYgaXQgZG9lcyBu
b3QuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIHZhciBVc2VyID0gRW1iZXIuT2JqZWN0
LmV4dGVuZCh7CiAgICBoYXNWYWxpZEVtYWlsOiBFbWJlci5jb21wdXRlZC5tYXRjaCgnZW1haWwn
LCAvXi4rQC4rXC4uKyQvKQogIH0pOwogIHZhciB1c2VyID0gVXNlci5jcmVhdGUoe2xvZ2dlZElu
OiBmYWxzZX0pOwogIHVzZXIuZ2V0KCdoYXNWYWxpZEVtYWlsJyk7IC8vIGZhbHNlCiAgdXNlci5z
ZXQoJ2VtYWlsJywgJycpOwogIHVzZXIuZ2V0KCdoYXNWYWxpZEVtYWlsJyk7IC8vIGZhbHNlCiAg
dXNlci5zZXQoJ2VtYWlsJywgJ2VtYmVyX2hhbXN0ZXJAZXhhbXBsZS5jb20nKTsKICB1c2VyLmdl
dCgnaGFzVmFsaWRFbWFpbCcpOyAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQubWF0
Y2gKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleQogIEBwYXJhbSB7
UmVnRXhwfSByZWdleHAKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRl
ZCBwcm9wZXJ0eSB3aGljaCBtYXRjaAogIHRoZSBvcmlnaW5hbCB2YWx1ZSBmb3IgcHJvcGVydHkg
YWdhaW5zdCBhIGdpdmVuIFJlZ0V4cAoqLwpyZWdpc3RlckNvbXB1dGVkKCdtYXRjaCcsIGZ1bmN0
aW9uKGRlcGVuZGVudEtleSwgcmVnZXhwKSB7CiAgdmFyIHZhbHVlID0gZ2V0KHRoaXMsIGRlcGVu
ZGVudEtleSk7CiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyByZWdleHAudGVz
dCh2YWx1ZSkgOiBmYWxzZTsKfSk7CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRoYXQgcmV0
dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBkZXBlbmRlbnQgcHJvcGVydHkKICBpcyBlcXVhbCB0
byB0aGUgZ2l2ZW4gdmFsdWUuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIHZhciBIYW1z
dGVyID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICBuYXBUaW1lOiBFbWJlci5jb21wdXRlZC5l
cXVhbCgnc3RhdGUnLCAnc2xlZXB5JykKICB9KTsKICB2YXIgaGFtc3RlciA9IEhhbXN0ZXIuY3Jl
YXRlKCk7CiAgaGFtc3Rlci5nZXQoJ25hcFRpbWUnKTsgLy8gZmFsc2UKICBoYW1zdGVyLnNldCgn
c3RhdGUnLCAnc2xlZXB5Jyk7CiAgaGFtc3Rlci5nZXQoJ25hcFRpbWUnKTsgLy8gdHJ1ZQogIGhh
bXN0ZXIuc2V0KCdzdGF0ZScsICdodW5ncnknKTsKICBoYW1zdGVyLmdldCgnbmFwVGltZScpOyAv
LyBmYWxzZQogIGBgYAoKICBAbWV0aG9kIGNvbXB1dGVkLmVxdWFsCiAgQGZvciBFbWJlcgogIEBw
YXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRLZXkKICBAcGFyYW0ge1N0cmluZ3xOdW1iZXJ8T2JqZWN0
fSB2YWx1ZQogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3Bl
cnR5IHdoaWNoIHJldHVybnMgdHJ1ZSBpZgogIHRoZSBvcmlnaW5hbCB2YWx1ZSBmb3IgcHJvcGVy
dHkgaXMgZXF1YWwgdG8gdGhlIGdpdmVuIHZhbHVlLgoqLwpyZWdpc3RlckNvbXB1dGVkKCdlcXVh
bCcsIGZ1bmN0aW9uKGRlcGVuZGVudEtleSwgdmFsdWUpIHsKICByZXR1cm4gZ2V0KHRoaXMsIGRl
cGVuZGVudEtleSkgPT09IHZhbHVlOwp9KTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgdGhh
dCByZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZWQgZGVwZW5kZW50IHByb3BlcnR5CiAgaXMgZ3Jl
YXRlciB0aGFuIHRoZSBwcm92aWRlZCB2YWx1ZS4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2NyaXB0
CiAgdmFyIEhhbXN0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGhhc1Rvb01hbnlCYW5h
bmFzOiBFbWJlci5jb21wdXRlZC5ndCgnbnVtQmFuYW5hcycsIDEwKQogIH0pOwogIHZhciBoYW1z
dGVyID0gSGFtc3Rlci5jcmVhdGUoKTsKICBoYW1zdGVyLmdldCgnaGFzVG9vTWFueUJhbmFuYXMn
KTsgLy8gZmFsc2UKICBoYW1zdGVyLnNldCgnbnVtQmFuYW5hcycsIDMpOwogIGhhbXN0ZXIuZ2V0
KCdoYXNUb29NYW55QmFuYW5hcycpOyAvLyBmYWxzZQogIGhhbXN0ZXIuc2V0KCdudW1CYW5hbmFz
JywgMTEpOwogIGhhbXN0ZXIuZ2V0KCdoYXNUb29NYW55QmFuYW5hcycpOyAvLyB0cnVlCiAgYGBg
CgogIEBtZXRob2QgY29tcHV0ZWQuZ3QKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRl
cGVuZGVudEtleQogIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZQogIEByZXR1cm4ge0VtYmVyLkNvbXB1
dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3BlcnR5IHdoaWNoIHJldHVybnMgdHJ1ZSBpZgogIHRo
ZSBvcmlnaW5hbCB2YWx1ZSBmb3IgcHJvcGVydHkgaXMgZ3JlYXRlciB0aGVuIGdpdmVuIHZhbHVl
LgoqLwpyZWdpc3RlckNvbXB1dGVkKCdndCcsIGZ1bmN0aW9uKGRlcGVuZGVudEtleSwgdmFsdWUp
IHsKICByZXR1cm4gZ2V0KHRoaXMsIGRlcGVuZGVudEtleSkgPiB2YWx1ZTsKfSk7CgovKioKICBB
IGNvbXB1dGVkIHByb3BlcnR5IHRoYXQgcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBkZXBl
bmRlbnQgcHJvcGVydHkKICBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHByb3ZpZGVk
IHZhbHVlLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3JpcHQKICB2YXIgSGFtc3RlciA9IEVtYmVy
Lk9iamVjdC5leHRlbmQoewogICAgaGFzVG9vTWFueUJhbmFuYXM6IEVtYmVyLmNvbXB1dGVkLmd0
ZSgnbnVtQmFuYW5hcycsIDEwKQogIH0pOwogIHZhciBoYW1zdGVyID0gSGFtc3Rlci5jcmVhdGUo
KTsKICBoYW1zdGVyLmdldCgnaGFzVG9vTWFueUJhbmFuYXMnKTsgLy8gZmFsc2UKICBoYW1zdGVy
LnNldCgnbnVtQmFuYW5hcycsIDMpOwogIGhhbXN0ZXIuZ2V0KCdoYXNUb29NYW55QmFuYW5hcycp
OyAvLyBmYWxzZQogIGhhbXN0ZXIuc2V0KCdudW1CYW5hbmFzJywgMTApOwogIGhhbXN0ZXIuZ2V0
KCdoYXNUb29NYW55QmFuYW5hcycpOyAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQu
Z3RlCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRLZXkKICBAcGFyYW0g
e051bWJlcn0gdmFsdWUKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRl
ZCBwcm9wZXJ0eSB3aGljaCByZXR1cm5zIHRydWUgaWYKICB0aGUgb3JpZ2luYWwgdmFsdWUgZm9y
IHByb3BlcnR5IGlzIGdyZWF0ZXIgb3IgZXF1YWwgdGhlbiBnaXZlbiB2YWx1ZS4KKi8KcmVnaXN0
ZXJDb21wdXRlZCgnZ3RlJywgZnVuY3Rpb24oZGVwZW5kZW50S2V5LCB2YWx1ZSkgewogIHJldHVy
biBnZXQodGhpcywgZGVwZW5kZW50S2V5KSA+PSB2YWx1ZTsKfSk7CgovKioKICBBIGNvbXB1dGVk
IHByb3BlcnR5IHRoYXQgcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBkZXBlbmRlbnQgcHJv
cGVydHkKICBpcyBsZXNzIHRoYW4gdGhlIHByb3ZpZGVkIHZhbHVlLgoKICBFeGFtcGxlCgogIGBg
YGphdmFzY3JpcHQKICB2YXIgSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgbmVl
ZHNNb3JlQmFuYW5hczogRW1iZXIuY29tcHV0ZWQubHQoJ251bUJhbmFuYXMnLCAzKQogIH0pOwog
IHZhciBoYW1zdGVyID0gSGFtc3Rlci5jcmVhdGUoKTsKICBoYW1zdGVyLmdldCgnbmVlZHNNb3Jl
QmFuYW5hcycpOyAvLyB0cnVlCiAgaGFtc3Rlci5zZXQoJ251bUJhbmFuYXMnLCAzKTsKICBoYW1z
dGVyLmdldCgnbmVlZHNNb3JlQmFuYW5hcycpOyAvLyBmYWxzZQogIGhhbXN0ZXIuc2V0KCdudW1C
YW5hbmFzJywgMik7CiAgaGFtc3Rlci5nZXQoJ25lZWRzTW9yZUJhbmFuYXMnKTsgLy8gdHJ1ZQog
IGBgYAoKICBAbWV0aG9kIGNvbXB1dGVkLmx0CiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5n
fSBkZXBlbmRlbnRLZXkKICBAcGFyYW0ge051bWJlcn0gdmFsdWUKICBAcmV0dXJuIHtFbWJlci5D
b21wdXRlZFByb3BlcnR5fSBjb21wdXRlZCBwcm9wZXJ0eSB3aGljaCByZXR1cm5zIHRydWUgaWYK
ICB0aGUgb3JpZ2luYWwgdmFsdWUgZm9yIHByb3BlcnR5IGlzIGxlc3MgdGhlbiBnaXZlbiB2YWx1
ZS4KKi8KcmVnaXN0ZXJDb21wdXRlZCgnbHQnLCBmdW5jdGlvbihkZXBlbmRlbnRLZXksIHZhbHVl
KSB7CiAgcmV0dXJuIGdldCh0aGlzLCBkZXBlbmRlbnRLZXkpIDwgdmFsdWU7Cn0pOwoKLyoqCiAg
QSBjb21wdXRlZCBwcm9wZXJ0eSB0aGF0IHJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgZGVw
ZW5kZW50IHByb3BlcnR5CiAgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBwcm92aWRlZCB2
YWx1ZS4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2NyaXB0CiAgdmFyIEhhbXN0ZXIgPSBFbWJlci5P
YmplY3QuZXh0ZW5kKHsKICAgIG5lZWRzTW9yZUJhbmFuYXM6IEVtYmVyLmNvbXB1dGVkLmx0ZSgn
bnVtQmFuYW5hcycsIDMpCiAgfSk7CiAgdmFyIGhhbXN0ZXIgPSBIYW1zdGVyLmNyZWF0ZSgpOwog
IGhhbXN0ZXIuZ2V0KCduZWVkc01vcmVCYW5hbmFzJyk7IC8vIHRydWUKICBoYW1zdGVyLnNldCgn
bnVtQmFuYW5hcycsIDUpOwogIGhhbXN0ZXIuZ2V0KCduZWVkc01vcmVCYW5hbmFzJyk7IC8vIGZh
bHNlCiAgaGFtc3Rlci5zZXQoJ251bUJhbmFuYXMnLCAzKTsKICBoYW1zdGVyLmdldCgnbmVlZHNN
b3JlQmFuYW5hcycpOyAvLyB0cnVlCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQubHRlCiAgQGZv
ciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRLZXkKICBAcGFyYW0ge051bWJlcn0g
dmFsdWUKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRlZCBwcm9wZXJ0
eSB3aGljaCByZXR1cm5zIHRydWUgaWYKICB0aGUgb3JpZ2luYWwgdmFsdWUgZm9yIHByb3BlcnR5
IGlzIGxlc3Mgb3IgZXF1YWwgdGhlbiBnaXZlbiB2YWx1ZS4KKi8KcmVnaXN0ZXJDb21wdXRlZCgn
bHRlJywgZnVuY3Rpb24oZGVwZW5kZW50S2V5LCB2YWx1ZSkgewogIHJldHVybiBnZXQodGhpcywg
ZGVwZW5kZW50S2V5KSA8PSB2YWx1ZTsKfSk7CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRo
YXQgcGVyZm9ybXMgYSBsb2dpY2FsIGBhbmRgIG9uIHRoZQogIG9yaWdpbmFsIHZhbHVlcyBmb3Ig
dGhlIHByb3ZpZGVkIGRlcGVuZGVudCBwcm9wZXJ0aWVzLgoKICBFeGFtcGxlCgogIGBgYGphdmFz
Y3JpcHQKICB2YXIgSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgcmVhZHlGb3JD
YW1wOiBFbWJlci5jb21wdXRlZC5hbmQoJ2hhc1RlbnQnLCAnaGFzQmFja3BhY2snKQogIH0pOwog
IHZhciBoYW1zdGVyID0gSGFtc3Rlci5jcmVhdGUoKTsKICBoYW1zdGVyLmdldCgncmVhZHlGb3JD
YW1wJyk7IC8vIGZhbHNlCiAgaGFtc3Rlci5zZXQoJ2hhc1RlbnQnLCB0cnVlKTsKICBoYW1zdGVy
LmdldCgncmVhZHlGb3JDYW1wJyk7IC8vIGZhbHNlCiAgaGFtc3Rlci5zZXQoJ2hhc0JhY2twYWNr
JywgdHJ1ZSk7CiAgaGFtc3Rlci5nZXQoJ3JlYWR5Rm9yQ2FtcCcpOyAvLyB0cnVlCiAgYGBgCgog
IEBtZXRob2QgY29tcHV0ZWQuYW5kCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBl
bmRlbnRLZXkqCiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gY29tcHV0ZWQgcHJv
cGVydHkgd2hpY2ggcGVyZm9ybXMKICBhIGxvZ2ljYWwgYGFuZGAgb24gdGhlIHZhbHVlcyBvZiBh
bGwgdGhlIG9yaWdpbmFsIHZhbHVlcyBmb3IgcHJvcGVydGllcy4KKi8KcmVnaXN0ZXJDb21wdXRl
ZFdpdGhQcm9wZXJ0aWVzKCdhbmQnLCBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgZm9yICh2YXIg
a2V5IGluIHByb3BlcnRpZXMpIHsKICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KGtl
eSkgJiYgIXByb3BlcnRpZXNba2V5XSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQog
IHJldHVybiB0cnVlOwp9KTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgd2hpY2ggcGVyZm9y
bXMgYSBsb2dpY2FsIGBvcmAgb24gdGhlCiAgb3JpZ2luYWwgdmFsdWVzIGZvciB0aGUgcHJvdmlk
ZWQgZGVwZW5kZW50IHByb3BlcnRpZXMuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIHZh
ciBIYW1zdGVyID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICByZWFkeUZvclJhaW46IEVtYmVy
LmNvbXB1dGVkLm9yKCdoYXNKYWNrZXQnLCAnaGFzVW1icmVsbGEnKQogIH0pOwogIHZhciBoYW1z
dGVyID0gSGFtc3Rlci5jcmVhdGUoKTsKICBoYW1zdGVyLmdldCgncmVhZHlGb3JSYWluJyk7IC8v
IGZhbHNlCiAgaGFtc3Rlci5zZXQoJ2hhc0phY2tldCcsIHRydWUpOwogIGhhbXN0ZXIuZ2V0KCdy
ZWFkeUZvclJhaW4nKTsgLy8gdHJ1ZQogIGBgYAoKICBAbWV0aG9kIGNvbXB1dGVkLm9yCiAgQGZv
ciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRLZXkqCiAgQHJldHVybiB7RW1iZXIu
Q29tcHV0ZWRQcm9wZXJ0eX0gY29tcHV0ZWQgcHJvcGVydHkgd2hpY2ggcGVyZm9ybXMKICBhIGxv
Z2ljYWwgYG9yYCBvbiB0aGUgdmFsdWVzIG9mIGFsbCB0aGUgb3JpZ2luYWwgdmFsdWVzIGZvciBw
cm9wZXJ0aWVzLgoqLwpyZWdpc3RlckNvbXB1dGVkV2l0aFByb3BlcnRpZXMoJ29yJywgZnVuY3Rp
b24ocHJvcGVydGllcykgewogIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICBpZiAo
cHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIHByb3BlcnRpZXNba2V5XSkgewogICAg
ICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9KTsKCi8qKgogIEEgY29t
cHV0ZWQgcHJvcGVydHkgdGhhdCByZXR1cm5zIHRoZSBmaXJzdCB0cnV0aHkgdmFsdWUKICBmcm9t
IGEgbGlzdCBvZiBkZXBlbmRlbnQgcHJvcGVydGllcy4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2Ny
aXB0CiAgdmFyIEhhbXN0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGhhc0Nsb3RoZXM6
IEVtYmVyLmNvbXB1dGVkLmFueSgnaGF0JywgJ3NoaXJ0JykKICB9KTsKICB2YXIgaGFtc3RlciA9
IEhhbXN0ZXIuY3JlYXRlKCk7CiAgaGFtc3Rlci5nZXQoJ2hhc0Nsb3RoZXMnKTsgLy8gbnVsbAog
IGhhbXN0ZXIuc2V0KCdzaGlydCcsICdIYXdhaWlhbiBTaGlydCcpOwogIGhhbXN0ZXIuZ2V0KCdo
YXNDbG90aGVzJyk7IC8vICdIYXdhaWlhbiBTaGlydCcKICBgYGAKCiAgQG1ldGhvZCBjb21wdXRl
ZC5hbnkKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleSoKICBAcmV0
dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRlZCBwcm9wZXJ0eSB3aGljaCByZXR1
cm5zCiAgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSBvZiBnaXZlbiBsaXN0IG9mIHByb3BlcnRpZXMu
CiovCnJlZ2lzdGVyQ29tcHV0ZWRXaXRoUHJvcGVydGllcygnYW55JywgZnVuY3Rpb24ocHJvcGVy
dGllcykgewogIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICBpZiAocHJvcGVydGll
cy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIHByb3BlcnRpZXNba2V5XSkgewogICAgICByZXR1cm4g
cHJvcGVydGllc1trZXldOwogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfSk7CgovKioKICBBIGNv
bXB1dGVkIHByb3BlcnR5IHRoYXQgcmV0dXJucyB0aGUgYXJyYXkgb2YgdmFsdWVzCiAgZm9yIHRo
ZSBwcm92aWRlZCBkZXBlbmRlbnQgcHJvcGVydGllcy4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2Ny
aXB0CiAgdmFyIEhhbXN0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGNsb3RoZXM6IEVt
YmVyLmNvbXB1dGVkLmNvbGxlY3QoJ2hhdCcsICdzaGlydCcpCiAgfSk7CiAgdmFyIGhhbXN0ZXIg
PSBIYW1zdGVyLmNyZWF0ZSgpOwogIGhhbXN0ZXIuZ2V0KCdjbG90aGVzJyk7IC8vIFtudWxsLCBu
dWxsXQogIGhhbXN0ZXIuc2V0KCdoYXQnLCAnQ2FtcCBIYXQnKTsKICBoYW1zdGVyLnNldCgnc2hp
cnQnLCAnQ2FtcCBTaGlydCcpOwogIGhhbXN0ZXIuZ2V0KCdjbG90aGVzJyk7IC8vIFsnQ2FtcCBI
YXQnLCAnQ2FtcCBTaGlydCddCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQuY29sbGVjdAogIEBm
b3IgRW1iZXIKICBAcGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5KgogIEByZXR1cm4ge0VtYmVy
LkNvbXB1dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3BlcnR5IHdoaWNoIG1hcHMKICB2YWx1ZXMg
b2YgYWxsIHBhc3NlZCBwcm9wZXJ0aWVzIGluIHRvIGFuIGFycmF5LgoqLwpyZWdpc3RlckNvbXB1
dGVkV2l0aFByb3BlcnRpZXMoJ2NvbGxlY3QnLCBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgdmFy
IHJlcyA9IFtdOwogIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICBpZiAocHJvcGVy
dGllcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIGlmIChFbWJlci5pc05vbmUocHJvcGVy
dGllc1trZXldKSkgewogICAgICAgIHJlcy5wdXNoKG51bGwpOwogICAgICB9IGVsc2UgewogICAg
ICAgIHJlcy5wdXNoKHByb3BlcnRpZXNba2V5XSk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJu
IHJlczsKfSk7CgovKioKICBDcmVhdGVzIGEgbmV3IHByb3BlcnR5IHRoYXQgaXMgYW4gYWxpYXMg
Zm9yIGFub3RoZXIgcHJvcGVydHkKICBvbiBhbiBvYmplY3QuIENhbGxzIHRvIGBnZXRgIG9yIGBz
ZXRgIHRoaXMgcHJvcGVydHkgYmVoYXZlIGFzCiAgdGhvdWdoIHRoZXkgd2VyZSBjYWxsZWQgb24g
dGhlIG9yaWdpbmFsIHByb3BlcnR5LgoKICBgYGBqYXZhc2NyaXB0CiAgUGVyc29uID0gRW1iZXIu
T2JqZWN0LmV4dGVuZCh7CiAgICBuYW1lOiAnQWxleCBNYXRjaG5lZXInLAogICAgbm9tZW46IEVt
YmVyLmNvbXB1dGVkLmFsaWFzKCduYW1lJykKICB9KTsKCiAgYWxleCA9IFBlcnNvbi5jcmVhdGUo
KTsKICBhbGV4LmdldCgnbm9tZW4nKTsgLy8gJ0FsZXggTWF0Y2huZWVyJwogIGFsZXguZ2V0KCdu
YW1lJyk7ICAvLyAnQWxleCBNYXRjaG5lZXInCgogIGFsZXguc2V0KCdub21lbicsICdAbWFjaHR5
Jyk7CiAgYWxleC5nZXQoJ25hbWUnKTsgIC8vICdAbWFjaHR5JwogIGBgYAogIEBtZXRob2QgY29t
cHV0ZWQuYWxpYXMKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleQog
IEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNvbXB1dGVkIHByb3BlcnR5IHdoaWNo
IGNyZWF0ZXMgYW4KICBhbGlhcyB0byB0aGUgb3JpZ2luYWwgdmFsdWUgZm9yIHByb3BlcnR5Lgoq
LwpFbWJlci5jb21wdXRlZC5hbGlhcyA9IGZ1bmN0aW9uKGRlcGVuZGVudEtleSkgewogIHJldHVy
biBFbWJlci5jb21wdXRlZChkZXBlbmRlbnRLZXksIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAg
IGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICBzZXQodGhpcywgZGVwZW5kZW50S2V5
LCB2YWx1ZSk7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBn
ZXQodGhpcywgZGVwZW5kZW50S2V5KTsKICAgIH0KICB9KTsKfTsKCi8qKgogIFdoZXJlIGBjb21w
dXRlZC5hbGlhc2AgYWxpYXNlcyBgZ2V0YCBhbmQgYHNldGAsIGFuZCBhbGxvd3MgZm9yIGJpZGly
ZWN0aW9uYWwKICBkYXRhIGZsb3csIGBjb21wdXRlZC5vbmVXYXlgIG9ubHkgcHJvdmlkZXMgYW4g
YWxpYXNlZCBgZ2V0YC4gVGhlIGBzZXRgIHdpbGwKICBub3QgbXV0YXRlIHRoZSB1cHN0cmVhbSBw
cm9wZXJ0eSwgcmF0aGVyIGNhdXNlcyB0aGUgY3VycmVudCBwcm9wZXJ0eSB0bwogIGJlY29tZSB0
aGUgdmFsdWUgc2V0LiBUaGlzIGNhdXNlcyB0aGUgZG93bnN0cmVhbSBwcm9wZXJ0eSB0byBwZXJt
ZW50YW50bHkKICBkaXZlcmdlIGZyb20gdGhlIHVwc3RyZWFtIHByb3BlcnR5LgoKICBFeGFtcGxl
CgogIGBgYGphdmFzY3JpcHQKICBVc2VyID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICBmaXJz
dE5hbWU6IG51bGwsCiAgICBsYXN0TmFtZTogbnVsbCwKICAgIG5pY2tOYW1lOiBFbWJlci5jb21w
dXRlZC5vbmVXYXkoJ2ZpcnN0TmFtZScpCiAgfSk7CgogIHVzZXIgPSBVc2VyLmNyZWF0ZSh7CiAg
ICBmaXJzdE5hbWU6ICdUZWRkeScsCiAgICBsYXN0TmFtZTogICdaZWVubnknCiAgfSk7CgogIHVz
ZXIuZ2V0KCduaWNrTmFtZScpOwogICMgJ1RlZGR5JwoKICB1c2VyLnNldCgnbmlja05hbWUnLCAn
VGVkZHlCZWFyJyk7CiAgIyAnVGVkZHlCZWFyJwoKICB1c2VyLmdldCgnZmlyc3ROYW1lJyk7CiAg
IyAnVGVkZHknCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQub25lV2F5CiAgQGZvciBFbWJlcgog
IEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRlbnRLZXkKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFBy
b3BlcnR5fSBjb21wdXRlZCBwcm9wZXJ0eSB3aGljaCBjcmVhdGVzIGEKICBvbmUgd2F5IGNvbXB1
dGVkIHByb3BlcnR5IHRvIHRoZSBvcmlnaW5hbCB2YWx1ZSBmb3IgcHJvcGVydHkuCiovCkVtYmVy
LmNvbXB1dGVkLm9uZVdheSA9IGZ1bmN0aW9uKGRlcGVuZGVudEtleSkgewogIHJldHVybiBFbWJl
ci5jb21wdXRlZChkZXBlbmRlbnRLZXksIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGdldCh0aGlz
LCBkZXBlbmRlbnRLZXkpOwogIH0pOwp9OwoKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgdGhh
dCBhY3RzIGxpa2UgYSBzdGFuZGFyZCBnZXR0ZXIgYW5kIHNldHRlciwKICBidXQgcmV0dXJucyB0
aGUgdmFsdWUgYXQgdGhlIHByb3ZpZGVkIGBkZWZhdWx0UGF0aGAgaWYgdGhlCiAgcHJvcGVydHkg
aXRzZWxmIGhhcyBub3QgYmVlbiBzZXQgdG8gYSB2YWx1ZQoKICBFeGFtcGxlCgogIGBgYGphdmFz
Y3JpcHQKICB2YXIgSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgd2lzaExpc3Q6
IEVtYmVyLmNvbXB1dGVkLmRlZmF1bHRUbygnZmF2b3JpdGVGb29kJykKICB9KTsKICB2YXIgaGFt
c3RlciA9IEhhbXN0ZXIuY3JlYXRlKHtmYXZvcml0ZUZvb2Q6ICdCYW5hbmEnfSk7CiAgaGFtc3Rl
ci5nZXQoJ3dpc2hMaXN0Jyk7IC8vICdCYW5hbmEnCiAgaGFtc3Rlci5zZXQoJ3dpc2hMaXN0Jywg
J01vcmUgVW5pdCBUZXN0cycpOwogIGhhbXN0ZXIuZ2V0KCd3aXNoTGlzdCcpOyAvLyAnTW9yZSBV
bml0IFRlc3RzJwogIGhhbXN0ZXIuZ2V0KCdmYXZvcml0ZUZvb2QnKTsgLy8gJ0JhbmFuYScKICBg
YGAKCiAgQG1ldGhvZCBjb21wdXRlZC5kZWZhdWx0VG8KICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtT
dHJpbmd9IGRlZmF1bHRQYXRoCiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gY29t
cHV0ZWQgcHJvcGVydHkgd2hpY2ggYWN0cyBsaWtlCiAgYSBzdGFuZGFyZCBnZXR0ZXIgYW5kIHNl
dHRlciwgYnV0IGRlZmF1bHRzIHRvIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0UGF0aGAuCiovCkVt
YmVyLmNvbXB1dGVkLmRlZmF1bHRUbyA9IGZ1bmN0aW9uKGRlZmF1bHRQYXRoKSB7CiAgcmV0dXJu
IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKGtleSwgbmV3VmFsdWUsIGNhY2hlZFZhbHVlKSB7CiAg
ICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gY2FjaGVkVmFsdWUg
IT0gbnVsbCA/IGNhY2hlZFZhbHVlIDogZ2V0KHRoaXMsIGRlZmF1bHRQYXRoKTsKICAgIH0KICAg
IHJldHVybiBuZXdWYWx1ZSAhPSBudWxsID8gbmV3VmFsdWUgOiBnZXQodGhpcywgZGVmYXVsdFBh
dGgpOwogIH0pOwp9OwoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLy8gRW1iZXIudHJ5RmluYWxs
eQovKioKQG1vZHVsZSBlbWJlci1tZXRhbAoqLwoKdmFyIEFGVEVSX09CU0VSVkVSUyA9ICc6Y2hh
bmdlJywKICAgIEJFRk9SRV9PQlNFUlZFUlMgPSAnOmJlZm9yZSc7CgpmdW5jdGlvbiBjaGFuZ2VF
dmVudChrZXlOYW1lKSB7CiAgcmV0dXJuIGtleU5hbWUrQUZURVJfT0JTRVJWRVJTOwp9CgpmdW5j
dGlvbiBiZWZvcmVFdmVudChrZXlOYW1lKSB7CiAgcmV0dXJuIGtleU5hbWUrQkVGT1JFX09CU0VS
VkVSUzsKfQoKLyoqCiAgQG1ldGhvZCBhZGRPYnNlcnZlcgogIEBwYXJhbSBvYmoKICBAcGFyYW0g
e1N0cmluZ30gcGF0aAogIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSB0YXJnZXRPck1ldGhvZAog
IEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBbbWV0aG9kXQoqLwpFbWJlci5hZGRPYnNlcnZlciA9
IGZ1bmN0aW9uKG9iaiwgX3BhdGgsIHRhcmdldCwgbWV0aG9kKSB7CiAgRW1iZXIuYWRkTGlzdGVu
ZXIob2JqLCBjaGFuZ2VFdmVudChfcGF0aCksIHRhcmdldCwgbWV0aG9kKTsKICBFbWJlci53YXRj
aChvYmosIF9wYXRoKTsKCiAgcmV0dXJuIHRoaXM7Cn07CgpFbWJlci5vYnNlcnZlcnNGb3IgPSBm
dW5jdGlvbihvYmosIHBhdGgpIHsKICByZXR1cm4gRW1iZXIubGlzdGVuZXJzRm9yKG9iaiwgY2hh
bmdlRXZlbnQocGF0aCkpOwp9OwoKLyoqCiAgQG1ldGhvZCByZW1vdmVPYnNlcnZlcgogIEBwYXJh
bSBvYmoKICBAcGFyYW0ge1N0cmluZ30gcGF0aAogIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSB0
YXJnZXRPck1ldGhvZAogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBbbWV0aG9kXQoqLwpFbWJl
ci5yZW1vdmVPYnNlcnZlciA9IGZ1bmN0aW9uKG9iaiwgX3BhdGgsIHRhcmdldCwgbWV0aG9kKSB7
CiAgRW1iZXIudW53YXRjaChvYmosIF9wYXRoKTsKICBFbWJlci5yZW1vdmVMaXN0ZW5lcihvYmos
IGNoYW5nZUV2ZW50KF9wYXRoKSwgdGFyZ2V0LCBtZXRob2QpOwoKICByZXR1cm4gdGhpczsKfTsK
Ci8qKgogIEBtZXRob2QgYWRkQmVmb3JlT2JzZXJ2ZXIKICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtT
dHJpbmd9IHBhdGgKICBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gdGFyZ2V0T3JNZXRob2QKICBA
cGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gW21ldGhvZF0KKi8KRW1iZXIuYWRkQmVmb3JlT2JzZXJ2
ZXIgPSBmdW5jdGlvbihvYmosIF9wYXRoLCB0YXJnZXQsIG1ldGhvZCkgewogIEVtYmVyLmFkZExp
c3RlbmVyKG9iaiwgYmVmb3JlRXZlbnQoX3BhdGgpLCB0YXJnZXQsIG1ldGhvZCk7CiAgRW1iZXIu
d2F0Y2gob2JqLCBfcGF0aCk7CgogIHJldHVybiB0aGlzOwp9OwoKLy8gU3VzcGVuZCBvYnNlcnZl
ciBkdXJpbmcgY2FsbGJhY2suCi8vCi8vIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBieSB0aGUg
dGFyZ2V0IG9mIHRoZSBvYnNlcnZlcgovLyB3aGlsZSBpdCBpcyBzZXR0aW5nIHRoZSBvYnNlcnZl
ZCBwYXRoLgpFbWJlci5fc3VzcGVuZEJlZm9yZU9ic2VydmVyID0gZnVuY3Rpb24ob2JqLCBwYXRo
LCB0YXJnZXQsIG1ldGhvZCwgY2FsbGJhY2spIHsKICByZXR1cm4gRW1iZXIuX3N1c3BlbmRMaXN0
ZW5lcihvYmosIGJlZm9yZUV2ZW50KHBhdGgpLCB0YXJnZXQsIG1ldGhvZCwgY2FsbGJhY2spOwp9
OwoKRW1iZXIuX3N1c3BlbmRPYnNlcnZlciA9IGZ1bmN0aW9uKG9iaiwgcGF0aCwgdGFyZ2V0LCBt
ZXRob2QsIGNhbGxiYWNrKSB7CiAgcmV0dXJuIEVtYmVyLl9zdXNwZW5kTGlzdGVuZXIob2JqLCBj
aGFuZ2VFdmVudChwYXRoKSwgdGFyZ2V0LCBtZXRob2QsIGNhbGxiYWNrKTsKfTsKCnZhciBtYXAg
PSBFbWJlci5BcnJheVBvbHlmaWxscy5tYXA7CgpFbWJlci5fc3VzcGVuZEJlZm9yZU9ic2VydmVy
cyA9IGZ1bmN0aW9uKG9iaiwgcGF0aHMsIHRhcmdldCwgbWV0aG9kLCBjYWxsYmFjaykgewogIHZh
ciBldmVudHMgPSBtYXAuY2FsbChwYXRocywgYmVmb3JlRXZlbnQpOwogIHJldHVybiBFbWJlci5f
c3VzcGVuZExpc3RlbmVycyhvYmosIGV2ZW50cywgdGFyZ2V0LCBtZXRob2QsIGNhbGxiYWNrKTsK
fTsKCkVtYmVyLl9zdXNwZW5kT2JzZXJ2ZXJzID0gZnVuY3Rpb24ob2JqLCBwYXRocywgdGFyZ2V0
LCBtZXRob2QsIGNhbGxiYWNrKSB7CiAgdmFyIGV2ZW50cyA9IG1hcC5jYWxsKHBhdGhzLCBjaGFu
Z2VFdmVudCk7CiAgcmV0dXJuIEVtYmVyLl9zdXNwZW5kTGlzdGVuZXJzKG9iaiwgZXZlbnRzLCB0
YXJnZXQsIG1ldGhvZCwgY2FsbGJhY2spOwp9OwoKRW1iZXIuYmVmb3JlT2JzZXJ2ZXJzRm9yID0g
ZnVuY3Rpb24ob2JqLCBwYXRoKSB7CiAgcmV0dXJuIEVtYmVyLmxpc3RlbmVyc0ZvcihvYmosIGJl
Zm9yZUV2ZW50KHBhdGgpKTsKfTsKCi8qKgogIEBtZXRob2QgcmVtb3ZlQmVmb3JlT2JzZXJ2ZXIK
ICBAcGFyYW0gb2JqCiAgQHBhcmFtIHtTdHJpbmd9IHBhdGgKICBAcGFyYW0ge09iamVjdHxGdW5j
dGlvbn0gdGFyZ2V0T3JNZXRob2QKICBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gW21ldGhvZF0K
Ki8KRW1iZXIucmVtb3ZlQmVmb3JlT2JzZXJ2ZXIgPSBmdW5jdGlvbihvYmosIF9wYXRoLCB0YXJn
ZXQsIG1ldGhvZCkgewogIEVtYmVyLnVud2F0Y2gob2JqLCBfcGF0aCk7CiAgRW1iZXIucmVtb3Zl
TGlzdGVuZXIob2JqLCBiZWZvcmVFdmVudChfcGF0aCksIHRhcmdldCwgbWV0aG9kKTsKCiAgcmV0
dXJuIHRoaXM7Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CmRlZmluZSgiYmFja2J1cm5lci9x
dWV1ZSIsCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsKICAgICJ1c2Ug
c3RyaWN0IjsKICAgIGZ1bmN0aW9uIFF1ZXVlKGRhcSwgbmFtZSwgb3B0aW9ucykgewogICAgICB0
aGlzLmRhcSA9IGRhcTsKICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgdGhpcy5vcHRpb25z
ID0gb3B0aW9uczsKICAgICAgdGhpcy5fcXVldWUgPSBbXTsKICAgIH0KCiAgICBRdWV1ZS5wcm90
b3R5cGUgPSB7CiAgICAgIGRhcTogbnVsbCwKICAgICAgbmFtZTogbnVsbCwKICAgICAgb3B0aW9u
czogbnVsbCwKICAgICAgX3F1ZXVlOiBudWxsLAoKICAgICAgcHVzaDogZnVuY3Rpb24odGFyZ2V0
LCBtZXRob2QsIGFyZ3MsIHN0YWNrKSB7CiAgICAgICAgdmFyIHF1ZXVlID0gdGhpcy5fcXVldWU7
CiAgICAgICAgcXVldWUucHVzaCh0YXJnZXQsIG1ldGhvZCwgYXJncywgc3RhY2spOwogICAgICAg
IHJldHVybiB7cXVldWU6IHRoaXMsIHRhcmdldDogdGFyZ2V0LCBtZXRob2Q6IG1ldGhvZH07CiAg
ICAgIH0sCgogICAgICBwdXNoVW5pcXVlOiBmdW5jdGlvbih0YXJnZXQsIG1ldGhvZCwgYXJncywg
c3RhY2spIHsKICAgICAgICB2YXIgcXVldWUgPSB0aGlzLl9xdWV1ZSwgY3VycmVudFRhcmdldCwg
Y3VycmVudE1ldGhvZCwgaSwgbDsKCiAgICAgICAgZm9yIChpID0gMCwgbCA9IHF1ZXVlLmxlbmd0
aDsgaSA8IGw7IGkgKz0gNCkgewogICAgICAgICAgY3VycmVudFRhcmdldCA9IHF1ZXVlW2ldOwog
ICAgICAgICAgY3VycmVudE1ldGhvZCA9IHF1ZXVlW2krMV07CgogICAgICAgICAgaWYgKGN1cnJl
bnRUYXJnZXQgPT09IHRhcmdldCAmJiBjdXJyZW50TWV0aG9kID09PSBtZXRob2QpIHsKICAgICAg
ICAgICAgcXVldWVbaSsyXSA9IGFyZ3M7IC8vIHJlcGxhY2UgYXJncwogICAgICAgICAgICBxdWV1
ZVtpKzNdID0gc3RhY2s7IC8vIHJlcGxhY2Ugc3RhY2sKICAgICAgICAgICAgcmV0dXJuIHtxdWV1
ZTogdGhpcywgdGFyZ2V0OiB0YXJnZXQsIG1ldGhvZDogbWV0aG9kfTsgLy8gVE9ETzogdGVzdCB0
aGlzIGNvZGUgcGF0aAogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5fcXVldWUu
cHVzaCh0YXJnZXQsIG1ldGhvZCwgYXJncywgc3RhY2spOwogICAgICAgIHJldHVybiB7cXVldWU6
IHRoaXMsIHRhcmdldDogdGFyZ2V0LCBtZXRob2Q6IG1ldGhvZH07CiAgICAgIH0sCgogICAgICAv
LyBUT0RPOiByZW1vdmUgbWUsIG9ubHkgYmVpbmcgdXNlZCBmb3IgRW1iZXIucnVuLnN5bmMKICAg
ICAgZmx1c2g6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlLAog
ICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBiZWZvcmUgPSBv
cHRpb25zICYmIG9wdGlvbnMuYmVmb3JlLAogICAgICAgICAgICBhZnRlciA9IG9wdGlvbnMgJiYg
b3B0aW9ucy5hZnRlciwKICAgICAgICAgICAgdGFyZ2V0LCBtZXRob2QsIGFyZ3MsIHN0YWNrLCBp
LCBsID0gcXVldWUubGVuZ3RoOwoKICAgICAgICBpZiAobCAmJiBiZWZvcmUpIHsgYmVmb3JlKCk7
IH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbDsgaSArPSA0KSB7CiAgICAgICAgICB0YXJnZXQg
PSBxdWV1ZVtpXTsKICAgICAgICAgIG1ldGhvZCA9IHF1ZXVlW2krMV07CiAgICAgICAgICBhcmdz
ICAgPSBxdWV1ZVtpKzJdOwogICAgICAgICAgc3RhY2sgID0gcXVldWVbaSszXTsgLy8gRGVidWdn
aW5nIGFzc2lzdGFuY2UKCiAgICAgICAgICAvLyBUT0RPOiBlcnJvciBoYW5kbGluZwogICAgICAg
ICAgaWYgKGFyZ3MgJiYgYXJncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIG1ldGhvZC5hcHBs
eSh0YXJnZXQsIGFyZ3MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWV0aG9kLmNh
bGwodGFyZ2V0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGwgJiYgYWZ0ZXIp
IHsgYWZ0ZXIoKTsgfQoKICAgICAgICAvLyBjaGVjayBpZiBuZXcgaXRlbXMgaGF2ZSBiZWVuIGFk
ZGVkCiAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IGwpIHsKICAgICAgICAgIHRoaXMuX3F1ZXVl
ID0gcXVldWUuc2xpY2UobCk7CiAgICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgIHRoaXMuX3F1ZXVlLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9LAoK
ICAgICAgY2FuY2VsOiBmdW5jdGlvbihhY3Rpb25Ub0NhbmNlbCkgewogICAgICAgIHZhciBxdWV1
ZSA9IHRoaXMuX3F1ZXVlLCBjdXJyZW50VGFyZ2V0LCBjdXJyZW50TWV0aG9kLCBpLCBsOwoKICAg
ICAgICBmb3IgKGkgPSAwLCBsID0gcXVldWUubGVuZ3RoOyBpIDwgbDsgaSArPSA0KSB7CiAgICAg
ICAgICBjdXJyZW50VGFyZ2V0ID0gcXVldWVbaV07CiAgICAgICAgICBjdXJyZW50TWV0aG9kID0g
cXVldWVbaSsxXTsKCiAgICAgICAgICBpZiAoY3VycmVudFRhcmdldCA9PT0gYWN0aW9uVG9DYW5j
ZWwudGFyZ2V0ICYmIGN1cnJlbnRNZXRob2QgPT09IGFjdGlvblRvQ2FuY2VsLm1ldGhvZCkgewog
ICAgICAgICAgICBxdWV1ZS5zcGxpY2UoaSwgNCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog
ICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm90IGZvdW5kIGluIGN1cnJlbnQg
cXVldWUKICAgICAgICAvLyBjb3VsZCBiZSBpbiB0aGUgcXVldWUgdGhhdCBpcyBiZWluZyBmbHVz
aGVkCiAgICAgICAgcXVldWUgPSB0aGlzLl9xdWV1ZUJlaW5nRmx1c2hlZDsKICAgICAgICBpZiAo
IXF1ZXVlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDAs
IGwgPSBxdWV1ZS5sZW5ndGg7IGkgPCBsOyBpICs9IDQpIHsKICAgICAgICAgIGN1cnJlbnRUYXJn
ZXQgPSBxdWV1ZVtpXTsKICAgICAgICAgIGN1cnJlbnRNZXRob2QgPSBxdWV1ZVtpKzFdOwoKICAg
ICAgICAgIGlmIChjdXJyZW50VGFyZ2V0ID09PSBhY3Rpb25Ub0NhbmNlbC50YXJnZXQgJiYgY3Vy
cmVudE1ldGhvZCA9PT0gYWN0aW9uVG9DYW5jZWwubWV0aG9kKSB7CiAgICAgICAgICAgIC8vIGRv
bid0IG1lc3Mgd2l0aCBhcnJheSBkdXJpbmcgZmx1c2gKICAgICAgICAgICAgLy8ganVzdCBudWxs
aWZ5IHRoZSBtZXRob2QKICAgICAgICAgICAgcXVldWVbaSsxXSA9IG51bGw7CiAgICAgICAgICAg
IHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKCgogICAg
X19leHBvcnRzX18uUXVldWUgPSBRdWV1ZTsKICB9KTsKCmRlZmluZSgiYmFja2J1cm5lci9kZWZl
cnJlZF9hY3Rpb25fcXVldWVzIiwKICBbImJhY2tidXJuZXIvcXVldWUiLCJleHBvcnRzIl0sCiAg
ZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3Qi
OwogICAgdmFyIFF1ZXVlID0gX19kZXBlbmRlbmN5MV9fLlF1ZXVlOwoKICAgIGZ1bmN0aW9uIERl
ZmVycmVkQWN0aW9uUXVldWVzKHF1ZXVlTmFtZXMsIG9wdGlvbnMpIHsKICAgICAgdmFyIHF1ZXVl
cyA9IHRoaXMucXVldWVzID0ge307CiAgICAgIHRoaXMucXVldWVOYW1lcyA9IHF1ZXVlTmFtZXMg
PSBxdWV1ZU5hbWVzIHx8IFtdOwoKICAgICAgdmFyIHF1ZXVlTmFtZTsKICAgICAgZm9yICh2YXIg
aSA9IDAsIGwgPSBxdWV1ZU5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHF1ZXVl
TmFtZSA9IHF1ZXVlTmFtZXNbaV07CiAgICAgICAgcXVldWVzW3F1ZXVlTmFtZV0gPSBuZXcgUXVl
dWUodGhpcywgcXVldWVOYW1lLCBvcHRpb25zW3F1ZXVlTmFtZV0pOwogICAgICB9CiAgICB9Cgog
ICAgRGVmZXJyZWRBY3Rpb25RdWV1ZXMucHJvdG90eXBlID0gewogICAgICBxdWV1ZU5hbWVzOiBu
dWxsLAogICAgICBxdWV1ZXM6IG51bGwsCgogICAgICBzY2hlZHVsZTogZnVuY3Rpb24ocXVldWVO
YW1lLCB0YXJnZXQsIG1ldGhvZCwgYXJncywgb25jZUZsYWcsIHN0YWNrKSB7CiAgICAgICAgdmFy
IHF1ZXVlcyA9IHRoaXMucXVldWVzLAogICAgICAgICAgICBxdWV1ZSA9IHF1ZXVlc1txdWV1ZU5h
bWVdOwoKICAgICAgICBpZiAoIXF1ZXVlKSB7IHRocm93IG5ldyBFcnJvcigiWW91IGF0dGVtcHRl
ZCB0byBzY2hlZHVsZSBhbiBhY3Rpb24gaW4gYSBxdWV1ZSAoIiArIHF1ZXVlTmFtZSArICIpIHRo
YXQgZG9lc24ndCBleGlzdCIpOyB9CgogICAgICAgIGlmIChvbmNlRmxhZykgewogICAgICAgICAg
cmV0dXJuIHF1ZXVlLnB1c2hVbmlxdWUodGFyZ2V0LCBtZXRob2QsIGFyZ3MsIHN0YWNrKTsKICAg
ICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHF1ZXVlLnB1c2godGFyZ2V0LCBtZXRob2Qs
IGFyZ3MsIHN0YWNrKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBmbHVzaDogZnVuY3Rpb24o
KSB7CiAgICAgICAgdmFyIHF1ZXVlcyA9IHRoaXMucXVldWVzLAogICAgICAgICAgICBxdWV1ZU5h
bWVzID0gdGhpcy5xdWV1ZU5hbWVzLAogICAgICAgICAgICBxdWV1ZU5hbWUsIHF1ZXVlLCBxdWV1
ZUl0ZW1zLCBwcmlvclF1ZXVlTmFtZUluZGV4LAogICAgICAgICAgICBxdWV1ZU5hbWVJbmRleCA9
IDAsIG51bWJlck9mUXVldWVzID0gcXVldWVOYW1lcy5sZW5ndGg7CgogICAgICAgIG91dGVybG9v
cDoKICAgICAgICB3aGlsZSAocXVldWVOYW1lSW5kZXggPCBudW1iZXJPZlF1ZXVlcykgewogICAg
ICAgICAgcXVldWVOYW1lID0gcXVldWVOYW1lc1txdWV1ZU5hbWVJbmRleF07CiAgICAgICAgICBx
dWV1ZSA9IHF1ZXVlc1txdWV1ZU5hbWVdOwogICAgICAgICAgcXVldWVJdGVtcyA9IHF1ZXVlLl9x
dWV1ZUJlaW5nRmx1c2hlZCA9IHF1ZXVlLl9xdWV1ZS5zbGljZSgpOwogICAgICAgICAgcXVldWUu
X3F1ZXVlID0gW107CgogICAgICAgICAgdmFyIG9wdGlvbnMgPSBxdWV1ZS5vcHRpb25zLAogICAg
ICAgICAgICAgIGJlZm9yZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5iZWZvcmUsCiAgICAgICAgICAg
ICAgYWZ0ZXIgPSBvcHRpb25zICYmIG9wdGlvbnMuYWZ0ZXIsCiAgICAgICAgICAgICAgdGFyZ2V0
LCBtZXRob2QsIGFyZ3MsIHN0YWNrLAogICAgICAgICAgICAgIHF1ZXVlSW5kZXggPSAwLCBudW1i
ZXJPZlF1ZXVlSXRlbXMgPSBxdWV1ZUl0ZW1zLmxlbmd0aDsKCiAgICAgICAgICBpZiAobnVtYmVy
T2ZRdWV1ZUl0ZW1zICYmIGJlZm9yZSkgeyBiZWZvcmUoKTsgfQogICAgICAgICAgd2hpbGUgKHF1
ZXVlSW5kZXggPCBudW1iZXJPZlF1ZXVlSXRlbXMpIHsKICAgICAgICAgICAgdGFyZ2V0ID0gcXVl
dWVJdGVtc1txdWV1ZUluZGV4XTsKICAgICAgICAgICAgbWV0aG9kID0gcXVldWVJdGVtc1txdWV1
ZUluZGV4KzFdOwogICAgICAgICAgICBhcmdzICAgPSBxdWV1ZUl0ZW1zW3F1ZXVlSW5kZXgrMl07
CiAgICAgICAgICAgIHN0YWNrICA9IHF1ZXVlSXRlbXNbcXVldWVJbmRleCszXTsgLy8gRGVidWdn
aW5nIGFzc2lzdGFuY2UKCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWV0aG9kID09PSAnc3RyaW5n
JykgeyBtZXRob2QgPSB0YXJnZXRbbWV0aG9kXTsgfQoKICAgICAgICAgICAgLy8gbWV0aG9kIGNv
dWxkIGhhdmUgYmVlbiBudWxsaWZpZWQgLyBjYW5jZWxlZCBkdXJpbmcgZmx1c2gKICAgICAgICAg
ICAgaWYgKG1ldGhvZCkgewogICAgICAgICAgICAgIC8vIFRPRE86IGVycm9yIGhhbmRsaW5nCiAg
ICAgICAgICAgICAgaWYgKGFyZ3MgJiYgYXJncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAg
ICBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmdzKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICAgICAgbWV0aG9kLmNhbGwodGFyZ2V0KTsKICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgIH0KCiAgICAgICAgICAgIHF1ZXVlSW5kZXggKz0gNDsKICAgICAgICAgIH0KICAgICAgICAg
IHF1ZXVlLl9xdWV1ZUJlaW5nRmx1c2hlZCA9IG51bGw7CiAgICAgICAgICBpZiAobnVtYmVyT2ZR
dWV1ZUl0ZW1zICYmIGFmdGVyKSB7IGFmdGVyKCk7IH0KCiAgICAgICAgICBpZiAoKHByaW9yUXVl
dWVOYW1lSW5kZXggPSBpbmRleE9mUHJpb3JRdWV1ZVdpdGhBY3Rpb25zKHRoaXMsIHF1ZXVlTmFt
ZUluZGV4KSkgIT09IC0xKSB7CiAgICAgICAgICAgIHF1ZXVlTmFtZUluZGV4ID0gcHJpb3JRdWV1
ZU5hbWVJbmRleDsKICAgICAgICAgICAgY29udGludWUgb3V0ZXJsb29wOwogICAgICAgICAgfQoK
ICAgICAgICAgIHF1ZXVlTmFtZUluZGV4Kys7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAg
IGZ1bmN0aW9uIGluZGV4T2ZQcmlvclF1ZXVlV2l0aEFjdGlvbnMoZGFxLCBjdXJyZW50UXVldWVJ
bmRleCkgewogICAgICB2YXIgcXVldWVOYW1lLCBxdWV1ZTsKCiAgICAgIGZvciAodmFyIGkgPSAw
LCBsID0gY3VycmVudFF1ZXVlSW5kZXg7IGkgPD0gbDsgaSsrKSB7CiAgICAgICAgcXVldWVOYW1l
ID0gZGFxLnF1ZXVlTmFtZXNbaV07CiAgICAgICAgcXVldWUgPSBkYXEucXVldWVzW3F1ZXVlTmFt
ZV07CiAgICAgICAgaWYgKHF1ZXVlLl9xdWV1ZS5sZW5ndGgpIHsgcmV0dXJuIGk7IH0KICAgICAg
fQoKICAgICAgcmV0dXJuIC0xOwogICAgfQoKCiAgICBfX2V4cG9ydHNfXy5EZWZlcnJlZEFjdGlv
blF1ZXVlcyA9IERlZmVycmVkQWN0aW9uUXVldWVzOwogIH0pOwoKZGVmaW5lKCJiYWNrYnVybmVy
IiwKICBbImJhY2tidXJuZXIvZGVmZXJyZWRfYWN0aW9uX3F1ZXVlcyIsImV4cG9ydHMiXSwKICBm
dW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7
CiAgICB2YXIgRGVmZXJyZWRBY3Rpb25RdWV1ZXMgPSBfX2RlcGVuZGVuY3kxX18uRGVmZXJyZWRB
Y3Rpb25RdWV1ZXM7CgogICAgdmFyIHNsaWNlID0gW10uc2xpY2UsCiAgICAgICAgcG9wID0gW10u
cG9wLAogICAgICAgIHRocm90dGxlcnMgPSBbXSwKICAgICAgICBkZWJvdW5jZWVzID0gW10sCiAg
ICAgICAgdGltZXJzID0gW10sCiAgICAgICAgYXV0b3J1biwgbGF0ZXJUaW1lciwgbGF0ZXJUaW1l
ckV4cGlyZXNBdCwKICAgICAgICBnbG9iYWwgPSB0aGlzLAogICAgICAgIE5VTUJFUiA9IC9cZCsv
OwoKICAgIGZ1bmN0aW9uIGlzQ29lcmNhYmxlTnVtYmVyKG51bWJlcikgewogICAgICByZXR1cm4g
dHlwZW9mIG51bWJlciA9PT0gJ251bWJlcicgfHwgTlVNQkVSLnRlc3QobnVtYmVyKTsKICAgIH0K
CiAgICBmdW5jdGlvbiBCYWNrYnVybmVyKHF1ZXVlTmFtZXMsIG9wdGlvbnMpIHsKICAgICAgdGhp
cy5xdWV1ZU5hbWVzID0gcXVldWVOYW1lczsKICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8
fCB7fTsKICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZGVmYXVsdFF1ZXVlKSB7CiAgICAgICAgdGhp
cy5vcHRpb25zLmRlZmF1bHRRdWV1ZSA9IHF1ZXVlTmFtZXNbMF07CiAgICAgIH0KICAgICAgdGhp
cy5pbnN0YW5jZVN0YWNrID0gW107CiAgICB9CgogICAgQmFja2J1cm5lci5wcm90b3R5cGUgPSB7
CiAgICAgIHF1ZXVlTmFtZXM6IG51bGwsCiAgICAgIG9wdGlvbnM6IG51bGwsCiAgICAgIGN1cnJl
bnRJbnN0YW5jZTogbnVsbCwKICAgICAgaW5zdGFuY2VTdGFjazogbnVsbCwKCiAgICAgIGJlZ2lu
OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgb25CZWdpbiA9IHRoaXMub3B0aW9ucyAmJiB0aGlz
Lm9wdGlvbnMub25CZWdpbiwKICAgICAgICAgICAgcHJldmlvdXNJbnN0YW5jZSA9IHRoaXMuY3Vy
cmVudEluc3RhbmNlOwoKICAgICAgICBpZiAocHJldmlvdXNJbnN0YW5jZSkgewogICAgICAgICAg
dGhpcy5pbnN0YW5jZVN0YWNrLnB1c2gocHJldmlvdXNJbnN0YW5jZSk7CiAgICAgICAgfQoKICAg
ICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZSA9IG5ldyBEZWZlcnJlZEFjdGlvblF1ZXVlcyh0aGlz
LnF1ZXVlTmFtZXMsIHRoaXMub3B0aW9ucyk7CiAgICAgICAgaWYgKG9uQmVnaW4pIHsKICAgICAg
ICAgIG9uQmVnaW4odGhpcy5jdXJyZW50SW5zdGFuY2UsIHByZXZpb3VzSW5zdGFuY2UpOwogICAg
ICAgIH0KICAgICAgfSwKCiAgICAgIGVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIG9uRW5k
ID0gdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5vbkVuZCwKICAgICAgICAgICAgY3VycmVu
dEluc3RhbmNlID0gdGhpcy5jdXJyZW50SW5zdGFuY2UsCiAgICAgICAgICAgIG5leHRJbnN0YW5j
ZSA9IG51bGw7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBjdXJyZW50SW5zdGFuY2UuZmx1c2go
KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2UgPSBu
dWxsOwoKICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlU3RhY2subGVuZ3RoKSB7CiAgICAgICAg
ICAgIG5leHRJbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VTdGFjay5wb3AoKTsKICAgICAgICAgICAg
dGhpcy5jdXJyZW50SW5zdGFuY2UgPSBuZXh0SW5zdGFuY2U7CiAgICAgICAgICB9CgogICAgICAg
ICAgaWYgKG9uRW5kKSB7CiAgICAgICAgICAgIG9uRW5kKGN1cnJlbnRJbnN0YW5jZSwgbmV4dElu
c3RhbmNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgogICAgICBydW46IGZ1bmN0
aW9uKHRhcmdldCwgbWV0aG9kIC8qLCBhcmdzICovKSB7CiAgICAgICAgdmFyIHJldDsKICAgICAg
ICB0aGlzLmJlZ2luKCk7CgogICAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgICBtZXRob2Qg
PSB0YXJnZXQ7CiAgICAgICAgICB0YXJnZXQgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYg
KHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtZXRob2QgPSB0YXJnZXRb
bWV0aG9kXTsKICAgICAgICB9CgogICAgICAgIC8vIFByZXZlbnQgU2FmYXJpIGRvdWJsZS1maW5h
bGx5LgogICAgICAgIHZhciBmaW5hbGx5QWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgIHRy
eSB7CiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgcmV0
ID0gbWV0aG9kLmFwcGx5KHRhcmdldCwgc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpKTsKICAgICAg
ICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldCA9IG1ldGhvZC5jYWxsKHRhcmdldCk7CiAgICAg
ICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmICghZmluYWxseUFscmVhZHlD
YWxsZWQpIHsKICAgICAgICAgICAgZmluYWxseUFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAg
ICAgICB0aGlzLmVuZCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0
OwogICAgICB9LAoKICAgICAgZGVmZXI6IGZ1bmN0aW9uKHF1ZXVlTmFtZSwgdGFyZ2V0LCBtZXRo
b2QgLyogLCBhcmdzICovKSB7CiAgICAgICAgaWYgKCFtZXRob2QpIHsKICAgICAgICAgIG1ldGhv
ZCA9IHRhcmdldDsKICAgICAgICAgIHRhcmdldCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBp
ZiAodHlwZW9mIG1ldGhvZCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIG1ldGhvZCA9IHRhcmdl
dFttZXRob2RdOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5ERUJVRyA/IG5l
dyBFcnJvcigpIDogdW5kZWZpbmVkLAogICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzLmxlbmd0
aCA+IDMgPyBzbGljZS5jYWxsKGFyZ3VtZW50cywgMykgOiB1bmRlZmluZWQ7CiAgICAgICAgaWYg
KCF0aGlzLmN1cnJlbnRJbnN0YW5jZSkgeyBjcmVhdGVBdXRvcnVuKHRoaXMpOyB9CiAgICAgICAg
cmV0dXJuIHRoaXMuY3VycmVudEluc3RhbmNlLnNjaGVkdWxlKHF1ZXVlTmFtZSwgdGFyZ2V0LCBt
ZXRob2QsIGFyZ3MsIGZhbHNlLCBzdGFjayk7CiAgICAgIH0sCgogICAgICBkZWZlck9uY2U6IGZ1
bmN0aW9uKHF1ZXVlTmFtZSwgdGFyZ2V0LCBtZXRob2QgLyogLCBhcmdzICovKSB7CiAgICAgICAg
aWYgKCFtZXRob2QpIHsKICAgICAgICAgIG1ldGhvZCA9IHRhcmdldDsKICAgICAgICAgIHRhcmdl
dCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ3N0cmlu
ZycpIHsKICAgICAgICAgIG1ldGhvZCA9IHRhcmdldFttZXRob2RdOwogICAgICAgIH0KCiAgICAg
ICAgdmFyIHN0YWNrID0gdGhpcy5ERUJVRyA/IG5ldyBFcnJvcigpIDogdW5kZWZpbmVkLAogICAg
ICAgICAgICBhcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBzbGljZS5jYWxsKGFyZ3VtZW50
cywgMykgOiB1bmRlZmluZWQ7CiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRJbnN0YW5jZSkgeyBj
cmVhdGVBdXRvcnVuKHRoaXMpOyB9CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEluc3RhbmNl
LnNjaGVkdWxlKHF1ZXVlTmFtZSwgdGFyZ2V0LCBtZXRob2QsIGFyZ3MsIHRydWUsIHN0YWNrKTsK
ICAgICAgfSwKCiAgICAgIHNldFRpbWVvdXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhcmdz
ID0gc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgIHZhciBsZW5ndGggPSBhcmdzLmxlbmd0
aDsKICAgICAgICB2YXIgbWV0aG9kLCB3YWl0LCB0YXJnZXQ7CiAgICAgICAgdmFyIHNlbGYgPSB0
aGlzOwogICAgICAgIHZhciBtZXRob2RPclRhcmdldCwgbWV0aG9kT3JXYWl0LCBtZXRob2RPckFy
Z3M7CgogICAgICAgIGlmIChsZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAg
ICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgICAgICAgbWV0aG9kID0gYXJncy5zaGlm
dCgpOwogICAgICAgICAgd2FpdCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPT09IDIp
IHsKICAgICAgICAgIG1ldGhvZE9yVGFyZ2V0ID0gYXJnc1swXTsKICAgICAgICAgIG1ldGhvZE9y
V2FpdCA9IGFyZ3NbMV07CgogICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2RPcldhaXQgPT09ICdm
dW5jdGlvbicgfHwgdHlwZW9mICBtZXRob2RPclRhcmdldFttZXRob2RPcldhaXRdID09PSAnZnVu
Y3Rpb24nKSB7CiAgICAgICAgICAgIHRhcmdldCA9IGFyZ3Muc2hpZnQoKTsKICAgICAgICAgICAg
bWV0aG9kID0gYXJncy5zaGlmdCgpOwogICAgICAgICAgICB3YWl0ID0gMDsKICAgICAgICAgIH0g
ZWxzZSBpZiAoaXNDb2VyY2FibGVOdW1iZXIobWV0aG9kT3JXYWl0KSkgewogICAgICAgICAgICBt
ZXRob2QgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgICAgIHdhaXQgPSBhcmdzLnNoaWZ0KCk7CiAg
ICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZXRob2QgPSBhcmdzLnNoaWZ0KCk7CiAgICAg
ICAgICAgIHdhaXQgPSAgMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg
dmFyIGxhc3QgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CgogICAgICAgICAgaWYgKGlzQ29lcmNh
YmxlTnVtYmVyKGxhc3QpKSB7CiAgICAgICAgICAgIHdhaXQgPSBhcmdzLnBvcCgpOwogICAgICAg
ICAgfQoKICAgICAgICAgIG1ldGhvZE9yVGFyZ2V0ID0gYXJnc1swXTsKICAgICAgICAgIG1ldGhv
ZE9yQXJncyA9IGFyZ3NbMV07CgogICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2RPckFyZ3MgPT09
ICdmdW5jdGlvbicgfHwgKHR5cGVvZiBtZXRob2RPckFyZ3MgPT09ICdzdHJpbmcnICYmCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kT3JU
YXJnZXQgIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBtZXRob2RPckFyZ3MgaW4gbWV0aG9kT3JUYXJnZXQpKSB7CiAgICAgICAg
ICAgIHRhcmdldCA9IGFyZ3Muc2hpZnQoKTsKICAgICAgICAgICAgbWV0aG9kID0gYXJncy5zaGlm
dCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWV0aG9kID0gYXJncy5zaGlmdCgp
OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGV4ZWN1dGVBdCA9ICgrbmV3IERh
dGUoKSkgKyBwYXJzZUludCh3YWl0LCAxMCk7CgogICAgICAgIGlmICh0eXBlb2YgbWV0aG9kID09
PSAnc3RyaW5nJykgewogICAgICAgICAgbWV0aG9kID0gdGFyZ2V0W21ldGhvZF07CiAgICAgICAg
fQoKICAgICAgICBmdW5jdGlvbiBmbigpIHsKICAgICAgICAgIG1ldGhvZC5hcHBseSh0YXJnZXQs
IGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gZmluZCBwb3NpdGlvbiB0byBpbnNlcnQgLSBU
T0RPOiBiaW5hcnkgc2VhcmNoCiAgICAgICAgdmFyIGksIGw7CiAgICAgICAgZm9yIChpID0gMCwg
bCA9IHRpbWVycy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGlmIChleGVjdXRl
QXQgPCB0aW1lcnNbaV0pIHsgYnJlYWs7IH0KICAgICAgICB9CgogICAgICAgIHRpbWVycy5zcGxp
Y2UoaSwgMCwgZXhlY3V0ZUF0LCBmbik7CgogICAgICAgIHVwZGF0ZUxhdGVyVGltZXIoc2VsZiwg
ZXhlY3V0ZUF0LCB3YWl0KTsKCiAgICAgICAgcmV0dXJuIGZuOwogICAgICB9LAoKICAgICAgdGhy
b3R0bGU6IGZ1bmN0aW9uKHRhcmdldCwgbWV0aG9kIC8qICwgYXJncywgd2FpdCAqLykgewogICAg
ICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50cywKICAgICAg
ICAgICAgd2FpdCA9IHBhcnNlSW50KHBvcC5jYWxsKGFyZ3MpLCAxMCksCiAgICAgICAgICAgIHRo
cm90dGxlciwKICAgICAgICAgICAgaW5kZXgsCiAgICAgICAgICAgIHRpbWVyOwoKICAgICAgICBp
bmRleCA9IGZpbmRUaHJvdHRsZXIodGFyZ2V0LCBtZXRob2QpOwogICAgICAgIGlmIChpbmRleCA+
IC0xKSB7IHJldHVybiB0aHJvdHRsZXJzW2luZGV4XTsgfSAvLyB0aHJvdHRsZWQKCiAgICAgICAg
dGltZXIgPSBnbG9iYWwuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIHNlbGYucnVu
LmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgICAgIHZhciBpbmRleCA9IGZpbmRUaHJvdHRsZXIo
dGFyZ2V0LCBtZXRob2QpOwogICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsgdGhyb3R0bGVycy5z
cGxpY2UoaW5kZXgsIDEpOyB9CiAgICAgICAgfSwgd2FpdCk7CgogICAgICAgIHRocm90dGxlciA9
IFt0YXJnZXQsIG1ldGhvZCwgdGltZXJdOwoKICAgICAgICB0aHJvdHRsZXJzLnB1c2godGhyb3R0
bGVyKTsKCiAgICAgICAgcmV0dXJuIHRocm90dGxlcjsKICAgICAgfSwKCiAgICAgIGRlYm91bmNl
OiBmdW5jdGlvbih0YXJnZXQsIG1ldGhvZCAvKiAsIGFyZ3MsIHdhaXQsIFtpbW1lZGlhdGVdICov
KSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgICAgICBhcmdzID0gYXJndW1lbnRz
LAogICAgICAgICAgICBpbW1lZGlhdGUgPSBwb3AuY2FsbChhcmdzKSwKICAgICAgICAgICAgd2Fp
dCwKICAgICAgICAgICAgaW5kZXgsCiAgICAgICAgICAgIGRlYm91bmNlZSwKICAgICAgICAgICAg
dGltZXI7CgogICAgICAgIGlmICh0eXBlb2YgaW1tZWRpYXRlID09PSAibnVtYmVyIiB8fCB0eXBl
b2YgaW1tZWRpYXRlID09PSAic3RyaW5nIikgewogICAgICAgICAgd2FpdCA9IGltbWVkaWF0ZTsK
ICAgICAgICAgIGltbWVkaWF0ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3
YWl0ID0gcG9wLmNhbGwoYXJncyk7CiAgICAgICAgfQoKICAgICAgICB3YWl0ID0gcGFyc2VJbnQo
d2FpdCwgMTApOwogICAgICAgIC8vIFJlbW92ZSBkZWJvdW5jZWUKICAgICAgICBpbmRleCA9IGZp
bmREZWJvdW5jZWUodGFyZ2V0LCBtZXRob2QpOwoKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewog
ICAgICAgICAgZGVib3VuY2VlID0gZGVib3VuY2Vlc1tpbmRleF07CiAgICAgICAgICBkZWJvdW5j
ZWVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2VlWzJd
KTsKICAgICAgICB9CgogICAgICAgIHRpbWVyID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24o
KSB7CiAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgICBzZWxmLnJ1bi5hcHBs
eShzZWxmLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpbmRleCA9IGZpbmREZWJv
dW5jZWUodGFyZ2V0LCBtZXRob2QpOwogICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAg
ICAgICAgZGVib3VuY2Vlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfQogICAgICAgIH0s
IHdhaXQpOwoKICAgICAgICBpZiAoaW1tZWRpYXRlICYmIGluZGV4ID09PSAtMSkgewogICAgICAg
ICAgc2VsZi5ydW4uYXBwbHkoc2VsZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBkZWJvdW5j
ZWUgPSBbdGFyZ2V0LCBtZXRob2QsIHRpbWVyXTsKCiAgICAgICAgZGVib3VuY2Vlcy5wdXNoKGRl
Ym91bmNlZSk7CgogICAgICAgIHJldHVybiBkZWJvdW5jZWU7CiAgICAgIH0sCgogICAgICBjYW5j
ZWxUaW1lcnM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpLCBsZW47CgogICAgICAgIGZvciAo
aSA9IDAsIGxlbiA9IHRocm90dGxlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAg
IGNsZWFyVGltZW91dCh0aHJvdHRsZXJzW2ldWzJdKTsKICAgICAgICB9CiAgICAgICAgdGhyb3R0
bGVycyA9IFtdOwoKICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBkZWJvdW5jZWVzLmxlbmd0aDsg
aSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2Vlc1tpXVsyXSk7
CiAgICAgICAgfQogICAgICAgIGRlYm91bmNlZXMgPSBbXTsKCiAgICAgICAgaWYgKGxhdGVyVGlt
ZXIpIHsKICAgICAgICAgIGNsZWFyVGltZW91dChsYXRlclRpbWVyKTsKICAgICAgICAgIGxhdGVy
VGltZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgICB0aW1lcnMgPSBbXTsKCiAgICAgICAgaWYg
KGF1dG9ydW4pIHsKICAgICAgICAgIGNsZWFyVGltZW91dChhdXRvcnVuKTsKICAgICAgICAgIGF1
dG9ydW4gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGhhc1RpbWVyczogZnVuY3Rp
b24oKSB7CiAgICAgICAgcmV0dXJuICEhdGltZXJzLmxlbmd0aCB8fCBhdXRvcnVuOwogICAgICB9
LAoKICAgICAgY2FuY2VsOiBmdW5jdGlvbih0aW1lcikgewogICAgICAgIHZhciB0aW1lclR5cGUg
PSB0eXBlb2YgdGltZXI7CgogICAgICAgIGlmICh0aW1lciAmJiB0aW1lclR5cGUgPT09ICdvYmpl
Y3QnICYmIHRpbWVyLnF1ZXVlICYmIHRpbWVyLm1ldGhvZCkgeyAvLyB3ZSdyZSBjYW5jZWxsaW5n
IGEgZGVmZXJPbmNlCiAgICAgICAgICByZXR1cm4gdGltZXIucXVldWUuY2FuY2VsKHRpbWVyKTsK
ICAgICAgICB9IGVsc2UgaWYgKHRpbWVyVHlwZSA9PT0gJ2Z1bmN0aW9uJykgeyAvLyB3ZSdyZSBj
YW5jZWxsaW5nIGEgc2V0VGltZW91dAogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aW1l
cnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICAgIGlmICh0aW1lcnNbaSArIDFd
ID09PSB0aW1lcikgewogICAgICAgICAgICAgIHRpbWVycy5zcGxpY2UoaSwgMik7IC8vIHJlbW92
ZSB0aGUgdHdvIGVsZW1lbnRzCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAg
IH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy50b1N0cmluZy5jYWxsKHRp
bWVyKSA9PT0gIltvYmplY3QgQXJyYXldIil7IC8vIHdlJ3JlIGNhbmNlbGxpbmcgYSB0aHJvdHRs
ZSBvciBkZWJvdW5jZQogICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbEl0ZW0oZmluZFRocm90
dGxlciwgdGhyb3R0bGVycywgdGltZXIpIHx8IAogICAgICAgICAgICAgICAgICAgdGhpcy5fY2Fu
Y2VsSXRlbShmaW5kRGVib3VuY2VlLCBkZWJvdW5jZWVzLCB0aW1lcik7CiAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgIHJldHVybjsgLy8gdGltZXIgd2FzIG51bGwgb3Igbm90IGEgdGltZXIKICAg
ICAgICB9CiAgICAgIH0sCgogICAgICBfY2FuY2VsSXRlbTogZnVuY3Rpb24oZmluZE1ldGhvZCwg
YXJyYXksIHRpbWVyKXsKICAgICAgICB2YXIgaXRlbSwKICAgICAgICAgICAgaW5kZXg7CgogICAg
ICAgIGlmICh0aW1lci5sZW5ndGggPCAzKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICBpbmRl
eCA9IGZpbmRNZXRob2QodGltZXJbMF0sIHRpbWVyWzFdKTsKCiAgICAgICAgaWYoaW5kZXggPiAt
MSkgewoKICAgICAgICAgIGl0ZW0gPSBhcnJheVtpbmRleF07CgogICAgICAgICAgaWYoaXRlbVsy
XSA9PT0gdGltZXJbMl0pewogICAgICAgICAgICBhcnJheS5zcGxpY2UoaW5kZXgsIDEpOwogICAg
ICAgICAgICBjbGVhclRpbWVvdXQodGltZXJbMl0pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK
ICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAg
IH07CgogICAgQmFja2J1cm5lci5wcm90b3R5cGUuc2NoZWR1bGUgPSBCYWNrYnVybmVyLnByb3Rv
dHlwZS5kZWZlcjsKICAgIEJhY2tidXJuZXIucHJvdG90eXBlLnNjaGVkdWxlT25jZSA9IEJhY2ti
dXJuZXIucHJvdG90eXBlLmRlZmVyT25jZTsKICAgIEJhY2tidXJuZXIucHJvdG90eXBlLmxhdGVy
ID0gQmFja2J1cm5lci5wcm90b3R5cGUuc2V0VGltZW91dDsKCiAgICBmdW5jdGlvbiBjcmVhdGVB
dXRvcnVuKGJhY2tidXJuZXIpIHsKICAgICAgYmFja2J1cm5lci5iZWdpbigpOwogICAgICBhdXRv
cnVuID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgYXV0b3J1biA9IG51
bGw7CiAgICAgICAgYmFja2J1cm5lci5lbmQoKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rp
b24gdXBkYXRlTGF0ZXJUaW1lcihzZWxmLCBleGVjdXRlQXQsIHdhaXQpIHsKICAgICAgaWYgKCFs
YXRlclRpbWVyIHx8IGV4ZWN1dGVBdCA8IGxhdGVyVGltZXJFeHBpcmVzQXQpIHsKICAgICAgICBp
ZiAobGF0ZXJUaW1lcikgewogICAgICAgICAgY2xlYXJUaW1lb3V0KGxhdGVyVGltZXIpOwogICAg
ICAgIH0KICAgICAgICBsYXRlclRpbWVyID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7
CiAgICAgICAgICBsYXRlclRpbWVyID0gbnVsbDsKICAgICAgICAgIGxhdGVyVGltZXJFeHBpcmVz
QXQgPSBudWxsOwogICAgICAgICAgZXhlY3V0ZVRpbWVycyhzZWxmKTsKICAgICAgICB9LCB3YWl0
KTsKICAgICAgICBsYXRlclRpbWVyRXhwaXJlc0F0ID0gZXhlY3V0ZUF0OwogICAgICB9CiAgICB9
CgogICAgZnVuY3Rpb24gZXhlY3V0ZVRpbWVycyhzZWxmKSB7CiAgICAgIHZhciBub3cgPSArbmV3
IERhdGUoKSwKICAgICAgICAgIHRpbWUsIGZucywgaSwgbDsKCiAgICAgIHNlbGYucnVuKGZ1bmN0
aW9uKCkgewogICAgICAgIC8vIFRPRE86IGJpbmFyeSBzZWFyY2gKICAgICAgICBmb3IgKGkgPSAw
LCBsID0gdGltZXJzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgdGltZSA9IHRp
bWVyc1tpXTsKICAgICAgICAgIGlmICh0aW1lID4gbm93KSB7IGJyZWFrOyB9CiAgICAgICAgfQoK
ICAgICAgICBmbnMgPSB0aW1lcnMuc3BsaWNlKDAsIGkpOwoKICAgICAgICBmb3IgKGkgPSAxLCBs
ID0gZm5zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgc2VsZi5zY2hlZHVsZShz
ZWxmLm9wdGlvbnMuZGVmYXVsdFF1ZXVlLCBudWxsLCBmbnNbaV0pOwogICAgICAgIH0KICAgICAg
fSk7CgogICAgICBpZiAodGltZXJzLmxlbmd0aCkgewogICAgICAgIHVwZGF0ZUxhdGVyVGltZXIo
c2VsZiwgdGltZXJzWzBdLCB0aW1lcnNbMF0gLSBub3cpOwogICAgICB9CiAgICB9CgogICAgZnVu
Y3Rpb24gZmluZERlYm91bmNlZSh0YXJnZXQsIG1ldGhvZCkgewogICAgICB2YXIgZGVib3VuY2Vl
LAogICAgICAgICAgaW5kZXggPSAtMTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gZGVib3Vu
Y2Vlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBkZWJvdW5jZWUgPSBkZWJvdW5jZWVz
W2ldOwogICAgICAgIGlmIChkZWJvdW5jZWVbMF0gPT09IHRhcmdldCAmJiBkZWJvdW5jZWVbMV0g
PT09IG1ldGhvZCkgewogICAgICAgICAgaW5kZXggPSBpOwogICAgICAgICAgYnJlYWs7CiAgICAg
ICAgfQogICAgICB9CgogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gZmlu
ZFRocm90dGxlcih0YXJnZXQsIG1ldGhvZCkgewogICAgICB2YXIgdGhyb3R0bGVyLAogICAgICAg
ICAgaW5kZXggPSAtMTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhyb3R0bGVycy5sZW5n
dGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aHJvdHRsZXIgPSB0aHJvdHRsZXJzW2ldOwogICAg
ICAgIGlmICh0aHJvdHRsZXJbMF0gPT09IHRhcmdldCAmJiB0aHJvdHRsZXJbMV0gPT09IG1ldGhv
ZCkgewogICAgICAgICAgaW5kZXggPSBpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAg
ICB9CgogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CgoKICAgIF9fZXhwb3J0c19fLkJhY2tidXJu
ZXIgPSBCYWNrYnVybmVyOwogIH0pOwp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBvbkJlZ2lu
ID0gZnVuY3Rpb24oY3VycmVudCkgewogIEVtYmVyLnJ1bi5jdXJyZW50UnVuTG9vcCA9IGN1cnJl
bnQ7Cn07Cgp2YXIgb25FbmQgPSBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7CiAgRW1iZXIucnVu
LmN1cnJlbnRSdW5Mb29wID0gbmV4dDsKfTsKCnZhciBCYWNrYnVybmVyID0gcmVxdWlyZU1vZHVs
ZSgnYmFja2J1cm5lcicpLkJhY2tidXJuZXIsCiAgICBiYWNrYnVybmVyID0gbmV3IEJhY2tidXJu
ZXIoWydzeW5jJywgJ2FjdGlvbnMnLCAnZGVzdHJveSddLCB7CiAgICAgIHN5bmM6IHsKICAgICAg
ICBiZWZvcmU6IEVtYmVyLmJlZ2luUHJvcGVydHlDaGFuZ2VzLAogICAgICAgIGFmdGVyOiBFbWJl
ci5lbmRQcm9wZXJ0eUNoYW5nZXMKICAgICAgfSwKICAgICAgZGVmYXVsdFF1ZXVlOiAnYWN0aW9u
cycsCiAgICAgIG9uQmVnaW46IG9uQmVnaW4sCiAgICAgIG9uRW5kOiBvbkVuZAogICAgfSksCiAg
ICBzbGljZSA9IFtdLnNsaWNlOwoKLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgovLyBFbWJlci5ydW4gLSB0aGlzIGlzIGlkZWFsbHkg
dGhlIG9ubHkgcHVibGljIEFQSSB0aGUgZGV2IHNlZXMKLy8KCi8qKgogIFJ1bnMgdGhlIHBhc3Nl
ZCB0YXJnZXQgYW5kIG1ldGhvZCBpbnNpZGUgb2YgYSBSdW5Mb29wLCBlbnN1cmluZyBhbnkKICBk
ZWZlcnJlZCBhY3Rpb25zIGluY2x1ZGluZyBiaW5kaW5ncyBhbmQgdmlld3MgdXBkYXRlcyBhcmUg
Zmx1c2hlZCBhdCB0aGUKICBlbmQuCgogIE5vcm1hbGx5IHlvdSBzaG91bGQgbm90IG5lZWQgdG8g
aW52b2tlIHRoaXMgbWV0aG9kIHlvdXJzZWxmLiBIb3dldmVyIGlmCiAgeW91IGFyZSBpbXBsZW1l
bnRpbmcgcmF3IGV2ZW50IGhhbmRsZXJzIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBvdGhlcgogIGxp
YnJhcmllcyBvciBwbHVnaW5zLCB5b3Ugc2hvdWxkIHByb2JhYmx5IHdyYXAgYWxsIG9mIHlvdXIg
Y29kZSBpbnNpZGUgdGhpcwogIGNhbGwuCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5ydW4oZnVu
Y3Rpb24oKSB7CiAgICAvLyBjb2RlIHRvIGJlIGV4ZWN1dGUgd2l0aGluIGEgUnVuTG9vcAogIH0p
OwogIGBgYAoKICBAY2xhc3MgcnVuCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBzdGF0aWMKICBAY29u
c3RydWN0b3IKICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gdGFyZ2V0IG9mIG1ldGhvZCB0byBj
YWxsCiAgQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IG1ldGhvZCBNZXRob2QgdG8gaW52b2tlLgog
ICAgTWF5IGJlIGEgZnVuY3Rpb24gb3IgYSBzdHJpbmcuIElmIHlvdSBwYXNzIGEgc3RyaW5nCiAg
ICB0aGVuIGl0IHdpbGwgYmUgbG9va2VkIHVwIG9uIHRoZSBwYXNzZWQgdGFyZ2V0LgogIEBwYXJh
bSB7T2JqZWN0fSBbYXJncypdIEFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyB5b3Ugd2lzaCB0byBw
YXNzIHRvIHRoZSBtZXRob2QuCiAgQHJldHVybiB7T2JqZWN0fSByZXR1cm4gdmFsdWUgZnJvbSBp
bnZva2luZyB0aGUgcGFzc2VkIGZ1bmN0aW9uLgoqLwpFbWJlci5ydW4gPSBmdW5jdGlvbih0YXJn
ZXQsIG1ldGhvZCkgewogIHZhciByZXQ7CgogIGlmIChFbWJlci5vbmVycm9yKSB7CiAgICB0cnkg
ewogICAgICByZXQgPSBiYWNrYnVybmVyLnJ1bi5hcHBseShiYWNrYnVybmVyLCBhcmd1bWVudHMp
OwogICAgfSBjYXRjaCAoZSkgewogICAgICBFbWJlci5vbmVycm9yKGUpOwogICAgfQogIH0gZWxz
ZSB7CiAgICByZXQgPSBiYWNrYnVybmVyLnJ1bi5hcHBseShiYWNrYnVybmVyLCBhcmd1bWVudHMp
OwogIH0KCiAgcmV0dXJuIHJldDsKfTsKCi8qKgogIElmIG5vIHJ1bi1sb29wIGlzIHByZXNlbnQs
IGl0IGNyZWF0ZXMgYSBuZXcgb25lLiBJZiBhIHJ1biBsb29wIGlzCiAgcHJlc2VudCBpdCB3aWxs
IHF1ZXVlIGl0c2VsZiB0byBydW4gb24gdGhlIGV4aXN0aW5nIHJ1bi1sb29wcyBhY3Rpb24KICBx
dWV1ZS4KCiAgUGxlYXNlIG5vdGU6IFRoaXMgaXMgbm90IGZvciBub3JtYWwgdXNhZ2UsIGFuZCBz
aG91bGQgYmUgdXNlZCBzcGFyaW5nbHkuCgogIElmIGludm9rZWQgd2hlbiBub3Qgd2l0aGluIGEg
cnVuIGxvb3A6CgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5ydW4uam9pbihmdW5jdGlvbigpIHsK
ICAgIC8vIGNyZWF0ZXMgYSBuZXcgcnVuLWxvb3AKICB9KTsKICBgYGAKCiAgQWx0ZXJuYXRpdmVs
eSwgaWYgY2FsbGVkIHdpdGhpbiBhbiBleGlzdGluZyBydW4gbG9vcDoKCiAgYGBgamF2YXNjcmlw
dAogIEVtYmVyLnJ1bihmdW5jdGlvbigpIHsKICAgIC8vIGNyZWF0ZXMgYSBuZXcgcnVuLWxvb3AK
ICAgIEVtYmVyLnJ1bi5qb2luKGZ1bmN0aW9uKCkgewogICAgICAvLyBqb2lucyB3aXRoIHRoZSBl
eGlzdGluZyBydW4tbG9vcCwgYW5kIHF1ZXVlcyBmb3IgaW52b2NhdGlvbiBvbgogICAgICAvLyB0
aGUgZXhpc3RpbmcgcnVuLWxvb3BzIGFjdGlvbiBxdWV1ZS4KICAgIH0pOwogIH0pOwogIGBgYAoK
ICBAbWV0aG9kIGpvaW4KICBAbmFtZXNwYWNlIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IFt0YXJn
ZXRdIHRhcmdldCBvZiBtZXRob2QgdG8gY2FsbAogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBt
ZXRob2QgTWV0aG9kIHRvIGludm9rZS4KICAgIE1heSBiZSBhIGZ1bmN0aW9uIG9yIGEgc3RyaW5n
LiBJZiB5b3UgcGFzcyBhIHN0cmluZwogICAgdGhlbiBpdCB3aWxsIGJlIGxvb2tlZCB1cCBvbiB0
aGUgcGFzc2VkIHRhcmdldC4KICBAcGFyYW0ge09iamVjdH0gW2FyZ3MqXSBBbnkgYWRkaXRpb25h
bCBhcmd1bWVudHMgeW91IHdpc2ggdG8gcGFzcyB0byB0aGUgbWV0aG9kLgogIEByZXR1cm4ge09i
amVjdH0gUmV0dXJuIHZhbHVlIGZyb20gaW52b2tpbmcgdGhlIHBhc3NlZCBmdW5jdGlvbi4gUGxl
YXNlIG5vdGUsCiAgd2hlbiBjYWxsZWQgd2l0aGluIGFuIGV4aXN0aW5nIGxvb3AsIG5vIHJldHVy
biB2YWx1ZSBpcyBwb3NzaWJsZS4KKi8KRW1iZXIucnVuLmpvaW4gPSBmdW5jdGlvbih0YXJnZXQs
IG1ldGhvZCkgewogIGlmICghRW1iZXIucnVuLmN1cnJlbnRSdW5Mb29wKSB7CiAgICByZXR1cm4g
RW1iZXIucnVuLmFwcGx5KEVtYmVyLnJ1biwgYXJndW1lbnRzKTsKICB9CgogIHZhciBhcmdzID0g
c2xpY2UuY2FsbChhcmd1bWVudHMpOwogIGFyZ3MudW5zaGlmdCgnYWN0aW9ucycpOwogIEVtYmVy
LnJ1bi5zY2hlZHVsZS5hcHBseShFbWJlci5ydW4sIGFyZ3MpOwp9OwoKRW1iZXIucnVuLmJhY2ti
dXJuZXIgPSBiYWNrYnVybmVyOwoKdmFyIHJ1biA9IEVtYmVyLnJ1bjsKCkVtYmVyLnJ1bi5jdXJy
ZW50UnVuTG9vcCA9IG51bGw7CgpFbWJlci5ydW4ucXVldWVzID0gYmFja2J1cm5lci5xdWV1ZU5h
bWVzOwoKLyoqCiAgQmVnaW5zIGEgbmV3IFJ1bkxvb3AuIEFueSBkZWZlcnJlZCBhY3Rpb25zIGlu
dm9rZWQgYWZ0ZXIgdGhlIGJlZ2luIHdpbGwKICBiZSBidWZmZXJlZCB1bnRpbCB5b3UgaW52b2tl
IGEgbWF0Y2hpbmcgY2FsbCB0byBgRW1iZXIucnVuLmVuZCgpYC4gVGhpcyBpcwogIGEgbG93ZXIt
bGV2ZWwgd2F5IHRvIHVzZSBhIFJ1bkxvb3AgaW5zdGVhZCBvZiB1c2luZyBgRW1iZXIucnVuKClg
LgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIucnVuLmJlZ2luKCk7CiAgLy8gY29kZSB0byBiZSBl
eGVjdXRlIHdpdGhpbiBhIFJ1bkxvb3AKICBFbWJlci5ydW4uZW5kKCk7CiAgYGBgCgogIEBtZXRo
b2QgYmVnaW4KICBAcmV0dXJuIHt2b2lkfQoqLwpFbWJlci5ydW4uYmVnaW4gPSBmdW5jdGlvbigp
IHsKICBiYWNrYnVybmVyLmJlZ2luKCk7Cn07CgovKioKICBFbmRzIGEgUnVuTG9vcC4gVGhpcyBt
dXN0IGJlIGNhbGxlZCBzb21ldGltZSBhZnRlciB5b3UgY2FsbAogIGBFbWJlci5ydW4uYmVnaW4o
KWAgdG8gZmx1c2ggYW55IGRlZmVycmVkIGFjdGlvbnMuIFRoaXMgaXMgYSBsb3dlci1sZXZlbCB3
YXkKICB0byB1c2UgYSBSdW5Mb29wIGluc3RlYWQgb2YgdXNpbmcgYEVtYmVyLnJ1bigpYC4KCiAg
YGBgamF2YXNjcmlwdAogIEVtYmVyLnJ1bi5iZWdpbigpOwogIC8vIGNvZGUgdG8gYmUgZXhlY3V0
ZSB3aXRoaW4gYSBSdW5Mb29wCiAgRW1iZXIucnVuLmVuZCgpOwogIGBgYAoKICBAbWV0aG9kIGVu
ZAogIEByZXR1cm4ge3ZvaWR9CiovCkVtYmVyLnJ1bi5lbmQgPSBmdW5jdGlvbigpIHsKICBiYWNr
YnVybmVyLmVuZCgpOwp9OwoKLyoqCiAgQXJyYXkgb2YgbmFtZWQgcXVldWVzLiBUaGlzIGFycmF5
IGRldGVybWluZXMgdGhlIG9yZGVyIGluIHdoaWNoIHF1ZXVlcwogIGFyZSBmbHVzaGVkIGF0IHRo
ZSBlbmQgb2YgdGhlIFJ1bkxvb3AuIFlvdSBjYW4gZGVmaW5lIHlvdXIgb3duIHF1ZXVlcyBieQog
IHNpbXBseSBhZGRpbmcgdGhlIHF1ZXVlIG5hbWUgdG8gdGhpcyBhcnJheS4gTm9ybWFsbHkgeW91
IHNob3VsZCBub3QgbmVlZAogIHRvIGluc3BlY3Qgb3IgbW9kaWZ5IHRoaXMgcHJvcGVydHkuCgog
IEBwcm9wZXJ0eSBxdWV1ZXMKICBAdHlwZSBBcnJheQogIEBkZWZhdWx0IFsnc3luYycsICdhY3Rp
b25zJywgJ2Rlc3Ryb3knXQoqLwoKLyoqCiAgQWRkcyB0aGUgcGFzc2VkIHRhcmdldC9tZXRob2Qg
YW5kIGFueSBvcHRpb25hbCBhcmd1bWVudHMgdG8gdGhlIG5hbWVkCiAgcXVldWUgdG8gYmUgZXhl
Y3V0ZWQgYXQgdGhlIGVuZCBvZiB0aGUgUnVuTG9vcC4gSWYgeW91IGhhdmUgbm90IGFscmVhZHkK
ICBzdGFydGVkIGEgUnVuTG9vcCB3aGVuIGNhbGxpbmcgdGhpcyBtZXRob2Qgb25lIHdpbGwgYmUg
c3RhcnRlZCBmb3IgeW91CiAgYXV0b21hdGljYWxseS4KCiAgQXQgdGhlIGVuZCBvZiBhIFJ1bkxv
b3AsIGFueSBtZXRob2RzIHNjaGVkdWxlZCBpbiB0aGlzIHdheSB3aWxsIGJlIGludm9rZWQuCiAg
TWV0aG9kcyB3aWxsIGJlIGludm9rZWQgaW4gYW4gb3JkZXIgbWF0Y2hpbmcgdGhlIG5hbWVkIHF1
ZXVlcyBkZWZpbmVkIGluCiAgdGhlIGBFbWJlci5ydW4ucXVldWVzYCBwcm9wZXJ0eS4KCiAgYGBg
amF2YXNjcmlwdAogIEVtYmVyLnJ1bi5zY2hlZHVsZSgnc3luYycsIHRoaXMsIGZ1bmN0aW9uKCkg
ewogICAgLy8gdGhpcyB3aWxsIGJlIGV4ZWN1dGVkIGluIHRoZSBmaXJzdCBSdW5Mb29wIHF1ZXVl
LCB3aGVuIGJpbmRpbmdzIGFyZSBzeW5jZWQKICAgIGNvbnNvbGUubG9nKCJzY2hlZHVsZWQgb24g
c3luYyBxdWV1ZSIpOwogIH0pOwoKICBFbWJlci5ydW4uc2NoZWR1bGUoJ2FjdGlvbnMnLCB0aGlz
LCBmdW5jdGlvbigpIHsKICAgIC8vIHRoaXMgd2lsbCBiZSBleGVjdXRlZCBpbiB0aGUgJ2FjdGlv
bnMnIHF1ZXVlLCBhZnRlciBiaW5kaW5ncyBoYXZlIHN5bmNlZC4KICAgIGNvbnNvbGUubG9nKCJz
Y2hlZHVsZWQgb24gYWN0aW9ucyBxdWV1ZSIpOwogIH0pOwoKICAvLyBOb3RlIHRoZSBmdW5jdGlv
bnMgd2lsbCBiZSBydW4gaW4gb3JkZXIgYmFzZWQgb24gdGhlIHJ1biBxdWV1ZXMgb3JkZXIuCiAg
Ly8gT3V0cHV0IHdvdWxkIGJlOgogIC8vICAgc2NoZWR1bGVkIG9uIHN5bmMgcXVldWUKICAvLyAg
IHNjaGVkdWxlZCBvbiBhY3Rpb25zIHF1ZXVlCiAgYGBgCgogIEBtZXRob2Qgc2NoZWR1bGUKICBA
cGFyYW0ge1N0cmluZ30gcXVldWUgVGhlIG5hbWUgb2YgdGhlIHF1ZXVlIHRvIHNjaGVkdWxlIGFn
YWluc3QuCiAgICBEZWZhdWx0IHF1ZXVlcyBhcmUgJ3N5bmMnIGFuZCAnYWN0aW9ucycKICBAcGFy
YW0ge09iamVjdH0gW3RhcmdldF0gdGFyZ2V0IG9iamVjdCB0byB1c2UgYXMgdGhlIGNvbnRleHQg
d2hlbiBpbnZva2luZyBhIG1ldGhvZC4KICBAcGFyYW0ge1N0cmluZ3xGdW5jdGlvbn0gbWV0aG9k
IFRoZSBtZXRob2QgdG8gaW52b2tlLiBJZiB5b3UgcGFzcyBhIHN0cmluZyBpdAogICAgd2lsbCBi
ZSByZXNvbHZlZCBvbiB0aGUgdGFyZ2V0IG9iamVjdCBhdCB0aGUgdGltZSB0aGUgc2NoZWR1bGVk
IGl0ZW0gaXMKICAgIGludm9rZWQgYWxsb3dpbmcgeW91IHRvIGNoYW5nZSB0aGUgdGFyZ2V0IGZ1
bmN0aW9uLgogIEBwYXJhbSB7T2JqZWN0fSBbYXJndW1lbnRzKl0gT3B0aW9uYWwgYXJndW1lbnRz
IHRvIGJlIHBhc3NlZCB0byB0aGUgcXVldWVkIG1ldGhvZC4KICBAcmV0dXJuIHt2b2lkfQoqLwpF
bWJlci5ydW4uc2NoZWR1bGUgPSBmdW5jdGlvbihxdWV1ZSwgdGFyZ2V0LCBtZXRob2QpIHsKICBj
aGVja0F1dG9SdW4oKTsKICBiYWNrYnVybmVyLnNjaGVkdWxlLmFwcGx5KGJhY2tidXJuZXIsIGFy
Z3VtZW50cyk7Cn07CgovLyBVc2VkIGJ5IGdsb2JhbCB0ZXN0IHRlYXJkb3duCkVtYmVyLnJ1bi5o
YXNTY2hlZHVsZWRUaW1lcnMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gYmFja2J1cm5lci5oYXNU
aW1lcnMoKTsKfTsKCi8vIFVzZWQgYnkgZ2xvYmFsIHRlc3QgdGVhcmRvd24KRW1iZXIucnVuLmNh
bmNlbFRpbWVycyA9IGZ1bmN0aW9uICgpIHsKICBiYWNrYnVybmVyLmNhbmNlbFRpbWVycygpOwp9
OwoKLyoqCiAgSW1tZWRpYXRlbHkgZmx1c2hlcyBhbnkgZXZlbnRzIHNjaGVkdWxlZCBpbiB0aGUg
J3N5bmMnIHF1ZXVlLiBCaW5kaW5ncwogIHVzZSB0aGlzIHF1ZXVlIHNvIHRoaXMgbWV0aG9kIGlz
IGEgdXNlZnVsIHdheSB0byBpbW1lZGlhdGVseSBmb3JjZSBhbGwKICBiaW5kaW5ncyBpbiB0aGUg
YXBwbGljYXRpb24gdG8gc3luYy4KCiAgWW91IHNob3VsZCBjYWxsIHRoaXMgbWV0aG9kIGFueXRp
bWUgeW91IG5lZWQgYW55IGNoYW5nZWQgc3RhdGUgdG8gcHJvcGFnYXRlCiAgdGhyb3VnaG91dCB0
aGUgYXBwIGltbWVkaWF0ZWx5IHdpdGhvdXQgcmVwYWludGluZyB0aGUgVUkgKHdoaWNoIGhhcHBl
bnMKICBpbiB0aGUgbGF0ZXIgJ3JlbmRlcicgcXVldWUgYWRkZWQgYnkgdGhlIGBlbWJlci12aWV3
c2AgcGFja2FnZSkuCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5ydW4uc3luYygpOwogIGBgYAoK
ICBAbWV0aG9kIHN5bmMKICBAcmV0dXJuIHt2b2lkfQoqLwpFbWJlci5ydW4uc3luYyA9IGZ1bmN0
aW9uKCkgewogIGlmIChiYWNrYnVybmVyLmN1cnJlbnRJbnN0YW5jZSkgewogICAgYmFja2J1cm5l
ci5jdXJyZW50SW5zdGFuY2UucXVldWVzLnN5bmMuZmx1c2goKTsKICB9Cn07CgovKioKICBJbnZv
a2VzIHRoZSBwYXNzZWQgdGFyZ2V0L21ldGhvZCBhbmQgb3B0aW9uYWwgYXJndW1lbnRzIGFmdGVy
IGEgc3BlY2lmaWVkCiAgcGVyaW9kIGlmIHRpbWUuIFRoZSBsYXN0IHBhcmFtZXRlciBvZiB0aGlz
IG1ldGhvZCBtdXN0IGFsd2F5cyBiZSBhIG51bWJlcgogIG9mIG1pbGxpc2Vjb25kcy4KCiAgWW91
IHNob3VsZCB1c2UgdGhpcyBtZXRob2Qgd2hlbmV2ZXIgeW91IG5lZWQgdG8gcnVuIHNvbWUgYWN0
aW9uIGFmdGVyIGEKICBwZXJpb2Qgb2YgdGltZSBpbnN0ZWFkIG9mIHVzaW5nIGBzZXRUaW1lb3V0
KClgLiBUaGlzIG1ldGhvZCB3aWxsIGVuc3VyZSB0aGF0CiAgaXRlbXMgdGhhdCBleHBpcmUgZHVy
aW5nIHRoZSBzYW1lIHNjcmlwdCBleGVjdXRpb24gY3ljbGUgYWxsIGV4ZWN1dGUKICB0b2dldGhl
ciwgd2hpY2ggaXMgb2Z0ZW4gbW9yZSBlZmZpY2llbnQgdGhhbiB1c2luZyBhIHJlYWwgc2V0VGlt
ZW91dC4KCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLnJ1bi5sYXRlcihteUNvbnRleHQsIGZ1bmN0
aW9uKCkgewogICAgLy8gY29kZSBoZXJlIHdpbGwgZXhlY3V0ZSB3aXRoaW4gYSBSdW5Mb29wIGlu
IGFib3V0IDUwMG1zIHdpdGggdGhpcyA9PSBteUNvbnRleHQKICB9LCA1MDApOwogIGBgYAoKICBA
bWV0aG9kIGxhdGVyCiAgQHBhcmFtIHtPYmplY3R9IFt0YXJnZXRdIHRhcmdldCBvZiBtZXRob2Qg
dG8gaW52b2tlCiAgQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IG1ldGhvZCBUaGUgbWV0aG9kIHRv
IGludm9rZS4KICAgIElmIHlvdSBwYXNzIGEgc3RyaW5nIGl0IHdpbGwgYmUgcmVzb2x2ZWQgb24g
dGhlCiAgICB0YXJnZXQgYXQgdGhlIHRpbWUgdGhlIG1ldGhvZCBpcyBpbnZva2VkLgogIEBwYXJh
bSB7T2JqZWN0fSBbYXJncypdIE9wdGlvbmFsIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSB0aW1l
b3V0LgogIEBwYXJhbSB7TnVtYmVyfSB3YWl0IE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2Fp
dC4KICBAcmV0dXJuIHtTdHJpbmd9IGEgc3RyaW5nIHlvdSBjYW4gdXNlIHRvIGNhbmNlbCB0aGUg
dGltZXIgaW4KICAgIGBFbWJlci5ydW4uY2FuY2VsYCBsYXRlci4KKi8KRW1iZXIucnVuLmxhdGVy
ID0gZnVuY3Rpb24odGFyZ2V0LCBtZXRob2QpIHsKICByZXR1cm4gYmFja2J1cm5lci5sYXRlci5h
cHBseShiYWNrYnVybmVyLCBhcmd1bWVudHMpOwp9OwoKLyoqCiAgU2NoZWR1bGUgYSBmdW5jdGlv
biB0byBydW4gb25lIHRpbWUgZHVyaW5nIHRoZSBjdXJyZW50IFJ1bkxvb3AuIFRoaXMgaXMgZXF1
aXZhbGVudAogIHRvIGNhbGxpbmcgYHNjaGVkdWxlT25jZWAgd2l0aCB0aGUgImFjdGlvbnMiIHF1
ZXVlLgoKICBAbWV0aG9kIG9uY2UKICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIHRhcmdl
dCBvZiB0aGUgbWV0aG9kIHRvIGludm9rZS4KICBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gbWV0
aG9kIFRoZSBtZXRob2QgdG8gaW52b2tlLgogICAgSWYgeW91IHBhc3MgYSBzdHJpbmcgaXQgd2ls
bCBiZSByZXNvbHZlZCBvbiB0aGUKICAgIHRhcmdldCBhdCB0aGUgdGltZSB0aGUgbWV0aG9kIGlz
IGludm9rZWQuCiAgQHBhcmFtIHtPYmplY3R9IFthcmdzKl0gT3B0aW9uYWwgYXJndW1lbnRzIHRv
IHBhc3MgdG8gdGhlIHRpbWVvdXQuCiAgQHJldHVybiB7T2JqZWN0fSB0aW1lcgoqLwpFbWJlci5y
dW4ub25jZSA9IGZ1bmN0aW9uKHRhcmdldCwgbWV0aG9kKSB7CiAgY2hlY2tBdXRvUnVuKCk7CiAg
dmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgYXJncy51bnNoaWZ0KCdhY3Rpb25z
Jyk7CiAgcmV0dXJuIGJhY2tidXJuZXIuc2NoZWR1bGVPbmNlLmFwcGx5KGJhY2tidXJuZXIsIGFy
Z3MpOwp9OwoKLyoqCiAgU2NoZWR1bGVzIGEgZnVuY3Rpb24gdG8gcnVuIG9uZSB0aW1lIGluIGEg
Z2l2ZW4gcXVldWUgb2YgdGhlIGN1cnJlbnQgUnVuTG9vcC4KICBDYWxsaW5nIHRoaXMgbWV0aG9k
IHdpdGggdGhlIHNhbWUgcXVldWUvdGFyZ2V0L21ldGhvZCBjb21iaW5hdGlvbiB3aWxsIGhhdmUK
ICBubyBlZmZlY3QgKHBhc3QgdGhlIGluaXRpYWwgY2FsbCkuCgogIE5vdGUgdGhhdCBhbHRob3Vn
aCB5b3UgY2FuIHBhc3Mgb3B0aW9uYWwgYXJndW1lbnRzIHRoZXNlIHdpbGwgbm90IGJlCiAgY29u
c2lkZXJlZCB3aGVuIGxvb2tpbmcgZm9yIGR1cGxpY2F0ZXMuIE5ldyBhcmd1bWVudHMgd2lsbCBy
ZXBsYWNlIHByZXZpb3VzCiAgY2FsbHMuCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5ydW4oZnVu
Y3Rpb24oKSB7CiAgICB2YXIgc2F5SGkgPSBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2hpJyk7
IH0KICAgIEVtYmVyLnJ1bi5zY2hlZHVsZU9uY2UoJ2FmdGVyUmVuZGVyJywgbXlDb250ZXh0LCBz
YXlIaSk7CiAgICBFbWJlci5ydW4uc2NoZWR1bGVPbmNlKCdhZnRlclJlbmRlcicsIG15Q29udGV4
dCwgc2F5SGkpOwogICAgLy8gc2F5SGkgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIG9uY2UsIGluIHRo
ZSBhZnRlclJlbmRlciBxdWV1ZSBvZiB0aGUgUnVuTG9vcAogIH0pOwogIGBgYAoKICBBbHNvIG5v
dGUgdGhhdCBwYXNzaW5nIGFuIGFub255bW91cyBmdW5jdGlvbiB0byBgRW1iZXIucnVuLnNjaGVk
dWxlT25jZWAgd2lsbAogIG5vdCBwcmV2ZW50IGFkZGl0aW9uYWwgY2FsbHMgd2l0aCBhbiBpZGVu
dGljYWwgYW5vbnltb3VzIGZ1bmN0aW9uIGZyb20KICBzY2hlZHVsaW5nIHRoZSBpdGVtcyBtdWx0
aXBsZSB0aW1lcywgZS5nLjoKCiAgYGBgamF2YXNjcmlwdAogIGZ1bmN0aW9uIHNjaGVkdWxlSXQo
KSB7CiAgICBFbWJlci5ydW4uc2NoZWR1bGVPbmNlKCdhY3Rpb25zJywgbXlDb250ZXh0LCBmdW5j
dGlvbigpIHsgY29uc29sZS5sb2coIkNsb3N1cmUiKTsgfSk7CiAgfQogIHNjaGVkdWxlSXQoKTsK
ICBzY2hlZHVsZUl0KCk7CiAgLy8gIkNsb3N1cmUiIHdpbGwgcHJpbnQgdHdpY2UsIGV2ZW4gdGhv
dWdoIHdlJ3JlIHVzaW5nIGBFbWJlci5ydW4uc2NoZWR1bGVPbmNlYCwKICAvLyBiZWNhdXNlIHRo
ZSBmdW5jdGlvbiB3ZSBwYXNzIHRvIGl0IGlzIGFub255bW91cyBhbmQgd29uJ3QgbWF0Y2ggdGhl
CiAgLy8gcHJldmlvdXNseSBzY2hlZHVsZWQgb3BlcmF0aW9uLgogIGBgYAoKICBBdmFpbGFibGUg
cXVldWVzLCBhbmQgdGhlaXIgb3JkZXIsIGNhbiBiZSBmb3VuZCBhdCBgRW1iZXIucnVuLnF1ZXVl
c2AKCiAgQG1ldGhvZCBzY2hlZHVsZU9uY2UKICBAcGFyYW0ge1N0cmluZ30gW3F1ZXVlXSBUaGUg
bmFtZSBvZiB0aGUgcXVldWUgdG8gc2NoZWR1bGUgYWdhaW5zdC4gRGVmYXVsdCBxdWV1ZXMgYXJl
ICdzeW5jJyBhbmQgJ2FjdGlvbnMnLgogIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSBUaGUgdGFy
Z2V0IG9mIHRoZSBtZXRob2QgdG8gaW52b2tlLgogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBt
ZXRob2QgVGhlIG1ldGhvZCB0byBpbnZva2UuCiAgICBJZiB5b3UgcGFzcyBhIHN0cmluZyBpdCB3
aWxsIGJlIHJlc29sdmVkIG9uIHRoZQogICAgdGFyZ2V0IGF0IHRoZSB0aW1lIHRoZSBtZXRob2Qg
aXMgaW52b2tlZC4KICBAcGFyYW0ge09iamVjdH0gW2FyZ3MqXSBPcHRpb25hbCBhcmd1bWVudHMg
dG8gcGFzcyB0byB0aGUgdGltZW91dC4KICBAcmV0dXJuIHtPYmplY3R9IHRpbWVyCiovCkVtYmVy
LnJ1bi5zY2hlZHVsZU9uY2UgPSBmdW5jdGlvbihxdWV1ZSwgdGFyZ2V0LCBtZXRob2QpIHsKICBj
aGVja0F1dG9SdW4oKTsKICByZXR1cm4gYmFja2J1cm5lci5zY2hlZHVsZU9uY2UuYXBwbHkoYmFj
a2J1cm5lciwgYXJndW1lbnRzKTsKfTsKCi8qKgogIFNjaGVkdWxlcyBhbiBpdGVtIHRvIHJ1biBm
cm9tIHdpdGhpbiBhIHNlcGFyYXRlIHJ1biBsb29wLCBhZnRlcgogIGNvbnRyb2wgaGFzIGJlZW4g
cmV0dXJuZWQgdG8gdGhlIHN5c3RlbS4gVGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmcKICBg
RW1iZXIucnVuLmxhdGVyYCB3aXRoIGEgd2FpdCB0aW1lIG9mIDFtcy4KCiAgYGBgamF2YXNjcmlw
dAogIEVtYmVyLnJ1bi5uZXh0KG15Q29udGV4dCwgZnVuY3Rpb24oKSB7CiAgICAvLyBjb2RlIHRv
IGJlIGV4ZWN1dGVkIGluIHRoZSBuZXh0IHJ1biBsb29wLAogICAgLy8gd2hpY2ggd2lsbCBiZSBz
Y2hlZHVsZWQgYWZ0ZXIgdGhlIGN1cnJlbnQgb25lCiAgfSk7CiAgYGBgCgogIE11bHRpcGxlIG9w
ZXJhdGlvbnMgc2NoZWR1bGVkIHdpdGggYEVtYmVyLnJ1bi5uZXh0YCB3aWxsIGNvYWxlc2NlCiAg
aW50byB0aGUgc2FtZSBsYXRlciBydW4gbG9vcCwgYWxvbmcgd2l0aCBhbnkgb3RoZXIgb3BlcmF0
aW9ucwogIHNjaGVkdWxlZCBieSBgRW1iZXIucnVuLmxhdGVyYCB0aGF0IGV4cGlyZSByaWdodCBh
cm91bmQgdGhlIHNhbWUKICB0aW1lIHRoYXQgYEVtYmVyLnJ1bi5uZXh0YCBvcGVyYXRpb25zIHdp
bGwgZmlyZS4KCiAgTm90ZSB0aGF0IHRoZXJlIGFyZSBvZnRlbiBhbHRlcm5hdGl2ZXMgdG8gdXNp
bmcgYEVtYmVyLnJ1bi5uZXh0YC4KICBGb3IgaW5zdGFuY2UsIGlmIHlvdSdkIGxpa2UgdG8gc2No
ZWR1bGUgYW4gb3BlcmF0aW9uIHRvIGhhcHBlbgogIGFmdGVyIGFsbCBET00gZWxlbWVudCBvcGVy
YXRpb25zIGhhdmUgY29tcGxldGVkIHdpdGhpbiB0aGUgY3VycmVudAogIHJ1biBsb29wLCB5b3Ug
Y2FuIG1ha2UgdXNlIG9mIHRoZSBgYWZ0ZXJSZW5kZXJgIHJ1biBsb29wIHF1ZXVlIChhZGRlZAog
IGJ5IHRoZSBgZW1iZXItdmlld3NgIHBhY2thZ2UsIGFsb25nIHdpdGggdGhlIHByZWNlZGluZyBg
cmVuZGVyYCBxdWV1ZQogIHdoZXJlIGFsbCB0aGUgRE9NIGVsZW1lbnQgb3BlcmF0aW9ucyBoYXBw
ZW4pLiBFeGFtcGxlOgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLk15Q29sbGVjdGlvblZpZXcgPSBF
bWJlci5Db2xsZWN0aW9uVmlldy5leHRlbmQoewogICAgZGlkSW5zZXJ0RWxlbWVudDogZnVuY3Rp
b24oKSB7CiAgICAgIEVtYmVyLnJ1bi5zY2hlZHVsZU9uY2UoJ2FmdGVyUmVuZGVyJywgdGhpcywg
J3Byb2Nlc3NDaGlsZEVsZW1lbnRzJyk7CiAgICB9LAogICAgcHJvY2Vzc0NoaWxkRWxlbWVudHM6
IGZ1bmN0aW9uKCkgewogICAgICAvLyAuLi4gZG8gc29tZXRoaW5nIHdpdGggY29sbGVjdGlvblZp
ZXcncyBjaGlsZCB2aWV3CiAgICAgIC8vIGVsZW1lbnRzIGFmdGVyIHRoZXkndmUgZmluaXNoZWQg
cmVuZGVyaW5nLCB3aGljaAogICAgICAvLyBjYW4ndCBiZSBkb25lIHdpdGhpbiB0aGUgQ29sbGVj
dGlvblZpZXcncwogICAgICAvLyBgZGlkSW5zZXJ0RWxlbWVudGAgaG9vayBiZWNhdXNlIHRoYXQg
Z2V0cyBydW4KICAgICAgLy8gYmVmb3JlIHRoZSBjaGlsZCBlbGVtZW50cyBoYXZlIGJlZW4gYWRk
ZWQgdG8gdGhlIERPTS4KICAgIH0KICB9KTsKICBgYGAKCiAgT25lIGJlbmVmaXQgb2YgdGhlIGFi
b3ZlIGFwcHJvYWNoIGNvbXBhcmVkIHRvIHVzaW5nIGBFbWJlci5ydW4ubmV4dGAgaXMKICB0aGF0
IHlvdSB3aWxsIGJlIGFibGUgdG8gcGVyZm9ybSBET00vQ1NTIG9wZXJhdGlvbnMgYmVmb3JlIHVu
cHJvY2Vzc2VkCiAgZWxlbWVudHMgYXJlIHJlbmRlcmVkIHRvIHRoZSBzY3JlZW4sIHdoaWNoIG1h
eSBwcmV2ZW50IGZsaWNrZXJpbmcgb3IKICBvdGhlciBhcnRpZmFjdHMgY2F1c2VkIGJ5IGRlbGF5
aW5nIHByb2Nlc3NpbmcgdW50aWwgYWZ0ZXIgcmVuZGVyaW5nLgoKICBUaGUgb3RoZXIgbWFqb3Ig
YmVuZWZpdCB0byB0aGUgYWJvdmUgYXBwcm9hY2ggaXMgdGhhdCBgRW1iZXIucnVuLm5leHRgCiAg
aW50cm9kdWNlcyBhbiBlbGVtZW50IG9mIG5vbi1kZXRlcm1pbmlzbSwgd2hpY2ggY2FuIG1ha2Ug
dGhpbmdzIG11Y2gKICBoYXJkZXIgdG8gdGVzdCwgZHVlIHRvIGl0cyByZWxpYW5jZSBvbiBgc2V0
VGltZW91dGA7IGl0J3MgbXVjaCBoYXJkZXIKICB0byBndWFyYW50ZWUgdGhlIG9yZGVyIG9mIHNj
aGVkdWxlZCBvcGVyYXRpb25zIHdoZW4gdGhleSBhcmUgc2NoZWR1bGVkCiAgb3V0c2lkZSBvZiB0
aGUgY3VycmVudCBydW4gbG9vcCwgaS5lLiB3aXRoIGBFbWJlci5ydW4ubmV4dGAuCgogIEBtZXRo
b2QgbmV4dAogIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSB0YXJnZXQgb2YgbWV0aG9kIHRvIGlu
dm9rZQogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBtZXRob2QgVGhlIG1ldGhvZCB0byBpbnZv
a2UuCiAgICBJZiB5b3UgcGFzcyBhIHN0cmluZyBpdCB3aWxsIGJlIHJlc29sdmVkIG9uIHRoZQog
ICAgdGFyZ2V0IGF0IHRoZSB0aW1lIHRoZSBtZXRob2QgaXMgaW52b2tlZC4KICBAcGFyYW0ge09i
amVjdH0gW2FyZ3MqXSBPcHRpb25hbCBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgdGltZW91dC4K
ICBAcmV0dXJuIHtPYmplY3R9IHRpbWVyCiovCkVtYmVyLnJ1bi5uZXh0ID0gZnVuY3Rpb24oKSB7
CiAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgYXJncy5wdXNoKDEpOwogIHJl
dHVybiBiYWNrYnVybmVyLmxhdGVyLmFwcGx5KGJhY2tidXJuZXIsIGFyZ3MpOwp9OwoKLyoqCiAg
Q2FuY2VscyBhIHNjaGVkdWxlZCBpdGVtLiBNdXN0IGJlIGEgdmFsdWUgcmV0dXJuZWQgYnkgYEVt
YmVyLnJ1bi5sYXRlcigpYCwKICBgRW1iZXIucnVuLm9uY2UoKWAsIG9yIGBFbWJlci5ydW4ubmV4
dCgpYC4KCiAgYGBgamF2YXNjcmlwdAogIHZhciBydW5OZXh0ID0gRW1iZXIucnVuLm5leHQobXlD
b250ZXh0LCBmdW5jdGlvbigpIHsKICAgIC8vIHdpbGwgbm90IGJlIGV4ZWN1dGVkCiAgfSk7CiAg
RW1iZXIucnVuLmNhbmNlbChydW5OZXh0KTsKCiAgdmFyIHJ1bkxhdGVyID0gRW1iZXIucnVuLmxh
dGVyKG15Q29udGV4dCwgZnVuY3Rpb24oKSB7CiAgICAvLyB3aWxsIG5vdCBiZSBleGVjdXRlZAog
IH0sIDUwMCk7CiAgRW1iZXIucnVuLmNhbmNlbChydW5MYXRlcik7CgogIHZhciBydW5PbmNlID0g
RW1iZXIucnVuLm9uY2UobXlDb250ZXh0LCBmdW5jdGlvbigpIHsKICAgIC8vIHdpbGwgbm90IGJl
IGV4ZWN1dGVkCiAgfSk7CiAgRW1iZXIucnVuLmNhbmNlbChydW5PbmNlKTsKICBgYGAKCiAgQG1l
dGhvZCBjYW5jZWwKICBAcGFyYW0ge09iamVjdH0gdGltZXIgVGltZXIgb2JqZWN0IHRvIGNhbmNl
bAogIEByZXR1cm4ge3ZvaWR9CiovCkVtYmVyLnJ1bi5jYW5jZWwgPSBmdW5jdGlvbih0aW1lcikg
ewogIHJldHVybiBiYWNrYnVybmVyLmNhbmNlbCh0aW1lcik7Cn07CgovKioKICBEZWxheSBjYWxs
aW5nIHRoZSB0YXJnZXQgbWV0aG9kIHVudGlsIHRoZSBkZWJvdW5jZSBwZXJpb2QgaGFzIGVsYXBz
ZWQKICB3aXRoIG5vIGFkZGl0aW9uYWwgZGVib3VuY2UgY2FsbHMuIElmIGBkZWJvdW5jZWAgaXMg
Y2FsbGVkIGFnYWluIGJlZm9yZQogIHRoZSBzcGVjaWZpZWQgdGltZSBoYXMgZWxhcHNlZCwgdGhl
IHRpbWVyIGlzIHJlc2V0IGFuZCB0aGUgZW50aXJlIHBlcmlvZAogIG11c3QgcGFzcyBhZ2FpbiBi
ZWZvcmUgdGhlIHRhcmdldCBtZXRob2QgaXMgY2FsbGVkLgoKICBUaGlzIG1ldGhvZCBzaG91bGQg
YmUgdXNlZCB3aGVuIGFuIGV2ZW50IG1heSBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMKICBidXQg
dGhlIGFjdGlvbiBzaG91bGQgb25seSBiZSBjYWxsZWQgb25jZSB3aGVuIHRoZSBldmVudCBpcyBk
b25lIGZpcmluZy4KICBBIGNvbW1vbiBleGFtcGxlIGlzIGZvciBzY3JvbGwgZXZlbnRzIHdoZXJl
IHlvdSBvbmx5IHdhbnQgdXBkYXRlcyB0bwogIGhhcHBlbiBvbmNlIHNjcm9sbGluZyBoYXMgY2Vh
c2VkLgoKICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgbXlGdW5jID0gZnVuY3Rpb24oKSB7IGNvbnNv
bGUubG9nKHRoaXMubmFtZSArICcgcmFuLicpOyB9OwogICAgdmFyIG15Q29udGV4dCA9IHtuYW1l
OiAnZGVib3VuY2UnfTsKCiAgICBFbWJlci5ydW4uZGVib3VuY2UobXlDb250ZXh0LCBteUZ1bmMs
IDE1MCk7CgogICAgLy8gbGVzcyB0aGFuIDE1MG1zIHBhc3NlcwoKICAgIEVtYmVyLnJ1bi5kZWJv
dW5jZShteUNvbnRleHQsIG15RnVuYywgMTUwKTsKCiAgICAvLyAxNTBtcyBwYXNzZXMKICAgIC8v
IG15RnVuYyBpcyBpbnZva2VkIHdpdGggY29udGV4dCBteUNvbnRleHQKICAgIC8vIGNvbnNvbGUg
bG9ncyAnZGVib3VuY2UgcmFuLicgb25lIHRpbWUuCiAgYGBgCgogIEBtZXRob2QgZGVib3VuY2UK
ICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gdGFyZ2V0IG9mIG1ldGhvZCB0byBpbnZva2UKICBA
cGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gbWV0aG9kIFRoZSBtZXRob2QgdG8gaW52b2tlLgogICAg
TWF5IGJlIGEgZnVuY3Rpb24gb3IgYSBzdHJpbmcuIElmIHlvdSBwYXNzIGEgc3RyaW5nCiAgICB0
aGVuIGl0IHdpbGwgYmUgbG9va2VkIHVwIG9uIHRoZSBwYXNzZWQgdGFyZ2V0LgogIEBwYXJhbSB7
T2JqZWN0fSBbYXJncypdIE9wdGlvbmFsIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSB0aW1lb3V0
LgogIEBwYXJhbSB7TnVtYmVyfSB3YWl0IE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdC4K
ICBAcGFyYW0ge0Jvb2xlYW59IGltbWVkaWF0ZSBUcmlnZ2VyIHRoZSBmdW5jdGlvbiBvbiB0aGUg
bGVhZGluZyBpbnN0ZWFkIG9mIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB3YWl0IGludGVydmFs
LgogIEByZXR1cm4ge3ZvaWR9CiovCkVtYmVyLnJ1bi5kZWJvdW5jZSA9IGZ1bmN0aW9uKCkgewog
IHJldHVybiBiYWNrYnVybmVyLmRlYm91bmNlLmFwcGx5KGJhY2tidXJuZXIsIGFyZ3VtZW50cyk7
Cn07CgovKioKICBFbnN1cmUgdGhhdCB0aGUgdGFyZ2V0IG1ldGhvZCBpcyBuZXZlciBjYWxsZWQg
bW9yZSBmcmVxdWVudGx5IHRoYW4KICB0aGUgc3BlY2lmaWVkIHNwYWNpbmcgcGVyaW9kLgoKICBg
YGBqYXZhc2NyaXB0CiAgICB2YXIgbXlGdW5jID0gZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKHRo
aXMubmFtZSArICcgcmFuLicpOyB9OwogICAgdmFyIG15Q29udGV4dCA9IHtuYW1lOiAndGhyb3R0
bGUnfTsKCiAgICBFbWJlci5ydW4udGhyb3R0bGUobXlDb250ZXh0LCBteUZ1bmMsIDE1MCk7Cgog
ICAgLy8gNTBtcyBwYXNzZXMKICAgIEVtYmVyLnJ1bi50aHJvdHRsZShteUNvbnRleHQsIG15RnVu
YywgMTUwKTsKCiAgICAvLyA1MG1zIHBhc3NlcwogICAgRW1iZXIucnVuLnRocm90dGxlKG15Q29u
dGV4dCwgbXlGdW5jLCAxNTApOwoKICAgIC8vIDUwbXMgcGFzc2VzCiAgICBFbWJlci5ydW4udGhy
b3R0bGUobXlDb250ZXh0LCBteUZ1bmMsIDE1MCk7CgogICAgLy8gMTUwbXMgcGFzc2VzCiAgICAv
LyBteUZ1bmMgaXMgaW52b2tlZCB3aXRoIGNvbnRleHQgbXlDb250ZXh0CiAgICAvLyBjb25zb2xl
IGxvZ3MgJ3Rocm90dGxlIHJhbi4nIHR3aWNlLCAxNTBtcyBhcGFydC4KICBgYGAKCiAgQG1ldGhv
ZCB0aHJvdHRsZQogIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSB0YXJnZXQgb2YgbWV0aG9kIHRv
IGludm9rZQogIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBtZXRob2QgVGhlIG1ldGhvZCB0byBp
bnZva2UuCiAgICBNYXkgYmUgYSBmdW5jdGlvbiBvciBhIHN0cmluZy4gSWYgeW91IHBhc3MgYSBz
dHJpbmcKICAgIHRoZW4gaXQgd2lsbCBiZSBsb29rZWQgdXAgb24gdGhlIHBhc3NlZCB0YXJnZXQu
CiAgQHBhcmFtIHtPYmplY3R9IFthcmdzKl0gT3B0aW9uYWwgYXJndW1lbnRzIHRvIHBhc3MgdG8g
dGhlIHRpbWVvdXQuCiAgQHBhcmFtIHtOdW1iZXJ9IHNwYWNpbmcgTnVtYmVyIG9mIG1pbGxpc2Vj
b25kcyB0byBzcGFjZSBvdXQgcmVxdWVzdHMuCiAgQHJldHVybiB7dm9pZH0KKi8KRW1iZXIucnVu
LnRocm90dGxlID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIGJhY2tidXJuZXIudGhyb3R0bGUuYXBw
bHkoYmFja2J1cm5lciwgYXJndW1lbnRzKTsKfTsKCi8vIE1ha2Ugc3VyZSBpdCdzIG5vdCBhbiBh
dXRvcnVuIGR1cmluZyB0ZXN0aW5nCmZ1bmN0aW9uIGNoZWNrQXV0b1J1bigpIHsKICBpZiAoIUVt
YmVyLnJ1bi5jdXJyZW50UnVuTG9vcCkgewogICAgRW1iZXIuYXNzZXJ0KCJZb3UgaGF2ZSB0dXJu
ZWQgb24gdGVzdGluZyBtb2RlLCB3aGljaCBkaXNhYmxlZCB0aGUgcnVuLWxvb3AncyBhdXRvcnVu
LiBZb3Ugd2lsbCBuZWVkIHRvIHdyYXAgYW55IGNvZGUgd2l0aCBhc3luY2hyb25vdXMgc2lkZS1l
ZmZlY3RzIGluIGFuIEVtYmVyLnJ1biIsICFFbWJlci50ZXN0aW5nKTsKICB9Cn0KCn0pKCk7CgoK
CihmdW5jdGlvbigpIHsKLy8gRW1iZXIuTG9nZ2VyCi8vIGdldAovLyBzZXQKLy8gZ3VpZEZvciwg
bWV0YQovLyBhZGRPYnNlcnZlciwgcmVtb3ZlT2JzZXJ2ZXIKLy8gRW1iZXIucnVuLnNjaGVkdWxl
Ci8qKgpAbW9kdWxlIGVtYmVyLW1ldGFsCiovCgovLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCi8vIENPTlNUQU5UUwovLwoKLyoqCiAg
RGVidWcgcGFyYW1ldGVyIHlvdSBjYW4gdHVybiBvbi4gVGhpcyB3aWxsIGxvZyBhbGwgYmluZGlu
Z3MgdGhhdCBmaXJlIHRvCiAgdGhlIGNvbnNvbGUuIFRoaXMgc2hvdWxkIGJlIGRpc2FibGVkIGlu
IHByb2R1Y3Rpb24gY29kZS4gTm90ZSB0aGF0IHlvdQogIGNhbiBhbHNvIGVuYWJsZSB0aGlzIGZy
b20gdGhlIGNvbnNvbGUgb3IgdGVtcG9yYXJpbHkuCgogIEBwcm9wZXJ0eSBMT0dfQklORElOR1MK
ICBAZm9yIEVtYmVyCiAgQHR5cGUgQm9vbGVhbgogIEBkZWZhdWx0IGZhbHNlCiovCkVtYmVyLkxP
R19CSU5ESU5HUyA9IGZhbHNlIHx8ICEhRW1iZXIuRU5WLkxPR19CSU5ESU5HUzsKCnZhciBnZXQg
ICAgID0gRW1iZXIuZ2V0LAogICAgc2V0ICAgICA9IEVtYmVyLnNldCwKICAgIGd1aWRGb3IgPSBF
bWJlci5ndWlkRm9yLAogICAgSVNfR0xPQkFMID0gL14oW0EtWiRdfChbMC05XVtBLVokXSkpLzsK
Ci8qKgogIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgcGF0aCBpcyBnbG9iYWwgKGUuZy4s
IGBNeUFwcC5mb29Db250cm9sbGVyLmJhcmApCiAgaW5zdGVhZCBvZiBsb2NhbCAoYGZvby5iYXIu
YmF6YCkuCgogIEBtZXRob2QgaXNHbG9iYWxQYXRoCiAgQGZvciBFbWJlcgogIEBwcml2YXRlCiAg
QHBhcmFtIHtTdHJpbmd9IHBhdGgKICBAcmV0dXJuIEJvb2xlYW4KKi8KdmFyIGlzR2xvYmFsUGF0
aCA9IEVtYmVyLmlzR2xvYmFsUGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICByZXR1cm4gSVNfR0xP
QkFMLnRlc3QocGF0aCk7Cn07CgpmdW5jdGlvbiBnZXRXaXRoR2xvYmFscyhvYmosIHBhdGgpIHsK
ICByZXR1cm4gZ2V0KGlzR2xvYmFsUGF0aChwYXRoKSA/IEVtYmVyLmxvb2t1cCA6IG9iaiwgcGF0
aCk7Cn0KCi8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4KLy8gQklORElORwovLwoKdmFyIEJpbmRpbmcgPSBmdW5jdGlvbih0b1BhdGgs
IGZyb21QYXRoKSB7CiAgdGhpcy5fZGlyZWN0aW9uID0gJ2Z3ZCc7CiAgdGhpcy5fZnJvbSA9IGZy
b21QYXRoOwogIHRoaXMuX3RvICAgPSB0b1BhdGg7CiAgdGhpcy5fZGlyZWN0aW9uTWFwID0gRW1i
ZXIuTWFwLmNyZWF0ZSgpOwp9OwoKLyoqCkBjbGFzcyBCaW5kaW5nCkBuYW1lc3BhY2UgRW1iZXIK
Ki8KCkJpbmRpbmcucHJvdG90eXBlID0gewogIC8qKgogICAgVGhpcyBjb3BpZXMgdGhlIEJpbmRp
bmcgc28gaXQgY2FuIGJlIGNvbm5lY3RlZCB0byBhbm90aGVyIG9iamVjdC4KCiAgICBAbWV0aG9k
IGNvcHkKICAgIEByZXR1cm4ge0VtYmVyLkJpbmRpbmd9IGB0aGlzYAogICovCiAgY29weTogZnVu
Y3Rpb24gKCkgewogICAgdmFyIGNvcHkgPSBuZXcgQmluZGluZyh0aGlzLl90bywgdGhpcy5fZnJv
bSk7CiAgICBpZiAodGhpcy5fb25lV2F5KSB7IGNvcHkuX29uZVdheSA9IHRydWU7IH0KICAgIHJl
dHVybiBjb3B5OwogIH0sCgogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyBDT05GSUcKICAvLwoKICAvKioKICAgIFRoaXMg
d2lsbCBzZXQgYGZyb21gIHByb3BlcnR5IHBhdGggdG8gdGhlIHNwZWNpZmllZCB2YWx1ZS4gSXQg
d2lsbCBub3QKICAgIGF0dGVtcHQgdG8gcmVzb2x2ZSB0aGlzIHByb3BlcnR5IHBhdGggdG8gYW4g
YWN0dWFsIG9iamVjdCB1bnRpbCB5b3UKICAgIGNvbm5lY3QgdGhlIGJpbmRpbmcuCgogICAgVGhl
IGJpbmRpbmcgd2lsbCBzZWFyY2ggZm9yIHRoZSBwcm9wZXJ0eSBwYXRoIHN0YXJ0aW5nIGF0IHRo
ZSByb290IG9iamVjdAogICAgeW91IHBhc3Mgd2hlbiB5b3UgYGNvbm5lY3QoKWAgdGhlIGJpbmRp
bmcuIEl0IGZvbGxvd3MgdGhlIHNhbWUgcnVsZXMgYXMKICAgIGBnZXQoKWAgLSBzZWUgdGhhdCBt
ZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgQG1ldGhvZCBmcm9tCiAgICBAcGFyYW0g
e1N0cmluZ30gcGF0aCB0aGUgcHJvcGVydHkgcGF0aCB0byBjb25uZWN0IHRvCiAgICBAcmV0dXJu
IHtFbWJlci5CaW5kaW5nfSBgdGhpc2AKICAqLwogIGZyb206IGZ1bmN0aW9uKHBhdGgpIHsKICAg
IHRoaXMuX2Zyb20gPSBwYXRoOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBUaGlz
IHdpbGwgc2V0IHRoZSBgdG9gIHByb3BlcnR5IHBhdGggdG8gdGhlIHNwZWNpZmllZCB2YWx1ZS4g
SXQgd2lsbCBub3QKICAgIGF0dGVtcHQgdG8gcmVzb2x2ZSB0aGlzIHByb3BlcnR5IHBhdGggdG8g
YW4gYWN0dWFsIG9iamVjdCB1bnRpbCB5b3UKICAgIGNvbm5lY3QgdGhlIGJpbmRpbmcuCgogICAg
VGhlIGJpbmRpbmcgd2lsbCBzZWFyY2ggZm9yIHRoZSBwcm9wZXJ0eSBwYXRoIHN0YXJ0aW5nIGF0
IHRoZSByb290IG9iamVjdAogICAgeW91IHBhc3Mgd2hlbiB5b3UgYGNvbm5lY3QoKWAgdGhlIGJp
bmRpbmcuIEl0IGZvbGxvd3MgdGhlIHNhbWUgcnVsZXMgYXMKICAgIGBnZXQoKWAgLSBzZWUgdGhh
dCBtZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgQG1ldGhvZCB0bwogICAgQHBhcmFt
IHtTdHJpbmd8VHVwbGV9IHBhdGggQSBwcm9wZXJ0eSBwYXRoIG9yIHR1cGxlCiAgICBAcmV0dXJu
IHtFbWJlci5CaW5kaW5nfSBgdGhpc2AKICAqLwogIHRvOiBmdW5jdGlvbihwYXRoKSB7CiAgICB0
aGlzLl90byA9IHBhdGg7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgIENvbmZpZ3Vy
ZXMgdGhlIGJpbmRpbmcgYXMgb25lIHdheS4gQSBvbmUtd2F5IGJpbmRpbmcgd2lsbCByZWxheSBj
aGFuZ2VzCiAgICBvbiB0aGUgYGZyb21gIHNpZGUgdG8gdGhlIGB0b2Agc2lkZSwgYnV0IG5vdCB0
aGUgb3RoZXIgd2F5IGFyb3VuZC4gVGhpcwogICAgbWVhbnMgdGhhdCBpZiB5b3UgY2hhbmdlIHRo
ZSBgdG9gIHNpZGUgZGlyZWN0bHksIHRoZSBgZnJvbWAgc2lkZSBtYXkgaGF2ZQogICAgYSBkaWZm
ZXJlbnQgdmFsdWUuCgogICAgQG1ldGhvZCBvbmVXYXkKICAgIEByZXR1cm4ge0VtYmVyLkJpbmRp
bmd9IGB0aGlzYAogICovCiAgb25lV2F5OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX29uZVdheSA9
IHRydWU7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgIEBtZXRob2QgdG9TdHJpbmcK
ICAgIEByZXR1cm4ge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGJpbmRpbmcKICAq
LwogIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgIHZhciBvbmVXYXkgPSB0aGlzLl9vbmVXYXkg
PyAnW29uZVdheV0nIDogJyc7CiAgICByZXR1cm4gIkVtYmVyLkJpbmRpbmc8IiArIGd1aWRGb3Io
dGhpcykgKyAiPigiICsgdGhpcy5fZnJvbSArICIgLT4gIiArIHRoaXMuX3RvICsgIikiICsgb25l
V2F5OwogIH0sCgogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4KICAvLyBDT05ORUNUIEFORCBTWU5DCiAgLy8KCiAgLyoqCiAgICBB
dHRlbXB0cyB0byBjb25uZWN0IHRoaXMgYmluZGluZyBpbnN0YW5jZSBzbyB0aGF0IGl0IGNhbiBy
ZWNlaXZlIGFuZCByZWxheQogICAgY2hhbmdlcy4gVGhpcyBtZXRob2Qgd2lsbCByYWlzZSBhbiBl
eGNlcHRpb24gaWYgeW91IGhhdmUgbm90IHNldCB0aGUKICAgIGZyb20vdG8gcHJvcGVydGllcyB5
ZXQuCgogICAgQG1ldGhvZCBjb25uZWN0CiAgICBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSByb290
IG9iamVjdCBmb3IgdGhpcyBiaW5kaW5nLgogICAgQHJldHVybiB7RW1iZXIuQmluZGluZ30gYHRo
aXNgCiAgKi8KICBjb25uZWN0OiBmdW5jdGlvbihvYmopIHsKICAgIEVtYmVyLmFzc2VydCgnTXVz
dCBwYXNzIGEgdmFsaWQgb2JqZWN0IHRvIEVtYmVyLkJpbmRpbmcuY29ubmVjdCgpJywgISFvYmop
OwoKICAgIHZhciBmcm9tUGF0aCA9IHRoaXMuX2Zyb20sIHRvUGF0aCA9IHRoaXMuX3RvOwogICAg
RW1iZXIudHJ5U2V0KG9iaiwgdG9QYXRoLCBnZXRXaXRoR2xvYmFscyhvYmosIGZyb21QYXRoKSk7
CgogICAgLy8gYWRkIGFuIG9ic2VydmVyIG9uIHRoZSBvYmplY3QgdG8gYmUgbm90aWZpZWQgd2hl
biB0aGUgYmluZGluZyBzaG91bGQgYmUgdXBkYXRlZAogICAgRW1iZXIuYWRkT2JzZXJ2ZXIob2Jq
LCBmcm9tUGF0aCwgdGhpcywgdGhpcy5mcm9tRGlkQ2hhbmdlKTsKCiAgICAvLyBpZiB0aGUgYmlu
ZGluZyBpcyBhIHR3by13YXkgYmluZGluZywgYWxzbyBzZXQgdXAgYW4gb2JzZXJ2ZXIgb24gdGhl
IHRhcmdldAogICAgaWYgKCF0aGlzLl9vbmVXYXkpIHsgRW1iZXIuYWRkT2JzZXJ2ZXIob2JqLCB0
b1BhdGgsIHRoaXMsIHRoaXMudG9EaWRDaGFuZ2UpOyB9CgogICAgdGhpcy5fcmVhZHlUb1N5bmMg
PSB0cnVlOwoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgRGlzY29ubmVjdHMgdGhl
IGJpbmRpbmcgaW5zdGFuY2UuIENoYW5nZXMgd2lsbCBubyBsb25nZXIgYmUgcmVsYXllZC4gWW91
CiAgICB3aWxsIG5vdCB1c3VhbGx5IG5lZWQgdG8gY2FsbCB0aGlzIG1ldGhvZC4KCiAgICBAbWV0
aG9kIGRpc2Nvbm5lY3QKICAgIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIHJvb3Qgb2JqZWN0IHlv
dSBwYXNzZWQgd2hlbiBjb25uZWN0aW5nIHRoZSBiaW5kaW5nLgogICAgQHJldHVybiB7RW1iZXIu
QmluZGluZ30gYHRoaXNgCiAgKi8KICBkaXNjb25uZWN0OiBmdW5jdGlvbihvYmopIHsKICAgIEVt
YmVyLmFzc2VydCgnTXVzdCBwYXNzIGEgdmFsaWQgb2JqZWN0IHRvIEVtYmVyLkJpbmRpbmcuZGlz
Y29ubmVjdCgpJywgISFvYmopOwoKICAgIHZhciB0d29XYXkgPSAhdGhpcy5fb25lV2F5OwoKICAg
IC8vIHJlbW92ZSBhbiBvYnNlcnZlciBvbiB0aGUgb2JqZWN0IHNvIHdlJ3JlIG5vIGxvbmdlciBu
b3RpZmllZCBvZgogICAgLy8gY2hhbmdlcyB0aGF0IHNob3VsZCB1cGRhdGUgYmluZGluZ3MuCiAg
ICBFbWJlci5yZW1vdmVPYnNlcnZlcihvYmosIHRoaXMuX2Zyb20sIHRoaXMsIHRoaXMuZnJvbURp
ZENoYW5nZSk7CgogICAgLy8gaWYgdGhlIGJpbmRpbmcgaXMgdHdvLXdheSwgcmVtb3ZlIHRoZSBv
YnNlcnZlciBmcm9tIHRoZSB0YXJnZXQgYXMgd2VsbAogICAgaWYgKHR3b1dheSkgeyBFbWJlci5y
ZW1vdmVPYnNlcnZlcihvYmosIHRoaXMuX3RvLCB0aGlzLCB0aGlzLnRvRGlkQ2hhbmdlKTsgfQoK
ICAgIHRoaXMuX3JlYWR5VG9TeW5jID0gZmFsc2U7IC8vIGRpc2FibGUgc2NoZWR1bGVkIHN5bmNz
Li4uCiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgLy8gUFJJVkFURQogIC8vCgogIC8q
IGNhbGxlZCB3aGVuIHRoZSBmcm9tIHNpZGUgY2hhbmdlcyAqLwogIGZyb21EaWRDaGFuZ2U6IGZ1
bmN0aW9uKHRhcmdldCkgewogICAgdGhpcy5fc2NoZWR1bGVTeW5jKHRhcmdldCwgJ2Z3ZCcpOwog
IH0sCgogIC8qIGNhbGxlZCB3aGVuIHRoZSB0byBzaWRlIGNoYW5nZXMgKi8KICB0b0RpZENoYW5n
ZTogZnVuY3Rpb24odGFyZ2V0KSB7CiAgICB0aGlzLl9zY2hlZHVsZVN5bmModGFyZ2V0LCAnYmFj
aycpOwogIH0sCgogIF9zY2hlZHVsZVN5bmM6IGZ1bmN0aW9uKG9iaiwgZGlyKSB7CiAgICB2YXIg
ZGlyZWN0aW9uTWFwID0gdGhpcy5fZGlyZWN0aW9uTWFwOwogICAgdmFyIGV4aXN0aW5nRGlyID0g
ZGlyZWN0aW9uTWFwLmdldChvYmopOwoKICAgIC8vIGlmIHdlIGhhdmVuJ3Qgc2NoZWR1bGVkIHRo
ZSBiaW5kaW5nIHlldCwgc2NoZWR1bGUgaXQKICAgIGlmICghZXhpc3RpbmdEaXIpIHsKICAgICAg
RW1iZXIucnVuLnNjaGVkdWxlKCdzeW5jJywgdGhpcywgdGhpcy5fc3luYywgb2JqKTsKICAgICAg
ZGlyZWN0aW9uTWFwLnNldChvYmosIGRpcik7CiAgICB9CgogICAgLy8gSWYgYm90aCBhICdiYWNr
JyBhbmQgJ2Z3ZCcgc3luYyBoYXZlIGJlZW4gc2NoZWR1bGVkIG9uIHRoZSBzYW1lIG9iamVjdCwK
ICAgIC8vIGRlZmF1bHQgdG8gYSAnZndkJyBzeW5jIHNvIHRoYXQgaXQgcmVtYWlucyBkZXRlcm1p
bmlzdGljLgogICAgaWYgKGV4aXN0aW5nRGlyID09PSAnYmFjaycgJiYgZGlyID09PSAnZndkJykg
ewogICAgICBkaXJlY3Rpb25NYXAuc2V0KG9iaiwgJ2Z3ZCcpOwogICAgfQogIH0sCgogIF9zeW5j
OiBmdW5jdGlvbihvYmopIHsKICAgIHZhciBsb2cgPSBFbWJlci5MT0dfQklORElOR1M7CgogICAg
Ly8gZG9uJ3Qgc3luY2hyb25pemUgZGVzdHJveWVkIG9iamVjdHMgb3IgZGlzY29ubmVjdGVkIGJp
bmRpbmdzCiAgICBpZiAob2JqLmlzRGVzdHJveWVkIHx8ICF0aGlzLl9yZWFkeVRvU3luYykgeyBy
ZXR1cm47IH0KCiAgICAvLyBnZXQgdGhlIGRpcmVjdGlvbiBvZiB0aGUgYmluZGluZyBmb3IgdGhl
IG9iamVjdCB3ZSBhcmUKICAgIC8vIHN5bmNocm9uaXppbmcgZnJvbQogICAgdmFyIGRpcmVjdGlv
bk1hcCA9IHRoaXMuX2RpcmVjdGlvbk1hcDsKICAgIHZhciBkaXJlY3Rpb24gPSBkaXJlY3Rpb25N
YXAuZ2V0KG9iaik7CgogICAgdmFyIGZyb21QYXRoID0gdGhpcy5fZnJvbSwgdG9QYXRoID0gdGhp
cy5fdG87CgogICAgZGlyZWN0aW9uTWFwLnJlbW92ZShvYmopOwoKICAgIC8vIGlmIHdlJ3JlIHN5
bmNocm9uaXppbmcgZnJvbSB0aGUgcmVtb3RlIG9iamVjdC4uLgogICAgaWYgKGRpcmVjdGlvbiA9
PT0gJ2Z3ZCcpIHsKICAgICAgdmFyIGZyb21WYWx1ZSA9IGdldFdpdGhHbG9iYWxzKG9iaiwgdGhp
cy5fZnJvbSk7CiAgICAgIGlmIChsb2cpIHsKICAgICAgICBFbWJlci5Mb2dnZXIubG9nKCcgJywg
dGhpcy50b1N0cmluZygpLCAnLT4nLCBmcm9tVmFsdWUsIG9iaik7CiAgICAgIH0KICAgICAgaWYg
KHRoaXMuX29uZVdheSkgewogICAgICAgIEVtYmVyLnRyeVNldChvYmosIHRvUGF0aCwgZnJvbVZh
bHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBFbWJlci5fc3VzcGVuZE9ic2VydmVyKG9iaiwg
dG9QYXRoLCB0aGlzLCB0aGlzLnRvRGlkQ2hhbmdlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBF
bWJlci50cnlTZXQob2JqLCB0b1BhdGgsIGZyb21WYWx1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0K
ICAgIC8vIGlmIHdlJ3JlIHN5bmNocm9uaXppbmcgKnRvKiB0aGUgcmVtb3RlIG9iamVjdAogICAg
fSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdiYWNrJykgewogICAgICB2YXIgdG9WYWx1ZSA9IGdl
dChvYmosIHRoaXMuX3RvKTsKICAgICAgaWYgKGxvZykgewogICAgICAgIEVtYmVyLkxvZ2dlci5s
b2coJyAnLCB0aGlzLnRvU3RyaW5nKCksICc8LScsIHRvVmFsdWUsIG9iaik7CiAgICAgIH0KICAg
ICAgRW1iZXIuX3N1c3BlbmRPYnNlcnZlcihvYmosIGZyb21QYXRoLCB0aGlzLCB0aGlzLmZyb21E
aWRDaGFuZ2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICBFbWJlci50cnlTZXQoRW1iZXIuaXNHbG9i
YWxQYXRoKGZyb21QYXRoKSA/IEVtYmVyLmxvb2t1cCA6IG9iaiwgZnJvbVBhdGgsIHRvVmFsdWUp
OwogICAgICB9KTsKICAgIH0KICB9Cgp9OwoKZnVuY3Rpb24gbWl4aW5Qcm9wZXJ0aWVzKHRvLCBm
cm9tKSB7CiAgZm9yICh2YXIga2V5IGluIGZyb20pIHsKICAgIGlmIChmcm9tLmhhc093blByb3Bl
cnR5KGtleSkpIHsKICAgICAgdG9ba2V5XSA9IGZyb21ba2V5XTsKICAgIH0KICB9Cn0KCm1peGlu
UHJvcGVydGllcyhCaW5kaW5nLCB7CgogIC8qCiAgICBTZWUgYEVtYmVyLkJpbmRpbmcuZnJvbWAu
CgogICAgQG1ldGhvZCBmcm9tCiAgICBAc3RhdGljCiAgKi8KICBmcm9tOiBmdW5jdGlvbigpIHsK
ICAgIHZhciBDID0gdGhpcywgYmluZGluZyA9IG5ldyBDKCk7CiAgICByZXR1cm4gYmluZGluZy5m
cm9tLmFwcGx5KGJpbmRpbmcsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoKICAgIFNlZSBgRW1iZXIu
QmluZGluZy50b2AuCgogICAgQG1ldGhvZCB0bwogICAgQHN0YXRpYwogICovCiAgdG86IGZ1bmN0
aW9uKCkgewogICAgdmFyIEMgPSB0aGlzLCBiaW5kaW5nID0gbmV3IEMoKTsKICAgIHJldHVybiBi
aW5kaW5nLnRvLmFwcGx5KGJpbmRpbmcsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgICBDcmVh
dGVzIGEgbmV3IEJpbmRpbmcgaW5zdGFuY2UgYW5kIG1ha2VzIGl0IGFwcGx5IGluIGEgc2luZ2xl
IGRpcmVjdGlvbi4KICAgIEEgb25lLXdheSBiaW5kaW5nIHdpbGwgcmVsYXkgY2hhbmdlcyBvbiB0
aGUgYGZyb21gIHNpZGUgb2JqZWN0IChzdXBwbGllZAogICAgYXMgdGhlIGBmcm9tYCBhcmd1bWVu
dCkgdGhlIGB0b2Agc2lkZSwgYnV0IG5vdCB0aGUgb3RoZXIgd2F5IGFyb3VuZC4KICAgIFRoaXMg
bWVhbnMgdGhhdCBpZiB5b3UgY2hhbmdlIHRoZSAidG8iIHNpZGUgZGlyZWN0bHksIHRoZSAiZnJv
bSIgc2lkZSBtYXkgaGF2ZQogICAgYSBkaWZmZXJlbnQgdmFsdWUuCgogICAgU2VlIGBCaW5kaW5n
Lm9uZVdheWAuCgogICAgQG1ldGhvZCBvbmVXYXkKICAgIEBwYXJhbSB7U3RyaW5nfSBmcm9tIGZy
b20gcGF0aC4KICAgIEBwYXJhbSB7Qm9vbGVhbn0gW2ZsYWddIChPcHRpb25hbCkgcGFzc2luZyBu
b3RoaW5nIGhlcmUgd2lsbCBtYWtlIHRoZQogICAgICBiaW5kaW5nIGBvbmVXYXlgLiBZb3UgY2Fu
IGluc3RlYWQgcGFzcyBgZmFsc2VgIHRvIGRpc2FibGUgYG9uZVdheWAsIG1ha2luZyB0aGUKICAg
ICAgYmluZGluZyB0d28gd2F5IGFnYWluLgogICAgQHJldHVybiB7RW1iZXIuQmluZGluZ30gYHRo
aXNgCiAgKi8KICBvbmVXYXk6IGZ1bmN0aW9uKGZyb20sIGZsYWcpIHsKICAgIHZhciBDID0gdGhp
cywgYmluZGluZyA9IG5ldyBDKG51bGwsIGZyb20pOwogICAgcmV0dXJuIGJpbmRpbmcub25lV2F5
KGZsYWcpOwogIH0KCn0pOwoKLyoqCiAgQW4gYEVtYmVyLkJpbmRpbmdgIGNvbm5lY3RzIHRoZSBw
cm9wZXJ0aWVzIG9mIHR3byBvYmplY3RzIHNvIHRoYXQgd2hlbmV2ZXIKICB0aGUgdmFsdWUgb2Yg
b25lIHByb3BlcnR5IGNoYW5nZXMsIHRoZSBvdGhlciBwcm9wZXJ0eSB3aWxsIGJlIGNoYW5nZWQg
YWxzby4KCiAgIyMgQXV0b21hdGljIENyZWF0aW9uIG9mIEJpbmRpbmdzIHdpdGggYC9eKkJpbmRp
bmcvYC1uYW1lZCBQcm9wZXJ0aWVzCgogIFlvdSBkbyBub3QgdXN1YWxseSBjcmVhdGUgQmluZGlu
ZyBvYmplY3RzIGRpcmVjdGx5IGJ1dCBpbnN0ZWFkIGRlc2NyaWJlCiAgYmluZGluZ3MgaW4geW91
ciBjbGFzcyBvciBvYmplY3QgZGVmaW5pdGlvbiB1c2luZyBhdXRvbWF0aWMgYmluZGluZwogIGRl
dGVjdGlvbi4KCiAgUHJvcGVydGllcyBlbmRpbmcgaW4gYSBgQmluZGluZ2Agc3VmZml4IHdpbGwg
YmUgY29udmVydGVkIHRvIGBFbWJlci5CaW5kaW5nYAogIGluc3RhbmNlcy4gVGhlIHZhbHVlIG9m
IHRoaXMgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nIHJlcHJlc2VudGluZyBhIHBhdGgKICB0
byBhbm90aGVyIG9iamVjdCBvciBhIGN1c3RvbSBiaW5kaW5nIGluc3RhbmNlZCBjcmVhdGVkIHVz
aW5nIEJpbmRpbmcgaGVscGVycwogIChzZWUgIk9uZSBXYXkgQmluZGluZ3MiKToKCiAgYGBgCiAg
dmFsdWVCaW5kaW5nOiAiTXlBcHAuc29tZUNvbnRyb2xsZXIudGl0bGUiCiAgYGBgCgogIFRoaXMg
d2lsbCBjcmVhdGUgYSBiaW5kaW5nIGZyb20gYE15QXBwLnNvbWVDb250cm9sbGVyLnRpdGxlYCB0
byB0aGUgYHZhbHVlYAogIHByb3BlcnR5IG9mIHlvdXIgb2JqZWN0IGluc3RhbmNlIGF1dG9tYXRp
Y2FsbHkuIE5vdyB0aGUgdHdvIHZhbHVlcyB3aWxsIGJlCiAga2VwdCBpbiBzeW5jLgoKICAjIyBP
bmUgV2F5IEJpbmRpbmdzCgogIE9uZSBlc3BlY2lhbGx5IHVzZWZ1bCBiaW5kaW5nIGN1c3RvbWl6
YXRpb24geW91IGNhbiB1c2UgaXMgdGhlIGBvbmVXYXkoKWAKICBoZWxwZXIuIFRoaXMgaGVscGVy
IHRlbGxzIEVtYmVyIHRoYXQgeW91IGFyZSBvbmx5IGludGVyZXN0ZWQgaW4KICByZWNlaXZpbmcg
Y2hhbmdlcyBvbiB0aGUgb2JqZWN0IHlvdSBhcmUgYmluZGluZyBmcm9tLiBGb3IgZXhhbXBsZSwg
aWYgeW91CiAgYXJlIGJpbmRpbmcgdG8gYSBwcmVmZXJlbmNlIGFuZCB5b3Ugd2FudCB0byBiZSBu
b3RpZmllZCBpZiB0aGUgcHJlZmVyZW5jZQogIGhhcyBjaGFuZ2VkLCBidXQgeW91ciBvYmplY3Qg
d2lsbCBub3QgYmUgY2hhbmdpbmcgdGhlIHByZWZlcmVuY2UgaXRzZWxmLCB5b3UKICBjb3VsZCBk
bzoKCiAgYGBgCiAgYmlnVGl0bGVzQmluZGluZzogRW1iZXIuQmluZGluZy5vbmVXYXkoIk15QXBw
LnByZWZlcmVuY2VzQ29udHJvbGxlci5iaWdUaXRsZXMiKQogIGBgYAoKICBUaGlzIHdheSBpZiB0
aGUgdmFsdWUgb2YgYE15QXBwLnByZWZlcmVuY2VzQ29udHJvbGxlci5iaWdUaXRsZXNgIGNoYW5n
ZXMgdGhlCiAgYGJpZ1RpdGxlc2AgcHJvcGVydHkgb2YgeW91ciBvYmplY3Qgd2lsbCBjaGFuZ2Ug
YWxzby4gSG93ZXZlciwgaWYgeW91CiAgY2hhbmdlIHRoZSB2YWx1ZSBvZiB5b3VyIGBiaWdUaXRs
ZXNgIHByb3BlcnR5LCBpdCB3aWxsIG5vdCB1cGRhdGUgdGhlCiAgYHByZWZlcmVuY2VzQ29udHJv
bGxlcmAuCgogIE9uZSB3YXkgYmluZGluZ3MgYXJlIGFsbW9zdCB0d2ljZSBhcyBmYXN0IHRvIHNl
dHVwIGFuZCB0d2ljZSBhcyBmYXN0IHRvCiAgZXhlY3V0ZSBiZWNhdXNlIHRoZSBiaW5kaW5nIG9u
bHkgaGFzIHRvIHdvcnJ5IGFib3V0IGNoYW5nZXMgdG8gb25lIHNpZGUuCgogIFlvdSBzaG91bGQg
Y29uc2lkZXIgdXNpbmcgb25lIHdheSBiaW5kaW5ncyBhbnl0aW1lIHlvdSBoYXZlIGFuIG9iamVj
dCB0aGF0CiAgbWF5IGJlIGNyZWF0ZWQgZnJlcXVlbnRseSBhbmQgeW91IGRvIG5vdCBpbnRlbmQg
dG8gY2hhbmdlIGEgcHJvcGVydHk7IG9ubHkKICB0byBtb25pdG9yIGl0IGZvciBjaGFuZ2VzIChz
dWNoIGFzIGluIHRoZSBleGFtcGxlIGFib3ZlKS4KCiAgIyMgQWRkaW5nIEJpbmRpbmdzIE1hbnVh
bGx5CgogIEFsbCBvZiB0aGUgZXhhbXBsZXMgYWJvdmUgc2hvdyB5b3UgaG93IHRvIGNvbmZpZ3Vy
ZSBhIGN1c3RvbSBiaW5kaW5nLCBidXQgdGhlCiAgcmVzdWx0IG9mIHRoZXNlIGN1c3RvbWl6YXRp
b25zIHdpbGwgYmUgYSBiaW5kaW5nIHRlbXBsYXRlLCBub3QgYSBmdWxseSBhY3RpdmUKICBCaW5k
aW5nIGluc3RhbmNlLiBUaGUgYmluZGluZyB3aWxsIGFjdHVhbGx5IGJlY29tZSBhY3RpdmUgb25s
eSB3aGVuIHlvdQogIGluc3RhbnRpYXRlIHRoZSBvYmplY3QgdGhlIGJpbmRpbmcgYmVsb25ncyB0
by4gSXQgaXMgdXNlZnVsIGhvd2V2ZXIsIHRvCiAgdW5kZXJzdGFuZCB3aGF0IGFjdHVhbGx5IGhh
cHBlbnMgd2hlbiB0aGUgYmluZGluZyBpcyBhY3RpdmF0ZWQuCgogIEZvciBhIGJpbmRpbmcgdG8g
ZnVuY3Rpb24gaXQgbXVzdCBoYXZlIGF0IGxlYXN0IGEgYGZyb21gIHByb3BlcnR5IGFuZCBhIGB0
b2AKICBwcm9wZXJ0eS4gVGhlIGBmcm9tYCBwcm9wZXJ0eSBwYXRoIHBvaW50cyB0byB0aGUgb2Jq
ZWN0L2tleSB0aGF0IHlvdSB3YW50IHRvCiAgYmluZCBmcm9tIHdoaWxlIHRoZSBgdG9gIHBhdGgg
cG9pbnRzIHRvIHRoZSBvYmplY3Qva2V5IHlvdSB3YW50IHRvIGJpbmQgdG8uCgogIFdoZW4geW91
IGRlZmluZSBhIGN1c3RvbSBiaW5kaW5nLCB5b3UgYXJlIHVzdWFsbHkgZGVzY3JpYmluZyB0aGUg
cHJvcGVydHkKICB5b3Ugd2FudCB0byBiaW5kIGZyb20gKHN1Y2ggYXMgYE15QXBwLnNvbWVDb250
cm9sbGVyLnZhbHVlYCBpbiB0aGUgZXhhbXBsZXMKICBhYm92ZSkuIFdoZW4geW91ciBvYmplY3Qg
aXMgY3JlYXRlZCwgaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGFzc2lnbiB0aGUgdmFsdWUKICB5b3Ug
d2FudCB0byBiaW5kIGB0b2AgYmFzZWQgb24gdGhlIG5hbWUgb2YgeW91ciBiaW5kaW5nIGtleS4g
SW4gdGhlCiAgZXhhbXBsZXMgYWJvdmUsIGR1cmluZyBpbml0LCBFbWJlciBvYmplY3RzIHdpbGwg
ZWZmZWN0aXZlbHkgY2FsbAogIHNvbWV0aGluZyBsaWtlIHRoaXMgb24geW91ciBiaW5kaW5nOgoK
ICBgYGBqYXZhc2NyaXB0CiAgYmluZGluZyA9IEVtYmVyLkJpbmRpbmcuZnJvbSh0aGlzLnZhbHVl
QmluZGluZykudG8oInZhbHVlIik7CiAgYGBgCgogIFRoaXMgY3JlYXRlcyBhIG5ldyBiaW5kaW5n
IGluc3RhbmNlIGJhc2VkIG9uIHRoZSB0ZW1wbGF0ZSB5b3UgcHJvdmlkZSwgYW5kCiAgc2V0cyB0
aGUgdG8gcGF0aCB0byB0aGUgYHZhbHVlYCBwcm9wZXJ0eSBvZiB0aGUgbmV3IG9iamVjdC4gTm93
IHRoYXQgdGhlCiAgYmluZGluZyBpcyBmdWxseSBjb25maWd1cmVkIHdpdGggYSBgZnJvbWAgYW5k
IGEgYHRvYCwgaXQgc2ltcGx5IG5lZWRzIHRvIGJlCiAgY29ubmVjdGVkIHRvIGJlY29tZSBhY3Rp
dmUuIFRoaXMgaXMgZG9uZSB0aHJvdWdoIHRoZSBgY29ubmVjdCgpYCBtZXRob2Q6CgogIGBgYGph
dmFzY3JpcHQKICBiaW5kaW5nLmNvbm5lY3QodGhpcyk7CiAgYGBgCgogIE5vdGUgdGhhdCB3aGVu
IHlvdSBjb25uZWN0IGEgYmluZGluZyB5b3UgcGFzcyB0aGUgb2JqZWN0IHlvdSB3YW50IGl0IHRv
IGJlCiAgY29ubmVjdGVkIHRvLiBUaGlzIG9iamVjdCB3aWxsIGJlIHVzZWQgYXMgdGhlIHJvb3Qg
Zm9yIGJvdGggdGhlIGZyb20gYW5kCiAgdG8gc2lkZSBvZiB0aGUgYmluZGluZyB3aGVuIGluc3Bl
Y3RpbmcgcmVsYXRpdmUgcGF0aHMuIFRoaXMgYWxsb3dzIHRoZQogIGJpbmRpbmcgdG8gYmUgYXV0
b21hdGljYWxseSBpbmhlcml0ZWQgYnkgc3ViY2xhc3NlZCBvYmplY3RzIGFzIHdlbGwuCgogIE5v
dyB0aGF0IHRoZSBiaW5kaW5nIGlzIGNvbm5lY3RlZCwgaXQgd2lsbCBvYnNlcnZlIGJvdGggdGhl
IGZyb20gYW5kIHRvIHNpZGUKICBhbmQgcmVsYXkgY2hhbmdlcy4KCiAgSWYgeW91IGV2ZXIgbmVl
ZGVkIHRvIGRvIHNvICh5b3UgYWxtb3N0IG5ldmVyIHdpbGwsIGJ1dCBpdCBpcyB1c2VmdWwgdG8K
ICB1bmRlcnN0YW5kIHRoaXMgYW55d2F5KSwgeW91IGNvdWxkIG1hbnVhbGx5IGNyZWF0ZSBhbiBh
Y3RpdmUgYmluZGluZyBieQogIHVzaW5nIHRoZSBgRW1iZXIuYmluZCgpYCBoZWxwZXIgbWV0aG9k
LiAoVGhpcyBpcyB0aGUgc2FtZSBtZXRob2QgdXNlZCBieQogIHRvIHNldHVwIHlvdXIgYmluZGlu
Z3Mgb24gb2JqZWN0cyk6CgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5iaW5kKE15QXBwLmFub3Ro
ZXJPYmplY3QsICJ2YWx1ZSIsICJNeUFwcC5zb21lQ29udHJvbGxlci52YWx1ZSIpOwogIGBgYAoK
ICBCb3RoIG9mIHRoZXNlIGNvZGUgZnJhZ21lbnRzIGhhdmUgdGhlIHNhbWUgZWZmZWN0IGFzIGRv
aW5nIHRoZSBtb3N0IGZyaWVuZGx5CiAgZm9ybSBvZiBiaW5kaW5nIGNyZWF0aW9uIGxpa2Ugc286
CgogIGBgYGphdmFzY3JpcHQKICBNeUFwcC5hbm90aGVyT2JqZWN0ID0gRW1iZXIuT2JqZWN0LmNy
ZWF0ZSh7CiAgICB2YWx1ZUJpbmRpbmc6ICJNeUFwcC5zb21lQ29udHJvbGxlci52YWx1ZSIsCgog
ICAgLy8gT1RIRVIgQ09ERSBGT1IgVEhJUyBPQkpFQ1QuLi4KICB9KTsKICBgYGAKCiAgRW1iZXIn
cyBidWlsdCBpbiBiaW5kaW5nIGNyZWF0aW9uIG1ldGhvZCBtYWtlcyBpdCBlYXN5IHRvIGF1dG9t
YXRpY2FsbHkKICBjcmVhdGUgYmluZGluZ3MgZm9yIHlvdS4gWW91IHNob3VsZCBhbHdheXMgdXNl
IHRoZSBoaWdoZXN0LWxldmVsIEFQSXMKICBhdmFpbGFibGUsIGV2ZW4gaWYgeW91IHVuZGVyc3Rh
bmQgaG93IGl0IHdvcmtzIHVuZGVybmVhdGguCgogIEBjbGFzcyBCaW5kaW5nCiAgQG5hbWVzcGFj
ZSBFbWJlcgogIEBzaW5jZSBFbWJlciAwLjkKKi8KRW1iZXIuQmluZGluZyA9IEJpbmRpbmc7CgoK
LyoqCiAgR2xvYmFsIGhlbHBlciBtZXRob2QgdG8gY3JlYXRlIGEgbmV3IGJpbmRpbmcuIEp1c3Qg
cGFzcyB0aGUgcm9vdCBvYmplY3QKICBhbG9uZyB3aXRoIGEgYHRvYCBhbmQgYGZyb21gIHBhdGgg
dG8gY3JlYXRlIGFuZCBjb25uZWN0IHRoZSBiaW5kaW5nLgoKICBAbWV0aG9kIGJpbmQKICBAZm9y
IEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgcm9vdCBvYmplY3Qgb2YgdGhlIHRyYW5z
Zm9ybS4KICBAcGFyYW0ge1N0cmluZ30gdG8gVGhlIHBhdGggdG8gdGhlICd0bycgc2lkZSBvZiB0
aGUgYmluZGluZy4KICAgIE11c3QgYmUgcmVsYXRpdmUgdG8gb2JqLgogIEBwYXJhbSB7U3RyaW5n
fSBmcm9tIFRoZSBwYXRoIHRvIHRoZSAnZnJvbScgc2lkZSBvZiB0aGUgYmluZGluZy4KICAgIE11
c3QgYmUgcmVsYXRpdmUgdG8gb2JqIG9yIGEgZ2xvYmFsIHBhdGguCiAgQHJldHVybiB7RW1iZXIu
QmluZGluZ30gYmluZGluZyBpbnN0YW5jZQoqLwpFbWJlci5iaW5kID0gZnVuY3Rpb24ob2JqLCB0
bywgZnJvbSkgewogIHJldHVybiBuZXcgRW1iZXIuQmluZGluZyh0bywgZnJvbSkuY29ubmVjdChv
YmopOwp9OwoKLyoqCiAgQG1ldGhvZCBvbmVXYXkKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmpl
Y3R9IG9iaiBUaGUgcm9vdCBvYmplY3Qgb2YgdGhlIHRyYW5zZm9ybS4KICBAcGFyYW0ge1N0cmlu
Z30gdG8gVGhlIHBhdGggdG8gdGhlICd0bycgc2lkZSBvZiB0aGUgYmluZGluZy4KICAgIE11c3Qg
YmUgcmVsYXRpdmUgdG8gb2JqLgogIEBwYXJhbSB7U3RyaW5nfSBmcm9tIFRoZSBwYXRoIHRvIHRo
ZSAnZnJvbScgc2lkZSBvZiB0aGUgYmluZGluZy4KICAgIE11c3QgYmUgcmVsYXRpdmUgdG8gb2Jq
IG9yIGEgZ2xvYmFsIHBhdGguCiAgQHJldHVybiB7RW1iZXIuQmluZGluZ30gYmluZGluZyBpbnN0
YW5jZQoqLwpFbWJlci5vbmVXYXkgPSBmdW5jdGlvbihvYmosIHRvLCBmcm9tKSB7CiAgcmV0dXJu
IG5ldyBFbWJlci5CaW5kaW5nKHRvLCBmcm9tKS5vbmVXYXkoKS5jb25uZWN0KG9iaik7Cn07Cgp9
KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXIt
bWV0YWwKKi8KCnZhciBNaXhpbiwgUkVRVUlSRUQsIEFsaWFzLAogICAgYV9tYXAgPSBFbWJlci5B
cnJheVBvbHlmaWxscy5tYXAsCiAgICBhX2luZGV4T2YgPSBFbWJlci5BcnJheVBvbHlmaWxscy5p
bmRleE9mLAogICAgYV9mb3JFYWNoID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMuZm9yRWFjaCwKICAg
IGFfc2xpY2UgPSBbXS5zbGljZSwKICAgIG9fY3JlYXRlID0gRW1iZXIuY3JlYXRlLAogICAgZGVm
aW5lUHJvcGVydHkgPSBFbWJlci5kZWZpbmVQcm9wZXJ0eSwKICAgIGd1aWRGb3IgPSBFbWJlci5n
dWlkRm9yOwoKCmZ1bmN0aW9uIG1peGluc01ldGEob2JqKSB7CiAgdmFyIG0gPSBFbWJlci5tZXRh
KG9iaiwgdHJ1ZSksIHJldCA9IG0ubWl4aW5zOwogIGlmICghcmV0KSB7CiAgICByZXQgPSBtLm1p
eGlucyA9IHt9OwogIH0gZWxzZSBpZiAoIW0uaGFzT3duUHJvcGVydHkoJ21peGlucycpKSB7CiAg
ICByZXQgPSBtLm1peGlucyA9IG9fY3JlYXRlKHJldCk7CiAgfQogIHJldHVybiByZXQ7Cn0KCmZ1
bmN0aW9uIGluaXRNaXhpbihtaXhpbiwgYXJncykgewogIGlmIChhcmdzICYmIGFyZ3MubGVuZ3Ro
ID4gMCkgewogICAgbWl4aW4ubWl4aW5zID0gYV9tYXAuY2FsbChhcmdzLCBmdW5jdGlvbih4KSB7
CiAgICAgIGlmICh4IGluc3RhbmNlb2YgTWl4aW4pIHsgcmV0dXJuIHg7IH0KCiAgICAgIC8vIE5v
dGU6IE1hbnVhbGx5IHNldHVwIGEgcHJpbWl0aXZlIG1peGluIGhlcmUuIFRoaXMgaXMgdGhlIG9u
bHkKICAgICAgLy8gd2F5IHRvIGFjdHVhbGx5IGdldCBhIHByaW1pdGl2ZSBtaXhpbi4gVGhpcyB3
YXkgbm9ybWFsIGNyZWF0aW9uCiAgICAgIC8vIG9mIG1peGlucyB3aWxsIGdpdmUgeW91IGNvbWJp
bmVkIG1peGlucy4uLgogICAgICB2YXIgbWl4aW4gPSBuZXcgTWl4aW4oKTsKICAgICAgbWl4aW4u
cHJvcGVydGllcyA9IHg7CiAgICAgIHJldHVybiBtaXhpbjsKICAgIH0pOwogIH0KICByZXR1cm4g
bWl4aW47Cn0KCmZ1bmN0aW9uIGlzTWV0aG9kKG9iaikgewogIHJldHVybiAnZnVuY3Rpb24nID09
PSB0eXBlb2Ygb2JqICYmCiAgICAgICAgIG9iai5pc01ldGhvZCAhPT0gZmFsc2UgJiYKICAgICAg
ICAgb2JqICE9PSBCb29sZWFuICYmIG9iaiAhPT0gT2JqZWN0ICYmIG9iaiAhPT0gTnVtYmVyICYm
IG9iaiAhPT0gQXJyYXkgJiYgb2JqICE9PSBEYXRlICYmIG9iaiAhPT0gU3RyaW5nOwp9Cgp2YXIg
Q09OVElOVUUgPSB7fTsKCmZ1bmN0aW9uIG1peGluUHJvcGVydGllcyhtaXhpbnNNZXRhLCBtaXhp
bikgewogIHZhciBndWlkOwoKICBpZiAobWl4aW4gaW5zdGFuY2VvZiBNaXhpbikgewogICAgZ3Vp
ZCA9IGd1aWRGb3IobWl4aW4pOwogICAgaWYgKG1peGluc01ldGFbZ3VpZF0pIHsgcmV0dXJuIENP
TlRJTlVFOyB9CiAgICBtaXhpbnNNZXRhW2d1aWRdID0gbWl4aW47CiAgICByZXR1cm4gbWl4aW4u
cHJvcGVydGllczsKICB9IGVsc2UgewogICAgcmV0dXJuIG1peGluOyAvLyBhcHBseSBhbm9ueW1v
dXMgbWl4aW4gcHJvcGVydGllcwogIH0KfQoKZnVuY3Rpb24gY29uY2F0ZW5hdGVkTWl4aW5Qcm9w
ZXJ0aWVzKGNvbmNhdFByb3AsIHByb3BzLCB2YWx1ZXMsIGJhc2UpIHsKICB2YXIgY29uY2F0czsK
CiAgLy8gcmVzZXQgYmVmb3JlIGFkZGluZyBlYWNoIG5ldyBtaXhpbiB0byBwaWNrdXAgY29uY2F0
cyBmcm9tIHByZXZpb3VzCiAgY29uY2F0cyA9IHZhbHVlc1tjb25jYXRQcm9wXSB8fCBiYXNlW2Nv
bmNhdFByb3BdOwogIGlmIChwcm9wc1tjb25jYXRQcm9wXSkgewogICAgY29uY2F0cyA9IGNvbmNh
dHMgPyBjb25jYXRzLmNvbmNhdChwcm9wc1tjb25jYXRQcm9wXSkgOiBwcm9wc1tjb25jYXRQcm9w
XTsKICB9CgogIHJldHVybiBjb25jYXRzOwp9CgpmdW5jdGlvbiBnaXZlRGVzY3JpcHRvclN1cGVy
KG1ldGEsIGtleSwgcHJvcGVydHksIHZhbHVlcywgZGVzY3MpIHsKICB2YXIgc3VwZXJQcm9wZXJ0
eTsKCiAgLy8gQ29tcHV0ZWQgcHJvcGVydGllcyBvdmVycmlkZSBtZXRob2RzLCBhbmQgZG8gbm90
IGNhbGwgc3VwZXIgdG8gdGhlbQogIGlmICh2YWx1ZXNba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAg
ICAvLyBGaW5kIHRoZSBvcmlnaW5hbCBkZXNjcmlwdG9yIGluIGEgcGFyZW50IG1peGluCiAgICBz
dXBlclByb3BlcnR5ID0gZGVzY3Nba2V5XTsKICB9CgogIC8vIElmIHdlIGRpZG4ndCBmaW5kIHRo
ZSBvcmlnaW5hbCBkZXNjcmlwdG9yIGluIGEgcGFyZW50IG1peGluLCBmaW5kCiAgLy8gaXQgb24g
dGhlIG9yaWdpbmFsIG9iamVjdC4KICBzdXBlclByb3BlcnR5ID0gc3VwZXJQcm9wZXJ0eSB8fCBt
ZXRhLmRlc2NzW2tleV07CgogIGlmICghc3VwZXJQcm9wZXJ0eSB8fCAhKHN1cGVyUHJvcGVydHkg
aW5zdGFuY2VvZiBFbWJlci5Db21wdXRlZFByb3BlcnR5KSkgewogICAgcmV0dXJuIHByb3BlcnR5
OwogIH0KCiAgLy8gU2luY2UgbXVsdGlwbGUgbWl4aW5zIG1heSBpbmhlcml0IGZyb20gdGhlIHNh
bWUgcGFyZW50LCB3ZSBuZWVkCiAgLy8gdG8gY2xvbmUgdGhlIGNvbXB1dGVkIHByb3BlcnR5IHNv
IHRoYXQgb3RoZXIgbWl4aW5zIGRvIG5vdCByZWNlaXZlCiAgLy8gdGhlIHdyYXBwZWQgdmVyc2lv
bi4KICBwcm9wZXJ0eSA9IG9fY3JlYXRlKHByb3BlcnR5KTsKICBwcm9wZXJ0eS5mdW5jID0gRW1i
ZXIud3JhcChwcm9wZXJ0eS5mdW5jLCBzdXBlclByb3BlcnR5LmZ1bmMpOwoKICByZXR1cm4gcHJv
cGVydHk7Cn0KCmZ1bmN0aW9uIGdpdmVNZXRob2RTdXBlcihvYmosIGtleSwgbWV0aG9kLCB2YWx1
ZXMsIGRlc2NzKSB7CiAgdmFyIHN1cGVyTWV0aG9kOwoKICAvLyBNZXRob2RzIG92ZXJ3cml0ZSBj
b21wdXRlZCBwcm9wZXJ0aWVzLCBhbmQgZG8gbm90IGNhbGwgc3VwZXIgdG8gdGhlbS4KICBpZiAo
ZGVzY3Nba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAvLyBGaW5kIHRoZSBvcmlnaW5hbCBtZXRo
b2QgaW4gYSBwYXJlbnQgbWl4aW4KICAgIHN1cGVyTWV0aG9kID0gdmFsdWVzW2tleV07CiAgfQoK
ICAvLyBJZiB3ZSBkaWRuJ3QgZmluZCB0aGUgb3JpZ2luYWwgdmFsdWUgaW4gYSBwYXJlbnQgbWl4
aW4sIGZpbmQgaXQgaW4KICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0CiAgc3VwZXJNZXRob2QgPSBz
dXBlck1ldGhvZCB8fCBvYmpba2V5XTsKCiAgLy8gT25seSB3cmFwIHRoZSBuZXcgbWV0aG9kIGlm
IHRoZSBvcmlnaW5hbCBtZXRob2Qgd2FzIGEgZnVuY3Rpb24KICBpZiAoJ2Z1bmN0aW9uJyAhPT0g
dHlwZW9mIHN1cGVyTWV0aG9kKSB7CiAgICByZXR1cm4gbWV0aG9kOwogIH0KCiAgcmV0dXJuIEVt
YmVyLndyYXAobWV0aG9kLCBzdXBlck1ldGhvZCk7Cn0KCmZ1bmN0aW9uIGFwcGx5Q29uY2F0ZW5h
dGVkUHJvcGVydGllcyhvYmosIGtleSwgdmFsdWUsIHZhbHVlcykgewogIHZhciBiYXNlVmFsdWUg
PSB2YWx1ZXNba2V5XSB8fCBvYmpba2V5XTsKCiAgaWYgKGJhc2VWYWx1ZSkgewogICAgaWYgKCdm
dW5jdGlvbicgPT09IHR5cGVvZiBiYXNlVmFsdWUuY29uY2F0KSB7CiAgICAgIHJldHVybiBiYXNl
VmFsdWUuY29uY2F0KHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBFbWJlci5tYWtl
QXJyYXkoYmFzZVZhbHVlKS5jb25jYXQodmFsdWUpOwogICAgfQogIH0gZWxzZSB7CiAgICByZXR1
cm4gRW1iZXIubWFrZUFycmF5KHZhbHVlKTsKICB9Cn0KCmZ1bmN0aW9uIGFwcGx5TWVyZ2VkUHJv
cGVydGllcyhvYmosIGtleSwgdmFsdWUsIHZhbHVlcykgewogIHZhciBiYXNlVmFsdWUgPSB2YWx1
ZXNba2V5XSB8fCBvYmpba2V5XTsKCiAgaWYgKCFiYXNlVmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9
CgogIHZhciBuZXdCYXNlID0gRW1iZXIubWVyZ2Uoe30sIGJhc2VWYWx1ZSk7CiAgZm9yICh2YXIg
cHJvcCBpbiB2YWx1ZSkgewogICAgaWYgKCF2YWx1ZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgeyBj
b250aW51ZTsgfQoKICAgIHZhciBwcm9wVmFsdWUgPSB2YWx1ZVtwcm9wXTsKICAgIGlmIChpc01l
dGhvZChwcm9wVmFsdWUpKSB7CiAgICAgIC8vIFRPRE86IHN1cHBvcnQgZm9yIENvbXB1dGVkIFBy
b3BlcnRpZXMsIGV0Yz8KICAgICAgbmV3QmFzZVtwcm9wXSA9IGdpdmVNZXRob2RTdXBlcihvYmos
IHByb3AsIHByb3BWYWx1ZSwgYmFzZVZhbHVlLCB7fSk7CiAgICB9IGVsc2UgewogICAgICBuZXdC
YXNlW3Byb3BdID0gcHJvcFZhbHVlOwogICAgfQogIH0KCiAgcmV0dXJuIG5ld0Jhc2U7Cn0KCmZ1
bmN0aW9uIGFkZE5vcm1hbGl6ZWRQcm9wZXJ0eShiYXNlLCBrZXksIHZhbHVlLCBtZXRhLCBkZXNj
cywgdmFsdWVzLCBjb25jYXRzLCBtZXJnaW5ncykgewogIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEVt
YmVyLkRlc2NyaXB0b3IpIHsKICAgIGlmICh2YWx1ZSA9PT0gUkVRVUlSRUQgJiYgZGVzY3Nba2V5
XSkgeyByZXR1cm4gQ09OVElOVUU7IH0KCiAgICAvLyBXcmFwIGRlc2NyaXB0b3IgZnVuY3Rpb24g
dG8gaW1wbGVtZW50CiAgICAvLyBfc3VwZXIoKSBpZiBuZWVkZWQKICAgIGlmICh2YWx1ZS5mdW5j
KSB7CiAgICAgIHZhbHVlID0gZ2l2ZURlc2NyaXB0b3JTdXBlcihtZXRhLCBrZXksIHZhbHVlLCB2
YWx1ZXMsIGRlc2NzKTsKICAgIH0KCiAgICBkZXNjc1trZXldICA9IHZhbHVlOwogICAgdmFsdWVz
W2tleV0gPSB1bmRlZmluZWQ7CiAgfSBlbHNlIHsKICAgIGlmICgoY29uY2F0cyAmJiBhX2luZGV4
T2YuY2FsbChjb25jYXRzLCBrZXkpID49IDApIHx8CiAgICAgICAgICAgICAgICBrZXkgPT09ICdj
b25jYXRlbmF0ZWRQcm9wZXJ0aWVzJyB8fAogICAgICAgICAgICAgICAga2V5ID09PSAnbWVyZ2Vk
UHJvcGVydGllcycpIHsKICAgICAgdmFsdWUgPSBhcHBseUNvbmNhdGVuYXRlZFByb3BlcnRpZXMo
YmFzZSwga2V5LCB2YWx1ZSwgdmFsdWVzKTsKICAgIH0gZWxzZSBpZiAoKG1lcmdpbmdzICYmIGFf
aW5kZXhPZi5jYWxsKG1lcmdpbmdzLCBrZXkpID49IDApKSB7CiAgICAgIHZhbHVlID0gYXBwbHlN
ZXJnZWRQcm9wZXJ0aWVzKGJhc2UsIGtleSwgdmFsdWUsIHZhbHVlcyk7CiAgICB9IGVsc2UgaWYg
KGlzTWV0aG9kKHZhbHVlKSkgewogICAgICB2YWx1ZSA9IGdpdmVNZXRob2RTdXBlcihiYXNlLCBr
ZXksIHZhbHVlLCB2YWx1ZXMsIGRlc2NzKTsKICAgIH0KCiAgICBkZXNjc1trZXldID0gdW5kZWZp
bmVkOwogICAgdmFsdWVzW2tleV0gPSB2YWx1ZTsKICB9Cn0KCmZ1bmN0aW9uIG1lcmdlTWl4aW5z
KG1peGlucywgbSwgZGVzY3MsIHZhbHVlcywgYmFzZSwga2V5cykgewogIHZhciBtaXhpbiwgcHJv
cHMsIGtleSwgY29uY2F0cywgbWVyZ2luZ3MsIG1ldGE7CgogIGZ1bmN0aW9uIHJlbW92ZUtleXMo
a2V5TmFtZSkgewogICAgZGVsZXRlIGRlc2NzW2tleU5hbWVdOwogICAgZGVsZXRlIHZhbHVlc1tr
ZXlOYW1lXTsKICB9CgogIGZvcih2YXIgaT0wLCBsPW1peGlucy5sZW5ndGg7IGk8bDsgaSsrKSB7
CiAgICBtaXhpbiA9IG1peGluc1tpXTsKICAgIEVtYmVyLmFzc2VydCgnRXhwZWN0ZWQgaGFzaCBv
ciBNaXhpbiBpbnN0YW5jZSwgZ290ICcgKyBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwo
bWl4aW4pLAogICAgICAgICAgICAgICAgIHR5cGVvZiBtaXhpbiA9PT0gJ29iamVjdCcgJiYgbWl4
aW4gIT09IG51bGwgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1peGluKSAhPT0g
J1tvYmplY3QgQXJyYXldJyk7CgogICAgcHJvcHMgPSBtaXhpblByb3BlcnRpZXMobSwgbWl4aW4p
OwogICAgaWYgKHByb3BzID09PSBDT05USU5VRSkgeyBjb250aW51ZTsgfQoKICAgIGlmIChwcm9w
cykgewogICAgICBtZXRhID0gRW1iZXIubWV0YShiYXNlKTsKICAgICAgaWYgKGJhc2Uud2lsbE1l
cmdlTWl4aW4pIHsgYmFzZS53aWxsTWVyZ2VNaXhpbihwcm9wcyk7IH0KICAgICAgY29uY2F0cyA9
IGNvbmNhdGVuYXRlZE1peGluUHJvcGVydGllcygnY29uY2F0ZW5hdGVkUHJvcGVydGllcycsIHBy
b3BzLCB2YWx1ZXMsIGJhc2UpOwogICAgICBtZXJnaW5ncyA9IGNvbmNhdGVuYXRlZE1peGluUHJv
cGVydGllcygnbWVyZ2VkUHJvcGVydGllcycsIHByb3BzLCB2YWx1ZXMsIGJhc2UpOwoKICAgICAg
Zm9yIChrZXkgaW4gcHJvcHMpIHsKICAgICAgICBpZiAoIXByb3BzLmhhc093blByb3BlcnR5KGtl
eSkpIHsgY29udGludWU7IH0KICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICBhZGROb3Jt
YWxpemVkUHJvcGVydHkoYmFzZSwga2V5LCBwcm9wc1trZXldLCBtZXRhLCBkZXNjcywgdmFsdWVz
LCBjb25jYXRzLCBtZXJnaW5ncyk7CiAgICAgIH0KCiAgICAgIC8vIG1hbnVhbGx5IGNvcHkgdG9T
dHJpbmcoKSBiZWNhdXNlIHNvbWUgSlMgZW5naW5lcyBkbyBub3QgZW51bWVyYXRlIGl0CiAgICAg
IGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eSgndG9TdHJpbmcnKSkgeyBiYXNlLnRvU3RyaW5nID0g
cHJvcHMudG9TdHJpbmc7IH0KICAgIH0gZWxzZSBpZiAobWl4aW4ubWl4aW5zKSB7CiAgICAgIG1l
cmdlTWl4aW5zKG1peGluLm1peGlucywgbSwgZGVzY3MsIHZhbHVlcywgYmFzZSwga2V5cyk7CiAg
ICAgIGlmIChtaXhpbi5fd2l0aG91dCkgeyBhX2ZvckVhY2guY2FsbChtaXhpbi5fd2l0aG91dCwg
cmVtb3ZlS2V5cyk7IH0KICAgIH0KICB9Cn0KCnZhciBJU19CSU5ESU5HID0gRW1iZXIuSVNfQklO
RElORyA9IC9eLitCaW5kaW5nJC87CgpmdW5jdGlvbiBkZXRlY3RCaW5kaW5nKG9iaiwga2V5LCB2
YWx1ZSwgbSkgewogIGlmIChJU19CSU5ESU5HLnRlc3Qoa2V5KSkgewogICAgdmFyIGJpbmRpbmdz
ID0gbS5iaW5kaW5nczsKICAgIGlmICghYmluZGluZ3MpIHsKICAgICAgYmluZGluZ3MgPSBtLmJp
bmRpbmdzID0ge307CiAgICB9IGVsc2UgaWYgKCFtLmhhc093blByb3BlcnR5KCdiaW5kaW5ncycp
KSB7CiAgICAgIGJpbmRpbmdzID0gbS5iaW5kaW5ncyA9IG9fY3JlYXRlKG0uYmluZGluZ3MpOwog
ICAgfQogICAgYmluZGluZ3Nba2V5XSA9IHZhbHVlOwogIH0KfQoKZnVuY3Rpb24gY29ubmVjdEJp
bmRpbmdzKG9iaiwgbSkgewogIC8vIFRPRE8gTWl4aW4uYXBwbHkoaW5zdGFuY2UpIHNob3VsZCBk
aXNjb25uZWN0IGJpbmRpbmcgaWYgZXhpc3RzCiAgdmFyIGJpbmRpbmdzID0gbS5iaW5kaW5ncywg
a2V5LCBiaW5kaW5nLCB0bzsKICBpZiAoYmluZGluZ3MpIHsKICAgIGZvciAoa2V5IGluIGJpbmRp
bmdzKSB7CiAgICAgIGJpbmRpbmcgPSBiaW5kaW5nc1trZXldOwogICAgICBpZiAoYmluZGluZykg
ewogICAgICAgIHRvID0ga2V5LnNsaWNlKDAsIC03KTsgLy8gc3RyaXAgQmluZGluZyBvZmYgZW5k
CiAgICAgICAgaWYgKGJpbmRpbmcgaW5zdGFuY2VvZiBFbWJlci5CaW5kaW5nKSB7CiAgICAgICAg
ICBiaW5kaW5nID0gYmluZGluZy5jb3B5KCk7IC8vIGNvcHkgcHJvdG90eXBlcycgaW5zdGFuY2UK
ICAgICAgICAgIGJpbmRpbmcudG8odG8pOwogICAgICAgIH0gZWxzZSB7IC8vIGJpbmRpbmcgaXMg
c3RyaW5nIHBhdGgKICAgICAgICAgIGJpbmRpbmcgPSBuZXcgRW1iZXIuQmluZGluZyh0bywgYmlu
ZGluZyk7CiAgICAgICAgfQogICAgICAgIGJpbmRpbmcuY29ubmVjdChvYmopOwogICAgICAgIG9i
altrZXldID0gYmluZGluZzsKICAgICAgfQogICAgfQogICAgLy8gbWFyayBhcyBhcHBsaWVkCiAg
ICBtLmJpbmRpbmdzID0ge307CiAgfQp9CgpmdW5jdGlvbiBmaW5pc2hQYXJ0aWFsKG9iaiwgbSkg
ewogIGNvbm5lY3RCaW5kaW5ncyhvYmosIG0gfHwgRW1iZXIubWV0YShvYmopKTsKICByZXR1cm4g
b2JqOwp9CgpmdW5jdGlvbiBmb2xsb3dBbGlhcyhvYmosIGRlc2MsIG0sIGRlc2NzLCB2YWx1ZXMp
IHsKICB2YXIgYWx0S2V5ID0gZGVzYy5tZXRob2ROYW1lLCB2YWx1ZTsKICBpZiAoZGVzY3NbYWx0
S2V5XSB8fCB2YWx1ZXNbYWx0S2V5XSkgewogICAgdmFsdWUgPSB2YWx1ZXNbYWx0S2V5XTsKICAg
IGRlc2MgID0gZGVzY3NbYWx0S2V5XTsKICB9IGVsc2UgaWYgKG0uZGVzY3NbYWx0S2V5XSkgewog
ICAgZGVzYyAgPSBtLmRlc2NzW2FsdEtleV07CiAgICB2YWx1ZSA9IHVuZGVmaW5lZDsKICB9IGVs
c2UgewogICAgZGVzYyA9IHVuZGVmaW5lZDsKICAgIHZhbHVlID0gb2JqW2FsdEtleV07CiAgfQoK
ICByZXR1cm4geyBkZXNjOiBkZXNjLCB2YWx1ZTogdmFsdWUgfTsKfQoKZnVuY3Rpb24gdXBkYXRl
T2JzZXJ2ZXJzQW5kTGlzdGVuZXJzKG9iaiwga2V5LCBvYnNlcnZlck9yTGlzdGVuZXIsIHBhdGhz
S2V5LCB1cGRhdGVNZXRob2QpIHsKICB2YXIgcGF0aHMgPSBvYnNlcnZlck9yTGlzdGVuZXJbcGF0
aHNLZXldOwoKICBpZiAocGF0aHMpIHsKICAgIGZvciAodmFyIGk9MCwgbD1wYXRocy5sZW5ndGg7
IGk8bDsgaSsrKSB7CiAgICAgIEVtYmVyW3VwZGF0ZU1ldGhvZF0ob2JqLCBwYXRoc1tpXSwgbnVs
bCwga2V5KTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHJlcGxhY2VPYnNlcnZlcnNBbmRMaXN0ZW5l
cnMob2JqLCBrZXksIG9ic2VydmVyT3JMaXN0ZW5lcikgewogIHZhciBwcmV2ID0gb2JqW2tleV07
CgogIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2YgcHJldikgewogICAgdXBkYXRlT2JzZXJ2ZXJz
QW5kTGlzdGVuZXJzKG9iaiwga2V5LCBwcmV2LCAnX19lbWJlcl9vYnNlcnZlc0JlZm9yZV9fJywg
J3JlbW92ZUJlZm9yZU9ic2VydmVyJyk7CiAgICB1cGRhdGVPYnNlcnZlcnNBbmRMaXN0ZW5lcnMo
b2JqLCBrZXksIHByZXYsICdfX2VtYmVyX29ic2VydmVzX18nLCAncmVtb3ZlT2JzZXJ2ZXInKTsK
ICAgIHVwZGF0ZU9ic2VydmVyc0FuZExpc3RlbmVycyhvYmosIGtleSwgcHJldiwgJ19fZW1iZXJf
bGlzdGVuc19fJywgJ3JlbW92ZUxpc3RlbmVyJyk7CiAgfQoKICBpZiAoJ2Z1bmN0aW9uJyA9PT0g
dHlwZW9mIG9ic2VydmVyT3JMaXN0ZW5lcikgewogICAgdXBkYXRlT2JzZXJ2ZXJzQW5kTGlzdGVu
ZXJzKG9iaiwga2V5LCBvYnNlcnZlck9yTGlzdGVuZXIsICdfX2VtYmVyX29ic2VydmVzQmVmb3Jl
X18nLCAnYWRkQmVmb3JlT2JzZXJ2ZXInKTsKICAgIHVwZGF0ZU9ic2VydmVyc0FuZExpc3RlbmVy
cyhvYmosIGtleSwgb2JzZXJ2ZXJPckxpc3RlbmVyLCAnX19lbWJlcl9vYnNlcnZlc19fJywgJ2Fk
ZE9ic2VydmVyJyk7CiAgICB1cGRhdGVPYnNlcnZlcnNBbmRMaXN0ZW5lcnMob2JqLCBrZXksIG9i
c2VydmVyT3JMaXN0ZW5lciwgJ19fZW1iZXJfbGlzdGVuc19fJywgJ2FkZExpc3RlbmVyJyk7CiAg
fQp9CgpmdW5jdGlvbiBhcHBseU1peGluKG9iaiwgbWl4aW5zLCBwYXJ0aWFsKSB7CiAgdmFyIGRl
c2NzID0ge30sIHZhbHVlcyA9IHt9LCBtID0gRW1iZXIubWV0YShvYmopLAogICAgICBrZXksIHZh
bHVlLCBkZXNjLCBrZXlzID0gW107CgogIC8vIEdvIHRocm91Z2ggYWxsIG1peGlucyBhbmQgaGFz
aGVzIHBhc3NlZCBpbiwgYW5kOgogIC8vCiAgLy8gKiBIYW5kbGUgY29uY2F0ZW5hdGVkIHByb3Bl
cnRpZXMKICAvLyAqIEhhbmRsZSBtZXJnZWQgcHJvcGVydGllcwogIC8vICogU2V0IHVwIF9zdXBl
ciB3cmFwcGluZyBpZiBuZWNlc3NhcnkKICAvLyAqIFNldCB1cCBjb21wdXRlZCBwcm9wZXJ0eSBk
ZXNjcmlwdG9ycwogIC8vICogQ29weWluZyBgdG9TdHJpbmdgIGluIGJyb2tlbiBicm93c2Vycwog
IG1lcmdlTWl4aW5zKG1peGlucywgbWl4aW5zTWV0YShvYmopLCBkZXNjcywgdmFsdWVzLCBvYmos
IGtleXMpOwoKICBmb3IodmFyIGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsK
ICAgIGtleSA9IGtleXNbaV07CiAgICBpZiAoa2V5ID09PSAnY29uc3RydWN0b3InIHx8ICF2YWx1
ZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgeyBjb250aW51ZTsgfQoKICAgIGRlc2MgPSBkZXNjc1tr
ZXldOwogICAgdmFsdWUgPSB2YWx1ZXNba2V5XTsKCiAgICBpZiAoZGVzYyA9PT0gUkVRVUlSRUQp
IHsgY29udGludWU7IH0KCiAgICB3aGlsZSAoZGVzYyAmJiBkZXNjIGluc3RhbmNlb2YgQWxpYXMp
IHsKICAgICAgdmFyIGZvbGxvd2VkID0gZm9sbG93QWxpYXMob2JqLCBkZXNjLCBtLCBkZXNjcywg
dmFsdWVzKTsKICAgICAgZGVzYyA9IGZvbGxvd2VkLmRlc2M7CiAgICAgIHZhbHVlID0gZm9sbG93
ZWQudmFsdWU7CiAgICB9CgogICAgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0g
dW5kZWZpbmVkKSB7IGNvbnRpbnVlOyB9CgogICAgcmVwbGFjZU9ic2VydmVyc0FuZExpc3RlbmVy
cyhvYmosIGtleSwgdmFsdWUpOwogICAgZGV0ZWN0QmluZGluZyhvYmosIGtleSwgdmFsdWUsIG0p
OwogICAgZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIGRlc2MsIHZhbHVlLCBtKTsKICB9CgogIGlm
ICghcGFydGlhbCkgeyAvLyBkb24ndCBhcHBseSB0byBwcm90b3R5cGUKICAgIGZpbmlzaFBhcnRp
YWwob2JqLCBtKTsKICB9CgogIHJldHVybiBvYmo7Cn0KCi8qKgogIEBtZXRob2QgbWl4aW4KICBA
Zm9yIEVtYmVyCiAgQHBhcmFtIG9iagogIEBwYXJhbSBtaXhpbnMqCiAgQHJldHVybiBvYmoKKi8K
RW1iZXIubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICB2YXIgYXJncyA9IGFfc2xpY2UuY2FsbChh
cmd1bWVudHMsIDEpOwogIGFwcGx5TWl4aW4ob2JqLCBhcmdzLCBmYWxzZSk7CiAgcmV0dXJuIG9i
ajsKfTsKCi8qKgogIFRoZSBgRW1iZXIuTWl4aW5gIGNsYXNzIGFsbG93cyB5b3UgdG8gY3JlYXRl
IG1peGlucywgd2hvc2UgcHJvcGVydGllcyBjYW4gYmUKICBhZGRlZCB0byBvdGhlciBjbGFzc2Vz
LiBGb3IgaW5zdGFuY2UsCgogIGBgYGphdmFzY3JpcHQKICBBcHAuRWRpdGFibGUgPSBFbWJlci5N
aXhpbi5jcmVhdGUoewogICAgZWRpdDogZnVuY3Rpb24oKSB7CiAgICAgIGNvbnNvbGUubG9nKCdz
dGFydGluZyB0byBlZGl0Jyk7CiAgICAgIHRoaXMuc2V0KCdpc0VkaXRpbmcnLCB0cnVlKTsKICAg
IH0sCiAgICBpc0VkaXRpbmc6IGZhbHNlCiAgfSk7CgogIC8vIE1peCBtaXhpbnMgaW50byBjbGFz
c2VzIGJ5IHBhc3NpbmcgdGhlbSBhcyB0aGUgZmlyc3QgYXJndW1lbnRzIHRvCiAgLy8gLmV4dGVu
ZC4KICBBcHAuQ29tbWVudFZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZChBcHAuRWRpdGFibGUsIHsK
ICAgIHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoJ3t7I2lmIHZpZXcuaXNFZGl0
aW5nfX0uLi57e2Vsc2V9fS4uLnt7L2lmfX0nKQogIH0pOwoKICBjb21tZW50VmlldyA9IEFwcC5D
b21tZW50Vmlldy5jcmVhdGUoKTsKICBjb21tZW50Vmlldy5lZGl0KCk7IC8vIG91dHB1dHMgJ3N0
YXJ0aW5nIHRvIGVkaXQnCiAgYGBgCgogIE5vdGUgdGhhdCBNaXhpbnMgYXJlIGNyZWF0ZWQgd2l0
aCBgRW1iZXIuTWl4aW4uY3JlYXRlYCwgbm90CiAgYEVtYmVyLk1peGluLmV4dGVuZGAuCgogIE5v
dGUgdGhhdCBtaXhpbnMgZXh0ZW5kIGEgY29uc3RydWN0b3IncyBwcm90b3R5cGUgc28gYXJyYXlz
IGFuZCBvYmplY3QgbGl0ZXJhbHMKICBkZWZpbmVkIGFzIHByb3BlcnRpZXMgd2lsbCBiZSBzaGFy
ZWQgYW1vbmdzdCBvYmplY3RzIHRoYXQgaW1wbGVtZW50IHRoZSBtaXhpbi4KICBJZiB5b3Ugd2Fu
dCB0byBkZWZpbmUgYW4gcHJvcGVydHkgaW4gYSBtaXhpbiB0aGF0IGlzIG5vdCBzaGFyZWQsIHlv
dSBjYW4gZGVmaW5lCiAgaXQgZWl0aGVyIGFzIGEgY29tcHV0ZWQgcHJvcGVydHkgb3IgaGF2ZSBp
dCBiZSBjcmVhdGVkIG9uIGluaXRpYWxpemF0aW9uIG9mIHRoZSBvYmplY3QuCgogIGBgYGphdmFz
Y3JpcHQKICAvL2ZpbHRlcnMgYXJyYXkgd2lsbCBiZSBzaGFyZWQgYW1vbmdzdCBhbnkgb2JqZWN0
IGltcGxlbWVudGluZyBtaXhpbgogIEFwcC5GaWx0ZXJhYmxlID0gRW1iZXIuTWl4aW4uY3JlYXRl
KHsKICAgIGZpbHRlcnM6IEVtYmVyLkEoKQogIH0pOwoKICAvL2ZpbHRlcnMgd2lsbCBiZSBhIHNl
cGFyYXRlICBhcnJheSBmb3IgZXZlcnkgb2JqZWN0IGltcGxlbWVudGluZyB0aGUgbWl4aW4KICBB
cHAuRmlsdGVyYWJsZSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CiAgICBmaWx0ZXJzOiBFbWJlci5j
b21wdXRlZChmdW5jdGlvbigpe3JldHVybiBFbWJlci5BKCk7fSkKICB9KTsKCiAgLy9maWx0ZXJz
IHdpbGwgYmUgY3JlYXRlZCBhcyBhIHNlcGFyYXRlIGFycmF5IGR1cmluZyB0aGUgb2JqZWN0J3Mg
aW5pdGlhbGl6YXRpb24KICBBcHAuRmlsdGVyYWJsZSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CiAg
ICBpbml0OiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fc3VwZXIoKTsKICAgICAgdGhpcy5zZXQo
ImZpbHRlcnMiLCBFbWJlci5BKCkpOwogICAgfQogIH0pOwogIGBgYAoKICBAY2xhc3MgTWl4aW4K
ICBAbmFtZXNwYWNlIEVtYmVyCiovCkVtYmVyLk1peGluID0gZnVuY3Rpb24oKSB7IHJldHVybiBp
bml0TWl4aW4odGhpcywgYXJndW1lbnRzKTsgfTsKCk1peGluID0gRW1iZXIuTWl4aW47CgpNaXhp
bi5wcm90b3R5cGUgPSB7CiAgcHJvcGVydGllczogbnVsbCwKICBtaXhpbnM6IG51bGwsCiAgb3du
ZXJDb25zdHJ1Y3RvcjogbnVsbAp9OwoKTWl4aW4uX2FwcGx5ID0gYXBwbHlNaXhpbjsKCk1peGlu
LmFwcGx5UGFydGlhbCA9IGZ1bmN0aW9uKG9iaikgewogIHZhciBhcmdzID0gYV9zbGljZS5jYWxs
KGFyZ3VtZW50cywgMSk7CiAgcmV0dXJuIGFwcGx5TWl4aW4ob2JqLCBhcmdzLCB0cnVlKTsKfTsK
Ck1peGluLmZpbmlzaFBhcnRpYWwgPSBmaW5pc2hQYXJ0aWFsOwoKRW1iZXIuYW55VW5wcm9jZXNz
ZWRNaXhpbnMgPSBmYWxzZTsKCi8qKgogIEBtZXRob2QgY3JlYXRlCiAgQHN0YXRpYwogIEBwYXJh
bSBhcmd1bWVudHMqCiovCk1peGluLmNyZWF0ZSA9IGZ1bmN0aW9uKCkgewogIEVtYmVyLmFueVVu
cHJvY2Vzc2VkTWl4aW5zID0gdHJ1ZTsKICB2YXIgTSA9IHRoaXM7CiAgcmV0dXJuIGluaXRNaXhp
bihuZXcgTSgpLCBhcmd1bWVudHMpOwp9OwoKdmFyIE1peGluUHJvdG90eXBlID0gTWl4aW4ucHJv
dG90eXBlOwoKLyoqCiAgQG1ldGhvZCByZW9wZW4KICBAcGFyYW0gYXJndW1lbnRzKgoqLwpNaXhp
blByb3RvdHlwZS5yZW9wZW4gPSBmdW5jdGlvbigpIHsKICB2YXIgbWl4aW4sIHRtcDsKCiAgaWYg
KHRoaXMucHJvcGVydGllcykgewogICAgbWl4aW4gPSBNaXhpbi5jcmVhdGUoKTsKICAgIG1peGlu
LnByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7CiAgICBkZWxldGUgdGhpcy5wcm9wZXJ0aWVz
OwogICAgdGhpcy5taXhpbnMgPSBbbWl4aW5dOwogIH0gZWxzZSBpZiAoIXRoaXMubWl4aW5zKSB7
CiAgICB0aGlzLm1peGlucyA9IFtdOwogIH0KCiAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgs
IG1peGlucyA9IHRoaXMubWl4aW5zLCBpZHg7CgogIGZvcihpZHg9MDsgaWR4IDwgbGVuOyBpZHgr
KykgewogICAgbWl4aW4gPSBhcmd1bWVudHNbaWR4XTsKICAgIEVtYmVyLmFzc2VydCgnRXhwZWN0
ZWQgaGFzaCBvciBNaXhpbiBpbnN0YW5jZSwgZ290ICcgKyBPYmplY3QucHJvdG90eXBlLnRvU3Ry
aW5nLmNhbGwobWl4aW4pLAogICAgICAgICAgICAgICAgIHR5cGVvZiBtaXhpbiA9PT0gJ29iamVj
dCcgJiYgbWl4aW4gIT09IG51bGwgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1p
eGluKSAhPT0gJ1tvYmplY3QgQXJyYXldJyk7CgogICAgaWYgKG1peGluIGluc3RhbmNlb2YgTWl4
aW4pIHsKICAgICAgbWl4aW5zLnB1c2gobWl4aW4pOwogICAgfSBlbHNlIHsKICAgICAgdG1wID0g
TWl4aW4uY3JlYXRlKCk7CiAgICAgIHRtcC5wcm9wZXJ0aWVzID0gbWl4aW47CiAgICAgIG1peGlu
cy5wdXNoKHRtcCk7CiAgICB9CiAgfQoKICByZXR1cm4gdGhpczsKfTsKCi8qKgogIEBtZXRob2Qg
YXBwbHkKICBAcGFyYW0gb2JqCiAgQHJldHVybiBhcHBsaWVkIG9iamVjdAoqLwpNaXhpblByb3Rv
dHlwZS5hcHBseSA9IGZ1bmN0aW9uKG9iaikgewogIHJldHVybiBhcHBseU1peGluKG9iaiwgW3Ro
aXNdLCBmYWxzZSk7Cn07CgpNaXhpblByb3RvdHlwZS5hcHBseVBhcnRpYWwgPSBmdW5jdGlvbihv
YmopIHsKICByZXR1cm4gYXBwbHlNaXhpbihvYmosIFt0aGlzXSwgdHJ1ZSk7Cn07CgpmdW5jdGlv
biBfZGV0ZWN0KGN1ck1peGluLCB0YXJnZXRNaXhpbiwgc2VlbikgewogIHZhciBndWlkID0gZ3Vp
ZEZvcihjdXJNaXhpbik7CgogIGlmIChzZWVuW2d1aWRdKSB7IHJldHVybiBmYWxzZTsgfQogIHNl
ZW5bZ3VpZF0gPSB0cnVlOwoKICBpZiAoY3VyTWl4aW4gPT09IHRhcmdldE1peGluKSB7IHJldHVy
biB0cnVlOyB9CiAgdmFyIG1peGlucyA9IGN1ck1peGluLm1peGlucywgbG9jID0gbWl4aW5zID8g
bWl4aW5zLmxlbmd0aCA6IDA7CiAgd2hpbGUgKC0tbG9jID49IDApIHsKICAgIGlmIChfZGV0ZWN0
KG1peGluc1tsb2NdLCB0YXJnZXRNaXhpbiwgc2VlbikpIHsgcmV0dXJuIHRydWU7IH0KICB9CiAg
cmV0dXJuIGZhbHNlOwp9CgovKioKICBAbWV0aG9kIGRldGVjdAogIEBwYXJhbSBvYmoKICBAcmV0
dXJuIHtCb29sZWFufQoqLwpNaXhpblByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbihvYmopIHsK
ICBpZiAoIW9iaikgeyByZXR1cm4gZmFsc2U7IH0KICBpZiAob2JqIGluc3RhbmNlb2YgTWl4aW4p
IHsgcmV0dXJuIF9kZXRlY3Qob2JqLCB0aGlzLCB7fSk7IH0KICB2YXIgbWl4aW5zID0gRW1iZXIu
bWV0YShvYmosIGZhbHNlKS5taXhpbnM7CiAgaWYgKG1peGlucykgewogICAgcmV0dXJuICEhbWl4
aW5zW2d1aWRGb3IodGhpcyldOwogIH0KICByZXR1cm4gZmFsc2U7Cn07CgpNaXhpblByb3RvdHlw
ZS53aXRob3V0ID0gZnVuY3Rpb24oKSB7CiAgdmFyIHJldCA9IG5ldyBNaXhpbih0aGlzKTsKICBy
ZXQuX3dpdGhvdXQgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzKTsKICByZXR1cm4gcmV0Owp9OwoK
ZnVuY3Rpb24gX2tleXMocmV0LCBtaXhpbiwgc2VlbikgewogIGlmIChzZWVuW2d1aWRGb3IobWl4
aW4pXSkgeyByZXR1cm47IH0KICBzZWVuW2d1aWRGb3IobWl4aW4pXSA9IHRydWU7CgogIGlmICht
aXhpbi5wcm9wZXJ0aWVzKSB7CiAgICB2YXIgcHJvcHMgPSBtaXhpbi5wcm9wZXJ0aWVzOwogICAg
Zm9yICh2YXIga2V5IGluIHByb3BzKSB7CiAgICAgIGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eShr
ZXkpKSB7IHJldFtrZXldID0gdHJ1ZTsgfQogICAgfQogIH0gZWxzZSBpZiAobWl4aW4ubWl4aW5z
KSB7CiAgICBhX2ZvckVhY2guY2FsbChtaXhpbi5taXhpbnMsIGZ1bmN0aW9uKHgpIHsgX2tleXMo
cmV0LCB4LCBzZWVuKTsgfSk7CiAgfQp9CgpNaXhpblByb3RvdHlwZS5rZXlzID0gZnVuY3Rpb24o
KSB7CiAgdmFyIGtleXMgPSB7fSwgc2VlbiA9IHt9LCByZXQgPSBbXTsKICBfa2V5cyhrZXlzLCB0
aGlzLCBzZWVuKTsKICBmb3IodmFyIGtleSBpbiBrZXlzKSB7CiAgICBpZiAoa2V5cy5oYXNPd25Q
cm9wZXJ0eShrZXkpKSB7IHJldC5wdXNoKGtleSk7IH0KICB9CiAgcmV0dXJuIHJldDsKfTsKCi8v
IHJldHVybnMgdGhlIG1peGlucyBjdXJyZW50bHkgYXBwbGllZCB0byB0aGUgc3BlY2lmaWVkIG9i
amVjdAovLyBUT0RPOiBNYWtlIEVtYmVyLm1peGluCk1peGluLm1peGlucyA9IGZ1bmN0aW9uKG9i
aikgewogIHZhciBtaXhpbnMgPSBFbWJlci5tZXRhKG9iaiwgZmFsc2UpLm1peGlucywgcmV0ID0g
W107CgogIGlmICghbWl4aW5zKSB7IHJldHVybiByZXQ7IH0KCiAgZm9yICh2YXIga2V5IGluIG1p
eGlucykgewogICAgdmFyIG1peGluID0gbWl4aW5zW2tleV07CgogICAgLy8gc2tpcCBwcmltaXRp
dmUgbWl4aW5zIHNpbmNlIHRoZXNlIGFyZSBhbHdheXMgYW5vbnltb3VzCiAgICBpZiAoIW1peGlu
LnByb3BlcnRpZXMpIHsgcmV0LnB1c2gobWl4aW4pOyB9CiAgfQoKICByZXR1cm4gcmV0Owp9OwoK
UkVRVUlSRUQgPSBuZXcgRW1iZXIuRGVzY3JpcHRvcigpOwpSRVFVSVJFRC50b1N0cmluZyA9IGZ1
bmN0aW9uKCkgeyByZXR1cm4gJyhSZXF1aXJlZCBQcm9wZXJ0eSknOyB9OwoKLyoqCiAgRGVub3Rl
cyBhIHJlcXVpcmVkIHByb3BlcnR5IGZvciBhIG1peGluCgogIEBtZXRob2QgcmVxdWlyZWQKICBA
Zm9yIEVtYmVyCiovCkVtYmVyLnJlcXVpcmVkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIFJFUVVJ
UkVEOwp9OwoKQWxpYXMgPSBmdW5jdGlvbihtZXRob2ROYW1lKSB7CiAgdGhpcy5tZXRob2ROYW1l
ID0gbWV0aG9kTmFtZTsKfTsKQWxpYXMucHJvdG90eXBlID0gbmV3IEVtYmVyLkRlc2NyaXB0b3Io
KTsKCi8qKgogIE1ha2VzIGEgcHJvcGVydHkgb3IgbWV0aG9kIGF2YWlsYWJsZSB2aWEgYW4gYWRk
aXRpb25hbCBuYW1lLgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLlBhaW50U2FtcGxlID0gRW1iZXIu
T2JqZWN0LmV4dGVuZCh7CiAgICBjb2xvcjogJ3JlZCcsCiAgICBjb2xvdXI6IEVtYmVyLmFsaWFz
KCdjb2xvcicpLAogICAgbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAiWmVkIjsKICAg
IH0sCiAgICBtb25pa2VyOiBFbWJlci5hbGlhcygibmFtZSIpCiAgfSk7CgogIHZhciBwYWludFNh
bXBsZSA9IEFwcC5QYWludFNhbXBsZS5jcmVhdGUoKQogIHBhaW50U2FtcGxlLmdldCgnY29sb3Vy
Jyk7ICAvLyAncmVkJwogIHBhaW50U2FtcGxlLm1vbmlrZXIoKTsgICAgICAvLyAnWmVkJwogIGBg
YAoKICBAbWV0aG9kIGFsaWFzCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBtZXRob2RO
YW1lIG5hbWUgb2YgdGhlIG1ldGhvZCBvciBwcm9wZXJ0eSB0byBhbGlhcwogIEByZXR1cm4ge0Vt
YmVyLkRlc2NyaXB0b3J9CiAgQGRlcHJlY2F0ZWQgVXNlIGBFbWJlci5hbGlhc01ldGhvZGAgb3Ig
YEVtYmVyLmNvbXB1dGVkLmFsaWFzYCBpbnN0ZWFkCiovCkVtYmVyLmFsaWFzID0gZnVuY3Rpb24o
bWV0aG9kTmFtZSkgewogIEVtYmVyLmRlcHJlY2F0ZSgiRW1iZXIuYWxpYXMgaXMgZGVwcmVjYXRl
ZC4gUGxlYXNlIHVzZSBFbWJlci5hbGlhc01ldGhvZCBvciBFbWJlci5jb21wdXRlZC5hbGlhcyBp
bnN0ZWFkLiIpOwogIHJldHVybiBuZXcgQWxpYXMobWV0aG9kTmFtZSk7Cn07CgovKioKICBNYWtl
cyBhIG1ldGhvZCBhdmFpbGFibGUgdmlhIGFuIGFkZGl0aW9uYWwgbmFtZS4KCiAgYGBgamF2YXNj
cmlwdAogIEFwcC5QZXJzb24gPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIG5hbWU6IGZ1bmN0
aW9uKCkgewogICAgICByZXR1cm4gJ1RvbWh1ZGEgS2F0emRhbGUnOwogICAgfSwKICAgIG1vbmlr
ZXI6IEVtYmVyLmFsaWFzTWV0aG9kKCduYW1lJykKICB9KTsKCiAgdmFyIGdvb2RHdXkgPSBBcHAu
UGVyc29uLmNyZWF0ZSgpCiAgYGBgCgogIEBtZXRob2QgYWxpYXNNZXRob2QKICBAZm9yIEVtYmVy
CiAgQHBhcmFtIHtTdHJpbmd9IG1ldGhvZE5hbWUgbmFtZSBvZiB0aGUgbWV0aG9kIHRvIGFsaWFz
CiAgQHJldHVybiB7RW1iZXIuRGVzY3JpcHRvcn0KKi8KRW1iZXIuYWxpYXNNZXRob2QgPSBmdW5j
dGlvbihtZXRob2ROYW1lKSB7CiAgcmV0dXJuIG5ldyBBbGlhcyhtZXRob2ROYW1lKTsKfTsKCi8v
IC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4KLy8gT0JTRVJWRVIgSEVMUEVSCi8vCgovKioKICBTcGVjaWZ5IGEgbWV0aG9kIHRoYXQgb2Jz
ZXJ2ZXMgcHJvcGVydHkgY2hhbmdlcy4KCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLk9iamVjdC5l
eHRlbmQoewogICAgdmFsdWVPYnNlcnZlcjogRW1iZXIub2JzZXJ2ZXIoJ3ZhbHVlJywgZnVuY3Rp
b24oKSB7CiAgICAgIC8vIEV4ZWN1dGVzIHdoZW5ldmVyIHRoZSAidmFsdWUiIHByb3BlcnR5IGNo
YW5nZXMKICAgIH0pCiAgfSk7CiAgYGBgCgogIEluIHRoZSBmdXR1cmUgdGhpcyBtZXRob2QgbWF5
IGJlY29tZSBhc3luY2hyb25vdXMuIElmIHlvdSB3YW50IHRvIGVuc3VyZQogIHN5bmNocm9ub3Vz
IGJlaGF2aW9yLCB1c2UgYGltbWVkaWF0ZU9ic2VydmVyYC4KCiAgQWxzbyBhdmFpbGFibGUgYXMg
YEZ1bmN0aW9uLnByb3RvdHlwZS5vYnNlcnZlc2AgaWYgcHJvdG90eXBlIGV4dGVuc2lvbnMgYXJl
CiAgZW5hYmxlZC4KCiAgQG1ldGhvZCBvYnNlcnZlcgogIEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0
cmluZ30gcHJvcGVydHlOYW1lcyoKICBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jCiAgQHJldHVybiBm
dW5jCiovCkVtYmVyLm9ic2VydmVyID0gZnVuY3Rpb24oKSB7CiAgdmFyIGZ1bmMgID0gYV9zbGlj
ZS5jYWxsKGFyZ3VtZW50cywgLTEpWzBdOwogIHZhciBwYXRoczsKCiAgCiAgICBwYXRocyA9IGFf
c2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIC0xKTsKCiAgICBpZiAodHlwZW9mIGZ1bmMgIT09ICJm
dW5jdGlvbiIpIHsKICAgICAgLy8gcmV2ZXJ0IHRvIG9sZCwgc29mdC1kZXByZWNhdGVkIGFyZ3Vt
ZW50IG9yZGVyaW5nCgogICAgICBmdW5jICA9IGFyZ3VtZW50c1swXTsKICAgICAgcGF0aHMgPSBh
X3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIH0KICAKCiAgaWYgKHR5cGVvZiBmdW5jICE9
PSAiZnVuY3Rpb24iKSB7CiAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoIkVtYmVyLm9ic2VydmVy
IGNhbGxlZCB3aXRob3V0IGEgZnVuY3Rpb24iKTsKICB9CgogIGZ1bmMuX19lbWJlcl9vYnNlcnZl
c19fID0gcGF0aHM7CiAgcmV0dXJuIGZ1bmM7Cn07CgovKioKICBTcGVjaWZ5IGEgbWV0aG9kIHRo
YXQgb2JzZXJ2ZXMgcHJvcGVydHkgY2hhbmdlcy4KCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLk9i
amVjdC5leHRlbmQoewogICAgdmFsdWVPYnNlcnZlcjogRW1iZXIuaW1tZWRpYXRlT2JzZXJ2ZXIo
J3ZhbHVlJywgZnVuY3Rpb24oKSB7CiAgICAgIC8vIEV4ZWN1dGVzIHdoZW5ldmVyIHRoZSAidmFs
dWUiIHByb3BlcnR5IGNoYW5nZXMKICAgIH0pCiAgfSk7CiAgYGBgCgogIEluIHRoZSBmdXR1cmUs
IGBFbWJlci5vYnNlcnZlcmAgbWF5IGJlY29tZSBhc3luY2hyb25vdXMuIEluIHRoaXMgZXZlbnQs
CiAgYEVtYmVyLmltbWVkaWF0ZU9ic2VydmVyYCB3aWxsIG1haW50YWluIHRoZSBzeW5jaHJvbm91
cyBiZWhhdmlvci4KCiAgQWxzbyBhdmFpbGFibGUgYXMgYEZ1bmN0aW9uLnByb3RvdHlwZS5vYnNl
cnZlc0ltbWVkaWF0ZWx5YCBpZiBwcm90b3R5cGUgZXh0ZW5zaW9ucyBhcmUKICBlbmFibGVkLgoK
ICBAbWV0aG9kIGltbWVkaWF0ZU9ic2VydmVyCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5n
fSBwcm9wZXJ0eU5hbWVzKgogIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMKICBAcmV0dXJuIGZ1bmMK
Ki8KRW1iZXIuaW1tZWRpYXRlT2JzZXJ2ZXIgPSBmdW5jdGlvbigpIHsKICBmb3IgKHZhciBpPTAs
IGw9YXJndW1lbnRzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgIHZhciBhcmcgPSBhcmd1bWVudHNb
aV07CiAgICBFbWJlci5hc3NlcnQoIkltbWVkaWF0ZSBvYnNlcnZlcnMgbXVzdCBvYnNlcnZlIGlu
dGVybmFsIHByb3BlcnRpZXMgb25seSwgbm90IHByb3BlcnRpZXMgb24gb3RoZXIgb2JqZWN0cy4i
LCB0eXBlb2YgYXJnICE9PSAic3RyaW5nIiB8fCBhcmcuaW5kZXhPZignLicpID09PSAtMSk7CiAg
fQoKICByZXR1cm4gRW1iZXIub2JzZXJ2ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKCi8q
KgogIFdoZW4gb2JzZXJ2ZXJzIGZpcmUsIHRoZXkgYXJlIGNhbGxlZCB3aXRoIHRoZSBhcmd1bWVu
dHMgYG9iamAsIGBrZXlOYW1lYC4KCiAgTm90ZSwgYEBlYWNoLnByb3BlcnR5YCBvYnNlcnZlciBp
cyBjYWxsZWQgcGVyIGVhY2ggYWRkIG9yIHJlcGxhY2Ugb2YgYW4gZWxlbWVudAogIGFuZCBpdCdz
IG5vdCBjYWxsZWQgd2l0aCBhIHNwZWNpZmljIGVudW1lcmF0aW9uIGl0ZW0uCgogIEEgYGJlZm9y
ZU9ic2VydmVyYCBmaXJlcyBiZWZvcmUgYSBwcm9wZXJ0eSBjaGFuZ2VzLgoKICBBIGBiZWZvcmVP
YnNlcnZlcmAgaXMgYW4gYWx0ZXJuYXRpdmUgZm9ybSBvZiBgLm9ic2VydmVzQmVmb3JlKClgLgoK
ICBgYGBqYXZhc2NyaXB0CiAgQXBwLlBlcnNvblZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7Cgog
ICAgZnJpZW5kczogW3sgbmFtZTogJ1RvbScgfSwgeyBuYW1lOiAnU3RlZmFuJyB9LCB7IG5hbWU6
ICdLcmlzJyB9XSwKCiAgICB2YWx1ZVdpbGxDaGFuZ2U6IEVtYmVyLmJlZm9yZU9ic2VydmVyKCdj
b250ZW50LnZhbHVlJywgZnVuY3Rpb24ob2JqLCBrZXlOYW1lKSB7CiAgICAgIHRoaXMuY2hhbmdp
bmdGcm9tID0gb2JqLmdldChrZXlOYW1lKTsKICAgIH0pLAoKICAgIHZhbHVlRGlkQ2hhbmdlOiBF
bWJlci5vYnNlcnZlcignY29udGVudC52YWx1ZScsIGZ1bmN0aW9uKG9iaiwga2V5TmFtZSkgewog
ICAgICAgIC8vIG9ubHkgcnVuIGlmIHVwZGF0aW5nIGEgdmFsdWUgYWxyZWFkeSBpbiB0aGUgRE9N
CiAgICAgICAgaWYgKHRoaXMuZ2V0KCdzdGF0ZScpID09PSAnaW5ET00nKSB7CiAgICAgICAgICB2
YXIgY29sb3IgPSBvYmouZ2V0KGtleU5hbWUpID4gdGhpcy5jaGFuZ2luZ0Zyb20gPyAnZ3JlZW4n
IDogJ3JlZCc7CiAgICAgICAgICAvLyBsb2dpYwogICAgICAgIH0KICAgIH0pLAoKICAgIGZyaWVu
ZHNEaWRDaGFuZ2U6IEVtYmVyLm9ic2VydmVyKCdmcmllbmRzLkBlYWNoLm5hbWUnLCBmdW5jdGlv
bihvYmosIGtleU5hbWUpIHsKICAgICAgLy8gc29tZSBsb2dpYwogICAgICAvLyBvYmouZ2V0KGtl
eU5hbWUpIHJldHVybnMgZnJpZW5kcyBhcnJheQogICAgfSkKICB9KTsKICBgYGAKCiAgQWxzbyBh
dmFpbGFibGUgYXMgYEZ1bmN0aW9uLnByb3RvdHlwZS5vYnNlcnZlc0JlZm9yZWAgaWYgcHJvdG90
eXBlIGV4dGVuc2lvbnMgYXJlCiAgZW5hYmxlZC4KCiAgQG1ldGhvZCBiZWZvcmVPYnNlcnZlcgog
IEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlOYW1lcyoKICBAcGFyYW0ge0Z1
bmN0aW9ufSBmdW5jCiAgQHJldHVybiBmdW5jCiovCkVtYmVyLmJlZm9yZU9ic2VydmVyID0gZnVu
Y3Rpb24oKSB7CiAgdmFyIGZ1bmMgID0gYV9zbGljZS5jYWxsKGFyZ3VtZW50cywgLTEpWzBdOwog
IHZhciBwYXRoczsKCiAgCiAgICBwYXRocyA9IGFfc2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIC0x
KTsKCiAgICBpZiAodHlwZW9mIGZ1bmMgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgLy8gcmV2ZXJ0
IHRvIG9sZCwgc29mdC1kZXByZWNhdGVkIGFyZ3VtZW50IG9yZGVyaW5nCgogICAgICBmdW5jICA9
IGFyZ3VtZW50c1swXTsKICAgICAgcGF0aHMgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsK
ICAgIH0KICAKCiAgaWYgKHR5cGVvZiBmdW5jICE9PSAiZnVuY3Rpb24iKSB7CiAgICB0aHJvdyBu
ZXcgRW1iZXIuRXJyb3IoIkVtYmVyLmJlZm9yZU9ic2VydmVyIGNhbGxlZCB3aXRob3V0IGEgZnVu
Y3Rpb24iKTsKICB9CgogIGZ1bmMuX19lbWJlcl9vYnNlcnZlc0JlZm9yZV9fID0gcGF0aHM7CiAg
cmV0dXJuIGZ1bmM7Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8vIFByb3ZpZGVzIGEgd2F5
IHRvIHJlZ2lzdGVyIGxpYnJhcnkgdmVyc2lvbnMgd2l0aCBlbWJlci4KdmFyIGZvckVhY2ggPSBF
bWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaCwKICAgIGluZGV4T2YgPSBFbWJlci5FbnVtZXJh
YmxlVXRpbHMuaW5kZXhPZjsKCkVtYmVyLmxpYnJhcmllcyA9IGZ1bmN0aW9uKCkgewogIHZhciBs
aWJyYXJpZXMgICAgPSBbXTsKICB2YXIgY29yZUxpYkluZGV4ID0gMDsKCiAgdmFyIGdldExpYnJh
cnkgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpYnJhcmllcy5s
ZW5ndGg7IGkrKykgewogICAgICBpZiAobGlicmFyaWVzW2ldLm5hbWUgPT09IG5hbWUpIHsKICAg
ICAgICByZXR1cm4gbGlicmFyaWVzW2ldOwogICAgICB9CiAgICB9CiAgfTsKCiAgbGlicmFyaWVz
LnJlZ2lzdGVyID0gZnVuY3Rpb24obmFtZSwgdmVyc2lvbikgewogICAgaWYgKCFnZXRMaWJyYXJ5
KG5hbWUpKSB7CiAgICAgIGxpYnJhcmllcy5wdXNoKHtuYW1lOiBuYW1lLCB2ZXJzaW9uOiB2ZXJz
aW9ufSk7CiAgICB9CiAgfTsKCiAgbGlicmFyaWVzLnJlZ2lzdGVyQ29yZUxpYnJhcnkgPSBmdW5j
dGlvbihuYW1lLCB2ZXJzaW9uKSB7CiAgICBpZiAoIWdldExpYnJhcnkobmFtZSkpIHsKICAgICAg
bGlicmFyaWVzLnNwbGljZShjb3JlTGliSW5kZXgrKywgMCwge25hbWU6IG5hbWUsIHZlcnNpb246
IHZlcnNpb259KTsKICAgIH0KICB9OwoKICBsaWJyYXJpZXMuZGVSZWdpc3RlciA9IGZ1bmN0aW9u
KG5hbWUpIHsKICAgIHZhciBsaWIgPSBnZXRMaWJyYXJ5KG5hbWUpOwogICAgaWYgKGxpYikgbGli
cmFyaWVzLnNwbGljZShpbmRleE9mKGxpYnJhcmllcywgbGliKSwgMSk7CiAgfTsKCiAgbGlicmFy
aWVzLmVhY2ggPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIGZvckVhY2gobGlicmFyaWVzLCBm
dW5jdGlvbihsaWIpIHsKICAgICAgY2FsbGJhY2sobGliLm5hbWUsIGxpYi52ZXJzaW9uKTsKICAg
IH0pOwogIH07CgogIHJldHVybiBsaWJyYXJpZXM7Cn0oKTsKCkVtYmVyLmxpYnJhcmllcy5yZWdp
c3RlckNvcmVMaWJyYXJ5KCdFbWJlcicsIEVtYmVyLlZFUlNJT04pOwoKfSkoKTsKCgoKKGZ1bmN0
aW9uKCkgewovKioKRW1iZXIgTWV0YWwKCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1t
ZXRhbAoqLwoKfSkoKTsKCihmdW5jdGlvbigpIHsKLyoqCiAgQGNsYXNzIFJTVlAKICBAbW9kdWxl
IFJTVlAKICAqLwpkZWZpbmUoInJzdnAvYWxsIiwgCiAgWyIuL3Byb21pc2UiLCJleHBvcnRzIl0s
CiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJp
Y3QiOwogICAgdmFyIFByb21pc2UgPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKCiAgICAv
KioKICAgICAgVGhpcyBpcyBhIGNvbnZlbmllbnQgYWxpYXMgZm9yIGBSU1ZQLlByb21pc2UuYWxs
YC4KCiAgICAgIEBtZXRob2QgYWxsCiAgICAgIEBmb3IgUlNWUAogICAgICBAcGFyYW0ge0FycmF5
fSBhcnJheSBBcnJheSBvZiBwcm9taXNlcy4KICAgICAgQHBhcmFtIHtTdHJpbmd9IGxhYmVsIEFu
IG9wdGlvbmFsIGxhYmVsLiBUaGlzIGlzIHVzZWZ1bAogICAgICBmb3IgdG9vbGluZy4KICAgICAg
QHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBhbGwo
YXJyYXksIGxhYmVsKSB7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbChhcnJheSwgbGFiZWwpOwog
ICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL2FsbF9zZXR0bGVkIiwgCiAgWyIuL3Byb21pc2UiLCIu
L3V0aWxzIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRl
bmN5Ml9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIFByb21pc2Ug
PSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKICAgIHZhciBpc0FycmF5ID0gX19kZXBlbmRl
bmN5Ml9fLmlzQXJyYXk7CiAgICB2YXIgaXNOb25UaGVuYWJsZSA9IF9fZGVwZW5kZW5jeTJfXy5p
c05vblRoZW5hYmxlOwoKICAgIC8qKgogICAgICBgUlNWUC5hbGxTZXR0bGVkYCBpcyBzaW1pbGFy
IHRvIGBSU1ZQLmFsbGAsIGJ1dCBpbnN0ZWFkIG9mIGltcGxlbWVudGluZwogICAgICBhIGZhaWwt
ZmFzdCBtZXRob2QsIGl0IHdhaXRzIHVudGlsIGFsbCB0aGUgcHJvbWlzZXMgaGF2ZSByZXR1cm5l
ZCBhbmQKICAgICAgc2hvd3MgeW91IGFsbCB0aGUgcmVzdWx0cy4gVGhpcyBpcyB1c2VmdWwgaWYg
eW91IHdhbnQgdG8gaGFuZGxlIG11bHRpcGxlCiAgICAgIHByb21pc2VzJyBmYWlsdXJlIHN0YXRl
cyB0b2dldGhlciBhcyBhIHNldC4KCiAgICAgIFJldHVybnMgYSBwcm9taXNlIHRoYXQgaXMgZnVs
ZmlsbGVkIHdoZW4gYWxsIHRoZSBnaXZlbiBwcm9taXNlcyBoYXZlIGJlZW4KICAgICAgc2V0dGxl
ZC4gVGhlIHJldHVybiBwcm9taXNlIGlzIGZ1bGZpbGxlZCB3aXRoIGFuIGFycmF5IG9mIHRoZSBz
dGF0ZXMgb2YKICAgICAgdGhlIHByb21pc2VzIHBhc3NlZCBpbnRvIHRoZSBgcHJvbWlzZXNgIGFy
cmF5IGFyZ3VtZW50LgoKICAgICAgRWFjaCBzdGF0ZSBvYmplY3Qgd2lsbCBlaXRoZXIgaW5kaWNh
dGUgZnVsZmlsbG1lbnQgb3IgcmVqZWN0aW9uLCBhbmQKICAgICAgcHJvdmlkZSB0aGUgY29ycmVz
cG9uZGluZyB2YWx1ZSBvciByZWFzb24uIFRoZSBzdGF0ZXMgd2lsbCB0YWtlIG9uZSBvZgogICAg
ICB0aGUgZm9sbG93aW5nIGZvcm1hdHM6CgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHsgc3Rh
dGU6ICdmdWxmaWxsZWQnLCB2YWx1ZTogdmFsdWUgfQogICAgICAgIG9yCiAgICAgIHsgc3RhdGU6
ICdyZWplY3RlZCcsIHJlYXNvbjogcmVhc29uIH0KICAgICAgYGBgCgogICAgICBFeGFtcGxlOgoK
ICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIgcHJvbWlzZTEgPSBSU1ZQLlByb21pc2UucmVz
b2x2ZSgxKTsKICAgICAgdmFyIHByb21pc2UyID0gUlNWUC5Qcm9taXNlLnJlamVjdChuZXcgRXJy
b3IoJzInKSk7CiAgICAgIHZhciBwcm9taXNlMyA9IFJTVlAuUHJvbWlzZS5yZWplY3QobmV3IEVy
cm9yKCczJykpOwogICAgICB2YXIgcHJvbWlzZXMgPSBbIHByb21pc2UxLCBwcm9taXNlMiwgcHJv
bWlzZTMgXTsKCiAgICAgIFJTVlAuYWxsU2V0dGxlZChwcm9taXNlcykudGhlbihmdW5jdGlvbihh
cnJheSl7CiAgICAgICAgLy8gYXJyYXkgPT0gWwogICAgICAgIC8vICAgeyBzdGF0ZTogJ2Z1bGZp
bGxlZCcsIHZhbHVlOiAxIH0sCiAgICAgICAgLy8gICB7IHN0YXRlOiAncmVqZWN0ZWQnLCByZWFz
b246IEVycm9yIH0sCiAgICAgICAgLy8gICB7IHN0YXRlOiAncmVqZWN0ZWQnLCByZWFzb246IEVy
cm9yIH0KICAgICAgICAvLyBdCiAgICAgICAgLy8gTm90ZSB0aGF0IGZvciB0aGUgc2Vjb25kIGl0
ZW0sIHJlYXNvbi5tZXNzYWdlIHdpbGwgYmUgIjIiLCBhbmQgZm9yIHRoZQogICAgICAgIC8vIHRo
aXJkIGl0ZW0sIHJlYXNvbi5tZXNzYWdlIHdpbGwgYmUgIjMiLgogICAgICB9LCBmdW5jdGlvbihl
cnJvcikgewogICAgICAgIC8vIE5vdCBydW4uIChUaGlzIGJsb2NrIHdvdWxkIG9ubHkgYmUgY2Fs
bGVkIGlmIGFsbFNldHRsZWQgaGFkIGZhaWxlZCwKICAgICAgICAvLyBmb3IgaW5zdGFuY2UgaWYg
cGFzc2VkIGFuIGluY29ycmVjdCBhcmd1bWVudCB0eXBlLikKICAgICAgfSk7CiAgICAgIGBgYAoK
ICAgICAgQG1ldGhvZCBhbGxTZXR0bGVkCiAgICAgIEBmb3IgUlNWUAogICAgICBAcGFyYW0ge0Fy
cmF5fSBwcm9taXNlcwogICAgICBAcGFyYW0ge1N0cmluZ30gbGFiZWwgLSBvcHRpb25hbCBzdHJp
bmcgdGhhdCBkZXNjcmliZXMgdGhlIHByb21pc2UuCiAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4K
ICAgICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSB0aGF0IGlzIGZ1bGZpbGxlZCB3aXRoIGFu
IGFycmF5IG9mIHRoZSBzZXR0bGVkCiAgICAgIHN0YXRlcyBvZiB0aGUgY29uc3RpdHVlbnQgcHJv
bWlzZXMuCiAgICAgIEBzdGF0aWMKICAgICovCgogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9
IGZ1bmN0aW9uIGFsbFNldHRsZWQoZW50cmllcywgbGFiZWwpIHsKICAgICAgcmV0dXJuIG5ldyBQ
cm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmICghaXNBcnJheShl
bnRyaWVzKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignWW91IG11c3QgcGFzcyBh
biBhcnJheSB0byBhbGxTZXR0bGVkLicpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlbWFpbmlu
ZyA9IGVudHJpZXMubGVuZ3RoOwogICAgICAgIHZhciBlbnRyeTsKCiAgICAgICAgaWYgKHJlbWFp
bmluZyA9PT0gMCkgewogICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICByZXR1cm47CiAg
ICAgICAgfQoKICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShyZW1haW5pbmcpOwoKICAg
ICAgICBmdW5jdGlvbiBmdWxmaWxsZWRSZXNvbHZlcihpbmRleCkgewogICAgICAgICAgcmV0dXJu
IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHJlc29sdmVBbGwoaW5kZXgsIGZ1bGZpbGxl
ZCh2YWx1ZSkpOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlamVj
dGVkUmVzb2x2ZXIoaW5kZXgpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihyZWFzb24pIHsK
ICAgICAgICAgICAgcmVzb2x2ZUFsbChpbmRleCwgcmVqZWN0ZWQocmVhc29uKSk7CiAgICAgICAg
ICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZUFsbChpbmRleCwgdmFsdWUp
IHsKICAgICAgICAgIHJlc3VsdHNbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICBpZiAoLS1yZW1h
aW5pbmcgPT09IDApIHsKICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHRzKTsKICAgICAgICAgIH0K
ICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBlbnRyaWVzLmxl
bmd0aDsgaW5kZXgrKykgewogICAgICAgICAgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKCiAgICAg
ICAgICBpZiAoaXNOb25UaGVuYWJsZShlbnRyeSkpIHsKICAgICAgICAgICAgcmVzb2x2ZUFsbChp
bmRleCwgZnVsZmlsbGVkKGVudHJ5KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBQ
cm9taXNlLmNhc3QoZW50cnkpLnRoZW4oZnVsZmlsbGVkUmVzb2x2ZXIoaW5kZXgpLCByZWplY3Rl
ZFJlc29sdmVyKGluZGV4KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBsYWJlbCk7
CiAgICB9OwoKICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgewogICAgICByZXR1cm4geyBz
dGF0ZTogJ2Z1bGZpbGxlZCcsIHZhbHVlOiB2YWx1ZSB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHJl
amVjdGVkKHJlYXNvbikgewogICAgICByZXR1cm4geyBzdGF0ZTogJ3JlamVjdGVkJywgcmVhc29u
OiByZWFzb24gfTsKICAgIH0KICB9KTsKZGVmaW5lKCJyc3ZwL2NvbmZpZyIsIAogIFsiLi9ldmVu
dHMiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykg
ewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIEV2ZW50VGFyZ2V0ID0gX19kZXBlbmRlbmN5MV9f
WyJkZWZhdWx0Il07CgogICAgdmFyIGNvbmZpZyA9IHsKICAgICAgaW5zdHJ1bWVudDogZmFsc2UK
ICAgIH07CgogICAgRXZlbnRUYXJnZXQubWl4aW4oY29uZmlnKTsKCiAgICBmdW5jdGlvbiBjb25m
aWd1cmUobmFtZSwgdmFsdWUpIHsKICAgICAgaWYgKG5hbWUgPT09ICdvbmVycm9yJykgewogICAg
ICAgIC8vIGhhbmRsZSBmb3IgbGVnYWN5IHVzZXJzIHRoYXQgZXhwZWN0IHRoZSBhY3R1YWwKICAg
ICAgICAvLyBlcnJvciB0byBiZSBwYXNzZWQgdG8gdGhlaXIgZnVuY3Rpb24gYWRkZWQgdmlhCiAg
ICAgICAgLy8gYFJTVlAuY29uZmlndXJlKCdvbmVycm9yJywgc29tZUZ1bmN0aW9uSGVyZSk7YAog
ICAgICAgIGNvbmZpZy5vbignZXJyb3InLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9
CgogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgIGNvbmZpZ1tuYW1l
XSA9IHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjb25maWdbbmFtZV07CiAg
ICAgIH0KICAgIH0KCiAgICBfX2V4cG9ydHNfXy5jb25maWcgPSBjb25maWc7CiAgICBfX2V4cG9y
dHNfXy5jb25maWd1cmUgPSBjb25maWd1cmU7CiAgfSk7CmRlZmluZSgicnN2cC9kZWZlciIsIAog
IFsiLi9wcm9taXNlIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19l
eHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBQcm9taXNlID0gX19kZXBlbmRl
bmN5MV9fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIGBSU1ZQLmRlZmVyYCByZXR1cm5zIGFu
IG9iamVjdCBzaW1pbGFyIHRvIGpRdWVyeSdzIGAkLkRlZmVycmVkYC4KICAgICAgYFJTVlAuZGVm
ZXJgIHNob3VsZCBiZSB1c2VkIHdoZW4gcG9ydGluZyBvdmVyIGNvZGUgcmVsaWFudCBvbiBgJC5E
ZWZlcnJlZGAncwogICAgICBpbnRlcmZhY2UuIE5ldyBjb2RlIHNob3VsZCB1c2UgdGhlIGBSU1ZQ
LlByb21pc2VgIGNvbnN0cnVjdG9yIGluc3RlYWQuCgogICAgICBUaGUgb2JqZWN0IHJldHVybmVk
IGZyb20gYFJTVlAuZGVmZXJgIGlzIGEgcGxhaW4gb2JqZWN0IHdpdGggdGhyZWUgcHJvcGVydGll
czoKCiAgICAgICogcHJvbWlzZSAtIGFuIGBSU1ZQLlByb21pc2VgLgogICAgICAqIHJlamVjdCAt
IGEgZnVuY3Rpb24gdGhhdCBjYXVzZXMgdGhlIGBwcm9taXNlYCBwcm9wZXJ0eSBvbiB0aGlzIG9i
amVjdCB0bwogICAgICAgIGJlY29tZSByZWplY3RlZAogICAgICAqIHJlc29sdmUgLSBhIGZ1bmN0
aW9uIHRoYXQgY2F1c2VzIHRoZSBgcHJvbWlzZWAgcHJvcGVydHkgb24gdGhpcyBvYmplY3QgdG8K
ICAgICAgICBiZWNvbWUgZnVsZmlsbGVkLgoKICAgICAgRXhhbXBsZToKCiAgICAgICBgYGBqYXZh
c2NyaXB0CiAgICAgICB2YXIgZGVmZXJyZWQgPSBSU1ZQLmRlZmVyKCk7CgogICAgICAgZGVmZXJy
ZWQucmVzb2x2ZSgiU3VjY2VzcyEiKTsKCiAgICAgICBkZWZlcmVkLnByb21pc2UudGhlbihmdW5j
dGlvbih2YWx1ZSl7CiAgICAgICAgIC8vIHZhbHVlIGhlcmUgaXMgIlN1Y2Nlc3MhIgogICAgICAg
fSk7CiAgICAgICBgYGAKCiAgICAgIEBtZXRob2QgZGVmZXIKICAgICAgQGZvciBSU1ZQCiAgICAg
IEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJpbmcgZm9yIGxhYmVsaW5nIHRoZSBw
cm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgIEByZXR1cm4ge09iamVjdH0K
ICAgICAqLwoKICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBkZWZlcihsYWJl
bCkgewogICAgICB2YXIgZGVmZXJyZWQgPSB7IH07CgogICAgICBkZWZlcnJlZC5wcm9taXNlID0g
bmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgZGVmZXJyZWQu
cmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgZGVmZXJyZWQucmVqZWN0ID0gcmVqZWN0OwogICAg
ICB9LCBsYWJlbCk7CgogICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9OwogIH0pOwpkZWZpbmUo
InJzdnAvZXZlbnRzIiwgCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsK
ICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBpbmRleE9mID0gZnVuY3Rpb24oY2FsbGJhY2tzLCBj
YWxsYmFjaykgewogICAgICBmb3IgKHZhciBpPTAsIGw9Y2FsbGJhY2tzLmxlbmd0aDsgaTxsOyBp
KyspIHsKICAgICAgICBpZiAoY2FsbGJhY2tzW2ldID09PSBjYWxsYmFjaykgeyByZXR1cm4gaTsg
fQogICAgICB9CgogICAgICByZXR1cm4gLTE7CiAgICB9OwoKICAgIHZhciBjYWxsYmFja3NGb3Ig
PSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgdmFyIGNhbGxiYWNrcyA9IG9iamVjdC5fcHJvbWlz
ZUNhbGxiYWNrczsKCiAgICAgIGlmICghY2FsbGJhY2tzKSB7CiAgICAgICAgY2FsbGJhY2tzID0g
b2JqZWN0Ll9wcm9taXNlQ2FsbGJhY2tzID0ge307CiAgICAgIH0KCiAgICAgIHJldHVybiBjYWxs
YmFja3M7CiAgICB9OwoKICAgIC8qKgogICAgICBAY2xhc3MgUlNWUC5FdmVudFRhcmdldAogICAg
Ki8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSB7CgogICAgICAvKioKICAgICAgICBgUlNW
UC5FdmVudFRhcmdldC5taXhpbmAgZXh0ZW5kcyBhbiBvYmplY3Qgd2l0aCBFdmVudFRhcmdldCBt
ZXRob2RzLiBGb3IKICAgICAgICBFeGFtcGxlOgoKICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAg
ICAgdmFyIG9iamVjdCA9IHt9OwoKICAgICAgICBSU1ZQLkV2ZW50VGFyZ2V0Lm1peGluKG9iamVj
dCk7CgogICAgICAgIG9iamVjdC5vbigiZmluaXNoZWQiLCBmdW5jdGlvbihldmVudCkgewogICAg
ICAgICAgLy8gaGFuZGxlIGV2ZW50CiAgICAgICAgfSk7CgogICAgICAgIG9iamVjdC50cmlnZ2Vy
KCJmaW5pc2hlZCIsIHsgZGV0YWlsOiB2YWx1ZSB9KTsKICAgICAgICBgYGAKCiAgICAgICAgYEV2
ZW50VGFyZ2V0Lm1peGluYCBhbHNvIHdvcmtzIHdpdGggcHJvdG90eXBlczoKCiAgICAgICAgYGBg
amF2YXNjcmlwdAogICAgICAgIHZhciBQZXJzb24gPSBmdW5jdGlvbigpIHt9OwogICAgICAgIFJT
VlAuRXZlbnRUYXJnZXQubWl4aW4oUGVyc29uLnByb3RvdHlwZSk7CgogICAgICAgIHZhciB5ZWh1
ZGEgPSBuZXcgUGVyc29uKCk7CiAgICAgICAgdmFyIHRvbSA9IG5ldyBQZXJzb24oKTsKCiAgICAg
ICAgeWVodWRhLm9uKCJwb2tlIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIGNvbnNvbGUu
bG9nKCJZZWh1ZGEgc2F5cyBPVyIpOwogICAgICAgIH0pOwoKICAgICAgICB0b20ub24oInBva2Ui
LCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgY29uc29sZS5sb2coIlRvbSBzYXlzIE9XIik7
CiAgICAgICAgfSk7CgogICAgICAgIHllaHVkYS50cmlnZ2VyKCJwb2tlIik7CiAgICAgICAgdG9t
LnRyaWdnZXIoInBva2UiKTsKICAgICAgICBgYGAKCiAgICAgICAgQG1ldGhvZCBtaXhpbgogICAg
ICAgIEBwYXJhbSB7T2JqZWN0fSBvYmplY3Qgb2JqZWN0IHRvIGV4dGVuZCB3aXRoIEV2ZW50VGFy
Z2V0IG1ldGhvZHMKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBtaXhpbjogZnVuY3Rp
b24ob2JqZWN0KSB7CiAgICAgICAgb2JqZWN0Lm9uID0gdGhpcy5vbjsKICAgICAgICBvYmplY3Qu
b2ZmID0gdGhpcy5vZmY7CiAgICAgICAgb2JqZWN0LnRyaWdnZXIgPSB0aGlzLnRyaWdnZXI7CiAg
ICAgICAgb2JqZWN0Ll9wcm9taXNlQ2FsbGJhY2tzID0gdW5kZWZpbmVkOwogICAgICAgIHJldHVy
biBvYmplY3Q7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBSZWdpc3RlcnMgYSBjYWxsYmFj
ayB0byBiZSBleGVjdXRlZCB3aGVuIGBldmVudE5hbWVgIGlzIHRyaWdnZXJlZAoKICAgICAgICBg
YGBqYXZhc2NyaXB0CiAgICAgICAgb2JqZWN0Lm9uKCdldmVudCcsIGZ1bmN0aW9uKGV2ZW50SW5m
byl7CiAgICAgICAgICAvLyBoYW5kbGUgdGhlIGV2ZW50CiAgICAgICAgfSk7CgogICAgICAgIG9i
amVjdC50cmlnZ2VyKCdldmVudCcpOwogICAgICAgIGBgYAoKICAgICAgICBAbWV0aG9kIG9uCiAg
ICAgICAgQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZSBuYW1lIG9mIHRoZSBldmVudCB0byBsaXN0
ZW4gZm9yCiAgICAgICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUg
Y2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZC4KICAgICAgICBAcHJpdmF0ZQogICAg
ICAqLwogICAgICBvbjogZnVuY3Rpb24oZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICAgIHZh
ciBhbGxDYWxsYmFja3MgPSBjYWxsYmFja3NGb3IodGhpcyksIGNhbGxiYWNrczsKCiAgICAgICAg
Y2FsbGJhY2tzID0gYWxsQ2FsbGJhY2tzW2V2ZW50TmFtZV07CgogICAgICAgIGlmICghY2FsbGJh
Y2tzKSB7CiAgICAgICAgICBjYWxsYmFja3MgPSBhbGxDYWxsYmFja3NbZXZlbnROYW1lXSA9IFtd
OwogICAgICAgIH0KCiAgICAgICAgaWYgKGluZGV4T2YoY2FsbGJhY2tzLCBjYWxsYmFjaykgPT09
IC0xKSB7CiAgICAgICAgICBjYWxsYmFja3MucHVzaChjYWxsYmFjayk7CiAgICAgICAgfQogICAg
ICB9LAoKICAgICAgLyoqCiAgICAgICAgWW91IGNhbiB1c2UgYG9mZmAgdG8gc3RvcCBmaXJpbmcg
YSBwYXJ0aWN1bGFyIGNhbGxiYWNrIGZvciBhbiBldmVudDoKCiAgICAgICAgYGBgamF2YXNjcmlw
dAogICAgICAgIGZ1bmN0aW9uIGRvU3R1ZmYoKSB7IC8vIGRvIHN0dWZmISB9CiAgICAgICAgb2Jq
ZWN0Lm9uKCdzdHVmZicsIGRvU3R1ZmYpOwoKICAgICAgICBvYmplY3QudHJpZ2dlcignc3R1ZmYn
KTsgLy8gZG9TdHVmZiB3aWxsIGJlIGNhbGxlZAoKICAgICAgICAvLyBVbnJlZ2lzdGVyIE9OTFkg
dGhlIGRvU3R1ZmYgY2FsbGJhY2sKICAgICAgICBvYmplY3Qub2ZmKCdzdHVmZicsIGRvU3R1ZmYp
OwogICAgICAgIG9iamVjdC50cmlnZ2VyKCdzdHVmZicpOyAvLyBkb1N0dWZmIHdpbGwgTk9UIGJl
IGNhbGxlZAogICAgICAgIGBgYAoKICAgICAgICBJZiB5b3UgZG9uJ3QgcGFzcyBhIGBjYWxsYmFj
a2AgYXJndW1lbnQgdG8gYG9mZmAsIEFMTCBjYWxsYmFja3MgZm9yIHRoZQogICAgICAgIGV2ZW50
IHdpbGwgbm90IGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IGZpcmVzLiBGb3IgZXhhbXBsZToK
CiAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgIHZhciBjYWxsYmFjazEgPSBmdW5jdGlvbigp
e307CiAgICAgICAgdmFyIGNhbGxiYWNrMiA9IGZ1bmN0aW9uKCl7fTsKCiAgICAgICAgb2JqZWN0
Lm9uKCdzdHVmZicsIGNhbGxiYWNrMSk7CiAgICAgICAgb2JqZWN0Lm9uKCdzdHVmZicsIGNhbGxi
YWNrMik7CgogICAgICAgIG9iamVjdC50cmlnZ2VyKCdzdHVmZicpOyAvLyBjYWxsYmFjazEgYW5k
IGNhbGxiYWNrMiB3aWxsIGJlIGV4ZWN1dGVkLgoKICAgICAgICBvYmplY3Qub2ZmKCdzdHVmZicp
OwogICAgICAgIG9iamVjdC50cmlnZ2VyKCdzdHVmZicpOyAvLyBjYWxsYmFjazEgYW5kIGNhbGxi
YWNrMiB3aWxsIG5vdCBiZSBleGVjdXRlZCEKICAgICAgICBgYGAKCiAgICAgICAgQG1ldGhvZCBv
ZmYKICAgICAgICBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIGV2ZW50IHRvIHN0b3AgbGlzdGVu
aW5nIHRvCiAgICAgICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgb3B0aW9uYWwgYXJndW1l
bnQuIElmIGdpdmVuLCBvbmx5IHRoZSBmdW5jdGlvbgogICAgICAgIGdpdmVuIHdpbGwgYmUgcmVt
b3ZlZCBmcm9tIHRoZSBldmVudCdzIGNhbGxiYWNrIHF1ZXVlLiBJZiBubyBgY2FsbGJhY2tgCiAg
ICAgICAgYXJndW1lbnQgaXMgZ2l2ZW4sIGFsbCBjYWxsYmFja3Mgd2lsbCBiZSByZW1vdmVkIGZy
b20gdGhlIGV2ZW50J3MgY2FsbGJhY2sKICAgICAgICBxdWV1ZS4KICAgICAgICBAcHJpdmF0ZQoK
ICAgICAgKi8KICAgICAgb2ZmOiBmdW5jdGlvbihldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAg
ICAgdmFyIGFsbENhbGxiYWNrcyA9IGNhbGxiYWNrc0Zvcih0aGlzKSwgY2FsbGJhY2tzLCBpbmRl
eDsKCiAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgYWxsQ2FsbGJhY2tzW2V2ZW50
TmFtZV0gPSBbXTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNhbGxiYWNr
cyA9IGFsbENhbGxiYWNrc1tldmVudE5hbWVdOwoKICAgICAgICBpbmRleCA9IGluZGV4T2YoY2Fs
bGJhY2tzLCBjYWxsYmFjayk7CgogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsgY2FsbGJhY2tz
LnNwbGljZShpbmRleCwgMSk7IH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFVzZSBgdHJp
Z2dlcmAgdG8gZmlyZSBjdXN0b20gZXZlbnRzLiBGb3IgZXhhbXBsZToKCiAgICAgICAgYGBgamF2
YXNjcmlwdAogICAgICAgIG9iamVjdC5vbignZm9vJywgZnVuY3Rpb24oKXsKICAgICAgICAgIGNv
bnNvbGUubG9nKCdmb28gZXZlbnQgaGFwcGVuZWQhJyk7CiAgICAgICAgfSk7CiAgICAgICAgb2Jq
ZWN0LnRyaWdnZXIoJ2ZvbycpOwogICAgICAgIC8vICdmb28gZXZlbnQgaGFwcGVuZWQhJyBsb2dn
ZWQgdG8gdGhlIGNvbnNvbGUKICAgICAgICBgYGAKCiAgICAgICAgWW91IGNhbiBhbHNvIHBhc3Mg
YSB2YWx1ZSBhcyBhIHNlY29uZCBhcmd1bWVudCB0byBgdHJpZ2dlcmAgdGhhdCB3aWxsIGJlCiAg
ICAgICAgcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIGFsbCBldmVudCBsaXN0ZW5lcnMgZm9yIHRo
ZSBldmVudDoKCiAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgIG9iamVjdC5vbignZm9vJywg
ZnVuY3Rpb24odmFsdWUpewogICAgICAgICAgY29uc29sZS5sb2codmFsdWUubmFtZSk7CiAgICAg
ICAgfSk7CgogICAgICAgIG9iamVjdC50cmlnZ2VyKCdmb28nLCB7IG5hbWU6ICdiYXInIH0pOwog
ICAgICAgIC8vICdiYXInIGxvZ2dlZCB0byB0aGUgY29uc29sZQogICAgICAgIGBgYAoKICAgICAg
ICBAbWV0aG9kIHRyaWdnZXIKICAgICAgICBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIG5hbWUg
b2YgdGhlIGV2ZW50IHRvIGJlIHRyaWdnZXJlZAogICAgICAgIEBwYXJhbSB7QW55fSBvcHRpb25z
IG9wdGlvbmFsIHZhbHVlIHRvIGJlIHBhc3NlZCB0byBhbnkgZXZlbnQgaGFuZGxlcnMgZm9yCiAg
ICAgICAgdGhlIGdpdmVuIGBldmVudE5hbWVgCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAg
ICAgdHJpZ2dlcjogZnVuY3Rpb24oZXZlbnROYW1lLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIGFs
bENhbGxiYWNrcyA9IGNhbGxiYWNrc0Zvcih0aGlzKSwKICAgICAgICAgICAgY2FsbGJhY2tzLCBj
YWxsYmFja1R1cGxlLCBjYWxsYmFjaywgYmluZGluZzsKCiAgICAgICAgaWYgKGNhbGxiYWNrcyA9
IGFsbENhbGxiYWNrc1tldmVudE5hbWVdKSB7CiAgICAgICAgICAvLyBEb24ndCBjYWNoZSB0aGUg
Y2FsbGJhY2tzLmxlbmd0aCBzaW5jZSBpdCBtYXkgZ3JvdwogICAgICAgICAgZm9yICh2YXIgaT0w
OyBpPGNhbGxiYWNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjYWxsYmFjayA9IGNhbGxi
YWNrc1tpXTsKCiAgICAgICAgICAgIGNhbGxiYWNrKG9wdGlvbnMpOwogICAgICAgICAgfQogICAg
ICAgIH0KICAgICAgfQogICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL2ZpbHRlciIsIAogIFsiLi9h
bGwiLCIuL21hcCIsIi4vdXRpbHMiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5
MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5kZW5jeTNfXywgX19leHBvcnRzX18pIHsKICAg
ICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBhbGwgPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsK
ICAgIHZhciBtYXAgPSBfX2RlcGVuZGVuY3kyX19bImRlZmF1bHQiXTsKICAgIHZhciBpc0Z1bmN0
aW9uID0gX19kZXBlbmRlbmN5M19fLmlzRnVuY3Rpb247CiAgICB2YXIgaXNBcnJheSA9IF9fZGVw
ZW5kZW5jeTNfXy5pc0FycmF5OwoKICAgIC8qKgogICAgIGBSU1ZQLmZpbHRlcmAgaXMgc2ltaWxh
ciB0byBKYXZhU2NyaXB0J3MgbmF0aXZlIGBmaWx0ZXJgIG1ldGhvZCwgZXhjZXB0IHRoYXQgaXQK
ICAgICAgd2FpdHMgZm9yIGFsbCBwcm9taXNlcyB0byBiZWNvbWUgZnVsZmlsbGVkIGJlZm9yZSBy
dW5uaW5nIHRoZSBgZmlsdGVyRm5gIG9uCiAgICAgIGVhY2ggaXRlbSBpbiBnaXZlbiB0byBgcHJv
bWlzZXNgLiBgUlNWUC5maWx0ZXJgIHJldHVybnMgYSBwcm9taXNlIHRoYXQgd2lsbAogICAgICBi
ZWNvbWUgZnVsZmlsbGVkIHdpdGggdGhlIHJlc3VsdCBvZiBydW5uaW5nIGBmaWx0ZXJGbmAgb24g
dGhlIHZhbHVlcyB0aGUKICAgICAgcHJvbWlzZXMgYmVjb21lIGZ1bGZpbGxlZCB3aXRoLgoKICAg
ICAgRm9yIGV4YW1wbGU6CgogICAgICBgYGBqYXZhc2NyaXB0CgogICAgICB2YXIgcHJvbWlzZTEg
PSBSU1ZQLnJlc29sdmUoMSk7CiAgICAgIHZhciBwcm9taXNlMiA9IFJTVlAucmVzb2x2ZSgyKTsK
ICAgICAgdmFyIHByb21pc2UzID0gUlNWUC5yZXNvbHZlKDMpOwoKICAgICAgdmFyIGZpbHRlckZu
ID0gZnVuY3Rpb24oaXRlbSl7CiAgICAgICAgcmV0dXJuIGl0ZW0gPiAxOwogICAgICB9OwoKICAg
ICAgUlNWUC5maWx0ZXIocHJvbWlzZXMsIGZpbHRlckZuKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7
CiAgICAgICAgLy8gcmVzdWx0IGlzIFsgMiwgMyBdCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAg
IElmIGFueSBvZiB0aGUgYHByb21pc2VzYCBnaXZlbiB0byBgUlNWUC5maWx0ZXJgIGFyZSByZWpl
Y3RlZCwgdGhlIGZpcnN0IHByb21pc2UKICAgICAgdGhhdCBpcyByZWplY3RlZCB3aWxsIGJlIGdp
dmVuIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSByZXR1cm5lZCBwcm9taXNlJ3MKICAgICAgcmVqZWN0
aW9uIGhhbmRsZXIuIEZvciBleGFtcGxlOgoKICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIg
cHJvbWlzZTEgPSBSU1ZQLnJlc29sdmUoMSk7CiAgICAgIHZhciBwcm9taXNlMiA9IFJTVlAucmVq
ZWN0KG5ldyBFcnJvcigiMiIpKTsKICAgICAgdmFyIHByb21pc2UzID0gUlNWUC5yZWplY3QobmV3
IEVycm9yKCIzIikpOwogICAgICB2YXIgcHJvbWlzZXMgPSBbIHByb21pc2UxLCBwcm9taXNlMiwg
cHJvbWlzZTMgXTsKCiAgICAgIHZhciBmaWx0ZXJGbiA9IGZ1bmN0aW9uKGl0ZW0pewogICAgICAg
IHJldHVybiBpdGVtID4gMTsKICAgICAgfTsKCiAgICAgIFJTVlAuZmlsdGVyKHByb21pc2VzLCBm
aWx0ZXJGbikudGhlbihmdW5jdGlvbihhcnJheSl7CiAgICAgICAgLy8gQ29kZSBoZXJlIG5ldmVy
IHJ1bnMgYmVjYXVzZSB0aGVyZSBhcmUgcmVqZWN0ZWQgcHJvbWlzZXMhCiAgICAgIH0sIGZ1bmN0
aW9uKHJlYXNvbikgewogICAgICAgIC8vIHJlYXNvbi5tZXNzYWdlID09PSAiMiIKICAgICAgfSk7
CiAgICAgIGBgYAoKICAgICAgYFJTVlAuZmlsdGVyYCB3aWxsIGFsc28gd2FpdCBmb3IgYW55IHBy
b21pc2VzIHJldHVybmVkIGZyb20gYGZpbHRlckZuYC4KICAgICAgRm9yIGluc3RhbmNlLCB5b3Ug
bWF5IHdhbnQgdG8gZmV0Y2ggYSBsaXN0IG9mIHVzZXJzIHRoZW4gcmV0dXJuIGEgc3Vic2V0CiAg
ICAgIG9mIHRob3NlIHVzZXJzIGJhc2VkIG9uIHNvbWUgYXN5bmNocm9ub3VzIG9wZXJhdGlvbjoK
CiAgICAgIGBgYGphdmFzY3JpcHQKCiAgICAgIHZhciBhbGljZSA9IHsgbmFtZTogJ2FsaWNlJyB9
OwogICAgICB2YXIgYm9iICAgPSB7IG5hbWU6ICdib2InIH07CiAgICAgIHZhciB1c2VycyA9IFsg
YWxpY2UsIGJvYiBdOwoKICAgICAgdmFyIHByb21pc2VzID0gdXNlcnMubWFwKGZ1bmN0aW9uKHVz
ZXIpewogICAgICAgIHJldHVybiBSU1ZQLnJlc29sdmUodXNlcik7CiAgICAgIH0pOwoKICAgICAg
dmFyIGZpbHRlckZuID0gZnVuY3Rpb24odXNlcil7CiAgICAgICAgLy8gSGVyZSwgQWxpY2UgaGFz
IHBlcm1pc3Npb25zIHRvIGNyZWF0ZSBhIGJsb2cgcG9zdCwgYnV0IEJvYiBkb2VzIG5vdC4KICAg
ICAgICByZXR1cm4gZ2V0UHJpdmlsZWdlc0ZvclVzZXIodXNlcikudGhlbihmdW5jdGlvbihwcml2
cyl7CiAgICAgICAgICByZXR1cm4gcHJpdnMuY2FuX2NyZWF0ZV9ibG9nX3Bvc3QgPT09IHRydWU7
CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIFJTVlAuZmlsdGVyKHByb21pc2VzLCBmaWx0ZXJG
bikudGhlbihmdW5jdGlvbih1c2Vycyl7CiAgICAgICAgLy8gdHJ1ZSwgYmVjYXVzZSB0aGUgc2Vy
dmVyIHRvbGQgdXMgb25seSBBbGljZSBjYW4gY3JlYXRlIGEgYmxvZyBwb3N0LgogICAgICAgIHVz
ZXJzLmxlbmd0aCA9PT0gMTsKICAgICAgICAvLyBmYWxzZSwgYmVjYXVzZSBBbGljZSBpcyB0aGUg
b25seSB1c2VyIHByZXNlbnQgaW4gYHVzZXJzYAogICAgICAgIHVzZXJzWzBdID09PSBib2I7CiAg
ICAgIH0pOwogICAgICBgYGAKCiAgICAgIEBtZXRob2QgZmlsdGVyCiAgICAgIEBmb3IgUlNWUAog
ICAgICBAcGFyYW0ge0FycmF5fSBwcm9taXNlcwogICAgICBAcGFyYW0ge0Z1bmN0aW9ufSBmaWx0
ZXJGbiAtIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbiBlYWNoIHJlc29sdmVkIHZhbHVlIHRvCiAg
ICAgIGZpbHRlciB0aGUgZmluYWwgcmVzdWx0cy4KICAgICAgQHBhcmFtIHtTdHJpbmd9IGxhYmVs
IG9wdGlvbmFsIHN0cmluZyBkZXNjcmliaW5nIHRoZSBwcm9taXNlLiBVc2VmdWwgZm9yCiAgICAg
IHRvb2xpbmcuCiAgICAgIEByZXR1cm4ge1Byb21pc2V9CiAgICAqLwogICAgZnVuY3Rpb24gZmls
dGVyKHByb21pc2VzLCBmaWx0ZXJGbiwgbGFiZWwpIHsKICAgICAgcmV0dXJuIGFsbChwcm9taXNl
cywgbGFiZWwpLnRoZW4oZnVuY3Rpb24odmFsdWVzKXsKICAgICAgICBpZiAoIWlzQXJyYXkocHJv
bWlzZXMpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdZb3UgbXVzdCBwYXNzIGFu
IGFycmF5IHRvIGZpbHRlci4nKTsKICAgICAgICB9CgogICAgICAgIGlmICghaXNGdW5jdGlvbihm
aWx0ZXJGbikpewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiWW91IG11c3QgcGFzcyBh
IGZ1bmN0aW9uIHRvIGZpbHRlcidzIHNlY29uZCBhcmd1bWVudC4iKTsKICAgICAgICB9CgogICAg
ICAgIHJldHVybiBtYXAocHJvbWlzZXMsIGZpbHRlckZuLCBsYWJlbCkudGhlbihmdW5jdGlvbihm
aWx0ZXJSZXN1bHRzKXsKICAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgICAgdmFsdWVzTGVu
ID0gdmFsdWVzLmxlbmd0aCwKICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBbXTsKCiAgICAgICAg
ICAgZm9yIChpID0gMDsgaSA8IHZhbHVlc0xlbjsgaSsrKXsKICAgICAgICAgICAgIGlmKGZpbHRl
clJlc3VsdHNbaV0pIGZpbHRlcmVkLnB1c2godmFsdWVzW2ldKTsKICAgICAgICAgICB9CiAgICAg
ICAgICAgcmV0dXJuIGZpbHRlcmVkOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICBf
X2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZmlsdGVyOwogIH0pOwpkZWZpbmUoInJzdnAvaGFzaCIs
IAogIFsiLi9wcm9taXNlIiwiLi91dGlscyIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVu
ZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0
IjsKICAgIHZhciBQcm9taXNlID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CiAgICB2YXIg
aXNOb25UaGVuYWJsZSA9IF9fZGVwZW5kZW5jeTJfXy5pc05vblRoZW5hYmxlOwogICAgdmFyIGtl
eXNPZiA9IF9fZGVwZW5kZW5jeTJfXy5rZXlzT2Y7CgogICAgLyoqCiAgICAgIGBSU1ZQLmhhc2hg
IGlzIHNpbWlsYXIgdG8gYFJTVlAuYWxsYCwgYnV0IHRha2VzIGFuIG9iamVjdCBpbnN0ZWFkIG9m
IGFuIGFycmF5CiAgICAgIGZvciBpdHMgYHByb21pc2VzYCBhcmd1bWVudC4KCiAgICAgIFJldHVy
bnMgYSBwcm9taXNlIHRoYXQgaXMgZnVsZmlsbGVkIHdoZW4gYWxsIHRoZSBnaXZlbiBwcm9taXNl
cyBoYXZlIGJlZW4KICAgICAgZnVsZmlsbGVkLCBvciByZWplY3RlZCBpZiBhbnkgb2YgdGhlbSBi
ZWNvbWUgcmVqZWN0ZWQuIFRoZSByZXR1cm5lZCBwcm9taXNlCiAgICAgIGlzIGZ1bGZpbGxlZCB3
aXRoIGEgaGFzaCB0aGF0IGhhcyB0aGUgc2FtZSBrZXkgbmFtZXMgYXMgdGhlIGBwcm9taXNlc2Ag
b2JqZWN0CiAgICAgIGFyZ3VtZW50LiBJZiBhbnkgb2YgdGhlIHZhbHVlcyBpbiB0aGUgb2JqZWN0
IGFyZSBub3QgcHJvbWlzZXMsIHRoZXkgd2lsbAogICAgICBzaW1wbHkgYmUgY29waWVkIG92ZXIg
dG8gdGhlIGZ1bGZpbGxlZCBvYmplY3QuCgogICAgICBFeGFtcGxlOgoKICAgICAgYGBgamF2YXNj
cmlwdAogICAgICB2YXIgcHJvbWlzZXMgPSB7CiAgICAgICAgbXlQcm9taXNlOiBSU1ZQLnJlc29s
dmUoMSksCiAgICAgICAgeW91clByb21pc2U6IFJTVlAucmVzb2x2ZSgyKSwKICAgICAgICB0aGVp
clByb21pc2U6IFJTVlAucmVzb2x2ZSgzKSwKICAgICAgICBub3RBUHJvbWlzZTogNAogICAgICB9
OwoKICAgICAgUlNWUC5oYXNoKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKGhhc2gpewogICAgICAg
IC8vIGhhc2ggaGVyZSBpcyBhbiBvYmplY3QgdGhhdCBsb29rcyBsaWtlOgogICAgICAgIC8vIHsK
ICAgICAgICAvLyAgIG15UHJvbWlzZTogMSwKICAgICAgICAvLyAgIHlvdXJQcm9taXNlOiAyLAog
ICAgICAgIC8vICAgdGhlaXJQcm9taXNlOiAzLAogICAgICAgIC8vICAgbm90QVByb21pc2U6IDQK
ICAgICAgICAvLyB9CiAgICAgIH0pOwogICAgICBgYGBgCgogICAgICBJZiBhbnkgb2YgdGhlIGBw
cm9taXNlc2AgZ2l2ZW4gdG8gYFJTVlAuaGFzaGAgYXJlIHJlamVjdGVkLCB0aGUgZmlyc3QgcHJv
bWlzZQogICAgICB0aGF0IGlzIHJlamVjdGVkIHdpbGwgYmUgZ2l2ZW4gYXMgdGhlIHJlYXNvbiB0
byB0aGUgcmVqZWN0aW9uIGhhbmRsZXIuCgogICAgICBFeGFtcGxlOgoKICAgICAgYGBgamF2YXNj
cmlwdAogICAgICB2YXIgcHJvbWlzZXMgPSB7CiAgICAgICAgbXlQcm9taXNlOiBSU1ZQLnJlc29s
dmUoMSksCiAgICAgICAgcmVqZWN0ZWRQcm9taXNlOiBSU1ZQLnJlamVjdChuZXcgRXJyb3IoInJl
amVjdGVkUHJvbWlzZSIpKSwKICAgICAgICBhbm90aGVyUmVqZWN0ZWRQcm9taXNlOiBSU1ZQLnJl
amVjdChuZXcgRXJyb3IoImFub3RoZXJSZWplY3RlZFByb21pc2UiKSksCiAgICAgIH07CgogICAg
ICBSU1ZQLmhhc2gocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24oaGFzaCl7CiAgICAgICAgLy8gQ29k
ZSBoZXJlIG5ldmVyIHJ1bnMgYmVjYXVzZSB0aGVyZSBhcmUgcmVqZWN0ZWQgcHJvbWlzZXMhCiAg
ICAgIH0sIGZ1bmN0aW9uKHJlYXNvbikgewogICAgICAgIC8vIHJlYXNvbi5tZXNzYWdlID09PSAi
cmVqZWN0ZWRQcm9taXNlIgogICAgICB9KTsKICAgICAgYGBgCgogICAgICBBbiBpbXBvcnRhbnQg
bm90ZTogYFJTVlAuaGFzaGAgaXMgaW50ZW5kZWQgZm9yIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0
cyB0aGF0CiAgICAgIGFyZSBqdXN0IGEgc2V0IG9mIGtleXMgYW5kIHZhbHVlcy4gYFJTVlAuaGFz
aGAgd2lsbCBOT1QgcHJlc2VydmUgcHJvdG90eXBlCiAgICAgIGNoYWlucy4KCiAgICAgIEV4YW1w
bGU6CgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIGZ1bmN0aW9uIE15Q29uc3RydWN0b3IoKXsK
ICAgICAgICB0aGlzLmV4YW1wbGUgPSBSU1ZQLnJlc29sdmUoIkV4YW1wbGUiKTsKICAgICAgfQoK
ICAgICAgTXlDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSB7CiAgICAgICAgcHJvdG9Qcm9wZXJ0eTog
UlNWUC5yZXNvbHZlKCJQcm90byBQcm9wZXJ0eSIpCiAgICAgIH07CgogICAgICB2YXIgbXlPYmpl
Y3QgPSBuZXcgTXlDb25zdHJ1Y3RvcigpOwoKICAgICAgUlNWUC5oYXNoKG15T2JqZWN0KS50aGVu
KGZ1bmN0aW9uKGhhc2gpewogICAgICAgIC8vIHByb3RvUHJvcGVydHkgd2lsbCBub3QgYmUgcHJl
c2VudCwgaW5zdGVhZCB5b3Ugd2lsbCBqdXN0IGhhdmUgYW4KICAgICAgICAvLyBvYmplY3QgdGhh
dCBsb29rcyBsaWtlOgogICAgICAgIC8vIHsKICAgICAgICAvLyAgIGV4YW1wbGU6ICJFeGFtcGxl
IgogICAgICAgIC8vIH0KICAgICAgICAvLwogICAgICAgIC8vIGhhc2guaGFzT3duUHJvcGVydHko
J3Byb3RvUHJvcGVydHknKTsgLy8gZmFsc2UKICAgICAgICAvLyAndW5kZWZpbmVkJyA9PT0gdHlw
ZW9mIGhhc2gucHJvdG9Qcm9wZXJ0eQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBAbWV0aG9k
IGhhc2gKICAgICAgQGZvciBSU1ZQCiAgICAgIEBwYXJhbSB7T2JqZWN0fSBwcm9taXNlcwogICAg
ICBAcGFyYW0ge1N0cmluZ30gbGFiZWwgb3B0aW9uYWwgc3RyaW5nIHRoYXQgZGVzY3JpYmVzIHRo
ZSBwcm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgIEByZXR1cm4ge1Byb21p
c2V9IHByb21pc2UgdGhhdCBpcyBmdWxmaWxsZWQgd2hlbiBhbGwgcHJvcGVydGllcyBvZiBgcHJv
bWlzZXNgCiAgICAgIGhhdmUgYmVlbiBmdWxmaWxsZWQsIG9yIHJlamVjdGVkIGlmIGFueSBvZiB0
aGVtIGJlY29tZSByZWplY3RlZC4KICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19f
WyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBoYXNoKG9iamVjdCwgbGFiZWwpIHsKICAgICAgcmV0dXJu
IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7CiAgICAgICAgdmFyIHJlc3Vs
dHMgPSB7fTsKICAgICAgICB2YXIga2V5cyA9IGtleXNPZihvYmplY3QpOwogICAgICAgIHZhciBy
ZW1haW5pbmcgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgZW50cnksIHByb3BlcnR5OwoKICAg
ICAgICBpZiAocmVtYWluaW5nID09PSAwKSB7CiAgICAgICAgICByZXNvbHZlKHJlc3VsdHMpOwog
ICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWRUbyhw
cm9wZXJ0eSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAg
IHJlc3VsdHNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgICAgIGlmICgtLXJlbWFpbmluZyA9
PT0gMCkgewogICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0cyk7CiAgICAgICAgICAgIH0KICAg
ICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBvblJlamVjdGlvbihyZWFzb24p
IHsKICAgICAgICAgIHJlbWFpbmluZyA9IDA7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAg
ICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewog
ICAgICAgICAgcHJvcGVydHkgPSBrZXlzW2ldOwogICAgICAgICAgZW50cnkgPSBvYmplY3RbcHJv
cGVydHldOwoKICAgICAgICAgIGlmIChpc05vblRoZW5hYmxlKGVudHJ5KSkgewogICAgICAgICAg
ICByZXN1bHRzW3Byb3BlcnR5XSA9IGVudHJ5OwogICAgICAgICAgICBpZiAoLS1yZW1haW5pbmcg
PT09IDApIHsKICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdHMpOwogICAgICAgICAgICB9CiAg
ICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBQcm9taXNlLmNhc3QoZW50cnkpLnRoZW4oZnVs
ZmlsbGVkVG8ocHJvcGVydHkpLCBvblJlamVjdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfQog
ICAgICB9KTsKICAgIH07CiAgfSk7CmRlZmluZSgicnN2cC9pbnN0cnVtZW50IiwgCiAgWyIuL2Nv
bmZpZyIsIi4vdXRpbHMiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBf
X2RlcGVuZGVuY3kyX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIg
Y29uZmlnID0gX19kZXBlbmRlbmN5MV9fLmNvbmZpZzsKICAgIHZhciBub3cgPSBfX2RlcGVuZGVu
Y3kyX18ubm93OwoKICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBpbnN0cnVt
ZW50KGV2ZW50TmFtZSwgcHJvbWlzZSwgY2hpbGQpIHsKICAgICAgLy8gaW5zdHJ1bWVudGF0aW9u
IHNob3VsZCBub3QgZGlzcnVwdCBub3JtYWwgdXNhZ2UuCiAgICAgIHRyeSB7CiAgICAgICAgY29u
ZmlnLnRyaWdnZXIoZXZlbnROYW1lLCB7CiAgICAgICAgICBndWlkOiBwcm9taXNlLl9ndWlkS2V5
ICsgcHJvbWlzZS5faWQsCiAgICAgICAgICBldmVudE5hbWU6IGV2ZW50TmFtZSwKICAgICAgICAg
IGRldGFpbDogcHJvbWlzZS5fZGV0YWlsLAogICAgICAgICAgY2hpbGRHdWlkOiBjaGlsZCAmJiBw
cm9taXNlLl9ndWlkS2V5ICsgY2hpbGQuX2lkLAogICAgICAgICAgbGFiZWw6IHByb21pc2UuX2xh
YmVsLAogICAgICAgICAgdGltZVN0YW1wOiBub3coKSwKICAgICAgICAgIHN0YWNrOiBuZXcgRXJy
b3IocHJvbWlzZS5fbGFiZWwpLnN0YWNrCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2goZXJyb3Ip
IHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICB0aHJvdyBlcnJvcjsK
ICAgICAgICB9LCAwKTsKICAgICAgfQogICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL21hcCIsIAog
IFsiLi9wcm9taXNlIiwiLi9hbGwiLCIuL3V0aWxzIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9f
ZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZXhwb3J0
c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgUHJvbWlzZSA9IF9fZGVwZW5kZW5jeTFf
X1siZGVmYXVsdCJdOwogICAgdmFyIGFsbCA9IF9fZGVwZW5kZW5jeTJfX1siZGVmYXVsdCJdOwog
ICAgdmFyIGlzQXJyYXkgPSBfX2RlcGVuZGVuY3kzX18uaXNBcnJheTsKICAgIHZhciBpc0Z1bmN0
aW9uID0gX19kZXBlbmRlbmN5M19fLmlzRnVuY3Rpb247CgogICAgLyoqCiAgICAgYFJTVlAubWFw
YCBpcyBzaW1pbGFyIHRvIEphdmFTY3JpcHQncyBuYXRpdmUgYG1hcGAgbWV0aG9kLCBleGNlcHQg
dGhhdCBpdAogICAgICB3YWl0cyBmb3IgYWxsIHByb21pc2VzIHRvIGJlY29tZSBmdWxmaWxsZWQg
YmVmb3JlIHJ1bm5pbmcgdGhlIGBtYXBGbmAgb24KICAgICAgZWFjaCBpdGVtIGluIGdpdmVuIHRv
IGBwcm9taXNlc2AuIGBSU1ZQLm1hcGAgcmV0dXJucyBhIHByb21pc2UgdGhhdCB3aWxsCiAgICAg
IGJlY29tZSBmdWxmaWxsZWQgd2l0aCB0aGUgcmVzdWx0IG9mIHJ1bm5pbmcgYG1hcEZuYCBvbiB0
aGUgdmFsdWVzIHRoZSBwcm9taXNlcwogICAgICBiZWNvbWUgZnVsZmlsbGVkIHdpdGguCgogICAg
ICBGb3IgZXhhbXBsZToKCiAgICAgIGBgYGphdmFzY3JpcHQKCiAgICAgIHZhciBwcm9taXNlMSA9
IFJTVlAucmVzb2x2ZSgxKTsKICAgICAgdmFyIHByb21pc2UyID0gUlNWUC5yZXNvbHZlKDIpOwog
ICAgICB2YXIgcHJvbWlzZTMgPSBSU1ZQLnJlc29sdmUoMyk7CiAgICAgIHZhciBwcm9taXNlcyA9
IFsgcHJvbWlzZTEsIHByb21pc2UyLCBwcm9taXNlMyBdOwoKICAgICAgdmFyIG1hcEZuID0gZnVu
Y3Rpb24oaXRlbSl7CiAgICAgICAgcmV0dXJuIGl0ZW0gKyAxOwogICAgICB9OwoKICAgICAgUlNW
UC5tYXAocHJvbWlzZXMsIG1hcEZuKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgLy8g
cmVzdWx0IGlzIFsgMiwgMywgNCBdCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIElmIGFueSBv
ZiB0aGUgYHByb21pc2VzYCBnaXZlbiB0byBgUlNWUC5tYXBgIGFyZSByZWplY3RlZCwgdGhlIGZp
cnN0IHByb21pc2UKICAgICAgdGhhdCBpcyByZWplY3RlZCB3aWxsIGJlIGdpdmVuIGFzIGFuIGFy
Z3VtZW50IHRvIHRoZSByZXR1cm5lZCBwcm9taXNlJ3MKICAgICAgcmVqZWN0aW9uIGhhbmRsZXIu
IEZvciBleGFtcGxlOgoKICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIgcHJvbWlzZTEgPSBS
U1ZQLnJlc29sdmUoMSk7CiAgICAgIHZhciBwcm9taXNlMiA9IFJTVlAucmVqZWN0KG5ldyBFcnJv
cigiMiIpKTsKICAgICAgdmFyIHByb21pc2UzID0gUlNWUC5yZWplY3QobmV3IEVycm9yKCIzIikp
OwogICAgICB2YXIgcHJvbWlzZXMgPSBbIHByb21pc2UxLCBwcm9taXNlMiwgcHJvbWlzZTMgXTsK
CiAgICAgIHZhciBtYXBGbiA9IGZ1bmN0aW9uKGl0ZW0pewogICAgICAgIHJldHVybiBpdGVtICsg
MTsKICAgICAgfTsKCiAgICAgIFJTVlAubWFwKHByb21pc2VzLCBtYXBGbikudGhlbihmdW5jdGlv
bihhcnJheSl7CiAgICAgICAgLy8gQ29kZSBoZXJlIG5ldmVyIHJ1bnMgYmVjYXVzZSB0aGVyZSBh
cmUgcmVqZWN0ZWQgcHJvbWlzZXMhCiAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbikgewogICAgICAg
IC8vIHJlYXNvbi5tZXNzYWdlID09PSAiMiIKICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgYFJT
VlAubWFwYCB3aWxsIGFsc28gd2FpdCBpZiBhIHByb21pc2UgaXMgcmV0dXJuZWQgZnJvbSBgbWFw
Rm5gLiBGb3IgZXhhbXBsZSwKICAgICAgc2F5IHlvdSB3YW50IHRvIGdldCBhbGwgY29tbWVudHMg
ZnJvbSBhIHNldCBvZiBibG9nIHBvc3RzLCBidXQgeW91IG5lZWQKICAgICAgdGhlIGJsb2cgcG9z
dHMgZmlyc3QgYmVjdWFzZSB0aGV5IGNvbnRhaW4gYSB1cmwgdG8gdGhvc2UgY29tbWVudHMuCgog
ICAgICBgYGBqYXZzY3JpcHQKCiAgICAgIHZhciBtYXBGbiA9IGZ1bmN0aW9uKGJsb2dQb3N0KXsK
ICAgICAgICAvLyBnZXRDb21tZW50cyBkb2VzIHNvbWUgYWpheCBhbmQgcmV0dXJucyBhbiBSU1ZQ
LlByb21pc2UgdGhhdCBpcyBmdWxmaWxsZWQKICAgICAgICAvLyB3aXRoIHNvbWUgY29tbWVudHMg
ZGF0YQogICAgICAgIHJldHVybiBnZXRDb21tZW50cyhibG9nUG9zdC5jb21tZW50c191cmwpOwog
ICAgICB9OwoKICAgICAgLy8gZ2V0QmxvZ1Bvc3RzIGRvZXMgc29tZSBhamF4IGFuZCByZXR1cm5z
IGFuIFJTVlAuUHJvbWlzZSB0aGF0IGlzIGZ1bGZpbGxlZAogICAgICAvLyB3aXRoIHNvbWUgYmxv
ZyBwb3N0IGRhdGEKICAgICAgUlNWUC5tYXAoZ2V0QmxvZ1Bvc3RzKCksIG1hcEZuKS50aGVuKGZ1
bmN0aW9uKGNvbW1lbnRzKXsKICAgICAgICAvLyBjb21tZW50cyBpcyB0aGUgcmVzdWx0IG9mIGFz
a2luZyB0aGUgc2VydmVyIGZvciB0aGUgY29tbWVudHMKICAgICAgICAvLyBvZiBhbGwgYmxvZyBw
b3N0cyByZXR1cm5lZCBmcm9tIGdldEJsb2dQb3N0cygpCiAgICAgIH0pOwogICAgICBgYGAKCiAg
ICAgIEBtZXRob2QgbWFwCiAgICAgIEBmb3IgUlNWUAogICAgICBAcGFyYW0ge0FycmF5fSBwcm9t
aXNlcwogICAgICBAcGFyYW0ge0Z1bmN0aW9ufSBtYXBGbiBmdW5jdGlvbiB0byBiZSBjYWxsZWQg
b24gZWFjaCBmdWxmaWxsZWQgcHJvbWlzZS4KICAgICAgQHBhcmFtIHtTdHJpbmd9IGxhYmVsIG9w
dGlvbmFsIHN0cmluZyBmb3IgbGFiZWxpbmcgdGhlIHByb21pc2UuCiAgICAgIFVzZWZ1bCBmb3Ig
dG9vbGluZy4KICAgICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSB0aGF0IGlzIGZ1bGZpbGxl
ZCB3aXRoIHRoZSByZXN1bHQgb2YgY2FsbGluZwogICAgICBgbWFwRm5gIG9uIGVhY2ggZnVsZmls
bGVkIHByb21pc2Ugb3IgdmFsdWUgd2hlbiB0aGV5IGJlY29tZSBmdWxmaWxsZWQuCiAgICAgICBU
aGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIGlmIGFueSBvZiB0aGUgZ2l2ZW4gYHByb21pc2Vz
YCBiZWNvbWUgcmVqZWN0ZWQuCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBfX2V4cG9ydHNfX1si
ZGVmYXVsdCJdID0gZnVuY3Rpb24gbWFwKHByb21pc2VzLCBtYXBGbiwgbGFiZWwpIHsKICAgICAg
cmV0dXJuIGFsbChwcm9taXNlcywgbGFiZWwpLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7CiAgICAg
ICAgaWYgKCFpc0FycmF5KHByb21pc2VzKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJv
cignWW91IG11c3QgcGFzcyBhbiBhcnJheSB0byBtYXAuJyk7CiAgICAgICAgfQoKICAgICAgICBp
ZiAoIWlzRnVuY3Rpb24obWFwRm4pKXsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIllv
dSBtdXN0IHBhc3MgYSBmdW5jdGlvbiB0byBtYXAncyBzZWNvbmQgYXJndW1lbnQuIik7CiAgICAg
ICAgfQoKCiAgICAgICAgdmFyIHJlc3VsdExlbiA9IHJlc3VsdHMubGVuZ3RoLAogICAgICAgICAg
ICBtYXBwZWRSZXN1bHRzID0gW10sCiAgICAgICAgICAgIGk7CgogICAgICAgIGZvciAoaSA9IDA7
IGkgPCByZXN1bHRMZW47IGkrKyl7CiAgICAgICAgICBtYXBwZWRSZXN1bHRzLnB1c2gobWFwRm4o
cmVzdWx0c1tpXSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFsbChtYXBwZWRSZXN1bHRz
LCBsYWJlbCk7CiAgICAgIH0pOwogICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL25vZGUiLCAKICBb
Ii4vcHJvbWlzZSIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhw
b3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgUHJvbWlzZSA9IF9fZGVwZW5kZW5j
eTFfX1siZGVmYXVsdCJdOwoKICAgIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsK
CiAgICBmdW5jdGlvbiBtYWtlTm9kZUNhbGxiYWNrRm9yKHJlc29sdmUsIHJlamVjdCkgewogICAg
ICByZXR1cm4gZnVuY3Rpb24gKGVycm9yLCB2YWx1ZSkgewogICAgICAgIGlmIChlcnJvcikgewog
ICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5n
dGggPiAyKSB7CiAgICAgICAgICByZXNvbHZlKHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAg
ICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc29sdmUodmFsdWUpOwogICAgICAgIH0KICAgICAg
fTsKICAgIH0KCiAgICAvKioKICAgICAgYFJTVlAuZGVub2RlaWZ5YCB0YWtlcyBhICJub2RlLXN0
eWxlIiBmdW5jdGlvbiBhbmQgcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQKICAgICAgd2lsbCByZXR1
cm4gYW4gYFJTVlAuUHJvbWlzZWAuIFlvdSBjYW4gdXNlIGBkZW5vZGVpZnlgIGluIE5vZGUuanMg
b3IgdGhlCiAgICAgIGJyb3dzZXIgd2hlbiB5b3UnZCBwcmVmZXIgdG8gdXNlIHByb21pc2VzIG92
ZXIgdXNpbmcgY2FsbGJhY2tzLiBGb3IgZXhhbXBsZSwKICAgICAgYGRlbm9kZWlmeWAgdHJhbnNm
b3JtcyB0aGUgZm9sbG93aW5nOgoKICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIgZnMgPSBy
ZXF1aXJlKCdmcycpOwoKICAgICAgZnMucmVhZEZpbGUoJ215ZmlsZS50eHQnLCBmdW5jdGlvbihl
cnIsIGRhdGEpewogICAgICAgIGlmIChlcnIpIHJldHVybiBoYW5kbGVFcnJvcihlcnIpOwogICAg
ICAgIGhhbmRsZURhdGEoZGF0YSk7CiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIGludG86Cgog
ICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7CgogICAgICB2
YXIgcmVhZEZpbGUgPSBSU1ZQLmRlbm9kZWlmeShmcy5yZWFkRmlsZSk7CgogICAgICByZWFkRmls
ZSgnbXlmaWxlLnR4dCcpLnRoZW4oaGFuZGxlRGF0YSwgaGFuZGxlRXJyb3IpOwogICAgICBgYGAK
CiAgICAgIFVzaW5nIGBkZW5vZGVpZnlgIG1ha2VzIGl0IGVhc2llciB0byBjb21wb3NlIGFzeW5j
aHJvbm91cyBvcGVyYXRpb25zIGluc3RlYWQKICAgICAgb2YgdXNpbmcgY2FsbGJhY2tzLiBGb3Ig
ZXhhbXBsZSwgaW5zdGVhZCBvZjoKCiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgdmFyIGZzID0g
cmVxdWlyZSgnZnMnKTsKICAgICAgdmFyIGxvZyA9IHJlcXVpcmUoJ3NvbWUtYXN5bmMtbG9nZ2Vy
Jyk7CgogICAgICBmcy5yZWFkRmlsZSgnbXlmaWxlLnR4dCcsIGZ1bmN0aW9uKGVyciwgZGF0YSl7
CiAgICAgICAgaWYgKGVycikgcmV0dXJuIGhhbmRsZUVycm9yKGVycik7CiAgICAgICAgZnMud3Jp
dGVGaWxlKCdteWZpbGUyLnR4dCcsIGRhdGEsIGZ1bmN0aW9uKGVycil7CiAgICAgICAgICBpZiAo
ZXJyKSB0aHJvdyBlcnI7CiAgICAgICAgICBsb2coJ3N1Y2Nlc3MnLCBmdW5jdGlvbihlcnIpIHsK
ICAgICAgICAgICAgaWYgKGVycikgdGhyb3cgZXJyOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7
CiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIFlvdSBjYW4gY2hhaW4gdGhlIG9wZXJhdGlvbnMg
dG9nZXRoZXIgdXNpbmcgYHRoZW5gIGZyb20gdGhlIHJldHVybmVkIHByb21pc2U6CgogICAgICBg
YGBqYXZhc2NyaXB0CiAgICAgIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7CiAgICAgIHZhciBkZW5v
ZGVpZnkgPSBSU1ZQLmRlbm9kZWlmeTsKICAgICAgdmFyIHJlYWRGaWxlID0gZGVub2RlaWZ5KGZz
LnJlYWRGaWxlKTsKICAgICAgdmFyIHdyaXRlRmlsZSA9IGRlbm9kZWlmeShmcy53cml0ZUZpbGUp
OwogICAgICB2YXIgbG9nID0gZGVub2RlaWZ5KHJlcXVpcmUoJ3NvbWUtYXN5bmMtbG9nZ2VyJykp
OwoKICAgICAgcmVhZEZpbGUoJ215ZmlsZS50eHQnKS50aGVuKGZ1bmN0aW9uKGRhdGEpewogICAg
ICAgIHJldHVybiB3cml0ZUZpbGUoJ215ZmlsZTIudHh0JywgZGF0YSk7CiAgICAgIH0pLnRoZW4o
ZnVuY3Rpb24oKXsKICAgICAgICByZXR1cm4gbG9nKCdTVUNDRVNTJyk7CiAgICAgIH0pLnRoZW4o
ZnVuY3Rpb24oKXsKICAgICAgICAvLyBzdWNjZXNzIGhhbmRsZXIKICAgICAgfSwgZnVuY3Rpb24o
cmVhc29uKXsKICAgICAgICAvLyByZWplY3Rpb24gaGFuZGxlcgogICAgICB9KTsKICAgICAgYGBg
CgogICAgICBAbWV0aG9kIGRlbm9kZWlmeQogICAgICBAZm9yIFJTVlAKICAgICAgQHBhcmFtIHtG
dW5jdGlvbn0gbm9kZUZ1bmMgYSAibm9kZS1zdHlsZSIgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIGNh
bGxiYWNrIGFzCiAgICAgIGl0cyBsYXN0IGFyZ3VtZW50LiBUaGUgY2FsbGJhY2sgZXhwZWN0cyBh
biBlcnJvciB0byBiZSBwYXNzZWQgYXMgaXRzIGZpcnN0CiAgICAgIGFyZ3VtZW50IChpZiBhbiBl
cnJvciBvY2N1cnJlZCwgb3RoZXJ3aXNlIG51bGwpLCBhbmQgdGhlIHZhbHVlIGZyb20gdGhlCiAg
ICAgIG9wZXJhdGlvbiBhcyBpdHMgc2Vjb25kIGFyZ3VtZW50ICgiZnVuY3Rpb24oZXJyLCB2YWx1
ZSl7IH0iKS4KICAgICAgQHBhcmFtIHtBbnl9IGJpbmRpbmcgb3B0aW9uYWwgYXJndW1lbnQgZm9y
IGJpbmRpbmcgdGhlICJ0aGlzIiB2YWx1ZSB3aGVuCiAgICAgIGNhbGxpbmcgdGhlIGBub2RlRnVu
Y2AgZnVuY3Rpb24uCiAgICAgIEByZXR1cm4ge0Z1bmN0aW9ufSBhIGZ1bmN0aW9uIHRoYXQgd3Jh
cHMgYG5vZGVGdW5jYCB0byByZXR1cm4gYW4KICAgICAgYFJTVlAuUHJvbWlzZWAKICAgICAgQHN0
YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBkZW5vZGVp
Znkobm9kZUZ1bmMsIGJpbmRpbmcpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgIHsKICAgICAg
ICB2YXIgbm9kZUFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyksIHJlc29sdmUsIHJlamVjdDsK
ICAgICAgICB2YXIgdGhpc0FyZyA9IHRoaXMgfHwgYmluZGluZzsKCiAgICAgICAgcmV0dXJuIG5l
dyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgUHJvbWlzZS5h
bGwobm9kZUFyZ3MpLnRoZW4oZnVuY3Rpb24obm9kZUFyZ3MpIHsKICAgICAgICAgICAgdHJ5IHsK
ICAgICAgICAgICAgICBub2RlQXJncy5wdXNoKG1ha2VOb2RlQ2FsbGJhY2tGb3IocmVzb2x2ZSwg
cmVqZWN0KSk7CiAgICAgICAgICAgICAgbm9kZUZ1bmMuYXBwbHkodGhpc0FyZywgbm9kZUFyZ3Mp
OwogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAg
ICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9OwogICAgfTsKICB9KTsK
ZGVmaW5lKCJyc3ZwL3Byb21pc2UiLCAKICBbIi4vY29uZmlnIiwiLi9ldmVudHMiLCIuL2luc3Ry
dW1lbnQiLCIuL3V0aWxzIiwiLi9wcm9taXNlL2Nhc3QiLCIuL3Byb21pc2UvYWxsIiwiLi9wcm9t
aXNlL3JhY2UiLCIuL3Byb21pc2UvcmVzb2x2ZSIsIi4vcHJvbWlzZS9yZWplY3QiLCJleHBvcnRz
Il0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5k
ZW5jeTNfXywgX19kZXBlbmRlbmN5NF9fLCBfX2RlcGVuZGVuY3k1X18sIF9fZGVwZW5kZW5jeTZf
XywgX19kZXBlbmRlbmN5N19fLCBfX2RlcGVuZGVuY3k4X18sIF9fZGVwZW5kZW5jeTlfXywgX19l
eHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBjb25maWcgPSBfX2RlcGVuZGVu
Y3kxX18uY29uZmlnOwogICAgdmFyIEV2ZW50VGFyZ2V0ID0gX19kZXBlbmRlbmN5Ml9fWyJkZWZh
dWx0Il07CiAgICB2YXIgaW5zdHJ1bWVudCA9IF9fZGVwZW5kZW5jeTNfX1siZGVmYXVsdCJdOwog
ICAgdmFyIG9iamVjdE9yRnVuY3Rpb24gPSBfX2RlcGVuZGVuY3k0X18ub2JqZWN0T3JGdW5jdGlv
bjsKICAgIHZhciBpc0Z1bmN0aW9uID0gX19kZXBlbmRlbmN5NF9fLmlzRnVuY3Rpb247CiAgICB2
YXIgbm93ID0gX19kZXBlbmRlbmN5NF9fLm5vdzsKICAgIHZhciBjYXN0ID0gX19kZXBlbmRlbmN5
NV9fWyJkZWZhdWx0Il07CiAgICB2YXIgYWxsID0gX19kZXBlbmRlbmN5Nl9fWyJkZWZhdWx0Il07
CiAgICB2YXIgcmFjZSA9IF9fZGVwZW5kZW5jeTdfX1siZGVmYXVsdCJdOwogICAgdmFyIFJlc29s
dmUgPSBfX2RlcGVuZGVuY3k4X19bImRlZmF1bHQiXTsKICAgIHZhciBSZWplY3QgPSBfX2RlcGVu
ZGVuY3k5X19bImRlZmF1bHQiXTsKCiAgICB2YXIgZ3VpZEtleSA9ICdyc3ZwXycgKyBub3coKSAr
ICctJzsKICAgIHZhciBjb3VudGVyID0gMDsKCiAgICBmdW5jdGlvbiBub29wKCkge30KCiAgICBf
X2V4cG9ydHNfX1siZGVmYXVsdCJdID0gUHJvbWlzZTsKCgogICAgLyoqCiAgICAgIFByb21pc2Ug
b2JqZWN0cyByZXByZXNlbnQgdGhlIGV2ZW50dWFsIHJlc3VsdCBvZiBhbiBhc3luY2hyb25vdXMg
b3BlcmF0aW9uLiBUaGUKICAgICAgcHJpbWFyeSB3YXkgb2YgaW50ZXJhY3Rpbmcgd2l0aCBhIHBy
b21pc2UgaXMgdGhyb3VnaCBpdHMgYHRoZW5gIG1ldGhvZCwgd2hpY2gKICAgICAgcmVnaXN0ZXJz
IGNhbGxiYWNrcyB0byByZWNlaXZlIGVpdGhlciBhIHByb21pc2XigJlzIGV2ZW50dWFsIHZhbHVl
IG9yIHRoZSByZWFzb24KICAgICAgd2h5IHRoZSBwcm9taXNlIGNhbm5vdCBiZSBmdWxmaWxsZWQu
CgogICAgICBUZXJtaW5vbG9neQogICAgICAtLS0tLS0tLS0tLQoKICAgICAgLSBgcHJvbWlzZWAg
aXMgYW4gb2JqZWN0IG9yIGZ1bmN0aW9uIHdpdGggYSBgdGhlbmAgbWV0aG9kIHdob3NlIGJlaGF2
aW9yIGNvbmZvcm1zIHRvIHRoaXMgc3BlY2lmaWNhdGlvbi4KICAgICAgLSBgdGhlbmFibGVgIGlz
IGFuIG9iamVjdCBvciBmdW5jdGlvbiB0aGF0IGRlZmluZXMgYSBgdGhlbmAgbWV0aG9kLgogICAg
ICAtIGB2YWx1ZWAgaXMgYW55IGxlZ2FsIEphdmFTY3JpcHQgdmFsdWUgKGluY2x1ZGluZyB1bmRl
ZmluZWQsIGEgdGhlbmFibGUsIG9yIGEgcHJvbWlzZSkuCiAgICAgIC0gYGV4Y2VwdGlvbmAgaXMg
YSB2YWx1ZSB0aGF0IGlzIHRocm93biB1c2luZyB0aGUgdGhyb3cgc3RhdGVtZW50LgogICAgICAt
IGByZWFzb25gIGlzIGEgdmFsdWUgdGhhdCBpbmRpY2F0ZXMgd2h5IGEgcHJvbWlzZSB3YXMgcmVq
ZWN0ZWQuCiAgICAgIC0gYHNldHRsZWRgIHRoZSBmaW5hbCByZXN0aW5nIHN0YXRlIG9mIGEgcHJv
bWlzZSwgZnVsZmlsbGVkIG9yIHJlamVjdGVkLgoKICAgICAgQSBwcm9taXNlIGNhbiBiZSBpbiBv
bmUgb2YgdGhyZWUgc3RhdGVzOiBwZW5kaW5nLCBmdWxmaWxsZWQsIG9yIHJlamVjdGVkLgoKICAg
ICAgUHJvbWlzZXMgdGhhdCBhcmUgZnVsZmlsbGVkIGhhdmUgYSBmdWxmaWxsbWVudCB2YWx1ZSBh
bmQgYXJlIGluIHRoZSBmdWxmaWxsZWQKICAgICAgc3RhdGUuICBQcm9taXNlcyB0aGF0IGFyZSBy
ZWplY3RlZCBoYXZlIGEgcmVqZWN0aW9uIHJlYXNvbiBhbmQgYXJlIGluIHRoZQogICAgICByZWpl
Y3RlZCBzdGF0ZS4gIEEgZnVsZmlsbG1lbnQgdmFsdWUgaXMgbmV2ZXIgYSB0aGVuYWJsZS4gIFNp
bWlsYXJseSwgYQogICAgICByZWplY3Rpb24gcmVhc29uIGlzIG5ldmVyIGEgdGhlbmFibGUuCgog
ICAgICBQcm9taXNlcyBjYW4gYWxzbyBiZSBzYWlkIHRvICpyZXNvbHZlKiBhIHZhbHVlLiAgSWYg
dGhpcyB2YWx1ZSBpcyBhbHNvIGEKICAgICAgcHJvbWlzZSwgdGhlbiB0aGUgb3JpZ2luYWwgcHJv
bWlzZSdzIHNldHRsZWQgc3RhdGUgd2lsbCBtYXRjaCB0aGUgdmFsdWUncwogICAgICBzZXR0bGVk
IHN0YXRlLiAgU28gYSBwcm9taXNlIHRoYXQgKnJlc29sdmVzKiBhIHByb21pc2UgdGhhdCByZWpl
Y3RzIHdpbGwKICAgICAgaXRzZWxmIHJlamVjdCwgYW5kIGEgcHJvbWlzZSB0aGF0ICpyZXNvbHZl
cyogYSBwcm9taXNlIHRoYXQgZnVsZmlsbHMgd2lsbAogICAgICBpdHNlbGYgZnVsZmlsbC4KCgog
ICAgICBCYXNpYyBVc2FnZToKICAgICAgLS0tLS0tLS0tLS0tCgogICAgICBgYGBqcwogICAgICB2
YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAg
ICAgIC8vIG9uIHN1Y2Nlc3MKICAgICAgICByZXNvbHZlKHZhbHVlKTsKCiAgICAgICAgLy8gb24g
ZmFpbHVyZQogICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICB9KTsKCiAgICAgIHByb21pc2Uu
dGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIC8vIG9uIGZ1bGZpbGxtZW50CiAgICAgIH0s
IGZ1bmN0aW9uKHJlYXNvbikgewogICAgICAgIC8vIG9uIHJlamVjdGlvbgogICAgICB9KTsKICAg
ICAgYGBgCgogICAgICBBZHZhbmNlZCBVc2FnZToKICAgICAgLS0tLS0tLS0tLS0tLS0tCgogICAg
ICBQcm9taXNlcyBzaGluZSB3aGVuIGFic3RyYWN0aW5nIGF3YXkgYXN5bmNocm9ub3VzIGludGVy
YWN0aW9ucyBzdWNoIGFzCiAgICAgIGBYTUxIdHRwUmVxdWVzdGBzLgoKICAgICAgYGBganMKICAg
ICAgZnVuY3Rpb24gZ2V0SlNPTih1cmwpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVu
Y3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXsKICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJl
cXVlc3QoKTsKCiAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsKTsKICAgICAgICAgIHhoci5v
bnJlYWR5c3RhdGVjaGFuZ2UgPSBoYW5kbGVyOwogICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9
ICdqc29uJzsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCAnYXBwbGlj
YXRpb24vanNvbicpOwogICAgICAgICAgeGhyLnNlbmQoKTsKCiAgICAgICAgICBmdW5jdGlvbiBo
YW5kbGVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSB0aGlzLkRPTkUp
IHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAg
ICAgcmVzb2x2ZSh0aGlzLnJlc3BvbnNlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg
ICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigiZ2V0SlNPTjogYCIgKyB1cmwgKyAiYCBmYWlsZWQg
d2l0aCBzdGF0dXM6IFsiICsgdGhpcy5zdGF0dXMgKyAiXSIpOwogICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZ2V0SlNP
TignL3Bvc3RzLmpzb24nKS50aGVuKGZ1bmN0aW9uKGpzb24pIHsKICAgICAgICAvLyBvbiBmdWxm
aWxsbWVudAogICAgICB9LCBmdW5jdGlvbihyZWFzb24pIHsKICAgICAgICAvLyBvbiByZWplY3Rp
b24KICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgVW5saWtlIGNhbGxiYWNrcywgcHJvbWlzZXMg
YXJlIGdyZWF0IGNvbXBvc2FibGUgcHJpbWl0aXZlcy4KCiAgICAgIGBgYGpzCiAgICAgIFByb21p
c2UuYWxsKFsKICAgICAgICBnZXRKU09OKCcvcG9zdHMnKSwKICAgICAgICBnZXRKU09OKCcvY29t
bWVudHMnKQogICAgICBdKS50aGVuKGZ1bmN0aW9uKHZhbHVlcyl7CiAgICAgICAgdmFsdWVzWzBd
IC8vID0+IHBvc3RzSlNPTgogICAgICAgIHZhbHVlc1sxXSAvLyA9PiBjb21tZW50c0pTT04KCiAg
ICAgICAgcmV0dXJuIHZhbHVlczsKICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgQGNsYXNzIFJT
VlAuUHJvbWlzZQogICAgICBAcGFyYW0ge2Z1bmN0aW9ufQogICAgICBAcGFyYW0ge1N0cmluZ30g
bGFiZWwgb3B0aW9uYWwgc3RyaW5nIGZvciBsYWJlbGluZyB0aGUgcHJvbWlzZS4KICAgICAgVXNl
ZnVsIGZvciB0b29saW5nLgogICAgICBAY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBQ
cm9taXNlKHJlc29sdmVyLCBsYWJlbCkgewogICAgICBpZiAoIWlzRnVuY3Rpb24ocmVzb2x2ZXIp
KSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignWW91IG11c3QgcGFzcyBhIHJlc29sdmVy
IGZ1bmN0aW9uIGFzIHRoZSBmaXJzdCBhcmd1bWVudCB0byB0aGUgcHJvbWlzZSBjb25zdHJ1Y3Rv
cicpOwogICAgICB9CgogICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAg
ICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJGYWlsZWQgdG8gY29uc3RydWN0ICdQcm9taXNlJzog
UGxlYXNlIHVzZSB0aGUgJ25ldycgb3BlcmF0b3IsIHRoaXMgb2JqZWN0IGNvbnN0cnVjdG9yIGNh
bm5vdCBiZSBjYWxsZWQgYXMgYSBmdW5jdGlvbi4iKTsKICAgICAgfQoKICAgICAgdGhpcy5faWQg
PSBjb3VudGVyKys7CiAgICAgIHRoaXMuX2xhYmVsID0gbGFiZWw7CiAgICAgIHRoaXMuX3N1YnNj
cmliZXJzID0gW107CgogICAgICBpZiAoY29uZmlnLmluc3RydW1lbnQpIHsKICAgICAgICBpbnN0
cnVtZW50KCdjcmVhdGVkJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIGlmIChub29wICE9PSByZXNv
bHZlcikgewogICAgICAgIGludm9rZVJlc29sdmVyKHJlc29sdmVyLCB0aGlzKTsKICAgICAgfQog
ICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZVJlc29sdmVyKHJlc29sdmVyLCBwcm9taXNlKSB7CiAg
ICAgIGZ1bmN0aW9uIHJlc29sdmVQcm9taXNlKHZhbHVlKSB7CiAgICAgICAgcmVzb2x2ZShwcm9t
aXNlLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHJlamVjdFByb21pc2UocmVhc29u
KSB7CiAgICAgICAgcmVqZWN0KHByb21pc2UsIHJlYXNvbik7CiAgICAgIH0KCiAgICAgIHRyeSB7
CiAgICAgICAgcmVzb2x2ZXIocmVzb2x2ZVByb21pc2UsIHJlamVjdFByb21pc2UpOwogICAgICB9
IGNhdGNoKGUpIHsKICAgICAgICByZWplY3RQcm9taXNlKGUpOwogICAgICB9CiAgICB9CgogICAg
UHJvbWlzZS5jYXN0ID0gY2FzdDsKICAgIFByb21pc2UuYWxsID0gYWxsOwogICAgUHJvbWlzZS5y
YWNlID0gcmFjZTsKICAgIFByb21pc2UucmVzb2x2ZSA9IFJlc29sdmU7CiAgICBQcm9taXNlLnJl
amVjdCA9IFJlamVjdDsKCiAgICB2YXIgUEVORElORyAgID0gdm9pZCAwOwogICAgdmFyIFNFQUxF
RCAgICA9IDA7CiAgICB2YXIgRlVMRklMTEVEID0gMTsKICAgIHZhciBSRUpFQ1RFRCAgPSAyOwoK
ICAgIGZ1bmN0aW9uIHN1YnNjcmliZShwYXJlbnQsIGNoaWxkLCBvbkZ1bGZpbGxtZW50LCBvblJl
amVjdGlvbikgewogICAgICB2YXIgc3Vic2NyaWJlcnMgPSBwYXJlbnQuX3N1YnNjcmliZXJzOwog
ICAgICB2YXIgbGVuZ3RoID0gc3Vic2NyaWJlcnMubGVuZ3RoOwoKICAgICAgc3Vic2NyaWJlcnNb
bGVuZ3RoXSA9IGNoaWxkOwogICAgICBzdWJzY3JpYmVyc1tsZW5ndGggKyBGVUxGSUxMRURdID0g
b25GdWxmaWxsbWVudDsKICAgICAgc3Vic2NyaWJlcnNbbGVuZ3RoICsgUkVKRUNURURdICA9IG9u
UmVqZWN0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1Ymxpc2gocHJvbWlzZSwgc2V0dGxlZCkg
ewogICAgICB2YXIgY2hpbGQsIGNhbGxiYWNrLCBzdWJzY3JpYmVycyA9IHByb21pc2UuX3N1YnNj
cmliZXJzLCBkZXRhaWwgPSBwcm9taXNlLl9kZXRhaWw7CgogICAgICBpZiAoY29uZmlnLmluc3Ry
dW1lbnQpIHsKICAgICAgICBpbnN0cnVtZW50KHNldHRsZWQgPT09IEZVTEZJTExFRCA/ICdmdWxm
aWxsZWQnIDogJ3JlamVjdGVkJywgcHJvbWlzZSk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkg
PSAwOyBpIDwgc3Vic2NyaWJlcnMubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICBjaGlsZCA9IHN1
YnNjcmliZXJzW2ldOwogICAgICAgIGNhbGxiYWNrID0gc3Vic2NyaWJlcnNbaSArIHNldHRsZWRd
OwoKICAgICAgICBpbnZva2VDYWxsYmFjayhzZXR0bGVkLCBjaGlsZCwgY2FsbGJhY2ssIGRldGFp
bCk7CiAgICAgIH0KCiAgICAgIHByb21pc2UuX3N1YnNjcmliZXJzID0gbnVsbDsKICAgIH0KCiAg
ICBQcm9taXNlLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IFByb21pc2UsCgogICAg
ICBfaWQ6IHVuZGVmaW5lZCwKICAgICAgX2d1aWRLZXk6IGd1aWRLZXksCiAgICAgIF9sYWJlbDog
dW5kZWZpbmVkLAoKICAgICAgX3N0YXRlOiB1bmRlZmluZWQsCiAgICAgIF9kZXRhaWw6IHVuZGVm
aW5lZCwKICAgICAgX3N1YnNjcmliZXJzOiB1bmRlZmluZWQsCgogICAgICBfb25lcnJvcjogZnVu
Y3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbmZpZy50cmlnZ2VyKCdlcnJvcicsIHJlYXNvbik7
CiAgICAgIH0sCgogICAgLyoqCiAgICAgIFRoZSBwcmltYXJ5IHdheSBvZiBpbnRlcmFjdGluZyB3
aXRoIGEgcHJvbWlzZSBpcyB0aHJvdWdoIGl0cyBgdGhlbmAgbWV0aG9kLAogICAgICB3aGljaCBy
ZWdpc3RlcnMgY2FsbGJhY2tzIHRvIHJlY2VpdmUgZWl0aGVyIGEgcHJvbWlzZSdzIGV2ZW50dWFs
IHZhbHVlIG9yIHRoZQogICAgICByZWFzb24gd2h5IHRoZSBwcm9taXNlIGNhbm5vdCBiZSBmdWxm
aWxsZWQuCgogICAgICBgYGBqcwogICAgICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcil7
CiAgICAgICAgLy8gdXNlciBpcyBhdmFpbGFibGUKICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKXsK
ICAgICAgICAvLyB1c2VyIGlzIHVuYXZhaWxhYmxlLCBhbmQgeW91IGFyZSBnaXZlbiB0aGUgcmVh
c29uIHdoeQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBDaGFpbmluZwogICAgICAtLS0tLS0t
LQoKICAgICAgVGhlIHJldHVybiB2YWx1ZSBvZiBgdGhlbmAgaXMgaXRzZWxmIGEgcHJvbWlzZS4g
IFRoaXMgc2Vjb25kLCAiZG93bnN0cmVhbSIKICAgICAgcHJvbWlzZSBpcyByZXNvbHZlZCB3aXRo
IHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZpcnN0IHByb21pc2UncyBmdWxmaWxsbWVudAogICAg
ICBvciByZWplY3Rpb24gaGFuZGxlciwgb3IgcmVqZWN0ZWQgaWYgdGhlIGhhbmRsZXIgdGhyb3dz
IGFuIGV4Y2VwdGlvbi4KCiAgICAgIGBgYGpzCiAgICAgIGZpbmRVc2VyKCkudGhlbihmdW5jdGlv
biAodXNlcikgewogICAgICAgIHJldHVybiB1c2VyLm5hbWU7CiAgICAgIH0sIGZ1bmN0aW9uIChy
ZWFzb24pIHsKICAgICAgICByZXR1cm4gImRlZmF1bHQgbmFtZSI7CiAgICAgIH0pLnRoZW4oZnVu
Y3Rpb24gKHVzZXJOYW1lKSB7CiAgICAgICAgLy8gSWYgYGZpbmRVc2VyYCBmdWxmaWxsZWQsIGB1
c2VyTmFtZWAgd2lsbCBiZSB0aGUgdXNlcidzIG5hbWUsIG90aGVyd2lzZSBpdAogICAgICAgIC8v
IHdpbGwgYmUgYCJkZWZhdWx0IG5hbWUiYAogICAgICB9KTsKCiAgICAgIGZpbmRVc2VyKCkudGhl
bihmdW5jdGlvbiAodXNlcikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRm91bmQgdXNlciwg
YnV0IHN0aWxsIHVuaGFwcHkiKTsKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAg
IHRocm93IG5ldyBFcnJvcigiYGZpbmRVc2VyYCByZWplY3RlZCBhbmQgd2UncmUgdW5oYXBweSIp
OwogICAgICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIC8vIG5ldmVyIHJlYWNo
ZWQKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIC8vIGlmIGBmaW5kVXNlcmAg
ZnVsZmlsbGVkLCBgcmVhc29uYCB3aWxsIGJlICJGb3VuZCB1c2VyLCBidXQgc3RpbGwgdW5oYXBw
eSIuCiAgICAgICAgLy8gSWYgYGZpbmRVc2VyYCByZWplY3RlZCwgYHJlYXNvbmAgd2lsbCBiZSAi
YGZpbmRVc2VyYCByZWplY3RlZCBhbmQgd2UncmUgdW5oYXBweSIuCiAgICAgIH0pOwogICAgICBg
YGAKICAgICAgSWYgdGhlIGRvd25zdHJlYW0gcHJvbWlzZSBkb2VzIG5vdCBzcGVjaWZ5IGEgcmVq
ZWN0aW9uIGhhbmRsZXIsIHJlamVjdGlvbiByZWFzb25zIHdpbGwgYmUgcHJvcGFnYXRlZCBmdXJ0
aGVyIGRvd25zdHJlYW0uCgogICAgICBgYGBqcwogICAgICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rp
b24gKHVzZXIpIHsKICAgICAgICB0aHJvdyBuZXcgUGVkYWdvZ2ljYWxFeGNlcHRpb24oIlVwc3Ry
ZWFtIGVycm9yIik7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgLy8g
bmV2ZXIgcmVhY2hlZAogICAgICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIC8v
IG5ldmVyIHJlYWNoZWQKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIC8vIFRo
ZSBgUGVkZ2Fnb2NpYWxFeGNlcHRpb25gIGlzIHByb3BhZ2F0ZWQgYWxsIHRoZSB3YXkgZG93biB0
byBoZXJlCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEFzc2ltaWxhdGlvbgogICAgICAtLS0t
LS0tLS0tLS0KCiAgICAgIFNvbWV0aW1lcyB0aGUgdmFsdWUgeW91IHdhbnQgdG8gcHJvcGFnYXRl
IHRvIGEgZG93bnN0cmVhbSBwcm9taXNlIGNhbiBvbmx5IGJlCiAgICAgIHJldHJpZXZlZCBhc3lu
Y2hyb25vdXNseS4gVGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmV0dXJuaW5nIGEgcHJvbWlzZSBp
biB0aGUKICAgICAgZnVsZmlsbG1lbnQgb3IgcmVqZWN0aW9uIGhhbmRsZXIuIFRoZSBkb3duc3Ry
ZWFtIHByb21pc2Ugd2lsbCB0aGVuIGJlIHBlbmRpbmcKICAgICAgdW50aWwgdGhlIHJldHVybmVk
IHByb21pc2UgaXMgc2V0dGxlZC4gVGhpcyBpcyBjYWxsZWQgKmFzc2ltaWxhdGlvbiouCgogICAg
ICBgYGBqcwogICAgICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHsKICAgICAgICBy
ZXR1cm4gZmluZENvbW1lbnRzQnlBdXRob3IodXNlcik7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24g
KGNvbW1lbnRzKSB7CiAgICAgICAgLy8gVGhlIHVzZXIncyBjb21tZW50cyBhcmUgbm93IGF2YWls
YWJsZQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBJZiB0aGUgYXNzaW1saWF0ZWQgcHJvbWlz
ZSByZWplY3RzLCB0aGVuIHRoZSBkb3duc3RyZWFtIHByb21pc2Ugd2lsbCBhbHNvIHJlamVjdC4K
CiAgICAgIGBgYGpzCiAgICAgIGZpbmRVc2VyKCkudGhlbihmdW5jdGlvbiAodXNlcikgewogICAg
ICAgIHJldHVybiBmaW5kQ29tbWVudHNCeUF1dGhvcih1c2VyKTsKICAgICAgfSkudGhlbihmdW5j
dGlvbiAoY29tbWVudHMpIHsKICAgICAgICAvLyBJZiBgZmluZENvbW1lbnRzQnlBdXRob3JgIGZ1
bGZpbGxzLCB3ZSdsbCBoYXZlIHRoZSB2YWx1ZSBoZXJlCiAgICAgIH0sIGZ1bmN0aW9uIChyZWFz
b24pIHsKICAgICAgICAvLyBJZiBgZmluZENvbW1lbnRzQnlBdXRob3JgIHJlamVjdHMsIHdlJ2xs
IGhhdmUgdGhlIHJlYXNvbiBoZXJlCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIFNpbXBsZSBF
eGFtcGxlCiAgICAgIC0tLS0tLS0tLS0tLS0tCgogICAgICBTeW5jaHJvbm91cyBFeGFtcGxlCgog
ICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciByZXN1bHQ7CgogICAgICB0cnkgewogICAgICAg
IHJlc3VsdCA9IGZpbmRSZXN1bHQoKTsKICAgICAgICAvLyBzdWNjZXNzCiAgICAgIH0gY2F0Y2go
cmVhc29uKSB7CiAgICAgICAgLy8gZmFpbHVyZQogICAgICB9CiAgICAgIGBgYAoKICAgICAgRXJy
YmFjayBFeGFtcGxlCgogICAgICBgYGBqcwogICAgICBmaW5kUmVzdWx0KGZ1bmN0aW9uKHJlc3Vs
dCwgZXJyKXsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAvLyBmYWlsdXJlCiAgICAgICAg
fSBlbHNlIHsKICAgICAgICAgIC8vIHN1Y2Nlc3MKICAgICAgICB9CiAgICAgIH0pOwogICAgICBg
YGAKCiAgICAgIFByb21pc2UgRXhhbXBsZTsKCiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgZmlu
ZFJlc3VsdCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAvLyBzdWNjZXNzCiAgICAg
IH0sIGZ1bmN0aW9uKHJlYXNvbil7CiAgICAgICAgLy8gZmFpbHVyZQogICAgICB9KTsKICAgICAg
YGBgCgogICAgICBBZHZhbmNlZCBFeGFtcGxlCiAgICAgIC0tLS0tLS0tLS0tLS0tCgogICAgICBT
eW5jaHJvbm91cyBFeGFtcGxlCgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciBhdXRob3Is
IGJvb2tzOwoKICAgICAgdHJ5IHsKICAgICAgICBhdXRob3IgPSBmaW5kQXV0aG9yKCk7CiAgICAg
ICAgYm9va3MgID0gZmluZEJvb2tzQnlBdXRob3IoYXV0aG9yKTsKICAgICAgICAvLyBzdWNjZXNz
CiAgICAgIH0gY2F0Y2gocmVhc29uKSB7CiAgICAgICAgLy8gZmFpbHVyZQogICAgICB9CiAgICAg
IGBgYAoKICAgICAgRXJyYmFjayBFeGFtcGxlCgogICAgICBgYGBqcwoKICAgICAgZnVuY3Rpb24g
Zm91bmRCb29rcyhib29rcykgewoKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZmFpbHVyZShyZWFz
b24pIHsKCiAgICAgIH0KCiAgICAgIGZpbmRBdXRob3IoZnVuY3Rpb24oYXV0aG9yLCBlcnIpewog
ICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGZhaWx1cmUoZXJyKTsKICAgICAgICAgIC8vIGZh
aWx1cmUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluZEJv
b29rc0J5QXV0aG9yKGF1dGhvciwgZnVuY3Rpb24oYm9va3MsIGVycikgewogICAgICAgICAgICAg
IGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIGZhaWx1cmUoZXJyKTsKICAgICAgICAgICAgICB9
IGVsc2UgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgZm91bmRCb29r
cyhib29rcyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoKHJlYXNvbikgewogICAgICAgICAgICAg
ICAgICBmYWlsdXJlKHJlYXNvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQog
ICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgICAgICAgZmFp
bHVyZShlcnIpOwogICAgICAgICAgfQogICAgICAgICAgLy8gc3VjY2VzcwogICAgICAgIH0KICAg
ICAgfSk7CiAgICAgIGBgYAoKICAgICAgUHJvbWlzZSBFeGFtcGxlOwoKICAgICAgYGBgamF2YXNj
cmlwdAogICAgICBmaW5kQXV0aG9yKCkuCiAgICAgICAgdGhlbihmaW5kQm9va3NCeUF1dGhvciku
CiAgICAgICAgdGhlbihmdW5jdGlvbihib29rcyl7CiAgICAgICAgICAvLyBmb3VuZCBib29rcwog
ICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pewogICAgICAgIC8vIHNvbWV0aGluZyB3ZW50
IHdyb25nCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEBtZXRob2QgdGhlbgogICAgICBAcGFy
YW0ge0Z1bmN0aW9ufSBvbkZ1bGZpbGxlZAogICAgICBAcGFyYW0ge0Z1bmN0aW9ufSBvblJlamVj
dGVkCiAgICAgIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJpbmcgZm9yIGxhYmVs
aW5nIHRoZSBwcm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAgICAgIEByZXR1cm4g
e1Byb21pc2V9CiAgICAqLwogICAgICB0aGVuOiBmdW5jdGlvbihvbkZ1bGZpbGxtZW50LCBvblJl
amVjdGlvbiwgbGFiZWwpIHsKICAgICAgICB2YXIgcHJvbWlzZSA9IHRoaXM7CiAgICAgICAgdGhp
cy5fb25lcnJvciA9IG51bGw7CgogICAgICAgIHZhciB0aGVuUHJvbWlzZSA9IG5ldyB0aGlzLmNv
bnN0cnVjdG9yKG5vb3AsIGxhYmVsKTsKCiAgICAgICAgaWYgKHRoaXMuX3N0YXRlKSB7CiAgICAg
ICAgICB2YXIgY2FsbGJhY2tzID0gYXJndW1lbnRzOwogICAgICAgICAgY29uZmlnLmFzeW5jKGZ1
bmN0aW9uIGludm9rZVByb21pc2VDYWxsYmFjaygpIHsKICAgICAgICAgICAgaW52b2tlQ2FsbGJh
Y2socHJvbWlzZS5fc3RhdGUsIHRoZW5Qcm9taXNlLCBjYWxsYmFja3NbcHJvbWlzZS5fc3RhdGUg
LSAxXSwgcHJvbWlzZS5fZGV0YWlsKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgICBzdWJzY3JpYmUodGhpcywgdGhlblByb21pc2UsIG9uRnVsZmlsbG1lbnQsIG9uUmVq
ZWN0aW9uKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25maWcuaW5zdHJ1bWVudCkgewogICAg
ICAgICAgaW5zdHJ1bWVudCgnY2hhaW5lZCcsIHByb21pc2UsIHRoZW5Qcm9taXNlKTsKICAgICAg
ICB9CgogICAgICAgIHJldHVybiB0aGVuUHJvbWlzZTsKICAgICAgfSwKCiAgICAvKioKICAgICAg
YGNhdGNoYCBpcyBzaW1wbHkgc3VnYXIgZm9yIGB0aGVuKHVuZGVmaW5lZCwgb25SZWplY3Rpb24p
YCB3aGljaCBtYWtlcyBpdCB0aGUgc2FtZQogICAgICBhcyB0aGUgY2F0Y2ggYmxvY2sgb2YgYSB0
cnkvY2F0Y2ggc3RhdGVtZW50LgoKICAgICAgYGBganMKICAgICAgZnVuY3Rpb24gZmluZEF1dGhv
cigpewogICAgICAgIHRocm93IG5ldyBFcnJvcigiY291bGRuJ3QgZmluZCB0aGF0IGF1dGhvciIp
OwogICAgICB9CgogICAgICAvLyBzeW5jaHJvbm91cwogICAgICB0cnkgewogICAgICAgIGZpbmRB
dXRob3IoKTsKICAgICAgfSBjYXRjaChyZWFzb24pIHsKICAgICAgICAvLyBzb21ldGhpbmcgd2Vu
dCB3cm9uZwogICAgICB9CgogICAgICAvLyBhc3luYyB3aXRoIHByb21pc2VzCiAgICAgIGZpbmRB
dXRob3IoKS5jYXRjaChmdW5jdGlvbihyZWFzb24pewogICAgICAgIC8vIHNvbWV0aGluZyB3ZW50
IHdyb25nCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEBtZXRob2QgY2F0Y2gKICAgICAgQHBh
cmFtIHtGdW5jdGlvbn0gb25SZWplY3Rpb24KICAgICAgQHBhcmFtIHtTdHJpbmd9IGxhYmVsIG9w
dGlvbmFsIHN0cmluZyBmb3IgbGFiZWxpbmcgdGhlIHByb21pc2UuCiAgICAgIFVzZWZ1bCBmb3Ig
dG9vbGluZy4KICAgICAgQHJldHVybiB7UHJvbWlzZX0KICAgICovCiAgICAgICdjYXRjaCc6IGZ1
bmN0aW9uKG9uUmVqZWN0aW9uLCBsYWJlbCkgewogICAgICAgIHJldHVybiB0aGlzLnRoZW4obnVs
bCwgb25SZWplY3Rpb24sIGxhYmVsKTsKICAgICAgfSwKCiAgICAvKioKICAgICAgYGZpbmFsbHlg
IHdpbGwgYmUgaW52b2tlZCByZWdhcmRsZXNzIG9mIHRoZSBwcm9taXNlJ3MgZmF0ZSBqdXN0IGFz
IG5hdGl2ZQogICAgICB0cnkvY2F0Y2gvZmluYWxseSBiZWhhdmVzCgogICAgICBTeW5jaHJvbm91
cyBleGFtcGxlOgoKICAgICAgYGBganMKICAgICAgZmluZEF1dGhvcigpIHsKICAgICAgICBpZiAo
TWF0aC5yYW5kb20oKSA+IDAuNSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICAg
ICAgfQogICAgICAgIHJldHVybiBuZXcgQXV0aG9yKCk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAg
ICAgICAgcmV0dXJuIGZpbmRBdXRob3IoKTsgLy8gc3VjY2VlZCBvciBmYWlsCiAgICAgIH0gY2F0
Y2goZXJyb3IpIHsKICAgICAgICByZXR1cm4gZmluZE90aGVyQXV0aGVyKCk7CiAgICAgIH0gZmlu
YWxseSB7CiAgICAgICAgLy8gYWx3YXlzIHJ1bnMKICAgICAgICAvLyBkb2Vzbid0IGFmZmVjdCB0
aGUgcmV0dXJuIHZhbHVlCiAgICAgIH0KICAgICAgYGBgCgogICAgICBBc3luY2hyb25vdXMgZXhh
bXBsZToKCiAgICAgIGBgYGpzCiAgICAgIGZpbmRBdXRob3IoKS5jYXRjaChmdW5jdGlvbihyZWFz
b24pewogICAgICAgIHJldHVybiBmaW5kT3RoZXJBdXRoZXIoKTsKICAgICAgfSkuZmluYWxseShm
dW5jdGlvbigpewogICAgICAgIC8vIGF1dGhvciB3YXMgZWl0aGVyIGZvdW5kLCBvciBub3QKICAg
ICAgfSk7CiAgICAgIGBgYAoKICAgICAgQG1ldGhvZCBmaW5hbGx5CiAgICAgIEBwYXJhbSB7RnVu
Y3Rpb259IGNhbGxiYWNrCiAgICAgIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJp
bmcgZm9yIGxhYmVsaW5nIHRoZSBwcm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAg
ICAgIEByZXR1cm4ge1Byb21pc2V9CiAgICAqLwogICAgICAnZmluYWxseSc6IGZ1bmN0aW9uKGNh
bGxiYWNrLCBsYWJlbCkgewogICAgICAgIHZhciBjb25zdHJ1Y3RvciA9IHRoaXMuY29uc3RydWN0
b3I7CgogICAgICAgIHJldHVybiB0aGlzLnRoZW4oZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAg
IHJldHVybiBjb25zdHJ1Y3Rvci5jYXN0KGNhbGxiYWNrKCkpLnRoZW4oZnVuY3Rpb24oKXsKICAg
ICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24o
cmVhc29uKSB7CiAgICAgICAgICByZXR1cm4gY29uc3RydWN0b3IuY2FzdChjYWxsYmFjaygpKS50
aGVuKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgIH0pOwog
ICAgICAgIH0sIGxhYmVsKTsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBpbnZva2VDYWxs
YmFjayhzZXR0bGVkLCBwcm9taXNlLCBjYWxsYmFjaywgZGV0YWlsKSB7CiAgICAgIHZhciBoYXND
YWxsYmFjayA9IGlzRnVuY3Rpb24oY2FsbGJhY2spLAogICAgICAgICAgdmFsdWUsIGVycm9yLCBz
dWNjZWVkZWQsIGZhaWxlZDsKCiAgICAgIGlmIChoYXNDYWxsYmFjaykgewogICAgICAgIHRyeSB7
CiAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKGRldGFpbCk7CiAgICAgICAgICBzdWNjZWVkZWQg
PSB0cnVlOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgZmFpbGVkID0gdHJ1ZTsKICAg
ICAgICAgIGVycm9yID0gZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsdWUg
PSBkZXRhaWw7CiAgICAgICAgc3VjY2VlZGVkID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKGhh
bmRsZVRoZW5hYmxlKHByb21pc2UsIHZhbHVlKSkgewogICAgICAgIHJldHVybjsKICAgICAgfSBl
bHNlIGlmIChoYXNDYWxsYmFjayAmJiBzdWNjZWVkZWQpIHsKICAgICAgICByZXNvbHZlKHByb21p
c2UsIHZhbHVlKTsKICAgICAgfSBlbHNlIGlmIChmYWlsZWQpIHsKICAgICAgICByZWplY3QocHJv
bWlzZSwgZXJyb3IpOwogICAgICB9IGVsc2UgaWYgKHNldHRsZWQgPT09IEZVTEZJTExFRCkgewog
ICAgICAgIHJlc29sdmUocHJvbWlzZSwgdmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHNldHRsZWQg
PT09IFJFSkVDVEVEKSB7CiAgICAgICAgcmVqZWN0KHByb21pc2UsIHZhbHVlKTsKICAgICAgfQog
ICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZVRoZW5hYmxlKHByb21pc2UsIHZhbHVlKSB7CiAgICAg
IHZhciB0aGVuID0gbnVsbCwKICAgICAgcmVzb2x2ZWQ7CgogICAgICB0cnkgewogICAgICAgIGlm
IChwcm9taXNlID09PSB2YWx1ZSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSBw
cm9taXNlcyBjYWxsYmFjayBjYW5ub3QgcmV0dXJuIHRoYXQgc2FtZSBwcm9taXNlLiIpOwogICAg
ICAgIH0KCiAgICAgICAgaWYgKG9iamVjdE9yRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgICB0
aGVuID0gdmFsdWUudGhlbjsKCiAgICAgICAgICBpZiAoaXNGdW5jdGlvbih0aGVuKSkgewogICAg
ICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgICAgIGlm
IChyZXNvbHZlZCkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1
ZTsKCiAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB2YWwpIHsKICAgICAgICAgICAgICAgIHJl
c29sdmUocHJvbWlzZSwgdmFsKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg
ICAgZnVsZmlsbChwcm9taXNlLCB2YWwpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwg
ZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICAgICAgaWYgKHJlc29sdmVkKSB7IHJldHVybiB0cnVl
OyB9CiAgICAgICAgICAgICAgcmVzb2x2ZWQgPSB0cnVlOwoKICAgICAgICAgICAgICByZWplY3Qo
cHJvbWlzZSwgdmFsKTsKICAgICAgICAgICAgfSwgJ2Rlcml2ZWQgZnJvbTogJyArIChwcm9taXNl
Ll9sYWJlbCB8fCAnIHVua25vd24gcHJvbWlzZScpKTsKCiAgICAgICAgICAgIHJldHVybiB0cnVl
OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBp
ZiAocmVzb2x2ZWQpIHsgcmV0dXJuIHRydWU7IH0KICAgICAgICByZWplY3QocHJvbWlzZSwgZXJy
b3IpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAg
ICB9CgogICAgZnVuY3Rpb24gcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSkgewogICAgICBpZiAocHJv
bWlzZSA9PT0gdmFsdWUpIHsKICAgICAgICBmdWxmaWxsKHByb21pc2UsIHZhbHVlKTsKICAgICAg
fSBlbHNlIGlmICghaGFuZGxlVGhlbmFibGUocHJvbWlzZSwgdmFsdWUpKSB7CiAgICAgICAgZnVs
ZmlsbChwcm9taXNlLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmdWxmaWxs
KHByb21pc2UsIHZhbHVlKSB7CiAgICAgIGlmIChwcm9taXNlLl9zdGF0ZSAhPT0gUEVORElORykg
eyByZXR1cm47IH0KICAgICAgcHJvbWlzZS5fc3RhdGUgPSBTRUFMRUQ7CiAgICAgIHByb21pc2Uu
X2RldGFpbCA9IHZhbHVlOwoKICAgICAgY29uZmlnLmFzeW5jKHB1Ymxpc2hGdWxmaWxsbWVudCwg
cHJvbWlzZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVqZWN0KHByb21pc2UsIHJlYXNvbikgewog
ICAgICBpZiAocHJvbWlzZS5fc3RhdGUgIT09IFBFTkRJTkcpIHsgcmV0dXJuOyB9CiAgICAgIHBy
b21pc2UuX3N0YXRlID0gU0VBTEVEOwogICAgICBwcm9taXNlLl9kZXRhaWwgPSByZWFzb247Cgog
ICAgICBjb25maWcuYXN5bmMocHVibGlzaFJlamVjdGlvbiwgcHJvbWlzZSk7CiAgICB9CgogICAg
ZnVuY3Rpb24gcHVibGlzaEZ1bGZpbGxtZW50KHByb21pc2UpIHsKICAgICAgcHVibGlzaChwcm9t
aXNlLCBwcm9taXNlLl9zdGF0ZSA9IEZVTEZJTExFRCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHVi
bGlzaFJlamVjdGlvbihwcm9taXNlKSB7CiAgICAgIGlmIChwcm9taXNlLl9vbmVycm9yKSB7CiAg
ICAgICAgcHJvbWlzZS5fb25lcnJvcihwcm9taXNlLl9kZXRhaWwpOwogICAgICB9CgogICAgICBw
dWJsaXNoKHByb21pc2UsIHByb21pc2UuX3N0YXRlID0gUkVKRUNURUQpOwogICAgfQogIH0pOwpk
ZWZpbmUoInJzdnAvcHJvbWlzZS9hbGwiLCAKICBbIi4uL3V0aWxzIiwiZXhwb3J0cyJdLAogIGZ1
bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsK
ICAgIHZhciBpc0FycmF5ID0gX19kZXBlbmRlbmN5MV9fLmlzQXJyYXk7CiAgICB2YXIgaXNOb25U
aGVuYWJsZSA9IF9fZGVwZW5kZW5jeTFfXy5pc05vblRoZW5hYmxlOwoKICAgIC8qKgogICAgICBg
UlNWUC5Qcm9taXNlLmFsbGAgYWNjZXB0cyBhbiBhcnJheSBvZiBwcm9taXNlcywgYW5kIHJldHVy
bnMgYSBuZXcgcHJvbWlzZSB3aGljaAogICAgICBpcyBmdWxmaWxsZWQgd2l0aCBhbiBhcnJheSBv
ZiBmdWxmaWxsbWVudCB2YWx1ZXMgZm9yIHRoZSBwYXNzZWQgcHJvbWlzZXMsIG9yCiAgICAgIHJl
amVjdGVkIHdpdGggdGhlIHJlYXNvbiBvZiB0aGUgZmlyc3QgcGFzc2VkIHByb21pc2UgdG8gYmUg
cmVqZWN0ZWQuIEl0IGNhc3RzIGFsbAogICAgICBlbGVtZW50cyBvZiB0aGUgcGFzc2VkIGl0ZXJh
YmxlIHRvIHByb21pc2VzIGFzIGl0IHJ1bnMgdGhpcyBhbGdvcml0aG0uCgogICAgICBFeGFtcGxl
OgoKICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIgcHJvbWlzZTEgPSBSU1ZQLnJlc29sdmUo
MSk7CiAgICAgIHZhciBwcm9taXNlMiA9IFJTVlAucmVzb2x2ZSgyKTsKICAgICAgdmFyIHByb21p
c2UzID0gUlNWUC5yZXNvbHZlKDMpOwogICAgICB2YXIgcHJvbWlzZXMgPSBbIHByb21pc2UxLCBw
cm9taXNlMiwgcHJvbWlzZTMgXTsKCiAgICAgIFJTVlAuUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRo
ZW4oZnVuY3Rpb24oYXJyYXkpewogICAgICAgIC8vIFRoZSBhcnJheSBoZXJlIHdvdWxkIGJlIFsg
MSwgMiwgMyBdOwogICAgICB9KTsKICAgICAgYGBgCgogICAgICBJZiBhbnkgb2YgdGhlIGBwcm9t
aXNlc2AgZ2l2ZW4gdG8gYFJTVlAuYWxsYCBhcmUgcmVqZWN0ZWQsIHRoZSBmaXJzdCBwcm9taXNl
CiAgICAgIHRoYXQgaXMgcmVqZWN0ZWQgd2lsbCBiZSBnaXZlbiBhcyBhbiBhcmd1bWVudCB0byB0
aGUgcmV0dXJuZWQgcHJvbWlzZXMncwogICAgICByZWplY3Rpb24gaGFuZGxlci4gRm9yIGV4YW1w
bGU6CgogICAgICBFeGFtcGxlOgoKICAgICAgYGBgamF2YXNjcmlwdAogICAgICB2YXIgcHJvbWlz
ZTEgPSBSU1ZQLnJlc29sdmUoMSk7CiAgICAgIHZhciBwcm9taXNlMiA9IFJTVlAucmVqZWN0KG5l
dyBFcnJvcigiMiIpKTsKICAgICAgdmFyIHByb21pc2UzID0gUlNWUC5yZWplY3QobmV3IEVycm9y
KCIzIikpOwogICAgICB2YXIgcHJvbWlzZXMgPSBbIHByb21pc2UxLCBwcm9taXNlMiwgcHJvbWlz
ZTMgXTsKCiAgICAgIFJTVlAuUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24oYXJy
YXkpewogICAgICAgIC8vIENvZGUgaGVyZSBuZXZlciBydW5zIGJlY2F1c2UgdGhlcmUgYXJlIHJl
amVjdGVkIHByb21pc2VzIQogICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgIC8vIGVy
cm9yLm1lc3NhZ2UgPT09ICIyIgogICAgICB9KTsKICAgICAgYGBgCgogICAgICBAbWV0aG9kIGFs
bAogICAgICBAZm9yIFJTVlAuUHJvbWlzZQogICAgICBAcGFyYW0ge0FycmF5fSBlbnRyaWVzIGFy
cmF5IG9mIHByb21pc2VzCiAgICAgIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJp
bmcgZm9yIGxhYmVsaW5nIHRoZSBwcm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAg
ICAgIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgdGhhdCBpcyBmdWxmaWxsZWQgd2hlbiBhbGwg
YHByb21pc2VzYCBoYXZlIGJlZW4KICAgICAgZnVsZmlsbGVkLCBvciByZWplY3RlZCBpZiBhbnkg
b2YgdGhlbSBiZWNvbWUgcmVqZWN0ZWQuCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBfX2V4cG9y
dHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24gYWxsKGVudHJpZXMsIGxhYmVsKSB7CgogICAgICAv
KmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLwogICAgICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzOwoK
ICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3RvcihmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsK
ICAgICAgICBpZiAoIWlzQXJyYXkoZW50cmllcykpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBl
RXJyb3IoJ1lvdSBtdXN0IHBhc3MgYW4gYXJyYXkgdG8gYWxsLicpOwogICAgICAgIH0KCiAgICAg
ICAgdmFyIHJlbWFpbmluZyA9IGVudHJpZXMubGVuZ3RoOwogICAgICAgIHZhciByZXN1bHRzID0g
bmV3IEFycmF5KHJlbWFpbmluZyk7CiAgICAgICAgdmFyIGVudHJ5LCBwZW5kaW5nID0gdHJ1ZTsK
CiAgICAgICAgaWYgKHJlbWFpbmluZyA9PT0gMCkgewogICAgICAgICAgcmVzb2x2ZShyZXN1bHRz
KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxt
ZW50QXQoaW5kZXgpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAg
ICAgICByZXN1bHRzW2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgICBpZiAoLS1yZW1haW5pbmcg
PT09IDApIHsKICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdHMpOwogICAgICAgICAgICB9CiAg
ICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gb25SZWplY3Rpb24ocmVhc29u
KSB7CiAgICAgICAgICByZW1haW5pbmcgPSAwOwogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAg
ICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgZW50cmllcy5sZW5n
dGg7IGluZGV4KyspIHsKICAgICAgICAgIGVudHJ5ID0gZW50cmllc1tpbmRleF07CiAgICAgICAg
ICBpZiAoaXNOb25UaGVuYWJsZShlbnRyeSkpIHsKICAgICAgICAgICAgcmVzdWx0c1tpbmRleF0g
PSBlbnRyeTsKICAgICAgICAgICAgaWYgKC0tcmVtYWluaW5nID09PSAwKSB7CiAgICAgICAgICAg
ICAgcmVzb2x2ZShyZXN1bHRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgICAgQ29uc3RydWN0b3IuY2FzdChlbnRyeSkudGhlbihmdWxmaWxsbWVudEF0KGluZGV4
KSwgb25SZWplY3Rpb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbGFiZWwpOwog
ICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL3Byb21pc2UvY2FzdCIsIAogIFsiZXhwb3J0cyJdLAog
IGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKioKICAgICAg
YFJTVlAuUHJvbWlzZS5jYXN0YCBjb2VyY2VzIGl0cyBhcmd1bWVudCB0byBhIHByb21pc2UsIG9y
IHJldHVybnMgdGhlCiAgICAgIGFyZ3VtZW50IGlmIGl0IGlzIGFscmVhZHkgYSBwcm9taXNlIHdo
aWNoIHNoYXJlcyBhIGNvbnN0cnVjdG9yIHdpdGggdGhlIGNhc3Rlci4KCiAgICAgIEV4YW1wbGU6
CgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciBwcm9taXNlID0gUlNWUC5Qcm9taXNlLnJl
c29sdmUoMSk7CiAgICAgIHZhciBjYXN0ZWQgPSBSU1ZQLlByb21pc2UuY2FzdChwcm9taXNlKTsK
CiAgICAgIGNvbnNvbGUubG9nKHByb21pc2UgPT09IGNhc3RlZCk7IC8vIHRydWUKICAgICAgYGBg
CgogICAgICBJbiB0aGUgY2FzZSBvZiBhIHByb21pc2Ugd2hvc2UgY29uc3RydWN0b3IgZG9lcyBu
b3QgbWF0Y2gsIGl0IGlzIGFzc2ltaWxhdGVkLgogICAgICBUaGUgcmVzdWx0aW5nIHByb21pc2Ug
d2lsbCBmdWxmaWxsIG9yIHJlamVjdCBiYXNlZCBvbiB0aGUgb3V0Y29tZSBvZiB0aGUKICAgICAg
cHJvbWlzZSBiZWluZyBjYXN0ZWQuCgogICAgICBFeGFtcGxlOgoKICAgICAgYGBgamF2YXNjcmlw
dAogICAgICB2YXIgdGhlbm5hYmxlID0gJC5nZXRKU09OKCcvYXBpL2ZvbycpOwogICAgICB2YXIg
Y2FzdGVkID0gUlNWUC5Qcm9taXNlLmNhc3QodGhlbm5hYmxlKTsKCiAgICAgIGNvbnNvbGUubG9n
KHRoZW5uYWJsZSA9PT0gY2FzdGVkKTsgLy8gZmFsc2UKICAgICAgY29uc29sZS5sb2coY2FzdGVk
IGluc3RhbmNlb2YgUlNWUC5Qcm9taXNlKSAvLyB0cnVlCgogICAgICBjYXN0ZWQudGhlbihmdW5j
dGlvbihkYXRhKSB7CiAgICAgICAgLy8gZGF0YSBpcyB0aGUgdmFsdWUgZ2V0SlNPTiBmdWxmaWxs
cyB3aXRoCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEluIHRoZSBjYXNlIG9mIGEgbm9uLXBy
b21pc2UsIGEgcHJvbWlzZSB3aGljaCB3aWxsIGZ1bGZpbGwgd2l0aCB0aGF0IHZhbHVlIGlzCiAg
ICAgIHJldHVybmVkLgoKICAgICAgRXhhbXBsZToKCiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAg
dmFyIHZhbHVlID0gMTsgLy8gY291bGQgYmUgYSBudW1iZXIsIGJvb2xlYW4sIHN0cmluZywgdW5k
ZWZpbmVkLi4uCiAgICAgIHZhciBjYXN0ZWQgPSBSU1ZQLlByb21pc2UuY2FzdCh2YWx1ZSk7Cgog
ICAgICBjb25zb2xlLmxvZyh2YWx1ZSA9PT0gY2FzdGVkKTsgLy8gZmFsc2UKICAgICAgY29uc29s
ZS5sb2coY2FzdGVkIGluc3RhbmNlb2YgUlNWUC5Qcm9taXNlKSAvLyB0cnVlCgogICAgICBjYXN0
ZWQudGhlbihmdW5jdGlvbih2YWwpIHsKICAgICAgICB2YWwgPT09IHZhbHVlIC8vID0+IHRydWUK
ICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgYFJTVlAuUHJvbWlzZS5jYXN0YCBpcyBzaW1pbGFy
IHRvIGBSU1ZQLlByb21pc2UucmVzb2x2ZWAsIGJ1dCBgUlNWUC5Qcm9taXNlLmNhc3RgIGRpZmZl
cnMgaW4gdGhlCiAgICAgIGZvbGxvd2luZyB3YXlzOgoKICAgICAgKiBgUlNWUC5Qcm9taXNlLmNh
c3RgIHNlcnZlcyBhcyBhIG1lbW9yeS1lZmZpY2llbnQgd2F5IG9mIGdldHRpbmcgYSBwcm9taXNl
LCB3aGVuIHlvdQogICAgICBoYXZlIHNvbWV0aGluZyB0aGF0IGNvdWxkIGVpdGhlciBiZSBhIHBy
b21pc2Ugb3IgYSB2YWx1ZS4gUlNWUC5yZXNvbHZlCiAgICAgIHdpbGwgaGF2ZSB0aGUgc2FtZSBl
ZmZlY3QgYnV0IHdpbGwgY3JlYXRlIGEgbmV3IHByb21pc2Ugd3JhcHBlciBpZiB0aGUKICAgICAg
YXJndW1lbnQgaXMgYSBwcm9taXNlLgogICAgICAqIGBSU1ZQLlByb21pc2UuY2FzdGAgaXMgYSB3
YXkgb2YgY2FzdGluZyBpbmNvbWluZyB0aGVuYWJsZXMgb3IgcHJvbWlzZSBzdWJjbGFzc2VzIHRv
CiAgICAgIHByb21pc2VzIG9mIHRoZSBleGFjdCBjbGFzcyBzcGVjaWZpZWQsIHNvIHRoYXQgdGhl
IHJlc3VsdGluZyBvYmplY3QncyBgdGhlbmAgaXMKICAgICAgZW5zdXJlZCB0byBoYXZlIHRoZSBi
ZWhhdmlvciBvZiB0aGUgY29uc3RydWN0b3IgeW91IGFyZSBjYWxsaW5nIGNhc3Qgb24gKGkuZS4s
IFJTVlAuUHJvbWlzZSkuCgogICAgICBAbWV0aG9kIGNhc3QKICAgICAgQHBhcmFtIHtPYmplY3R9
IG9iamVjdCB0byBiZSBjYXN0ZWQKICAgICAgQHBhcmFtIHtTdHJpbmd9IGxhYmVsIG9wdGlvbmFs
IHN0cmluZyBmb3IgbGFiZWxpbmcgdGhlIHByb21pc2UuCiAgICAgIFVzZWZ1bCBmb3IgdG9vbGlu
Zy4KICAgICAgQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZQogICAgICBAc3RhdGljCiAgICAqLwoK
ICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5jdGlvbiBjYXN0KG9iamVjdCwgbGFiZWwp
IHsKICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi8KICAgICAgdmFyIENvbnN0cnVjdG9y
ID0gdGhpczsKCiAgICAgIGlmIChvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcg
JiYgb2JqZWN0LmNvbnN0cnVjdG9yID09PSBDb25zdHJ1Y3RvcikgewogICAgICAgIHJldHVybiBv
YmplY3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3IoZnVuY3Rpb24ocmVz
b2x2ZSkgewogICAgICAgIHJlc29sdmUob2JqZWN0KTsKICAgICAgfSwgbGFiZWwpOwogICAgfTsK
ICB9KTsKZGVmaW5lKCJyc3ZwL3Byb21pc2UvcmFjZSIsIAogIFsiLi4vdXRpbHMiLCJleHBvcnRz
Il0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBz
dHJpY3QiOwogICAgLyogZ2xvYmFsIHRvU3RyaW5nICovCgogICAgdmFyIGlzQXJyYXkgPSBfX2Rl
cGVuZGVuY3kxX18uaXNBcnJheTsKICAgIHZhciBpc0Z1bmN0aW9uID0gX19kZXBlbmRlbmN5MV9f
LmlzRnVuY3Rpb247CiAgICB2YXIgaXNOb25UaGVuYWJsZSA9IF9fZGVwZW5kZW5jeTFfXy5pc05v
blRoZW5hYmxlOwoKICAgIC8qKgogICAgICBgUlNWUC5Qcm9taXNlLnJhY2VgIHJldHVybnMgYSBu
ZXcgcHJvbWlzZSB3aGljaCBpcyBzZXR0bGVkIGluIHRoZSBzYW1lIHdheSBhcyB0aGUKICAgICAg
Zmlyc3QgcGFzc2VkIHByb21pc2UgdG8gc2V0dGxlLgoKICAgICAgRXhhbXBsZToKCiAgICAgIGBg
YGphdmFzY3JpcHQKICAgICAgdmFyIHByb21pc2UxID0gbmV3IFJTVlAuUHJvbWlzZShmdW5jdGlv
bihyZXNvbHZlLCByZWplY3QpewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAg
ICAgIHJlc29sdmUoInByb21pc2UgMSIpOwogICAgICAgIH0sIDIwMCk7CiAgICAgIH0pOwoKICAg
ICAgdmFyIHByb21pc2UyID0gbmV3IFJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWpl
Y3QpewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICAgIHJlc29sdmUoInBy
b21pc2UgMiIpOwogICAgICAgIH0sIDEwMCk7CiAgICAgIH0pOwoKICAgICAgUlNWUC5Qcm9taXNl
LnJhY2UoW3Byb21pc2UxLCBwcm9taXNlMl0pLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXsKICAgICAg
ICAvLyByZXN1bHQgPT09ICJwcm9taXNlIDIiIGJlY2F1c2UgaXQgd2FzIHJlc29sdmVkIGJlZm9y
ZSBwcm9taXNlMQogICAgICAgIC8vIHdhcyByZXNvbHZlZC4KICAgICAgfSk7CiAgICAgIGBgYAoK
ICAgICAgYFJTVlAuUHJvbWlzZS5yYWNlYCBpcyBkZXRlcm1pbmlzdGljIGluIHRoYXQgb25seSB0
aGUgc3RhdGUgb2YgdGhlIGZpcnN0CiAgICAgIHNldHRsZWQgcHJvbWlzZSBtYXR0ZXJzLiBGb3Ig
ZXhhbXBsZSwgZXZlbiBpZiBvdGhlciBwcm9taXNlcyBnaXZlbiB0byB0aGUKICAgICAgYHByb21p
c2VzYCBhcnJheSBhcmd1bWVudCBhcmUgcmVzb2x2ZWQsIGJ1dCB0aGUgZmlyc3Qgc2V0dGxlZCBw
cm9taXNlIGhhcwogICAgICBiZWNvbWUgcmVqZWN0ZWQgYmVmb3JlIHRoZSBvdGhlciBwcm9taXNl
cyBiZWNhbWUgZnVsZmlsbGVkLCB0aGUgcmV0dXJuZWQKICAgICAgcHJvbWlzZSB3aWxsIGJlY29t
ZSByZWplY3RlZDoKCiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgdmFyIHByb21pc2UxID0gbmV3
IFJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpewogICAgICAgIHNldFRpbWVv
dXQoZnVuY3Rpb24oKXsKICAgICAgICAgIHJlc29sdmUoInByb21pc2UgMSIpOwogICAgICAgIH0s
IDIwMCk7CiAgICAgIH0pOwoKICAgICAgdmFyIHByb21pc2UyID0gbmV3IFJTVlAuUHJvbWlzZShm
dW5jdGlvbihyZXNvbHZlLCByZWplY3QpewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsK
ICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInByb21pc2UgMiIpKTsKICAgICAgICB9LCAxMDAp
OwogICAgICB9KTsKCiAgICAgIFJTVlAuUHJvbWlzZS5yYWNlKFtwcm9taXNlMSwgcHJvbWlzZTJd
KS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgLy8gQ29kZSBoZXJlIG5ldmVyIHJ1bnMK
ICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKXsKICAgICAgICAvLyByZWFzb24ubWVzc2FnZSA9PT0g
InByb21pc2UyIiBiZWNhdXNlIHByb21pc2UgMiBiZWNhbWUgcmVqZWN0ZWQgYmVmb3JlCiAgICAg
ICAgLy8gcHJvbWlzZSAxIGJlY2FtZSBmdWxmaWxsZWQKICAgICAgfSk7CiAgICAgIGBgYAoKICAg
ICAgQW4gZXhhbXBsZSByZWFsLXdvcmxkIHVzZSBjYXNlIGlzIGltcGxlbWVudGluZyB0aW1lb3V0
czoKCiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgUlNWUC5Qcm9taXNlLnJhY2UoW2FqYXgoJ2Zv
by5qc29uJyksIHRpbWVvdXQoNTAwMCldKQogICAgICBgYGAKCiAgICAgIEBtZXRob2QgcmFjZQog
ICAgICBAcGFyYW0ge0FycmF5fSBwcm9taXNlcyBhcnJheSBvZiBwcm9taXNlcyB0byBvYnNlcnZl
CiAgICAgIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJpbmcgZm9yIGRlc2NyaWJp
bmcgdGhlIHByb21pc2UgcmV0dXJuZWQuCiAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4KICAgICAg
QHJldHVybiB7UHJvbWlzZX0gYSBwcm9taXNlIHdoaWNoIHNldHRsZXMgaW4gdGhlIHNhbWUgd2F5
IGFzIHRoZSBmaXJzdCBwYXNzZWQKICAgICAgcHJvbWlzZSB0byBzZXR0bGUuCiAgICAgIEBzdGF0
aWMKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24gcmFjZShlbnRy
aWVzLCBsYWJlbCkgewogICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLwogICAgICB2YXIg
Q29uc3RydWN0b3IgPSB0aGlzLCBlbnRyeTsKCiAgICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3Io
ZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKCFpc0FycmF5KGVudHJpZXMp
KSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdZb3UgbXVzdCBwYXNzIGFuIGFycmF5
IHRvIHJhY2UuJyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGVuZGluZyA9IHRydWU7CgogICAg
ICAgIGZ1bmN0aW9uIG9uRnVsZmlsbG1lbnQodmFsdWUpIHsgaWYgKHBlbmRpbmcpIHsgcGVuZGlu
ZyA9IGZhbHNlOyByZXNvbHZlKHZhbHVlKTsgfSB9CiAgICAgICAgZnVuY3Rpb24gb25SZWplY3Rp
b24ocmVhc29uKSAgeyBpZiAocGVuZGluZykgeyBwZW5kaW5nID0gZmFsc2U7IHJlamVjdChyZWFz
b24pOyB9IH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRyaWVzLmxlbmd0aDsgaSsr
KSB7CiAgICAgICAgICBlbnRyeSA9IGVudHJpZXNbaV07CiAgICAgICAgICBpZiAoaXNOb25UaGVu
YWJsZShlbnRyeSkpIHsKICAgICAgICAgICAgcGVuZGluZyA9IGZhbHNlOwogICAgICAgICAgICBy
ZXNvbHZlKGVudHJ5KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgICAgQ29uc3RydWN0b3IuY2FzdChlbnRyeSkudGhlbihvbkZ1bGZpbGxtZW50LCBvblJl
amVjdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBsYWJlbCk7CiAgICB9Owog
IH0pOwpkZWZpbmUoInJzdnAvcHJvbWlzZS9yZWplY3QiLCAKICBbImV4cG9ydHMiXSwKICBmdW5j
dGlvbihfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgLyoqCiAgICAgIGBSU1ZQ
LlByb21pc2UucmVqZWN0YCByZXR1cm5zIGEgcHJvbWlzZSByZWplY3RlZCB3aXRoIHRoZSBwYXNz
ZWQgYHJlYXNvbmAuCiAgICAgIEl0IGlzIHNob3J0aGFuZCBmb3IgdGhlIGZvbGxvd2luZzoKCiAg
ICAgIGBgYGphdmFzY3JpcHQKICAgICAgdmFyIHByb21pc2UgPSBuZXcgUlNWUC5Qcm9taXNlKGZ1
bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7CiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignV0hPT1BT
JykpOwogICAgICB9KTsKCiAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSl7CiAgICAg
ICAgLy8gQ29kZSBoZXJlIGRvZXNuJ3QgcnVuIGJlY2F1c2UgdGhlIHByb21pc2UgaXMgcmVqZWN0
ZWQhCiAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbil7CiAgICAgICAgLy8gcmVhc29uLm1lc3NhZ2Ug
PT09ICdXSE9PUFMnCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEluc3RlYWQgb2Ygd3JpdGlu
ZyB0aGUgYWJvdmUsIHlvdXIgY29kZSBub3cgc2ltcGx5IGJlY29tZXMgdGhlIGZvbGxvd2luZzoK
CiAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgdmFyIHByb21pc2UgPSBSU1ZQLlByb21pc2UucmVq
ZWN0KG5ldyBFcnJvcignV0hPT1BTJykpOwoKICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHZh
bHVlKXsKICAgICAgICAvLyBDb2RlIGhlcmUgZG9lc24ndCBydW4gYmVjYXVzZSB0aGUgcHJvbWlz
ZSBpcyByZWplY3RlZCEKICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKXsKICAgICAgICAvLyByZWFz
b24ubWVzc2FnZSA9PT0gJ1dIT09QUycKICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgQG1ldGhv
ZCByZWplY3QKICAgICAgQHBhcmFtIHtBbnl9IHJlYXNvbiB2YWx1ZSB0aGF0IHRoZSByZXR1cm5l
ZCBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgd2l0aC4KICAgICAgQHBhcmFtIHtTdHJpbmd9IGxh
YmVsIG9wdGlvbmFsIHN0cmluZyBmb3IgaWRlbnRpZnlpbmcgdGhlIHJldHVybmVkIHByb21pc2Uu
CiAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4KICAgICAgQHJldHVybiB7UHJvbWlzZX0gYSBwcm9t
aXNlIHJlamVjdGVkIHdpdGggdGhlIGdpdmVuIGByZWFzb25gLgogICAgICBAc3RhdGljCiAgICAq
LwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IGZ1bmN0aW9uIHJlamVjdChyZWFzb24sIGxh
YmVsKSB7CiAgICAgIC8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCiAgICAgIHZhciBDb25zdHJ1
Y3RvciA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IENvbnN0cnVjdG9yKGZ1bmN0aW9uIChyZXNv
bHZlLCByZWplY3QpIHsKICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgfSwgbGFiZWwpOwog
ICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL3Byb21pc2UvcmVzb2x2ZSIsIAogIFsiZXhwb3J0cyJd
LAogIGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKioKICAg
ICAgYFJTVlAuUHJvbWlzZS5yZXNvbHZlYCByZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgYmVj
b21lIHJlc29sdmVkIHdpdGggdGhlCiAgICAgIHBhc3NlZCBgdmFsdWVgLiBJdCBpcyBzaG9ydGhh
bmQgZm9yIHRoZSBmb2xsb3dpbmc6CgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciBwcm9t
aXNlID0gbmV3IFJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpewogICAgICAg
IHJlc29sdmUoMSk7CiAgICAgIH0pOwoKICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHZhbHVl
KXsKICAgICAgICAvLyB2YWx1ZSA9PT0gMQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBJbnN0
ZWFkIG9mIHdyaXRpbmcgdGhlIGFib3ZlLCB5b3VyIGNvZGUgbm93IHNpbXBseSBiZWNvbWVzIHRo
ZSBmb2xsb3dpbmc6CgogICAgICBgYGBqYXZhc2NyaXB0CiAgICAgIHZhciBwcm9taXNlID0gUlNW
UC5Qcm9taXNlLnJlc29sdmUoMSk7CgogICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24odmFsdWUp
ewogICAgICAgIC8vIHZhbHVlID09PSAxCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEBtZXRo
b2QgcmVzb2x2ZQogICAgICBAcGFyYW0ge0FueX0gdmFsdWUgdmFsdWUgdGhhdCB0aGUgcmV0dXJu
ZWQgcHJvbWlzZSB3aWxsIGJlIHJlc29sdmVkIHdpdGgKICAgICAgQHBhcmFtIHtTdHJpbmd9IGxh
YmVsIG9wdGlvbmFsIHN0cmluZyBmb3IgaWRlbnRpZnlpbmcgdGhlIHJldHVybmVkIHByb21pc2Uu
CiAgICAgIFVzZWZ1bCBmb3IgdG9vbGluZy4KICAgICAgQHJldHVybiB7UHJvbWlzZX0gYSBwcm9t
aXNlIHRoYXQgd2lsbCBiZWNvbWUgZnVsZmlsbGVkIHdpdGggdGhlIGdpdmVuCiAgICAgIGB2YWx1
ZWAKICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5j
dGlvbiByZXNvbHZlKHZhbHVlLCBsYWJlbCkgewogICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1
ZSAqLwogICAgICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBDb25z
dHJ1Y3RvcihmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICByZXNvbHZlKHZhbHVl
KTsKICAgICAgfSwgbGFiZWwpOwogICAgfTsKICB9KTsKZGVmaW5lKCJyc3ZwL3JhY2UiLCAKICBb
Ii4vcHJvbWlzZSIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhw
b3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgUHJvbWlzZSA9IF9fZGVwZW5kZW5j
eTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGlzIGlzIGEgY29udmVuaWVudCBhbGlh
cyBmb3IgYFJTVlAuUHJvbWlzZS5yYWNlYC4KCiAgICAgIEBtZXRob2QgcmFjZQogICAgICBAcGFy
YW0ge0FycmF5fSBhcnJheSBBcnJheSBvZiBwcm9taXNlcy4KICAgICAgQHBhcmFtIHtTdHJpbmd9
IGxhYmVsIEFuIG9wdGlvbmFsIGxhYmVsLiBUaGlzIGlzIHVzZWZ1bAogICAgICBmb3IgdG9vbGlu
Zy4KICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBmdW5j
dGlvbiByYWNlKGFycmF5LCBsYWJlbCkgewogICAgICByZXR1cm4gUHJvbWlzZS5yYWNlKGFycmF5
LCBsYWJlbCk7CiAgICB9OwogIH0pOwpkZWZpbmUoInJzdnAvcmVqZWN0IiwgCiAgWyIuL3Byb21p
c2UiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykg
ewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIFByb21pc2UgPSBfX2RlcGVuZGVuY3kxX19bImRl
ZmF1bHQiXTsKCiAgICAvKioKICAgICAgVGhpcyBpcyBhIGNvbnZlbmllbnQgYWxpYXMgZm9yIGBS
U1ZQLlByb21pc2UucmVqZWN0YC4KCiAgICAgIEBtZXRob2QgcmVqZWN0CiAgICAgIEBmb3IgUlNW
UAogICAgICBAcGFyYW0ge0FueX0gcmVhc29uIHZhbHVlIHRoYXQgdGhlIHJldHVybmVkIHByb21p
c2Ugd2lsbCBiZSByZWplY3RlZCB3aXRoLgogICAgICBAcGFyYW0ge1N0cmluZ30gbGFiZWwgb3B0
aW9uYWwgc3RyaW5nIGZvciBpZGVudGlmeWluZyB0aGUgcmV0dXJuZWQgcHJvbWlzZS4KICAgICAg
VXNlZnVsIGZvciB0b29saW5nLgogICAgICBAcmV0dXJuIHtQcm9taXNlfSBhIHByb21pc2UgcmVq
ZWN0ZWQgd2l0aCB0aGUgZ2l2ZW4gYHJlYXNvbmAuCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBf
X2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24gcmVqZWN0KHJlYXNvbiwgbGFiZWwpIHsK
ICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlYXNvbiwgbGFiZWwpOwogICAgfTsKICB9KTsK
ZGVmaW5lKCJyc3ZwL3Jlc29sdmUiLCAKICBbIi4vcHJvbWlzZSIsImV4cG9ydHMiXSwKICBmdW5j
dGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAg
ICB2YXIgUHJvbWlzZSA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAg
ICBUaGlzIGlzIGEgY29udmVuaWVudCBhbGlhcyBmb3IgYFJTVlAuUHJvbWlzZS5yZXNvbHZlYC4K
CiAgICAgIEBtZXRob2QgcmVzb2x2ZQogICAgICBAZm9yIFJTVlAKICAgICAgQHBhcmFtIHtBbnl9
IHZhbHVlIHZhbHVlIHRoYXQgdGhlIHJldHVybmVkIHByb21pc2Ugd2lsbCBiZSByZXNvbHZlZCB3
aXRoCiAgICAgIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJpbmcgZm9yIGlkZW50
aWZ5aW5nIHRoZSByZXR1cm5lZCBwcm9taXNlLgogICAgICBVc2VmdWwgZm9yIHRvb2xpbmcuCiAg
ICAgIEByZXR1cm4ge1Byb21pc2V9IGEgcHJvbWlzZSB0aGF0IHdpbGwgYmVjb21lIGZ1bGZpbGxl
ZCB3aXRoIHRoZSBnaXZlbgogICAgICBgdmFsdWVgCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBf
X2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24gcmVzb2x2ZSh2YWx1ZSwgbGFiZWwpIHsK
ICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZSwgbGFiZWwpOwogICAgfTsKICB9KTsK
ZGVmaW5lKCJyc3ZwL3JldGhyb3ciLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4cG9y
dHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgLyoqCiAgICAgIGBSU1ZQLnJldGhyb3dgIHdp
bGwgcmV0aHJvdyBhbiBlcnJvciBvbiB0aGUgbmV4dCB0dXJuIG9mIHRoZSBKYXZhU2NyaXB0IGV2
ZW50CiAgICAgIGxvb3AgaW4gb3JkZXIgdG8gYWlkIGRlYnVnZ2luZy4KCiAgICAgIFByb21pc2Vz
IEErIHNwZWNpZmllcyB0aGF0IGFueSBleGNlcHRpb25zIHRoYXQgb2NjdXIgd2l0aCBhIHByb21p
c2UgbXVzdCBiZQogICAgICBjYXVnaHQgYnkgdGhlIHByb21pc2VzIGltcGxlbWVudGF0aW9uIGFu
ZCBidWJibGVkIHRvIHRoZSBsYXN0IGhhbmRsZXIuIEZvcgogICAgICB0aGlzIHJlYXNvbiwgaXQg
aXMgcmVjb21tZW5kZWQgdGhhdCB5b3UgYWx3YXlzIHNwZWNpZnkgYSBzZWNvbmQgcmVqZWN0aW9u
CiAgICAgIGhhbmRsZXIgZnVuY3Rpb24gdG8gYHRoZW5gLiBIb3dldmVyLCBgUlNWUC5yZXRocm93
YCB3aWxsIHRocm93IHRoZSBleGNlcHRpb24KICAgICAgb3V0c2lkZSBvZiB0aGUgcHJvbWlzZSwg
c28gaXQgYnViYmxlcyB1cCB0byB5b3VyIGNvbnNvbGUgaWYgaW4gdGhlIGJyb3dzZXIsCiAgICAg
IG9yIGRvbWFpbi9jYXVzZSB1bmNhdWdodCBleGNlcHRpb24gaW4gTm9kZS4gYHJldGhyb3dgIHdp
bGwgYWxzbyB0aHJvdyB0aGUKICAgICAgZXJyb3IgYWdhaW4gc28gdGhlIGVycm9yIGNhbiBiZSBo
YW5kbGVkIGJ5IHRoZSBwcm9taXNlIHBlciB0aGUgc3BlYy4KCiAgICAgIGBgYGphdmFzY3JpcHQK
ICAgICAgZnVuY3Rpb24gdGhyb3dzKCl7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXaG9vcHMh
Jyk7CiAgICAgIH0KCiAgICAgIHZhciBwcm9taXNlID0gbmV3IFJTVlAuUHJvbWlzZShmdW5jdGlv
bihyZXNvbHZlLCByZWplY3QpewogICAgICAgIHRocm93cygpOwogICAgICB9KTsKCiAgICAgIHBy
b21pc2UuY2F0Y2goUlNWUC5yZXRocm93KS50aGVuKGZ1bmN0aW9uKCl7CiAgICAgICAgLy8gQ29k
ZSBoZXJlIGRvZXNuJ3QgcnVuIGJlY2F1c2UgdGhlIHByb21pc2UgYmVjYW1lIHJlamVjdGVkIGR1
ZSB0byBhbgogICAgICAgIC8vIGVycm9yIQogICAgICB9LCBmdW5jdGlvbiAoZXJyKXsKICAgICAg
ICAvLyBoYW5kbGUgdGhlIGVycm9yIGhlcmUKICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgVGhl
ICdXaG9vcHMnIGVycm9yIHdpbGwgYmUgdGhyb3duIG9uIHRoZSBuZXh0IHR1cm4gb2YgdGhlIGV2
ZW50IGxvb3AKICAgICAgYW5kIHlvdSBjYW4gd2F0Y2ggZm9yIGl0IGluIHlvdXIgY29uc29sZS4g
WW91IGNhbiBhbHNvIGhhbmRsZSBpdCB1c2luZyBhCiAgICAgIHJlamVjdGlvbiBoYW5kbGVyIGdp
dmVuIHRvIGAudGhlbmAgb3IgYC5jYXRjaGAgb24gdGhlIHJldHVybmVkIHByb21pc2UuCgogICAg
ICBAbWV0aG9kIHJldGhyb3cKICAgICAgQGZvciBSU1ZQCiAgICAgIEBwYXJhbSB7RXJyb3J9IHJl
YXNvbiByZWFzb24gdGhlIHByb21pc2UgYmVjYW1lIHJlamVjdGVkLgogICAgICBAdGhyb3dzIEVy
cm9yCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVu
Y3Rpb24gcmV0aHJvdyhyZWFzb24pIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAg
ICAgICB0aHJvdyByZWFzb247CiAgICAgIH0pOwogICAgICB0aHJvdyByZWFzb247CiAgICB9Owog
IH0pOwpkZWZpbmUoInJzdnAvdXRpbHMiLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4
cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgZnVuY3Rpb24gb2JqZWN0T3JGdW5jdGlv
bih4KSB7CiAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiB8fCAodHlwZW9mIHgg
PT09ICJvYmplY3QiICYmIHggIT09IG51bGwpOwogICAgfQoKICAgIF9fZXhwb3J0c19fLm9iamVj
dE9yRnVuY3Rpb24gPSBvYmplY3RPckZ1bmN0aW9uO2Z1bmN0aW9uIGlzRnVuY3Rpb24oeCkgewog
ICAgICByZXR1cm4gdHlwZW9mIHggPT09ICJmdW5jdGlvbiI7CiAgICB9CgogICAgX19leHBvcnRz
X18uaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247ZnVuY3Rpb24gaXNOb25UaGVuYWJsZSh4KSB7CiAg
ICAgIHJldHVybiAhb2JqZWN0T3JGdW5jdGlvbih4KTsKICAgIH0KCiAgICBfX2V4cG9ydHNfXy5p
c05vblRoZW5hYmxlID0gaXNOb25UaGVuYWJsZTtmdW5jdGlvbiBpc0FycmF5KHgpIHsKICAgICAg
cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh4KSA9PT0gIltvYmplY3QgQXJy
YXldIjsKICAgIH0KCiAgICBfX2V4cG9ydHNfXy5pc0FycmF5ID0gaXNBcnJheTsvLyBEYXRlLm5v
dyBpcyBub3QgYXZhaWxhYmxlIGluIGJyb3dzZXJzIDwgSUU5CiAgICAvLyBodHRwczovL2RldmVs
b3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9i
YWxfT2JqZWN0cy9EYXRlL25vdyNDb21wYXRpYmlsaXR5CiAgICB2YXIgbm93ID0gRGF0ZS5ub3cg
fHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKICAgIF9fZXhw
b3J0c19fLm5vdyA9IG5vdzsKICAgIHZhciBrZXlzT2YgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlv
bihvYmplY3QpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgZm9yICh2YXIgcHJvcCBp
biBvYmplY3QpIHsKICAgICAgICByZXN1bHQucHVzaChwcm9wKTsKICAgICAgfQoKICAgICAgcmV0
dXJuIHJlc3VsdDsKICAgIH07CiAgICBfX2V4cG9ydHNfXy5rZXlzT2YgPSBrZXlzT2Y7CiAgfSk7
CmRlZmluZSgicnN2cCIsIAogIFsiLi9yc3ZwL3Byb21pc2UiLCIuL3JzdnAvZXZlbnRzIiwiLi9y
c3ZwL25vZGUiLCIuL3JzdnAvYWxsIiwiLi9yc3ZwL2FsbF9zZXR0bGVkIiwiLi9yc3ZwL3JhY2Ui
LCIuL3JzdnAvaGFzaCIsIi4vcnN2cC9yZXRocm93IiwiLi9yc3ZwL2RlZmVyIiwiLi9yc3ZwL2Nv
bmZpZyIsIi4vcnN2cC9tYXAiLCIuL3JzdnAvcmVzb2x2ZSIsIi4vcnN2cC9yZWplY3QiLCIuL3Jz
dnAvZmlsdGVyIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBl
bmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXywgX19kZXBlbmRlbmN5
NV9fLCBfX2RlcGVuZGVuY3k2X18sIF9fZGVwZW5kZW5jeTdfXywgX19kZXBlbmRlbmN5OF9fLCBf
X2RlcGVuZGVuY3k5X18sIF9fZGVwZW5kZW5jeTEwX18sIF9fZGVwZW5kZW5jeTExX18sIF9fZGVw
ZW5kZW5jeTEyX18sIF9fZGVwZW5kZW5jeTEzX18sIF9fZGVwZW5kZW5jeTE0X18sIF9fZXhwb3J0
c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgUHJvbWlzZSA9IF9fZGVwZW5kZW5jeTFf
X1siZGVmYXVsdCJdOwogICAgdmFyIEV2ZW50VGFyZ2V0ID0gX19kZXBlbmRlbmN5Ml9fWyJkZWZh
dWx0Il07CiAgICB2YXIgZGVub2RlaWZ5ID0gX19kZXBlbmRlbmN5M19fWyJkZWZhdWx0Il07CiAg
ICB2YXIgYWxsID0gX19kZXBlbmRlbmN5NF9fWyJkZWZhdWx0Il07CiAgICB2YXIgYWxsU2V0dGxl
ZCA9IF9fZGVwZW5kZW5jeTVfX1siZGVmYXVsdCJdOwogICAgdmFyIHJhY2UgPSBfX2RlcGVuZGVu
Y3k2X19bImRlZmF1bHQiXTsKICAgIHZhciBoYXNoID0gX19kZXBlbmRlbmN5N19fWyJkZWZhdWx0
Il07CiAgICB2YXIgcmV0aHJvdyA9IF9fZGVwZW5kZW5jeThfX1siZGVmYXVsdCJdOwogICAgdmFy
IGRlZmVyID0gX19kZXBlbmRlbmN5OV9fWyJkZWZhdWx0Il07CiAgICB2YXIgY29uZmlnID0gX19k
ZXBlbmRlbmN5MTBfXy5jb25maWc7CiAgICB2YXIgY29uZmlndXJlID0gX19kZXBlbmRlbmN5MTBf
Xy5jb25maWd1cmU7CiAgICB2YXIgbWFwID0gX19kZXBlbmRlbmN5MTFfX1siZGVmYXVsdCJdOwog
ICAgdmFyIHJlc29sdmUgPSBfX2RlcGVuZGVuY3kxMl9fWyJkZWZhdWx0Il07CiAgICB2YXIgcmVq
ZWN0ID0gX19kZXBlbmRlbmN5MTNfX1siZGVmYXVsdCJdOwogICAgdmFyIGZpbHRlciA9IF9fZGVw
ZW5kZW5jeTE0X19bImRlZmF1bHQiXTsKCiAgICBmdW5jdGlvbiBhc3luYyhjYWxsYmFjaywgYXJn
KSB7CiAgICAgIGNvbmZpZy5hc3luYyhjYWxsYmFjaywgYXJnKTsKICAgIH0KCiAgICBmdW5jdGlv
biBvbigpIHsKICAgICAgY29uZmlnLm9uLmFwcGx5KGNvbmZpZywgYXJndW1lbnRzKTsKICAgIH0K
CiAgICBmdW5jdGlvbiBvZmYoKSB7CiAgICAgIGNvbmZpZy5vZmYuYXBwbHkoY29uZmlnLCBhcmd1
bWVudHMpOwogICAgfQoKICAgIC8vIFNldCB1cCBpbnN0cnVtZW50YXRpb24gdGhyb3VnaCBgd2lu
ZG93Ll9fUFJPTUlTRV9JTlRSVU1FTlRBVElPTl9fYAogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09
ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cuX19QUk9NSVNFX0lOU1RSVU1FTlRBVElPTl9f
ID09PSAnb2JqZWN0JykgewogICAgICB2YXIgY2FsbGJhY2tzID0gd2luZG93Ll9fUFJPTUlTRV9J
TlNUUlVNRU5UQVRJT05fXzsKICAgICAgY29uZmlndXJlKCdpbnN0cnVtZW50JywgdHJ1ZSk7CiAg
ICAgIGZvciAodmFyIGV2ZW50TmFtZSBpbiBjYWxsYmFja3MpIHsKICAgICAgICBpZiAoY2FsbGJh
Y2tzLmhhc093blByb3BlcnR5KGV2ZW50TmFtZSkpIHsKICAgICAgICAgIG9uKGV2ZW50TmFtZSwg
Y2FsbGJhY2tzW2V2ZW50TmFtZV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIF9fZXhw
b3J0c19fLlByb21pc2UgPSBQcm9taXNlOwogICAgX19leHBvcnRzX18uRXZlbnRUYXJnZXQgPSBF
dmVudFRhcmdldDsKICAgIF9fZXhwb3J0c19fLmFsbCA9IGFsbDsKICAgIF9fZXhwb3J0c19fLmFs
bFNldHRsZWQgPSBhbGxTZXR0bGVkOwogICAgX19leHBvcnRzX18ucmFjZSA9IHJhY2U7CiAgICBf
X2V4cG9ydHNfXy5oYXNoID0gaGFzaDsKICAgIF9fZXhwb3J0c19fLnJldGhyb3cgPSByZXRocm93
OwogICAgX19leHBvcnRzX18uZGVmZXIgPSBkZWZlcjsKICAgIF9fZXhwb3J0c19fLmRlbm9kZWlm
eSA9IGRlbm9kZWlmeTsKICAgIF9fZXhwb3J0c19fLmNvbmZpZ3VyZSA9IGNvbmZpZ3VyZTsKICAg
IF9fZXhwb3J0c19fLm9uID0gb247CiAgICBfX2V4cG9ydHNfXy5vZmYgPSBvZmY7CiAgICBfX2V4
cG9ydHNfXy5yZXNvbHZlID0gcmVzb2x2ZTsKICAgIF9fZXhwb3J0c19fLnJlamVjdCA9IHJlamVj
dDsKICAgIF9fZXhwb3J0c19fLmFzeW5jID0gYXN5bmM7CiAgICBfX2V4cG9ydHNfXy5tYXAgPSBt
YXA7CiAgICBfX2V4cG9ydHNfXy5maWx0ZXIgPSBmaWx0ZXI7CiAgfSk7Cgp9KSgpOwoKKGZ1bmN0
aW9uKCkgewovKioKUHVibGljIGFwaSBmb3IgdGhlIGNvbnRhaW5lciBpcyBzdGlsbCBpbiBmbHV4
LgpUaGUgcHVibGljIGFwaSwgc3BlY2lmaWVkIG9uIHRoZSBhcHBsaWNhdGlvbiBuYW1lc3BhY2Ug
c2hvdWxkIGJlIGNvbnNpZGVyZWQgdGhlIHN0YWJsZSBhcGkuCi8vIEBtb2R1bGUgY29udGFpbmVy
CiAgQHByaXZhdGUKKi8KCi8qCiBGbGFnIHRvIGVuYWJsZS9kaXNhYmxlIG1vZGVsIGZhY3Rvcnkg
aW5qZWN0aW9ucyAoZGlzYWJsZWQgYnkgZGVmYXVsdCkKIElmIG1vZGVsIGZhY3RvcnkgaW5qZWN0
aW9ucyBhcmUgZW5hYmxlZCwgbW9kZWxzIHNob3VsZCBub3QgYmUKIGFjY2Vzc2VkIGdsb2JhbGx5
IChvbmx5IHRocm91Z2ggYGNvbnRhaW5lci5sb29rdXBGYWN0b3J5KCdtb2RlbDptb2RlbE5hbWUn
KSlgKTsKKi8KRW1iZXIuTU9ERUxfRkFDVE9SWV9JTkpFQ1RJT05TID0gZmFsc2UgfHwgISFFbWJl
ci5FTlYuTU9ERUxfRkFDVE9SWV9JTkpFQ1RJT05TOwoKZGVmaW5lKCJjb250YWluZXIiLAogIFtd
LAogIGZ1bmN0aW9uKCkgewoKICAgIC8vIEEgc2FmZSBhbmQgc2ltcGxlIGluaGVyaXRpbmcgb2Jq
ZWN0LgogICAgZnVuY3Rpb24gSW5oZXJpdGluZ0RpY3QocGFyZW50KSB7CiAgICAgIHRoaXMucGFy
ZW50ID0gcGFyZW50OwogICAgICB0aGlzLmRpY3QgPSB7fTsKICAgIH0KCiAgICBJbmhlcml0aW5n
RGljdC5wcm90b3R5cGUgPSB7CgogICAgICAvKioKICAgICAgICBAcHJvcGVydHkgcGFyZW50CiAg
ICAgICAgQHR5cGUgSW5oZXJpdGluZ0RpY3QKICAgICAgICBAZGVmYXVsdCBudWxsCiAgICAgICov
CgogICAgICBwYXJlbnQ6IG51bGwsCgogICAgICAvKioKICAgICAgICBPYmplY3QgdXNlZCB0byBz
dG9yZSB0aGUgY3VycmVudCBub2RlcyBkYXRhLgoKICAgICAgICBAcHJvcGVydHkgZGljdAogICAg
ICAgIEB0eXBlIE9iamVjdAogICAgICAgIEBkZWZhdWx0IE9iamVjdAogICAgICAqLwogICAgICBk
aWN0OiBudWxsLAoKICAgICAgLyoqCiAgICAgICAgUmV0cmlldmUgdGhlIHZhbHVlIGdpdmVuIGEg
a2V5LCBpZiB0aGUgdmFsdWUgaXMgcHJlc2VudCBhdCB0aGUgY3VycmVudAogICAgICAgIGxldmVs
IHVzZSBpdCwgb3RoZXJ3aXNlIHdhbGsgdXAgdGhlIHBhcmVudCBoaWVyYXJjaHkgYW5kIHRyeSBh
Z2Fpbi4gSWYKICAgICAgICBubyBtYXRjaGluZyBrZXkgaXMgZm91bmQsIHJldHVybiB1bmRlZmlu
ZWQuCgogICAgICAgIEBtZXRob2QgZ2V0CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGtleQogICAg
ICAgIEByZXR1cm4ge2FueX0KICAgICAgKi8KICAgICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAg
ICAgICB2YXIgZGljdCA9IHRoaXMuZGljdDsKCiAgICAgICAgaWYgKGRpY3QuaGFzT3duUHJvcGVy
dHkoa2V5KSkgewogICAgICAgICAgcmV0dXJuIGRpY3Rba2V5XTsKICAgICAgICB9CgogICAgICAg
IGlmICh0aGlzLnBhcmVudCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldChrZXkp
OwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFNldCB0aGUgZ2l2ZW4gdmFs
dWUgZm9yIHRoZSBnaXZlbiBrZXksIGF0IHRoZSBjdXJyZW50IGxldmVsLgoKICAgICAgICBAbWV0
aG9kIHNldAogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgICAgICBAcGFyYW0ge0FueX0g
dmFsdWUKICAgICAgKi8KICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAg
dGhpcy5kaWN0W2tleV0gPSB2YWx1ZTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIERlbGV0
ZSB0aGUgZ2l2ZW4ga2V5CgogICAgICAgIEBtZXRob2QgcmVtb3ZlCiAgICAgICAgQHBhcmFtIHtT
dHJpbmd9IGtleQogICAgICAqLwogICAgICByZW1vdmU6IGZ1bmN0aW9uKGtleSkgewogICAgICAg
IGRlbGV0ZSB0aGlzLmRpY3Rba2V5XTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIENoZWNr
IGZvciB0aGUgZXhpc3RlbmNlIG9mIGdpdmVuIGEga2V5LCBpZiB0aGUga2V5IGlzIHByZXNlbnQg
YXQgdGhlIGN1cnJlbnQKICAgICAgICBsZXZlbCByZXR1cm4gdHJ1ZSwgb3RoZXJ3aXNlIHdhbGsg
dXAgdGhlIHBhcmVudCBoaWVyYXJjaHkgYW5kIHRyeSBhZ2Fpbi4gSWYKICAgICAgICBubyBtYXRj
aGluZyBrZXkgaXMgZm91bmQsIHJldHVybiBmYWxzZS4KCiAgICAgICAgQG1ldGhvZCBoYXMKICAg
ICAgICBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICAgICAgQHJldHVybiB7Qm9vbGVhbn0KICAgICAg
Ki8KICAgICAgaGFzOiBmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgZGljdCA9IHRoaXMuZGlj
dDsKCiAgICAgICAgaWYgKGRpY3QuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgcmV0
dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHsKICAgICAgICAg
IHJldHVybiB0aGlzLnBhcmVudC5oYXMoa2V5KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBm
YWxzZTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEl0ZXJhdGUgYW5kIGludm9rZSBhIGNh
bGxiYWNrIGZvciBlYWNoIGxvY2FsIGtleS12YWx1ZSBwYWlyLgoKICAgICAgICBAbWV0aG9kIGVh
Y2hMb2NhbAogICAgICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgICAgQHBhcmFt
IHtPYmplY3R9IGJpbmRpbmcKICAgICAgKi8KICAgICAgZWFjaExvY2FsOiBmdW5jdGlvbihjYWxs
YmFjaywgYmluZGluZykgewogICAgICAgIHZhciBkaWN0ID0gdGhpcy5kaWN0OwoKICAgICAgICBm
b3IgKHZhciBwcm9wIGluIGRpY3QpIHsKICAgICAgICAgIGlmIChkaWN0Lmhhc093blByb3BlcnR5
KHByb3ApKSB7CiAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoYmluZGluZywgcHJvcCwgZGljdFtw
cm9wXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKCiAgICAvLyBBIGxp
Z2h0d2VpZ2h0IGNvbnRhaW5lciB0aGF0IGhlbHBzIHRvIGFzc2VtYmxlIGFuZCBkZWNvdXBsZSBj
b21wb25lbnRzLgogICAgLy8gUHVibGljIGFwaSBmb3IgdGhlIGNvbnRhaW5lciBpcyBzdGlsbCBp
biBmbHV4LgogICAgLy8gVGhlIHB1YmxpYyBhcGksIHNwZWNpZmllZCBvbiB0aGUgYXBwbGljYXRp
b24gbmFtZXNwYWNlIHNob3VsZCBiZSBjb25zaWRlcmVkIHRoZSBzdGFibGUgYXBpLgogICAgZnVu
Y3Rpb24gQ29udGFpbmVyKHBhcmVudCkgewogICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAg
ICAgdGhpcy5jaGlsZHJlbiA9IFtdOwoKICAgICAgdGhpcy5yZXNvbHZlciA9IHBhcmVudCAmJiBw
YXJlbnQucmVzb2x2ZXIgfHwgZnVuY3Rpb24oKSB7fTsKCiAgICAgIHRoaXMucmVnaXN0cnkgPSBu
ZXcgSW5oZXJpdGluZ0RpY3QocGFyZW50ICYmIHBhcmVudC5yZWdpc3RyeSk7CiAgICAgIHRoaXMu
Y2FjaGUgPSBuZXcgSW5oZXJpdGluZ0RpY3QocGFyZW50ICYmIHBhcmVudC5jYWNoZSk7CiAgICAg
IHRoaXMuZmFjdG9yeUNhY2hlID0gbmV3IEluaGVyaXRpbmdEaWN0KHBhcmVudCAmJiBwYXJlbnQu
Y2FjaGUpOwogICAgICB0aGlzLnR5cGVJbmplY3Rpb25zID0gbmV3IEluaGVyaXRpbmdEaWN0KHBh
cmVudCAmJiBwYXJlbnQudHlwZUluamVjdGlvbnMpOwogICAgICB0aGlzLmluamVjdGlvbnMgPSB7
fTsKCiAgICAgIHRoaXMuZmFjdG9yeVR5cGVJbmplY3Rpb25zID0gbmV3IEluaGVyaXRpbmdEaWN0
KHBhcmVudCAmJiBwYXJlbnQuZmFjdG9yeVR5cGVJbmplY3Rpb25zKTsKICAgICAgdGhpcy5mYWN0
b3J5SW5qZWN0aW9ucyA9IHt9OwoKICAgICAgdGhpcy5fb3B0aW9ucyA9IG5ldyBJbmhlcml0aW5n
RGljdChwYXJlbnQgJiYgcGFyZW50Ll9vcHRpb25zKTsKICAgICAgdGhpcy5fdHlwZU9wdGlvbnMg
PSBuZXcgSW5oZXJpdGluZ0RpY3QocGFyZW50ICYmIHBhcmVudC5fdHlwZU9wdGlvbnMpOwogICAg
fQoKICAgIENvbnRhaW5lci5wcm90b3R5cGUgPSB7CgogICAgICAvKioKICAgICAgICBAcHJvcGVy
dHkgcGFyZW50CiAgICAgICAgQHR5cGUgQ29udGFpbmVyCiAgICAgICAgQGRlZmF1bHQgbnVsbAog
ICAgICAqLwogICAgICBwYXJlbnQ6IG51bGwsCgogICAgICAvKioKICAgICAgICBAcHJvcGVydHkg
Y2hpbGRyZW4KICAgICAgICBAdHlwZSBBcnJheQogICAgICAgIEBkZWZhdWx0IFtdCiAgICAgICov
CiAgICAgIGNoaWxkcmVuOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAgQHByb3BlcnR5IHJlc29s
dmVyCiAgICAgICAgQHR5cGUgZnVuY3Rpb24KICAgICAgKi8KICAgICAgcmVzb2x2ZXI6IG51bGws
CgogICAgICAvKioKICAgICAgICBAcHJvcGVydHkgcmVnaXN0cnkKICAgICAgICBAdHlwZSBJbmhl
cml0aW5nRGljdAogICAgICAqLwogICAgICByZWdpc3RyeTogbnVsbCwKCiAgICAgIC8qKgogICAg
ICAgIEBwcm9wZXJ0eSBjYWNoZQogICAgICAgIEB0eXBlIEluaGVyaXRpbmdEaWN0CiAgICAgICov
CiAgICAgIGNhY2hlOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAgQHByb3BlcnR5IHR5cGVJbmpl
Y3Rpb25zCiAgICAgICAgQHR5cGUgSW5oZXJpdGluZ0RpY3QKICAgICAgKi8KICAgICAgdHlwZUlu
amVjdGlvbnM6IG51bGwsCgogICAgICAvKioKICAgICAgICBAcHJvcGVydHkgaW5qZWN0aW9ucwog
ICAgICAgIEB0eXBlIE9iamVjdAogICAgICAgIEBkZWZhdWx0IHt9CiAgICAgICovCiAgICAgIGlu
amVjdGlvbnM6IG51bGwsCgogICAgICAvKioKICAgICAgICBAcHJpdmF0ZQoKICAgICAgICBAcHJv
cGVydHkgX29wdGlvbnMKICAgICAgICBAdHlwZSBJbmhlcml0aW5nRGljdAogICAgICAgIEBkZWZh
dWx0IG51bGwKICAgICAgKi8KICAgICAgX29wdGlvbnM6IG51bGwsCgogICAgICAvKioKICAgICAg
ICBAcHJpdmF0ZQoKICAgICAgICBAcHJvcGVydHkgX3R5cGVPcHRpb25zCiAgICAgICAgQHR5cGUg
SW5oZXJpdGluZ0RpY3QKICAgICAgKi8KICAgICAgX3R5cGVPcHRpb25zOiBudWxsLAoKICAgICAg
LyoqCiAgICAgICAgUmV0dXJucyBhIG5ldyBjaGlsZCBvZiB0aGUgY3VycmVudCBjb250YWluZXIu
IFRoZXNlIGNoaWxkcmVuIGFyZSBjb25maWd1cmVkCiAgICAgICAgdG8gY29ycmVjdGx5IGluaGVy
aXQgZnJvbSB0aGUgY3VycmVudCBjb250YWluZXIuCgogICAgICAgIEBtZXRob2QgY2hpbGQKICAg
ICAgICBAcmV0dXJuIHtDb250YWluZXJ9CiAgICAgICovCiAgICAgIGNoaWxkOiBmdW5jdGlvbigp
IHsKICAgICAgICB2YXIgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcih0aGlzKTsKICAgICAgICB0
aGlzLmNoaWxkcmVuLnB1c2goY29udGFpbmVyKTsKICAgICAgICByZXR1cm4gY29udGFpbmVyOwog
ICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgU2V0cyBhIGtleS12YWx1ZSBwYWlyIG9uIHRoZSBj
dXJyZW50IGNvbnRhaW5lci4gSWYgYSBwYXJlbnQgY29udGFpbmVyLAogICAgICAgIGhhcyB0aGUg
c2FtZSBrZXksIG9uY2Ugc2V0IG9uIGEgY2hpbGQsIHRoZSBwYXJlbnQgYW5kIGNoaWxkIHdpbGwg
ZGl2ZXJnZQogICAgICAgIGFzIGV4cGVjdGVkLgoKICAgICAgICBAbWV0aG9kIHNldAogICAgICAg
IEBwYXJhbSB7T2JqZWN0fSBvYmplY3QKICAgICAgICBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICAg
ICAgQHBhcmFtIHthbnl9IHZhbHVlCiAgICAgICovCiAgICAgIHNldDogZnVuY3Rpb24ob2JqZWN0
LCBrZXksIHZhbHVlKSB7CiAgICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgICAgfSwKCiAg
ICAgIC8qKgogICAgICAgIFJlZ2lzdGVycyBhIGZhY3RvcnkgZm9yIGxhdGVyIGluamVjdGlvbi4K
CiAgICAgICAgRXhhbXBsZToKCiAgICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgIHZhciBjb250
YWluZXIgPSBuZXcgQ29udGFpbmVyKCk7CgogICAgICAgIGNvbnRhaW5lci5yZWdpc3RlcignbW9k
ZWw6dXNlcicsIFBlcnNvbiwge3NpbmdsZXRvbjogZmFsc2UgfSk7CiAgICAgICAgY29udGFpbmVy
LnJlZ2lzdGVyKCdmcnVpdDpmYXZvcml0ZScsIE9yYW5nZSk7CiAgICAgICAgY29udGFpbmVyLnJl
Z2lzdGVyKCdjb21tdW5pY2F0aW9uOm1haW4nLCBFbWFpbCwge3NpbmdsZXRvbjogZmFsc2V9KTsK
ICAgICAgICBgYGAKCiAgICAgICAgQG1ldGhvZCByZWdpc3RlcgogICAgICAgIEBwYXJhbSB7U3Ry
aW5nfSBmdWxsTmFtZQogICAgICAgIEBwYXJhbSB7RnVuY3Rpb259IGZhY3RvcnkKICAgICAgICBA
cGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAqLwogICAgICByZWdpc3RlcjogZnVuY3Rpb24o
ZnVsbE5hbWUsIGZhY3RvcnksIG9wdGlvbnMpIHsKICAgICAgICBpZiAoZnVsbE5hbWUuaW5kZXhP
ZignOicpID09PSAtMSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibWFsZm9ybWVk
IGZ1bGxOYW1lLCBleHBlY3RlZDogYHR5cGU6bmFtZWAgZ290OiAiICsgZnVsbE5hbWUgKyAiIik7
CiAgICAgICAgfQoKICAgICAgICBpZiAoZmFjdG9yeSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAg
ICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBdHRlbXB0aW5nIHRvIHJlZ2lzdGVyIGFuIHVua25vd24g
ZmFjdG9yeTogYCcgKyBmdWxsTmFtZSArICdgJyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9y
bWFsaXplZE5hbWUgPSB0aGlzLm5vcm1hbGl6ZShmdWxsTmFtZSk7CgogICAgICAgIGlmICh0aGlz
LmNhY2hlLmhhcyhub3JtYWxpemVkTmFtZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcign
Q2Fubm90IHJlLXJlZ2lzdGVyOiBgJyArIGZ1bGxOYW1lICsnYCwgYXMgaXQgaGFzIGFscmVhZHkg
YmVlbiBsb29rZWQgdXAuJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJlZ2lzdHJ5LnNldChu
b3JtYWxpemVkTmFtZSwgZmFjdG9yeSk7CiAgICAgICAgdGhpcy5fb3B0aW9ucy5zZXQobm9ybWFs
aXplZE5hbWUsIG9wdGlvbnMgfHwge30pOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgVW5y
ZWdpc3RlciBhIGZ1bGxOYW1lCgogICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICB2YXIgY29u
dGFpbmVyID0gbmV3IENvbnRhaW5lcigpOwogICAgICAgIGNvbnRhaW5lci5yZWdpc3RlcignbW9k
ZWw6dXNlcicsIFVzZXIpOwoKICAgICAgICBjb250YWluZXIubG9va3VwKCdtb2RlbDp1c2VyJykg
aW5zdGFuY2VvZiBVc2VyIC8vPT4gdHJ1ZQoKICAgICAgICBjb250YWluZXIudW5yZWdpc3Rlcign
bW9kZWw6dXNlcicpCiAgICAgICAgY29udGFpbmVyLmxvb2t1cCgnbW9kZWw6dXNlcicpID09PSB1
bmRlZmluZWQgLy89PiB0cnVlCiAgICAgICAgYGBgCgogICAgICAgIEBtZXRob2QgdW5yZWdpc3Rl
cgogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBmdWxsTmFtZQogICAgICAgKi8KICAgICAgdW5yZWdp
c3RlcjogZnVuY3Rpb24oZnVsbE5hbWUpIHsKICAgICAgICB2YXIgbm9ybWFsaXplZE5hbWUgPSB0
aGlzLm5vcm1hbGl6ZShmdWxsTmFtZSk7CgogICAgICAgIHRoaXMucmVnaXN0cnkucmVtb3ZlKG5v
cm1hbGl6ZWROYW1lKTsKICAgICAgICB0aGlzLmNhY2hlLnJlbW92ZShub3JtYWxpemVkTmFtZSk7
CiAgICAgICAgdGhpcy5mYWN0b3J5Q2FjaGUucmVtb3ZlKG5vcm1hbGl6ZWROYW1lKTsKICAgICAg
ICB0aGlzLl9vcHRpb25zLnJlbW92ZShub3JtYWxpemVkTmFtZSk7CiAgICAgIH0sCgogICAgICAv
KioKICAgICAgICBHaXZlbiBhIGZ1bGxOYW1lIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyBmYWN0
b3J5LgoKICAgICAgICBCeSBkZWZhdWx0IGByZXNvbHZlYCB3aWxsIHJldHJpZXZlIHRoZSBmYWN0
b3J5IGZyb20KICAgICAgICBpdHMgY29udGFpbmVyJ3MgcmVnaXN0cnkuCgogICAgICAgIGBgYGph
dmFzY3JpcHQKICAgICAgICB2YXIgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcigpOwogICAgICAg
IGNvbnRhaW5lci5yZWdpc3RlcignYXBpOnR3aXR0ZXInLCBUd2l0dGVyKTsKCiAgICAgICAgY29u
dGFpbmVyLnJlc29sdmUoJ2FwaTp0d2l0dGVyJykgLy8gPT4gVHdpdHRlcgogICAgICAgIGBgYAoK
ICAgICAgICBPcHRpb25hbGx5IHRoZSBjb250YWluZXIgY2FuIGJlIHByb3ZpZGVkIHdpdGggYSBj
dXN0b20gcmVzb2x2ZXIuCiAgICAgICAgSWYgcHJvdmlkZWQsIGByZXNvbHZlYCB3aWxsIGZpcnN0
IHByb3ZpZGUgdGhlIGN1c3RvbSByZXNvbHZlcgogICAgICAgIHRoZSBvcHBlcnR1bml0eSB0byBy
ZXNvbHZlIHRoZSBmdWxsTmFtZSwgb3RoZXJ3aXNlIGl0IHdpbGwgZmFsbGJhY2sKICAgICAgICB0
byB0aGUgcmVnaXN0cnkuCgogICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICB2YXIgY29udGFp
bmVyID0gbmV3IENvbnRhaW5lcigpOwogICAgICAgIGNvbnRhaW5lci5yZXNvbHZlciA9IGZ1bmN0
aW9uKGZ1bGxOYW1lKSB7CiAgICAgICAgICAvLyBsb29rdXAgdmlhIHRoZSBtb2R1bGUgc3lzdGVt
IG9mIGNob2ljZQogICAgICAgIH07CgogICAgICAgIC8vIHRoZSB0d2l0dGVyIGZhY3RvcnkgaXMg
YWRkZWQgdG8gdGhlIG1vZHVsZSBzeXN0ZW0KICAgICAgICBjb250YWluZXIucmVzb2x2ZSgnYXBp
OnR3aXR0ZXInKSAvLyA9PiBUd2l0dGVyCiAgICAgICAgYGBgCgogICAgICAgIEBtZXRob2QgcmVz
b2x2ZQogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBmdWxsTmFtZQogICAgICAgIEByZXR1cm4ge0Z1
bmN0aW9ufSBmdWxsTmFtZSdzIGZhY3RvcnkKICAgICAgKi8KICAgICAgcmVzb2x2ZTogZnVuY3Rp
b24oZnVsbE5hbWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZXNvbHZlcihmdWxsTmFtZSkgfHwg
dGhpcy5yZWdpc3RyeS5nZXQoZnVsbE5hbWUpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAg
QSBob29rIHRoYXQgY2FuIGJlIHVzZWQgdG8gZGVzY3JpYmUgaG93IHRoZSByZXNvbHZlciB3aWxs
CiAgICAgICAgYXR0ZW1wdCB0byBmaW5kIHRoZSBmYWN0b3J5LgoKICAgICAgICBGb3IgZXhhbXBs
ZSwgdGhlIGRlZmF1bHQgRW1iZXIgYC5kZXNjcmliZWAgcmV0dXJucyB0aGUgZnVsbAogICAgICAg
IGNsYXNzIG5hbWUgKGluY2x1ZGluZyBuYW1lc3BhY2UpIHdoZXJlIEVtYmVyJ3MgcmVzb2x2ZXIg
ZXhwZWN0cwogICAgICAgIHRvIGZpbmQgdGhlIGBmdWxsTmFtZWAuCgogICAgICAgIEBtZXRob2Qg
ZGVzY3JpYmUKICAgICAgICBAcGFyYW0ge1N0cmluZ30gZnVsbE5hbWUKICAgICAgICBAcmV0dXJu
IHtzdHJpbmd9IGRlc2NyaWJlZCBmdWxsTmFtZQogICAgICAqLwogICAgICBkZXNjcmliZTogZnVu
Y3Rpb24oZnVsbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVsbE5hbWU7CiAgICAgIH0sCgogICAg
ICAvKioKICAgICAgICBBIGhvb2sgdG8gZW5hYmxlIGN1c3RvbSBmdWxsTmFtZSBub3JtYWxpemF0
aW9uIGJlaGF2aW91cgoKICAgICAgICBAbWV0aG9kIG5vcm1hbGl6ZQogICAgICAgIEBwYXJhbSB7
U3RyaW5nfSBmdWxsTmFtZQogICAgICAgIEByZXR1cm4ge3N0cmluZ30gbm9ybWFsaXplZCBmdWxs
TmFtZQogICAgICAqLwogICAgICBub3JtYWxpemU6IGZ1bmN0aW9uKGZ1bGxOYW1lKSB7CiAgICAg
ICAgcmV0dXJuIGZ1bGxOYW1lOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBt
YWtlVG9TdHJpbmcKCiAgICAgICAgQHBhcmFtIHthbnl9IGZhY3RvcnkKICAgICAgICBAcGFyYW0g
e3N0cmluZ30gZnVsbE5hbWUKICAgICAgICBAcmV0dXJuIHtmdW5jdGlvbn0gdG9TdHJpbmcgZnVu
Y3Rpb24KICAgICAgKi8KICAgICAgbWFrZVRvU3RyaW5nOiBmdW5jdGlvbihmYWN0b3J5LCBmdWxs
TmFtZSkgewogICAgICAgIHJldHVybiBmYWN0b3J5LnRvU3RyaW5nKCk7CiAgICAgIH0sCgogICAg
ICAvKioKICAgICAgICBHaXZlbiBhIGZ1bGxOYW1lIHJldHVybiBhIGNvcnJlc3BvbmRpbmcgaW5z
dGFuY2UuCgogICAgICAgIFRoZSBkZWZhdWx0IGJlaGF2aW91ciBpcyBmb3IgbG9va3VwIHRvIHJl
dHVybiBhIHNpbmdsZXRvbiBpbnN0YW5jZS4KICAgICAgICBUaGUgc2luZ2xldG9uIGlzIHNjb3Bl
ZCB0byB0aGUgY29udGFpbmVyLCBhbGxvd2luZyBtdWx0aXBsZSBjb250YWluZXJzCiAgICAgICAg
dG8gYWxsIGhhdmUgdGhlaXIgb3duIGxvY2FsbHkgc2NvcGVkIHNpbmdsZXRvbnMuCgogICAgICAg
IGBgYGphdmFzY3JpcHQKICAgICAgICB2YXIgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcigpOwog
ICAgICAgIGNvbnRhaW5lci5yZWdpc3RlcignYXBpOnR3aXR0ZXInLCBUd2l0dGVyKTsKCiAgICAg
ICAgdmFyIHR3aXR0ZXIgPSBjb250YWluZXIubG9va3VwKCdhcGk6dHdpdHRlcicpOwoKICAgICAg
ICB0d2l0dGVyIGluc3RhbmNlb2YgVHdpdHRlcjsgLy8gPT4gdHJ1ZQoKICAgICAgICAvLyBieSBk
ZWZhdWx0IHRoZSBjb250YWluZXIgd2lsbCByZXR1cm4gc2luZ2xldG9ucwogICAgICAgIHZhciB0
d2l0dGVyMiA9IGNvbnRhaW5lci5sb29rdXAoJ2FwaTp0d2l0dGVyJyk7CiAgICAgICAgdHdpdHRl
ciBpbnN0YW5jZW9mIFR3aXR0ZXI7IC8vID0+IHRydWUKCiAgICAgICAgdHdpdHRlciA9PT0gdHdp
dHRlcjI7IC8vPT4gdHJ1ZQogICAgICAgIGBgYAoKICAgICAgICBJZiBzaW5nbGV0b25zIGFyZSBu
b3Qgd2FudGVkIGFuIG9wdGlvbmFsIGZsYWcgY2FuIGJlIHByb3ZpZGVkIGF0IGxvb2t1cC4KCiAg
ICAgICAgYGBgamF2YXNjcmlwdAogICAgICAgIHZhciBjb250YWluZXIgPSBuZXcgQ29udGFpbmVy
KCk7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdhcGk6dHdpdHRlcicsIFR3aXR0ZXIpOwoK
ICAgICAgICB2YXIgdHdpdHRlciA9IGNvbnRhaW5lci5sb29rdXAoJ2FwaTp0d2l0dGVyJywgeyBz
aW5nbGV0b246IGZhbHNlIH0pOwogICAgICAgIHZhciB0d2l0dGVyMiA9IGNvbnRhaW5lci5sb29r
dXAoJ2FwaTp0d2l0dGVyJywgeyBzaW5nbGV0b246IGZhbHNlIH0pOwoKICAgICAgICB0d2l0dGVy
ID09PSB0d2l0dGVyMjsgLy89PiBmYWxzZQogICAgICAgIGBgYAoKICAgICAgICBAbWV0aG9kIGxv
b2t1cAogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBmdWxsTmFtZQogICAgICAgIEBwYXJhbSB7T2Jq
ZWN0fSBvcHRpb25zCiAgICAgICAgQHJldHVybiB7YW55fQogICAgICAqLwogICAgICBsb29rdXA6
IGZ1bmN0aW9uKGZ1bGxOYW1lLCBvcHRpb25zKSB7CiAgICAgICAgZnVsbE5hbWUgPSB0aGlzLm5v
cm1hbGl6ZShmdWxsTmFtZSk7CgogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAg
ICAgICBpZiAodGhpcy5jYWNoZS5oYXMoZnVsbE5hbWUpICYmIG9wdGlvbnMuc2luZ2xldG9uICE9
PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGZ1bGxOYW1lKTsKICAg
ICAgICB9CgogICAgICAgIHZhciB2YWx1ZSA9IGluc3RhbnRpYXRlKHRoaXMsIGZ1bGxOYW1lKTsK
CiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsgcmV0dXJuOyB9CgogICAgICAgIGlm
IChpc1NpbmdsZXRvbih0aGlzLCBmdWxsTmFtZSkgJiYgb3B0aW9ucy5zaW5nbGV0b24gIT09IGZh
bHNlKSB7CiAgICAgICAgICB0aGlzLmNhY2hlLnNldChmdWxsTmFtZSwgdmFsdWUpOwogICAgICAg
IH0KCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgR2l2
ZW4gYSBmdWxsTmFtZSByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgZmFjdG9yeS4KCiAgICAgICAg
QG1ldGhvZCBsb29rdXBGYWN0b3J5CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGZ1bGxOYW1lCiAg
ICAgICAgQHJldHVybiB7YW55fQogICAgICAqLwogICAgICBsb29rdXBGYWN0b3J5OiBmdW5jdGlv
bihmdWxsTmFtZSkgewogICAgICAgIHJldHVybiBmYWN0b3J5Rm9yKHRoaXMsIGZ1bGxOYW1lKTsK
ICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEdpdmVuIGEgZnVsbE5hbWUgY2hlY2sgaWYgdGhl
IGNvbnRhaW5lciBpcyBhd2FyZSBvZiBpdHMgZmFjdG9yeQogICAgICAgIG9yIHNpbmdsZXRvbiBp
bnN0YW5jZS4KCiAgICAgICAgQG1ldGhvZCBoYXMKICAgICAgICBAcGFyYW0ge1N0cmluZ30gZnVs
bE5hbWUKICAgICAgICBAcmV0dXJuIHtCb29sZWFufQogICAgICAqLwogICAgICBoYXM6IGZ1bmN0
aW9uKGZ1bGxOYW1lKSB7CiAgICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzKGZ1bGxOYW1lKSkgewog
ICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gISF0aGlzLnJl
c29sdmUoZnVsbE5hbWUpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQWxsb3cgcmVnaXN0
ZXJpbmcgb3B0aW9ucyBmb3IgYWxsIGZhY3RvcmllcyBvZiBhIHR5cGUuCgogICAgICAgIGBgYGph
dmFzY3JpcHQKICAgICAgICB2YXIgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcigpOwoKICAgICAg
ICAvLyBpZiBhbGwgb2YgdHlwZSBgY29ubmVjdGlvbmAgbXVzdCBub3QgYmUgc2luZ2xldG9ucwog
ICAgICAgIGNvbnRhaW5lci5vcHRpb25zRm9yVHlwZSgnY29ubmVjdGlvbicsIHsgc2luZ2xldG9u
OiBmYWxzZSB9KTsKCiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdjb25uZWN0aW9uOnR3aXR0
ZXInLCBUd2l0dGVyQ29ubmVjdGlvbik7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdjb25u
ZWN0aW9uOmZhY2Vib29rJywgRmFjZWJvb2tDb25uZWN0aW9uKTsKCiAgICAgICAgdmFyIHR3aXR0
ZXIgPSBjb250YWluZXIubG9va3VwKCdjb25uZWN0aW9uOnR3aXR0ZXInKTsKICAgICAgICB2YXIg
dHdpdHRlcjIgPSBjb250YWluZXIubG9va3VwKCdjb25uZWN0aW9uOnR3aXR0ZXInKTsKCiAgICAg
ICAgdHdpdHRlciA9PT0gdHdpdHRlcjI7IC8vID0+IGZhbHNlCgogICAgICAgIHZhciBmYWNlYm9v
ayA9IGNvbnRhaW5lci5sb29rdXAoJ2Nvbm5lY3Rpb246ZmFjZWJvb2snKTsKICAgICAgICB2YXIg
ZmFjZWJvb2syID0gY29udGFpbmVyLmxvb2t1cCgnY29ubmVjdGlvbjpmYWNlYm9vaycpOwoKICAg
ICAgICBmYWNlYm9vayA9PT0gZmFjZWJvb2syOyAvLyA9PiBmYWxzZQogICAgICAgIGBgYAoKICAg
ICAgICBAbWV0aG9kIG9wdGlvbnNGb3JUeXBlCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IHR5cGUK
ICAgICAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAqLwogICAgICBvcHRpb25zRm9y
VHlwZTogZnVuY3Rpb24odHlwZSwgb3B0aW9ucykgewogICAgICAgIGlmICh0aGlzLnBhcmVudCkg
eyBpbGxlZ2FsQ2hpbGRPcGVyYXRpb24oJ29wdGlvbnNGb3JUeXBlJyk7IH0KCiAgICAgICAgdGhp
cy5fdHlwZU9wdGlvbnMuc2V0KHR5cGUsIG9wdGlvbnMpOwogICAgICB9LAoKICAgICAgLyoqCiAg
ICAgICAgQG1ldGhvZCBvcHRpb25zCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgICAg
ICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAqLwogICAgICBvcHRpb25zOiBmdW5jdGlv
bih0eXBlLCBvcHRpb25zKSB7CiAgICAgICAgdGhpcy5vcHRpb25zRm9yVHlwZSh0eXBlLCBvcHRp
b25zKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFVzZWQgb25seSB2aWEgYGluamVjdGlv
bmAuCgogICAgICAgIFByb3ZpZGVzIGEgc3BlY2lhbGl6ZWQgZm9ybSBvZiBpbmplY3Rpb24sIHNw
ZWNpZmljYWxseSBlbmFibGluZwogICAgICAgIGFsbCBvYmplY3RzIG9mIG9uZSB0eXBlIHRvIGJl
IGluamVjdGVkIHdpdGggYSByZWZlcmVuY2UgdG8gYW5vdGhlcgogICAgICAgIG9iamVjdC4KCiAg
ICAgICAgRm9yIGV4YW1wbGUsIHByb3ZpZGVkIGVhY2ggb2JqZWN0IG9mIHR5cGUgYGNvbnRyb2xs
ZXJgIG5lZWRlZCBhIGByb3V0ZXJgLgogICAgICAgIG9uZSB3b3VsZCBkbyB0aGUgZm9sbG93aW5n
OgoKICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IG5ldyBDb250
YWluZXIoKTsKCiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdyb3V0ZXI6bWFpbicsIFJvdXRl
cik7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdjb250cm9sbGVyOnVzZXInLCBVc2VyQ29u
dHJvbGxlcik7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdjb250cm9sbGVyOnBvc3QnLCBQ
b3N0Q29udHJvbGxlcik7CgogICAgICAgIGNvbnRhaW5lci50eXBlSW5qZWN0aW9uKCdjb250cm9s
bGVyJywgJ3JvdXRlcicsICdyb3V0ZXI6bWFpbicpOwoKICAgICAgICB2YXIgdXNlciA9IGNvbnRh
aW5lci5sb29rdXAoJ2NvbnRyb2xsZXI6dXNlcicpOwogICAgICAgIHZhciBwb3N0ID0gY29udGFp
bmVyLmxvb2t1cCgnY29udHJvbGxlcjpwb3N0Jyk7CgogICAgICAgIHVzZXIucm91dGVyIGluc3Rh
bmNlb2YgUm91dGVyOyAvLz0+IHRydWUKICAgICAgICBwb3N0LnJvdXRlciBpbnN0YW5jZW9mIFJv
dXRlcjsgLy89PiB0cnVlCgogICAgICAgIC8vIGJvdGggY29udHJvbGxlcnMgc2hhcmUgdGhlIHNh
bWUgcm91dGVyCiAgICAgICAgdXNlci5yb3V0ZXIgPT09IHBvc3Qucm91dGVyOyAvLz0+IHRydWUK
ICAgICAgICBgYGAKCiAgICAgICAgQHByaXZhdGUKICAgICAgICBAbWV0aG9kIHR5cGVJbmplY3Rp
b24KICAgICAgICBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBw
cm9wZXJ0eQogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBmdWxsTmFtZQogICAgICAqLwogICAgICB0
eXBlSW5qZWN0aW9uOiBmdW5jdGlvbih0eXBlLCBwcm9wZXJ0eSwgZnVsbE5hbWUpIHsKICAgICAg
ICBpZiAodGhpcy5wYXJlbnQpIHsgaWxsZWdhbENoaWxkT3BlcmF0aW9uKCd0eXBlSW5qZWN0aW9u
Jyk7IH0KCiAgICAgICAgYWRkVHlwZUluamVjdGlvbih0aGlzLnR5cGVJbmplY3Rpb25zLCB0eXBl
LCBwcm9wZXJ0eSwgZnVsbE5hbWUpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgRGVmaW5l
cyBpbmplY3Rpb24gcnVsZXMuCgogICAgICAgIFRoZXNlIHJ1bGVzIGFyZSB1c2VkIHRvIGluamVj
dCBkZXBlbmRlbmNpZXMgb250byBvYmplY3RzIHdoZW4gdGhleQogICAgICAgIGFyZSBpbnN0YW50
aWF0ZWQuCgogICAgICAgIFR3byBmb3JtcyBvZiBpbmplY3Rpb25zIGFyZSBwb3NzaWJsZToKCiAg
ICAgICAgKiBJbmplY3Rpbmcgb25lIGZ1bGxOYW1lIG9uIGFub3RoZXIgZnVsbE5hbWUKICAgICAg
ICAqIEluamVjdGluZyBvbmUgZnVsbE5hbWUgb24gYSB0eXBlCgogICAgICAgIEV4YW1wbGU6Cgog
ICAgICAgIGBgYGphdmFzY3JpcHQKICAgICAgICB2YXIgY29udGFpbmVyID0gbmV3IENvbnRhaW5l
cigpOwoKICAgICAgICBjb250YWluZXIucmVnaXN0ZXIoJ3NvdXJjZTptYWluJywgU291cmNlKTsK
ICAgICAgICBjb250YWluZXIucmVnaXN0ZXIoJ21vZGVsOnVzZXInLCBVc2VyKTsKICAgICAgICBj
b250YWluZXIucmVnaXN0ZXIoJ21vZGVsOnBvc3QnLCBQb3N0KTsKCiAgICAgICAgLy8gaW5qZWN0
aW5nIG9uZSBmdWxsTmFtZSBvbiBhbm90aGVyIGZ1bGxOYW1lCiAgICAgICAgLy8gZWcuIGVhY2gg
dXNlciBtb2RlbCBnZXRzIGEgcG9zdCBtb2RlbAogICAgICAgIGNvbnRhaW5lci5pbmplY3Rpb24o
J21vZGVsOnVzZXInLCAncG9zdCcsICdtb2RlbDpwb3N0Jyk7CgogICAgICAgIC8vIGluamVjdGlu
ZyBvbmUgZnVsbE5hbWUgb24gYW5vdGhlciB0eXBlCiAgICAgICAgY29udGFpbmVyLmluamVjdGlv
bignbW9kZWwnLCAnc291cmNlJywgJ3NvdXJjZTptYWluJyk7CgogICAgICAgIHZhciB1c2VyID0g
Y29udGFpbmVyLmxvb2t1cCgnbW9kZWw6dXNlcicpOwogICAgICAgIHZhciBwb3N0ID0gY29udGFp
bmVyLmxvb2t1cCgnbW9kZWw6cG9zdCcpOwoKICAgICAgICB1c2VyLnNvdXJjZSBpbnN0YW5jZW9m
IFNvdXJjZTsgLy89PiB0cnVlCiAgICAgICAgcG9zdC5zb3VyY2UgaW5zdGFuY2VvZiBTb3VyY2U7
IC8vPT4gdHJ1ZQoKICAgICAgICB1c2VyLnBvc3QgaW5zdGFuY2VvZiBQb3N0OyAvLz0+IHRydWUK
CiAgICAgICAgLy8gYW5kIGJvdGggbW9kZWxzIHNoYXJlIHRoZSBzYW1lIHNvdXJjZQogICAgICAg
IHVzZXIuc291cmNlID09PSBwb3N0LnNvdXJjZTsgLy89PiB0cnVlCiAgICAgICAgYGBgCgogICAg
ICAgIEBtZXRob2QgaW5qZWN0aW9uCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGZhY3RvcnlOYW1l
CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9
IGluamVjdGlvbk5hbWUKICAgICAgKi8KICAgICAgaW5qZWN0aW9uOiBmdW5jdGlvbihmYWN0b3J5
TmFtZSwgcHJvcGVydHksIGluamVjdGlvbk5hbWUpIHsKICAgICAgICBpZiAodGhpcy5wYXJlbnQp
IHsgaWxsZWdhbENoaWxkT3BlcmF0aW9uKCdpbmplY3Rpb24nKTsgfQoKICAgICAgICBpZiAoZmFj
dG9yeU5hbWUuaW5kZXhPZignOicpID09PSAtMSkgewogICAgICAgICAgcmV0dXJuIHRoaXMudHlw
ZUluamVjdGlvbihmYWN0b3J5TmFtZSwgcHJvcGVydHksIGluamVjdGlvbk5hbWUpOwogICAgICAg
IH0KCiAgICAgICAgYWRkSW5qZWN0aW9uKHRoaXMuaW5qZWN0aW9ucywgZmFjdG9yeU5hbWUsIHBy
b3BlcnR5LCBpbmplY3Rpb25OYW1lKTsKICAgICAgfSwKCgogICAgICAvKioKICAgICAgICBVc2Vk
IG9ubHkgdmlhIGBmYWN0b3J5SW5qZWN0aW9uYC4KCiAgICAgICAgUHJvdmlkZXMgYSBzcGVjaWFs
aXplZCBmb3JtIG9mIGluamVjdGlvbiwgc3BlY2lmaWNhbGx5IGVuYWJsaW5nCiAgICAgICAgYWxs
IGZhY3Rvcnkgb2Ygb25lIHR5cGUgdG8gYmUgaW5qZWN0ZWQgd2l0aCBhIHJlZmVyZW5jZSB0byBh
bm90aGVyCiAgICAgICAgb2JqZWN0LgoKICAgICAgICBGb3IgZXhhbXBsZSwgcHJvdmlkZWQgZWFj
aCBmYWN0b3J5IG9mIHR5cGUgYG1vZGVsYCBuZWVkZWQgYSBgc3RvcmVgLgogICAgICAgIG9uZSB3
b3VsZCBkbyB0aGUgZm9sbG93aW5nOgoKICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgdmFy
IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoKTsKCiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVy
KCdzdG9yZTptYWluJywgU29tZVN0b3JlKTsKCiAgICAgICAgY29udGFpbmVyLmZhY3RvcnlUeXBl
SW5qZWN0aW9uKCdtb2RlbCcsICdzdG9yZScsICdzdG9yZTptYWluJyk7CgogICAgICAgIHZhciBz
dG9yZSA9IGNvbnRhaW5lci5sb29rdXAoJ3N0b3JlOm1haW4nKTsKICAgICAgICB2YXIgVXNlckZh
Y3RvcnkgPSBjb250YWluZXIubG9va3VwRmFjdG9yeSgnbW9kZWw6dXNlcicpOwoKICAgICAgICBV
c2VyRmFjdG9yeS5zdG9yZSBpbnN0YW5jZW9mIFNvbWVTdG9yZTsgLy89PiB0cnVlCiAgICAgICAg
YGBgCgogICAgICAgIEBwcml2YXRlCiAgICAgICAgQG1ldGhvZCBmYWN0b3J5VHlwZUluamVjdGlv
bgogICAgICAgIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IHBy
b3BlcnR5CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGZ1bGxOYW1lCiAgICAgICovCiAgICAgIGZh
Y3RvcnlUeXBlSW5qZWN0aW9uOiBmdW5jdGlvbih0eXBlLCBwcm9wZXJ0eSwgZnVsbE5hbWUpIHsK
ICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHsgaWxsZWdhbENoaWxkT3BlcmF0aW9uKCdmYWN0b3J5
VHlwZUluamVjdGlvbicpOyB9CgogICAgICAgIGFkZFR5cGVJbmplY3Rpb24odGhpcy5mYWN0b3J5
VHlwZUluamVjdGlvbnMsIHR5cGUsIHByb3BlcnR5LCBmdWxsTmFtZSk7CiAgICAgIH0sCgogICAg
ICAvKioKICAgICAgICBEZWZpbmVzIGZhY3RvcnkgaW5qZWN0aW9uIHJ1bGVzLgoKICAgICAgICBT
aW1pbGFyIHRvIHJlZ3VsYXIgaW5qZWN0aW9uIHJ1bGVzLCBidXQgYXJlIHJ1biBhZ2FpbnN0IGZh
Y3RvcmllcywgdmlhCiAgICAgICAgYENvbnRhaW5lciNsb29rdXBGYWN0b3J5YC4KCiAgICAgICAg
VGhlc2UgcnVsZXMgYXJlIHVzZWQgdG8gaW5qZWN0IG9iamVjdHMgb250byBmYWN0b3JpZXMgd2hl
biB0aGV5CiAgICAgICAgYXJlIGxvb2tlZCB1cC4KCiAgICAgICAgVHdvIGZvcm1zIG9mIGluamVj
dGlvbnMgYXJlIHBvc3NpYmxlOgoKICAgICAgKiBJbmplY3Rpbmcgb25lIGZ1bGxOYW1lIG9uIGFu
b3RoZXIgZnVsbE5hbWUKICAgICAgKiBJbmplY3Rpbmcgb25lIGZ1bGxOYW1lIG9uIGEgdHlwZQoK
ICAgICAgICBFeGFtcGxlOgoKICAgICAgICBgYGBqYXZhc2NyaXB0CiAgICAgICAgdmFyIGNvbnRh
aW5lciA9IG5ldyBDb250YWluZXIoKTsKCiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdzdG9y
ZTptYWluJywgU3RvcmUpOwogICAgICAgIGNvbnRhaW5lci5yZWdpc3Rlcignc3RvcmU6c2Vjb25k
YXJ5JywgT3RoZXJTdG9yZSk7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdtb2RlbDp1c2Vy
JywgVXNlcik7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdtb2RlbDpwb3N0JywgUG9zdCk7
CgogICAgICAgIC8vIGluamVjdGluZyBvbmUgZnVsbE5hbWUgb24gYW5vdGhlciB0eXBlCiAgICAg
ICAgY29udGFpbmVyLmZhY3RvcnlJbmplY3Rpb24oJ21vZGVsJywgJ3N0b3JlJywgJ3N0b3JlOm1h
aW4nKTsKCiAgICAgICAgLy8gaW5qZWN0aW5nIG9uZSBmdWxsTmFtZSBvbiBhbm90aGVyIGZ1bGxO
YW1lCiAgICAgICAgY29udGFpbmVyLmZhY3RvcnlJbmplY3Rpb24oJ21vZGVsOnBvc3QnLCAnc2Vj
b25kYXJ5U3RvcmUnLCAnc3RvcmU6c2Vjb25kYXJ5Jyk7CgogICAgICAgIHZhciBVc2VyRmFjdG9y
eSA9IGNvbnRhaW5lci5sb29rdXBGYWN0b3J5KCdtb2RlbDp1c2VyJyk7CiAgICAgICAgdmFyIFBv
c3RGYWN0b3J5ID0gY29udGFpbmVyLmxvb2t1cEZhY3RvcnkoJ21vZGVsOnBvc3QnKTsKICAgICAg
ICB2YXIgc3RvcmUgPSBjb250YWluZXIubG9va3VwKCdzdG9yZTptYWluJyk7CgogICAgICAgIFVz
ZXJGYWN0b3J5LnN0b3JlIGluc3RhbmNlb2YgU3RvcmU7IC8vPT4gdHJ1ZQogICAgICAgIFVzZXJG
YWN0b3J5LnNlY29uZGFyeVN0b3JlIGluc3RhbmNlb2YgT3RoZXJTdG9yZTsgLy89PiBmYWxzZQoK
ICAgICAgICBQb3N0RmFjdG9yeS5zdG9yZSBpbnN0YW5jZW9mIFN0b3JlOyAvLz0+IHRydWUKICAg
ICAgICBQb3N0RmFjdG9yeS5zZWNvbmRhcnlTdG9yZSBpbnN0YW5jZW9mIE90aGVyU3RvcmU7IC8v
PT4gdHJ1ZQoKICAgICAgICAvLyBhbmQgYm90aCBtb2RlbHMgc2hhcmUgdGhlIHNhbWUgc291cmNl
IGluc3RhbmNlCiAgICAgICAgVXNlckZhY3Rvcnkuc3RvcmUgPT09IFBvc3RGYWN0b3J5LnN0b3Jl
OyAvLz0+IHRydWUKICAgICAgICBgYGAKCiAgICAgICAgQG1ldGhvZCBmYWN0b3J5SW5qZWN0aW9u
CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGZhY3RvcnlOYW1lCiAgICAgICAgQHBhcmFtIHtTdHJp
bmd9IHByb3BlcnR5CiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGluamVjdGlvbk5hbWUKICAgICAg
Ki8KICAgICAgZmFjdG9yeUluamVjdGlvbjogZnVuY3Rpb24oZmFjdG9yeU5hbWUsIHByb3BlcnR5
LCBpbmplY3Rpb25OYW1lKSB7CiAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7IGlsbGVnYWxDaGls
ZE9wZXJhdGlvbignaW5qZWN0aW9uJyk7IH0KCiAgICAgICAgaWYgKGZhY3RvcnlOYW1lLmluZGV4
T2YoJzonKSA9PT0gLTEpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmZhY3RvcnlUeXBlSW5qZWN0
aW9uKGZhY3RvcnlOYW1lLCBwcm9wZXJ0eSwgaW5qZWN0aW9uTmFtZSk7CiAgICAgICAgfQoKICAg
ICAgICBhZGRJbmplY3Rpb24odGhpcy5mYWN0b3J5SW5qZWN0aW9ucywgZmFjdG9yeU5hbWUsIHBy
b3BlcnR5LCBpbmplY3Rpb25OYW1lKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEEgZGVw
dGggZmlyc3QgdHJhdmVyc2FsLCBkZXN0cm95aW5nIHRoZSBjb250YWluZXIsIGl0cyBkZXNjZW5k
YW50IGNvbnRhaW5lcnMgYW5kIGFsbAogICAgICAgIHRoZWlyIG1hbmFnZWQgb2JqZWN0cy4KCiAg
ICAgICAgQG1ldGhvZCBkZXN0cm95CiAgICAgICovCiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkg
ewoKICAgICAgICBmb3IgKHZhciBpPTAsIGw9dGhpcy5jaGlsZHJlbi5sZW5ndGg7IGk8bDsgaSsr
KSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLmRlc3Ryb3koKTsKICAgICAgICB9CgogICAg
ICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKCiAgICAgICAgZWFjaERlc3Ryb3lhYmxlKHRoaXMsIGZ1
bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgIGl0ZW0uZGVzdHJveSgpOwogICAgICAgIH0pOwoKICAg
ICAgICB0aGlzLnBhcmVudCA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLmlzRGVzdHJveWVkID0g
dHJ1ZTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgcmVzZXQKICAgICAgKi8K
ICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIGk9MCwgbD10aGlzLmNo
aWxkcmVuLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICAgIHJlc2V0Q2FjaGUodGhpcy5jaGls
ZHJlbltpXSk7CiAgICAgICAgfQogICAgICAgIHJlc2V0Q2FjaGUodGhpcyk7CiAgICAgIH0KICAg
IH07CgogICAgZnVuY3Rpb24gaWxsZWdhbENoaWxkT3BlcmF0aW9uKG9wZXJhdGlvbikgewogICAg
ICB0aHJvdyBuZXcgRXJyb3Iob3BlcmF0aW9uICsgIiBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRl
ZCBvbiBjaGlsZCBjb250YWluZXJzIik7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTaW5nbGV0b24o
Y29udGFpbmVyLCBmdWxsTmFtZSkgewogICAgICB2YXIgc2luZ2xldG9uID0gb3B0aW9uKGNvbnRh
aW5lciwgZnVsbE5hbWUsICdzaW5nbGV0b24nKTsKCiAgICAgIHJldHVybiBzaW5nbGV0b24gIT09
IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1aWxkSW5qZWN0aW9ucyhjb250YWluZXIsIGlu
amVjdGlvbnMpIHsKICAgICAgdmFyIGhhc2ggPSB7fTsKCiAgICAgIGlmICghaW5qZWN0aW9ucykg
eyByZXR1cm4gaGFzaDsgfQoKICAgICAgdmFyIGluamVjdGlvbiwgbG9va3VwOwoKICAgICAgZm9y
ICh2YXIgaT0wLCBsPWluamVjdGlvbnMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIGluamVj
dGlvbiA9IGluamVjdGlvbnNbaV07CiAgICAgICAgbG9va3VwID0gY29udGFpbmVyLmxvb2t1cChp
bmplY3Rpb24uZnVsbE5hbWUpOwoKICAgICAgICBpZiAobG9va3VwICE9PSB1bmRlZmluZWQpIHsK
ICAgICAgICAgIGhhc2hbaW5qZWN0aW9uLnByb3BlcnR5XSA9IGxvb2t1cDsKICAgICAgICB9IGVs
c2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0aW5nIHRvIGluamVjdCBhbiB1
bmtub3duIGluamVjdGlvbjogYCcgKyBpbmplY3Rpb24uZnVsbE5hbWUgKyAnYCcpOwogICAgICAg
IH0KICAgICAgfQoKICAgICAgcmV0dXJuIGhhc2g7CiAgICB9CgogICAgZnVuY3Rpb24gb3B0aW9u
KGNvbnRhaW5lciwgZnVsbE5hbWUsIG9wdGlvbk5hbWUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBj
b250YWluZXIuX29wdGlvbnMuZ2V0KGZ1bGxOYW1lKTsKCiAgICAgIGlmIChvcHRpb25zICYmIG9w
dGlvbnNbb3B0aW9uTmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBvcHRpb25z
W29wdGlvbk5hbWVdOwogICAgICB9CgogICAgICB2YXIgdHlwZSA9IGZ1bGxOYW1lLnNwbGl0KCI6
IilbMF07CiAgICAgIG9wdGlvbnMgPSBjb250YWluZXIuX3R5cGVPcHRpb25zLmdldCh0eXBlKTsK
CiAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnNbb3B0aW9uTmFtZV07
CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmYWN0b3J5Rm9yKGNvbnRhaW5lciwgZnVsbE5h
bWUpIHsKICAgICAgdmFyIG5hbWUgPSBjb250YWluZXIubm9ybWFsaXplKGZ1bGxOYW1lKTsKICAg
ICAgdmFyIGZhY3RvcnkgPSBjb250YWluZXIucmVzb2x2ZShuYW1lKTsKICAgICAgdmFyIGluamVj
dGVkRmFjdG9yeTsKICAgICAgdmFyIGNhY2hlID0gY29udGFpbmVyLmZhY3RvcnlDYWNoZTsKICAg
ICAgdmFyIHR5cGUgPSBmdWxsTmFtZS5zcGxpdCgiOiIpWzBdOwoKICAgICAgaWYgKGZhY3Rvcnkg
PT09IHVuZGVmaW5lZCkgeyByZXR1cm47IH0KCiAgICAgIGlmIChjYWNoZS5oYXMoZnVsbE5hbWUp
KSB7CiAgICAgICAgcmV0dXJuIGNhY2hlLmdldChmdWxsTmFtZSk7CiAgICAgIH0KCiAgICAgIGlm
ICghZmFjdG9yeSB8fCB0eXBlb2YgZmFjdG9yeS5leHRlbmQgIT09ICdmdW5jdGlvbicgfHwgKCFF
bWJlci5NT0RFTF9GQUNUT1JZX0lOSkVDVElPTlMgJiYgdHlwZSA9PT0gJ21vZGVsJykpIHsKICAg
ICAgICAvLyBUT0RPOiB0aGluayBhYm91dCBhICdzYWZlJyBtZXJnZSBzdHlsZSBleHRlbnNpb24K
ICAgICAgICAvLyBmb3Igbm93IGp1c3QgZmFsbGJhY2sgdG8gY3JlYXRlIHRpbWUgaW5qZWN0aW9u
CiAgICAgICAgcmV0dXJuIGZhY3Rvcnk7CiAgICAgIH0gZWxzZSB7CgogICAgICAgIHZhciBpbmpl
Y3Rpb25zICAgICAgICA9IGluamVjdGlvbnNGb3IoY29udGFpbmVyLCBmdWxsTmFtZSk7CiAgICAg
ICAgdmFyIGZhY3RvcnlJbmplY3Rpb25zID0gZmFjdG9yeUluamVjdGlvbnNGb3IoY29udGFpbmVy
LCBmdWxsTmFtZSk7CgogICAgICAgIGZhY3RvcnlJbmplY3Rpb25zLl90b1N0cmluZyA9IGNvbnRh
aW5lci5tYWtlVG9TdHJpbmcoZmFjdG9yeSwgZnVsbE5hbWUpOwoKICAgICAgICBpbmplY3RlZEZh
Y3RvcnkgPSBmYWN0b3J5LmV4dGVuZChpbmplY3Rpb25zKTsKICAgICAgICBpbmplY3RlZEZhY3Rv
cnkucmVvcGVuQ2xhc3MoZmFjdG9yeUluamVjdGlvbnMpOwoKICAgICAgICBjYWNoZS5zZXQoZnVs
bE5hbWUsIGluamVjdGVkRmFjdG9yeSk7CgogICAgICAgIHJldHVybiBpbmplY3RlZEZhY3Rvcnk7
CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbmplY3Rpb25zRm9yKGNvbnRhaW5lciAsZnVs
bE5hbWUpIHsKICAgICAgdmFyIHNwbGl0TmFtZSA9IGZ1bGxOYW1lLnNwbGl0KCI6IiksCiAgICAg
ICAgdHlwZSA9IHNwbGl0TmFtZVswXSwKICAgICAgICBpbmplY3Rpb25zID0gW107CgogICAgICBp
bmplY3Rpb25zID0gaW5qZWN0aW9ucy5jb25jYXQoY29udGFpbmVyLnR5cGVJbmplY3Rpb25zLmdl
dCh0eXBlKSB8fCBbXSk7CiAgICAgIGluamVjdGlvbnMgPSBpbmplY3Rpb25zLmNvbmNhdChjb250
YWluZXIuaW5qZWN0aW9uc1tmdWxsTmFtZV0gfHwgW10pOwoKICAgICAgaW5qZWN0aW9ucyA9IGJ1
aWxkSW5qZWN0aW9ucyhjb250YWluZXIsIGluamVjdGlvbnMpOwogICAgICBpbmplY3Rpb25zLl9k
ZWJ1Z0NvbnRhaW5lcktleSA9IGZ1bGxOYW1lOwogICAgICBpbmplY3Rpb25zLmNvbnRhaW5lciA9
IGNvbnRhaW5lcjsKCiAgICAgIHJldHVybiBpbmplY3Rpb25zOwogICAgfQoKICAgIGZ1bmN0aW9u
IGZhY3RvcnlJbmplY3Rpb25zRm9yKGNvbnRhaW5lciwgZnVsbE5hbWUpIHsKICAgICAgdmFyIHNw
bGl0TmFtZSA9IGZ1bGxOYW1lLnNwbGl0KCI6IiksCiAgICAgICAgdHlwZSA9IHNwbGl0TmFtZVsw
XSwKICAgICAgICBmYWN0b3J5SW5qZWN0aW9ucyA9IFtdOwoKICAgICAgZmFjdG9yeUluamVjdGlv
bnMgPSBmYWN0b3J5SW5qZWN0aW9ucy5jb25jYXQoY29udGFpbmVyLmZhY3RvcnlUeXBlSW5qZWN0
aW9ucy5nZXQodHlwZSkgfHwgW10pOwogICAgICBmYWN0b3J5SW5qZWN0aW9ucyA9IGZhY3RvcnlJ
bmplY3Rpb25zLmNvbmNhdChjb250YWluZXIuZmFjdG9yeUluamVjdGlvbnNbZnVsbE5hbWVdIHx8
IFtdKTsKCiAgICAgIGZhY3RvcnlJbmplY3Rpb25zID0gYnVpbGRJbmplY3Rpb25zKGNvbnRhaW5l
ciwgZmFjdG9yeUluamVjdGlvbnMpOwogICAgICBmYWN0b3J5SW5qZWN0aW9ucy5fZGVidWdDb250
YWluZXJLZXkgPSBmdWxsTmFtZTsKCiAgICAgIHJldHVybiBmYWN0b3J5SW5qZWN0aW9uczsKICAg
IH0KCiAgICBmdW5jdGlvbiBpbnN0YW50aWF0ZShjb250YWluZXIsIGZ1bGxOYW1lKSB7CiAgICAg
IHZhciBmYWN0b3J5ID0gZmFjdG9yeUZvcihjb250YWluZXIsIGZ1bGxOYW1lKTsKCiAgICAgIGlm
IChvcHRpb24oY29udGFpbmVyLCBmdWxsTmFtZSwgJ2luc3RhbnRpYXRlJykgPT09IGZhbHNlKSB7
CiAgICAgICAgcmV0dXJuIGZhY3Rvcnk7CiAgICAgIH0KCiAgICAgIGlmIChmYWN0b3J5KSB7CiAg
ICAgICAgaWYgKHR5cGVvZiBmYWN0b3J5LmV4dGVuZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAg
ICAgLy8gYXNzdW1lIHRoZSBmYWN0b3J5IHdhcyBleHRlbmRhYmxlIGFuZCBpcyBhbHJlYWR5IGlu
amVjdGVkCiAgICAgICAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoKTsKICAgICAgICB9IGVsc2Ug
ewogICAgICAgICAgLy8gYXNzdW1lIHRoZSBmYWN0b3J5IHdhcyBleHRlbmRhYmxlCiAgICAgICAg
ICAvLyB0byBjcmVhdGUgdGltZSBpbmplY3Rpb25zCiAgICAgICAgICAvLyBUT0RPOiBzdXBwb3J0
IG5ldydpbmcgZm9yIGluc3RhbnRpYXRpb24gYW5kIG1lcmdlIGluamVjdGlvbnMgZm9yIHB1cmUg
SlMgRnVuY3Rpb25zCiAgICAgICAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoaW5qZWN0aW9uc0Zv
cihjb250YWluZXIsIGZ1bGxOYW1lKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVu
Y3Rpb24gZWFjaERlc3Ryb3lhYmxlKGNvbnRhaW5lciwgY2FsbGJhY2spIHsKICAgICAgY29udGFp
bmVyLmNhY2hlLmVhY2hMb2NhbChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgaWYgKG9w
dGlvbihjb250YWluZXIsIGtleSwgJ2luc3RhbnRpYXRlJykgPT09IGZhbHNlKSB7IHJldHVybjsg
fQogICAgICAgIGNhbGxiYWNrKHZhbHVlKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24g
cmVzZXRDYWNoZShjb250YWluZXIpIHsKICAgICAgY29udGFpbmVyLmNhY2hlLmVhY2hMb2NhbChm
dW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgaWYgKG9wdGlvbihjb250YWluZXIsIGtleSwg
J2luc3RhbnRpYXRlJykgPT09IGZhbHNlKSB7IHJldHVybjsgfQogICAgICAgIHZhbHVlLmRlc3Ry
b3koKTsKICAgICAgfSk7CiAgICAgIGNvbnRhaW5lci5jYWNoZS5kaWN0ID0ge307CiAgICB9Cgog
ICAgZnVuY3Rpb24gYWRkVHlwZUluamVjdGlvbihydWxlcywgdHlwZSwgcHJvcGVydHksIGZ1bGxO
YW1lKSB7CiAgICAgIHZhciBpbmplY3Rpb25zID0gcnVsZXMuZ2V0KHR5cGUpOwoKICAgICAgaWYg
KCFpbmplY3Rpb25zKSB7CiAgICAgICAgaW5qZWN0aW9ucyA9IFtdOwogICAgICAgIHJ1bGVzLnNl
dCh0eXBlLCBpbmplY3Rpb25zKTsKICAgICAgfQoKICAgICAgaW5qZWN0aW9ucy5wdXNoKHsKICAg
ICAgICBwcm9wZXJ0eTogcHJvcGVydHksCiAgICAgICAgZnVsbE5hbWU6IGZ1bGxOYW1lCiAgICAg
IH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEluamVjdGlvbihydWxlcywgZmFjdG9yeU5hbWUs
IHByb3BlcnR5LCBpbmplY3Rpb25OYW1lKSB7CiAgICAgIHZhciBpbmplY3Rpb25zID0gcnVsZXNb
ZmFjdG9yeU5hbWVdID0gcnVsZXNbZmFjdG9yeU5hbWVdIHx8IFtdOwogICAgICBpbmplY3Rpb25z
LnB1c2goeyBwcm9wZXJ0eTogcHJvcGVydHksIGZ1bGxOYW1lOiBpbmplY3Rpb25OYW1lIH0pOwog
ICAgfQoKICAgIHJldHVybiBDb250YWluZXI7Cn0pOwoKfSkoKTsKCihmdW5jdGlvbigpIHsKLypn
bG9iYWxzIEVOViAqLwovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXJ1bnRpbWUK
Ki8KCnZhciBpbmRleE9mID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmluZGV4T2Y7CgovKioKIFRo
aXMgd2lsbCBjb21wYXJlIHR3byBqYXZhc2NyaXB0IHZhbHVlcyBvZiBwb3NzaWJseSBkaWZmZXJl
bnQgdHlwZXMuCiBJdCB3aWxsIHRlbGwgeW91IHdoaWNoIG9uZSBpcyBncmVhdGVyIHRoYW4gdGhl
IG90aGVyIGJ5IHJldHVybmluZzoKCiAgLSAtMSBpZiB0aGUgZmlyc3QgaXMgc21hbGxlciB0aGFu
IHRoZSBzZWNvbmQsCiAgLSAwIGlmIGJvdGggYXJlIGVxdWFsLAogIC0gMSBpZiB0aGUgZmlyc3Qg
aXMgZ3JlYXRlciB0aGFuIHRoZSBzZWNvbmQuCgogVGhlIG9yZGVyIGlzIGNhbGN1bGF0ZWQgYmFz
ZWQgb24gYEVtYmVyLk9SREVSX0RFRklOSVRJT05gLCBpZiB0eXBlcyBhcmUgZGlmZmVyZW50Lgog
SW4gY2FzZSB0aGV5IGhhdmUgdGhlIHNhbWUgdHlwZSBhbiBhcHByb3ByaWF0ZSBjb21wYXJpc29u
IGZvciB0aGlzIHR5cGUgaXMgbWFkZS4KCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLmNvbXBhcmUo
J2hlbGxvJywgJ2hlbGxvJyk7ICAvLyAwCiAgRW1iZXIuY29tcGFyZSgnYWJjJywgJ2RmZycpOyAg
ICAgIC8vIC0xCiAgRW1iZXIuY29tcGFyZSgyLCAxKTsgICAgICAgICAgICAgIC8vIDEKICBgYGAK
CiBAbWV0aG9kIGNvbXBhcmUKIEBmb3IgRW1iZXIKIEBwYXJhbSB7T2JqZWN0fSB2IEZpcnN0IHZh
bHVlIHRvIGNvbXBhcmUKIEBwYXJhbSB7T2JqZWN0fSB3IFNlY29uZCB2YWx1ZSB0byBjb21wYXJl
CiBAcmV0dXJuIHtOdW1iZXJ9IC0xIGlmIHYgPCB3LCAwIGlmIHYgPSB3IGFuZCAxIGlmIHYgPiB3
LgoqLwpFbWJlci5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZSh2LCB3KSB7CiAgaWYgKHYgPT09
IHcpIHsgcmV0dXJuIDA7IH0KCiAgdmFyIHR5cGUxID0gRW1iZXIudHlwZU9mKHYpOwogIHZhciB0
eXBlMiA9IEVtYmVyLnR5cGVPZih3KTsKCiAgdmFyIENvbXBhcmFibGUgPSBFbWJlci5Db21wYXJh
YmxlOwogIGlmIChDb21wYXJhYmxlKSB7CiAgICBpZiAodHlwZTE9PT0naW5zdGFuY2UnICYmIENv
bXBhcmFibGUuZGV0ZWN0KHYuY29uc3RydWN0b3IpKSB7CiAgICAgIHJldHVybiB2LmNvbnN0cnVj
dG9yLmNvbXBhcmUodiwgdyk7CiAgICB9CgogICAgaWYgKHR5cGUyID09PSAnaW5zdGFuY2UnICYm
IENvbXBhcmFibGUuZGV0ZWN0KHcuY29uc3RydWN0b3IpKSB7CiAgICAgIHJldHVybiAxLXcuY29u
c3RydWN0b3IuY29tcGFyZSh3LCB2KTsKICAgIH0KICB9CgogIC8vIElmIHdlIGhhdmVuJ3QgeWV0
IGdlbmVyYXRlZCBhIHJldmVyc2UtbWFwcGluZyBvZiBFbWJlci5PUkRFUl9ERUZJTklUSU9OLAog
IC8vIGRvIHNvIG5vdy4KICB2YXIgbWFwcGluZyA9IEVtYmVyLk9SREVSX0RFRklOSVRJT05fTUFQ
UElORzsKICBpZiAoIW1hcHBpbmcpIHsKICAgIHZhciBvcmRlciA9IEVtYmVyLk9SREVSX0RFRklO
SVRJT047CiAgICBtYXBwaW5nID0gRW1iZXIuT1JERVJfREVGSU5JVElPTl9NQVBQSU5HID0ge307
CiAgICB2YXIgaWR4LCBsZW47CiAgICBmb3IgKGlkeCA9IDAsIGxlbiA9IG9yZGVyLmxlbmd0aDsg
aWR4IDwgbGVuOyAgKytpZHgpIHsKICAgICAgbWFwcGluZ1tvcmRlcltpZHhdXSA9IGlkeDsKICAg
IH0KCiAgICAvLyBXZSBubyBsb25nZXIgbmVlZCBFbWJlci5PUkRFUl9ERUZJTklUSU9OLgogICAg
ZGVsZXRlIEVtYmVyLk9SREVSX0RFRklOSVRJT047CiAgfQoKICB2YXIgdHlwZTFJbmRleCA9IG1h
cHBpbmdbdHlwZTFdOwogIHZhciB0eXBlMkluZGV4ID0gbWFwcGluZ1t0eXBlMl07CgogIGlmICh0
eXBlMUluZGV4IDwgdHlwZTJJbmRleCkgeyByZXR1cm4gLTE7IH0KICBpZiAodHlwZTFJbmRleCA+
IHR5cGUySW5kZXgpIHsgcmV0dXJuIDE7IH0KCiAgLy8gdHlwZXMgYXJlIGVxdWFsIC0gc28gd2Ug
aGF2ZSB0byBjaGVjayB2YWx1ZXMgbm93CiAgc3dpdGNoICh0eXBlMSkgewogICAgY2FzZSAnYm9v
bGVhbic6CiAgICBjYXNlICdudW1iZXInOgogICAgICBpZiAodiA8IHcpIHsgcmV0dXJuIC0xOyB9
CiAgICAgIGlmICh2ID4gdykgeyByZXR1cm4gMTsgfQogICAgICByZXR1cm4gMDsKCiAgICBjYXNl
ICdzdHJpbmcnOgogICAgICB2YXIgY29tcCA9IHYubG9jYWxlQ29tcGFyZSh3KTsKICAgICAgaWYg
KGNvbXAgPCAwKSB7IHJldHVybiAtMTsgfQogICAgICBpZiAoY29tcCA+IDApIHsgcmV0dXJuIDE7
IH0KICAgICAgcmV0dXJuIDA7CgogICAgY2FzZSAnYXJyYXknOgogICAgICB2YXIgdkxlbiA9IHYu
bGVuZ3RoOwogICAgICB2YXIgd0xlbiA9IHcubGVuZ3RoOwogICAgICB2YXIgbCA9IE1hdGgubWlu
KHZMZW4sIHdMZW4pOwogICAgICB2YXIgciA9IDA7CiAgICAgIHZhciBpID0gMDsKICAgICAgd2hp
bGUgKHIgPT09IDAgJiYgaSA8IGwpIHsKICAgICAgICByID0gY29tcGFyZSh2W2ldLHdbaV0pOwog
ICAgICAgIGkrKzsKICAgICAgfQogICAgICBpZiAociAhPT0gMCkgeyByZXR1cm4gcjsgfQoKICAg
ICAgLy8gYWxsIGVsZW1lbnRzIGFyZSBlcXVhbCBub3cKICAgICAgLy8gc2hvcnRlciBhcnJheSBz
aG91bGQgYmUgb3JkZXJlZCBmaXJzdAogICAgICBpZiAodkxlbiA8IHdMZW4pIHsgcmV0dXJuIC0x
OyB9CiAgICAgIGlmICh2TGVuID4gd0xlbikgeyByZXR1cm4gMTsgfQogICAgICAvLyBhcnJheXMg
YXJlIGVxdWFsIG5vdwogICAgICByZXR1cm4gMDsKCiAgICBjYXNlICdpbnN0YW5jZSc6CiAgICAg
IGlmIChFbWJlci5Db21wYXJhYmxlICYmIEVtYmVyLkNvbXBhcmFibGUuZGV0ZWN0KHYpKSB7CiAg
ICAgICAgcmV0dXJuIHYuY29tcGFyZSh2LCB3KTsKICAgICAgfQogICAgICByZXR1cm4gMDsKCiAg
ICBjYXNlICdkYXRlJzoKICAgICAgdmFyIHZOdW0gPSB2LmdldFRpbWUoKTsKICAgICAgdmFyIHdO
dW0gPSB3LmdldFRpbWUoKTsKICAgICAgaWYgKHZOdW0gPCB3TnVtKSB7IHJldHVybiAtMTsgfQog
ICAgICBpZiAodk51bSA+IHdOdW0pIHsgcmV0dXJuIDE7IH0KICAgICAgcmV0dXJuIDA7CgogICAg
ZGVmYXVsdDoKICAgICAgcmV0dXJuIDA7CiAgfQp9OwoKZnVuY3Rpb24gX2NvcHkob2JqLCBkZWVw
LCBzZWVuLCBjb3BpZXMpIHsKICB2YXIgcmV0LCBsb2MsIGtleTsKCiAgLy8gcHJpbWl0aXZlIGRh
dGEgdHlwZXMgYXJlIGltbXV0YWJsZSwganVzdCByZXR1cm4gdGhlbS4KICBpZiAoJ29iamVjdCcg
IT09IHR5cGVvZiBvYmogfHwgb2JqPT09bnVsbCkgcmV0dXJuIG9iajsKCiAgLy8gYXZvaWQgY3lj
bGljYWwgbG9vcHMKICBpZiAoZGVlcCAmJiAobG9jPWluZGV4T2Yoc2Vlbiwgb2JqKSk+PTApIHJl
dHVybiBjb3BpZXNbbG9jXTsKCiAgRW1iZXIuYXNzZXJ0KCdDYW5ub3QgY2xvbmUgYW4gRW1iZXIu
T2JqZWN0IHRoYXQgZG9lcyBub3QgaW1wbGVtZW50IEVtYmVyLkNvcHlhYmxlJywgIShvYmogaW5z
dGFuY2VvZiBFbWJlci5PYmplY3QpIHx8IChFbWJlci5Db3B5YWJsZSAmJiBFbWJlci5Db3B5YWJs
ZS5kZXRlY3Qob2JqKSkpOwoKICAvLyBJTVBPUlRBTlQ6IHRoaXMgc3BlY2lmaWMgdGVzdCB3aWxs
IGRldGVjdCBhIG5hdGl2ZSBhcnJheSBvbmx5LiBBbnkgb3RoZXIKICAvLyBvYmplY3Qgd2lsbCBu
ZWVkIHRvIGltcGxlbWVudCBDb3B5YWJsZS4KICBpZiAoRW1iZXIudHlwZU9mKG9iaikgPT09ICdh
cnJheScpIHsKICAgIHJldCA9IG9iai5zbGljZSgpOwogICAgaWYgKGRlZXApIHsKICAgICAgbG9j
ID0gcmV0Lmxlbmd0aDsKICAgICAgd2hpbGUoLS1sb2M+PTApIHJldFtsb2NdID0gX2NvcHkocmV0
W2xvY10sIGRlZXAsIHNlZW4sIGNvcGllcyk7CiAgICB9CiAgfSBlbHNlIGlmIChFbWJlci5Db3B5
YWJsZSAmJiBFbWJlci5Db3B5YWJsZS5kZXRlY3Qob2JqKSkgewogICAgcmV0ID0gb2JqLmNvcHko
ZGVlcCwgc2VlbiwgY29waWVzKTsKICB9IGVsc2UgewogICAgcmV0ID0ge307CiAgICBmb3Ioa2V5
IGluIG9iaikgewogICAgICBpZiAoIW9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSBjb250aW51ZTsK
CiAgICAgIC8vIFByZXZlbnRzIGJyb3dzZXJzIHRoYXQgZG9uJ3QgcmVzcGVjdCBub24tZW51bWVy
YWJpbGl0eSBmcm9tCiAgICAgIC8vIGNvcHlpbmcgaW50ZXJuYWwgRW1iZXIgcHJvcGVydGllcwog
ICAgICBpZiAoa2V5LnN1YnN0cmluZygwLDIpID09PSAnX18nKSBjb250aW51ZTsKCiAgICAgIHJl
dFtrZXldID0gZGVlcCA/IF9jb3B5KG9ialtrZXldLCBkZWVwLCBzZWVuLCBjb3BpZXMpIDogb2Jq
W2tleV07CiAgICB9CiAgfQoKICBpZiAoZGVlcCkgewogICAgc2Vlbi5wdXNoKG9iaik7CiAgICBj
b3BpZXMucHVzaChyZXQpOwogIH0KCiAgcmV0dXJuIHJldDsKfQoKLyoqCiAgQ3JlYXRlcyBhIGNs
b25lIG9mIHRoZSBwYXNzZWQgb2JqZWN0LiBUaGlzIGZ1bmN0aW9uIGNhbiB0YWtlIGp1c3QgYWJv
dXQKICBhbnkgdHlwZSBvZiBvYmplY3QgYW5kIGNyZWF0ZSBhIGNsb25lIG9mIGl0LCBpbmNsdWRp
bmcgcHJpbWl0aXZlIHZhbHVlcwogICh3aGljaCBhcmUgbm90IGFjdHVhbGx5IGNsb25lZCBiZWNh
dXNlIHRoZXkgYXJlIGltbXV0YWJsZSkuCgogIElmIHRoZSBwYXNzZWQgb2JqZWN0IGltcGxlbWVu
dHMgdGhlIGBjbG9uZSgpYCBtZXRob2QsIHRoZW4gdGhpcyBmdW5jdGlvbgogIHdpbGwgc2ltcGx5
IGNhbGwgdGhhdCBtZXRob2QgYW5kIHJldHVybiB0aGUgcmVzdWx0LgoKICBAbWV0aG9kIGNvcHkK
ICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGNsb25lCiAg
QHBhcmFtIHtCb29sZWFufSBkZWVwIElmIHRydWUsIGEgZGVlcCBjb3B5IG9mIHRoZSBvYmplY3Qg
aXMgbWFkZQogIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lZCBvYmplY3QKKi8KRW1iZXIuY29w
eSA9IGZ1bmN0aW9uKG9iaiwgZGVlcCkgewogIC8vIGZhc3QgcGF0aHMKICBpZiAoJ29iamVjdCcg
IT09IHR5cGVvZiBvYmogfHwgb2JqPT09bnVsbCkgcmV0dXJuIG9iajsgLy8gY2FuJ3QgY29weSBw
cmltaXRpdmVzCiAgaWYgKEVtYmVyLkNvcHlhYmxlICYmIEVtYmVyLkNvcHlhYmxlLmRldGVjdChv
YmopKSByZXR1cm4gb2JqLmNvcHkoZGVlcCk7CiAgcmV0dXJuIF9jb3B5KG9iaiwgZGVlcCwgZGVl
cCA/IFtdIDogbnVsbCwgZGVlcCA/IFtdIDogbnVsbCk7Cn07CgovKioKICBDb252ZW5pZW5jZSBt
ZXRob2QgdG8gaW5zcGVjdCBhbiBvYmplY3QuIFRoaXMgbWV0aG9kIHdpbGwgYXR0ZW1wdCB0bwog
IGNvbnZlcnQgdGhlIG9iamVjdCBpbnRvIGEgdXNlZnVsIHN0cmluZyBkZXNjcmlwdGlvbi4KCiAg
SXQgaXMgYSBwcmV0dHkgc2ltcGxlIGltcGxlbWVudGF0aW9uLiBJZiB5b3Ugd2FudCBzb21ldGhp
bmcgbW9yZSByb2J1c3QsCiAgdXNlIHNvbWV0aGluZyBsaWtlIEpTRHVtcDogaHR0cHM6Ly9naXRo
dWIuY29tL05WL2pzRHVtcAoKICBAbWV0aG9kIGluc3BlY3QKICBAZm9yIEVtYmVyCiAgQHBhcmFt
IHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHlvdSB3YW50IHRvIGluc3BlY3QuCiAgQHJldHVybiB7
U3RyaW5nfSBBIGRlc2NyaXB0aW9uIG9mIHRoZSBvYmplY3QKKi8KRW1iZXIuaW5zcGVjdCA9IGZ1
bmN0aW9uKG9iaikgewogIHZhciB0eXBlID0gRW1iZXIudHlwZU9mKG9iaik7CiAgaWYgKHR5cGUg
PT09ICdhcnJheScpIHsKICAgIHJldHVybiAnWycgKyBvYmogKyAnXSc7CiAgfQogIGlmICh0eXBl
ICE9PSAnb2JqZWN0JykgewogICAgcmV0dXJuIG9iaiArICcnOwogIH0KCiAgdmFyIHYsIHJldCA9
IFtdOwogIGZvcih2YXIga2V5IGluIG9iaikgewogICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShr
ZXkpKSB7CiAgICAgIHYgPSBvYmpba2V5XTsKICAgICAgaWYgKHYgPT09ICd0b1N0cmluZycpIHsg
Y29udGludWU7IH0gLy8gaWdub3JlIHVzZWxlc3MgaXRlbXMKICAgICAgaWYgKEVtYmVyLnR5cGVP
Zih2KSA9PT0gJ2Z1bmN0aW9uJykgeyB2ID0gImZ1bmN0aW9uKCkgeyAuLi4gfSI7IH0KICAgICAg
cmV0LnB1c2goa2V5ICsgIjogIiArIHYpOwogICAgfQogIH0KICByZXR1cm4gInsiICsgcmV0Lmpv
aW4oIiwgIikgKyAifSI7Cn07CgovKioKICBDb21wYXJlcyB0d28gb2JqZWN0cywgcmV0dXJuaW5n
IHRydWUgaWYgdGhleSBhcmUgbG9naWNhbGx5IGVxdWFsLiBUaGlzIGlzCiAgYSBkZWVwZXIgY29t
cGFyaXNvbiB0aGFuIGEgc2ltcGxlIHRyaXBsZSBlcXVhbC4gRm9yIHNldHMgaXQgd2lsbCBjb21w
YXJlIHRoZQogIGludGVybmFsIG9iamVjdHMuIEZvciBhbnkgb3RoZXIgb2JqZWN0IHRoYXQgaW1w
bGVtZW50cyBgaXNFcXVhbCgpYCBpdCB3aWxsCiAgcmVzcGVjdCB0aGF0IG1ldGhvZC4KCiAgYGBg
amF2YXNjcmlwdAogIEVtYmVyLmlzRXF1YWwoJ2hlbGxvJywgJ2hlbGxvJyk7ICAvLyB0cnVlCiAg
RW1iZXIuaXNFcXVhbCgxLCAyKTsgICAgICAgICAgICAgIC8vIGZhbHNlCiAgRW1iZXIuaXNFcXVh
bChbNCwyXSwgWzQsMl0pOyAgICAgIC8vIGZhbHNlCiAgYGBgCgogIEBtZXRob2QgaXNFcXVhbAog
IEBmb3IgRW1iZXIKICBAcGFyYW0ge09iamVjdH0gYSBmaXJzdCBvYmplY3QgdG8gY29tcGFyZQog
IEBwYXJhbSB7T2JqZWN0fSBiIHNlY29uZCBvYmplY3QgdG8gY29tcGFyZQogIEByZXR1cm4ge0Jv
b2xlYW59CiovCkVtYmVyLmlzRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7CiAgaWYgKGEgJiYgJ2Z1
bmN0aW9uJz09PXR5cGVvZiBhLmlzRXF1YWwpIHJldHVybiBhLmlzRXF1YWwoYik7CiAgcmV0dXJu
IGEgPT09IGI7Cn07CgovLyBVc2VkIGJ5IEVtYmVyLmNvbXBhcmUKRW1iZXIuT1JERVJfREVGSU5J
VElPTiA9IEVtYmVyLkVOVi5PUkRFUl9ERUZJTklUSU9OIHx8IFsKICAndW5kZWZpbmVkJywKICAn
bnVsbCcsCiAgJ2Jvb2xlYW4nLAogICdudW1iZXInLAogICdzdHJpbmcnLAogICdhcnJheScsCiAg
J29iamVjdCcsCiAgJ2luc3RhbmNlJywKICAnZnVuY3Rpb24nLAogICdjbGFzcycsCiAgJ2RhdGUn
Cl07CgovKioKICBSZXR1cm5zIGFsbCBvZiB0aGUga2V5cyBkZWZpbmVkIG9uIGFuIG9iamVjdCBv
ciBoYXNoLiBUaGlzIGlzIHVzZWZ1bAogIHdoZW4gaW5zcGVjdGluZyBvYmplY3RzIGZvciBkZWJ1
Z2dpbmcuIE9uIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBpdCwgdGhpcwogIHVzZXMgdGhlIG5hdGl2
ZSBgT2JqZWN0LmtleXNgIGltcGxlbWVudGF0aW9uLgoKICBAbWV0aG9kIGtleXMKICBAZm9yIEVt
YmVyCiAgQHBhcmFtIHtPYmplY3R9IG9iagogIEByZXR1cm4ge0FycmF5fSBBcnJheSBjb250YWlu
aW5nIGtleXMgb2Ygb2JqCiovCkVtYmVyLmtleXMgPSBPYmplY3Qua2V5czsKCmlmICghRW1iZXIu
a2V5cyB8fCBFbWJlci5jcmVhdGUuaXNTaW11bGF0ZWQpIHsKICB2YXIgcHJvdG90eXBlUHJvcGVy
dGllcyA9IFsKICAgICdjb25zdHJ1Y3RvcicsCiAgICAnaGFzT3duUHJvcGVydHknLAogICAgJ2lz
UHJvdG90eXBlT2YnLAogICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywKICAgICd2YWx1ZU9mJywK
ICAgICd0b0xvY2FsZVN0cmluZycsCiAgICAndG9TdHJpbmcnCiAgXSwKICBwdXNoUHJvcGVydHlO
YW1lID0gZnVuY3Rpb24ob2JqLCBhcnJheSwga2V5KSB7CiAgICAvLyBQcmV2ZW50cyBicm93c2Vy
cyB0aGF0IGRvbid0IHJlc3BlY3Qgbm9uLWVudW1lcmFiaWxpdHkgZnJvbQogICAgLy8gY29weWlu
ZyBpbnRlcm5hbCBFbWJlciBwcm9wZXJ0aWVzCiAgICBpZiAoa2V5LnN1YnN0cmluZygwLDIpID09
PSAnX18nKSByZXR1cm47CiAgICBpZiAoa2V5ID09PSAnX3N1cGVyJykgcmV0dXJuOwogICAgaWYg
KGluZGV4T2YoYXJyYXksIGtleSkgPj0gMCkgcmV0dXJuOwogICAgaWYgKCFvYmouaGFzT3duUHJv
cGVydHkoa2V5KSkgcmV0dXJuOwoKICAgIGFycmF5LnB1c2goa2V5KTsKICB9OwoKICBFbWJlci5r
ZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmV0ID0gW10sIGtleTsKICAgIGZvciAoa2V5
IGluIG9iaikgewogICAgICBwdXNoUHJvcGVydHlOYW1lKG9iaiwgcmV0LCBrZXkpOwogICAgfQoK
ICAgIC8vIElFOCBkb2Vzbid0IGVudW1lcmF0ZSBwcm9wZXJ0eSB0aGF0IG5hbWVkIHRoZSBzYW1l
IGFzIHByb3RvdHlwZSBwcm9wZXJ0aWVzLgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwcm90b3R5
cGVQcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBrZXkgPSBwcm90b3R5cGVQ
cm9wZXJ0aWVzW2ldOwoKICAgICAgcHVzaFByb3BlcnR5TmFtZShvYmosIHJldCwga2V5KTsKICAg
IH0KCiAgICByZXR1cm4gcmV0OwogIH07Cn0KCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBt
b2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgU1RSSU5HX0RBU0hF
UklaRV9SRUdFWFAgPSAoL1sgX10vZyk7CnZhciBTVFJJTkdfREFTSEVSSVpFX0NBQ0hFID0ge307
CnZhciBTVFJJTkdfREVDQU1FTElaRV9SRUdFWFAgPSAoLyhbYS16XGRdKShbQS1aXSkvZyk7CnZh
ciBTVFJJTkdfQ0FNRUxJWkVfUkVHRVhQID0gKC8oXC18X3xcLnxccykrKC4pPy9nKTsKdmFyIFNU
UklOR19VTkRFUlNDT1JFX1JFR0VYUF8xID0gKC8oW2EtelxkXSkoW0EtWl0rKS9nKTsKdmFyIFNU
UklOR19VTkRFUlNDT1JFX1JFR0VYUF8yID0gKC9cLXxccysvZyk7CgovKioKICBEZWZpbmVzIHRo
ZSBoYXNoIG9mIGxvY2FsaXplZCBzdHJpbmdzIGZvciB0aGUgY3VycmVudCBsYW5ndWFnZS4gVXNl
ZCBieQogIHRoZSBgRW1iZXIuU3RyaW5nLmxvYygpYCBoZWxwZXIuIFRvIGxvY2FsaXplLCBhZGQg
c3RyaW5nIHZhbHVlcyB0byB0aGlzCiAgaGFzaC4KCiAgQHByb3BlcnR5IFNUUklOR1MKICBAZm9y
IEVtYmVyCiAgQHR5cGUgSGFzaAoqLwpFbWJlci5TVFJJTkdTID0ge307CgovKioKICBEZWZpbmVz
IHN0cmluZyBoZWxwZXIgbWV0aG9kcyBpbmNsdWRpbmcgc3RyaW5nIGZvcm1hdHRpbmcgYW5kIGxv
Y2FsaXphdGlvbi4KICBVbmxlc3MgYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTLlN0cmluZ2AgaXMg
YGZhbHNlYCB0aGVzZSBtZXRob2RzIHdpbGwgYWxzbyBiZQogIGFkZGVkIHRvIHRoZSBgU3RyaW5n
LnByb3RvdHlwZWAgYXMgd2VsbC4KCiAgQGNsYXNzIFN0cmluZwogIEBuYW1lc3BhY2UgRW1iZXIK
ICBAc3RhdGljCiovCkVtYmVyLlN0cmluZyA9IHsKCiAgLyoqCiAgICBBcHBseSBmb3JtYXR0aW5n
IG9wdGlvbnMgdG8gdGhlIHN0cmluZy4gVGhpcyB3aWxsIGxvb2sgZm9yIG9jY3VycmVuY2VzCiAg
ICBvZiAiJUAiIGluIHlvdXIgc3RyaW5nIGFuZCBzdWJzdGl0dXRlIHRoZW0gd2l0aCB0aGUgYXJn
dW1lbnRzIHlvdSBwYXNzIGludG8KICAgIHRoaXMgbWV0aG9kLiBJZiB5b3Ugd2FudCB0byBjb250
cm9sIHRoZSBzcGVjaWZpYyBvcmRlciBvZiByZXBsYWNlbWVudCwKICAgIHlvdSBjYW4gYWRkIGEg
bnVtYmVyIGFmdGVyIHRoZSBrZXkgYXMgd2VsbCB0byBpbmRpY2F0ZSB3aGljaCBhcmd1bWVudAog
ICAgeW91IHdhbnQgdG8gaW5zZXJ0LgoKICAgIE9yZGVyZWQgaW5zZXJ0aW9ucyBhcmUgbW9zdCB1
c2VmdWwgd2hlbiBidWlsZGluZyBsb2Mgc3RyaW5ncyB3aGVyZSB2YWx1ZXMKICAgIHlvdSBuZWVk
IHRvIGluc2VydCBtYXkgYXBwZWFyIGluIGRpZmZlcmVudCBvcmRlcnMuCgogICAgYGBgamF2YXNj
cmlwdAogICAgIkhlbGxvICVAICVAIi5mbXQoJ0pvaG4nLCAnRG9lJyk7ICAgICAvLyAiSGVsbG8g
Sm9obiBEb2UiCiAgICAiSGVsbG8gJUAyLCAlQDEiLmZtdCgnSm9obicsICdEb2UnKTsgIC8vICJI
ZWxsbyBEb2UsIEpvaG4iCiAgICBgYGAKCiAgICBAbWV0aG9kIGZtdAogICAgQHBhcmFtIHtTdHJp
bmd9IHN0ciBUaGUgc3RyaW5nIHRvIGZvcm1hdAogICAgQHBhcmFtIHtBcnJheX0gZm9ybWF0cyBB
biBhcnJheSBvZiBwYXJhbWV0ZXJzIHRvIGludGVycG9sYXRlIGludG8gc3RyaW5nLgogICAgQHJl
dHVybiB7U3RyaW5nfSBmb3JtYXR0ZWQgc3RyaW5nCiAgKi8KICBmbXQ6IGZ1bmN0aW9uKHN0ciwg
Zm9ybWF0cykgewogICAgLy8gZmlyc3QsIHJlcGxhY2UgYW55IE9SREVSRUQgcmVwbGFjZW1lbnRz
LgogICAgdmFyIGlkeCAgPSAwOyAvLyB0aGUgY3VycmVudCBpbmRleCBmb3Igbm9uLW51bWVyaWNh
bCByZXBsYWNlbWVudHMKICAgIHJldHVybiBzdHIucmVwbGFjZSgvJUAoWzAtOV0rKT8vZywgZnVu
Y3Rpb24ocywgYXJnSW5kZXgpIHsKICAgICAgYXJnSW5kZXggPSAoYXJnSW5kZXgpID8gcGFyc2VJ
bnQoYXJnSW5kZXgsIDEwKSAtIDEgOiBpZHgrKzsKICAgICAgcyA9IGZvcm1hdHNbYXJnSW5kZXhd
OwogICAgICByZXR1cm4gKHMgPT09IG51bGwpID8gJyhudWxsKScgOiAocyA9PT0gdW5kZWZpbmVk
KSA/ICcnIDogRW1iZXIuaW5zcGVjdChzKTsKICAgIH0pIDsKICB9LAoKICAvKioKICAgIEZvcm1h
dHMgdGhlIHBhc3NlZCBzdHJpbmcsIGJ1dCBmaXJzdCBsb29rcyB1cCB0aGUgc3RyaW5nIGluIHRo
ZSBsb2NhbGl6ZWQKICAgIHN0cmluZ3MgaGFzaC4gVGhpcyBpcyBhIGNvbnZlbmllbnQgd2F5IHRv
IGxvY2FsaXplIHRleHQuIFNlZQogICAgYEVtYmVyLlN0cmluZy5mbXQoKWAgZm9yIG1vcmUgaW5m
b3JtYXRpb24gb24gZm9ybWF0dGluZy4KCiAgICBOb3RlIHRoYXQgaXQgaXMgdHJhZGl0aW9uYWwg
YnV0IG5vdCByZXF1aXJlZCB0byBwcmVmaXggbG9jYWxpemVkIHN0cmluZwogICAga2V5cyB3aXRo
IGFuIHVuZGVyc2NvcmUgb3Igb3RoZXIgY2hhcmFjdGVyIHNvIHlvdSBjYW4gZWFzaWx5IGlkZW50
aWZ5CiAgICBsb2NhbGl6ZWQgc3RyaW5ncy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBFbWJlci5T
VFJJTkdTID0gewogICAgICAnX0hlbGxvIFdvcmxkJzogJ0JvbmpvdXIgbGUgbW9uZGUnLAogICAg
ICAnX0hlbGxvICVAICVAJzogJ0JvbmpvdXIgJUAgJUAnCiAgICB9OwoKICAgIEVtYmVyLlN0cmlu
Zy5sb2MoIl9IZWxsbyBXb3JsZCIpOyAgLy8gJ0JvbmpvdXIgbGUgbW9uZGUnOwogICAgRW1iZXIu
U3RyaW5nLmxvYygiX0hlbGxvICVAICVAIiwgWyJKb2huIiwgIlNtaXRoIl0pOyAgLy8gIkJvbmpv
dXIgSm9obiBTbWl0aCI7CiAgICBgYGAKCiAgICBAbWV0aG9kIGxvYwogICAgQHBhcmFtIHtTdHJp
bmd9IHN0ciBUaGUgc3RyaW5nIHRvIGZvcm1hdAogICAgQHBhcmFtIHtBcnJheX0gZm9ybWF0cyBP
cHRpb25hbCBhcnJheSBvZiBwYXJhbWV0ZXJzIHRvIGludGVycG9sYXRlIGludG8gc3RyaW5nLgog
ICAgQHJldHVybiB7U3RyaW5nfSBmb3JtYXR0ZWQgc3RyaW5nCiAgKi8KICBsb2M6IGZ1bmN0aW9u
KHN0ciwgZm9ybWF0cykgewogICAgc3RyID0gRW1iZXIuU1RSSU5HU1tzdHJdIHx8IHN0cjsKICAg
IHJldHVybiBFbWJlci5TdHJpbmcuZm10KHN0ciwgZm9ybWF0cykgOwogIH0sCgogIC8qKgogICAg
U3BsaXRzIGEgc3RyaW5nIGludG8gc2VwYXJhdGUgdW5pdHMgc2VwYXJhdGVkIGJ5IHNwYWNlcywg
ZWxpbWluYXRpbmcgYW55CiAgICBlbXB0eSBzdHJpbmdzIGluIHRoZSBwcm9jZXNzLiBUaGlzIGlz
IGEgY29udmVuaWVuY2UgbWV0aG9kIGZvciBzcGxpdCB0aGF0CiAgICBpcyBtb3N0bHkgdXNlZnVs
IHdoZW4gYXBwbGllZCB0byB0aGUgYFN0cmluZy5wcm90b3R5cGVgLgoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIEVtYmVyLlN0cmluZy53KCJhbHBoYSBiZXRhIGdhbW1hIikuZm9yRWFjaChmdW5jdGlv
bihrZXkpIHsKICAgICAgY29uc29sZS5sb2coa2V5KTsKICAgIH0pOwoKICAgIC8vID4gYWxwaGEK
ICAgIC8vID4gYmV0YQogICAgLy8gPiBnYW1tYQogICAgYGBgCgogICAgQG1ldGhvZCB3CiAgICBA
cGFyYW0ge1N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gc3BsaXQKICAgIEByZXR1cm4ge1N0cmlu
Z30gc3BsaXQgc3RyaW5nCiAgKi8KICB3OiBmdW5jdGlvbihzdHIpIHsgcmV0dXJuIHN0ci5zcGxp
dCgvXHMrLyk7IH0sCgogIC8qKgogICAgQ29udmVydHMgYSBjYW1lbGl6ZWQgc3RyaW5nIGludG8g
YWxsIGxvd2VyIGNhc2Ugc2VwYXJhdGVkIGJ5IHVuZGVyc2NvcmVzLgoKICAgIGBgYGphdmFzY3Jp
cHQKICAgICdpbm5lckhUTUwnLmRlY2FtZWxpemUoKTsgICAgICAgICAgIC8vICdpbm5lcl9odG1s
JwogICAgJ2FjdGlvbl9uYW1lJy5kZWNhbWVsaXplKCk7ICAgICAgICAvLyAnYWN0aW9uX25hbWUn
CiAgICAnY3NzLWNsYXNzLW5hbWUnLmRlY2FtZWxpemUoKTsgICAgIC8vICdjc3MtY2xhc3MtbmFt
ZScKICAgICdteSBmYXZvcml0ZSBpdGVtcycuZGVjYW1lbGl6ZSgpOyAgLy8gJ215IGZhdm9yaXRl
IGl0ZW1zJwogICAgYGBgCgogICAgQG1ldGhvZCBkZWNhbWVsaXplCiAgICBAcGFyYW0ge1N0cmlu
Z30gc3RyIFRoZSBzdHJpbmcgdG8gZGVjYW1lbGl6ZS4KICAgIEByZXR1cm4ge1N0cmluZ30gdGhl
IGRlY2FtZWxpemVkIHN0cmluZy4KICAqLwogIGRlY2FtZWxpemU6IGZ1bmN0aW9uKHN0cikgewog
ICAgcmV0dXJuIHN0ci5yZXBsYWNlKFNUUklOR19ERUNBTUVMSVpFX1JFR0VYUCwgJyQxXyQyJyku
dG9Mb3dlckNhc2UoKTsKICB9LAoKICAvKioKICAgIFJlcGxhY2VzIHVuZGVyc2NvcmVzLCBzcGFj
ZXMsIG9yIGNhbWVsQ2FzZSB3aXRoIGRhc2hlcy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICAnaW5u
ZXJIVE1MJy5kYXNoZXJpemUoKTsgICAgICAgICAgLy8gJ2lubmVyLWh0bWwnCiAgICAnYWN0aW9u
X25hbWUnLmRhc2hlcml6ZSgpOyAgICAgICAgLy8gJ2FjdGlvbi1uYW1lJwogICAgJ2Nzcy1jbGFz
cy1uYW1lJy5kYXNoZXJpemUoKTsgICAgIC8vICdjc3MtY2xhc3MtbmFtZScKICAgICdteSBmYXZv
cml0ZSBpdGVtcycuZGFzaGVyaXplKCk7ICAvLyAnbXktZmF2b3JpdGUtaXRlbXMnCiAgICBgYGAK
CiAgICBAbWV0aG9kIGRhc2hlcml6ZQogICAgQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5n
IHRvIGRhc2hlcml6ZS4KICAgIEByZXR1cm4ge1N0cmluZ30gdGhlIGRhc2hlcml6ZWQgc3RyaW5n
LgogICovCiAgZGFzaGVyaXplOiBmdW5jdGlvbihzdHIpIHsKICAgIHZhciBjYWNoZSA9IFNUUklO
R19EQVNIRVJJWkVfQ0FDSEUsCiAgICAgICAgaGl0ICAgPSBjYWNoZS5oYXNPd25Qcm9wZXJ0eShz
dHIpLAogICAgICAgIHJldDsKCiAgICBpZiAoaGl0KSB7CiAgICAgIHJldHVybiBjYWNoZVtzdHJd
OwogICAgfSBlbHNlIHsKICAgICAgcmV0ID0gRW1iZXIuU3RyaW5nLmRlY2FtZWxpemUoc3RyKS5y
ZXBsYWNlKFNUUklOR19EQVNIRVJJWkVfUkVHRVhQLCctJyk7CiAgICAgIGNhY2hlW3N0cl0gPSBy
ZXQ7CiAgICB9CgogICAgcmV0dXJuIHJldDsKICB9LAoKICAvKioKICAgIFJldHVybnMgdGhlIGxv
d2VyQ2FtZWxDYXNlIGZvcm0gb2YgYSBzdHJpbmcuCgogICAgYGBgamF2YXNjcmlwdAogICAgJ2lu
bmVySFRNTCcuY2FtZWxpemUoKTsgICAgICAgICAgLy8gJ2lubmVySFRNTCcKICAgICdhY3Rpb25f
bmFtZScuY2FtZWxpemUoKTsgICAgICAgIC8vICdhY3Rpb25OYW1lJwogICAgJ2Nzcy1jbGFzcy1u
YW1lJy5jYW1lbGl6ZSgpOyAgICAgLy8gJ2Nzc0NsYXNzTmFtZScKICAgICdteSBmYXZvcml0ZSBp
dGVtcycuY2FtZWxpemUoKTsgIC8vICdteUZhdm9yaXRlSXRlbXMnCiAgICAnTXkgRmF2b3JpdGUg
SXRlbXMnLmNhbWVsaXplKCk7ICAvLyAnbXlGYXZvcml0ZUl0ZW1zJwogICAgYGBgCgogICAgQG1l
dGhvZCBjYW1lbGl6ZQogICAgQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNhbWVs
aXplLgogICAgQHJldHVybiB7U3RyaW5nfSB0aGUgY2FtZWxpemVkIHN0cmluZy4KICAqLwogIGNh
bWVsaXplOiBmdW5jdGlvbihzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZShTVFJJTkdfQ0FN
RUxJWkVfUkVHRVhQLCBmdW5jdGlvbihtYXRjaCwgc2VwYXJhdG9yLCBjaHIpIHsKICAgICAgcmV0
dXJuIGNociA/IGNoci50b1VwcGVyQ2FzZSgpIDogJyc7CiAgICB9KS5yZXBsYWNlKC9eKFtBLVpd
KS8sIGZ1bmN0aW9uKG1hdGNoLCBzZXBhcmF0b3IsIGNocikgewogICAgICByZXR1cm4gbWF0Y2gu
dG9Mb3dlckNhc2UoKTsKICAgIH0pOwogIH0sCgogIC8qKgogICAgUmV0dXJucyB0aGUgVXBwZXJD
YW1lbENhc2UgZm9ybSBvZiBhIHN0cmluZy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICAnaW5uZXJI
VE1MJy5jbGFzc2lmeSgpOyAgICAgICAgICAvLyAnSW5uZXJIVE1MJwogICAgJ2FjdGlvbl9uYW1l
Jy5jbGFzc2lmeSgpOyAgICAgICAgLy8gJ0FjdGlvbk5hbWUnCiAgICAnY3NzLWNsYXNzLW5hbWUn
LmNsYXNzaWZ5KCk7ICAgICAvLyAnQ3NzQ2xhc3NOYW1lJwogICAgJ215IGZhdm9yaXRlIGl0ZW1z
Jy5jbGFzc2lmeSgpOyAgLy8gJ015RmF2b3JpdGVJdGVtcycKICAgIGBgYAoKICAgIEBtZXRob2Qg
Y2xhc3NpZnkKICAgIEBwYXJhbSB7U3RyaW5nfSBzdHIgdGhlIHN0cmluZyB0byBjbGFzc2lmeQog
ICAgQHJldHVybiB7U3RyaW5nfSB0aGUgY2xhc3NpZmllZCBzdHJpbmcKICAqLwogIGNsYXNzaWZ5
OiBmdW5jdGlvbihzdHIpIHsKICAgIHZhciBwYXJ0cyA9IHN0ci5zcGxpdCgiLiIpLAogICAgICAg
IG91dCA9IFtdOwoKICAgIGZvciAodmFyIGk9MCwgbD1wYXJ0cy5sZW5ndGg7IGk8bDsgaSsrKSB7
CiAgICAgIHZhciBjYW1lbGl6ZWQgPSBFbWJlci5TdHJpbmcuY2FtZWxpemUocGFydHNbaV0pOwog
ICAgICBvdXQucHVzaChjYW1lbGl6ZWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYW1lbGl6
ZWQuc3Vic3RyKDEpKTsKICAgIH0KCiAgICByZXR1cm4gb3V0LmpvaW4oIi4iKTsKICB9LAoKICAv
KioKICAgIE1vcmUgZ2VuZXJhbCB0aGFuIGRlY2FtZWxpemUuIFJldHVybnMgdGhlIGxvd2VyXF9j
YXNlXF9hbmRcX3VuZGVyc2NvcmVkCiAgICBmb3JtIG9mIGEgc3RyaW5nLgoKICAgIGBgYGphdmFz
Y3JpcHQKICAgICdpbm5lckhUTUwnLnVuZGVyc2NvcmUoKTsgICAgICAgICAgLy8gJ2lubmVyX2h0
bWwnCiAgICAnYWN0aW9uX25hbWUnLnVuZGVyc2NvcmUoKTsgICAgICAgIC8vICdhY3Rpb25fbmFt
ZScKICAgICdjc3MtY2xhc3MtbmFtZScudW5kZXJzY29yZSgpOyAgICAgLy8gJ2Nzc19jbGFzc19u
YW1lJwogICAgJ215IGZhdm9yaXRlIGl0ZW1zJy51bmRlcnNjb3JlKCk7ICAvLyAnbXlfZmF2b3Jp
dGVfaXRlbXMnCiAgICBgYGAKCiAgICBAbWV0aG9kIHVuZGVyc2NvcmUKICAgIEBwYXJhbSB7U3Ry
aW5nfSBzdHIgVGhlIHN0cmluZyB0byB1bmRlcnNjb3JlLgogICAgQHJldHVybiB7U3RyaW5nfSB0
aGUgdW5kZXJzY29yZWQgc3RyaW5nLgogICovCiAgdW5kZXJzY29yZTogZnVuY3Rpb24oc3RyKSB7
CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoU1RSSU5HX1VOREVSU0NPUkVfUkVHRVhQXzEsICckMV8k
MicpLgogICAgICByZXBsYWNlKFNUUklOR19VTkRFUlNDT1JFX1JFR0VYUF8yLCAnXycpLnRvTG93
ZXJDYXNlKCk7CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRoZSBDYXBpdGFsaXplZCBmb3JtIG9m
IGEgc3RyaW5nCgogICAgYGBgamF2YXNjcmlwdAogICAgJ2lubmVySFRNTCcuY2FwaXRhbGl6ZSgp
ICAgICAgICAgLy8gJ0lubmVySFRNTCcKICAgICdhY3Rpb25fbmFtZScuY2FwaXRhbGl6ZSgpICAg
ICAgIC8vICdBY3Rpb25fbmFtZScKICAgICdjc3MtY2xhc3MtbmFtZScuY2FwaXRhbGl6ZSgpICAg
IC8vICdDc3MtY2xhc3MtbmFtZScKICAgICdteSBmYXZvcml0ZSBpdGVtcycuY2FwaXRhbGl6ZSgp
IC8vICdNeSBmYXZvcml0ZSBpdGVtcycKICAgIGBgYAoKICAgIEBtZXRob2QgY2FwaXRhbGl6ZQog
ICAgQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNhcGl0YWxpemUuCiAgICBAcmV0
dXJuIHtTdHJpbmd9IFRoZSBjYXBpdGFsaXplZCBzdHJpbmcuCiAgKi8KICBjYXBpdGFsaXplOiBm
dW5jdGlvbihzdHIpIHsKICAgIHJldHVybiBzdHIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBz
dHIuc3Vic3RyKDEpOwogIH0KfTsKCgoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVs
ZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXJ1bnRpbWUKKi8KCgoKdmFyIGZtdCA9IEVtYmVyLlN0
cmluZy5mbXQsCiAgICB3ICAgPSBFbWJlci5TdHJpbmcudywKICAgIGxvYyA9IEVtYmVyLlN0cmlu
Zy5sb2MsCiAgICBjYW1lbGl6ZSA9IEVtYmVyLlN0cmluZy5jYW1lbGl6ZSwKICAgIGRlY2FtZWxp
emUgPSBFbWJlci5TdHJpbmcuZGVjYW1lbGl6ZSwKICAgIGRhc2hlcml6ZSA9IEVtYmVyLlN0cmlu
Zy5kYXNoZXJpemUsCiAgICB1bmRlcnNjb3JlID0gRW1iZXIuU3RyaW5nLnVuZGVyc2NvcmUsCiAg
ICBjYXBpdGFsaXplID0gRW1iZXIuU3RyaW5nLmNhcGl0YWxpemUsCiAgICBjbGFzc2lmeSA9IEVt
YmVyLlN0cmluZy5jbGFzc2lmeTsKCgppZiAoRW1iZXIuRVhURU5EX1BST1RPVFlQRVMgPT09IHRy
dWUgfHwgRW1iZXIuRVhURU5EX1BST1RPVFlQRVMuU3RyaW5nKSB7CgogIC8qKgogICAgU2VlIFtF
bWJlci5TdHJpbmcuZm10XSgvYXBpL2NsYXNzZXMvRW1iZXIuU3RyaW5nLmh0bWwjbWV0aG9kX2Zt
dCkuCgogICAgQG1ldGhvZCBmbXQKICAgIEBmb3IgU3RyaW5nCiAgKi8KICBTdHJpbmcucHJvdG90
eXBlLmZtdCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGZtdCh0aGlzLCBhcmd1bWVudHMpOwog
IH07CgogIC8qKgogICAgU2VlIFtFbWJlci5TdHJpbmcud10oL2FwaS9jbGFzc2VzL0VtYmVyLlN0
cmluZy5odG1sI21ldGhvZF93KS4KCiAgICBAbWV0aG9kIHcKICAgIEBmb3IgU3RyaW5nCiAgKi8K
ICBTdHJpbmcucHJvdG90eXBlLncgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB3KHRoaXMpOwog
IH07CgogIC8qKgogICAgU2VlIFtFbWJlci5TdHJpbmcubG9jXSgvYXBpL2NsYXNzZXMvRW1iZXIu
U3RyaW5nLmh0bWwjbWV0aG9kX2xvYykuCgogICAgQG1ldGhvZCBsb2MKICAgIEBmb3IgU3RyaW5n
CiAgKi8KICBTdHJpbmcucHJvdG90eXBlLmxvYyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGxv
Yyh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8qKgogICAgU2VlIFtFbWJlci5TdHJpbmcuY2Ft
ZWxpemVdKC9hcGkvY2xhc3Nlcy9FbWJlci5TdHJpbmcuaHRtbCNtZXRob2RfY2FtZWxpemUpLgoK
ICAgIEBtZXRob2QgY2FtZWxpemUKICAgIEBmb3IgU3RyaW5nCiAgKi8KICBTdHJpbmcucHJvdG90
eXBlLmNhbWVsaXplID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gY2FtZWxpemUodGhpcyk7CiAg
fTsKCiAgLyoqCiAgICBTZWUgW0VtYmVyLlN0cmluZy5kZWNhbWVsaXplXSgvYXBpL2NsYXNzZXMv
RW1iZXIuU3RyaW5nLmh0bWwjbWV0aG9kX2RlY2FtZWxpemUpLgoKICAgIEBtZXRob2QgZGVjYW1l
bGl6ZQogICAgQGZvciBTdHJpbmcKICAqLwogIFN0cmluZy5wcm90b3R5cGUuZGVjYW1lbGl6ZSA9
IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGRlY2FtZWxpemUodGhpcyk7CiAgfTsKCiAgLyoqCiAg
ICBTZWUgW0VtYmVyLlN0cmluZy5kYXNoZXJpemVdKC9hcGkvY2xhc3Nlcy9FbWJlci5TdHJpbmcu
aHRtbCNtZXRob2RfZGFzaGVyaXplKS4KCiAgICBAbWV0aG9kIGRhc2hlcml6ZQogICAgQGZvciBT
dHJpbmcKICAqLwogIFN0cmluZy5wcm90b3R5cGUuZGFzaGVyaXplID0gZnVuY3Rpb24oKSB7CiAg
ICByZXR1cm4gZGFzaGVyaXplKHRoaXMpOwogIH07CgogIC8qKgogICAgU2VlIFtFbWJlci5TdHJp
bmcudW5kZXJzY29yZV0oL2FwaS9jbGFzc2VzL0VtYmVyLlN0cmluZy5odG1sI21ldGhvZF91bmRl
cnNjb3JlKS4KCiAgICBAbWV0aG9kIHVuZGVyc2NvcmUKICAgIEBmb3IgU3RyaW5nCiAgKi8KICBT
dHJpbmcucHJvdG90eXBlLnVuZGVyc2NvcmUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB1bmRl
cnNjb3JlKHRoaXMpOwogIH07CgogIC8qKgogICAgU2VlIFtFbWJlci5TdHJpbmcuY2xhc3NpZnld
KC9hcGkvY2xhc3Nlcy9FbWJlci5TdHJpbmcuaHRtbCNtZXRob2RfY2xhc3NpZnkpLgoKICAgIEBt
ZXRob2QgY2xhc3NpZnkKICAgIEBmb3IgU3RyaW5nCiAgKi8KICBTdHJpbmcucHJvdG90eXBlLmNs
YXNzaWZ5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gY2xhc3NpZnkodGhpcyk7CiAgfTsKCiAg
LyoqCiAgICBTZWUgW0VtYmVyLlN0cmluZy5jYXBpdGFsaXplXSgvYXBpL2NsYXNzZXMvRW1iZXIu
U3RyaW5nLmh0bWwjbWV0aG9kX2NhcGl0YWxpemUpLgoKICAgIEBtZXRob2QgY2FwaXRhbGl6ZQog
ICAgQGZvciBTdHJpbmcKICAqLwogIFN0cmluZy5wcm90b3R5cGUuY2FwaXRhbGl6ZSA9IGZ1bmN0
aW9uKCkgewogICAgcmV0dXJuIGNhcGl0YWxpemUodGhpcyk7CiAgfTsKCiAgCn0KCgp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVudGlt
ZQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwKICAgIHNldCA9IEVtYmVyLnNldCwKICAgIHNsaWNl
ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgZ2V0UHJvcGVydGllcyA9IEVtYmVyLmdldFBy
b3BlcnRpZXM7CgovKioKICAjIyBPdmVydmlldwoKICBUaGlzIG1peGluIHByb3ZpZGVzIHByb3Bl
cnRpZXMgYW5kIHByb3BlcnR5IG9ic2VydmluZyBmdW5jdGlvbmFsaXR5LCBjb3JlCiAgZmVhdHVy
ZXMgb2YgdGhlIEVtYmVyIG9iamVjdCBtb2RlbC4KCiAgUHJvcGVydGllcyBhbmQgb2JzZXJ2ZXJz
IGFsbG93IG9uZSBvYmplY3QgdG8gb2JzZXJ2ZSBjaGFuZ2VzIHRvIGEKICBwcm9wZXJ0eSBvbiBh
bm90aGVyIG9iamVjdC4gVGhpcyBpcyBvbmUgb2YgdGhlIGZ1bmRhbWVudGFsIHdheXMgdGhhdAog
IG1vZGVscywgY29udHJvbGxlcnMgYW5kIHZpZXdzIGNvbW11bmljYXRlIHdpdGggZWFjaCBvdGhl
ciBpbiBhbiBFbWJlcgogIGFwcGxpY2F0aW9uLgoKICBBbnkgb2JqZWN0IHRoYXQgaGFzIHRoaXMg
bWl4aW4gYXBwbGllZCBjYW4gYmUgdXNlZCBpbiBvYnNlcnZlcgogIG9wZXJhdGlvbnMuIFRoYXQg
aW5jbHVkZXMgYEVtYmVyLk9iamVjdGAgYW5kIG1vc3Qgb2JqZWN0cyB5b3Ugd2lsbAogIGludGVy
YWN0IHdpdGggYXMgeW91IHdyaXRlIHlvdXIgRW1iZXIgYXBwbGljYXRpb24uCgogIE5vdGUgdGhh
dCB5b3Ugd2lsbCBub3QgZ2VuZXJhbGx5IGFwcGx5IHRoaXMgbWl4aW4gdG8gY2xhc3NlcyB5b3Vy
c2VsZiwKICBidXQgeW91IHdpbGwgdXNlIHRoZSBmZWF0dXJlcyBwcm92aWRlZCBieSB0aGlzIG1v
ZHVsZSBmcmVxdWVudGx5LCBzbyBpdAogIGlzIGltcG9ydGFudCB0byB1bmRlcnN0YW5kIGhvdyB0
byB1c2UgaXQuCgogICMjIFVzaW5nIGBnZXQoKWAgYW5kIGBzZXQoKWAKCiAgQmVjYXVzZSBvZiBF
bWJlcidzIHN1cHBvcnQgZm9yIGJpbmRpbmdzIGFuZCBvYnNlcnZlcnMsIHlvdSB3aWxsIGFsd2F5
cwogIGFjY2VzcyBwcm9wZXJ0aWVzIHVzaW5nIHRoZSBnZXQgbWV0aG9kLCBhbmQgc2V0IHByb3Bl
cnRpZXMgdXNpbmcgdGhlCiAgc2V0IG1ldGhvZC4gVGhpcyBhbGxvd3MgdGhlIG9ic2VydmluZyBv
YmplY3RzIHRvIGJlIG5vdGlmaWVkIGFuZAogIGNvbXB1dGVkIHByb3BlcnRpZXMgdG8gYmUgaGFu
ZGxlZCBwcm9wZXJseS4KCiAgTW9yZSBkb2N1bWVudGF0aW9uIGFib3V0IGBnZXRgIGFuZCBgc2V0
YCBhcmUgYmVsb3cuCgogICMjIE9ic2VydmluZyBQcm9wZXJ0eSBDaGFuZ2VzCgogIFlvdSB0eXBp
Y2FsbHkgb2JzZXJ2ZSBwcm9wZXJ0eSBjaGFuZ2VzIHNpbXBseSBieSBhZGRpbmcgdGhlIGBvYnNl
cnZlc2AKICBjYWxsIHRvIHRoZSBlbmQgb2YgeW91ciBtZXRob2QgZGVjbGFyYXRpb25zIGluIGNs
YXNzZXMgdGhhdCB5b3Ugd3JpdGUuCiAgRm9yIGV4YW1wbGU6CgogIGBgYGphdmFzY3JpcHQKICBF
bWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIHZhbHVlT2JzZXJ2ZXI6IGZ1bmN0aW9uKCkgewogICAg
ICAvLyBFeGVjdXRlcyB3aGVuZXZlciB0aGUgInZhbHVlIiBwcm9wZXJ0eSBjaGFuZ2VzCiAgICB9
Lm9ic2VydmVzKCd2YWx1ZScpCiAgfSk7CiAgYGBgCgogIEFsdGhvdWdoIHRoaXMgaXMgdGhlIG1v
c3QgY29tbW9uIHdheSB0byBhZGQgYW4gb2JzZXJ2ZXIsIHRoaXMgY2FwYWJpbGl0eQogIGlzIGFj
dHVhbGx5IGJ1aWx0IGludG8gdGhlIGBFbWJlci5PYmplY3RgIGNsYXNzIG9uIHRvcCBvZiB0d28g
bWV0aG9kcwogIGRlZmluZWQgaW4gdGhpcyBtaXhpbjogYGFkZE9ic2VydmVyYCBhbmQgYHJlbW92
ZU9ic2VydmVyYC4gWW91IGNhbiB1c2UKICB0aGVzZSB0d28gbWV0aG9kcyB0byBhZGQgYW5kIHJl
bW92ZSBvYnNlcnZlcnMgeW91cnNlbGYgaWYgeW91IG5lZWQgdG8KICBkbyBzbyBhdCBydW50aW1l
LgoKICBUbyBhZGQgYW4gb2JzZXJ2ZXIgZm9yIGEgcHJvcGVydHksIGNhbGw6CgogIGBgYGphdmFz
Y3JpcHQKICBvYmplY3QuYWRkT2JzZXJ2ZXIoJ3Byb3BlcnR5S2V5JywgdGFyZ2V0T2JqZWN0LCB0
YXJnZXRBY3Rpb24pCiAgYGBgCgogIFRoaXMgd2lsbCBjYWxsIHRoZSBgdGFyZ2V0QWN0aW9uYCBt
ZXRob2Qgb24gdGhlIGB0YXJnZXRPYmplY3RgIHdoZW5ldmVyCiAgdGhlIHZhbHVlIG9mIHRoZSBg
cHJvcGVydHlLZXlgIGNoYW5nZXMuCgogIE5vdGUgdGhhdCBpZiBgcHJvcGVydHlLZXlgIGlzIGEg
Y29tcHV0ZWQgcHJvcGVydHksIHRoZSBvYnNlcnZlciB3aWxsIGJlCiAgY2FsbGVkIHdoZW4gYW55
IG9mIHRoZSBwcm9wZXJ0eSBkZXBlbmRlbmNpZXMgYXJlIGNoYW5nZWQsIGV2ZW4gaWYgdGhlCiAg
cmVzdWx0aW5nIHZhbHVlIG9mIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSBpcyB1bmNoYW5nZWQuIFRo
aXMgaXMgbmVjZXNzYXJ5CiAgYmVjYXVzZSBjb21wdXRlZCBwcm9wZXJ0aWVzIGFyZSBub3QgY29t
cHV0ZWQgdW50aWwgYGdldGAgaXMgY2FsbGVkLgoKICBAY2xhc3MgT2JzZXJ2YWJsZQogIEBuYW1l
c3BhY2UgRW1iZXIKKi8KRW1iZXIuT2JzZXJ2YWJsZSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7Cgog
IC8qKgogICAgUmV0cmlldmVzIHRoZSB2YWx1ZSBvZiBhIHByb3BlcnR5IGZyb20gdGhlIG9iamVj
dC4KCiAgICBUaGlzIG1ldGhvZCBpcyB1c3VhbGx5IHNpbWlsYXIgdG8gdXNpbmcgYG9iamVjdFtr
ZXlOYW1lXWAgb3IgYG9iamVjdC5rZXlOYW1lYCwKICAgIGhvd2V2ZXIgaXQgc3VwcG9ydHMgYm90
aCBjb21wdXRlZCBwcm9wZXJ0aWVzIGFuZCB0aGUgdW5rbm93blByb3BlcnR5CiAgICBoYW5kbGVy
LgoKICAgIEJlY2F1c2UgYGdldGAgdW5pZmllcyB0aGUgc3ludGF4IGZvciBhY2Nlc3NpbmcgYWxs
IHRoZXNlIGtpbmRzCiAgICBvZiBwcm9wZXJ0aWVzLCBpdCBjYW4gbWFrZSBtYW55IHJlZmFjdG9y
aW5ncyBlYXNpZXIsIHN1Y2ggYXMgcmVwbGFjaW5nIGEKICAgIHNpbXBsZSBwcm9wZXJ0eSB3aXRo
IGEgY29tcHV0ZWQgcHJvcGVydHksIG9yIHZpY2UgdmVyc2EuCgogICAgIyMjIENvbXB1dGVkIFBy
b3BlcnRpZXMKCiAgICBDb21wdXRlZCBwcm9wZXJ0aWVzIGFyZSBtZXRob2RzIGRlZmluZWQgd2l0
aCB0aGUgYHByb3BlcnR5YCBtb2RpZmllcgogICAgZGVjbGFyZWQgYXQgdGhlIGVuZCwgc3VjaCBh
czoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBmdWxsTmFtZTogZnVuY3Rpb24oKSB7CiAgICAgIHJl
dHVybiB0aGlzLmdldCgnZmlyc3ROYW1lJykgKyAnICcgKyB0aGlzLmdldCgnbGFzdE5hbWUnKTsK
ICAgIH0ucHJvcGVydHkoJ2ZpcnN0TmFtZScsICdsYXN0TmFtZScpCiAgICBgYGAKCiAgICBXaGVu
IHlvdSBjYWxsIGBnZXRgIG9uIGEgY29tcHV0ZWQgcHJvcGVydHksIHRoZSBmdW5jdGlvbiB3aWxs
IGJlCiAgICBjYWxsZWQgYW5kIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBpbnN0
ZWFkIG9mIHRoZSBmdW5jdGlvbgogICAgaXRzZWxmLgoKICAgICMjIyBVbmtub3duIFByb3BlcnRp
ZXMKCiAgICBMaWtld2lzZSwgaWYgeW91IHRyeSB0byBjYWxsIGBnZXRgIG9uIGEgcHJvcGVydHkg
d2hvc2UgdmFsdWUgaXMKICAgIGB1bmRlZmluZWRgLCB0aGUgYHVua25vd25Qcm9wZXJ0eSgpYCBt
ZXRob2Qgd2lsbCBiZSBjYWxsZWQgb24gdGhlIG9iamVjdC4KICAgIElmIHRoaXMgbWV0aG9kIHJl
dHVybnMgYW55IHZhbHVlIG90aGVyIHRoYW4gYHVuZGVmaW5lZGAsIGl0IHdpbGwgYmUgcmV0dXJu
ZWQKICAgIGluc3RlYWQuIFRoaXMgYWxsb3dzIHlvdSB0byBpbXBsZW1lbnQgInZpcnR1YWwiIHBy
b3BlcnRpZXMgdGhhdCBhcmUKICAgIG5vdCBkZWZpbmVkIHVwZnJvbnQuCgogICAgQG1ldGhvZCBn
ZXQKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXlOYW1lIFRoZSBwcm9wZXJ0eSB0byByZXRyaWV2ZQog
ICAgQHJldHVybiB7T2JqZWN0fSBUaGUgcHJvcGVydHkgdmFsdWUgb3IgdW5kZWZpbmVkLgogICov
CiAgZ2V0OiBmdW5jdGlvbihrZXlOYW1lKSB7CiAgICByZXR1cm4gZ2V0KHRoaXMsIGtleU5hbWUp
OwogIH0sCgogIC8qKgogICAgVG8gZ2V0IG11bHRpcGxlIHByb3BlcnRpZXMgYXQgb25jZSwgY2Fs
bCBgZ2V0UHJvcGVydGllc2AKICAgIHdpdGggYSBsaXN0IG9mIHN0cmluZ3Mgb3IgYW4gYXJyYXk6
CgogICAgYGBgamF2YXNjcmlwdAogICAgcmVjb3JkLmdldFByb3BlcnRpZXMoJ2ZpcnN0TmFtZScs
ICdsYXN0TmFtZScsICd6aXBDb2RlJyk7ICAvLyB7IGZpcnN0TmFtZTogJ0pvaG4nLCBsYXN0TmFt
ZTogJ0RvZScsIHppcENvZGU6ICcxMDAxMScgfQogICAgYGBgCgogICAgaXMgZXF1aXZhbGVudCB0
bzoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICByZWNvcmQuZ2V0UHJvcGVydGllcyhbJ2ZpcnN0TmFt
ZScsICdsYXN0TmFtZScsICd6aXBDb2RlJ10pOyAgLy8geyBmaXJzdE5hbWU6ICdKb2huJywgbGFz
dE5hbWU6ICdEb2UnLCB6aXBDb2RlOiAnMTAwMTEnIH0KICAgIGBgYAoKICAgIEBtZXRob2QgZ2V0
UHJvcGVydGllcwogICAgQHBhcmFtIHtTdHJpbmcuLi58QXJyYXl9IGxpc3Qgb2Yga2V5cyB0byBn
ZXQKICAgIEByZXR1cm4ge0hhc2h9CiAgKi8KICBnZXRQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsK
ICAgIHJldHVybiBnZXRQcm9wZXJ0aWVzLmFwcGx5KG51bGwsIFt0aGlzXS5jb25jYXQoc2xpY2Uu
Y2FsbChhcmd1bWVudHMpKSk7CiAgfSwKCiAgLyoqCiAgICBTZXRzIHRoZSBwcm92aWRlZCBrZXkg
b3IgcGF0aCB0byB0aGUgdmFsdWUuCgogICAgVGhpcyBtZXRob2QgaXMgZ2VuZXJhbGx5IHZlcnkg
c2ltaWxhciB0byBjYWxsaW5nIGBvYmplY3Rba2V5XSA9IHZhbHVlYCBvcgogICAgYG9iamVjdC5r
ZXkgPSB2YWx1ZWAsIGV4Y2VwdCB0aGF0IGl0IHByb3ZpZGVzIHN1cHBvcnQgZm9yIGNvbXB1dGVk
CiAgICBwcm9wZXJ0aWVzLCB0aGUgYHNldFVua25vd25Qcm9wZXJ0eSgpYCBtZXRob2QgYW5kIHBy
b3BlcnR5IG9ic2VydmVycy4KCiAgICAjIyMgQ29tcHV0ZWQgUHJvcGVydGllcwoKICAgIElmIHlv
dSB0cnkgdG8gc2V0IGEgdmFsdWUgb24gYSBrZXkgdGhhdCBoYXMgYSBjb21wdXRlZCBwcm9wZXJ0
eSBoYW5kbGVyCiAgICBkZWZpbmVkIChzZWUgdGhlIGBnZXQoKWAgbWV0aG9kIGZvciBhbiBleGFt
cGxlKSwgdGhlbiBgc2V0KClgIHdpbGwgY2FsbAogICAgdGhhdCBtZXRob2QsIHBhc3NpbmcgYm90
aCB0aGUgdmFsdWUgYW5kIGtleSBpbnN0ZWFkIG9mIHNpbXBseSBjaGFuZ2luZwogICAgdGhlIHZh
bHVlIGl0c2VsZi4gVGhpcyBpcyB1c2VmdWwgZm9yIHRob3NlIHRpbWVzIHdoZW4geW91IG5lZWQg
dG8KICAgIGltcGxlbWVudCBhIHByb3BlcnR5IHRoYXQgaXMgY29tcG9zZWQgb2Ygb25lIG9yIG1v
cmUgbWVtYmVyCiAgICBwcm9wZXJ0aWVzLgoKICAgICMjIyBVbmtub3duIFByb3BlcnRpZXMKCiAg
ICBJZiB5b3UgdHJ5IHRvIHNldCBhIHZhbHVlIG9uIGEga2V5IHRoYXQgaXMgdW5kZWZpbmVkIGlu
IHRoZSB0YXJnZXQKICAgIG9iamVjdCwgdGhlbiB0aGUgYHNldFVua25vd25Qcm9wZXJ0eSgpYCBo
YW5kbGVyIHdpbGwgYmUgY2FsbGVkIGluc3RlYWQuIFRoaXMKICAgIGdpdmVzIHlvdSBhbiBvcHBv
cnR1bml0eSB0byBpbXBsZW1lbnQgY29tcGxleCAidmlydHVhbCIgcHJvcGVydGllcyB0aGF0CiAg
ICBhcmUgbm90IHByZWRlZmluZWQgb24gdGhlIG9iamVjdC4gSWYgYHNldFVua25vd25Qcm9wZXJ0
eSgpYCByZXR1cm5zCiAgICB1bmRlZmluZWQsIHRoZW4gYHNldCgpYCB3aWxsIHNpbXBseSBzZXQg
dGhlIHZhbHVlIG9uIHRoZSBvYmplY3QuCgogICAgIyMjIFByb3BlcnR5IE9ic2VydmVycwoKICAg
IEluIGFkZGl0aW9uIHRvIGNoYW5naW5nIHRoZSBwcm9wZXJ0eSwgYHNldCgpYCB3aWxsIGFsc28g
cmVnaXN0ZXIgYSBwcm9wZXJ0eQogICAgY2hhbmdlIHdpdGggdGhlIG9iamVjdC4gVW5sZXNzIHlv
dSBoYXZlIHBsYWNlZCB0aGlzIGNhbGwgaW5zaWRlIG9mIGEKICAgIGBiZWdpblByb3BlcnR5Q2hh
bmdlcygpYCBhbmQgYGVuZFByb3BlcnR5Q2hhbmdlcygpLGAgYW55ICJsb2NhbCIgb2JzZXJ2ZXJz
CiAgICAoaS5lLiBvYnNlcnZlciBtZXRob2RzIGRlY2xhcmVkIG9uIHRoZSBzYW1lIG9iamVjdCks
IHdpbGwgYmUgY2FsbGVkCiAgICBpbW1lZGlhdGVseS4gQW55ICJyZW1vdGUiIG9ic2VydmVycyAo
aS5lLiBvYnNlcnZlciBtZXRob2RzIGRlY2xhcmVkIG9uCiAgICBhbm90aGVyIG9iamVjdCkgd2ls
bCBiZSBwbGFjZWQgaW4gYSBxdWV1ZSBhbmQgY2FsbGVkIGF0IGEgbGF0ZXIgdGltZSBpbiBhCiAg
ICBjb2FsZXNjZWQgbWFubmVyLgoKICAgICMjIyBDaGFpbmluZwoKICAgIEluIGFkZGl0aW9uIHRv
IHByb3BlcnR5IGNoYW5nZXMsIGBzZXQoKWAgcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG9iamVj
dAogICAgaXRzZWxmIHNvIHlvdSBjYW4gZG8gY2hhaW5pbmcgbGlrZSB0aGlzOgoKICAgIGBgYGph
dmFzY3JpcHQKICAgIHJlY29yZC5zZXQoJ2ZpcnN0TmFtZScsICdDaGFybGVzJykuc2V0KCdsYXN0
TmFtZScsICdKb2xsZXknKTsKICAgIGBgYAoKICAgIEBtZXRob2Qgc2V0CiAgICBAcGFyYW0ge1N0
cmluZ30ga2V5TmFtZSBUaGUgcHJvcGVydHkgdG8gc2V0CiAgICBAcGFyYW0ge09iamVjdH0gdmFs
dWUgVGhlIHZhbHVlIHRvIHNldCBvciBgbnVsbGAuCiAgICBAcmV0dXJuIHtFbWJlci5PYnNlcnZh
YmxlfQogICovCiAgc2V0OiBmdW5jdGlvbihrZXlOYW1lLCB2YWx1ZSkgewogICAgc2V0KHRoaXMs
IGtleU5hbWUsIHZhbHVlKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgoKICAvKioKICAgIFNldHMg
YSBsaXN0IG9mIHByb3BlcnRpZXMgYXQgb25jZS4gVGhlc2UgcHJvcGVydGllcyBhcmUgc2V0IGlu
c2lkZQogICAgYSBzaW5nbGUgYGJlZ2luUHJvcGVydHlDaGFuZ2VzYCBhbmQgYGVuZFByb3BlcnR5
Q2hhbmdlc2AgYmF0Y2gsIHNvCiAgICBvYnNlcnZlcnMgd2lsbCBiZSBidWZmZXJlZC4KCiAgICBg
YGBqYXZhc2NyaXB0CiAgICByZWNvcmQuc2V0UHJvcGVydGllcyh7IGZpcnN0TmFtZTogJ0NoYXJs
ZXMnLCBsYXN0TmFtZTogJ0pvbGxleScgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIHNldFByb3Bl
cnRpZXMKICAgIEBwYXJhbSB7SGFzaH0gaGFzaCB0aGUgaGFzaCBvZiBrZXlzIGFuZCB2YWx1ZXMg
dG8gc2V0CiAgICBAcmV0dXJuIHtFbWJlci5PYnNlcnZhYmxlfQogICovCiAgc2V0UHJvcGVydGll
czogZnVuY3Rpb24oaGFzaCkgewogICAgcmV0dXJuIEVtYmVyLnNldFByb3BlcnRpZXModGhpcywg
aGFzaCk7CiAgfSwKCiAgLyoqCiAgICBCZWdpbnMgYSBncm91cGluZyBvZiBwcm9wZXJ0eSBjaGFu
Z2VzLgoKICAgIFlvdSBjYW4gdXNlIHRoaXMgbWV0aG9kIHRvIGdyb3VwIHByb3BlcnR5IGNoYW5n
ZXMgc28gdGhhdCBub3RpZmljYXRpb25zCiAgICB3aWxsIG5vdCBiZSBzZW50IHVudGlsIHRoZSBj
aGFuZ2VzIGFyZSBmaW5pc2hlZC4gSWYgeW91IHBsYW4gdG8gbWFrZSBhCiAgICBsYXJnZSBudW1i
ZXIgb2YgY2hhbmdlcyB0byBhbiBvYmplY3QgYXQgb25lIHRpbWUsIHlvdSBzaG91bGQgY2FsbCB0
aGlzCiAgICBtZXRob2QgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgY2hhbmdlcyB0byBiZWdpbiBk
ZWZlcnJpbmcgY2hhbmdlCiAgICBub3RpZmljYXRpb25zLiBXaGVuIHlvdSBhcmUgZG9uZSBtYWtp
bmcgY2hhbmdlcywgY2FsbAogICAgYGVuZFByb3BlcnR5Q2hhbmdlcygpYCB0byBkZWxpdmVyIHRo
ZSBkZWZlcnJlZCBjaGFuZ2Ugbm90aWZpY2F0aW9ucyBhbmQgZW5kCiAgICBkZWZlcnJpbmcuCgog
ICAgQG1ldGhvZCBiZWdpblByb3BlcnR5Q2hhbmdlcwogICAgQHJldHVybiB7RW1iZXIuT2JzZXJ2
YWJsZX0KICAqLwogIGJlZ2luUHJvcGVydHlDaGFuZ2VzOiBmdW5jdGlvbigpIHsKICAgIEVtYmVy
LmJlZ2luUHJvcGVydHlDaGFuZ2VzKCk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAg
IEVuZHMgYSBncm91cGluZyBvZiBwcm9wZXJ0eSBjaGFuZ2VzLgoKICAgIFlvdSBjYW4gdXNlIHRo
aXMgbWV0aG9kIHRvIGdyb3VwIHByb3BlcnR5IGNoYW5nZXMgc28gdGhhdCBub3RpZmljYXRpb25z
CiAgICB3aWxsIG5vdCBiZSBzZW50IHVudGlsIHRoZSBjaGFuZ2VzIGFyZSBmaW5pc2hlZC4gSWYg
eW91IHBsYW4gdG8gbWFrZSBhCiAgICBsYXJnZSBudW1iZXIgb2YgY2hhbmdlcyB0byBhbiBvYmpl
Y3QgYXQgb25lIHRpbWUsIHlvdSBzaG91bGQgY2FsbAogICAgYGJlZ2luUHJvcGVydHlDaGFuZ2Vz
KClgIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNoYW5nZXMgdG8gZGVmZXIgY2hhbmdlCiAgICBu
b3RpZmljYXRpb25zLiBXaGVuIHlvdSBhcmUgZG9uZSBtYWtpbmcgY2hhbmdlcywgY2FsbCB0aGlz
IG1ldGhvZCB0bwogICAgZGVsaXZlciB0aGUgZGVmZXJyZWQgY2hhbmdlIG5vdGlmaWNhdGlvbnMg
YW5kIGVuZCBkZWZlcnJpbmcuCgogICAgQG1ldGhvZCBlbmRQcm9wZXJ0eUNoYW5nZXMKICAgIEBy
ZXR1cm4ge0VtYmVyLk9ic2VydmFibGV9CiAgKi8KICBlbmRQcm9wZXJ0eUNoYW5nZXM6IGZ1bmN0
aW9uKCkgewogICAgRW1iZXIuZW5kUHJvcGVydHlDaGFuZ2VzKCk7CiAgICByZXR1cm4gdGhpczsK
ICB9LAoKICAvKioKICAgIE5vdGlmeSB0aGUgb2JzZXJ2ZXIgc3lzdGVtIHRoYXQgYSBwcm9wZXJ0
eSBpcyBhYm91dCB0byBjaGFuZ2UuCgogICAgU29tZXRpbWVzIHlvdSBuZWVkIHRvIGNoYW5nZSBh
IHZhbHVlIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkgd2l0aG91dAogICAgYWN0dWFsbHkgY2FsbGlu
ZyBgZ2V0KClgIG9yIGBzZXQoKWAgb24gaXQuIEluIHRoaXMgY2FzZSwgeW91IGNhbiB1c2UgdGhp
cwogICAgbWV0aG9kIGFuZCBgcHJvcGVydHlEaWRDaGFuZ2UoKWAgaW5zdGVhZC4gQ2FsbGluZyB0
aGVzZSB0d28gbWV0aG9kcwogICAgdG9nZXRoZXIgd2lsbCBub3RpZnkgYWxsIG9ic2VydmVycyB0
aGF0IHRoZSBwcm9wZXJ0eSBoYXMgcG90ZW50aWFsbHkKICAgIGNoYW5nZWQgdmFsdWUuCgogICAg
Tm90ZSB0aGF0IHlvdSBtdXN0IGFsd2F5cyBjYWxsIGBwcm9wZXJ0eVdpbGxDaGFuZ2VgIGFuZCBg
cHJvcGVydHlEaWRDaGFuZ2VgCiAgICBhcyBhIHBhaXIuIElmIHlvdSBkbyBub3QsIGl0IG1heSBn
ZXQgdGhlIHByb3BlcnR5IGNoYW5nZSBncm91cHMgb3V0IG9mCiAgICBvcmRlciBhbmQgY2F1c2Ug
bm90aWZpY2F0aW9ucyB0byBiZSBkZWxpdmVyZWQgbW9yZSBvZnRlbiB0aGFuIHlvdSB3b3VsZAog
ICAgbGlrZS4KCiAgICBAbWV0aG9kIHByb3BlcnR5V2lsbENoYW5nZQogICAgQHBhcmFtIHtTdHJp
bmd9IGtleU5hbWUgVGhlIHByb3BlcnR5IGtleSB0aGF0IGlzIGFib3V0IHRvIGNoYW5nZS4KICAg
IEByZXR1cm4ge0VtYmVyLk9ic2VydmFibGV9CiAgKi8KICBwcm9wZXJ0eVdpbGxDaGFuZ2U6IGZ1
bmN0aW9uKGtleU5hbWUpIHsKICAgIEVtYmVyLnByb3BlcnR5V2lsbENoYW5nZSh0aGlzLCBrZXlO
YW1lKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgTm90aWZ5IHRoZSBvYnNlcnZl
ciBzeXN0ZW0gdGhhdCBhIHByb3BlcnR5IGhhcyBqdXN0IGNoYW5nZWQuCgogICAgU29tZXRpbWVz
IHlvdSBuZWVkIHRvIGNoYW5nZSBhIHZhbHVlIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkgd2l0aG91
dAogICAgYWN0dWFsbHkgY2FsbGluZyBgZ2V0KClgIG9yIGBzZXQoKWAgb24gaXQuIEluIHRoaXMg
Y2FzZSwgeW91IGNhbiB1c2UgdGhpcwogICAgbWV0aG9kIGFuZCBgcHJvcGVydHlXaWxsQ2hhbmdl
KClgIGluc3RlYWQuIENhbGxpbmcgdGhlc2UgdHdvIG1ldGhvZHMKICAgIHRvZ2V0aGVyIHdpbGwg
bm90aWZ5IGFsbCBvYnNlcnZlcnMgdGhhdCB0aGUgcHJvcGVydHkgaGFzIHBvdGVudGlhbGx5CiAg
ICBjaGFuZ2VkIHZhbHVlLgoKICAgIE5vdGUgdGhhdCB5b3UgbXVzdCBhbHdheXMgY2FsbCBgcHJv
cGVydHlXaWxsQ2hhbmdlYCBhbmQgYHByb3BlcnR5RGlkQ2hhbmdlYAogICAgYXMgYSBwYWlyLiBJ
ZiB5b3UgZG8gbm90LCBpdCBtYXkgZ2V0IHRoZSBwcm9wZXJ0eSBjaGFuZ2UgZ3JvdXBzIG91dCBv
ZgogICAgb3JkZXIgYW5kIGNhdXNlIG5vdGlmaWNhdGlvbnMgdG8gYmUgZGVsaXZlcmVkIG1vcmUg
b2Z0ZW4gdGhhbiB5b3Ugd291bGQKICAgIGxpa2UuCgogICAgQG1ldGhvZCBwcm9wZXJ0eURpZENo
YW5nZQogICAgQHBhcmFtIHtTdHJpbmd9IGtleU5hbWUgVGhlIHByb3BlcnR5IGtleSB0aGF0IGhh
cyBqdXN0IGNoYW5nZWQuCiAgICBAcmV0dXJuIHtFbWJlci5PYnNlcnZhYmxlfQogICovCiAgcHJv
cGVydHlEaWRDaGFuZ2U6IGZ1bmN0aW9uKGtleU5hbWUpIHsKICAgIEVtYmVyLnByb3BlcnR5RGlk
Q2hhbmdlKHRoaXMsIGtleU5hbWUpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBD
b252ZW5pZW5jZSBtZXRob2QgdG8gY2FsbCBgcHJvcGVydHlXaWxsQ2hhbmdlYCBhbmQgYHByb3Bl
cnR5RGlkQ2hhbmdlYCBpbgogICAgc3VjY2Vzc2lvbi4KCiAgICBAbWV0aG9kIG5vdGlmeVByb3Bl
cnR5Q2hhbmdlCiAgICBAcGFyYW0ge1N0cmluZ30ga2V5TmFtZSBUaGUgcHJvcGVydHkga2V5IHRv
IGJlIG5vdGlmaWVkIGFib3V0LgogICAgQHJldHVybiB7RW1iZXIuT2JzZXJ2YWJsZX0KICAqLwog
IG5vdGlmeVByb3BlcnR5Q2hhbmdlOiBmdW5jdGlvbihrZXlOYW1lKSB7CiAgICB0aGlzLnByb3Bl
cnR5V2lsbENoYW5nZShrZXlOYW1lKTsKICAgIHRoaXMucHJvcGVydHlEaWRDaGFuZ2Uoa2V5TmFt
ZSk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICBhZGRCZWZvcmVPYnNlcnZlcjogZnVuY3Rpb24o
a2V5LCB0YXJnZXQsIG1ldGhvZCkgewogICAgRW1iZXIuYWRkQmVmb3JlT2JzZXJ2ZXIodGhpcywg
a2V5LCB0YXJnZXQsIG1ldGhvZCk7CiAgfSwKCiAgLyoqCiAgICBBZGRzIGFuIG9ic2VydmVyIG9u
IGEgcHJvcGVydHkuCgogICAgVGhpcyBpcyB0aGUgY29yZSBtZXRob2QgdXNlZCB0byByZWdpc3Rl
ciBhbiBvYnNlcnZlciBmb3IgYSBwcm9wZXJ0eS4KCiAgICBPbmNlIHlvdSBjYWxsIHRoaXMgbWV0
aG9kLCBhbnkgdGltZSB0aGUga2V5J3MgdmFsdWUgaXMgc2V0LCB5b3VyIG9ic2VydmVyCiAgICB3
aWxsIGJlIG5vdGlmaWVkLiBOb3RlIHRoYXQgdGhlIG9ic2VydmVycyBhcmUgdHJpZ2dlcmVkIGFu
eSB0aW1lIHRoZQogICAgdmFsdWUgaXMgc2V0LCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgaXQgaGFz
IGFjdHVhbGx5IGNoYW5nZWQuIFlvdXIKICAgIG9ic2VydmVyIHNob3VsZCBiZSBwcmVwYXJlZCB0
byBoYW5kbGUgdGhhdC4KCiAgICBZb3UgY2FuIGFsc28gcGFzcyBhbiBvcHRpb25hbCBjb250ZXh0
IHBhcmFtZXRlciB0byB0aGlzIG1ldGhvZC4gVGhlCiAgICBjb250ZXh0IHdpbGwgYmUgcGFzc2Vk
IHRvIHlvdXIgb2JzZXJ2ZXIgbWV0aG9kIHdoZW5ldmVyIGl0IGlzIHRyaWdnZXJlZC4KICAgIE5v
dGUgdGhhdCBpZiB5b3UgYWRkIHRoZSBzYW1lIHRhcmdldC9tZXRob2QgcGFpciBvbiBhIGtleSBt
dWx0aXBsZSB0aW1lcwogICAgd2l0aCBkaWZmZXJlbnQgY29udGV4dCBwYXJhbWV0ZXJzLCB5b3Vy
IG9ic2VydmVyIHdpbGwgb25seSBiZSBjYWxsZWQgb25jZQogICAgd2l0aCB0aGUgbGFzdCBjb250
ZXh0IHlvdSBwYXNzZWQuCgogICAgIyMjIE9ic2VydmVyIE1ldGhvZHMKCiAgICBPYnNlcnZlciBt
ZXRob2RzIHlvdSBwYXNzIHNob3VsZCBnZW5lcmFsbHkgaGF2ZSB0aGUgZm9sbG93aW5nIHNpZ25h
dHVyZSBpZgogICAgeW91IGRvIG5vdCBwYXNzIGEgYGNvbnRleHRgIHBhcmFtZXRlcjoKCiAgICBg
YGBqYXZhc2NyaXB0CiAgICBmb29EaWRDaGFuZ2U6IGZ1bmN0aW9uKHNlbmRlciwga2V5LCB2YWx1
ZSwgcmV2KSB7IH07CiAgICBgYGAKCiAgICBUaGUgc2VuZGVyIGlzIHRoZSBvYmplY3QgdGhhdCBj
aGFuZ2VkLiBUaGUga2V5IGlzIHRoZSBwcm9wZXJ0eSB0aGF0CiAgICBjaGFuZ2VzLiBUaGUgdmFs
dWUgcHJvcGVydHkgaXMgY3VycmVudGx5IHJlc2VydmVkIGFuZCB1bnVzZWQuIFRoZSByZXYKICAg
IGlzIHRoZSBsYXN0IHByb3BlcnR5IHJldmlzaW9uIG9mIHRoZSBvYmplY3Qgd2hlbiBpdCBjaGFu
Z2VkLCB3aGljaCB5b3UgY2FuCiAgICB1c2UgdG8gZGV0ZWN0IGlmIHRoZSBrZXkgdmFsdWUgaGFz
IHJlYWxseSBjaGFuZ2VkIG9yIG5vdC4KCiAgICBJZiB5b3UgcGFzcyBhIGBjb250ZXh0YCBwYXJh
bWV0ZXIsIHRoZSBjb250ZXh0IHdpbGwgYmUgcGFzc2VkIGJlZm9yZSB0aGUKICAgIHJldmlzaW9u
IGxpa2Ugc286CgogICAgYGBgamF2YXNjcmlwdAogICAgZm9vRGlkQ2hhbmdlOiBmdW5jdGlvbihz
ZW5kZXIsIGtleSwgdmFsdWUsIGNvbnRleHQsIHJldikgeyB9OwogICAgYGBgCgogICAgVXN1YWxs
eSB5b3Ugd2lsbCBub3QgbmVlZCB0aGUgdmFsdWUsIGNvbnRleHQgb3IgcmV2aXNpb24gcGFyYW1l
dGVycyBhdAogICAgdGhlIGVuZC4gSW4gdGhpcyBjYXNlLCBpdCBpcyBjb21tb24gdG8gd3JpdGUg
b2JzZXJ2ZXIgbWV0aG9kcyB0aGF0IHRha2UKICAgIG9ubHkgYSBzZW5kZXIgYW5kIGtleSB2YWx1
ZSBhcyBwYXJhbWV0ZXJzIG9yLCBpZiB5b3UgYXJlbid0IGludGVyZXN0ZWQgaW4KICAgIGFueSBv
ZiB0aGVzZSB2YWx1ZXMsIHRvIHdyaXRlIGFuIG9ic2VydmVyIHRoYXQgaGFzIG5vIHBhcmFtZXRl
cnMgYXQgYWxsLgoKICAgIEBtZXRob2QgYWRkT2JzZXJ2ZXIKICAgIEBwYXJhbSB7U3RyaW5nfSBr
ZXkgVGhlIGtleSB0byBvYnNlcnZlcgogICAgQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgdGFy
Z2V0IG9iamVjdCB0byBpbnZva2UKICAgIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBtZXRob2Qg
VGhlIG1ldGhvZCB0byBpbnZva2UuCiAgICBAcmV0dXJuIHtFbWJlci5PYmplY3R9IHNlbGYKICAq
LwogIGFkZE9ic2VydmVyOiBmdW5jdGlvbihrZXksIHRhcmdldCwgbWV0aG9kKSB7CiAgICBFbWJl
ci5hZGRPYnNlcnZlcih0aGlzLCBrZXksIHRhcmdldCwgbWV0aG9kKTsKICB9LAoKICAvKioKICAg
IFJlbW92ZSBhbiBvYnNlcnZlciB5b3UgaGF2ZSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgb24gdGhp
cyBvYmplY3QuIFBhc3MKICAgIHRoZSBzYW1lIGtleSwgdGFyZ2V0LCBhbmQgbWV0aG9kIHlvdSBw
YXNzZWQgdG8gYGFkZE9ic2VydmVyKClgIGFuZCB5b3VyCiAgICB0YXJnZXQgd2lsbCBubyBsb25n
ZXIgcmVjZWl2ZSBub3RpZmljYXRpb25zLgoKICAgIEBtZXRob2QgcmVtb3ZlT2JzZXJ2ZXIKICAg
IEBwYXJhbSB7U3RyaW5nfSBrZXkgVGhlIGtleSB0byBvYnNlcnZlcgogICAgQHBhcmFtIHtPYmpl
Y3R9IHRhcmdldCBUaGUgdGFyZ2V0IG9iamVjdCB0byBpbnZva2UKICAgIEBwYXJhbSB7U3RyaW5n
fEZ1bmN0aW9ufSBtZXRob2QgVGhlIG1ldGhvZCB0byBpbnZva2UuCiAgICBAcmV0dXJuIHtFbWJl
ci5PYnNlcnZhYmxlfSByZWNlaXZlcgogICovCiAgcmVtb3ZlT2JzZXJ2ZXI6IGZ1bmN0aW9uKGtl
eSwgdGFyZ2V0LCBtZXRob2QpIHsKICAgIEVtYmVyLnJlbW92ZU9ic2VydmVyKHRoaXMsIGtleSwg
dGFyZ2V0LCBtZXRob2QpOwogIH0sCgogIC8qKgogICAgUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9i
amVjdCBjdXJyZW50bHkgaGFzIG9ic2VydmVycyByZWdpc3RlcmVkIGZvciBhCiAgICBwYXJ0aWN1
bGFyIGtleS4gWW91IGNhbiB1c2UgdGhpcyBtZXRob2QgdG8gcG90ZW50aWFsbHkgZGVmZXIgcGVy
Zm9ybWluZwogICAgYW4gZXhwZW5zaXZlIGFjdGlvbiB1bnRpbCBzb21lb25lIGJlZ2lucyBvYnNl
cnZpbmcgYSBwYXJ0aWN1bGFyIHByb3BlcnR5CiAgICBvbiB0aGUgb2JqZWN0LgoKICAgIEBtZXRo
b2QgaGFzT2JzZXJ2ZXJGb3IKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgS2V5IHRvIGNoZWNrCiAg
ICBAcmV0dXJuIHtCb29sZWFufQogICovCiAgaGFzT2JzZXJ2ZXJGb3I6IGZ1bmN0aW9uKGtleSkg
ewogICAgcmV0dXJuIEVtYmVyLmhhc0xpc3RlbmVycyh0aGlzLCBrZXkrJzpjaGFuZ2UnKTsKICB9
LAoKICAvKioKICAgIFJldHJpZXZlcyB0aGUgdmFsdWUgb2YgYSBwcm9wZXJ0eSwgb3IgYSBkZWZh
dWx0IHZhbHVlIGluIHRoZSBjYXNlIHRoYXQgdGhlCiAgICBwcm9wZXJ0eSByZXR1cm5zIGB1bmRl
ZmluZWRgLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHBlcnNvbi5nZXRXaXRoRGVmYXVsdCgnbGFz
dE5hbWUnLCAnRG9lJyk7CiAgICBgYGAKCiAgICBAbWV0aG9kIGdldFdpdGhEZWZhdWx0CiAgICBA
cGFyYW0ge1N0cmluZ30ga2V5TmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgdG8gcmV0cmll
dmUKICAgIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0VmFsdWUgVGhlIHZhbHVlIHRvIHJldHVybiBp
ZiB0aGUgcHJvcGVydHkgdmFsdWUgaXMgdW5kZWZpbmVkCiAgICBAcmV0dXJuIHtPYmplY3R9IFRo
ZSBwcm9wZXJ0eSB2YWx1ZSBvciB0aGUgZGVmYXVsdFZhbHVlLgogICovCiAgZ2V0V2l0aERlZmF1
bHQ6IGZ1bmN0aW9uKGtleU5hbWUsIGRlZmF1bHRWYWx1ZSkgewogICAgcmV0dXJuIEVtYmVyLmdl
dFdpdGhEZWZhdWx0KHRoaXMsIGtleU5hbWUsIGRlZmF1bHRWYWx1ZSk7CiAgfSwKCiAgLyoqCiAg
ICBTZXQgdGhlIHZhbHVlIG9mIGEgcHJvcGVydHkgdG8gdGhlIGN1cnJlbnQgdmFsdWUgcGx1cyBz
b21lIGFtb3VudC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBwZXJzb24uaW5jcmVtZW50UHJvcGVy
dHkoJ2FnZScpOwogICAgdGVhbS5pbmNyZW1lbnRQcm9wZXJ0eSgnc2NvcmUnLCAyKTsKICAgIGBg
YAoKICAgIEBtZXRob2QgaW5jcmVtZW50UHJvcGVydHkKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXlO
YW1lIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB0byBpbmNyZW1lbnQKICAgIEBwYXJhbSB7TnVt
YmVyfSBpbmNyZW1lbnQgVGhlIGFtb3VudCB0byBpbmNyZW1lbnQgYnkuIERlZmF1bHRzIHRvIDEK
ICAgIEByZXR1cm4ge051bWJlcn0gVGhlIG5ldyBwcm9wZXJ0eSB2YWx1ZQogICovCiAgaW5jcmVt
ZW50UHJvcGVydHk6IGZ1bmN0aW9uKGtleU5hbWUsIGluY3JlbWVudCkgewogICAgaWYgKEVtYmVy
LmlzTm9uZShpbmNyZW1lbnQpKSB7IGluY3JlbWVudCA9IDE7IH0KICAgIEVtYmVyLmFzc2VydCgi
TXVzdCBwYXNzIGEgbnVtZXJpYyB2YWx1ZSB0byBpbmNyZW1lbnRQcm9wZXJ0eSIsICghaXNOYU4o
cGFyc2VGbG9hdChpbmNyZW1lbnQpKSAmJiBpc0Zpbml0ZShpbmNyZW1lbnQpKSk7CiAgICBzZXQo
dGhpcywga2V5TmFtZSwgKGdldCh0aGlzLCBrZXlOYW1lKSB8fCAwKSArIGluY3JlbWVudCk7CiAg
ICByZXR1cm4gZ2V0KHRoaXMsIGtleU5hbWUpOwogIH0sCgogIC8qKgogICAgU2V0IHRoZSB2YWx1
ZSBvZiBhIHByb3BlcnR5IHRvIHRoZSBjdXJyZW50IHZhbHVlIG1pbnVzIHNvbWUgYW1vdW50LgoK
ICAgIGBgYGphdmFzY3JpcHQKICAgIHBsYXllci5kZWNyZW1lbnRQcm9wZXJ0eSgnbGl2ZXMnKTsK
ICAgIG9yYy5kZWNyZW1lbnRQcm9wZXJ0eSgnaGVhbHRoJywgNSk7CiAgICBgYGAKCiAgICBAbWV0
aG9kIGRlY3JlbWVudFByb3BlcnR5CiAgICBAcGFyYW0ge1N0cmluZ30ga2V5TmFtZSBUaGUgbmFt
ZSBvZiB0aGUgcHJvcGVydHkgdG8gZGVjcmVtZW50CiAgICBAcGFyYW0ge051bWJlcn0gZGVjcmVt
ZW50IFRoZSBhbW91bnQgdG8gZGVjcmVtZW50IGJ5LiBEZWZhdWx0cyB0byAxCiAgICBAcmV0dXJu
IHtOdW1iZXJ9IFRoZSBuZXcgcHJvcGVydHkgdmFsdWUKICAqLwogIGRlY3JlbWVudFByb3BlcnR5
OiBmdW5jdGlvbihrZXlOYW1lLCBkZWNyZW1lbnQpIHsKICAgIGlmIChFbWJlci5pc05vbmUoZGVj
cmVtZW50KSkgeyBkZWNyZW1lbnQgPSAxOyB9CiAgICBFbWJlci5hc3NlcnQoIk11c3QgcGFzcyBh
IG51bWVyaWMgdmFsdWUgdG8gZGVjcmVtZW50UHJvcGVydHkiLCAoIWlzTmFOKHBhcnNlRmxvYXQo
ZGVjcmVtZW50KSkgJiYgaXNGaW5pdGUoZGVjcmVtZW50KSkpOwogICAgc2V0KHRoaXMsIGtleU5h
bWUsIChnZXQodGhpcywga2V5TmFtZSkgfHwgMCkgLSBkZWNyZW1lbnQpOwogICAgcmV0dXJuIGdl
dCh0aGlzLCBrZXlOYW1lKTsKICB9LAoKICAvKioKICAgIFNldCB0aGUgdmFsdWUgb2YgYSBib29s
ZWFuIHByb3BlcnR5IHRvIHRoZSBvcHBvc2l0ZSBvZiBpdCdzCiAgICBjdXJyZW50IHZhbHVlLgoK
ICAgIGBgYGphdmFzY3JpcHQKICAgIHN0YXJzaGlwLnRvZ2dsZVByb3BlcnR5KCd3YXJwRHJpdmVF
bmdhZ2VkJyk7CiAgICBgYGAKCiAgICBAbWV0aG9kIHRvZ2dsZVByb3BlcnR5CiAgICBAcGFyYW0g
e1N0cmluZ30ga2V5TmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgdG8gdG9nZ2xlCiAgICBA
cmV0dXJuIHtPYmplY3R9IFRoZSBuZXcgcHJvcGVydHkgdmFsdWUKICAqLwogIHRvZ2dsZVByb3Bl
cnR5OiBmdW5jdGlvbihrZXlOYW1lKSB7CiAgICBzZXQodGhpcywga2V5TmFtZSwgIWdldCh0aGlz
LCBrZXlOYW1lKSk7CiAgICByZXR1cm4gZ2V0KHRoaXMsIGtleU5hbWUpOwogIH0sCgogIC8qKgog
ICAgUmV0dXJucyB0aGUgY2FjaGVkIHZhbHVlIG9mIGEgY29tcHV0ZWQgcHJvcGVydHksIGlmIGl0
IGV4aXN0cy4KICAgIFRoaXMgYWxsb3dzIHlvdSB0byBpbnNwZWN0IHRoZSB2YWx1ZSBvZiBhIGNv
bXB1dGVkIHByb3BlcnR5CiAgICB3aXRob3V0IGFjY2lkZW50YWxseSBpbnZva2luZyBpdCBpZiBp
dCBpcyBpbnRlbmRlZCB0byBiZQogICAgZ2VuZXJhdGVkIGxhemlseS4KCiAgICBAbWV0aG9kIGNh
Y2hlRm9yCiAgICBAcGFyYW0ge1N0cmluZ30ga2V5TmFtZQogICAgQHJldHVybiB7T2JqZWN0fSBU
aGUgY2FjaGVkIHZhbHVlIG9mIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSwgaWYgYW55CiAgKi8KICBj
YWNoZUZvcjogZnVuY3Rpb24oa2V5TmFtZSkgewogICAgcmV0dXJuIEVtYmVyLmNhY2hlRm9yKHRo
aXMsIGtleU5hbWUpOwogIH0sCgogIC8vIGludGVuZGVkIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMK
ICBvYnNlcnZlcnNGb3JLZXk6IGZ1bmN0aW9uKGtleU5hbWUpIHsKICAgIHJldHVybiBFbWJlci5v
YnNlcnZlcnNGb3IodGhpcywga2V5TmFtZSk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKLyoqCiAgQG1vZHVsZSBlbWJlcgogIEBzdWJtb2R1bGUgZW1iZXItcnVudGltZQoqLwoKCi8v
IE5PVEU6IHRoaXMgb2JqZWN0IHNob3VsZCBuZXZlciBiZSBpbmNsdWRlZCBkaXJlY3RseS4gSW5z
dGVhZCB1c2UgYEVtYmVyLk9iamVjdGAuCi8vIFdlIG9ubHkgZGVmaW5lIHRoaXMgc2VwYXJhdGVs
eSBzbyB0aGF0IGBFbWJlci5TZXRgIGNhbiBkZXBlbmQgb24gaXQuCgoKdmFyIHNldCA9IEVtYmVy
LnNldCwgZ2V0ID0gRW1iZXIuZ2V0LAogICAgb19jcmVhdGUgPSBFbWJlci5jcmVhdGUsCiAgICBv
X2RlZmluZVByb3BlcnR5ID0gRW1iZXIucGxhdGZvcm0uZGVmaW5lUHJvcGVydHksCiAgICBHVUlE
X0tFWSA9IEVtYmVyLkdVSURfS0VZLAogICAgZ3VpZEZvciA9IEVtYmVyLmd1aWRGb3IsCiAgICBn
ZW5lcmF0ZUd1aWQgPSBFbWJlci5nZW5lcmF0ZUd1aWQsCiAgICBtZXRhID0gRW1iZXIubWV0YSwK
ICAgIHJld2F0Y2ggPSBFbWJlci5yZXdhdGNoLAogICAgZmluaXNoQ2hhaW5zID0gRW1iZXIuZmlu
aXNoQ2hhaW5zLAogICAgc2VuZEV2ZW50ID0gRW1iZXIuc2VuZEV2ZW50LAogICAgZGVzdHJveSA9
IEVtYmVyLmRlc3Ryb3ksCiAgICBzY2hlZHVsZSA9IEVtYmVyLnJ1bi5zY2hlZHVsZSwKICAgIE1p
eGluID0gRW1iZXIuTWl4aW4sCiAgICBhcHBseU1peGluID0gTWl4aW4uX2FwcGx5LAogICAgZmlu
aXNoUGFydGlhbCA9IE1peGluLmZpbmlzaFBhcnRpYWwsCiAgICByZW9wZW4gPSBNaXhpbi5wcm90
b3R5cGUucmVvcGVuLAogICAgTUFOREFUT1JZX1NFVFRFUiA9IEVtYmVyLkVOVi5NQU5EQVRPUllf
U0VUVEVSLAogICAgaW5kZXhPZiA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5pbmRleE9mOwoKdmFy
IHVuZGVmaW5lZERlc2NyaXB0b3IgPSB7CiAgY29uZmlndXJhYmxlOiB0cnVlLAogIHdyaXRhYmxl
OiB0cnVlLAogIGVudW1lcmFibGU6IGZhbHNlLAogIHZhbHVlOiB1bmRlZmluZWQKfTsKCmZ1bmN0
aW9uIG1ha2VDdG9yKCkgewoKICAvLyBOb3RlOiBhdm9pZCBhY2Nlc3NpbmcgYW55IHByb3BlcnRp
ZXMgb24gdGhlIG9iamVjdCBzaW5jZSBpdCBtYWtlcyB0aGUKICAvLyBtZXRob2QgYSBsb3QgZmFz
dGVyLiBUaGlzIGlzIGdsdWUgY29kZSBzbyB3ZSB3YW50IGl0IHRvIGJlIGFzIGZhc3QgYXMKICAv
LyBwb3NzaWJsZS4KCiAgdmFyIHdhc0FwcGxpZWQgPSBmYWxzZSwgaW5pdE1peGlucywgaW5pdFBy
b3BlcnRpZXM7CgogIHZhciBDbGFzcyA9IGZ1bmN0aW9uKCkgewogICAgaWYgKCF3YXNBcHBsaWVk
KSB7CiAgICAgIENsYXNzLnByb3RvKCk7IC8vIHByZXBhcmUgcHJvdG90eXBlLi4uCiAgICB9CiAg
ICBvX2RlZmluZVByb3BlcnR5KHRoaXMsIEdVSURfS0VZLCB1bmRlZmluZWREZXNjcmlwdG9yKTsK
ICAgIG9fZGVmaW5lUHJvcGVydHkodGhpcywgJ19zdXBlcicsIHVuZGVmaW5lZERlc2NyaXB0b3Ip
OwogICAgdmFyIG0gPSBtZXRhKHRoaXMpLCBwcm90byA9IG0ucHJvdG87CiAgICBtLnByb3RvID0g
dGhpczsKICAgIGlmIChpbml0TWl4aW5zKSB7CiAgICAgIC8vIGNhcHR1cmUgbG9jYWxseSBzbyB3
ZSBjYW4gY2xlYXIgdGhlIGNsb3NlZCBvdmVyIHZhcmlhYmxlCiAgICAgIHZhciBtaXhpbnMgPSBp
bml0TWl4aW5zOwogICAgICBpbml0TWl4aW5zID0gbnVsbDsKICAgICAgdGhpcy5yZW9wZW4uYXBw
bHkodGhpcywgbWl4aW5zKTsKICAgIH0KICAgIGlmIChpbml0UHJvcGVydGllcykgewogICAgICAv
LyBjYXB0dXJlIGxvY2FsbHkgc28gd2UgY2FuIGNsZWFyIHRoZSBjbG9zZWQgb3ZlciB2YXJpYWJs
ZQogICAgICB2YXIgcHJvcHMgPSBpbml0UHJvcGVydGllczsKICAgICAgaW5pdFByb3BlcnRpZXMg
PSBudWxsOwoKICAgICAgdmFyIGNvbmNhdGVuYXRlZFByb3BlcnRpZXMgPSB0aGlzLmNvbmNhdGVu
YXRlZFByb3BlcnRpZXM7CgogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHByb3BzLmxlbmd0aDsg
aSA8IGw7IGkrKykgewogICAgICAgIHZhciBwcm9wZXJ0aWVzID0gcHJvcHNbaV07CgogICAgICAg
IEVtYmVyLmFzc2VydCgiRW1iZXIuT2JqZWN0LmNyZWF0ZSBubyBsb25nZXIgc3VwcG9ydHMgbWl4
aW5nIGluIG90aGVyIGRlZmluaXRpb25zLCB1c2UgY3JlYXRlV2l0aE1peGlucyBpbnN0ZWFkLiIs
ICEocHJvcGVydGllcyBpbnN0YW5jZW9mIEVtYmVyLk1peGluKSk7CgogICAgICAgIGlmICh0eXBl
b2YgcHJvcGVydGllcyAhPT0gJ29iamVjdCcgJiYgcHJvcGVydGllcyAhPT0gdW5kZWZpbmVkKSB7
CiAgICAgICAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoIkVtYmVyLk9iamVjdC5jcmVhdGUgb25s
eSBhY2NlcHRzIG9iamVjdHMuIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXByb3BlcnRpZXMp
IHsgY29udGludWU7IH0KCiAgICAgICAgdmFyIGtleU5hbWVzID0gRW1iZXIua2V5cyhwcm9wZXJ0
aWVzKTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxsID0ga2V5TmFtZXMubGVuZ3RoOyBqIDwg
bGw7IGorKykgewogICAgICAgICAgdmFyIGtleU5hbWUgPSBrZXlOYW1lc1tqXTsKICAgICAgICAg
IGlmICghcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShrZXlOYW1lKSkgeyBjb250aW51ZTsgfQoK
ICAgICAgICAgIHZhciB2YWx1ZSA9IHByb3BlcnRpZXNba2V5TmFtZV0sCiAgICAgICAgICAgICAg
SVNfQklORElORyA9IEVtYmVyLklTX0JJTkRJTkc7CgogICAgICAgICAgaWYgKElTX0JJTkRJTkcu
dGVzdChrZXlOYW1lKSkgewogICAgICAgICAgICB2YXIgYmluZGluZ3MgPSBtLmJpbmRpbmdzOwog
ICAgICAgICAgICBpZiAoIWJpbmRpbmdzKSB7CiAgICAgICAgICAgICAgYmluZGluZ3MgPSBtLmJp
bmRpbmdzID0ge307CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIW0uaGFzT3duUHJvcGVydHkoJ2Jp
bmRpbmdzJykpIHsKICAgICAgICAgICAgICBiaW5kaW5ncyA9IG0uYmluZGluZ3MgPSBvX2NyZWF0
ZShtLmJpbmRpbmdzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBiaW5kaW5nc1trZXlOYW1l
XSA9IHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkZXNjID0gbS5kZXNjc1trZXlO
YW1lXTsKCiAgICAgICAgICBFbWJlci5hc3NlcnQoIkVtYmVyLk9iamVjdC5jcmVhdGUgbm8gbG9u
Z2VyIHN1cHBvcnRzIGRlZmluaW5nIGNvbXB1dGVkIHByb3BlcnRpZXMuIiwgISh2YWx1ZSBpbnN0
YW5jZW9mIEVtYmVyLkNvbXB1dGVkUHJvcGVydHkpKTsKICAgICAgICAgIEVtYmVyLmFzc2VydCgi
RW1iZXIuT2JqZWN0LmNyZWF0ZSBubyBsb25nZXIgc3VwcG9ydHMgZGVmaW5pbmcgbWV0aG9kcyB0
aGF0IGNhbGwgX3N1cGVyLiIsICEodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmIHZhbHVl
LnRvU3RyaW5nKCkuaW5kZXhPZignLl9zdXBlcicpICE9PSAtMSkpOwogICAgICAgICAgRW1iZXIu
YXNzZXJ0KCJgYWN0aW9uc2AgbXVzdCBiZSBwcm92aWRlZCBhdCBleHRlbmQgdGltZSwgbm90IGF0
IGNyZWF0ZSAiICsKICAgICAgICAgICAgICAgICAgICAgICAidGltZSwgd2hlbiBFbWJlci5BY3Rp
b25IYW5kbGVyIGlzIHVzZWQgKGkuZS4gdmlld3MsICIgKwogICAgICAgICAgICAgICAgICAgICAg
ICJjb250cm9sbGVycyAmIHJvdXRlcykuIiwgISgoa2V5TmFtZSA9PT0gJ2FjdGlvbnMnKSAmJiBF
bWJlci5BY3Rpb25IYW5kbGVyLmRldGVjdCh0aGlzKSkpOwoKICAgICAgICAgIGlmIChjb25jYXRl
bmF0ZWRQcm9wZXJ0aWVzICYmIGluZGV4T2YoY29uY2F0ZW5hdGVkUHJvcGVydGllcywga2V5TmFt
ZSkgPj0gMCkgewogICAgICAgICAgICB2YXIgYmFzZVZhbHVlID0gdGhpc1trZXlOYW1lXTsKCiAg
ICAgICAgICAgIGlmIChiYXNlVmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoJ2Z1bmN0aW9uJyA9
PT0gdHlwZW9mIGJhc2VWYWx1ZS5jb25jYXQpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gYmFz
ZVZhbHVlLmNvbmNhdCh2YWx1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg
ICAgIHZhbHVlID0gRW1iZXIubWFrZUFycmF5KGJhc2VWYWx1ZSkuY29uY2F0KHZhbHVlKTsKICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBF
bWJlci5tYWtlQXJyYXkodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAg
ICAgaWYgKGRlc2MpIHsKICAgICAgICAgICAgZGVzYy5zZXQodGhpcywga2V5TmFtZSwgdmFsdWUp
OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnNldFVua25v
d25Qcm9wZXJ0eSA9PT0gJ2Z1bmN0aW9uJyAmJiAhKGtleU5hbWUgaW4gdGhpcykpIHsKICAgICAg
ICAgICAgICB0aGlzLnNldFVua25vd25Qcm9wZXJ0eShrZXlOYW1lLCB2YWx1ZSk7CiAgICAgICAg
ICAgIH0gZWxzZSBpZiAoTUFOREFUT1JZX1NFVFRFUikgewogICAgICAgICAgICAgIEVtYmVyLmRl
ZmluZVByb3BlcnR5KHRoaXMsIGtleU5hbWUsIG51bGwsIHZhbHVlKTsgLy8gc2V0dXAgbWFuZGF0
b3J5IHNldHRlcgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXNba2V5TmFt
ZV0gPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQog
ICAgfQogICAgZmluaXNoUGFydGlhbCh0aGlzLCBtKTsKICAgIHRoaXMuaW5pdC5hcHBseSh0aGlz
LCBhcmd1bWVudHMpOwogICAgbS5wcm90byA9IHByb3RvOwogICAgZmluaXNoQ2hhaW5zKHRoaXMp
OwogICAgc2VuZEV2ZW50KHRoaXMsICJpbml0Iik7CiAgfTsKCiAgQ2xhc3MudG9TdHJpbmcgPSBN
aXhpbi5wcm90b3R5cGUudG9TdHJpbmc7CiAgQ2xhc3Mud2lsbFJlb3BlbiA9IGZ1bmN0aW9uKCkg
ewogICAgaWYgKHdhc0FwcGxpZWQpIHsKICAgICAgQ2xhc3MuUHJvdG90eXBlTWl4aW4gPSBNaXhp
bi5jcmVhdGUoQ2xhc3MuUHJvdG90eXBlTWl4aW4pOwogICAgfQoKICAgIHdhc0FwcGxpZWQgPSBm
YWxzZTsKICB9OwogIENsYXNzLl9pbml0TWl4aW5zID0gZnVuY3Rpb24oYXJncykgeyBpbml0TWl4
aW5zID0gYXJnczsgfTsKICBDbGFzcy5faW5pdFByb3BlcnRpZXMgPSBmdW5jdGlvbihhcmdzKSB7
IGluaXRQcm9wZXJ0aWVzID0gYXJnczsgfTsKCiAgQ2xhc3MucHJvdG8gPSBmdW5jdGlvbigpIHsK
ICAgIHZhciBzdXBlcmNsYXNzID0gQ2xhc3Muc3VwZXJjbGFzczsKICAgIGlmIChzdXBlcmNsYXNz
KSB7IHN1cGVyY2xhc3MucHJvdG8oKTsgfQoKICAgIGlmICghd2FzQXBwbGllZCkgewogICAgICB3
YXNBcHBsaWVkID0gdHJ1ZTsKICAgICAgQ2xhc3MuUHJvdG90eXBlTWl4aW4uYXBwbHlQYXJ0aWFs
KENsYXNzLnByb3RvdHlwZSk7CiAgICAgIHJld2F0Y2goQ2xhc3MucHJvdG90eXBlKTsKICAgIH0K
CiAgICByZXR1cm4gdGhpcy5wcm90b3R5cGU7CiAgfTsKCiAgcmV0dXJuIENsYXNzOwoKfQoKLyoq
CiAgQGNsYXNzIENvcmVPYmplY3QKICBAbmFtZXNwYWNlIEVtYmVyCiovCnZhciBDb3JlT2JqZWN0
ID0gbWFrZUN0b3IoKTsKQ29yZU9iamVjdC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4g
IkVtYmVyLkNvcmVPYmplY3QiOyB9OwoKQ29yZU9iamVjdC5Qcm90b3R5cGVNaXhpbiA9IE1peGlu
LmNyZWF0ZSh7CiAgcmVvcGVuOiBmdW5jdGlvbigpIHsKICAgIGFwcGx5TWl4aW4odGhpcywgYXJn
dW1lbnRzLCB0cnVlKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgQW4gb3ZlcnJp
ZGFibGUgbWV0aG9kIGNhbGxlZCB3aGVuIG9iamVjdHMgYXJlIGluc3RhbnRpYXRlZC4gQnkgZGVm
YXVsdCwKICAgIGRvZXMgbm90aGluZyB1bmxlc3MgaXQgaXMgb3ZlcnJpZGRlbiBkdXJpbmcgY2xh
c3MgZGVmaW5pdGlvbi4KCiAgICBFeGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5Q
ZXJzb24gPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAg
ICAgICAgYWxlcnQoJ05hbWUgaXMgJyArIHRoaXMuZ2V0KCduYW1lJykpOwogICAgICB9CiAgICB9
KTsKCiAgICB2YXIgc3RldmUgPSBBcHAuUGVyc29uLmNyZWF0ZSh7CiAgICAgIG5hbWU6ICJTdGV2
ZSIKICAgIH0pOwoKICAgIC8vIGFsZXJ0cyAnTmFtZSBpcyBTdGV2ZScuCiAgICBgYGAKCiAgICBO
T1RFOiBJZiB5b3UgZG8gb3ZlcnJpZGUgYGluaXRgIGZvciBhIGZyYW1ld29yayBjbGFzcyBsaWtl
IGBFbWJlci5WaWV3YCBvcgogICAgYEVtYmVyLkFycmF5Q29udHJvbGxlcmAsIGJlIHN1cmUgdG8g
Y2FsbCBgdGhpcy5fc3VwZXIoKWAgaW4geW91cgogICAgYGluaXRgIGRlY2xhcmF0aW9uISBJZiB5
b3UgZG9uJ3QsIEVtYmVyIG1heSBub3QgaGF2ZSBhbiBvcHBvcnR1bml0eSB0bwogICAgZG8gaW1w
b3J0YW50IHNldHVwIHdvcmssIGFuZCB5b3UnbGwgc2VlIHN0cmFuZ2UgYmVoYXZpb3IgaW4geW91
cgogICAgYXBwbGljYXRpb24uCgogICAgQG1ldGhvZCBpbml0CiAgKi8KICBpbml0OiBmdW5jdGlv
bigpIHt9LAoKICAvKioKICAgIERlZmluZXMgdGhlIHByb3BlcnRpZXMgdGhhdCB3aWxsIGJlIGNv
bmNhdGVuYXRlZCBmcm9tIHRoZSBzdXBlcmNsYXNzCiAgICAoaW5zdGVhZCBvZiBvdmVycmlkZGVu
KS4KCiAgICBCeSBkZWZhdWx0LCB3aGVuIHlvdSBleHRlbmQgYW4gRW1iZXIgY2xhc3MgYSBwcm9w
ZXJ0eSBkZWZpbmVkIGluCiAgICB0aGUgc3ViY2xhc3Mgb3ZlcnJpZGVzIGEgcHJvcGVydHkgd2l0
aCB0aGUgc2FtZSBuYW1lIHRoYXQgaXMgZGVmaW5lZAogICAgaW4gdGhlIHN1cGVyY2xhc3MuIEhv
d2V2ZXIsIHRoZXJlIGFyZSBzb21lIGNhc2VzIHdoZXJlIGl0IGlzIHByZWZlcmFibGUKICAgIHRv
IGJ1aWxkIHVwIGEgcHJvcGVydHkncyB2YWx1ZSBieSBjb21iaW5pbmcgdGhlIHN1cGVyY2xhc3Mn
IHByb3BlcnR5CiAgICB2YWx1ZSB3aXRoIHRoZSBzdWJjbGFzcycgdmFsdWUuIEFuIGV4YW1wbGUg
b2YgdGhpcyBpbiB1c2Ugd2l0aGluIEVtYmVyCiAgICBpcyB0aGUgYGNsYXNzTmFtZXNgIHByb3Bl
cnR5IG9mIGBFbWJlci5WaWV3YC4KCiAgICBIZXJlIGlzIHNvbWUgc2FtcGxlIGNvZGUgc2hvd2lu
ZyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgY29uY2F0ZW5hdGVkCiAgICBwcm9wZXJ0eSBhbmQg
YSBub3JtYWwgb25lOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5CYXJWaWV3ID0gRW1iZXIu
Vmlldy5leHRlbmQoewogICAgICBzb21lTm9uQ29uY2F0ZW5hdGVkUHJvcGVydHk6IFsnYmFyJ10s
CiAgICAgIGNsYXNzTmFtZXM6IFsnYmFyJ10KICAgIH0pOwoKICAgIEFwcC5Gb29CYXJWaWV3ID0g
QXBwLkJhclZpZXcuZXh0ZW5kKHsKICAgICAgc29tZU5vbkNvbmNhdGVuYXRlZFByb3BlcnR5OiBb
J2ZvbyddLAogICAgICBjbGFzc05hbWVzOiBbJ2ZvbyddLAogICAgfSk7CgogICAgdmFyIGZvb0Jh
clZpZXcgPSBBcHAuRm9vQmFyVmlldy5jcmVhdGUoKTsKICAgIGZvb0JhclZpZXcuZ2V0KCdzb21l
Tm9uQ29uY2F0ZW5hdGVkUHJvcGVydHknKTsgLy8gWydmb28nXQogICAgZm9vQmFyVmlldy5nZXQo
J2NsYXNzTmFtZXMnKTsgLy8gWydlbWJlci12aWV3JywgJ2JhcicsICdmb28nXQogICAgYGBgCgog
ICAgVGhpcyBiZWhhdmlvciBleHRlbmRzIHRvIG9iamVjdCBjcmVhdGlvbiBhcyB3ZWxsLiBDb250
aW51aW5nIHRoZQogICAgYWJvdmUgZXhhbXBsZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIg
dmlldyA9IEFwcC5Gb29CYXJWaWV3LmNyZWF0ZSh7CiAgICAgIHNvbWVOb25Db25jYXRlbmF0ZWRQ
cm9wZXJ0eTogWydiYXonXSwKICAgICAgY2xhc3NOYW1lczogWydiYXonXQogICAgfSkKICAgIHZp
ZXcuZ2V0KCdzb21lTm9uQ29uY2F0ZW5hdGVkUHJvcGVydHknKTsgLy8gWydiYXonXQogICAgdmll
dy5nZXQoJ2NsYXNzTmFtZXMnKTsgLy8gWydlbWJlci12aWV3JywgJ2JhcicsICdmb28nLCAnYmF6
J10KICAgIGBgYAogICAgQWRkaW5nIGEgc2luZ2xlIHByb3BlcnR5IHRoYXQgaXMgbm90IGFuIGFy
cmF5IHdpbGwganVzdCBhZGQgaXQgaW4gdGhlIGFycmF5OgoKICAgIGBgYGphdmFzY3JpcHQKICAg
IHZhciB2aWV3ID0gQXBwLkZvb0JhclZpZXcuY3JlYXRlKHsKICAgICAgY2xhc3NOYW1lczogJ2Jh
eicKICAgIH0pCiAgICB2aWV3LmdldCgnY2xhc3NOYW1lcycpOyAvLyBbJ2VtYmVyLXZpZXcnLCAn
YmFyJywgJ2ZvbycsICdiYXonXQogICAgYGBgCgogICAgVXNpbmcgdGhlIGBjb25jYXRlbmF0ZWRQ
cm9wZXJ0aWVzYCBwcm9wZXJ0eSwgd2UgY2FuIHRlbGwgdG8gRW1iZXIgdGhhdCBtaXgKICAgIHRo
ZSBjb250ZW50IG9mIHRoZSBwcm9wZXJ0aWVzLgoKICAgIEluIGBFbWJlci5WaWV3YCB0aGUgYGNs
YXNzTmFtZUJpbmRpbmdzYCBhbmQgYGF0dHJpYnV0ZUJpbmRpbmdzYCBwcm9wZXJ0aWVzCiAgICBh
cmUgYWxzbyBjb25jYXRlbmF0ZWQsIGluIGFkZGl0aW9uIHRvIGBjbGFzc05hbWVzYC4KCiAgICBU
aGlzIGZlYXR1cmUgaXMgYXZhaWxhYmxlIGZvciB5b3UgdG8gdXNlIHRocm91Z2hvdXQgdGhlIEVt
YmVyIG9iamVjdCBtb2RlbCwKICAgIGFsdGhvdWdoIHR5cGljYWwgYXBwIGRldmVsb3BlcnMgYXJl
IGxpa2VseSB0byB1c2UgaXQgaW5mcmVxdWVudGx5LiBTaW5jZQogICAgaXQgY2hhbmdlcyBleHBl
Y3RhdGlvbnMgYWJvdXQgYmVoYXZpb3Igb2YgcHJvcGVydGllcywgeW91IHNob3VsZCBwcm9wZXJs
eQogICAgZG9jdW1lbnQgaXRzIHVzYWdlIGluIGVhY2ggaW5kaXZpZHVhbCBjb25jYXRlbmF0ZWQg
cHJvcGVydHkgKHRvIG5vdAogICAgbWlzbGVhZCB5b3VyIHVzZXJzIHRvIHRoaW5rIHRoZXkgY2Fu
IG92ZXJyaWRlIHRoZSBwcm9wZXJ0eSBpbiBhIHN1YmNsYXNzKS4KCiAgICBAcHJvcGVydHkgY29u
Y2F0ZW5hdGVkUHJvcGVydGllcwogICAgQHR5cGUgQXJyYXkKICAgIEBkZWZhdWx0IG51bGwKICAq
LwogIGNvbmNhdGVuYXRlZFByb3BlcnRpZXM6IG51bGwsCgogIC8qKgogICAgRGVzdHJveWVkIG9i
amVjdCBwcm9wZXJ0eSBmbGFnLgoKICAgIGlmIHRoaXMgcHJvcGVydHkgaXMgYHRydWVgIHRoZSBv
YnNlcnZlcnMgYW5kIGJpbmRpbmdzIHdlcmUgYWxyZWFkeQogICAgcmVtb3ZlZCBieSB0aGUgZWZm
ZWN0IG9mIGNhbGxpbmcgdGhlIGBkZXN0cm95KClgIG1ldGhvZC4KCiAgICBAcHJvcGVydHkgaXNE
ZXN0cm95ZWQKICAgIEBkZWZhdWx0IGZhbHNlCiAgKi8KICBpc0Rlc3Ryb3llZDogZmFsc2UsCgog
IC8qKgogICAgRGVzdHJ1Y3Rpb24gc2NoZWR1bGVkIGZsYWcuIFRoZSBgZGVzdHJveSgpYCBtZXRo
b2QgaGFzIGJlZW4gY2FsbGVkLgoKICAgIFRoZSBvYmplY3Qgc3RheXMgaW50YWN0IHVudGlsIHRo
ZSBlbmQgb2YgdGhlIHJ1biBsb29wIGF0IHdoaWNoIHBvaW50CiAgICB0aGUgYGlzRGVzdHJveWVk
YCBmbGFnIGlzIHNldC4KCiAgICBAcHJvcGVydHkgaXNEZXN0cm95aW5nCiAgICBAZGVmYXVsdCBm
YWxzZQogICovCiAgaXNEZXN0cm95aW5nOiBmYWxzZSwKCiAgLyoqCiAgICBEZXN0cm95cyBhbiBv
YmplY3QgYnkgc2V0dGluZyB0aGUgYGlzRGVzdHJveWVkYCBmbGFnIGFuZCByZW1vdmluZyBpdHMK
ICAgIG1ldGFkYXRhLCB3aGljaCBlZmZlY3RpdmVseSBkZXN0cm95cyBvYnNlcnZlcnMgYW5kIGJp
bmRpbmdzLgoKICAgIElmIHlvdSB0cnkgdG8gc2V0IGEgcHJvcGVydHkgb24gYSBkZXN0cm95ZWQg
b2JqZWN0LCBhbiBleGNlcHRpb24gd2lsbCBiZQogICAgcmFpc2VkLgoKICAgIE5vdGUgdGhhdCBk
ZXN0cnVjdGlvbiBpcyBzY2hlZHVsZWQgZm9yIHRoZSBlbmQgb2YgdGhlIHJ1biBsb29wIGFuZCBk
b2VzIG5vdAogICAgaGFwcGVuIGltbWVkaWF0ZWx5LiAgSXQgd2lsbCBzZXQgYW4gaXNEZXN0cm95
aW5nIGZsYWcgaW1tZWRpYXRlbHkuCgogICAgQG1ldGhvZCBkZXN0cm95CiAgICBAcmV0dXJuIHtF
bWJlci5PYmplY3R9IHJlY2VpdmVyCiAgKi8KICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIGlm
ICh0aGlzLmlzRGVzdHJveWluZykgeyByZXR1cm47IH0KICAgIHRoaXMuaXNEZXN0cm95aW5nID0g
dHJ1ZTsKCiAgICBzY2hlZHVsZSgnYWN0aW9ucycsIHRoaXMsIHRoaXMud2lsbERlc3Ryb3kpOwog
ICAgc2NoZWR1bGUoJ2Rlc3Ryb3knLCB0aGlzLCB0aGlzLl9zY2hlZHVsZWREZXN0cm95KTsKICAg
IHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgT3ZlcnJpZGUgdG8gaW1wbGVtZW50IHRlYXJk
b3duLgoKICAgIEBtZXRob2Qgd2lsbERlc3Ryb3kKICAgKi8KICB3aWxsRGVzdHJveTogRW1iZXIu
SywKCiAgLyoqCiAgICBJbnZva2VkIGJ5IHRoZSBydW4gbG9vcCB0byBhY3R1YWxseSBkZXN0cm95
IHRoZSBvYmplY3QuIFRoaXMgaXMKICAgIHNjaGVkdWxlZCBmb3IgZXhlY3V0aW9uIGJ5IHRoZSBg
ZGVzdHJveWAgbWV0aG9kLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIF9zY2hlZHVsZWREZXN0
cm95CiAgKi8KICBfc2NoZWR1bGVkRGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5p
c0Rlc3Ryb3llZCkgeyByZXR1cm47IH0KICAgIGRlc3Ryb3kodGhpcyk7CiAgICB0aGlzLmlzRGVz
dHJveWVkID0gdHJ1ZTsKICB9LAoKICBiaW5kOiBmdW5jdGlvbih0bywgZnJvbSkgewogICAgaWYg
KCEoZnJvbSBpbnN0YW5jZW9mIEVtYmVyLkJpbmRpbmcpKSB7IGZyb20gPSBFbWJlci5CaW5kaW5n
LmZyb20oZnJvbSk7IH0KICAgIGZyb20udG8odG8pLmNvbm5lY3QodGhpcyk7CiAgICByZXR1cm4g
ZnJvbTsKICB9LAoKICAvKioKICAgIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gd2hp
Y2ggYXR0ZW1wdHMgdG8gcHJvdmlkZSBtb3JlIGluZm9ybWF0aW9uCiAgICB0aGFuIEphdmFzY3Jp
cHQncyBgdG9TdHJpbmdgIHR5cGljYWxseSBkb2VzLCBpbiBhIGdlbmVyaWMgd2F5IGZvciBhbGwg
RW1iZXIKICAgIG9iamVjdHMuCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlBlcnNvbiA9IEVt
Lk9iamVjdC5leHRlbmQoKQogICAgcGVyc29uID0gQXBwLlBlcnNvbi5jcmVhdGUoKQogICAgcGVy
c29uLnRvU3RyaW5nKCkgLy89PiAiPEFwcC5QZXJzb246ZW1iZXIxMDI0PiIKICAgIGBgYAoKICAg
IElmIHRoZSBvYmplY3QncyBjbGFzcyBpcyBub3QgZGVmaW5lZCBvbiBhbiBFbWJlciBuYW1lc3Bh
Y2UsIGl0IHdpbGwKICAgIGluZGljYXRlIGl0IGlzIGEgc3ViY2xhc3Mgb2YgdGhlIHJlZ2lzdGVy
ZWQgc3VwZXJjbGFzczoKCiAgIGBgYGphdmFzY3JpcHQKICAgIFN0dWRlbnQgPSBBcHAuUGVyc29u
LmV4dGVuZCgpCiAgICBzdHVkZW50ID0gU3R1ZGVudC5jcmVhdGUoKQogICAgc3R1ZGVudC50b1N0
cmluZygpIC8vPT4gIjwoc3ViY2xhc3Mgb2YgQXBwLlBlcnNvbik6ZW1iZXIxMDI1PiIKICAgIGBg
YAoKICAgIElmIHRoZSBtZXRob2QgYHRvU3RyaW5nRXh0ZW5zaW9uYCBpcyBkZWZpbmVkLCBpdHMg
cmV0dXJuIHZhbHVlIHdpbGwgYmUKICAgIGluY2x1ZGVkIGluIHRoZSBvdXRwdXQuCgogICAgYGBg
amF2YXNjcmlwdAogICAgQXBwLlRlYWNoZXIgPSBBcHAuUGVyc29uLmV4dGVuZCh7CiAgICAgIHRv
U3RyaW5nRXh0ZW5zaW9uOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ2Z1
bGxOYW1lJyk7CiAgICAgIH0KICAgIH0pOwogICAgdGVhY2hlciA9IEFwcC5UZWFjaGVyLmNyZWF0
ZSgpCiAgICB0ZWFjaGVyLnRvU3RyaW5nKCk7IC8vPT4gIjxBcHAuVGVhY2hlcjplbWJlcjEwMjY6
VG9tIERhbGU+IgogICAgYGBgCgogICAgQG1ldGhvZCB0b1N0cmluZwogICAgQHJldHVybiB7U3Ry
aW5nfSBzdHJpbmcgcmVwcmVzZW50YXRpb24KICAqLwogIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0
cmluZygpIHsKICAgIHZhciBoYXNUb1N0cmluZ0V4dGVuc2lvbiA9IHR5cGVvZiB0aGlzLnRvU3Ry
aW5nRXh0ZW5zaW9uID09PSAnZnVuY3Rpb24nLAogICAgICAgIGV4dGVuc2lvbiA9IGhhc1RvU3Ry
aW5nRXh0ZW5zaW9uID8gIjoiICsgdGhpcy50b1N0cmluZ0V4dGVuc2lvbigpIDogJyc7CiAgICB2
YXIgcmV0ID0gJzwnK3RoaXMuY29uc3RydWN0b3IudG9TdHJpbmcoKSsnOicrZ3VpZEZvcih0aGlz
KStleHRlbnNpb24rJz4nOwogICAgdGhpcy50b1N0cmluZyA9IG1ha2VUb1N0cmluZyhyZXQpOwog
ICAgcmV0dXJuIHJldDsKICB9Cn0pOwoKQ29yZU9iamVjdC5Qcm90b3R5cGVNaXhpbi5vd25lckNv
bnN0cnVjdG9yID0gQ29yZU9iamVjdDsKCmZ1bmN0aW9uIG1ha2VUb1N0cmluZyhyZXQpIHsKICBy
ZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiByZXQ7IH07Cn0KCmlmIChFbWJlci5jb25maWcub3Zl
cnJpZGVQcm90b3R5cGVNaXhpbikgewogIEVtYmVyLmNvbmZpZy5vdmVycmlkZVByb3RvdHlwZU1p
eGluKENvcmVPYmplY3QuUHJvdG90eXBlTWl4aW4pOwp9CgpDb3JlT2JqZWN0Ll9fc3VwZXJfXyA9
IG51bGw7Cgp2YXIgQ2xhc3NNaXhpbiA9IE1peGluLmNyZWF0ZSh7CgogIENsYXNzTWl4aW46IEVt
YmVyLnJlcXVpcmVkKCksCgogIFByb3RvdHlwZU1peGluOiBFbWJlci5yZXF1aXJlZCgpLAoKICBp
c0NsYXNzOiB0cnVlLAoKICBpc01ldGhvZDogZmFsc2UsCgogIC8qKgogICAgQ3JlYXRlcyBhIG5l
dyBzdWJjbGFzcy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUGVyc29uID0gRW1iZXIuT2Jq
ZWN0LmV4dGVuZCh7CiAgICAgIHNheTogZnVuY3Rpb24odGhpbmcpIHsKICAgICAgICBhbGVydCh0
aGluZyk7CiAgICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIFRoaXMgZGVmaW5lcyBhIG5ldyBz
dWJjbGFzcyBvZiBFbWJlci5PYmplY3Q6IGBBcHAuUGVyc29uYC4gSXQgY29udGFpbnMgb25lIG1l
dGhvZDogYHNheSgpYC4KCiAgICBZb3UgY2FuIGFsc28gY3JlYXRlIGEgc3ViY2xhc3MgZnJvbSBh
bnkgZXhpc3RpbmcgY2xhc3MgYnkgY2FsbGluZyBpdHMgYGV4dGVuZCgpYCAgbWV0aG9kLiBGb3Ig
ZXhhbXBsZSwgeW91IG1pZ2h0IHdhbnQgdG8gY3JlYXRlIGEgc3ViY2xhc3Mgb2YgRW1iZXIncyBi
dWlsdC1pbiBgRW1iZXIuVmlld2AgY2xhc3M6CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlBl
cnNvblZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICAgIHRhZ05hbWU6ICdsaScsCiAgICAg
IGNsYXNzTmFtZUJpbmRpbmdzOiBbJ2lzQWRtaW5pc3RyYXRvciddCiAgICB9KTsKICAgIGBgYAoK
ICAgIFdoZW4gZGVmaW5pbmcgYSBzdWJjbGFzcywgeW91IGNhbiBvdmVycmlkZSBtZXRob2RzIGJ1
dCBzdGlsbCBhY2Nlc3MgdGhlIGltcGxlbWVudGF0aW9uIG9mIHlvdXIgcGFyZW50IGNsYXNzIGJ5
IGNhbGxpbmcgdGhlIHNwZWNpYWwgYF9zdXBlcigpYCBtZXRob2Q6CgogICAgYGBgamF2YXNjcmlw
dAogICAgQXBwLlBlcnNvbiA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICBzYXk6IGZ1bmN0
aW9uKHRoaW5nKSB7CiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmdldCgnbmFtZScpOwogICAgICAg
IGFsZXJ0KG5hbWUgKyAnIHNheXM6ICcgKyB0aGluZyk7CiAgICAgIH0KICAgIH0pOwoKICAgIEFw
cC5Tb2xkaWVyID0gQXBwLlBlcnNvbi5leHRlbmQoewogICAgICBzYXk6IGZ1bmN0aW9uKHRoaW5n
KSB7CiAgICAgICAgdGhpcy5fc3VwZXIodGhpbmcgKyAiLCBzaXIhIik7CiAgICAgIH0sCiAgICAg
IG1hcmNoOiBmdW5jdGlvbihudW1iZXJPZkhvdXJzKSB7CiAgICAgICAgYWxlcnQodGhpcy5nZXQo
J25hbWUnKSArICcgbWFyY2hlcyBmb3IgJyArIG51bWJlck9mSG91cnMgKyAnIGhvdXJzLicpCiAg
ICAgIH0KICAgIH0pOwoKICAgIHZhciB5ZWh1ZGEgPSBBcHAuU29sZGllci5jcmVhdGUoewogICAg
ICBuYW1lOiAiWWVodWRhIEthdHoiCiAgICB9KTsKCiAgICB5ZWh1ZGEuc2F5KCJZZXMiKTsgIC8v
IGFsZXJ0cyAiWWVodWRhIEthdHogc2F5czogWWVzLCBzaXIhIgogICAgYGBgCgogICAgVGhlIGBj
cmVhdGUoKWAgb24gbGluZSAjMTcgY3JlYXRlcyBhbiAqaW5zdGFuY2UqIG9mIHRoZSBgQXBwLlNv
bGRpZXJgIGNsYXNzLiBUaGUgYGV4dGVuZCgpYCBvbiBsaW5lICM4IGNyZWF0ZXMgYSAqc3ViY2xh
c3MqIG9mIGBBcHAuUGVyc29uYC4gQW55IGluc3RhbmNlIG9mIHRoZSBgQXBwLlBlcnNvbmAgY2xh
c3Mgd2lsbCAqbm90KiBoYXZlIHRoZSBgbWFyY2goKWAgbWV0aG9kLgoKICAgIFlvdSBjYW4gYWxz
byBwYXNzIGBFbWJlci5NaXhpbmAgY2xhc3NlcyB0byBhZGQgYWRkaXRpb25hbCBwcm9wZXJ0aWVz
IHRvIHRoZSBzdWJjbGFzcy4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUGVyc29uID0gRW1i
ZXIuT2JqZWN0LmV4dGVuZCh7CiAgICAgIHNheTogZnVuY3Rpb24odGhpbmcpIHsKICAgICAgICBh
bGVydCh0aGlzLmdldCgnbmFtZScpICsgJyBzYXlzOiAnICsgdGhpbmcpOwogICAgICB9CiAgICB9
KTsKCiAgICBBcHAuU2luZ2luZ01peGluID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgc2lu
ZzogZnVuY3Rpb24odGhpbmcpewogICAgICAgIGFsZXJ0KHRoaXMuZ2V0KCduYW1lJykgKyAnIHNp
bmdzOiBsYSBsYSBsYSAnICsgdGhpbmcpOwogICAgICB9CiAgICB9KTsKCiAgICBBcHAuQnJvYWR3
YXlTdGFyID0gQXBwLlBlcnNvbi5leHRlbmQoQXBwLlNpbmdpbmdNaXhpbiwgewogICAgICBkYW5j
ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgYWxlcnQodGhpcy5nZXQoJ25hbWUnKSArICcgZGFuY2Vz
OiB0YXAgdGFwIHRhcCB0YXAgJyk7CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgVGhlIGBB
cHAuQnJvYWR3YXlTdGFyYCBjbGFzcyBjb250YWlucyB0aHJlZSBtZXRob2RzOiBgc2F5KClgLCBg
c2luZygpYCwgYW5kIGBkYW5jZSgpYC4KCiAgICBAbWV0aG9kIGV4dGVuZAogICAgQHN0YXRpYwoK
ICAgIEBwYXJhbSB7RW1iZXIuTWl4aW59IFttaXhpbnNdKiBPbmUgb3IgbW9yZSBFbWJlci5NaXhp
biBjbGFzc2VzCiAgICBAcGFyYW0ge09iamVjdH0gW2FyZ3VtZW50c10qIE9iamVjdCBjb250YWlu
aW5nIHZhbHVlcyB0byB1c2Ugd2l0aGluIHRoZSBuZXcgY2xhc3MKICAqLwogIGV4dGVuZDogZnVu
Y3Rpb24oKSB7CiAgICB2YXIgQ2xhc3MgPSBtYWtlQ3RvcigpLCBwcm90bzsKICAgIENsYXNzLkNs
YXNzTWl4aW4gPSBNaXhpbi5jcmVhdGUodGhpcy5DbGFzc01peGluKTsKICAgIENsYXNzLlByb3Rv
dHlwZU1peGluID0gTWl4aW4uY3JlYXRlKHRoaXMuUHJvdG90eXBlTWl4aW4pOwoKICAgIENsYXNz
LkNsYXNzTWl4aW4ub3duZXJDb25zdHJ1Y3RvciA9IENsYXNzOwogICAgQ2xhc3MuUHJvdG90eXBl
TWl4aW4ub3duZXJDb25zdHJ1Y3RvciA9IENsYXNzOwoKICAgIHJlb3Blbi5hcHBseShDbGFzcy5Q
cm90b3R5cGVNaXhpbiwgYXJndW1lbnRzKTsKCiAgICBDbGFzcy5zdXBlcmNsYXNzID0gdGhpczsK
ICAgIENsYXNzLl9fc3VwZXJfXyAgPSB0aGlzLnByb3RvdHlwZTsKCiAgICBwcm90byA9IENsYXNz
LnByb3RvdHlwZSA9IG9fY3JlYXRlKHRoaXMucHJvdG90eXBlKTsKICAgIHByb3RvLmNvbnN0cnVj
dG9yID0gQ2xhc3M7CiAgICBnZW5lcmF0ZUd1aWQocHJvdG8pOwogICAgbWV0YShwcm90bykucHJv
dG8gPSBwcm90bzsgLy8gdGhpcyB3aWxsIGRpc2FibGUgb2JzZXJ2ZXJzIG9uIHByb3RvdHlwZQoK
ICAgIENsYXNzLkNsYXNzTWl4aW4uYXBwbHkoQ2xhc3MpOwogICAgcmV0dXJuIENsYXNzOwogIH0s
CgogIC8qKgogICAgRXF1aXZhbGVudCB0byBkb2luZyBgZXh0ZW5kKGFyZ3VtZW50cykuY3JlYXRl
KClgLgogICAgSWYgcG9zc2libGUgdXNlIHRoZSBub3JtYWwgYGNyZWF0ZWAgbWV0aG9kIGluc3Rl
YWQuCgogICAgQG1ldGhvZCBjcmVhdGVXaXRoTWl4aW5zCiAgICBAc3RhdGljCiAgICBAcGFyYW0g
W2FyZ3VtZW50c10qCiAgKi8KICBjcmVhdGVXaXRoTWl4aW5zOiBmdW5jdGlvbigpIHsKICAgIHZh
ciBDID0gdGhpczsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoPjApIHsgdGhpcy5faW5pdE1peGlu
cyhhcmd1bWVudHMpOyB9CiAgICByZXR1cm4gbmV3IEMoKTsKICB9LAoKICAvKioKICAgIENyZWF0
ZXMgYW4gaW5zdGFuY2Ugb2YgYSBjbGFzcy4gQWNjZXB0cyBlaXRoZXIgbm8gYXJndW1lbnRzLCBv
ciBhbiBvYmplY3QKICAgIGNvbnRhaW5pbmcgdmFsdWVzIHRvIGluaXRpYWxpemUgdGhlIG5ld2x5
IGluc3RhbnRpYXRlZCBvYmplY3Qgd2l0aC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuUGVy
c29uID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICAgIGhlbGxvV29ybGQ6IGZ1bmN0aW9uKCkg
ewogICAgICAgIGFsZXJ0KCJIaSwgbXkgbmFtZSBpcyAiICsgdGhpcy5nZXQoJ25hbWUnKSk7CiAg
ICAgIH0KICAgIH0pOwoKICAgIHZhciB0b20gPSBBcHAuUGVyc29uLmNyZWF0ZSh7CiAgICAgIG5h
bWU6ICdUb20gRGFsZScKICAgIH0pOwoKICAgIHRvbS5oZWxsb1dvcmxkKCk7IC8vIGFsZXJ0cyAi
SGksIG15IG5hbWUgaXMgVG9tIERhbGUiLgogICAgYGBgCgogICAgYGNyZWF0ZWAgd2lsbCBjYWxs
IHRoZSBgaW5pdGAgZnVuY3Rpb24gaWYgZGVmaW5lZCBkdXJpbmcKICAgIGBFbWJlci5BbnlPYmpl
Y3QuZXh0ZW5kYAoKICAgIElmIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkIHRvIGBjcmVhdGVgLCBp
dCB3aWxsIG5vdCBzZXQgdmFsdWVzIHRvIHRoZSBuZXcKICAgIGluc3RhbmNlIGR1cmluZyBpbml0
aWFsaXphdGlvbjoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgbm9OYW1lID0gQXBwLlBlcnNv
bi5jcmVhdGUoKTsKICAgIG5vTmFtZS5oZWxsb1dvcmxkKCk7IC8vIGFsZXJ0cyB1bmRlZmluZWQK
ICAgIGBgYAoKICAgIE5PVEU6IEZvciBwZXJmb3JtYW5jZSByZWFzb25zLCB5b3UgY2Fubm90IGRl
Y2xhcmUgbWV0aG9kcyBvciBjb21wdXRlZAogICAgcHJvcGVydGllcyBkdXJpbmcgYGNyZWF0ZWAu
IFlvdSBzaG91bGQgaW5zdGVhZCBkZWNsYXJlIG1ldGhvZHMgYW5kIGNvbXB1dGVkCiAgICBwcm9w
ZXJ0aWVzIHdoZW4gdXNpbmcgYGV4dGVuZGAgb3IgdXNlIHRoZSBgY3JlYXRlV2l0aE1peGluc2Ag
c2hvcnRoYW5kLgoKICAgIEBtZXRob2QgY3JlYXRlCiAgICBAc3RhdGljCiAgICBAcGFyYW0gW2Fy
Z3VtZW50c10qCiAgKi8KICBjcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgdmFyIEMgPSB0aGlzOwog
ICAgaWYgKGFyZ3VtZW50cy5sZW5ndGg+MCkgeyB0aGlzLl9pbml0UHJvcGVydGllcyhhcmd1bWVu
dHMpOyB9CiAgICByZXR1cm4gbmV3IEMoKTsKICB9LAoKICAvKioKICAgIEF1Z21lbnRzIGEgY29u
c3RydWN0b3IncyBwcm90b3R5cGUgd2l0aCBhZGRpdGlvbmFsCiAgICBwcm9wZXJ0aWVzIGFuZCBm
dW5jdGlvbnM6CgogICAgYGBgamF2YXNjcmlwdAogICAgTXlPYmplY3QgPSBFbWJlci5PYmplY3Qu
ZXh0ZW5kKHsKICAgICAgbmFtZTogJ2FuIG9iamVjdCcKICAgIH0pOwoKICAgIG8gPSBNeU9iamVj
dC5jcmVhdGUoKTsKICAgIG8uZ2V0KCduYW1lJyk7IC8vICdhbiBvYmplY3QnCgogICAgTXlPYmpl
Y3QucmVvcGVuKHsKICAgICAgc2F5OiBmdW5jdGlvbihtc2cpewogICAgICAgIGNvbnNvbGUubG9n
KG1zZyk7CiAgICAgIH0KICAgIH0pCgogICAgbzIgPSBNeU9iamVjdC5jcmVhdGUoKTsKICAgIG8y
LnNheSgiaGVsbG8iKTsgLy8gbG9ncyAiaGVsbG8iCgogICAgby5zYXkoImdvb2RieWUiKTsgLy8g
bG9ncyAiZ29vZGJ5ZSIKICAgIGBgYAoKICAgIFRvIGFkZCBmdW5jdGlvbnMgYW5kIHByb3BlcnRp
ZXMgdG8gdGhlIGNvbnN0cnVjdG9yIGl0c2VsZiwKICAgIHNlZSBgcmVvcGVuQ2xhc3NgCgogICAg
QG1ldGhvZCByZW9wZW4KICAqLwogIHJlb3BlbjogZnVuY3Rpb24oKSB7CiAgICB0aGlzLndpbGxS
ZW9wZW4oKTsKICAgIHJlb3Blbi5hcHBseSh0aGlzLlByb3RvdHlwZU1peGluLCBhcmd1bWVudHMp
OwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBBdWdtZW50cyBhIGNvbnN0cnVjdG9y
J3Mgb3duIHByb3BlcnRpZXMgYW5kIGZ1bmN0aW9uczoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBN
eU9iamVjdCA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICBuYW1lOiAnYW4gb2JqZWN0Jwog
ICAgfSk7CgogICAgTXlPYmplY3QucmVvcGVuQ2xhc3MoewogICAgICBjYW5CdWlsZDogZmFsc2UK
ICAgIH0pOwoKICAgIE15T2JqZWN0LmNhbkJ1aWxkOyAvLyBmYWxzZQogICAgbyA9IE15T2JqZWN0
LmNyZWF0ZSgpOwogICAgYGBgCgogICAgSW4gb3RoZXIgd29yZHMsIHRoaXMgY3JlYXRlcyBzdGF0
aWMgcHJvcGVydGllcyBhbmQgZnVuY3Rpb25zIGZvciB0aGUgY2xhc3MuIFRoZXNlIGFyZSBvbmx5
IGF2YWlsYWJsZSBvbiB0aGUgY2xhc3MKICAgIGFuZCBub3Qgb24gYW55IGluc3RhbmNlIG9mIHRo
YXQgY2xhc3MuCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlBlcnNvbiA9IEVtYmVyLk9iamVj
dC5leHRlbmQoewogICAgICBuYW1lIDogIiIsCiAgICAgIHNheUhlbGxvIDogZnVuY3Rpb24oKXsK
ICAgICAgICBhbGVydCgiSGVsbG8uIE15IG5hbWUgaXMgIiArIHRoaXMuZ2V0KCduYW1lJykpOwog
ICAgICB9CiAgICB9KTsKCiAgICBBcHAuUGVyc29uLnJlb3BlbkNsYXNzKHsKICAgICAgc3BlY2ll
cyA6ICJIb21vIHNhcGllbnMiLAogICAgICBjcmVhdGVQZXJzb246IGZ1bmN0aW9uKG5ld1BlcnNv
bnNOYW1lKXsKICAgICAgICByZXR1cm4gQXBwLlBlcnNvbi5jcmVhdGUoewogICAgICAgICAgbmFt
ZTpuZXdQZXJzb25zTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICB2YXIgdG9t
ID0gQXBwLlBlcnNvbi5jcmVhdGUoewogICAgICBuYW1lIDogIlRvbSBEYWxlIgogICAgfSk7CiAg
ICB2YXIgeWVodWRhID0gQXBwLlBlcnNvbi5jcmVhdGVQZXJzb24oIlllaHVkYSBLYXR6Iik7Cgog
ICAgdG9tLnNheUhlbGxvKCk7IC8vICJIZWxsby4gTXkgbmFtZSBpcyBUb20gRGFsZSIKICAgIHll
aHVkYS5zYXlIZWxsbygpOyAvLyAiSGVsbG8uIE15IG5hbWUgaXMgWWVodWRhIEthdHoiCiAgICBh
bGVydChBcHAuUGVyc29uLnNwZWNpZXMpOyAvLyAiSG9tbyBzYXBpZW5zIgogICAgYGBgCgogICAg
Tm90ZSB0aGF0IGBzcGVjaWVzYCBhbmQgYGNyZWF0ZVBlcnNvbmAgYXJlICpub3QqIHZhbGlkIG9u
IHRoZSBgdG9tYCBhbmQgYHllaHVkYWAKICAgIHZhcmlhYmxlcy4gVGhleSBhcmUgb25seSB2YWxp
ZCBvbiBgQXBwLlBlcnNvbmAuCgogICAgVG8gYWRkIGZ1bmN0aW9ucyBhbmQgcHJvcGVydGllcyB0
byBpbnN0YW5jZXMgb2YKICAgIGEgY29uc3RydWN0b3IgYnkgZXh0ZW5kaW5nIHRoZSBjb25zdHJ1
Y3RvcidzIHByb3RvdHlwZQogICAgc2VlIGByZW9wZW5gCgogICAgQG1ldGhvZCByZW9wZW5DbGFz
cwogICovCiAgcmVvcGVuQ2xhc3M6IGZ1bmN0aW9uKCkgewogICAgcmVvcGVuLmFwcGx5KHRoaXMu
Q2xhc3NNaXhpbiwgYXJndW1lbnRzKTsKICAgIGFwcGx5TWl4aW4odGhpcywgYXJndW1lbnRzLCBm
YWxzZSk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICBkZXRlY3Q6IGZ1bmN0aW9uKG9iaikgewog
ICAgaWYgKCdmdW5jdGlvbicgIT09IHR5cGVvZiBvYmopIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB3
aGlsZShvYmopIHsKICAgICAgaWYgKG9iaj09PXRoaXMpIHsgcmV0dXJuIHRydWU7IH0KICAgICAg
b2JqID0gb2JqLnN1cGVyY2xhc3M7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfSwKCiAgZGV0
ZWN0SW5zdGFuY2U6IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIHRo
aXM7CiAgfSwKCiAgLyoqCiAgICBJbiBzb21lIGNhc2VzLCB5b3UgbWF5IHdhbnQgdG8gYW5ub3Rh
dGUgY29tcHV0ZWQgcHJvcGVydGllcyB3aXRoIGFkZGl0aW9uYWwKICAgIG1ldGFkYXRhIGFib3V0
IGhvdyB0aGV5IGZ1bmN0aW9uIG9yIHdoYXQgdmFsdWVzIHRoZXkgb3BlcmF0ZSBvbi4gRm9yCiAg
ICBleGFtcGxlLCBjb21wdXRlZCBwcm9wZXJ0eSBmdW5jdGlvbnMgbWF5IGNsb3NlIG92ZXIgdmFy
aWFibGVzIHRoYXQgYXJlIHRoZW4KICAgIG5vIGxvbmdlciBhdmFpbGFibGUgZm9yIGludHJvc3Bl
Y3Rpb24uCgogICAgWW91IGNhbiBwYXNzIGEgaGFzaCBvZiB0aGVzZSB2YWx1ZXMgdG8gYSBjb21w
dXRlZCBwcm9wZXJ0eSBsaWtlIHRoaXM6CgogICAgYGBgamF2YXNjcmlwdAogICAgcGVyc29uOiBm
dW5jdGlvbigpIHsKICAgICAgdmFyIHBlcnNvbklkID0gdGhpcy5nZXQoJ3BlcnNvbklkJyk7CiAg
ICAgIHJldHVybiBBcHAuUGVyc29uLmNyZWF0ZSh7IGlkOiBwZXJzb25JZCB9KTsKICAgIH0ucHJv
cGVydHkoKS5tZXRhKHsgdHlwZTogQXBwLlBlcnNvbiB9KQogICAgYGBgCgogICAgT25jZSB5b3Un
dmUgZG9uZSB0aGlzLCB5b3UgY2FuIHJldHJpZXZlIHRoZSB2YWx1ZXMgc2F2ZWQgdG8gdGhlIGNv
bXB1dGVkCiAgICBwcm9wZXJ0eSBmcm9tIHlvdXIgY2xhc3MgbGlrZSB0aGlzOgoKICAgIGBgYGph
dmFzY3JpcHQKICAgIE15Q2xhc3MubWV0YUZvclByb3BlcnR5KCdwZXJzb24nKTsKICAgIGBgYAoK
ICAgIFRoaXMgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIGhhc2ggdGhhdCB3YXMgcGFzc2VkIHRv
IGBtZXRhKClgLgoKICAgIEBtZXRob2QgbWV0YUZvclByb3BlcnR5CiAgICBAcGFyYW0ga2V5IHtT
dHJpbmd9IHByb3BlcnR5IG5hbWUKICAqLwogIG1ldGFGb3JQcm9wZXJ0eTogZnVuY3Rpb24oa2V5
KSB7CiAgICB2YXIgZGVzYyA9IG1ldGEodGhpcy5wcm90bygpLCBmYWxzZSkuZGVzY3Nba2V5XTsK
CiAgICBFbWJlci5hc3NlcnQoIm1ldGFGb3JQcm9wZXJ0eSgpIGNvdWxkIG5vdCBmaW5kIGEgY29t
cHV0ZWQgcHJvcGVydHkgd2l0aCBrZXkgJyIra2V5KyInLiIsICEhZGVzYyAmJiBkZXNjIGluc3Rh
bmNlb2YgRW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eSk7CiAgICByZXR1cm4gZGVzYy5fbWV0YSB8fCB7
fTsKICB9LAoKICAvKioKICAgIEl0ZXJhdGUgb3ZlciBlYWNoIGNvbXB1dGVkIHByb3BlcnR5IGZv
ciB0aGUgY2xhc3MsIHBhc3NpbmcgaXRzIG5hbWUKICAgIGFuZCBhbnkgYXNzb2NpYXRlZCBtZXRh
ZGF0YSAoc2VlIGBtZXRhRm9yUHJvcGVydHlgKSB0byB0aGUgY2FsbGJhY2suCgogICAgQG1ldGhv
ZCBlYWNoQ29tcHV0ZWRQcm9wZXJ0eQogICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAg
IEBwYXJhbSB7T2JqZWN0fSBiaW5kaW5nCiAgKi8KICBlYWNoQ29tcHV0ZWRQcm9wZXJ0eTogZnVu
Y3Rpb24oY2FsbGJhY2ssIGJpbmRpbmcpIHsKICAgIHZhciBwcm90byA9IHRoaXMucHJvdG8oKSwK
ICAgICAgICBkZXNjcyA9IG1ldGEocHJvdG8pLmRlc2NzLAogICAgICAgIGVtcHR5ID0ge30sCiAg
ICAgICAgcHJvcGVydHk7CgogICAgZm9yICh2YXIgbmFtZSBpbiBkZXNjcykgewogICAgICBwcm9w
ZXJ0eSA9IGRlc2NzW25hbWVdOwoKICAgICAgaWYgKHByb3BlcnR5IGluc3RhbmNlb2YgRW1iZXIu
Q29tcHV0ZWRQcm9wZXJ0eSkgewogICAgICAgIGNhbGxiYWNrLmNhbGwoYmluZGluZyB8fCB0aGlz
LCBuYW1lLCBwcm9wZXJ0eS5fbWV0YSB8fCBlbXB0eSk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsK
CkNsYXNzTWl4aW4ub3duZXJDb25zdHJ1Y3RvciA9IENvcmVPYmplY3Q7CgppZiAoRW1iZXIuY29u
ZmlnLm92ZXJyaWRlQ2xhc3NNaXhpbikgewogIEVtYmVyLmNvbmZpZy5vdmVycmlkZUNsYXNzTWl4
aW4oQ2xhc3NNaXhpbik7Cn0KCkNvcmVPYmplY3QuQ2xhc3NNaXhpbiA9IENsYXNzTWl4aW47CkNs
YXNzTWl4aW4uYXBwbHkoQ29yZU9iamVjdCk7CgpFbWJlci5Db3JlT2JqZWN0ID0gQ29yZU9iamVj
dDsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBl
bWJlci1ydW50aW1lCiovCgovKioKICBgRW1iZXIuT2JqZWN0YCBpcyB0aGUgbWFpbiBiYXNlIGNs
YXNzIGZvciBhbGwgRW1iZXIgb2JqZWN0cy4gSXQgaXMgYSBzdWJjbGFzcwogIG9mIGBFbWJlci5D
b3JlT2JqZWN0YCB3aXRoIHRoZSBgRW1iZXIuT2JzZXJ2YWJsZWAgbWl4aW4gYXBwbGllZC4gRm9y
IGRldGFpbHMsCiAgc2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciBlYWNoIG9mIHRoZXNlLgoKICBA
Y2xhc3MgT2JqZWN0CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLkNvcmVPYmpl
Y3QKICBAdXNlcyBFbWJlci5PYnNlcnZhYmxlCiovCkVtYmVyLk9iamVjdCA9IEVtYmVyLkNvcmVP
YmplY3QuZXh0ZW5kKEVtYmVyLk9ic2VydmFibGUpOwpFbWJlci5PYmplY3QudG9TdHJpbmcgPSBm
dW5jdGlvbigpIHsgcmV0dXJuICJFbWJlci5PYmplY3QiOyB9OwoKfSkoKTsKCgoKKGZ1bmN0aW9u
KCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXJ1bnRpbWUKKi8KCnZhciBn
ZXQgPSBFbWJlci5nZXQsIGluZGV4T2YgPSBFbWJlci5BcnJheVBvbHlmaWxscy5pbmRleE9mOwoK
LyoqCiAgQSBOYW1lc3BhY2UgaXMgYW4gb2JqZWN0IHVzdWFsbHkgdXNlZCB0byBjb250YWluIG90
aGVyIG9iamVjdHMgb3IgbWV0aG9kcwogIHN1Y2ggYXMgYW4gYXBwbGljYXRpb24gb3IgZnJhbWV3
b3JrLiBDcmVhdGUgYSBuYW1lc3BhY2UgYW55dGltZSB5b3Ugd2FudAogIHRvIGRlZmluZSBvbmUg
b2YgdGhlc2UgbmV3IGNvbnRhaW5lcnMuCgogICMgRXhhbXBsZSBVc2FnZQoKICBgYGBqYXZhc2Ny
aXB0CiAgTXlGcmFtZXdvcmsgPSBFbWJlci5OYW1lc3BhY2UuY3JlYXRlKHsKICAgIFZFUlNJT046
ICcxLjAuMCcKICB9KTsKICBgYGAKCiAgQGNsYXNzIE5hbWVzcGFjZQogIEBuYW1lc3BhY2UgRW1i
ZXIKICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKKi8KdmFyIE5hbWVzcGFjZSA9IEVtYmVyLk5hbWVz
cGFjZSA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogIGlzTmFtZXNwYWNlOiB0cnVlLAoKICBpbml0
OiBmdW5jdGlvbigpIHsKICAgIEVtYmVyLk5hbWVzcGFjZS5OQU1FU1BBQ0VTLnB1c2godGhpcyk7
CiAgICBFbWJlci5OYW1lc3BhY2UuUFJPQ0VTU0VEID0gZmFsc2U7CiAgfSwKCiAgdG9TdHJpbmc6
IGZ1bmN0aW9uKCkgewogICAgdmFyIG5hbWUgPSBnZXQodGhpcywgJ25hbWUnKTsKICAgIGlmIChu
YW1lKSB7IHJldHVybiBuYW1lOyB9CgogICAgZmluZE5hbWVzcGFjZXMoKTsKICAgIHJldHVybiB0
aGlzW0VtYmVyLkdVSURfS0VZKydfbmFtZSddOwogIH0sCgogIG5hbWVDbGFzc2VzOiBmdW5jdGlv
bigpIHsKICAgIHByb2Nlc3NOYW1lc3BhY2UoW3RoaXMudG9TdHJpbmcoKV0sIHRoaXMsIHt9KTsK
ICB9LAoKICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIHZhciBuYW1lc3BhY2VzID0gRW1iZXIu
TmFtZXNwYWNlLk5BTUVTUEFDRVM7CiAgICBFbWJlci5sb29rdXBbdGhpcy50b1N0cmluZygpXSA9
IHVuZGVmaW5lZDsKICAgIG5hbWVzcGFjZXMuc3BsaWNlKGluZGV4T2YuY2FsbChuYW1lc3BhY2Vz
LCB0aGlzKSwgMSk7CiAgICB0aGlzLl9zdXBlcigpOwogIH0KfSk7CgpOYW1lc3BhY2UucmVvcGVu
Q2xhc3MoewogIE5BTUVTUEFDRVM6IFtFbWJlcl0sCiAgTkFNRVNQQUNFU19CWV9JRDoge30sCiAg
UFJPQ0VTU0VEOiBmYWxzZSwKICBwcm9jZXNzQWxsOiBwcm9jZXNzQWxsTmFtZXNwYWNlcywKICBi
eU5hbWU6IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmICghRW1iZXIuQk9PVEVEKSB7CiAgICAgIHBy
b2Nlc3NBbGxOYW1lc3BhY2VzKCk7CiAgICB9CgogICAgcmV0dXJuIE5BTUVTUEFDRVNfQllfSURb
bmFtZV07CiAgfQp9KTsKCnZhciBOQU1FU1BBQ0VTX0JZX0lEID0gTmFtZXNwYWNlLk5BTUVTUEFD
RVNfQllfSUQ7Cgp2YXIgaGFzT3duUHJvcCA9ICh7fSkuaGFzT3duUHJvcGVydHksCiAgICBndWlk
Rm9yID0gRW1iZXIuZ3VpZEZvcjsKCmZ1bmN0aW9uIHByb2Nlc3NOYW1lc3BhY2UocGF0aHMsIHJv
b3QsIHNlZW4pIHsKICB2YXIgaWR4ID0gcGF0aHMubGVuZ3RoOwoKICBOQU1FU1BBQ0VTX0JZX0lE
W3BhdGhzLmpvaW4oJy4nKV0gPSByb290OwoKICAvLyBMb29wIG92ZXIgYWxsIG9mIHRoZSBrZXlz
IGluIHRoZSBuYW1lc3BhY2UsIGxvb2tpbmcgZm9yIGNsYXNzZXMKICBmb3IodmFyIGtleSBpbiBy
b290KSB7CiAgICBpZiAoIWhhc093blByb3AuY2FsbChyb290LCBrZXkpKSB7IGNvbnRpbnVlOyB9
CiAgICB2YXIgb2JqID0gcm9vdFtrZXldOwoKICAgIC8vIElmIHdlIGFyZSBwcm9jZXNzaW5nIHRo
ZSBgRW1iZXJgIG5hbWVzcGFjZSwgZm9yIGV4YW1wbGUsIHRoZQogICAgLy8gYHBhdGhzYCB3aWxs
IHN0YXJ0IHdpdGggYFsiRW1iZXIiXWAuIEV2ZXJ5IGl0ZXJhdGlvbiB0aHJvdWdoCiAgICAvLyB0
aGUgbG9vcCB3aWxsIHVwZGF0ZSB0aGUgKipzZWNvbmQqKiBlbGVtZW50IG9mIHRoaXMgbGlzdCB3
aXRoCiAgICAvLyB0aGUga2V5LCBzbyBwcm9jZXNzaW5nIGBFbWJlci5WaWV3YCB3aWxsIG1ha2Ug
dGhlIEFycmF5CiAgICAvLyBgWydFbWJlcicsICdWaWV3J11gLgogICAgcGF0aHNbaWR4XSA9IGtl
eTsKCiAgICAvLyBJZiB3ZSBoYXZlIGZvdW5kIGFuIHVucHJvY2Vzc2VkIGNsYXNzCiAgICBpZiAo
b2JqICYmIG9iai50b1N0cmluZyA9PT0gY2xhc3NUb1N0cmluZykgewogICAgICAvLyBSZXBsYWNl
IHRoZSBjbGFzcycgYHRvU3RyaW5nYCB3aXRoIHRoZSBkb3Qtc2VwYXJhdGVkIHBhdGgKICAgICAg
Ly8gYW5kIHNldCBpdHMgYE5BTUVfS0VZYAogICAgICBvYmoudG9TdHJpbmcgPSBtYWtlVG9TdHJp
bmcocGF0aHMuam9pbignLicpKTsKICAgICAgb2JqW05BTUVfS0VZXSA9IHBhdGhzLmpvaW4oJy4n
KTsKCiAgICAvLyBTdXBwb3J0IG5lc3RlZCBuYW1lc3BhY2VzCiAgICB9IGVsc2UgaWYgKG9iaiAm
JiBvYmouaXNOYW1lc3BhY2UpIHsKICAgICAgLy8gU2tpcCBhbGlhc2VkIG5hbWVzcGFjZXMKICAg
ICAgaWYgKHNlZW5bZ3VpZEZvcihvYmopXSkgeyBjb250aW51ZTsgfQogICAgICBzZWVuW2d1aWRG
b3Iob2JqKV0gPSB0cnVlOwoKICAgICAgLy8gUHJvY2VzcyB0aGUgY2hpbGQgbmFtZXNwYWNlCiAg
ICAgIHByb2Nlc3NOYW1lc3BhY2UocGF0aHMsIG9iaiwgc2Vlbik7CiAgICB9CiAgfQoKICBwYXRo
cy5sZW5ndGggPSBpZHg7IC8vIGN1dCBvdXQgbGFzdCBpdGVtCn0KCmZ1bmN0aW9uIGZpbmROYW1l
c3BhY2VzKCkgewogIHZhciBOYW1lc3BhY2UgPSBFbWJlci5OYW1lc3BhY2UsIGxvb2t1cCA9IEVt
YmVyLmxvb2t1cCwgb2JqLCBpc05hbWVzcGFjZTsKCiAgaWYgKE5hbWVzcGFjZS5QUk9DRVNTRUQp
IHsgcmV0dXJuOyB9CgogIGZvciAodmFyIHByb3AgaW4gbG9va3VwKSB7CiAgICAvLyBUaGVzZSBk
b24ndCByYWlzZSBleGNlcHRpb25zIGJ1dCBjYW4gY2F1c2Ugd2FybmluZ3MKICAgIGlmIChwcm9w
ID09PSAicGFyZW50IiB8fCBwcm9wID09PSAidG9wIiB8fCBwcm9wID09PSAiZnJhbWVFbGVtZW50
IiB8fCBwcm9wID09PSAid2Via2l0U3RvcmFnZUluZm8iKSB7IGNvbnRpbnVlOyB9CgogICAgLy8g
IGdldCh3aW5kb3cuZ2xvYmFsU3RvcmFnZSwgJ2lzTmFtZXNwYWNlJykgd291bGQgdHJ5IHRvIHJl
YWQgdGhlIHN0b3JhZ2UgZm9yIGRvbWFpbiBpc05hbWVzcGFjZSBhbmQgY2F1c2UgZXhjZXB0aW9u
IGluIEZpcmVmb3guCiAgICAvLyBnbG9iYWxTdG9yYWdlIGlzIGEgc3RvcmFnZSBvYnNvbGV0ZWQg
YnkgdGhlIFdoYXRXRyBzdG9yYWdlIHNwZWNpZmljYXRpb24uIFNlZSBodHRwczovL2RldmVsb3Bl
ci5tb3ppbGxhLm9yZy9lbi9ET00vU3RvcmFnZSNnbG9iYWxTdG9yYWdlCiAgICBpZiAocHJvcCA9
PT0gImdsb2JhbFN0b3JhZ2UiICYmIGxvb2t1cC5TdG9yYWdlTGlzdCAmJiBsb29rdXAuZ2xvYmFs
U3RvcmFnZSBpbnN0YW5jZW9mIGxvb2t1cC5TdG9yYWdlTGlzdCkgeyBjb250aW51ZTsgfQogICAg
Ly8gVW5mb3J0dW5hdGVseSwgc29tZSB2ZXJzaW9ucyBvZiBJRSBkb24ndCBzdXBwb3J0IHdpbmRv
dy5oYXNPd25Qcm9wZXJ0eQogICAgaWYgKGxvb2t1cC5oYXNPd25Qcm9wZXJ0eSAmJiAhbG9va3Vw
Lmhhc093blByb3BlcnR5KHByb3ApKSB7IGNvbnRpbnVlOyB9CgogICAgLy8gQXQgdGltZXMgd2Ug
YXJlIG5vdCBhbGxvd2VkIHRvIGFjY2VzcyBjZXJ0YWluIHByb3BlcnRpZXMgZm9yIHNlY3VyaXR5
IHJlYXNvbnMuCiAgICAvLyBUaGVyZSBhcmUgYWxzbyB0aW1lcyB3aGVyZSBldmVuIGlmIHdlIGNh
biBhY2Nlc3MgdGhlbSwgd2UgYXJlIG5vdCBhbGxvd2VkIHRvIGFjY2VzcyB0aGVpciBwcm9wZXJ0
aWVzLgogICAgdHJ5IHsKICAgICAgb2JqID0gRW1iZXIubG9va3VwW3Byb3BdOwogICAgICBpc05h
bWVzcGFjZSA9IG9iaiAmJiBvYmouaXNOYW1lc3BhY2U7CiAgICB9IGNhdGNoIChlKSB7CiAgICAg
IGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChpc05hbWVzcGFjZSkgewogICAgICBFbWJlci5kZXBy
ZWNhdGUoIk5hbWVzcGFjZXMgc2hvdWxkIG5vdCBiZWdpbiB3aXRoIGxvd2VyY2FzZS4iLCAvXltB
LVpdLy50ZXN0KHByb3ApKTsKICAgICAgb2JqW05BTUVfS0VZXSA9IHByb3A7CiAgICB9CiAgfQp9
Cgp2YXIgTkFNRV9LRVkgPSBFbWJlci5OQU1FX0tFWSA9IEVtYmVyLkdVSURfS0VZICsgJ19uYW1l
JzsKCmZ1bmN0aW9uIHN1cGVyQ2xhc3NTdHJpbmcobWl4aW4pIHsKICB2YXIgc3VwZXJjbGFzcyA9
IG1peGluLnN1cGVyY2xhc3M7CiAgaWYgKHN1cGVyY2xhc3MpIHsKICAgIGlmIChzdXBlcmNsYXNz
W05BTUVfS0VZXSkgeyByZXR1cm4gc3VwZXJjbGFzc1tOQU1FX0tFWV07IH0KICAgIGVsc2UgeyBy
ZXR1cm4gc3VwZXJDbGFzc1N0cmluZyhzdXBlcmNsYXNzKTsgfQogIH0gZWxzZSB7CiAgICByZXR1
cm47CiAgfQp9CgpmdW5jdGlvbiBjbGFzc1RvU3RyaW5nKCkgewogIGlmICghRW1iZXIuQk9PVEVE
ICYmICF0aGlzW05BTUVfS0VZXSkgewogICAgcHJvY2Vzc0FsbE5hbWVzcGFjZXMoKTsKICB9Cgog
IHZhciByZXQ7CgogIGlmICh0aGlzW05BTUVfS0VZXSkgewogICAgcmV0ID0gdGhpc1tOQU1FX0tF
WV07CiAgfSBlbHNlIGlmICh0aGlzLl90b1N0cmluZykgewogICAgcmV0ID0gdGhpcy5fdG9TdHJp
bmc7IAogIH0gZWxzZSB7CiAgICB2YXIgc3RyID0gc3VwZXJDbGFzc1N0cmluZyh0aGlzKTsKICAg
IGlmIChzdHIpIHsKICAgICAgcmV0ID0gIihzdWJjbGFzcyBvZiAiICsgc3RyICsgIikiOwogICAg
fSBlbHNlIHsKICAgICAgcmV0ID0gIih1bmtub3duIG1peGluKSI7CiAgICB9CiAgICB0aGlzLnRv
U3RyaW5nID0gbWFrZVRvU3RyaW5nKHJldCk7CiAgfQoKICByZXR1cm4gcmV0Owp9CgpmdW5jdGlv
biBwcm9jZXNzQWxsTmFtZXNwYWNlcygpIHsKICB2YXIgdW5wcm9jZXNzZWROYW1lc3BhY2VzID0g
IU5hbWVzcGFjZS5QUk9DRVNTRUQsCiAgICAgIHVucHJvY2Vzc2VkTWl4aW5zID0gRW1iZXIuYW55
VW5wcm9jZXNzZWRNaXhpbnM7CgogIGlmICh1bnByb2Nlc3NlZE5hbWVzcGFjZXMpIHsKICAgIGZp
bmROYW1lc3BhY2VzKCk7CiAgICBOYW1lc3BhY2UuUFJPQ0VTU0VEID0gdHJ1ZTsKICB9CgogIGlm
ICh1bnByb2Nlc3NlZE5hbWVzcGFjZXMgfHwgdW5wcm9jZXNzZWRNaXhpbnMpIHsKICAgIHZhciBu
YW1lc3BhY2VzID0gTmFtZXNwYWNlLk5BTUVTUEFDRVMsIG5hbWVzcGFjZTsKICAgIGZvciAodmFy
IGk9MCwgbD1uYW1lc3BhY2VzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgbmFtZXNwYWNlID0g
bmFtZXNwYWNlc1tpXTsKICAgICAgcHJvY2Vzc05hbWVzcGFjZShbbmFtZXNwYWNlLnRvU3RyaW5n
KCldLCBuYW1lc3BhY2UsIHt9KTsKICAgIH0KCiAgICBFbWJlci5hbnlVbnByb2Nlc3NlZE1peGlu
cyA9IGZhbHNlOwogIH0KfQoKZnVuY3Rpb24gbWFrZVRvU3RyaW5nKHJldCkgewogIHJldHVybiBm
dW5jdGlvbigpIHsgcmV0dXJuIHJldDsgfTsKfQoKRW1iZXIuTWl4aW4ucHJvdG90eXBlLnRvU3Ry
aW5nID0gY2xhc3NUb1N0cmluZzsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUg
ZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LAog
ICAgc2V0ID0gRW1iZXIuc2V0LAogICAgZm10ID0gRW1iZXIuU3RyaW5nLmZtdCwKICAgIGFkZEJl
Zm9yZU9ic2VydmVyID0gRW1iZXIuYWRkQmVmb3JlT2JzZXJ2ZXIsCiAgICBhZGRPYnNlcnZlciA9
IEVtYmVyLmFkZE9ic2VydmVyLAogICAgcmVtb3ZlQmVmb3JlT2JzZXJ2ZXIgPSBFbWJlci5yZW1v
dmVCZWZvcmVPYnNlcnZlciwKICAgIHJlbW92ZU9ic2VydmVyID0gRW1iZXIucmVtb3ZlT2JzZXJ2
ZXIsCiAgICBwcm9wZXJ0eVdpbGxDaGFuZ2UgPSBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UsCiAg
ICBwcm9wZXJ0eURpZENoYW5nZSA9IEVtYmVyLnByb3BlcnR5RGlkQ2hhbmdlLAogICAgbWV0YSA9
IEVtYmVyLm1ldGEsCiAgICBkZWZpbmVQcm9wZXJ0eSA9IEVtYmVyLmRlZmluZVByb3BlcnR5OwoK
ZnVuY3Rpb24gY29udGVudFByb3BlcnR5V2lsbENoYW5nZShjb250ZW50LCBjb250ZW50S2V5KSB7
CiAgdmFyIGtleSA9IGNvbnRlbnRLZXkuc2xpY2UoOCk7IC8vIHJlbW92ZSAiY29udGVudC4iCiAg
aWYgKGtleSBpbiB0aGlzKSB7IHJldHVybjsgfSAgLy8gaWYgc2hhZG93ZWQgaW4gcHJveHkKICBw
cm9wZXJ0eVdpbGxDaGFuZ2UodGhpcywga2V5KTsKfQoKZnVuY3Rpb24gY29udGVudFByb3BlcnR5
RGlkQ2hhbmdlKGNvbnRlbnQsIGNvbnRlbnRLZXkpIHsKICB2YXIga2V5ID0gY29udGVudEtleS5z
bGljZSg4KTsgLy8gcmVtb3ZlICJjb250ZW50LiIKICBpZiAoa2V5IGluIHRoaXMpIHsgcmV0dXJu
OyB9IC8vIGlmIHNoYWRvd2VkIGluIHByb3h5CiAgcHJvcGVydHlEaWRDaGFuZ2UodGhpcywga2V5
KTsKfQoKLyoqCiAgYEVtYmVyLk9iamVjdFByb3h5YCBmb3J3YXJkcyBhbGwgcHJvcGVydGllcyBu
b3QgZGVmaW5lZCBieSB0aGUgcHJveHkgaXRzZWxmCiAgdG8gYSBwcm94aWVkIGBjb250ZW50YCBv
YmplY3QuCgogIGBgYGphdmFzY3JpcHQKICBvYmplY3QgPSBFbWJlci5PYmplY3QuY3JlYXRlKHsK
ICAgIG5hbWU6ICdGb28nCiAgfSk7CgogIHByb3h5ID0gRW1iZXIuT2JqZWN0UHJveHkuY3JlYXRl
KHsKICAgIGNvbnRlbnQ6IG9iamVjdAogIH0pOwoKICAvLyBBY2Nlc3MgYW5kIGNoYW5nZSBleGlz
dGluZyBwcm9wZXJ0aWVzCiAgcHJveHkuZ2V0KCduYW1lJykgICAgICAgICAgLy8gJ0ZvbycKICBw
cm94eS5zZXQoJ25hbWUnLCAnQmFyJyk7CiAgb2JqZWN0LmdldCgnbmFtZScpICAgICAgICAgLy8g
J0JhcicKCiAgLy8gQ3JlYXRlIG5ldyAnZGVzY3JpcHRpb24nIHByb3BlcnR5IG9uIGBvYmplY3Rg
CiAgcHJveHkuc2V0KCdkZXNjcmlwdGlvbicsICdGb28gaXMgYSB3aGl6Ym9vIGJheicpOwogIG9i
amVjdC5nZXQoJ2Rlc2NyaXB0aW9uJykgIC8vICdGb28gaXMgYSB3aGl6Ym9vIGJheicKICBgYGAK
CiAgV2hpbGUgYGNvbnRlbnRgIGlzIHVuc2V0LCBzZXR0aW5nIGEgcHJvcGVydHkgdG8gYmUgZGVs
ZWdhdGVkIHdpbGwgdGhyb3cgYW4KICBFcnJvci4KCiAgYGBgamF2YXNjcmlwdAogIHByb3h5ID0g
RW1iZXIuT2JqZWN0UHJveHkuY3JlYXRlKHsKICAgIGNvbnRlbnQ6IG51bGwsCiAgICBmbGFnOiBu
dWxsCiAgfSk7CiAgcHJveHkuc2V0KCdmbGFnJywgdHJ1ZSk7CiAgcHJveHkuZ2V0KCdmbGFnJyk7
ICAgICAgICAgLy8gdHJ1ZQogIHByb3h5LmdldCgnZm9vJyk7ICAgICAgICAgIC8vIHVuZGVmaW5l
ZAogIHByb3h5LnNldCgnZm9vJywgJ2RhdGEnKTsgIC8vIHRocm93cyBFcnJvcgogIGBgYAoKICBE
ZWxlZ2F0ZWQgcHJvcGVydGllcyBjYW4gYmUgYm91bmQgdG8gYW5kIHdpbGwgY2hhbmdlIHdoZW4g
Y29udGVudCBpcyB1cGRhdGVkLgoKICBDb21wdXRlZCBwcm9wZXJ0aWVzIG9uIHRoZSBwcm94eSBp
dHNlbGYgY2FuIGRlcGVuZCBvbiBkZWxlZ2F0ZWQgcHJvcGVydGllcy4KCiAgYGBgamF2YXNjcmlw
dAogIFByb3h5V2l0aENvbXB1dGVkUHJvcGVydHkgPSBFbWJlci5PYmplY3RQcm94eS5leHRlbmQo
ewogICAgZnVsbE5hbWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGZpcnN0TmFtZSA9IHRoaXMu
Z2V0KCdmaXJzdE5hbWUnKSwKICAgICAgICAgIGxhc3ROYW1lID0gdGhpcy5nZXQoJ2xhc3ROYW1l
Jyk7CiAgICAgIGlmIChmaXJzdE5hbWUgJiYgbGFzdE5hbWUpIHsKICAgICAgICByZXR1cm4gZmly
c3ROYW1lICsgJyAnICsgbGFzdE5hbWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZpcnN0TmFtZSB8
fCBsYXN0TmFtZTsKICAgIH0ucHJvcGVydHkoJ2ZpcnN0TmFtZScsICdsYXN0TmFtZScpCiAgfSk7
CgogIHByb3h5ID0gUHJveHlXaXRoQ29tcHV0ZWRQcm9wZXJ0eS5jcmVhdGUoKTsKCiAgcHJveHku
Z2V0KCdmdWxsTmFtZScpOyAgLy8gdW5kZWZpbmVkCiAgcHJveHkuc2V0KCdjb250ZW50Jywgewog
ICAgZmlyc3ROYW1lOiAnVG9tJywgbGFzdE5hbWU6ICdEYWxlJwogIH0pOyAvLyB0cmlnZ2VycyBw
cm9wZXJ0eSBjaGFuZ2UgZm9yIGZ1bGxOYW1lIG9uIHByb3h5CgogIHByb3h5LmdldCgnZnVsbE5h
bWUnKTsgIC8vICdUb20gRGFsZScKICBgYGAKCiAgQGNsYXNzIE9iamVjdFByb3h5CiAgQG5hbWVz
cGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLk9iamVjdAoqLwpFbWJlci5PYmplY3RQcm94eSA9
IEVtYmVyLk9iamVjdC5leHRlbmQoewogIC8qKgogICAgVGhlIG9iamVjdCB3aG9zZSBwcm9wZXJ0
aWVzIHdpbGwgYmUgZm9yd2FyZGVkLgoKICAgIEBwcm9wZXJ0eSBjb250ZW50CiAgICBAdHlwZSBF
bWJlci5PYmplY3QKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIGNvbnRlbnQ6IG51bGwsCiAgX2Nv
bnRlbnREaWRDaGFuZ2U6IEVtYmVyLm9ic2VydmVyKCdjb250ZW50JywgZnVuY3Rpb24oKSB7CiAg
ICBFbWJlci5hc3NlcnQoIkNhbid0IHNldCBPYmplY3RQcm94eSdzIGNvbnRlbnQgdG8gaXRzZWxm
IiwgdGhpcy5nZXQoJ2NvbnRlbnQnKSAhPT0gdGhpcyk7CiAgfSksCgogIGlzVHJ1dGh5OiBFbWJl
ci5jb21wdXRlZC5ib29sKCdjb250ZW50JyksCgogIF9kZWJ1Z0NvbnRhaW5lcktleTogbnVsbCwK
CiAgd2lsbFdhdGNoUHJvcGVydHk6IGZ1bmN0aW9uIChrZXkpIHsKICAgIHZhciBjb250ZW50S2V5
ID0gJ2NvbnRlbnQuJyArIGtleTsKICAgIGFkZEJlZm9yZU9ic2VydmVyKHRoaXMsIGNvbnRlbnRL
ZXksIG51bGwsIGNvbnRlbnRQcm9wZXJ0eVdpbGxDaGFuZ2UpOwogICAgYWRkT2JzZXJ2ZXIodGhp
cywgY29udGVudEtleSwgbnVsbCwgY29udGVudFByb3BlcnR5RGlkQ2hhbmdlKTsKICB9LAoKICBk
aWRVbndhdGNoUHJvcGVydHk6IGZ1bmN0aW9uIChrZXkpIHsKICAgIHZhciBjb250ZW50S2V5ID0g
J2NvbnRlbnQuJyArIGtleTsKICAgIHJlbW92ZUJlZm9yZU9ic2VydmVyKHRoaXMsIGNvbnRlbnRL
ZXksIG51bGwsIGNvbnRlbnRQcm9wZXJ0eVdpbGxDaGFuZ2UpOwogICAgcmVtb3ZlT2JzZXJ2ZXIo
dGhpcywgY29udGVudEtleSwgbnVsbCwgY29udGVudFByb3BlcnR5RGlkQ2hhbmdlKTsKICB9LAoK
ICB1bmtub3duUHJvcGVydHk6IGZ1bmN0aW9uIChrZXkpIHsKICAgIHZhciBjb250ZW50ID0gZ2V0
KHRoaXMsICdjb250ZW50Jyk7CiAgICBpZiAoY29udGVudCkgewogICAgICByZXR1cm4gZ2V0KGNv
bnRlbnQsIGtleSk7CiAgICB9CiAgfSwKCiAgc2V0VW5rbm93blByb3BlcnR5OiBmdW5jdGlvbiAo
a2V5LCB2YWx1ZSkgewogICAgdmFyIG0gPSBtZXRhKHRoaXMpOwogICAgaWYgKG0ucHJvdG8gPT09
IHRoaXMpIHsKICAgICAgLy8gaWYgbWFya2VkIGFzIHByb3RvdHlwZSB0aGVuIGp1c3QgZGVmaW5l
UHJvcGVydHkKICAgICAgLy8gcmF0aGVyIHRoYW4gZGVsZWdhdGUKICAgICAgZGVmaW5lUHJvcGVy
dHkodGhpcywga2V5LCBudWxsLCB2YWx1ZSk7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KCiAg
ICB2YXIgY29udGVudCA9IGdldCh0aGlzLCAnY29udGVudCcpOwogICAgRW1iZXIuYXNzZXJ0KGZt
dCgiQ2Fubm90IGRlbGVnYXRlIHNldCgnJUAnLCAlQCkgdG8gdGhlICdjb250ZW50JyBwcm9wZXJ0
eSBvZiBvYmplY3QgcHJveHkgJUA6IGl0cyAnY29udGVudCcgaXMgdW5kZWZpbmVkLiIsIFtrZXks
IHZhbHVlLCB0aGlzXSksIGNvbnRlbnQpOwogICAgcmV0dXJuIHNldChjb250ZW50LCBrZXksIHZh
bHVlKTsKICB9Cgp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIK
QHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgovLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCi8vIEhFTFBFUlMKLy8KCnZhciBnZXQg
PSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKdmFyIGFfc2xpY2UgPSBBcnJheS5wcm90b3R5
cGUuc2xpY2U7CnZhciBhX2luZGV4T2YgPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuaW5kZXhPZjsK
CnZhciBjb250ZXh0cyA9IFtdOwoKZnVuY3Rpb24gcG9wQ3R4KCkgewogIHJldHVybiBjb250ZXh0
cy5sZW5ndGg9PT0wID8ge30gOiBjb250ZXh0cy5wb3AoKTsKfQoKZnVuY3Rpb24gcHVzaEN0eChj
dHgpIHsKICBjb250ZXh0cy5wdXNoKGN0eCk7CiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGl0
ZXIoa2V5LCB2YWx1ZSkgewogIHZhciB2YWx1ZVByb3ZpZGVkID0gYXJndW1lbnRzLmxlbmd0aCA9
PT0gMjsKCiAgZnVuY3Rpb24gaShpdGVtKSB7CiAgICB2YXIgY3VyID0gZ2V0KGl0ZW0sIGtleSk7
CiAgICByZXR1cm4gdmFsdWVQcm92aWRlZCA/IHZhbHVlPT09Y3VyIDogISFjdXI7CiAgfQogIHJl
dHVybiBpIDsKfQoKLyoqCiAgVGhpcyBtaXhpbiBkZWZpbmVzIHRoZSBjb21tb24gaW50ZXJmYWNl
IGltcGxlbWVudGVkIGJ5IGVudW1lcmFibGUgb2JqZWN0cwogIGluIEVtYmVyLiBNb3N0IG9mIHRo
ZXNlIG1ldGhvZHMgZm9sbG93IHRoZSBzdGFuZGFyZCBBcnJheSBpdGVyYXRpb24KICBBUEkgZGVm
aW5lZCB1cCB0byBKYXZhU2NyaXB0IDEuOCAoZXhjbHVkaW5nIGxhbmd1YWdlLXNwZWNpZmljIGZl
YXR1cmVzIHRoYXQKICBjYW5ub3QgYmUgZW11bGF0ZWQgaW4gb2xkZXIgdmVyc2lvbnMgb2YgSmF2
YVNjcmlwdCkuCgogIFRoaXMgbWl4aW4gaXMgYXBwbGllZCBhdXRvbWF0aWNhbGx5IHRvIHRoZSBB
cnJheSBjbGFzcyBvbiBwYWdlIGxvYWQsIHNvIHlvdQogIGNhbiB1c2UgYW55IG9mIHRoZXNlIG1l
dGhvZHMgb24gc2ltcGxlIGFycmF5cy4gSWYgQXJyYXkgYWxyZWFkeSBpbXBsZW1lbnRzCiAgb25l
IG9mIHRoZXNlIG1ldGhvZHMsIHRoZSBtaXhpbiB3aWxsIG5vdCBvdmVycmlkZSB0aGVtLgoKICAj
IyBXcml0aW5nIFlvdXIgT3duIEVudW1lcmFibGUKCiAgVG8gbWFrZSB5b3VyIG93biBjdXN0b20g
Y2xhc3MgZW51bWVyYWJsZSwgeW91IG5lZWQgdHdvIGl0ZW1zOgoKICAxLiBZb3UgbXVzdCBoYXZl
IGEgbGVuZ3RoIHByb3BlcnR5LiBUaGlzIHByb3BlcnR5IHNob3VsZCBjaGFuZ2Ugd2hlbmV2ZXIK
ICAgICB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIHlvdXIgZW51bWVyYWJsZSBvYmplY3QgY2hhbmdl
cy4gSWYgeW91IHVzaW5nIHRoaXMKICAgICB3aXRoIGFuIGBFbWJlci5PYmplY3RgIHN1YmNsYXNz
LCB5b3Ugc2hvdWxkIGJlIHN1cmUgdG8gY2hhbmdlIHRoZSBsZW5ndGgKICAgICBwcm9wZXJ0eSB1
c2luZyBgc2V0KCkuYAoKICAyLiBZb3UgbXVzdCBpbXBsZW1lbnQgYG5leHRPYmplY3QoKS5gIFNl
ZSBkb2N1bWVudGF0aW9uLgoKICBPbmNlIHlvdSBoYXZlIHRoZXNlIHR3byBtZXRob2RzIGltcGxl
bWVudCwgYXBwbHkgdGhlIGBFbWJlci5FbnVtZXJhYmxlYCBtaXhpbgogIHRvIHlvdXIgY2xhc3Mg
YW5kIHlvdSB3aWxsIGJlIGFibGUgdG8gZW51bWVyYXRlIHRoZSBjb250ZW50cyBvZiB5b3VyIG9i
amVjdAogIGxpa2UgYW55IG90aGVyIGNvbGxlY3Rpb24uCgogICMjIFVzaW5nIEVtYmVyIEVudW1l
cmF0aW9uIHdpdGggT3RoZXIgTGlicmFyaWVzCgogIE1hbnkgb3RoZXIgbGlicmFyaWVzIHByb3Zp
ZGUgc29tZSBraW5kIG9mIGl0ZXJhdG9yIG9yIGVudW1lcmF0aW9uIGxpa2UKICBmYWNpbGl0eS4g
VGhpcyBpcyBvZnRlbiB3aGVyZSB0aGUgbW9zdCBjb21tb24gQVBJIGNvbmZsaWN0cyBvY2N1ci4K
ICBFbWJlcidzIEFQSSBpcyBkZXNpZ25lZCB0byBiZSBhcyBmcmllbmRseSBhcyBwb3NzaWJsZSB3
aXRoIG90aGVyCiAgbGlicmFyaWVzIGJ5IGltcGxlbWVudGluZyBvbmx5IG1ldGhvZHMgdGhhdCBt
b3N0bHkgY29ycmVzcG9uZCB0byB0aGUKICBKYXZhU2NyaXB0IDEuOCBBUEkuCgogIEBjbGFzcyBF
bnVtZXJhYmxlCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBzaW5jZSBFbWJlciAwLjkKKi8KRW1iZXIu
RW51bWVyYWJsZSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CgogIC8qKgogICAgSW1wbGVtZW50IHRo
aXMgbWV0aG9kIHRvIG1ha2UgeW91ciBjbGFzcyBlbnVtZXJhYmxlLgoKICAgIFRoaXMgbWV0aG9k
IHdpbGwgYmUgY2FsbCByZXBlYXRlZGx5IGR1cmluZyBlbnVtZXJhdGlvbi4gVGhlIGluZGV4IHZh
bHVlCiAgICB3aWxsIGFsd2F5cyBiZWdpbiB3aXRoIDAgYW5kIGluY3JlbWVudCBtb25vdG9uaWNh
bGx5LiBZb3UgZG9uJ3QgaGF2ZSB0bwogICAgcmVseSBvbiB0aGUgaW5kZXggdmFsdWUgdG8gZGV0
ZXJtaW5lIHdoYXQgb2JqZWN0IHRvIHJldHVybiwgYnV0IHlvdSBzaG91bGQKICAgIGFsd2F5cyBj
aGVjayB0aGUgdmFsdWUgYW5kIHN0YXJ0IGZyb20gdGhlIGJlZ2lubmluZyB3aGVuIHlvdSBzZWUg
dGhlCiAgICByZXF1ZXN0ZWQgaW5kZXggaXMgMC4KCiAgICBUaGUgYHByZXZpb3VzT2JqZWN0YCBp
cyB0aGUgb2JqZWN0IHRoYXQgd2FzIHJldHVybmVkIGZyb20gdGhlIGxhc3QgY2FsbAogICAgdG8g
YG5leHRPYmplY3RgIGZvciB0aGUgY3VycmVudCBpdGVyYXRpb24uIFRoaXMgaXMgYSB1c2VmdWwg
d2F5IHRvCiAgICBtYW5hZ2UgaXRlcmF0aW9uIGlmIHlvdSBhcmUgdHJhY2luZyBhIGxpbmtlZCBs
aXN0LCBmb3IgZXhhbXBsZS4KCiAgICBGaW5hbGx5IHRoZSBjb250ZXh0IHBhcmFtZXRlciB3aWxs
IGFsd2F5cyBjb250YWluIGEgaGFzaCB5b3UgY2FuIHVzZSBhcwogICAgYSAic2NyYXRjaHBhZCIg
dG8gbWFpbnRhaW4gYW55IG90aGVyIHN0YXRlIHlvdSBuZWVkIGluIG9yZGVyIHRvIGl0ZXJhdGUK
ICAgIHByb3Blcmx5LiBUaGUgY29udGV4dCBvYmplY3QgaXMgcmV1c2VkIGFuZCBpcyBub3QgcmVz
ZXQgYmV0d2VlbgogICAgaXRlcmF0aW9ucyBzbyBtYWtlIHN1cmUgeW91IHNldHVwIHRoZSBjb250
ZXh0IHdpdGggYSBmcmVzaCBzdGF0ZSB3aGVuZXZlcgogICAgdGhlIGluZGV4IHBhcmFtZXRlciBp
cyAwLgoKICAgIEdlbmVyYWxseSBpdGVyYXRvcnMgd2lsbCBjb250aW51ZSB0byBjYWxsIGBuZXh0
T2JqZWN0YCB1bnRpbCB0aGUgaW5kZXgKICAgIHJlYWNoZXMgdGhlIHlvdXIgY3VycmVudCBsZW5n
dGgtMS4gSWYgeW91IHJ1biBvdXQgb2YgZGF0YSBiZWZvcmUgdGhpcwogICAgdGltZSBmb3Igc29t
ZSByZWFzb24sIHlvdSBzaG91bGQgc2ltcGx5IHJldHVybiB1bmRlZmluZWQuCgogICAgVGhlIGRl
ZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhpcyBtZXRob2Qgc2ltcGx5IGxvb2tzIHVwIHRoZSBp
bmRleC4KICAgIFRoaXMgd29ya3MgZ3JlYXQgb24gYW55IEFycmF5LWxpa2Ugb2JqZWN0cy4KCiAg
ICBAbWV0aG9kIG5leHRPYmplY3QKICAgIEBwYXJhbSB7TnVtYmVyfSBpbmRleCB0aGUgY3VycmVu
dCBpbmRleCBvZiB0aGUgaXRlcmF0aW9uCiAgICBAcGFyYW0ge09iamVjdH0gcHJldmlvdXNPYmpl
Y3QgdGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8KICAgICAgYG5leHRPYmpl
Y3RgLgogICAgQHBhcmFtIHtPYmplY3R9IGNvbnRleHQgYSBjb250ZXh0IG9iamVjdCB5b3UgY2Fu
IHVzZSB0byBtYWludGFpbiBzdGF0ZS4KICAgIEByZXR1cm4ge09iamVjdH0gdGhlIG5leHQgb2Jq
ZWN0IGluIHRoZSBpdGVyYXRpb24gb3IgdW5kZWZpbmVkCiAgKi8KICBuZXh0T2JqZWN0OiBFbWJl
ci5yZXF1aXJlZChGdW5jdGlvbiksCgogIC8qKgogICAgSGVscGVyIG1ldGhvZCByZXR1cm5zIHRo
ZSBmaXJzdCBvYmplY3QgZnJvbSBhIGNvbGxlY3Rpb24uIFRoaXMgaXMgdXN1YWxseQogICAgdXNl
ZCBieSBiaW5kaW5ncyBhbmQgb3RoZXIgcGFydHMgb2YgdGhlIGZyYW1ld29yayB0byBleHRyYWN0
IGEgc2luZ2xlCiAgICBvYmplY3QgaWYgdGhlIGVudW1lcmFibGUgY29udGFpbnMgb25seSBvbmUg
aXRlbS4KCiAgICBJZiB5b3Ugb3ZlcnJpZGUgdGhpcyBtZXRob2QsIHlvdSBzaG91bGQgaW1wbGVt
ZW50IGl0IHNvIHRoYXQgaXQgd2lsbAogICAgYWx3YXlzIHJldHVybiB0aGUgc2FtZSB2YWx1ZSBl
YWNoIHRpbWUgaXQgaXMgY2FsbGVkLiBJZiB5b3VyIGVudW1lcmFibGUKICAgIGNvbnRhaW5zIG9u
bHkgb25lIG9iamVjdCwgdGhpcyBtZXRob2Qgc2hvdWxkIGFsd2F5cyByZXR1cm4gdGhhdCBvYmpl
Y3QuCiAgICBJZiB5b3VyIGVudW1lcmFibGUgaXMgZW1wdHksIHRoaXMgbWV0aG9kIHNob3VsZCBy
ZXR1cm4gYHVuZGVmaW5lZGAuCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGFyciA9IFsiYSIs
ICJiIiwgImMiXTsKICAgIGFyci5nZXQoJ2ZpcnN0T2JqZWN0Jyk7ICAvLyAiYSIKCiAgICB2YXIg
YXJyID0gW107CiAgICBhcnIuZ2V0KCdmaXJzdE9iamVjdCcpOyAgLy8gdW5kZWZpbmVkCiAgICBg
YGAKCiAgICBAcHJvcGVydHkgZmlyc3RPYmplY3QKICAgIEByZXR1cm4ge09iamVjdH0gdGhlIG9i
amVjdCBvciB1bmRlZmluZWQKICAqLwogIGZpcnN0T2JqZWN0OiBFbWJlci5jb21wdXRlZChmdW5j
dGlvbigpIHsKICAgIGlmIChnZXQodGhpcywgJ2xlbmd0aCcpPT09MCkgcmV0dXJuIHVuZGVmaW5l
ZCA7CgogICAgLy8gaGFuZGxlIGdlbmVyaWMgZW51bWVyYWJsZXMKICAgIHZhciBjb250ZXh0ID0g
cG9wQ3R4KCksIHJldDsKICAgIHJldCA9IHRoaXMubmV4dE9iamVjdCgwLCBudWxsLCBjb250ZXh0
KTsKICAgIHB1c2hDdHgoY29udGV4dCk7CiAgICByZXR1cm4gcmV0IDsKICB9KS5wcm9wZXJ0eSgn
W10nKSwKCiAgLyoqCiAgICBIZWxwZXIgbWV0aG9kIHJldHVybnMgdGhlIGxhc3Qgb2JqZWN0IGZy
b20gYSBjb2xsZWN0aW9uLiBJZiB5b3VyIGVudW1lcmFibGUKICAgIGNvbnRhaW5zIG9ubHkgb25l
IG9iamVjdCwgdGhpcyBtZXRob2Qgc2hvdWxkIGFsd2F5cyByZXR1cm4gdGhhdCBvYmplY3QuCiAg
ICBJZiB5b3VyIGVudW1lcmFibGUgaXMgZW1wdHksIHRoaXMgbWV0aG9kIHNob3VsZCByZXR1cm4g
YHVuZGVmaW5lZGAuCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGFyciA9IFsiYSIsICJiIiwg
ImMiXTsKICAgIGFyci5nZXQoJ2xhc3RPYmplY3QnKTsgIC8vICJjIgoKICAgIHZhciBhcnIgPSBb
XTsKICAgIGFyci5nZXQoJ2xhc3RPYmplY3QnKTsgIC8vIHVuZGVmaW5lZAogICAgYGBgCgogICAg
QHByb3BlcnR5IGxhc3RPYmplY3QKICAgIEByZXR1cm4ge09iamVjdH0gdGhlIGxhc3Qgb2JqZWN0
IG9yIHVuZGVmaW5lZAogICovCiAgbGFzdE9iamVjdDogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24o
KSB7CiAgICB2YXIgbGVuID0gZ2V0KHRoaXMsICdsZW5ndGgnKTsKICAgIGlmIChsZW49PT0wKSBy
ZXR1cm4gdW5kZWZpbmVkIDsKICAgIHZhciBjb250ZXh0ID0gcG9wQ3R4KCksIGlkeD0wLCBjdXIs
IGxhc3QgPSBudWxsOwogICAgZG8gewogICAgICBsYXN0ID0gY3VyOwogICAgICBjdXIgPSB0aGlz
Lm5leHRPYmplY3QoaWR4KyssIGxhc3QsIGNvbnRleHQpOwogICAgfSB3aGlsZSAoY3VyICE9PSB1
bmRlZmluZWQpOwogICAgcHVzaEN0eChjb250ZXh0KTsKICAgIHJldHVybiBsYXN0OwogIH0pLnBy
b3BlcnR5KCdbXScpLAoKICAvKioKICAgIFJldHVybnMgYHRydWVgIGlmIHRoZSBwYXNzZWQgb2Jq
ZWN0IGNhbiBiZSBmb3VuZCBpbiB0aGUgcmVjZWl2ZXIuIFRoZQogICAgZGVmYXVsdCB2ZXJzaW9u
IHdpbGwgaXRlcmF0ZSB0aHJvdWdoIHRoZSBlbnVtZXJhYmxlIHVudGlsIHRoZSBvYmplY3QKICAg
IGlzIGZvdW5kLiBZb3UgbWF5IHdhbnQgdG8gb3ZlcnJpZGUgdGhpcyB3aXRoIGEgbW9yZSBlZmZp
Y2llbnQgdmVyc2lvbi4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgYXJyID0gWyJhIiwgImIi
LCAiYyJdOwogICAgYXJyLmNvbnRhaW5zKCJhIik7IC8vIHRydWUKICAgIGFyci5jb250YWlucygi
eiIpOyAvLyBmYWxzZQogICAgYGBgCgogICAgQG1ldGhvZCBjb250YWlucwogICAgQHBhcmFtIHtP
YmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHNlYXJjaCBmb3IuCiAgICBAcmV0dXJuIHtCb29sZWFu
fSBgdHJ1ZWAgaWYgb2JqZWN0IGlzIGZvdW5kIGluIGVudW1lcmFibGUuCiAgKi8KICBjb250YWlu
czogZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdGhpcy5maW5kKGZ1bmN0aW9uKGl0ZW0pIHsg
cmV0dXJuIGl0ZW09PT1vYmo7IH0pICE9PSB1bmRlZmluZWQ7CiAgfSwKCiAgLyoqCiAgICBJdGVy
YXRlcyB0aHJvdWdoIHRoZSBlbnVtZXJhYmxlLCBjYWxsaW5nIHRoZSBwYXNzZWQgZnVuY3Rpb24g
b24gZWFjaAogICAgaXRlbS4gVGhpcyBtZXRob2QgY29ycmVzcG9uZHMgdG8gdGhlIGBmb3JFYWNo
KClgIG1ldGhvZCBkZWZpbmVkIGluCiAgICBKYXZhU2NyaXB0IDEuNi4KCiAgICBUaGUgY2FsbGJh
Y2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJl
IChhbGwKICAgIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsKToKCiAgICBgYGBqYXZhc2NyaXB0CiAg
ICBmdW5jdGlvbihpdGVtLCBpbmRleCwgZW51bWVyYWJsZSk7CiAgICBgYGAKCiAgICAtIGBpdGVt
YCBpcyB0aGUgY3VycmVudCBpdGVtIGluIHRoZSBpdGVyYXRpb24uCiAgICAtIGBpbmRleGAgaXMg
dGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGl0ZXJhdGlvbi4KICAgIC0gYGVudW1lcmFibGVgIGlz
IHRoZSBlbnVtZXJhYmxlIG9iamVjdCBpdHNlbGYuCgogICAgTm90ZSB0aGF0IGluIGFkZGl0aW9u
IHRvIGEgY2FsbGJhY2ssIHlvdSBjYW4gYWxzbyBwYXNzIGFuIG9wdGlvbmFsIHRhcmdldAogICAg
b2JqZWN0IHRoYXQgd2lsbCBiZSBzZXQgYXMgYHRoaXNgIG9uIHRoZSBjb250ZXh0LiBUaGlzIGlz
IGEgZ29vZCB3YXkKICAgIHRvIGdpdmUgeW91ciBpdGVyYXRvciBmdW5jdGlvbiBhY2Nlc3MgdG8g
dGhlIGN1cnJlbnQgb2JqZWN0LgoKICAgIEBtZXRob2QgZm9yRWFjaAogICAgQHBhcmFtIHtGdW5j
dGlvbn0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGV4ZWN1dGUKICAgIEBwYXJhbSB7T2JqZWN0
fSBbdGFyZ2V0XSBUaGUgdGFyZ2V0IG9iamVjdCB0byB1c2UKICAgIEByZXR1cm4ge09iamVjdH0g
cmVjZWl2ZXIKICAqLwogIGZvckVhY2g6IGZ1bmN0aW9uKGNhbGxiYWNrLCB0YXJnZXQpIHsKICAg
IGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBUeXBlRXJyb3Io
KSA7CiAgICB2YXIgbGVuID0gZ2V0KHRoaXMsICdsZW5ndGgnKSwgbGFzdCA9IG51bGwsIGNvbnRl
eHQgPSBwb3BDdHgoKTsKCiAgICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQpIHRhcmdldCA9IG51
bGw7CgogICAgZm9yKHZhciBpZHg9MDtpZHg8bGVuO2lkeCsrKSB7CiAgICAgIHZhciBuZXh0ID0g
dGhpcy5uZXh0T2JqZWN0KGlkeCwgbGFzdCwgY29udGV4dCkgOwogICAgICBjYWxsYmFjay5jYWxs
KHRhcmdldCwgbmV4dCwgaWR4LCB0aGlzKTsKICAgICAgbGFzdCA9IG5leHQgOwogICAgfQogICAg
bGFzdCA9IG51bGwgOwogICAgY29udGV4dCA9IHB1c2hDdHgoY29udGV4dCk7CiAgICByZXR1cm4g
dGhpcyA7CiAgfSwKCiAgLyoqCiAgICBBbGlhcyBmb3IgYG1hcEJ5YAoKICAgIEBtZXRob2QgZ2V0
RWFjaAogICAgQHBhcmFtIHtTdHJpbmd9IGtleSBuYW1lIG9mIHRoZSBwcm9wZXJ0eQogICAgQHJl
dHVybiB7QXJyYXl9IFRoZSBtYXBwZWQgYXJyYXkuCiAgKi8KICBnZXRFYWNoOiBmdW5jdGlvbihr
ZXkpIHsKICAgIHJldHVybiB0aGlzLm1hcEJ5KGtleSk7CiAgfSwKCiAgLyoqCiAgICBTZXRzIHRo
ZSB2YWx1ZSBvbiB0aGUgbmFtZWQgcHJvcGVydHkgZm9yIGVhY2ggbWVtYmVyLiBUaGlzIGlzIG1v
cmUKICAgIGVmZmljaWVudCB0aGFuIHVzaW5nIG90aGVyIG1ldGhvZHMgZGVmaW5lZCBvbiB0aGlz
IGhlbHBlci4gSWYgdGhlIG9iamVjdAogICAgaW1wbGVtZW50cyBFbWJlci5PYnNlcnZhYmxlLCB0
aGUgdmFsdWUgd2lsbCBiZSBjaGFuZ2VkIHRvIGBzZXQoKSxgIG90aGVyd2lzZQogICAgaXQgd2ls
bCBiZSBzZXQgZGlyZWN0bHkuIGBudWxsYCBvYmplY3RzIGFyZSBza2lwcGVkLgoKICAgIEBtZXRo
b2Qgc2V0RWFjaAogICAgQHBhcmFtIHtTdHJpbmd9IGtleSBUaGUga2V5IHRvIHNldAogICAgQHBh
cmFtIHtPYmplY3R9IHZhbHVlIFRoZSBvYmplY3QgdG8gc2V0CiAgICBAcmV0dXJuIHtPYmplY3R9
IHJlY2VpdmVyCiAgKi8KICBzZXRFYWNoOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICByZXR1
cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgc2V0KGl0ZW0sIGtleSwgdmFs
dWUpOwogICAgfSk7CiAgfSwKCiAgLyoqCiAgICBNYXBzIGFsbCBvZiB0aGUgaXRlbXMgaW4gdGhl
IGVudW1lcmF0aW9uIHRvIGFub3RoZXIgdmFsdWUsIHJldHVybmluZwogICAgYSBuZXcgYXJyYXku
IFRoaXMgbWV0aG9kIGNvcnJlc3BvbmRzIHRvIGBtYXAoKWAgZGVmaW5lZCBpbiBKYXZhU2NyaXB0
IDEuNi4KCiAgICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3VsZCBoYXZlIHRo
ZSBmb2xsb3dpbmcgc2lnbmF0dXJlIChhbGwKICAgIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsKToK
CiAgICBgYGBqYXZhc2NyaXB0CiAgICBmdW5jdGlvbihpdGVtLCBpbmRleCwgZW51bWVyYWJsZSk7
CiAgICBgYGAKCiAgICAtIGBpdGVtYCBpcyB0aGUgY3VycmVudCBpdGVtIGluIHRoZSBpdGVyYXRp
b24uCiAgICAtIGBpbmRleGAgaXMgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGl0ZXJhdGlvbi4K
ICAgIC0gYGVudW1lcmFibGVgIGlzIHRoZSBlbnVtZXJhYmxlIG9iamVjdCBpdHNlbGYuCgogICAg
SXQgc2hvdWxkIHJldHVybiB0aGUgbWFwcGVkIHZhbHVlLgoKICAgIE5vdGUgdGhhdCBpbiBhZGRp
dGlvbiB0byBhIGNhbGxiYWNrLCB5b3UgY2FuIGFsc28gcGFzcyBhbiBvcHRpb25hbCB0YXJnZXQK
ICAgIG9iamVjdCB0aGF0IHdpbGwgYmUgc2V0IGFzIGB0aGlzYCBvbiB0aGUgY29udGV4dC4gVGhp
cyBpcyBhIGdvb2Qgd2F5CiAgICB0byBnaXZlIHlvdXIgaXRlcmF0b3IgZnVuY3Rpb24gYWNjZXNz
IHRvIHRoZSBjdXJyZW50IG9iamVjdC4KCiAgICBAbWV0aG9kIG1hcAogICAgQHBhcmFtIHtGdW5j
dGlvbn0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGV4ZWN1dGUKICAgIEBwYXJhbSB7T2JqZWN0
fSBbdGFyZ2V0XSBUaGUgdGFyZ2V0IG9iamVjdCB0byB1c2UKICAgIEByZXR1cm4ge0FycmF5fSBU
aGUgbWFwcGVkIGFycmF5LgogICovCiAgbWFwOiBmdW5jdGlvbihjYWxsYmFjaywgdGFyZ2V0KSB7
CiAgICB2YXIgcmV0ID0gRW1iZXIuQSgpOwogICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHgsIGlk
eCwgaSkgewogICAgICByZXRbaWR4XSA9IGNhbGxiYWNrLmNhbGwodGFyZ2V0LCB4LCBpZHgsaSk7
CiAgICB9KTsKICAgIHJldHVybiByZXQgOwogIH0sCgogIC8qKgogICAgU2ltaWxhciB0byBtYXAs
IHRoaXMgc3BlY2lhbGl6ZWQgZnVuY3Rpb24gcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG5hbWVk
CiAgICBwcm9wZXJ0eSBvbiBhbGwgaXRlbXMgaW4gdGhlIGVudW1lcmF0aW9uLgoKICAgIEBtZXRo
b2QgbWFwQnkKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgbmFtZSBvZiB0aGUgcHJvcGVydHkKICAg
IEByZXR1cm4ge0FycmF5fSBUaGUgbWFwcGVkIGFycmF5LgogICovCiAgbWFwQnk6IGZ1bmN0aW9u
KGtleSkgewogICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKG5leHQpIHsKICAgICAgcmV0dXJu
IGdldChuZXh0LCBrZXkpOwogICAgfSk7CiAgfSwKCiAgLyoqCiAgICBTaW1pbGFyIHRvIG1hcCwg
dGhpcyBzcGVjaWFsaXplZCBmdW5jdGlvbiByZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbmFtZWQK
ICAgIHByb3BlcnR5IG9uIGFsbCBpdGVtcyBpbiB0aGUgZW51bWVyYXRpb24uCgogICAgQG1ldGhv
ZCBtYXBQcm9wZXJ0eQogICAgQHBhcmFtIHtTdHJpbmd9IGtleSBuYW1lIG9mIHRoZSBwcm9wZXJ0
eQogICAgQHJldHVybiB7QXJyYXl9IFRoZSBtYXBwZWQgYXJyYXkuCiAgICBAZGVwcmVjYXRlZCBV
c2UgYG1hcEJ5YCBpbnN0ZWFkCiAgKi8KCiAgbWFwUHJvcGVydHk6IEVtYmVyLmFsaWFzTWV0aG9k
KCdtYXBCeScpLAoKICAvKioKICAgIFJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgb2YgdGhlIGl0
ZW1zIGluIHRoZSBlbnVtZXJhdGlvbiB0aGF0IHRoZSBwYXNzZWQKICAgIGZ1bmN0aW9uIHJldHVy
bnMgdHJ1ZSBmb3IuIFRoaXMgbWV0aG9kIGNvcnJlc3BvbmRzIHRvIGBmaWx0ZXIoKWAgZGVmaW5l
ZCBpbgogICAgSmF2YVNjcmlwdCAxLjYuCgogICAgVGhlIGNhbGxiYWNrIG1ldGhvZCB5b3UgcHJv
dmlkZSBzaG91bGQgaGF2ZSB0aGUgZm9sbG93aW5nIHNpZ25hdHVyZSAoYWxsCiAgICBwYXJhbWV0
ZXJzIGFyZSBvcHRpb25hbCk6CgogICAgYGBgamF2YXNjcmlwdAogICAgZnVuY3Rpb24oaXRlbSwg
aW5kZXgsIGVudW1lcmFibGUpOwogICAgYGBgCgogICAgLSBgaXRlbWAgaXMgdGhlIGN1cnJlbnQg
aXRlbSBpbiB0aGUgaXRlcmF0aW9uLgogICAgLSBgaW5kZXhgIGlzIHRoZSBjdXJyZW50IGluZGV4
IGluIHRoZSBpdGVyYXRpb24uCiAgICAtIGBlbnVtZXJhYmxlYCBpcyB0aGUgZW51bWVyYWJsZSBv
YmplY3QgaXRzZWxmLgoKICAgIEl0IHNob3VsZCByZXR1cm4gdGhlIGB0cnVlYCB0byBpbmNsdWRl
IHRoZSBpdGVtIGluIHRoZSByZXN1bHRzLCBgZmFsc2VgCiAgICBvdGhlcndpc2UuCgogICAgTm90
ZSB0aGF0IGluIGFkZGl0aW9uIHRvIGEgY2FsbGJhY2ssIHlvdSBjYW4gYWxzbyBwYXNzIGFuIG9w
dGlvbmFsIHRhcmdldAogICAgb2JqZWN0IHRoYXQgd2lsbCBiZSBzZXQgYXMgYHRoaXNgIG9uIHRo
ZSBjb250ZXh0LiBUaGlzIGlzIGEgZ29vZCB3YXkKICAgIHRvIGdpdmUgeW91ciBpdGVyYXRvciBm
dW5jdGlvbiBhY2Nlc3MgdG8gdGhlIGN1cnJlbnQgb2JqZWN0LgoKICAgIEBtZXRob2QgZmlsdGVy
CiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdG8gZXhlY3V0ZQog
ICAgQHBhcmFtIHtPYmplY3R9IFt0YXJnZXRdIFRoZSB0YXJnZXQgb2JqZWN0IHRvIHVzZQogICAg
QHJldHVybiB7QXJyYXl9IEEgZmlsdGVyZWQgYXJyYXkuCiAgKi8KICBmaWx0ZXI6IGZ1bmN0aW9u
KGNhbGxiYWNrLCB0YXJnZXQpIHsKICAgIHZhciByZXQgPSBFbWJlci5BKCk7CiAgICB0aGlzLmZv
ckVhY2goZnVuY3Rpb24oeCwgaWR4LCBpKSB7CiAgICAgIGlmIChjYWxsYmFjay5jYWxsKHRhcmdl
dCwgeCwgaWR4LCBpKSkgcmV0LnB1c2goeCk7CiAgICB9KTsKICAgIHJldHVybiByZXQgOwogIH0s
CgogIC8qKgogICAgUmV0dXJucyBhbiBhcnJheSB3aXRoIGFsbCBvZiB0aGUgaXRlbXMgaW4gdGhl
IGVudW1lcmF0aW9uIHdoZXJlIHRoZSBwYXNzZWQKICAgIGZ1bmN0aW9uIHJldHVybnMgZmFsc2Ug
Zm9yLiBUaGlzIG1ldGhvZCBpcyB0aGUgaW52ZXJzZSBvZiBmaWx0ZXIoKS4KCiAgICBUaGUgY2Fs
bGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0
dXJlIChhbGwKICAgIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsKToKCiAgICBgYGBqYXZhc2NyaXB0
CiAgICBmdW5jdGlvbihpdGVtLCBpbmRleCwgZW51bWVyYWJsZSk7CiAgICBgYGAKCiAgICAtICpp
dGVtKiBpcyB0aGUgY3VycmVudCBpdGVtIGluIHRoZSBpdGVyYXRpb24uCiAgICAtICppbmRleCog
aXMgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGl0ZXJhdGlvbgogICAgLSAqZW51bWVyYWJsZSog
aXMgdGhlIGVudW1lcmFibGUgb2JqZWN0IGl0c2VsZi4KCiAgICBJdCBzaG91bGQgcmV0dXJuIHRo
ZSBhIGZhbHNleSB2YWx1ZSB0byBpbmNsdWRlIHRoZSBpdGVtIGluIHRoZSByZXN1bHRzLgoKICAg
IE5vdGUgdGhhdCBpbiBhZGRpdGlvbiB0byBhIGNhbGxiYWNrLCB5b3UgY2FuIGFsc28gcGFzcyBh
biBvcHRpb25hbCB0YXJnZXQKICAgIG9iamVjdCB0aGF0IHdpbGwgYmUgc2V0IGFzICJ0aGlzIiBv
biB0aGUgY29udGV4dC4gVGhpcyBpcyBhIGdvb2Qgd2F5CiAgICB0byBnaXZlIHlvdXIgaXRlcmF0
b3IgZnVuY3Rpb24gYWNjZXNzIHRvIHRoZSBjdXJyZW50IG9iamVjdC4KCiAgICBAbWV0aG9kIHJl
amVjdAogICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGV4ZWN1
dGUKICAgIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSBUaGUgdGFyZ2V0IG9iamVjdCB0byB1c2UK
ICAgIEByZXR1cm4ge0FycmF5fSBBIHJlamVjdGVkIGFycmF5LgogICAqLwogIHJlamVjdDogZnVu
Y3Rpb24oY2FsbGJhY2ssIHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9u
KCkgewogICAgICByZXR1cm4gIShjYWxsYmFjay5hcHBseSh0YXJnZXQsIGFyZ3VtZW50cykpOwog
ICAgfSk7CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIGFuIGFycmF5IHdpdGgganVzdCB0aGUgaXRl
bXMgd2l0aCB0aGUgbWF0Y2hlZCBwcm9wZXJ0eS4gWW91CiAgICBjYW4gcGFzcyBhbiBvcHRpb25h
bCBzZWNvbmQgYXJndW1lbnQgd2l0aCB0aGUgdGFyZ2V0IHZhbHVlLiBPdGhlcndpc2UKICAgIHRo
aXMgd2lsbCBtYXRjaCBhbnkgcHJvcGVydHkgdGhhdCBldmFsdWF0ZXMgdG8gYHRydWVgLgoKICAg
IEBtZXRob2QgZmlsdGVyQnkKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgdGhlIHByb3BlcnR5IHRv
IHRlc3QKICAgIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWVdIG9wdGlvbmFsIHZhbHVlIHRvIHRlc3Qg
YWdhaW5zdC4KICAgIEByZXR1cm4ge0FycmF5fSBmaWx0ZXJlZCBhcnJheQogICovCiAgZmlsdGVy
Qnk6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIHJldHVybiB0aGlzLmZpbHRlcihpdGVyLmFw
cGx5KHRoaXMsIGFyZ3VtZW50cykpOwogIH0sCgogIC8qKgogICAgUmV0dXJucyBhbiBhcnJheSB3
aXRoIGp1c3QgdGhlIGl0ZW1zIHdpdGggdGhlIG1hdGNoZWQgcHJvcGVydHkuIFlvdQogICAgY2Fu
IHBhc3MgYW4gb3B0aW9uYWwgc2Vjb25kIGFyZ3VtZW50IHdpdGggdGhlIHRhcmdldCB2YWx1ZS4g
T3RoZXJ3aXNlCiAgICB0aGlzIHdpbGwgbWF0Y2ggYW55IHByb3BlcnR5IHRoYXQgZXZhbHVhdGVz
IHRvIGB0cnVlYC4KCiAgICBAbWV0aG9kIGZpbHRlclByb3BlcnR5CiAgICBAcGFyYW0ge1N0cmlu
Z30ga2V5IHRoZSBwcm9wZXJ0eSB0byB0ZXN0CiAgICBAcGFyYW0ge1N0cmluZ30gW3ZhbHVlXSBv
cHRpb25hbCB2YWx1ZSB0byB0ZXN0IGFnYWluc3QuCiAgICBAcmV0dXJuIHtBcnJheX0gZmlsdGVy
ZWQgYXJyYXkKICAgIEBkZXByZWNhdGVkIFVzZSBgZmlsdGVyQnlgIGluc3RlYWQKICAqLwogIGZp
bHRlclByb3BlcnR5OiBFbWJlci5hbGlhc01ldGhvZCgnZmlsdGVyQnknKSwKCiAgLyoqCiAgICBS
ZXR1cm5zIGFuIGFycmF5IHdpdGggdGhlIGl0ZW1zIHRoYXQgZG8gbm90IGhhdmUgdHJ1dGh5IHZh
bHVlcyBmb3IKICAgIGtleS4gIFlvdSBjYW4gcGFzcyBhbiBvcHRpb25hbCBzZWNvbmQgYXJndW1l
bnQgd2l0aCB0aGUgdGFyZ2V0IHZhbHVlLiAgT3RoZXJ3aXNlCiAgICB0aGlzIHdpbGwgbWF0Y2gg
YW55IHByb3BlcnR5IHRoYXQgZXZhbHVhdGVzIHRvIGZhbHNlLgoKICAgIEBtZXRob2QgcmVqZWN0
QnkKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgdGhlIHByb3BlcnR5IHRvIHRlc3QKICAgIEBwYXJh
bSB7U3RyaW5nfSBbdmFsdWVdIG9wdGlvbmFsIHZhbHVlIHRvIHRlc3QgYWdhaW5zdC4KICAgIEBy
ZXR1cm4ge0FycmF5fSByZWplY3RlZCBhcnJheQogICovCiAgcmVqZWN0Qnk6IGZ1bmN0aW9uKGtl
eSwgdmFsdWUpIHsKICAgIHZhciBleGFjdFZhbHVlID0gZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4g
Z2V0KGl0ZW0sIGtleSkgPT09IHZhbHVlOyB9LAogICAgICAgIGhhc1ZhbHVlID0gZnVuY3Rpb24o
aXRlbSkgeyByZXR1cm4gISFnZXQoaXRlbSwga2V5KTsgfSwKICAgICAgICB1c2UgPSAoYXJndW1l
bnRzLmxlbmd0aCA9PT0gMiA/IGV4YWN0VmFsdWUgOiBoYXNWYWx1ZSk7CgogICAgcmV0dXJuIHRo
aXMucmVqZWN0KHVzZSk7CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIGFuIGFycmF5IHdpdGggdGhl
IGl0ZW1zIHRoYXQgZG8gbm90IGhhdmUgdHJ1dGh5IHZhbHVlcyBmb3IKICAgIGtleS4gIFlvdSBj
YW4gcGFzcyBhbiBvcHRpb25hbCBzZWNvbmQgYXJndW1lbnQgd2l0aCB0aGUgdGFyZ2V0IHZhbHVl
LiAgT3RoZXJ3aXNlCiAgICB0aGlzIHdpbGwgbWF0Y2ggYW55IHByb3BlcnR5IHRoYXQgZXZhbHVh
dGVzIHRvIGZhbHNlLgoKICAgIEBtZXRob2QgcmVqZWN0UHJvcGVydHkKICAgIEBwYXJhbSB7U3Ry
aW5nfSBrZXkgdGhlIHByb3BlcnR5IHRvIHRlc3QKICAgIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWVd
IG9wdGlvbmFsIHZhbHVlIHRvIHRlc3QgYWdhaW5zdC4KICAgIEByZXR1cm4ge0FycmF5fSByZWpl
Y3RlZCBhcnJheQogICAgQGRlcHJlY2F0ZWQgVXNlIGByZWplY3RCeWAgaW5zdGVhZAogICovCiAg
cmVqZWN0UHJvcGVydHk6IEVtYmVyLmFsaWFzTWV0aG9kKCdyZWplY3RCeScpLAoKICAvKioKICAg
IFJldHVybnMgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIGFycmF5IGZvciB3aGljaCB0aGUgY2FsbGJh
Y2sgcmV0dXJucyB0cnVlLgogICAgVGhpcyBtZXRob2Qgd29ya3Mgc2ltaWxhciB0byB0aGUgYGZp
bHRlcigpYCBtZXRob2QgZGVmaW5lZCBpbiBKYXZhU2NyaXB0IDEuNgogICAgZXhjZXB0IHRoYXQg
aXQgd2lsbCBzdG9wIHdvcmtpbmcgb24gdGhlIGFycmF5IG9uY2UgYSBtYXRjaCBpcyBmb3VuZC4K
CiAgICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3VsZCBoYXZlIHRoZSBmb2xs
b3dpbmcgc2lnbmF0dXJlIChhbGwKICAgIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsKToKCiAgICBg
YGBqYXZhc2NyaXB0CiAgICBmdW5jdGlvbihpdGVtLCBpbmRleCwgZW51bWVyYWJsZSk7CiAgICBg
YGAKCiAgICAtIGBpdGVtYCBpcyB0aGUgY3VycmVudCBpdGVtIGluIHRoZSBpdGVyYXRpb24uCiAg
ICAtIGBpbmRleGAgaXMgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGl0ZXJhdGlvbi4KICAgIC0g
YGVudW1lcmFibGVgIGlzIHRoZSBlbnVtZXJhYmxlIG9iamVjdCBpdHNlbGYuCgogICAgSXQgc2hv
dWxkIHJldHVybiB0aGUgYHRydWVgIHRvIGluY2x1ZGUgdGhlIGl0ZW0gaW4gdGhlIHJlc3VsdHMs
IGBmYWxzZWAKICAgIG90aGVyd2lzZS4KCiAgICBOb3RlIHRoYXQgaW4gYWRkaXRpb24gdG8gYSBj
YWxsYmFjaywgeW91IGNhbiBhbHNvIHBhc3MgYW4gb3B0aW9uYWwgdGFyZ2V0CiAgICBvYmplY3Qg
dGhhdCB3aWxsIGJlIHNldCBhcyBgdGhpc2Agb24gdGhlIGNvbnRleHQuIFRoaXMgaXMgYSBnb29k
IHdheQogICAgdG8gZ2l2ZSB5b3VyIGl0ZXJhdG9yIGZ1bmN0aW9uIGFjY2VzcyB0byB0aGUgY3Vy
cmVudCBvYmplY3QuCgogICAgQG1ldGhvZCBmaW5kCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxs
YmFjayBUaGUgY2FsbGJhY2sgdG8gZXhlY3V0ZQogICAgQHBhcmFtIHtPYmplY3R9IFt0YXJnZXRd
IFRoZSB0YXJnZXQgb2JqZWN0IHRvIHVzZQogICAgQHJldHVybiB7T2JqZWN0fSBGb3VuZCBpdGVt
IG9yIGB1bmRlZmluZWRgLgogICovCiAgZmluZDogZnVuY3Rpb24oY2FsbGJhY2ssIHRhcmdldCkg
ewogICAgdmFyIGxlbiA9IGdldCh0aGlzLCAnbGVuZ3RoJykgOwogICAgaWYgKHRhcmdldCA9PT0g
dW5kZWZpbmVkKSB0YXJnZXQgPSBudWxsOwoKICAgIHZhciBsYXN0ID0gbnVsbCwgbmV4dCwgZm91
bmQgPSBmYWxzZSwgcmV0IDsKICAgIHZhciBjb250ZXh0ID0gcG9wQ3R4KCk7CiAgICBmb3IodmFy
IGlkeD0wO2lkeDxsZW4gJiYgIWZvdW5kO2lkeCsrKSB7CiAgICAgIG5leHQgPSB0aGlzLm5leHRP
YmplY3QoaWR4LCBsYXN0LCBjb250ZXh0KSA7CiAgICAgIGlmIChmb3VuZCA9IGNhbGxiYWNrLmNh
bGwodGFyZ2V0LCBuZXh0LCBpZHgsIHRoaXMpKSByZXQgPSBuZXh0IDsKICAgICAgbGFzdCA9IG5l
eHQgOwogICAgfQogICAgbmV4dCA9IGxhc3QgPSBudWxsIDsKICAgIGNvbnRleHQgPSBwdXNoQ3R4
KGNvbnRleHQpOwogICAgcmV0dXJuIHJldCA7CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRoZSBm
aXJzdCBpdGVtIHdpdGggYSBwcm9wZXJ0eSBtYXRjaGluZyB0aGUgcGFzc2VkIHZhbHVlLiBZb3UK
ICAgIGNhbiBwYXNzIGFuIG9wdGlvbmFsIHNlY29uZCBhcmd1bWVudCB3aXRoIHRoZSB0YXJnZXQg
dmFsdWUuIE90aGVyd2lzZQogICAgdGhpcyB3aWxsIG1hdGNoIGFueSBwcm9wZXJ0eSB0aGF0IGV2
YWx1YXRlcyB0byBgdHJ1ZWAuCgogICAgVGhpcyBtZXRob2Qgd29ya3MgbXVjaCBsaWtlIHRoZSBt
b3JlIGdlbmVyaWMgYGZpbmQoKWAgbWV0aG9kLgoKICAgIEBtZXRob2QgZmluZEJ5CiAgICBAcGFy
YW0ge1N0cmluZ30ga2V5IHRoZSBwcm9wZXJ0eSB0byB0ZXN0CiAgICBAcGFyYW0ge1N0cmluZ30g
W3ZhbHVlXSBvcHRpb25hbCB2YWx1ZSB0byB0ZXN0IGFnYWluc3QuCiAgICBAcmV0dXJuIHtPYmpl
Y3R9IGZvdW5kIGl0ZW0gb3IgYHVuZGVmaW5lZGAKICAqLwogIGZpbmRCeTogZnVuY3Rpb24oa2V5
LCB2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmluZChpdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50
cykpOwogIH0sCgogIC8qKgogICAgUmV0dXJucyB0aGUgZmlyc3QgaXRlbSB3aXRoIGEgcHJvcGVy
dHkgbWF0Y2hpbmcgdGhlIHBhc3NlZCB2YWx1ZS4gWW91CiAgICBjYW4gcGFzcyBhbiBvcHRpb25h
bCBzZWNvbmQgYXJndW1lbnQgd2l0aCB0aGUgdGFyZ2V0IHZhbHVlLiBPdGhlcndpc2UKICAgIHRo
aXMgd2lsbCBtYXRjaCBhbnkgcHJvcGVydHkgdGhhdCBldmFsdWF0ZXMgdG8gYHRydWVgLgoKICAg
IFRoaXMgbWV0aG9kIHdvcmtzIG11Y2ggbGlrZSB0aGUgbW9yZSBnZW5lcmljIGBmaW5kKClgIG1l
dGhvZC4KCiAgICBAbWV0aG9kIGZpbmRQcm9wZXJ0eQogICAgQHBhcmFtIHtTdHJpbmd9IGtleSB0
aGUgcHJvcGVydHkgdG8gdGVzdAogICAgQHBhcmFtIHtTdHJpbmd9IFt2YWx1ZV0gb3B0aW9uYWwg
dmFsdWUgdG8gdGVzdCBhZ2FpbnN0LgogICAgQHJldHVybiB7T2JqZWN0fSBmb3VuZCBpdGVtIG9y
IGB1bmRlZmluZWRgCiAgICBAZGVwcmVjYXRlZCBVc2UgYGZpbmRCeWAgaW5zdGVhZAogICovCiAg
ZmluZFByb3BlcnR5OiBFbWJlci5hbGlhc01ldGhvZCgnZmluZEJ5JyksCgogIC8qKgogICAgUmV0
dXJucyBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBmdW5jdGlvbiByZXR1cm5zIHRydWUgZm9yIGV2ZXJ5
IGl0ZW0gaW4gdGhlCiAgICBlbnVtZXJhdGlvbi4gVGhpcyBjb3JyZXNwb25kcyB3aXRoIHRoZSBg
ZXZlcnkoKWAgbWV0aG9kIGluIEphdmFTY3JpcHQgMS42LgoKICAgIFRoZSBjYWxsYmFjayBtZXRo
b2QgeW91IHByb3ZpZGUgc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBzaWduYXR1cmUgKGFsbAog
ICAgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwpOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIGZ1bmN0
aW9uKGl0ZW0sIGluZGV4LCBlbnVtZXJhYmxlKTsKICAgIGBgYAoKICAgIC0gYGl0ZW1gIGlzIHRo
ZSBjdXJyZW50IGl0ZW0gaW4gdGhlIGl0ZXJhdGlvbi4KICAgIC0gYGluZGV4YCBpcyB0aGUgY3Vy
cmVudCBpbmRleCBpbiB0aGUgaXRlcmF0aW9uLgogICAgLSBgZW51bWVyYWJsZWAgaXMgdGhlIGVu
dW1lcmFibGUgb2JqZWN0IGl0c2VsZi4KCiAgICBJdCBzaG91bGQgcmV0dXJuIHRoZSBgdHJ1ZWAg
b3IgYGZhbHNlYC4KCiAgICBOb3RlIHRoYXQgaW4gYWRkaXRpb24gdG8gYSBjYWxsYmFjaywgeW91
IGNhbiBhbHNvIHBhc3MgYW4gb3B0aW9uYWwgdGFyZ2V0CiAgICBvYmplY3QgdGhhdCB3aWxsIGJl
IHNldCBhcyBgdGhpc2Agb24gdGhlIGNvbnRleHQuIFRoaXMgaXMgYSBnb29kIHdheQogICAgdG8g
Z2l2ZSB5b3VyIGl0ZXJhdG9yIGZ1bmN0aW9uIGFjY2VzcyB0byB0aGUgY3VycmVudCBvYmplY3Qu
CgogICAgRXhhbXBsZSBVc2FnZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBpZiAocGVvcGxlLmV2
ZXJ5KGlzRW5naW5lZXIpKSB7IFBheWNoZWNrcy5hZGRCaWdCb251cygpOyB9CiAgICBgYGAKCiAg
ICBAbWV0aG9kIGV2ZXJ5CiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgY2FsbGJh
Y2sgdG8gZXhlY3V0ZQogICAgQHBhcmFtIHtPYmplY3R9IFt0YXJnZXRdIFRoZSB0YXJnZXQgb2Jq
ZWN0IHRvIHVzZQogICAgQHJldHVybiB7Qm9vbGVhbn0KICAqLwogIGV2ZXJ5OiBmdW5jdGlvbihj
YWxsYmFjaywgdGFyZ2V0KSB7CiAgICByZXR1cm4gIXRoaXMuZmluZChmdW5jdGlvbih4LCBpZHgs
IGkpIHsKICAgICAgcmV0dXJuICFjYWxsYmFjay5jYWxsKHRhcmdldCwgeCwgaWR4LCBpKTsKICAg
IH0pOwogIH0sCgogIC8qKgogICAgQG1ldGhvZCBldmVyeUJ5CiAgICBAcGFyYW0ge1N0cmluZ30g
a2V5IHRoZSBwcm9wZXJ0eSB0byB0ZXN0CiAgICBAcGFyYW0ge1N0cmluZ30gW3ZhbHVlXSBvcHRp
b25hbCB2YWx1ZSB0byB0ZXN0IGFnYWluc3QuCiAgICBAZGVwcmVjYXRlZCBVc2UgYGlzRXZlcnlg
IGluc3RlYWQKICAgIEByZXR1cm4ge0Jvb2xlYW59CiAgKi8KICBldmVyeUJ5OiBFbWJlci5hbGlh
c01ldGhvZCgnaXNFdmVyeScpLAoKICAvKioKICAgIEBtZXRob2QgZXZlcnlQcm9wZXJ0eQogICAg
QHBhcmFtIHtTdHJpbmd9IGtleSB0aGUgcHJvcGVydHkgdG8gdGVzdAogICAgQHBhcmFtIHtTdHJp
bmd9IFt2YWx1ZV0gb3B0aW9uYWwgdmFsdWUgdG8gdGVzdCBhZ2FpbnN0LgogICAgQGRlcHJlY2F0
ZWQgVXNlIGBpc0V2ZXJ5YCBpbnN0ZWFkCiAgICBAcmV0dXJuIHtCb29sZWFufQogICovCiAgZXZl
cnlQcm9wZXJ0eTogRW1iZXIuYWxpYXNNZXRob2QoJ2lzRXZlcnknKSwKCiAgLyoqCiAgICBSZXR1
cm5zIGB0cnVlYCBpZiB0aGUgcGFzc2VkIHByb3BlcnR5IHJlc29sdmVzIHRvIGB0cnVlYCBmb3Ig
YWxsIGl0ZW1zIGluCiAgICB0aGUgZW51bWVyYWJsZS4gVGhpcyBtZXRob2QgaXMgb2Z0ZW4gc2lt
cGxlci9mYXN0ZXIgdGhhbiB1c2luZyBhIGNhbGxiYWNrLgoKICAgIEBtZXRob2QgaXNFdmVyeQog
ICAgQHBhcmFtIHtTdHJpbmd9IGtleSB0aGUgcHJvcGVydHkgdG8gdGVzdAogICAgQHBhcmFtIHtT
dHJpbmd9IFt2YWx1ZV0gb3B0aW9uYWwgdmFsdWUgdG8gdGVzdCBhZ2FpbnN0LgogICAgQHJldHVy
biB7Qm9vbGVhbn0KICAqLwogIGlzRXZlcnk6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIHJl
dHVybiB0aGlzLmV2ZXJ5KGl0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgfSwKCiAgLyoq
CiAgICBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgcGFzc2VkIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZSBm
b3IgYW55IGl0ZW0gaW4gdGhlCiAgICBlbnVtZXJhdGlvbi4gVGhpcyBjb3JyZXNwb25kcyB3aXRo
IHRoZSBgc29tZSgpYCBtZXRob2QgaW4gSmF2YVNjcmlwdCAxLjYuCgogICAgVGhlIGNhbGxiYWNr
IG1ldGhvZCB5b3UgcHJvdmlkZSBzaG91bGQgaGF2ZSB0aGUgZm9sbG93aW5nIHNpZ25hdHVyZSAo
YWxsCiAgICBwYXJhbWV0ZXJzIGFyZSBvcHRpb25hbCk6CgogICAgYGBgamF2YXNjcmlwdAogICAg
ZnVuY3Rpb24oaXRlbSwgaW5kZXgsIGVudW1lcmFibGUpOwogICAgYGBgCgogICAgLSBgaXRlbWAg
aXMgdGhlIGN1cnJlbnQgaXRlbSBpbiB0aGUgaXRlcmF0aW9uLgogICAgLSBgaW5kZXhgIGlzIHRo
ZSBjdXJyZW50IGluZGV4IGluIHRoZSBpdGVyYXRpb24uCiAgICAtIGBlbnVtZXJhYmxlYCBpcyB0
aGUgZW51bWVyYWJsZSBvYmplY3QgaXRzZWxmLgoKICAgIEl0IHNob3VsZCByZXR1cm4gdGhlIGB0
cnVlYCB0byBpbmNsdWRlIHRoZSBpdGVtIGluIHRoZSByZXN1bHRzLCBgZmFsc2VgCiAgICBvdGhl
cndpc2UuCgogICAgTm90ZSB0aGF0IGluIGFkZGl0aW9uIHRvIGEgY2FsbGJhY2ssIHlvdSBjYW4g
YWxzbyBwYXNzIGFuIG9wdGlvbmFsIHRhcmdldAogICAgb2JqZWN0IHRoYXQgd2lsbCBiZSBzZXQg
YXMgYHRoaXNgIG9uIHRoZSBjb250ZXh0LiBUaGlzIGlzIGEgZ29vZCB3YXkKICAgIHRvIGdpdmUg
eW91ciBpdGVyYXRvciBmdW5jdGlvbiBhY2Nlc3MgdG8gdGhlIGN1cnJlbnQgb2JqZWN0LgoKICAg
IFVzYWdlIEV4YW1wbGU6CgogICAgYGBgamF2YXNjcmlwdAogICAgaWYgKHBlb3BsZS5hbnkoaXNN
YW5hZ2VyKSkgeyBQYXljaGVja3MuYWRkQmlnZ2VyQm9udXMoKTsgfQogICAgYGBgCgogICAgQG1l
dGhvZCBhbnkKICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBl
eGVjdXRlCiAgICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIHRhcmdldCBvYmplY3QgdG8g
dXNlCiAgICBAcmV0dXJuIHtCb29sZWFufSBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBmdW5jdGlvbiBy
ZXR1cm5zIGB0cnVlYCBmb3IgYW55IGl0ZW0KICAqLwogIGFueTogZnVuY3Rpb24oY2FsbGJhY2ss
IHRhcmdldCkgewogICAgdmFyIGZvdW5kID0gdGhpcy5maW5kKGZ1bmN0aW9uKHgsIGlkeCwgaSkg
ewogICAgICByZXR1cm4gISFjYWxsYmFjay5jYWxsKHRhcmdldCwgeCwgaWR4LCBpKTsKICAgIH0p
OwoKICAgIHJldHVybiB0eXBlb2YgZm91bmQgIT09ICd1bmRlZmluZWQnOwogIH0sCgogIC8qKgog
ICAgUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBmdW5jdGlvbiByZXR1cm5zIHRydWUgZm9y
IGFueSBpdGVtIGluIHRoZQogICAgZW51bWVyYXRpb24uIFRoaXMgY29ycmVzcG9uZHMgd2l0aCB0
aGUgYHNvbWUoKWAgbWV0aG9kIGluIEphdmFTY3JpcHQgMS42LgoKICAgIFRoZSBjYWxsYmFjayBt
ZXRob2QgeW91IHByb3ZpZGUgc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBzaWduYXR1cmUgKGFs
bAogICAgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwpOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIGZ1
bmN0aW9uKGl0ZW0sIGluZGV4LCBlbnVtZXJhYmxlKTsKICAgIGBgYAoKICAgIC0gYGl0ZW1gIGlz
IHRoZSBjdXJyZW50IGl0ZW0gaW4gdGhlIGl0ZXJhdGlvbi4KICAgIC0gYGluZGV4YCBpcyB0aGUg
Y3VycmVudCBpbmRleCBpbiB0aGUgaXRlcmF0aW9uLgogICAgLSBgZW51bWVyYWJsZWAgaXMgdGhl
IGVudW1lcmFibGUgb2JqZWN0IGl0c2VsZi4KCiAgICBJdCBzaG91bGQgcmV0dXJuIHRoZSBgdHJ1
ZWAgdG8gaW5jbHVkZSB0aGUgaXRlbSBpbiB0aGUgcmVzdWx0cywgYGZhbHNlYAogICAgb3RoZXJ3
aXNlLgoKICAgIE5vdGUgdGhhdCBpbiBhZGRpdGlvbiB0byBhIGNhbGxiYWNrLCB5b3UgY2FuIGFs
c28gcGFzcyBhbiBvcHRpb25hbCB0YXJnZXQKICAgIG9iamVjdCB0aGF0IHdpbGwgYmUgc2V0IGFz
IGB0aGlzYCBvbiB0aGUgY29udGV4dC4gVGhpcyBpcyBhIGdvb2Qgd2F5CiAgICB0byBnaXZlIHlv
dXIgaXRlcmF0b3IgZnVuY3Rpb24gYWNjZXNzIHRvIHRoZSBjdXJyZW50IG9iamVjdC4KCiAgICBV
c2FnZSBFeGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIGlmIChwZW9wbGUuc29tZShpc01h
bmFnZXIpKSB7IFBheWNoZWNrcy5hZGRCaWdnZXJCb251cygpOyB9CiAgICBgYGAKCiAgICBAbWV0
aG9kIHNvbWUKICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBl
eGVjdXRlCiAgICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIHRhcmdldCBvYmplY3QgdG8g
dXNlCiAgICBAcmV0dXJuIHtCb29sZWFufSBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBmdW5jdGlvbiBy
ZXR1cm5zIGB0cnVlYCBmb3IgYW55IGl0ZW0KICAgIEBkZXByZWNhdGVkIFVzZSBgYW55YCBpbnN0
ZWFkCiAgKi8KICBzb21lOiBFbWJlci5hbGlhc01ldGhvZCgnYW55JyksCgogIC8qKgogICAgUmV0
dXJucyBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBwcm9wZXJ0eSByZXNvbHZlcyB0byBgdHJ1ZWAgZm9y
IGFueSBpdGVtIGluCiAgICB0aGUgZW51bWVyYWJsZS4gVGhpcyBtZXRob2QgaXMgb2Z0ZW4gc2lt
cGxlci9mYXN0ZXIgdGhhbiB1c2luZyBhIGNhbGxiYWNrLgoKICAgIEBtZXRob2QgaXNBbnkKICAg
IEBwYXJhbSB7U3RyaW5nfSBrZXkgdGhlIHByb3BlcnR5IHRvIHRlc3QKICAgIEBwYXJhbSB7U3Ry
aW5nfSBbdmFsdWVdIG9wdGlvbmFsIHZhbHVlIHRvIHRlc3QgYWdhaW5zdC4KICAgIEByZXR1cm4g
e0Jvb2xlYW59IGB0cnVlYCBpZiB0aGUgcGFzc2VkIGZ1bmN0aW9uIHJldHVybnMgYHRydWVgIGZv
ciBhbnkgaXRlbQogICovCiAgaXNBbnk6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIHJldHVy
biB0aGlzLmFueShpdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogIH0sCgogIC8qKgogICAg
QG1ldGhvZCBhbnlCeQogICAgQHBhcmFtIHtTdHJpbmd9IGtleSB0aGUgcHJvcGVydHkgdG8gdGVz
dAogICAgQHBhcmFtIHtTdHJpbmd9IFt2YWx1ZV0gb3B0aW9uYWwgdmFsdWUgdG8gdGVzdCBhZ2Fp
bnN0LgogICAgQHJldHVybiB7Qm9vbGVhbn0gYHRydWVgIGlmIHRoZSBwYXNzZWQgZnVuY3Rpb24g
cmV0dXJucyBgdHJ1ZWAgZm9yIGFueSBpdGVtCiAgICBAZGVwcmVjYXRlZCBVc2UgYGlzQW55YCBp
bnN0ZWFkCiAgKi8KICBhbnlCeTogRW1iZXIuYWxpYXNNZXRob2QoJ2lzQW55JyksCgogIC8qKgog
ICAgQG1ldGhvZCBzb21lUHJvcGVydHkKICAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgdGhlIHByb3Bl
cnR5IHRvIHRlc3QKICAgIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWVdIG9wdGlvbmFsIHZhbHVlIHRv
IHRlc3QgYWdhaW5zdC4KICAgIEByZXR1cm4ge0Jvb2xlYW59IGB0cnVlYCBpZiB0aGUgcGFzc2Vk
IGZ1bmN0aW9uIHJldHVybnMgYHRydWVgIGZvciBhbnkgaXRlbQogICAgQGRlcHJlY2F0ZWQgVXNl
IGBpc0FueWAgaW5zdGVhZAogICovCiAgc29tZVByb3BlcnR5OiBFbWJlci5hbGlhc01ldGhvZCgn
aXNBbnknKSwKCiAgLyoqCiAgICBUaGlzIHdpbGwgY29tYmluZSB0aGUgdmFsdWVzIG9mIHRoZSBl
bnVtZXJhdG9yIGludG8gYSBzaW5nbGUgdmFsdWUuIEl0CiAgICBpcyBhIHVzZWZ1bCB3YXkgdG8g
Y29sbGVjdCBhIHN1bW1hcnkgdmFsdWUgZnJvbSBhbiBlbnVtZXJhdGlvbi4gVGhpcwogICAgY29y
cmVzcG9uZHMgdG8gdGhlIGByZWR1Y2UoKWAgbWV0aG9kIGRlZmluZWQgaW4gSmF2YVNjcmlwdCAx
LjguCgogICAgVGhlIGNhbGxiYWNrIG1ldGhvZCB5b3UgcHJvdmlkZSBzaG91bGQgaGF2ZSB0aGUg
Zm9sbG93aW5nIHNpZ25hdHVyZSAoYWxsCiAgICBwYXJhbWV0ZXJzIGFyZSBvcHRpb25hbCk6Cgog
ICAgYGBgamF2YXNjcmlwdAogICAgZnVuY3Rpb24ocHJldmlvdXNWYWx1ZSwgaXRlbSwgaW5kZXgs
IGVudW1lcmFibGUpOwogICAgYGBgCgogICAgLSBgcHJldmlvdXNWYWx1ZWAgaXMgdGhlIHZhbHVl
IHJldHVybmVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8gdGhlIGl0ZXJhdG9yLgogICAgLSBgaXRlbWAg
aXMgdGhlIGN1cnJlbnQgaXRlbSBpbiB0aGUgaXRlcmF0aW9uLgogICAgLSBgaW5kZXhgIGlzIHRo
ZSBjdXJyZW50IGluZGV4IGluIHRoZSBpdGVyYXRpb24uCiAgICAtIGBlbnVtZXJhYmxlYCBpcyB0
aGUgZW51bWVyYWJsZSBvYmplY3QgaXRzZWxmLgoKICAgIFJldHVybiB0aGUgbmV3IGN1bXVsYXRp
dmUgdmFsdWUuCgogICAgSW4gYWRkaXRpb24gdG8gdGhlIGNhbGxiYWNrIHlvdSBjYW4gYWxzbyBw
YXNzIGFuIGBpbml0aWFsVmFsdWVgLiBBbiBlcnJvcgogICAgd2lsbCBiZSByYWlzZWQgaWYgeW91
IGRvIG5vdCBwYXNzIGFuIGluaXRpYWwgdmFsdWUgYW5kIHRoZSBlbnVtZXJhdG9yIGlzCiAgICBl
bXB0eS4KCiAgICBOb3RlIHRoYXQgdW5saWtlIHRoZSBvdGhlciBtZXRob2RzLCB0aGlzIG1ldGhv
ZCBkb2VzIG5vdCBhbGxvdyB5b3UgdG8KICAgIHBhc3MgYSB0YXJnZXQgb2JqZWN0IHRvIHNldCBh
cyB0aGlzIGZvciB0aGUgY2FsbGJhY2suIEl0J3MgcGFydCBvZiB0aGUKICAgIHNwZWMuIFNvcnJ5
LgoKICAgIEBtZXRob2QgcmVkdWNlCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUg
Y2FsbGJhY2sgdG8gZXhlY3V0ZQogICAgQHBhcmFtIHtPYmplY3R9IGluaXRpYWxWYWx1ZSBJbml0
aWFsIHZhbHVlIGZvciB0aGUgcmVkdWNlCiAgICBAcGFyYW0ge1N0cmluZ30gcmVkdWNlclByb3Bl
cnR5IGludGVybmFsIHVzZSBvbmx5LgogICAgQHJldHVybiB7T2JqZWN0fSBUaGUgcmVkdWNlZCB2
YWx1ZS4KICAqLwogIHJlZHVjZTogZnVuY3Rpb24oY2FsbGJhY2ssIGluaXRpYWxWYWx1ZSwgcmVk
dWNlclByb3BlcnR5KSB7CiAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSB7
IHRocm93IG5ldyBUeXBlRXJyb3IoKTsgfQoKICAgIHZhciByZXQgPSBpbml0aWFsVmFsdWU7Cgog
ICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGkpIHsKICAgICAgcmV0ID0gY2FsbGJhY2su
Y2FsbChudWxsLCByZXQsIGl0ZW0sIGksIHRoaXMsIHJlZHVjZXJQcm9wZXJ0eSk7CiAgICB9LCB0
aGlzKTsKCiAgICByZXR1cm4gcmV0OwogIH0sCgogIC8qKgogICAgSW52b2tlcyB0aGUgbmFtZWQg
bWV0aG9kIG9uIGV2ZXJ5IG9iamVjdCBpbiB0aGUgcmVjZWl2ZXIgdGhhdAogICAgaW1wbGVtZW50
cyBpdC4gVGhpcyBtZXRob2QgY29ycmVzcG9uZHMgdG8gdGhlIGltcGxlbWVudGF0aW9uIGluCiAg
ICBQcm90b3R5cGUgMS42LgoKICAgIEBtZXRob2QgaW52b2tlCiAgICBAcGFyYW0ge1N0cmluZ30g
bWV0aG9kTmFtZSB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kCiAgICBAcGFyYW0ge09iamVjdC4uLn0g
YXJncyBvcHRpb25hbCBhcmd1bWVudHMgdG8gcGFzcyBhcyB3ZWxsLgogICAgQHJldHVybiB7QXJy
YXl9IHJldHVybiB2YWx1ZXMgZnJvbSBjYWxsaW5nIGludm9rZS4KICAqLwogIGludm9rZTogZnVu
Y3Rpb24obWV0aG9kTmFtZSkgewogICAgdmFyIGFyZ3MsIHJldCA9IEVtYmVyLkEoKTsKICAgIGlm
IChhcmd1bWVudHMubGVuZ3RoPjEpIGFyZ3MgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsK
CiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24oeCwgaWR4KSB7CiAgICAgIHZhciBtZXRob2QgPSB4
ICYmIHhbbWV0aG9kTmFtZV07CiAgICAgIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2YgbWV0aG9k
KSB7CiAgICAgICAgcmV0W2lkeF0gPSBhcmdzID8gbWV0aG9kLmFwcGx5KHgsIGFyZ3MpIDogbWV0
aG9kLmNhbGwoeCk7CiAgICAgIH0KICAgIH0sIHRoaXMpOwoKICAgIHJldHVybiByZXQ7CiAgfSwK
CiAgLyoqCiAgICBTaW1wbHkgY29udmVydHMgdGhlIGVudW1lcmFibGUgaW50byBhIGdlbnVpbmUg
YXJyYXkuIFRoZSBvcmRlciBpcyBub3QKICAgIGd1YXJhbnRlZWQuIENvcnJlc3BvbmRzIHRvIHRo
ZSBtZXRob2QgaW1wbGVtZW50ZWQgYnkgUHJvdG90eXBlLgoKICAgIEBtZXRob2QgdG9BcnJheQog
ICAgQHJldHVybiB7QXJyYXl9IHRoZSBlbnVtZXJhYmxlIGFzIGFuIGFycmF5LgogICovCiAgdG9B
cnJheTogZnVuY3Rpb24oKSB7CiAgICB2YXIgcmV0ID0gRW1iZXIuQSgpOwogICAgdGhpcy5mb3JF
YWNoKGZ1bmN0aW9uKG8sIGlkeCkgeyByZXRbaWR4XSA9IG87IH0pOwogICAgcmV0dXJuIHJldCA7
CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIGEgY29weSBvZiB0aGUgYXJyYXkgd2l0aCBhbGwgbnVs
bCBhbmQgdW5kZWZpbmVkIGVsZW1lbnRzIHJlbW92ZWQuCgogICAgYGBgamF2YXNjcmlwdAogICAg
dmFyIGFyciA9IFsiYSIsIG51bGwsICJjIiwgdW5kZWZpbmVkXTsKICAgIGFyci5jb21wYWN0KCk7
ICAvLyBbImEiLCAiYyJdCiAgICBgYGAKCiAgICBAbWV0aG9kIGNvbXBhY3QKICAgIEByZXR1cm4g
e0FycmF5fSB0aGUgYXJyYXkgd2l0aG91dCBudWxsIGFuZCB1bmRlZmluZWQgZWxlbWVudHMuCiAg
Ki8KICBjb21wYWN0OiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlv
bih2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfSk7CiAgfSwKCiAgLyoqCiAgICBSZXR1
cm5zIGEgbmV3IGVudW1lcmFibGUgdGhhdCBleGNsdWRlcyB0aGUgcGFzc2VkIHZhbHVlLiBUaGUg
ZGVmYXVsdAogICAgaW1wbGVtZW50YXRpb24gcmV0dXJucyBhbiBhcnJheSByZWdhcmRsZXNzIG9m
IHRoZSByZWNlaXZlciB0eXBlIHVubGVzcwogICAgdGhlIHJlY2VpdmVyIGRvZXMgbm90IGNvbnRh
aW4gdGhlIHZhbHVlLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBhcnIgPSBbImEiLCAiYiIs
ICJhIiwgImMiXTsKICAgIGFyci53aXRob3V0KCJhIik7ICAvLyBbImIiLCAiYyJdCiAgICBgYGAK
CiAgICBAbWV0aG9kIHdpdGhvdXQKICAgIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZQogICAgQHJldHVy
biB7RW1iZXIuRW51bWVyYWJsZX0KICAqLwogIHdpdGhvdXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAg
ICBpZiAoIXRoaXMuY29udGFpbnModmFsdWUpKSByZXR1cm4gdGhpczsgLy8gbm90aGluZyB0byBk
bwogICAgdmFyIHJldCA9IEVtYmVyLkEoKTsKICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihrKSB7
CiAgICAgIGlmIChrICE9PSB2YWx1ZSkgcmV0W3JldC5sZW5ndGhdID0gazsKICAgIH0pIDsKICAg
IHJldHVybiByZXQgOwogIH0sCgogIC8qKgogICAgUmV0dXJucyBhIG5ldyBlbnVtZXJhYmxlIHRo
YXQgY29udGFpbnMgb25seSB1bmlxdWUgdmFsdWVzLiBUaGUgZGVmYXVsdAogICAgaW1wbGVtZW50
YXRpb24gcmV0dXJucyBhbiBhcnJheSByZWdhcmRsZXNzIG9mIHRoZSByZWNlaXZlciB0eXBlLgoK
ICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBhcnIgPSBbImEiLCAiYSIsICJiIiwgImIiXTsKICAg
IGFyci51bmlxKCk7ICAvLyBbImEiLCAiYiJdCiAgICBgYGAKCiAgICBAbWV0aG9kIHVuaXEKICAg
IEByZXR1cm4ge0VtYmVyLkVudW1lcmFibGV9CiAgKi8KICB1bmlxOiBmdW5jdGlvbigpIHsKICAg
IHZhciByZXQgPSBFbWJlci5BKCk7CiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24oaykgewogICAg
ICBpZiAoYV9pbmRleE9mKHJldCwgayk8MCkgcmV0LnB1c2goayk7CiAgICB9KTsKICAgIHJldHVy
biByZXQ7CiAgfSwKCiAgLyoqCiAgICBUaGlzIHByb3BlcnR5IHdpbGwgdHJpZ2dlciBhbnl0aW1l
IHRoZSBlbnVtZXJhYmxlJ3MgY29udGVudCBjaGFuZ2VzLgogICAgWW91IGNhbiBvYnNlcnZlIHRo
aXMgcHJvcGVydHkgdG8gYmUgbm90aWZpZWQgb2YgY2hhbmdlcyB0byB0aGUgZW51bWVyYWJsZXMK
ICAgIGNvbnRlbnQuCgogICAgRm9yIHBsYWluIGVudW1lcmFibGVzLCB0aGlzIHByb3BlcnR5IGlz
IHJlYWQgb25seS4gYEVtYmVyLkFycmF5YCBvdmVycmlkZXMKICAgIHRoaXMgbWV0aG9kLgoKICAg
IEBwcm9wZXJ0eSBbXQogICAgQHR5cGUgRW1iZXIuQXJyYXkKICAgIEByZXR1cm4gdGhpcwogICov
CiAgJ1tdJzogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgcmV0dXJu
IHRoaXM7CiAgfSksCgogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyBFTlVNRVJBQkxFIE9CU0VSVkVSUwogIC8vCgogIC8q
KgogICAgUmVnaXN0ZXJzIGFuIGVudW1lcmFibGUgb2JzZXJ2ZXIuIE11c3QgaW1wbGVtZW50IGBF
bWJlci5FbnVtZXJhYmxlT2JzZXJ2ZXJgCiAgICBtaXhpbi4KCiAgICBAbWV0aG9kIGFkZEVudW1l
cmFibGVPYnNlcnZlcgogICAgQHBhcmFtIHtPYmplY3R9IHRhcmdldAogICAgQHBhcmFtIHtIYXNo
fSBbb3B0c10KICAgIEByZXR1cm4gdGhpcwogICovCiAgYWRkRW51bWVyYWJsZU9ic2VydmVyOiBm
dW5jdGlvbih0YXJnZXQsIG9wdHMpIHsKICAgIHZhciB3aWxsQ2hhbmdlID0gKG9wdHMgJiYgb3B0
cy53aWxsQ2hhbmdlKSB8fCAnZW51bWVyYWJsZVdpbGxDaGFuZ2UnLAogICAgICAgIGRpZENoYW5n
ZSAgPSAob3B0cyAmJiBvcHRzLmRpZENoYW5nZSkgfHwgJ2VudW1lcmFibGVEaWRDaGFuZ2UnOwoK
ICAgIHZhciBoYXNPYnNlcnZlcnMgPSBnZXQodGhpcywgJ2hhc0VudW1lcmFibGVPYnNlcnZlcnMn
KTsKICAgIGlmICghaGFzT2JzZXJ2ZXJzKSBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UodGhpcywg
J2hhc0VudW1lcmFibGVPYnNlcnZlcnMnKTsKICAgIEVtYmVyLmFkZExpc3RlbmVyKHRoaXMsICdA
ZW51bWVyYWJsZTpiZWZvcmUnLCB0YXJnZXQsIHdpbGxDaGFuZ2UpOwogICAgRW1iZXIuYWRkTGlz
dGVuZXIodGhpcywgJ0BlbnVtZXJhYmxlOmNoYW5nZScsIHRhcmdldCwgZGlkQ2hhbmdlKTsKICAg
IGlmICghaGFzT2JzZXJ2ZXJzKSBFbWJlci5wcm9wZXJ0eURpZENoYW5nZSh0aGlzLCAnaGFzRW51
bWVyYWJsZU9ic2VydmVycycpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBSZW1v
dmVzIGEgcmVnaXN0ZXJlZCBlbnVtZXJhYmxlIG9ic2VydmVyLgoKICAgIEBtZXRob2QgcmVtb3Zl
RW51bWVyYWJsZU9ic2VydmVyCiAgICBAcGFyYW0ge09iamVjdH0gdGFyZ2V0CiAgICBAcGFyYW0g
e0hhc2h9IFtvcHRzXQogICAgQHJldHVybiB0aGlzCiAgKi8KICByZW1vdmVFbnVtZXJhYmxlT2Jz
ZXJ2ZXI6IGZ1bmN0aW9uKHRhcmdldCwgb3B0cykgewogICAgdmFyIHdpbGxDaGFuZ2UgPSAob3B0
cyAmJiBvcHRzLndpbGxDaGFuZ2UpIHx8ICdlbnVtZXJhYmxlV2lsbENoYW5nZScsCiAgICAgICAg
ZGlkQ2hhbmdlICA9IChvcHRzICYmIG9wdHMuZGlkQ2hhbmdlKSB8fCAnZW51bWVyYWJsZURpZENo
YW5nZSc7CgogICAgdmFyIGhhc09ic2VydmVycyA9IGdldCh0aGlzLCAnaGFzRW51bWVyYWJsZU9i
c2VydmVycycpOwogICAgaWYgKGhhc09ic2VydmVycykgRW1iZXIucHJvcGVydHlXaWxsQ2hhbmdl
KHRoaXMsICdoYXNFbnVtZXJhYmxlT2JzZXJ2ZXJzJyk7CiAgICBFbWJlci5yZW1vdmVMaXN0ZW5l
cih0aGlzLCAnQGVudW1lcmFibGU6YmVmb3JlJywgdGFyZ2V0LCB3aWxsQ2hhbmdlKTsKICAgIEVt
YmVyLnJlbW92ZUxpc3RlbmVyKHRoaXMsICdAZW51bWVyYWJsZTpjaGFuZ2UnLCB0YXJnZXQsIGRp
ZENoYW5nZSk7CiAgICBpZiAoaGFzT2JzZXJ2ZXJzKSBFbWJlci5wcm9wZXJ0eURpZENoYW5nZSh0
aGlzLCAnaGFzRW51bWVyYWJsZU9ic2VydmVycycpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAg
LyoqCiAgICBCZWNvbWVzIHRydWUgd2hlbmV2ZXIgdGhlIGFycmF5IGN1cnJlbnRseSBoYXMgb2Jz
ZXJ2ZXJzIHdhdGNoaW5nIGNoYW5nZXMKICAgIG9uIHRoZSBhcnJheS4KCiAgICBAcHJvcGVydHkg
aGFzRW51bWVyYWJsZU9ic2VydmVycwogICAgQHR5cGUgQm9vbGVhbgogICovCiAgaGFzRW51bWVy
YWJsZU9ic2VydmVyczogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gRW1i
ZXIuaGFzTGlzdGVuZXJzKHRoaXMsICdAZW51bWVyYWJsZTpjaGFuZ2UnKSB8fCBFbWJlci5oYXNM
aXN0ZW5lcnModGhpcywgJ0BlbnVtZXJhYmxlOmJlZm9yZScpOwogIH0pLAoKCiAgLyoqCiAgICBJ
bnZva2UgdGhpcyBtZXRob2QganVzdCBiZWZvcmUgdGhlIGNvbnRlbnRzIG9mIHlvdXIgZW51bWVy
YWJsZSB3aWxsCiAgICBjaGFuZ2UuIFlvdSBjYW4gZWl0aGVyIG9taXQgdGhlIHBhcmFtZXRlcnMg
Y29tcGxldGVseSBvciBwYXNzIHRoZSBvYmplY3RzCiAgICB0byBiZSByZW1vdmVkIG9yIGFkZGVk
IGlmIGF2YWlsYWJsZSBvciBqdXN0IGEgY291bnQuCgogICAgQG1ldGhvZCBlbnVtZXJhYmxlQ29u
dGVudFdpbGxDaGFuZ2UKICAgIEBwYXJhbSB7RW1iZXIuRW51bWVyYWJsZXxOdW1iZXJ9IHJlbW92
aW5nIEFuIGVudW1lcmFibGUgb2YgdGhlIG9iamVjdHMgdG8KICAgICAgYmUgcmVtb3ZlZCBvciB0
aGUgbnVtYmVyIG9mIGl0ZW1zIHRvIGJlIHJlbW92ZWQuCiAgICBAcGFyYW0ge0VtYmVyLkVudW1l
cmFibGV8TnVtYmVyfSBhZGRpbmcgQW4gZW51bWVyYWJsZSBvZiB0aGUgb2JqZWN0cyB0byBiZQog
ICAgICBhZGRlZCBvciB0aGUgbnVtYmVyIG9mIGl0ZW1zIHRvIGJlIGFkZGVkLgogICAgQGNoYWlu
YWJsZQogICovCiAgZW51bWVyYWJsZUNvbnRlbnRXaWxsQ2hhbmdlOiBmdW5jdGlvbihyZW1vdmlu
ZywgYWRkaW5nKSB7CgogICAgdmFyIHJlbW92ZUNudCwgYWRkQ250LCBoYXNEZWx0YTsKCiAgICBp
ZiAoJ251bWJlcicgPT09IHR5cGVvZiByZW1vdmluZykgcmVtb3ZlQ250ID0gcmVtb3Zpbmc7CiAg
ICBlbHNlIGlmIChyZW1vdmluZykgcmVtb3ZlQ250ID0gZ2V0KHJlbW92aW5nLCAnbGVuZ3RoJyk7
CiAgICBlbHNlIHJlbW92ZUNudCA9IHJlbW92aW5nID0gLTE7CgogICAgaWYgKCdudW1iZXInID09
PSB0eXBlb2YgYWRkaW5nKSBhZGRDbnQgPSBhZGRpbmc7CiAgICBlbHNlIGlmIChhZGRpbmcpIGFk
ZENudCA9IGdldChhZGRpbmcsJ2xlbmd0aCcpOwogICAgZWxzZSBhZGRDbnQgPSBhZGRpbmcgPSAt
MTsKCiAgICBoYXNEZWx0YSA9IGFkZENudDwwIHx8IHJlbW92ZUNudDwwIHx8IGFkZENudC1yZW1v
dmVDbnQhPT0wOwoKICAgIGlmIChyZW1vdmluZyA9PT0gLTEpIHJlbW92aW5nID0gbnVsbDsKICAg
IGlmIChhZGRpbmcgICA9PT0gLTEpIGFkZGluZyAgID0gbnVsbDsKCiAgICBFbWJlci5wcm9wZXJ0
eVdpbGxDaGFuZ2UodGhpcywgJ1tdJyk7CiAgICBpZiAoaGFzRGVsdGEpIEVtYmVyLnByb3BlcnR5
V2lsbENoYW5nZSh0aGlzLCAnbGVuZ3RoJyk7CiAgICBFbWJlci5zZW5kRXZlbnQodGhpcywgJ0Bl
bnVtZXJhYmxlOmJlZm9yZScsIFt0aGlzLCByZW1vdmluZywgYWRkaW5nXSk7CgogICAgcmV0dXJu
IHRoaXM7CiAgfSwKCiAgLyoqCiAgICBJbnZva2UgdGhpcyBtZXRob2Qgd2hlbiB0aGUgY29udGVu
dHMgb2YgeW91ciBlbnVtZXJhYmxlIGhhcyBjaGFuZ2VkLgogICAgVGhpcyB3aWxsIG5vdGlmeSBh
bnkgb2JzZXJ2ZXJzIHdhdGNoaW5nIGZvciBjb250ZW50IGNoYW5nZXMuIElmIHlvdXIgYXJlCiAg
ICBpbXBsZW1lbnRpbmcgYW4gb3JkZXJlZCBlbnVtZXJhYmxlIChzdWNoIGFzIGFuIGFycmF5KSwg
YWxzbyBwYXNzIHRoZQogICAgc3RhcnQgYW5kIGVuZCB2YWx1ZXMgd2hlcmUgdGhlIGNvbnRlbnQg
Y2hhbmdlZCBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIHRvCiAgICBub3RpZnkgcmFuZ2Ugb2JzZXJ2
ZXJzLgoKICAgIEBtZXRob2QgZW51bWVyYWJsZUNvbnRlbnREaWRDaGFuZ2UKICAgIEBwYXJhbSB7
TnVtYmVyfSBbc3RhcnRdIG9wdGlvbmFsIHN0YXJ0IG9mZnNldCBmb3IgdGhlIGNvbnRlbnQgY2hh
bmdlLgogICAgICBGb3IgdW5vcmRlcmVkIGVudW1lcmFibGVzLCB5b3Ugc2hvdWxkIGFsd2F5cyBw
YXNzIC0xLgogICAgQHBhcmFtIHtFbWJlci5FbnVtZXJhYmxlfE51bWJlcn0gcmVtb3ZpbmcgQW4g
ZW51bWVyYWJsZSBvZiB0aGUgb2JqZWN0cyB0bwogICAgICBiZSByZW1vdmVkIG9yIHRoZSBudW1i
ZXIgb2YgaXRlbXMgdG8gYmUgcmVtb3ZlZC4KICAgIEBwYXJhbSB7RW1iZXIuRW51bWVyYWJsZXxO
dW1iZXJ9IGFkZGluZyAgQW4gZW51bWVyYWJsZSBvZiB0aGUgb2JqZWN0cyB0bwogICAgICBiZSBh
ZGRlZCBvciB0aGUgbnVtYmVyIG9mIGl0ZW1zIHRvIGJlIGFkZGVkLgogICAgQGNoYWluYWJsZQog
ICovCiAgZW51bWVyYWJsZUNvbnRlbnREaWRDaGFuZ2U6IGZ1bmN0aW9uKHJlbW92aW5nLCBhZGRp
bmcpIHsKICAgIHZhciByZW1vdmVDbnQsIGFkZENudCwgaGFzRGVsdGE7CgogICAgaWYgKCdudW1i
ZXInID09PSB0eXBlb2YgcmVtb3ZpbmcpIHJlbW92ZUNudCA9IHJlbW92aW5nOwogICAgZWxzZSBp
ZiAocmVtb3ZpbmcpIHJlbW92ZUNudCA9IGdldChyZW1vdmluZywgJ2xlbmd0aCcpOwogICAgZWxz
ZSByZW1vdmVDbnQgPSByZW1vdmluZyA9IC0xOwoKICAgIGlmICgnbnVtYmVyJyA9PT0gdHlwZW9m
IGFkZGluZykgYWRkQ250ID0gYWRkaW5nOwogICAgZWxzZSBpZiAoYWRkaW5nKSBhZGRDbnQgPSBn
ZXQoYWRkaW5nLCAnbGVuZ3RoJyk7CiAgICBlbHNlIGFkZENudCA9IGFkZGluZyA9IC0xOwoKICAg
IGhhc0RlbHRhID0gYWRkQ250PDAgfHwgcmVtb3ZlQ250PDAgfHwgYWRkQ250LXJlbW92ZUNudCE9
PTA7CgogICAgaWYgKHJlbW92aW5nID09PSAtMSkgcmVtb3ZpbmcgPSBudWxsOwogICAgaWYgKGFk
ZGluZyAgID09PSAtMSkgYWRkaW5nICAgPSBudWxsOwoKICAgIEVtYmVyLnNlbmRFdmVudCh0aGlz
LCAnQGVudW1lcmFibGU6Y2hhbmdlJywgW3RoaXMsIHJlbW92aW5nLCBhZGRpbmddKTsKICAgIGlm
IChoYXNEZWx0YSkgRW1iZXIucHJvcGVydHlEaWRDaGFuZ2UodGhpcywgJ2xlbmd0aCcpOwogICAg
RW1iZXIucHJvcGVydHlEaWRDaGFuZ2UodGhpcywgJ1tdJyk7CgogICAgcmV0dXJuIHRoaXMgOwog
IH0sCgogIC8qKgogICAgQ29udmVydHMgdGhlIGVudW1lcmFibGUgaW50byBhbiBhcnJheSBhbmQg
c29ydHMgYnkgdGhlIGtleXMKICAgIHNwZWNpZmllZCBpbiB0aGUgYXJndW1lbnQuCgogICAgWW91
IG1heSBwcm92aWRlIG11bHRpcGxlIGFyZ3VtZW50cyB0byBzb3J0IGJ5IG11bHRpcGxlIHByb3Bl
cnRpZXMuCgogICAgQG1ldGhvZCBzb3J0QnkKICAgIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eSBu
YW1lKHMpIHRvIHNvcnQgb24KICAgIEByZXR1cm4ge0FycmF5fSBUaGUgc29ydGVkIGFycmF5Lgog
ICAgKi8KICBzb3J0Qnk6IGZ1bmN0aW9uKCkgewogICAgdmFyIHNvcnRLZXlzID0gYXJndW1lbnRz
OwogICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLnNvcnQoZnVuY3Rpb24oYSwgYil7CiAgICAgIGZv
cih2YXIgaSA9IDA7IGkgPCBzb3J0S2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBrZXkg
PSBzb3J0S2V5c1tpXSwKICAgICAgICBwcm9wQSA9IGdldChhLCBrZXkpLAogICAgICAgIHByb3BC
ID0gZ2V0KGIsIGtleSk7CiAgICAgICAgLy8gcmV0dXJuIDEgb3IgLTEgZWxzZSBjb250aW51ZSB0
byB0aGUgbmV4dCBzb3J0S2V5CiAgICAgICAgdmFyIGNvbXBhcmVWYWx1ZSA9IEVtYmVyLmNvbXBh
cmUocHJvcEEsIHByb3BCKTsKICAgICAgICBpZiAoY29tcGFyZVZhbHVlKSB7IHJldHVybiBjb21w
YXJlVmFsdWU7IH0KICAgICAgfQogICAgICByZXR1cm4gMDsKICAgIH0pOwogIH0KfSk7Cgp9KSgp
OwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVu
dGltZQoqLwoKLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLgovLyBIRUxQRVJTCi8vCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBF
bWJlci5zZXQsIGlzTm9uZSA9IEVtYmVyLmlzTm9uZSwgbWFwID0gRW1iZXIuRW51bWVyYWJsZVV0
aWxzLm1hcCwgY2FjaGVGb3IgPSBFbWJlci5jYWNoZUZvcjsKCi8vIC4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KLy8gQVJSQVkKLy8KLyoq
CiAgVGhpcyBtb2R1bGUgaW1wbGVtZW50cyBPYnNlcnZlci1mcmllbmRseSBBcnJheS1saWtlIGJl
aGF2aW9yLiBUaGlzIG1peGluIGlzCiAgcGlja2VkIHVwIGJ5IHRoZSBBcnJheSBjbGFzcyBhcyB3
ZWxsIGFzIG90aGVyIGNvbnRyb2xsZXJzLCBldGMuIHRoYXQgd2FudCB0bwogIGFwcGVhciB0byBi
ZSBhcnJheXMuCgogIFVubGlrZSBgRW1iZXIuRW51bWVyYWJsZSxgIHRoaXMgbWl4aW4gZGVmaW5l
cyBtZXRob2RzIHNwZWNpZmljYWxseSBmb3IKICBjb2xsZWN0aW9ucyB0aGF0IHByb3ZpZGUgaW5k
ZXgtb3JkZXJlZCBhY2Nlc3MgdG8gdGhlaXIgY29udGVudHMuIFdoZW4geW91CiAgYXJlIGRlc2ln
bmluZyBjb2RlIHRoYXQgbmVlZHMgdG8gYWNjZXB0IGFueSBraW5kIG9mIEFycmF5LWxpa2Ugb2Jq
ZWN0LCB5b3UKICBzaG91bGQgdXNlIHRoZXNlIG1ldGhvZHMgaW5zdGVhZCBvZiBBcnJheSBwcmlt
aXRpdmVzIGJlY2F1c2UgdGhlc2Ugd2lsbAogIHByb3Blcmx5IG5vdGlmeSBvYnNlcnZlcnMgb2Yg
Y2hhbmdlcyB0byB0aGUgYXJyYXkuCgogIEFsdGhvdWdoIHRoZXNlIG1ldGhvZHMgYXJlIGVmZmlj
aWVudCwgdGhleSBkbyBhZGQgYSBsYXllciBvZiBpbmRpcmVjdGlvbiB0bwogIHlvdXIgYXBwbGlj
YXRpb24gc28gaXQgaXMgYSBnb29kIGlkZWEgdG8gdXNlIHRoZW0gb25seSB3aGVuIHlvdSBuZWVk
IHRoZQogIGZsZXhpYmlsaXR5IG9mIHVzaW5nIGJvdGggdHJ1ZSBKYXZhU2NyaXB0IGFycmF5cyBh
bmQgInZpcnR1YWwiIGFycmF5cyBzdWNoCiAgYXMgY29udHJvbGxlcnMgYW5kIGNvbGxlY3Rpb25z
LgoKICBZb3UgY2FuIHVzZSB0aGUgbWV0aG9kcyBkZWZpbmVkIGluIHRoaXMgbW9kdWxlIHRvIGFj
Y2VzcyBhbmQgbW9kaWZ5IGFycmF5CiAgY29udGVudHMgaW4gYSBLVk8tZnJpZW5kbHkgd2F5LiBZ
b3UgY2FuIGFsc28gYmUgbm90aWZpZWQgd2hlbmV2ZXIgdGhlCiAgbWVtYmVyc2hpcCBvZiBhbiBh
cnJheSBjaGFuZ2VzIGJ5IGNoYW5naW5nIHRoZSBzeW50YXggb2YgdGhlIHByb3BlcnR5IHRvCiAg
YC5vYnNlcnZlcygnKm15UHJvcGVydHkuW10nKWAuCgogIFRvIHN1cHBvcnQgYEVtYmVyLkFycmF5
YCBpbiB5b3VyIG93biBjbGFzcywgeW91IG11c3Qgb3ZlcnJpZGUgdHdvCiAgcHJpbWl0aXZlcyB0
byB1c2UgaXQ6IGByZXBsYWNlKClgIGFuZCBgb2JqZWN0QXQoKWAuCgogIE5vdGUgdGhhdCB0aGUg
RW1iZXIuQXJyYXkgbWl4aW4gYWxzbyBpbmNvcnBvcmF0ZXMgdGhlIGBFbWJlci5FbnVtZXJhYmxl
YAogIG1peGluLiBBbGwgYEVtYmVyLkFycmF5YC1saWtlIG9iamVjdHMgYXJlIGFsc28gZW51bWVy
YWJsZS4KCiAgQGNsYXNzIEFycmF5CiAgQG5hbWVzcGFjZSBFbWJlcgogIEB1c2VzIEVtYmVyLkVu
dW1lcmFibGUKICBAc2luY2UgRW1iZXIgMC45LjAKKi8KRW1iZXIuQXJyYXkgPSBFbWJlci5NaXhp
bi5jcmVhdGUoRW1iZXIuRW51bWVyYWJsZSwgewoKICAvKioKICAgIFlvdXIgYXJyYXkgbXVzdCBz
dXBwb3J0IHRoZSBgbGVuZ3RoYCBwcm9wZXJ0eS4gWW91ciByZXBsYWNlIG1ldGhvZHMgc2hvdWxk
CiAgICBzZXQgdGhpcyBwcm9wZXJ0eSB3aGVuZXZlciBpdCBjaGFuZ2VzLgoKICAgIEBwcm9wZXJ0
eSB7TnVtYmVyfSBsZW5ndGgKICAqLwogIGxlbmd0aDogRW1iZXIucmVxdWlyZWQoKSwKCiAgLyoq
CiAgICBSZXR1cm5zIHRoZSBvYmplY3QgYXQgdGhlIGdpdmVuIGBpbmRleGAuIElmIHRoZSBnaXZl
biBgaW5kZXhgIGlzIG5lZ2F0aXZlCiAgICBvciBpcyBncmVhdGVyIG9yIGVxdWFsIHRoYW4gdGhl
IGFycmF5IGxlbmd0aCwgcmV0dXJucyBgdW5kZWZpbmVkYC4KCiAgICBUaGlzIGlzIG9uZSBvZiB0
aGUgcHJpbWl0aXZlcyB5b3UgbXVzdCBpbXBsZW1lbnQgdG8gc3VwcG9ydCBgRW1iZXIuQXJyYXlg
LgogICAgSWYgeW91ciBvYmplY3Qgc3VwcG9ydHMgcmV0cmlldmluZyB0aGUgdmFsdWUgb2YgYW4g
YXJyYXkgaXRlbSB1c2luZyBgZ2V0KClgCiAgICAoaS5lLiBgbXlBcnJheS5nZXQoMClgKSwgdGhl
biB5b3UgZG8gbm90IG5lZWQgdG8gaW1wbGVtZW50IHRoaXMgbWV0aG9kCiAgICB5b3Vyc2VsZi4K
CiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgYXJyID0gWydhJywgJ2InLCAnYycsICdkJ107CiAg
ICBhcnIub2JqZWN0QXQoMCk7ICAgLy8gImEiCiAgICBhcnIub2JqZWN0QXQoMyk7ICAgLy8gImQi
CiAgICBhcnIub2JqZWN0QXQoLTEpOyAgLy8gdW5kZWZpbmVkCiAgICBhcnIub2JqZWN0QXQoNCk7
ICAgLy8gdW5kZWZpbmVkCiAgICBhcnIub2JqZWN0QXQoNSk7ICAgLy8gdW5kZWZpbmVkCiAgICBg
YGAKCiAgICBAbWV0aG9kIG9iamVjdEF0CiAgICBAcGFyYW0ge051bWJlcn0gaWR4IFRoZSBpbmRl
eCBvZiB0aGUgaXRlbSB0byByZXR1cm4uCiAgICBAcmV0dXJuIHsqfSBpdGVtIGF0IGluZGV4IG9y
IHVuZGVmaW5lZAogICovCiAgb2JqZWN0QXQ6IGZ1bmN0aW9uKGlkeCkgewogICAgaWYgKChpZHgg
PCAwKSB8fCAoaWR4Pj1nZXQodGhpcywgJ2xlbmd0aCcpKSkgcmV0dXJuIHVuZGVmaW5lZCA7CiAg
ICByZXR1cm4gZ2V0KHRoaXMsIGlkeCk7CiAgfSwKCiAgLyoqCiAgICBUaGlzIHJldHVybnMgdGhl
IG9iamVjdHMgYXQgdGhlIHNwZWNpZmllZCBpbmRleGVzLCB1c2luZyBgb2JqZWN0QXRgLgoKICAg
IGBgYGphdmFzY3JpcHQKICAgIHZhciBhcnIgPcKgWydhJywgJ2InLCAnYycsICdkJ107CiAgICBh
cnIub2JqZWN0c0F0KFswLCAxLCAyXSk7ICAvLyBbImEiLCAiYiIsICJjIl0KICAgIGFyci5vYmpl
Y3RzQXQoWzIsIDMsIDRdKTsgIC8vIFsiYyIsICJkIiwgdW5kZWZpbmVkXQogICAgYGBgCgogICAg
QG1ldGhvZCBvYmplY3RzQXQKICAgIEBwYXJhbSB7QXJyYXl9IGluZGV4ZXMgQW4gYXJyYXkgb2Yg
aW5kZXhlcyBvZiBpdGVtcyB0byByZXR1cm4uCiAgICBAcmV0dXJuIHtBcnJheX0KICAgKi8KICBv
YmplY3RzQXQ6IGZ1bmN0aW9uKGluZGV4ZXMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJl
dHVybiBtYXAoaW5kZXhlcywgZnVuY3Rpb24oaWR4KSB7IHJldHVybiBzZWxmLm9iamVjdEF0KGlk
eCk7IH0pOwogIH0sCgogIC8vIG92ZXJyaWRlcyBFbWJlci5FbnVtZXJhYmxlIHZlcnNpb24KICBu
ZXh0T2JqZWN0OiBmdW5jdGlvbihpZHgpIHsKICAgIHJldHVybiB0aGlzLm9iamVjdEF0KGlkeCk7
CiAgfSwKCiAgLyoqCiAgICBUaGlzIGlzIHRoZSBoYW5kbGVyIGZvciB0aGUgc3BlY2lhbCBhcnJh
eSBjb250ZW50IHByb3BlcnR5LiBJZiB5b3UgZ2V0CiAgICB0aGlzIHByb3BlcnR5LCBpdCB3aWxs
IHJldHVybiB0aGlzLiBJZiB5b3Ugc2V0IHRoaXMgcHJvcGVydHkgaXQgYSBuZXcKICAgIGFycmF5
LCBpdCB3aWxsIHJlcGxhY2UgdGhlIGN1cnJlbnQgY29udGVudC4KCiAgICBUaGlzIHByb3BlcnR5
IG92ZXJyaWRlcyB0aGUgZGVmYXVsdCBwcm9wZXJ0eSBkZWZpbmVkIGluIGBFbWJlci5FbnVtZXJh
YmxlYC4KCiAgICBAcHJvcGVydHkgW10KICAgIEByZXR1cm4gdGhpcwogICovCiAgJ1tdJzogRW1i
ZXIuY29tcHV0ZWQoZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgaWYgKHZhbHVlICE9PSB1bmRl
ZmluZWQpIHRoaXMucmVwbGFjZSgwLCBnZXQodGhpcywgJ2xlbmd0aCcpLCB2YWx1ZSkgOwogICAg
cmV0dXJuIHRoaXMgOwogIH0pLAoKICBmaXJzdE9iamVjdDogRW1iZXIuY29tcHV0ZWQoZnVuY3Rp
b24oKSB7CiAgICByZXR1cm4gdGhpcy5vYmplY3RBdCgwKTsKICB9KSwKCiAgbGFzdE9iamVjdDog
RW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5vYmplY3RBdChnZXQo
dGhpcywgJ2xlbmd0aCcpLTEpOwogIH0pLAoKICAvLyBvcHRpbWl6ZWQgdmVyc2lvbiBmcm9tIEVu
dW1lcmFibGUKICBjb250YWluczogZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdGhpcy5pbmRl
eE9mKG9iaikgPj0gMDsKICB9LAoKICAvLyBBZGQgYW55IGV4dHJhIG1ldGhvZHMgdG8gRW1iZXIu
QXJyYXkgdGhhdCBhcmUgbmF0aXZlIHRvIHRoZSBidWlsdC1pbiBBcnJheS4KICAvKioKICAgIFJl
dHVybnMgYSBuZXcgYXJyYXkgdGhhdCBpcyBhIHNsaWNlIG9mIHRoZSByZWNlaXZlci4gVGhpcyBp
bXBsZW1lbnRhdGlvbgogICAgdXNlcyB0aGUgb2JzZXJ2YWJsZSBhcnJheSBtZXRob2RzIHRvIHJl
dHJpZXZlIHRoZSBvYmplY3RzIGZvciB0aGUgbmV3CiAgICBzbGljZS4KCiAgICBgYGBqYXZhc2Ny
aXB0CiAgICB2YXIgYXJyID0gWydyZWQnLCAnZ3JlZW4nLCAnYmx1ZSddOwogICAgYXJyLnNsaWNl
KDApOyAgICAgICAvLyBbJ3JlZCcsICdncmVlbicsICdibHVlJ10KICAgIGFyci5zbGljZSgwLCAy
KTsgICAgLy8gWydyZWQnLCAnZ3JlZW4nXQogICAgYXJyLnNsaWNlKDEsIDEwMCk7ICAvLyBbJ2dy
ZWVuJywgJ2JsdWUnXQogICAgYGBgCgogICAgQG1ldGhvZCBzbGljZQogICAgQHBhcmFtIHtJbnRl
Z2VyfSBiZWdpbkluZGV4IChPcHRpb25hbCkgaW5kZXggdG8gYmVnaW4gc2xpY2luZyBmcm9tLgog
ICAgQHBhcmFtIHtJbnRlZ2VyfSBlbmRJbmRleCAoT3B0aW9uYWwpIGluZGV4IHRvIGVuZCB0aGUg
c2xpY2UgYXQuCiAgICBAcmV0dXJuIHtBcnJheX0gTmV3IGFycmF5IHdpdGggc3BlY2lmaWVkIHNs
aWNlCiAgKi8KICBzbGljZTogZnVuY3Rpb24oYmVnaW5JbmRleCwgZW5kSW5kZXgpIHsKICAgIHZh
ciByZXQgPSBFbWJlci5BKCk7CiAgICB2YXIgbGVuZ3RoID0gZ2V0KHRoaXMsICdsZW5ndGgnKSA7
CiAgICBpZiAoaXNOb25lKGJlZ2luSW5kZXgpKSBiZWdpbkluZGV4ID0gMCA7CiAgICBpZiAoaXNO
b25lKGVuZEluZGV4KSB8fCAoZW5kSW5kZXggPiBsZW5ndGgpKSBlbmRJbmRleCA9IGxlbmd0aCA7
CgogICAgaWYgKGJlZ2luSW5kZXggPCAwKSBiZWdpbkluZGV4ID0gbGVuZ3RoICsgYmVnaW5JbmRl
eDsKICAgIGlmIChlbmRJbmRleCA8IDApIGVuZEluZGV4ID0gbGVuZ3RoICsgZW5kSW5kZXg7Cgog
ICAgd2hpbGUoYmVnaW5JbmRleCA8IGVuZEluZGV4KSB7CiAgICAgIHJldFtyZXQubGVuZ3RoXSA9
IHRoaXMub2JqZWN0QXQoYmVnaW5JbmRleCsrKSA7CiAgICB9CiAgICByZXR1cm4gcmV0IDsKICB9
LAoKICAvKioKICAgIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBvYmplY3QncyBmaXJz
dCBvY2N1cnJlbmNlLgogICAgSWYgbm8gYHN0YXJ0QXRgIGFyZ3VtZW50IGlzIGdpdmVuLCB0aGUg
c3RhcnRpbmcgbG9jYXRpb24gdG8KICAgIHNlYXJjaCBpcyAwLiBJZiBpdCdzIG5lZ2F0aXZlLCB3
aWxsIGNvdW50IGJhY2t3YXJkIGZyb20KICAgIHRoZSBlbmQgb2YgdGhlIGFycmF5LiBSZXR1cm5z
IC0xIGlmIG5vIG1hdGNoIGlzIGZvdW5kLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBhcnIg
PSBbImEiLCAiYiIsICJjIiwgImQiLCAiYSJdOwogICAgYXJyLmluZGV4T2YoImEiKTsgICAgICAg
Ly8gIDAKICAgIGFyci5pbmRleE9mKCJ6Iik7ICAgICAgIC8vIC0xCiAgICBhcnIuaW5kZXhPZigi
YSIsIDIpOyAgICAvLyAgNAogICAgYXJyLmluZGV4T2YoImEiLCAtMSk7ICAgLy8gIDQKICAgIGFy
ci5pbmRleE9mKCJiIiwgMyk7ICAgIC8vIC0xCiAgICBhcnIuaW5kZXhPZigiYSIsIDEwMCk7ICAv
LyAtMQogICAgYGBgCgogICAgQG1ldGhvZCBpbmRleE9mCiAgICBAcGFyYW0ge09iamVjdH0gb2Jq
ZWN0IHRoZSBpdGVtIHRvIHNlYXJjaCBmb3IKICAgIEBwYXJhbSB7TnVtYmVyfSBzdGFydEF0IG9w
dGlvbmFsIHN0YXJ0aW5nIGxvY2F0aW9uIHRvIHNlYXJjaCwgZGVmYXVsdCAwCiAgICBAcmV0dXJu
IHtOdW1iZXJ9IGluZGV4IG9yIC0xIGlmIG5vdCBmb3VuZAogICovCiAgaW5kZXhPZjogZnVuY3Rp
b24ob2JqZWN0LCBzdGFydEF0KSB7CiAgICB2YXIgaWR4LCBsZW4gPSBnZXQodGhpcywgJ2xlbmd0
aCcpOwoKICAgIGlmIChzdGFydEF0ID09PSB1bmRlZmluZWQpIHN0YXJ0QXQgPSAwOwogICAgaWYg
KHN0YXJ0QXQgPCAwKSBzdGFydEF0ICs9IGxlbjsKCiAgICBmb3IoaWR4PXN0YXJ0QXQ7aWR4PGxl
bjtpZHgrKykgewogICAgICBpZiAodGhpcy5vYmplY3RBdChpZHgpID09PSBvYmplY3QpIHJldHVy
biBpZHggOwogICAgfQogICAgcmV0dXJuIC0xOwogIH0sCgogIC8qKgogICAgUmV0dXJucyB0aGUg
aW5kZXggb2YgdGhlIGdpdmVuIG9iamVjdCdzIGxhc3Qgb2NjdXJyZW5jZS4KICAgIElmIG5vIGBz
dGFydEF0YCBhcmd1bWVudCBpcyBnaXZlbiwgdGhlIHNlYXJjaCBzdGFydHMgZnJvbQogICAgdGhl
IGxhc3QgcG9zaXRpb24uIElmIGl0J3MgbmVnYXRpdmUsIHdpbGwgY291bnQgYmFja3dhcmQKICAg
IGZyb20gdGhlIGVuZCBvZiB0aGUgYXJyYXkuIFJldHVybnMgLTEgaWYgbm8gbWF0Y2ggaXMgZm91
bmQuCgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGFyciA9IFsiYSIsICJiIiwgImMiLCAiZCIs
ICJhIl07CiAgICBhcnIubGFzdEluZGV4T2YoImEiKTsgICAgICAgLy8gIDQKICAgIGFyci5sYXN0
SW5kZXhPZigieiIpOyAgICAgICAvLyAtMQogICAgYXJyLmxhc3RJbmRleE9mKCJhIiwgMik7ICAg
IC8vICAwCiAgICBhcnIubGFzdEluZGV4T2YoImEiLCAtMSk7ICAgLy8gIDQKICAgIGFyci5sYXN0
SW5kZXhPZigiYiIsIDMpOyAgICAvLyAgMQogICAgYXJyLmxhc3RJbmRleE9mKCJhIiwgMTAwKTsg
IC8vICA0CiAgICBgYGAKCiAgICBAbWV0aG9kIGxhc3RJbmRleE9mCiAgICBAcGFyYW0ge09iamVj
dH0gb2JqZWN0IHRoZSBpdGVtIHRvIHNlYXJjaCBmb3IKICAgIEBwYXJhbSB7TnVtYmVyfSBzdGFy
dEF0IG9wdGlvbmFsIHN0YXJ0aW5nIGxvY2F0aW9uIHRvIHNlYXJjaCwgZGVmYXVsdCAwCiAgICBA
cmV0dXJuIHtOdW1iZXJ9IGluZGV4IG9yIC0xIGlmIG5vdCBmb3VuZAogICovCiAgbGFzdEluZGV4
T2Y6IGZ1bmN0aW9uKG9iamVjdCwgc3RhcnRBdCkgewogICAgdmFyIGlkeCwgbGVuID0gZ2V0KHRo
aXMsICdsZW5ndGgnKTsKCiAgICBpZiAoc3RhcnRBdCA9PT0gdW5kZWZpbmVkIHx8IHN0YXJ0QXQg
Pj0gbGVuKSBzdGFydEF0ID0gbGVuLTE7CiAgICBpZiAoc3RhcnRBdCA8IDApIHN0YXJ0QXQgKz0g
bGVuOwoKICAgIGZvcihpZHg9c3RhcnRBdDtpZHg+PTA7aWR4LS0pIHsKICAgICAgaWYgKHRoaXMu
b2JqZWN0QXQoaWR4KSA9PT0gb2JqZWN0KSByZXR1cm4gaWR4IDsKICAgIH0KICAgIHJldHVybiAt
MTsKICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uCiAgLy8gQVJSQVkgT0JTRVJWRVJTCiAgLy8KCiAgLyoqCiAgICBBZGRz
IGFuIGFycmF5IG9ic2VydmVyIHRvIHRoZSByZWNlaXZpbmcgYXJyYXkuIFRoZSBhcnJheSBvYnNl
cnZlciBvYmplY3QKICAgIG5vcm1hbGx5IG11c3QgaW1wbGVtZW50IHR3byBtZXRob2RzOgoKICAg
ICogYGFycmF5V2lsbENoYW5nZShvYnNlcnZlZE9iaiwgc3RhcnQsIHJlbW92ZUNvdW50LCBhZGRD
b3VudClgIC0gVGhpcyBtZXRob2Qgd2lsbCBiZQogICAgICBjYWxsZWQganVzdCBiZWZvcmUgdGhl
IGFycmF5IGlzIG1vZGlmaWVkLgogICAgKiBgYXJyYXlEaWRDaGFuZ2Uob2JzZXJ2ZWRPYmosIHN0
YXJ0LCByZW1vdmVDb3VudCwgYWRkQ291bnQpYCAtIFRoaXMgbWV0aG9kIHdpbGwgYmUKICAgICAg
Y2FsbGVkIGp1c3QgYWZ0ZXIgdGhlIGFycmF5IGlzIG1vZGlmaWVkLgoKICAgIEJvdGggY2FsbGJh
Y2tzIHdpbGwgYmUgcGFzc2VkIHRoZSBvYnNlcnZlZCBvYmplY3QsIHN0YXJ0aW5nIGluZGV4IG9m
IHRoZQogICAgY2hhbmdlIGFzIHdlbGwgYSBhIGNvdW50IG9mIHRoZSBpdGVtcyB0byBiZSByZW1v
dmVkIGFuZCBhZGRlZC4gWW91IGNhbiB1c2UKICAgIHRoZXNlIGNhbGxiYWNrcyB0byBvcHRpb25h
bGx5IGluc3BlY3QgdGhlIGFycmF5IGR1cmluZyB0aGUgY2hhbmdlLCBjbGVhcgogICAgY2FjaGVz
LCBvciBkbyBhbnkgb3RoZXIgYm9va2tlZXBpbmcgbmVjZXNzYXJ5LgoKICAgIEluIGFkZGl0aW9u
IHRvIHBhc3NpbmcgYSB0YXJnZXQsIHlvdSBjYW4gYWxzbyBpbmNsdWRlIGFuIG9wdGlvbnMgaGFz
aAogICAgd2hpY2ggeW91IGNhbiB1c2UgdG8gb3ZlcnJpZGUgdGhlIG1ldGhvZCBuYW1lcyB0aGF0
IHdpbGwgYmUgaW52b2tlZCBvbiB0aGUKICAgIHRhcmdldC4KCiAgICBAbWV0aG9kIGFkZEFycmF5
T2JzZXJ2ZXIKICAgIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGhlIG9ic2VydmVyIG9iamVjdC4K
ICAgIEBwYXJhbSB7SGFzaH0gb3B0cyBPcHRpb25hbCBoYXNoIG9mIGNvbmZpZ3VyYXRpb24gb3B0
aW9ucyBpbmNsdWRpbmcKICAgICAgYHdpbGxDaGFuZ2VgIGFuZCBgZGlkQ2hhbmdlYCBvcHRpb24u
CiAgICBAcmV0dXJuIHtFbWJlci5BcnJheX0gcmVjZWl2ZXIKICAqLwogIGFkZEFycmF5T2JzZXJ2
ZXI6IGZ1bmN0aW9uKHRhcmdldCwgb3B0cykgewogICAgdmFyIHdpbGxDaGFuZ2UgPSAob3B0cyAm
JiBvcHRzLndpbGxDaGFuZ2UpIHx8ICdhcnJheVdpbGxDaGFuZ2UnLAogICAgICAgIGRpZENoYW5n
ZSAgPSAob3B0cyAmJiBvcHRzLmRpZENoYW5nZSkgfHwgJ2FycmF5RGlkQ2hhbmdlJzsKCiAgICB2
YXIgaGFzT2JzZXJ2ZXJzID0gZ2V0KHRoaXMsICdoYXNBcnJheU9ic2VydmVycycpOwogICAgaWYg
KCFoYXNPYnNlcnZlcnMpIEVtYmVyLnByb3BlcnR5V2lsbENoYW5nZSh0aGlzLCAnaGFzQXJyYXlP
YnNlcnZlcnMnKTsKICAgIEVtYmVyLmFkZExpc3RlbmVyKHRoaXMsICdAYXJyYXk6YmVmb3JlJywg
dGFyZ2V0LCB3aWxsQ2hhbmdlKTsKICAgIEVtYmVyLmFkZExpc3RlbmVyKHRoaXMsICdAYXJyYXk6
Y2hhbmdlJywgdGFyZ2V0LCBkaWRDaGFuZ2UpOwogICAgaWYgKCFoYXNPYnNlcnZlcnMpIEVtYmVy
LnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMsICdoYXNBcnJheU9ic2VydmVycycpOwogICAgcmV0dXJu
IHRoaXM7CiAgfSwKCiAgLyoqCiAgICBSZW1vdmVzIGFuIGFycmF5IG9ic2VydmVyIGZyb20gdGhl
IG9iamVjdCBpZiB0aGUgb2JzZXJ2ZXIgaXMgY3VycmVudAogICAgcmVnaXN0ZXJlZC4gQ2FsbGlu
ZyB0aGlzIG1ldGhvZCBtdWx0aXBsZSB0aW1lcyB3aXRoIHRoZSBzYW1lIG9iamVjdCB3aWxsCiAg
ICBoYXZlIG5vIGVmZmVjdC4KCiAgICBAbWV0aG9kIHJlbW92ZUFycmF5T2JzZXJ2ZXIKICAgIEBw
YXJhbSB7T2JqZWN0fSB0YXJnZXQgVGhlIG9iamVjdCBvYnNlcnZpbmcgdGhlIGFycmF5LgogICAg
QHBhcmFtIHtIYXNofSBvcHRzIE9wdGlvbmFsIGhhc2ggb2YgY29uZmlndXJhdGlvbiBvcHRpb25z
IGluY2x1ZGluZwogICAgICBgd2lsbENoYW5nZWAgYW5kIGBkaWRDaGFuZ2VgIG9wdGlvbi4KICAg
IEByZXR1cm4ge0VtYmVyLkFycmF5fSByZWNlaXZlcgogICovCiAgcmVtb3ZlQXJyYXlPYnNlcnZl
cjogZnVuY3Rpb24odGFyZ2V0LCBvcHRzKSB7CiAgICB2YXIgd2lsbENoYW5nZSA9IChvcHRzICYm
IG9wdHMud2lsbENoYW5nZSkgfHwgJ2FycmF5V2lsbENoYW5nZScsCiAgICAgICAgZGlkQ2hhbmdl
ICA9IChvcHRzICYmIG9wdHMuZGlkQ2hhbmdlKSB8fCAnYXJyYXlEaWRDaGFuZ2UnOwoKICAgIHZh
ciBoYXNPYnNlcnZlcnMgPSBnZXQodGhpcywgJ2hhc0FycmF5T2JzZXJ2ZXJzJyk7CiAgICBpZiAo
aGFzT2JzZXJ2ZXJzKSBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UodGhpcywgJ2hhc0FycmF5T2Jz
ZXJ2ZXJzJyk7CiAgICBFbWJlci5yZW1vdmVMaXN0ZW5lcih0aGlzLCAnQGFycmF5OmJlZm9yZScs
IHRhcmdldCwgd2lsbENoYW5nZSk7CiAgICBFbWJlci5yZW1vdmVMaXN0ZW5lcih0aGlzLCAnQGFy
cmF5OmNoYW5nZScsIHRhcmdldCwgZGlkQ2hhbmdlKTsKICAgIGlmIChoYXNPYnNlcnZlcnMpIEVt
YmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMsICdoYXNBcnJheU9ic2VydmVycycpOwogICAgcmV0
dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBCZWNvbWVzIHRydWUgd2hlbmV2ZXIgdGhlIGFycmF5
IGN1cnJlbnRseSBoYXMgb2JzZXJ2ZXJzIHdhdGNoaW5nIGNoYW5nZXMKICAgIG9uIHRoZSBhcnJh
eS4KCiAgICBAcHJvcGVydHkgQm9vbGVhbgogICovCiAgaGFzQXJyYXlPYnNlcnZlcnM6IEVtYmVy
LmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEVtYmVyLmhhc0xpc3RlbmVycyh0aGlz
LCAnQGFycmF5OmNoYW5nZScpIHx8IEVtYmVyLmhhc0xpc3RlbmVycyh0aGlzLCAnQGFycmF5OmJl
Zm9yZScpOwogIH0pLAoKICAvKioKICAgIElmIHlvdSBhcmUgaW1wbGVtZW50aW5nIGFuIG9iamVj
dCB0aGF0IHN1cHBvcnRzIGBFbWJlci5BcnJheWAsIGNhbGwgdGhpcwogICAgbWV0aG9kIGp1c3Qg
YmVmb3JlIHRoZSBhcnJheSBjb250ZW50IGNoYW5nZXMgdG8gbm90aWZ5IGFueSBvYnNlcnZlcnMg
YW5kCiAgICBpbnZhbGlkYXRlIGFueSByZWxhdGVkIHByb3BlcnRpZXMuIFBhc3MgdGhlIHN0YXJ0
aW5nIGluZGV4IG9mIHRoZSBjaGFuZ2UKICAgIGFzIHdlbGwgYXMgYSBkZWx0YSBvZiB0aGUgYW1v
dW50cyB0byBjaGFuZ2UuCgogICAgQG1ldGhvZCBhcnJheUNvbnRlbnRXaWxsQ2hhbmdlCiAgICBA
cGFyYW0ge051bWJlcn0gc3RhcnRJZHggVGhlIHN0YXJ0aW5nIGluZGV4IGluIHRoZSBhcnJheSB0
aGF0IHdpbGwgY2hhbmdlLgogICAgQHBhcmFtIHtOdW1iZXJ9IHJlbW92ZUFtdCBUaGUgbnVtYmVy
IG9mIGl0ZW1zIHRoYXQgd2lsbCBiZSByZW1vdmVkLiBJZiB5b3UKICAgICAgcGFzcyBgbnVsbGAg
YXNzdW1lcyAwCiAgICBAcGFyYW0ge051bWJlcn0gYWRkQW10IFRoZSBudW1iZXIgb2YgaXRlbXMg
dGhhdCB3aWxsIGJlIGFkZGVkLiBJZiB5b3UKICAgICAgcGFzcyBgbnVsbGAgYXNzdW1lcyAwLgog
ICAgQHJldHVybiB7RW1iZXIuQXJyYXl9IHJlY2VpdmVyCiAgKi8KICBhcnJheUNvbnRlbnRXaWxs
Q2hhbmdlOiBmdW5jdGlvbihzdGFydElkeCwgcmVtb3ZlQW10LCBhZGRBbXQpIHsKCiAgICAvLyBp
ZiBubyBhcmdzIGFyZSBwYXNzZWQgYXNzdW1lIGV2ZXJ5dGhpbmcgY2hhbmdlcwogICAgaWYgKHN0
YXJ0SWR4PT09dW5kZWZpbmVkKSB7CiAgICAgIHN0YXJ0SWR4ID0gMDsKICAgICAgcmVtb3ZlQW10
ID0gYWRkQW10ID0gLTE7CiAgICB9IGVsc2UgewogICAgICBpZiAocmVtb3ZlQW10ID09PSB1bmRl
ZmluZWQpIHJlbW92ZUFtdD0tMTsKICAgICAgaWYgKGFkZEFtdCAgICA9PT0gdW5kZWZpbmVkKSBh
ZGRBbXQ9LTE7CiAgICB9CgogICAgLy8gTWFrZSBzdXJlIHRoZSBAZWFjaCBwcm94eSBpcyBzZXQg
dXAgaWYgYW55b25lIGlzIG9ic2VydmluZyBAZWFjaAogICAgaWYgKEVtYmVyLmlzV2F0Y2hpbmco
dGhpcywgJ0BlYWNoJykpIHsgZ2V0KHRoaXMsICdAZWFjaCcpOyB9CgogICAgRW1iZXIuc2VuZEV2
ZW50KHRoaXMsICdAYXJyYXk6YmVmb3JlJywgW3RoaXMsIHN0YXJ0SWR4LCByZW1vdmVBbXQsIGFk
ZEFtdF0pOwoKICAgIHZhciByZW1vdmluZywgbGltOwogICAgaWYgKHN0YXJ0SWR4Pj0wICYmIHJl
bW92ZUFtdD49MCAmJiBnZXQodGhpcywgJ2hhc0VudW1lcmFibGVPYnNlcnZlcnMnKSkgewogICAg
ICByZW1vdmluZyA9IFtdOwogICAgICBsaW0gPSBzdGFydElkeCtyZW1vdmVBbXQ7CiAgICAgIGZv
cih2YXIgaWR4PXN0YXJ0SWR4O2lkeDxsaW07aWR4KyspIHJlbW92aW5nLnB1c2godGhpcy5vYmpl
Y3RBdChpZHgpKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbW92aW5nID0gcmVtb3ZlQW10OwogICAg
fQoKICAgIHRoaXMuZW51bWVyYWJsZUNvbnRlbnRXaWxsQ2hhbmdlKHJlbW92aW5nLCBhZGRBbXQp
OwoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgSWYgeW91IGFyZSBpbXBsZW1lbnRp
bmcgYW4gb2JqZWN0IHRoYXQgc3VwcG9ydHMgYEVtYmVyLkFycmF5YCwgY2FsbCB0aGlzCiAgICBt
ZXRob2QganVzdCBhZnRlciB0aGUgYXJyYXkgY29udGVudCBjaGFuZ2VzIHRvIG5vdGlmeSBhbnkg
b2JzZXJ2ZXJzIGFuZAogICAgaW52YWxpZGF0ZSBhbnkgcmVsYXRlZCBwcm9wZXJ0aWVzLiBQYXNz
IHRoZSBzdGFydGluZyBpbmRleCBvZiB0aGUgY2hhbmdlCiAgICBhcyB3ZWxsIGFzIGEgZGVsdGEg
b2YgdGhlIGFtb3VudHMgdG8gY2hhbmdlLgoKICAgIEBtZXRob2QgYXJyYXlDb250ZW50RGlkQ2hh
bmdlCiAgICBAcGFyYW0ge051bWJlcn0gc3RhcnRJZHggVGhlIHN0YXJ0aW5nIGluZGV4IGluIHRo
ZSBhcnJheSB0aGF0IGRpZCBjaGFuZ2UuCiAgICBAcGFyYW0ge051bWJlcn0gcmVtb3ZlQW10IFRo
ZSBudW1iZXIgb2YgaXRlbXMgdGhhdCB3ZXJlIHJlbW92ZWQuIElmIHlvdQogICAgICBwYXNzIGBu
dWxsYCBhc3N1bWVzIDAKICAgIEBwYXJhbSB7TnVtYmVyfSBhZGRBbXQgVGhlIG51bWJlciBvZiBp
dGVtcyB0aGF0IHdlcmUgYWRkZWQuIElmIHlvdQogICAgICBwYXNzIGBudWxsYCBhc3N1bWVzIDAu
CiAgICBAcmV0dXJuIHtFbWJlci5BcnJheX0gcmVjZWl2ZXIKICAqLwogIGFycmF5Q29udGVudERp
ZENoYW5nZTogZnVuY3Rpb24oc3RhcnRJZHgsIHJlbW92ZUFtdCwgYWRkQW10KSB7CgogICAgLy8g
aWYgbm8gYXJncyBhcmUgcGFzc2VkIGFzc3VtZSBldmVyeXRoaW5nIGNoYW5nZXMKICAgIGlmIChz
dGFydElkeD09PXVuZGVmaW5lZCkgewogICAgICBzdGFydElkeCA9IDA7CiAgICAgIHJlbW92ZUFt
dCA9IGFkZEFtdCA9IC0xOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHJlbW92ZUFtdCA9PT0gdW5k
ZWZpbmVkKSByZW1vdmVBbXQ9LTE7CiAgICAgIGlmIChhZGRBbXQgICAgPT09IHVuZGVmaW5lZCkg
YWRkQW10PS0xOwogICAgfQoKICAgIHZhciBhZGRpbmcsIGxpbTsKICAgIGlmIChzdGFydElkeD49
MCAmJiBhZGRBbXQ+PTAgJiYgZ2V0KHRoaXMsICdoYXNFbnVtZXJhYmxlT2JzZXJ2ZXJzJykpIHsK
ICAgICAgYWRkaW5nID0gW107CiAgICAgIGxpbSA9IHN0YXJ0SWR4K2FkZEFtdDsKICAgICAgZm9y
KHZhciBpZHg9c3RhcnRJZHg7aWR4PGxpbTtpZHgrKykgYWRkaW5nLnB1c2godGhpcy5vYmplY3RB
dChpZHgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGFkZGluZyA9IGFkZEFtdDsKICAgIH0KCiAgICB0
aGlzLmVudW1lcmFibGVDb250ZW50RGlkQ2hhbmdlKHJlbW92ZUFtdCwgYWRkaW5nKTsKICAgIEVt
YmVyLnNlbmRFdmVudCh0aGlzLCAnQGFycmF5OmNoYW5nZScsIFt0aGlzLCBzdGFydElkeCwgcmVt
b3ZlQW10LCBhZGRBbXRdKTsKCiAgICB2YXIgbGVuZ3RoICAgICAgPSBnZXQodGhpcywgJ2xlbmd0
aCcpLAogICAgICAgIGNhY2hlZEZpcnN0ID0gY2FjaGVGb3IodGhpcywgJ2ZpcnN0T2JqZWN0Jyks
CiAgICAgICAgY2FjaGVkTGFzdCAgPSBjYWNoZUZvcih0aGlzLCAnbGFzdE9iamVjdCcpOwogICAg
aWYgKHRoaXMub2JqZWN0QXQoMCkgIT09IGNhY2hlZEZpcnN0KSB7CiAgICAgIEVtYmVyLnByb3Bl
cnR5V2lsbENoYW5nZSh0aGlzLCAnZmlyc3RPYmplY3QnKTsKICAgICAgRW1iZXIucHJvcGVydHlE
aWRDaGFuZ2UodGhpcywgJ2ZpcnN0T2JqZWN0Jyk7CiAgICB9CiAgICBpZiAodGhpcy5vYmplY3RB
dChsZW5ndGgtMSkgIT09IGNhY2hlZExhc3QpIHsKICAgICAgRW1iZXIucHJvcGVydHlXaWxsQ2hh
bmdlKHRoaXMsICdsYXN0T2JqZWN0Jyk7CiAgICAgIEVtYmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRo
aXMsICdsYXN0T2JqZWN0Jyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLy8gLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgog
IC8vIEVOVU1FUkFURUQgUFJPUEVSVElFUwogIC8vCgogIC8qKgogICAgUmV0dXJucyBhIHNwZWNp
YWwgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gb2JzZXJ2ZSBpbmRpdmlkdWFsIHByb3BlcnRp
ZXMKICAgIG9uIHRoZSBhcnJheS4gSnVzdCBnZXQgYW4gZXF1aXZhbGVudCBwcm9wZXJ0eSBvbiB0
aGlzIG9iamVjdCBhbmQgaXQgd2lsbAogICAgcmV0dXJuIGFuIGVudW1lcmFibGUgdGhhdCBtYXBz
IGF1dG9tYXRpY2FsbHkgdG8gdGhlIG5hbWVkIGtleSBvbiB0aGUKICAgIG1lbWJlciBvYmplY3Rz
LgoKICAgIElmIHlvdSBtZXJlbHkgd2FudCB0byB3YXRjaCBmb3IgYW55IGl0ZW1zIGJlaW5nIGFk
ZGVkIG9yIHJlbW92ZWQgdG8gdGhlIGFycmF5LAogICAgdXNlIHRoZSBgW11gIHByb3BlcnR5IGlu
c3RlYWQgb2YgYEBlYWNoYC4KCiAgICBAcHJvcGVydHkgQGVhY2gKICAqLwogICdAZWFjaCc6IEVt
YmVyLmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLl9fZWFjaCkgdGhpcy5fX2Vh
Y2ggPSBuZXcgRW1iZXIuRWFjaFByb3h5KHRoaXMpOwogICAgcmV0dXJuIHRoaXMuX19lYWNoOwog
IH0pCgp9KSA7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBlX2dldCA9IEVtYmVyLmdldCwK
ICAgIHNldCA9IEVtYmVyLnNldCwKICAgIGd1aWRGb3IgPSBFbWJlci5ndWlkRm9yLAogICAgbWV0
YUZvciA9IEVtYmVyLm1ldGEsCiAgICBwcm9wZXJ0eVdpbGxDaGFuZ2UgPSBFbWJlci5wcm9wZXJ0
eVdpbGxDaGFuZ2UsCiAgICBwcm9wZXJ0eURpZENoYW5nZSA9IEVtYmVyLnByb3BlcnR5RGlkQ2hh
bmdlLAogICAgYWRkQmVmb3JlT2JzZXJ2ZXIgPSBFbWJlci5hZGRCZWZvcmVPYnNlcnZlciwKICAg
IHJlbW92ZUJlZm9yZU9ic2VydmVyID0gRW1iZXIucmVtb3ZlQmVmb3JlT2JzZXJ2ZXIsCiAgICBh
ZGRPYnNlcnZlciA9IEVtYmVyLmFkZE9ic2VydmVyLAogICAgcmVtb3ZlT2JzZXJ2ZXIgPSBFbWJl
ci5yZW1vdmVPYnNlcnZlciwKICAgIENvbXB1dGVkUHJvcGVydHkgPSBFbWJlci5Db21wdXRlZFBy
b3BlcnR5LAogICAgYV9zbGljZSA9IFtdLnNsaWNlLAogICAgb19jcmVhdGUgPSBFbWJlci5jcmVh
dGUsCiAgICBmb3JFYWNoID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmZvckVhY2gsCiAgICAvLyBI
ZXJlIHdlIGV4cGxpY2l0bHkgZG9uJ3QgYWxsb3cgYEBlYWNoLmZvb2A7IGl0IHdvdWxkIHJlcXVp
cmUgc29tZSBzcGVjaWFsCiAgICAvLyB0ZXN0aW5nLCBidXQgdGhlcmUncyBubyBwYXJ0aWN1bGFy
IHJlYXNvbiB3aHkgaXQgc2hvdWxkIGJlIGRpc2FsbG93ZWQuCiAgICBlYWNoUHJvcGVydHlQYXR0
ZXJuID0gL14oLiopXC5AZWFjaFwuKC4qKS8sCiAgICBkb3VibGVFYWNoUHJvcGVydHlQYXR0ZXJu
ID0gLyguKlwuQGVhY2gpezIsfS8sCiAgICBhcnJheUJyYWNrZXRQYXR0ZXJuID0gL1wuXFtcXSQv
OwoKCmZ1bmN0aW9uIGdldChvYmosIGtleSkgewogIGlmIChrZXkgPT09ICdAdGhpcycpIHsKICAg
IHJldHVybiBvYmo7CiAgfQoKICByZXR1cm4gZV9nZXQob2JqLCBrZXkpOwp9CgovKgogIFRyYWNr
cyBjaGFuZ2VzIHRvIGRlcGVuZGVudCBhcnJheXMsIGFzIHdlbGwgYXMgdG8gcHJvcGVydGllcyBv
ZiBpdGVtcyBpbgogIGRlcGVuZGVudCBhcnJheXMuCgogIEBjbGFzcyBEZXBlbmRlbnRBcnJheXNP
YnNlcnZlcgoqLwpmdW5jdGlvbiBEZXBlbmRlbnRBcnJheXNPYnNlcnZlcihjYWxsYmFja3MsIGNw
LCBpbnN0YW5jZU1ldGEsIGNvbnRleHQsIHByb3BlcnR5TmFtZSwgc3VnYXJNZXRhKSB7CiAgLy8g
dXNlciBzcGVjaWZpZWQgY2FsbGJhY2tzIGZvciBgYWRkZWRJdGVtYCBhbmQgYHJlbW92ZWRJdGVt
YAogIHRoaXMuY2FsbGJhY2tzID0gY2FsbGJhY2tzOwoKICAvLyB0aGUgY29tcHV0ZWQgcHJvcGVy
dHk6IHJlbWVtYmVyIHRoZXNlIGFyZSBzaGFyZWQgYWNyb3NzIGluc3RhbmNlcwogIHRoaXMuY3Ag
PSBjcDsKCiAgLy8gdGhlIFJlZHVjZUNvbXB1dGVkUHJvcGVydHlJbnN0YW5jZU1ldGEgdGhpcyBE
ZXBlbmRlbnRBcnJheXNPYnNlcnZlciBpcwogIC8vIGFzc29jaWF0ZWQgd2l0aAogIHRoaXMuaW5z
dGFuY2VNZXRhID0gaW5zdGFuY2VNZXRhOwoKICAvLyBBIG1hcCBvZiBhcnJheSBndWlkcyB0byBk
ZXBlbmRlbnRLZXlzLCBmb3IgdGhlIGdpdmVuIGNvbnRleHQuICBXZSB0cmFjawogIC8vIHRoaXMg
YmVjYXVzZSB3ZSB3YW50IHRvIHNldCB1cCB0aGUgY29tcHV0ZWQgcHJvcGVydHkgcG90ZW50aWFs
bHkgYmVmb3JlIHRoZQogIC8vIGRlcGVuZGVudCBhcnJheSBldmVuIGV4aXN0cywgYnV0IHdoZW4g
dGhlIGFycmF5IG9ic2VydmVyIGZpcmVzLCB3ZSBsYWNrCiAgLy8gZW5vdWdoIGNvbnRleHQgdG8g
a25vdyB3aGF0IHRvIHVwZGF0ZTogd2UgY2FuIHJlY292ZXIgdGhhdCBjb250ZXh0IGJ5CiAgLy8g
Z2V0dGluZyB0aGUgZGVwZW5kZW50S2V5LgogIHRoaXMuZGVwZW5kZW50S2V5c0J5R3VpZCA9IHt9
OwoKICAvLyBhIG1hcCBvZiBkZXBlbmRlbnQgYXJyYXkgZ3VpZHMgLT4gRW1iZXIuVHJhY2tlZEFy
cmF5IGluc3RhbmNlcy4gIFdlIHVzZQogIC8vIHRoaXMgdG8gbGF6aWx5IHJlY29tcHV0ZSBpbmRl
eGVzIGZvciBpdGVtIHByb3BlcnR5IG9ic2VydmVycy4KICB0aGlzLnRyYWNrZWRBcnJheXNCeUd1
aWQgPSB7fTsKCiAgLy8gV2Ugc3VzcGVuZCBvYnNlcnZlcnMgdG8gaWdub3JlIHJlcGxhY2VtZW50
cyBmcm9tIGByZXNldGAgd2hlbiB0b3RhbGx5CiAgLy8gcmVjb21wdXRpbmcuICBVbmZvcnR1bmF0
ZWx5IHdlIGNhbm5vdCBwcm9wZXJseSBzdXNwZW5kIHRoZSBvYnNlcnZlcnMKICAvLyBiZWNhdXNl
IHdlIG9ubHkgaGF2ZSB0aGUga2V5OyBpbnN0ZWFkIHdlIG1ha2UgdGhlIG9ic2VydmVycyBuby1v
cHMKICB0aGlzLnN1c3BlbmRlZCA9IGZhbHNlOwoKICAvLyBUaGlzIGlzIHVzZWQgdG8gY29hbGVz
Y2UgaXRlbSBjaGFuZ2VzIGZyb20gcHJvcGVydHkgb2JzZXJ2ZXJzLgogIHRoaXMuY2hhbmdlZEl0
ZW1zID0ge307Cn0KCmZ1bmN0aW9uIEl0ZW1Qcm9wZXJ0eU9ic2VydmVyQ29udGV4dCAoZGVwZW5k
ZW50QXJyYXksIGluZGV4LCB0cmFja2VkQXJyYXkpIHsKICBFbWJlci5hc3NlcnQoIkludGVybmFs
IGVycm9yOiB0cmFja2VkQXJyYXkgaXMgbnVsbCBvciB1bmRlZmluZWQiLCB0cmFja2VkQXJyYXkp
OwoKICB0aGlzLmRlcGVuZGVudEFycmF5ID0gZGVwZW5kZW50QXJyYXk7CiAgdGhpcy5pbmRleCA9
IGluZGV4OwogIHRoaXMuaXRlbSA9IGRlcGVuZGVudEFycmF5Lm9iamVjdEF0KGluZGV4KTsKICB0
aGlzLnRyYWNrZWRBcnJheSA9IHRyYWNrZWRBcnJheTsKICB0aGlzLmJlZm9yZU9ic2VydmVyID0g
bnVsbDsKICB0aGlzLm9ic2VydmVyID0gbnVsbDsKCiAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTsK
fQoKRGVwZW5kZW50QXJyYXlzT2JzZXJ2ZXIucHJvdG90eXBlID0gewogIHNldFZhbHVlOiBmdW5j
dGlvbiAobmV3VmFsdWUpIHsKICAgIHRoaXMuaW5zdGFuY2VNZXRhLnNldFZhbHVlKG5ld1ZhbHVl
LCB0cnVlKTsKICB9LAogIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5p
bnN0YW5jZU1ldGEuZ2V0VmFsdWUoKTsKICB9LAoKICBzZXR1cE9ic2VydmVyczogZnVuY3Rpb24g
KGRlcGVuZGVudEFycmF5LCBkZXBlbmRlbnRLZXkpIHsKICAgIEVtYmVyLmFzc2VydCgiZGVwZW5k
ZW50IGFycmF5IG11c3QgYmUgYW4gYEVtYmVyLkFycmF5YCIsIEVtYmVyLkFycmF5LmRldGVjdChk
ZXBlbmRlbnRBcnJheSkpOwoKICAgIHRoaXMuZGVwZW5kZW50S2V5c0J5R3VpZFtndWlkRm9yKGRl
cGVuZGVudEFycmF5KV0gPSBkZXBlbmRlbnRLZXk7CgogICAgZGVwZW5kZW50QXJyYXkuYWRkQXJy
YXlPYnNlcnZlcih0aGlzLCB7CiAgICAgIHdpbGxDaGFuZ2U6ICdkZXBlbmRlbnRBcnJheVdpbGxD
aGFuZ2UnLAogICAgICBkaWRDaGFuZ2U6ICdkZXBlbmRlbnRBcnJheURpZENoYW5nZScKICAgIH0p
OwoKICAgIGlmICh0aGlzLmNwLl9pdGVtUHJvcGVydHlLZXlzW2RlcGVuZGVudEtleV0pIHsKICAg
ICAgdGhpcy5zZXR1cFByb3BlcnR5T2JzZXJ2ZXJzKGRlcGVuZGVudEtleSwgdGhpcy5jcC5faXRl
bVByb3BlcnR5S2V5c1tkZXBlbmRlbnRLZXldKTsKICAgIH0KICB9LAoKICB0ZWFyZG93bk9ic2Vy
dmVyczogZnVuY3Rpb24gKGRlcGVuZGVudEFycmF5LCBkZXBlbmRlbnRLZXkpIHsKICAgIHZhciBp
dGVtUHJvcGVydHlLZXlzID0gdGhpcy5jcC5faXRlbVByb3BlcnR5S2V5c1tkZXBlbmRlbnRLZXld
IHx8IFtdOwoKICAgIGRlbGV0ZSB0aGlzLmRlcGVuZGVudEtleXNCeUd1aWRbZ3VpZEZvcihkZXBl
bmRlbnRBcnJheSldOwoKICAgIHRoaXMudGVhcmRvd25Qcm9wZXJ0eU9ic2VydmVycyhkZXBlbmRl
bnRLZXksIGl0ZW1Qcm9wZXJ0eUtleXMpOwoKICAgIGRlcGVuZGVudEFycmF5LnJlbW92ZUFycmF5
T2JzZXJ2ZXIodGhpcywgewogICAgICB3aWxsQ2hhbmdlOiAnZGVwZW5kZW50QXJyYXlXaWxsQ2hh
bmdlJywKICAgICAgZGlkQ2hhbmdlOiAnZGVwZW5kZW50QXJyYXlEaWRDaGFuZ2UnCiAgICB9KTsK
ICB9LAoKICBzdXNwZW5kQXJyYXlPYnNlcnZlcnM6IGZ1bmN0aW9uIChjYWxsYmFjaywgYmluZGlu
ZykgewogICAgdmFyIG9sZFN1c3BlbmRlZCA9IHRoaXMuc3VzcGVuZGVkOwogICAgdGhpcy5zdXNw
ZW5kZWQgPSB0cnVlOwogICAgY2FsbGJhY2suY2FsbChiaW5kaW5nKTsKICAgIHRoaXMuc3VzcGVu
ZGVkID0gb2xkU3VzcGVuZGVkOwogIH0sCgogIHNldHVwUHJvcGVydHlPYnNlcnZlcnM6IGZ1bmN0
aW9uIChkZXBlbmRlbnRLZXksIGl0ZW1Qcm9wZXJ0eUtleXMpIHsKICAgIHZhciBkZXBlbmRlbnRB
cnJheSA9IGdldCh0aGlzLmluc3RhbmNlTWV0YS5jb250ZXh0LCBkZXBlbmRlbnRLZXkpLAogICAg
ICAgIGxlbmd0aCA9IGdldChkZXBlbmRlbnRBcnJheSwgJ2xlbmd0aCcpLAogICAgICAgIG9ic2Vy
dmVyQ29udGV4dHMgPSBuZXcgQXJyYXkobGVuZ3RoKTsKCiAgICB0aGlzLnJlc2V0VHJhbnNmb3Jt
YXRpb25zKGRlcGVuZGVudEtleSwgb2JzZXJ2ZXJDb250ZXh0cyk7CgogICAgZm9yRWFjaChkZXBl
bmRlbnRBcnJheSwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgIHZhciBvYnNlcnZlckNv
bnRleHQgPSB0aGlzLmNyZWF0ZVByb3BlcnR5T2JzZXJ2ZXJDb250ZXh0KGRlcGVuZGVudEFycmF5
LCBpbmRleCwgdGhpcy50cmFja2VkQXJyYXlzQnlHdWlkW2RlcGVuZGVudEtleV0pOwogICAgICBv
YnNlcnZlckNvbnRleHRzW2luZGV4XSA9IG9ic2VydmVyQ29udGV4dDsKCiAgICAgIGZvckVhY2go
aXRlbVByb3BlcnR5S2V5cywgZnVuY3Rpb24gKHByb3BlcnR5S2V5KSB7CiAgICAgICAgYWRkQmVm
b3JlT2JzZXJ2ZXIoaXRlbSwgcHJvcGVydHlLZXksIHRoaXMsIG9ic2VydmVyQ29udGV4dC5iZWZv
cmVPYnNlcnZlcik7CiAgICAgICAgYWRkT2JzZXJ2ZXIoaXRlbSwgcHJvcGVydHlLZXksIHRoaXMs
IG9ic2VydmVyQ29udGV4dC5vYnNlcnZlcik7CiAgICAgIH0sIHRoaXMpOwogICAgfSwgdGhpcyk7
CiAgfSwKCiAgdGVhcmRvd25Qcm9wZXJ0eU9ic2VydmVyczogZnVuY3Rpb24gKGRlcGVuZGVudEtl
eSwgaXRlbVByb3BlcnR5S2V5cykgewogICAgdmFyIGRlcGVuZGVudEFycmF5T2JzZXJ2ZXIgPSB0
aGlzLAogICAgICAgIHRyYWNrZWRBcnJheSA9IHRoaXMudHJhY2tlZEFycmF5c0J5R3VpZFtkZXBl
bmRlbnRLZXldLAogICAgICAgIGJlZm9yZU9ic2VydmVyLAogICAgICAgIG9ic2VydmVyLAogICAg
ICAgIGl0ZW07CgogICAgaWYgKCF0cmFja2VkQXJyYXkpIHsgcmV0dXJuOyB9CgogICAgdHJhY2tl
ZEFycmF5LmFwcGx5KGZ1bmN0aW9uIChvYnNlcnZlckNvbnRleHRzLCBvZmZzZXQsIG9wZXJhdGlv
bikgewogICAgICBpZiAob3BlcmF0aW9uID09PSBFbWJlci5UcmFja2VkQXJyYXkuREVMRVRFKSB7
IHJldHVybjsgfQoKICAgICAgZm9yRWFjaChvYnNlcnZlckNvbnRleHRzLCBmdW5jdGlvbiAob2Jz
ZXJ2ZXJDb250ZXh0KSB7CiAgICAgICAgb2JzZXJ2ZXJDb250ZXh0LmRlc3Ryb3llZCA9IHRydWU7
CiAgICAgICAgYmVmb3JlT2JzZXJ2ZXIgPSBvYnNlcnZlckNvbnRleHQuYmVmb3JlT2JzZXJ2ZXI7
CiAgICAgICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckNvbnRleHQub2JzZXJ2ZXI7CiAgICAgICAgaXRl
bSA9IG9ic2VydmVyQ29udGV4dC5pdGVtOwoKICAgICAgICBmb3JFYWNoKGl0ZW1Qcm9wZXJ0eUtl
eXMsIGZ1bmN0aW9uIChwcm9wZXJ0eUtleSkgewogICAgICAgICAgcmVtb3ZlQmVmb3JlT2JzZXJ2
ZXIoaXRlbSwgcHJvcGVydHlLZXksIGRlcGVuZGVudEFycmF5T2JzZXJ2ZXIsIGJlZm9yZU9ic2Vy
dmVyKTsKICAgICAgICAgIHJlbW92ZU9ic2VydmVyKGl0ZW0sIHByb3BlcnR5S2V5LCBkZXBlbmRl
bnRBcnJheU9ic2VydmVyLCBvYnNlcnZlcik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7
CiAgfSwKCiAgY3JlYXRlUHJvcGVydHlPYnNlcnZlckNvbnRleHQ6IGZ1bmN0aW9uIChkZXBlbmRl
bnRBcnJheSwgaW5kZXgsIHRyYWNrZWRBcnJheSkgewogICAgdmFyIG9ic2VydmVyQ29udGV4dCA9
IG5ldyBJdGVtUHJvcGVydHlPYnNlcnZlckNvbnRleHQoZGVwZW5kZW50QXJyYXksIGluZGV4LCB0
cmFja2VkQXJyYXkpOwoKICAgIHRoaXMuY3JlYXRlUHJvcGVydHlPYnNlcnZlcihvYnNlcnZlckNv
bnRleHQpOwoKICAgIHJldHVybiBvYnNlcnZlckNvbnRleHQ7CiAgfSwKCiAgY3JlYXRlUHJvcGVy
dHlPYnNlcnZlcjogZnVuY3Rpb24gKG9ic2VydmVyQ29udGV4dCkgewogICAgdmFyIGRlcGVuZGVu
dEFycmF5T2JzZXJ2ZXIgPSB0aGlzOwoKICAgIG9ic2VydmVyQ29udGV4dC5iZWZvcmVPYnNlcnZl
ciA9IGZ1bmN0aW9uIChvYmosIGtleU5hbWUpIHsKICAgICAgcmV0dXJuIGRlcGVuZGVudEFycmF5
T2JzZXJ2ZXIuaXRlbVByb3BlcnR5V2lsbENoYW5nZShvYmosIGtleU5hbWUsIG9ic2VydmVyQ29u
dGV4dC5kZXBlbmRlbnRBcnJheSwgb2JzZXJ2ZXJDb250ZXh0KTsKICAgIH07CiAgICBvYnNlcnZl
ckNvbnRleHQub2JzZXJ2ZXIgPSBmdW5jdGlvbiAob2JqLCBrZXlOYW1lKSB7CiAgICAgIHJldHVy
biBkZXBlbmRlbnRBcnJheU9ic2VydmVyLml0ZW1Qcm9wZXJ0eURpZENoYW5nZShvYmosIGtleU5h
bWUsIG9ic2VydmVyQ29udGV4dC5kZXBlbmRlbnRBcnJheSwgb2JzZXJ2ZXJDb250ZXh0KTsKICAg
IH07CiAgfSwKCiAgcmVzZXRUcmFuc2Zvcm1hdGlvbnM6IGZ1bmN0aW9uIChkZXBlbmRlbnRLZXks
IG9ic2VydmVyQ29udGV4dHMpIHsKICAgIHRoaXMudHJhY2tlZEFycmF5c0J5R3VpZFtkZXBlbmRl
bnRLZXldID0gbmV3IEVtYmVyLlRyYWNrZWRBcnJheShvYnNlcnZlckNvbnRleHRzKTsKICB9LAoK
ICB0cmFja0FkZDogZnVuY3Rpb24gKGRlcGVuZGVudEtleSwgaW5kZXgsIG5ld0l0ZW1zKSB7CiAg
ICB2YXIgdHJhY2tlZEFycmF5ID0gdGhpcy50cmFja2VkQXJyYXlzQnlHdWlkW2RlcGVuZGVudEtl
eV07CiAgICBpZiAodHJhY2tlZEFycmF5KSB7CiAgICAgIHRyYWNrZWRBcnJheS5hZGRJdGVtcyhp
bmRleCwgbmV3SXRlbXMpOwogICAgfQogIH0sCgogIHRyYWNrUmVtb3ZlOiBmdW5jdGlvbiAoZGVw
ZW5kZW50S2V5LCBpbmRleCwgcmVtb3ZlZENvdW50KSB7CiAgICB2YXIgdHJhY2tlZEFycmF5ID0g
dGhpcy50cmFja2VkQXJyYXlzQnlHdWlkW2RlcGVuZGVudEtleV07CgogICAgaWYgKHRyYWNrZWRB
cnJheSkgewogICAgICByZXR1cm4gdHJhY2tlZEFycmF5LnJlbW92ZUl0ZW1zKGluZGV4LCByZW1v
dmVkQ291bnQpOwogICAgfQoKICAgIHJldHVybiBbXTsKICB9LAoKICB1cGRhdGVJbmRleGVzOiBm
dW5jdGlvbiAodHJhY2tlZEFycmF5LCBhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGdldChhcnJh
eSwgJ2xlbmd0aCcpOwogICAgLy8gT1BUSU1JWkU6IHdlIGNvdWxkIHN0b3AgdXBkYXRpbmcgb25j
ZSB3ZSBoaXQgdGhlIG9iamVjdCB3aG9zZSBvYnNlcnZlcgogICAgLy8gZmlyZWQ7IGllIHBhcnRp
YWxseSBhcHBseSB0aGUgdHJhbnNmb3JtYXRpb25zCiAgICB0cmFja2VkQXJyYXkuYXBwbHkoZnVu
Y3Rpb24gKG9ic2VydmVyQ29udGV4dHMsIG9mZnNldCwgb3BlcmF0aW9uKSB7CiAgICAgIC8vIHdl
IGRvbid0IGV2ZW4gaGF2ZSBvYnNlcnZlciBjb250ZXh0cyBmb3IgcmVtb3ZlZCBpdGVtcywgZXZl
biBpZiB3ZSBkaWQsCiAgICAgIC8vIHRoZXkgbm8gbG9uZ2VyIGhhdmUgYW55IGluZGV4IGluIHRo
ZSBhcnJheQogICAgICBpZiAob3BlcmF0aW9uID09PSBFbWJlci5UcmFja2VkQXJyYXkuREVMRVRF
KSB7IHJldHVybjsgfQogICAgICBpZiAob3BlcmF0aW9uID09PSBFbWJlci5UcmFja2VkQXJyYXku
UkVUQUlOICYmIG9ic2VydmVyQ29udGV4dHMubGVuZ3RoID09PSBsZW5ndGggJiYgb2Zmc2V0ID09
PSAwKSB7CiAgICAgICAgLy8gSWYgd2UgdXBkYXRlIG1hbnkgaXRlbXMgd2UgZG9uJ3Qgd2FudCB0
byB3YWxrIHRoZSBhcnJheSBlYWNoIHRpbWU6IHdlCiAgICAgICAgLy8gb25seSBuZWVkIHRvIHVw
ZGF0ZSB0aGUgaW5kZXhlcyBhdCBtb3N0IG9uY2UgcGVyIHJ1biBsb29wLgogICAgICAgIHJldHVy
bjsKICAgICAgfQoKICAgICAgZm9yRWFjaChvYnNlcnZlckNvbnRleHRzLCBmdW5jdGlvbiAoY29u
dGV4dCwgaW5kZXgpIHsKICAgICAgICBjb250ZXh0LmluZGV4ID0gaW5kZXggKyBvZmZzZXQ7CiAg
ICAgIH0pOwogICAgfSk7CiAgfSwKCiAgZGVwZW5kZW50QXJyYXlXaWxsQ2hhbmdlOiBmdW5jdGlv
biAoZGVwZW5kZW50QXJyYXksIGluZGV4LCByZW1vdmVkQ291bnQsIGFkZGVkQ291bnQpIHsKICAg
IGlmICh0aGlzLnN1c3BlbmRlZCkgeyByZXR1cm47IH0KCiAgICB2YXIgcmVtb3ZlZEl0ZW0gPSB0
aGlzLmNhbGxiYWNrcy5yZW1vdmVkSXRlbSwKICAgICAgICBjaGFuZ2VNZXRhLAogICAgICAgIGd1
aWQgPSBndWlkRm9yKGRlcGVuZGVudEFycmF5KSwKICAgICAgICBkZXBlbmRlbnRLZXkgPSB0aGlz
LmRlcGVuZGVudEtleXNCeUd1aWRbZ3VpZF0sCiAgICAgICAgaXRlbVByb3BlcnR5S2V5cyA9IHRo
aXMuY3AuX2l0ZW1Qcm9wZXJ0eUtleXNbZGVwZW5kZW50S2V5XSB8fCBbXSwKICAgICAgICBsZW5n
dGggPSBnZXQoZGVwZW5kZW50QXJyYXksICdsZW5ndGgnKSwKICAgICAgICBub3JtYWxpemVkSW5k
ZXggPSBub3JtYWxpemVJbmRleChpbmRleCwgbGVuZ3RoLCAwKSwKICAgICAgICBub3JtYWxpemVk
UmVtb3ZlQ291bnQgPSBub3JtYWxpemVSZW1vdmVDb3VudChub3JtYWxpemVkSW5kZXgsIGxlbmd0
aCwgcmVtb3ZlZENvdW50KSwKICAgICAgICBpdGVtLAogICAgICAgIGl0ZW1JbmRleCwKICAgICAg
ICBzbGljZUluZGV4LAogICAgICAgIG9ic2VydmVyQ29udGV4dHM7CgogICAgb2JzZXJ2ZXJDb250
ZXh0cyA9IHRoaXMudHJhY2tSZW1vdmUoZGVwZW5kZW50S2V5LCBub3JtYWxpemVkSW5kZXgsIG5v
cm1hbGl6ZWRSZW1vdmVDb3VudCk7CgogICAgZnVuY3Rpb24gcmVtb3ZlT2JzZXJ2ZXJzKHByb3Bl
cnR5S2V5KSB7CiAgICAgIG9ic2VydmVyQ29udGV4dHNbc2xpY2VJbmRleF0uZGVzdHJveWVkID0g
dHJ1ZTsKICAgICAgcmVtb3ZlQmVmb3JlT2JzZXJ2ZXIoaXRlbSwgcHJvcGVydHlLZXksIHRoaXMs
IG9ic2VydmVyQ29udGV4dHNbc2xpY2VJbmRleF0uYmVmb3JlT2JzZXJ2ZXIpOwogICAgICByZW1v
dmVPYnNlcnZlcihpdGVtLCBwcm9wZXJ0eUtleSwgdGhpcywgb2JzZXJ2ZXJDb250ZXh0c1tzbGlj
ZUluZGV4XS5vYnNlcnZlcik7CiAgICB9CgogICAgZm9yIChzbGljZUluZGV4ID0gbm9ybWFsaXpl
ZFJlbW92ZUNvdW50IC0gMTsgc2xpY2VJbmRleCA+PSAwOyAtLXNsaWNlSW5kZXgpIHsKICAgICAg
aXRlbUluZGV4ID0gbm9ybWFsaXplZEluZGV4ICsgc2xpY2VJbmRleDsKICAgICAgaWYgKGl0ZW1J
bmRleCA+PSBsZW5ndGgpIHsgYnJlYWs7IH0KCiAgICAgIGl0ZW0gPSBkZXBlbmRlbnRBcnJheS5v
YmplY3RBdChpdGVtSW5kZXgpOwoKICAgICAgZm9yRWFjaChpdGVtUHJvcGVydHlLZXlzLCByZW1v
dmVPYnNlcnZlcnMsIHRoaXMpOwoKICAgICAgY2hhbmdlTWV0YSA9IGNyZWF0ZUNoYW5nZU1ldGEo
ZGVwZW5kZW50QXJyYXksIGl0ZW0sIGl0ZW1JbmRleCwgdGhpcy5pbnN0YW5jZU1ldGEucHJvcGVy
dHlOYW1lLCB0aGlzLmNwKTsKICAgICAgdGhpcy5zZXRWYWx1ZSggcmVtb3ZlZEl0ZW0uY2FsbCgK
ICAgICAgICB0aGlzLmluc3RhbmNlTWV0YS5jb250ZXh0LCB0aGlzLmdldFZhbHVlKCksIGl0ZW0s
IGNoYW5nZU1ldGEsIHRoaXMuaW5zdGFuY2VNZXRhLnN1Z2FyTWV0YSkpOwogICAgfQogIH0sCgog
IGRlcGVuZGVudEFycmF5RGlkQ2hhbmdlOiBmdW5jdGlvbiAoZGVwZW5kZW50QXJyYXksIGluZGV4
LCByZW1vdmVkQ291bnQsIGFkZGVkQ291bnQpIHsKICAgIGlmICh0aGlzLnN1c3BlbmRlZCkgeyBy
ZXR1cm47IH0KCiAgICB2YXIgYWRkZWRJdGVtID0gdGhpcy5jYWxsYmFja3MuYWRkZWRJdGVtLAog
ICAgICAgIGd1aWQgPSBndWlkRm9yKGRlcGVuZGVudEFycmF5KSwKICAgICAgICBkZXBlbmRlbnRL
ZXkgPSB0aGlzLmRlcGVuZGVudEtleXNCeUd1aWRbZ3VpZF0sCiAgICAgICAgb2JzZXJ2ZXJDb250
ZXh0cyA9IG5ldyBBcnJheShhZGRlZENvdW50KSwKICAgICAgICBpdGVtUHJvcGVydHlLZXlzID0g
dGhpcy5jcC5faXRlbVByb3BlcnR5S2V5c1tkZXBlbmRlbnRLZXldLAogICAgICAgIGxlbmd0aCA9
IGdldChkZXBlbmRlbnRBcnJheSwgJ2xlbmd0aCcpLAogICAgICAgIG5vcm1hbGl6ZWRJbmRleCA9
IG5vcm1hbGl6ZUluZGV4KGluZGV4LCBsZW5ndGgsIGFkZGVkQ291bnQpLAogICAgICAgIGNoYW5n
ZU1ldGEsCiAgICAgICAgb2JzZXJ2ZXJDb250ZXh0OwoKICAgIGZvckVhY2goZGVwZW5kZW50QXJy
YXkuc2xpY2Uobm9ybWFsaXplZEluZGV4LCBub3JtYWxpemVkSW5kZXggKyBhZGRlZENvdW50KSwg
ZnVuY3Rpb24gKGl0ZW0sIHNsaWNlSW5kZXgpIHsKICAgICAgaWYgKGl0ZW1Qcm9wZXJ0eUtleXMp
IHsKICAgICAgICBvYnNlcnZlckNvbnRleHQgPQogICAgICAgICAgb2JzZXJ2ZXJDb250ZXh0c1tz
bGljZUluZGV4XSA9CiAgICAgICAgICB0aGlzLmNyZWF0ZVByb3BlcnR5T2JzZXJ2ZXJDb250ZXh0
KGRlcGVuZGVudEFycmF5LCBub3JtYWxpemVkSW5kZXggKyBzbGljZUluZGV4LCB0aGlzLnRyYWNr
ZWRBcnJheXNCeUd1aWRbZGVwZW5kZW50S2V5XSk7CiAgICAgICAgZm9yRWFjaChpdGVtUHJvcGVy
dHlLZXlzLCBmdW5jdGlvbiAocHJvcGVydHlLZXkpIHsKICAgICAgICAgIGFkZEJlZm9yZU9ic2Vy
dmVyKGl0ZW0sIHByb3BlcnR5S2V5LCB0aGlzLCBvYnNlcnZlckNvbnRleHQuYmVmb3JlT2JzZXJ2
ZXIpOwogICAgICAgICAgYWRkT2JzZXJ2ZXIoaXRlbSwgcHJvcGVydHlLZXksIHRoaXMsIG9ic2Vy
dmVyQ29udGV4dC5vYnNlcnZlcik7CiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIGNo
YW5nZU1ldGEgPSBjcmVhdGVDaGFuZ2VNZXRhKGRlcGVuZGVudEFycmF5LCBpdGVtLCBub3JtYWxp
emVkSW5kZXggKyBzbGljZUluZGV4LCB0aGlzLmluc3RhbmNlTWV0YS5wcm9wZXJ0eU5hbWUsIHRo
aXMuY3ApOwogICAgICB0aGlzLnNldFZhbHVlKCBhZGRlZEl0ZW0uY2FsbCgKICAgICAgICB0aGlz
Lmluc3RhbmNlTWV0YS5jb250ZXh0LCB0aGlzLmdldFZhbHVlKCksIGl0ZW0sIGNoYW5nZU1ldGEs
IHRoaXMuaW5zdGFuY2VNZXRhLnN1Z2FyTWV0YSkpOwogICAgfSwgdGhpcyk7CgogICAgdGhpcy50
cmFja0FkZChkZXBlbmRlbnRLZXksIG5vcm1hbGl6ZWRJbmRleCwgb2JzZXJ2ZXJDb250ZXh0cyk7
CiAgfSwKCiAgaXRlbVByb3BlcnR5V2lsbENoYW5nZTogZnVuY3Rpb24gKG9iaiwga2V5TmFtZSwg
YXJyYXksIG9ic2VydmVyQ29udGV4dCkgewogICAgdmFyIGd1aWQgPSBndWlkRm9yKG9iaik7Cgog
ICAgaWYgKCF0aGlzLmNoYW5nZWRJdGVtc1tndWlkXSkgewogICAgICB0aGlzLmNoYW5nZWRJdGVt
c1tndWlkXSA9IHsKICAgICAgICBhcnJheTogICAgICAgICAgICBhcnJheSwKICAgICAgICBvYnNl
cnZlckNvbnRleHQ6ICBvYnNlcnZlckNvbnRleHQsCiAgICAgICAgb2JqOiAgICAgICAgICAgICAg
b2JqLAogICAgICAgIHByZXZpb3VzVmFsdWVzOiAgIHt9CiAgICAgIH07CiAgICB9CgogICAgdGhp
cy5jaGFuZ2VkSXRlbXNbZ3VpZF0ucHJldmlvdXNWYWx1ZXNba2V5TmFtZV0gPSBnZXQob2JqLCBr
ZXlOYW1lKTsKICB9LAoKICBpdGVtUHJvcGVydHlEaWRDaGFuZ2U6IGZ1bmN0aW9uKG9iaiwga2V5
TmFtZSwgYXJyYXksIG9ic2VydmVyQ29udGV4dCkgewogICAgdGhpcy5mbHVzaENoYW5nZXMoKTsK
ICB9LAoKICBmbHVzaENoYW5nZXM6IGZ1bmN0aW9uKCkgewogICAgdmFyIGNoYW5nZWRJdGVtcyA9
IHRoaXMuY2hhbmdlZEl0ZW1zLCBrZXksIGMsIGNoYW5nZU1ldGE7CgogICAgZm9yIChrZXkgaW4g
Y2hhbmdlZEl0ZW1zKSB7CiAgICAgIGMgPSBjaGFuZ2VkSXRlbXNba2V5XTsKICAgICAgaWYgKGMu
b2JzZXJ2ZXJDb250ZXh0LmRlc3Ryb3llZCkgeyBjb250aW51ZTsgfQoKICAgICAgdGhpcy51cGRh
dGVJbmRleGVzKGMub2JzZXJ2ZXJDb250ZXh0LnRyYWNrZWRBcnJheSwgYy5vYnNlcnZlckNvbnRl
eHQuZGVwZW5kZW50QXJyYXkpOwoKICAgICAgY2hhbmdlTWV0YSA9IGNyZWF0ZUNoYW5nZU1ldGEo
Yy5hcnJheSwgYy5vYmosIGMub2JzZXJ2ZXJDb250ZXh0LmluZGV4LCB0aGlzLmluc3RhbmNlTWV0
YS5wcm9wZXJ0eU5hbWUsIHRoaXMuY3AsIGMucHJldmlvdXNWYWx1ZXMpOwogICAgICB0aGlzLnNl
dFZhbHVlKAogICAgICAgIHRoaXMuY2FsbGJhY2tzLnJlbW92ZWRJdGVtLmNhbGwodGhpcy5pbnN0
YW5jZU1ldGEuY29udGV4dCwgdGhpcy5nZXRWYWx1ZSgpLCBjLm9iaiwgY2hhbmdlTWV0YSwgdGhp
cy5pbnN0YW5jZU1ldGEuc3VnYXJNZXRhKSk7CiAgICAgIHRoaXMuc2V0VmFsdWUoCiAgICAgICAg
dGhpcy5jYWxsYmFja3MuYWRkZWRJdGVtLmNhbGwodGhpcy5pbnN0YW5jZU1ldGEuY29udGV4dCwg
dGhpcy5nZXRWYWx1ZSgpLCBjLm9iaiwgY2hhbmdlTWV0YSwgdGhpcy5pbnN0YW5jZU1ldGEuc3Vn
YXJNZXRhKSk7CiAgICB9CiAgICB0aGlzLmNoYW5nZWRJdGVtcyA9IHt9OwogIH0KfTsKCmZ1bmN0
aW9uIG5vcm1hbGl6ZUluZGV4KGluZGV4LCBsZW5ndGgsIG5ld0l0ZW1zT2Zmc2V0KSB7CiAgaWYg
KGluZGV4IDwgMCkgewogICAgcmV0dXJuIE1hdGgubWF4KDAsIGxlbmd0aCArIGluZGV4KTsKICB9
IGVsc2UgaWYgKGluZGV4IDwgbGVuZ3RoKSB7CiAgICByZXR1cm4gaW5kZXg7CiAgfSBlbHNlIC8q
IGluZGV4ID4gbGVuZ3RoICovIHsKICAgIHJldHVybiBNYXRoLm1pbihsZW5ndGggLSBuZXdJdGVt
c09mZnNldCwgaW5kZXgpOwogIH0KfQoKZnVuY3Rpb24gbm9ybWFsaXplUmVtb3ZlQ291bnQoaW5k
ZXgsIGxlbmd0aCwgcmVtb3ZlZENvdW50KSB7CiAgcmV0dXJuIE1hdGgubWluKHJlbW92ZWRDb3Vu
dCwgbGVuZ3RoIC0gaW5kZXgpOwp9CgpmdW5jdGlvbiBjcmVhdGVDaGFuZ2VNZXRhKGRlcGVuZGVu
dEFycmF5LCBpdGVtLCBpbmRleCwgcHJvcGVydHlOYW1lLCBwcm9wZXJ0eSwgcHJldmlvdXNWYWx1
ZXMpIHsKICB2YXIgbWV0YSA9IHsKICAgIGFycmF5Q2hhbmdlZDogZGVwZW5kZW50QXJyYXksCiAg
ICBpbmRleDogaW5kZXgsCiAgICBpdGVtOiBpdGVtLAogICAgcHJvcGVydHlOYW1lOiBwcm9wZXJ0
eU5hbWUsCiAgICBwcm9wZXJ0eTogcHJvcGVydHkKICB9OwoKICBpZiAocHJldmlvdXNWYWx1ZXMp
IHsKICAgIC8vIHByZXZpb3VzIHZhbHVlcyBvbmx5IGF2YWlsYWJsZSBmb3IgaXRlbSBwcm9wZXJ0
eSBjaGFuZ2VzCiAgICBtZXRhLnByZXZpb3VzVmFsdWVzID0gcHJldmlvdXNWYWx1ZXM7CiAgfQoK
ICByZXR1cm4gbWV0YTsKfQoKZnVuY3Rpb24gYWRkSXRlbXMgKGRlcGVuZGVudEFycmF5LCBjYWxs
YmFja3MsIGNwLCBwcm9wZXJ0eU5hbWUsIG1ldGEpIHsKICBmb3JFYWNoKGRlcGVuZGVudEFycmF5
LCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgIG1ldGEuc2V0VmFsdWUoIGNhbGxiYWNrcy5h
ZGRlZEl0ZW0uY2FsbCgKICAgICAgdGhpcywgbWV0YS5nZXRWYWx1ZSgpLCBpdGVtLCBjcmVhdGVD
aGFuZ2VNZXRhKGRlcGVuZGVudEFycmF5LCBpdGVtLCBpbmRleCwgcHJvcGVydHlOYW1lLCBjcCks
IG1ldGEuc3VnYXJNZXRhKSk7CiAgfSwgdGhpcyk7Cn0KCmZ1bmN0aW9uIHJlc2V0KGNwLCBwcm9w
ZXJ0eU5hbWUpIHsKICB2YXIgY2FsbGJhY2tzID0gY3AuX2NhbGxiYWNrcygpLAogICAgICBtZXRh
OwoKICBpZiAoY3AuX2hhc0luc3RhbmNlTWV0YSh0aGlzLCBwcm9wZXJ0eU5hbWUpKSB7CiAgICBt
ZXRhID0gY3AuX2luc3RhbmNlTWV0YSh0aGlzLCBwcm9wZXJ0eU5hbWUpOwogICAgbWV0YS5zZXRW
YWx1ZShjcC5yZXNldFZhbHVlKG1ldGEuZ2V0VmFsdWUoKSkpOwogIH0gZWxzZSB7CiAgICBtZXRh
ID0gY3AuX2luc3RhbmNlTWV0YSh0aGlzLCBwcm9wZXJ0eU5hbWUpOwogIH0KCiAgaWYgKGNwLm9w
dGlvbnMuaW5pdGlhbGl6ZSkgewogICAgY3Aub3B0aW9ucy5pbml0aWFsaXplLmNhbGwodGhpcywg
bWV0YS5nZXRWYWx1ZSgpLCB7IHByb3BlcnR5OiBjcCwgcHJvcGVydHlOYW1lOiBwcm9wZXJ0eU5h
bWUgfSwgbWV0YS5zdWdhck1ldGEpOwogIH0KfQoKZnVuY3Rpb24gcGFydGlhbGx5UmVjb21wdXRl
Rm9yKG9iaiwgZGVwZW5kZW50S2V5KSB7CiAgaWYgKGFycmF5QnJhY2tldFBhdHRlcm4udGVzdChk
ZXBlbmRlbnRLZXkpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB2YXIgdmFsdWUgPSBnZXQo
b2JqLCBkZXBlbmRlbnRLZXkpOwogIHJldHVybiBFbWJlci5BcnJheS5kZXRlY3QodmFsdWUpOwp9
CgpmdW5jdGlvbiBSZWR1Y2VDb21wdXRlZFByb3BlcnR5SW5zdGFuY2VNZXRhKGNvbnRleHQsIHBy
b3BlcnR5TmFtZSwgaW5pdGlhbFZhbHVlKSB7CiAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsKICB0
aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTsKICB0aGlzLmNhY2hlID0gbWV0YUZvcihj
b250ZXh0KS5jYWNoZTsKCiAgdGhpcy5kZXBlbmRlbnRBcnJheXMgPSB7fTsKICB0aGlzLnN1Z2Fy
TWV0YSA9IHt9OwoKICB0aGlzLmluaXRpYWxWYWx1ZSA9IGluaXRpYWxWYWx1ZTsKfQoKUmVkdWNl
Q29tcHV0ZWRQcm9wZXJ0eUluc3RhbmNlTWV0YS5wcm90b3R5cGUgPSB7CiAgZ2V0VmFsdWU6IGZ1
bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnByb3BlcnR5TmFtZSBpbiB0aGlzLmNhY2hlKSB7CiAg
ICAgIHJldHVybiB0aGlzLmNhY2hlW3RoaXMucHJvcGVydHlOYW1lXTsKICAgIH0gZWxzZSB7CiAg
ICAgIHJldHVybiB0aGlzLmluaXRpYWxWYWx1ZTsKICAgIH0KICB9LAoKICBzZXRWYWx1ZTogZnVu
Y3Rpb24obmV3VmFsdWUsIHRyaWdnZXJPYnNlcnZlcnMpIHsKICAgIC8vIFRoaXMgbGV0cyBzdWdh
cnMgZm9yY2UgYSByZWNvbXB1dGF0aW9uLCBoYW5keSBmb3IgdmVyeSBzaW1wbGUKICAgIC8vIGlt
cGxlbWVudGF0aW9ucyBvZiBlZyBtYXguCiAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCkg
ewogICAgICB2YXIgZmlyZU9ic2VydmVycyA9IHRyaWdnZXJPYnNlcnZlcnMgJiYgKG5ld1ZhbHVl
ICE9PSB0aGlzLmNhY2hlW3RoaXMucHJvcGVydHlOYW1lXSk7CgogICAgICBpZiAoZmlyZU9ic2Vy
dmVycykgewogICAgICAgIHByb3BlcnR5V2lsbENoYW5nZSh0aGlzLmNvbnRleHQsIHRoaXMucHJv
cGVydHlOYW1lKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZVt0aGlzLnByb3BlcnR5TmFtZV0g
PSBuZXdWYWx1ZTsKCiAgICAgIGlmIChmaXJlT2JzZXJ2ZXJzKSB7CiAgICAgICAgcHJvcGVydHlE
aWRDaGFuZ2UodGhpcy5jb250ZXh0LCB0aGlzLnByb3BlcnR5TmFtZSk7CiAgICAgIH0KICAgIH0g
ZWxzZSB7CiAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlW3RoaXMucHJvcGVydHlOYW1lXTsKICAgIH0K
ICB9Cn07CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHdob3NlIGRlcGVuZGVudCBrZXlzIGFy
ZSBhcnJheXMgYW5kIHdoaWNoIGlzIHVwZGF0ZWQgd2l0aAogICJvbmUgYXQgYSB0aW1lIiBzZW1h
bnRpY3MuCgogIEBjbGFzcyBSZWR1Y2VDb21wdXRlZFByb3BlcnR5CiAgQG5hbWVzcGFjZSBFbWJl
cgogIEBleHRlbmRzIEVtYmVyLkNvbXB1dGVkUHJvcGVydHkKICBAY29uc3RydWN0b3IKKi8KZnVu
Y3Rpb24gUmVkdWNlQ29tcHV0ZWRQcm9wZXJ0eShvcHRpb25zKSB7CiAgdmFyIGNwID0gdGhpczsK
CiAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICB0aGlzLl9pbnN0YW5jZU1ldGFzID0ge307Cgog
IHRoaXMuX2RlcGVuZGVudEtleXMgPSBudWxsOwogIC8vIEEgbWFwIG9mIGRlcGVuZGVudEtleSAt
PiBbaXRlbVByb3BlcnR5LCAuLi5dIHRoYXQgdHJhY2tzIHdoYXQgcHJvcGVydGllcyBvZgogIC8v
IGl0ZW1zIGluIHRoZSBhcnJheSB3ZSBtdXN0IHRyYWNrIHRvIHVwZGF0ZSB0aGlzIHByb3BlcnR5
LgogIHRoaXMuX2l0ZW1Qcm9wZXJ0eUtleXMgPSB7fTsKICB0aGlzLl9wcmV2aW91c0l0ZW1Qcm9w
ZXJ0eUtleXMgPSB7fTsKCiAgdGhpcy5yZWFkT25seSgpOwogIHRoaXMuY2FjaGVhYmxlKCk7Cgog
IHRoaXMucmVjb21wdXRlT25jZSA9IGZ1bmN0aW9uKHByb3BlcnR5TmFtZSkgewogICAgLy8gV2hh
dCB3ZSByZWFsbHkgd2FudCB0byBkbyBpcyBjb2FsZXNjZSBieSA8Y3AsIHByb3BlcnR5TmFtZT4u
CiAgICAvLyBXZSBuZWVkIGEgZm9ybSBvZiBgc2NoZWR1bGVPbmNlYCB0aGF0IGFjY2VwdHMgYW4g
YXJiaXRyYXJ5IHRva2VuIHRvCiAgICAvLyBjb2FsZXNjZSBieSwgaW4gYWRkaXRpb24gdG8gdGhl
IHRhcmdldCBhbmQgbWV0aG9kLgogICAgRW1iZXIucnVuLm9uY2UodGhpcywgcmVjb21wdXRlLCBw
cm9wZXJ0eU5hbWUpOwogIH07CiAgdmFyIHJlY29tcHV0ZSA9IGZ1bmN0aW9uKHByb3BlcnR5TmFt
ZSkgewogICAgdmFyIGRlcGVuZGVudEtleXMgPSBjcC5fZGVwZW5kZW50S2V5cywKICAgICAgICBt
ZXRhID0gY3AuX2luc3RhbmNlTWV0YSh0aGlzLCBwcm9wZXJ0eU5hbWUpLAogICAgICAgIGNhbGxi
YWNrcyA9IGNwLl9jYWxsYmFja3MoKTsKCiAgICByZXNldC5jYWxsKHRoaXMsIGNwLCBwcm9wZXJ0
eU5hbWUpOwoKICAgIG1ldGEuZGVwZW5kZW50QXJyYXlzT2JzZXJ2ZXIuc3VzcGVuZEFycmF5T2Jz
ZXJ2ZXJzKGZ1bmN0aW9uICgpIHsKICAgICAgZm9yRWFjaChjcC5fZGVwZW5kZW50S2V5cywgZnVu
Y3Rpb24gKGRlcGVuZGVudEtleSkgewogICAgICAgIGlmICghcGFydGlhbGx5UmVjb21wdXRlRm9y
KHRoaXMsIGRlcGVuZGVudEtleSkpIHsgcmV0dXJuOyB9CgogICAgICAgIHZhciBkZXBlbmRlbnRB
cnJheSA9IGdldCh0aGlzLCBkZXBlbmRlbnRLZXkpLAogICAgICAgICAgICBwcmV2aW91c0RlcGVu
ZGVudEFycmF5ID0gbWV0YS5kZXBlbmRlbnRBcnJheXNbZGVwZW5kZW50S2V5XTsKCiAgICAgICAg
aWYgKGRlcGVuZGVudEFycmF5ID09PSBwcmV2aW91c0RlcGVuZGVudEFycmF5KSB7CiAgICAgICAg
ICAvLyBUaGUgYXJyYXkgbWF5IGJlIHRoZSBzYW1lLCBidXQgb3VyIGl0ZW0gcHJvcGVydHkga2V5
cyBtYXkgaGF2ZQogICAgICAgICAgLy8gY2hhbmdlZCwgc28gd2Ugc2V0IHRoZW0gdXAgYWdhaW4u
ICBXZSBjYW4ndCBlYXNpbHkgdGVsbCBpZiB0aGV5J3ZlCiAgICAgICAgICAvLyBjaGFuZ2VkOiB0
aGUgYXJyYXkgbWF5IGJlIHRoZSBzYW1lIG9iamVjdCwgYnV0IHdpdGggZGlmZmVyZW50CiAgICAg
ICAgICAvLyBjb250ZW50cy4KICAgICAgICAgIGlmIChjcC5fcHJldmlvdXNJdGVtUHJvcGVydHlL
ZXlzW2RlcGVuZGVudEtleV0pIHsKICAgICAgICAgICAgZGVsZXRlIGNwLl9wcmV2aW91c0l0ZW1Q
cm9wZXJ0eUtleXNbZGVwZW5kZW50S2V5XTsKICAgICAgICAgICAgbWV0YS5kZXBlbmRlbnRBcnJh
eXNPYnNlcnZlci5zZXR1cFByb3BlcnR5T2JzZXJ2ZXJzKGRlcGVuZGVudEtleSwgY3AuX2l0ZW1Q
cm9wZXJ0eUtleXNbZGVwZW5kZW50S2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK
ICAgICAgICAgIG1ldGEuZGVwZW5kZW50QXJyYXlzW2RlcGVuZGVudEtleV0gPSBkZXBlbmRlbnRB
cnJheTsKCiAgICAgICAgICBpZiAocHJldmlvdXNEZXBlbmRlbnRBcnJheSkgewogICAgICAgICAg
ICBtZXRhLmRlcGVuZGVudEFycmF5c09ic2VydmVyLnRlYXJkb3duT2JzZXJ2ZXJzKHByZXZpb3Vz
RGVwZW5kZW50QXJyYXksIGRlcGVuZGVudEtleSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYg
KGRlcGVuZGVudEFycmF5KSB7CiAgICAgICAgICAgIG1ldGEuZGVwZW5kZW50QXJyYXlzT2JzZXJ2
ZXIuc2V0dXBPYnNlcnZlcnMoZGVwZW5kZW50QXJyYXksIGRlcGVuZGVudEtleSk7CiAgICAgICAg
ICB9CiAgICAgICAgfQogICAgICB9LCB0aGlzKTsKICAgIH0sIHRoaXMpOwoKICAgIGZvckVhY2go
Y3AuX2RlcGVuZGVudEtleXMsIGZ1bmN0aW9uKGRlcGVuZGVudEtleSkgewogICAgICBpZiAoIXBh
cnRpYWxseVJlY29tcHV0ZUZvcih0aGlzLCBkZXBlbmRlbnRLZXkpKSB7IHJldHVybjsgfQoKICAg
ICAgdmFyIGRlcGVuZGVudEFycmF5ID0gZ2V0KHRoaXMsIGRlcGVuZGVudEtleSk7CiAgICAgIGlm
IChkZXBlbmRlbnRBcnJheSkgewogICAgICAgIGFkZEl0ZW1zLmNhbGwodGhpcywgZGVwZW5kZW50
QXJyYXksIGNhbGxiYWNrcywgY3AsIHByb3BlcnR5TmFtZSwgbWV0YSk7CiAgICAgIH0KICAgIH0s
IHRoaXMpOwogIH07CgogIHRoaXMuZnVuYyA9IGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUpIHsKICAg
IEVtYmVyLmFzc2VydCgiQ29tcHV0ZWQgcmVkdWNlIHZhbHVlcyByZXF1aXJlIGF0IGxlYXN0IG9u
ZSBkZXBlbmRlbnQga2V5IiwgY3AuX2RlcGVuZGVudEtleXMpOwoKICAgIHJlY29tcHV0ZS5jYWxs
KHRoaXMsIHByb3BlcnR5TmFtZSk7CgogICAgcmV0dXJuIGNwLl9pbnN0YW5jZU1ldGEodGhpcywg
cHJvcGVydHlOYW1lKS5nZXRWYWx1ZSgpOwogIH07Cn0KCkVtYmVyLlJlZHVjZUNvbXB1dGVkUHJv
cGVydHkgPSBSZWR1Y2VDb21wdXRlZFByb3BlcnR5OwpSZWR1Y2VDb21wdXRlZFByb3BlcnR5LnBy
b3RvdHlwZSA9IG9fY3JlYXRlKENvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlKTsKCmZ1bmN0aW9u
IGRlZmF1bHRDYWxsYmFjayhjb21wdXRlZFZhbHVlKSB7CiAgcmV0dXJuIGNvbXB1dGVkVmFsdWU7
Cn0KClJlZHVjZUNvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlLl9jYWxsYmFja3MgPSBmdW5jdGlv
biAoKSB7CiAgaWYgKCF0aGlzLmNhbGxiYWNrcykgewogICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9w
dGlvbnM7CiAgICB0aGlzLmNhbGxiYWNrcyA9IHsKICAgICAgcmVtb3ZlZEl0ZW06IG9wdGlvbnMu
cmVtb3ZlZEl0ZW0gfHwgZGVmYXVsdENhbGxiYWNrLAogICAgICBhZGRlZEl0ZW06IG9wdGlvbnMu
YWRkZWRJdGVtIHx8IGRlZmF1bHRDYWxsYmFjawogICAgfTsKICB9CiAgcmV0dXJuIHRoaXMuY2Fs
bGJhY2tzOwp9OwoKUmVkdWNlQ29tcHV0ZWRQcm9wZXJ0eS5wcm90b3R5cGUuX2hhc0luc3RhbmNl
TWV0YSA9IGZ1bmN0aW9uIChjb250ZXh0LCBwcm9wZXJ0eU5hbWUpIHsKICB2YXIgZ3VpZCA9IGd1
aWRGb3IoY29udGV4dCksCiAgICAgIGtleSA9IGd1aWQgKyAnOicgKyBwcm9wZXJ0eU5hbWU7Cgog
IHJldHVybiAhIXRoaXMuX2luc3RhbmNlTWV0YXNba2V5XTsKfTsKClJlZHVjZUNvbXB1dGVkUHJv
cGVydHkucHJvdG90eXBlLl9pbnN0YW5jZU1ldGEgPSBmdW5jdGlvbiAoY29udGV4dCwgcHJvcGVy
dHlOYW1lKSB7CiAgdmFyIGd1aWQgPSBndWlkRm9yKGNvbnRleHQpLAogICAgICBrZXkgPSBndWlk
ICsgJzonICsgcHJvcGVydHlOYW1lLAogICAgICBtZXRhID0gdGhpcy5faW5zdGFuY2VNZXRhc1tr
ZXldOwoKICBpZiAoIW1ldGEpIHsKICAgIG1ldGEgPSB0aGlzLl9pbnN0YW5jZU1ldGFzW2tleV0g
PSBuZXcgUmVkdWNlQ29tcHV0ZWRQcm9wZXJ0eUluc3RhbmNlTWV0YShjb250ZXh0LCBwcm9wZXJ0
eU5hbWUsIHRoaXMuaW5pdGlhbFZhbHVlKCkpOwogICAgbWV0YS5kZXBlbmRlbnRBcnJheXNPYnNl
cnZlciA9IG5ldyBEZXBlbmRlbnRBcnJheXNPYnNlcnZlcih0aGlzLl9jYWxsYmFja3MoKSwgdGhp
cywgbWV0YSwgY29udGV4dCwgcHJvcGVydHlOYW1lLCBtZXRhLnN1Z2FyTWV0YSk7CiAgfQoKICBy
ZXR1cm4gbWV0YTsKfTsKClJlZHVjZUNvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlLmluaXRpYWxW
YWx1ZSA9IGZ1bmN0aW9uICgpIHsKICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5pbml0aWFsVmFs
dWUgPT09ICdmdW5jdGlvbicpIHsKICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaW5pdGlhbFZhbHVl
KCk7CiAgfQogIGVsc2UgewogICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pbml0aWFsVmFsdWU7CiAg
fQp9OwoKUmVkdWNlQ29tcHV0ZWRQcm9wZXJ0eS5wcm90b3R5cGUucmVzZXRWYWx1ZSA9IGZ1bmN0
aW9uICh2YWx1ZSkgewogIHJldHVybiB0aGlzLmluaXRpYWxWYWx1ZSgpOwp9OwoKUmVkdWNlQ29t
cHV0ZWRQcm9wZXJ0eS5wcm90b3R5cGUuaXRlbVByb3BlcnR5S2V5ID0gZnVuY3Rpb24gKGRlcGVu
ZGVudEFycmF5S2V5LCBpdGVtUHJvcGVydHlLZXkpIHsKICB0aGlzLl9pdGVtUHJvcGVydHlLZXlz
W2RlcGVuZGVudEFycmF5S2V5XSA9IHRoaXMuX2l0ZW1Qcm9wZXJ0eUtleXNbZGVwZW5kZW50QXJy
YXlLZXldIHx8IFtdOwogIHRoaXMuX2l0ZW1Qcm9wZXJ0eUtleXNbZGVwZW5kZW50QXJyYXlLZXld
LnB1c2goaXRlbVByb3BlcnR5S2V5KTsKfTsKClJlZHVjZUNvbXB1dGVkUHJvcGVydHkucHJvdG90
eXBlLmNsZWFySXRlbVByb3BlcnR5S2V5cyA9IGZ1bmN0aW9uIChkZXBlbmRlbnRBcnJheUtleSkg
ewogIGlmICh0aGlzLl9pdGVtUHJvcGVydHlLZXlzW2RlcGVuZGVudEFycmF5S2V5XSkgewogICAg
dGhpcy5fcHJldmlvdXNJdGVtUHJvcGVydHlLZXlzW2RlcGVuZGVudEFycmF5S2V5XSA9IHRoaXMu
X2l0ZW1Qcm9wZXJ0eUtleXNbZGVwZW5kZW50QXJyYXlLZXldOwogICAgdGhpcy5faXRlbVByb3Bl
cnR5S2V5c1tkZXBlbmRlbnRBcnJheUtleV0gPSBbXTsKICB9Cn07CgpSZWR1Y2VDb21wdXRlZFBy
b3BlcnR5LnByb3RvdHlwZS5wcm9wZXJ0eSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgY3AgPSB0aGlz
LAogICAgICBhcmdzID0gYV9zbGljZS5jYWxsKGFyZ3VtZW50cyksCiAgICAgIHByb3BlcnR5QXJn
cyA9IG5ldyBFbWJlci5TZXQoKSwKICAgICAgbWF0Y2gsCiAgICAgIGRlcGVuZGVudEFycmF5S2V5
LAogICAgICBpdGVtUHJvcGVydHlLZXk7CgogIGZvckVhY2goYV9zbGljZS5jYWxsKGFyZ3VtZW50
cyksIGZ1bmN0aW9uIChkZXBlbmRlbnRLZXkpIHsKICAgIGlmIChkb3VibGVFYWNoUHJvcGVydHlQ
YXR0ZXJuLnRlc3QoZGVwZW5kZW50S2V5KSkgewogICAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3Io
Ik5lc3RlZCBAZWFjaCBwcm9wZXJ0aWVzIG5vdCBzdXBwb3J0ZWQ6ICIgKyBkZXBlbmRlbnRLZXkp
OwogICAgfSBlbHNlIGlmIChtYXRjaCA9IGVhY2hQcm9wZXJ0eVBhdHRlcm4uZXhlYyhkZXBlbmRl
bnRLZXkpKSB7CiAgICAgIGRlcGVuZGVudEFycmF5S2V5ID0gbWF0Y2hbMV07CgogICAgICAKICAg
ICAgICBpdGVtUHJvcGVydHlLZXkgPSBtYXRjaFsyXTsKICAgICAgICBjcC5pdGVtUHJvcGVydHlL
ZXkoZGVwZW5kZW50QXJyYXlLZXksIGl0ZW1Qcm9wZXJ0eUtleSk7CiAgICAgIAogICAgICBwcm9w
ZXJ0eUFyZ3MuYWRkKGRlcGVuZGVudEFycmF5S2V5KTsKICAgIH0gZWxzZSB7CiAgICAgIHByb3Bl
cnR5QXJncy5hZGQoZGVwZW5kZW50S2V5KTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIENvbXB1dGVk
UHJvcGVydHkucHJvdG90eXBlLnByb3BlcnR5LmFwcGx5KHRoaXMsIHByb3BlcnR5QXJncy50b0Fy
cmF5KCkpOwoKfTsKCi8qKgogIENyZWF0ZXMgYSBjb21wdXRlZCBwcm9wZXJ0eSB3aGljaCBvcGVy
YXRlcyBvbiBkZXBlbmRlbnQgYXJyYXlzIGFuZAogIGlzIHVwZGF0ZWQgd2l0aCAib25lIGF0IGEg
dGltZSIgc2VtYW50aWNzLiBXaGVuIGl0ZW1zIGFyZSBhZGRlZCBvcgogIHJlbW92ZWQgZnJvbSB0
aGUgZGVwZW5kZW50IGFycmF5KHMpIGEgcmVkdWNlIGNvbXB1dGVkIG9ubHkgb3BlcmF0ZXMKICBv
biB0aGUgY2hhbmdlIGluc3RlYWQgb2YgcmUtZXZhbHVhdGluZyB0aGUgZW50aXJlIGFycmF5LgoK
ICBJZiB0aGVyZSBhcmUgbW9yZSB0aGFuIG9uZSBhcmd1bWVudHMgdGhlIGZpcnN0IGFyZ3VtZW50
cyBhcmUKICBjb25zaWRlcmVkIHRvIGJlIGRlcGVuZGVudCBwcm9wZXJ0eSBrZXlzLiBUaGUgbGFz
dCBhcmd1bWVudCBpcwogIHJlcXVpcmVkIHRvIGJlIGFuIG9wdGlvbnMgb2JqZWN0LiBUaGUgb3B0
aW9ucyBvYmplY3QgY2FuIGhhdmUgdGhlCiAgZm9sbG93aW5nIGZvdXIgcHJvcGVydGllczoKCiAg
YGluaXRpYWxWYWx1ZWAgLSBBIHZhbHVlIG9yIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIGFz
IHRoZSBpbml0aWFsCiAgdmFsdWUgZm9yIHRoZSBjb21wdXRlZC4gSWYgdGhpcyBwcm9wZXJ0eSBp
cyBhIGZ1bmN0aW9uIHRoZSByZXN1bHQgb2YgY2FsbGluZwogIHRoZSBmdW5jdGlvbiB3aWxsIGJl
IHVzZWQgYXMgdGhlIGluaXRpYWwgdmFsdWUuIFRoaXMgcHJvcGVydHkgaXMgcmVxdWlyZWQuCgog
IGBpbml0aWFsaXplYCAtIEFuIG9wdGlvbmFsIGluaXRpYWxpemUgZnVuY3Rpb24uIFR5cGljYWxs
eSB0aGlzIHdpbGwgYmUgdXNlZAogIHRvIHNldCB1cCBzdGF0ZSBvbiB0aGUgaW5zdGFuY2VNZXRh
IG9iamVjdC4KCiAgYHJlbW92ZWRJdGVtYCAtIEEgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZWFj
aCB0aW1lIGFuIGVsZW1lbnQgaXMgcmVtb3ZlZAogIGZyb20gdGhlIGFycmF5LgoKICBgYWRkZWRJ
dGVtYCAtIEEgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZWFjaCB0aW1lIGFuIGVsZW1lbnQgaXMg
YWRkZWQgdG8KICB0aGUgYXJyYXkuCgoKICBUaGUgYGluaXRpYWxpemVgIGZ1bmN0aW9uIGhhcyB0
aGUgZm9sbG93aW5nIHNpZ25hdHVyZToKCiAgYGBgamF2YXNjcmlwdAogICBmdW5jdGlvbiAoaW5p
dGlhbFZhbHVlLCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpCiAgYGBgCgogIGBpbml0aWFsVmFs
dWVgIC0gVGhlIHZhbHVlIG9mIHRoZSBgaW5pdGlhbFZhbHVlYCBwcm9wZXJ0eSBmcm9tIHRoZQog
IG9wdGlvbnMgb2JqZWN0LgoKICBgY2hhbmdlTWV0YWAgLSBBbiBvYmplY3Qgd2hpY2ggY29udGFp
bnMgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUKICBjb21wdXRlZC4gSXQgY29udGFpbnMgdGhl
IGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoKICAgICAtIGBwcm9wZXJ0eWAgdGhlIGNvbXB1dGVkIHBy
b3BlcnR5CiAgICAgLSBgcHJvcGVydHlOYW1lYCB0aGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgb24g
dGhlIG9iamVjdAoKICBgaW5zdGFuY2VNZXRhYCAtIEFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2Vk
IHRvIHN0b3JlIG1ldGEKICBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIGNhbGN1bGF0aW5nIHlvdXIg
Y29tcHV0ZWQuIEZvciBleGFtcGxlIGEKICB1bmlxdWUgY29tcHV0ZWQgbWlnaHQgdXNlIHRoaXMg
dG8gc3RvcmUgdGhlIG51bWJlciBvZiB0aW1lcyBhIGdpdmVuCiAgZWxlbWVudCBpcyBmb3VuZCBp
biB0aGUgZGVwZW5kZW50IGFycmF5LgoKCiAgVGhlIGByZW1vdmVkSXRlbWAgYW5kIGBhZGRlZEl0
ZW1gIGZ1bmN0aW9ucyBib3RoIGhhdmUgdGhlIGZvbGxvd2luZyBzaWduYXR1cmU6CgogIGBgYGph
dmFzY3JpcHQKICBmdW5jdGlvbiAoYWNjdW11bGF0ZWRWYWx1ZSwgaXRlbSwgY2hhbmdlTWV0YSwg
aW5zdGFuY2VNZXRhKQogIGBgYAoKICBgYWNjdW11bGF0ZWRWYWx1ZWAgLSBUaGUgdmFsdWUgcmV0
dXJuZWQgZnJvbSB0aGUgbGFzdCB0aW1lCiAgYHJlbW92ZWRJdGVtYCBvciBgYWRkZWRJdGVtYCB3
YXMgY2FsbGVkIG9yIGBpbml0aWFsVmFsdWVgLgoKICBgaXRlbWAgLSB0aGUgZWxlbWVudCBhZGRl
ZCBvciByZW1vdmVkIGZyb20gdGhlIGFycmF5CgogIGBjaGFuZ2VNZXRhYCAtIEFuIG9iamVjdCB3
aGljaCBjb250YWlucyBtZXRhIGluZm9ybWF0aW9uIGFib3V0IHRoZQogIGNoYW5nZS4gSXQgY29u
dGFpbnMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoKICAgIC0gYHByb3BlcnR5YCB0aGUgY29t
cHV0ZWQgcHJvcGVydHkKICAgIC0gYHByb3BlcnR5TmFtZWAgdGhlIG5hbWUgb2YgdGhlIHByb3Bl
cnR5IG9uIHRoZSBvYmplY3QKICAgIC0gYGluZGV4YCB0aGUgaW5kZXggb2YgdGhlIGFkZGVkIG9y
IHJlbW92ZWQgaXRlbQogICAgLSBgaXRlbWAgdGhlIGFkZGVkIG9yIHJlbW92ZWQgaXRlbTogdGhp
cyBpcyBleGFjdGx5IHRoZSBzYW1lIGFzCiAgICAgIHRoZSBzZWNvbmQgYXJnCiAgICAtIGBhcnJh
eUNoYW5nZWRgIHRoZSBhcnJheSB0aGF0IHRyaWdnZXJlZCB0aGUgY2hhbmdlLiBDYW4gYmUKICAg
ICAgdXNlZnVsIHdoZW4gZGVwZW5kaW5nIG9uIG11bHRpcGxlIGFycmF5cy4KCiAgRm9yIHByb3Bl
cnR5IGNoYW5nZXMgdHJpZ2dlcmVkIG9uIGFuIGl0ZW0gcHJvcGVydHkgY2hhbmdlICh3aGVuCiAg
ZGVwS2V5IGlzIHNvbWV0aGluZyBsaWtlIGBzb21lQXJyYXkuQGVhY2guc29tZVByb3BlcnR5YCks
CiAgYGNoYW5nZU1ldGFgIHdpbGwgYWxzbyBjb250YWluIHRoZSBmb2xsb3dpbmcgcHJvcGVydHk6
CgogICAgLSBgcHJldmlvdXNWYWx1ZXNgIGFuIG9iamVjdCB3aG9zZSBrZXlzIGFyZSB0aGUgcHJv
cGVydGllcyB0aGF0IGNoYW5nZWQgb24KICAgIHRoZSBpdGVtLCBhbmQgd2hvc2UgdmFsdWVzIGFy
ZSB0aGUgaXRlbSdzIHByZXZpb3VzIHZhbHVlcy4KCiAgYHByZXZpb3VzVmFsdWVzYCBpcyBpbXBv
cnRhbnQgRW1iZXIgY29hbGVzY2VzIGl0ZW0gcHJvcGVydHkgY2hhbmdlcyB2aWEKICBFbWJlci5y
dW4ub25jZS4gVGhpcyBtZWFucyB0aGF0IGJ5IHRoZSB0aW1lIHJlbW92ZWRJdGVtIGdldHMgY2Fs
bGVkLCBpdGVtIGhhcwogIHRoZSBuZXcgdmFsdWVzLCBidXQgeW91IG1heSBuZWVkIHRoZSBwcmV2
aW91cyB2YWx1ZSAoZWcgZm9yIHNvcnRpbmcgJgogIGZpbHRlcmluZykuCgogIGBpbnN0YW5jZU1l
dGFgIC0gQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgbWV0YQogIGluZm9ybWF0
aW9uIG5lZWRlZCBmb3IgY2FsY3VsYXRpbmcgeW91ciBjb21wdXRlZC4gRm9yIGV4YW1wbGUgYQog
IHVuaXF1ZSBjb21wdXRlZCBtaWdodCB1c2UgdGhpcyB0byBzdG9yZSB0aGUgbnVtYmVyIG9mIHRp
bWVzIGEgZ2l2ZW4KICBlbGVtZW50IGlzIGZvdW5kIGluIHRoZSBkZXBlbmRlbnQgYXJyYXkuCgog
IFRoZSBgcmVtb3ZlZEl0ZW1gIGFuZCBgYWRkZWRJdGVtYCBmdW5jdGlvbnMgc2hvdWxkIHJldHVy
biB0aGUgYWNjdW11bGF0ZWQKICB2YWx1ZS4gSXQgaXMgYWNjZXB0YWJsZSB0byBub3QgcmV0dXJu
IGFueXRoaW5nIChpZSByZXR1cm4gdW5kZWZpbmVkKQogIHRvIGludmFsaWRhdGUgdGhlIGNvbXB1
dGF0aW9uLiBUaGlzIGlzIGdlbmVyYWxseSBub3QgYSBnb29kIGlkZWEgZm9yCiAgYXJyYXlDb21w
dXRlZCBidXQgaXQncyB1c2VkIGluIGVnIG1heCBhbmQgbWluLgoKICBOb3RlIHRoYXQgb2JzZXJ2
ZXJzIHdpbGwgYmUgZmlyZWQgaWYgZWl0aGVyIG9mIHRoZXNlIGZ1bmN0aW9ucyByZXR1cm4gYSB2
YWx1ZQogIHRoYXQgZGlmZmVycyBmcm9tIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS4gIFdoZW4gcmV0
dXJuaW5nIGFuIG9iamVjdCB0aGF0CiAgbXV0YXRlcyBpbiByZXNwb25zZSB0byBhcnJheSBjaGFu
Z2VzLCBmb3IgZXhhbXBsZSBhbiBhcnJheSB0aGF0IG1hcHMKICBldmVyeXRoaW5nIGZyb20gc29t
ZSBvdGhlciBhcnJheSAoc2VlIGBFbWJlci5jb21wdXRlZC5tYXBgKSwgaXQgaXMgdXN1YWxseQog
IGltcG9ydGFudCB0aGF0IHRoZSAqc2FtZSogYXJyYXkgYmUgcmV0dXJuZWQgdG8gYXZvaWQgYWNj
aWRlbnRhbGx5IHRyaWdnZXJpbmcgb2JzZXJ2ZXJzLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3Jp
cHQKICBFbWJlci5jb21wdXRlZC5tYXggPSBmdW5jdGlvbiAoZGVwZW5kZW50S2V5KSB7CiAgICBy
ZXR1cm4gRW1iZXIucmVkdWNlQ29tcHV0ZWQuY2FsbChudWxsLCBkZXBlbmRlbnRLZXksIHsKICAg
ICAgaW5pdGlhbFZhbHVlOiAtSW5maW5pdHksCgogICAgICBhZGRlZEl0ZW06IGZ1bmN0aW9uIChh
Y2N1bXVsYXRlZFZhbHVlLCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAg
ICByZXR1cm4gTWF0aC5tYXgoYWNjdW11bGF0ZWRWYWx1ZSwgaXRlbSk7CiAgICAgIH0sCgogICAg
ICByZW1vdmVkSXRlbTogZnVuY3Rpb24gKGFjY3VtdWxhdGVkVmFsdWUsIGl0ZW0sIGNoYW5nZU1l
dGEsIGluc3RhbmNlTWV0YSkgewogICAgICAgIGlmIChpdGVtIDwgYWNjdW11bGF0ZWRWYWx1ZSkg
ewogICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdGVkVmFsdWU7CiAgICAgICAgfQogICAgICB9CiAg
ICB9KTsKICB9OwogIGBgYAoKICBEZXBlbmRlbnQga2V5cyBtYXkgcmVmZXIgdG8gYEB0aGlzYCB0
byBvYnNlcnZlIGNoYW5nZXMgdG8gdGhlIG9iamVjdCBpdHNlbGYsCiAgd2hpY2ggbXVzdCBiZSBh
cnJheS1saWtlLCByYXRoZXIgdGhhbiBhIHByb3BlcnR5IG9mIHRoZSBvYmplY3QuICBUaGlzIGlz
CiAgbW9zdGx5IHVzZWZ1bCBmb3IgYXJyYXkgcHJveGllcywgdG8gZW5zdXJlIG9iamVjdHMgYXJl
IHJldHJpZXZlZCB2aWEKICBgb2JqZWN0QXRDb250ZW50YC4gIFRoaXMgaXMgaG93IHlvdSBjb3Vs
ZCBzb3J0IGl0ZW1zIGJ5IHByb3BlcnRpZXMgZGVmaW5lZCBvbiBhbiBpdGVtIGNvbnRyb2xsZXIu
CgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5QZW9wbGVDb250cm9sbGVyID0gRW1i
ZXIuQXJyYXlDb250cm9sbGVyLmV4dGVuZCh7CiAgICBpdGVtQ29udHJvbGxlcjogJ3BlcnNvbics
CgogICAgc29ydGVkUGVvcGxlOiBFbWJlci5jb21wdXRlZC5zb3J0KCdAdGhpcy5AZWFjaC5yZXZl
cnNlZE5hbWUnLCBmdW5jdGlvbihwZXJzb25BLCBwZXJzb25CKSB7CiAgICAgIC8vIGByZXZlcnNl
ZE5hbWVgIGlzbid0IGRlZmluZWQgb24gUGVyc29uLCBidXQgd2UgaGF2ZSBhY2Nlc3MgdG8gaXQg
dmlhCiAgICAgIC8vIHRoZSBpdGVtIGNvbnRyb2xsZXIgQXBwLlBlcnNvbkNvbnRyb2xsZXIuICBJ
ZiB3ZSdkIHVzZWQKICAgICAgLy8gYGNvbnRlbnQuQGVhY2gucmV2ZXJzZWROYW1lYCBhYm92ZSwg
d2Ugd291bGQgYmUgZ2V0dGluZyB0aGUgb2JqZWN0cwogICAgICAvLyBkaXJlY3RseSBhbmQgbm90
IGhhdmUgYWNjZXNzIHRvIGByZXZlcnNlZE5hbWVgLgogICAgICAvLwogICAgICB2YXIgcmV2ZXJz
ZWROYW1lQSA9IGdldChwZXJzb25BLCAncmV2ZXJzZWROYW1lJyksCiAgICAgICAgICByZXZlcnNl
ZE5hbWVCID0gZ2V0KHBlcnNvbkIsICdyZXZlcnNlZE5hbWUnKTsKCiAgICAgIHJldHVybiBFbWJl
ci5jb21wYXJlKHJldmVyc2VkTmFtZUEsIHJldmVyc2VkTmFtZUIpOwogICAgfSkKICB9KTsKCiAg
QXBwLlBlcnNvbkNvbnRyb2xsZXIgPSBFbWJlci5PYmplY3RDb250cm9sbGVyLmV4dGVuZCh7CiAg
ICByZXZlcnNlZE5hbWU6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHJldmVyc2UoZ2V0KHRo
aXMsICduYW1lJykpOwogICAgfS5wcm9wZXJ0eSgnbmFtZScpCiAgfSkKICBgYGAKCiAgRGVwZW5k
ZW50IGtleXMgd2hvc2UgdmFsdWVzIGFyZSBub3QgYXJyYXlzIGFyZSB0cmVhdGVkIGFzIHJlZ3Vs
YXIKICBkZXBlbmRlbmNpZXM6IHdoZW4gdGhleSBjaGFuZ2UsIHRoZSBjb21wdXRlZCBwcm9wZXJ0
eSBpcyBjb21wbGV0ZWx5CiAgcmVjYWxjdWxhdGVkLiAgSXQgaXMgc29tZXRpbWVzIHVzZWZ1bCB0
byBoYXZlIGRlcGVuZGVudCBhcnJheXMgd2l0aCBzaW1pbGFyCiAgc2VtYW50aWNzLiAgRGVwZW5k
ZW50IGtleXMgd2hpY2ggZW5kIGluIGAuW11gIGRvIG5vdCB1c2UgIm9uZSBhdCBhIHRpbWUiCiAg
c2VtYW50aWNzLiAgV2hlbiBhbiBpdGVtIGlzIGFkZGVkIG9yIHJlbW92ZWQgZnJvbSBzdWNoIGEg
ZGVwZW5kZW5jeSwgdGhlCiAgY29tcHV0ZWQgcHJvcGVydHkgaXMgY29tcGxldGVseSByZWNvbXB1
dGVkLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3JpcHQKICBFbWJlci5PYmplY3QuZXh0ZW5kKHsK
ICAgIC8vIFdoZW4gYHN0cmluZ2AgaXMgY2hhbmdlZCwgYGNvbXB1dGVkYCBpcyBjb21wbGV0ZWx5
IHJlY29tcHV0ZWQuCiAgICBzdHJpbmc6ICdhIHN0cmluZycsCgogICAgLy8gV2hlbiBhbiBpdGVt
IGlzIGFkZGVkIHRvIGBhcnJheWAsIGBhZGRlZEl0ZW1gIGlzIGNhbGxlZC4KICAgIGFycmF5OiBb
XSwKCiAgICAvLyBXaGVuIGFuIGl0ZW0gaXMgYWRkZWQgdG8gYGFub3RoZXJBcnJheWAsIGBjb21w
dXRlZGAgaXMgY29tcGxldGVseQogICAgLy8gcmVjb21wdXRlZC4KICAgIGFub3RoZXJBcnJheTog
W10sCgogICAgY29tcHV0ZWQ6IEVtYmVyLnJlZHVjZUNvbXB1dGVkKCdzdHJpbmcnLCAnYXJyYXkn
LCAnYW5vdGhlckFycmF5LltdJywgewogICAgICBhZGRlZEl0ZW06IGFkZGVkSXRlbUNhbGxiYWNr
LAogICAgICByZW1vdmVkSXRlbTogcmVtb3ZlZEl0ZW1DYWxsYmFjawogICAgfSkKICB9KTsKICBg
YGAKCiAgQG1ldGhvZCByZWR1Y2VDb21wdXRlZAogIEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0cmlu
Z30gW2RlcGVuZGVudEtleXMqXQogIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgQHJldHVybiB7
RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0KKi8KRW1iZXIucmVkdWNlQ29tcHV0ZWQgPSBmdW5jdGlv
biAob3B0aW9ucykgewogIHZhciBhcmdzOwoKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsK
ICAgIGFyZ3MgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAwLCAtMSk7CiAgICBvcHRpb25zID0g
YV9zbGljZS5jYWxsKGFyZ3VtZW50cywgLTEpWzBdOwogIH0KCiAgaWYgKHR5cGVvZiBvcHRpb25z
ICE9PSAib2JqZWN0IikgewogICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCJSZWR1Y2UgQ29tcHV0
ZWQgUHJvcGVydHkgZGVjbGFyZWQgd2l0aG91dCBhbiBvcHRpb25zIGhhc2giKTsKICB9CgogIGlm
ICghKCdpbml0aWFsVmFsdWUnIGluIG9wdGlvbnMpKSB7CiAgICB0aHJvdyBuZXcgRW1iZXIuRXJy
b3IoIlJlZHVjZSBDb21wdXRlZCBQcm9wZXJ0eSBkZWNsYXJlZCB3aXRob3V0IGFuIGluaXRpYWwg
dmFsdWUiKTsKICB9CgogIHZhciBjcCA9IG5ldyBSZWR1Y2VDb21wdXRlZFByb3BlcnR5KG9wdGlv
bnMpOwoKICBpZiAoYXJncykgewogICAgY3AucHJvcGVydHkuYXBwbHkoY3AsIGFyZ3MpOwogIH0K
CiAgcmV0dXJuIGNwOwp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgUmVkdWNlQ29tcHV0
ZWRQcm9wZXJ0eSA9IEVtYmVyLlJlZHVjZUNvbXB1dGVkUHJvcGVydHksCiAgICBhX3NsaWNlID0g
W10uc2xpY2UsCiAgICBvX2NyZWF0ZSA9IEVtYmVyLmNyZWF0ZSwKICAgIGZvckVhY2ggPSBFbWJl
ci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaDsKCmZ1bmN0aW9uIEFycmF5Q29tcHV0ZWRQcm9wZXJ0
eSgpIHsKICB2YXIgY3AgPSB0aGlzOwoKICBSZWR1Y2VDb21wdXRlZFByb3BlcnR5LmFwcGx5KHRo
aXMsIGFyZ3VtZW50cyk7CgogIHRoaXMuZnVuYyA9IChmdW5jdGlvbihyZWR1Y2VGdW5jKSB7CiAg
ICByZXR1cm4gZnVuY3Rpb24gKHByb3BlcnR5TmFtZSkgewogICAgICBpZiAoIWNwLl9oYXNJbnN0
YW5jZU1ldGEodGhpcywgcHJvcGVydHlOYW1lKSkgewogICAgICAgIC8vIFdoZW4gd2UgcmVjb21w
dXRlIGFuIGFycmF5IGNvbXB1dGVkIHByb3BlcnR5LCB3ZSBuZWVkIGFscmVhZHkKICAgICAgICAv
LyByZXRyaWV2ZWQgYXJyYXlzIHRvIGJlIHVwZGF0ZWQ7IHdlIGNhbid0IHNpbXBseSBlbXB0eSB0
aGUgY2FjaGUgYW5kCiAgICAgICAgLy8gaG9wZSB0aGUgYXJyYXkgaXMgcmUtcmV0cmlldmVkLgog
ICAgICAgIGZvckVhY2goY3AuX2RlcGVuZGVudEtleXMsIGZ1bmN0aW9uKGRlcGVuZGVudEtleSkg
ewogICAgICAgICAgRW1iZXIuYWRkT2JzZXJ2ZXIodGhpcywgZGVwZW5kZW50S2V5LCBmdW5jdGlv
bigpIHsKICAgICAgICAgICAgY3AucmVjb21wdXRlT25jZS5jYWxsKHRoaXMsIHByb3BlcnR5TmFt
ZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQoKICAgICAgcmV0dXJu
IHJlZHVjZUZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSkodGhpcy5mdW5j
KTsKCiAgcmV0dXJuIHRoaXM7Cn0KRW1iZXIuQXJyYXlDb21wdXRlZFByb3BlcnR5ID0gQXJyYXlD
b21wdXRlZFByb3BlcnR5OwpBcnJheUNvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlID0gb19jcmVh
dGUoUmVkdWNlQ29tcHV0ZWRQcm9wZXJ0eS5wcm90b3R5cGUpOwpBcnJheUNvbXB1dGVkUHJvcGVy
dHkucHJvdG90eXBlLmluaXRpYWxWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gRW1iZXIu
QSgpOwp9OwpBcnJheUNvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlLnJlc2V0VmFsdWUgPSBmdW5j
dGlvbiAoYXJyYXkpIHsKICBhcnJheS5jbGVhcigpOwogIHJldHVybiBhcnJheTsKfTsKCi8vIFRo
aXMgaXMgYSBzdG9wZ2FwIHRvIGtlZXAgdGhlIHJlZmVyZW5jZSBjb3VudHMgY29ycmVjdCB3aXRo
IGxhenkgQ1BzLgpBcnJheUNvbXB1dGVkUHJvcGVydHkucHJvdG90eXBlLmRpZENoYW5nZSA9IGZ1
bmN0aW9uIChvYmosIGtleU5hbWUpIHsKICByZXR1cm47Cn07CgovKioKICBDcmVhdGVzIGEgY29t
cHV0ZWQgcHJvcGVydHkgd2hpY2ggb3BlcmF0ZXMgb24gZGVwZW5kZW50IGFycmF5cyBhbmQKICBp
cyB1cGRhdGVkIHdpdGggIm9uZSBhdCBhIHRpbWUiIHNlbWFudGljcy4gV2hlbiBpdGVtcyBhcmUg
YWRkZWQgb3IKICByZW1vdmVkIGZyb20gdGhlIGRlcGVuZGVudCBhcnJheShzKSBhbiBhcnJheSBj
b21wdXRlZCBvbmx5IG9wZXJhdGVzCiAgb24gdGhlIGNoYW5nZSBpbnN0ZWFkIG9mIHJlLWV2YWx1
YXRpbmcgdGhlIGVudGlyZSBhcnJheS4gVGhpcyBzaG91bGQKICByZXR1cm4gYW4gYXJyYXksIGlm
IHlvdSdkIGxpa2UgdG8gdXNlICJvbmUgYXQgYSB0aW1lIiBzZW1hbnRpY3MgYW5kCiAgY29tcHV0
ZSBzb21lIHZhbHVlIG90aGVyIHRoZW4gYW4gYXJyYXkgbG9vayBhdAogIGBFbWJlci5yZWR1Y2VD
b21wdXRlZGAuCgogIElmIHRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIGFyZ3VtZW50cyB0aGUgZmly
c3QgYXJndW1lbnRzIGFyZQogIGNvbnNpZGVyZWQgdG8gYmUgZGVwZW5kZW50IHByb3BlcnR5IGtl
eXMuIFRoZSBsYXN0IGFyZ3VtZW50IGlzCiAgcmVxdWlyZWQgdG8gYmUgYW4gb3B0aW9ucyBvYmpl
Y3QuIFRoZSBvcHRpb25zIG9iamVjdCBjYW4gaGF2ZSB0aGUKICBmb2xsb3dpbmcgdGhyZWUgcHJv
cGVydGllcy4KCiAgYGluaXRpYWxpemVgIC0gQW4gb3B0aW9uYWwgaW5pdGlhbGl6ZSBmdW5jdGlv
bi4gVHlwaWNhbGx5IHRoaXMgd2lsbCBiZSB1c2VkCiAgdG8gc2V0IHVwIHN0YXRlIG9uIHRoZSBp
bnN0YW5jZU1ldGEgb2JqZWN0LgoKICBgcmVtb3ZlZEl0ZW1gIC0gQSBmdW5jdGlvbiB0aGF0IGlz
IGNhbGxlZCBlYWNoIHRpbWUgYW4gZWxlbWVudCBpcwogIHJlbW92ZWQgZnJvbSB0aGUgYXJyYXku
CgogIGBhZGRlZEl0ZW1gIC0gQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBlYWNoIHRpbWUgYW4g
ZWxlbWVudCBpcwogIGFkZGVkIHRvIHRoZSBhcnJheS4KCgogIFRoZSBgaW5pdGlhbGl6ZWAgZnVu
Y3Rpb24gaGFzIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlOgoKICBgYGBqYXZhc2NyaXB0CiAgIGZ1
bmN0aW9uIChhcnJheSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKQogIGBgYAoKICBgYXJyYXlg
IC0gVGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIGFycmF5Q29tcHV0ZWQsIGFuIGVtcHR5IGFycmF5
LgoKICBgY2hhbmdlTWV0YWAgLSBBbiBvYmplY3Qgd2hpY2ggY29udGFpbnMgbWV0YSBpbmZvcm1h
dGlvbiBhYm91dCB0aGUKICBjb21wdXRlZC4gSXQgY29udGFpbnMgdGhlIGZvbGxvd2luZyBwcm9w
ZXJ0aWVzOgoKICAgICAtIGBwcm9wZXJ0eWAgdGhlIGNvbXB1dGVkIHByb3BlcnR5CiAgICAgLSBg
cHJvcGVydHlOYW1lYCB0aGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgb24gdGhlIG9iamVjdAoKICBg
aW5zdGFuY2VNZXRhYCAtIEFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHN0b3JlIG1ldGEK
ICBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIGNhbGN1bGF0aW5nIHlvdXIgY29tcHV0ZWQuIEZvciBl
eGFtcGxlIGEKICB1bmlxdWUgY29tcHV0ZWQgbWlnaHQgdXNlIHRoaXMgdG8gc3RvcmUgdGhlIG51
bWJlciBvZiB0aW1lcyBhIGdpdmVuCiAgZWxlbWVudCBpcyBmb3VuZCBpbiB0aGUgZGVwZW5kZW50
IGFycmF5LgoKCiAgVGhlIGByZW1vdmVkSXRlbWAgYW5kIGBhZGRlZEl0ZW1gIGZ1bmN0aW9ucyBi
b3RoIGhhdmUgdGhlIGZvbGxvd2luZyBzaWduYXR1cmU6CgogIGBgYGphdmFzY3JpcHQKICBmdW5j
dGlvbiAoYWNjdW11bGF0ZWRWYWx1ZSwgaXRlbSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKQog
IGBgYAoKICBgYWNjdW11bGF0ZWRWYWx1ZWAgLSBUaGUgdmFsdWUgcmV0dXJuZWQgZnJvbSB0aGUg
bGFzdCB0aW1lCiAgYHJlbW92ZWRJdGVtYCBvciBgYWRkZWRJdGVtYCB3YXMgY2FsbGVkIG9yIGFu
IGVtcHR5IGFycmF5LgoKICBgaXRlbWAgLSB0aGUgZWxlbWVudCBhZGRlZCBvciByZW1vdmVkIGZy
b20gdGhlIGFycmF5CgogIGBjaGFuZ2VNZXRhYCAtIEFuIG9iamVjdCB3aGljaCBjb250YWlucyBt
ZXRhIGluZm9ybWF0aW9uIGFib3V0IHRoZQogIGNoYW5nZS4gSXQgY29udGFpbnMgdGhlIGZvbGxv
d2luZyBwcm9wZXJ0aWVzOgoKICAgIC0gYHByb3BlcnR5YCB0aGUgY29tcHV0ZWQgcHJvcGVydHkK
ICAgIC0gYHByb3BlcnR5TmFtZWAgdGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IG9uIHRoZSBvYmpl
Y3QKICAgIC0gYGluZGV4YCB0aGUgaW5kZXggb2YgdGhlIGFkZGVkIG9yIHJlbW92ZWQgaXRlbQog
ICAgLSBgaXRlbWAgdGhlIGFkZGVkIG9yIHJlbW92ZWQgaXRlbTogdGhpcyBpcyBleGFjdGx5IHRo
ZSBzYW1lIGFzCiAgICAgIHRoZSBzZWNvbmQgYXJnCiAgICAtIGBhcnJheUNoYW5nZWRgIHRoZSBh
cnJheSB0aGF0IHRyaWdnZXJlZCB0aGUgY2hhbmdlLiBDYW4gYmUKICAgICAgdXNlZnVsIHdoZW4g
ZGVwZW5kaW5nIG9uIG11bHRpcGxlIGFycmF5cy4KCiAgRm9yIHByb3BlcnR5IGNoYW5nZXMgdHJp
Z2dlcmVkIG9uIGFuIGl0ZW0gcHJvcGVydHkgY2hhbmdlICh3aGVuCiAgZGVwS2V5IGlzIHNvbWV0
aGluZyBsaWtlIGBzb21lQXJyYXkuQGVhY2guc29tZVByb3BlcnR5YCksCiAgYGNoYW5nZU1ldGFg
IHdpbGwgYWxzbyBjb250YWluIHRoZSBmb2xsb3dpbmcgcHJvcGVydHk6CgogICAgLSBgcHJldmlv
dXNWYWx1ZXNgIGFuIG9iamVjdCB3aG9zZSBrZXlzIGFyZSB0aGUgcHJvcGVydGllcyB0aGF0IGNo
YW5nZWQgb24KICAgIHRoZSBpdGVtLCBhbmQgd2hvc2UgdmFsdWVzIGFyZSB0aGUgaXRlbSdzIHBy
ZXZpb3VzIHZhbHVlcy4KCiAgYHByZXZpb3VzVmFsdWVzYCBpcyBpbXBvcnRhbnQgRW1iZXIgY29h
bGVzY2VzIGl0ZW0gcHJvcGVydHkgY2hhbmdlcyB2aWEKICBFbWJlci5ydW4ub25jZS4gVGhpcyBt
ZWFucyB0aGF0IGJ5IHRoZSB0aW1lIHJlbW92ZWRJdGVtIGdldHMgY2FsbGVkLCBpdGVtIGhhcwog
IHRoZSBuZXcgdmFsdWVzLCBidXQgeW91IG1heSBuZWVkIHRoZSBwcmV2aW91cyB2YWx1ZSAoZWcg
Zm9yIHNvcnRpbmcgJgogIGZpbHRlcmluZykuCgogIGBpbnN0YW5jZU1ldGFgIC0gQW4gb2JqZWN0
IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgbWV0YQogIGluZm9ybWF0aW9uIG5lZWRlZCBmb3Ig
Y2FsY3VsYXRpbmcgeW91ciBjb21wdXRlZC4gRm9yIGV4YW1wbGUgYQogIHVuaXF1ZSBjb21wdXRl
ZCBtaWdodCB1c2UgdGhpcyB0byBzdG9yZSB0aGUgbnVtYmVyIG9mIHRpbWVzIGEgZ2l2ZW4KICBl
bGVtZW50IGlzIGZvdW5kIGluIHRoZSBkZXBlbmRlbnQgYXJyYXkuCgogIFRoZSBgcmVtb3ZlZEl0
ZW1gIGFuZCBgYWRkZWRJdGVtYCBmdW5jdGlvbnMgc2hvdWxkIHJldHVybiB0aGUgYWNjdW11bGF0
ZWQKICB2YWx1ZS4gSXQgaXMgYWNjZXB0YWJsZSB0byBub3QgcmV0dXJuIGFueXRoaW5nIChpZSBy
ZXR1cm4gdW5kZWZpbmVkKQogIHRvIGludmFsaWRhdGUgdGhlIGNvbXB1dGF0aW9uLiBUaGlzIGlz
IGdlbmVyYWxseSBub3QgYSBnb29kIGlkZWEgZm9yCiAgYXJyYXlDb21wdXRlZCBidXQgaXQncyB1
c2VkIGluIGVnIG1heCBhbmQgbWluLgoKICBFeGFtcGxlCgogIGBgYGphdmFzY3JpcHQKICBFbWJl
ci5jb21wdXRlZC5tYXAgPSBmdW5jdGlvbihkZXBlbmRlbnRLZXksIGNhbGxiYWNrKSB7CiAgICB2
YXIgb3B0aW9ucyA9IHsKICAgICAgYWRkZWRJdGVtOiBmdW5jdGlvbihhcnJheSwgaXRlbSwgY2hh
bmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgICAgdmFyIG1hcHBlZCA9IGNhbGxiYWNrKGl0
ZW0pOwogICAgICAgIGFycmF5Lmluc2VydEF0KGNoYW5nZU1ldGEuaW5kZXgsIG1hcHBlZCk7CiAg
ICAgICAgcmV0dXJuIGFycmF5OwogICAgICB9LAogICAgICByZW1vdmVkSXRlbTogZnVuY3Rpb24o
YXJyYXksIGl0ZW0sIGNoYW5nZU1ldGEsIGluc3RhbmNlTWV0YSkgewogICAgICAgIGFycmF5LnJl
bW92ZUF0KGNoYW5nZU1ldGEuaW5kZXgsIDEpOwogICAgICAgIHJldHVybiBhcnJheTsKICAgICAg
fQogICAgfTsKCiAgICByZXR1cm4gRW1iZXIuYXJyYXlDb21wdXRlZChkZXBlbmRlbnRLZXksIG9w
dGlvbnMpOwogIH07CiAgYGBgCgogIEBtZXRob2QgYXJyYXlDb21wdXRlZAogIEBmb3IgRW1iZXIK
ICBAcGFyYW0ge1N0cmluZ30gW2RlcGVuZGVudEtleXMqXQogIEBwYXJhbSB7T2JqZWN0fSBvcHRp
b25zCiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0KKi8KRW1iZXIuYXJyYXlDb21w
dXRlZCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgdmFyIGFyZ3M7CgogIGlmIChhcmd1bWVudHMu
bGVuZ3RoID4gMSkgewogICAgYXJncyA9IGFfc2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIC0xKTsK
ICAgIG9wdGlvbnMgPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAtMSlbMF07CiAgfQoKICBpZiAo
dHlwZW9mIG9wdGlvbnMgIT09ICJvYmplY3QiKSB7CiAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3Io
IkFycmF5IENvbXB1dGVkIFByb3BlcnR5IGRlY2xhcmVkIHdpdGhvdXQgYW4gb3B0aW9ucyBoYXNo
Iik7CiAgfQoKICB2YXIgY3AgPSBuZXcgQXJyYXlDb21wdXRlZFByb3BlcnR5KG9wdGlvbnMpOwoK
ICBpZiAoYXJncykgewogICAgY3AucHJvcGVydHkuYXBwbHkoY3AsIGFyZ3MpOwogIH0KCiAgcmV0
dXJuIGNwOwp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3Vi
bW9kdWxlIGVtYmVyLXJ1bnRpbWUKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsCiAgICBzZXQgPSBF
bWJlci5zZXQsCiAgICBndWlkRm9yID0gRW1iZXIuZ3VpZEZvciwKICAgIG1lcmdlID0gRW1iZXIu
bWVyZ2UsCiAgICBhX3NsaWNlID0gW10uc2xpY2UsCiAgICBmb3JFYWNoID0gRW1iZXIuRW51bWVy
YWJsZVV0aWxzLmZvckVhY2gsCiAgICBtYXAgPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMubWFwLAog
ICAgU2VhcmNoUHJveHk7CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRoYXQgY2FsY3VsYXRl
cyB0aGUgbWF4aW11bSB2YWx1ZSBpbiB0aGUKICBkZXBlbmRlbnQgYXJyYXkuIFRoaXMgd2lsbCBy
ZXR1cm4gYC1JbmZpbml0eWAgd2hlbiB0aGUgZGVwZW5kZW50CiAgYXJyYXkgaXMgZW1wdHkuCgog
IGBgYGphdmFzY3JpcHQKICBBcHAuUGVyc29uID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICBj
aGlsZEFnZXM6IEVtYmVyLmNvbXB1dGVkLm1hcEJ5KCdjaGlsZHJlbicsICdhZ2UnKSwKICAgIG1h
eENoaWxkQWdlOiBFbWJlci5jb21wdXRlZC5tYXgoJ2NoaWxkQWdlcycpCiAgfSk7CgogIHZhciBs
b3JkQnlyb24gPSBBcHAuUGVyc29uLmNyZWF0ZSh7Y2hpbGRyZW46IFtdfSk7CiAgbG9yZEJ5cm9u
LmdldCgnbWF4Q2hpbGRBZ2UnKTsgLy8gLUluZmluaXR5CiAgbG9yZEJ5cm9uLmdldCgnY2hpbGRy
ZW4nKS5wdXNoT2JqZWN0KHsKICAgIG5hbWU6ICdBdWd1c3RhIEFkYSBCeXJvbicsIGFnZTogNwog
IH0pOwogIGxvcmRCeXJvbi5nZXQoJ21heENoaWxkQWdlJyk7IC8vIDcKICBsb3JkQnlyb24uZ2V0
KCdjaGlsZHJlbicpLnB1c2hPYmplY3RzKFt7CiAgICBuYW1lOiAnQWxsZWdyYSBCeXJvbicsCiAg
ICBhZ2U6IDUKICB9LCB7CiAgICBuYW1lOiAnRWxpemFiZXRoIE1lZG9yYSBMZWlnaCcsCiAgICBh
Z2U6IDgKICB9XSk7CiAgbG9yZEJ5cm9uLmdldCgnbWF4Q2hpbGRBZ2UnKTsgLy8gOAogIGBgYAoK
ICBAbWV0aG9kIGNvbXB1dGVkLm1heAogIEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0cmluZ30gZGVw
ZW5kZW50S2V5CiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gY29tcHV0ZXMgdGhl
IGxhcmdlc3QgdmFsdWUgaW4gdGhlIGRlcGVuZGVudEtleSdzIGFycmF5CiovCkVtYmVyLmNvbXB1
dGVkLm1heCA9IGZ1bmN0aW9uIChkZXBlbmRlbnRLZXkpIHsKICByZXR1cm4gRW1iZXIucmVkdWNl
Q29tcHV0ZWQuY2FsbChudWxsLCBkZXBlbmRlbnRLZXksIHsKICAgIGluaXRpYWxWYWx1ZTogLUlu
ZmluaXR5LAoKICAgIGFkZGVkSXRlbTogZnVuY3Rpb24gKGFjY3VtdWxhdGVkVmFsdWUsIGl0ZW0s
IGNoYW5nZU1ldGEsIGluc3RhbmNlTWV0YSkgewogICAgICByZXR1cm4gTWF0aC5tYXgoYWNjdW11
bGF0ZWRWYWx1ZSwgaXRlbSk7CiAgICB9LAoKICAgIHJlbW92ZWRJdGVtOiBmdW5jdGlvbiAoYWNj
dW11bGF0ZWRWYWx1ZSwgaXRlbSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIGlm
IChpdGVtIDwgYWNjdW11bGF0ZWRWYWx1ZSkgewogICAgICAgIHJldHVybiBhY2N1bXVsYXRlZFZh
bHVlOwogICAgICB9CiAgICB9CiAgfSk7Cn07CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5IHRo
YXQgY2FsY3VsYXRlcyB0aGUgbWluaW11bSB2YWx1ZSBpbiB0aGUKICBkZXBlbmRlbnQgYXJyYXku
IFRoaXMgd2lsbCByZXR1cm4gYEluZmluaXR5YCB3aGVuIHRoZSBkZXBlbmRlbnQKICBhcnJheSBp
cyBlbXB0eS4KCiAgYGBgamF2YXNjcmlwdAogIEFwcC5QZXJzb24gPSBFbWJlci5PYmplY3QuZXh0
ZW5kKHsKICAgIGNoaWxkQWdlczogRW1iZXIuY29tcHV0ZWQubWFwQnkoJ2NoaWxkcmVuJywgJ2Fn
ZScpLAogICAgbWluQ2hpbGRBZ2U6IEVtYmVyLmNvbXB1dGVkLm1pbignY2hpbGRBZ2VzJykKICB9
KTsKCiAgdmFyIGxvcmRCeXJvbiA9IEFwcC5QZXJzb24uY3JlYXRlKHtjaGlsZHJlbjogW119KTsK
ICBsb3JkQnlyb24uZ2V0KCdtaW5DaGlsZEFnZScpOyAvLyBJbmZpbml0eQogIGxvcmRCeXJvbi5n
ZXQoJ2NoaWxkcmVuJykucHVzaE9iamVjdCh7CiAgICBuYW1lOiAnQXVndXN0YSBBZGEgQnlyb24n
LCBhZ2U6IDcKICB9KTsKICBsb3JkQnlyb24uZ2V0KCdtaW5DaGlsZEFnZScpOyAvLyA3CiAgbG9y
ZEJ5cm9uLmdldCgnY2hpbGRyZW4nKS5wdXNoT2JqZWN0cyhbewogICAgbmFtZTogJ0FsbGVncmEg
Qnlyb24nLAogICAgYWdlOiA1CiAgfSwgewogICAgbmFtZTogJ0VsaXphYmV0aCBNZWRvcmEgTGVp
Z2gnLAogICAgYWdlOiA4CiAgfV0pOwogIGxvcmRCeXJvbi5nZXQoJ21pbkNoaWxkQWdlJyk7IC8v
IDUKICBgYGAKCiAgQG1ldGhvZCBjb21wdXRlZC5taW4KICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtT
dHJpbmd9IGRlcGVuZGVudEtleQogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNv
bXB1dGVzIHRoZSBzbWFsbGVzdCB2YWx1ZSBpbiB0aGUgZGVwZW5kZW50S2V5J3MgYXJyYXkKKi8K
RW1iZXIuY29tcHV0ZWQubWluID0gZnVuY3Rpb24gKGRlcGVuZGVudEtleSkgewogIHJldHVybiBF
bWJlci5yZWR1Y2VDb21wdXRlZC5jYWxsKG51bGwsIGRlcGVuZGVudEtleSwgewogICAgaW5pdGlh
bFZhbHVlOiBJbmZpbml0eSwKCiAgICBhZGRlZEl0ZW06IGZ1bmN0aW9uIChhY2N1bXVsYXRlZFZh
bHVlLCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAgcmV0dXJuIE1hdGgu
bWluKGFjY3VtdWxhdGVkVmFsdWUsIGl0ZW0pOwogICAgfSwKCiAgICByZW1vdmVkSXRlbTogZnVu
Y3Rpb24gKGFjY3VtdWxhdGVkVmFsdWUsIGl0ZW0sIGNoYW5nZU1ldGEsIGluc3RhbmNlTWV0YSkg
ewogICAgICBpZiAoaXRlbSA+IGFjY3VtdWxhdGVkVmFsdWUpIHsKICAgICAgICByZXR1cm4gYWNj
dW11bGF0ZWRWYWx1ZTsKICAgICAgfQogICAgfQogIH0pOwp9OwoKLyoqCiAgUmV0dXJucyBhbiBh
cnJheSBtYXBwZWQgdmlhIHRoZSBjYWxsYmFjawoKICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBw
cm92aWRlIHNob3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlLgogIGBpdGVtYCBpcyB0
aGUgY3VycmVudCBpdGVtIGluIHRoZSBpdGVyYXRpb24uCgogIGBgYGphdmFzY3JpcHQKICBmdW5j
dGlvbihpdGVtKTsKICBgYGAKCiAgRXhhbXBsZQoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLkhhbXN0
ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGV4Y2l0aW5nQ2hvcmVzOiBFbWJlci5jb21w
dXRlZC5tYXAoJ2Nob3JlcycsIGZ1bmN0aW9uKGNob3JlKSB7CiAgICAgIHJldHVybiBjaG9yZS50
b1VwcGVyQ2FzZSgpICsgJyEnOwogICAgfSkKICB9KTsKCiAgdmFyIGhhbXN0ZXIgPSBBcHAuSGFt
c3Rlci5jcmVhdGUoewogICAgY2hvcmVzOiBbJ2NsZWFuJywgJ3dyaXRlIG1vcmUgdW5pdCB0ZXN0
cyddCiAgfSk7CiAgaGFtc3Rlci5nZXQoJ2V4Y2l0aW5nQ2hvcmVzJyk7IC8vIFsnQ0xFQU4hJywg
J1dSSVRFIE1PUkUgVU5JVCBURVNUUyEnXQogIGBgYAoKICBAbWV0aG9kIGNvbXB1dGVkLm1hcAog
IEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5CiAgQHBhcmFtIHtGdW5j
dGlvbn0gY2FsbGJhY2sKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBhbiBhcnJh
eSBtYXBwZWQgdmlhIHRoZSBjYWxsYmFjawoqLwpFbWJlci5jb21wdXRlZC5tYXAgPSBmdW5jdGlv
bihkZXBlbmRlbnRLZXksIGNhbGxiYWNrKSB7CiAgdmFyIG9wdGlvbnMgPSB7CiAgICBhZGRlZEl0
ZW06IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAg
ICAgdmFyIG1hcHBlZCA9IGNhbGxiYWNrLmNhbGwodGhpcywgaXRlbSk7CiAgICAgIGFycmF5Lmlu
c2VydEF0KGNoYW5nZU1ldGEuaW5kZXgsIG1hcHBlZCk7CiAgICAgIHJldHVybiBhcnJheTsKICAg
IH0sCiAgICByZW1vdmVkSXRlbTogZnVuY3Rpb24oYXJyYXksIGl0ZW0sIGNoYW5nZU1ldGEsIGlu
c3RhbmNlTWV0YSkgewogICAgICBhcnJheS5yZW1vdmVBdChjaGFuZ2VNZXRhLmluZGV4LCAxKTsK
ICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogIH07CgogIHJldHVybiBFbWJlci5hcnJheUNvbXB1
dGVkKGRlcGVuZGVudEtleSwgb3B0aW9ucyk7Cn07CgovKioKICBSZXR1cm5zIGFuIGFycmF5IG1h
cHBlZCB0byB0aGUgc3BlY2lmaWVkIGtleS4KCiAgYGBgamF2YXNjcmlwdAogIEFwcC5QZXJzb24g
PSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAgIGNoaWxkQWdlczogRW1iZXIuY29tcHV0ZWQubWFw
QnkoJ2NoaWxkcmVuJywgJ2FnZScpCiAgfSk7CgogIHZhciBsb3JkQnlyb24gPSBBcHAuUGVyc29u
LmNyZWF0ZSh7Y2hpbGRyZW46IFtdfSk7CiAgbG9yZEJ5cm9uLmdldCgnY2hpbGRBZ2VzJyk7IC8v
IFtdCiAgbG9yZEJ5cm9uLmdldCgnY2hpbGRyZW4nKS5wdXNoT2JqZWN0KHtuYW1lOiAnQXVndXN0
YSBBZGEgQnlyb24nLCBhZ2U6IDd9KTsKICBsb3JkQnlyb24uZ2V0KCdjaGlsZEFnZXMnKTsgLy8g
WzddCiAgbG9yZEJ5cm9uLmdldCgnY2hpbGRyZW4nKS5wdXNoT2JqZWN0cyhbewogICAgbmFtZTog
J0FsbGVncmEgQnlyb24nLAogICAgYWdlOiA1CiAgfSwgewogICAgbmFtZTogJ0VsaXphYmV0aCBN
ZWRvcmEgTGVpZ2gnLAogICAgYWdlOiA4CiAgfV0pOwogIGxvcmRCeXJvbi5nZXQoJ2NoaWxkQWdl
cycpOyAvLyBbNywgNSwgOF0KICBgYGAKCiAgQG1ldGhvZCBjb21wdXRlZC5tYXBCeQogIEBmb3Ig
RW1iZXIKICBAcGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5CiAgQHBhcmFtIHtTdHJpbmd9IHBy
b3BlcnR5S2V5CiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gYW4gYXJyYXkgbWFw
cGVkIHRvIHRoZSBzcGVjaWZpZWQga2V5CiovCkVtYmVyLmNvbXB1dGVkLm1hcEJ5ID0gZnVuY3Rp
b24oZGVwZW5kZW50S2V5LCBwcm9wZXJ0eUtleSkgewogIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9u
KGl0ZW0pIHsgcmV0dXJuIGdldChpdGVtLCBwcm9wZXJ0eUtleSk7IH07CiAgcmV0dXJuIEVtYmVy
LmNvbXB1dGVkLm1hcChkZXBlbmRlbnRLZXkgKyAnLkBlYWNoLicgKyBwcm9wZXJ0eUtleSwgY2Fs
bGJhY2spOwp9OwoKLyoqCiAgQG1ldGhvZCBjb21wdXRlZC5tYXBQcm9wZXJ0eQogIEBmb3IgRW1i
ZXIKICBAZGVwcmVjYXRlZCBVc2UgYEVtYmVyLmNvbXB1dGVkLm1hcEJ5YCBpbnN0ZWFkCiAgQHBh
cmFtIGRlcGVuZGVudEtleQogIEBwYXJhbSBwcm9wZXJ0eUtleQoqLwpFbWJlci5jb21wdXRlZC5t
YXBQcm9wZXJ0eSA9IEVtYmVyLmNvbXB1dGVkLm1hcEJ5OwoKLyoqCiAgRmlsdGVycyB0aGUgYXJy
YXkgYnkgdGhlIGNhbGxiYWNrLgoKICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNo
b3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlLgogIGBpdGVtYCBpcyB0aGUgY3VycmVu
dCBpdGVtIGluIHRoZSBpdGVyYXRpb24uCgogIGBgYGphdmFzY3JpcHQKICBmdW5jdGlvbihpdGVt
KTsKICBgYGAKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5IYW1zdGVyID0gRW1iZXIuT2JqZWN0LmV4
dGVuZCh7CiAgICByZW1haW5pbmdDaG9yZXM6IEVtYmVyLmNvbXB1dGVkLmZpbHRlcignY2hvcmVz
JywgZnVuY3Rpb24oY2hvcmUpIHsKICAgICAgcmV0dXJuICFjaG9yZS5kb25lOwogICAgfSkKICB9
KTsKCiAgdmFyIGhhbXN0ZXIgPSBBcHAuSGFtc3Rlci5jcmVhdGUoe2Nob3JlczogWwogICAge25h
bWU6ICdjb29rJywgZG9uZTogdHJ1ZX0sCiAgICB7bmFtZTogJ2NsZWFuJywgZG9uZTogdHJ1ZX0s
CiAgICB7bmFtZTogJ3dyaXRlIG1vcmUgdW5pdCB0ZXN0cycsIGRvbmU6IGZhbHNlfQogIF19KTsK
ICBoYW1zdGVyLmdldCgncmVtYWluaW5nQ2hvcmVzJyk7IC8vIFt7bmFtZTogJ3dyaXRlIG1vcmUg
dW5pdCB0ZXN0cycsIGRvbmU6IGZhbHNlfV0KICBgYGAKCiAgQG1ldGhvZCBjb21wdXRlZC5maWx0
ZXIKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IGRlcGVuZGVudEtleQogIEBwYXJhbSB7
RnVuY3Rpb259IGNhbGxiYWNrCiAgQHJldHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gdGhl
IGZpbHRlcmVkIGFycmF5CiovCkVtYmVyLmNvbXB1dGVkLmZpbHRlciA9IGZ1bmN0aW9uKGRlcGVu
ZGVudEtleSwgY2FsbGJhY2spIHsKICB2YXIgb3B0aW9ucyA9IHsKICAgIGluaXRpYWxpemU6IGZ1
bmN0aW9uIChhcnJheSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIGluc3RhbmNl
TWV0YS5maWx0ZXJlZEFycmF5SW5kZXhlcyA9IG5ldyBFbWJlci5TdWJBcnJheSgpOwogICAgfSwK
CiAgICBhZGRlZEl0ZW06IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5j
ZU1ldGEpIHsKICAgICAgdmFyIG1hdGNoID0gISFjYWxsYmFjay5jYWxsKHRoaXMsIGl0ZW0pLAog
ICAgICAgICAgZmlsdGVySW5kZXggPSBpbnN0YW5jZU1ldGEuZmlsdGVyZWRBcnJheUluZGV4ZXMu
YWRkSXRlbShjaGFuZ2VNZXRhLmluZGV4LCBtYXRjaCk7CgogICAgICBpZiAobWF0Y2gpIHsKICAg
ICAgICBhcnJheS5pbnNlcnRBdChmaWx0ZXJJbmRleCwgaXRlbSk7CiAgICAgIH0KCiAgICAgIHJl
dHVybiBhcnJheTsKICAgIH0sCgogICAgcmVtb3ZlZEl0ZW06IGZ1bmN0aW9uKGFycmF5LCBpdGVt
LCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAgdmFyIGZpbHRlckluZGV4ID0gaW5z
dGFuY2VNZXRhLmZpbHRlcmVkQXJyYXlJbmRleGVzLnJlbW92ZUl0ZW0oY2hhbmdlTWV0YS5pbmRl
eCk7CgogICAgICBpZiAoZmlsdGVySW5kZXggPiAtMSkgewogICAgICAgIGFycmF5LnJlbW92ZUF0
KGZpbHRlckluZGV4KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogIH07Cgog
IHJldHVybiBFbWJlci5hcnJheUNvbXB1dGVkKGRlcGVuZGVudEtleSwgb3B0aW9ucyk7Cn07Cgov
KioKICBGaWx0ZXJzIHRoZSBhcnJheSBieSB0aGUgcHJvcGVydHkgYW5kIHZhbHVlCgogIGBgYGph
dmFzY3JpcHQKICBBcHAuSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgcmVtYWlu
aW5nQ2hvcmVzOiBFbWJlci5jb21wdXRlZC5maWx0ZXJCeSgnY2hvcmVzJywgJ2RvbmUnLCBmYWxz
ZSkKICB9KTsKCiAgdmFyIGhhbXN0ZXIgPSBBcHAuSGFtc3Rlci5jcmVhdGUoe2Nob3JlczogWwog
ICAge25hbWU6ICdjb29rJywgZG9uZTogdHJ1ZX0sCiAgICB7bmFtZTogJ2NsZWFuJywgZG9uZTog
dHJ1ZX0sCiAgICB7bmFtZTogJ3dyaXRlIG1vcmUgdW5pdCB0ZXN0cycsIGRvbmU6IGZhbHNlfQog
IF19KTsKICBoYW1zdGVyLmdldCgncmVtYWluaW5nQ2hvcmVzJyk7IC8vIFt7bmFtZTogJ3dyaXRl
IG1vcmUgdW5pdCB0ZXN0cycsIGRvbmU6IGZhbHNlfV0KICBgYGAKCiAgQG1ldGhvZCBjb21wdXRl
ZC5maWx0ZXJCeQogIEBmb3IgRW1iZXIKICBAcGFyYW0ge1N0cmluZ30gZGVwZW5kZW50S2V5CiAg
QHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5S2V5CiAgQHBhcmFtIHtTdHJpbmd9IHZhbHVlCiAgQHJl
dHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gdGhlIGZpbHRlcmVkIGFycmF5CiovCkVtYmVy
LmNvbXB1dGVkLmZpbHRlckJ5ID0gZnVuY3Rpb24oZGVwZW5kZW50S2V5LCBwcm9wZXJ0eUtleSwg
dmFsdWUpIHsKICB2YXIgY2FsbGJhY2s7CgogIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7
CiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgcmV0dXJuIGdldChpdGVtLCBw
cm9wZXJ0eUtleSk7CiAgICB9OwogIH0gZWxzZSB7CiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKGl0
ZW0pIHsKICAgICAgcmV0dXJuIGdldChpdGVtLCBwcm9wZXJ0eUtleSkgPT09IHZhbHVlOwogICAg
fTsKICB9CgogIHJldHVybiBFbWJlci5jb21wdXRlZC5maWx0ZXIoZGVwZW5kZW50S2V5ICsgJy5A
ZWFjaC4nICsgcHJvcGVydHlLZXksIGNhbGxiYWNrKTsKfTsKCi8qKgogIEBtZXRob2QgY29tcHV0
ZWQuZmlsdGVyUHJvcGVydHkKICBAZm9yIEVtYmVyCiAgQHBhcmFtIGRlcGVuZGVudEtleQogIEBw
YXJhbSBwcm9wZXJ0eUtleQogIEBwYXJhbSB2YWx1ZQogIEBkZXByZWNhdGVkIFVzZSBgRW1iZXIu
Y29tcHV0ZWQuZmlsdGVyQnlgIGluc3RlYWQKKi8KRW1iZXIuY29tcHV0ZWQuZmlsdGVyUHJvcGVy
dHkgPSBFbWJlci5jb21wdXRlZC5maWx0ZXJCeTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkg
d2hpY2ggcmV0dXJucyBhIG5ldyBhcnJheSB3aXRoIGFsbCB0aGUgdW5pcXVlCiAgZWxlbWVudHMg
ZnJvbSBvbmUgb3IgbW9yZSBkZXBlbmRlbnQgYXJyYXlzLgoKICBFeGFtcGxlCgogIGBgYGphdmFz
Y3JpcHQKICBBcHAuSGFtc3RlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgdW5pcXVlRnJ1
aXRzOiBFbWJlci5jb21wdXRlZC51bmlxKCdmcnVpdHMnKQogIH0pOwoKICB2YXIgaGFtc3RlciA9
IEFwcC5IYW1zdGVyLmNyZWF0ZSh7ZnJ1aXRzOiBbCiAgICAnYmFuYW5hJywKICAgICdncmFwZScs
CiAgICAna2FsZScsCiAgICAnYmFuYW5hJwogIF19KTsKICBoYW1zdGVyLmdldCgndW5pcXVlRnJ1
aXRzJyk7IC8vIFsnYmFuYW5hJywgJ2dyYXBlJywgJ2thbGUnXQogIGBgYAoKICBAbWV0aG9kIGNv
bXB1dGVkLnVuaXEKICBAZm9yIEVtYmVyCiAgQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5S2V5Kgog
IEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNvbXB1dGVzIGEgbmV3IGFycmF5IHdp
dGggYWxsIHRoZQogIHVuaXF1ZSBlbGVtZW50cyBmcm9tIHRoZSBkZXBlbmRlbnQgYXJyYXkKKi8K
RW1iZXIuY29tcHV0ZWQudW5pcSA9IGZ1bmN0aW9uKCkgewogIHZhciBhcmdzID0gYV9zbGljZS5j
YWxsKGFyZ3VtZW50cyk7CiAgYXJncy5wdXNoKHsKICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGFy
cmF5LCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAgaW5zdGFuY2VNZXRhLml0ZW1D
b3VudHMgPSB7fTsKICAgIH0sCgogICAgYWRkZWRJdGVtOiBmdW5jdGlvbihhcnJheSwgaXRlbSwg
Y2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIHZhciBndWlkID0gZ3VpZEZvcihpdGVt
KTsKCiAgICAgIGlmICghaW5zdGFuY2VNZXRhLml0ZW1Db3VudHNbZ3VpZF0pIHsKICAgICAgICBp
bnN0YW5jZU1ldGEuaXRlbUNvdW50c1tndWlkXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg
KytpbnN0YW5jZU1ldGEuaXRlbUNvdW50c1tndWlkXTsKICAgICAgfQogICAgICBhcnJheS5hZGRP
YmplY3QoaXRlbSk7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0sCiAgICByZW1vdmVkSXRlbTog
ZnVuY3Rpb24oYXJyYXksIGl0ZW0sIF8sIGluc3RhbmNlTWV0YSkgewogICAgICB2YXIgZ3VpZCA9
IGd1aWRGb3IoaXRlbSksCiAgICAgICAgICBpdGVtQ291bnRzID0gaW5zdGFuY2VNZXRhLml0ZW1D
b3VudHM7CgogICAgICBpZiAoLS1pdGVtQ291bnRzW2d1aWRdID09PSAwKSB7CiAgICAgICAgYXJy
YXkucmVtb3ZlT2JqZWN0KGl0ZW0pOwogICAgICB9CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0K
ICB9KTsKICByZXR1cm4gRW1iZXIuYXJyYXlDb21wdXRlZC5hcHBseShudWxsLCBhcmdzKTsKfTsK
Ci8qKgogIEFsaWFzIGZvciBbRW1iZXIuY29tcHV0ZWQudW5pcV0oL2FwaS8jbWV0aG9kX2NvbXB1
dGVkX3VuaXEpLgoKICBAbWV0aG9kIGNvbXB1dGVkLnVuaW9uCiAgQGZvciBFbWJlcgogIEBwYXJh
bSB7U3RyaW5nfSBwcm9wZXJ0eUtleSoKICBAcmV0dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5
fSBjb21wdXRlcyBhIG5ldyBhcnJheSB3aXRoIGFsbCB0aGUKICB1bmlxdWUgZWxlbWVudHMgZnJv
bSB0aGUgZGVwZW5kZW50IGFycmF5CiovCkVtYmVyLmNvbXB1dGVkLnVuaW9uID0gRW1iZXIuY29t
cHV0ZWQudW5pcTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgd2hpY2ggcmV0dXJucyBhIG5l
dyBhcnJheSB3aXRoIGFsbCB0aGUgZHVwbGljYXRlZAogIGVsZW1lbnRzIGZyb20gdHdvIG9yIG1v
cmUgZGVwZW5kZW55IGFycmF5cy4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2NyaXB0CiAgdmFyIG9i
aiA9IEVtYmVyLk9iamVjdC5jcmVhdGVXaXRoTWl4aW5zKHsKICAgIGFkYUZyaWVuZHM6IFsnQ2hh
cmxlcyBCYWJiYWdlJywgJ0pvaG4gSG9iaG91c2UnLCAnV2lsbGlhbSBLaW5nJywgJ01hcnkgU29t
ZXJ2aWxsZSddLAogICAgY2hhcmxlc0ZyaWVuZHM6IFsnV2lsbGlhbSBLaW5nJywgJ01hcnkgU29t
ZXJ2aWxsZScsICdBZGEgTG92ZWxhY2UnLCAnR2VvcmdlIFBlYWNvY2snXSwKICAgIGZyaWVuZHNJ
bkNvbW1vbjogRW1iZXIuY29tcHV0ZWQuaW50ZXJzZWN0KCdhZGFGcmllbmRzJywgJ2NoYXJsZXNG
cmllbmRzJykKICB9KTsKCiAgb2JqLmdldCgnZnJpZW5kc0luQ29tbW9uJyk7IC8vIFsnV2lsbGlh
bSBLaW5nJywgJ01hcnkgU29tZXJ2aWxsZSddCiAgYGBgCgogIEBtZXRob2QgY29tcHV0ZWQuaW50
ZXJzZWN0CiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eUtleSoKICBAcmV0
dXJuIHtFbWJlci5Db21wdXRlZFByb3BlcnR5fSBjb21wdXRlcyBhIG5ldyBhcnJheSB3aXRoIGFs
bCB0aGUKICBkdXBsaWNhdGVkIGVsZW1lbnRzIGZyb20gdGhlIGRlcGVuZGVudCBhcnJheXMKKi8K
RW1iZXIuY29tcHV0ZWQuaW50ZXJzZWN0ID0gZnVuY3Rpb24gKCkgewogIHZhciBnZXREZXBlbmRl
bnRLZXlHdWlkcyA9IGZ1bmN0aW9uIChjaGFuZ2VNZXRhKSB7CiAgICByZXR1cm4gbWFwKGNoYW5n
ZU1ldGEucHJvcGVydHkuX2RlcGVuZGVudEtleXMsIGZ1bmN0aW9uIChkZXBlbmRlbnRLZXkpIHsK
ICAgICAgcmV0dXJuIGd1aWRGb3IoZGVwZW5kZW50S2V5KTsKICAgIH0pOwogIH07CgogIHZhciBh
cmdzID0gYV9zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgYXJncy5wdXNoKHsKICAgIGluaXRpYWxp
emU6IGZ1bmN0aW9uIChhcnJheSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIGlu
c3RhbmNlTWV0YS5pdGVtQ291bnRzID0ge307CiAgICB9LAoKICAgIGFkZGVkSXRlbTogZnVuY3Rp
b24oYXJyYXksIGl0ZW0sIGNoYW5nZU1ldGEsIGluc3RhbmNlTWV0YSkgewogICAgICB2YXIgaXRl
bUd1aWQgPSBndWlkRm9yKGl0ZW0pLAogICAgICAgICAgZGVwZW5kZW50R3VpZHMgPSBnZXREZXBl
bmRlbnRLZXlHdWlkcyhjaGFuZ2VNZXRhKSwKICAgICAgICAgIGRlcGVuZGVudEd1aWQgPSBndWlk
Rm9yKGNoYW5nZU1ldGEuYXJyYXlDaGFuZ2VkKSwKICAgICAgICAgIG51bWJlck9mRGVwZW5kZW50
QXJyYXlzID0gY2hhbmdlTWV0YS5wcm9wZXJ0eS5fZGVwZW5kZW50S2V5cy5sZW5ndGgsCiAgICAg
ICAgICBpdGVtQ291bnRzID0gaW5zdGFuY2VNZXRhLml0ZW1Db3VudHM7CgogICAgICBpZiAoIWl0
ZW1Db3VudHNbaXRlbUd1aWRdKSB7IGl0ZW1Db3VudHNbaXRlbUd1aWRdID0ge307IH0KICAgICAg
aWYgKGl0ZW1Db3VudHNbaXRlbUd1aWRdW2RlcGVuZGVudEd1aWRdID09PSB1bmRlZmluZWQpIHsg
aXRlbUNvdW50c1tpdGVtR3VpZF1bZGVwZW5kZW50R3VpZF0gPSAwOyB9CgogICAgICBpZiAoKytp
dGVtQ291bnRzW2l0ZW1HdWlkXVtkZXBlbmRlbnRHdWlkXSA9PT0gMSAmJgogICAgICAgICAgbnVt
YmVyT2ZEZXBlbmRlbnRBcnJheXMgPT09IEVtYmVyLmtleXMoaXRlbUNvdW50c1tpdGVtR3VpZF0p
Lmxlbmd0aCkgewoKICAgICAgICBhcnJheS5hZGRPYmplY3QoaXRlbSk7CiAgICAgIH0KICAgICAg
cmV0dXJuIGFycmF5OwogICAgfSwKICAgIHJlbW92ZWRJdGVtOiBmdW5jdGlvbihhcnJheSwgaXRl
bSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIHZhciBpdGVtR3VpZCA9IGd1aWRG
b3IoaXRlbSksCiAgICAgICAgICBkZXBlbmRlbnRHdWlkcyA9IGdldERlcGVuZGVudEtleUd1aWRz
KGNoYW5nZU1ldGEpLAogICAgICAgICAgZGVwZW5kZW50R3VpZCA9IGd1aWRGb3IoY2hhbmdlTWV0
YS5hcnJheUNoYW5nZWQpLAogICAgICAgICAgbnVtYmVyT2ZEZXBlbmRlbnRBcnJheXMgPSBjaGFu
Z2VNZXRhLnByb3BlcnR5Ll9kZXBlbmRlbnRLZXlzLmxlbmd0aCwKICAgICAgICAgIG51bWJlck9m
QXJyYXlzSXRlbUFwcGVhcnNJbiwKICAgICAgICAgIGl0ZW1Db3VudHMgPSBpbnN0YW5jZU1ldGEu
aXRlbUNvdW50czsKCiAgICAgIGlmIChpdGVtQ291bnRzW2l0ZW1HdWlkXVtkZXBlbmRlbnRHdWlk
XSA9PT0gdW5kZWZpbmVkKSB7IGl0ZW1Db3VudHNbaXRlbUd1aWRdW2RlcGVuZGVudEd1aWRdID0g
MDsgfQogICAgICBpZiAoLS1pdGVtQ291bnRzW2l0ZW1HdWlkXVtkZXBlbmRlbnRHdWlkXSA9PT0g
MCkgewogICAgICAgIGRlbGV0ZSBpdGVtQ291bnRzW2l0ZW1HdWlkXVtkZXBlbmRlbnRHdWlkXTsK
ICAgICAgICBudW1iZXJPZkFycmF5c0l0ZW1BcHBlYXJzSW4gPSBFbWJlci5rZXlzKGl0ZW1Db3Vu
dHNbaXRlbUd1aWRdKS5sZW5ndGg7CgogICAgICAgIGlmIChudW1iZXJPZkFycmF5c0l0ZW1BcHBl
YXJzSW4gPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBpdGVtQ291bnRzW2l0ZW1HdWlkXTsKICAg
ICAgICB9CiAgICAgICAgYXJyYXkucmVtb3ZlT2JqZWN0KGl0ZW0pOwogICAgICB9CiAgICAgIHJl
dHVybiBhcnJheTsKICAgIH0KICB9KTsKICByZXR1cm4gRW1iZXIuYXJyYXlDb21wdXRlZC5hcHBs
eShudWxsLCBhcmdzKTsKfTsKCi8qKgogIEEgY29tcHV0ZWQgcHJvcGVydHkgd2hpY2ggcmV0dXJu
cyBhIG5ldyBhcnJheSB3aXRoIGFsbCB0aGUKICBwcm9wZXJ0aWVzIGZyb20gdGhlIGZpcnN0IGRl
cGVuZGVudCBhcnJheSB0aGF0IGFyZSBub3QgaW4gdGhlIHNlY29uZAogIGRlcGVuZGVudCBhcnJh
eS4KCiAgRXhhbXBsZQoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLkhhbXN0ZXIgPSBFbWJlci5PYmpl
Y3QuZXh0ZW5kKHsKICAgIGxpa2VzOiBbJ2JhbmFuYScsICdncmFwZScsICdrYWxlJ10sCiAgICB3
YW50czogRW1iZXIuY29tcHV0ZWQuc2V0RGlmZignbGlrZXMnLCAnZnJ1aXRzJykKICB9KTsKCiAg
dmFyIGhhbXN0ZXIgPSBBcHAuSGFtc3Rlci5jcmVhdGUoe2ZydWl0czogWwogICAgJ2dyYXBlJywK
ICAgICdrYWxlJywKICBdfSk7CiAgaGFtc3Rlci5nZXQoJ3dhbnRzJyk7IC8vIFsnYmFuYW5hJ10K
ICBgYGAKCiAgQG1ldGhvZCBjb21wdXRlZC5zZXREaWZmCiAgQGZvciBFbWJlcgogIEBwYXJhbSB7
U3RyaW5nfSBzZXRBUHJvcGVydHkKICBAcGFyYW0ge1N0cmluZ30gc2V0QlByb3BlcnR5CiAgQHJl
dHVybiB7RW1iZXIuQ29tcHV0ZWRQcm9wZXJ0eX0gY29tcHV0ZXMgYSBuZXcgYXJyYXkgd2l0aCBh
bGwgdGhlCiAgaXRlbXMgZnJvbSB0aGUgZmlyc3QgZGVwZW5kZW50IGFycmF5IHRoYXQgYXJlIG5v
dCBpbiB0aGUgc2Vjb25kCiAgZGVwZW5kZW50IGFycmF5CiovCkVtYmVyLmNvbXB1dGVkLnNldERp
ZmYgPSBmdW5jdGlvbiAoc2V0QVByb3BlcnR5LCBzZXRCUHJvcGVydHkpIHsKICBpZiAoYXJndW1l
bnRzLmxlbmd0aCAhPT0gMikgewogICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCJzZXREaWZmIHJl
cXVpcmVzIGV4YWN0bHkgdHdvIGRlcGVuZGVudCBhcnJheXMuIik7CiAgfQogIHJldHVybiBFbWJl
ci5hcnJheUNvbXB1dGVkLmNhbGwobnVsbCwgc2V0QVByb3BlcnR5LCBzZXRCUHJvcGVydHksIHsK
ICAgIGFkZGVkSXRlbTogZnVuY3Rpb24gKGFycmF5LCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5j
ZU1ldGEpIHsKICAgICAgdmFyIHNldEEgPSBnZXQodGhpcywgc2V0QVByb3BlcnR5KSwKICAgICAg
ICAgIHNldEIgPSBnZXQodGhpcywgc2V0QlByb3BlcnR5KTsKCiAgICAgIGlmIChjaGFuZ2VNZXRh
LmFycmF5Q2hhbmdlZCA9PT0gc2V0QSkgewogICAgICAgIGlmICghc2V0Qi5jb250YWlucyhpdGVt
KSkgewogICAgICAgICAgYXJyYXkuYWRkT2JqZWN0KGl0ZW0pOwogICAgICAgIH0KICAgICAgfSBl
bHNlIHsKICAgICAgICBhcnJheS5yZW1vdmVPYmplY3QoaXRlbSk7CiAgICAgIH0KICAgICAgcmV0
dXJuIGFycmF5OwogICAgfSwKCiAgICByZW1vdmVkSXRlbTogZnVuY3Rpb24gKGFycmF5LCBpdGVt
LCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAgdmFyIHNldEEgPSBnZXQodGhpcywg
c2V0QVByb3BlcnR5KSwKICAgICAgICAgIHNldEIgPSBnZXQodGhpcywgc2V0QlByb3BlcnR5KTsK
CiAgICAgIGlmIChjaGFuZ2VNZXRhLmFycmF5Q2hhbmdlZCA9PT0gc2V0QikgewogICAgICAgIGlm
IChzZXRBLmNvbnRhaW5zKGl0ZW0pKSB7CiAgICAgICAgICBhcnJheS5hZGRPYmplY3QoaXRlbSk7
CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGFycmF5LnJlbW92ZU9iamVjdChpdGVt
KTsKICAgICAgfQogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgfSk7Cn07CgpmdW5jdGlvbiBi
aW5hcnlTZWFyY2goYXJyYXksIGl0ZW0sIGxvdywgaGlnaCkgewogIHZhciBtaWQsIG1pZEl0ZW0s
IHJlcywgZ3VpZE1pZCwgZ3VpZEl0ZW07CgogIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgNCkgeyBo
aWdoID0gZ2V0KGFycmF5LCAnbGVuZ3RoJyk7IH0KICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMp
IHsgbG93ID0gMDsgfQoKICBpZiAobG93ID09PSBoaWdoKSB7CiAgICByZXR1cm4gbG93OwogIH0K
CiAgbWlkID0gbG93ICsgTWF0aC5mbG9vcigoaGlnaCAtIGxvdykgLyAyKTsKICBtaWRJdGVtID0g
YXJyYXkub2JqZWN0QXQobWlkKTsKCiAgZ3VpZE1pZCA9IF9ndWlkRm9yKG1pZEl0ZW0pOwogIGd1
aWRJdGVtID0gX2d1aWRGb3IoaXRlbSk7CgogIGlmIChndWlkTWlkID09PSBndWlkSXRlbSkgewog
ICAgcmV0dXJuIG1pZDsKICB9CgogIHJlcyA9IHRoaXMub3JkZXIobWlkSXRlbSwgaXRlbSk7CiAg
aWYgKHJlcyA9PT0gMCkgewogICAgcmVzID0gZ3VpZE1pZCA8IGd1aWRJdGVtID8gLTEgOiAxOwog
IH0KCgogIGlmIChyZXMgPCAwKSB7CiAgICByZXR1cm4gdGhpcy5iaW5hcnlTZWFyY2goYXJyYXks
IGl0ZW0sIG1pZCsxLCBoaWdoKTsKICB9IGVsc2UgaWYgKHJlcyA+IDApIHsKICAgIHJldHVybiB0
aGlzLmJpbmFyeVNlYXJjaChhcnJheSwgaXRlbSwgbG93LCBtaWQpOwogIH0KCiAgcmV0dXJuIG1p
ZDsKCiAgZnVuY3Rpb24gX2d1aWRGb3IoaXRlbSkgewogICAgaWYgKFNlYXJjaFByb3h5LmRldGVj
dEluc3RhbmNlKGl0ZW0pKSB7CiAgICAgIHJldHVybiBndWlkRm9yKGdldChpdGVtLCAnY29udGVu
dCcpKTsKICAgIH0KICAgIHJldHVybiBndWlkRm9yKGl0ZW0pOwogIH0KfQoKClNlYXJjaFByb3h5
ID0gRW1iZXIuT2JqZWN0UHJveHkuZXh0ZW5kKCk7CgovKioKICBBIGNvbXB1dGVkIHByb3BlcnR5
IHdoaWNoIHJldHVybnMgYSBuZXcgYXJyYXkgd2l0aCBhbGwgdGhlCiAgcHJvcGVydGllcyBmcm9t
IHRoZSBmaXJzdCBkZXBlbmRlbnQgYXJyYXkgc29ydGVkIGJhc2VkIG9uIGEgcHJvcGVydHkKICBv
ciBzb3J0IGZ1bmN0aW9uLgoKICBUaGUgY2FsbGJhY2sgbWV0aG9kIHlvdSBwcm92aWRlIHNob3Vs
ZCBoYXZlIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlOgoKICBgYGBqYXZhc2NyaXB0CiAgZnVuY3Rp
b24oaXRlbUEsIGl0ZW1CKTsKICBgYGAKCiAgLSBgaXRlbUFgIHRoZSBmaXJzdCBpdGVtIHRvIGNv
bXBhcmUuCiAgLSBgaXRlbUJgIHRoZSBzZWNvbmQgaXRlbSB0byBjb21wYXJlLgoKICBUaGlzIGZ1
bmN0aW9uIHNob3VsZCByZXR1cm4gYC0xYCB3aGVuIGBpdGVtQWAgc2hvdWxkIGNvbWUgYmVmb3Jl
CiAgYGl0ZW1CYC4gSXQgc2hvdWxkIHJldHVybiBgMWAgd2hlbiBgaXRlbUFgIHNob3VsZCBjb21l
IGFmdGVyCiAgYGl0ZW1CYC4gSWYgdGhlIGBpdGVtQWAgYW5kIGBpdGVtQmAgYXJlIGVxdWFsIHRo
aXMgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBgMGAuCgogIEV4YW1wbGUKCiAgYGBgamF2YXNjcmlw
dAogIHZhciBUb0RvTGlzdCA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgdG9kb3NTb3J0aW5n
OiBbJ25hbWUnXSwKICAgIHNvcnRlZFRvZG9zOiBFbWJlci5jb21wdXRlZC5zb3J0KCd0b2Rvcycs
ICd0b2Rvc1NvcnRpbmcnKSwKICAgIHByaW9yaXR5VG9kb3M6IEVtYmVyLmNvbXB1dGVkLnNvcnQo
J3RvZG9zJywgZnVuY3Rpb24oYSwgYil7CiAgICAgIGlmIChhLnByaW9yaXR5ID4gYi5wcmlvcml0
eSkgewogICAgICAgIHJldHVybiAxOwogICAgICB9IGVsc2UgaWYgKGEucHJpb3JpdHkgPCBiLnBy
aW9yaXR5KSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiAwOwogICAg
fSksCiAgfSk7CiAgdmFyIHRvZG9MaXN0ID0gVG9Eb0xpc3QuY3JlYXRlKHt0b2RvczogWwogICAg
e25hbWU6ICdVbml0IFRlc3QnLCBwcmlvcml0eTogMn0sCiAgICB7bmFtZTogJ0RvY3VtZW50YXRp
b24nLCBwcmlvcml0eTogM30sCiAgICB7bmFtZTogJ1JlbGVhc2UnLCBwcmlvcml0eTogMX0KICBd
fSk7CgogIHRvZG9MaXN0LmdldCgnc29ydGVkVG9kb3MnKTsgLy8gW3tuYW1lOidEb2N1bWVudGF0
aW9uJywgcHJpb3JpdHk6M30sIHtuYW1lOidSZWxlYXNlJywgcHJpb3JpdHk6MX0sIHtuYW1lOidV
bml0IFRlc3QnLCBwcmlvcml0eToyfV0KICB0b2RvTGlzdC5nZXQoJ3ByaW9yaXR5VG9kb3MnKTsg
Ly8gW3tuYW1lOidSZWxlYXNlJywgcHJpb3JpdHk6MX0sIHtuYW1lOidVbml0IFRlc3QnLCBwcmlv
cml0eToyfSwge25hbWU6J0RvY3VtZW50YXRpb24nLCBwcmlvcml0eTozfV0KICBgYGAKCiAgQG1l
dGhvZCBjb21wdXRlZC5zb3J0CiAgQGZvciBFbWJlcgogIEBwYXJhbSB7U3RyaW5nfSBkZXBlbmRl
bnRLZXkKICBAcGFyYW0ge1N0cmluZyBvciBGdW5jdGlvbn0gc29ydERlZmluaXRpb24gYSBkZXBl
bmRlbnQga2V5IHRvIGFuCiAgYXJyYXkgb2Ygc29ydCBwcm9wZXJ0aWVzIG9yIGEgZnVuY3Rpb24g
dG8gdXNlIHdoZW4gc29ydGluZwogIEByZXR1cm4ge0VtYmVyLkNvbXB1dGVkUHJvcGVydHl9IGNv
bXB1dGVzIGEgbmV3IHNvcnRlZCBhcnJheSBiYXNlZAogIG9uIHRoZSBzb3J0IHByb3BlcnR5IGFy
cmF5IG9yIGNhbGxiYWNrIGZ1bmN0aW9uCiovCkVtYmVyLmNvbXB1dGVkLnNvcnQgPSBmdW5jdGlv
biAoaXRlbXNLZXksIHNvcnREZWZpbml0aW9uKSB7CiAgRW1iZXIuYXNzZXJ0KCJFbWJlci5jb21w
dXRlZC5zb3J0IHJlcXVpcmVzIHR3byBhcmd1bWVudHM6IGFuIGFycmF5IGtleSB0byBzb3J0IGFu
ZCBlaXRoZXIgYSBzb3J0IHByb3BlcnRpZXMga2V5IG9yIHNvcnQgZnVuY3Rpb24iLCBhcmd1bWVu
dHMubGVuZ3RoID09PSAyKTsKCiAgdmFyIGluaXRGbiwgc29ydFByb3BlcnRpZXNLZXk7CgogIGlm
ICh0eXBlb2Ygc29ydERlZmluaXRpb24gPT09ICdmdW5jdGlvbicpIHsKICAgIGluaXRGbiA9IGZ1
bmN0aW9uIChhcnJheSwgY2hhbmdlTWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIGluc3RhbmNl
TWV0YS5vcmRlciA9IHNvcnREZWZpbml0aW9uOwogICAgICBpbnN0YW5jZU1ldGEuYmluYXJ5U2Vh
cmNoID0gYmluYXJ5U2VhcmNoOwogICAgfTsKICB9IGVsc2UgewogICAgc29ydFByb3BlcnRpZXNL
ZXkgPSBzb3J0RGVmaW5pdGlvbjsKICAgIGluaXRGbiA9IGZ1bmN0aW9uIChhcnJheSwgY2hhbmdl
TWV0YSwgaW5zdGFuY2VNZXRhKSB7CiAgICAgIGZ1bmN0aW9uIHNldHVwU29ydFByb3BlcnRpZXMo
KSB7CiAgICAgICAgdmFyIHNvcnRQcm9wZXJ0eURlZmluaXRpb25zID0gZ2V0KHRoaXMsIHNvcnRQ
cm9wZXJ0aWVzS2V5KSwKICAgICAgICAgICAgc29ydFByb3BlcnR5LAogICAgICAgICAgICBzb3J0
UHJvcGVydGllcyA9IGluc3RhbmNlTWV0YS5zb3J0UHJvcGVydGllcyA9IFtdLAogICAgICAgICAg
ICBzb3J0UHJvcGVydHlBc2NlbmRpbmcgPSBpbnN0YW5jZU1ldGEuc29ydFByb3BlcnR5QXNjZW5k
aW5nID0ge30sCiAgICAgICAgICAgIGlkeCwKICAgICAgICAgICAgYXNjOwoKICAgICAgICBFbWJl
ci5hc3NlcnQoIkNhbm5vdCBzb3J0OiAnIiArIHNvcnRQcm9wZXJ0aWVzS2V5ICsgIicgaXMgbm90
IGFuIGFycmF5LiIsIEVtYmVyLmlzQXJyYXkoc29ydFByb3BlcnR5RGVmaW5pdGlvbnMpKTsKCiAg
ICAgICAgY2hhbmdlTWV0YS5wcm9wZXJ0eS5jbGVhckl0ZW1Qcm9wZXJ0eUtleXMoaXRlbXNLZXkp
OwoKICAgICAgICBmb3JFYWNoKHNvcnRQcm9wZXJ0eURlZmluaXRpb25zLCBmdW5jdGlvbiAoc29y
dFByb3BlcnR5RGVmaW5pdGlvbikgewogICAgICAgICAgaWYgKChpZHggPSBzb3J0UHJvcGVydHlE
ZWZpbml0aW9uLmluZGV4T2YoJzonKSkgIT09IC0xKSB7CiAgICAgICAgICAgIHNvcnRQcm9wZXJ0
eSA9IHNvcnRQcm9wZXJ0eURlZmluaXRpb24uc3Vic3RyaW5nKDAsIGlkeCk7CiAgICAgICAgICAg
IGFzYyA9IHNvcnRQcm9wZXJ0eURlZmluaXRpb24uc3Vic3RyaW5nKGlkeCsxKS50b0xvd2VyQ2Fz
ZSgpICE9PSAnZGVzYyc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzb3J0UHJvcGVy
dHkgPSBzb3J0UHJvcGVydHlEZWZpbml0aW9uOwogICAgICAgICAgICBhc2MgPSB0cnVlOwogICAg
ICAgICAgfQoKICAgICAgICAgIHNvcnRQcm9wZXJ0aWVzLnB1c2goc29ydFByb3BlcnR5KTsKICAg
ICAgICAgIHNvcnRQcm9wZXJ0eUFzY2VuZGluZ1tzb3J0UHJvcGVydHldID0gYXNjOwogICAgICAg
ICAgY2hhbmdlTWV0YS5wcm9wZXJ0eS5pdGVtUHJvcGVydHlLZXkoaXRlbXNLZXksIHNvcnRQcm9w
ZXJ0eSk7CiAgICAgICAgfSk7CgogICAgICAgIHNvcnRQcm9wZXJ0eURlZmluaXRpb25zLmFkZE9i
c2VydmVyKCdAZWFjaCcsIHRoaXMsIHVwZGF0ZVNvcnRQcm9wZXJ0aWVzT25jZSk7CiAgICAgIH0K
CiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNvcnRQcm9wZXJ0aWVzT25jZSgpIHsKICAgICAgICBFbWJl
ci5ydW4ub25jZSh0aGlzLCB1cGRhdGVTb3J0UHJvcGVydGllcywgY2hhbmdlTWV0YS5wcm9wZXJ0
eU5hbWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB1cGRhdGVTb3J0UHJvcGVydGllcyhwcm9w
ZXJ0eU5hbWUpIHsKICAgICAgICBzZXR1cFNvcnRQcm9wZXJ0aWVzLmNhbGwodGhpcyk7CiAgICAg
ICAgY2hhbmdlTWV0YS5wcm9wZXJ0eS5yZWNvbXB1dGVPbmNlLmNhbGwodGhpcywgcHJvcGVydHlO
YW1lKTsKICAgICAgfQoKICAgICAgRW1iZXIuYWRkT2JzZXJ2ZXIodGhpcywgc29ydFByb3BlcnRp
ZXNLZXksIHVwZGF0ZVNvcnRQcm9wZXJ0aWVzT25jZSk7CgogICAgICBzZXR1cFNvcnRQcm9wZXJ0
aWVzLmNhbGwodGhpcyk7CgoKICAgICAgaW5zdGFuY2VNZXRhLm9yZGVyID0gZnVuY3Rpb24gKGl0
ZW1BLCBpdGVtQikgewogICAgICAgIHZhciBzb3J0UHJvcGVydHksIHJlc3VsdCwgYXNjOwogICAg
ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zb3J0UHJvcGVydGllcy5sZW5ndGg7ICsraSkg
ewogICAgICAgICAgc29ydFByb3BlcnR5ID0gdGhpcy5zb3J0UHJvcGVydGllc1tpXTsKICAgICAg
ICAgIHJlc3VsdCA9IEVtYmVyLmNvbXBhcmUoZ2V0KGl0ZW1BLCBzb3J0UHJvcGVydHkpLCBnZXQo
aXRlbUIsIHNvcnRQcm9wZXJ0eSkpOwoKICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHsKICAg
ICAgICAgICAgYXNjID0gdGhpcy5zb3J0UHJvcGVydHlBc2NlbmRpbmdbc29ydFByb3BlcnR5XTsK
ICAgICAgICAgICAgcmV0dXJuIGFzYyA/IHJlc3VsdCA6ICgtMSAqIHJlc3VsdCk7CiAgICAgICAg
ICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgICAgfTsKCiAgICAgIGluc3RhbmNl
TWV0YS5iaW5hcnlTZWFyY2ggPSBiaW5hcnlTZWFyY2g7CiAgICB9OwogIH0KCiAgcmV0dXJuIEVt
YmVyLmFycmF5Q29tcHV0ZWQuY2FsbChudWxsLCBpdGVtc0tleSwgewogICAgaW5pdGlhbGl6ZTog
aW5pdEZuLAoKICAgIGFkZGVkSXRlbTogZnVuY3Rpb24gKGFycmF5LCBpdGVtLCBjaGFuZ2VNZXRh
LCBpbnN0YW5jZU1ldGEpIHsKICAgICAgdmFyIGluZGV4ID0gaW5zdGFuY2VNZXRhLmJpbmFyeVNl
YXJjaChhcnJheSwgaXRlbSk7CiAgICAgIGFycmF5Lmluc2VydEF0KGluZGV4LCBpdGVtKTsKICAg
ICAgcmV0dXJuIGFycmF5OwogICAgfSwKCiAgICByZW1vdmVkSXRlbTogZnVuY3Rpb24gKGFycmF5
LCBpdGVtLCBjaGFuZ2VNZXRhLCBpbnN0YW5jZU1ldGEpIHsKICAgICAgdmFyIHByb3h5UHJvcGVy
dGllcywgaW5kZXgsIHNlYXJjaEl0ZW07CgogICAgICBpZiAoY2hhbmdlTWV0YS5wcmV2aW91c1Zh
bHVlcykgewogICAgICAgIHByb3h5UHJvcGVydGllcyA9IG1lcmdlKHsgY29udGVudDogaXRlbSB9
LCBjaGFuZ2VNZXRhLnByZXZpb3VzVmFsdWVzKTsKCiAgICAgICAgc2VhcmNoSXRlbSA9IFNlYXJj
aFByb3h5LmNyZWF0ZShwcm94eVByb3BlcnRpZXMpOwogICAgICB9IGVsc2UgewogICAgICAgIHNl
YXJjaEl0ZW0gPSBpdGVtOwogICAgICB9CgogICAgICBpbmRleCA9IGluc3RhbmNlTWV0YS5iaW5h
cnlTZWFyY2goYXJyYXksIHNlYXJjaEl0ZW0pOwogICAgICBhcnJheS5yZW1vdmVBdChpbmRleCk7
CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0KICB9KTsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKRW1iZXIuUlNWUCA9IHJlcXVpcmVNb2R1bGUoJ3JzdnAnKTsKCkVtYmVyLlJTVlAub25lcnJv
ckRlZmF1bHQgPSBmdW5jdGlvbihlcnJvcikgewogIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9y
KSB7CiAgICBpZiAoRW1iZXIudGVzdGluZykgewogICAgICBpZiAoRW1iZXIuVGVzdCAmJiBFbWJl
ci5UZXN0LmFkYXB0ZXIpIHsKICAgICAgICBFbWJlci5UZXN0LmFkYXB0ZXIuZXhjZXB0aW9uKGVy
cm9yKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfQogICAgfSBl
bHNlIHsKICAgICAgRW1iZXIuTG9nZ2VyLmVycm9yKGVycm9yLnN0YWNrKTsKICAgICAgRW1iZXIu
YXNzZXJ0KGVycm9yLCBmYWxzZSk7CiAgICB9CiAgfQp9OwoKRW1iZXIuUlNWUC5vbignZXJyb3In
LCBFbWJlci5SU1ZQLm9uZXJyb3JEZWZhdWx0KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoq
CkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgYV9zbGljZSA9
IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCgppZiAoRW1iZXIuRVhURU5EX1BST1RPVFlQRVMgPT09
IHRydWUgfHwgRW1iZXIuRVhURU5EX1BST1RPVFlQRVMuRnVuY3Rpb24pIHsKCiAgLyoqCiAgICBU
aGUgYHByb3BlcnR5YCBleHRlbnNpb24gb2YgSmF2YXNjcmlwdCdzIEZ1bmN0aW9uIHByb3RvdHlw
ZSBpcyBhdmFpbGFibGUKICAgIHdoZW4gYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTYCBvciBgRW1i
ZXIuRVhURU5EX1BST1RPVFlQRVMuRnVuY3Rpb25gIGlzCiAgICBgdHJ1ZWAsIHdoaWNoIGlzIHRo
ZSBkZWZhdWx0LgoKICAgIENvbXB1dGVkIHByb3BlcnRpZXMgYWxsb3cgeW91IHRvIHRyZWF0IGEg
ZnVuY3Rpb24gbGlrZSBhIHByb3BlcnR5OgoKICAgIGBgYGphdmFzY3JpcHQKICAgIE15QXBwLlBy
ZXNpZGVudCA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICBmaXJzdE5hbWU6ICcnLAogICAg
ICBsYXN0TmFtZTogICcnLAoKICAgICAgZnVsbE5hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJl
dHVybiB0aGlzLmdldCgnZmlyc3ROYW1lJykgKyAnICcgKyB0aGlzLmdldCgnbGFzdE5hbWUnKTsK
CiAgICAgICAgLy8gQ2FsbCB0aGlzIGZsYWcgdG8gbWFyayB0aGUgZnVuY3Rpb24gYXMgYSBwcm9w
ZXJ0eQogICAgICB9LnByb3BlcnR5KCkKICAgIH0pOwoKICAgIHZhciBwcmVzaWRlbnQgPSBNeUFw
cC5QcmVzaWRlbnQuY3JlYXRlKHsKICAgICAgZmlyc3ROYW1lOiAiQmFyYWNrIiwKICAgICAgbGFz
dE5hbWU6ICJPYmFtYSIKICAgIH0pOwoKICAgIHByZXNpZGVudC5nZXQoJ2Z1bGxOYW1lJyk7ICAg
IC8vICJCYXJhY2sgT2JhbWEiCiAgICBgYGAKCiAgICBUcmVhdGluZyBhIGZ1bmN0aW9uIGxpa2Ug
YSBwcm9wZXJ0eSBpcyB1c2VmdWwgYmVjYXVzZSB0aGV5IGNhbiB3b3JrIHdpdGgKICAgIGJpbmRp
bmdzLCBqdXN0IGxpa2UgYW55IG90aGVyIHByb3BlcnR5LgoKICAgIE1hbnkgY29tcHV0ZWQgcHJv
cGVydGllcyBoYXZlIGRlcGVuZGVuY2llcyBvbiBvdGhlciBwcm9wZXJ0aWVzLiBGb3IKICAgIGV4
YW1wbGUsIGluIHRoZSBhYm92ZSBleGFtcGxlLCB0aGUgYGZ1bGxOYW1lYCBwcm9wZXJ0eSBkZXBl
bmRzIG9uCiAgICBgZmlyc3ROYW1lYCBhbmQgYGxhc3ROYW1lYCB0byBkZXRlcm1pbmUgaXRzIHZh
bHVlLiBZb3UgY2FuIHRlbGwgRW1iZXIKICAgIGFib3V0IHRoZXNlIGRlcGVuZGVuY2llcyBsaWtl
IHRoaXM6CgogICAgYGBgamF2YXNjcmlwdAogICAgTXlBcHAuUHJlc2lkZW50ID0gRW1iZXIuT2Jq
ZWN0LmV4dGVuZCh7CiAgICAgIGZpcnN0TmFtZTogJycsCiAgICAgIGxhc3ROYW1lOiAgJycsCgog
ICAgICBmdWxsTmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdmaXJz
dE5hbWUnKSArICcgJyArIHRoaXMuZ2V0KCdsYXN0TmFtZScpOwoKICAgICAgICAvLyBUZWxsIEVt
YmVyLmpzIHRoYXQgdGhpcyBjb21wdXRlZCBwcm9wZXJ0eSBkZXBlbmRzIG9uIGZpcnN0TmFtZQog
ICAgICAgIC8vIGFuZCBsYXN0TmFtZQogICAgICB9LnByb3BlcnR5KCdmaXJzdE5hbWUnLCAnbGFz
dE5hbWUnKQogICAgfSk7CiAgICBgYGAKCiAgICBNYWtlIHN1cmUgeW91IGxpc3QgdGhlc2UgZGVw
ZW5kZW5jaWVzIHNvIEVtYmVyIGtub3dzIHdoZW4gdG8gdXBkYXRlCiAgICBiaW5kaW5ncyB0aGF0
IGNvbm5lY3QgdG8gYSBjb21wdXRlZCBwcm9wZXJ0eS4gQ2hhbmdpbmcgYSBkZXBlbmRlbmN5CiAg
ICB3aWxsIG5vdCBpbW1lZGlhdGVseSB0cmlnZ2VyIGFuIHVwZGF0ZSBvZiB0aGUgY29tcHV0ZWQg
cHJvcGVydHksIGJ1dAogICAgd2lsbCBpbnN0ZWFkIGNsZWFyIHRoZSBjYWNoZSBzbyB0aGF0IGl0
IGlzIHVwZGF0ZWQgd2hlbiB0aGUgbmV4dCBgZ2V0YAogICAgaXMgY2FsbGVkIG9uIHRoZSBwcm9w
ZXJ0eS4KCiAgICBTZWUgW0VtYmVyLkNvbXB1dGVkUHJvcGVydHldKC9hcGkvY2xhc3Nlcy9FbWJl
ci5Db21wdXRlZFByb3BlcnR5Lmh0bWwpLCBbRW1iZXIuY29tcHV0ZWRdKC9hcGkvI21ldGhvZF9j
b21wdXRlZCkuCgogICAgQG1ldGhvZCBwcm9wZXJ0eQogICAgQGZvciBGdW5jdGlvbgogICovCiAg
RnVuY3Rpb24ucHJvdG90eXBlLnByb3BlcnR5ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcmV0ID0g
RW1iZXIuY29tcHV0ZWQodGhpcyk7CiAgICAvLyBDb21wdXRlZFByb3BlcnR5LnByb3RvdHlwZS5w
cm9wZXJ0eSBleHBhbmRzIHByb3BlcnRpZXM7IG5vIG5lZWQgZm9yIHVzIHRvCiAgICAvLyBkbyBz
byBoZXJlLgogICAgcmV0dXJuIHJldC5wcm9wZXJ0eS5hcHBseShyZXQsIGFyZ3VtZW50cyk7CiAg
fTsKCiAgLyoqCiAgICBUaGUgYG9ic2VydmVzYCBleHRlbnNpb24gb2YgSmF2YXNjcmlwdCdzIEZ1
bmN0aW9uIHByb3RvdHlwZSBpcyBhdmFpbGFibGUKICAgIHdoZW4gYEVtYmVyLkVYVEVORF9QUk9U
T1RZUEVTYCBvciBgRW1iZXIuRVhURU5EX1BST1RPVFlQRVMuRnVuY3Rpb25gIGlzCiAgICB0cnVl
LCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KCiAgICBZb3UgY2FuIG9ic2VydmUgcHJvcGVydHkgY2hh
bmdlcyBzaW1wbHkgYnkgYWRkaW5nIHRoZSBgb2JzZXJ2ZXNgCiAgICBjYWxsIHRvIHRoZSBlbmQg
b2YgeW91ciBtZXRob2QgZGVjbGFyYXRpb25zIGluIGNsYXNzZXMgdGhhdCB5b3Ugd3JpdGUuCiAg
ICBGb3IgZXhhbXBsZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBFbWJlci5PYmplY3QuZXh0ZW5k
KHsKICAgICAgdmFsdWVPYnNlcnZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gRXhlY3V0ZXMg
d2hlbmV2ZXIgdGhlICJ2YWx1ZSIgcHJvcGVydHkgY2hhbmdlcwogICAgICB9Lm9ic2VydmVzKCd2
YWx1ZScpCiAgICB9KTsKICAgIGBgYAoKICAgIEluIHRoZSBmdXR1cmUgdGhpcyBtZXRob2QgbWF5
IGJlY29tZSBhc3luY2hyb25vdXMuIElmIHlvdSB3YW50IHRvIGVuc3VyZQogICAgc3luY2hyb25v
dXMgYmVoYXZpb3IsIHVzZSBgb2JzZXJ2ZXNJbW1lZGlhdGVseWAuCgogICAgU2VlIGBFbWJlci5v
YnNlcnZlcmAuCgogICAgQG1ldGhvZCBvYnNlcnZlcwogICAgQGZvciBGdW5jdGlvbgogICovCiAg
RnVuY3Rpb24ucHJvdG90eXBlLm9ic2VydmVzID0gZnVuY3Rpb24oKSB7CiAgICAKICAgICAgdGhp
cy5fX2VtYmVyX29ic2VydmVzX18gPSBhX3NsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIAoKICAg
IHJldHVybiB0aGlzOwogIH07CgogIC8qKgogICAgVGhlIGBvYnNlcnZlc0ltbWVkaWF0ZWx5YCBl
eHRlbnNpb24gb2YgSmF2YXNjcmlwdCdzIEZ1bmN0aW9uIHByb3RvdHlwZSBpcwogICAgYXZhaWxh
YmxlIHdoZW4gYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTYCBvcgogICAgYEVtYmVyLkVYVEVORF9Q
Uk9UT1RZUEVTLkZ1bmN0aW9uYCBpcyB0cnVlLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KCiAgICBZ
b3UgY2FuIG9ic2VydmUgcHJvcGVydHkgY2hhbmdlcyBzaW1wbHkgYnkgYWRkaW5nIHRoZSBgb2Jz
ZXJ2ZXNJbW1lZGlhdGVseWAKICAgIGNhbGwgdG8gdGhlIGVuZCBvZiB5b3VyIG1ldGhvZCBkZWNs
YXJhdGlvbnMgaW4gY2xhc3NlcyB0aGF0IHlvdSB3cml0ZS4KICAgIEZvciBleGFtcGxlOgoKICAg
IGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICB2YWx1ZU9ic2Vy
dmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAvLyBFeGVjdXRlcyBpbW1lZGlhdGVseSBhZnRlciB0
aGUgInZhbHVlIiBwcm9wZXJ0eSBjaGFuZ2VzCiAgICAgIH0ub2JzZXJ2ZXNJbW1lZGlhdGVseSgn
dmFsdWUnKQogICAgfSk7CiAgICBgYGAKCiAgICBJbiB0aGUgZnV0dXJlLCBgb2JzZXJ2ZXNgIG1h
eSBiZWNvbWUgYXN5bmNocm9ub3VzLiBJbiB0aGlzIGV2ZW50LAogICAgYG9ic2VydmVzSW1tZWRp
YXRlbHlgIHdpbGwgbWFpbnRhaW4gdGhlIHN5bmNocm9ub3VzIGJlaGF2aW9yLgoKICAgIFNlZSBg
RW1iZXIuaW1tZWRpYXRlT2JzZXJ2ZXJgLgoKICAgIEBtZXRob2Qgb2JzZXJ2ZXNJbW1lZGlhdGVs
eQogICAgQGZvciBGdW5jdGlvbgogICovCiAgRnVuY3Rpb24ucHJvdG90eXBlLm9ic2VydmVzSW1t
ZWRpYXRlbHkgPSBmdW5jdGlvbigpIHsKICAgIGZvciAodmFyIGk9MCwgbD1hcmd1bWVudHMubGVu
Z3RoOyBpPGw7IGkrKykgewogICAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldOwogICAgICBFbWJl
ci5hc3NlcnQoIkltbWVkaWF0ZSBvYnNlcnZlcnMgbXVzdCBvYnNlcnZlIGludGVybmFsIHByb3Bl
cnRpZXMgb25seSwgbm90IHByb3BlcnRpZXMgb24gb3RoZXIgb2JqZWN0cy4iLCBhcmcuaW5kZXhP
ZignLicpID09PSAtMSk7CiAgICB9CgogICAgLy8gb2JzZXJ2ZXMgaGFuZGxlcyBwcm9wZXJ0eSBl
eHBhbnNpb24KICAgIHJldHVybiB0aGlzLm9ic2VydmVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7
CiAgfTsKCiAgLyoqCiAgICBUaGUgYG9ic2VydmVzQmVmb3JlYCBleHRlbnNpb24gb2YgSmF2YXNj
cmlwdCdzIEZ1bmN0aW9uIHByb3RvdHlwZSBpcwogICAgYXZhaWxhYmxlIHdoZW4gYEVtYmVyLkVY
VEVORF9QUk9UT1RZUEVTYCBvcgogICAgYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTLkZ1bmN0aW9u
YCBpcyB0cnVlLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KCiAgICBZb3UgY2FuIGdldCBub3RpZmll
ZCB3aGVuIGEgcHJvcGVydHkgY2hhbmdlIGlzIGFib3V0IHRvIGhhcHBlbiBieQogICAgYnkgYWRk
aW5nIHRoZSBgb2JzZXJ2ZXNCZWZvcmVgIGNhbGwgdG8gdGhlIGVuZCBvZiB5b3VyIG1ldGhvZAog
ICAgZGVjbGFyYXRpb25zIGluIGNsYXNzZXMgdGhhdCB5b3Ugd3JpdGUuIEZvciBleGFtcGxlOgoK
ICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICB2YWx1ZU9i
c2VydmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAvLyBFeGVjdXRlcyB3aGVuZXZlciB0aGUgInZh
bHVlIiBwcm9wZXJ0eSBpcyBhYm91dCB0byBjaGFuZ2UKICAgICAgfS5vYnNlcnZlc0JlZm9yZSgn
dmFsdWUnKQogICAgfSk7CiAgICBgYGAKCiAgICBTZWUgYEVtYmVyLmJlZm9yZU9ic2VydmVyYC4K
CiAgICBAbWV0aG9kIG9ic2VydmVzQmVmb3JlCiAgICBAZm9yIEZ1bmN0aW9uCiAgKi8KICBGdW5j
dGlvbi5wcm90b3R5cGUub2JzZXJ2ZXNCZWZvcmUgPSBmdW5jdGlvbigpIHsKICAgIAogICAgICB0
aGlzLl9fZW1iZXJfb2JzZXJ2ZXNCZWZvcmVfXyA9IGFfc2xpY2UuY2FsbChhcmd1bWVudHMpOwog
ICAgCgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLyoqCiAgICBUaGUgYG9uYCBleHRlbnNpb24g
b2YgSmF2YXNjcmlwdCdzIEZ1bmN0aW9uIHByb3RvdHlwZSBpcyBhdmFpbGFibGUKICAgIHdoZW4g
YEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTYCBvciBgRW1iZXIuRVhURU5EX1BST1RPVFlQRVMuRnVu
Y3Rpb25gIGlzCiAgICB0cnVlLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KCiAgICBZb3UgY2FuIGxp
c3RlbiBmb3IgZXZlbnRzIHNpbXBseSBieSBhZGRpbmcgdGhlIGBvbmAgY2FsbCB0byB0aGUgZW5k
IG9mCiAgICB5b3VyIG1ldGhvZCBkZWNsYXJhdGlvbnMgaW4gY2xhc3NlcyBvciBtaXhpbnMgdGhh
dCB5b3Ugd3JpdGUuIEZvciBleGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLk1p
eGluLmNyZWF0ZSh7CiAgICAgIGRvU29tZXRoaW5nV2l0aEVsZW1lbnQ6IGZ1bmN0aW9uKCkgewog
ICAgICAgIC8vIEV4ZWN1dGVzIHdoZW5ldmVyIHRoZSAiZGlkSW5zZXJ0RWxlbWVudCIgZXZlbnQg
ZmlyZXMKICAgICAgfS5vbignZGlkSW5zZXJ0RWxlbWVudCcpCiAgICB9KTsKICAgIGBgYAoKICAg
IFNlZSBgRW1iZXIub25gLgoKICAgIEBtZXRob2Qgb24KICAgIEBmb3IgRnVuY3Rpb24KICAqLwog
IEZ1bmN0aW9uLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGV2ZW50cyA9IGFf
c2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgdGhpcy5fX2VtYmVyX2xpc3RlbnNfXyA9IGV2ZW50
czsKICAgIHJldHVybiB0aGlzOwogIH07Cn0KCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Cgp9KSgp
OwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVu
dGltZQoqLwoKCi8qKgogIEltcGxlbWVudHMgc29tZSBzdGFuZGFyZCBtZXRob2RzIGZvciBjb21w
YXJpbmcgb2JqZWN0cy4gQWRkIHRoaXMgbWl4aW4gdG8KICBhbnkgY2xhc3MgeW91IGNyZWF0ZSB0
aGF0IGNhbiBjb21wYXJlIGl0cyBpbnN0YW5jZXMuCgogIFlvdSBzaG91bGQgaW1wbGVtZW50IHRo
ZSBgY29tcGFyZSgpYCBtZXRob2QuCgogIEBjbGFzcyBDb21wYXJhYmxlCiAgQG5hbWVzcGFjZSBF
bWJlcgogIEBzaW5jZSBFbWJlciAwLjkKKi8KRW1iZXIuQ29tcGFyYWJsZSA9IEVtYmVyLk1peGlu
LmNyZWF0ZSh7CgogIC8qKgogICAgT3ZlcnJpZGUgdG8gcmV0dXJuIHRoZSByZXN1bHQgb2YgdGhl
IGNvbXBhcmlzb24gb2YgdGhlIHR3byBwYXJhbWV0ZXJzLiBUaGUKICAgIGNvbXBhcmUgbWV0aG9k
IHNob3VsZCByZXR1cm46CgogICAgLSBgLTFgIGlmIGBhIDwgYmAKICAgIC0gYDBgIGlmIGBhID09
IGJgCiAgICAtIGAxYCBpZiBgYSA+IGJgCgogICAgRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiByYWlz
ZXMgYW4gZXhjZXB0aW9uLgoKICAgIEBtZXRob2QgY29tcGFyZQogICAgQHBhcmFtIGEge09iamVj
dH0gdGhlIGZpcnN0IG9iamVjdCB0byBjb21wYXJlCiAgICBAcGFyYW0gYiB7T2JqZWN0fSB0aGUg
c2Vjb25kIG9iamVjdCB0byBjb21wYXJlCiAgICBAcmV0dXJuIHtJbnRlZ2VyfSB0aGUgcmVzdWx0
IG9mIHRoZSBjb21wYXJpc29uCiAgKi8KICBjb21wYXJlOiBFbWJlci5yZXF1aXJlZChGdW5jdGlv
bikKCn0pOwoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1v
ZHVsZSBlbWJlci1ydW50aW1lCiovCgoKCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVy
LnNldDsKCi8qKgogIEltcGxlbWVudHMgc29tZSBzdGFuZGFyZCBtZXRob2RzIGZvciBjb3B5aW5n
IGFuIG9iamVjdC4gQWRkIHRoaXMgbWl4aW4gdG8KICBhbnkgb2JqZWN0IHlvdSBjcmVhdGUgdGhh
dCBjYW4gY3JlYXRlIGEgY29weSBvZiBpdHNlbGYuIFRoaXMgbWl4aW4gaXMKICBhZGRlZCBhdXRv
bWF0aWNhbGx5IHRvIHRoZSBidWlsdC1pbiBhcnJheS4KCiAgWW91IHNob3VsZCBnZW5lcmFsbHkg
aW1wbGVtZW50IHRoZSBgY29weSgpYCBtZXRob2QgdG8gcmV0dXJuIGEgY29weSBvZiB0aGUKICBy
ZWNlaXZlci4KCiAgTm90ZSB0aGF0IGBmcm96ZW5Db3B5KClgIHdpbGwgb25seSB3b3JrIGlmIHlv
dSBhbHNvIGltcGxlbWVudAogIGBFbWJlci5GcmVlemFibGVgLgoKICBAY2xhc3MgQ29weWFibGUK
ICBAbmFtZXNwYWNlIEVtYmVyCiAgQHNpbmNlIEVtYmVyIDAuOQoqLwpFbWJlci5Db3B5YWJsZSA9
IEVtYmVyLk1peGluLmNyZWF0ZSh7CgogIC8qKgogICAgT3ZlcnJpZGUgdG8gcmV0dXJuIGEgY29w
eSBvZiB0aGUgcmVjZWl2ZXIuIERlZmF1bHQgaW1wbGVtZW50YXRpb24gcmFpc2VzCiAgICBhbiBl
eGNlcHRpb24uCgogICAgQG1ldGhvZCBjb3B5CiAgICBAcGFyYW0ge0Jvb2xlYW59IGRlZXAgaWYg
YHRydWVgLCBhIGRlZXAgY29weSBvZiB0aGUgb2JqZWN0IHNob3VsZCBiZSBtYWRlCiAgICBAcmV0
dXJuIHtPYmplY3R9IGNvcHkgb2YgcmVjZWl2ZXIKICAqLwogIGNvcHk6IEVtYmVyLnJlcXVpcmVk
KEZ1bmN0aW9uKSwKCiAgLyoqCiAgICBJZiB0aGUgb2JqZWN0IGltcGxlbWVudHMgYEVtYmVyLkZy
ZWV6YWJsZWAsIHRoZW4gdGhpcyB3aWxsIHJldHVybiBhIG5ldwogICAgY29weSBpZiB0aGUgb2Jq
ZWN0IGlzIG5vdCBmcm96ZW4gYW5kIHRoZSByZWNlaXZlciBpZiB0aGUgb2JqZWN0IGlzIGZyb3pl
bi4KCiAgICBSYWlzZXMgYW4gZXhjZXB0aW9uIGlmIHlvdSB0cnkgdG8gY2FsbCB0aGlzIG1ldGhv
ZCBvbiBhIG9iamVjdCB0aGF0IGRvZXMKICAgIG5vdCBzdXBwb3J0IGZyZWV6aW5nLgoKICAgIFlv
dSBzaG91bGQgdXNlIHRoaXMgbWV0aG9kIHdoZW5ldmVyIHlvdSB3YW50IGEgY29weSBvZiBhIGZy
ZWV6YWJsZSBvYmplY3QKICAgIHNpbmNlIGEgZnJlZXphYmxlIG9iamVjdCBjYW4gc2ltcGx5IHJl
dHVybiBpdHNlbGYgd2l0aG91dCBhY3R1YWxseQogICAgY29uc3VtaW5nIG1vcmUgbWVtb3J5LgoK
ICAgIEBtZXRob2QgZnJvemVuQ29weQogICAgQHJldHVybiB7T2JqZWN0fSBjb3B5IG9mIHJlY2Vp
dmVyIG9yIHJlY2VpdmVyCiAgKi8KICBmcm96ZW5Db3B5OiBmdW5jdGlvbigpIHsKICAgIGlmIChF
bWJlci5GcmVlemFibGUgJiYgRW1iZXIuRnJlZXphYmxlLmRldGVjdCh0aGlzKSkgewogICAgICBy
ZXR1cm4gZ2V0KHRoaXMsICdpc0Zyb3plbicpID8gdGhpcyA6IHRoaXMuY29weSgpLmZyZWV6ZSgp
OwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKEVtYmVyLlN0cmluZy5m
bXQoIiVAIGRvZXMgbm90IHN1cHBvcnQgZnJlZXppbmciLCBbdGhpc10pKTsKICAgIH0KICB9Cn0p
OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVt
YmVyLXJ1bnRpbWUKKi8KCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7Cgov
KioKICBUaGUgYEVtYmVyLkZyZWV6YWJsZWAgbWl4aW4gaW1wbGVtZW50cyBzb21lIGJhc2ljIG1l
dGhvZHMgZm9yIG1hcmtpbmcgYW4KICBvYmplY3QgYXMgZnJvemVuLiBPbmNlIGFuIG9iamVjdCBp
cyBmcm96ZW4gaXQgc2hvdWxkIGJlIHJlYWQgb25seS4gTm8gY2hhbmdlcwogIG1heSBiZSBtYWRl
IHRoZSBpbnRlcm5hbCBzdGF0ZSBvZiB0aGUgb2JqZWN0LgoKICAjIyBFbmZvcmNlbWVudAoKICBU
byBmdWxseSBzdXBwb3J0IGZyZWV6aW5nIGluIHlvdXIgc3ViY2xhc3MsIHlvdSBtdXN0IGluY2x1
ZGUgdGhpcyBtaXhpbiBhbmQKICBvdmVycmlkZSBhbnkgbWV0aG9kIHRoYXQgbWlnaHQgYWx0ZXIg
YW55IHByb3BlcnR5IG9uIHRoZSBvYmplY3QgdG8gaW5zdGVhZAogIHJhaXNlIGFuIGV4Y2VwdGlv
bi4gWW91IGNhbiBjaGVjayB0aGUgc3RhdGUgb2YgYW4gb2JqZWN0IGJ5IGNoZWNraW5nIHRoZQog
IGBpc0Zyb3plbmAgcHJvcGVydHkuCgogIEFsdGhvdWdoIGZ1dHVyZSB2ZXJzaW9ucyBvZiBKYXZh
U2NyaXB0IG1heSBzdXBwb3J0IGxhbmd1YWdlLWxldmVsIGZyZWV6aW5nCiAgb2JqZWN0IG9iamVj
dHMsIHRoYXQgaXMgbm90IHRoZSBjYXNlIHRvZGF5LiBFdmVuIGlmIGFuIG9iamVjdCBpcyBmcmVl
emFibGUsCiAgaXQgaXMgc3RpbGwgdGVjaG5pY2FsbHkgcG9zc2libGUgdG8gbW9kaWZ5IHRoZSBv
YmplY3QsIGV2ZW4gdGhvdWdoIGl0IGNvdWxkCiAgYnJlYWsgb3RoZXIgcGFydHMgb2YgeW91ciBh
cHBsaWNhdGlvbiB0aGF0IGRvIG5vdCBleHBlY3QgYSBmcm96ZW4gb2JqZWN0IHRvCiAgY2hhbmdl
LiBJdCBpcywgdGhlcmVmb3JlLCB2ZXJ5IGltcG9ydGFudCB0aGF0IHlvdSBhbHdheXMgcmVzcGVj
dCB0aGUKICBgaXNGcm96ZW5gIHByb3BlcnR5IG9uIGFsbCBmcmVlemFibGUgb2JqZWN0cy4KCiAg
IyMgRXhhbXBsZSBVc2FnZQoKICBUaGUgZXhhbXBsZSBiZWxvdyBzaG93cyBhIHNpbXBsZSBvYmpl
Y3QgdGhhdCBpbXBsZW1lbnQgdGhlIGBFbWJlci5GcmVlemFibGVgCiAgcHJvdG9jb2wuCgogIGBg
YGphdmFzY3JpcHQKICBDb250YWN0ID0gRW1iZXIuT2JqZWN0LmV4dGVuZChFbWJlci5GcmVlemFi
bGUsIHsKICAgIGZpcnN0TmFtZTogbnVsbCwKICAgIGxhc3ROYW1lOiBudWxsLAoKICAgIC8vIHN3
YXBzIHRoZSBuYW1lcwogICAgc3dhcE5hbWVzOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMu
Z2V0KCdpc0Zyb3plbicpKSB0aHJvdyBFbWJlci5GUk9aRU5fRVJST1I7CiAgICAgIHZhciB0bXAg
PSB0aGlzLmdldCgnZmlyc3ROYW1lJyk7CiAgICAgIHRoaXMuc2V0KCdmaXJzdE5hbWUnLCB0aGlz
LmdldCgnbGFzdE5hbWUnKSk7CiAgICAgIHRoaXMuc2V0KCdsYXN0TmFtZScsIHRtcCk7CiAgICAg
IHJldHVybiB0aGlzOwogICAgfQoKICB9KTsKCiAgYyA9IENvbnRhY3QuY3JlYXRlKHsgZmlyc3RO
YW1lOiAiSm9obiIsIGxhc3ROYW1lOiAiRG9lIiB9KTsKICBjLnN3YXBOYW1lcygpOyAgLy8gcmV0
dXJucyBjCiAgYy5mcmVlemUoKTsKICBjLnN3YXBOYW1lcygpOyAgLy8gRVhDRVBUSU9OCiAgYGBg
CgogICMjIENvcHlpbmcKCiAgVXN1YWxseSB0aGUgYEVtYmVyLkZyZWV6YWJsZWAgcHJvdG9jb2wg
aXMgaW1wbGVtZW50ZWQgaW4gY29vcGVyYXRpb24gd2l0aCB0aGUKICBgRW1iZXIuQ29weWFibGVg
IHByb3RvY29sLCB3aGljaCBkZWZpbmVzIGEgYGZyb3plbkNvcHkoKWAgbWV0aG9kIHRoYXQgd2ls
bAogIHJldHVybiBhIGZyb3plbiBvYmplY3QsIGlmIHRoZSBvYmplY3QgaW1wbGVtZW50cyB0aGlz
IG1ldGhvZCBhcyB3ZWxsLgoKICBAY2xhc3MgRnJlZXphYmxlCiAgQG5hbWVzcGFjZSBFbWJlcgog
IEBzaW5jZSBFbWJlciAwLjkKKi8KRW1iZXIuRnJlZXphYmxlID0gRW1iZXIuTWl4aW4uY3JlYXRl
KHsKCiAgLyoqCiAgICBTZXQgdG8gYHRydWVgIHdoZW4gdGhlIG9iamVjdCBpcyBmcm96ZW4uIFVz
ZSB0aGlzIHByb3BlcnR5IHRvIGRldGVjdAogICAgd2hldGhlciB5b3VyIG9iamVjdCBpcyBmcm96
ZW4gb3Igbm90LgoKICAgIEBwcm9wZXJ0eSBpc0Zyb3plbgogICAgQHR5cGUgQm9vbGVhbgogICov
CiAgaXNGcm96ZW46IGZhbHNlLAoKICAvKioKICAgIEZyZWV6ZXMgdGhlIG9iamVjdC4gT25jZSB0
aGlzIG1ldGhvZCBoYXMgYmVlbiBjYWxsZWQgdGhlIG9iamVjdCBzaG91bGQKICAgIG5vIGxvbmdl
ciBhbGxvdyBhbnkgcHJvcGVydGllcyB0byBiZSBlZGl0ZWQuCgogICAgQG1ldGhvZCBmcmVlemUK
ICAgIEByZXR1cm4ge09iamVjdH0gcmVjZWl2ZXIKICAqLwogIGZyZWV6ZTogZnVuY3Rpb24oKSB7
CiAgICBpZiAoZ2V0KHRoaXMsICdpc0Zyb3plbicpKSByZXR1cm4gdGhpczsKICAgIHNldCh0aGlz
LCAnaXNGcm96ZW4nLCB0cnVlKTsKICAgIHJldHVybiB0aGlzOwogIH0KCn0pOwoKRW1iZXIuRlJP
WkVOX0VSUk9SID0gIkZyb3plbiBvYmplY3QgY2Fubm90IGJlIG1vZGlmaWVkLiI7Cgp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVudGlt
ZQoqLwoKdmFyIGZvckVhY2ggPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaDsKCi8qKgog
IFRoaXMgbWl4aW4gZGVmaW5lcyB0aGUgQVBJIGZvciBtb2RpZnlpbmcgZ2VuZXJpYyBlbnVtZXJh
Ymxlcy4gVGhlc2UgbWV0aG9kcwogIGNhbiBiZSBhcHBsaWVkIHRvIGFuIG9iamVjdCByZWdhcmRs
ZXNzIG9mIHdoZXRoZXIgaXQgaXMgb3JkZXJlZCBvcgogIHVub3JkZXJlZC4KCiAgTm90ZSB0aGF0
IGFuIEVudW1lcmFibGUgY2FuIGNoYW5nZSBldmVuIGlmIGl0IGRvZXMgbm90IGltcGxlbWVudCB0
aGlzIG1peGluLgogIEZvciBleGFtcGxlLCBhIE1hcHBlZEVudW1lcmFibGUgY2Fubm90IGJlIGRp
cmVjdGx5IG1vZGlmaWVkIGJ1dCBpZiBpdHMKICB1bmRlcmx5aW5nIGVudW1lcmFibGUgY2hhbmdl
cywgaXQgd2lsbCBjaGFuZ2UgYWxzby4KCiAgIyMgQWRkaW5nIE9iamVjdHMKCiAgVG8gYWRkIGFu
IG9iamVjdCB0byBhbiBlbnVtZXJhYmxlLCB1c2UgdGhlIGBhZGRPYmplY3QoKWAgbWV0aG9kLiBU
aGlzCiAgbWV0aG9kIHdpbGwgb25seSBhZGQgdGhlIG9iamVjdCB0byB0aGUgZW51bWVyYWJsZSBp
ZiB0aGUgb2JqZWN0IGlzIG5vdAogIGFscmVhZHkgcHJlc2VudCBhbmQgaXMgb2YgYSB0eXBlIHN1
cHBvcnRlZCBieSB0aGUgZW51bWVyYWJsZS4KCiAgYGBgamF2YXNjcmlwdAogIHNldC5hZGRPYmpl
Y3QoY29udGFjdCk7CiAgYGBgCgogICMjIFJlbW92aW5nIE9iamVjdHMKCiAgVG8gcmVtb3ZlIGFu
IG9iamVjdCBmcm9tIGFuIGVudW1lcmFibGUsIHVzZSB0aGUgYHJlbW92ZU9iamVjdCgpYCBtZXRo
b2QuIFRoaXMKICB3aWxsIG9ubHkgcmVtb3ZlIHRoZSBvYmplY3QgaWYgaXQgaXMgcHJlc2VudCBp
biB0aGUgZW51bWVyYWJsZSwgb3RoZXJ3aXNlCiAgdGhpcyBtZXRob2QgaGFzIG5vIGVmZmVjdC4K
CiAgYGBgamF2YXNjcmlwdAogIHNldC5yZW1vdmVPYmplY3QoY29udGFjdCk7CiAgYGBgCgogICMj
IEltcGxlbWVudGluZyBJbiBZb3VyIE93biBDb2RlCgogIElmIHlvdSBhcmUgaW1wbGVtZW50aW5n
IGFuIG9iamVjdCBhbmQgd2FudCB0byBzdXBwb3J0IHRoaXMgQVBJLCBqdXN0IGluY2x1ZGUKICB0
aGlzIG1peGluIGluIHlvdXIgY2xhc3MgYW5kIGltcGxlbWVudCB0aGUgcmVxdWlyZWQgbWV0aG9k
cy4gSW4geW91ciB1bml0CiAgdGVzdHMsIGJlIHN1cmUgdG8gYXBwbHkgdGhlIEVtYmVyLk11dGFi
bGVFbnVtZXJhYmxlVGVzdHMgdG8geW91ciBvYmplY3QuCgogIEBjbGFzcyBNdXRhYmxlRW51bWVy
YWJsZQogIEBuYW1lc3BhY2UgRW1iZXIKICBAdXNlcyBFbWJlci5FbnVtZXJhYmxlCiovCkVtYmVy
Lk11dGFibGVFbnVtZXJhYmxlID0gRW1iZXIuTWl4aW4uY3JlYXRlKEVtYmVyLkVudW1lcmFibGUs
IHsKCiAgLyoqCiAgICBfX1JlcXVpcmVkLl9fIFlvdSBtdXN0IGltcGxlbWVudCB0aGlzIG1ldGhv
ZCB0byBhcHBseSB0aGlzIG1peGluLgoKICAgIEF0dGVtcHRzIHRvIGFkZCB0aGUgcGFzc2VkIG9i
amVjdCB0byB0aGUgcmVjZWl2ZXIgaWYgdGhlIG9iamVjdCBpcyBub3QKICAgIGFscmVhZHkgcHJl
c2VudCBpbiB0aGUgY29sbGVjdGlvbi4gSWYgdGhlIG9iamVjdCBpcyBwcmVzZW50LCB0aGlzIG1l
dGhvZAogICAgaGFzIG5vIGVmZmVjdC4KCiAgICBJZiB0aGUgcGFzc2VkIG9iamVjdCBpcyBvZiBh
IHR5cGUgbm90IHN1cHBvcnRlZCBieSB0aGUgcmVjZWl2ZXIsCiAgICB0aGVuIHRoaXMgbWV0aG9k
IHNob3VsZCByYWlzZSBhbiBleGNlcHRpb24uCgogICAgQG1ldGhvZCBhZGRPYmplY3QKICAgIEBw
YXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBhZGQgdG8gdGhlIGVudW1lcmFibGUu
CiAgICBAcmV0dXJuIHtPYmplY3R9IHRoZSBwYXNzZWQgb2JqZWN0CiAgKi8KICBhZGRPYmplY3Q6
IEVtYmVyLnJlcXVpcmVkKEZ1bmN0aW9uKSwKCiAgLyoqCiAgICBBZGRzIGVhY2ggb2JqZWN0IGlu
IHRoZSBwYXNzZWQgZW51bWVyYWJsZSB0byB0aGUgcmVjZWl2ZXIuCgogICAgQG1ldGhvZCBhZGRP
YmplY3RzCiAgICBAcGFyYW0ge0VtYmVyLkVudW1lcmFibGV9IG9iamVjdHMgdGhlIG9iamVjdHMg
dG8gYWRkLgogICAgQHJldHVybiB7T2JqZWN0fSByZWNlaXZlcgogICovCiAgYWRkT2JqZWN0czog
ZnVuY3Rpb24ob2JqZWN0cykgewogICAgRW1iZXIuYmVnaW5Qcm9wZXJ0eUNoYW5nZXModGhpcyk7
CiAgICBmb3JFYWNoKG9iamVjdHMsIGZ1bmN0aW9uKG9iaikgeyB0aGlzLmFkZE9iamVjdChvYmop
OyB9LCB0aGlzKTsKICAgIEVtYmVyLmVuZFByb3BlcnR5Q2hhbmdlcyh0aGlzKTsKICAgIHJldHVy
biB0aGlzOwogIH0sCgogIC8qKgogICAgX19SZXF1aXJlZC5fXyBZb3UgbXVzdCBpbXBsZW1lbnQg
dGhpcyBtZXRob2QgdG8gYXBwbHkgdGhpcyBtaXhpbi4KCiAgICBBdHRlbXB0cyB0byByZW1vdmUg
dGhlIHBhc3NlZCBvYmplY3QgZnJvbSB0aGUgcmVjZWl2ZXIgY29sbGVjdGlvbiBpZiB0aGUKICAg
IG9iamVjdCBpcyBwcmVzZW50IGluIHRoZSBjb2xsZWN0aW9uLiBJZiB0aGUgb2JqZWN0IGlzIG5v
dCBwcmVzZW50LAogICAgdGhpcyBtZXRob2QgaGFzIG5vIGVmZmVjdC4KCiAgICBJZiB0aGUgcGFz
c2VkIG9iamVjdCBpcyBvZiBhIHR5cGUgbm90IHN1cHBvcnRlZCBieSB0aGUgcmVjZWl2ZXIsCiAg
ICB0aGVuIHRoaXMgbWV0aG9kIHNob3VsZCByYWlzZSBhbiBleGNlcHRpb24uCgogICAgQG1ldGhv
ZCByZW1vdmVPYmplY3QKICAgIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBy
ZW1vdmUgZnJvbSB0aGUgZW51bWVyYWJsZS4KICAgIEByZXR1cm4ge09iamVjdH0gdGhlIHBhc3Nl
ZCBvYmplY3QKICAqLwogIHJlbW92ZU9iamVjdDogRW1iZXIucmVxdWlyZWQoRnVuY3Rpb24pLAoK
CiAgLyoqCiAgICBSZW1vdmVzIGVhY2ggb2JqZWN0IGluIHRoZSBwYXNzZWQgZW51bWVyYWJsZSBm
cm9tIHRoZSByZWNlaXZlci4KCiAgICBAbWV0aG9kIHJlbW92ZU9iamVjdHMKICAgIEBwYXJhbSB7
RW1iZXIuRW51bWVyYWJsZX0gb2JqZWN0cyB0aGUgb2JqZWN0cyB0byByZW1vdmUKICAgIEByZXR1
cm4ge09iamVjdH0gcmVjZWl2ZXIKICAqLwogIHJlbW92ZU9iamVjdHM6IGZ1bmN0aW9uKG9iamVj
dHMpIHsKICAgIEVtYmVyLmJlZ2luUHJvcGVydHlDaGFuZ2VzKHRoaXMpOwogICAgZm9yRWFjaChv
YmplY3RzLCBmdW5jdGlvbihvYmopIHsgdGhpcy5yZW1vdmVPYmplY3Qob2JqKTsgfSwgdGhpcyk7
CiAgICBFbWJlci5lbmRQcm9wZXJ0eUNoYW5nZXModGhpcyk7CiAgICByZXR1cm4gdGhpczsKICB9
Cgp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVs
ZSBlbWJlci1ydW50aW1lCiovCi8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KLy8gQ09OU1RBTlRTCi8vCgp2YXIgT1VUX09GX1JBTkdF
X0VYQ0VQVElPTiA9ICJJbmRleCBvdXQgb2YgcmFuZ2UiIDsKdmFyIEVNUFRZID0gW107CgovLyAu
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Ci8vIEhFTFBFUlMKLy8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCi8q
KgogIFRoaXMgbWl4aW4gZGVmaW5lcyB0aGUgQVBJIGZvciBtb2RpZnlpbmcgYXJyYXktbGlrZSBv
YmplY3RzLiBUaGVzZSBtZXRob2RzCiAgY2FuIGJlIGFwcGxpZWQgb25seSB0byBhIGNvbGxlY3Rp
b24gdGhhdCBrZWVwcyBpdHMgaXRlbXMgaW4gYW4gb3JkZXJlZCBzZXQuCgogIE5vdGUgdGhhdCBh
biBBcnJheSBjYW4gY2hhbmdlIGV2ZW4gaWYgaXQgZG9lcyBub3QgaW1wbGVtZW50IHRoaXMgbWl4
aW4uCiAgRm9yIGV4YW1wbGUsIG9uZSBtaWdodCBpbXBsZW1lbnQgYSBTcGFyc2VBcnJheSB0aGF0
IGNhbm5vdCBiZSBkaXJlY3RseQogIG1vZGlmaWVkLCBidXQgaWYgaXRzIHVuZGVybHlpbmcgZW51
bWVyYWJsZSBjaGFuZ2VzLCBpdCB3aWxsIGNoYW5nZSBhbHNvLgoKICBAY2xhc3MgTXV0YWJsZUFy
cmF5CiAgQG5hbWVzcGFjZSBFbWJlcgogIEB1c2VzIEVtYmVyLkFycmF5CiAgQHVzZXMgRW1iZXIu
TXV0YWJsZUVudW1lcmFibGUKKi8KRW1iZXIuTXV0YWJsZUFycmF5ID0gRW1iZXIuTWl4aW4uY3Jl
YXRlKEVtYmVyLkFycmF5LCBFbWJlci5NdXRhYmxlRW51bWVyYWJsZSwgewoKICAvKioKICAgIF9f
UmVxdWlyZWQuX18gWW91IG11c3QgaW1wbGVtZW50IHRoaXMgbWV0aG9kIHRvIGFwcGx5IHRoaXMg
bWl4aW4uCgogICAgVGhpcyBpcyBvbmUgb2YgdGhlIHByaW1pdGl2ZXMgeW91IG11c3QgaW1wbGVt
ZW50IHRvIHN1cHBvcnQgYEVtYmVyLkFycmF5YC4KICAgIFlvdSBzaG91bGQgcmVwbGFjZSBhbXQg
b2JqZWN0cyBzdGFydGVkIGF0IGlkeCB3aXRoIHRoZSBvYmplY3RzIGluIHRoZQogICAgcGFzc2Vk
IGFycmF5LiBZb3Ugc2hvdWxkIGFsc28gY2FsbCBgdGhpcy5lbnVtZXJhYmxlQ29udGVudERpZENo
YW5nZSgpYAoKICAgIEBtZXRob2QgcmVwbGFjZQogICAgQHBhcmFtIHtOdW1iZXJ9IGlkeCBTdGFy
dGluZyBpbmRleCBpbiB0aGUgYXJyYXkgdG8gcmVwbGFjZS4gSWYKICAgICAgaWR4ID49IGxlbmd0
aCwgdGhlbiBhcHBlbmQgdG8gdGhlIGVuZCBvZiB0aGUgYXJyYXkuCiAgICBAcGFyYW0ge051bWJl
cn0gYW10IE51bWJlciBvZiBlbGVtZW50cyB0aGF0IHNob3VsZCBiZSByZW1vdmVkIGZyb20KICAg
ICAgdGhlIGFycmF5LCBzdGFydGluZyBhdCAqaWR4Ki4KICAgIEBwYXJhbSB7QXJyYXl9IG9iamVj
dHMgQW4gYXJyYXkgb2YgemVybyBvciBtb3JlIG9iamVjdHMgdGhhdCBzaG91bGQgYmUKICAgICAg
aW5zZXJ0ZWQgaW50byB0aGUgYXJyYXkgYXQgKmlkeCoKICAqLwogIHJlcGxhY2U6IEVtYmVyLnJl
cXVpcmVkKCksCgogIC8qKgogICAgUmVtb3ZlIGFsbCBlbGVtZW50cyBmcm9tIHNlbGYuIFRoaXMg
aXMgdXNlZnVsIGlmIHlvdQogICAgd2FudCB0byByZXVzZSBhbiBleGlzdGluZyBhcnJheSB3aXRo
b3V0IGhhdmluZyB0byByZWNyZWF0ZSBpdC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgY29s
b3JzID0gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSJdOwogICAgY29sb3IubGVuZ3RoKCk7ICAgLy8g
IDMKICAgIGNvbG9ycy5jbGVhcigpOyAgIC8vICBbXQogICAgY29sb3JzLmxlbmd0aCgpOyAgLy8g
IDAKICAgIGBgYAoKICAgIEBtZXRob2QgY2xlYXIKICAgIEByZXR1cm4ge0VtYmVyLkFycmF5fSBB
biBlbXB0eSBBcnJheS4KICAqLwogIGNsZWFyOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbGVuID0g
Z2V0KHRoaXMsICdsZW5ndGgnKTsKICAgIGlmIChsZW4gPT09IDApIHJldHVybiB0aGlzOwogICAg
dGhpcy5yZXBsYWNlKDAsIGxlbiwgRU1QVFkpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoq
CiAgICBUaGlzIHdpbGwgdXNlIHRoZSBwcmltaXRpdmUgYHJlcGxhY2UoKWAgbWV0aG9kIHRvIGlu
c2VydCBhbiBvYmplY3QgYXQgdGhlCiAgICBzcGVjaWZpZWQgaW5kZXguCgogICAgYGBgamF2YXNj
cmlwdAogICAgdmFyIGNvbG9ycyA9IFsicmVkIiwgImdyZWVuIiwgImJsdWUiXTsKICAgIGNvbG9y
cy5pbnNlcnRBdCgyLCAieWVsbG93Iik7ICAvLyBbInJlZCIsICJncmVlbiIsICJ5ZWxsb3ciLCAi
Ymx1ZSJdCiAgICBjb2xvcnMuaW5zZXJ0QXQoNSwgIm9yYW5nZSIpOyAgLy8gRXJyb3I6IEluZGV4
IG91dCBvZiByYW5nZQogICAgYGBgCgogICAgQG1ldGhvZCBpbnNlcnRBdAogICAgQHBhcmFtIHtO
dW1iZXJ9IGlkeCBpbmRleCBvZiBpbnNlcnQgdGhlIG9iamVjdCBhdC4KICAgIEBwYXJhbSB7T2Jq
ZWN0fSBvYmplY3Qgb2JqZWN0IHRvIGluc2VydAogICAgQHJldHVybiB0aGlzCiAgKi8KICBpbnNl
cnRBdDogZnVuY3Rpb24oaWR4LCBvYmplY3QpIHsKICAgIGlmIChpZHggPiBnZXQodGhpcywgJ2xl
bmd0aCcpKSB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoT1VUX09GX1JBTkdFX0VYQ0VQVElPTikgOwog
ICAgdGhpcy5yZXBsYWNlKGlkeCwgMCwgW29iamVjdF0pIDsKICAgIHJldHVybiB0aGlzIDsKICB9
LAoKICAvKioKICAgIFJlbW92ZSBhbiBvYmplY3QgYXQgdGhlIHNwZWNpZmllZCBpbmRleCB1c2lu
ZyB0aGUgYHJlcGxhY2UoKWAgcHJpbWl0aXZlCiAgICBtZXRob2QuIFlvdSBjYW4gcGFzcyBlaXRo
ZXIgYSBzaW5nbGUgaW5kZXgsIG9yIGEgc3RhcnQgYW5kIGEgbGVuZ3RoLgoKICAgIElmIHlvdSBw
YXNzIGEgc3RhcnQgYW5kIGxlbmd0aCB0aGF0IGlzIGJleW9uZCB0aGUKICAgIGxlbmd0aCB0aGlz
IG1ldGhvZCB3aWxsIHRocm93IGFuIGBPVVRfT0ZfUkFOR0VfRVhDRVBUSU9OYC4KCiAgICBgYGBq
YXZhc2NyaXB0CiAgICB2YXIgY29sb3JzID0gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSIsICJ5ZWxs
b3ciLCAib3JhbmdlIl07CiAgICBjb2xvcnMucmVtb3ZlQXQoMCk7ICAgICAvLyBbImdyZWVuIiwg
ImJsdWUiLCAieWVsbG93IiwgIm9yYW5nZSJdCiAgICBjb2xvcnMucmVtb3ZlQXQoMiwgMik7ICAv
LyBbImdyZWVuIiwgImJsdWUiXQogICAgY29sb3JzLnJlbW92ZUF0KDQsIDIpOyAgLy8gRXJyb3I6
IEluZGV4IG91dCBvZiByYW5nZQogICAgYGBgCgogICAgQG1ldGhvZCByZW1vdmVBdAogICAgQHBh
cmFtIHtOdW1iZXJ9IHN0YXJ0IGluZGV4LCBzdGFydCBvZiByYW5nZQogICAgQHBhcmFtIHtOdW1i
ZXJ9IGxlbiBsZW5ndGggb2YgcGFzc2luZyByYW5nZQogICAgQHJldHVybiB7T2JqZWN0fSByZWNl
aXZlcgogICovCiAgcmVtb3ZlQXQ6IGZ1bmN0aW9uKHN0YXJ0LCBsZW4pIHsKICAgIGlmICgnbnVt
YmVyJyA9PT0gdHlwZW9mIHN0YXJ0KSB7CgogICAgICBpZiAoKHN0YXJ0IDwgMCkgfHwgKHN0YXJ0
ID49IGdldCh0aGlzLCAnbGVuZ3RoJykpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVtYmVyLkVycm9y
KE9VVF9PRl9SQU5HRV9FWENFUFRJT04pOwogICAgICB9CgogICAgICAvLyBmYXN0IGNhc2UKICAg
ICAgaWYgKGxlbiA9PT0gdW5kZWZpbmVkKSBsZW4gPSAxOwogICAgICB0aGlzLnJlcGxhY2Uoc3Rh
cnQsIGxlbiwgRU1QVFkpOwogICAgfQoKICAgIHJldHVybiB0aGlzIDsKICB9LAoKICAvKioKICAg
IFB1c2ggdGhlIG9iamVjdCBvbnRvIHRoZSBlbmQgb2YgdGhlIGFycmF5LiBXb3JrcyBqdXN0IGxp
a2UgYHB1c2goKWAgYnV0IGl0CiAgICBpcyBLVk8tY29tcGxpYW50LgoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIHZhciBjb2xvcnMgPSBbInJlZCIsICJncmVlbiJdOwogICAgY29sb3JzLnB1c2hPYmpl
Y3QoImJsYWNrIik7ICAgICAvLyBbInJlZCIsICJncmVlbiIsICJibGFjayJdCiAgICBjb2xvcnMu
cHVzaE9iamVjdChbInllbGxvdyJdKTsgIC8vIFsicmVkIiwgImdyZWVuIiwgWyJ5ZWxsb3ciXV0K
ICAgIGBgYAoKICAgIEBtZXRob2QgcHVzaE9iamVjdAogICAgQHBhcmFtIHsqfSBvYmogb2JqZWN0
IHRvIHB1c2gKICAgIEByZXR1cm4gVGhlIHNhbWUgb2JqIHBhc3NlZCBhcyBwYXJhbQogICovCiAg
cHVzaE9iamVjdDogZnVuY3Rpb24ob2JqKSB7CiAgICB0aGlzLmluc2VydEF0KGdldCh0aGlzLCAn
bGVuZ3RoJyksIG9iaikgOwogICAgcmV0dXJuIG9iajsKICB9LAoKICAvKioKICAgIEFkZCB0aGUg
b2JqZWN0cyBpbiB0aGUgcGFzc2VkIG51bWVyYWJsZSB0byB0aGUgZW5kIG9mIHRoZSBhcnJheS4g
RGVmZXJzCiAgICBub3RpZnlpbmcgb2JzZXJ2ZXJzIG9mIHRoZSBjaGFuZ2UgdW50aWwgYWxsIG9i
amVjdHMgYXJlIGFkZGVkLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBjb2xvcnMgPSBbInJl
ZCJdOwogICAgY29sb3JzLnB1c2hPYmplY3RzKFsieWVsbG93IiwgIm9yYW5nZSJdKTsgIC8vIFsi
cmVkIiwgInllbGxvdyIsICJvcmFuZ2UiXQogICAgYGBgCgogICAgQG1ldGhvZCBwdXNoT2JqZWN0
cwogICAgQHBhcmFtIHtFbWJlci5FbnVtZXJhYmxlfSBvYmplY3RzIHRoZSBvYmplY3RzIHRvIGFk
ZAogICAgQHJldHVybiB7RW1iZXIuQXJyYXl9IHJlY2VpdmVyCiAgKi8KICBwdXNoT2JqZWN0czog
ZnVuY3Rpb24ob2JqZWN0cykgewogICAgaWYgKCEoRW1iZXIuRW51bWVyYWJsZS5kZXRlY3Qob2Jq
ZWN0cykgfHwgRW1iZXIuaXNBcnJheShvYmplY3RzKSkpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVF
cnJvcigiTXVzdCBwYXNzIEVtYmVyLkVudW1lcmFibGUgdG8gRW1iZXIuTXV0YWJsZUFycmF5I3B1
c2hPYmplY3RzIik7CiAgICB9CiAgICB0aGlzLnJlcGxhY2UoZ2V0KHRoaXMsICdsZW5ndGgnKSwg
MCwgb2JqZWN0cyk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgIFBvcCBvYmplY3Qg
ZnJvbSBhcnJheSBvciBuaWwgaWYgbm9uZSBhcmUgbGVmdC4gV29ya3MganVzdCBsaWtlIGBwb3Ao
KWAgYnV0CiAgICBpdCBpcyBLVk8tY29tcGxpYW50LgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZh
ciBjb2xvcnMgPSBbInJlZCIsICJncmVlbiIsICJibHVlIl07CiAgICBjb2xvcnMucG9wT2JqZWN0
KCk7ICAgLy8gImJsdWUiCiAgICBjb25zb2xlLmxvZyhjb2xvcnMpOyAgLy8gWyJyZWQiLCAiZ3Jl
ZW4iXQogICAgYGBgCgogICAgQG1ldGhvZCBwb3BPYmplY3QKICAgIEByZXR1cm4gb2JqZWN0CiAg
Ki8KICBwb3BPYmplY3Q6IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbiA9IGdldCh0aGlzLCAnbGVu
Z3RoJykgOwogICAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuIG51bGwgOwoKICAgIHZhciByZXQgPSB0
aGlzLm9iamVjdEF0KGxlbi0xKSA7CiAgICB0aGlzLnJlbW92ZUF0KGxlbi0xLCAxKSA7CiAgICBy
ZXR1cm4gcmV0IDsKICB9LAoKICAvKioKICAgIFNoaWZ0IGFuIG9iamVjdCBmcm9tIHN0YXJ0IG9m
IGFycmF5IG9yIG5pbCBpZiBub25lIGFyZSBsZWZ0LiBXb3JrcyBqdXN0CiAgICBsaWtlIGBzaGlm
dCgpYCBidXQgaXQgaXMgS1ZPLWNvbXBsaWFudC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIg
Y29sb3JzID0gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSJdOwogICAgY29sb3JzLnNoaWZ0T2JqZWN0
KCk7ICAvLyAicmVkIgogICAgY29uc29sZS5sb2coY29sb3JzKTsgICAvLyBbImdyZWVuIiwgImJs
dWUiXQogICAgYGBgCgogICAgQG1ldGhvZCBzaGlmdE9iamVjdAogICAgQHJldHVybiBvYmplY3QK
ICAqLwogIHNoaWZ0T2JqZWN0OiBmdW5jdGlvbigpIHsKICAgIGlmIChnZXQodGhpcywgJ2xlbmd0
aCcpID09PSAwKSByZXR1cm4gbnVsbCA7CiAgICB2YXIgcmV0ID0gdGhpcy5vYmplY3RBdCgwKSA7
CiAgICB0aGlzLnJlbW92ZUF0KDApIDsKICAgIHJldHVybiByZXQgOwogIH0sCgogIC8qKgogICAg
VW5zaGlmdCBhbiBvYmplY3QgdG8gc3RhcnQgb2YgYXJyYXkuIFdvcmtzIGp1c3QgbGlrZSBgdW5z
aGlmdCgpYCBidXQgaXQgaXMKICAgIEtWTy1jb21wbGlhbnQuCgogICAgYGBgamF2YXNjcmlwdAog
ICAgdmFyIGNvbG9ycyA9IFsicmVkIl07CiAgICBjb2xvcnMudW5zaGlmdE9iamVjdCgieWVsbG93
Iik7ICAgIC8vIFsieWVsbG93IiwgInJlZCJdCiAgICBjb2xvcnMudW5zaGlmdE9iamVjdChbImJs
YWNrIl0pOyAgIC8vIFtbImJsYWNrIl0sICJ5ZWxsb3ciLCAicmVkIl0KICAgIGBgYAoKICAgIEBt
ZXRob2QgdW5zaGlmdE9iamVjdAogICAgQHBhcmFtIHsqfSBvYmogb2JqZWN0IHRvIHVuc2hpZnQK
ICAgIEByZXR1cm4gVGhlIHNhbWUgb2JqIHBhc3NlZCBhcyBwYXJhbQogICovCiAgdW5zaGlmdE9i
amVjdDogZnVuY3Rpb24ob2JqKSB7CiAgICB0aGlzLmluc2VydEF0KDAsIG9iaikgOwogICAgcmV0
dXJuIG9iaiA7CiAgfSwKCiAgLyoqCiAgICBBZGRzIHRoZSBuYW1lZCBvYmplY3RzIHRvIHRoZSBi
ZWdpbm5pbmcgb2YgdGhlIGFycmF5LiBEZWZlcnMgbm90aWZ5aW5nCiAgICBvYnNlcnZlcnMgdW50
aWwgYWxsIG9iamVjdHMgaGF2ZSBiZWVuIGFkZGVkLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZh
ciBjb2xvcnMgPSBbInJlZCJdOwogICAgY29sb3JzLnVuc2hpZnRPYmplY3RzKFsiYmxhY2siLCAi
d2hpdGUiXSk7ICAgLy8gWyJibGFjayIsICJ3aGl0ZSIsICJyZWQiXQogICAgY29sb3JzLnVuc2hp
ZnRPYmplY3RzKCJ5ZWxsb3ciKTsgLy8gVHlwZSBFcnJvcjogJ3VuZGVmaW5lZCcgaXMgbm90IGEg
ZnVuY3Rpb24KICAgIGBgYAoKICAgIEBtZXRob2QgdW5zaGlmdE9iamVjdHMKICAgIEBwYXJhbSB7
RW1iZXIuRW51bWVyYWJsZX0gb2JqZWN0cyB0aGUgb2JqZWN0cyB0byBhZGQKICAgIEByZXR1cm4g
e0VtYmVyLkFycmF5fSByZWNlaXZlcgogICovCiAgdW5zaGlmdE9iamVjdHM6IGZ1bmN0aW9uKG9i
amVjdHMpIHsKICAgIHRoaXMucmVwbGFjZSgwLCAwLCBvYmplY3RzKTsKICAgIHJldHVybiB0aGlz
OwogIH0sCgogIC8qKgogICAgUmV2ZXJzZSBvYmplY3RzIGluIHRoZSBhcnJheS4gV29ya3MganVz
dCBsaWtlIGByZXZlcnNlKClgIGJ1dCBpdCBpcwogICAgS1ZPLWNvbXBsaWFudC4KCiAgICBAbWV0
aG9kIHJldmVyc2VPYmplY3RzCiAgICBAcmV0dXJuIHtFbWJlci5BcnJheX0gcmVjZWl2ZXIKICAg
Ki8KICByZXZlcnNlT2JqZWN0czogZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuID0gZ2V0KHRoaXMs
ICdsZW5ndGgnKTsKICAgIGlmIChsZW4gPT09IDApIHJldHVybiB0aGlzOwogICAgdmFyIG9iamVj
dHMgPSB0aGlzLnRvQXJyYXkoKS5yZXZlcnNlKCk7CiAgICB0aGlzLnJlcGxhY2UoMCwgbGVuLCBv
YmplY3RzKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgUmVwbGFjZSBhbGwgdGhl
IHRoZSByZWNlaXZlcidzIGNvbnRlbnQgd2l0aCBjb250ZW50IG9mIHRoZSBhcmd1bWVudC4KICAg
IElmIGFyZ3VtZW50IGlzIGFuIGVtcHR5IGFycmF5IHJlY2VpdmVyIHdpbGwgYmUgY2xlYXJlZC4K
CiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgY29sb3JzID0gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1
ZSJdOwogICAgY29sb3JzLnNldE9iamVjdHMoWyJibGFjayIsICJ3aGl0ZSJdKTsgIC8vIFsiYmxh
Y2siLCAid2hpdGUiXQogICAgY29sb3JzLnNldE9iamVjdHMoW10pOyAgICAgICAgICAgICAgICAg
IC8vIFtdCiAgICBgYGAKCiAgICBAbWV0aG9kIHNldE9iamVjdHMKICAgIEBwYXJhbSB7RW1iZXIu
QXJyYXl9IG9iamVjdHMgYXJyYXkgd2hvc2UgY29udGVudCB3aWxsIGJlIHVzZWQgZm9yIHJlcGxh
Y2luZwogICAgICAgIHRoZSBjb250ZW50IG9mIHRoZSByZWNlaXZlcgogICAgQHJldHVybiB7RW1i
ZXIuQXJyYXl9IHJlY2VpdmVyIHdpdGggdGhlIG5ldyBjb250ZW50CiAgICovCiAgc2V0T2JqZWN0
czogZnVuY3Rpb24ob2JqZWN0cykgewogICAgaWYgKG9iamVjdHMubGVuZ3RoID09PSAwKSByZXR1
cm4gdGhpcy5jbGVhcigpOwoKICAgIHZhciBsZW4gPSBnZXQodGhpcywgJ2xlbmd0aCcpOwogICAg
dGhpcy5yZXBsYWNlKDAsIGxlbiwgb2JqZWN0cyk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAv
LyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uCiAgLy8gSU1QTEVNRU5UIEVtYmVyLk11dGFibGVFbnVtZXJhYmxlCiAgLy8KCiAgcmVtb3Zl
T2JqZWN0OiBmdW5jdGlvbihvYmopIHsKICAgIHZhciBsb2MgPSBnZXQodGhpcywgJ2xlbmd0aCcp
IHx8IDA7CiAgICB3aGlsZSgtLWxvYyA+PSAwKSB7CiAgICAgIHZhciBjdXJPYmplY3QgPSB0aGlz
Lm9iamVjdEF0KGxvYykgOwogICAgICBpZiAoY3VyT2JqZWN0ID09PSBvYmopIHRoaXMucmVtb3Zl
QXQobG9jKSA7CiAgICB9CiAgICByZXR1cm4gdGhpcyA7CiAgfSwKCiAgYWRkT2JqZWN0OiBmdW5j
dGlvbihvYmopIHsKICAgIGlmICghdGhpcy5jb250YWlucyhvYmopKSB0aGlzLnB1c2hPYmplY3Qo
b2JqKTsKICAgIHJldHVybiB0aGlzIDsKICB9Cgp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsK
LyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgZ2V0ID0g
RW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CgovKioKYEVtYmVyLlRhcmdldEFjdGlvblN1cHBv
cnRgIGlzIGEgbWl4aW4gdGhhdCBjYW4gYmUgaW5jbHVkZWQgaW4gYSBjbGFzcwp0byBhZGQgYSBg
dHJpZ2dlckFjdGlvbmAgbWV0aG9kIHdpdGggc2VtYW50aWNzIHNpbWlsYXIgdG8gdGhlIEhhbmRs
ZWJhcnMKYHt7YWN0aW9ufX1gIGhlbHBlci4gSW4gbm9ybWFsIEVtYmVyIHVzYWdlLCB0aGUgYHt7
YWN0aW9ufX1gIGhlbHBlciBpcwp1c3VhbGx5IHRoZSBiZXN0IGNob2ljZS4gVGhpcyBtaXhpbiBp
cyBtb3N0IG9mdGVuIHVzZWZ1bCB3aGVuIHlvdSBhcmUKZG9pbmcgbW9yZSBjb21wbGV4IGV2ZW50
IGhhbmRsaW5nIGluIFZpZXcgb2JqZWN0cy4KClNlZSBhbHNvIGBFbWJlci5WaWV3VGFyZ2V0QWN0
aW9uU3VwcG9ydGAsIHdoaWNoIGhhcwp2aWV3LWF3YXJlIGRlZmF1bHRzIGZvciB0YXJnZXQgYW5k
IGFjdGlvbkNvbnRleHQuCgpAY2xhc3MgVGFyZ2V0QWN0aW9uU3VwcG9ydApAbmFtZXNwYWNlIEVt
YmVyCkBleHRlbmRzIEVtYmVyLk1peGluCiovCkVtYmVyLlRhcmdldEFjdGlvblN1cHBvcnQgPSBF
bWJlci5NaXhpbi5jcmVhdGUoewogIHRhcmdldDogbnVsbCwKICBhY3Rpb246IG51bGwsCiAgYWN0
aW9uQ29udGV4dDogbnVsbCwKCiAgdGFyZ2V0T2JqZWN0OiBFbWJlci5jb21wdXRlZChmdW5jdGlv
bigpIHsKICAgIHZhciB0YXJnZXQgPSBnZXQodGhpcywgJ3RhcmdldCcpOwoKICAgIGlmIChFbWJl
ci50eXBlT2YodGFyZ2V0KSA9PT0gInN0cmluZyIpIHsKICAgICAgdmFyIHZhbHVlID0gZ2V0KHRo
aXMsIHRhcmdldCk7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7IHZhbHVlID0gZ2V0
KEVtYmVyLmxvb2t1cCwgdGFyZ2V0KTsgfQogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2Ug
ewogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogIH0pLnByb3BlcnR5KCd0YXJnZXQnKSwKCiAg
YWN0aW9uQ29udGV4dE9iamVjdDogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICB2YXIg
YWN0aW9uQ29udGV4dCA9IGdldCh0aGlzLCAnYWN0aW9uQ29udGV4dCcpOwoKICAgIGlmIChFbWJl
ci50eXBlT2YoYWN0aW9uQ29udGV4dCkgPT09ICJzdHJpbmciKSB7CiAgICAgIHZhciB2YWx1ZSA9
IGdldCh0aGlzLCBhY3Rpb25Db250ZXh0KTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQp
IHsgdmFsdWUgPSBnZXQoRW1iZXIubG9va3VwLCBhY3Rpb25Db250ZXh0KTsgfQogICAgICByZXR1
cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYWN0aW9uQ29udGV4dDsKICAgIH0K
ICB9KS5wcm9wZXJ0eSgnYWN0aW9uQ29udGV4dCcpLAoKICAvKioKICBTZW5kIGFuICJhY3Rpb24i
IHdpdGggYW4gImFjdGlvbkNvbnRleHQiIHRvIGEgInRhcmdldCIuIFRoZSBhY3Rpb24sIGFjdGlv
bkNvbnRleHQKICBhbmQgdGFyZ2V0IHdpbGwgYmUgcmV0cmlldmVkIGZyb20gcHJvcGVydGllcyBv
ZiB0aGUgb2JqZWN0LiBGb3IgZXhhbXBsZToKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5TYXZlQnV0
dG9uVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKEVtYmVyLlRhcmdldEFjdGlvblN1cHBvcnQsIHsK
ICAgIHRhcmdldDogRW1iZXIuY29tcHV0ZWQuYWxpYXMoJ2NvbnRyb2xsZXInKSwKICAgIGFjdGlv
bjogJ3NhdmUnLAogICAgYWN0aW9uQ29udGV4dDogRW1iZXIuY29tcHV0ZWQuYWxpYXMoJ2NvbnRl
eHQnKSwKICAgIGNsaWNrOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50cmlnZ2VyQWN0aW9uKCk7
IC8vIFNlbmRzIHRoZSBgc2F2ZWAgYWN0aW9uLCBhbG9uZyB3aXRoIHRoZSBjdXJyZW50IGNvbnRl
eHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIHRoZSBjdXJyZW50IGNvbnRyb2xs
ZXIKICAgIH0KICB9KTsKICBgYGAKCiAgVGhlIGB0YXJnZXRgLCBgYWN0aW9uYCwgYW5kIGBhY3Rp
b25Db250ZXh0YCBjYW4gYmUgcHJvdmlkZWQgYXMgcHJvcGVydGllcyBvZgogIGFuIG9wdGlvbmFs
IG9iamVjdCBhcmd1bWVudCB0byBgdHJpZ2dlckFjdGlvbmAgYXMgd2VsbC4KCiAgYGBgamF2YXNj
cmlwdAogIEFwcC5TYXZlQnV0dG9uVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKEVtYmVyLlRhcmdl
dEFjdGlvblN1cHBvcnQsIHsKICAgIGNsaWNrOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50cmln
Z2VyQWN0aW9uKHsKICAgICAgICBhY3Rpb246ICdzYXZlJywKICAgICAgICB0YXJnZXQ6IHRoaXMu
Z2V0KCdjb250cm9sbGVyJyksCiAgICAgICAgYWN0aW9uQ29udGV4dDogdGhpcy5nZXQoJ2NvbnRl
eHQnKSwKICAgICAgfSk7IC8vIFNlbmRzIHRoZSBgc2F2ZWAgYWN0aW9uLCBhbG9uZyB3aXRoIHRo
ZSBjdXJyZW50IGNvbnRleHQKICAgICAgICAgIC8vIHRvIHRoZSBjdXJyZW50IGNvbnRyb2xsZXIK
ICAgIH0KICB9KTsKICBgYGAKCiAgVGhlIGBhY3Rpb25Db250ZXh0YCBkZWZhdWx0cyB0byB0aGUg
b2JqZWN0IHlvdSBtaXhpbmcgYFRhcmdldEFjdGlvblN1cHBvcnRgIGludG8uCiAgQnV0IGB0YXJn
ZXRgIGFuZCBgYWN0aW9uYCBtdXN0IGJlIHNwZWNpZmllZCBlaXRoZXIgYXMgcHJvcGVydGllcyBv
ciB3aXRoIHRoZSBhcmd1bWVudAogIHRvIGB0cmlnZ2VyQWN0aW9uYCwgb3IgYSBjb21iaW5hdGlv
bjoKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5TYXZlQnV0dG9uVmlldyA9IEVtYmVyLlZpZXcuZXh0
ZW5kKEVtYmVyLlRhcmdldEFjdGlvblN1cHBvcnQsIHsKICAgIHRhcmdldDogRW1iZXIuY29tcHV0
ZWQuYWxpYXMoJ2NvbnRyb2xsZXInKSwKICAgIGNsaWNrOiBmdW5jdGlvbigpIHsKICAgICAgdGhp
cy50cmlnZ2VyQWN0aW9uKHsKICAgICAgICBhY3Rpb246ICdzYXZlJwogICAgICB9KTsgLy8gU2Vu
ZHMgdGhlIGBzYXZlYCBhY3Rpb24sIGFsb25nIHdpdGggYSByZWZlcmVuY2UgdG8gYHRoaXNgLAog
ICAgICAgICAgLy8gdG8gdGhlIGN1cnJlbnQgY29udHJvbGxlcgogICAgfQogIH0pOwogIGBgYAoK
ICBAbWV0aG9kIHRyaWdnZXJBY3Rpb24KICBAcGFyYW0gb3B0cyB7SGFzaH0gKG9wdGlvbmFsLCB3
aXRoIHRoZSBvcHRpb25hbCBrZXlzIGFjdGlvbiwgdGFyZ2V0IGFuZC9vciBhY3Rpb25Db250ZXh0
KQogIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIGFjdGlvbiB3YXMgc2VudCBzdWNjZXNz
ZnVsbHkgYW5kIGRpZCBub3QgcmV0dXJuIGZhbHNlCiAgKi8KICB0cmlnZ2VyQWN0aW9uOiBmdW5j
dGlvbihvcHRzKSB7CiAgICBvcHRzID0gb3B0cyB8fCB7fTsKICAgIHZhciBhY3Rpb24gPSBvcHRz
LmFjdGlvbiB8fCBnZXQodGhpcywgJ2FjdGlvbicpLAogICAgICAgIHRhcmdldCA9IG9wdHMudGFy
Z2V0IHx8IGdldCh0aGlzLCAndGFyZ2V0T2JqZWN0JyksCiAgICAgICAgYWN0aW9uQ29udGV4dCA9
IG9wdHMuYWN0aW9uQ29udGV4dDsKCiAgICBmdW5jdGlvbiBhcmdzKG9wdGlvbnMsIGFjdGlvbk5h
bWUpIHsKICAgICAgdmFyIHJldCA9IFtdOwogICAgICBpZiAoYWN0aW9uTmFtZSkgeyByZXQucHVz
aChhY3Rpb25OYW1lKTsgfQoKICAgICAgcmV0dXJuIHJldC5jb25jYXQob3B0aW9ucyk7CiAgICB9
CgogICAgaWYgKHR5cGVvZiBhY3Rpb25Db250ZXh0ID09PSAndW5kZWZpbmVkJykgewogICAgICBh
Y3Rpb25Db250ZXh0ID0gZ2V0KHRoaXMsICdhY3Rpb25Db250ZXh0T2JqZWN0JykgfHwgdGhpczsK
ICAgIH0KCiAgICBpZiAodGFyZ2V0ICYmIGFjdGlvbikgewogICAgICB2YXIgcmV0OwoKICAgICAg
aWYgKHRhcmdldC5zZW5kKSB7CiAgICAgICAgcmV0ID0gdGFyZ2V0LnNlbmQuYXBwbHkodGFyZ2V0
LCBhcmdzKGFjdGlvbkNvbnRleHQsIGFjdGlvbikpOwogICAgICB9IGVsc2UgewogICAgICAgIEVt
YmVyLmFzc2VydCgiVGhlIGFjdGlvbiAnIiArIGFjdGlvbiArICInIGRpZCBub3QgZXhpc3Qgb24g
IiArIHRhcmdldCwgdHlwZW9mIHRhcmdldFthY3Rpb25dID09PSAnZnVuY3Rpb24nKTsKICAgICAg
ICByZXQgPSB0YXJnZXRbYWN0aW9uXS5hcHBseSh0YXJnZXQsIGFyZ3MoYWN0aW9uQ29udGV4dCkp
OwogICAgICB9CgogICAgICBpZiAocmV0ICE9PSBmYWxzZSkgcmV0ID0gdHJ1ZTsKCiAgICAgIHJl
dHVybiByZXQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQp9KTsK
Cn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJl
ci1ydW50aW1lCiovCgovKioKICBUaGlzIG1peGluIGFsbG93cyBmb3IgRW1iZXIgb2JqZWN0cyB0
byBzdWJzY3JpYmUgdG8gYW5kIGVtaXQgZXZlbnRzLgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLlBl
cnNvbiA9IEVtYmVyLk9iamVjdC5leHRlbmQoRW1iZXIuRXZlbnRlZCwgewogICAgZ3JlZXQ6IGZ1
bmN0aW9uKCkgewogICAgICAvLyAuLi4KICAgICAgdGhpcy50cmlnZ2VyKCdncmVldCcpOwogICAg
fQogIH0pOwoKICB2YXIgcGVyc29uID0gQXBwLlBlcnNvbi5jcmVhdGUoKTsKCiAgcGVyc29uLm9u
KCdncmVldCcsIGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5sb2coJ091ciBwZXJzb24gaGFzIGdy
ZWV0ZWQnKTsKICB9KTsKCiAgcGVyc29uLmdyZWV0KCk7CgogIC8vIG91dHB1dHM6ICdPdXIgcGVy
c29uIGhhcyBncmVldGVkJwogIGBgYAoKICBZb3UgY2FuIGFsc28gY2hhaW4gbXVsdGlwbGUgZXZl
bnQgc3Vic2NyaXB0aW9uczoKCiAgYGBgamF2YXNjcmlwdAogIHBlcnNvbi5vbignZ3JlZXQnLCBm
dW5jdGlvbigpIHsKICAgIGNvbnNvbGUubG9nKCdPdXIgcGVyc29uIGhhcyBncmVldGVkJyk7CiAg
fSkub25lKCdncmVldCcsIGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5sb2coJ09mZmVyIG9uZS10
aW1lIHNwZWNpYWwnKTsKICB9KS5vZmYoJ2V2ZW50JywgdGhpcywgZm9yZ2V0VGhpcyk7CiAgYGBg
CgogIEBjbGFzcyBFdmVudGVkCiAgQG5hbWVzcGFjZSBFbWJlcgogKi8KRW1iZXIuRXZlbnRlZCA9
IEVtYmVyLk1peGluLmNyZWF0ZSh7CgogIC8qKgogICBTdWJzY3JpYmVzIHRvIGEgbmFtZWQgZXZl
bnQgd2l0aCBnaXZlbiBmdW5jdGlvbi4KCiAgIGBgYGphdmFzY3JpcHQKICAgcGVyc29uLm9uKCdk
aWRMb2FkJywgZnVuY3Rpb24oKSB7CiAgICAgLy8gZmlyZWQgb25jZSB0aGUgcGVyc29uIGhhcyBs
b2FkZWQKICAgfSk7CiAgIGBgYAoKICAgQW4gb3B0aW9uYWwgdGFyZ2V0IGNhbiBiZSBwYXNzZWQg
aW4gYXMgdGhlIDJuZCBhcmd1bWVudCB0aGF0IHdpbGwKICAgYmUgc2V0IGFzIHRoZSAidGhpcyIg
Zm9yIHRoZSBjYWxsYmFjay4gVGhpcyBpcyBhIGdvb2Qgd2F5IHRvIGdpdmUgeW91cgogICBmdW5j
dGlvbiBhY2Nlc3MgdG8gdGhlIG9iamVjdCB0cmlnZ2VyaW5nIHRoZSBldmVudC4gV2hlbiB0aGUg
dGFyZ2V0CiAgIHBhcmFtZXRlciBpcyB1c2VkIHRoZSBjYWxsYmFjayBiZWNvbWVzIHRoZSB0aGly
ZCBhcmd1bWVudC4KCiAgIEBtZXRob2Qgb24KICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5h
bWUgb2YgdGhlIGV2ZW50CiAgIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSBUaGUgInRoaXMiIGJp
bmRpbmcgZm9yIHRoZSBjYWxsYmFjawogICBAcGFyYW0ge0Z1bmN0aW9ufSBtZXRob2QgVGhlIGNh
bGxiYWNrIHRvIGV4ZWN1dGUKICAgQHJldHVybiB0aGlzCiAgKi8KICBvbjogZnVuY3Rpb24obmFt
ZSwgdGFyZ2V0LCBtZXRob2QpIHsKICAgIEVtYmVyLmFkZExpc3RlbmVyKHRoaXMsIG5hbWUsIHRh
cmdldCwgbWV0aG9kKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgU3Vic2NyaWJl
cyBhIGZ1bmN0aW9uIHRvIGEgbmFtZWQgZXZlbnQgYW5kIHRoZW4gY2FuY2VscyB0aGUgc3Vic2Ny
aXB0aW9uCiAgICBhZnRlciB0aGUgZmlyc3QgdGltZSB0aGUgZXZlbnQgaXMgdHJpZ2dlcmVkLiBJ
dCBpcyBnb29kIHRvIHVzZSBgYG9uZWBgIHdoZW4KICAgIHlvdSBvbmx5IGNhcmUgYWJvdXQgdGhl
IGZpcnN0IHRpbWUgYW4gZXZlbnQgaGFzIHRha2VuIHBsYWNlLgoKICAgIFRoaXMgZnVuY3Rpb24g
dGFrZXMgYW4gb3B0aW9uYWwgMm5kIGFyZ3VtZW50IHRoYXQgd2lsbCBiZWNvbWUgdGhlICJ0aGlz
IgogICAgdmFsdWUgZm9yIHRoZSBjYWxsYmFjay4gSWYgdGhpcyBhcmd1bWVudCBpcyBwYXNzZWQg
dGhlbiB0aGUgM3JkIGFyZ3VtZW50CiAgICBiZWNvbWVzIHRoZSBmdW5jdGlvbi4KCiAgICBAbWV0
aG9kIG9uZQogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGV2ZW50CiAg
ICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlICJ0aGlzIiBiaW5kaW5nIGZvciB0aGUgY2Fs
bGJhY2sKICAgIEBwYXJhbSB7RnVuY3Rpb259IG1ldGhvZCBUaGUgY2FsbGJhY2sgdG8gZXhlY3V0
ZQogICAgQHJldHVybiB0aGlzCiAgKi8KICBvbmU6IGZ1bmN0aW9uKG5hbWUsIHRhcmdldCwgbWV0
aG9kKSB7CiAgICBpZiAoIW1ldGhvZCkgewogICAgICBtZXRob2QgPSB0YXJnZXQ7CiAgICAgIHRh
cmdldCA9IG51bGw7CiAgICB9CgogICAgRW1iZXIuYWRkTGlzdGVuZXIodGhpcywgbmFtZSwgdGFy
Z2V0LCBtZXRob2QsIHRydWUpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBUcmln
Z2VycyBhIG5hbWVkIGV2ZW50IGZvciB0aGUgb2JqZWN0LiBBbnkgYWRkaXRpb25hbCBhcmd1bWVu
dHMKICAgIHdpbGwgYmUgcGFzc2VkIGFzIHBhcmFtZXRlcnMgdG8gdGhlIGZ1bmN0aW9ucyB0aGF0
IGFyZSBzdWJzY3JpYmVkIHRvIHRoZQogICAgZXZlbnQuCgogICAgYGBgamF2YXNjcmlwdAogICAg
cGVyc29uLm9uKCdkaWRFYXQnLCBmdW5jdGlvbihmb29kKSB7CiAgICAgIGNvbnNvbGUubG9nKCdw
ZXJzb24gYXRlIHNvbWUgJyArIGZvb2QpOwogICAgfSk7CgogICAgcGVyc29uLnRyaWdnZXIoJ2Rp
ZEVhdCcsICdicm9jY29saScpOwoKICAgIC8vIG91dHB1dHM6IHBlcnNvbiBhdGUgc29tZSBicm9j
Y29saQogICAgYGBgCiAgICBAbWV0aG9kIHRyaWdnZXIKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1l
IFRoZSBuYW1lIG9mIHRoZSBldmVudAogICAgQHBhcmFtIHtPYmplY3QuLi59IGFyZ3MgT3B0aW9u
YWwgYXJndW1lbnRzIHRvIHBhc3Mgb24KICAqLwogIHRyaWdnZXI6IGZ1bmN0aW9uKG5hbWUpIHsK
ICAgIHZhciBhcmdzID0gW10sIGksIGw7CiAgICBmb3IgKGkgPSAxLCBsID0gYXJndW1lbnRzLmxl
bmd0aDsgaSA8IGw7IGkrKykgewogICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKICAgIH0K
ICAgIEVtYmVyLnNlbmRFdmVudCh0aGlzLCBuYW1lLCBhcmdzKTsKICB9LAoKICAvKioKICAgIENh
bmNlbHMgc3Vic2NyaXB0aW9uIGZvciBnaXZlbiBuYW1lLCB0YXJnZXQsIGFuZCBtZXRob2QuCgog
ICAgQG1ldGhvZCBvZmYKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBl
dmVudAogICAgQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgdGFyZ2V0IG9mIHRoZSBzdWJzY3Jp
cHRpb24KICAgIEBwYXJhbSB7RnVuY3Rpb259IG1ldGhvZCBUaGUgZnVuY3Rpb24gb2YgdGhlIHN1
YnNjcmlwdGlvbgogICAgQHJldHVybiB0aGlzCiAgKi8KICBvZmY6IGZ1bmN0aW9uKG5hbWUsIHRh
cmdldCwgbWV0aG9kKSB7CiAgICBFbWJlci5yZW1vdmVMaXN0ZW5lcih0aGlzLCBuYW1lLCB0YXJn
ZXQsIG1ldGhvZCk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgIENoZWNrcyB0byBz
ZWUgaWYgb2JqZWN0IGhhcyBhbnkgc3Vic2NyaXB0aW9ucyBmb3IgbmFtZWQgZXZlbnQuCgogICAg
QG1ldGhvZCBoYXMKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBldmVu
dAogICAgQHJldHVybiB7Qm9vbGVhbn0gZG9lcyB0aGUgb2JqZWN0IGhhdmUgYSBzdWJzY3JpcHRp
b24gZm9yIGV2ZW50CiAgICovCiAgaGFzOiBmdW5jdGlvbihuYW1lKSB7CiAgICByZXR1cm4gRW1i
ZXIuaGFzTGlzdGVuZXJzKHRoaXMsIG5hbWUpOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7CnZhciBSU1ZQID0gcmVxdWlyZU1vZHVsZSgicnN2cCIpOwoKUlNWUC5jb25maWd1cmUoJ2Fz
eW5jJywgZnVuY3Rpb24oY2FsbGJhY2ssIHByb21pc2UpIHsKICBFbWJlci5ydW4uc2NoZWR1bGUo
J2FjdGlvbnMnLCBwcm9taXNlLCBjYWxsYmFjaywgcHJvbWlzZSk7Cn0pOwoKUlNWUC5Qcm9taXNl
LnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24oY2FsbGJhY2ssIGxhYmVsKXsKICBFbWJlci5kZXBy
ZWNhdGUoJ1JTVlAuUHJvbWlzZS5mYWlsIGhhcyBiZWVuIHJlbmFtZWQgYXMgUlNWUC5Qcm9taXNl
LmNhdGNoJyk7CiAgcmV0dXJuIHRoaXNbJ2NhdGNoJ10oY2FsbGJhY2ssIGxhYmVsKTsKfTsKCi8q
KgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVudGltZQoqLwoKdmFyIGdldCA9IEVt
YmVyLmdldDsKCi8qKgogIEBjbGFzcyBEZWZlcnJlZAogIEBuYW1lc3BhY2UgRW1iZXIKICovCkVt
YmVyLkRlZmVycmVkTWl4aW4gPSBFbWJlci5NaXhpbi5jcmVhdGUoewogIC8qKgogICAgQWRkIGhh
bmRsZXJzIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBEZWZlcnJlZCBvYmplY3QgaXMgcmVzb2x2ZWQg
b3IgcmVqZWN0ZWQuCgogICAgQG1ldGhvZCB0aGVuCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSByZXNv
bHZlIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gZG9uZQogICAgQHBhcmFt
IHtGdW5jdGlvbn0gcmVqZWN0ICBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVu
IGZhaWxlZAogICovCiAgdGhlbjogZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0LCBsYWJlbCkgewog
ICAgdmFyIGRlZmVycmVkLCBwcm9taXNlLCBlbnRpdHk7CgogICAgZW50aXR5ID0gdGhpczsKICAg
IGRlZmVycmVkID0gZ2V0KHRoaXMsICdfZGVmZXJyZWQnKTsKICAgIHByb21pc2UgPSBkZWZlcnJl
ZC5wcm9taXNlOwoKICAgIGZ1bmN0aW9uIGZ1bGZpbGxtZW50SGFuZGxlcihmdWxmaWxsbWVudCkg
ewogICAgICBpZiAoZnVsZmlsbG1lbnQgPT09IHByb21pc2UpIHsKICAgICAgICByZXR1cm4gcmVz
b2x2ZShlbnRpdHkpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiByZXNvbHZlKGZ1bGZp
bGxtZW50KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBwcm9taXNlLnRoZW4ocmVzb2x2ZSAm
JiBmdWxmaWxsbWVudEhhbmRsZXIsIHJlamVjdCwgbGFiZWwpOwogIH0sCgogIC8qKgogICAgUmVz
b2x2ZSBhIERlZmVycmVkIG9iamVjdCBhbmQgY2FsbCBhbnkgYGRvbmVDYWxsYmFja3NgIHdpdGgg
dGhlIGdpdmVuIGFyZ3MuCgogICAgQG1ldGhvZCByZXNvbHZlCiAgKi8KICByZXNvbHZlOiBmdW5j
dGlvbih2YWx1ZSkgewogICAgdmFyIGRlZmVycmVkLCBwcm9taXNlOwoKICAgIGRlZmVycmVkID0g
Z2V0KHRoaXMsICdfZGVmZXJyZWQnKTsKICAgIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlOwoK
ICAgIGlmICh2YWx1ZSA9PT0gdGhpcykgewogICAgICBkZWZlcnJlZC5yZXNvbHZlKHByb21pc2Up
OwogICAgfSBlbHNlIHsKICAgICAgZGVmZXJyZWQucmVzb2x2ZSh2YWx1ZSk7CiAgICB9CiAgfSwK
CiAgLyoqCiAgICBSZWplY3QgYSBEZWZlcnJlZCBvYmplY3QgYW5kIGNhbGwgYW55IGBmYWlsQ2Fs
bGJhY2tzYCB3aXRoIHRoZSBnaXZlbiBhcmdzLgoKICAgIEBtZXRob2QgcmVqZWN0CiAgKi8KICBy
ZWplY3Q6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBnZXQodGhpcywgJ19kZWZlcnJlZCcpLnJlamVj
dCh2YWx1ZSk7CiAgfSwKCiAgX2RlZmVycmVkOiBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsK
ICAgIHJldHVybiBSU1ZQLmRlZmVyKCdFbWJlcjogRGVmZXJyZWRNaXhpbiAtICcgKyB0aGlzKTsK
ICB9KQp9KTsKCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJt
b2R1bGUgZW1iZXItcnVudGltZQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgdHlwZU9mID0gRW1i
ZXIudHlwZU9mOwoKLyoqCiAgVGhlIGBFbWJlci5BY3Rpb25IYW5kbGVyYCBtaXhpbiBpbXBsZW1l
bnRzIHN1cHBvcnQgZm9yIG1vdmluZyBhbiBgYWN0aW9uc2AKICBwcm9wZXJ0eSB0byBhbiBgX2Fj
dGlvbnNgIHByb3BlcnR5IGF0IGV4dGVuZCB0aW1lLCBhbmQgYWRkaW5nIGBfYWN0aW9uc2AKICB0
byB0aGUgb2JqZWN0J3MgbWVyZ2VkUHJvcGVydGllcyBsaXN0LgoKICBgRW1iZXIuQWN0aW9uSGFu
ZGxlcmAgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IEVtYmVyIGluICBgRW1iZXIuVmlld2AsCiAgYEVt
YmVyLkNvbnRyb2xsZXJgLCBhbmQgYEVtYmVyLlJvdXRlYC4KCiAgQGNsYXNzIEFjdGlvbkhhbmRs
ZXIKICBAbmFtZXNwYWNlIEVtYmVyCiovCkVtYmVyLkFjdGlvbkhhbmRsZXIgPSBFbWJlci5NaXhp
bi5jcmVhdGUoewogIG1lcmdlZFByb3BlcnRpZXM6IFsnX2FjdGlvbnMnXSwKCiAgLyoqCiAgICBU
aGUgY29sbGVjdGlvbiBvZiBmdW5jdGlvbnMsIGtleWVkIGJ5IG5hbWUsIGF2YWlsYWJsZSBvbiB0
aGlzCiAgICBgQWN0aW9uSGFuZGxlcmAgYXMgYWN0aW9uIHRhcmdldHMuCgogICAgVGhlc2UgZnVu
Y3Rpb25zIHdpbGwgYmUgaW52b2tlZCB3aGVuIGEgbWF0Y2hpbmcgYHt7YWN0aW9ufX1gIGlzIHRy
aWdnZXJlZAogICAgZnJvbSB3aXRoaW4gYSB0ZW1wbGF0ZSBhbmQgdGhlIGFwcGxpY2F0aW9uJ3Mg
Y3VycmVudCByb3V0ZSBpcyB0aGlzIHJvdXRlLgoKICAgIEFjdGlvbnMgY2FuIGFsc28gYmUgaW52
b2tlZCBmcm9tIG90aGVyIHBhcnRzIG9mIHlvdXIgYXBwbGljYXRpb24KICAgIHZpYSBgQWN0aW9u
SGFuZGxlciNzZW5kYC4KCiAgICBUaGUgYGFjdGlvbnNgIGhhc2ggd2lsbCBpbmhlcml0IGFjdGlv
biBoYW5kbGVycyBmcm9tCiAgICB0aGUgYGFjdGlvbnNgIGhhc2ggZGVmaW5lZCBvbiBleHRlbmRl
ZCBwYXJlbnQgY2xhc3NlcwogICAgb3IgbWl4aW5zIHJhdGhlciB0aGFuIGp1c3QgcmVwbGFjZSB0
aGUgZW50aXJlIGhhc2gsIGUuZy46CgogICAgYGBganMKICAgIEFwcC5DYW5EaXNwbGF5QmFubmVy
ID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgYWN0aW9uczogewogICAgICAgIGRpc3BsYXlC
YW5uZXI6IGZ1bmN0aW9uKG1zZykgewogICAgICAgICAgLy8gLi4uCiAgICAgICAgfQogICAgICB9
CiAgICB9KTsKCiAgICBBcHAuV2VsY29tZVJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKEFwcC5D
YW5EaXNwbGF5QmFubmVyLCB7CiAgICAgIGFjdGlvbnM6IHsKICAgICAgICBwbGF5TXVzaWM6IGZ1
bmN0aW9uKCkgewogICAgICAgICAgLy8gLi4uCiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAg
ICAvLyBgV2VsY29tZVJvdXRlYCwgd2hlbiBhY3RpdmUsIHdpbGwgYmUgYWJsZSB0byByZXNwb25k
CiAgICAvLyB0byBib3RoIGFjdGlvbnMsIHNpbmNlIHRoZSBhY3Rpb25zIGhhc2ggaXMgbWVyZ2Vk
IHJhdGhlcgogICAgLy8gdGhlbiByZXBsYWNlZCB3aGVuIGV4dGVuZGluZyBtaXhpbnMgLyBwYXJl
bnQgY2xhc3Nlcy4KICAgIHRoaXMuc2VuZCgnZGlzcGxheUJhbm5lcicpOwogICAgdGhpcy5zZW5k
KCdwbGF5TXVzaWMnKTsKICAgIGBgYAoKICAgIFdpdGhpbiBhIENvbnRyb2xsZXIsIFJvdXRlLCBW
aWV3IG9yIENvbXBvbmVudCdzIGFjdGlvbiBoYW5kbGVyLAogICAgdGhlIHZhbHVlIG9mIHRoZSBg
dGhpc2AgY29udGV4dCBpcyB0aGUgQ29udHJvbGxlciwgUm91dGUsIFZpZXcgb3IKICAgIENvbXBv
bmVudCBvYmplY3Q6CgogICAgYGBganMKICAgIEFwcC5Tb25nUm91dGUgPSBFbWJlci5Sb3V0ZS5l
eHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgbXlBY3Rpb246IGZ1bmN0aW9uKCkgewog
ICAgICAgICAgdGhpcy5jb250cm9sbGVyRm9yKCJzb25nIik7CiAgICAgICAgICB0aGlzLnRyYW5z
aXRpb25Ubygib3RoZXIucm91dGUiKTsKICAgICAgICAgIC4uLgogICAgICAgIH0KICAgICAgfQog
ICAgfSk7CiAgICBgYGAKCiAgICBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIGNhbGwgYHRoaXMuX3N1
cGVyKClgIGZyb20gd2l0aGluIGFuCiAgICBhY3Rpb24gaGFuZGxlciBpZiBpdCBvdmVycmlkZXMg
YSBoYW5kbGVyIGRlZmluZWQgb24gYSBwYXJlbnQKICAgIGNsYXNzIG9yIG1peGluOgoKICAgIFRh
a2UgZm9yIGV4YW1wbGUgdGhlIGZvbGxvd2luZyByb3V0ZXM6CgogICAgYGBganMKICAgIEFwcC5E
ZWJ1Z1JvdXRlID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgYWN0aW9uczogewogICAgICAg
IGRlYnVnUm91dGVJbmZvcm1hdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBjb25zb2xlLmRl
YnVnKCJ0cm9sb2xvIik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBBcHAuQW5ub3lp
bmdEZWJ1Z1JvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKEFwcC5EZWJ1Z1JvdXRlLCB7CiAgICAg
IGFjdGlvbnM6IHsKICAgICAgICBkZWJ1Z1JvdXRlSW5mb3JtYXRpb246IGZ1bmN0aW9uKCkgewog
ICAgICAgICAgLy8gYWxzbyBjYWxsIHRoZSBkZWJ1Z1JvdXRlSW5mb3JtYXRpb24gb2YgbWl4ZWQg
aW4gQXBwLkRlYnVnUm91dGUKICAgICAgICAgIHRoaXMuX3N1cGVyKCk7CgogICAgICAgICAgLy8g
c2hvdyBhZGRpdGlvbmFsIGFubm95YW5jZQogICAgICAgICAgd2luZG93LmFsZXJ0KC4uLik7CiAg
ICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgICMjIEJ1YmJsaW5nCgogICAgQnkg
ZGVmYXVsdCwgYW4gYWN0aW9uIHdpbGwgc3RvcCBidWJibGluZyBvbmNlIGEgaGFuZGxlciBkZWZp
bmVkCiAgICBvbiB0aGUgYGFjdGlvbnNgIGhhc2ggaGFuZGxlcyBpdC4gVG8gY29udGludWUgYnVi
YmxpbmcgdGhlIGFjdGlvbiwKICAgIHlvdSBtdXN0IHJldHVybiBgdHJ1ZWAgZnJvbSB0aGUgaGFu
ZGxlcjoKCiAgICBgYGBqcwogICAgQXBwLlJvdXRlci5tYXAoZnVuY3Rpb24oKSB7CiAgICAgIHRo
aXMucmVzb3VyY2UoImFsYnVtIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5yb3V0ZSgic29u
ZyIpOwogICAgICB9KTsKICAgIH0pOwoKICAgIEFwcC5BbGJ1bVJvdXRlID0gRW1iZXIuUm91dGUu
ZXh0ZW5kKHsKICAgICAgYWN0aW9uczogewogICAgICAgIHN0YXJ0UGxheWluZzogZnVuY3Rpb24o
KSB7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBBcHAuQWxidW1Tb25nUm91dGUgPSBF
bWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgc3RhcnRQbGF5aW5n
OiBmdW5jdGlvbigpIHsKICAgICAgICAgIC8vIC4uLgoKICAgICAgICAgIGlmIChhY3Rpb25TaG91
bGRBbHNvQmVUcmlnZ2VyZWRPblBhcmVudFJvdXRlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVl
OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAcHJv
cGVydHkgYWN0aW9ucwogICAgQHR5cGUgSGFzaAogICAgQGRlZmF1bHQgbnVsbAogICovCgogIC8q
KgogICAgTW92ZXMgYGFjdGlvbnNgIHRvIGBfYWN0aW9uc2AgYXQgZXh0ZW5kIHRpbWUuIE5vdGUg
dGhhdCB0aGlzIGN1cnJlbnRseQogICAgbW9kaWZpZXMgdGhlIG1peGluIHRoZW1zZWx2ZXMsIHdo
aWNoIGlzIHRlY2huaWNhbGx5IGR1YmlvdXMgYnV0CiAgICBpcyBwcmFjdGljYWxseSBvZiBsaXR0
bGUgY29uc2VxdWVuY2UuIFRoaXMgbWF5IGNoYW5nZSBpbiB0aGUgZnV0dXJlLgoKICAgIEBwcml2
YXRlCiAgICBAbWV0aG9kIHdpbGxNZXJnZU1peGluCiAgKi8KICB3aWxsTWVyZ2VNaXhpbjogZnVu
Y3Rpb24ocHJvcHMpIHsKICAgIHZhciBoYXNoTmFtZTsKCiAgICBpZiAoIXByb3BzLl9hY3Rpb25z
KSB7CiAgICAgIGlmICh0eXBlT2YocHJvcHMuYWN0aW9ucykgPT09ICdvYmplY3QnKSB7CiAgICAg
ICAgaGFzaE5hbWUgPSAnYWN0aW9ucyc7CiAgICAgIH0gZWxzZSBpZiAodHlwZU9mKHByb3BzLmV2
ZW50cykgPT09ICdvYmplY3QnKSB7CiAgICAgICAgRW1iZXIuZGVwcmVjYXRlKCdBY3Rpb24gaGFu
ZGxlcnMgY29udGFpbmVkIGluIGFuIGBldmVudHNgIG9iamVjdCBhcmUgZGVwcmVjYXRlZCBpbiBm
YXZvciBvZiBwdXR0aW5nIHRoZW0gaW4gYW4gYGFjdGlvbnNgIG9iamVjdCcsIGZhbHNlKTsKICAg
ICAgICBoYXNoTmFtZSA9ICdldmVudHMnOwogICAgICB9CgogICAgICBpZiAoaGFzaE5hbWUpIHsK
ICAgICAgICBwcm9wcy5fYWN0aW9ucyA9IEVtYmVyLm1lcmdlKHByb3BzLl9hY3Rpb25zIHx8IHt9
LCBwcm9wc1toYXNoTmFtZV0pOwogICAgICB9CgogICAgICBkZWxldGUgcHJvcHNbaGFzaE5hbWVd
OwogICAgfQogIH0sCgogIHNlbmQ6IGZ1bmN0aW9uKGFjdGlvbk5hbWUpIHsKICAgIHZhciBhcmdz
ID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCB0YXJnZXQ7CgogICAgaWYgKHRoaXMuX2Fj
dGlvbnMgJiYgdGhpcy5fYWN0aW9uc1thY3Rpb25OYW1lXSkgewogICAgICBpZiAodGhpcy5fYWN0
aW9uc1thY3Rpb25OYW1lXS5hcHBseSh0aGlzLCBhcmdzKSA9PT0gdHJ1ZSkgewogICAgICAgIC8v
IGhhbmRsZXIgcmV0dXJuZWQgdHJ1ZSwgc28gdGhpcyBhY3Rpb24gd2lsbCBidWJibGUKICAgICAg
fSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodGhpcy5kZXBy
ZWNhdGVkU2VuZCAmJiB0aGlzLmRlcHJlY2F0ZWRTZW5kSGFuZGxlcyAmJiB0aGlzLmRlcHJlY2F0
ZWRTZW5kSGFuZGxlcyhhY3Rpb25OYW1lKSkgewogICAgICBpZiAodGhpcy5kZXByZWNhdGVkU2Vu
ZC5hcHBseSh0aGlzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykpID09PSB0cnVlKSB7CiAgICAg
ICAgLy8gaGFuZGxlciByZXR1cm4gdHJ1ZSwgc28gdGhpcyBhY3Rpb24gd2lsbCBidWJibGUKICAg
ICAgfSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICBpZiAodGFyZ2V0
ID0gZ2V0KHRoaXMsICd0YXJnZXQnKSkgewogICAgICBFbWJlci5hc3NlcnQoIlRoZSBgdGFyZ2V0
YCBmb3IgIiArIHRoaXMgKyAiICgiICsgdGFyZ2V0ICsgIikgZG9lcyBub3QgaGF2ZSBhIGBzZW5k
YCBtZXRob2QiLCB0eXBlb2YgdGFyZ2V0LnNlbmQgPT09ICdmdW5jdGlvbicpOwogICAgICB0YXJn
ZXQuc2VuZC5hcHBseSh0YXJnZXQsIGFyZ3VtZW50cyk7CiAgICB9CiAgfQoKfSk7Cgp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7CnZhciBzZXQgPSBFbWJlci5zZXQsIGdldCA9IEVtYmVyLmdldCwKICAg
IHJlc29sdmUgPSBFbWJlci5SU1ZQLnJlc29sdmUsCiAgICByZXRocm93ID0gRW1iZXIuUlNWUC5y
ZXRocm93LAogICAgbm90ID0gRW1iZXIuY29tcHV0ZWQubm90LAogICAgb3IgPSBFbWJlci5jb21w
dXRlZC5vcjsKCi8qKgogIEBtb2R1bGUgZW1iZXIKICBAc3VibW9kdWxlIGVtYmVyLXJ1bnRpbWUK
ICovCgpmdW5jdGlvbiBvYnNlcnZlUHJvbWlzZShwcm94eSwgcHJvbWlzZSkgewogIHByb21pc2Uu
dGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgc2V0KHByb3h5LCAnaXNGdWxmaWxsZWQnLCB0cnVl
KTsKICAgIHNldChwcm94eSwgJ2NvbnRlbnQnLCB2YWx1ZSk7CiAgfSwgZnVuY3Rpb24ocmVhc29u
KSB7CiAgICBzZXQocHJveHksICdpc1JlamVjdGVkJywgdHJ1ZSk7CiAgICBzZXQocHJveHksICdy
ZWFzb24nLCByZWFzb24pOwogICAgLy8gZG9uJ3QgcmUtdGhyb3csIGFzIHdlIGFyZSBtZXJlbHkg
b2JzZXJ2aW5nCiAgfSwgIkVtYmVyOiBQcm9taXNlUHJveHkiKTsKfQoKLyoqCiAgQSBsb3cgbGV2
ZWwgbWl4aW4gbWFraW5nIE9iamVjdFByb3h5LCBPYmplY3RDb250cm9sbGVyIG9yIEFycmF5Q29u
dHJvbGxlcidzIHByb21pc2UgYXdhcmUuCgogIGBgYGphdmFzY3JpcHQKICB2YXIgT2JqZWN0UHJv
bWlzZUNvbnRyb2xsZXIgPSBFbWJlci5PYmplY3RDb250cm9sbGVyLmV4dGVuZChFbWJlci5Qcm9t
aXNlUHJveHlNaXhpbik7CgogIHZhciBjb250cm9sbGVyID0gT2JqZWN0UHJvbWlzZUNvbnRyb2xs
ZXIuY3JlYXRlKHsKICAgIHByb21pc2U6ICQuZ2V0SlNPTignL3NvbWUvcmVtb3RlL2RhdGEuanNv
bicpCiAgfSk7CgogIGNvbnRyb2xsZXIudGhlbihmdW5jdGlvbihqc29uKXsKICAgICAvLyB0aGUg
anNvbgogIH0sIGZ1bmN0aW9uKHJlYXNvbikgewogICAgIC8vIHRoZSByZWFzb24gd2h5IHlvdSBo
YXZlIG5vIGpzb24KICB9KTsKICBgYGAKCiAgdGhlIGNvbnRyb2xsZXIgaGFzIGJpbmRhYmxlIGF0
dHJpYnV0ZXMgd2hpY2gKICB0cmFjayB0aGUgcHJvbWlzZXMgbGlmZSBjeWNsZQoKICBgYGBqYXZh
c2NyaXB0CiAgY29udHJvbGxlci5nZXQoJ2lzUGVuZGluZycpICAgLy89PiB0cnVlCiAgY29udHJv
bGxlci5nZXQoJ2lzU2V0dGxlZCcpICAvLz0+IGZhbHNlCiAgY29udHJvbGxlci5nZXQoJ2lzUmVq
ZWN0ZWQnKSAgLy89PiBmYWxzZQogIGNvbnRyb2xsZXIuZ2V0KCdpc0Z1bGZpbGxlZCcpIC8vPT4g
ZmFsc2UKICBgYGAKCiAgV2hlbiB0aGUgdGhlICQuZ2V0SlNPTiBjb21wbGV0ZXMsIGFuZCB0aGUg
cHJvbWlzZSBpcyBmdWxmaWxsZWQKICB3aXRoIGpzb24sIHRoZSBsaWZlIGN5Y2xlIGF0dHJpYnV0
ZXMgd2lsbCB1cGRhdGUgYWNjb3JkaW5nbHkuCgogIGBgYGphdmFzY3JpcHQKICBjb250cm9sbGVy
LmdldCgnaXNQZW5kaW5nJykgICAvLz0+IGZhbHNlCiAgY29udHJvbGxlci5nZXQoJ2lzU2V0dGxl
ZCcpICAgLy89PiB0cnVlCiAgY29udHJvbGxlci5nZXQoJ2lzUmVqZWN0ZWQnKSAgLy89PiBmYWxz
ZQogIGNvbnRyb2xsZXIuZ2V0KCdpc0Z1bGZpbGxlZCcpIC8vPT4gdHJ1ZQogIGBgYAoKICBBcyB0
aGUgY29udHJvbGxlciBpcyBhbiBPYmplY3RDb250cm9sbGVyLCBhbmQgdGhlIGpzb24gbm93IGl0
cyBjb250ZW50LAogIGFsbCB0aGUganNvbiBwcm9wZXJ0aWVzIHdpbGwgYmUgYXZhaWxhYmxlIGRp
cmVjdGx5IGZyb20gdGhlIGNvbnRyb2xsZXIuCgogIGBgYGphdmFzY3JpcHQKICAvLyBBc3N1bWlu
ZyB0aGUgZm9sbG93aW5nIGpzb246CiAgewogICAgZmlyc3ROYW1lOiAnU3RlZmFuJywKICAgIGxh
c3ROYW1lOiAnUGVubmVyJwogIH0KCiAgLy8gYm90aCBwcm9wZXJ0aWVzIHdpbGwgYWNjZXNzaWJs
ZSBvbiB0aGUgY29udHJvbGxlcgogIGNvbnRyb2xsZXIuZ2V0KCdmaXJzdE5hbWUnKSAvLz0+ICdT
dGVmYW4nCiAgY29udHJvbGxlci5nZXQoJ2xhc3ROYW1lJykgIC8vPT4gJ1Blbm5lcicKICBgYGAK
CiAgSWYgdGhlIGNvbnRyb2xsZXIgaXMgYmFja2luZyBhIHRlbXBsYXRlLCB0aGUgYXR0cmlidXRl
cyBhcmUKICBiaW5kYWJsZSBmcm9tIHdpdGhpbiB0aGF0IHRlbXBsYXRlCgogIGBgYGhhbmRsZWJh
cnMKICB7eyNpZiBpc1BlbmRpbmd9fQogICAgbG9hZGluZy4uLgogIHt7ZWxzZX19CiAgICBmaXJz
dE5hbWU6IHt7Zmlyc3ROYW1lfX0KICAgIGxhc3ROYW1lOiB7e2xhc3ROYW1lfX0KICB7ey9pZn19
CiAgYGBgCiAgQGNsYXNzIEVtYmVyLlByb21pc2VQcm94eU1peGluCiovCkVtYmVyLlByb21pc2VQ
cm94eU1peGluID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAvKioKICAgIElmIHRoZSBwcm94aWVk
IHByb21pc2UgaXMgcmVqZWN0ZWQgdGhpcyB3aWxsIGNvbnRhaW4gdGhlIHJlYXNvbgogICAgcHJv
dmlkZWQuCgogICAgQHByb3BlcnR5IHJlYXNvbgogICAgQGRlZmF1bHQgbnVsbAogICovCiAgcmVh
c29uOiAgICBudWxsLAoKICAvKioKICAgIE9uY2UgdGhlIHByb3hpZWQgcHJvbWlzZSBoYXMgc2V0
dGxlZCB0aGlzIHdpbGwgYmVjb21lIGBmYWxzZWAuCgogICAgQHByb3BlcnR5IGlzUGVuZGluZwog
ICAgQGRlZmF1bHQgdHJ1ZQogICovCiAgaXNQZW5kaW5nOiAgbm90KCdpc1NldHRsZWQnKS5yZWFk
T25seSgpLAoKICAvKioKICAgIE9uY2UgdGhlIHByb3hpZWQgcHJvbWlzZSBoYXMgc2V0dGxlZCB0
aGlzIHdpbGwgYmVjb21lIGB0cnVlYC4KCiAgICBAcHJvcGVydHkgaXNTZXR0bGVkCiAgICBAZGVm
YXVsdCBmYWxzZQogICovCiAgaXNTZXR0bGVkOiAgb3IoJ2lzUmVqZWN0ZWQnLCAnaXNGdWxmaWxs
ZWQnKS5yZWFkT25seSgpLAoKICAvKioKICAgIFdpbGwgYmVjb21lIGB0cnVlYCBpZiB0aGUgcHJv
eGllZCBwcm9taXNlIGlzIHJlamVjdGVkLgoKICAgIEBwcm9wZXJ0eSBpc1JlamVjdGVkCiAgICBA
ZGVmYXVsdCBmYWxzZQogICovCiAgaXNSZWplY3RlZDogIGZhbHNlLAoKICAvKioKICAgIFdpbGwg
YmVjb21lIGB0cnVlYCBpZiB0aGUgcHJveGllZCBwcm9taXNlIGlzIGZ1bGZpbGxlZC4KCiAgICBA
cHJvcGVydHkgaXNGdWxsZmlsbGVkCiAgICBAZGVmYXVsdCBmYWxzZQogICovCiAgaXNGdWxmaWxs
ZWQ6IGZhbHNlLAoKICAvKioKICAgIFRoZSBwcm9taXNlIHdob3NlIGZ1bGZpbGxtZW50IHZhbHVl
IGlzIGJlaW5nIHByb3hpZWQgYnkgdGhpcyBvYmplY3QuCgogICAgVGhpcyBwcm9wZXJ0eSBtdXN0
IGJlIHNwZWNpZmllZCB1cG9uIGNyZWF0aW9uLCBhbmQgc2hvdWxkIG5vdCBiZQogICAgY2hhbmdl
ZCBvbmNlIGNyZWF0ZWQuCgogICAgRXhhbXBsZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBFbWJl
ci5PYmplY3RDb250cm9sbGVyLmV4dGVuZChFbWJlci5Qcm9taXNlUHJveHlNaXhpbikuY3JlYXRl
KHsKICAgICAgcHJvbWlzZTogPHRoZW5hYmxlPgogICAgfSk7CiAgICBgYGAKCiAgICBAcHJvcGVy
dHkgcHJvbWlzZQogICovCiAgcHJvbWlzZTogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oa2V5LCBw
cm9taXNlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICBwcm9taXNl
ID0gcmVzb2x2ZShwcm9taXNlKTsKICAgICAgb2JzZXJ2ZVByb21pc2UodGhpcywgcHJvbWlzZSk7
CiAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oKTsgLy8gZm9yayB0aGUgcHJvbWlzZS4KICAgIH0g
ZWxzZSB7CiAgICAgIHRocm93IG5ldyBFbWJlci5FcnJvcigiUHJvbWlzZVByb3h5J3MgcHJvbWlz
ZSBtdXN0IGJlIHNldCIpOwogICAgfQogIH0pLAoKICAvKioKICAgIEFuIGFsaWFzIHRvIHRoZSBw
cm94aWVkIHByb21pc2UncyBgdGhlbmAuCgogICAgU2VlIFJTVlAuUHJvbWlzZS50aGVuLgoKICAg
IEBtZXRob2QgdGhlbgogICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgIEByZXR1cm4g
e1JTVlAuUHJvbWlzZX0KICAqLwogIHRoZW46IHByb21pc2VBbGlhcygndGhlbicpLAoKICAvKioK
ICAgIEFuIGFsaWFzIHRvIHRoZSBwcm94aWVkIHByb21pc2UncyBgY2F0Y2hgLgoKICAgIFNlZSBS
U1ZQLlByb21pc2UuY2F0Y2guCgogICAgQG1ldGhvZCBjYXRjaAogICAgQHBhcmFtIHtGdW5jdGlv
bn0gY2FsbGJhY2sKICAgIEByZXR1cm4ge1JTVlAuUHJvbWlzZX0KICAqLwogICdjYXRjaCc6IHBy
b21pc2VBbGlhcygnY2F0Y2gnKSwKCiAgLyoqCiAgICBBbiBhbGlhcyB0byB0aGUgcHJveGllZCBw
cm9taXNlJ3MgYGZpbmFsbHlgLgoKICAgIFNlZSBSU1ZQLlByb21pc2UuZmluYWxseS4KCiAgICBA
bWV0aG9kIGZpbmFsbHkKICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICBAcmV0dXJu
IHtSU1ZQLlByb21pc2V9CiAgKi8KICAnZmluYWxseSc6IHByb21pc2VBbGlhcygnZmluYWxseScp
Cgp9KTsKCmZ1bmN0aW9uIHByb21pc2VBbGlhcyhuYW1lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgp
IHsKICAgIHZhciBwcm9taXNlID0gZ2V0KHRoaXMsICdwcm9taXNlJyk7CiAgICByZXR1cm4gcHJv
bWlzZVtuYW1lXS5hcHBseShwcm9taXNlLCBhcmd1bWVudHMpOwogIH07Cn0KCn0pKCk7CgoKCihm
dW5jdGlvbigpIHsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKdmFyIGdldCA9IEVtYmVyLmdldCwK
ICAgIGZvckVhY2ggPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaCwKICAgIFJFVEFJTiA9
ICdyJywKICAgIElOU0VSVCA9ICdpJywKICAgIERFTEVURSA9ICdkJzsKCi8qKgogIEFuIGBFbWJl
ci5UcmFja2VkQXJyYXlgIHRyYWNrcyBhcnJheSBvcGVyYXRpb25zLiAgSXQncyB1c2VmdWwgd2hl
biB5b3Ugd2FudCB0bwogIGxhemlseSBjb21wdXRlIHRoZSBpbmRleGVzIG9mIGl0ZW1zIGluIGFu
IGFycmF5IGFmdGVyIHRoZXkndmUgYmVlbiBzaGlmdGVkIGJ5CiAgc3Vic2VxdWVudCBvcGVyYXRp
b25zLgoKICBAY2xhc3MgVHJhY2tlZEFycmF5CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBwYXJhbSB7
YXJyYXl9IFtpdGVtcz1bXV0gVGhlIGFycmF5IHRvIGJlIHRyYWNrZWQuICBUaGlzIGlzIHVzZWQg
anVzdCB0byBnZXQKICB0aGUgaW5pdGlhbCBpdGVtcyBmb3IgdGhlIHN0YXJ0aW5nIHN0YXRlIG9m
IHJldGFpbjpuLgoqLwpFbWJlci5UcmFja2VkQXJyYXkgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICBp
ZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpIHsgaXRlbXMgPSBbXTsgfQoKICB2YXIgbGVuZ3RoID0g
Z2V0KGl0ZW1zLCAnbGVuZ3RoJyk7CgogIGlmIChsZW5ndGgpIHsKICAgIHRoaXMuX29wZXJhdGlv
bnMgPSBbbmV3IEFycmF5T3BlcmF0aW9uKFJFVEFJTiwgbGVuZ3RoLCBpdGVtcyldOwogIH0gZWxz
ZSB7CiAgICB0aGlzLl9vcGVyYXRpb25zID0gW107CiAgfQp9OwoKRW1iZXIuVHJhY2tlZEFycmF5
LlJFVEFJTiA9IFJFVEFJTjsKRW1iZXIuVHJhY2tlZEFycmF5LklOU0VSVCA9IElOU0VSVDsKRW1i
ZXIuVHJhY2tlZEFycmF5LkRFTEVURSA9IERFTEVURTsKCkVtYmVyLlRyYWNrZWRBcnJheS5wcm90
b3R5cGUgPSB7CgogIC8qKgogICAgVHJhY2sgdGhhdCBgbmV3SXRlbXNgIHdlcmUgYWRkZWQgdG8g
dGhlIHRyYWNrZWQgYXJyYXkgYXQgYGluZGV4YC4KCiAgICBAbWV0aG9kIGFkZEl0ZW1zCiAgICBA
cGFyYW0gaW5kZXgKICAgIEBwYXJhbSBuZXdJdGVtcwogICovCiAgYWRkSXRlbXM6IGZ1bmN0aW9u
IChpbmRleCwgbmV3SXRlbXMpIHsKICAgIHZhciBjb3VudCA9IGdldChuZXdJdGVtcywgJ2xlbmd0
aCcpOwogICAgaWYgKGNvdW50IDwgMSkgeyByZXR1cm47IH0KCiAgICB2YXIgbWF0Y2ggPSB0aGlz
Ll9maW5kQXJyYXlPcGVyYXRpb24oaW5kZXgpLAogICAgICAgIGFycmF5T3BlcmF0aW9uID0gbWF0
Y2gub3BlcmF0aW9uLAogICAgICAgIGFycmF5T3BlcmF0aW9uSW5kZXggPSBtYXRjaC5pbmRleCwK
ICAgICAgICBhcnJheU9wZXJhdGlvblJhbmdlU3RhcnQgPSBtYXRjaC5yYW5nZVN0YXJ0LAogICAg
ICAgIGNvbXBvc2VJbmRleCwKICAgICAgICBzcGxpdEluZGV4LAogICAgICAgIHNwbGl0SXRlbXMs
CiAgICAgICAgc3BsaXRBcnJheU9wZXJhdGlvbiwKICAgICAgICBuZXdBcnJheU9wZXJhdGlvbjsK
CiAgICBuZXdBcnJheU9wZXJhdGlvbiA9IG5ldyBBcnJheU9wZXJhdGlvbihJTlNFUlQsIGNvdW50
LCBuZXdJdGVtcyk7CgogICAgaWYgKGFycmF5T3BlcmF0aW9uKSB7CiAgICAgIGlmICghbWF0Y2gu
c3BsaXQpIHsKICAgICAgICAvLyBpbnNlcnQgbGVmdCBvZiBhcnJheU9wZXJhdGlvbgogICAgICAg
IHRoaXMuX29wZXJhdGlvbnMuc3BsaWNlKGFycmF5T3BlcmF0aW9uSW5kZXgsIDAsIG5ld0FycmF5
T3BlcmF0aW9uKTsKICAgICAgICBjb21wb3NlSW5kZXggPSBhcnJheU9wZXJhdGlvbkluZGV4Owog
ICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3NwbGl0KGFycmF5T3BlcmF0aW9uSW5kZXgsIGlu
ZGV4IC0gYXJyYXlPcGVyYXRpb25SYW5nZVN0YXJ0LCBuZXdBcnJheU9wZXJhdGlvbik7CiAgICAg
ICAgY29tcG9zZUluZGV4ID0gYXJyYXlPcGVyYXRpb25JbmRleCArIDE7CiAgICAgIH0KICAgIH0g
ZWxzZSB7CiAgICAgIC8vIGluc2VydCBhdCBlbmQKICAgICAgdGhpcy5fb3BlcmF0aW9ucy5wdXNo
KG5ld0FycmF5T3BlcmF0aW9uKTsKICAgICAgY29tcG9zZUluZGV4ID0gYXJyYXlPcGVyYXRpb25J
bmRleDsKICAgIH0KCiAgICB0aGlzLl9jb21wb3NlSW5zZXJ0KGNvbXBvc2VJbmRleCk7CiAgfSwK
CiAgLyoqCiAgICBUcmFjayB0aGF0IGBjb3VudGAgaXRlbXMgd2VyZSByZW1vdmVkIGF0IGBpbmRl
eGAuCgogICAgQG1ldGhvZCByZW1vdmVJdGVtcwogICAgQHBhcmFtIGluZGV4CiAgICBAcGFyYW0g
Y291bnQKICAqLwogIHJlbW92ZUl0ZW1zOiBmdW5jdGlvbiAoaW5kZXgsIGNvdW50KSB7CiAgICBp
ZiAoY291bnQgPCAxKSB7IHJldHVybjsgfQoKICAgIHZhciBtYXRjaCA9IHRoaXMuX2ZpbmRBcnJh
eU9wZXJhdGlvbihpbmRleCksCiAgICAgICAgYXJyYXlPcGVyYXRpb24gPSBtYXRjaC5vcGVyYXRp
b24sCiAgICAgICAgYXJyYXlPcGVyYXRpb25JbmRleCA9IG1hdGNoLmluZGV4LAogICAgICAgIGFy
cmF5T3BlcmF0aW9uUmFuZ2VTdGFydCA9IG1hdGNoLnJhbmdlU3RhcnQsCiAgICAgICAgbmV3QXJy
YXlPcGVyYXRpb24sCiAgICAgICAgY29tcG9zZUluZGV4OwoKICAgIG5ld0FycmF5T3BlcmF0aW9u
ID0gbmV3IEFycmF5T3BlcmF0aW9uKERFTEVURSwgY291bnQpOwogICAgaWYgKCFtYXRjaC5zcGxp
dCkgewogICAgICAvLyBpbnNlcnQgbGVmdCBvZiBhcnJheU9wZXJhdGlvbgogICAgICB0aGlzLl9v
cGVyYXRpb25zLnNwbGljZShhcnJheU9wZXJhdGlvbkluZGV4LCAwLCBuZXdBcnJheU9wZXJhdGlv
bik7CiAgICAgIGNvbXBvc2VJbmRleCA9IGFycmF5T3BlcmF0aW9uSW5kZXg7CiAgICB9IGVsc2Ug
ewogICAgICB0aGlzLl9zcGxpdChhcnJheU9wZXJhdGlvbkluZGV4LCBpbmRleCAtIGFycmF5T3Bl
cmF0aW9uUmFuZ2VTdGFydCwgbmV3QXJyYXlPcGVyYXRpb24pOwogICAgICBjb21wb3NlSW5kZXgg
PSBhcnJheU9wZXJhdGlvbkluZGV4ICsgMTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fY29tcG9z
ZURlbGV0ZShjb21wb3NlSW5kZXgpOwogIH0sCgogIC8qKgogICAgQXBwbHkgYWxsIG9wZXJhdGlv
bnMsIHJlZHVjaW5nIHRoZW0gdG8gcmV0YWluOm4sIGZvciBgbmAsIHRoZSBudW1iZXIgb2YKICAg
IGl0ZW1zIGluIHRoZSBhcnJheS4KCiAgICBgY2FsbGJhY2tgIHdpbGwgYmUgY2FsbGVkIGZvciBl
YWNoIG9wZXJhdGlvbiBhbmQgd2lsbCBiZSBwYXNzZWQgdGhlIGZvbGxvd2luZyBhcmd1bWVudHM6
CgogICAgKiB7YXJyYXl9IGl0ZW1zIFRoZSBpdGVtcyBmb3IgdGhlIGdpdmVuIG9wZXJhdGlvbgog
ICAgKiB7bnVtYmVyfSBvZmZzZXQgVGhlIGNvbXB1dGVkIG9mZnNldCBvZiB0aGUgaXRlbXMsIGll
IHRoZSBpbmRleCBpbiB0aGUKICAgIGFycmF5IG9mIHRoZSBmaXJzdCBpdGVtIGZvciB0aGlzIG9w
ZXJhdGlvbi4KICAgICoge3N0cmluZ30gb3BlcmF0aW9uIFRoZSB0eXBlIG9mIHRoZSBvcGVyYXRp
b24uICBPbmUgb2YKICAgIGBFbWJlci5UcmFja2VkQXJyYXkue1JFVEFJTiwgREVMRVRFLCBJTlNF
UlR9YAoKICAgIEBtZXRob2QgYXBwbHkKICAgIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrCiAg
Ki8KICBhcHBseTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICB2YXIgaXRlbXMgPSBbXSwKICAg
ICAgICBvZmZzZXQgPSAwOwoKICAgIGZvckVhY2godGhpcy5fb3BlcmF0aW9ucywgZnVuY3Rpb24g
KGFycmF5T3BlcmF0aW9uKSB7CiAgICAgIGNhbGxiYWNrKGFycmF5T3BlcmF0aW9uLml0ZW1zLCBv
ZmZzZXQsIGFycmF5T3BlcmF0aW9uLnR5cGUpOwoKICAgICAgaWYgKGFycmF5T3BlcmF0aW9uLnR5
cGUgIT09IERFTEVURSkgewogICAgICAgIG9mZnNldCArPSBhcnJheU9wZXJhdGlvbi5jb3VudDsK
ICAgICAgICBpdGVtcyA9IGl0ZW1zLmNvbmNhdChhcnJheU9wZXJhdGlvbi5pdGVtcyk7CiAgICAg
IH0KICAgIH0pOwoKICAgIHRoaXMuX29wZXJhdGlvbnMgPSBbbmV3IEFycmF5T3BlcmF0aW9uKFJF
VEFJTiwgaXRlbXMubGVuZ3RoLCBpdGVtcyldOwogIH0sCgogIC8qKgogICAgUmV0dXJuIGFuIGBB
cnJheU9wZXJhdGlvbk1hdGNoYCBmb3IgdGhlIG9wZXJhdGlvbiB0aGF0IGNvbnRhaW5zIHRoZSBp
dGVtIGF0IGBpbmRleGAuCgogICAgQG1ldGhvZCBfZmluZEFycmF5T3BlcmF0aW9uCgogICAgQHBh
cmFtIHtudW1iZXJ9IGluZGV4IHRoZSBpbmRleCBvZiB0aGUgaXRlbSB3aG9zZSBvcGVyYXRpb24g
aW5mb3JtYXRpb24KICAgIHNob3VsZCBiZSByZXR1cm5lZC4KICAgIEBwcml2YXRlCiAgKi8KICBf
ZmluZEFycmF5T3BlcmF0aW9uOiBmdW5jdGlvbiAoaW5kZXgpIHsKICAgIHZhciBhcnJheU9wZXJh
dGlvbkluZGV4LAogICAgICAgIGxlbiwKICAgICAgICBzcGxpdCA9IGZhbHNlLAogICAgICAgIGFy
cmF5T3BlcmF0aW9uLAogICAgICAgIGFycmF5T3BlcmF0aW9uUmFuZ2VTdGFydCwKICAgICAgICBh
cnJheU9wZXJhdGlvblJhbmdlRW5kOwoKICAgIC8vIE9QVElNSVpFOiB3ZSBjb3VsZCBzZWFyY2gg
dGhlc2UgZmFzdGVyIGlmIHdlIGtlcHQgYSBiYWxhbmNlZCB0cmVlLgogICAgLy8gZmluZCBsZWZ0
bW9zdCBhcnJheU9wZXJhdGlvbiB0byB0aGUgcmlnaHQgb2YgYGluZGV4YAogICAgZm9yIChhcnJh
eU9wZXJhdGlvbkluZGV4ID0gYXJyYXlPcGVyYXRpb25SYW5nZVN0YXJ0ID0gMCwgbGVuID0gdGhp
cy5fb3BlcmF0aW9ucy5sZW5ndGg7IGFycmF5T3BlcmF0aW9uSW5kZXggPCBsZW47ICsrYXJyYXlP
cGVyYXRpb25JbmRleCkgewogICAgICBhcnJheU9wZXJhdGlvbiA9IHRoaXMuX29wZXJhdGlvbnNb
YXJyYXlPcGVyYXRpb25JbmRleF07CgogICAgICBpZiAoYXJyYXlPcGVyYXRpb24udHlwZSA9PT0g
REVMRVRFKSB7IGNvbnRpbnVlOyB9CgogICAgICBhcnJheU9wZXJhdGlvblJhbmdlRW5kID0gYXJy
YXlPcGVyYXRpb25SYW5nZVN0YXJ0ICsgYXJyYXlPcGVyYXRpb24uY291bnQgLSAxOwoKICAgICAg
aWYgKGluZGV4ID09PSBhcnJheU9wZXJhdGlvblJhbmdlU3RhcnQpIHsKICAgICAgICBicmVhazsK
ICAgICAgfSBlbHNlIGlmIChpbmRleCA+IGFycmF5T3BlcmF0aW9uUmFuZ2VTdGFydCAmJiBpbmRl
eCA8PSBhcnJheU9wZXJhdGlvblJhbmdlRW5kKSB7CiAgICAgICAgc3BsaXQgPSB0cnVlOwogICAg
ICAgIGJyZWFrOwogICAgICB9IGVsc2UgewogICAgICAgIGFycmF5T3BlcmF0aW9uUmFuZ2VTdGFy
dCA9IGFycmF5T3BlcmF0aW9uUmFuZ2VFbmQgKyAxOwogICAgICB9CiAgICB9CgogICAgcmV0dXJu
IG5ldyBBcnJheU9wZXJhdGlvbk1hdGNoKGFycmF5T3BlcmF0aW9uLCBhcnJheU9wZXJhdGlvbklu
ZGV4LCBzcGxpdCwgYXJyYXlPcGVyYXRpb25SYW5nZVN0YXJ0KTsKICB9LAoKICBfc3BsaXQ6IGZ1
bmN0aW9uIChhcnJheU9wZXJhdGlvbkluZGV4LCBzcGxpdEluZGV4LCBuZXdBcnJheU9wZXJhdGlv
bikgewogICAgdmFyIGFycmF5T3BlcmF0aW9uID0gdGhpcy5fb3BlcmF0aW9uc1thcnJheU9wZXJh
dGlvbkluZGV4XSwKICAgICAgICBzcGxpdEl0ZW1zID0gYXJyYXlPcGVyYXRpb24uaXRlbXMuc2xp
Y2Uoc3BsaXRJbmRleCksCiAgICAgICAgc3BsaXRBcnJheU9wZXJhdGlvbiA9IG5ldyBBcnJheU9w
ZXJhdGlvbihhcnJheU9wZXJhdGlvbi50eXBlLCBzcGxpdEl0ZW1zLmxlbmd0aCwgc3BsaXRJdGVt
cyk7CgogICAgLy8gdHJ1bmNhdGUgTEhTCiAgICBhcnJheU9wZXJhdGlvbi5jb3VudCA9IHNwbGl0
SW5kZXg7CiAgICBhcnJheU9wZXJhdGlvbi5pdGVtcyA9IGFycmF5T3BlcmF0aW9uLml0ZW1zLnNs
aWNlKDAsIHNwbGl0SW5kZXgpOwoKICAgIHRoaXMuX29wZXJhdGlvbnMuc3BsaWNlKGFycmF5T3Bl
cmF0aW9uSW5kZXggKyAxLCAwLCBuZXdBcnJheU9wZXJhdGlvbiwgc3BsaXRBcnJheU9wZXJhdGlv
bik7CiAgfSwKCiAgLy8gc2VlIFN1YkFycmF5IGZvciBhIGJldHRlciBpbXBsZW1lbnRhdGlvbi4K
ICBfY29tcG9zZUluc2VydDogZnVuY3Rpb24gKGluZGV4KSB7CiAgICB2YXIgbmV3QXJyYXlPcGVy
YXRpb24gPSB0aGlzLl9vcGVyYXRpb25zW2luZGV4XSwKICAgICAgICBsZWZ0QXJyYXlPcGVyYXRp
b24gPSB0aGlzLl9vcGVyYXRpb25zW2luZGV4LTFdLCAvLyBtYXkgYmUgdW5kZWZpbmVkCiAgICAg
ICAgcmlnaHRBcnJheU9wZXJhdGlvbiA9IHRoaXMuX29wZXJhdGlvbnNbaW5kZXgrMV0sIC8vIG1h
eSBiZSB1bmRlZmluZWQKICAgICAgICBsZWZ0T3AgPSBsZWZ0QXJyYXlPcGVyYXRpb24gJiYgbGVm
dEFycmF5T3BlcmF0aW9uLnR5cGUsCiAgICAgICAgcmlnaHRPcCA9IHJpZ2h0QXJyYXlPcGVyYXRp
b24gJiYgcmlnaHRBcnJheU9wZXJhdGlvbi50eXBlOwoKICAgIGlmIChsZWZ0T3AgPT09IElOU0VS
VCkgewogICAgICAgIC8vIG1lcmdlIGxlZnQKICAgICAgICBsZWZ0QXJyYXlPcGVyYXRpb24uY291
bnQgKz0gbmV3QXJyYXlPcGVyYXRpb24uY291bnQ7CiAgICAgICAgbGVmdEFycmF5T3BlcmF0aW9u
Lml0ZW1zID0gbGVmdEFycmF5T3BlcmF0aW9uLml0ZW1zLmNvbmNhdChuZXdBcnJheU9wZXJhdGlv
bi5pdGVtcyk7CgogICAgICBpZiAocmlnaHRPcCA9PT0gSU5TRVJUKSB7CiAgICAgICAgLy8gYWxz
byBtZXJnZSByaWdodCAod2UgaGF2ZSBzcGxpdCBhbiBpbnNlcnQgd2l0aCBhbiBpbnNlcnQpCiAg
ICAgICAgbGVmdEFycmF5T3BlcmF0aW9uLmNvdW50ICs9IHJpZ2h0QXJyYXlPcGVyYXRpb24uY291
bnQ7CiAgICAgICAgbGVmdEFycmF5T3BlcmF0aW9uLml0ZW1zID0gbGVmdEFycmF5T3BlcmF0aW9u
Lml0ZW1zLmNvbmNhdChyaWdodEFycmF5T3BlcmF0aW9uLml0ZW1zKTsKICAgICAgICB0aGlzLl9v
cGVyYXRpb25zLnNwbGljZShpbmRleCwgMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gb25s
eSBtZXJnZSBsZWZ0CiAgICAgICAgdGhpcy5fb3BlcmF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOwog
ICAgICB9CiAgICB9IGVsc2UgaWYgKHJpZ2h0T3AgPT09IElOU0VSVCkgewogICAgICAvLyBtZXJn
ZSByaWdodAogICAgICBuZXdBcnJheU9wZXJhdGlvbi5jb3VudCArPSByaWdodEFycmF5T3BlcmF0
aW9uLmNvdW50OwogICAgICBuZXdBcnJheU9wZXJhdGlvbi5pdGVtcyA9IG5ld0FycmF5T3BlcmF0
aW9uLml0ZW1zLmNvbmNhdChyaWdodEFycmF5T3BlcmF0aW9uLml0ZW1zKTsKICAgICAgdGhpcy5f
b3BlcmF0aW9ucy5zcGxpY2UoaW5kZXggKyAxLCAxKTsKICAgIH0KICB9LAoKICBfY29tcG9zZURl
bGV0ZTogZnVuY3Rpb24gKGluZGV4KSB7CiAgICB2YXIgYXJyYXlPcGVyYXRpb24gPSB0aGlzLl9v
cGVyYXRpb25zW2luZGV4XSwKICAgICAgICBkZWxldGVzVG9HbyA9IGFycmF5T3BlcmF0aW9uLmNv
dW50LAogICAgICAgIGxlZnRBcnJheU9wZXJhdGlvbiA9IHRoaXMuX29wZXJhdGlvbnNbaW5kZXgt
MV0sIC8vIG1heSBiZSB1bmRlZmluZWQKICAgICAgICBsZWZ0T3AgPSBsZWZ0QXJyYXlPcGVyYXRp
b24gJiYgbGVmdEFycmF5T3BlcmF0aW9uLnR5cGUsCiAgICAgICAgbmV4dEFycmF5T3BlcmF0aW9u
LAogICAgICAgIG5leHRPcCwKICAgICAgICBuZXh0Q291bnQsCiAgICAgICAgcmVtb3ZlTmV3QW5k
TmV4dE9wID0gZmFsc2UsCiAgICAgICAgcmVtb3ZlZEl0ZW1zID0gW107CgogICAgaWYgKGxlZnRP
cCA9PT0gREVMRVRFKSB7CiAgICAgIGFycmF5T3BlcmF0aW9uID0gbGVmdEFycmF5T3BlcmF0aW9u
OwogICAgICBpbmRleCAtPSAxOwogICAgfQoKICAgIGZvciAodmFyIGkgPSBpbmRleCArIDE7IGRl
bGV0ZXNUb0dvID4gMDsgKytpKSB7CiAgICAgIG5leHRBcnJheU9wZXJhdGlvbiA9IHRoaXMuX29w
ZXJhdGlvbnNbaV07CiAgICAgIG5leHRPcCA9IG5leHRBcnJheU9wZXJhdGlvbi50eXBlOwogICAg
ICBuZXh0Q291bnQgPSBuZXh0QXJyYXlPcGVyYXRpb24uY291bnQ7CgogICAgICBpZiAobmV4dE9w
ID09PSBERUxFVEUpIHsKICAgICAgICBhcnJheU9wZXJhdGlvbi5jb3VudCArPSBuZXh0Q291bnQ7
CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmIChuZXh0Q291bnQgPiBkZWxldGVz
VG9HbykgewogICAgICAgIC8vIGQ6MiB7cixpfTo1ICB3ZSByZWR1Y2UgdGhlIHJldGFpbiBvciBp
bnNlcnQsIGJ1dCBpdCBzdGF5cwogICAgICAgIHJlbW92ZWRJdGVtcyA9IHJlbW92ZWRJdGVtcy5j
b25jYXQobmV4dEFycmF5T3BlcmF0aW9uLml0ZW1zLnNwbGljZSgwLCBkZWxldGVzVG9HbykpOwog
ICAgICAgIG5leHRBcnJheU9wZXJhdGlvbi5jb3VudCAtPSBkZWxldGVzVG9HbzsKCiAgICAgICAg
Ly8gSW4gdGhlIGNhc2Ugd2hlcmUgd2UgdHJ1bmNhdGUgdGhlIGxhc3QgYXJyYXlPcGVyYXRpb24s
IHdlIGRvbid0IG5lZWQgdG8KICAgICAgICAvLyByZW1vdmUgaXQ7IGFsc28gdGhlIGRlbGV0ZXNU
b0dvIHJlZHVjdGlvbiBpcyBub3QgdGhlIGVudGlyZXR5IG9mCiAgICAgICAgLy8gbmV4dENvdW50
CiAgICAgICAgaSAtPSAxOwogICAgICAgIG5leHRDb3VudCA9IGRlbGV0ZXNUb0dvOwoKICAgICAg
ICBkZWxldGVzVG9HbyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG5leHRDb3VudCA9
PT0gZGVsZXRlc1RvR28pIHsKICAgICAgICAgIC8vIEhhbmRsZSBlZGdlIGNhc2Ugb2YgZDoyIGk6
MiBpbiB3aGljaCBjYXNlIGJvdGggb3BlcmF0aW9ucyBnbyBhd2F5CiAgICAgICAgICAvLyBkdXJp
bmcgY29tcG9zaXRpb24uCiAgICAgICAgICByZW1vdmVOZXdBbmROZXh0T3AgPSB0cnVlOwogICAg
ICAgIH0KICAgICAgICByZW1vdmVkSXRlbXMgPSByZW1vdmVkSXRlbXMuY29uY2F0KG5leHRBcnJh
eU9wZXJhdGlvbi5pdGVtcyk7CiAgICAgICAgZGVsZXRlc1RvR28gLT0gbmV4dENvdW50OwogICAg
ICB9CgogICAgICBpZiAobmV4dE9wID09PSBJTlNFUlQpIHsKICAgICAgICAvLyBkOjIgaTozIHdp
bGwgcmVzdWx0IGluIGRlbGV0ZSBnb2luZyBhd2F5CiAgICAgICAgYXJyYXlPcGVyYXRpb24uY291
bnQgLT0gbmV4dENvdW50OwogICAgICB9CiAgICB9CgogICAgaWYgKGFycmF5T3BlcmF0aW9uLmNv
dW50ID4gMCkgewogICAgICAvLyBjb21wb3NlIG91ciBuZXcgZGVsZXRlIHdpdGggcG9zc2libHkg
c2V2ZXJhbCBvcGVyYXRpb25zIHRvIHRoZSByaWdodCBvZgogICAgICAvLyBkaXNwYXJhdGUgdHlw
ZXMKICAgICAgdGhpcy5fb3BlcmF0aW9ucy5zcGxpY2UoaW5kZXgrMSwgaS0xLWluZGV4KTsKICAg
IH0gZWxzZSB7CiAgICAgIC8vIFRoZSBkZWxldGUgb3BlcmF0aW9uIGNhbiBnbyBhd2F5OyBpdCBo
YXMgbWVyZWx5IHJlZHVjZWQgc29tZSBvdGhlcgogICAgICAvLyBvcGVyYXRpb24sIGFzIGluIGQ6
MyBpOjQ7IGl0IG1heSBhbHNvIGhhdmUgZWxpbWluYXRlZCB0aGF0IG9wZXJhdGlvbiwKICAgICAg
Ly8gYXMgaW4gZDozIGk6My4KICAgICAgdGhpcy5fb3BlcmF0aW9ucy5zcGxpY2UoaW5kZXgsIHJl
bW92ZU5ld0FuZE5leHRPcCA/IDIgOiAxKTsKICAgIH0KCiAgICByZXR1cm4gcmVtb3ZlZEl0ZW1z
OwogIH0sCgogIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc3RyID0gIiI7CiAgICBm
b3JFYWNoKHRoaXMuX29wZXJhdGlvbnMsIGZ1bmN0aW9uIChvcGVyYXRpb24pIHsKICAgICAgc3Ry
ICs9ICIgIiArIG9wZXJhdGlvbi50eXBlICsgIjoiICsgb3BlcmF0aW9uLmNvdW50OwogICAgfSk7
CiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygxKTsKICB9Cn07CgovKioKICBJbnRlcm5hbCBkYXRh
IHN0cnVjdHVyZSB0byByZXByZXNlbnQgYW4gYXJyYXkgb3BlcmF0aW9uLgoKICBAbWV0aG9kIEFy
cmF5T3BlcmF0aW9uCiAgQHByaXZhdGUKICBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBv
ZiB0aGUgb3BlcmF0aW9uLiAgT25lIG9mCiAgYEVtYmVyLlRyYWNrZWRBcnJheS57UkVUQUlOLCBJ
TlNFUlQsIERFTEVURX1gCiAgQHBhcmFtIHtudW1iZXJ9IGNvdW50IFRoZSBudW1iZXIgb2YgaXRl
bXMgaW4gdGhpcyBvcGVyYXRpb24uCiAgQHBhcmFtIHthcnJheX0gaXRlbXMgVGhlIGl0ZW1zIG9m
IHRoZSBvcGVyYXRpb24sIGlmIGluY2x1ZGVkLiAgUkVUQUlOIGFuZAogIElOU0VSVCBpbmNsdWRl
IHRoZWlyIGl0ZW1zLCBERUxFVEUgZG9lcyBub3QuCiovCmZ1bmN0aW9uIEFycmF5T3BlcmF0aW9u
IChvcGVyYXRpb24sIGNvdW50LCBpdGVtcykgewogIHRoaXMudHlwZSA9IG9wZXJhdGlvbjsgLy8g
UkVUQUlOIHwgSU5TRVJUIHwgREVMRVRFCiAgdGhpcy5jb3VudCA9IGNvdW50OwogIHRoaXMuaXRl
bXMgPSBpdGVtczsKfQoKLyoqCiAgSW50ZXJuYWwgZGF0YSBzdHJ1Y3R1cmUgdXNlZCB0byBpbmNs
dWRlIGluZm9ybWF0aW9uIHdoZW4gbG9va2luZyB1cCBvcGVyYXRpb25zCiAgYnkgaXRlbSBpbmRl
eC4KCiAgQG1ldGhvZCBBcnJheU9wZXJhdGlvbk1hdGNoCiAgQHByaXZhdGUKICBAcGFyYW0ge0Fy
cmF5T3BlcmF0aW9ufSBvcGVyYXRpb24KICBAcGFyYW0ge251bWJlcn0gaW5kZXggVGhlIGluZGV4
IG9mIGBvcGVyYXRpb25gIGluIHRoZSBhcnJheSBvZiBvcGVyYXRpb25zLgogIEBwYXJhbSB7Ym9v
bGVhbn0gc3BsaXQgV2hldGhlciBvciBub3QgdGhlIGl0ZW0gaW5kZXggc2VhcmNoZWQgZm9yIHdv
dWxkCiAgcmVxdWlyZSBhIHNwbGl0IGZvciBhIG5ldyBvcGVyYXRpb24gdHlwZS4KICBAcGFyYW0g
e251bWJlcn0gcmFuZ2VTdGFydCBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIG9w
ZXJhdGlvbiwKICB3aXRoIHJlc3BlY3QgdG8gdGhlIHRyYWNrZWQgYXJyYXkuICBUaGUgaW5kZXgg
b2YgdGhlIGxhc3QgaXRlbSBjYW4gYmUgY29tcHV0ZWQKICBmcm9tIGByYW5nZVN0YXJ0YCBhbmQg
YG9wZXJhdGlvbi5jb3VudGAuCiovCmZ1bmN0aW9uIEFycmF5T3BlcmF0aW9uTWF0Y2gob3BlcmF0
aW9uLCBpbmRleCwgc3BsaXQsIHJhbmdlU3RhcnQpIHsKICB0aGlzLm9wZXJhdGlvbiA9IG9wZXJh
dGlvbjsKICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgdGhpcy5zcGxpdCA9IHNwbGl0OwogIHRoaXMu
cmFuZ2VTdGFydCA9IHJhbmdlU3RhcnQ7Cn0KCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKdmFyIGdl
dCA9IEVtYmVyLmdldCwKICAgIGZvckVhY2ggPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFj
aCwKICAgIFJFVEFJTiA9ICdyJywKICAgIEZJTFRFUiA9ICdmJzsKCmZ1bmN0aW9uIE9wZXJhdGlv
biAodHlwZSwgY291bnQpIHsKICB0aGlzLnR5cGUgPSB0eXBlOwogIHRoaXMuY291bnQgPSBjb3Vu
dDsKfQoKLyoqCiAgQW4gYEVtYmVyLlN1YkFycmF5YCB0cmFja3MgYW4gYXJyYXkgaW4gYSB3YXkg
c2ltaWxhciB0bywgYnV0IG1vcmUgc3BlY2lhbGl6ZWQKICB0aGFuLCBgRW1iZXIuVHJhY2tlZEFy
cmF5YC4gIEl0IGlzIHVzZWZ1bCBmb3Iga2VlcGluZyB0cmFjayBvZiB0aGUgaW5kZXhlcyBvZgog
IGl0ZW1zIHdpdGhpbiBhIGZpbHRlcmVkIGFycmF5LgoKICBAY2xhc3MgU3ViQXJyYXkKICBAbmFt
ZXNwYWNlIEVtYmVyCiovCkVtYmVyLlN1YkFycmF5ID0gZnVuY3Rpb24gKGxlbmd0aCkgewogIGlm
IChhcmd1bWVudHMubGVuZ3RoIDwgMSkgeyBsZW5ndGggPSAwOyB9CgogIGlmIChsZW5ndGggPiAw
KSB7CiAgICB0aGlzLl9vcGVyYXRpb25zID0gW25ldyBPcGVyYXRpb24oUkVUQUlOLCBsZW5ndGgp
XTsKICB9IGVsc2UgewogICAgdGhpcy5fb3BlcmF0aW9ucyA9IFtdOwogIH0KfTsKCkVtYmVyLlN1
YkFycmF5LnByb3RvdHlwZSA9IHsKICAvKioKICAgIFRyYWNrIHRoYXQgYW4gaXRlbSB3YXMgYWRk
ZWQgdG8gdGhlIHRyYWNrZWQgYXJyYXkuCgogICAgQG1ldGhvZCBhZGRJdGVtCgogICAgQHBhcmFt
IHtudW1iZXJ9IGluZGV4IFRoZSBpbmRleCBvZiB0aGUgaXRlbSBpbiB0aGUgdHJhY2tlZCBhcnJh
eS4KICAgIEBwYXJhbSB7Ym9vbGVhbn0gbWF0Y2ggYHRydWVgIGlmZiB0aGUgaXRlbSBpcyBpbmNs
dWRlZCBpbiB0aGUgc3ViYXJyYXkuCgogICAgQHJldHVybiB7bnVtYmVyfSBUaGUgaW5kZXggb2Yg
dGhlIGl0ZW0gaW4gdGhlIHN1YmFycmF5LgogICovCiAgYWRkSXRlbTogZnVuY3Rpb24oaW5kZXgs
IG1hdGNoKSB7CiAgICB2YXIgcmV0dXJuVmFsdWUgPSAtMSwKICAgICAgICBpdGVtVHlwZSA9IG1h
dGNoID8gUkVUQUlOIDogRklMVEVSLAogICAgICAgIHNlbGYgPSB0aGlzOwoKICAgIHRoaXMuX2Zp
bmRPcGVyYXRpb24oaW5kZXgsIGZ1bmN0aW9uKG9wZXJhdGlvbiwgb3BlcmF0aW9uSW5kZXgsIHJh
bmdlU3RhcnQsIHJhbmdlRW5kLCBzZWVuSW5TdWJBcnJheSkgewogICAgICB2YXIgbmV3T3BlcmF0
aW9uLCBzcGxpdE9wZXJhdGlvbjsKCiAgICAgIGlmIChpdGVtVHlwZSA9PT0gb3BlcmF0aW9uLnR5
cGUpIHsKICAgICAgICArK29wZXJhdGlvbi5jb3VudDsKICAgICAgfSBlbHNlIGlmIChpbmRleCA9
PT0gcmFuZ2VTdGFydCkgewogICAgICAgIC8vIGluc2VydCB0byB0aGUgbGVmdCBvZiBgb3BlcmF0
aW9uYAogICAgICAgIHNlbGYuX29wZXJhdGlvbnMuc3BsaWNlKG9wZXJhdGlvbkluZGV4LCAwLCBu
ZXcgT3BlcmF0aW9uKGl0ZW1UeXBlLCAxKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3T3Bl
cmF0aW9uID0gbmV3IE9wZXJhdGlvbihpdGVtVHlwZSwgMSk7CiAgICAgICAgc3BsaXRPcGVyYXRp
b24gPSBuZXcgT3BlcmF0aW9uKG9wZXJhdGlvbi50eXBlLCByYW5nZUVuZCAtIGluZGV4ICsgMSk7
CiAgICAgICAgb3BlcmF0aW9uLmNvdW50ID0gaW5kZXggLSByYW5nZVN0YXJ0OwoKICAgICAgICBz
ZWxmLl9vcGVyYXRpb25zLnNwbGljZShvcGVyYXRpb25JbmRleCArIDEsIDAsIG5ld09wZXJhdGlv
biwgc3BsaXRPcGVyYXRpb24pOwogICAgICB9CgogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICBp
ZiAob3BlcmF0aW9uLnR5cGUgPT09IFJFVEFJTikgewogICAgICAgICAgcmV0dXJuVmFsdWUgPSBz
ZWVuSW5TdWJBcnJheSArIChpbmRleCAtIHJhbmdlU3RhcnQpOwogICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgICByZXR1cm5WYWx1ZSA9IHNlZW5JblN1YkFycmF5OwogICAgICAgIH0KICAgICAgfQoK
ICAgICAgc2VsZi5fY29tcG9zZUF0KG9wZXJhdGlvbkluZGV4KTsKICAgIH0sIGZ1bmN0aW9uKHNl
ZW5JblN1YkFycmF5KSB7CiAgICAgIHNlbGYuX29wZXJhdGlvbnMucHVzaChuZXcgT3BlcmF0aW9u
KGl0ZW1UeXBlLCAxKSk7CgogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICByZXR1cm5WYWx1ZSA9
IHNlZW5JblN1YkFycmF5OwogICAgICB9CgogICAgICBzZWxmLl9jb21wb3NlQXQoc2VsZi5fb3Bl
cmF0aW9ucy5sZW5ndGgtMSk7CiAgICB9KTsKCiAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgfSwK
CiAgLyoqCiAgICBUcmFjayB0aGF0IGFuIGl0ZW0gd2FzIHJlbW92ZWQgZnJvbSB0aGUgdHJhY2tl
ZCBhcnJheS4KCiAgICBAbWV0aG9kIHJlbW92ZUl0ZW0KCiAgICBAcGFyYW0ge251bWJlcn0gaW5k
ZXggVGhlIGluZGV4IG9mIHRoZSBpdGVtIGluIHRoZSB0cmFja2VkIGFycmF5LgoKICAgIEByZXR1
cm4ge251bWJlcn0gVGhlIGluZGV4IG9mIHRoZSBpdGVtIGluIHRoZSBzdWJhcnJheSwgb3IgYC0x
YCBpZiB0aGUgaXRlbQogICAgd2FzIG5vdCBpbiB0aGUgc3ViYXJyYXkuCiAgKi8KICByZW1vdmVJ
dGVtOiBmdW5jdGlvbihpbmRleCkgewogICAgdmFyIHJldHVyblZhbHVlID0gLTEsCiAgICAgICAg
c2VsZiA9IHRoaXM7CgogICAgdGhpcy5fZmluZE9wZXJhdGlvbihpbmRleCwgZnVuY3Rpb24gKG9w
ZXJhdGlvbiwgb3BlcmF0aW9uSW5kZXgsIHJhbmdlU3RhcnQsIHJhbmdlRW5kLCBzZWVuSW5TdWJB
cnJheSkgewogICAgICBpZiAob3BlcmF0aW9uLnR5cGUgPT09IFJFVEFJTikgewogICAgICAgIHJl
dHVyblZhbHVlID0gc2VlbkluU3ViQXJyYXkgKyAoaW5kZXggLSByYW5nZVN0YXJ0KTsKICAgICAg
fQoKICAgICAgaWYgKG9wZXJhdGlvbi5jb3VudCA+IDEpIHsKICAgICAgICAtLW9wZXJhdGlvbi5j
b3VudDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLl9vcGVyYXRpb25zLnNwbGljZShvcGVy
YXRpb25JbmRleCwgMSk7CiAgICAgICAgc2VsZi5fY29tcG9zZUF0KG9wZXJhdGlvbkluZGV4KTsK
ICAgICAgfQogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIHRocm93IG5ldyBFbWJlci5FcnJvcigi
Q2FuJ3QgcmVtb3ZlIGFuIGl0ZW0gdGhhdCBoYXMgbmV2ZXIgYmVlbiBhZGRlZC4iKTsKICAgIH0p
OwoKICAgIHJldHVybiByZXR1cm5WYWx1ZTsKICB9LAoKCiAgX2ZpbmRPcGVyYXRpb246IGZ1bmN0
aW9uIChpbmRleCwgZm91bmRDYWxsYmFjaywgbm90Rm91bmRDYWxsYmFjaykgewogICAgdmFyIG9w
ZXJhdGlvbkluZGV4LAogICAgICAgIGxlbiwKICAgICAgICBvcGVyYXRpb24sCiAgICAgICAgcmFu
Z2VTdGFydCwKICAgICAgICByYW5nZUVuZCwKICAgICAgICBzZWVuSW5TdWJBcnJheSA9IDA7Cgog
ICAgLy8gT1BUSU1JWkU6IGNoYW5nZSB0byBiYWxhbmNlZCB0cmVlCiAgICAvLyBmaW5kIGxlZnRt
b3N0IG9wZXJhdGlvbiB0byB0aGUgcmlnaHQgb2YgYGluZGV4YAogICAgZm9yIChvcGVyYXRpb25J
bmRleCA9IHJhbmdlU3RhcnQgPSAwLCBsZW4gPSB0aGlzLl9vcGVyYXRpb25zLmxlbmd0aDsgb3Bl
cmF0aW9uSW5kZXggPCBsZW47IHJhbmdlU3RhcnQgPSByYW5nZUVuZCArIDEsICsrb3BlcmF0aW9u
SW5kZXgpIHsKICAgICAgb3BlcmF0aW9uID0gdGhpcy5fb3BlcmF0aW9uc1tvcGVyYXRpb25JbmRl
eF07CiAgICAgIHJhbmdlRW5kID0gcmFuZ2VTdGFydCArIG9wZXJhdGlvbi5jb3VudCAtIDE7Cgog
ICAgICBpZiAoaW5kZXggPj0gcmFuZ2VTdGFydCAmJiBpbmRleCA8PSByYW5nZUVuZCkgewogICAg
ICAgIGZvdW5kQ2FsbGJhY2sob3BlcmF0aW9uLCBvcGVyYXRpb25JbmRleCwgcmFuZ2VTdGFydCwg
cmFuZ2VFbmQsIHNlZW5JblN1YkFycmF5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBp
ZiAob3BlcmF0aW9uLnR5cGUgPT09IFJFVEFJTikgewogICAgICAgIHNlZW5JblN1YkFycmF5ICs9
IG9wZXJhdGlvbi5jb3VudDsKICAgICAgfQogICAgfQoKICAgIG5vdEZvdW5kQ2FsbGJhY2soc2Vl
bkluU3ViQXJyYXkpOwogIH0sCgogIF9jb21wb3NlQXQ6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICB2
YXIgb3AgPSB0aGlzLl9vcGVyYXRpb25zW2luZGV4XSwKICAgICAgICBvdGhlck9wOwoKICAgIGlm
ICghb3ApIHsKICAgICAgLy8gQ29tcG9zaW5nIG91dCBvZiBib3VuZHMgaXMgYSBuby1vcCwgYXMg
d2hlbiByZW1vdmluZyB0aGUgbGFzdCBvcGVyYXRpb24KICAgICAgLy8gaW4gdGhlIGxpc3QuCiAg
ICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoaW5kZXggPiAwKSB7CiAgICAgIG90aGVyT3AgPSB0
aGlzLl9vcGVyYXRpb25zW2luZGV4LTFdOwogICAgICBpZiAob3RoZXJPcC50eXBlID09PSBvcC50
eXBlKSB7CiAgICAgICAgb3AuY291bnQgKz0gb3RoZXJPcC5jb3VudDsKICAgICAgICB0aGlzLl9v
cGVyYXRpb25zLnNwbGljZShpbmRleC0xLCAxKTsKICAgICAgICAtLWluZGV4OwogICAgICB9CiAg
ICB9CgogICAgaWYgKGluZGV4IDwgdGhpcy5fb3BlcmF0aW9ucy5sZW5ndGgtMSkgewogICAgICBv
dGhlck9wID0gdGhpcy5fb3BlcmF0aW9uc1tpbmRleCsxXTsKICAgICAgaWYgKG90aGVyT3AudHlw
ZSA9PT0gb3AudHlwZSkgewogICAgICAgIG9wLmNvdW50ICs9IG90aGVyT3AuY291bnQ7CiAgICAg
ICAgdGhpcy5fb3BlcmF0aW9ucy5zcGxpY2UoaW5kZXgrMSwgMSk7CiAgICAgIH0KICAgIH0KICB9
LAoKICB0b1N0cmluZzogZnVuY3Rpb24gKCkgewogICAgdmFyIHN0ciA9ICIiOwogICAgZm9yRWFj
aCh0aGlzLl9vcGVyYXRpb25zLCBmdW5jdGlvbiAob3BlcmF0aW9uKSB7CiAgICAgIHN0ciArPSAi
ICIgKyBvcGVyYXRpb24udHlwZSArICI6IiArIG9wZXJhdGlvbi5jb3VudDsKICAgIH0pOwogICAg
cmV0dXJuIHN0ci5zdWJzdHJpbmcoMSk7CiAgfQp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewpF
bWJlci5Db250YWluZXIgPSByZXF1aXJlTW9kdWxlKCdjb250YWluZXInKTsKRW1iZXIuQ29udGFp
bmVyLnNldCA9IEVtYmVyLnNldDsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKRW1iZXIuQXBwbGlj
YXRpb24gPSBFbWJlci5OYW1lc3BhY2UuZXh0ZW5kKCk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7
Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVudGltZQoqLwoKdmFyIE9VVF9P
Rl9SQU5HRV9FWENFUFRJT04gPSAiSW5kZXggb3V0IG9mIHJhbmdlIjsKdmFyIEVNUFRZID0gW107
Cgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CgovKioKICBBbiBBcnJheVBy
b3h5IHdyYXBzIGFueSBvdGhlciBvYmplY3QgdGhhdCBpbXBsZW1lbnRzIGBFbWJlci5BcnJheWAg
YW5kL29yCiAgYEVtYmVyLk11dGFibGVBcnJheSxgIGZvcndhcmRpbmcgYWxsIHJlcXVlc3RzLiBU
aGlzIG1ha2VzIGl0IHZlcnkgdXNlZnVsIGZvcgogIGEgbnVtYmVyIG9mIGJpbmRpbmcgdXNlIGNh
c2VzIG9yIG90aGVyIGNhc2VzIHdoZXJlIGJlaW5nIGFibGUgdG8gc3dhcAogIG91dCB0aGUgdW5k
ZXJseWluZyBhcnJheSBpcyB1c2VmdWwuCgogIEEgc2ltcGxlIGV4YW1wbGUgb2YgdXNhZ2U6Cgog
IGBgYGphdmFzY3JpcHQKICB2YXIgcGV0cyA9IFsnZG9nJywgJ2NhdCcsICdmaXNoJ107CiAgdmFy
IGFwID0gRW1iZXIuQXJyYXlQcm94eS5jcmVhdGUoeyBjb250ZW50OiBFbWJlci5BKHBldHMpIH0p
OwoKICBhcC5nZXQoJ2ZpcnN0T2JqZWN0Jyk7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gJ2Rv
ZycKICBhcC5zZXQoJ2NvbnRlbnQnLCBbJ2Ftb2ViYScsICdwYXJhbWVjaXVtJ10pOwogIGFwLmdl
dCgnZmlyc3RPYmplY3QnKTsgICAgICAgICAgICAgICAgICAgICAgICAvLyAnYW1vZWJhJwogIGBg
YAoKICBUaGlzIGNsYXNzIGNhbiBhbHNvIGJlIHVzZWZ1bCBhcyBhIGxheWVyIHRvIHRyYW5zZm9y
bSB0aGUgY29udGVudHMgb2YKICBhbiBhcnJheSwgYXMgdGhleSBhcmUgYWNjZXNzZWQuIFRoaXMg
Y2FuIGJlIGRvbmUgYnkgb3ZlcnJpZGluZwogIGBvYmplY3RBdENvbnRlbnRgOgoKICBgYGBqYXZh
c2NyaXB0CiAgdmFyIHBldHMgPSBbJ2RvZycsICdjYXQnLCAnZmlzaCddOwogIHZhciBhcCA9IEVt
YmVyLkFycmF5UHJveHkuY3JlYXRlKHsKICAgICAgY29udGVudDogRW1iZXIuQShwZXRzKSwKICAg
ICAgb2JqZWN0QXRDb250ZW50OiBmdW5jdGlvbihpZHgpIHsKICAgICAgICAgIHJldHVybiB0aGlz
LmdldCgnY29udGVudCcpLm9iamVjdEF0KGlkeCkudG9VcHBlckNhc2UoKTsKICAgICAgfQogIH0p
OwoKICBhcC5nZXQoJ2ZpcnN0T2JqZWN0Jyk7IC8vIC4gJ0RPRycKICBgYGAKCiAgQGNsYXNzIEFy
cmF5UHJveHkKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0CiAgQHVz
ZXMgRW1iZXIuTXV0YWJsZUFycmF5CiovCkVtYmVyLkFycmF5UHJveHkgPSBFbWJlci5PYmplY3Qu
ZXh0ZW5kKEVtYmVyLk11dGFibGVBcnJheSwgewoKICAvKioKICAgIFRoZSBjb250ZW50IGFycmF5
LiBNdXN0IGJlIGFuIG9iamVjdCB0aGF0IGltcGxlbWVudHMgYEVtYmVyLkFycmF5YCBhbmQvb3IK
ICAgIGBFbWJlci5NdXRhYmxlQXJyYXkuYAoKICAgIEBwcm9wZXJ0eSBjb250ZW50CiAgICBAdHlw
ZSBFbWJlci5BcnJheQogICovCiAgY29udGVudDogbnVsbCwKCiAgLyoqCiAgIFRoZSBhcnJheSB0
aGF0IHRoZSBwcm94eSBwcmV0ZW5kcyB0byBiZS4gSW4gdGhlIGRlZmF1bHQgYEFycmF5UHJveHlg
CiAgIGltcGxlbWVudGF0aW9uLCB0aGlzIGFuZCBgY29udGVudGAgYXJlIHRoZSBzYW1lLiBTdWJj
bGFzc2VzIG9mIGBBcnJheVByb3h5YAogICBjYW4gb3ZlcnJpZGUgdGhpcyBwcm9wZXJ0eSB0byBw
cm92aWRlIHRoaW5ncyBsaWtlIHNvcnRpbmcgYW5kIGZpbHRlcmluZy4KCiAgIEBwcm9wZXJ0eSBh
cnJhbmdlZENvbnRlbnQKICAqLwogIGFycmFuZ2VkQ29udGVudDogRW1iZXIuY29tcHV0ZWQuYWxp
YXMoJ2NvbnRlbnQnKSwKCiAgLyoqCiAgICBTaG91bGQgYWN0dWFsbHkgcmV0cmlldmUgdGhlIG9i
amVjdCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IGZyb20gdGhlCiAgICBjb250ZW50LiBZb3UgY2Fu
IG92ZXJyaWRlIHRoaXMgbWV0aG9kIGluIHN1YmNsYXNzZXMgdG8gdHJhbnNmb3JtIHRoZQogICAg
Y29udGVudCBpdGVtIHRvIHNvbWV0aGluZyBuZXcuCgogICAgVGhpcyBtZXRob2Qgd2lsbCBvbmx5
IGJlIGNhbGxlZCBpZiBjb250ZW50IGlzIG5vbi1gbnVsbGAuCgogICAgQG1ldGhvZCBvYmplY3RB
dENvbnRlbnQKICAgIEBwYXJhbSB7TnVtYmVyfSBpZHggVGhlIGluZGV4IHRvIHJldHJpZXZlLgog
ICAgQHJldHVybiB7T2JqZWN0fSB0aGUgdmFsdWUgb3IgdW5kZWZpbmVkIGlmIG5vbmUgZm91bmQK
ICAqLwogIG9iamVjdEF0Q29udGVudDogZnVuY3Rpb24oaWR4KSB7CiAgICByZXR1cm4gZ2V0KHRo
aXMsICdhcnJhbmdlZENvbnRlbnQnKS5vYmplY3RBdChpZHgpOwogIH0sCgogIC8qKgogICAgU2hv
dWxkIGFjdHVhbGx5IHJlcGxhY2UgdGhlIHNwZWNpZmllZCBvYmplY3RzIG9uIHRoZSBjb250ZW50
IGFycmF5LgogICAgWW91IGNhbiBvdmVycmlkZSB0aGlzIG1ldGhvZCBpbiBzdWJjbGFzc2VzIHRv
IHRyYW5zZm9ybSB0aGUgY29udGVudCBpdGVtCiAgICBpbnRvIHNvbWV0aGluZyBuZXcuCgogICAg
VGhpcyBtZXRob2Qgd2lsbCBvbmx5IGJlIGNhbGxlZCBpZiBjb250ZW50IGlzIG5vbi1gbnVsbGAu
CgogICAgQG1ldGhvZCByZXBsYWNlQ29udGVudAogICAgQHBhcmFtIHtOdW1iZXJ9IGlkeCBUaGUg
c3RhcnRpbmcgaW5kZXgKICAgIEBwYXJhbSB7TnVtYmVyfSBhbXQgVGhlIG51bWJlciBvZiBpdGVt
cyB0byByZW1vdmUgZnJvbSB0aGUgY29udGVudC4KICAgIEBwYXJhbSB7QXJyYXl9IG9iamVjdHMg
T3B0aW9uYWwgYXJyYXkgb2Ygb2JqZWN0cyB0byBpbnNlcnQgb3IgbnVsbCBpZiBubwogICAgICBv
YmplY3RzLgogICAgQHJldHVybiB7dm9pZH0KICAqLwogIHJlcGxhY2VDb250ZW50OiBmdW5jdGlv
bihpZHgsIGFtdCwgb2JqZWN0cykgewogICAgZ2V0KHRoaXMsICdjb250ZW50JykucmVwbGFjZShp
ZHgsIGFtdCwgb2JqZWN0cyk7CiAgfSwKCiAgLyoqCiAgICBJbnZva2VkIHdoZW4gdGhlIGNvbnRl
bnQgcHJvcGVydHkgaXMgYWJvdXQgdG8gY2hhbmdlLiBOb3RpZmllcyBvYnNlcnZlcnMgdGhhdCB0
aGUKICAgIGVudGlyZSBhcnJheSBjb250ZW50IHdpbGwgY2hhbmdlLgoKICAgIEBwcml2YXRlCiAg
ICBAbWV0aG9kIF9jb250ZW50V2lsbENoYW5nZQogICovCiAgX2NvbnRlbnRXaWxsQ2hhbmdlOiBF
bWJlci5iZWZvcmVPYnNlcnZlcignY29udGVudCcsIGZ1bmN0aW9uKCkgewogICAgdGhpcy5fdGVh
cmRvd25Db250ZW50KCk7CiAgfSksCgogIF90ZWFyZG93bkNvbnRlbnQ6IGZ1bmN0aW9uKCkgewog
ICAgdmFyIGNvbnRlbnQgPSBnZXQodGhpcywgJ2NvbnRlbnQnKTsKCiAgICBpZiAoY29udGVudCkg
ewogICAgICBjb250ZW50LnJlbW92ZUFycmF5T2JzZXJ2ZXIodGhpcywgewogICAgICAgIHdpbGxD
aGFuZ2U6ICdjb250ZW50QXJyYXlXaWxsQ2hhbmdlJywKICAgICAgICBkaWRDaGFuZ2U6ICdjb250
ZW50QXJyYXlEaWRDaGFuZ2UnCiAgICAgIH0pOwogICAgfQogIH0sCgogIGNvbnRlbnRBcnJheVdp
bGxDaGFuZ2U6IEVtYmVyLkssCiAgY29udGVudEFycmF5RGlkQ2hhbmdlOiBFbWJlci5LLAoKICAv
KioKICAgIEludm9rZWQgd2hlbiB0aGUgY29udGVudCBwcm9wZXJ0eSBjaGFuZ2VzLiBOb3RpZmll
cyBvYnNlcnZlcnMgdGhhdCB0aGUKICAgIGVudGlyZSBhcnJheSBjb250ZW50IGhhcyBjaGFuZ2Vk
LgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIF9jb250ZW50RGlkQ2hhbmdlCiAgKi8KICBfY29u
dGVudERpZENoYW5nZTogRW1iZXIub2JzZXJ2ZXIoJ2NvbnRlbnQnLCBmdW5jdGlvbigpIHsKICAg
IHZhciBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50Jyk7CgogICAgRW1iZXIuYXNzZXJ0KCJD
YW4ndCBzZXQgQXJyYXlQcm94eSdzIGNvbnRlbnQgdG8gaXRzZWxmIiwgY29udGVudCAhPT0gdGhp
cyk7CgogICAgdGhpcy5fc2V0dXBDb250ZW50KCk7CiAgfSksCgogIF9zZXR1cENvbnRlbnQ6IGZ1
bmN0aW9uKCkgewogICAgdmFyIGNvbnRlbnQgPSBnZXQodGhpcywgJ2NvbnRlbnQnKTsKCiAgICBp
ZiAoY29udGVudCkgewogICAgICBjb250ZW50LmFkZEFycmF5T2JzZXJ2ZXIodGhpcywgewogICAg
ICAgIHdpbGxDaGFuZ2U6ICdjb250ZW50QXJyYXlXaWxsQ2hhbmdlJywKICAgICAgICBkaWRDaGFu
Z2U6ICdjb250ZW50QXJyYXlEaWRDaGFuZ2UnCiAgICAgIH0pOwogICAgfQogIH0sCgogIF9hcnJh
bmdlZENvbnRlbnRXaWxsQ2hhbmdlOiBFbWJlci5iZWZvcmVPYnNlcnZlcignYXJyYW5nZWRDb250
ZW50JywgZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJyYW5nZWRDb250ZW50ID0gZ2V0KHRoaXMsICdh
cnJhbmdlZENvbnRlbnQnKSwKICAgICAgICBsZW4gPSBhcnJhbmdlZENvbnRlbnQgPyBnZXQoYXJy
YW5nZWRDb250ZW50LCAnbGVuZ3RoJykgOiAwOwoKICAgIHRoaXMuYXJyYW5nZWRDb250ZW50QXJy
YXlXaWxsQ2hhbmdlKHRoaXMsIDAsIGxlbiwgdW5kZWZpbmVkKTsKICAgIHRoaXMuYXJyYW5nZWRD
b250ZW50V2lsbENoYW5nZSh0aGlzKTsKCiAgICB0aGlzLl90ZWFyZG93bkFycmFuZ2VkQ29udGVu
dChhcnJhbmdlZENvbnRlbnQpOwogIH0pLAoKICBfYXJyYW5nZWRDb250ZW50RGlkQ2hhbmdlOiBF
bWJlci5vYnNlcnZlcignYXJyYW5nZWRDb250ZW50JywgZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJy
YW5nZWRDb250ZW50ID0gZ2V0KHRoaXMsICdhcnJhbmdlZENvbnRlbnQnKSwKICAgICAgICBsZW4g
PSBhcnJhbmdlZENvbnRlbnQgPyBnZXQoYXJyYW5nZWRDb250ZW50LCAnbGVuZ3RoJykgOiAwOwoK
ICAgIEVtYmVyLmFzc2VydCgiQ2FuJ3Qgc2V0IEFycmF5UHJveHkncyBjb250ZW50IHRvIGl0c2Vs
ZiIsIGFycmFuZ2VkQ29udGVudCAhPT0gdGhpcyk7CgogICAgdGhpcy5fc2V0dXBBcnJhbmdlZENv
bnRlbnQoKTsKCiAgICB0aGlzLmFycmFuZ2VkQ29udGVudERpZENoYW5nZSh0aGlzKTsKICAgIHRo
aXMuYXJyYW5nZWRDb250ZW50QXJyYXlEaWRDaGFuZ2UodGhpcywgMCwgdW5kZWZpbmVkLCBsZW4p
OwogIH0pLAoKICBfc2V0dXBBcnJhbmdlZENvbnRlbnQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIGFy
cmFuZ2VkQ29udGVudCA9IGdldCh0aGlzLCAnYXJyYW5nZWRDb250ZW50Jyk7CgogICAgaWYgKGFy
cmFuZ2VkQ29udGVudCkgewogICAgICBhcnJhbmdlZENvbnRlbnQuYWRkQXJyYXlPYnNlcnZlcih0
aGlzLCB7CiAgICAgICAgd2lsbENoYW5nZTogJ2FycmFuZ2VkQ29udGVudEFycmF5V2lsbENoYW5n
ZScsCiAgICAgICAgZGlkQ2hhbmdlOiAnYXJyYW5nZWRDb250ZW50QXJyYXlEaWRDaGFuZ2UnCiAg
ICAgIH0pOwogICAgfQogIH0sCgogIF90ZWFyZG93bkFycmFuZ2VkQ29udGVudDogZnVuY3Rpb24o
KSB7CiAgICB2YXIgYXJyYW5nZWRDb250ZW50ID0gZ2V0KHRoaXMsICdhcnJhbmdlZENvbnRlbnQn
KTsKCiAgICBpZiAoYXJyYW5nZWRDb250ZW50KSB7CiAgICAgIGFycmFuZ2VkQ29udGVudC5yZW1v
dmVBcnJheU9ic2VydmVyKHRoaXMsIHsKICAgICAgICB3aWxsQ2hhbmdlOiAnYXJyYW5nZWRDb250
ZW50QXJyYXlXaWxsQ2hhbmdlJywKICAgICAgICBkaWRDaGFuZ2U6ICdhcnJhbmdlZENvbnRlbnRB
cnJheURpZENoYW5nZScKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgYXJyYW5nZWRDb250ZW50V2ls
bENoYW5nZTogRW1iZXIuSywKICBhcnJhbmdlZENvbnRlbnREaWRDaGFuZ2U6IEVtYmVyLkssCgog
IG9iamVjdEF0OiBmdW5jdGlvbihpZHgpIHsKICAgIHJldHVybiBnZXQodGhpcywgJ2NvbnRlbnQn
KSAmJiB0aGlzLm9iamVjdEF0Q29udGVudChpZHgpOwogIH0sCgogIGxlbmd0aDogRW1iZXIuY29t
cHV0ZWQoZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJyYW5nZWRDb250ZW50ID0gZ2V0KHRoaXMsICdh
cnJhbmdlZENvbnRlbnQnKTsKICAgIHJldHVybiBhcnJhbmdlZENvbnRlbnQgPyBnZXQoYXJyYW5n
ZWRDb250ZW50LCAnbGVuZ3RoJykgOiAwOwogICAgLy8gTm8gZGVwZW5kZW5jaWVzIHNpbmNlIEVu
dW1lcmFibGUgbm90aWZpZXMgbGVuZ3RoIG9mIGNoYW5nZQogIH0pLAoKICBfcmVwbGFjZTogZnVu
Y3Rpb24oaWR4LCBhbXQsIG9iamVjdHMpIHsKICAgIHZhciBjb250ZW50ID0gZ2V0KHRoaXMsICdj
b250ZW50Jyk7CiAgICBFbWJlci5hc3NlcnQoJ1RoZSBjb250ZW50IHByb3BlcnR5IG9mICcrIHRo
aXMuY29uc3RydWN0b3IgKyAnIHNob3VsZCBiZSBzZXQgYmVmb3JlIG1vZGlmeWluZyBpdCcsIGNv
bnRlbnQpOwogICAgaWYgKGNvbnRlbnQpIHRoaXMucmVwbGFjZUNvbnRlbnQoaWR4LCBhbXQsIG9i
amVjdHMpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgcmVwbGFjZTogZnVuY3Rpb24oKSB7CiAg
ICBpZiAoZ2V0KHRoaXMsICdhcnJhbmdlZENvbnRlbnQnKSA9PT0gZ2V0KHRoaXMsICdjb250ZW50
JykpIHsKICAgICAgdGhpcy5fcmVwbGFjZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSBl
bHNlIHsKICAgICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCJVc2luZyByZXBsYWNlIG9uIGFuIGFy
cmFuZ2VkIEFycmF5UHJveHkgaXMgbm90IGFsbG93ZWQuIik7CiAgICB9CiAgfSwKCiAgX2luc2Vy
dEF0OiBmdW5jdGlvbihpZHgsIG9iamVjdCkgewogICAgaWYgKGlkeCA+IGdldCh0aGlzLCAnY29u
dGVudC5sZW5ndGgnKSkgdGhyb3cgbmV3IEVtYmVyLkVycm9yKE9VVF9PRl9SQU5HRV9FWENFUFRJ
T04pOwogICAgdGhpcy5fcmVwbGFjZShpZHgsIDAsIFtvYmplY3RdKTsKICAgIHJldHVybiB0aGlz
OwogIH0sCgogIGluc2VydEF0OiBmdW5jdGlvbihpZHgsIG9iamVjdCkgewogICAgaWYgKGdldCh0
aGlzLCAnYXJyYW5nZWRDb250ZW50JykgPT09IGdldCh0aGlzLCAnY29udGVudCcpKSB7CiAgICAg
IHJldHVybiB0aGlzLl9pbnNlcnRBdChpZHgsIG9iamVjdCk7CiAgICB9IGVsc2UgewogICAgICB0
aHJvdyBuZXcgRW1iZXIuRXJyb3IoIlVzaW5nIGluc2VydEF0IG9uIGFuIGFycmFuZ2VkIEFycmF5
UHJveHkgaXMgbm90IGFsbG93ZWQuIik7CiAgICB9CiAgfSwKCiAgcmVtb3ZlQXQ6IGZ1bmN0aW9u
KHN0YXJ0LCBsZW4pIHsKICAgIGlmICgnbnVtYmVyJyA9PT0gdHlwZW9mIHN0YXJ0KSB7CiAgICAg
IHZhciBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50JyksCiAgICAgICAgICBhcnJhbmdlZENv
bnRlbnQgPSBnZXQodGhpcywgJ2FycmFuZ2VkQ29udGVudCcpLAogICAgICAgICAgaW5kaWNlcyA9
IFtdLCBpOwoKICAgICAgaWYgKChzdGFydCA8IDApIHx8IChzdGFydCA+PSBnZXQodGhpcywgJ2xl
bmd0aCcpKSkgewogICAgICAgIHRocm93IG5ldyBFbWJlci5FcnJvcihPVVRfT0ZfUkFOR0VfRVhD
RVBUSU9OKTsKICAgICAgfQoKICAgICAgaWYgKGxlbiA9PT0gdW5kZWZpbmVkKSBsZW4gPSAxOwoK
ICAgICAgLy8gR2V0IGEgbGlzdCBvZiBpbmRpY2VzIGluIG9yaWdpbmFsIGNvbnRlbnQgdG8gcmVt
b3ZlCiAgICAgIGZvciAoaT1zdGFydDsgaTxzdGFydCtsZW47IGkrKykgewogICAgICAgIC8vIFVz
ZSBhcnJhbmdlZENvbnRlbnQgaGVyZSBzbyB3ZSBhdm9pZCBjb25mdXNpb24gd2l0aCBvYmplY3Rz
IHRyYW5zZm9ybWVkIGJ5IG9iamVjdEF0Q29udGVudAogICAgICAgIGluZGljZXMucHVzaChjb250
ZW50LmluZGV4T2YoYXJyYW5nZWRDb250ZW50Lm9iamVjdEF0KGkpKSk7CiAgICAgIH0KCiAgICAg
IC8vIFJlcGxhY2UgaW4gcmV2ZXJzZSBvcmRlciBzaW5jZSBpbmRpY2VzIHdpbGwgY2hhbmdlCiAg
ICAgIGluZGljZXMuc29ydChmdW5jdGlvbihhLGIpIHsgcmV0dXJuIGIgLSBhOyB9KTsKCiAgICAg
IEVtYmVyLmJlZ2luUHJvcGVydHlDaGFuZ2VzKCk7CiAgICAgIGZvciAoaT0wOyBpPGluZGljZXMu
bGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLl9yZXBsYWNlKGluZGljZXNbaV0sIDEsIEVNUFRZ
KTsKICAgICAgfQogICAgICBFbWJlci5lbmRQcm9wZXJ0eUNoYW5nZXMoKTsKICAgIH0KCiAgICBy
ZXR1cm4gdGhpcyA7CiAgfSwKCiAgcHVzaE9iamVjdDogZnVuY3Rpb24ob2JqKSB7CiAgICB0aGlz
Ll9pbnNlcnRBdChnZXQodGhpcywgJ2NvbnRlbnQubGVuZ3RoJyksIG9iaikgOwogICAgcmV0dXJu
IG9iaiA7CiAgfSwKCiAgcHVzaE9iamVjdHM6IGZ1bmN0aW9uKG9iamVjdHMpIHsKICAgIGlmICgh
KEVtYmVyLkVudW1lcmFibGUuZGV0ZWN0KG9iamVjdHMpIHx8IEVtYmVyLmlzQXJyYXkob2JqZWN0
cykpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIk11c3QgcGFzcyBFbWJlci5FbnVtZXJh
YmxlIHRvIEVtYmVyLk11dGFibGVBcnJheSNwdXNoT2JqZWN0cyIpOwogICAgfQogICAgdGhpcy5f
cmVwbGFjZShnZXQodGhpcywgJ2xlbmd0aCcpLCAwLCBvYmplY3RzKTsKICAgIHJldHVybiB0aGlz
OwogIH0sCgogIHNldE9iamVjdHM6IGZ1bmN0aW9uKG9iamVjdHMpIHsKICAgIGlmIChvYmplY3Rz
Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRoaXMuY2xlYXIoKTsKCiAgICB2YXIgbGVuID0gZ2V0KHRo
aXMsICdsZW5ndGgnKTsKICAgIHRoaXMuX3JlcGxhY2UoMCwgbGVuLCBvYmplY3RzKTsKICAgIHJl
dHVybiB0aGlzOwogIH0sCgogIHVuc2hpZnRPYmplY3Q6IGZ1bmN0aW9uKG9iaikgewogICAgdGhp
cy5faW5zZXJ0QXQoMCwgb2JqKSA7CiAgICByZXR1cm4gb2JqIDsKICB9LAoKICB1bnNoaWZ0T2Jq
ZWN0czogZnVuY3Rpb24ob2JqZWN0cykgewogICAgdGhpcy5fcmVwbGFjZSgwLCAwLCBvYmplY3Rz
KTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIHNsaWNlOiBmdW5jdGlvbigpIHsKICAgIHZhciBh
cnIgPSB0aGlzLnRvQXJyYXkoKTsKICAgIHJldHVybiBhcnIuc2xpY2UuYXBwbHkoYXJyLCBhcmd1
bWVudHMpOwogIH0sCgogIGFycmFuZ2VkQ29udGVudEFycmF5V2lsbENoYW5nZTogZnVuY3Rpb24o
aXRlbSwgaWR4LCByZW1vdmVkQ250LCBhZGRlZENudCkgewogICAgdGhpcy5hcnJheUNvbnRlbnRX
aWxsQ2hhbmdlKGlkeCwgcmVtb3ZlZENudCwgYWRkZWRDbnQpOwogIH0sCgogIGFycmFuZ2VkQ29u
dGVudEFycmF5RGlkQ2hhbmdlOiBmdW5jdGlvbihpdGVtLCBpZHgsIHJlbW92ZWRDbnQsIGFkZGVk
Q250KSB7CiAgICB0aGlzLmFycmF5Q29udGVudERpZENoYW5nZShpZHgsIHJlbW92ZWRDbnQsIGFk
ZGVkQ250KTsKICB9LAoKICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3N1cGVyKCk7CiAg
ICB0aGlzLl9zZXR1cENvbnRlbnQoKTsKICAgIHRoaXMuX3NldHVwQXJyYW5nZWRDb250ZW50KCk7
CiAgfSwKCiAgd2lsbERlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fdGVhcmRvd25BcnJh
bmdlZENvbnRlbnQoKTsKICAgIHRoaXMuX3RlYXJkb3duQ29udGVudCgpOwogIH0KfSk7Cgp9KSgp
OwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVu
dGltZQoqLwoKCnZhciBzZXQgPSBFbWJlci5zZXQsIGdldCA9IEVtYmVyLmdldCwgZ3VpZEZvciA9
IEVtYmVyLmd1aWRGb3I7CnZhciBmb3JFYWNoID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmZvckVh
Y2gsCiAgICBpbmRleE9mID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMuaW5kZXhPZjsKCnZhciBFYWNo
QXJyYXkgPSBFbWJlci5PYmplY3QuZXh0ZW5kKEVtYmVyLkFycmF5LCB7CgogIGluaXQ6IGZ1bmN0
aW9uKGNvbnRlbnQsIGtleU5hbWUsIG93bmVyKSB7CiAgICB0aGlzLl9zdXBlcigpOwogICAgdGhp
cy5fa2V5TmFtZSA9IGtleU5hbWU7CiAgICB0aGlzLl9vd25lciAgID0gb3duZXI7CiAgICB0aGlz
Ll9jb250ZW50ID0gY29udGVudDsKICB9LAoKICBvYmplY3RBdDogZnVuY3Rpb24oaWR4KSB7CiAg
ICB2YXIgaXRlbSA9IHRoaXMuX2NvbnRlbnQub2JqZWN0QXQoaWR4KTsKICAgIHJldHVybiBpdGVt
ICYmIGdldChpdGVtLCB0aGlzLl9rZXlOYW1lKTsKICB9LAoKICBsZW5ndGg6IEVtYmVyLmNvbXB1
dGVkKGZ1bmN0aW9uKCkgewogICAgdmFyIGNvbnRlbnQgPSB0aGlzLl9jb250ZW50OwogICAgcmV0
dXJuIGNvbnRlbnQgPyBnZXQoY29udGVudCwgJ2xlbmd0aCcpIDogMDsKICB9KQoKfSk7Cgp2YXIg
SVNfT0JTRVJWRVIgPSAvXi4rOihiZWZvcmV8Y2hhbmdlKSQvOwoKZnVuY3Rpb24gYWRkT2JzZXJ2
ZXJGb3JDb250ZW50S2V5KGNvbnRlbnQsIGtleU5hbWUsIHByb3h5LCBpZHgsIGxvYykgewogIHZh
ciBvYmplY3RzID0gcHJveHkuX29iamVjdHMsIGd1aWQ7CiAgaWYgKCFvYmplY3RzKSBvYmplY3Rz
ID0gcHJveHkuX29iamVjdHMgPSB7fTsKCiAgd2hpbGUoLS1sb2M+PWlkeCkgewogICAgdmFyIGl0
ZW0gPSBjb250ZW50Lm9iamVjdEF0KGxvYyk7CiAgICBpZiAoaXRlbSkgewogICAgICBFbWJlci5h
c3NlcnQoJ1doZW4gdXNpbmcgQGVhY2ggdG8gb2JzZXJ2ZSB0aGUgYXJyYXkgJyArIGNvbnRlbnQg
KyAnLCB0aGUgYXJyYXkgbXVzdCByZXR1cm4gYW4gb2JqZWN0JywgRW1iZXIudHlwZU9mKGl0ZW0p
ID09PSAnaW5zdGFuY2UnIHx8IEVtYmVyLnR5cGVPZihpdGVtKSA9PT0gJ29iamVjdCcpOwogICAg
ICBFbWJlci5hZGRCZWZvcmVPYnNlcnZlcihpdGVtLCBrZXlOYW1lLCBwcm94eSwgJ2NvbnRlbnRL
ZXlXaWxsQ2hhbmdlJyk7CiAgICAgIEVtYmVyLmFkZE9ic2VydmVyKGl0ZW0sIGtleU5hbWUsIHBy
b3h5LCAnY29udGVudEtleURpZENoYW5nZScpOwoKICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUg
aW5kZXggZWFjaCBpdGVtIHdhcyBmb3VuZCBhdCBzbyB3ZSBjYW4gbWFwCiAgICAgIC8vIGl0IGJh
Y2sgd2hlbiB0aGUgb2JqIGNoYW5nZXMuCiAgICAgIGd1aWQgPSBndWlkRm9yKGl0ZW0pOwogICAg
ICBpZiAoIW9iamVjdHNbZ3VpZF0pIG9iamVjdHNbZ3VpZF0gPSBbXTsKICAgICAgb2JqZWN0c1tn
dWlkXS5wdXNoKGxvYyk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiByZW1vdmVPYnNlcnZlckZvckNv
bnRlbnRLZXkoY29udGVudCwga2V5TmFtZSwgcHJveHksIGlkeCwgbG9jKSB7CiAgdmFyIG9iamVj
dHMgPSBwcm94eS5fb2JqZWN0czsKICBpZiAoIW9iamVjdHMpIG9iamVjdHMgPSBwcm94eS5fb2Jq
ZWN0cyA9IHt9OwogIHZhciBpbmRpY2llcywgZ3VpZDsKCiAgd2hpbGUoLS1sb2M+PWlkeCkgewog
ICAgdmFyIGl0ZW0gPSBjb250ZW50Lm9iamVjdEF0KGxvYyk7CiAgICBpZiAoaXRlbSkgewogICAg
ICBFbWJlci5yZW1vdmVCZWZvcmVPYnNlcnZlcihpdGVtLCBrZXlOYW1lLCBwcm94eSwgJ2NvbnRl
bnRLZXlXaWxsQ2hhbmdlJyk7CiAgICAgIEVtYmVyLnJlbW92ZU9ic2VydmVyKGl0ZW0sIGtleU5h
bWUsIHByb3h5LCAnY29udGVudEtleURpZENoYW5nZScpOwoKICAgICAgZ3VpZCA9IGd1aWRGb3Io
aXRlbSk7CiAgICAgIGluZGljaWVzID0gb2JqZWN0c1tndWlkXTsKICAgICAgaW5kaWNpZXNbaW5k
ZXhPZi5jYWxsKGluZGljaWVzLCBsb2MpXSA9IG51bGw7CiAgICB9CiAgfQp9CgovKioKICBUaGlz
IGlzIHRoZSBvYmplY3QgaW5zdGFuY2UgcmV0dXJuZWQgd2hlbiB5b3UgZ2V0IHRoZSBgQGVhY2hg
IHByb3BlcnR5IG9uIGFuCiAgYXJyYXkuIEl0IHVzZXMgdGhlIHVua25vd25Qcm9wZXJ0eSBoYW5k
bGVyIHRvIGF1dG9tYXRpY2FsbHkgY3JlYXRlCiAgRWFjaEFycmF5IGluc3RhbmNlcyBmb3IgcHJv
cGVydHkgbmFtZXMuCgogIEBwcml2YXRlCiAgQGNsYXNzIEVhY2hQcm94eQogIEBuYW1lc3BhY2Ug
RW1iZXIKICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKKi8KRW1iZXIuRWFjaFByb3h5ID0gRW1iZXIu
T2JqZWN0LmV4dGVuZCh7CgogIGluaXQ6IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgIHRoaXMuX3N1
cGVyKCk7CiAgICB0aGlzLl9jb250ZW50ID0gY29udGVudDsKICAgIGNvbnRlbnQuYWRkQXJyYXlP
YnNlcnZlcih0aGlzKTsKCiAgICAvLyBpbiBjYXNlIHNvbWVvbmUgaXMgYWxyZWFkeSBvYnNlcnZp
bmcgc29tZSBrZXlzIG1ha2Ugc3VyZSB0aGV5IGFyZQogICAgLy8gYWRkZWQKICAgIGZvckVhY2go
RW1iZXIud2F0Y2hlZEV2ZW50cyh0aGlzKSwgZnVuY3Rpb24oZXZlbnROYW1lKSB7CiAgICAgIHRo
aXMuZGlkQWRkTGlzdGVuZXIoZXZlbnROYW1lKTsKICAgIH0sIHRoaXMpOwogIH0sCgogIC8qKgog
ICAgWW91IGNhbiBkaXJlY3RseSBhY2Nlc3MgbWFwcGVkIHByb3BlcnRpZXMgYnkgc2ltcGx5IHJl
cXVlc3RpbmcgdGhlbS4KICAgIFRoZSBgdW5rbm93blByb3BlcnR5YCBoYW5kbGVyIHdpbGwgZ2Vu
ZXJhdGUgYW4gRWFjaEFycmF5IG9mIGVhY2ggaXRlbS4KCiAgICBAbWV0aG9kIHVua25vd25Qcm9w
ZXJ0eQogICAgQHBhcmFtIGtleU5hbWUge1N0cmluZ30KICAgIEBwYXJhbSB2YWx1ZSB7Kn0KICAq
LwogIHVua25vd25Qcm9wZXJ0eTogZnVuY3Rpb24oa2V5TmFtZSwgdmFsdWUpIHsKICAgIHZhciBy
ZXQ7CiAgICByZXQgPSBuZXcgRWFjaEFycmF5KHRoaXMuX2NvbnRlbnQsIGtleU5hbWUsIHRoaXMp
OwogICAgRW1iZXIuZGVmaW5lUHJvcGVydHkodGhpcywga2V5TmFtZSwgbnVsbCwgcmV0KTsKICAg
IHRoaXMuYmVnaW5PYnNlcnZpbmdDb250ZW50S2V5KGtleU5hbWUpOwogICAgcmV0dXJuIHJldDsK
ICB9LAoKICAvLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uCiAgLy8gQVJSQVkgQ0hBTkdFUwogIC8vIEludm9rZXMgd2hlbmV2ZXIgdGhl
IGNvbnRlbnQgYXJyYXkgaXRzZWxmIGNoYW5nZXMuCgogIGFycmF5V2lsbENoYW5nZTogZnVuY3Rp
b24oY29udGVudCwgaWR4LCByZW1vdmVkQ250LCBhZGRlZENudCkgewogICAgdmFyIGtleXMgPSB0
aGlzLl9rZXlzLCBrZXksIGxpbTsKCiAgICBsaW0gPSByZW1vdmVkQ250PjAgPyBpZHgrcmVtb3Zl
ZENudCA6IC0xOwogICAgRW1iZXIuYmVnaW5Qcm9wZXJ0eUNoYW5nZXModGhpcyk7CgogICAgZm9y
KGtleSBpbiBrZXlzKSB7CiAgICAgIGlmICgha2V5cy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7IGNv
bnRpbnVlOyB9CgogICAgICBpZiAobGltPjApIHsgcmVtb3ZlT2JzZXJ2ZXJGb3JDb250ZW50S2V5
KGNvbnRlbnQsIGtleSwgdGhpcywgaWR4LCBsaW0pOyB9CgogICAgICBFbWJlci5wcm9wZXJ0eVdp
bGxDaGFuZ2UodGhpcywga2V5KTsKICAgIH0KCiAgICBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2Uo
dGhpcy5fY29udGVudCwgJ0BlYWNoJyk7CiAgICBFbWJlci5lbmRQcm9wZXJ0eUNoYW5nZXModGhp
cyk7CiAgfSwKCiAgYXJyYXlEaWRDaGFuZ2U6IGZ1bmN0aW9uKGNvbnRlbnQsIGlkeCwgcmVtb3Zl
ZENudCwgYWRkZWRDbnQpIHsKICAgIHZhciBrZXlzID0gdGhpcy5fa2V5cywgbGltOwoKICAgIGxp
bSA9IGFkZGVkQ250PjAgPyBpZHgrYWRkZWRDbnQgOiAtMTsKICAgIEVtYmVyLmNoYW5nZVByb3Bl
cnRpZXMoZnVuY3Rpb24oKSB7CiAgICAgIGZvcih2YXIga2V5IGluIGtleXMpIHsKICAgICAgICBp
ZiAoIWtleXMuaGFzT3duUHJvcGVydHkoa2V5KSkgeyBjb250aW51ZTsgfQoKICAgICAgICBpZiAo
bGltPjApIHsgYWRkT2JzZXJ2ZXJGb3JDb250ZW50S2V5KGNvbnRlbnQsIGtleSwgdGhpcywgaWR4
LCBsaW0pOyB9CgogICAgICAgIEVtYmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMsIGtleSk7CiAg
ICAgIH0KCiAgICAgIEVtYmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMuX2NvbnRlbnQsICdAZWFj
aCcpOwogICAgfSwgdGhpcyk7CiAgfSwKCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogIC8vIExJU1RFTiBGT1IgTkVXIE9CU0VS
VkVSUyBBTkQgT1RIRVIgRVZFTlQgTElTVEVORVJTCiAgLy8gU3RhcnQgbW9uaXRvcmluZyBrZXlz
IGJhc2VkIG9uIHdobyBpcyBsaXN0ZW5pbmcuLi4KCiAgZGlkQWRkTGlzdGVuZXI6IGZ1bmN0aW9u
KGV2ZW50TmFtZSkgewogICAgaWYgKElTX09CU0VSVkVSLnRlc3QoZXZlbnROYW1lKSkgewogICAg
ICB0aGlzLmJlZ2luT2JzZXJ2aW5nQ29udGVudEtleShldmVudE5hbWUuc2xpY2UoMCwgLTcpKTsK
ICAgIH0KICB9LAoKICBkaWRSZW1vdmVMaXN0ZW5lcjogZnVuY3Rpb24oZXZlbnROYW1lKSB7CiAg
ICBpZiAoSVNfT0JTRVJWRVIudGVzdChldmVudE5hbWUpKSB7CiAgICAgIHRoaXMuc3RvcE9ic2Vy
dmluZ0NvbnRlbnRLZXkoZXZlbnROYW1lLnNsaWNlKDAsIC03KSk7CiAgICB9CiAgfSwKCiAgLy8g
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
LgogIC8vIENPTlRFTlQgS0VZIE9CU0VSVklORwogIC8vIEFjdHVhbCB3YXRjaCBrZXlzIG9uIHRo
ZSBzb3VyY2UgY29udGVudC4KCiAgYmVnaW5PYnNlcnZpbmdDb250ZW50S2V5OiBmdW5jdGlvbihr
ZXlOYW1lKSB7CiAgICB2YXIga2V5cyA9IHRoaXMuX2tleXM7CiAgICBpZiAoIWtleXMpIGtleXMg
PSB0aGlzLl9rZXlzID0ge307CiAgICBpZiAoIWtleXNba2V5TmFtZV0pIHsKICAgICAga2V5c1tr
ZXlOYW1lXSA9IDE7CiAgICAgIHZhciBjb250ZW50ID0gdGhpcy5fY29udGVudCwKICAgICAgICAg
IGxlbiA9IGdldChjb250ZW50LCAnbGVuZ3RoJyk7CiAgICAgIGFkZE9ic2VydmVyRm9yQ29udGVu
dEtleShjb250ZW50LCBrZXlOYW1lLCB0aGlzLCAwLCBsZW4pOwogICAgfSBlbHNlIHsKICAgICAg
a2V5c1trZXlOYW1lXSsrOwogICAgfQogIH0sCgogIHN0b3BPYnNlcnZpbmdDb250ZW50S2V5OiBm
dW5jdGlvbihrZXlOYW1lKSB7CiAgICB2YXIga2V5cyA9IHRoaXMuX2tleXM7CiAgICBpZiAoa2V5
cyAmJiAoa2V5c1trZXlOYW1lXT4wKSAmJiAoLS1rZXlzW2tleU5hbWVdPD0wKSkgewogICAgICB2
YXIgY29udGVudCA9IHRoaXMuX2NvbnRlbnQsCiAgICAgICAgICBsZW4gICAgID0gZ2V0KGNvbnRl
bnQsICdsZW5ndGgnKTsKICAgICAgcmVtb3ZlT2JzZXJ2ZXJGb3JDb250ZW50S2V5KGNvbnRlbnQs
IGtleU5hbWUsIHRoaXMsIDAsIGxlbik7CiAgICB9CiAgfSwKCiAgY29udGVudEtleVdpbGxDaGFu
Z2U6IGZ1bmN0aW9uKG9iaiwga2V5TmFtZSkgewogICAgRW1iZXIucHJvcGVydHlXaWxsQ2hhbmdl
KHRoaXMsIGtleU5hbWUpOwogIH0sCgogIGNvbnRlbnRLZXlEaWRDaGFuZ2U6IGZ1bmN0aW9uKG9i
aiwga2V5TmFtZSkgewogICAgRW1iZXIucHJvcGVydHlEaWRDaGFuZ2UodGhpcywga2V5TmFtZSk7
CiAgfQoKfSk7CgoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1
Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1i
ZXIuc2V0LCByZXBsYWNlID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLl9yZXBsYWNlOwoKLy8gQWRk
IEVtYmVyLkFycmF5IHRvIEFycmF5LnByb3RvdHlwZS4gUmVtb3ZlIG1ldGhvZHMgd2l0aCBuYXRp
dmUKLy8gaW1wbGVtZW50YXRpb25zIGFuZCBzdXBwbHkgc29tZSBtb3JlIG9wdGltaXplZCB2ZXJz
aW9ucyBvZiBnZW5lcmljIG1ldGhvZHMKLy8gYmVjYXVzZSB0aGV5IGFyZSBzbyBjb21tb24uCnZh
ciBOYXRpdmVBcnJheSA9IEVtYmVyLk1peGluLmNyZWF0ZShFbWJlci5NdXRhYmxlQXJyYXksIEVt
YmVyLk9ic2VydmFibGUsIEVtYmVyLkNvcHlhYmxlLCB7CgogIC8vIGJlY2F1c2UgbGVuZ3RoIGlz
IGEgYnVpbHQtaW4gcHJvcGVydHkgd2UgbmVlZCB0byBrbm93IHRvIGp1c3QgZ2V0IHRoZQogIC8v
IG9yaWdpbmFsIHByb3BlcnR5LgogIGdldDogZnVuY3Rpb24oa2V5KSB7CiAgICBpZiAoa2V5PT09
J2xlbmd0aCcpIHJldHVybiB0aGlzLmxlbmd0aDsKICAgIGVsc2UgaWYgKCdudW1iZXInID09PSB0
eXBlb2Yga2V5KSByZXR1cm4gdGhpc1trZXldOwogICAgZWxzZSByZXR1cm4gdGhpcy5fc3VwZXIo
a2V5KTsKICB9LAoKICBvYmplY3RBdDogZnVuY3Rpb24oaWR4KSB7CiAgICByZXR1cm4gdGhpc1tp
ZHhdOwogIH0sCgogIC8vIHByaW1pdGl2ZSBmb3IgYXJyYXkgc3VwcG9ydC4KICByZXBsYWNlOiBm
dW5jdGlvbihpZHgsIGFtdCwgb2JqZWN0cykgewoKICAgIGlmICh0aGlzLmlzRnJvemVuKSB0aHJv
dyBFbWJlci5GUk9aRU5fRVJST1I7CgogICAgLy8gaWYgd2UgcmVwbGFjZWQgZXhhY3RseSB0aGUg
c2FtZSBudW1iZXIgb2YgaXRlbXMsIHRoZW4gcGFzcyBvbmx5IHRoZQogICAgLy8gcmVwbGFjZWQg
cmFuZ2UuIE90aGVyd2lzZSwgcGFzcyB0aGUgZnVsbCByZW1haW5pbmcgYXJyYXkgbGVuZ3RoCiAg
ICAvLyBzaW5jZSBldmVyeXRoaW5nIGhhcyBzaGlmdGVkCiAgICB2YXIgbGVuID0gb2JqZWN0cyA/
IGdldChvYmplY3RzLCAnbGVuZ3RoJykgOiAwOwogICAgdGhpcy5hcnJheUNvbnRlbnRXaWxsQ2hh
bmdlKGlkeCwgYW10LCBsZW4pOwoKICAgIGlmIChsZW4gPT09IDApIHsKICAgICAgdGhpcy5zcGxp
Y2UoaWR4LCBhbXQpOwogICAgfSBlbHNlIHsKICAgICAgcmVwbGFjZSh0aGlzLCBpZHgsIGFtdCwg
b2JqZWN0cyk7CiAgICB9CgogICAgdGhpcy5hcnJheUNvbnRlbnREaWRDaGFuZ2UoaWR4LCBhbXQs
IGxlbik7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvLyBJZiB5b3UgYXNrIGZvciBhbiB1bmtu
b3duIHByb3BlcnR5LCB0aGVuIHRyeSB0byBjb2xsZWN0IHRoZSB2YWx1ZQogIC8vIGZyb20gbWVt
YmVyIGl0ZW1zLgogIHVua25vd25Qcm9wZXJ0eTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAg
dmFyIHJldDsvLyA9IHRoaXMucmVkdWNlZFByb3BlcnR5KGtleSwgdmFsdWUpIDsKICAgIGlmICgo
dmFsdWUgIT09IHVuZGVmaW5lZCkgJiYgcmV0ID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0ID0g
dGhpc1trZXldID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gcmV0IDsKICB9LAoKICAvLyBJZiBi
cm93c2VyIGRpZCBub3QgaW1wbGVtZW50IGluZGV4T2YgbmF0aXZlbHksIHRoZW4gb3ZlcnJpZGUg
d2l0aAogIC8vIHNwZWNpYWxpemVkIHZlcnNpb24KICBpbmRleE9mOiBmdW5jdGlvbihvYmplY3Qs
IHN0YXJ0QXQpIHsKICAgIHZhciBpZHgsIGxlbiA9IHRoaXMubGVuZ3RoOwoKICAgIGlmIChzdGFy
dEF0ID09PSB1bmRlZmluZWQpIHN0YXJ0QXQgPSAwOwogICAgZWxzZSBzdGFydEF0ID0gKHN0YXJ0
QXQgPCAwKSA/IE1hdGguY2VpbChzdGFydEF0KSA6IE1hdGguZmxvb3Ioc3RhcnRBdCk7CiAgICBp
ZiAoc3RhcnRBdCA8IDApIHN0YXJ0QXQgKz0gbGVuOwoKICAgIGZvcihpZHg9c3RhcnRBdDtpZHg8
bGVuO2lkeCsrKSB7CiAgICAgIGlmICh0aGlzW2lkeF0gPT09IG9iamVjdCkgcmV0dXJuIGlkeCA7
CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfSwKCiAgbGFzdEluZGV4T2Y6IGZ1bmN0aW9uKG9iamVj
dCwgc3RhcnRBdCkgewogICAgdmFyIGlkeCwgbGVuID0gdGhpcy5sZW5ndGg7CgogICAgaWYgKHN0
YXJ0QXQgPT09IHVuZGVmaW5lZCkgc3RhcnRBdCA9IGxlbi0xOwogICAgZWxzZSBzdGFydEF0ID0g
KHN0YXJ0QXQgPCAwKSA/IE1hdGguY2VpbChzdGFydEF0KSA6IE1hdGguZmxvb3Ioc3RhcnRBdCk7
CiAgICBpZiAoc3RhcnRBdCA8IDApIHN0YXJ0QXQgKz0gbGVuOwoKICAgIGZvcihpZHg9c3RhcnRB
dDtpZHg+PTA7aWR4LS0pIHsKICAgICAgaWYgKHRoaXNbaWR4XSA9PT0gb2JqZWN0KSByZXR1cm4g
aWR4IDsKICAgIH0KICAgIHJldHVybiAtMTsKICB9LAoKICBjb3B5OiBmdW5jdGlvbihkZWVwKSB7
CiAgICBpZiAoZGVlcCkgewogICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oaXRlbSkgeyBy
ZXR1cm4gRW1iZXIuY29weShpdGVtLCB0cnVlKTsgfSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMu
c2xpY2UoKTsKICB9Cn0pOwoKLy8gUmVtb3ZlIGFueSBtZXRob2RzIGltcGxlbWVudGVkIG5hdGl2
ZWx5IHNvIHdlIGRvbid0IG92ZXJyaWRlIHRoZW0KdmFyIGlnbm9yZSA9IFsnbGVuZ3RoJ107CkVt
YmVyLkVudW1lcmFibGVVdGlscy5mb3JFYWNoKE5hdGl2ZUFycmF5LmtleXMoKSwgZnVuY3Rpb24o
bWV0aG9kTmFtZSkgewogIGlmIChBcnJheS5wcm90b3R5cGVbbWV0aG9kTmFtZV0pIGlnbm9yZS5w
dXNoKG1ldGhvZE5hbWUpOwp9KTsKCmlmIChpZ25vcmUubGVuZ3RoPjApIHsKICBOYXRpdmVBcnJh
eSA9IE5hdGl2ZUFycmF5LndpdGhvdXQuYXBwbHkoTmF0aXZlQXJyYXksIGlnbm9yZSk7Cn0KCi8q
KgogIFRoZSBOYXRpdmVBcnJheSBtaXhpbiBjb250YWlucyB0aGUgcHJvcGVydGllcyBuZWVkZWQg
dG8gdG8gbWFrZSB0aGUgbmF0aXZlCiAgQXJyYXkgc3VwcG9ydCBFbWJlci5NdXRhYmxlQXJyYXkg
YW5kIGFsbCBvZiBpdHMgZGVwZW5kZW50IEFQSXMuIFVubGVzcyB5b3UKICBoYXZlIGBFbWJlci5F
WFRFTkRfUFJPVE9UWVBFU2Agb3IgYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTLkFycmF5YCBzZXQg
dG8KICBmYWxzZSwgdGhpcyB3aWxsIGJlIGFwcGxpZWQgYXV0b21hdGljYWxseS4gT3RoZXJ3aXNl
IHlvdSBjYW4gYXBwbHkgdGhlIG1peGluCiAgYXQgYW55dGltZSBieSBjYWxsaW5nIGBFbWJlci5O
YXRpdmVBcnJheS5hY3RpdmF0ZWAuCgogIEBjbGFzcyBOYXRpdmVBcnJheQogIEBuYW1lc3BhY2Ug
RW1iZXIKICBAdXNlcyBFbWJlci5NdXRhYmxlQXJyYXkKICBAdXNlcyBFbWJlci5PYnNlcnZhYmxl
CiAgQHVzZXMgRW1iZXIuQ29weWFibGUKKi8KRW1iZXIuTmF0aXZlQXJyYXkgPSBOYXRpdmVBcnJh
eTsKCi8qKgogIENyZWF0ZXMgYW4gYEVtYmVyLk5hdGl2ZUFycmF5YCBmcm9tIGFuIEFycmF5IGxp
a2Ugb2JqZWN0LgogIERvZXMgbm90IG1vZGlmeSB0aGUgb3JpZ2luYWwgb2JqZWN0LiBFbWJlci5B
IGlzIG5vdCBuZWVkZWQgaWYKICBgRW1iZXIuRVhURU5EX1BST1RPVFlQRVNgIGlzIGB0cnVlYCAo
dGhlIGRlZmF1bHQgdmFsdWUpLiBIb3dldmVyLAogIGl0IGlzIHJlY29tbWVuZGVkIHRoYXQgeW91
IHVzZSBFbWJlci5BIHdoZW4gY3JlYXRpbmcgYWRkb25zIGZvcgogIGVtYmVyIG9yIHdoZW4geW91
IGNhbiBub3QgZ3VhcmFudGVlIHRoYXQgYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTYAogIHdpbGwg
YmUgYHRydWVgLgoKICBFeGFtcGxlCgogIGBgYGpzCiAgdmFyIFBhZ2luYXRpb24gPSBFbWJlci5D
b2xsZWN0aW9uVmlldy5leHRlbmQoewogICAgdGFnTmFtZTogJ3VsJywKICAgIGNsYXNzTmFtZXM6
IFsncGFnaW5hdGlvbiddLAogICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX3N1cGVy
KCk7CiAgICAgIGlmICghdGhpcy5nZXQoJ2NvbnRlbnQnKSkgewogICAgICAgIHRoaXMuc2V0KCdj
b250ZW50JywgRW1iZXIuQShbXSkpOwogICAgICB9CiAgICB9CiAgfSk7CiAgYGBgCgogIEBtZXRo
b2QgQQogIEBmb3IgRW1iZXIKICBAcmV0dXJuIHtFbWJlci5OYXRpdmVBcnJheX0KKi8KRW1iZXIu
QSA9IGZ1bmN0aW9uKGFycikgewogIGlmIChhcnIgPT09IHVuZGVmaW5lZCkgeyBhcnIgPSBbXTsg
fQogIHJldHVybiBFbWJlci5BcnJheS5kZXRlY3QoYXJyKSA/IGFyciA6IEVtYmVyLk5hdGl2ZUFy
cmF5LmFwcGx5KGFycik7Cn07CgovKioKICBBY3RpdmF0ZXMgdGhlIG1peGluIG9uIHRoZSBBcnJh
eS5wcm90b3R5cGUgaWYgbm90IGFscmVhZHkgYXBwbGllZC4gQ2FsbGluZwogIHRoaXMgbWV0aG9k
IG1vcmUgdGhhbiBvbmNlIGlzIHNhZmUuIFRoaXMgd2lsbCBiZSBjYWxsZWQgd2hlbiBlbWJlciBp
cyBsb2FkZWQKICB1bmxlc3MgeW91IGhhdmUgYEVtYmVyLkVYVEVORF9QUk9UT1RZUEVTYCBvciBg
RW1iZXIuRVhURU5EX1BST1RPVFlQRVMuQXJyYXlgCiAgc2V0IHRvIGBmYWxzZWAuCgogIEV4YW1w
bGUKCiAgYGBganMKICBpZiAoRW1iZXIuRVhURU5EX1BST1RPVFlQRVMgPT09IHRydWUgfHwgRW1i
ZXIuRVhURU5EX1BST1RPVFlQRVMuQXJyYXkpIHsKICAgIEVtYmVyLk5hdGl2ZUFycmF5LmFjdGl2
YXRlKCk7CiAgfQogIGBgYAoKICBAbWV0aG9kIGFjdGl2YXRlCiAgQGZvciBFbWJlci5OYXRpdmVB
cnJheQogIEBzdGF0aWMKICBAcmV0dXJuIHt2b2lkfQoqLwpFbWJlci5OYXRpdmVBcnJheS5hY3Rp
dmF0ZSA9IGZ1bmN0aW9uKCkgewogIE5hdGl2ZUFycmF5LmFwcGx5KEFycmF5LnByb3RvdHlwZSk7
CgogIEVtYmVyLkEgPSBmdW5jdGlvbihhcnIpIHsgcmV0dXJuIGFyciB8fCBbXTsgfTsKfTsKCmlm
IChFbWJlci5FWFRFTkRfUFJPVE9UWVBFUyA9PT0gdHJ1ZSB8fCBFbWJlci5FWFRFTkRfUFJPVE9U
WVBFUy5BcnJheSkgewogIEVtYmVyLk5hdGl2ZUFycmF5LmFjdGl2YXRlKCk7Cn0KCgp9KSgpOwoK
CgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcnVudGlt
ZQoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0LCBndWlkRm9yID0gRW1i
ZXIuZ3VpZEZvciwgaXNOb25lID0gRW1iZXIuaXNOb25lLCBmbXQgPSBFbWJlci5TdHJpbmcuZm10
OwoKLyoqCiAgQW4gdW5vcmRlcmVkIGNvbGxlY3Rpb24gb2Ygb2JqZWN0cy4KCiAgQSBTZXQgd29y
a3MgYSBiaXQgbGlrZSBhbiBhcnJheSBleGNlcHQgdGhhdCBpdHMgaXRlbXMgYXJlIG5vdCBvcmRl
cmVkLiBZb3UKICBjYW4gY3JlYXRlIGEgc2V0IHRvIGVmZmljaWVudGx5IHRlc3QgZm9yIG1lbWJl
cnNoaXAgZm9yIGFuIG9iamVjdC4gWW91IGNhbgogIGFsc28gaXRlcmF0ZSB0aHJvdWdoIGEgc2V0
IGp1c3QgbGlrZSBhbiBhcnJheSwgZXZlbiBhY2Nlc3Npbmcgb2JqZWN0cyBieQogIGluZGV4LCBo
b3dldmVyIHRoZXJlIGlzIG5vIGd1YXJhbnRlZSBhcyB0byB0aGVpciBvcmRlci4KCiAgQWxsIFNl
dHMgYXJlIG9ic2VydmFibGUgdmlhIHRoZSBFbnVtZXJhYmxlIE9ic2VydmVyIEFQSSAtIHdoaWNo
IHdvcmtzCiAgb24gYW55IGVudW1lcmFibGUgb2JqZWN0IGluY2x1ZGluZyBib3RoIFNldHMgYW5k
IEFycmF5cy4KCiAgIyMgQ3JlYXRpbmcgYSBTZXQKCiAgWW91IGNhbiBjcmVhdGUgYSBzZXQgbGlr
ZSB5b3Ugd291bGQgbW9zdCBvYmplY3RzIHVzaW5nCiAgYG5ldyBFbWJlci5TZXQoKWAuIE1vc3Qg
bmV3IHNldHMgeW91IGNyZWF0ZSB3aWxsIGJlIGVtcHR5LCBidXQgeW91IGNhbgogIGFsc28gaW5p
dGlhbGl6ZSB0aGUgc2V0IHdpdGggc29tZSBjb250ZW50IGJ5IHBhc3NpbmcgYW4gYXJyYXkgb3Ig
b3RoZXIKICBlbnVtZXJhYmxlIG9mIG9iamVjdHMgdG8gdGhlIGNvbnN0cnVjdG9yLgoKICBGaW5h
bGx5LCB5b3UgY2FuIHBhc3MgaW4gYW4gZXhpc3Rpbmcgc2V0IGFuZCB0aGUgc2V0IHdpbGwgYmUg
Y29waWVkLiBZb3UKICBjYW4gYWxzbyBjcmVhdGUgYSBjb3B5IG9mIGEgc2V0IGJ5IGNhbGxpbmcg
YEVtYmVyLlNldCNjb3B5KClgLgoKICBgYGBqYXZhc2NyaXB0CiAgLy8gY3JlYXRlcyBhIG5ldyBl
bXB0eSBzZXQKICB2YXIgZm91bmROYW1lcyA9IG5ldyBFbWJlci5TZXQoKTsKCiAgLy8gY3JlYXRl
cyBhIHNldCB3aXRoIGZvdXIgbmFtZXMgaW4gaXQuCiAgdmFyIG5hbWVzID0gbmV3IEVtYmVyLlNl
dChbIkNoYXJsZXMiLCAiVG9tIiwgIkp1YW4iLCAiQWxleCJdKTsgLy8gOlAKCiAgLy8gY3JlYXRl
cyBhIGNvcHkgb2YgdGhlIG5hbWVzIHNldC4KICB2YXIgbmFtZXNDb3B5ID0gbmV3IEVtYmVyLlNl
dChuYW1lcyk7CgogIC8vIHNhbWUgYXMgYWJvdmUuCiAgdmFyIGFub3RoZXJOYW1lc0NvcHkgPSBu
YW1lcy5jb3B5KCk7CiAgYGBgCgogICMjIEFkZGluZy9SZW1vdmluZyBPYmplY3RzCgogIFlvdSBn
ZW5lcmFsbHkgYWRkIG9yIHJlbW92ZSBvYmplY3RzIGZyb20gYSBzZXQgdXNpbmcgYGFkZCgpYCBv
cgogIGByZW1vdmUoKWAuIFlvdSBjYW4gYWRkIGFueSB0eXBlIG9mIG9iamVjdCBpbmNsdWRpbmcg
cHJpbWl0aXZlcyBzdWNoIGFzCiAgbnVtYmVycywgc3RyaW5ncywgYW5kIGJvb2xlYW5zLgoKICBV
bmxpa2UgYXJyYXlzLCBvYmplY3RzIGNhbiBvbmx5IGV4aXN0IG9uZSB0aW1lIGluIGEgc2V0LiBJ
ZiB5b3UgY2FsbCBgYWRkKClgCiAgb24gYSBzZXQgd2l0aCB0aGUgc2FtZSBvYmplY3QgbXVsdGlw
bGUgdGltZXMsIHRoZSBvYmplY3Qgd2lsbCBvbmx5IGJlIGFkZGVkCiAgb25jZS4gTGlrZXdpc2Us
IGNhbGxpbmcgYHJlbW92ZSgpYCB3aXRoIHRoZSBzYW1lIG9iamVjdCBtdWx0aXBsZSB0aW1lcyB3
aWxsCiAgcmVtb3ZlIHRoZSBvYmplY3QgdGhlIGZpcnN0IHRpbWUgYW5kIGhhdmUgbm8gZWZmZWN0
IG9uIGZ1dHVyZSBjYWxscyB1bnRpbAogIHlvdSBhZGQgdGhlIG9iamVjdCB0byB0aGUgc2V0IGFn
YWluLgoKICBOT1RFOiBZb3UgY2Fubm90IGFkZC9yZW1vdmUgYG51bGxgIG9yIGB1bmRlZmluZWRg
IHRvIGEgc2V0LiBBbnkgYXR0ZW1wdCB0byBkbwogIHNvIHdpbGwgYmUgaWdub3JlZC4KCiAgSW4g
YWRkaXRpb24gdG8gYWRkL3JlbW92ZSB5b3UgY2FuIGFsc28gY2FsbCBgcHVzaCgpYC9gcG9wKClg
LiBQdXNoIGJlaGF2ZXMKICBqdXN0IGxpa2UgYGFkZCgpYCBidXQgYHBvcCgpYCwgdW5saWtlIGBy
ZW1vdmUoKWAgd2lsbCBwaWNrIGFuIGFyYml0cmFyeQogIG9iamVjdCwgcmVtb3ZlIGl0IGFuZCBy
ZXR1cm4gaXQuIFRoaXMgaXMgYSBnb29kIHdheSB0byB1c2UgYSBzZXQgYXMgYSBqb2IKICBxdWV1
ZSB3aGVuIHlvdSBkb24ndCBjYXJlIHdoaWNoIG9yZGVyIHRoZSBqb2JzIGFyZSBleGVjdXRlZCBp
bi4KCiAgIyMgVGVzdGluZyBmb3IgYW4gT2JqZWN0CgogIFRvIHRlc3QgZm9yIGFuIG9iamVjdCdz
IHByZXNlbmNlIGluIGEgc2V0IHlvdSBzaW1wbHkgY2FsbAogIGBFbWJlci5TZXQjY29udGFpbnMo
KWAuCgogICMjIE9ic2VydmluZyBjaGFuZ2VzCgogIFdoZW4gdXNpbmcgYEVtYmVyLlNldGAsIHlv
dSBjYW4gb2JzZXJ2ZSB0aGUgYCJbXSJgIHByb3BlcnR5IHRvIGJlCiAgYWxlcnRlZCB3aGVuZXZl
ciB0aGUgY29udGVudCBjaGFuZ2VzLiBZb3UgY2FuIGFsc28gYWRkIGFuIGVudW1lcmFibGUKICBv
YnNlcnZlciB0byB0aGUgc2V0IHRvIGJlIG5vdGlmaWVkIG9mIHNwZWNpZmljIG9iamVjdHMgdGhh
dCBhcmUgYWRkZWQgYW5kCiAgcmVtb3ZlZCBmcm9tIHRoZSBzZXQuIFNlZSBbRW1iZXIuRW51bWVy
YWJsZV0oL2FwaS9jbGFzc2VzL0VtYmVyLkVudW1lcmFibGUuaHRtbCkKICBmb3IgbW9yZSBpbmZv
cm1hdGlvbiBvbiBlbnVtZXJhYmxlcy4KCiAgVGhpcyBpcyBvZnRlbiB1bmhlbHBmdWwuIElmIHlv
dSBhcmUgZmlsdGVyaW5nIHNldHMgb2Ygb2JqZWN0cywgZm9yIGluc3RhbmNlLAogIGl0IGlzIHZl
cnkgaW5lZmZpY2llbnQgdG8gcmUtZmlsdGVyIGFsbCBvZiB0aGUgaXRlbXMgZWFjaCB0aW1lIHRo
ZSBzZXQKICBjaGFuZ2VzLiBJdCB3b3VsZCBiZSBiZXR0ZXIgaWYgeW91IGNvdWxkIGp1c3QgYWRq
dXN0IHRoZSBmaWx0ZXJlZCBzZXQgYmFzZWQKICBvbiB3aGF0IHdhcyBjaGFuZ2VkIG9uIHRoZSBv
cmlnaW5hbCBzZXQuIFRoZSBzYW1lIGlzc3VlIGFwcGxpZXMgdG8gbWVyZ2luZwogIHNldHMsIGFz
IHdlbGwuCgogICMjIE90aGVyIE1ldGhvZHMKCiAgYEVtYmVyLlNldGAgcHJpbWFyeSBpbXBsZW1l
bnRzIG90aGVyIG1peGluIEFQSXMuIEZvciBhIGNvbXBsZXRlIHJlZmVyZW5jZQogIG9uIHRoZSBt
ZXRob2RzIHlvdSB3aWxsIHVzZSB3aXRoIGBFbWJlci5TZXRgLCBwbGVhc2UgY29uc3VsdCB0aGVz
ZSBtaXhpbnMuCiAgVGhlIG1vc3QgdXNlZnVsIG9uZXMgd2lsbCBiZSBgRW1iZXIuRW51bWVyYWJs
ZWAgYW5kCiAgYEVtYmVyLk11dGFibGVFbnVtZXJhYmxlYCB3aGljaCBpbXBsZW1lbnQgbW9zdCBv
ZiB0aGUgY29tbW9uIGl0ZXJhdG9yCiAgbWV0aG9kcyB5b3UgYXJlIHVzZWQgdG8gb24gQXJyYXku
CgogIE5vdGUgdGhhdCB5b3UgY2FuIGFsc28gdXNlIHRoZSBgRW1iZXIuQ29weWFibGVgIGFuZCBg
RW1iZXIuRnJlZXphYmxlYAogIEFQSXMgb24gYEVtYmVyLlNldGAgYXMgd2VsbC4gT25jZSBhIHNl
dCBpcyBmcm96ZW4gaXQgY2FuIG5vIGxvbmdlciBiZQogIG1vZGlmaWVkLiBUaGUgYmVuZWZpdCBv
ZiB0aGlzIGlzIHRoYXQgd2hlbiB5b3UgY2FsbCBgZnJvemVuQ29weSgpYCBvbiBpdCwKICBFbWJl
ciB3aWxsIGF2b2lkIG1ha2luZyBjb3BpZXMgb2YgdGhlIHNldC4gVGhpcyBhbGxvd3MgeW91IHRv
IHdyaXRlCiAgY29kZSB0aGF0IGNhbiBrbm93IHdpdGggY2VydGFpbnR5IHdoZW4gdGhlIHVuZGVy
bHlpbmcgc2V0IGRhdGEgd2lsbCBvcgogIHdpbGwgbm90IGJlIG1vZGlmaWVkLgoKICBAY2xhc3Mg
U2V0CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLkNvcmVPYmplY3QKICBAdXNl
cyBFbWJlci5NdXRhYmxlRW51bWVyYWJsZQogIEB1c2VzIEVtYmVyLkNvcHlhYmxlCiAgQHVzZXMg
RW1iZXIuRnJlZXphYmxlCiAgQHNpbmNlIEVtYmVyIDAuOQoqLwpFbWJlci5TZXQgPSBFbWJlci5D
b3JlT2JqZWN0LmV4dGVuZChFbWJlci5NdXRhYmxlRW51bWVyYWJsZSwgRW1iZXIuQ29weWFibGUs
IEVtYmVyLkZyZWV6YWJsZSwKICB7CgogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyBJTVBMRU1FTlQgRU5VTUVSQUJMRSBB
UElTCiAgLy8KCiAgLyoqCiAgICBUaGlzIHByb3BlcnR5IHdpbGwgY2hhbmdlIGFzIHRoZSBudW1i
ZXIgb2Ygb2JqZWN0cyBpbiB0aGUgc2V0IGNoYW5nZXMuCgogICAgQHByb3BlcnR5IGxlbmd0aAog
ICAgQHR5cGUgbnVtYmVyCiAgICBAZGVmYXVsdCAwCiAgKi8KICBsZW5ndGg6IDAsCgogIC8qKgog
ICAgQ2xlYXJzIHRoZSBzZXQuIFRoaXMgaXMgdXNlZnVsIGlmIHlvdSB3YW50IHRvIHJldXNlIGFu
IGV4aXN0aW5nIHNldAogICAgd2l0aG91dCBoYXZpbmcgdG8gcmVjcmVhdGUgaXQuCgogICAgYGBg
amF2YXNjcmlwdAogICAgdmFyIGNvbG9ycyA9IG5ldyBFbWJlci5TZXQoWyJyZWQiLCAiZ3JlZW4i
LCAiYmx1ZSJdKTsKICAgIGNvbG9ycy5sZW5ndGg7ICAvLyAzCiAgICBjb2xvcnMuY2xlYXIoKTsK
ICAgIGNvbG9ycy5sZW5ndGg7ICAvLyAwCiAgICBgYGAKCiAgICBAbWV0aG9kIGNsZWFyCiAgICBA
cmV0dXJuIHtFbWJlci5TZXR9IEFuIGVtcHR5IFNldAogICovCiAgY2xlYXI6IGZ1bmN0aW9uKCkg
ewogICAgaWYgKHRoaXMuaXNGcm96ZW4pIHsgdGhyb3cgbmV3IEVtYmVyLkVycm9yKEVtYmVyLkZS
T1pFTl9FUlJPUik7IH0KCiAgICB2YXIgbGVuID0gZ2V0KHRoaXMsICdsZW5ndGgnKTsKICAgIGlm
IChsZW4gPT09IDApIHsgcmV0dXJuIHRoaXM7IH0KCiAgICB2YXIgZ3VpZDsKCiAgICB0aGlzLmVu
dW1lcmFibGVDb250ZW50V2lsbENoYW5nZShsZW4sIDApOwogICAgRW1iZXIucHJvcGVydHlXaWxs
Q2hhbmdlKHRoaXMsICdmaXJzdE9iamVjdCcpOwogICAgRW1iZXIucHJvcGVydHlXaWxsQ2hhbmdl
KHRoaXMsICdsYXN0T2JqZWN0Jyk7CgogICAgZm9yICh2YXIgaT0wOyBpIDwgbGVuOyBpKyspIHsK
ICAgICAgZ3VpZCA9IGd1aWRGb3IodGhpc1tpXSk7CiAgICAgIGRlbGV0ZSB0aGlzW2d1aWRdOwog
ICAgICBkZWxldGUgdGhpc1tpXTsKICAgIH0KCiAgICBzZXQodGhpcywgJ2xlbmd0aCcsIDApOwoK
ICAgIEVtYmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMsICdmaXJzdE9iamVjdCcpOwogICAgRW1i
ZXIucHJvcGVydHlEaWRDaGFuZ2UodGhpcywgJ2xhc3RPYmplY3QnKTsKICAgIHRoaXMuZW51bWVy
YWJsZUNvbnRlbnREaWRDaGFuZ2UobGVuLCAwKTsKCiAgICByZXR1cm4gdGhpczsKICB9LAoKICAv
KioKICAgIFJldHVybnMgdHJ1ZSBpZiB0aGUgcGFzc2VkIG9iamVjdCBpcyBhbHNvIGFuIGVudW1l
cmFibGUgdGhhdCBjb250YWlucyB0aGUKICAgIHNhbWUgb2JqZWN0cyBhcyB0aGUgcmVjZWl2ZXIu
CgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGNvbG9ycyA9IFsicmVkIiwgImdyZWVuIiwgImJs
dWUiXSwKICAgICAgICBzYW1lX2NvbG9ycyA9IG5ldyBFbWJlci5TZXQoY29sb3JzKTsKCiAgICBz
YW1lX2NvbG9ycy5pc0VxdWFsKGNvbG9ycyk7ICAgICAgICAgICAgICAgLy8gdHJ1ZQogICAgc2Ft
ZV9jb2xvcnMuaXNFcXVhbChbInB1cnBsZSIsICJicm93biJdKTsgIC8vIGZhbHNlCiAgICBgYGAK
CiAgICBAbWV0aG9kIGlzRXF1YWwKICAgIEBwYXJhbSB7RW1iZXIuU2V0fSBvYmogdGhlIG90aGVy
IG9iamVjdC4KICAgIEByZXR1cm4ge0Jvb2xlYW59CiAgKi8KICBpc0VxdWFsOiBmdW5jdGlvbihv
YmopIHsKICAgIC8vIGZhaWwgZmFzdAogICAgaWYgKCFFbWJlci5FbnVtZXJhYmxlLmRldGVjdChv
YmopKSByZXR1cm4gZmFsc2U7CgogICAgdmFyIGxvYyA9IGdldCh0aGlzLCAnbGVuZ3RoJyk7CiAg
ICBpZiAoZ2V0KG9iaiwgJ2xlbmd0aCcpICE9PSBsb2MpIHJldHVybiBmYWxzZTsKCiAgICB3aGls
ZSgtLWxvYyA+PSAwKSB7CiAgICAgIGlmICghb2JqLmNvbnRhaW5zKHRoaXNbbG9jXSkpIHJldHVy
biBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9LAoKICAvKioKICAgIEFkZHMgYW4g
b2JqZWN0IHRvIHRoZSBzZXQuIE9ubHkgbm9uLWBudWxsYCBvYmplY3RzIGNhbiBiZSBhZGRlZCB0
byBhIHNldAogICAgYW5kIHRob3NlIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2UuIElmIHRoZSBvYmpl
Y3QgaXMgYWxyZWFkeSBpbiB0aGUgc2V0IG9yCiAgICB0aGUgcGFzc2VkIHZhbHVlIGlzIG51bGwg
dGhpcyBtZXRob2Qgd2lsbCBoYXZlIG5vIGVmZmVjdC4KCiAgICBUaGlzIGlzIGFuIGFsaWFzIGZv
ciBgRW1iZXIuTXV0YWJsZUVudW1lcmFibGUuYWRkT2JqZWN0KClgLgoKICAgIGBgYGphdmFzY3Jp
cHQKICAgIHZhciBjb2xvcnMgPSBuZXcgRW1iZXIuU2V0KCk7CiAgICBjb2xvcnMuYWRkKCJibHVl
Iik7ICAgICAvLyBbImJsdWUiXQogICAgY29sb3JzLmFkZCgiYmx1ZSIpOyAgICAgLy8gWyJibHVl
Il0KICAgIGNvbG9ycy5hZGQoInJlZCIpOyAgICAgIC8vIFsiYmx1ZSIsICJyZWQiXQogICAgY29s
b3JzLmFkZChudWxsKTsgICAgICAgLy8gWyJibHVlIiwgInJlZCJdCiAgICBjb2xvcnMuYWRkKHVu
ZGVmaW5lZCk7ICAvLyBbImJsdWUiLCAicmVkIl0KICAgIGBgYAoKICAgIEBtZXRob2QgYWRkCiAg
ICBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gYWRkLgogICAgQHJldHVybiB7RW1i
ZXIuU2V0fSBUaGUgc2V0IGl0c2VsZi4KICAqLwogIGFkZDogRW1iZXIuYWxpYXNNZXRob2QoJ2Fk
ZE9iamVjdCcpLAoKICAvKioKICAgIFJlbW92ZXMgdGhlIG9iamVjdCBmcm9tIHRoZSBzZXQgaWYg
aXQgaXMgZm91bmQuIElmIHlvdSBwYXNzIGEgYG51bGxgIHZhbHVlCiAgICBvciBhbiBvYmplY3Qg
dGhhdCBpcyBhbHJlYWR5IG5vdCBpbiB0aGUgc2V0LCB0aGlzIG1ldGhvZCB3aWxsIGhhdmUgbm8K
ICAgIGVmZmVjdC4gVGhpcyBpcyBhbiBhbGlhcyBmb3IgYEVtYmVyLk11dGFibGVFbnVtZXJhYmxl
LnJlbW92ZU9iamVjdCgpYC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgY29sb3JzID0gbmV3
IEVtYmVyLlNldChbInJlZCIsICJncmVlbiIsICJibHVlIl0pOwogICAgY29sb3JzLnJlbW92ZSgi
cmVkIik7ICAgICAvLyBbImJsdWUiLCAiZ3JlZW4iXQogICAgY29sb3JzLnJlbW92ZSgicHVycGxl
Iik7ICAvLyBbImJsdWUiLCAiZ3JlZW4iXQogICAgY29sb3JzLnJlbW92ZShudWxsKTsgICAgICAv
LyBbImJsdWUiLCAiZ3JlZW4iXQogICAgYGBgCgogICAgQG1ldGhvZCByZW1vdmUKICAgIEBwYXJh
bSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byByZW1vdmUKICAgIEByZXR1cm4ge0VtYmVyLlNl
dH0gVGhlIHNldCBpdHNlbGYuCiAgKi8KICByZW1vdmU6IEVtYmVyLmFsaWFzTWV0aG9kKCdyZW1v
dmVPYmplY3QnKSwKCiAgLyoqCiAgICBSZW1vdmVzIHRoZSBsYXN0IGVsZW1lbnQgZnJvbSB0aGUg
c2V0IGFuZCByZXR1cm5zIGl0LCBvciBgbnVsbGAgaWYgaXQncyBlbXB0eS4KCiAgICBgYGBqYXZh
c2NyaXB0CiAgICB2YXIgY29sb3JzID0gbmV3IEVtYmVyLlNldChbImdyZWVuIiwgImJsdWUiXSk7
CiAgICBjb2xvcnMucG9wKCk7ICAvLyAiYmx1ZSIKICAgIGNvbG9ycy5wb3AoKTsgIC8vICJncmVl
biIKICAgIGNvbG9ycy5wb3AoKTsgIC8vIG51bGwKICAgIGBgYAoKICAgIEBtZXRob2QgcG9wCiAg
ICBAcmV0dXJuIHtPYmplY3R9IFRoZSByZW1vdmVkIG9iamVjdCBmcm9tIHRoZSBzZXQgb3IgbnVs
bC4KICAqLwogIHBvcDogZnVuY3Rpb24oKSB7CiAgICBpZiAoZ2V0KHRoaXMsICdpc0Zyb3plbicp
KSB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoRW1iZXIuRlJPWkVOX0VSUk9SKTsKICAgIHZhciBvYmog
PSB0aGlzLmxlbmd0aCA+IDAgPyB0aGlzW3RoaXMubGVuZ3RoLTFdIDogbnVsbDsKICAgIHRoaXMu
cmVtb3ZlKG9iaik7CiAgICByZXR1cm4gb2JqOwogIH0sCgogIC8qKgogICAgSW5zZXJ0cyB0aGUg
Z2l2ZW4gb2JqZWN0IG9uIHRvIHRoZSBlbmQgb2YgdGhlIHNldC4gSXQgcmV0dXJucwogICAgdGhl
IHNldCBpdHNlbGYuCgogICAgVGhpcyBpcyBhbiBhbGlhcyBmb3IgYEVtYmVyLk11dGFibGVFbnVt
ZXJhYmxlLmFkZE9iamVjdCgpYC4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgY29sb3JzID0g
bmV3IEVtYmVyLlNldCgpOwogICAgY29sb3JzLnB1c2goInJlZCIpOyAgIC8vIFsicmVkIl0KICAg
IGNvbG9ycy5wdXNoKCJncmVlbiIpOyAvLyBbInJlZCIsICJncmVlbiJdCiAgICBjb2xvcnMucHVz
aCgiYmx1ZSIpOyAgLy8gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSJdCiAgICBgYGAKCiAgICBAbWV0
aG9kIHB1c2gKICAgIEByZXR1cm4ge0VtYmVyLlNldH0gVGhlIHNldCBpdHNlbGYuCiAgKi8KICBw
dXNoOiBFbWJlci5hbGlhc01ldGhvZCgnYWRkT2JqZWN0JyksCgogIC8qKgogICAgUmVtb3ZlcyB0
aGUgbGFzdCBlbGVtZW50IGZyb20gdGhlIHNldCBhbmQgcmV0dXJucyBpdCwgb3IgYG51bGxgIGlm
IGl0J3MgZW1wdHkuCgogICAgVGhpcyBpcyBhbiBhbGlhcyBmb3IgYEVtYmVyLlNldC5wb3AoKWAu
CgogICAgYGBgamF2YXNjcmlwdAogICAgdmFyIGNvbG9ycyA9IG5ldyBFbWJlci5TZXQoWyJncmVl
biIsICJibHVlIl0pOwogICAgY29sb3JzLnNoaWZ0KCk7ICAvLyAiYmx1ZSIKICAgIGNvbG9ycy5z
aGlmdCgpOyAgLy8gImdyZWVuIgogICAgY29sb3JzLnNoaWZ0KCk7ICAvLyBudWxsCiAgICBgYGAK
CiAgICBAbWV0aG9kIHNoaWZ0CiAgICBAcmV0dXJuIHtPYmplY3R9IFRoZSByZW1vdmVkIG9iamVj
dCBmcm9tIHRoZSBzZXQgb3IgbnVsbC4KICAqLwogIHNoaWZ0OiBFbWJlci5hbGlhc01ldGhvZCgn
cG9wJyksCgogIC8qKgogICAgSW5zZXJ0cyB0aGUgZ2l2ZW4gb2JqZWN0IG9uIHRvIHRoZSBlbmQg
b2YgdGhlIHNldC4gSXQgcmV0dXJucwogICAgdGhlIHNldCBpdHNlbGYuCgogICAgVGhpcyBpcyBh
biBhbGlhcyBvZiBgRW1iZXIuU2V0LnB1c2goKWAKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIg
Y29sb3JzID0gbmV3IEVtYmVyLlNldCgpOwogICAgY29sb3JzLnVuc2hpZnQoInJlZCIpOyAgICAv
LyBbInJlZCJdCiAgICBjb2xvcnMudW5zaGlmdCgiZ3JlZW4iKTsgIC8vIFsicmVkIiwgImdyZWVu
Il0KICAgIGNvbG9ycy51bnNoaWZ0KCJibHVlIik7ICAgLy8gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1
ZSJdCiAgICBgYGAKCiAgICBAbWV0aG9kIHVuc2hpZnQKICAgIEByZXR1cm4ge0VtYmVyLlNldH0g
VGhlIHNldCBpdHNlbGYuCiAgKi8KICB1bnNoaWZ0OiBFbWJlci5hbGlhc01ldGhvZCgncHVzaCcp
LAoKICAvKioKICAgIEFkZHMgZWFjaCBvYmplY3QgaW4gdGhlIHBhc3NlZCBlbnVtZXJhYmxlIHRv
IHRoZSBzZXQuCgogICAgVGhpcyBpcyBhbiBhbGlhcyBvZiBgRW1iZXIuTXV0YWJsZUVudW1lcmFi
bGUuYWRkT2JqZWN0cygpYAoKICAgIGBgYGphdmFzY3JpcHQKICAgIHZhciBjb2xvcnMgPSBuZXcg
RW1iZXIuU2V0KCk7CiAgICBjb2xvcnMuYWRkRWFjaChbInJlZCIsICJncmVlbiIsICJibHVlIl0p
OyAgLy8gWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSJdCiAgICBgYGAKCiAgICBAbWV0aG9kIGFkZEVh
Y2gKICAgIEBwYXJhbSB7RW1iZXIuRW51bWVyYWJsZX0gb2JqZWN0cyB0aGUgb2JqZWN0cyB0byBh
ZGQuCiAgICBAcmV0dXJuIHtFbWJlci5TZXR9IFRoZSBzZXQgaXRzZWxmLgogICovCiAgYWRkRWFj
aDogRW1iZXIuYWxpYXNNZXRob2QoJ2FkZE9iamVjdHMnKSwKCiAgLyoqCiAgICBSZW1vdmVzIGVh
Y2ggb2JqZWN0IGluIHRoZSBwYXNzZWQgZW51bWVyYWJsZSB0byB0aGUgc2V0LgoKICAgIFRoaXMg
aXMgYW4gYWxpYXMgb2YgYEVtYmVyLk11dGFibGVFbnVtZXJhYmxlLnJlbW92ZU9iamVjdHMoKWAK
CiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgY29sb3JzID0gbmV3IEVtYmVyLlNldChbInJlZCIs
ICJncmVlbiIsICJibHVlIl0pOwogICAgY29sb3JzLnJlbW92ZUVhY2goWyJyZWQiLCAiYmx1ZSJd
KTsgIC8vICBbImdyZWVuIl0KICAgIGBgYAoKICAgIEBtZXRob2QgcmVtb3ZlRWFjaAogICAgQHBh
cmFtIHtFbWJlci5FbnVtZXJhYmxlfSBvYmplY3RzIHRoZSBvYmplY3RzIHRvIHJlbW92ZS4KICAg
IEByZXR1cm4ge0VtYmVyLlNldH0gVGhlIHNldCBpdHNlbGYuCiAgKi8KICByZW1vdmVFYWNoOiBF
bWJlci5hbGlhc01ldGhvZCgncmVtb3ZlT2JqZWN0cycpLAoKICAvLyAuLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgLy8gUFJJVkFURSBF
TlVNRVJBQkxFIFNVUFBPUlQKICAvLwoKICBpbml0OiBmdW5jdGlvbihpdGVtcykgewogICAgdGhp
cy5fc3VwZXIoKTsKICAgIGlmIChpdGVtcykgdGhpcy5hZGRPYmplY3RzKGl0ZW1zKTsKICB9LAoK
ICAvLyBpbXBsZW1lbnQgRW1iZXIuRW51bWVyYWJsZQogIG5leHRPYmplY3Q6IGZ1bmN0aW9uKGlk
eCkgewogICAgcmV0dXJuIHRoaXNbaWR4XTsKICB9LAoKICAvLyBtb3JlIG9wdGltaXplZCB2ZXJz
aW9uCiAgZmlyc3RPYmplY3Q6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgcmV0dXJu
IHRoaXMubGVuZ3RoID4gMCA/IHRoaXNbMF0gOiB1bmRlZmluZWQ7CiAgfSksCgogIC8vIG1vcmUg
b3B0aW1pemVkIHZlcnNpb24KICBsYXN0T2JqZWN0OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbigp
IHsKICAgIHJldHVybiB0aGlzLmxlbmd0aCA+IDAgPyB0aGlzW3RoaXMubGVuZ3RoLTFdIDogdW5k
ZWZpbmVkOwogIH0pLAoKICAvLyBpbXBsZW1lbnRzIEVtYmVyLk11dGFibGVFbnVtZXJhYmxlCiAg
YWRkT2JqZWN0OiBmdW5jdGlvbihvYmopIHsKICAgIGlmIChnZXQodGhpcywgJ2lzRnJvemVuJykp
IHRocm93IG5ldyBFbWJlci5FcnJvcihFbWJlci5GUk9aRU5fRVJST1IpOwogICAgaWYgKGlzTm9u
ZShvYmopKSByZXR1cm4gdGhpczsgLy8gbm90aGluZyB0byBkbwoKICAgIHZhciBndWlkID0gZ3Vp
ZEZvcihvYmopLAogICAgICAgIGlkeCAgPSB0aGlzW2d1aWRdLAogICAgICAgIGxlbiAgPSBnZXQo
dGhpcywgJ2xlbmd0aCcpLAogICAgICAgIGFkZGVkIDsKCiAgICBpZiAoaWR4Pj0wICYmIGlkeDxs
ZW4gJiYgKHRoaXNbaWR4XSA9PT0gb2JqKSkgcmV0dXJuIHRoaXM7IC8vIGFkZGVkCgogICAgYWRk
ZWQgPSBbb2JqXTsKCiAgICB0aGlzLmVudW1lcmFibGVDb250ZW50V2lsbENoYW5nZShudWxsLCBh
ZGRlZCk7CiAgICBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UodGhpcywgJ2xhc3RPYmplY3QnKTsK
CiAgICBsZW4gPSBnZXQodGhpcywgJ2xlbmd0aCcpOwogICAgdGhpc1tndWlkXSA9IGxlbjsKICAg
IHRoaXNbbGVuXSA9IG9iajsKICAgIHNldCh0aGlzLCAnbGVuZ3RoJywgbGVuKzEpOwoKICAgIEVt
YmVyLnByb3BlcnR5RGlkQ2hhbmdlKHRoaXMsICdsYXN0T2JqZWN0Jyk7CiAgICB0aGlzLmVudW1l
cmFibGVDb250ZW50RGlkQ2hhbmdlKG51bGwsIGFkZGVkKTsKCiAgICByZXR1cm4gdGhpczsKICB9
LAoKICAvLyBpbXBsZW1lbnRzIEVtYmVyLk11dGFibGVFbnVtZXJhYmxlCiAgcmVtb3ZlT2JqZWN0
OiBmdW5jdGlvbihvYmopIHsKICAgIGlmIChnZXQodGhpcywgJ2lzRnJvemVuJykpIHRocm93IG5l
dyBFbWJlci5FcnJvcihFbWJlci5GUk9aRU5fRVJST1IpOwogICAgaWYgKGlzTm9uZShvYmopKSBy
ZXR1cm4gdGhpczsgLy8gbm90aGluZyB0byBkbwoKICAgIHZhciBndWlkID0gZ3VpZEZvcihvYmop
LAogICAgICAgIGlkeCAgPSB0aGlzW2d1aWRdLAogICAgICAgIGxlbiA9IGdldCh0aGlzLCAnbGVu
Z3RoJyksCiAgICAgICAgaXNGaXJzdCA9IGlkeCA9PT0gMCwKICAgICAgICBpc0xhc3QgPSBpZHgg
PT09IGxlbi0xLAogICAgICAgIGxhc3QsIHJlbW92ZWQ7CgoKICAgIGlmIChpZHg+PTAgJiYgaWR4
PGxlbiAmJiAodGhpc1tpZHhdID09PSBvYmopKSB7CiAgICAgIHJlbW92ZWQgPSBbb2JqXTsKCiAg
ICAgIHRoaXMuZW51bWVyYWJsZUNvbnRlbnRXaWxsQ2hhbmdlKHJlbW92ZWQsIG51bGwpOwogICAg
ICBpZiAoaXNGaXJzdCkgeyBFbWJlci5wcm9wZXJ0eVdpbGxDaGFuZ2UodGhpcywgJ2ZpcnN0T2Jq
ZWN0Jyk7IH0KICAgICAgaWYgKGlzTGFzdCkgIHsgRW1iZXIucHJvcGVydHlXaWxsQ2hhbmdlKHRo
aXMsICdsYXN0T2JqZWN0Jyk7IH0KCiAgICAgIC8vIHN3YXAgaXRlbXMgLSBiYXNpY2FsbHkgbW92
ZSB0aGUgaXRlbSB0byB0aGUgZW5kIHNvIGl0IGNhbiBiZSByZW1vdmVkCiAgICAgIGlmIChpZHgg
PCBsZW4tMSkgewogICAgICAgIGxhc3QgPSB0aGlzW2xlbi0xXTsKICAgICAgICB0aGlzW2lkeF0g
PSBsYXN0OwogICAgICAgIHRoaXNbZ3VpZEZvcihsYXN0KV0gPSBpZHg7CiAgICAgIH0KCiAgICAg
IGRlbGV0ZSB0aGlzW2d1aWRdOwogICAgICBkZWxldGUgdGhpc1tsZW4tMV07CiAgICAgIHNldCh0
aGlzLCAnbGVuZ3RoJywgbGVuLTEpOwoKICAgICAgaWYgKGlzRmlyc3QpIHsgRW1iZXIucHJvcGVy
dHlEaWRDaGFuZ2UodGhpcywgJ2ZpcnN0T2JqZWN0Jyk7IH0KICAgICAgaWYgKGlzTGFzdCkgIHsg
RW1iZXIucHJvcGVydHlEaWRDaGFuZ2UodGhpcywgJ2xhc3RPYmplY3QnKTsgfQogICAgICB0aGlz
LmVudW1lcmFibGVDb250ZW50RGlkQ2hhbmdlKHJlbW92ZWQsIG51bGwpOwogICAgfQoKICAgIHJl
dHVybiB0aGlzOwogIH0sCgogIC8vIG9wdGltaXplZCB2ZXJzaW9uCiAgY29udGFpbnM6IGZ1bmN0
aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXNbZ3VpZEZvcihvYmopXT49MDsKICB9LAoKICBjb3B5
OiBmdW5jdGlvbigpIHsKICAgIHZhciBDID0gdGhpcy5jb25zdHJ1Y3RvciwgcmV0ID0gbmV3IEMo
KSwgbG9jID0gZ2V0KHRoaXMsICdsZW5ndGgnKTsKICAgIHNldChyZXQsICdsZW5ndGgnLCBsb2Mp
OwogICAgd2hpbGUoLS1sb2M+PTApIHsKICAgICAgcmV0W2xvY10gPSB0aGlzW2xvY107CiAgICAg
IHJldFtndWlkRm9yKHRoaXNbbG9jXSldID0gbG9jOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9
LAoKICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGgsIGlk
eCwgYXJyYXkgPSBbXTsKICAgIGZvcihpZHggPSAwOyBpZHggPCBsZW47IGlkeCsrKSB7CiAgICAg
IGFycmF5W2lkeF0gPSB0aGlzW2lkeF07CiAgICB9CiAgICByZXR1cm4gZm10KCJFbWJlci5TZXQ8
JUA+IiwgW2FycmF5LmpvaW4oJywnKV0pOwogIH0KCn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkg
ewp2YXIgRGVmZXJyZWRNaXhpbiA9IEVtYmVyLkRlZmVycmVkTWl4aW4sIC8vIG1peGlucy9kZWZl
cnJlZAogICAgZ2V0ID0gRW1iZXIuZ2V0OwoKdmFyIERlZmVycmVkID0gRW1iZXIuT2JqZWN0LmV4
dGVuZChEZWZlcnJlZE1peGluKTsKCkRlZmVycmVkLnJlb3BlbkNsYXNzKHsKICBwcm9taXNlOiBm
dW5jdGlvbihjYWxsYmFjaywgYmluZGluZykgewogICAgdmFyIGRlZmVycmVkID0gRGVmZXJyZWQu
Y3JlYXRlKCk7CiAgICBjYWxsYmFjay5jYWxsKGJpbmRpbmcsIGRlZmVycmVkKTsKICAgIHJldHVy
biBkZWZlcnJlZDsKICB9Cn0pOwoKRW1iZXIuRGVmZXJyZWQgPSBEZWZlcnJlZDsKCn0pKCk7CgoK
CihmdW5jdGlvbigpIHsKdmFyIGZvckVhY2ggPSBFbWJlci5BcnJheVBvbHlmaWxscy5mb3JFYWNo
OwoKLyoqCiAgQG1vZHVsZSBlbWJlcgogIEBzdWJtb2R1bGUgZW1iZXItcnVudGltZQoqLwoKdmFy
IGxvYWRIb29rcyA9IEVtYmVyLkVOVi5FTUJFUl9MT0FEX0hPT0tTIHx8IHt9Owp2YXIgbG9hZGVk
ID0ge307CgovKioKICBEZXRlY3RzIHdoZW4gYSBzcGVjaWZpYyBwYWNrYWdlIG9mIEVtYmVyIChl
LmcuICdFbWJlci5IYW5kbGViYXJzJykKICBoYXMgZnVsbHkgbG9hZGVkIGFuZCBpcyBhdmFpbGFi
bGUgZm9yIGV4dGVuc2lvbi4KCiAgVGhlIHByb3ZpZGVkIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxs
ZWQgd2l0aCB0aGUgYG5hbWVgIHBhc3NlZAogIHJlc29sdmVkIGZyb20gYSBzdHJpbmcgaW50byB0
aGUgb2JqZWN0OgoKICBgYGAgamF2YXNjcmlwdAogIEVtYmVyLm9uTG9hZCgnRW1iZXIuSGFuZGxl
YmFycycgZnVuY3Rpb24oaGJhcnMpewogICAgaGJhcnMucmVnaXN0ZXJIZWxwZXIoLi4uKTsKICB9
KTsKICBgYGAKCiAgQG1ldGhvZCBvbkxvYWQKICBAZm9yIEVtYmVyCiAgQHBhcmFtIG5hbWUge1N0
cmluZ30gbmFtZSBvZiBob29rCiAgQHBhcmFtIGNhbGxiYWNrIHtGdW5jdGlvbn0gY2FsbGJhY2sg
dG8gYmUgY2FsbGVkCiovCkVtYmVyLm9uTG9hZCA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7
CiAgdmFyIG9iamVjdDsKCiAgbG9hZEhvb2tzW25hbWVdID0gbG9hZEhvb2tzW25hbWVdIHx8IEVt
YmVyLkEoKTsKICBsb2FkSG9va3NbbmFtZV0ucHVzaE9iamVjdChjYWxsYmFjayk7CgogIGlmIChv
YmplY3QgPSBsb2FkZWRbbmFtZV0pIHsKICAgIGNhbGxiYWNrKG9iamVjdCk7CiAgfQp9OwoKLyoq
CiAgQ2FsbGVkIHdoZW4gYW4gRW1iZXIuanMgcGFja2FnZSAoZS5nIEVtYmVyLkhhbmRsZWJhcnMp
IGhhcyBmaW5pc2hlZAogIGxvYWRpbmcuIFRyaWdnZXJzIGFueSBjYWxsYmFja3MgcmVnaXN0ZXJl
ZCBmb3IgdGhpcyBldmVudC4KCiAgQG1ldGhvZCBydW5Mb2FkSG9va3MKICBAZm9yIEVtYmVyCiAg
QHBhcmFtIG5hbWUge1N0cmluZ30gbmFtZSBvZiBob29rCiAgQHBhcmFtIG9iamVjdCB7T2JqZWN0
fSBvYmplY3QgdG8gcGFzcyB0byBjYWxsYmFja3MKKi8KRW1iZXIucnVuTG9hZEhvb2tzID0gZnVu
Y3Rpb24obmFtZSwgb2JqZWN0KSB7CiAgbG9hZGVkW25hbWVdID0gb2JqZWN0OwoKICBpZiAobG9h
ZEhvb2tzW25hbWVdKSB7CiAgICBmb3JFYWNoLmNhbGwobG9hZEhvb2tzW25hbWVdLCBmdW5jdGlv
bihjYWxsYmFjaykgewogICAgICBjYWxsYmFjayhvYmplY3QpOwogICAgfSk7CiAgfQp9OwoKfSko
KTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgZ2V0ID0gRW1i
ZXIuZ2V0OwoKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgov
KioKICBgRW1iZXIuQ29udHJvbGxlck1peGluYCBwcm92aWRlcyBhIHN0YW5kYXJkIGludGVyZmFj
ZSBmb3IgYWxsIGNsYXNzZXMgdGhhdAogIGNvbXBvc2UgRW1iZXIncyBjb250cm9sbGVyIGxheWVy
OiBgRW1iZXIuQ29udHJvbGxlcmAsCiAgYEVtYmVyLkFycmF5Q29udHJvbGxlcmAsIGFuZCBgRW1i
ZXIuT2JqZWN0Q29udHJvbGxlcmAuCgogIEBjbGFzcyBDb250cm9sbGVyTWl4aW4KICBAbmFtZXNw
YWNlIEVtYmVyCiAgQHVzZXMgRW1iZXIuQWN0aW9uSGFuZGxlcgoqLwpFbWJlci5Db250cm9sbGVy
TWl4aW4gPSBFbWJlci5NaXhpbi5jcmVhdGUoRW1iZXIuQWN0aW9uSGFuZGxlciwgewogIC8qIGR1
Y2t0eXBlIGFzIGEgY29udHJvbGxlciAqLwogIGlzQ29udHJvbGxlcjogdHJ1ZSwKCiAgLyoqCiAg
ICBUaGUgb2JqZWN0IHRvIHdoaWNoIGFjdGlvbnMgZnJvbSB0aGUgdmlldyBzaG91bGQgYmUgc2Vu
dC4KCiAgICBGb3IgZXhhbXBsZSwgd2hlbiBhIEhhbmRsZWJhcnMgdGVtcGxhdGUgdXNlcyB0aGUg
YHt7YWN0aW9ufX1gIGhlbHBlciwKICAgIGl0IHdpbGwgYXR0ZW1wdCB0byBzZW5kIHRoZSBhY3Rp
b24gdG8gdGhlIHZpZXcncyBjb250cm9sbGVyJ3MgYHRhcmdldGAuCgogICAgQnkgZGVmYXVsdCwg
YSBjb250cm9sbGVyJ3MgYHRhcmdldGAgaXMgc2V0IHRvIHRoZSByb3V0ZXIgYWZ0ZXIgaXQgaXMK
ICAgIGluc3RhbnRpYXRlZCBieSBgRW1iZXIuQXBwbGljYXRpb24jaW5pdGlhbGl6ZWAuCgogICAg
QHByb3BlcnR5IHRhcmdldAogICAgQGRlZmF1bHQgbnVsbAogICovCiAgdGFyZ2V0OiBudWxsLAoK
ICBjb250YWluZXI6IG51bGwsCgogIHBhcmVudENvbnRyb2xsZXI6IG51bGwsCgogIHN0b3JlOiBu
dWxsLAoKICBtb2RlbDogRW1iZXIuY29tcHV0ZWQuYWxpYXMoJ2NvbnRlbnQnKSwKCiAgZGVwcmVj
YXRlZFNlbmRIYW5kbGVzOiBmdW5jdGlvbihhY3Rpb25OYW1lKSB7CiAgICByZXR1cm4gISF0aGlz
W2FjdGlvbk5hbWVdOwogIH0sCgogIGRlcHJlY2F0ZWRTZW5kOiBmdW5jdGlvbihhY3Rpb25OYW1l
KSB7CiAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIEVtYmVy
LmFzc2VydCgnJyArIHRoaXMgKyAiIGhhcyB0aGUgYWN0aW9uICIgKyBhY3Rpb25OYW1lICsgIiBi
dXQgaXQgaXMgbm90IGEgZnVuY3Rpb24iLCB0eXBlb2YgdGhpc1thY3Rpb25OYW1lXSA9PT0gJ2Z1
bmN0aW9uJyk7CiAgICBFbWJlci5kZXByZWNhdGUoJ0FjdGlvbiBoYW5kbGVycyBpbXBsZW1lbnRl
ZCBkaXJlY3RseSBvbiBjb250cm9sbGVycyBhcmUgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBhY3Rp
b24gaGFuZGxlcnMgb24gYW4gYGFjdGlvbnNgIG9iamVjdCAoJyArIGFjdGlvbk5hbWUgKyAnIG9u
ICcgKyB0aGlzICsgJyknLCBmYWxzZSk7CiAgICB0aGlzW2FjdGlvbk5hbWVdLmFwcGx5KHRoaXMs
IGFyZ3MpOwogICAgcmV0dXJuOwogIH0KfSk7CgovKioKICBAY2xhc3MgQ29udHJvbGxlcgogIEBu
YW1lc3BhY2UgRW1iZXIKICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKICBAdXNlcyBFbWJlci5Db250
cm9sbGVyTWl4aW4KKi8KRW1iZXIuQ29udHJvbGxlciA9IEVtYmVyLk9iamVjdC5leHRlbmQoRW1i
ZXIuQ29udHJvbGxlck1peGluKTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUg
ZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBz
ZXQgPSBFbWJlci5zZXQsIGZvckVhY2ggPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaDsK
Ci8qKgogIGBFbWJlci5Tb3J0YWJsZU1peGluYCBwcm92aWRlcyBhIHN0YW5kYXJkIGludGVyZmFj
ZSBmb3IgYXJyYXkgcHJveGllcwogIHRvIHNwZWNpZnkgYSBzb3J0IG9yZGVyIGFuZCBtYWludGFp
biB0aGlzIHNvcnRpbmcgd2hlbiBvYmplY3RzIGFyZSBhZGRlZCwKICByZW1vdmVkLCBvciB1cGRh
dGVkIHdpdGhvdXQgY2hhbmdpbmcgdGhlIGltcGxpY2l0IG9yZGVyIG9mIHRoZWlyIHVuZGVybHlp
bmcKICBjb250ZW50IGFycmF5OgoKICBgYGBqYXZhc2NyaXB0CiAgc29uZ3MgPSBbCiAgICB7dHJh
Y2tOdW1iZXI6IDQsIHRpdGxlOiAnT2ItTGEtRGksIE9iLUxhLURhJ30sCiAgICB7dHJhY2tOdW1i
ZXI6IDIsIHRpdGxlOiAnQmFjayBpbiB0aGUgVS5TLlMuUi4nfSwKICAgIHt0cmFja051bWJlcjog
MywgdGl0bGU6ICdHbGFzcyBPbmlvbid9LAogIF07CgogIHNvbmdzQ29udHJvbGxlciA9IEVtYmVy
LkFycmF5Q29udHJvbGxlci5jcmVhdGUoewogICAgY29udGVudDogc29uZ3MsCiAgICBzb3J0UHJv
cGVydGllczogWyd0cmFja051bWJlciddLAogICAgc29ydEFzY2VuZGluZzogdHJ1ZQogIH0pOwoK
ICBzb25nc0NvbnRyb2xsZXIuZ2V0KCdmaXJzdE9iamVjdCcpOyAgLy8ge3RyYWNrTnVtYmVyOiAy
LCB0aXRsZTogJ0JhY2sgaW4gdGhlIFUuUy5TLlIuJ30KCiAgc29uZ3NDb250cm9sbGVyLmFkZE9i
amVjdCh7dHJhY2tOdW1iZXI6IDEsIHRpdGxlOiAnRGVhciBQcnVkZW5jZSd9KTsKICBzb25nc0Nv
bnRyb2xsZXIuZ2V0KCdmaXJzdE9iamVjdCcpOyAgLy8ge3RyYWNrTnVtYmVyOiAxLCB0aXRsZTog
J0RlYXIgUHJ1ZGVuY2UnfQogIGBgYAoKICBJZiB5b3UgYWRkIG9yIHJlbW92ZSB0aGUgcHJvcGVy
dGllcyB0byBzb3J0IGJ5IG9yIGNoYW5nZSB0aGUgc29ydCBkaXJlY3Rpb24gdGhlIGNvbnRlbnQK
ICBzb3J0IG9yZGVyIHdpbGwgYmUgYXV0b21hdGljYWxseSB1cGRhdGVkLgoKICBgYGBqYXZhc2Ny
aXB0CiAgc29uZ3NDb250cm9sbGVyLnNldCgnc29ydFByb3BlcnRpZXMnLCBbJ3RpdGxlJ10pOwog
IHNvbmdzQ29udHJvbGxlci5nZXQoJ2ZpcnN0T2JqZWN0Jyk7IC8vIHt0cmFja051bWJlcjogMiwg
dGl0bGU6ICdCYWNrIGluIHRoZSBVLlMuUy5SLid9CgogIHNvbmdzQ29udHJvbGxlci50b2dnbGVQ
cm9wZXJ0eSgnc29ydEFzY2VuZGluZycpOwogIHNvbmdzQ29udHJvbGxlci5nZXQoJ2ZpcnN0T2Jq
ZWN0Jyk7IC8vIHt0cmFja051bWJlcjogNCwgdGl0bGU6ICdPYi1MYS1EaSwgT2ItTGEtRGEnfQog
IGBgYAoKICBTb3J0YWJsZU1peGluIHdvcmtzIGJ5IHNvcnRpbmcgdGhlIGFycmFuZ2VkQ29udGVu
dCBhcnJheSwgd2hpY2ggaXMgdGhlIGFycmF5IHRoYXQKICBhcnJheVByb3h5IGRpc3BsYXlzLiBE
dWUgdG8gdGhlIGZhY3QgdGhhdCB0aGUgdW5kZXJseWluZyAnY29udGVudCcgYXJyYXkgaXMgbm90
IGNoYW5nZWQsIHRoYXQKICBhcnJheSB3aWxsIG5vdCBkaXNwbGF5IHRoZSBzb3J0ZWQgbGlzdDoK
CiAgIGBgYGphdmFzY3JpcHQKICBzb25nc0NvbnRyb2xsZXIuZ2V0KCdjb250ZW50JykuZ2V0KCdm
aXJzdE9iamVjdCcpOyAvLyBSZXR1cm5zIHRoZSB1bnNvcnRlZCBvcmlnaW5hbCBjb250ZW50CiAg
c29uZ3NDb250cm9sbGVyLmdldCgnZmlyc3RPYmplY3QnKTsgLy8gUmV0dXJucyB0aGUgc29ydGVk
IGNvbnRlbnQuCiAgYGBgIAogIAogIEFsdGhvdWdoIHRoZSBzb3J0ZWQgY29udGVudCBjYW4gYWxz
byBiZSBhY2Nlc3NlZCB0aHJvdWdoIHRoZSBhcnJhbmdlZENvbnRlbnQgcHJvcGVydHksCiAgaXQg
aXMgcHJlZmVyYWJsZSB0byB1c2UgdGhlIHByb3hpZWQgY2xhc3MgYW5kIG5vdCB0aGUgYXJyYW5n
ZWRDb250ZW50IGFycmF5IGRpcmVjdGx5LgoKICBAY2xhc3MgU29ydGFibGVNaXhpbgogIEBuYW1l
c3BhY2UgRW1iZXIKICBAdXNlcyBFbWJlci5NdXRhYmxlRW51bWVyYWJsZQoqLwpFbWJlci5Tb3J0
YWJsZU1peGluID0gRW1iZXIuTWl4aW4uY3JlYXRlKEVtYmVyLk11dGFibGVFbnVtZXJhYmxlLCB7
CgogIC8qKgogICAgU3BlY2lmaWVzIHdoaWNoIHByb3BlcnRpZXMgZGljdGF0ZSB0aGUgYXJyYW5n
ZWRDb250ZW50J3Mgc29ydCBvcmRlci4KCiAgICBXaGVuIHNwZWNpZnlpbmcgbXVsdGlwbGUgcHJv
cGVydGllcyB0aGUgc29ydGluZyB3aWxsIHVzZSBwcm9wZXJ0aWVzCiAgICBmcm9tIHRoZSBgc29y
dFByb3BlcnRpZXNgIGFycmF5IHByaW9yaXRpemVkIGZyb20gZmlyc3QgdG8gbGFzdC4KCiAgICBA
cHJvcGVydHkge0FycmF5fSBzb3J0UHJvcGVydGllcwogICovCiAgc29ydFByb3BlcnRpZXM6IG51
bGwsCgogIC8qKgogICAgU3BlY2lmaWVzIHRoZSBhcnJhbmdlZENvbnRlbnQncyBzb3J0IGRpcmVj
dGlvbgoKICAgIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gc29ydEFzY2VuZGluZwogICovCiAgc29ydEFz
Y2VuZGluZzogdHJ1ZSwKCiAgLyoqCiAgICBUaGUgZnVuY3Rpb24gdXNlZCB0byBjb21wYXJlIHR3
byB2YWx1ZXMuIFlvdSBjYW4gb3ZlcnJpZGUgdGhpcyBpZiB5b3UKICAgIHdhbnQgdG8gZG8gY3Vz
dG9tIGNvbXBhcmlzb25zLiBGdW5jdGlvbnMgbXVzdCBiZSBvZiB0aGUgdHlwZSBleHBlY3RlZCBi
eQogICAgQXJyYXkjc29ydCwgaS5lLgogICAgICByZXR1cm4gMCBpZiB0aGUgdHdvIHBhcmFtZXRl
cnMgYXJlIGVxdWFsLAogICAgICByZXR1cm4gYSBuZWdhdGl2ZSB2YWx1ZSBpZiB0aGUgZmlyc3Qg
cGFyYW1ldGVyIGlzIHNtYWxsZXIgdGhhbiB0aGUgc2Vjb25kIG9yCiAgICAgIHJldHVybiBhIHBv
c2l0aXZlIHZhbHVlIG90aGVyd2lzZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBmdW5jdGlvbih4
LHkpIHsgLy8gVGhlc2UgYXJlIGFzc3VtZWQgdG8gYmUgaW50ZWdlcnMKICAgICAgaWYgKHggPT09
IHkpCiAgICAgICAgcmV0dXJuIDA7CiAgICAgIHJldHVybiB4IDwgeSA/IC0xIDogMTsKICAgIH0K
ICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBzb3J0RnVuY3Rpb24KICAgIEB0eXBlIHtGdW5jdGlvbn0K
ICAgIEBkZWZhdWx0IEVtYmVyLmNvbXBhcmUKICAqLwogIHNvcnRGdW5jdGlvbjogRW1iZXIuY29t
cGFyZSwKCiAgb3JkZXJCeTogZnVuY3Rpb24oaXRlbTEsIGl0ZW0yKSB7CiAgICB2YXIgcmVzdWx0
ID0gMCwKICAgICAgICBzb3J0UHJvcGVydGllcyA9IGdldCh0aGlzLCAnc29ydFByb3BlcnRpZXMn
KSwKICAgICAgICBzb3J0QXNjZW5kaW5nID0gZ2V0KHRoaXMsICdzb3J0QXNjZW5kaW5nJyksCiAg
ICAgICAgc29ydEZ1bmN0aW9uID0gZ2V0KHRoaXMsICdzb3J0RnVuY3Rpb24nKTsKCiAgICBFbWJl
ci5hc3NlcnQoInlvdSBuZWVkIHRvIGRlZmluZSBgc29ydFByb3BlcnRpZXNgIiwgISFzb3J0UHJv
cGVydGllcyk7CgogICAgZm9yRWFjaChzb3J0UHJvcGVydGllcywgZnVuY3Rpb24ocHJvcGVydHlO
YW1lKSB7CiAgICAgIGlmIChyZXN1bHQgPT09IDApIHsKICAgICAgICByZXN1bHQgPSBzb3J0RnVu
Y3Rpb24oZ2V0KGl0ZW0xLCBwcm9wZXJ0eU5hbWUpLCBnZXQoaXRlbTIsIHByb3BlcnR5TmFtZSkp
OwogICAgICAgIGlmICgocmVzdWx0ICE9PSAwKSAmJiAhc29ydEFzY2VuZGluZykgewogICAgICAg
ICAgcmVzdWx0ID0gKC0xKSAqIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAg
IHJldHVybiByZXN1bHQ7CiAgfSwKCiAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICB2YXIgY29u
dGVudCA9IGdldCh0aGlzLCAnY29udGVudCcpLAogICAgICAgIHNvcnRQcm9wZXJ0aWVzID0gZ2V0
KHRoaXMsICdzb3J0UHJvcGVydGllcycpOwoKICAgIGlmIChjb250ZW50ICYmIHNvcnRQcm9wZXJ0
aWVzKSB7CiAgICAgIGZvckVhY2goY29udGVudCwgZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGZv
ckVhY2goc29ydFByb3BlcnRpZXMsIGZ1bmN0aW9uKHNvcnRQcm9wZXJ0eSkgewogICAgICAgICAg
RW1iZXIucmVtb3ZlT2JzZXJ2ZXIoaXRlbSwgc29ydFByb3BlcnR5LCB0aGlzLCAnY29udGVudEl0
ZW1Tb3J0UHJvcGVydHlEaWRDaGFuZ2UnKTsKICAgICAgICB9LCB0aGlzKTsKICAgICAgfSwgdGhp
cyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX3N1cGVyKCk7CiAgfSwKCiAgaXNTb3J0ZWQ6IEVt
YmVyLmNvbXB1dGVkLmJvb2woJ3NvcnRQcm9wZXJ0aWVzJyksCgogIC8qKgogICAgT3ZlcnJpZGVz
IHRoZSBkZWZhdWx0IGFycmFuZ2VkQ29udGVudCBmcm9tIGFycmF5UHJveHkgaW4gb3JkZXIgdG8g
c29ydCBieSBzb3J0RnVuY3Rpb24uCiAgICBBbHNvIHNldHMgdXAgb2JzZXJ2ZXJzIGZvciBlYWNo
IHNvcnRQcm9wZXJ0eSBvbiBlYWNoIGl0ZW0gaW4gdGhlIGNvbnRlbnQgQXJyYXkuCiAgICAKICAg
IEBwcm9wZXJ0eSBhcnJhbmdlZENvbnRlbnQKICAqLwoKICBhcnJhbmdlZENvbnRlbnQ6IEVtYmVy
LmNvbXB1dGVkKCdjb250ZW50JywgJ3NvcnRQcm9wZXJ0aWVzLkBlYWNoJywgZnVuY3Rpb24oa2V5
LCB2YWx1ZSkgewogICAgdmFyIGNvbnRlbnQgPSBnZXQodGhpcywgJ2NvbnRlbnQnKSwKICAgICAg
ICBpc1NvcnRlZCA9IGdldCh0aGlzLCAnaXNTb3J0ZWQnKSwKICAgICAgICBzb3J0UHJvcGVydGll
cyA9IGdldCh0aGlzLCAnc29ydFByb3BlcnRpZXMnKSwKICAgICAgICBzZWxmID0gdGhpczsKCiAg
ICBpZiAoY29udGVudCAmJiBpc1NvcnRlZCkgewogICAgICBjb250ZW50ID0gY29udGVudC5zbGlj
ZSgpOwogICAgICBjb250ZW50LnNvcnQoZnVuY3Rpb24oaXRlbTEsIGl0ZW0yKSB7CiAgICAgICAg
cmV0dXJuIHNlbGYub3JkZXJCeShpdGVtMSwgaXRlbTIpOwogICAgICB9KTsKICAgICAgZm9yRWFj
aChjb250ZW50LCBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgZm9yRWFjaChzb3J0UHJvcGVydGll
cywgZnVuY3Rpb24oc29ydFByb3BlcnR5KSB7CiAgICAgICAgICBFbWJlci5hZGRPYnNlcnZlcihp
dGVtLCBzb3J0UHJvcGVydHksIHRoaXMsICdjb250ZW50SXRlbVNvcnRQcm9wZXJ0eURpZENoYW5n
ZScpOwogICAgICAgIH0sIHRoaXMpOwogICAgICB9LCB0aGlzKTsKICAgICAgcmV0dXJuIEVtYmVy
LkEoY29udGVudCk7CiAgICB9CgogICAgcmV0dXJuIGNvbnRlbnQ7CiAgfSksCgogIF9jb250ZW50
V2lsbENoYW5nZTogRW1iZXIuYmVmb3JlT2JzZXJ2ZXIoJ2NvbnRlbnQnLCBmdW5jdGlvbigpIHsK
ICAgIHZhciBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50JyksCiAgICAgICAgc29ydFByb3Bl
cnRpZXMgPSBnZXQodGhpcywgJ3NvcnRQcm9wZXJ0aWVzJyk7CgogICAgaWYgKGNvbnRlbnQgJiYg
c29ydFByb3BlcnRpZXMpIHsKICAgICAgZm9yRWFjaChjb250ZW50LCBmdW5jdGlvbihpdGVtKSB7
CiAgICAgICAgZm9yRWFjaChzb3J0UHJvcGVydGllcywgZnVuY3Rpb24oc29ydFByb3BlcnR5KSB7
CiAgICAgICAgICBFbWJlci5yZW1vdmVPYnNlcnZlcihpdGVtLCBzb3J0UHJvcGVydHksIHRoaXMs
ICdjb250ZW50SXRlbVNvcnRQcm9wZXJ0eURpZENoYW5nZScpOwogICAgICAgIH0sIHRoaXMpOwog
ICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICB0aGlzLl9zdXBlcigpOwogIH0pLAoKICBzb3J0QXNj
ZW5kaW5nV2lsbENoYW5nZTogRW1iZXIuYmVmb3JlT2JzZXJ2ZXIoJ3NvcnRBc2NlbmRpbmcnLCBm
dW5jdGlvbigpIHsKICAgIHRoaXMuX2xhc3RTb3J0QXNjZW5kaW5nID0gZ2V0KHRoaXMsICdzb3J0
QXNjZW5kaW5nJyk7CiAgfSksCgogIHNvcnRBc2NlbmRpbmdEaWRDaGFuZ2U6IEVtYmVyLm9ic2Vy
dmVyKCdzb3J0QXNjZW5kaW5nJywgZnVuY3Rpb24oKSB7CiAgICBpZiAoZ2V0KHRoaXMsICdzb3J0
QXNjZW5kaW5nJykgIT09IHRoaXMuX2xhc3RTb3J0QXNjZW5kaW5nKSB7CiAgICAgIHZhciBhcnJh
bmdlZENvbnRlbnQgPSBnZXQodGhpcywgJ2FycmFuZ2VkQ29udGVudCcpOwogICAgICBhcnJhbmdl
ZENvbnRlbnQucmV2ZXJzZU9iamVjdHMoKTsKICAgIH0KICB9KSwKCiAgY29udGVudEFycmF5V2ls
bENoYW5nZTogZnVuY3Rpb24oYXJyYXksIGlkeCwgcmVtb3ZlZENvdW50LCBhZGRlZENvdW50KSB7
CiAgICB2YXIgaXNTb3J0ZWQgPSBnZXQodGhpcywgJ2lzU29ydGVkJyk7CgogICAgaWYgKGlzU29y
dGVkKSB7CiAgICAgIHZhciBhcnJhbmdlZENvbnRlbnQgPSBnZXQodGhpcywgJ2FycmFuZ2VkQ29u
dGVudCcpOwogICAgICB2YXIgcmVtb3ZlZE9iamVjdHMgPSBhcnJheS5zbGljZShpZHgsIGlkeCty
ZW1vdmVkQ291bnQpOwogICAgICB2YXIgc29ydFByb3BlcnRpZXMgPSBnZXQodGhpcywgJ3NvcnRQ
cm9wZXJ0aWVzJyk7CgogICAgICBmb3JFYWNoKHJlbW92ZWRPYmplY3RzLCBmdW5jdGlvbihpdGVt
KSB7CiAgICAgICAgYXJyYW5nZWRDb250ZW50LnJlbW92ZU9iamVjdChpdGVtKTsKCiAgICAgICAg
Zm9yRWFjaChzb3J0UHJvcGVydGllcywgZnVuY3Rpb24oc29ydFByb3BlcnR5KSB7CiAgICAgICAg
ICBFbWJlci5yZW1vdmVPYnNlcnZlcihpdGVtLCBzb3J0UHJvcGVydHksIHRoaXMsICdjb250ZW50
SXRlbVNvcnRQcm9wZXJ0eURpZENoYW5nZScpOwogICAgICAgIH0sIHRoaXMpOwogICAgICB9LCB0
aGlzKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fc3VwZXIoYXJyYXksIGlkeCwgcmVtb3ZlZENv
dW50LCBhZGRlZENvdW50KTsKICB9LAoKICBjb250ZW50QXJyYXlEaWRDaGFuZ2U6IGZ1bmN0aW9u
KGFycmF5LCBpZHgsIHJlbW92ZWRDb3VudCwgYWRkZWRDb3VudCkgewogICAgdmFyIGlzU29ydGVk
ID0gZ2V0KHRoaXMsICdpc1NvcnRlZCcpLAogICAgICAgIHNvcnRQcm9wZXJ0aWVzID0gZ2V0KHRo
aXMsICdzb3J0UHJvcGVydGllcycpOwoKICAgIGlmIChpc1NvcnRlZCkgewogICAgICB2YXIgYWRk
ZWRPYmplY3RzID0gYXJyYXkuc2xpY2UoaWR4LCBpZHgrYWRkZWRDb3VudCk7CgogICAgICBmb3JF
YWNoKGFkZGVkT2JqZWN0cywgZnVuY3Rpb24oaXRlbSkgewogICAgICAgIHRoaXMuaW5zZXJ0SXRl
bVNvcnRlZChpdGVtKTsKCiAgICAgICAgZm9yRWFjaChzb3J0UHJvcGVydGllcywgZnVuY3Rpb24o
c29ydFByb3BlcnR5KSB7CiAgICAgICAgICBFbWJlci5hZGRPYnNlcnZlcihpdGVtLCBzb3J0UHJv
cGVydHksIHRoaXMsICdjb250ZW50SXRlbVNvcnRQcm9wZXJ0eURpZENoYW5nZScpOwogICAgICAg
IH0sIHRoaXMpOwogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fc3VwZXIo
YXJyYXksIGlkeCwgcmVtb3ZlZENvdW50LCBhZGRlZENvdW50KTsKICB9LAoKICBpbnNlcnRJdGVt
U29ydGVkOiBmdW5jdGlvbihpdGVtKSB7CiAgICB2YXIgYXJyYW5nZWRDb250ZW50ID0gZ2V0KHRo
aXMsICdhcnJhbmdlZENvbnRlbnQnKTsKICAgIHZhciBsZW5ndGggPSBnZXQoYXJyYW5nZWRDb250
ZW50LCAnbGVuZ3RoJyk7CgogICAgdmFyIGlkeCA9IHRoaXMuX2JpbmFyeVNlYXJjaChpdGVtLCAw
LCBsZW5ndGgpOwogICAgYXJyYW5nZWRDb250ZW50Lmluc2VydEF0KGlkeCwgaXRlbSk7CiAgfSwK
CiAgY29udGVudEl0ZW1Tb3J0UHJvcGVydHlEaWRDaGFuZ2U6IGZ1bmN0aW9uKGl0ZW0pIHsKICAg
IHZhciBhcnJhbmdlZENvbnRlbnQgPSBnZXQodGhpcywgJ2FycmFuZ2VkQ29udGVudCcpLAogICAg
ICAgIG9sZEluZGV4ID0gYXJyYW5nZWRDb250ZW50LmluZGV4T2YoaXRlbSksCiAgICAgICAgbGVm
dEl0ZW0gPSBhcnJhbmdlZENvbnRlbnQub2JqZWN0QXQob2xkSW5kZXggLSAxKSwKICAgICAgICBy
aWdodEl0ZW0gPSBhcnJhbmdlZENvbnRlbnQub2JqZWN0QXQob2xkSW5kZXggKyAxKSwKICAgICAg
ICBsZWZ0UmVzdWx0ID0gbGVmdEl0ZW0gJiYgdGhpcy5vcmRlckJ5KGl0ZW0sIGxlZnRJdGVtKSwK
ICAgICAgICByaWdodFJlc3VsdCA9IHJpZ2h0SXRlbSAmJiB0aGlzLm9yZGVyQnkoaXRlbSwgcmln
aHRJdGVtKTsKCiAgICBpZiAobGVmdFJlc3VsdCA8IDAgfHwgcmlnaHRSZXN1bHQgPiAwKSB7CiAg
ICAgIGFycmFuZ2VkQ29udGVudC5yZW1vdmVPYmplY3QoaXRlbSk7CiAgICAgIHRoaXMuaW5zZXJ0
SXRlbVNvcnRlZChpdGVtKTsKICAgIH0KICB9LAoKICBfYmluYXJ5U2VhcmNoOiBmdW5jdGlvbihp
dGVtLCBsb3csIGhpZ2gpIHsKICAgIHZhciBtaWQsIG1pZEl0ZW0sIHJlcywgYXJyYW5nZWRDb250
ZW50OwoKICAgIGlmIChsb3cgPT09IGhpZ2gpIHsKICAgICAgcmV0dXJuIGxvdzsKICAgIH0KCiAg
ICBhcnJhbmdlZENvbnRlbnQgPSBnZXQodGhpcywgJ2FycmFuZ2VkQ29udGVudCcpOwoKICAgIG1p
ZCA9IGxvdyArIE1hdGguZmxvb3IoKGhpZ2ggLSBsb3cpIC8gMik7CiAgICBtaWRJdGVtID0gYXJy
YW5nZWRDb250ZW50Lm9iamVjdEF0KG1pZCk7CgogICAgcmVzID0gdGhpcy5vcmRlckJ5KG1pZEl0
ZW0sIGl0ZW0pOwoKICAgIGlmIChyZXMgPCAwKSB7CiAgICAgIHJldHVybiB0aGlzLl9iaW5hcnlT
ZWFyY2goaXRlbSwgbWlkKzEsIGhpZ2gpOwogICAgfSBlbHNlIGlmIChyZXMgPiAwKSB7CiAgICAg
IHJldHVybiB0aGlzLl9iaW5hcnlTZWFyY2goaXRlbSwgbG93LCBtaWQpOwogICAgfQoKICAgIHJl
dHVybiBtaWQ7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1i
ZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1lCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQg
PSBFbWJlci5zZXQsIGZvckVhY2ggPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaCwKICAg
IHJlcGxhY2UgPSBFbWJlci5FbnVtZXJhYmxlVXRpbHMucmVwbGFjZTsKCi8qKgogIGBFbWJlci5B
cnJheUNvbnRyb2xsZXJgIHByb3ZpZGVzIGEgd2F5IGZvciB5b3UgdG8gcHVibGlzaCBhIGNvbGxl
Y3Rpb24gb2YKICBvYmplY3RzIHNvIHRoYXQgeW91IGNhbiBlYXNpbHkgYmluZCB0byB0aGUgY29s
bGVjdGlvbiBmcm9tIGEgSGFuZGxlYmFycwogIGAjZWFjaGAgaGVscGVyLCBhbiBgRW1iZXIuQ29s
bGVjdGlvblZpZXdgLCBvciBvdGhlciBjb250cm9sbGVycy4KCiAgVGhlIGFkdmFudGFnZSBvZiB1
c2luZyBhbiBgQXJyYXlDb250cm9sbGVyYCBpcyB0aGF0IHlvdSBvbmx5IGhhdmUgdG8gc2V0IHVw
CiAgeW91ciB2aWV3IGJpbmRpbmdzIG9uY2U7IHRvIGNoYW5nZSB3aGF0J3MgZGlzcGxheWVkLCBz
aW1wbHkgc3dhcCBvdXQgdGhlCiAgYGNvbnRlbnRgIHByb3BlcnR5IG9uIHRoZSBjb250cm9sbGVy
LgoKICBGb3IgZXhhbXBsZSwgaW1hZ2luZSB5b3Ugd2FudGVkIHRvIGRpc3BsYXkgYSBsaXN0IG9m
IGl0ZW1zIGZldGNoZWQgdmlhIGFuIFhIUgogIHJlcXVlc3QuIENyZWF0ZSBhbiBgRW1iZXIuQXJy
YXlDb250cm9sbGVyYCBhbmQgc2V0IGl0cyBgY29udGVudGAgcHJvcGVydHk6CgogIGBgYGphdmFz
Y3JpcHQKICBNeUFwcC5saXN0Q29udHJvbGxlciA9IEVtYmVyLkFycmF5Q29udHJvbGxlci5jcmVh
dGUoKTsKCiAgJC5nZXQoJ3Blb3BsZS5qc29uJywgZnVuY3Rpb24oZGF0YSkgewogICAgTXlBcHAu
bGlzdENvbnRyb2xsZXIuc2V0KCdjb250ZW50JywgZGF0YSk7CiAgfSk7CiAgYGBgCgogIFRoZW4s
IGNyZWF0ZSBhIHZpZXcgdGhhdCBiaW5kcyB0byB5b3VyIG5ldyBjb250cm9sbGVyOgoKICBgYGBo
YW5kbGViYXJzCiAge3sjZWFjaCBNeUFwcC5saXN0Q29udHJvbGxlcn19CiAgICB7e2ZpcnN0TmFt
ZX19IHt7bGFzdE5hbWV9fQogIHt7L2VhY2h9fQogIGBgYAoKICBBbHRob3VnaCB5b3UgYXJlIGJp
bmRpbmcgdG8gdGhlIGNvbnRyb2xsZXIsIHRoZSBiZWhhdmlvciBvZiB0aGlzIGNvbnRyb2xsZXIK
ICBpcyB0byBwYXNzIHRocm91Z2ggYW55IG1ldGhvZHMgb3IgcHJvcGVydGllcyB0byB0aGUgdW5k
ZXJseWluZyBhcnJheS4gVGhpcwogIGNhcGFiaWxpdHkgY29tZXMgZnJvbSBgRW1iZXIuQXJyYXlQ
cm94eWAsIHdoaWNoIHRoaXMgY2xhc3MgaW5oZXJpdHMgZnJvbS4KCiAgU29tZXRpbWVzIHlvdSB3
YW50IHRvIGRpc3BsYXkgY29tcHV0ZWQgcHJvcGVydGllcyB3aXRoaW4gdGhlIGJvZHkgb2YgYW4K
ICBgI2VhY2hgIGhlbHBlciB0aGF0IGRlcGVuZCBvbiB0aGUgdW5kZXJseWluZyBpdGVtcyBpbiBg
Y29udGVudGAsIGJ1dCBhcmUgbm90CiAgcHJlc2VudCBvbiB0aG9zZSBpdGVtcy4gICBUbyBkbyB0
aGlzLCBzZXQgYGl0ZW1Db250cm9sbGVyYCB0byB0aGUgbmFtZSBvZiBhCiAgY29udHJvbGxlciAo
cHJvYmFibHkgYW4gYE9iamVjdENvbnRyb2xsZXJgKSB0aGF0IHdpbGwgd3JhcCBlYWNoIGluZGl2
aWR1YWwgaXRlbS4KCiAgRm9yIGV4YW1wbGU6CgogIGBgYGhhbmRsZWJhcnMKICAgIHt7I2VhY2gg
cG9zdCBpbiBjb250cm9sbGVyfX0KICAgICAgPGxpPnt7dGl0bGV9fSAoe3t0aXRsZUxlbmd0aH19
IGNoYXJhY3RlcnMpPC9saT4KICAgIHt7L2VhY2h9fQogIGBgYAoKICBgYGBqYXZhc2NyaXB0CiAg
QXBwLlBvc3RzQ29udHJvbGxlciA9IEVtYmVyLkFycmF5Q29udHJvbGxlci5leHRlbmQoewogICAg
aXRlbUNvbnRyb2xsZXI6ICdwb3N0JwogIH0pOwoKICBBcHAuUG9zdENvbnRyb2xsZXIgPSBFbWJl
ci5PYmplY3RDb250cm9sbGVyLmV4dGVuZCh7CiAgICAvLyB0aGUgYHRpdGxlYCBwcm9wZXJ0eSB3
aWxsIGJlIHByb3hpZWQgdG8gdGhlIHVuZGVybHlpbmcgcG9zdC4KCiAgICB0aXRsZUxlbmd0aDog
ZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmdldCgndGl0bGUnKS5sZW5ndGg7CiAgICB9
LnByb3BlcnR5KCd0aXRsZScpCiAgfSk7CiAgYGBgCgogIEluIHNvbWUgY2FzZXMgaXQgaXMgaGVs
cGZ1bCB0byByZXR1cm4gYSBkaWZmZXJlbnQgYGl0ZW1Db250cm9sbGVyYCBkZXBlbmRpbmcKICBv
biB0aGUgcGFydGljdWxhciBpdGVtLiAgU3ViY2xhc3NlcyBjYW4gZG8gdGhpcyBieSBvdmVycmlk
aW5nCiAgYGxvb2t1cEl0ZW1Db250cm9sbGVyYC4KCiAgRm9yIGV4YW1wbGU6CgogIGBgYGphdmFz
Y3JpcHQKICBBcHAuTXlBcnJheUNvbnRyb2xsZXIgPSBFbWJlci5BcnJheUNvbnRyb2xsZXIuZXh0
ZW5kKHsKICAgIGxvb2t1cEl0ZW1Db250cm9sbGVyOiBmdW5jdGlvbiggb2JqZWN0ICkgewogICAg
ICBpZiAob2JqZWN0LmdldCgnaXNTcGVjaWFsJykpIHsKICAgICAgICByZXR1cm4gInNwZWNpYWwi
OyAvLyB1c2UgQXBwLlNwZWNpYWxDb250cm9sbGVyCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0
dXJuICJyZWd1bGFyIjsgLy8gdXNlIEFwcC5SZWd1bGFyQ29udHJvbGxlcgogICAgICB9CiAgICB9
CiAgfSk7CiAgYGBgCgogIFRoZSBpdGVtQ29udHJvbGxlciBpbnN0YW5jZXMgd2lsbCBoYXZlIGEg
YHBhcmVudENvbnRyb2xsZXJgIHByb3BlcnR5IHNldCB0bwogIGVpdGhlciB0aGUgdGhlIGBwYXJl
bnRDb250cm9sbGVyYCBwcm9wZXJ0eSBvZiB0aGUgYEFycmF5Q29udHJvbGxlcmAKICBvciB0byB0
aGUgYEFycmF5Q29udHJvbGxlcmAgaW5zdGFuY2UgaXRzZWxmLgoKICBAY2xhc3MgQXJyYXlDb250
cm9sbGVyCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLkFycmF5UHJveHkKICBA
dXNlcyBFbWJlci5Tb3J0YWJsZU1peGluCiAgQHVzZXMgRW1iZXIuQ29udHJvbGxlck1peGluCiov
CgpFbWJlci5BcnJheUNvbnRyb2xsZXIgPSBFbWJlci5BcnJheVByb3h5LmV4dGVuZChFbWJlci5D
b250cm9sbGVyTWl4aW4sCiAgRW1iZXIuU29ydGFibGVNaXhpbiwgewoKICAvKioKICAgIFRoZSBj
b250cm9sbGVyIHVzZWQgdG8gd3JhcCBpdGVtcywgaWYgYW55LgoKICAgIEBwcm9wZXJ0eSBpdGVt
Q29udHJvbGxlcgogICAgQHR5cGUgU3RyaW5nCiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBpdGVt
Q29udHJvbGxlcjogbnVsbCwKCiAgLyoqCiAgICBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGNvbnRy
b2xsZXIgdG8gd3JhcCBpdGVtcywgb3IgYG51bGxgIGlmIGl0ZW1zIHNob3VsZAogICAgYmUgcmV0
dXJuZWQgZGlyZWN0bHkuICBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBzaW1wbHkgcmV0dXJu
cyB0aGUKICAgIGBpdGVtQ29udHJvbGxlcmAgcHJvcGVydHksIGJ1dCBzdWJjbGFzc2VzIGNhbiBv
dmVycmlkZSB0aGlzIG1ldGhvZCB0byByZXR1cm4KICAgIGRpZmZlcmVudCBjb250cm9sbGVycyBm
b3IgZGlmZmVyZW50IG9iamVjdHMuCgogICAgRm9yIGV4YW1wbGU6CgogICAgYGBgamF2YXNjcmlw
dAogICAgQXBwLk15QXJyYXlDb250cm9sbGVyID0gRW1iZXIuQXJyYXlDb250cm9sbGVyLmV4dGVu
ZCh7CiAgICAgIGxvb2t1cEl0ZW1Db250cm9sbGVyOiBmdW5jdGlvbiggb2JqZWN0ICkgewogICAg
ICAgIGlmIChvYmplY3QuZ2V0KCdpc1NwZWNpYWwnKSkgewogICAgICAgICAgcmV0dXJuICJzcGVj
aWFsIjsgLy8gdXNlIEFwcC5TcGVjaWFsQ29udHJvbGxlcgogICAgICAgIH0gZWxzZSB7CiAgICAg
ICAgICByZXR1cm4gInJlZ3VsYXIiOyAvLyB1c2UgQXBwLlJlZ3VsYXJDb250cm9sbGVyCiAgICAg
ICAgfQogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2QgbG9va3VwSXRlbUNvbnRy
b2xsZXIKICAgIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QKICAgIEByZXR1cm4ge1N0cmluZ30KICAq
LwogIGxvb2t1cEl0ZW1Db250cm9sbGVyOiBmdW5jdGlvbihvYmplY3QpIHsKICAgIHJldHVybiBn
ZXQodGhpcywgJ2l0ZW1Db250cm9sbGVyJyk7CiAgfSwKCiAgb2JqZWN0QXRDb250ZW50OiBmdW5j
dGlvbihpZHgpIHsKICAgIHZhciBsZW5ndGggPSBnZXQodGhpcywgJ2xlbmd0aCcpLAogICAgICAg
IGFycmFuZ2VkQ29udGVudCA9IGdldCh0aGlzLCdhcnJhbmdlZENvbnRlbnQnKSwKICAgICAgICBv
YmplY3QgPSBhcnJhbmdlZENvbnRlbnQgJiYgYXJyYW5nZWRDb250ZW50Lm9iamVjdEF0KGlkeCk7
CgogICAgaWYgKGlkeCA+PSAwICYmIGlkeCA8IGxlbmd0aCkgewogICAgICB2YXIgY29udHJvbGxl
ckNsYXNzID0gdGhpcy5sb29rdXBJdGVtQ29udHJvbGxlcihvYmplY3QpOwogICAgICBpZiAoY29u
dHJvbGxlckNsYXNzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbGxlckF0KGlkeCwgb2Jq
ZWN0LCBjb250cm9sbGVyQ2xhc3MpOwogICAgICB9CiAgICB9CgogICAgLy8gV2hlbiBgY29udHJv
bGxlckNsYXNzYCBpcyBmYWxzeSwgd2UgaGF2ZSBub3Qgb3B0ZWQgaW4gdG8gdXNpbmcgaXRlbQog
ICAgLy8gY29udHJvbGxlcnMsIHNvIHJldHVybiB0aGUgb2JqZWN0IGRpcmVjdGx5LgoKICAgIC8v
IFdoZW4gdGhlIGluZGV4IGlzIG91dCBvZiByYW5nZSwgd2Ugd2FudCB0byByZXR1cm4gdGhlICJv
dXQgb2YgcmFuZ2UiCiAgICAvLyB2YWx1ZSwgd2hhdGV2ZXIgdGhhdCBtaWdodCBiZS4gIFJhdGhl
ciB0aGFuIG1ha2UgYXNzdW1wdGlvbnMKICAgIC8vIChlLmcuIGd1ZXNzaW5nIGBudWxsYCBvciBg
dW5kZWZpbmVkYCkgd2UgZGVmZXIgdGhpcyB0byBgYXJyYW5nZWRDb250ZW50YC4KICAgIHJldHVy
biBvYmplY3Q7CiAgfSwKCiAgYXJyYW5nZWRDb250ZW50RGlkQ2hhbmdlOiBmdW5jdGlvbigpIHsK
ICAgIHRoaXMuX3N1cGVyKCk7CiAgICB0aGlzLl9yZXNldFN1YkNvbnRyb2xsZXJzKCk7CiAgfSwK
CiAgYXJyYXlDb250ZW50RGlkQ2hhbmdlOiBmdW5jdGlvbihpZHgsIHJlbW92ZWRDbnQsIGFkZGVk
Q250KSB7CiAgICB2YXIgc3ViQ29udHJvbGxlcnMgPSBnZXQodGhpcywgJ19zdWJDb250cm9sbGVy
cycpLAogICAgICAgIHN1YkNvbnRyb2xsZXJzVG9SZW1vdmUgPSBzdWJDb250cm9sbGVycy5zbGlj
ZShpZHgsIGlkeCtyZW1vdmVkQ250KTsKCiAgICBmb3JFYWNoKHN1YkNvbnRyb2xsZXJzVG9SZW1v
dmUsIGZ1bmN0aW9uKHN1YkNvbnRyb2xsZXIpIHsKICAgICAgaWYgKHN1YkNvbnRyb2xsZXIpIHsg
c3ViQ29udHJvbGxlci5kZXN0cm95KCk7IH0KICAgIH0pOwoKICAgIHJlcGxhY2Uoc3ViQ29udHJv
bGxlcnMsIGlkeCwgcmVtb3ZlZENudCwgbmV3IEFycmF5KGFkZGVkQ250KSk7CgogICAgLy8gVGhl
IHNoYWRvdyBhcnJheSBvZiBzdWJjb250cm9sbGVycyBtdXN0IGJlIHVwZGF0ZWQgYmVmb3JlIHdl
IHRyaWdnZXIKICAgIC8vIG9ic2VydmVycywgb3RoZXJ3aXNlIG9ic2VydmVycyB3aWxsIGdldCB0
aGUgd3Jvbmcgc3ViY29udGFpbmVyIHdoZW4KICAgIC8vIGNhbGxpbmcgYG9iamVjdEF0YAogICAg
dGhpcy5fc3VwZXIoaWR4LCByZW1vdmVkQ250LCBhZGRlZENudCk7CiAgfSwKCiAgaW5pdDogZnVu
Y3Rpb24oKSB7CiAgICB0aGlzLl9zdXBlcigpOwoKICAgIHRoaXMuc2V0KCdfc3ViQ29udHJvbGxl
cnMnLCBFbWJlci5BKCkpOwogIH0sCgogIGNvbnRlbnQ6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9u
ICgpIHsKICAgIHJldHVybiBFbWJlci5BKCk7CiAgfSksCgogIGNvbnRyb2xsZXJBdDogZnVuY3Rp
b24oaWR4LCBvYmplY3QsIGNvbnRyb2xsZXJDbGFzcykgewogICAgdmFyIGNvbnRhaW5lciA9IGdl
dCh0aGlzLCAnY29udGFpbmVyJyksCiAgICAgICAgc3ViQ29udHJvbGxlcnMgPSBnZXQodGhpcywg
J19zdWJDb250cm9sbGVycycpLAogICAgICAgIHN1YkNvbnRyb2xsZXIgPSBzdWJDb250cm9sbGVy
c1tpZHhdLAogICAgICAgIGZhY3RvcnksIGZ1bGxOYW1lOwoKICAgIGlmIChzdWJDb250cm9sbGVy
KSB7IHJldHVybiBzdWJDb250cm9sbGVyOyB9CgogICAgZnVsbE5hbWUgPSAiY29udHJvbGxlcjoi
ICsgY29udHJvbGxlckNsYXNzOwoKICAgIGlmICghY29udGFpbmVyLmhhcyhmdWxsTmFtZSkpIHsK
ICAgICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCdDb3VsZCBub3QgcmVzb2x2ZSBpdGVtQ29udHJv
bGxlcjogIicgKyBjb250cm9sbGVyQ2xhc3MgKyAnIicpOwogICAgfQoKICAgIHN1YkNvbnRyb2xs
ZXIgPSBjb250YWluZXIubG9va3VwRmFjdG9yeShmdWxsTmFtZSkuY3JlYXRlKHsKICAgICAgdGFy
Z2V0OiB0aGlzLAogICAgICBwYXJlbnRDb250cm9sbGVyOiBnZXQodGhpcywgJ3BhcmVudENvbnRy
b2xsZXInKSB8fCB0aGlzLAogICAgICBjb250ZW50OiBvYmplY3QKICAgIH0pOwoKICAgIHN1YkNv
bnRyb2xsZXJzW2lkeF0gPSBzdWJDb250cm9sbGVyOwoKICAgIHJldHVybiBzdWJDb250cm9sbGVy
OwogIH0sCgogIF9zdWJDb250cm9sbGVyczogbnVsbCwKCiAgX3Jlc2V0U3ViQ29udHJvbGxlcnM6
IGZ1bmN0aW9uKCkgewogICAgdmFyIHN1YkNvbnRyb2xsZXJzID0gZ2V0KHRoaXMsICdfc3ViQ29u
dHJvbGxlcnMnKTsKICAgIGlmIChzdWJDb250cm9sbGVycykgewogICAgICBmb3JFYWNoKHN1YkNv
bnRyb2xsZXJzLCBmdW5jdGlvbihzdWJDb250cm9sbGVyKSB7CiAgICAgICAgaWYgKHN1YkNvbnRy
b2xsZXIpIHsgc3ViQ29udHJvbGxlci5kZXN0cm95KCk7IH0KICAgICAgfSk7CiAgICB9CgogICAg
dGhpcy5zZXQoJ19zdWJDb250cm9sbGVycycsIEVtYmVyLkEoKSk7CiAgfQp9KTsKCn0pKCk7CgoK
CihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1ydW50aW1l
CiovCgovKioKICBgRW1iZXIuT2JqZWN0Q29udHJvbGxlcmAgaXMgcGFydCBvZiBFbWJlcidzIENv
bnRyb2xsZXIgbGF5ZXIuIEl0IGlzIGludGVuZGVkCiAgdG8gd3JhcCBhIHNpbmdsZSBvYmplY3Qs
IHByb3h5aW5nIHVuaGFuZGxlZCBhdHRlbXB0cyB0byBgZ2V0YCBhbmQgYHNldGAgdG8gdGhlIHVu
ZGVybHlpbmcKICBjb250ZW50IG9iamVjdCwgYW5kIHRvIGZvcndhcmQgdW5oYW5kbGVkIGFjdGlv
biBhdHRlbXB0cyB0byBpdHMgYHRhcmdldGAuCgogIGBFbWJlci5PYmplY3RDb250cm9sbGVyYCBk
ZXJpdmVzIHRoaXMgZnVuY3Rpb25hbGl0eSBmcm9tIGl0cyBzdXBlcmNsYXNzCiAgYEVtYmVyLk9i
amVjdFByb3h5YCBhbmQgdGhlIGBFbWJlci5Db250cm9sbGVyTWl4aW5gIG1peGluLgoKICBAY2xh
c3MgT2JqZWN0Q29udHJvbGxlcgogIEBuYW1lc3BhY2UgRW1iZXIKICBAZXh0ZW5kcyBFbWJlci5P
YmplY3RQcm94eQogIEB1c2VzIEVtYmVyLkNvbnRyb2xsZXJNaXhpbgoqKi8KRW1iZXIuT2JqZWN0
Q29udHJvbGxlciA9IEVtYmVyLk9iamVjdFByb3h5LmV4dGVuZChFbWJlci5Db250cm9sbGVyTWl4
aW4pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioK
RW1iZXIgUnVudGltZQoKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXJ1bnRpbWUKQHJl
cXVpcmVzIGVtYmVyLW1ldGFsCiovCgp9KSgpOwoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBl
bWJlcgpAc3VibW9kdWxlIGVtYmVyLXZpZXdzCiovCgp2YXIgalF1ZXJ5ID0gdGhpcy5qUXVlcnkg
fHwgKEVtYmVyLmltcG9ydHMgJiYgRW1iZXIuaW1wb3J0cy5qUXVlcnkpOwppZiAoIWpRdWVyeSAm
JiB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykgewogIGpRdWVyeSA9IHJlcXVpcmUoJ2px
dWVyeScpOwp9CgpFbWJlci5hc3NlcnQoIkVtYmVyIFZpZXdzIHJlcXVpcmUgalF1ZXJ5IDEuNywg
MS44LCAxLjksIDEuMTAsIG9yIDIuMCIsIGpRdWVyeSAmJiAoalF1ZXJ5KCkuanF1ZXJ5Lm1hdGNo
KC9eKCgxXC4oN3w4fDl8MTApKXwyLjApKFwuXGQrKT8ocHJlfHJjXGQ/KT8vKSB8fCBFbWJlci5F
TlYuRk9SQ0VfSlFVRVJZKSk7CgovKioKICBBbGlhcyBmb3IgalF1ZXJ5CgogIEBtZXRob2QgJAog
IEBmb3IgRW1iZXIKKi8KRW1iZXIuJCA9IGpRdWVyeTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsK
LyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwoqLwppZiAoRW1iZXIuJCkg
ewogIC8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsv
bXVsdGlwYWdlL2RuZC5odG1sI2RuZGV2ZW50cwogIHZhciBkcmFnRXZlbnRzID0gRW1iZXIuU3Ry
aW5nLncoJ2RyYWdzdGFydCBkcmFnIGRyYWdlbnRlciBkcmFnbGVhdmUgZHJhZ292ZXIgZHJvcCBk
cmFnZW5kJyk7CgogIC8vIENvcGllcyB0aGUgYGRhdGFUcmFuc2ZlcmAgcHJvcGVydHkgZnJvbSBh
IGJyb3dzZXIgZXZlbnQgb2JqZWN0IG9udG8gdGhlCiAgLy8galF1ZXJ5IGV2ZW50IG9iamVjdCBm
b3IgdGhlIHNwZWNpZmllZCBldmVudHMKICBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaChk
cmFnRXZlbnRzLCBmdW5jdGlvbihldmVudE5hbWUpIHsKICAgIEVtYmVyLiQuZXZlbnQuZml4SG9v
a3NbZXZlbnROYW1lXSA9IHsgcHJvcHM6IFsnZGF0YVRyYW5zZmVyJ10gfTsKICB9KTsKfQoKfSko
KTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXZp
ZXdzCiovCgovKiBCRUdJTiBNRVRBTU9SUEggSEVMUEVSUyAqLwoKLy8gSW50ZXJuZXQgRXhwbG9y
ZXIgcHJpb3IgdG8gOSBkb2VzIG5vdCBhbGxvdyBzZXR0aW5nIGlubmVySFRNTCBpZiB0aGUgZmly
c3QgZWxlbWVudAovLyBpcyBhICJ6ZXJvLXNjb3BlIiBlbGVtZW50LiBUaGlzIHByb2JsZW0gY2Fu
IGJlIHdvcmtlZCBhcm91bmQgYnkgbWFraW5nCi8vIHRoZSBmaXJzdCBub2RlIGFuIGludmlzaWJs
ZSB0ZXh0IG5vZGUuIFdlLCBsaWtlIE1vZGVybml6ciwgdXNlICZzaHk7Cgp2YXIgbmVlZHNTaHkg
PSB0aGlzLmRvY3VtZW50ICYmIChmdW5jdGlvbigpIHsKICB2YXIgdGVzdEVsID0gZG9jdW1lbnQu
Y3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgdGVzdEVsLmlubmVySFRNTCA9ICI8ZGl2PjwvZGl2PiI7
CiAgdGVzdEVsLmZpcnN0Q2hpbGQuaW5uZXJIVE1MID0gIjxzY3JpcHQ+PC9zY3JpcHQ+IjsKICBy
ZXR1cm4gdGVzdEVsLmZpcnN0Q2hpbGQuaW5uZXJIVE1MID09PSAnJzsKfSkoKTsKCi8vIElFIDgg
KGFuZCBsaWtlbHkgZWFybGllcikgbGlrZXMgdG8gbW92ZSB3aGl0ZXNwYWNlIHByZWNlZWRpbmcK
Ly8gYSBzY3JpcHQgdGFnIHRvIGFwcGVhciBhZnRlciBpdC4gVGhpcyBtZWFucyB0aGF0IHdlIGNh
bgovLyBhY2NpZGVudGFsbHkgcmVtb3ZlIHdoaXRlc3BhY2Ugd2hlbiB1cGRhdGluZyBhIG1vcnBo
Lgp2YXIgbW92ZXNXaGl0ZXNwYWNlID0gdGhpcy5kb2N1bWVudCAmJiAoZnVuY3Rpb24oKSB7CiAg
dmFyIHRlc3RFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHRlc3RFbC5pbm5l
ckhUTUwgPSAiVGVzdDogPHNjcmlwdCB0eXBlPSd0ZXh0L3gtcGxhY2Vob2xkZXInPjwvc2NyaXB0
PlZhbHVlIjsKICByZXR1cm4gdGVzdEVsLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAnVGVz
dDonICYmCiAgICAgICAgICB0ZXN0RWwuY2hpbGROb2Rlc1syXS5ub2RlVmFsdWUgPT09ICcgVmFs
dWUnOwp9KSgpOwoKLy8gVXNlIHRoaXMgdG8gZmluZCBjaGlsZHJlbiBieSBJRCBpbnN0ZWFkIG9m
IHVzaW5nIGpRdWVyeQp2YXIgZmluZENoaWxkQnlJZCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGlkKSB7
CiAgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpID09PSBpZCkgeyByZXR1cm4gZWxlbWVu
dDsgfQoKICB2YXIgbGVuID0gZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCwgaWR4LCBub2RlLCBm
b3VuZDsKICBmb3IgKGlkeD0wOyBpZHg8bGVuOyBpZHgrKykgewogICAgbm9kZSA9IGVsZW1lbnQu
Y2hpbGROb2Rlc1tpZHhdOwogICAgZm91bmQgPSBub2RlLm5vZGVUeXBlID09PSAxICYmIGZpbmRD
aGlsZEJ5SWQobm9kZSwgaWQpOwogICAgaWYgKGZvdW5kKSB7IHJldHVybiBmb3VuZDsgfQogIH0K
fTsKCnZhciBzZXRJbm5lckhUTUxXaXRob3V0Rml4ID0gZnVuY3Rpb24oZWxlbWVudCwgaHRtbCkg
ewogIGlmIChuZWVkc1NoeSkgewogICAgaHRtbCA9ICcmc2h5OycgKyBodG1sOwogIH0KCiAgdmFy
IG1hdGNoZXMgPSBbXTsKICBpZiAobW92ZXNXaGl0ZXNwYWNlKSB7CiAgICAvLyBSaWdodCBub3cg
d2Ugb25seSBjaGVjayBmb3Igc2NyaXB0IHRhZ3Mgd2l0aCBpZHMgd2l0aCB0aGUKICAgIC8vIGdv
YWwgb2YgdGFyZ2V0aW5nIG1vcnBocy4KICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoLyhccyspKDxz
Y3JpcHQgaWQ9JyhbXiddKyknKS9nLCBmdW5jdGlvbihtYXRjaCwgc3BhY2VzLCB0YWcsIGlkKSB7
CiAgICAgIG1hdGNoZXMucHVzaChbaWQsIHNwYWNlc10pOwogICAgICByZXR1cm4gdGFnOwogICAg
fSk7CiAgfQoKICBlbGVtZW50LmlubmVySFRNTCA9IGh0bWw7CgogIC8vIElmIHdlIGhhdmUgdG8g
ZG8gYW55IHdoaXRlc3BhY2UgYWRqdXN0bWVudHMgZG8gdGhlbSBub3cKICBpZiAobWF0Y2hlcy5s
ZW5ndGggPiAwKSB7CiAgICB2YXIgbGVuID0gbWF0Y2hlcy5sZW5ndGgsIGlkeDsKICAgIGZvciAo
aWR4PTA7IGlkeDxsZW47IGlkeCsrKSB7CiAgICAgIHZhciBzY3JpcHQgPSBmaW5kQ2hpbGRCeUlk
KGVsZW1lbnQsIG1hdGNoZXNbaWR4XVswXSksCiAgICAgICAgICBub2RlID0gZG9jdW1lbnQuY3Jl
YXRlVGV4dE5vZGUobWF0Y2hlc1tpZHhdWzFdKTsKICAgICAgc2NyaXB0LnBhcmVudE5vZGUuaW5z
ZXJ0QmVmb3JlKG5vZGUsIHNjcmlwdCk7CiAgICB9CiAgfQoKICBpZiAobmVlZHNTaHkpIHsKICAg
IHZhciBzaHlFbGVtZW50ID0gZWxlbWVudC5maXJzdENoaWxkOwogICAgd2hpbGUgKHNoeUVsZW1l
bnQubm9kZVR5cGUgPT09IDEgJiYgIXNoeUVsZW1lbnQubm9kZU5hbWUpIHsKICAgICAgc2h5RWxl
bWVudCA9IHNoeUVsZW1lbnQuZmlyc3RDaGlsZDsKICAgIH0KICAgIGlmIChzaHlFbGVtZW50Lm5v
ZGVUeXBlID09PSAzICYmIHNoeUVsZW1lbnQubm9kZVZhbHVlLmNoYXJBdCgwKSA9PT0gIlx1MDBB
RCIpIHsKICAgICAgc2h5RWxlbWVudC5ub2RlVmFsdWUgPSBzaHlFbGVtZW50Lm5vZGVWYWx1ZS5z
bGljZSgxKTsKICAgIH0KICB9Cn07CgovKiBFTkQgTUVUQU1PUlBIIEhFTFBFUlMgKi8KCgp2YXIg
aW5uZXJIVE1MVGFncyA9IHt9Owp2YXIgY2FuU2V0SW5uZXJIVE1MID0gZnVuY3Rpb24odGFnTmFt
ZSkgewogIGlmIChpbm5lckhUTUxUYWdzW3RhZ05hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgIHJl
dHVybiBpbm5lckhUTUxUYWdzW3RhZ05hbWVdOwogIH0KCiAgdmFyIGNhblNldCA9IHRydWU7Cgog
IC8vIElFIDggYW5kIGVhcmxpZXIgZG9uJ3QgYWxsb3cgdXMgdG8gZG8gaW5uZXJIVE1MIG9uIHNl
bGVjdAogIGlmICh0YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7CiAgICB2YXIg
ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTsKICAgIHNldElubmVySFRNTFdp
dGhvdXRGaXgoZWwsICc8b3B0aW9uIHZhbHVlPSJ0ZXN0Ij5UZXN0PC9vcHRpb24+Jyk7CiAgICBj
YW5TZXQgPSBlbC5vcHRpb25zLmxlbmd0aCA9PT0gMTsKICB9CgogIGlubmVySFRNTFRhZ3NbdGFn
TmFtZV0gPSBjYW5TZXQ7CgogIHJldHVybiBjYW5TZXQ7Cn07Cgp2YXIgc2V0SW5uZXJIVE1MID0g
ZnVuY3Rpb24oZWxlbWVudCwgaHRtbCkgewogIHZhciB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1l
OwoKICBpZiAoY2FuU2V0SW5uZXJIVE1MKHRhZ05hbWUpKSB7CiAgICBzZXRJbm5lckhUTUxXaXRo
b3V0Rml4KGVsZW1lbnQsIGh0bWwpOwogIH0gZWxzZSB7CiAgICAvLyBGaXJlZm94IHZlcnNpb25z
IDwgMTEgZG8gbm90IGhhdmUgc3VwcG9ydCBmb3IgZWxlbWVudC5vdXRlckhUTUwuCiAgICB2YXIg
b3V0ZXJIVE1MID0gZWxlbWVudC5vdXRlckhUTUwgfHwgbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJp
YWxpemVUb1N0cmluZyhlbGVtZW50KTsKICAgIEVtYmVyLmFzc2VydCgiQ2FuJ3Qgc2V0IGlubmVy
SFRNTCBvbiAiK2VsZW1lbnQudGFnTmFtZSsiIGluIHRoaXMgYnJvd3NlciIsIG91dGVySFRNTCk7
CgogICAgdmFyIHN0YXJ0VGFnID0gb3V0ZXJIVE1MLm1hdGNoKG5ldyBSZWdFeHAoIjwiK3RhZ05h
bWUrIihbXj5dKik+IiwgJ2knKSlbMF0sCiAgICAgICAgZW5kVGFnID0gJzwvJyt0YWdOYW1lKyc+
JzsKCiAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAg
c2V0SW5uZXJIVE1MV2l0aG91dEZpeCh3cmFwcGVyLCBzdGFydFRhZyArIGh0bWwgKyBlbmRUYWcp
OwogICAgZWxlbWVudCA9IHdyYXBwZXIuZmlyc3RDaGlsZDsKICAgIHdoaWxlIChlbGVtZW50LnRh
Z05hbWUgIT09IHRhZ05hbWUpIHsKICAgICAgZWxlbWVudCA9IGVsZW1lbnQubmV4dFNpYmxpbmc7
CiAgICB9CiAgfQoKICByZXR1cm4gZWxlbWVudDsKfTsKCmZ1bmN0aW9uIGlzU2ltcGxlQ2xpY2so
ZXZlbnQpIHsKICB2YXIgbW9kaWZpZXIgPSBldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5
IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5LAogICAgICBzZWNvbmRhcnlDbGljayA9
IGV2ZW50LndoaWNoID4gMTsgLy8gSUU5IG1heSByZXR1cm4gdW5kZWZpbmVkCgogIHJldHVybiAh
bW9kaWZpZXIgJiYgIXNlY29uZGFyeUNsaWNrOwp9CgpFbWJlci5WaWV3VXRpbHMgPSB7CiAgc2V0
SW5uZXJIVE1MOiBzZXRJbm5lckhUTUwsCiAgaXNTaW1wbGVDbGljazogaXNTaW1wbGVDbGljawp9
OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVt
YmVyLXZpZXdzCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7Cgp2YXIg
Q2xhc3NTZXQgPSBmdW5jdGlvbigpIHsKICB0aGlzLnNlZW4gPSB7fTsKICB0aGlzLmxpc3QgPSBb
XTsKfTsKCkNsYXNzU2V0LnByb3RvdHlwZSA9IHsKICBhZGQ6IGZ1bmN0aW9uKHN0cmluZykgewog
ICAgaWYgKHN0cmluZyBpbiB0aGlzLnNlZW4pIHsgcmV0dXJuOyB9CiAgICB0aGlzLnNlZW5bc3Ry
aW5nXSA9IHRydWU7CgogICAgdGhpcy5saXN0LnB1c2goc3RyaW5nKTsKICB9LAoKICB0b0RPTTog
ZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5saXN0LmpvaW4oIiAiKTsKICB9Cn07Cgp2YXIg
QkFEX1RBR19OQU1FX1RFU1RfUkVHRVhQID0gL1teYS16QS1aMC05XC1dLzsKdmFyIEJBRF9UQUdf
TkFNRV9SRVBMQUNFX1JFR0VYUCA9IC9bXmEtekEtWjAtOVwtXS9nOwoKZnVuY3Rpb24gc3RyaXBU
YWdOYW1lKHRhZ05hbWUpIHsKICBpZiAoIXRhZ05hbWUpIHsKICAgIHJldHVybiB0YWdOYW1lOwog
IH0KCiAgaWYgKCFCQURfVEFHX05BTUVfVEVTVF9SRUdFWFAudGVzdCh0YWdOYW1lKSkgewogICAg
cmV0dXJuIHRhZ05hbWU7CiAgfQoKICByZXR1cm4gdGFnTmFtZS5yZXBsYWNlKEJBRF9UQUdfTkFN
RV9SRVBMQUNFX1JFR0VYUCwgJycpOwp9Cgp2YXIgQkFEX0NIQVJTX1JFR0VYUCA9IC8mKD8hXHcr
Oyl8Wzw+IidgXS9nOwp2YXIgUE9TU0lCTEVfQ0hBUlNfUkVHRVhQID0gL1smPD4iJ2BdLzsKCmZ1
bmN0aW9uIGVzY2FwZUF0dHJpYnV0ZSh2YWx1ZSkgewogIC8vIFN0b2xlbiBzaGFtZWxlc3NseSBm
cm9tIEhhbmRsZWJhcnMKCiAgdmFyIGVzY2FwZSA9IHsKICAgICI8IjogIiZsdDsiLAogICAgIj4i
OiAiJmd0OyIsCiAgICAnIic6ICImcXVvdDsiLAogICAgIiciOiAiJiN4Mjc7IiwKICAgICJgIjog
IiYjeDYwOyIKICB9OwoKICB2YXIgZXNjYXBlQ2hhciA9IGZ1bmN0aW9uKGNocikgewogICAgcmV0
dXJuIGVzY2FwZVtjaHJdIHx8ICImYW1wOyI7CiAgfTsKCiAgdmFyIHN0cmluZyA9IHZhbHVlLnRv
U3RyaW5nKCk7CgogIGlmKCFQT1NTSUJMRV9DSEFSU19SRUdFWFAudGVzdChzdHJpbmcpKSB7IHJl
dHVybiBzdHJpbmc7IH0KICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoQkFEX0NIQVJTX1JFR0VYUCwg
ZXNjYXBlQ2hhcik7Cn0KCi8vIElFIDYvNyBoYXZlIGJ1Z3MgYXJvbmQgc2V0dGluZyBuYW1lcyBv
biBpbnB1dHMgZHVyaW5nIGNyZWF0aW9uLgovLyBGcm9tIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5j
b20vZW4tdXMvbGlicmFyeS9pZS9tczUzNjM4OSh2PXZzLjg1KS5hc3B4OgovLyAiVG8gaW5jbHVk
ZSB0aGUgTkFNRSBhdHRyaWJ1dGUgYXQgcnVuIHRpbWUgb24gb2JqZWN0cyBjcmVhdGVkIHdpdGgg
dGhlIGNyZWF0ZUVsZW1lbnQgbWV0aG9kLCB1c2UgdGhlIGVUYWcuIgp2YXIgY2FuU2V0TmFtZU9u
SW5wdXRzID0gKGZ1bmN0aW9uKCkgewogIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50
KCdkaXYnKSwKICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoKICBl
bC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZm9vJyk7CiAgZGl2LmFwcGVuZENoaWxkKGVsKTsKCiAg
cmV0dXJuICEhZGl2LmlubmVySFRNTC5tYXRjaCgnZm9vJyk7Cn0pKCk7CgovKioKICBgRW1iZXIu
UmVuZGVyQnVmZmVyYCBnYXRoZXJzIGluZm9ybWF0aW9uIHJlZ2FyZGluZyB0aGUgYSB2aWV3IGFu
ZCBnZW5lcmF0ZXMgdGhlCiAgZmluYWwgcmVwcmVzZW50YXRpb24uIGBFbWJlci5SZW5kZXJCdWZm
ZXJgIHdpbGwgZ2VuZXJhdGUgSFRNTCB3aGljaCBjYW4gYmUgcHVzaGVkCiAgdG8gdGhlIERPTS4K
CiAgIGBgYGphdmFzY3JpcHQKICAgdmFyIGJ1ZmZlciA9IEVtYmVyLlJlbmRlckJ1ZmZlcignZGl2
Jyk7CiAgYGBgCgogIEBjbGFzcyBSZW5kZXJCdWZmZXIKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGNv
bnN0cnVjdG9yCiAgQHBhcmFtIHtTdHJpbmd9IHRhZ05hbWUgdGFnIG5hbWUgKHN1Y2ggYXMgJ2Rp
dicgb3IgJ3AnKSB1c2VkIGZvciB0aGUgYnVmZmVyCiovCkVtYmVyLlJlbmRlckJ1ZmZlciA9IGZ1
bmN0aW9uKHRhZ05hbWUpIHsKICByZXR1cm4gbmV3IEVtYmVyLl9SZW5kZXJCdWZmZXIodGFnTmFt
ZSk7Cn07CgpFbWJlci5fUmVuZGVyQnVmZmVyID0gZnVuY3Rpb24odGFnTmFtZSkgewogIHRoaXMu
dGFnTmFtZXMgPSBbdGFnTmFtZSB8fCBudWxsXTsKICB0aGlzLmJ1ZmZlciA9ICIiOwp9OwoKRW1i
ZXIuX1JlbmRlckJ1ZmZlci5wcm90b3R5cGUgPSB7CgogIC8vIFRoZSByb290IHZpZXcncyBlbGVt
ZW50CiAgX2VsZW1lbnQ6IG51bGwsCgogIF9oYXNFbGVtZW50OiB0cnVlLAoKICAvKioKICAgIEFu
IGludGVybmFsIHNldCB1c2VkIHRvIGRlLWR1cGUgY2xhc3MgbmFtZXMgd2hlbiBgYWRkQ2xhc3Mo
KWAgaXMKICAgIHVzZWQuIEFmdGVyIGVhY2ggY2FsbCB0byBgYWRkQ2xhc3MoKWAsIHRoZSBgY2xh
c3Nlc2AgcHJvcGVydHkKICAgIHdpbGwgYmUgdXBkYXRlZC4KCiAgICBAcHJpdmF0ZQogICAgQHBy
b3BlcnR5IGVsZW1lbnRDbGFzc2VzCiAgICBAdHlwZSBBcnJheQogICAgQGRlZmF1bHQgW10KICAq
LwogIGVsZW1lbnRDbGFzc2VzOiBudWxsLAoKICAvKioKICAgIEFycmF5IG9mIGNsYXNzIG5hbWVz
IHdoaWNoIHdpbGwgYmUgYXBwbGllZCBpbiB0aGUgY2xhc3MgYXR0cmlidXRlLgoKICAgIFlvdSBj
YW4gdXNlIGBzZXRDbGFzc2VzKClgIHRvIHNldCB0aGlzIHByb3BlcnR5IGRpcmVjdGx5LiBJZiB5
b3UKICAgIHVzZSBgYWRkQ2xhc3MoKWAsIGl0IHdpbGwgYmUgbWFpbnRhaW5lZCBmb3IgeW91LgoK
ICAgIEBwcm9wZXJ0eSBjbGFzc2VzCiAgICBAdHlwZSBBcnJheQogICAgQGRlZmF1bHQgW10KICAq
LwogIGNsYXNzZXM6IG51bGwsCgogIC8qKgogICAgVGhlIGlkIGluIG9mIHRoZSBlbGVtZW50LCB0
byBiZSBhcHBsaWVkIGluIHRoZSBpZCBhdHRyaWJ1dGUuCgogICAgWW91IHNob3VsZCBub3Qgc2V0
IHRoaXMgcHJvcGVydHkgeW91cnNlbGYsIHJhdGhlciwgeW91IHNob3VsZCB1c2UKICAgIHRoZSBg
aWQoKWAgbWV0aG9kIG9mIGBFbWJlci5SZW5kZXJCdWZmZXJgLgoKICAgIEBwcm9wZXJ0eSBlbGVt
ZW50SWQKICAgIEB0eXBlIFN0cmluZwogICAgQGRlZmF1bHQgbnVsbAogICovCiAgZWxlbWVudElk
OiBudWxsLAoKICAvKioKICAgIEEgaGFzaCBrZXllZCBvbiB0aGUgbmFtZSBvZiB0aGUgYXR0cmli
dXRlIGFuZCB3aG9zZSB2YWx1ZSB3aWxsIGJlCiAgICBhcHBsaWVkIHRvIHRoYXQgYXR0cmlidXRl
LiBGb3IgZXhhbXBsZSwgaWYgeW91IHdhbnRlZCB0byBhcHBseSBhCiAgICBgZGF0YS12aWV3PSJG
b28uYmFyImAgcHJvcGVydHkgdG8gYW4gZWxlbWVudCwgeW91IHdvdWxkIHNldCB0aGUKICAgIGVs
ZW1lbnRBdHRyaWJ1dGVzIGhhc2ggdG8gYHsnZGF0YS12aWV3JzonRm9vLmJhcid9YC4KCiAgICBZ
b3Ugc2hvdWxkIG5vdCBtYWludGFpbiB0aGlzIGhhc2ggeW91cnNlbGYsIHJhdGhlciwgeW91IHNo
b3VsZCB1c2UKICAgIHRoZSBgYXR0cigpYCBtZXRob2Qgb2YgYEVtYmVyLlJlbmRlckJ1ZmZlcmAu
CgogICAgQHByb3BlcnR5IGVsZW1lbnRBdHRyaWJ1dGVzCiAgICBAdHlwZSBIYXNoCiAgICBAZGVm
YXVsdCB7fQogICovCiAgZWxlbWVudEF0dHJpYnV0ZXM6IG51bGwsCgogIC8qKgogICAgQSBoYXNo
IGtleWVkIG9uIHRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0aWVzIGFuZCB3aG9zZSB2YWx1ZSB3aWxs
IGJlCiAgICBhcHBsaWVkIHRvIHRoYXQgcHJvcGVydHkuIEZvciBleGFtcGxlLCBpZiB5b3Ugd2Fu
dGVkIHRvIGFwcGx5IGEKICAgIGBjaGVja2VkPXRydWVgIHByb3BlcnR5IHRvIGFuIGVsZW1lbnQs
IHlvdSB3b3VsZCBzZXQgdGhlCiAgICBlbGVtZW50UHJvcGVydGllcyBoYXNoIHRvIGB7J2NoZWNr
ZWQnOnRydWV9YC4KCiAgICBZb3Ugc2hvdWxkIG5vdCBtYWludGFpbiB0aGlzIGhhc2ggeW91cnNl
bGYsIHJhdGhlciwgeW91IHNob3VsZCB1c2UKICAgIHRoZSBgcHJvcCgpYCBtZXRob2Qgb2YgYEVt
YmVyLlJlbmRlckJ1ZmZlcmAuCgogICAgQHByb3BlcnR5IGVsZW1lbnRQcm9wZXJ0aWVzCiAgICBA
dHlwZSBIYXNoCiAgICBAZGVmYXVsdCB7fQogICovCiAgZWxlbWVudFByb3BlcnRpZXM6IG51bGws
CgogIC8qKgogICAgVGhlIHRhZ25hbWUgb2YgdGhlIGVsZW1lbnQgYW4gaW5zdGFuY2Ugb2YgYEVt
YmVyLlJlbmRlckJ1ZmZlcmAgcmVwcmVzZW50cy4KCiAgICBVc3VhbGx5LCB0aGlzIGdldHMgc2V0
IGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgdG8gYEVtYmVyLlJlbmRlckJ1ZmZlcmAuIEZvcgogICAg
ZXhhbXBsZSwgaWYgeW91IHdhbnRlZCB0byBjcmVhdGUgYSBgcGAgdGFnLCB0aGVuIHlvdSB3b3Vs
ZCBjYWxsCgogICAgYGBgamF2YXNjcmlwdAogICAgRW1iZXIuUmVuZGVyQnVmZmVyKCdwJykKICAg
IGBgYAoKICAgIEBwcm9wZXJ0eSBlbGVtZW50VGFnCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZh
dWx0IG51bGwKICAqLwogIGVsZW1lbnRUYWc6IG51bGwsCgogIC8qKgogICAgQSBoYXNoIGtleWVk
IG9uIHRoZSBuYW1lIG9mIHRoZSBzdHlsZSBhdHRyaWJ1dGUgYW5kIHdob3NlIHZhbHVlIHdpbGwK
ICAgIGJlIGFwcGxpZWQgdG8gdGhhdCBhdHRyaWJ1dGUuIEZvciBleGFtcGxlLCBpZiB5b3Ugd2Fu
dGVkIHRvIGFwcGx5IGEKICAgIGBiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrO2Agc3R5bGUgdG8gYW4g
ZWxlbWVudCwgeW91IHdvdWxkIHNldCB0aGUKICAgIGVsZW1lbnRTdHlsZSBoYXNoIHRvIGB7J2Jh
Y2tncm91bmQtY29sb3InOidibGFjayd9YC4KCiAgICBZb3Ugc2hvdWxkIG5vdCBtYWludGFpbiB0
aGlzIGhhc2ggeW91cnNlbGYsIHJhdGhlciwgeW91IHNob3VsZCB1c2UKICAgIHRoZSBgc3R5bGUo
KWAgbWV0aG9kIG9mIGBFbWJlci5SZW5kZXJCdWZmZXJgLgoKICAgIEBwcm9wZXJ0eSBlbGVtZW50
U3R5bGUKICAgIEB0eXBlIEhhc2gKICAgIEBkZWZhdWx0IHt9CiAgKi8KICBlbGVtZW50U3R5bGU6
IG51bGwsCgogIC8qKgogICAgTmVzdGVkIGBSZW5kZXJCdWZmZXJzYCB3aWxsIHNldCB0aGlzIHRv
IHRoZWlyIHBhcmVudCBgUmVuZGVyQnVmZmVyYAogICAgaW5zdGFuY2UuCgogICAgQHByb3BlcnR5
IHBhcmVudEJ1ZmZlcgogICAgQHR5cGUgRW1iZXIuX1JlbmRlckJ1ZmZlcgogICovCiAgcGFyZW50
QnVmZmVyOiBudWxsLAoKICAvKioKICAgIEFkZHMgYSBzdHJpbmcgb2YgSFRNTCB0byB0aGUgYFJl
bmRlckJ1ZmZlcmAuCgogICAgQG1ldGhvZCBwdXNoCiAgICBAcGFyYW0ge1N0cmluZ30gc3RyaW5n
IEhUTUwgdG8gcHVzaCBpbnRvIHRoZSBidWZmZXIKICAgIEBjaGFpbmFibGUKICAqLwogIHB1c2g6
IGZ1bmN0aW9uKHN0cmluZykgewogICAgdGhpcy5idWZmZXIgKz0gc3RyaW5nOwogICAgcmV0dXJu
IHRoaXM7CiAgfSwKCiAgLyoqCiAgICBBZGRzIGEgY2xhc3MgdG8gdGhlIGJ1ZmZlciwgd2hpY2gg
d2lsbCBiZSByZW5kZXJlZCB0byB0aGUgY2xhc3MgYXR0cmlidXRlLgoKICAgIEBtZXRob2QgYWRk
Q2xhc3MKICAgIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgQ2xhc3MgbmFtZSB0byBhZGQgdG8g
dGhlIGJ1ZmZlcgogICAgQGNoYWluYWJsZQogICovCiAgYWRkQ2xhc3M6IGZ1bmN0aW9uKGNsYXNz
TmFtZSkgewogICAgLy8gbGF6aWx5IGNyZWF0ZSBlbGVtZW50Q2xhc3NlcwogICAgdGhpcy5lbGVt
ZW50Q2xhc3NlcyA9ICh0aGlzLmVsZW1lbnRDbGFzc2VzIHx8IG5ldyBDbGFzc1NldCgpKTsKICAg
IHRoaXMuZWxlbWVudENsYXNzZXMuYWRkKGNsYXNzTmFtZSk7CiAgICB0aGlzLmNsYXNzZXMgPSB0
aGlzLmVsZW1lbnRDbGFzc2VzLmxpc3Q7CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgc2V0Q2xh
c3NlczogZnVuY3Rpb24oY2xhc3NOYW1lcykgewogICAgdGhpcy5jbGFzc2VzID0gY2xhc3NOYW1l
czsKICB9LAoKICAvKioKICAgIFNldHMgdGhlIGVsZW1lbnRJRCB0byBiZSB1c2VkIGZvciB0aGUg
ZWxlbWVudC4KCiAgICBAbWV0aG9kIGlkCiAgICBAcGFyYW0ge1N0cmluZ30gaWQKICAgIEBjaGFp
bmFibGUKICAqLwogIGlkOiBmdW5jdGlvbihpZCkgewogICAgdGhpcy5lbGVtZW50SWQgPSBpZDsK
ICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8vIGR1Y2sgdHlwZSBhdHRyaWJ1dGUgZnVuY3Rpb25h
bGl0eSBsaWtlIGpRdWVyeSBzbyBhIHJlbmRlciBidWZmZXIKICAvLyBjYW4gYmUgdXNlZCBsaWtl
IGEgalF1ZXJ5IG9iamVjdCBpbiBhdHRyaWJ1dGUgYmluZGluZyBzY2VuYXJpb3MuCgogIC8qKgog
ICAgQWRkcyBhbiBhdHRyaWJ1dGUgd2hpY2ggd2lsbCBiZSByZW5kZXJlZCB0byB0aGUgZWxlbWVu
dC4KCiAgICBAbWV0aG9kIGF0dHIKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9m
IHRoZSBhdHRyaWJ1dGUKICAgIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYWRk
IHRvIHRoZSBhdHRyaWJ1dGUKICAgIEBjaGFpbmFibGUKICAgIEByZXR1cm4ge0VtYmVyLlJlbmRl
ckJ1ZmZlcnxTdHJpbmd9IHRoaXMgb3IgdGhlIGN1cnJlbnQgYXR0cmlidXRlIHZhbHVlCiAgKi8K
ICBhdHRyOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlz
LmVsZW1lbnRBdHRyaWJ1dGVzID0gKHRoaXMuZWxlbWVudEF0dHJpYnV0ZXMgfHwge30pOwoKICAg
IGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybiBhdHRyaWJ1dGVzW25h
bWVdOwogICAgfSBlbHNlIHsKICAgICAgYXR0cmlidXRlc1tuYW1lXSA9IHZhbHVlOwogICAgfQoK
ICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgUmVtb3ZlIGFuIGF0dHJpYnV0ZSBmcm9t
IHRoZSBsaXN0IG9mIGF0dHJpYnV0ZXMgdG8gcmVuZGVyLgoKICAgIEBtZXRob2QgcmVtb3ZlQXR0
cgogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZQogICAg
QGNoYWluYWJsZQogICovCiAgcmVtb3ZlQXR0cjogZnVuY3Rpb24obmFtZSkgewogICAgdmFyIGF0
dHJpYnV0ZXMgPSB0aGlzLmVsZW1lbnRBdHRyaWJ1dGVzOwogICAgaWYgKGF0dHJpYnV0ZXMpIHsg
ZGVsZXRlIGF0dHJpYnV0ZXNbbmFtZV07IH0KCiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioK
ICAgIEFkZHMgYW4gcHJvcGVydHkgd2hpY2ggd2lsbCBiZSByZW5kZXJlZCB0byB0aGUgZWxlbWVu
dC4KCiAgICBAbWV0aG9kIHByb3AKICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9m
IHRoZSBwcm9wZXJ0eQogICAgQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQg
dG8gdGhlIHByb3BlcnR5CiAgICBAY2hhaW5hYmxlCiAgICBAcmV0dXJuIHtFbWJlci5SZW5kZXJC
dWZmZXJ8U3RyaW5nfSB0aGlzIG9yIHRoZSBjdXJyZW50IHByb3BlcnR5IHZhbHVlCiAgKi8KICBw
cm9wOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLmVs
ZW1lbnRQcm9wZXJ0aWVzID0gKHRoaXMuZWxlbWVudFByb3BlcnRpZXMgfHwge30pOwoKICAgIGlm
IChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybiBwcm9wZXJ0aWVzW25hbWVd
OwogICAgfSBlbHNlIHsKICAgICAgcHJvcGVydGllc1tuYW1lXSA9IHZhbHVlOwogICAgfQoKICAg
IHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgUmVtb3ZlIGFuIHByb3BlcnR5IGZyb20gdGhl
IGxpc3Qgb2YgcHJvcGVydGllcyB0byByZW5kZXIuCgogICAgQG1ldGhvZCByZW1vdmVQcm9wCiAg
ICBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkKICAgIEBjaGFp
bmFibGUKICAqLwogIHJlbW92ZVByb3A6IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHZhciBwcm9wZXJ0
aWVzID0gdGhpcy5lbGVtZW50UHJvcGVydGllczsKICAgIGlmIChwcm9wZXJ0aWVzKSB7IGRlbGV0
ZSBwcm9wZXJ0aWVzW25hbWVdOyB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBB
ZGRzIGEgc3R5bGUgdG8gdGhlIHN0eWxlIGF0dHJpYnV0ZSB3aGljaCB3aWxsIGJlIHJlbmRlcmVk
IHRvIHRoZSBlbGVtZW50LgoKICAgIEBtZXRob2Qgc3R5bGUKICAgIEBwYXJhbSB7U3RyaW5nfSBu
YW1lIE5hbWUgb2YgdGhlIHN0eWxlCiAgICBAcGFyYW0ge1N0cmluZ30gdmFsdWUKICAgIEBjaGFp
bmFibGUKICAqLwogIHN0eWxlOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgdGhpcy5lbGVt
ZW50U3R5bGUgPSAodGhpcy5lbGVtZW50U3R5bGUgfHwge30pOwoKICAgIHRoaXMuZWxlbWVudFN0
eWxlW25hbWVdID0gdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICBiZWdpbjogZnVuY3Rp
b24odGFnTmFtZSkgewogICAgdGhpcy50YWdOYW1lcy5wdXNoKHRhZ05hbWUgfHwgbnVsbCk7CiAg
ICByZXR1cm4gdGhpczsKICB9LAoKICBwdXNoT3BlbmluZ1RhZzogZnVuY3Rpb24oKSB7CiAgICB2
YXIgdGFnTmFtZSA9IHRoaXMuY3VycmVudFRhZ05hbWUoKTsKICAgIGlmICghdGFnTmFtZSkgeyBy
ZXR1cm47IH0KCiAgICBpZiAodGhpcy5faGFzRWxlbWVudCAmJiAhdGhpcy5fZWxlbWVudCAmJiB0
aGlzLmJ1ZmZlci5sZW5ndGggPT09IDApIHsKICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuZ2Vu
ZXJhdGVFbGVtZW50KCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgYnVmZmVyID0gdGhp
cy5idWZmZXIsCiAgICAgICAgaWQgPSB0aGlzLmVsZW1lbnRJZCwKICAgICAgICBjbGFzc2VzID0g
dGhpcy5jbGFzc2VzLAogICAgICAgIGF0dHJzID0gdGhpcy5lbGVtZW50QXR0cmlidXRlcywKICAg
ICAgICBwcm9wcyA9IHRoaXMuZWxlbWVudFByb3BlcnRpZXMsCiAgICAgICAgc3R5bGUgPSB0aGlz
LmVsZW1lbnRTdHlsZSwKICAgICAgICBhdHRyLCBwcm9wOwoKICAgIGJ1ZmZlciArPSAnPCcgKyBz
dHJpcFRhZ05hbWUodGFnTmFtZSk7CgogICAgaWYgKGlkKSB7CiAgICAgIGJ1ZmZlciArPSAnIGlk
PSInICsgZXNjYXBlQXR0cmlidXRlKGlkKSArICciJzsKICAgICAgdGhpcy5lbGVtZW50SWQgPSBu
dWxsOwogICAgfQogICAgaWYgKGNsYXNzZXMpIHsKICAgICAgYnVmZmVyICs9ICcgY2xhc3M9Iicg
KyBlc2NhcGVBdHRyaWJ1dGUoY2xhc3Nlcy5qb2luKCcgJykpICsgJyInOwogICAgICB0aGlzLmNs
YXNzZXMgPSBudWxsOwogICAgfQoKICAgIGlmIChzdHlsZSkgewogICAgICBidWZmZXIgKz0gJyBz
dHlsZT0iJzsKCiAgICAgIGZvciAocHJvcCBpbiBzdHlsZSkgewogICAgICAgIGlmIChzdHlsZS5o
YXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgYnVmZmVyICs9IHByb3AgKyAnOicgKyBl
c2NhcGVBdHRyaWJ1dGUoc3R5bGVbcHJvcF0pICsgJzsnOwogICAgICAgIH0KICAgICAgfQoKICAg
ICAgYnVmZmVyICs9ICciJzsKCiAgICAgIHRoaXMuZWxlbWVudFN0eWxlID0gbnVsbDsKICAgIH0K
CiAgICBpZiAoYXR0cnMpIHsKICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgaWYg
KGF0dHJzLmhhc093blByb3BlcnR5KGF0dHIpKSB7CiAgICAgICAgICBidWZmZXIgKz0gJyAnICsg
YXR0ciArICc9IicgKyBlc2NhcGVBdHRyaWJ1dGUoYXR0cnNbYXR0cl0pICsgJyInOwogICAgICAg
IH0KICAgICAgfQoKICAgICAgdGhpcy5lbGVtZW50QXR0cmlidXRlcyA9IG51bGw7CiAgICB9Cgog
ICAgaWYgKHByb3BzKSB7CiAgICAgIGZvciAocHJvcCBpbiBwcm9wcykgewogICAgICAgIGlmIChw
cm9wcy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdmFyIHZhbHVlID0gcHJvcHNb
cHJvcF07CiAgICAgICAgICBpZiAodmFsdWUgfHwgdHlwZW9mKHZhbHVlKSA9PT0gJ251bWJlcicp
IHsKICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgYnVmZmVy
ICs9ICcgJyArIHByb3AgKyAnPSInICsgcHJvcCArICciJzsKICAgICAgICAgICAgfSBlbHNlIHsK
ICAgICAgICAgICAgICBidWZmZXIgKz0gJyAnICsgcHJvcCArICc9IicgKyBlc2NhcGVBdHRyaWJ1
dGUocHJvcHNbcHJvcF0pICsgJyInOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAg
fQogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRQcm9wZXJ0aWVzID0gbnVsbDsKICAgIH0KCiAg
ICBidWZmZXIgKz0gJz4nOwogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgfSwKCiAgcHVzaENs
b3NpbmdUYWc6IGZ1bmN0aW9uKCkgewogICAgdmFyIHRhZ05hbWUgPSB0aGlzLnRhZ05hbWVzLnBv
cCgpOwogICAgaWYgKHRhZ05hbWUpIHsgdGhpcy5idWZmZXIgKz0gJzwvJyArIHN0cmlwVGFnTmFt
ZSh0YWdOYW1lKSArICc+JzsgfQogIH0sCgogIGN1cnJlbnRUYWdOYW1lOiBmdW5jdGlvbigpIHsK
ICAgIHJldHVybiB0aGlzLnRhZ05hbWVzW3RoaXMudGFnTmFtZXMubGVuZ3RoLTFdOwogIH0sCgog
IGdlbmVyYXRlRWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICB2YXIgdGFnTmFtZSA9IHRoaXMudGFn
TmFtZXMucG9wKCksIC8vIHBvcCBzaW5jZSB3ZSBkb24ndCBuZWVkIHRvIGNsb3NlCiAgICAgICAg
aWQgPSB0aGlzLmVsZW1lbnRJZCwKICAgICAgICBjbGFzc2VzID0gdGhpcy5jbGFzc2VzLAogICAg
ICAgIGF0dHJzID0gdGhpcy5lbGVtZW50QXR0cmlidXRlcywKICAgICAgICBwcm9wcyA9IHRoaXMu
ZWxlbWVudFByb3BlcnRpZXMsCiAgICAgICAgc3R5bGUgPSB0aGlzLmVsZW1lbnRTdHlsZSwKICAg
ICAgICBzdHlsZUJ1ZmZlciA9ICcnLCBhdHRyLCBwcm9wLCB0YWdTdHJpbmc7CgogICAgaWYgKGF0
dHJzICYmIGF0dHJzLm5hbWUgJiYgIWNhblNldE5hbWVPbklucHV0cykgewogICAgICAvLyBJRSBh
bGxvd3MgcGFzc2luZyBhIHRhZyB0byBjcmVhdGVFbGVtZW50LiBTZWUgbm90ZSBvbiBgY2FuU2V0
TmFtZU9uSW5wdXRzYCBhYm92ZSBhcyB3ZWxsLgogICAgICB0YWdTdHJpbmcgPSAnPCcrc3RyaXBU
YWdOYW1lKHRhZ05hbWUpKycgbmFtZT0iJytlc2NhcGVBdHRyaWJ1dGUoYXR0cnMubmFtZSkrJyI+
JzsKICAgIH0gZWxzZSB7CiAgICAgIHRhZ1N0cmluZyA9IHRhZ05hbWU7CiAgICB9CgogICAgdmFy
IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ1N0cmluZyksCiAgICAgICAgJGVs
ZW1lbnQgPSBFbWJlci4kKGVsZW1lbnQpOwoKICAgIGlmIChpZCkgewogICAgICAkZWxlbWVudC5h
dHRyKCdpZCcsIGlkKTsKICAgICAgdGhpcy5lbGVtZW50SWQgPSBudWxsOwogICAgfQogICAgaWYg
KGNsYXNzZXMpIHsKICAgICAgJGVsZW1lbnQuYXR0cignY2xhc3MnLCBjbGFzc2VzLmpvaW4oJyAn
KSk7CiAgICAgIHRoaXMuY2xhc3NlcyA9IG51bGw7CiAgICB9CgogICAgaWYgKHN0eWxlKSB7CiAg
ICAgIGZvciAocHJvcCBpbiBzdHlsZSkgewogICAgICAgIGlmIChzdHlsZS5oYXNPd25Qcm9wZXJ0
eShwcm9wKSkgewogICAgICAgICAgc3R5bGVCdWZmZXIgKz0gKHByb3AgKyAnOicgKyBzdHlsZVtw
cm9wXSArICc7Jyk7CiAgICAgICAgfQogICAgICB9CgogICAgICAkZWxlbWVudC5hdHRyKCdzdHls
ZScsIHN0eWxlQnVmZmVyKTsKCiAgICAgIHRoaXMuZWxlbWVudFN0eWxlID0gbnVsbDsKICAgIH0K
CiAgICBpZiAoYXR0cnMpIHsKICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgaWYg
KGF0dHJzLmhhc093blByb3BlcnR5KGF0dHIpKSB7CiAgICAgICAgICAkZWxlbWVudC5hdHRyKGF0
dHIsIGF0dHJzW2F0dHJdKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZWxlbWVudEF0
dHJpYnV0ZXMgPSBudWxsOwogICAgfQoKICAgIGlmIChwcm9wcykgewogICAgICBmb3IgKHByb3Ag
aW4gcHJvcHMpIHsKICAgICAgICBpZiAocHJvcHMuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAg
ICAgICAgICRlbGVtZW50LnByb3AocHJvcCwgcHJvcHNbcHJvcF0pOwogICAgICAgIH0KICAgICAg
fQoKICAgICAgdGhpcy5lbGVtZW50UHJvcGVydGllcyA9IG51bGw7CiAgICB9CgogICAgcmV0dXJu
IGVsZW1lbnQ7CiAgfSwKCiAgLyoqCiAgICBAbWV0aG9kIGVsZW1lbnQKICAgIEByZXR1cm4ge0RP
TUVsZW1lbnR9IFRoZSBlbGVtZW50IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdlbmVyYXRlZCBIVE1M
CiAgICAgIG9mIHRoaXMgYnVmZmVyCiAgKi8KICBlbGVtZW50OiBmdW5jdGlvbigpIHsKICAgIHZh
ciBodG1sID0gdGhpcy5pbm5lclN0cmluZygpOwoKICAgIGlmIChodG1sKSB7CiAgICAgIHRoaXMu
X2VsZW1lbnQgPSBFbWJlci5WaWV3VXRpbHMuc2V0SW5uZXJIVE1MKHRoaXMuX2VsZW1lbnQsIGh0
bWwpOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9lbGVtZW50OwogIH0sCgogIC8qKgogICAgR2Vu
ZXJhdGVzIHRoZSBIVE1MIGNvbnRlbnQgZm9yIHRoaXMgYnVmZmVyLgoKICAgIEBtZXRob2Qgc3Ry
aW5nCiAgICBAcmV0dXJuIHtTdHJpbmd9IFRoZSBnZW5lcmF0ZWQgSFRNTAogICovCiAgc3RyaW5n
OiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9oYXNFbGVtZW50ICYmIHRoaXMuX2VsZW1lbnQp
IHsKICAgICAgLy8gRmlyZWZveCB2ZXJzaW9ucyA8IDExIGRvIG5vdCBoYXZlIHN1cHBvcnQgZm9y
IGVsZW1lbnQub3V0ZXJIVE1MLgogICAgICB2YXIgdGhpc0VsZW1lbnQgPSB0aGlzLmVsZW1lbnQo
KSwgb3V0ZXJIVE1MID0gdGhpc0VsZW1lbnQub3V0ZXJIVE1MOwogICAgICBpZiAodHlwZW9mIG91
dGVySFRNTCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm4gRW1iZXIuJCgnPGRpdi8+
JykuYXBwZW5kKHRoaXNFbGVtZW50KS5odG1sKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dGVy
SFRNTDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0aGlzLmlubmVyU3RyaW5nKCk7CiAgICB9
CiAgfSwKCiAgaW5uZXJTdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuYnVmZmVy
OwogIH0KfTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1v
ZHVsZSBlbWJlci12aWV3cwoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0
LCBmbXQgPSBFbWJlci5TdHJpbmcuZm10OwoKLyoqCiAgYEVtYmVyLkV2ZW50RGlzcGF0Y2hlcmAg
aGFuZGxlcyBkZWxlZ2F0aW5nIGJyb3dzZXIgZXZlbnRzIHRvIHRoZWlyCiAgY29ycmVzcG9uZGlu
ZyBgRW1iZXIuVmlld3MuYCBGb3IgZXhhbXBsZSwgd2hlbiB5b3UgY2xpY2sgb24gYSB2aWV3LAog
IGBFbWJlci5FdmVudERpc3BhdGNoZXJgIGVuc3VyZXMgdGhhdCB0aGF0IHZpZXcncyBgbW91c2VE
b3duYCBtZXRob2QgZ2V0cwogIGNhbGxlZC4KCiAgQGNsYXNzIEV2ZW50RGlzcGF0Y2hlcgogIEBu
YW1lc3BhY2UgRW1iZXIKICBAcHJpdmF0ZQogIEBleHRlbmRzIEVtYmVyLk9iamVjdAoqLwpFbWJl
ci5FdmVudERpc3BhdGNoZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKCiAgLyoqCiAgICBUaGUg
c2V0IG9mIGV2ZW50cyBuYW1lcyAoYW5kIGFzc29jaWF0ZWQgaGFuZGxlciBmdW5jdGlvbiBuYW1l
cykgdG8gYmUgc2V0dXAKICAgIGFuZCBkaXNwYXRjaGVkIGJ5IHRoZSBgRXZlbnREaXNwYXRjaGVy
YC4gQ3VzdG9tIGV2ZW50cyBjYW4gYWRkZWQgdG8gdGhpcyBsaXN0IGF0IHNldHVwCiAgICB0aW1l
LCBnZW5lcmFsbHkgdmlhIHRoZSBgRW1iZXIuQXBwbGljYXRpb24uY3VzdG9tRXZlbnRzYCBoYXNo
LiBPbmx5IG92ZXJyaWRlIHRoaXMKICAgIGRlZmF1bHQgc2V0IHRvIHByZXZlbnQgdGhlIEV2ZW50
RGlzcGF0Y2hlciBmcm9tIGxpc3RlbmluZyBvbiBzb21lIGV2ZW50cyBhbGwgdG9nZXRoZXIuCgog
ICAgVGhpcyBzZXQgd2lsbCBiZSBtb2RpZmllZCBieSBgc2V0dXBgIHRvIGFsc28gaW5jbHVkZSBh
bnkgZXZlbnRzIGFkZGVkIGF0IHRoYXQgdGltZS4KCiAgICBAcHJvcGVydHkgZXZlbnRzCiAgICBA
dHlwZSBPYmplY3QKICAqLwogIGV2ZW50czogewogICAgdG91Y2hzdGFydCAgOiAndG91Y2hTdGFy
dCcsCiAgICB0b3VjaG1vdmUgICA6ICd0b3VjaE1vdmUnLAogICAgdG91Y2hlbmQgICAgOiAndG91
Y2hFbmQnLAogICAgdG91Y2hjYW5jZWwgOiAndG91Y2hDYW5jZWwnLAogICAga2V5ZG93biAgICAg
OiAna2V5RG93bicsCiAgICBrZXl1cCAgICAgICA6ICdrZXlVcCcsCiAgICBrZXlwcmVzcyAgICA6
ICdrZXlQcmVzcycsCiAgICBtb3VzZWRvd24gICA6ICdtb3VzZURvd24nLAogICAgbW91c2V1cCAg
ICAgOiAnbW91c2VVcCcsCiAgICBjb250ZXh0bWVudSA6ICdjb250ZXh0TWVudScsCiAgICBjbGlj
ayAgICAgICA6ICdjbGljaycsCiAgICBkYmxjbGljayAgICA6ICdkb3VibGVDbGljaycsCiAgICBt
b3VzZW1vdmUgICA6ICdtb3VzZU1vdmUnLAogICAgZm9jdXNpbiAgICAgOiAnZm9jdXNJbicsCiAg
ICBmb2N1c291dCAgICA6ICdmb2N1c091dCcsCiAgICBtb3VzZWVudGVyICA6ICdtb3VzZUVudGVy
JywKICAgIG1vdXNlbGVhdmUgIDogJ21vdXNlTGVhdmUnLAogICAgc3VibWl0ICAgICAgOiAnc3Vi
bWl0JywKICAgIGlucHV0ICAgICAgIDogJ2lucHV0JywKICAgIGNoYW5nZSAgICAgIDogJ2NoYW5n
ZScsCiAgICBkcmFnc3RhcnQgICA6ICdkcmFnU3RhcnQnLAogICAgZHJhZyAgICAgICAgOiAnZHJh
ZycsCiAgICBkcmFnZW50ZXIgICA6ICdkcmFnRW50ZXInLAogICAgZHJhZ2xlYXZlICAgOiAnZHJh
Z0xlYXZlJywKICAgIGRyYWdvdmVyICAgIDogJ2RyYWdPdmVyJywKICAgIGRyb3AgICAgICAgIDog
J2Ryb3AnLAogICAgZHJhZ2VuZCAgICAgOiAnZHJhZ0VuZCcKICB9LAoKICAvKioKICAgIFRoZSBy
b290IERPTSBlbGVtZW50IHRvIHdoaWNoIGV2ZW50IGxpc3RlbmVycyBzaG91bGQgYmUgYXR0YWNo
ZWQuIEV2ZW50CiAgICBsaXN0ZW5lcnMgd2lsbCBiZSBhdHRhY2hlZCB0byB0aGUgZG9jdW1lbnQg
dW5sZXNzIHRoaXMgaXMgb3ZlcnJpZGRlbi4KCiAgICBDYW4gYmUgc3BlY2lmaWVkIGFzIGEgRE9N
RWxlbWVudCBvciBhIHNlbGVjdG9yIHN0cmluZy4KCiAgICBUaGUgZGVmYXVsdCBib2R5IGlzIGEg
c3RyaW5nIHNpbmNlIHRoaXMgbWF5IGJlIGV2YWx1YXRlZCBiZWZvcmUgZG9jdW1lbnQuYm9keQog
ICAgZXhpc3RzIGluIHRoZSBET00uCgogICAgQHByaXZhdGUKICAgIEBwcm9wZXJ0eSByb290RWxl
bWVudAogICAgQHR5cGUgRE9NRWxlbWVudAogICAgQGRlZmF1bHQgJ2JvZHknCiAgKi8KICByb290
RWxlbWVudDogJ2JvZHknLAoKICAvKioKICAgIFNldHMgdXAgZXZlbnQgbGlzdGVuZXJzIGZvciBz
dGFuZGFyZCBicm93c2VyIGV2ZW50cy4KCiAgICBUaGlzIHdpbGwgYmUgY2FsbGVkIGFmdGVyIHRo
ZSBicm93c2VyIHNlbmRzIGEgYERPTUNvbnRlbnRSZWFkeWAgZXZlbnQuIEJ5CiAgICBkZWZhdWx0
LCBpdCB3aWxsIHNldCB1cCBhbGwgb2YgdGhlIGxpc3RlbmVycyBvbiB0aGUgZG9jdW1lbnQgYm9k
eS4gSWYgeW91CiAgICB3b3VsZCBsaWtlIHRvIHJlZ2lzdGVyIHRoZSBsaXN0ZW5lcnMgb24gYSBk
aWZmZXJlbnQgZWxlbWVudCwgc2V0IHRoZSBldmVudAogICAgZGlzcGF0Y2hlcidzIGByb290YCBw
cm9wZXJ0eS4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBzZXR1cAogICAgQHBhcmFtIGFkZGVk
RXZlbnRzIHtIYXNofQogICovCiAgc2V0dXA6IGZ1bmN0aW9uKGFkZGVkRXZlbnRzLCByb290RWxl
bWVudCkgewogICAgdmFyIGV2ZW50LCBldmVudHMgPSBnZXQodGhpcywgJ2V2ZW50cycpOwoKICAg
IEVtYmVyLiQuZXh0ZW5kKGV2ZW50cywgYWRkZWRFdmVudHMgfHwge30pOwoKCiAgICBpZiAoIUVt
YmVyLmlzTm9uZShyb290RWxlbWVudCkpIHsKICAgICAgc2V0KHRoaXMsICdyb290RWxlbWVudCcs
IHJvb3RFbGVtZW50KTsKICAgIH0KCiAgICByb290RWxlbWVudCA9IEVtYmVyLiQoZ2V0KHRoaXMs
ICdyb290RWxlbWVudCcpKTsKCiAgICBFbWJlci5hc3NlcnQoZm10KCdZb3UgY2Fubm90IHVzZSB0
aGUgc2FtZSByb290IGVsZW1lbnQgKCVAKSBtdWx0aXBsZSB0aW1lcyBpbiBhbiBFbWJlci5BcHBs
aWNhdGlvbicsIFtyb290RWxlbWVudC5zZWxlY3RvciB8fCByb290RWxlbWVudFswXS50YWdOYW1l
XSksICFyb290RWxlbWVudC5pcygnLmVtYmVyLWFwcGxpY2F0aW9uJykpOwogICAgRW1iZXIuYXNz
ZXJ0KCdZb3UgY2Fubm90IG1ha2UgYSBuZXcgRW1iZXIuQXBwbGljYXRpb24gdXNpbmcgYSByb290
IGVsZW1lbnQgdGhhdCBpcyBhIGRlc2NlbmRlbnQgb2YgYW4gZXhpc3RpbmcgRW1iZXIuQXBwbGlj
YXRpb24nLCAhcm9vdEVsZW1lbnQuY2xvc2VzdCgnLmVtYmVyLWFwcGxpY2F0aW9uJykubGVuZ3Ro
KTsKICAgIEVtYmVyLmFzc2VydCgnWW91IGNhbm5vdCBtYWtlIGEgbmV3IEVtYmVyLkFwcGxpY2F0
aW9uIHVzaW5nIGEgcm9vdCBlbGVtZW50IHRoYXQgaXMgYW4gYW5jZXN0b3Igb2YgYW4gZXhpc3Rp
bmcgRW1iZXIuQXBwbGljYXRpb24nLCAhcm9vdEVsZW1lbnQuZmluZCgnLmVtYmVyLWFwcGxpY2F0
aW9uJykubGVuZ3RoKTsKCiAgICByb290RWxlbWVudC5hZGRDbGFzcygnZW1iZXItYXBwbGljYXRp
b24nKTsKCiAgICBFbWJlci5hc3NlcnQoJ1VuYWJsZSB0byBhZGQgImVtYmVyLWFwcGxpY2F0aW9u
IiBjbGFzcyB0byByb290RWxlbWVudC4gTWFrZSBzdXJlIHlvdSBzZXQgcm9vdEVsZW1lbnQgdG8g
dGhlIGJvZHkgb3IgYW4gZWxlbWVudCBpbiB0aGUgYm9keS4nLCByb290RWxlbWVudC5pcygnLmVt
YmVyLWFwcGxpY2F0aW9uJykpOwoKICAgIGZvciAoZXZlbnQgaW4gZXZlbnRzKSB7CiAgICAgIGlm
IChldmVudHMuaGFzT3duUHJvcGVydHkoZXZlbnQpKSB7CiAgICAgICAgdGhpcy5zZXR1cEhhbmRs
ZXIocm9vdEVsZW1lbnQsIGV2ZW50LCBldmVudHNbZXZlbnRdKTsKICAgICAgfQogICAgfQogIH0s
CgogIC8qKgogICAgUmVnaXN0ZXJzIGFuIGV2ZW50IGxpc3RlbmVyIG9uIHRoZSBkb2N1bWVudC4g
SWYgdGhlIGdpdmVuIGV2ZW50IGlzCiAgICB0cmlnZ2VyZWQsIHRoZSBwcm92aWRlZCBldmVudCBo
YW5kbGVyIHdpbGwgYmUgdHJpZ2dlcmVkIG9uIHRoZSB0YXJnZXQgdmlldy4KCiAgICBJZiB0aGUg
dGFyZ2V0IHZpZXcgZG9lcyBub3QgaW1wbGVtZW50IHRoZSBldmVudCBoYW5kbGVyLCBvciBpZiB0
aGUgaGFuZGxlcgogICAgcmV0dXJucyBgZmFsc2VgLCB0aGUgcGFyZW50IHZpZXcgd2lsbCBiZSBj
YWxsZWQuIFRoZSBldmVudCB3aWxsIGNvbnRpbnVlIHRvCiAgICBidWJibGUgdG8gZWFjaCBzdWNj
ZXNzaXZlIHBhcmVudCB2aWV3IHVudGlsIGl0IHJlYWNoZXMgdGhlIHRvcC4KCiAgICBGb3IgZXhh
bXBsZSwgdG8gaGF2ZSB0aGUgYG1vdXNlRG93bmAgbWV0aG9kIGNhbGxlZCBvbiB0aGUgdGFyZ2V0
IHZpZXcgd2hlbgogICAgYSBgbW91c2Vkb3duYCBldmVudCBpcyByZWNlaXZlZCBmcm9tIHRoZSBi
cm93c2VyLCBkbyB0aGUgZm9sbG93aW5nOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIHNldHVwSGFu
ZGxlcignbW91c2Vkb3duJywgJ21vdXNlRG93bicpOwogICAgYGBgCgogICAgQHByaXZhdGUKICAg
IEBtZXRob2Qgc2V0dXBIYW5kbGVyCiAgICBAcGFyYW0ge0VsZW1lbnR9IHJvb3RFbGVtZW50CiAg
ICBAcGFyYW0ge1N0cmluZ30gZXZlbnQgdGhlIGJyb3dzZXItb3JpZ2luYXRlZCBldmVudCB0byBs
aXN0ZW4gdG8KICAgIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWUgdGhlIG5hbWUgb2YgdGhlIG1l
dGhvZCB0byBjYWxsIG9uIHRoZSB2aWV3CiAgKi8KICBzZXR1cEhhbmRsZXI6IGZ1bmN0aW9uKHJv
b3RFbGVtZW50LCBldmVudCwgZXZlbnROYW1lKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAg
cm9vdEVsZW1lbnQub24oZXZlbnQgKyAnLmVtYmVyJywgJy5lbWJlci12aWV3JywgZnVuY3Rpb24o
ZXZ0LCB0cmlnZ2VyaW5nTWFuYWdlcikgewogICAgICByZXR1cm4gRW1iZXIuaGFuZGxlRXJyb3Jz
KGZ1bmN0aW9uIGhhbmRsZVZpZXdFdmVudCgpIHsKICAgICAgICB2YXIgdmlldyA9IEVtYmVyLlZp
ZXcudmlld3NbdGhpcy5pZF0sCiAgICAgICAgICAgIHJlc3VsdCA9IHRydWUsIG1hbmFnZXIgPSBu
dWxsOwoKICAgICAgICBtYW5hZ2VyID0gc2VsZi5fZmluZE5lYXJlc3RFdmVudE1hbmFnZXIodmll
dyxldmVudE5hbWUpOwoKICAgICAgICBpZiAobWFuYWdlciAmJiBtYW5hZ2VyICE9PSB0cmlnZ2Vy
aW5nTWFuYWdlcikgewogICAgICAgICAgcmVzdWx0ID0gc2VsZi5fZGlzcGF0Y2hFdmVudChtYW5h
Z2VyLCBldnQsIGV2ZW50TmFtZSwgdmlldyk7CiAgICAgICAgfSBlbHNlIGlmICh2aWV3KSB7CiAg
ICAgICAgICByZXN1bHQgPSBzZWxmLl9idWJibGVFdmVudCh2aWV3LGV2dCxldmVudE5hbWUpOwog
ICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAg
fQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LCB0aGlzKTsKICAgIH0pOwoKICAgIHJv
b3RFbGVtZW50Lm9uKGV2ZW50ICsgJy5lbWJlcicsICdbZGF0YS1lbWJlci1hY3Rpb25dJywgZnVu
Y3Rpb24oZXZ0KSB7CiAgICAgIHJldHVybiBFbWJlci5oYW5kbGVFcnJvcnMoZnVuY3Rpb24gaGFu
ZGxlQWN0aW9uRXZlbnQoKSB7CiAgICAgICAgdmFyIGFjdGlvbklkID0gRW1iZXIuJChldnQuY3Vy
cmVudFRhcmdldCkuYXR0cignZGF0YS1lbWJlci1hY3Rpb24nKSwKICAgICAgICAgICAgYWN0aW9u
ICAgPSBFbWJlci5IYW5kbGViYXJzLkFjdGlvbkhlbHBlci5yZWdpc3RlcmVkQWN0aW9uc1thY3Rp
b25JZF07CgogICAgICAgIC8vIFdlIGhhdmUgdG8gY2hlY2sgZm9yIGFjdGlvbiBoZXJlIHNpbmNl
IGluIHNvbWUgY2FzZXMsIGpRdWVyeSB3aWxsIHRyaWdnZXIKICAgICAgICAvLyBhbiBldmVudCBv
biBgcmVtb3ZlQ2hpbGRgIChpLmUuIGZvY3Vzb3V0KSBhZnRlciB3ZSd2ZSBhbHJlYWR5IHRvcm4g
ZG93biB0aGUKICAgICAgICAvLyBhY3Rpb24gaGFuZGxlcnMgZm9yIHRoZSB2aWV3LgogICAgICAg
IGlmIChhY3Rpb24gJiYgYWN0aW9uLmV2ZW50TmFtZSA9PT0gZXZlbnROYW1lKSB7CiAgICAgICAg
ICByZXR1cm4gYWN0aW9uLmhhbmRsZXIoZXZ0KTsKICAgICAgICB9CiAgICAgIH0sIHRoaXMpOwog
ICAgfSk7CiAgfSwKCiAgX2ZpbmROZWFyZXN0RXZlbnRNYW5hZ2VyOiBmdW5jdGlvbih2aWV3LCBl
dmVudE5hbWUpIHsKICAgIHZhciBtYW5hZ2VyID0gbnVsbDsKCiAgICB3aGlsZSAodmlldykgewog
ICAgICBtYW5hZ2VyID0gZ2V0KHZpZXcsICdldmVudE1hbmFnZXInKTsKICAgICAgaWYgKG1hbmFn
ZXIgJiYgbWFuYWdlcltldmVudE5hbWVdKSB7IGJyZWFrOyB9CgogICAgICB2aWV3ID0gZ2V0KHZp
ZXcsICdwYXJlbnRWaWV3Jyk7CiAgICB9CgogICAgcmV0dXJuIG1hbmFnZXI7CiAgfSwKCiAgX2Rp
c3BhdGNoRXZlbnQ6IGZ1bmN0aW9uKG9iamVjdCwgZXZ0LCBldmVudE5hbWUsIHZpZXcpIHsKICAg
IHZhciByZXN1bHQgPSB0cnVlOwoKICAgIHZhciBoYW5kbGVyID0gb2JqZWN0W2V2ZW50TmFtZV07
CiAgICBpZiAoRW1iZXIudHlwZU9mKGhhbmRsZXIpID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJl
c3VsdCA9IEVtYmVyLnJ1bihmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gaGFuZGxlci5jYWxs
KG9iamVjdCwgZXZ0LCB2aWV3KTsKICAgICAgfSk7CiAgICAgIC8vIERvIG5vdCBwcmV2ZW50RGVm
YXVsdCBpbiBldmVudE1hbmFnZXJzLgogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9
CiAgICBlbHNlIHsKICAgICAgcmVzdWx0ID0gdGhpcy5fYnViYmxlRXZlbnQodmlldywgZXZ0LCBl
dmVudE5hbWUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfSwKCiAgX2J1YmJsZUV2ZW50
OiBmdW5jdGlvbih2aWV3LCBldnQsIGV2ZW50TmFtZSkgewogICAgcmV0dXJuIEVtYmVyLnJ1bihm
dW5jdGlvbiBidWJibGVFdmVudCgpIHsKICAgICAgcmV0dXJuIHZpZXcuaGFuZGxlRXZlbnQoZXZl
bnROYW1lLCBldnQpOwogICAgfSk7CiAgfSwKCiAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICB2
YXIgcm9vdEVsZW1lbnQgPSBnZXQodGhpcywgJ3Jvb3RFbGVtZW50Jyk7CiAgICBFbWJlci4kKHJv
b3RFbGVtZW50KS5vZmYoJy5lbWJlcicsICcqKicpLnJlbW92ZUNsYXNzKCdlbWJlci1hcHBsaWNh
dGlvbicpOwogICAgcmV0dXJuIHRoaXMuX3N1cGVyKCk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5j
dGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwoqLwoKLy8g
QWRkIGEgbmV3IG5hbWVkIHF1ZXVlIGZvciByZW5kZXJpbmcgdmlld3MgdGhhdCBoYXBwZW5zCi8v
IGFmdGVyIGJpbmRpbmdzIGhhdmUgc3luY2VkLCBhbmQgYSBxdWV1ZSBmb3Igc2NoZWR1bGluZyBh
Y3Rpb25zCi8vIHRoYXQgdGhhdCBzaG91bGQgb2NjdXIgYWZ0ZXIgdmlldyByZW5kZXJpbmcuCnZh
ciBxdWV1ZXMgPSBFbWJlci5ydW4ucXVldWVzLAogICAgaW5kZXhPZiA9IEVtYmVyLkFycmF5UG9s
eWZpbGxzLmluZGV4T2Y7CnF1ZXVlcy5zcGxpY2UoaW5kZXhPZi5jYWxsKHF1ZXVlcywgJ2FjdGlv
bnMnKSsxLCAwLCAncmVuZGVyJywgJ2FmdGVyUmVuZGVyJyk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItdmlld3MKKi8KCnZhciBnZXQg
PSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCi8vIE9yaWdpbmFsIGNsYXNzIGRlY2xhcmF0
aW9uIGFuZCBkb2N1bWVudGF0aW9uIGluIHJ1bnRpbWUvbGliL2NvbnRyb2xsZXJzL2NvbnRyb2xs
ZXIuanMKLy8gTk9URTogSXQgbWF5IGJlIHBvc3NpYmxlIHdpdGggWVVJRG9jIHRvIGNvbWJpbmUg
ZG9jcyBpbiB0d28gbG9jYXRpb25zCgovKioKQWRkaXRpb25hbCBtZXRob2RzIGZvciB0aGUgQ29u
dHJvbGxlck1peGluCgpAY2xhc3MgQ29udHJvbGxlck1peGluCkBuYW1lc3BhY2UgRW1iZXIKKi8K
RW1iZXIuQ29udHJvbGxlck1peGluLnJlb3Blbih7CiAgdGFyZ2V0OiBudWxsLAogIG5hbWVzcGFj
ZTogbnVsbCwKICB2aWV3OiBudWxsLAogIGNvbnRhaW5lcjogbnVsbCwKICBfY2hpbGRDb250YWlu
ZXJzOiBudWxsLAoKICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3N1cGVyKCk7CiAgICBz
ZXQodGhpcywgJ19jaGlsZENvbnRhaW5lcnMnLCB7fSk7CiAgfSwKCiAgX21vZGVsRGlkQ2hhbmdl
OiBFbWJlci5vYnNlcnZlcignbW9kZWwnLCBmdW5jdGlvbigpIHsKICAgIHZhciBjb250YWluZXJz
ID0gZ2V0KHRoaXMsICdfY2hpbGRDb250YWluZXJzJyk7CgogICAgZm9yICh2YXIgcHJvcCBpbiBj
b250YWluZXJzKSB7CiAgICAgIGlmICghY29udGFpbmVycy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkg
eyBjb250aW51ZTsgfQogICAgICBjb250YWluZXJzW3Byb3BdLmRlc3Ryb3koKTsKICAgIH0KCiAg
ICBzZXQodGhpcywgJ19jaGlsZENvbnRhaW5lcnMnLCB7fSk7CiAgfSkKfSk7Cgp9KSgpOwoKCgoo
ZnVuY3Rpb24oKSB7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7CnZhciBzdGF0ZXMgPSB7fTsKCi8q
KgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItdmlld3MKKi8KCnZhciBnZXQgPSBFbWJl
ci5nZXQsIHNldCA9IEVtYmVyLnNldDsKdmFyIGd1aWRGb3IgPSBFbWJlci5ndWlkRm9yOwp2YXIg
YV9mb3JFYWNoID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmZvckVhY2g7CnZhciBhX2FkZE9iamVj
dCA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5hZGRPYmplY3Q7CnZhciBtZXRhID0gRW1iZXIubWV0
YTsKCnZhciBjaGlsZFZpZXdzUHJvcGVydHkgPSBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsK
ICB2YXIgY2hpbGRWaWV3cyA9IHRoaXMuX2NoaWxkVmlld3MsIHJldCA9IEVtYmVyLkEoKSwgdmll
dyA9IHRoaXM7CgogIGFfZm9yRWFjaChjaGlsZFZpZXdzLCBmdW5jdGlvbih2aWV3KSB7CiAgICB2
YXIgY3VycmVudENoaWxkVmlld3M7CiAgICBpZiAodmlldy5pc1ZpcnR1YWwpIHsKICAgICAgaWYg
KGN1cnJlbnRDaGlsZFZpZXdzID0gZ2V0KHZpZXcsICdjaGlsZFZpZXdzJykpIHsKICAgICAgICBy
ZXQucHVzaE9iamVjdHMoY3VycmVudENoaWxkVmlld3MpOwogICAgICB9CiAgICB9IGVsc2Ugewog
ICAgICByZXQucHVzaCh2aWV3KTsKICAgIH0KICB9KTsKCiAgcmV0LnJlcGxhY2UgPSBmdW5jdGlv
biAoaWR4LCByZW1vdmVkQ291bnQsIGFkZGVkVmlld3MpIHsKICAgIGlmICh2aWV3IGluc3RhbmNl
b2YgRW1iZXIuQ29udGFpbmVyVmlldykgewogICAgICBFbWJlci5kZXByZWNhdGUoIk1hbmlwdWxh
dGluZyBhbiBFbWJlci5Db250YWluZXJWaWV3IHRocm91Z2ggaXRzIGNoaWxkVmlld3MgcHJvcGVy
dHkgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSB0aGUgQ29udGFpbmVyVmlldyBpbnN0YW5jZSBp
dHNlbGYgYXMgYW4gRW1iZXIuTXV0YWJsZUFycmF5LiIpOwogICAgICByZXR1cm4gdmlldy5yZXBs
YWNlKGlkeCwgcmVtb3ZlZENvdW50LCBhZGRlZFZpZXdzKTsKICAgIH0KICAgIHRocm93IG5ldyBF
bWJlci5FcnJvcigiY2hpbGRWaWV3cyBpcyBpbW11dGFibGUiKTsKICB9OwoKICByZXR1cm4gcmV0
Owp9KTsKCkVtYmVyLndhcm4oIlRoZSBWSUVXX1BSRVNFUlZFU19DT05URVhUIGZsYWcgaGFzIGJl
ZW4gcmVtb3ZlZCBhbmQgdGhlIGZ1bmN0aW9uYWxpdHkgY2FuIG5vIGxvbmdlciBiZSBkaXNhYmxl
ZC4iLCBFbWJlci5FTlYuVklFV19QUkVTRVJWRVNfQ09OVEVYVCAhPT0gZmFsc2UpOwoKLyoqCiAg
R2xvYmFsIGhhc2ggb2Ygc2hhcmVkIHRlbXBsYXRlcy4gVGhpcyB3aWxsIGF1dG9tYXRpY2FsbHkg
YmUgcG9wdWxhdGVkCiAgYnkgdGhlIGJ1aWxkIHRvb2xzIHNvIHRoYXQgeW91IGNhbiBzdG9yZSB5
b3VyIEhhbmRsZWJhcnMgdGVtcGxhdGVzIGluCiAgc2VwYXJhdGUgZmlsZXMgdGhhdCBnZXQgbG9h
ZGVkIGludG8gSmF2YVNjcmlwdCBhdCBidWlsZHRpbWUuCgogIEBwcm9wZXJ0eSBURU1QTEFURVMK
ICBAZm9yIEVtYmVyCiAgQHR5cGUgSGFzaAoqLwpFbWJlci5URU1QTEFURVMgPSB7fTsKCi8qKgog
IGBFbWJlci5Db3JlVmlld2AgaXMgYW4gYWJzdHJhY3QgY2xhc3MgdGhhdCBleGlzdHMgdG8gZ2l2
ZSB2aWV3LWxpa2UgYmVoYXZpb3IKICB0byBib3RoIEVtYmVyJ3MgbWFpbiB2aWV3IGNsYXNzIGBF
bWJlci5WaWV3YCBhbmQgb3RoZXIgY2xhc3NlcyBsaWtlCiAgYEVtYmVyLl9TaW1wbGVNZXRhbW9y
cGhWaWV3YCB0aGF0IGRvbid0IG5lZWQgdGhlIGZ1bGx5IGZ1bmN0aW9uYWx0aXkgb2YKICBgRW1i
ZXIuVmlld2AuCgogIFVubGVzcyB5b3UgaGF2ZSBzcGVjaWZpYyBuZWVkcyBmb3IgYENvcmVWaWV3
YCwgeW91IHdpbGwgdXNlIGBFbWJlci5WaWV3YAogIGluIHlvdXIgYXBwbGljYXRpb25zLgoKICBA
Y2xhc3MgQ29yZVZpZXcKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0
CiAgQHVzZXMgRW1iZXIuRXZlbnRlZAogIEB1c2VzIEVtYmVyLkFjdGlvbkhhbmRsZXIKKi8KCkVt
YmVyLkNvcmVWaWV3ID0gRW1iZXIuT2JqZWN0LmV4dGVuZChFbWJlci5FdmVudGVkLCBFbWJlci5B
Y3Rpb25IYW5kbGVyLCB7CiAgaXNWaWV3OiB0cnVlLAoKICBzdGF0ZXM6IHN0YXRlcywKCiAgaW5p
dDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9zdXBlcigpOwogICAgdGhpcy50cmFuc2l0aW9uVG8o
J3ByZVJlbmRlcicpOwogIH0sCgogIC8qKgogICAgSWYgdGhlIHZpZXcgaXMgY3VycmVudGx5IGlu
c2VydGVkIGludG8gdGhlIERPTSBvZiBhIHBhcmVudCB2aWV3LCB0aGlzCiAgICBwcm9wZXJ0eSB3
aWxsIHBvaW50IHRvIHRoZSBwYXJlbnQgb2YgdGhlIHZpZXcuCgogICAgQHByb3BlcnR5IHBhcmVu
dFZpZXcKICAgIEB0eXBlIEVtYmVyLlZpZXcKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIHBhcmVu
dFZpZXc6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKCkgewogICAgdmFyIHBhcmVudCA9IHRoaXMu
X3BhcmVudFZpZXc7CgogICAgaWYgKHBhcmVudCAmJiBwYXJlbnQuaXNWaXJ0dWFsKSB7CiAgICAg
IHJldHVybiBnZXQocGFyZW50LCAncGFyZW50VmlldycpOwogICAgfSBlbHNlIHsKICAgICAgcmV0
dXJuIHBhcmVudDsKICAgIH0KICB9KS5wcm9wZXJ0eSgnX3BhcmVudFZpZXcnKSwKCiAgc3RhdGU6
IG51bGwsCgogIF9wYXJlbnRWaWV3OiBudWxsLAoKICAvLyByZXR1cm4gdGhlIGN1cnJlbnQgdmll
dywgbm90IGluY2x1ZGluZyB2aXJ0dWFsIHZpZXdzCiAgY29uY3JldGVWaWV3OiBFbWJlci5jb21w
dXRlZChmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5pc1ZpcnR1YWwpIHsgcmV0dXJuIHRoaXM7
IH0KICAgIGVsc2UgeyByZXR1cm4gZ2V0KHRoaXMsICdwYXJlbnRWaWV3Jyk7IH0KICB9KS5wcm9w
ZXJ0eSgncGFyZW50VmlldycpLAoKICBpbnN0cnVtZW50TmFtZTogJ2NvcmVfdmlldycsCgogIGlu
c3RydW1lbnREZXRhaWxzOiBmdW5jdGlvbihoYXNoKSB7CiAgICBoYXNoLm9iamVjdCA9IHRoaXMu
dG9TdHJpbmcoKTsKICB9LAoKICAvKioKICAgIEludm9rZWQgYnkgdGhlIHZpZXcgc3lzdGVtIHdo
ZW4gdGhpcyB2aWV3IG5lZWRzIHRvIHByb2R1Y2UgYW4gSFRNTAogICAgcmVwcmVzZW50YXRpb24u
IFRoaXMgbWV0aG9kIHdpbGwgY3JlYXRlIGEgbmV3IHJlbmRlciBidWZmZXIsIGlmIG5lZWRlZCwK
ICAgIHRoZW4gYXBwbHkgYW55IGRlZmF1bHQgYXR0cmlidXRlcywgc3VjaCBhcyBjbGFzcyBuYW1l
cyBhbmQgdmlzaWJpbGl0eS4KICAgIEZpbmFsbHksIHRoZSBgcmVuZGVyKClgIG1ldGhvZCBpcyBp
bnZva2VkLCB3aGljaCBpcyByZXNwb25zaWJsZSBmb3IKICAgIGRvaW5nIHRoZSBidWxrIG9mIHRo
ZSByZW5kZXJpbmcuCgogICAgWW91IHNob3VsZCBub3QgbmVlZCB0byBvdmVycmlkZSB0aGlzIG1l
dGhvZDsgaW5zdGVhZCwgaW1wbGVtZW50IHRoZQogICAgYHRlbXBsYXRlYCBwcm9wZXJ0eSwgb3Ig
aWYgeW91IG5lZWQgbW9yZSBjb250cm9sLCBvdmVycmlkZSB0aGUgYHJlbmRlcmAKICAgIG1ldGhv
ZC4KCiAgICBAbWV0aG9kIHJlbmRlclRvQnVmZmVyCiAgICBAcGFyYW0ge0VtYmVyLlJlbmRlckJ1
ZmZlcn0gYnVmZmVyIHRoZSByZW5kZXIgYnVmZmVyLiBJZiBubyBidWZmZXIgaXMKICAgICAgcGFz
c2VkLCBhIGRlZmF1bHQgYnVmZmVyLCB1c2luZyB0aGUgY3VycmVudCB2aWV3J3MgYHRhZ05hbWVg
LCB3aWxsCiAgICAgIGJlIHVzZWQuCiAgICBAcHJpdmF0ZQogICovCiAgcmVuZGVyVG9CdWZmZXI6
IGZ1bmN0aW9uKHBhcmVudEJ1ZmZlciwgYnVmZmVyT3BlcmF0aW9uKSB7CiAgICB2YXIgbmFtZSA9
ICdyZW5kZXIuJyArIHRoaXMuaW5zdHJ1bWVudE5hbWUsCiAgICAgICAgZGV0YWlscyA9IHt9OwoK
ICAgIHRoaXMuaW5zdHJ1bWVudERldGFpbHMoZGV0YWlscyk7CgogICAgcmV0dXJuIEVtYmVyLmlu
c3RydW1lbnQobmFtZSwgZGV0YWlscywgZnVuY3Rpb24gaW5zdHJ1bWVudFJlbmRlclRvQnVmZmVy
KCkgewogICAgICByZXR1cm4gdGhpcy5fcmVuZGVyVG9CdWZmZXIocGFyZW50QnVmZmVyLCBidWZm
ZXJPcGVyYXRpb24pOwogICAgfSwgdGhpcyk7CiAgfSwKCiAgX3JlbmRlclRvQnVmZmVyOiBmdW5j
dGlvbihwYXJlbnRCdWZmZXIsIGJ1ZmZlck9wZXJhdGlvbikgewogICAgLy8gSWYgdGhpcyBpcyB0
aGUgdG9wLW1vc3Qgdmlldywgc3RhcnQgYSBuZXcgYnVmZmVyLiBPdGhlcndpc2UsCiAgICAvLyBj
cmVhdGUgYSBuZXcgYnVmZmVyIHJlbGF0aXZlIHRvIHRoZSBvcmlnaW5hbCB1c2luZyB0aGUKICAg
IC8vIHByb3ZpZGVkIGJ1ZmZlciBvcGVyYXRpb24gKGZvciBleGFtcGxlLCBgaW5zZXJ0QWZ0ZXJg
IHdpbGwKICAgIC8vIGluc2VydCBhIG5ldyBidWZmZXIgYWZ0ZXIgdGhlICJwYXJlbnQgYnVmZmVy
IikuCiAgICB2YXIgdGFnTmFtZSA9IHRoaXMudGFnTmFtZTsKCiAgICBpZiAodGFnTmFtZSA9PT0g
bnVsbCB8fCB0YWdOYW1lID09PSB1bmRlZmluZWQpIHsKICAgICAgdGFnTmFtZSA9ICdkaXYnOwog
ICAgfQoKICAgIHZhciBidWZmZXIgPSB0aGlzLmJ1ZmZlciA9IHBhcmVudEJ1ZmZlciAmJiBwYXJl
bnRCdWZmZXIuYmVnaW4odGFnTmFtZSkgfHwgRW1iZXIuUmVuZGVyQnVmZmVyKHRhZ05hbWUpOwog
ICAgdGhpcy50cmFuc2l0aW9uVG8oJ2luQnVmZmVyJywgZmFsc2UpOwoKICAgIHRoaXMuYmVmb3Jl
UmVuZGVyKGJ1ZmZlcik7CiAgICB0aGlzLnJlbmRlcihidWZmZXIpOwogICAgdGhpcy5hZnRlclJl
bmRlcihidWZmZXIpOwoKICAgIHJldHVybiBidWZmZXI7CiAgfSwKCiAgLyoqCiAgICBPdmVycmlk
ZSB0aGUgZGVmYXVsdCBldmVudCBmaXJpbmcgZnJvbSBgRW1iZXIuRXZlbnRlZGAgdG8KICAgIGFs
c28gY2FsbCBtZXRob2RzIHdpdGggdGhlIGdpdmVuIG5hbWUuCgogICAgQG1ldGhvZCB0cmlnZ2Vy
CiAgICBAcGFyYW0gbmFtZSB7U3RyaW5nfQogICAgQHByaXZhdGUKICAqLwogIHRyaWdnZXI6IGZ1
bmN0aW9uKG5hbWUpIHsKICAgIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAg
ICB2YXIgbWV0aG9kID0gdGhpc1tuYW1lXTsKICAgIGlmIChtZXRob2QpIHsKICAgICAgdmFyIGFy
Z3MgPSBbXSwgaSwgbDsKICAgICAgZm9yIChpID0gMSwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkg
PCBsOyBpKyspIHsKICAgICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKICAgICAgfQogICAg
ICByZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfQogIH0sCgogIGRlcHJlY2F0
ZWRTZW5kSGFuZGxlczogZnVuY3Rpb24oYWN0aW9uTmFtZSkgewogICAgcmV0dXJuICEhdGhpc1th
Y3Rpb25OYW1lXTsKICB9LAoKICBkZXByZWNhdGVkU2VuZDogZnVuY3Rpb24oYWN0aW9uTmFtZSkg
ewogICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICBFbWJlci5h
c3NlcnQoJycgKyB0aGlzICsgIiBoYXMgdGhlIGFjdGlvbiAiICsgYWN0aW9uTmFtZSArICIgYnV0
IGl0IGlzIG5vdCBhIGZ1bmN0aW9uIiwgdHlwZW9mIHRoaXNbYWN0aW9uTmFtZV0gPT09ICdmdW5j
dGlvbicpOwogICAgRW1iZXIuZGVwcmVjYXRlKCdBY3Rpb24gaGFuZGxlcnMgaW1wbGVtZW50ZWQg
ZGlyZWN0bHkgb24gdmlld3MgYXJlIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgYWN0aW9uIGhhbmRs
ZXJzIG9uIGFuIGBhY3Rpb25zYCBvYmplY3QgKCcgKyBhY3Rpb25OYW1lICsgJyBvbiAnICsgdGhp
cyArICcpJywgZmFsc2UpOwogICAgdGhpc1thY3Rpb25OYW1lXS5hcHBseSh0aGlzLCBhcmdzKTsK
ICAgIHJldHVybjsKICB9LAoKICBoYXM6IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHJldHVybiBFbWJl
ci50eXBlT2YodGhpc1tuYW1lXSkgPT09ICdmdW5jdGlvbicgfHwgdGhpcy5fc3VwZXIobmFtZSk7
CiAgfSwKCiAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICB2YXIgcGFyZW50ID0gdGhpcy5fcGFy
ZW50VmlldzsKCiAgICBpZiAoIXRoaXMuX3N1cGVyKCkpIHsgcmV0dXJuOyB9CgogICAgLy8gZGVz
dHJveSB0aGUgZWxlbWVudCAtLSB0aGlzIHdpbGwgYXZvaWQgZWFjaCBjaGlsZCB2aWV3IGRlc3Ry
b3lpbmcKICAgIC8vIHRoZSBlbGVtZW50IG92ZXIgYW5kIG92ZXIgYWdhaW4uLi4KICAgIGlmICgh
dGhpcy5yZW1vdmVkRnJvbURPTSkgeyB0aGlzLmRlc3Ryb3lFbGVtZW50KCk7IH0KCiAgICAvLyBy
ZW1vdmUgZnJvbSBwYXJlbnQgaWYgZm91bmQuIERvbid0IGNhbGwgcmVtb3ZlRnJvbVBhcmVudCwK
ICAgIC8vIGFzIHJlbW92ZUZyb21QYXJlbnQgd2lsbCB0cnkgdG8gcmVtb3ZlIHRoZSBlbGVtZW50
IGZyb20KICAgIC8vIHRoZSBET00gYWdhaW4uCiAgICBpZiAocGFyZW50KSB7IHBhcmVudC5yZW1v
dmVDaGlsZCh0aGlzKTsgfQoKICAgIHRoaXMudHJhbnNpdGlvblRvKCdkZXN0cm95aW5nJywgZmFs
c2UpOwoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIGNsZWFyUmVuZGVyZWRDaGlsZHJlbjogRW1i
ZXIuSywKICB0cmlnZ2VyUmVjdXJzaXZlbHk6IEVtYmVyLkssCiAgaW52b2tlUmVjdXJzaXZlbHk6
IEVtYmVyLkssCiAgdHJhbnNpdGlvblRvOiBFbWJlci5LLAogIGRlc3Ryb3lFbGVtZW50OiBFbWJl
ci5LCn0pOwoKdmFyIFZpZXdDb2xsZWN0aW9uID0gRW1iZXIuX1ZpZXdDb2xsZWN0aW9uID0gZnVu
Y3Rpb24oaW5pdGlhbFZpZXdzKSB7CiAgdmFyIHZpZXdzID0gdGhpcy52aWV3cyA9IGluaXRpYWxW
aWV3cyB8fCBbXTsKICB0aGlzLmxlbmd0aCA9IHZpZXdzLmxlbmd0aDsKfTsKClZpZXdDb2xsZWN0
aW9uLnByb3RvdHlwZSA9IHsKICBsZW5ndGg6IDAsCgogIHRyaWdnZXI6IGZ1bmN0aW9uKGV2ZW50
TmFtZSkgewogICAgdmFyIHZpZXdzID0gdGhpcy52aWV3cywgdmlldzsKICAgIGZvciAodmFyIGkg
PSAwLCBsID0gdmlld3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZpZXcgPSB2aWV3c1tp
XTsKICAgICAgaWYgKHZpZXcudHJpZ2dlcikgeyB2aWV3LnRyaWdnZXIoZXZlbnROYW1lKTsgfQog
ICAgfQogIH0sCgogIHRyaWdnZXJSZWN1cnNpdmVseTogZnVuY3Rpb24oZXZlbnROYW1lKSB7CiAg
ICB2YXIgdmlld3MgPSB0aGlzLnZpZXdzOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2aWV3cy5s
ZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmlld3NbaV0udHJpZ2dlclJlY3Vyc2l2ZWx5KGV2
ZW50TmFtZSk7CiAgICB9CiAgfSwKCiAgaW52b2tlUmVjdXJzaXZlbHk6IGZ1bmN0aW9uKGZuKSB7
CiAgICB2YXIgdmlld3MgPSB0aGlzLnZpZXdzLCB2aWV3OwoKICAgIGZvciAodmFyIGkgPSAwLCBs
ID0gdmlld3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZpZXcgPSB2aWV3c1tpXTsKICAg
ICAgZm4odmlldyk7CiAgICB9CiAgfSwKCiAgdHJhbnNpdGlvblRvOiBmdW5jdGlvbihzdGF0ZSwg
Y2hpbGRyZW4pIHsKICAgIHZhciB2aWV3cyA9IHRoaXMudmlld3M7CiAgICBmb3IgKHZhciBpID0g
MCwgbCA9IHZpZXdzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2aWV3c1tpXS50cmFuc2l0
aW9uVG8oc3RhdGUsIGNoaWxkcmVuKTsKICAgIH0KICB9LAoKICBwdXNoOiBmdW5jdGlvbigpIHsK
ICAgIHRoaXMubGVuZ3RoICs9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB2YXIgdmlld3MgPSB0aGlz
LnZpZXdzOwogICAgcmV0dXJuIHZpZXdzLnB1c2guYXBwbHkodmlld3MsIGFyZ3VtZW50cyk7CiAg
fSwKCiAgb2JqZWN0QXQ6IGZ1bmN0aW9uKGlkeCkgewogICAgcmV0dXJuIHRoaXMudmlld3NbaWR4
XTsKICB9LAoKICBmb3JFYWNoOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIHZpZXdzID0g
dGhpcy52aWV3czsKICAgIHJldHVybiBhX2ZvckVhY2godmlld3MsIGNhbGxiYWNrKTsKICB9LAoK
ICBjbGVhcjogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICB0aGlzLnZpZXdz
Lmxlbmd0aCA9IDA7CiAgfQp9OwoKdmFyIEVNUFRZX0FSUkFZID0gW107CgovKioKICBgRW1iZXIu
Vmlld2AgaXMgdGhlIGNsYXNzIGluIEVtYmVyIHJlc3BvbnNpYmxlIGZvciBlbmNhcHN1bGF0aW5n
IHRlbXBsYXRlcyBvZgogIEhUTUwgY29udGVudCwgY29tYmluaW5nIHRlbXBsYXRlcyB3aXRoIGRh
dGEgdG8gcmVuZGVyIGFzIHNlY3Rpb25zIG9mIGEgcGFnZSdzCiAgRE9NLCBhbmQgcmVnaXN0ZXJp
bmcgYW5kIHJlc3BvbmRpbmcgdG8gdXNlci1pbml0aWF0ZWQgZXZlbnRzLgoKICAjIyBIVE1MIFRh
ZwoKICBUaGUgZGVmYXVsdCBIVE1MIHRhZyBuYW1lIHVzZWQgZm9yIGEgdmlldydzIERPTSByZXBy
ZXNlbnRhdGlvbiBpcyBgZGl2YC4gVGhpcwogIGNhbiBiZSBjdXN0b21pemVkIGJ5IHNldHRpbmcg
dGhlIGB0YWdOYW1lYCBwcm9wZXJ0eS4gVGhlIGZvbGxvd2luZyB2aWV3CiAgY2xhc3M6CgogIGBg
YGphdmFzY3JpcHQKICBQYXJhZ3JhcGhWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgdGFn
TmFtZTogJ2VtJwogIH0pOwogIGBgYAoKICBXb3VsZCByZXN1bHQgaW4gaW5zdGFuY2VzIHdpdGgg
dGhlIGZvbGxvd2luZyBIVE1MOgoKICBgYGBodG1sCiAgPGVtIGlkPSJlbWJlcjEiIGNsYXNzPSJl
bWJlci12aWV3Ij48L2VtPgogIGBgYAoKICAjIyBIVE1MIGBjbGFzc2AgQXR0cmlidXRlCgogIFRo
ZSBIVE1MIGBjbGFzc2AgYXR0cmlidXRlIG9mIGEgdmlldydzIHRhZyBjYW4gYmUgc2V0IGJ5IHBy
b3ZpZGluZyBhCiAgYGNsYXNzTmFtZXNgIHByb3BlcnR5IHRoYXQgaXMgc2V0IHRvIGFuIGFycmF5
IG9mIHN0cmluZ3M6CgogIGBgYGphdmFzY3JpcHQKICBNeVZpZXcgPSBFbWJlci5WaWV3LmV4dGVu
ZCh7CiAgICBjbGFzc05hbWVzOiBbJ215LWNsYXNzJywgJ215LW90aGVyLWNsYXNzJ10KICB9KTsK
ICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJl
c2VudGF0aW9uIG9mOgoKICBgYGBodG1sCiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXIt
dmlldyBteS1jbGFzcyBteS1vdGhlci1jbGFzcyI+PC9kaXY+CiAgYGBgCgogIGBjbGFzc2AgYXR0
cmlidXRlIHZhbHVlcyBjYW4gYWxzbyBiZSBzZXQgYnkgcHJvdmlkaW5nIGEgYGNsYXNzTmFtZUJp
bmRpbmdzYAogIHByb3BlcnR5IHNldCB0byBhbiBhcnJheSBvZiBwcm9wZXJ0aWVzIG5hbWVzIGZv
ciB0aGUgdmlldy4gVGhlIHJldHVybiB2YWx1ZQogIG9mIHRoZXNlIHByb3BlcnRpZXMgd2lsbCBi
ZSBhZGRlZCBhcyBwYXJ0IG9mIHRoZSB2YWx1ZSBmb3IgdGhlIHZpZXcncyBgY2xhc3NgCiAgYXR0
cmlidXRlLiBUaGVzZSBwcm9wZXJ0aWVzIGNhbiBiZSBjb21wdXRlZCBwcm9wZXJ0aWVzOgoKICBg
YGBqYXZhc2NyaXB0CiAgTXlWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xhc3NOYW1l
QmluZGluZ3M6IFsncHJvcGVydHlBJywgJ3Byb3BlcnR5QiddLAogICAgcHJvcGVydHlBOiAnZnJv
bS1hJywKICAgIHByb3BlcnR5QjogZnVuY3Rpb24oKSB7CiAgICAgIGlmIChzb21lTG9naWMpIHsg
cmV0dXJuICdmcm9tLWInOyB9CiAgICB9LnByb3BlcnR5KCkKICB9KTsKICBgYGAKCiAgV2lsbCBy
ZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJlc2VudGF0aW9uIG9mOgoK
ICBgYGBodG1sCiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXItdmlldyBmcm9tLWEgZnJv
bS1iIj48L2Rpdj4KICBgYGAKCiAgSWYgdGhlIHZhbHVlIG9mIGEgY2xhc3MgbmFtZSBiaW5kaW5n
IHJldHVybnMgYSBib29sZWFuIHRoZSBwcm9wZXJ0eSBuYW1lCiAgaXRzZWxmIHdpbGwgYmUgdXNl
ZCBhcyB0aGUgY2xhc3MgbmFtZSBpZiB0aGUgcHJvcGVydHkgaXMgdHJ1ZS4gVGhlIGNsYXNzIG5h
bWUKICB3aWxsIG5vdCBiZSBhZGRlZCBpZiB0aGUgdmFsdWUgaXMgYGZhbHNlYCBvciBgdW5kZWZp
bmVkYC4KCiAgYGBgamF2YXNjcmlwdAogIE15VmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAg
IGNsYXNzTmFtZUJpbmRpbmdzOiBbJ2hvdmVyZWQnXSwKICAgIGhvdmVyZWQ6IHRydWUKICB9KTsK
ICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJl
c2VudGF0aW9uIG9mOgoKICBgYGBodG1sCiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXIt
dmlldyBob3ZlcmVkIj48L2Rpdj4KICBgYGAKCiAgV2hlbiB1c2luZyBib29sZWFuIGNsYXNzIG5h
bWUgYmluZGluZ3MgeW91IGNhbiBzdXBwbHkgYSBzdHJpbmcgdmFsdWUgb3RoZXIKICB0aGFuIHRo
ZSBwcm9wZXJ0eSBuYW1lIGZvciB1c2UgYXMgdGhlIGBjbGFzc2AgSFRNTCBhdHRyaWJ1dGUgYnkg
YXBwZW5kaW5nIHRoZQogIHByZWZlcnJlZCB2YWx1ZSBhZnRlciBhICI6IiBjaGFyYWN0ZXIgd2hl
biBkZWZpbmluZyB0aGUgYmluZGluZzoKCiAgYGBgamF2YXNjcmlwdAogIE15VmlldyA9IEVtYmVy
LlZpZXcuZXh0ZW5kKHsKICAgIGNsYXNzTmFtZUJpbmRpbmdzOiBbJ2F3ZXNvbWU6c28tdmVyeS1j
b29sJ10sCiAgICBhd2Vzb21lOiB0cnVlCiAgfSk7CiAgYGBgCgogIFdpbGwgcmVzdWx0IGluIHZp
ZXcgaW5zdGFuY2VzIHdpdGggYW4gSFRNTCByZXByZXNlbnRhdGlvbiBvZjoKCiAgYGBgaHRtbAog
IDxkaXYgaWQ9ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZpZXcgc28tdmVyeS1jb29sIj48L2Rpdj4K
ICBgYGAKCiAgQm9vbGVhbiB2YWx1ZSBjbGFzcyBuYW1lIGJpbmRpbmdzIHdob3NlIHByb3BlcnR5
IG5hbWVzIGFyZSBpbiBhCiAgY2FtZWxDYXNlLXN0eWxlIGZvcm1hdCB3aWxsIGJlIGNvbnZlcnRl
ZCB0byBhIGRhc2hlcml6ZWQgZm9ybWF0OgoKICBgYGBqYXZhc2NyaXB0CiAgTXlWaWV3ID0gRW1i
ZXIuVmlldy5leHRlbmQoewogICAgY2xhc3NOYW1lQmluZGluZ3M6IFsnaXNVcmdlbnQnXSwKICAg
IGlzVXJnZW50OiB0cnVlCiAgfSk7CiAgYGBgCgogIFdpbGwgcmVzdWx0IGluIHZpZXcgaW5zdGFu
Y2VzIHdpdGggYW4gSFRNTCByZXByZXNlbnRhdGlvbiBvZjoKCiAgYGBgaHRtbAogIDxkaXYgaWQ9
ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZpZXcgaXMtdXJnZW50Ij48L2Rpdj4KICBgYGAKCiAgQ2xh
c3MgbmFtZSBiaW5kaW5ncyBjYW4gYWxzbyByZWZlciB0byBvYmplY3QgdmFsdWVzIHRoYXQgYXJl
IGZvdW5kIGJ5CiAgdHJhdmVyc2luZyBhIHBhdGggcmVsYXRpdmUgdG8gdGhlIHZpZXcgaXRzZWxm
OgoKICBgYGBqYXZhc2NyaXB0CiAgTXlWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xh
c3NOYW1lQmluZGluZ3M6IFsnbWVzc2FnZXMuZW1wdHknXQogICAgbWVzc2FnZXM6IEVtYmVyLk9i
amVjdC5jcmVhdGUoewogICAgICBlbXB0eTogdHJ1ZQogICAgfSkKICB9KTsKICBgYGAKCiAgV2ls
bCByZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJlc2VudGF0aW9uIG9m
OgoKICBgYGBodG1sCiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXItdmlldyBlbXB0eSI+
PC9kaXY+CiAgYGBgCgogIElmIHlvdSB3YW50IHRvIGFkZCBhIGNsYXNzIG5hbWUgZm9yIGEgcHJv
cGVydHkgd2hpY2ggZXZhbHVhdGVzIHRvIHRydWUgYW5kCiAgYW5kIGEgZGlmZmVyZW50IGNsYXNz
IG5hbWUgaWYgaXQgZXZhbHVhdGVzIHRvIGZhbHNlLCB5b3UgY2FuIHBhc3MgYSBiaW5kaW5nCiAg
bGlrZSB0aGlzOgoKICBgYGBqYXZhc2NyaXB0CiAgLy8gQXBwbGllcyAnZW5hYmxlZCcgY2xhc3Mg
d2hlbiBpc0VuYWJsZWQgaXMgdHJ1ZSBhbmQgJ2Rpc2FibGVkJyB3aGVuIGlzRW5hYmxlZCBpcyBm
YWxzZQogIEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgIGNsYXNzTmFtZUJpbmRpbmdzOiBbJ2lzRW5h
YmxlZDplbmFibGVkOmRpc2FibGVkJ10KICAgIGlzRW5hYmxlZDogdHJ1ZQogIH0pOwogIGBgYAoK
ICBXaWxsIHJlc3VsdCBpbiB2aWV3IGluc3RhbmNlcyB3aXRoIGFuIEhUTUwgcmVwcmVzZW50YXRp
b24gb2Y6CgogIGBgYGh0bWwKICA8ZGl2IGlkPSJlbWJlcjEiIGNsYXNzPSJlbWJlci12aWV3IGVu
YWJsZWQiPjwvZGl2PgogIGBgYAoKICBXaGVuIGlzRW5hYmxlZCBpcyBgZmFsc2VgLCB0aGUgcmVz
dWx0aW5nIEhUTUwgcmVwcmVuc2VudGF0aW9uIGxvb2tzIGxpa2UKICB0aGlzOgoKICBgYGBodG1s
CiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXItdmlldyBkaXNhYmxlZCI+PC9kaXY+CiAg
YGBgCgogIFRoaXMgc3ludGF4IG9mZmVycyB0aGUgY29udmVuaWVuY2UgdG8gYWRkIGEgY2xhc3Mg
aWYgYSBwcm9wZXJ0eSBpcyBgZmFsc2VgOgoKICBgYGBqYXZhc2NyaXB0CiAgLy8gQXBwbGllcyBu
byBjbGFzcyB3aGVuIGlzRW5hYmxlZCBpcyB0cnVlIGFuZCBjbGFzcyAnZGlzYWJsZWQnIHdoZW4g
aXNFbmFibGVkIGlzIGZhbHNlCiAgRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xhc3NOYW1lQmlu
ZGluZ3M6IFsnaXNFbmFibGVkOjpkaXNhYmxlZCddCiAgICBpc0VuYWJsZWQ6IHRydWUKICB9KTsK
ICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJl
c2VudGF0aW9uIG9mOgoKICBgYGBodG1sCiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXIt
dmlldyI+PC9kaXY+CiAgYGBgCgogIFdoZW4gdGhlIGBpc0VuYWJsZWRgIHByb3BlcnR5IG9uIHRo
ZSB2aWV3IGlzIHNldCB0byBgZmFsc2VgLCBpdCB3aWxsIHJlc3VsdAogIGluIHZpZXcgaW5zdGFu
Y2VzIHdpdGggYW4gSFRNTCByZXByZXNlbnRhdGlvbiBvZjoKCiAgYGBgaHRtbAogIDxkaXYgaWQ9
ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZpZXcgZGlzYWJsZWQiPjwvZGl2PgogIGBgYAoKICBVcGRh
dGVzIHRvIHRoZSB0aGUgdmFsdWUgb2YgYSBjbGFzcyBuYW1lIGJpbmRpbmcgd2lsbCByZXN1bHQg
aW4gYXV0b21hdGljCiAgdXBkYXRlIG9mIHRoZSAgSFRNTCBgY2xhc3NgIGF0dHJpYnV0ZSBpbiB0
aGUgdmlldydzIHJlbmRlcmVkIEhUTUwKICByZXByZXNlbnRhdGlvbi4gSWYgdGhlIHZhbHVlIGJl
Y29tZXMgYGZhbHNlYCBvciBgdW5kZWZpbmVkYCB0aGUgY2xhc3MgbmFtZQogIHdpbGwgYmUgcmVt
b3ZlZC4KCiAgQm90aCBgY2xhc3NOYW1lc2AgYW5kIGBjbGFzc05hbWVCaW5kaW5nc2AgYXJlIGNv
bmNhdGVuYXRlZCBwcm9wZXJ0aWVzLiBTZWUKICBbRW1iZXIuT2JqZWN0XSgvYXBpL2NsYXNzZXMv
RW1iZXIuT2JqZWN0Lmh0bWwpIGRvY3VtZW50YXRpb24gZm9yIG1vcmUKICBpbmZvcm1hdGlvbiBh
Ym91dCBjb25jYXRlbmF0ZWQgcHJvcGVydGllcy4KCiAgIyMgSFRNTCBBdHRyaWJ1dGVzCgogIFRo
ZSBIVE1MIGF0dHJpYnV0ZSBzZWN0aW9uIG9mIGEgdmlldydzIHRhZyBjYW4gYmUgc2V0IGJ5IHBy
b3ZpZGluZyBhbgogIGBhdHRyaWJ1dGVCaW5kaW5nc2AgcHJvcGVydHkgc2V0IHRvIGFuIGFycmF5
IG9mIHByb3BlcnR5IG5hbWVzIG9uIHRoZSB2aWV3LgogIFRoZSByZXR1cm4gdmFsdWUgb2YgdGhl
c2UgcHJvcGVydGllcyB3aWxsIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mIHRoZSB2aWV3J3MKICBI
VE1MIGFzc29jaWF0ZWQgYXR0cmlidXRlOgoKICBgYGBqYXZhc2NyaXB0CiAgQW5jaG9yVmlldyA9
IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgIHRhZ05hbWU6ICdhJywKICAgIGF0dHJpYnV0ZUJpbmRp
bmdzOiBbJ2hyZWYnXSwKICAgIGhyZWY6ICdodHRwOi8vZ29vZ2xlLmNvbScKICB9KTsKICBgYGAK
CiAgV2lsbCByZXN1bHQgaW4gdmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJlc2VudGF0
aW9uIG9mOgoKICBgYGBodG1sCiAgPGEgaWQ9ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZpZXciIGhy
ZWY9Imh0dHA6Ly9nb29nbGUuY29tIj48L2E+CiAgYGBgCgogIElmIHRoZSByZXR1cm4gdmFsdWUg
b2YgYW4gYGF0dHJpYnV0ZUJpbmRpbmdzYCBtb25pdG9yZWQgcHJvcGVydHkgaXMgYSBib29sZWFu
CiAgdGhlIHByb3BlcnR5IHdpbGwgZm9sbG93IEhUTUwncyBwYXR0ZXJuIG9mIHJlcGVhdGluZyB0
aGUgYXR0cmlidXRlJ3MgbmFtZSBhcwogIGl0cyB2YWx1ZToKCiAgYGBgamF2YXNjcmlwdAogIE15
VGV4dElucHV0ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgdGFnTmFtZTogJ2lucHV0JywKICAg
IGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ2Rpc2FibGVkJ10sCiAgICBkaXNhYmxlZDogdHJ1ZQogIH0p
OwogIGBgYAoKICBXaWxsIHJlc3VsdCBpbiB2aWV3IGluc3RhbmNlcyB3aXRoIGFuIEhUTUwgcmVw
cmVzZW50YXRpb24gb2Y6CgogIGBgYGh0bWwKICA8aW5wdXQgaWQ9ImVtYmVyMSIgY2xhc3M9ImVt
YmVyLXZpZXciIGRpc2FibGVkPSJkaXNhYmxlZCIgLz4KICBgYGAKCiAgYGF0dHJpYnV0ZUJpbmRp
bmdzYCBjYW4gcmVmZXIgdG8gY29tcHV0ZWQgcHJvcGVydGllczoKCiAgYGBgamF2YXNjcmlwdAog
IE15VGV4dElucHV0ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgdGFnTmFtZTogJ2lucHV0JywK
ICAgIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ2Rpc2FibGVkJ10sCiAgICBkaXNhYmxlZDogZnVuY3Rp
b24oKSB7CiAgICAgIGlmIChzb21lTG9naWMpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg
fSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0ucHJvcGVydHkoKQog
IH0pOwogIGBgYAoKICBVcGRhdGVzIHRvIHRoZSB0aGUgcHJvcGVydHkgb2YgYW4gYXR0cmlidXRl
IGJpbmRpbmcgd2lsbCByZXN1bHQgaW4gYXV0b21hdGljCiAgdXBkYXRlIG9mIHRoZSAgSFRNTCBh
dHRyaWJ1dGUgaW4gdGhlIHZpZXcncyByZW5kZXJlZCBIVE1MIHJlcHJlc2VudGF0aW9uLgoKICBg
YXR0cmlidXRlQmluZGluZ3NgIGlzIGEgY29uY2F0ZW5hdGVkIHByb3BlcnR5LiBTZWUgW0VtYmVy
Lk9iamVjdF0oL2FwaS9jbGFzc2VzL0VtYmVyLk9iamVjdC5odG1sKQogIGRvY3VtZW50YXRpb24g
Zm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgY29uY2F0ZW5hdGVkIHByb3BlcnRpZXMuCgogICMj
IFRlbXBsYXRlcwoKICBUaGUgSFRNTCBjb250ZW50cyBvZiBhIHZpZXcncyByZW5kZXJlZCByZXBy
ZXNlbnRhdGlvbiBhcmUgZGV0ZXJtaW5lZCBieSBpdHMKICB0ZW1wbGF0ZS4gVGVtcGxhdGVzIGNh
biBiZSBhbnkgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIGFuIG9wdGlvbmFsIGNvbnRleHQKICBwYXJh
bWV0ZXIgYW5kIHJldHVybnMgYSBzdHJpbmcgb2YgSFRNTCB0aGF0IHdpbGwgYmUgaW5zZXJ0ZWQg
d2l0aGluIHRoZQogIHZpZXcncyB0YWcuIE1vc3QgdHlwaWNhbGx5IGluIEVtYmVyIHRoaXMgZnVu
Y3Rpb24gd2lsbCBiZSBhIGNvbXBpbGVkCiAgYEVtYmVyLkhhbmRsZWJhcnNgIHRlbXBsYXRlLgoK
ICBgYGBqYXZhc2NyaXB0CiAgQVZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICB0ZW1wbGF0
ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCdJIGFtIHRoZSB0ZW1wbGF0ZScpCiAgfSk7CiAg
YGBgCgogIFdpbGwgcmVzdWx0IGluIHZpZXcgaW5zdGFuY2VzIHdpdGggYW4gSFRNTCByZXByZXNl
bnRhdGlvbiBvZjoKCiAgYGBgaHRtbAogIDxkaXYgaWQ9ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZp
ZXciPkkgYW0gdGhlIHRlbXBsYXRlPC9kaXY+CiAgYGBgCgogIFdpdGhpbiBhbiBFbWJlciBhcHBs
aWNhdGlvbiBpcyBtb3JlIGNvbW1vbiB0byBkZWZpbmUgYSBIYW5kbGViYXJzIHRlbXBsYXRlcyBh
cwogIHBhcnQgb2YgYSBwYWdlOgoKICBgYGBodG1sCiAgPHNjcmlwdCB0eXBlPSd0ZXh0L3gtaGFu
ZGxlYmFycycgZGF0YS10ZW1wbGF0ZS1uYW1lPSdzb21lLXRlbXBsYXRlJz4KICAgIEhlbGxvCiAg
PC9zY3JpcHQ+CiAgYGBgCgogIEFuZCBhc3NvY2lhdGUgaXQgYnkgbmFtZSB1c2luZyBhIHZpZXcn
cyBgdGVtcGxhdGVOYW1lYCBwcm9wZXJ0eToKCiAgYGBgamF2YXNjcmlwdAogIEFWaWV3ID0gRW1i
ZXIuVmlldy5leHRlbmQoewogICAgdGVtcGxhdGVOYW1lOiAnc29tZS10ZW1wbGF0ZScKICB9KTsK
ICBgYGAKCiAgSWYgeW91IGhhdmUgbmVzdGVkIHJlc291cmNlcywgeW91ciBIYW5kbGViYXJzIHRl
bXBsYXRlIHdpbGwgbG9vayBsaWtlIHRoaXM6CgogIGBgYGh0bWwKICA8c2NyaXB0IHR5cGU9J3Rl
eHQveC1oYW5kbGViYXJzJyBkYXRhLXRlbXBsYXRlLW5hbWU9J3Bvc3RzL25ldyc+CiAgICA8aDE+
TmV3IFBvc3Q8L2gxPgogIDwvc2NyaXB0PgogIGBgYAoKICBBbmQgYHRlbXBsYXRlTmFtZWAgcHJv
cGVydHk6CgogIGBgYGphdmFzY3JpcHQKICBBVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAg
IHRlbXBsYXRlTmFtZTogJ3Bvc3RzL25ldycKICB9KTsKICBgYGAKCiAgVXNpbmcgYSB2YWx1ZSBm
b3IgYHRlbXBsYXRlTmFtZWAgdGhhdCBkb2VzIG5vdCBoYXZlIGEgSGFuZGxlYmFycyB0ZW1wbGF0
ZQogIHdpdGggYSBtYXRjaGluZyBgZGF0YS10ZW1wbGF0ZS1uYW1lYCBhdHRyaWJ1dGUgd2lsbCB0
aHJvdyBhbiBlcnJvci4KCiAgRm9yIHZpZXdzIGNsYXNzZXMgdGhhdCBtYXkgaGF2ZSBhIHRlbXBs
YXRlIGxhdGVyIGRlZmluZWQgKGUuZy4gYXMgdGhlIGJsb2NrCiAgcG9ydGlvbiBvZiBhIGB7e3Zp
ZXd9fWAgSGFuZGxlYmFycyBoZWxwZXIgY2FsbCBpbiBhbm90aGVyIHRlbXBsYXRlIG9yIGluCiAg
YSBzdWJjbGFzcyksIHlvdSBjYW4gcHJvdmlkZSBhIGBkZWZhdWx0VGVtcGxhdGVgIHByb3BlcnR5
IHNldCB0byBjb21waWxlZAogIHRlbXBsYXRlIGZ1bmN0aW9uLiBJZiBhIHRlbXBsYXRlIGlzIG5v
dCBsYXRlciBwcm92aWRlZCBmb3IgdGhlIHZpZXcgaW5zdGFuY2UKICB0aGUgYGRlZmF1bHRUZW1w
bGF0ZWAgdmFsdWUgd2lsbCBiZSB1c2VkOgoKICBgYGBqYXZhc2NyaXB0CiAgQVZpZXcgPSBFbWJl
ci5WaWV3LmV4dGVuZCh7CiAgICBkZWZhdWx0VGVtcGxhdGU6IEVtYmVyLkhhbmRsZWJhcnMuY29t
cGlsZSgnSSB3YXMgdGhlIGRlZmF1bHQnKSwKICAgIHRlbXBsYXRlOiBudWxsLAogICAgdGVtcGxh
dGVOYW1lOiBudWxsCiAgfSk7CiAgYGBgCgogIFdpbGwgcmVzdWx0IGluIGluc3RhbmNlcyB3aXRo
IGFuIEhUTUwgcmVwcmVzZW50YXRpb24gb2Y6CgogIGBgYGh0bWwKICA8ZGl2IGlkPSJlbWJlcjEi
IGNsYXNzPSJlbWJlci12aWV3Ij5JIHdhcyB0aGUgZGVmYXVsdDwvZGl2PgogIGBgYAoKICBJZiBh
IGB0ZW1wbGF0ZWAgb3IgYHRlbXBsYXRlTmFtZWAgaXMgcHJvdmlkZWQgaXQgd2lsbCB0YWtlIHBy
ZWNlZGVuY2Ugb3ZlcgogIGBkZWZhdWx0VGVtcGxhdGVgOgoKICBgYGBqYXZhc2NyaXB0CiAgQVZp
ZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICBkZWZhdWx0VGVtcGxhdGU6IEVtYmVyLkhhbmRs
ZWJhcnMuY29tcGlsZSgnSSB3YXMgdGhlIGRlZmF1bHQnKQogIH0pOwoKICBhVmlldyA9IEFWaWV3
LmNyZWF0ZSh7CiAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCdJIHdhcyB0
aGUgdGVtcGxhdGUsIG5vdCBkZWZhdWx0JykKICB9KTsKICBgYGAKCiAgV2lsbCByZXN1bHQgaW4g
dGhlIGZvbGxvd2luZyBIVE1MIHJlcHJlc2VudGF0aW9uIHdoZW4gcmVuZGVyZWQ6CgogIGBgYGh0
bWwKICA8ZGl2IGlkPSJlbWJlcjEiIGNsYXNzPSJlbWJlci12aWV3Ij5JIHdhcyB0aGUgdGVtcGxh
dGUsIG5vdCBkZWZhdWx0PC9kaXY+CiAgYGBgCgogICMjIFZpZXcgQ29udGV4dAoKICBUaGUgZGVm
YXVsdCBjb250ZXh0IG9mIHRoZSBjb21waWxlZCB0ZW1wbGF0ZSBpcyB0aGUgdmlldydzIGNvbnRy
b2xsZXI6CgogIGBgYGphdmFzY3JpcHQKICBBVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAg
IHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoJ0hlbGxvIHt7ZXhjaXRlZEdyZWV0
aW5nfX0nKQogIH0pOwoKICBhQ29udHJvbGxlciA9IEVtYmVyLk9iamVjdC5jcmVhdGUoewogICAg
Zmlyc3ROYW1lOiAnQmFycnknLAogICAgZXhjaXRlZEdyZWV0aW5nOiBmdW5jdGlvbigpIHsKICAg
ICAgcmV0dXJuIHRoaXMuZ2V0KCJjb250ZW50LmZpcnN0TmFtZSIpICsgIiEhISIKICAgIH0ucHJv
cGVydHkoKQogIH0pOwoKICBhVmlldyA9IEFWaWV3LmNyZWF0ZSh7CiAgICBjb250cm9sbGVyOiBh
Q29udHJvbGxlciwKICB9KTsKICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gYW4gSFRNTCByZXByZXNl
bnRhdGlvbiBvZjoKCiAgYGBgaHRtbAogIDxkaXYgaWQ9ImVtYmVyMSIgY2xhc3M9ImVtYmVyLXZp
ZXciPkhlbGxvIEJhcnJ5ISEhPC9kaXY+CiAgYGBgCgogIEEgY29udGV4dCBjYW4gYWxzbyBiZSBl
eHBsaWNpdGx5IHN1cHBsaWVkIHRocm91Z2ggdGhlIHZpZXcncyBgY29udGV4dGAKICBwcm9wZXJ0
eS4gSWYgdGhlIHZpZXcgaGFzIG5laXRoZXIgYGNvbnRleHRgIG5vciBgY29udHJvbGxlcmAgcHJv
cGVydGllcywgdGhlCiAgYHBhcmVudFZpZXdgJ3MgY29udGV4dCB3aWxsIGJlIHVzZWQuCgogICMj
IExheW91dHMKCiAgVmlld3MgY2FuIGhhdmUgYSBzZWNvbmRhcnkgdGVtcGxhdGUgdGhhdCB3cmFw
cyB0aGVpciBtYWluIHRlbXBsYXRlLiBMaWtlCiAgcHJpbWFyeSB0ZW1wbGF0ZXMsIGxheW91dHMg
Y2FuIGJlIGFueSBmdW5jdGlvbiB0aGF0ICBhY2NlcHRzIGFuIG9wdGlvbmFsCiAgY29udGV4dCBw
YXJhbWV0ZXIgYW5kIHJldHVybnMgYSBzdHJpbmcgb2YgSFRNTCB0aGF0IHdpbGwgYmUgaW5zZXJ0
ZWQgaW5zaWRlCiAgdmlldydzIHRhZy4gVmlld3Mgd2hvc2UgSFRNTCBlbGVtZW50IGlzIHNlbGYg
Y2xvc2luZyAoZS5nLiBgPGlucHV0IC8+YCkKICBjYW5ub3QgaGF2ZSBhIGxheW91dCBhbmQgdGhp
cyBwcm9wZXJ0eSB3aWxsIGJlIGlnbm9yZWQuCgogIE1vc3QgdHlwaWNhbGx5IGluIEVtYmVyIGEg
bGF5b3V0IHdpbGwgYmUgYSBjb21waWxlZCBgRW1iZXIuSGFuZGxlYmFyc2AKICB0ZW1wbGF0ZS4K
CiAgQSB2aWV3J3MgbGF5b3V0IGNhbiBiZSBzZXQgZGlyZWN0bHkgd2l0aCB0aGUgYGxheW91dGAg
cHJvcGVydHkgb3IgcmVmZXJlbmNlCiAgYW4gZXhpc3RpbmcgSGFuZGxlYmFycyB0ZW1wbGF0ZSBi
eSBuYW1lIHdpdGggdGhlIGBsYXlvdXROYW1lYCBwcm9wZXJ0eS4KCiAgQSB0ZW1wbGF0ZSB1c2Vk
IGFzIGEgbGF5b3V0IG11c3QgY29udGFpbiBhIHNpbmdsZSB1c2Ugb2YgdGhlIEhhbmRsZWJhcnMK
ICBge3t5aWVsZH19YCBoZWxwZXIuIFRoZSBIVE1MIGNvbnRlbnRzIG9mIGEgdmlldydzIHJlbmRl
cmVkIGB0ZW1wbGF0ZWAgd2lsbCBiZQogIGluc2VydGVkIGF0IHRoaXMgbG9jYXRpb246CgogIGBg
YGphdmFzY3JpcHQKICBBVmlld1dpdGhMYXlvdXQgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICBs
YXlvdXQ6IEVtYmVyLkhhbmRsZWJhcnMuY29tcGlsZSgiPGRpdiBjbGFzcz0nbXktZGVjb3JhdGl2
ZS1jbGFzcyc+e3t5aWVsZH19PC9kaXY+IikKICAgIHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJz
LmNvbXBpbGUoIkkgZ290IHdyYXBwZWQiKSwKICB9KTsKICBgYGAKCiAgV2lsbCByZXN1bHQgaW4g
dmlldyBpbnN0YW5jZXMgd2l0aCBhbiBIVE1MIHJlcHJlc2VudGF0aW9uIG9mOgoKICBgYGBodG1s
CiAgPGRpdiBpZD0iZW1iZXIxIiBjbGFzcz0iZW1iZXItdmlldyI+CiAgICA8ZGl2IGNsYXNzPSJt
eS1kZWNvcmF0aXZlLWNsYXNzIj4KICAgICAgSSBnb3Qgd3JhcHBlZAogICAgPC9kaXY+CiAgPC9k
aXY+CiAgYGBgCgogIFNlZSBbRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLnlpZWxkXSgvYXBpL2Ns
YXNzZXMvRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLmh0bWwjbWV0aG9kX3lpZWxkKQogIGZvciBt
b3JlIGluZm9ybWF0aW9uLgoKICAjIyBSZXNwb25kaW5nIHRvIEJyb3dzZXIgRXZlbnRzCgogIFZp
ZXdzIGNhbiByZXNwb25kIHRvIHVzZXItaW5pdGlhdGVkIGV2ZW50cyBpbiBvbmUgb2YgdGhyZWUg
d2F5czogbWV0aG9kCiAgaW1wbGVtZW50YXRpb24sIHRocm91Z2ggYW4gZXZlbnQgbWFuYWdlciwg
YW5kIHRocm91Z2ggYHt7YWN0aW9ufX1gIGhlbHBlciB1c2UKICBpbiB0aGVpciB0ZW1wbGF0ZSBv
ciBsYXlvdXQuCgogICMjIyBNZXRob2QgSW1wbGVtZW50YXRpb24KCiAgVmlld3MgY2FuIHJlc3Bv
bmQgdG8gdXNlci1pbml0aWF0ZWQgZXZlbnRzIGJ5IGltcGxlbWVudGluZyBhIG1ldGhvZCB0aGF0
CiAgbWF0Y2hlcyB0aGUgZXZlbnQgbmFtZS4gQSBgalF1ZXJ5LkV2ZW50YCBvYmplY3Qgd2lsbCBi
ZSBwYXNzZWQgYXMgdGhlCiAgYXJndW1lbnQgdG8gdGhpcyBtZXRob2QuCgogIGBgYGphdmFzY3Jp
cHQKICBBVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgIGNsaWNrOiBmdW5jdGlvbihldmVu
dCkgewogICAgICAvLyB3aWxsIGJlIGNhbGxlZCB3aGVuIHdoZW4gYW4gaW5zdGFuY2UncwogICAg
ICAvLyByZW5kZXJlZCBlbGVtZW50IGlzIGNsaWNrZWQKICAgIH0KICB9KTsKICBgYGAKCiAgIyMj
IEV2ZW50IE1hbmFnZXJzCgogIFZpZXdzIGNhbiBkZWZpbmUgYW4gb2JqZWN0IGFzIHRoZWlyIGBl
dmVudE1hbmFnZXJgIHByb3BlcnR5LiBUaGlzIG9iamVjdCBjYW4KICB0aGVuIGltcGxlbWVudCBt
ZXRob2RzIHRoYXQgbWF0Y2ggdGhlIGRlc2lyZWQgZXZlbnQgbmFtZXMuIE1hdGNoaW5nIGV2ZW50
cwogIHRoYXQgb2NjdXIgb24gdGhlIHZpZXcncyByZW5kZXJlZCBIVE1MIG9yIHRoZSByZW5kZXJl
ZCBIVE1MIG9mIGFueSBvZiBpdHMgRE9NCiAgZGVzY2VuZGFudHMgd2lsbCB0cmlnZ2VyIHRoaXMg
bWV0aG9kLiBBIGBqUXVlcnkuRXZlbnRgIG9iamVjdCB3aWxsIGJlIHBhc3NlZAogIGFzIHRoZSBm
aXJzdCBhcmd1bWVudCB0byB0aGUgbWV0aG9kIGFuZCBhbiAgYEVtYmVyLlZpZXdgIG9iamVjdCBh
cyB0aGUKICBzZWNvbmQuIFRoZSBgRW1iZXIuVmlld2Agd2lsbCBiZSB0aGUgdmlldyB3aG9zZSBy
ZW5kZXJlZCBIVE1MIHdhcyBpbnRlcmFjdGVkCiAgd2l0aC4gVGhpcyBtYXkgYmUgdGhlIHZpZXcg
d2l0aCB0aGUgYGV2ZW50TWFuYWdlcmAgcHJvcGVydHkgb3Igb25lIG9mIGl0cwogIGRlc2NlbmRl
bnQgdmlld3MuCgogIGBgYGphdmFzY3JpcHQKICBBVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsK
ICAgIGV2ZW50TWFuYWdlcjogRW1iZXIuT2JqZWN0LmNyZWF0ZSh7CiAgICAgIGRvdWJsZUNsaWNr
OiBmdW5jdGlvbihldmVudCwgdmlldykgewogICAgICAgIC8vIHdpbGwgYmUgY2FsbGVkIHdoZW4g
d2hlbiBhbiBpbnN0YW5jZSdzCiAgICAgICAgLy8gcmVuZGVyZWQgZWxlbWVudCBvciBhbnkgcmVu
ZGVyaW5nCiAgICAgICAgLy8gb2YgdGhpcyB2aWV3cydzIGRlc2NlbmRlbnQKICAgICAgICAvLyBl
bGVtZW50cyBpcyBjbGlja2VkCiAgICAgIH0KICAgIH0pCiAgfSk7CiAgYGBgCgogIEFuIGV2ZW50
IGRlZmluZWQgZm9yIGFuIGV2ZW50IG1hbmFnZXIgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGV2ZW50
cyBvZiB0aGUKICBzYW1lIG5hbWUgaGFuZGxlZCB0aHJvdWdoIG1ldGhvZHMgb24gdGhlIHZpZXcu
CgogIGBgYGphdmFzY3JpcHQKICBBVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgIG1vdXNl
RW50ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIC8vIHdpbGwgbmV2ZXIgdHJpZ2dlci4KICAg
IH0sCiAgICBldmVudE1hbmFnZXI6IEVtYmVyLk9iamVjdC5jcmVhdGUoewogICAgICBtb3VzZUVu
dGVyOiBmdW5jdGlvbihldmVudCwgdmlldykgewogICAgICAgIC8vIHRha2VzIHByZWNlZGVuY2Ug
b3ZlciBBVmlldyNtb3VzZUVudGVyCiAgICAgIH0KICAgIH0pCiAgfSk7CiAgYGBgCgogIFNpbWls
YXJseSBhIHZpZXcncyBldmVudCBtYW5hZ2VyIHdpbGwgdGFrZSBwcmVjZWRlbmNlIGZvciBldmVu
dHMgb2YgYW55IHZpZXdzCiAgcmVuZGVyZWQgYXMgYSBkZXNjZW5kZW50LiBBIG1ldGhvZCBuYW1l
IHRoYXQgbWF0Y2hlcyBhbiBldmVudCBuYW1lIHdpbGwgbm90CiAgYmUgY2FsbGVkIGlmIHRoZSB2
aWV3IGluc3RhbmNlIHdhcyByZW5kZXJlZCBpbnNpZGUgdGhlIEhUTUwgcmVwcmVzZW50YXRpb24g
b2YKICBhIHZpZXcgdGhhdCBoYXMgYW4gYGV2ZW50TWFuYWdlcmAgcHJvcGVydHkgZGVmaW5lZCB0
aGF0IGhhbmRsZXMgZXZlbnRzIG9mIHRoZQogIG5hbWUuIEV2ZW50cyBub3QgaGFuZGxlZCBieSB0
aGUgZXZlbnQgbWFuYWdlciB3aWxsIHN0aWxsIHRyaWdnZXIgbWV0aG9kIGNhbGxzCiAgb24gdGhl
IGRlc2NlbmRlbnQuCgogIGBgYGphdmFzY3JpcHQKICBPdXRlclZpZXcgPSBFbWJlci5WaWV3LmV4
dGVuZCh7CiAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCJvdXRlciB7eyN2
aWV3IElubmVyVmlld319aW5uZXJ7ey92aWV3fX0gb3V0ZXIiKSwKICAgIGV2ZW50TWFuYWdlcjog
RW1iZXIuT2JqZWN0LmNyZWF0ZSh7CiAgICAgIG1vdXNlRW50ZXI6IGZ1bmN0aW9uKGV2ZW50LCB2
aWV3KSB7CiAgICAgICAgLy8gdmlldyBtaWdodCBiZSBpbnN0YW5jZSBvZiBlaXRoZXIKICAgICAg
ICAvLyBPdXRlclZpZXcgb3IgSW5uZXJWaWV3IGRlcGVuZGluZyBvbgogICAgICAgIC8vIHdoZXJl
IG9uIHRoZSBwYWdlIHRoZSB1c2VyIGludGVyYWN0aW9uIG9jY3VyZWQKICAgICAgfQogICAgfSkK
ICB9KTsKCiAgSW5uZXJWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xpY2s6IGZ1bmN0
aW9uKGV2ZW50KSB7CiAgICAgIC8vIHdpbGwgYmUgY2FsbGVkIGlmIHJlbmRlcmVkIGluc2lkZQog
ICAgICAvLyBhbiBPdXRlclZpZXcgYmVjYXVzZSBPdXRlclZpZXcncwogICAgICAvLyBldmVudE1h
bmFnZXIgZG9lc24ndCBoYW5kbGUgY2xpY2sgZXZlbnRzCiAgICB9LAogICAgbW91c2VFbnRlcjog
ZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgLy8gd2lsbCBuZXZlciBiZSBjYWxsZWQgaWYgcmVuZGVy
ZWQgaW5zaWRlCiAgICAgIC8vIGFuIE91dGVyVmlldy4KICAgIH0KICB9KTsKICBgYGAKCiAgIyMj
IEhhbmRsZWJhcnMgYHt7YWN0aW9ufX1gIEhlbHBlcgoKICBTZWUgW0hhbmRsZWJhcnMuaGVscGVy
cy5hY3Rpb25dKC9hcGkvY2xhc3Nlcy9FbWJlci5IYW5kbGViYXJzLmhlbHBlcnMuaHRtbCNtZXRo
b2RfYWN0aW9uKS4KCiAgIyMjIEV2ZW50IE5hbWVzCgogIEFsbCBvZiB0aGUgZXZlbnQgaGFuZGxp
bmcgYXBwcm9hY2hlcyBkZXNjcmliZWQgYWJvdmUgcmVzcG9uZCB0byB0aGUgc2FtZSBzZXQKICBv
ZiBldmVudHMuIFRoZSBuYW1lcyBvZiB0aGUgYnVpbHQtaW4gZXZlbnRzIGFyZSBsaXN0ZWQgYmVs
b3cuIChUaGUgaGFzaCBvZgogIGJ1aWx0LWluIGV2ZW50cyBleGlzdHMgaW4gYEVtYmVyLkV2ZW50
RGlzcGF0Y2hlcmAuKSBBZGRpdGlvbmFsLCBjdXN0b20gZXZlbnRzCiAgY2FuIGJlIHJlZ2lzdGVy
ZWQgYnkgdXNpbmcgYEVtYmVyLkFwcGxpY2F0aW9uLmN1c3RvbUV2ZW50c2AuCgogIFRvdWNoIGV2
ZW50czoKCiAgKiBgdG91Y2hTdGFydGAKICAqIGB0b3VjaE1vdmVgCiAgKiBgdG91Y2hFbmRgCiAg
KiBgdG91Y2hDYW5jZWxgCgogIEtleWJvYXJkIGV2ZW50cwoKICAqIGBrZXlEb3duYAogICogYGtl
eVVwYAogICogYGtleVByZXNzYAoKICBNb3VzZSBldmVudHMKCiAgKiBgbW91c2VEb3duYAogICog
YG1vdXNlVXBgCiAgKiBgY29udGV4dE1lbnVgCiAgKiBgY2xpY2tgCiAgKiBgZG91YmxlQ2xpY2tg
CiAgKiBgbW91c2VNb3ZlYAogICogYGZvY3VzSW5gCiAgKiBgZm9jdXNPdXRgCiAgKiBgbW91c2VF
bnRlcmAKICAqIGBtb3VzZUxlYXZlYAoKICBGb3JtIGV2ZW50czoKCiAgKiBgc3VibWl0YAogICog
YGNoYW5nZWAKICAqIGBmb2N1c0luYAogICogYGZvY3VzT3V0YAogICogYGlucHV0YAoKICBIVE1M
NSBkcmFnIGFuZCBkcm9wIGV2ZW50czoKCiAgKiBgZHJhZ1N0YXJ0YAogICogYGRyYWdgCiAgKiBg
ZHJhZ0VudGVyYAogICogYGRyYWdMZWF2ZWAKICAqIGBkcm9wYAogICogYGRyYWdFbmRgCgogICMj
IEhhbmRsZWJhcnMgYHt7dmlld319YCBIZWxwZXIKCiAgT3RoZXIgYEVtYmVyLlZpZXdgIGluc3Rh
bmNlcyBjYW4gYmUgaW5jbHVkZWQgYXMgcGFydCBvZiBhIHZpZXcncyB0ZW1wbGF0ZSBieQogIHVz
aW5nIHRoZSBge3t2aWV3fX1gIEhhbmRsZWJhcnMgaGVscGVyLiBTZWUgW0VtYmVyLkhhbmRsZWJh
cnMuaGVscGVycy52aWV3XSgvYXBpL2NsYXNzZXMvRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLmh0
bWwjbWV0aG9kX3ZpZXcpCiAgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24uCgogIEBjbGFzcyBW
aWV3CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLkNvcmVWaWV3CiovCkVtYmVy
LlZpZXcgPSBFbWJlci5Db3JlVmlldy5leHRlbmQoewoKICBjb25jYXRlbmF0ZWRQcm9wZXJ0aWVz
OiBbJ2NsYXNzTmFtZXMnLCAnY2xhc3NOYW1lQmluZGluZ3MnLCAnYXR0cmlidXRlQmluZGluZ3Mn
XSwKCiAgLyoqCiAgICBAcHJvcGVydHkgaXNWaWV3CiAgICBAdHlwZSBCb29sZWFuCiAgICBAZGVm
YXVsdCB0cnVlCiAgICBAc3RhdGljCiAgKi8KICBpc1ZpZXc6IHRydWUsCgogIC8vIC4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyBU
RU1QTEFURSBTVVBQT1JUCiAgLy8KCiAgLyoqCiAgICBUaGUgbmFtZSBvZiB0aGUgdGVtcGxhdGUg
dG8gbG9va3VwIGlmIG5vIHRlbXBsYXRlIGlzIHByb3ZpZGVkLgoKICAgIEJ5IGRlZmF1bHQgYEVt
YmVyLlZpZXdgIHdpbGwgbG9va3VwIGEgdGVtcGxhdGUgd2l0aCB0aGlzIG5hbWUgaW4KICAgIGBF
bWJlci5URU1QTEFURVNgIChhIHNoYXJlZCBnbG9iYWwgb2JqZWN0KS4KCiAgICBAcHJvcGVydHkg
dGVtcGxhdGVOYW1lCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIHRl
bXBsYXRlTmFtZTogbnVsbCwKCiAgLyoqCiAgICBUaGUgbmFtZSBvZiB0aGUgbGF5b3V0IHRvIGxv
b2t1cCBpZiBubyBsYXlvdXQgaXMgcHJvdmlkZWQuCgogICAgQnkgZGVmYXVsdCBgRW1iZXIuVmll
d2Agd2lsbCBsb29rdXAgYSB0ZW1wbGF0ZSB3aXRoIHRoaXMgbmFtZSBpbgogICAgYEVtYmVyLlRF
TVBMQVRFU2AgKGEgc2hhcmVkIGdsb2JhbCBvYmplY3QpLgoKICAgIEBwcm9wZXJ0eSBsYXlvdXRO
YW1lCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIGxheW91dE5hbWU6
IG51bGwsCgogIC8qKgogICAgVGhlIHRlbXBsYXRlIHVzZWQgdG8gcmVuZGVyIHRoZSB2aWV3LiBU
aGlzIHNob3VsZCBiZSBhIGZ1bmN0aW9uIHRoYXQKICAgIGFjY2VwdHMgYW4gb3B0aW9uYWwgY29u
dGV4dCBwYXJhbWV0ZXIgYW5kIHJldHVybnMgYSBzdHJpbmcgb2YgSFRNTCB0aGF0CiAgICB3aWxs
IGJlIGluc2VydGVkIGludG8gdGhlIERPTSByZWxhdGl2ZSB0byBpdHMgcGFyZW50IHZpZXcuCgog
ICAgSW4gZ2VuZXJhbCwgeW91IHNob3VsZCBzZXQgdGhlIGB0ZW1wbGF0ZU5hbWVgIHByb3BlcnR5
IGluc3RlYWQgb2Ygc2V0dGluZwogICAgdGhlIHRlbXBsYXRlIHlvdXJzZWxmLgoKICAgIEBwcm9w
ZXJ0eSB0ZW1wbGF0ZQogICAgQHR5cGUgRnVuY3Rpb24KICAqLwogIHRlbXBsYXRlOiBFbWJlci5j
b21wdXRlZChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5l
ZCkgeyByZXR1cm4gdmFsdWU7IH0KCiAgICB2YXIgdGVtcGxhdGVOYW1lID0gZ2V0KHRoaXMsICd0
ZW1wbGF0ZU5hbWUnKSwKICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGVGb3JOYW1lKHRl
bXBsYXRlTmFtZSwgJ3RlbXBsYXRlJyk7CgogICAgRW1iZXIuYXNzZXJ0KCJZb3Ugc3BlY2lmaWVk
IHRoZSB0ZW1wbGF0ZU5hbWUgIiArIHRlbXBsYXRlTmFtZSArICIgZm9yICIgKyB0aGlzICsgIiwg
YnV0IGl0IGRpZCBub3QgZXhpc3QuIiwgIXRlbXBsYXRlTmFtZSB8fCB0ZW1wbGF0ZSk7CgogICAg
cmV0dXJuIHRlbXBsYXRlIHx8IGdldCh0aGlzLCAnZGVmYXVsdFRlbXBsYXRlJyk7CiAgfSkucHJv
cGVydHkoJ3RlbXBsYXRlTmFtZScpLAoKICAvKioKICAgIFRoZSBjb250cm9sbGVyIG1hbmFnaW5n
IHRoaXMgdmlldy4gSWYgdGhpcyBwcm9wZXJ0eSBpcyBzZXQsIGl0IHdpbGwgYmUKICAgIG1hZGUg
YXZhaWxhYmxlIGZvciB1c2UgYnkgdGhlIHRlbXBsYXRlLgoKICAgIEBwcm9wZXJ0eSBjb250cm9s
bGVyCiAgICBAdHlwZSBPYmplY3QKICAqLwogIGNvbnRyb2xsZXI6IEVtYmVyLmNvbXB1dGVkKGZ1
bmN0aW9uKGtleSkgewogICAgdmFyIHBhcmVudFZpZXcgPSBnZXQodGhpcywgJ19wYXJlbnRWaWV3
Jyk7CiAgICByZXR1cm4gcGFyZW50VmlldyA/IGdldChwYXJlbnRWaWV3LCAnY29udHJvbGxlcicp
IDogbnVsbDsKICB9KS5wcm9wZXJ0eSgnX3BhcmVudFZpZXcnKSwKCiAgLyoqCiAgICBBIHZpZXcg
bWF5IGNvbnRhaW4gYSBsYXlvdXQuIEEgbGF5b3V0IGlzIGEgcmVndWxhciB0ZW1wbGF0ZSBidXQK
ICAgIHN1cGVyc2VkZXMgdGhlIGB0ZW1wbGF0ZWAgcHJvcGVydHkgZHVyaW5nIHJlbmRlcmluZy4g
SXQgaXMgdGhlCiAgICByZXNwb25zaWJpbGl0eSBvZiB0aGUgbGF5b3V0IHRlbXBsYXRlIHRvIHJl
dHJpZXZlIHRoZSBgdGVtcGxhdGVgCiAgICBwcm9wZXJ0eSBmcm9tIHRoZSB2aWV3IChvciBhbHRl
cm5hdGl2ZWx5LCBjYWxsIGBIYW5kbGViYXJzLmhlbHBlcnMueWllbGRgLAogICAgYHt7eWllbGR9
fWApIHRvIHJlbmRlciBpdCBpbiB0aGUgY29ycmVjdCBsb2NhdGlvbi4KCiAgICBUaGlzIGlzIHVz
ZWZ1bCBmb3IgYSB2aWV3IHRoYXQgaGFzIGEgc2hhcmVkIHdyYXBwZXIsIGJ1dCB3aGljaCBkZWxl
Z2F0ZXMKICAgIHRoZSByZW5kZXJpbmcgb2YgdGhlIGNvbnRlbnRzIG9mIHRoZSB3cmFwcGVyIHRv
IHRoZSBgdGVtcGxhdGVgIHByb3BlcnR5CiAgICBvbiBhIHN1YmNsYXNzLgoKICAgIEBwcm9wZXJ0
eSBsYXlvdXQKICAgIEB0eXBlIEZ1bmN0aW9uCiAgKi8KICBsYXlvdXQ6IEVtYmVyLmNvbXB1dGVk
KGZ1bmN0aW9uKGtleSkgewogICAgdmFyIGxheW91dE5hbWUgPSBnZXQodGhpcywgJ2xheW91dE5h
bWUnKSwKICAgICAgICBsYXlvdXQgPSB0aGlzLnRlbXBsYXRlRm9yTmFtZShsYXlvdXROYW1lLCAn
bGF5b3V0Jyk7CgogICAgRW1iZXIuYXNzZXJ0KCJZb3Ugc3BlY2lmaWVkIHRoZSBsYXlvdXROYW1l
ICIgKyBsYXlvdXROYW1lICsgIiBmb3IgIiArIHRoaXMgKyAiLCBidXQgaXQgZGlkIG5vdCBleGlz
dC4iLCAhbGF5b3V0TmFtZSB8fCBsYXlvdXQpOwoKICAgIHJldHVybiBsYXlvdXQgfHwgZ2V0KHRo
aXMsICdkZWZhdWx0TGF5b3V0Jyk7CiAgfSkucHJvcGVydHkoJ2xheW91dE5hbWUnKSwKCiAgX3lp
ZWxkOiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAgICB2YXIgdGVtcGxhdGUgPSBnZXQo
dGhpcywgJ3RlbXBsYXRlJyk7CiAgICBpZiAodGVtcGxhdGUpIHsgdGVtcGxhdGUoY29udGV4dCwg
b3B0aW9ucyk7IH0KICB9LAoKICB0ZW1wbGF0ZUZvck5hbWU6IGZ1bmN0aW9uKG5hbWUsIHR5cGUp
IHsKICAgIGlmICghbmFtZSkgeyByZXR1cm47IH0KICAgIEVtYmVyLmFzc2VydCgidGVtcGxhdGVO
YW1lcyBhcmUgbm90IGFsbG93ZWQgdG8gY29udGFpbiBwZXJpb2RzOiAiK25hbWUsIG5hbWUuaW5k
ZXhPZignLicpID09PSAtMSk7CgogICAgLy8gdGhlIGRlZmF1bHRDb250YWluZXIgaXMgZGVwcmVj
YXRlZAogICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyIHx8IChFbWJlci5Db250YWlu
ZXIgJiYgRW1iZXIuQ29udGFpbmVyLmRlZmF1bHRDb250YWluZXIpOwogICAgcmV0dXJuIGNvbnRh
aW5lciAmJiBjb250YWluZXIubG9va3VwKCd0ZW1wbGF0ZTonICsgbmFtZSk7CiAgfSwKCiAgLyoq
CiAgICBUaGUgb2JqZWN0IGZyb20gd2hpY2ggdGVtcGxhdGVzIHNob3VsZCBhY2Nlc3MgcHJvcGVy
dGllcy4KCiAgICBUaGlzIG9iamVjdCB3aWxsIGJlIHBhc3NlZCB0byB0aGUgdGVtcGxhdGUgZnVu
Y3Rpb24gZWFjaCB0aW1lIHRoZSByZW5kZXIKICAgIG1ldGhvZCBpcyBjYWxsZWQsIGJ1dCBpdCBp
cyB1cCB0byB0aGUgaW5kaXZpZHVhbCBmdW5jdGlvbiB0byBkZWNpZGUgd2hhdAogICAgdG8gZG8g
d2l0aCBpdC4KCiAgICBCeSBkZWZhdWx0LCB0aGlzIHdpbGwgYmUgdGhlIHZpZXcncyBjb250cm9s
bGVyLgoKICAgIEBwcm9wZXJ0eSBjb250ZXh0CiAgICBAdHlwZSBPYmplY3QKICAqLwogIGNvbnRl
eHQ6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVu
dHMubGVuZ3RoID09PSAyKSB7CiAgICAgIHNldCh0aGlzLCAnX2NvbnRleHQnLCB2YWx1ZSk7CiAg
ICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBnZXQodGhpcywgJ19j
b250ZXh0Jyk7CiAgICB9CiAgfSkudm9sYXRpbGUoKSwKCiAgLyoqCiAgICBQcml2YXRlIGNvcHkg
b2YgdGhlIHZpZXcncyB0ZW1wbGF0ZSBjb250ZXh0LiBUaGlzIGNhbiBiZSBzZXQgZGlyZWN0bHkK
ICAgIGJ5IEhhbmRsZWJhcnMgd2l0aG91dCB0cmlnZ2VyaW5nIHRoZSBvYnNlcnZlciB0aGF0IGNh
dXNlcyB0aGUgdmlldwogICAgdG8gYmUgcmUtcmVuZGVyZWQuCgogICAgVGhlIGNvbnRleHQgb2Yg
YSB2aWV3IGlzIGxvb2tlZCB1cCBhcyBmb2xsb3dzOgoKICAgIDEuIFN1cHBsaWVkIGNvbnRleHQg
KHVzdWFsbHkgYnkgSGFuZGxlYmFycykKICAgIDIuIFNwZWNpZmllZCBjb250cm9sbGVyCiAgICAz
LiBgcGFyZW50Vmlld2AncyBjb250ZXh0IChmb3IgYSBjaGlsZCBvZiBhIENvbnRhaW5lclZpZXcp
CgogICAgVGhlIGNvZGUgaW4gSGFuZGxlYmFycyB0aGF0IG92ZXJyaWRlcyB0aGUgYF9jb250ZXh0
YCBwcm9wZXJ0eSBmaXJzdAogICAgY2hlY2tzIHRvIHNlZSB3aGV0aGVyIHRoZSB2aWV3IGhhcyBh
IHNwZWNpZmllZCBjb250cm9sbGVyLiBUaGlzIGlzCiAgICBzb21ldGhpbmcgb2YgYSBoYWNrIGFu
ZCBzaG91bGQgYmUgcmV2aXNpdGVkLgoKICAgIEBwcm9wZXJ0eSBfY29udGV4dAogICAgQHByaXZh
dGUKICAqLwogIF9jb250ZXh0OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbihrZXkpIHsKICAgIHZh
ciBwYXJlbnRWaWV3LCBjb250cm9sbGVyOwoKICAgIGlmIChjb250cm9sbGVyID0gZ2V0KHRoaXMs
ICdjb250cm9sbGVyJykpIHsKICAgICAgcmV0dXJuIGNvbnRyb2xsZXI7CiAgICB9CgogICAgcGFy
ZW50VmlldyA9IHRoaXMuX3BhcmVudFZpZXc7CiAgICBpZiAocGFyZW50VmlldykgewogICAgICBy
ZXR1cm4gZ2V0KHBhcmVudFZpZXcsICdfY29udGV4dCcpOwogICAgfQoKICAgIHJldHVybiBudWxs
OwogIH0pLAoKICAvKioKICAgIElmIGEgdmFsdWUgdGhhdCBhZmZlY3RzIHRlbXBsYXRlIHJlbmRl
cmluZyBjaGFuZ2VzLCB0aGUgdmlldyBzaG91bGQgYmUKICAgIHJlLXJlbmRlcmVkIHRvIHJlZmxl
Y3QgdGhlIG5ldyB2YWx1ZS4KCiAgICBAbWV0aG9kIF9jb250ZXh0RGlkQ2hhbmdlCiAgICBAcHJp
dmF0ZQogICovCiAgX2NvbnRleHREaWRDaGFuZ2U6IEVtYmVyLm9ic2VydmVyKCdjb250ZXh0Jywg
ZnVuY3Rpb24oKSB7CiAgICB0aGlzLnJlcmVuZGVyKCk7CiAgfSksCgogIC8qKgogICAgSWYgYGZh
bHNlYCwgdGhlIHZpZXcgd2lsbCBhcHBlYXIgaGlkZGVuIGluIERPTS4KCiAgICBAcHJvcGVydHkg
aXNWaXNpYmxlCiAgICBAdHlwZSBCb29sZWFuCiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBpc1Zp
c2libGU6IHRydWUsCgogIC8qKgogICAgQXJyYXkgb2YgY2hpbGQgdmlld3MuIFlvdSBzaG91bGQg
bmV2ZXIgZWRpdCB0aGlzIGFycmF5IGRpcmVjdGx5LgogICAgSW5zdGVhZCwgdXNlIGBhcHBlbmRD
aGlsZGAgYW5kIGByZW1vdmVGcm9tUGFyZW50YC4KCiAgICBAcHJvcGVydHkgY2hpbGRWaWV3cwog
ICAgQHR5cGUgQXJyYXkKICAgIEBkZWZhdWx0IFtdCiAgICBAcHJpdmF0ZQogICovCiAgY2hpbGRW
aWV3czogY2hpbGRWaWV3c1Byb3BlcnR5LAoKICBfY2hpbGRWaWV3czogRU1QVFlfQVJSQVksCgog
IC8vIFdoZW4gaXQncyBhIHZpcnR1YWwgdmlldywgd2UgbmVlZCB0byBub3RpZnkgdGhlIHBhcmVu
dCB0aGF0IHRoZWlyCiAgLy8gY2hpbGRWaWV3cyB3aWxsIGNoYW5nZS4KICBfY2hpbGRWaWV3c1dp
bGxDaGFuZ2U6IEVtYmVyLmJlZm9yZU9ic2VydmVyKCdjaGlsZFZpZXdzJywgZnVuY3Rpb24oKSB7
CiAgICBpZiAodGhpcy5pc1ZpcnR1YWwpIHsKICAgICAgdmFyIHBhcmVudFZpZXcgPSBnZXQodGhp
cywgJ3BhcmVudFZpZXcnKTsKICAgICAgaWYgKHBhcmVudFZpZXcpIHsgRW1iZXIucHJvcGVydHlX
aWxsQ2hhbmdlKHBhcmVudFZpZXcsICdjaGlsZFZpZXdzJyk7IH0KICAgIH0KICB9KSwKCiAgLy8g
V2hlbiBpdCdzIGEgdmlydHVhbCB2aWV3LCB3ZSBuZWVkIHRvIG5vdGlmeSB0aGUgcGFyZW50IHRo
YXQgdGhlaXIKICAvLyBjaGlsZFZpZXdzIGRpZCBjaGFuZ2UuCiAgX2NoaWxkVmlld3NEaWRDaGFu
Z2U6IEVtYmVyLm9ic2VydmVyKCdjaGlsZFZpZXdzJywgZnVuY3Rpb24oKSB7CiAgICBpZiAodGhp
cy5pc1ZpcnR1YWwpIHsKICAgICAgdmFyIHBhcmVudFZpZXcgPSBnZXQodGhpcywgJ3BhcmVudFZp
ZXcnKTsKICAgICAgaWYgKHBhcmVudFZpZXcpIHsgRW1iZXIucHJvcGVydHlEaWRDaGFuZ2UocGFy
ZW50VmlldywgJ2NoaWxkVmlld3MnKTsgfQogICAgfQogIH0pLAoKICAvKioKICAgIFJldHVybiB0
aGUgbmVhcmVzdCBhbmNlc3RvciB0aGF0IGlzIGFuIGluc3RhbmNlIG9mIHRoZSBwcm92aWRlZAog
ICAgY2xhc3MuCgogICAgQHByb3BlcnR5IG5lYXJlc3RJbnN0YW5jZU9mCiAgICBAcGFyYW0ge0Ns
YXNzfSBrbGFzcyBTdWJjbGFzcyBvZiBFbWJlci5WaWV3IChvciBFbWJlci5WaWV3IGl0c2VsZikK
ICAgIEByZXR1cm4gRW1iZXIuVmlldwogICAgQGRlcHJlY2F0ZWQKICAqLwogIG5lYXJlc3RJbnN0
YW5jZU9mOiBmdW5jdGlvbihrbGFzcykgewogICAgRW1iZXIuZGVwcmVjYXRlKCJuZWFyZXN0SW5z
dGFuY2VPZiBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgZnJvbSBmdXR1cmUgcmVs
ZWFzZXMuIFVzZSBuZWFyZXN0T2ZUeXBlLiIpOwogICAgdmFyIHZpZXcgPSBnZXQodGhpcywgJ3Bh
cmVudFZpZXcnKTsKCiAgICB3aGlsZSAodmlldykgewogICAgICBpZiAodmlldyBpbnN0YW5jZW9m
IGtsYXNzKSB7IHJldHVybiB2aWV3OyB9CiAgICAgIHZpZXcgPSBnZXQodmlldywgJ3BhcmVudFZp
ZXcnKTsKICAgIH0KICB9LAoKICAvKioKICAgIFJldHVybiB0aGUgbmVhcmVzdCBhbmNlc3RvciB0
aGF0IGlzIGFuIGluc3RhbmNlIG9mIHRoZSBwcm92aWRlZAogICAgY2xhc3Mgb3IgbWl4aW4uCgog
ICAgQHByb3BlcnR5IG5lYXJlc3RPZlR5cGUKICAgIEBwYXJhbSB7Q2xhc3MsTWl4aW59IGtsYXNz
IFN1YmNsYXNzIG9mIEVtYmVyLlZpZXcgKG9yIEVtYmVyLlZpZXcgaXRzZWxmKSwKICAgICAgICAg
ICBvciBhbiBpbnN0YW5jZSBvZiBFbWJlci5NaXhpbi4KICAgIEByZXR1cm4gRW1iZXIuVmlldwog
ICovCiAgbmVhcmVzdE9mVHlwZTogZnVuY3Rpb24oa2xhc3MpIHsKICAgIHZhciB2aWV3ID0gZ2V0
KHRoaXMsICdwYXJlbnRWaWV3JyksCiAgICAgICAgaXNPZlR5cGUgPSBrbGFzcyBpbnN0YW5jZW9m
IEVtYmVyLk1peGluID8KICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHZpZXcpIHsgcmV0dXJu
IGtsYXNzLmRldGVjdCh2aWV3KTsgfSA6CiAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih2aWV3
KSB7IHJldHVybiBrbGFzcy5kZXRlY3Qodmlldy5jb25zdHJ1Y3Rvcik7IH07CgogICAgd2hpbGUg
KHZpZXcpIHsKICAgICAgaWYgKGlzT2ZUeXBlKHZpZXcpKSB7IHJldHVybiB2aWV3OyB9CiAgICAg
IHZpZXcgPSBnZXQodmlldywgJ3BhcmVudFZpZXcnKTsKICAgIH0KICB9LAoKICAvKioKICAgIFJl
dHVybiB0aGUgbmVhcmVzdCBhbmNlc3RvciB0aGF0IGhhcyBhIGdpdmVuIHByb3BlcnR5LgoKICAg
IEBmdW5jdGlvbiBuZWFyZXN0V2l0aFByb3BlcnR5CiAgICBAcGFyYW0ge1N0cmluZ30gcHJvcGVy
dHkgQSBwcm9wZXJ0eSBuYW1lCiAgICBAcmV0dXJuIEVtYmVyLlZpZXcKICAqLwogIG5lYXJlc3RX
aXRoUHJvcGVydHk6IGZ1bmN0aW9uKHByb3BlcnR5KSB7CiAgICB2YXIgdmlldyA9IGdldCh0aGlz
LCAncGFyZW50VmlldycpOwoKICAgIHdoaWxlICh2aWV3KSB7CiAgICAgIGlmIChwcm9wZXJ0eSBp
biB2aWV3KSB7IHJldHVybiB2aWV3OyB9CiAgICAgIHZpZXcgPSBnZXQodmlldywgJ3BhcmVudFZp
ZXcnKTsKICAgIH0KICB9LAoKICAvKioKICAgIFJldHVybiB0aGUgbmVhcmVzdCBhbmNlc3RvciB3
aG9zZSBwYXJlbnQgaXMgYW4gaW5zdGFuY2Ugb2YKICAgIGBrbGFzc2AuCgogICAgQG1ldGhvZCBu
ZWFyZXN0Q2hpbGRPZgogICAgQHBhcmFtIHtDbGFzc30ga2xhc3MgU3ViY2xhc3Mgb2YgRW1iZXIu
VmlldyAob3IgRW1iZXIuVmlldyBpdHNlbGYpCiAgICBAcmV0dXJuIEVtYmVyLlZpZXcKICAqLwog
IG5lYXJlc3RDaGlsZE9mOiBmdW5jdGlvbihrbGFzcykgewogICAgdmFyIHZpZXcgPSBnZXQodGhp
cywgJ3BhcmVudFZpZXcnKTsKCiAgICB3aGlsZSAodmlldykgewogICAgICBpZiAoZ2V0KHZpZXcs
ICdwYXJlbnRWaWV3JykgaW5zdGFuY2VvZiBrbGFzcykgeyByZXR1cm4gdmlldzsgfQogICAgICB2
aWV3ID0gZ2V0KHZpZXcsICdwYXJlbnRWaWV3Jyk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBXaGVu
IHRoZSBwYXJlbnQgdmlldyBjaGFuZ2VzLCByZWN1cnNpdmVseSBpbnZhbGlkYXRlIGBjb250cm9s
bGVyYAoKICAgIEBtZXRob2QgX3BhcmVudFZpZXdEaWRDaGFuZ2UKICAgIEBwcml2YXRlCiAgKi8K
ICBfcGFyZW50Vmlld0RpZENoYW5nZTogRW1iZXIub2JzZXJ2ZXIoJ19wYXJlbnRWaWV3JywgZnVu
Y3Rpb24oKSB7CiAgICBpZiAodGhpcy5pc0Rlc3Ryb3lpbmcpIHsgcmV0dXJuOyB9CgogICAgdGhp
cy50cmlnZ2VyKCdwYXJlbnRWaWV3RGlkQ2hhbmdlJyk7CgogICAgaWYgKGdldCh0aGlzLCAncGFy
ZW50Vmlldy5jb250cm9sbGVyJykgJiYgIWdldCh0aGlzLCAnY29udHJvbGxlcicpKSB7CiAgICAg
IHRoaXMubm90aWZ5UHJvcGVydHlDaGFuZ2UoJ2NvbnRyb2xsZXInKTsKICAgIH0KICB9KSwKCiAg
X2NvbnRyb2xsZXJEaWRDaGFuZ2U6IEVtYmVyLm9ic2VydmVyKCdjb250cm9sbGVyJywgZnVuY3Rp
b24oKSB7CiAgICBpZiAodGhpcy5pc0Rlc3Ryb3lpbmcpIHsgcmV0dXJuOyB9CgogICAgdGhpcy5y
ZXJlbmRlcigpOwoKICAgIHRoaXMuZm9yRWFjaENoaWxkVmlldyhmdW5jdGlvbih2aWV3KSB7CiAg
ICAgIHZpZXcucHJvcGVydHlEaWRDaGFuZ2UoJ2NvbnRyb2xsZXInKTsKICAgIH0pOwogIH0pLAoK
ICBjbG9uZUtleXdvcmRzOiBmdW5jdGlvbigpIHsKICAgIHZhciB0ZW1wbGF0ZURhdGEgPSBnZXQo
dGhpcywgJ3RlbXBsYXRlRGF0YScpOwoKICAgIHZhciBrZXl3b3JkcyA9IHRlbXBsYXRlRGF0YSA/
IEVtYmVyLmNvcHkodGVtcGxhdGVEYXRhLmtleXdvcmRzKSA6IHt9OwogICAgc2V0KGtleXdvcmRz
LCAndmlldycsIGdldCh0aGlzLCAnY29uY3JldGVWaWV3JykpOwogICAgc2V0KGtleXdvcmRzLCAn
X3ZpZXcnLCB0aGlzKTsKICAgIHNldChrZXl3b3JkcywgJ2NvbnRyb2xsZXInLCBnZXQodGhpcywg
J2NvbnRyb2xsZXInKSk7CgogICAgcmV0dXJuIGtleXdvcmRzOwogIH0sCgogIC8qKgogICAgQ2Fs
bGVkIG9uIHlvdXIgdmlldyB3aGVuIGl0IHNob3VsZCBwdXNoIHN0cmluZ3Mgb2YgSFRNTCBpbnRv
IGEKICAgIGBFbWJlci5SZW5kZXJCdWZmZXJgLiBNb3N0IHVzZXJzIHdpbGwgd2FudCB0byBvdmVy
cmlkZSB0aGUgYHRlbXBsYXRlYAogICAgb3IgYHRlbXBsYXRlTmFtZWAgcHJvcGVydGllcyBpbnN0
ZWFkIG9mIHRoaXMgbWV0aG9kLgoKICAgIEJ5IGRlZmF1bHQsIGBFbWJlci5WaWV3YCB3aWxsIGxv
b2sgZm9yIGEgZnVuY3Rpb24gaW4gdGhlIGB0ZW1wbGF0ZWAKICAgIHByb3BlcnR5IGFuZCBpbnZv
a2UgaXQgd2l0aCB0aGUgdmFsdWUgb2YgYGNvbnRleHRgLiBUaGUgdmFsdWUgb2YKICAgIGBjb250
ZXh0YCB3aWxsIGJlIHRoZSB2aWV3J3MgY29udHJvbGxlciB1bmxlc3MgeW91IG92ZXJyaWRlIGl0
LgoKICAgIEBtZXRob2QgcmVuZGVyCiAgICBAcGFyYW0ge0VtYmVyLlJlbmRlckJ1ZmZlcn0gYnVm
ZmVyIFRoZSByZW5kZXIgYnVmZmVyCiAgKi8KICByZW5kZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewog
ICAgLy8gSWYgdGhpcyB2aWV3IGhhcyBhIGxheW91dCwgaXQgaXMgdGhlIHJlc3BvbnNpYmlsaXR5
IG9mIHRoZQogICAgLy8gdGhlIGxheW91dCB0byByZW5kZXIgdGhlIHZpZXcncyB0ZW1wbGF0ZS4g
T3RoZXJ3aXNlLCByZW5kZXIgdGhlIHRlbXBsYXRlCiAgICAvLyBkaXJlY3RseS4KICAgIHZhciB0
ZW1wbGF0ZSA9IGdldCh0aGlzLCAnbGF5b3V0JykgfHwgZ2V0KHRoaXMsICd0ZW1wbGF0ZScpOwoK
ICAgIGlmICh0ZW1wbGF0ZSkgewogICAgICB2YXIgY29udGV4dCA9IGdldCh0aGlzLCAnY29udGV4
dCcpOwogICAgICB2YXIga2V5d29yZHMgPSB0aGlzLmNsb25lS2V5d29yZHMoKTsKICAgICAgdmFy
IG91dHB1dDsKCiAgICAgIHZhciBkYXRhID0gewogICAgICAgIHZpZXc6IHRoaXMsCiAgICAgICAg
YnVmZmVyOiBidWZmZXIsCiAgICAgICAgaXNSZW5kZXJEYXRhOiB0cnVlLAogICAgICAgIGtleXdv
cmRzOiBrZXl3b3JkcywKICAgICAgICBpbnNpZGVHcm91cDogZ2V0KHRoaXMsICd0ZW1wbGF0ZURh
dGEuaW5zaWRlR3JvdXAnKQogICAgICB9OwoKICAgICAgLy8gSW52b2tlIHRoZSB0ZW1wbGF0ZSB3
aXRoIHRoZSBwcm92aWRlZCB0ZW1wbGF0ZSBjb250ZXh0LCB3aGljaAogICAgICAvLyBpcyB0aGUg
dmlldydzIGNvbnRyb2xsZXIgYnkgZGVmYXVsdC4gQSBoYXNoIG9mIGRhdGEgaXMgYWxzbyBwYXNz
ZWQgdGhhdCBwcm92aWRlcwogICAgICAvLyB0aGUgdGVtcGxhdGUgd2l0aCBhY2Nlc3MgdG8gdGhl
IHZpZXcgYW5kIHJlbmRlciBidWZmZXIuCgogICAgICBFbWJlci5hc3NlcnQoJ3RlbXBsYXRlIG11
c3QgYmUgYSBmdW5jdGlvbi4gRGlkIHlvdSBtZWFuIHRvIGNhbGwgRW1iZXIuSGFuZGxlYmFycy5j
b21waWxlKCIuLi4iKSBvciBzcGVjaWZ5IHRlbXBsYXRlTmFtZSBpbnN0ZWFkPycsIHR5cGVvZiB0
ZW1wbGF0ZSA9PT0gJ2Z1bmN0aW9uJyk7CiAgICAgIC8vIFRoZSB0ZW1wbGF0ZSBzaG91bGQgd3Jp
dGUgZGlyZWN0bHkgdG8gdGhlIHJlbmRlciBidWZmZXIgaW5zdGVhZAogICAgICAvLyBvZiByZXR1
cm5pbmcgYSBzdHJpbmcuCiAgICAgIG91dHB1dCA9IHRlbXBsYXRlKGNvbnRleHQsIHsgZGF0YTog
ZGF0YSB9KTsKCiAgICAgIC8vIElmIHRoZSB0ZW1wbGF0ZSByZXR1cm5lZCBhIHN0cmluZyBpbnN0
ZWFkIG9mIHdyaXRpbmcgdG8gdGhlIGJ1ZmZlciwKICAgICAgLy8gcHVzaCB0aGUgc3RyaW5nIG9u
dG8gdGhlIGJ1ZmZlci4KICAgICAgaWYgKG91dHB1dCAhPT0gdW5kZWZpbmVkKSB7IGJ1ZmZlci5w
dXNoKG91dHB1dCk7IH0KICAgIH0KICB9LAoKICAvKioKICAgIFJlbmRlcnMgdGhlIHZpZXcgYWdh
aW4uIFRoaXMgd2lsbCB3b3JrIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGUKICAgIHZpZXcgaXMg
YWxyZWFkeSBpbiB0aGUgRE9NIG9yIG5vdC4gSWYgdGhlIHZpZXcgaXMgaW4gdGhlIERPTSwgdGhl
CiAgICByZW5kZXJpbmcgcHJvY2VzcyB3aWxsIGJlIGRlZmVycmVkIHRvIGdpdmUgYmluZGluZ3Mg
YSBjaGFuY2UKICAgIHRvIHN5bmNocm9uaXplLgoKICAgIElmIGNoaWxkcmVuIHdlcmUgYWRkZWQg
ZHVyaW5nIHRoZSByZW5kZXJpbmcgcHJvY2VzcyB1c2luZyBgYXBwZW5kQ2hpbGRgLAogICAgYHJl
cmVuZGVyYCB3aWxsIHJlbW92ZSB0aGVtLCBiZWNhdXNlIHRoZXkgd2lsbCBiZSBhZGRlZCBhZ2Fp
bgogICAgaWYgbmVlZGVkIGJ5IHRoZSBuZXh0IGByZW5kZXJgLgoKICAgIEluIGdlbmVyYWwsIGlm
IHRoZSBkaXNwbGF5IG9mIHlvdXIgdmlldyBjaGFuZ2VzLCB5b3Ugc2hvdWxkIG1vZGlmeQogICAg
dGhlIERPTSBlbGVtZW50IGRpcmVjdGx5IGluc3RlYWQgb2YgbWFudWFsbHkgY2FsbGluZyBgcmVy
ZW5kZXJgLCB3aGljaCBjYW4KICAgIGJlIHNsb3cuCgogICAgQG1ldGhvZCByZXJlbmRlcgogICov
CiAgcmVyZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudFN0YXRlLnJl
cmVuZGVyKHRoaXMpOwogIH0sCgogIGNsZWFyUmVuZGVyZWRDaGlsZHJlbjogZnVuY3Rpb24oKSB7
CiAgICB2YXIgbGVuZ3RoQmVmb3JlID0gdGhpcy5sZW5ndGhCZWZvcmVSZW5kZXIsCiAgICAgICAg
bGVuZ3RoQWZ0ZXIgID0gdGhpcy5sZW5ndGhBZnRlclJlbmRlcjsKCiAgICAvLyBJZiB0aGVyZSB3
ZXJlIGNoaWxkIHZpZXdzIGNyZWF0ZWQgZHVyaW5nIHRoZSBsYXN0IGNhbGwgdG8gcmVuZGVyKCks
CiAgICAvLyByZW1vdmUgdGhlbSB1bmRlciB0aGUgYXNzdW1wdGlvbiB0aGF0IHRoZXkgd2lsbCBi
ZSByZS1jcmVhdGVkIHdoZW4KICAgIC8vIHdlIHJlLXJlbmRlci4KCiAgICAvLyBWSUVXLVRPRE86
IFVuaXQgdGVzdCB0aGlzIHBhdGguCiAgICB2YXIgY2hpbGRWaWV3cyA9IHRoaXMuX2NoaWxkVmll
d3M7CiAgICBmb3IgKHZhciBpPWxlbmd0aEFmdGVyLTE7IGk+PWxlbmd0aEJlZm9yZTsgaS0tKSB7
CiAgICAgIGlmIChjaGlsZFZpZXdzW2ldKSB7IGNoaWxkVmlld3NbaV0uZGVzdHJveSgpOyB9CiAg
ICB9CiAgfSwKCiAgLyoqCiAgICBJdGVyYXRlcyBvdmVyIHRoZSB2aWV3J3MgYGNsYXNzTmFtZUJp
bmRpbmdzYCBhcnJheSwgaW5zZXJ0cyB0aGUgdmFsdWUKICAgIG9mIHRoZSBzcGVjaWZpZWQgcHJv
cGVydHkgaW50byB0aGUgYGNsYXNzTmFtZXNgIGFycmF5LCB0aGVuIGNyZWF0ZXMgYW4KICAgIG9i
c2VydmVyIHRvIHVwZGF0ZSB0aGUgdmlldydzIGVsZW1lbnQgaWYgdGhlIGJvdW5kIHByb3BlcnR5
IGV2ZXIgY2hhbmdlcwogICAgaW4gdGhlIGZ1dHVyZS4KCiAgICBAbWV0aG9kIF9hcHBseUNsYXNz
TmFtZUJpbmRpbmdzCiAgICBAcHJpdmF0ZQogICovCiAgX2FwcGx5Q2xhc3NOYW1lQmluZGluZ3M6
IGZ1bmN0aW9uKGNsYXNzQmluZGluZ3MpIHsKICAgIHZhciBjbGFzc05hbWVzID0gdGhpcy5jbGFz
c05hbWVzLAogICAgZWxlbSwgbmV3Q2xhc3MsIGRhc2hlcml6ZWRDbGFzczsKCiAgICAvLyBMb29w
IHRocm91Z2ggYWxsIG9mIHRoZSBjb25maWd1cmVkIGJpbmRpbmdzLiBUaGVzZSB3aWxsIGJlIGVp
dGhlcgogICAgLy8gcHJvcGVydHkgbmFtZXMgKCdpc1VyZ2VudCcpIG9yIHByb3BlcnR5IHBhdGhz
IHJlbGF0aXZlIHRvIHRoZSB2aWV3CiAgICAvLyAoJ2NvbnRlbnQuaXNVcmdlbnQnKQogICAgYV9m
b3JFYWNoKGNsYXNzQmluZGluZ3MsIGZ1bmN0aW9uKGJpbmRpbmcpIHsKCiAgICAgIC8vIFZhcmlh
YmxlIGluIHdoaWNoIHRoZSBvbGQgY2xhc3MgdmFsdWUgaXMgc2F2ZWQuIFRoZSBvYnNlcnZlciBm
dW5jdGlvbgogICAgICAvLyBjbG9zZXMgb3ZlciB0aGlzIHZhcmlhYmxlLCBzbyBpdCBrbm93cyB3
aGljaCBzdHJpbmcgdG8gcmVtb3ZlIHdoZW4KICAgICAgLy8gdGhlIHByb3BlcnR5IGNoYW5nZXMu
CiAgICAgIHZhciBvbGRDbGFzczsKICAgICAgLy8gRXh0cmFjdCBqdXN0IHRoZSBwcm9wZXJ0eSBu
YW1lIGZyb20gYmluZGluZ3MgbGlrZSAnZm9vOmJhcicKICAgICAgdmFyIHBhcnNlZFBhdGggPSBF
bWJlci5WaWV3Ll9wYXJzZVByb3BlcnR5UGF0aChiaW5kaW5nKTsKCiAgICAgIC8vIFNldCB1cCBh
biBvYnNlcnZlciBvbiB0aGUgY29udGV4dC4gSWYgdGhlIHByb3BlcnR5IGNoYW5nZXMsIHRvZ2ds
ZSB0aGUKICAgICAgLy8gY2xhc3MgbmFtZS4KICAgICAgdmFyIG9ic2VydmVyID0gZnVuY3Rpb24o
KSB7CiAgICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eQogICAg
ICAgIG5ld0NsYXNzID0gdGhpcy5fY2xhc3NTdHJpbmdGb3JQcm9wZXJ0eShiaW5kaW5nKTsKICAg
ICAgICBlbGVtID0gdGhpcy4kKCk7CgogICAgICAgIC8vIElmIHdlIGhhZCBwcmV2aW91c2x5IGFk
ZGVkIGEgY2xhc3MgdG8gdGhlIGVsZW1lbnQsIHJlbW92ZSBpdC4KICAgICAgICBpZiAob2xkQ2xh
c3MpIHsKICAgICAgICAgIGVsZW0ucmVtb3ZlQ2xhc3Mob2xkQ2xhc3MpOwogICAgICAgICAgLy8g
QWxzbyByZW1vdmUgZnJvbSBjbGFzc05hbWVzIHNvIHRoYXQgaWYgdGhlIHZpZXcgZ2V0cyByZXJl
bmRlcmVkLAogICAgICAgICAgLy8gdGhlIGNsYXNzIGRvZXNuJ3QgZ2V0IGFkZGVkIGJhY2sgdG8g
dGhlIERPTS4KICAgICAgICAgIGNsYXNzTmFtZXMucmVtb3ZlT2JqZWN0KG9sZENsYXNzKTsKICAg
ICAgICB9CgogICAgICAgIC8vIElmIG5lY2Vzc2FyeSwgYWRkIGEgbmV3IGNsYXNzLiBNYWtlIHN1
cmUgd2Uga2VlcCB0cmFjayBvZiBpdCBzbwogICAgICAgIC8vIGl0IGNhbiBiZSByZW1vdmVkIGlu
IHRoZSBmdXR1cmUuCiAgICAgICAgaWYgKG5ld0NsYXNzKSB7CiAgICAgICAgICBlbGVtLmFkZENs
YXNzKG5ld0NsYXNzKTsKICAgICAgICAgIG9sZENsYXNzID0gbmV3Q2xhc3M7CiAgICAgICAgfSBl
bHNlIHsKICAgICAgICAgIG9sZENsYXNzID0gbnVsbDsKICAgICAgICB9CiAgICAgIH07CgogICAg
ICAvLyBHZXQgdGhlIGNsYXNzIG5hbWUgZm9yIHRoZSBwcm9wZXJ0eSBhdCBpdHMgY3VycmVudCB2
YWx1ZQogICAgICBkYXNoZXJpemVkQ2xhc3MgPSB0aGlzLl9jbGFzc1N0cmluZ0ZvclByb3BlcnR5
KGJpbmRpbmcpOwoKICAgICAgaWYgKGRhc2hlcml6ZWRDbGFzcykgewogICAgICAgIC8vIEVuc3Vy
ZSB0aGF0IGl0IGdldHMgaW50byB0aGUgY2xhc3NOYW1lcyBhcnJheQogICAgICAgIC8vIHNvIGl0
IGlzIGRpc3BsYXllZCB3aGVuIHdlIHJlbmRlci4KICAgICAgICBhX2FkZE9iamVjdChjbGFzc05h
bWVzLCBkYXNoZXJpemVkQ2xhc3MpOwoKICAgICAgICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHRo
ZSBjbGFzcyBuYW1lIHNvIHdlIGNhbiByZW1vdmUgaXQKICAgICAgICAvLyBpZiB0aGUgb2JzZXJ2
ZXIgZmlyZXMuIFJlbWVtYmVyIHRoYXQgdGhpcyB2YXJpYWJsZSBoYXMKICAgICAgICAvLyBiZWVu
IGNsb3NlZCBvdmVyIGJ5IHRoZSBvYnNlcnZlci4KICAgICAgICBvbGRDbGFzcyA9IGRhc2hlcml6
ZWRDbGFzczsKICAgICAgfQoKICAgICAgdGhpcy5yZWdpc3Rlck9ic2VydmVyKHRoaXMsIHBhcnNl
ZFBhdGgucGF0aCwgb2JzZXJ2ZXIpOwogICAgICAvLyBSZW1vdmUgY2xhc3NOYW1lIHNvIHdoZW4g
dGhlIHZpZXcgaXMgcmVyZW5kZXJlZCwKICAgICAgLy8gdGhlIGNsYXNzTmFtZSBpcyBhZGRlZCBi
YXNlZCBvbiBiaW5kaW5nIHJlZXZhbHVhdGlvbgogICAgICB0aGlzLm9uZSgnd2lsbENsZWFyUmVu
ZGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKG9sZENsYXNzKSB7CiAgICAgICAgICBjbGFz
c05hbWVzLnJlbW92ZU9iamVjdChvbGRDbGFzcyk7CiAgICAgICAgICBvbGRDbGFzcyA9IG51bGw7
CiAgICAgICAgfQogICAgICB9KTsKCiAgICB9LCB0aGlzKTsKICB9LAoKICAvKioKICAgIEl0ZXJh
dGVzIHRocm91Z2ggdGhlIHZpZXcncyBhdHRyaWJ1dGUgYmluZGluZ3MsIHNldHMgdXAgb2JzZXJ2
ZXJzIGZvciBlYWNoLAogICAgdGhlbiBhcHBsaWVzIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBh
dHRyaWJ1dGVzIHRvIHRoZSBwYXNzZWQgcmVuZGVyIGJ1ZmZlci4KCiAgICBAbWV0aG9kIF9hcHBs
eUF0dHJpYnV0ZUJpbmRpbmdzCiAgICBAcGFyYW0ge0VtYmVyLlJlbmRlckJ1ZmZlcn0gYnVmZmVy
CiAgICBAcHJpdmF0ZQogICovCiAgX2FwcGx5QXR0cmlidXRlQmluZGluZ3M6IGZ1bmN0aW9uKGJ1
ZmZlciwgYXR0cmlidXRlQmluZGluZ3MpIHsKICAgIHZhciBhdHRyaWJ1dGVWYWx1ZSwgZWxlbTsK
CiAgICBhX2ZvckVhY2goYXR0cmlidXRlQmluZGluZ3MsIGZ1bmN0aW9uKGJpbmRpbmcpIHsKICAg
ICAgdmFyIHNwbGl0ID0gYmluZGluZy5zcGxpdCgnOicpLAogICAgICAgICAgcHJvcGVydHkgPSBz
cGxpdFswXSwKICAgICAgICAgIGF0dHJpYnV0ZU5hbWUgPSBzcGxpdFsxXSB8fCBwcm9wZXJ0eTsK
CiAgICAgIC8vIENyZWF0ZSBhbiBvYnNlcnZlciB0byBhZGQvcmVtb3ZlL2NoYW5nZSB0aGUgYXR0
cmlidXRlIGlmIHRoZQogICAgICAvLyBKYXZhU2NyaXB0IHByb3BlcnR5IGNoYW5nZXMuCiAgICAg
IHZhciBvYnNlcnZlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGVsZW0gPSB0aGlzLiQoKTsKCiAg
ICAgICAgYXR0cmlidXRlVmFsdWUgPSBnZXQodGhpcywgcHJvcGVydHkpOwoKICAgICAgICBFbWJl
ci5WaWV3LmFwcGx5QXR0cmlidXRlQmluZGluZ3MoZWxlbSwgYXR0cmlidXRlTmFtZSwgYXR0cmli
dXRlVmFsdWUpOwogICAgICB9OwoKICAgICAgdGhpcy5yZWdpc3Rlck9ic2VydmVyKHRoaXMsIHBy
b3BlcnR5LCBvYnNlcnZlcik7CgogICAgICAvLyBEZXRlcm1pbmUgdGhlIGN1cnJlbnQgdmFsdWUg
YW5kIGFkZCBpdCB0byB0aGUgcmVuZGVyIGJ1ZmZlcgogICAgICAvLyBpZiBuZWNlc3NhcnkuCiAg
ICAgIGF0dHJpYnV0ZVZhbHVlID0gZ2V0KHRoaXMsIHByb3BlcnR5KTsKICAgICAgRW1iZXIuVmll
dy5hcHBseUF0dHJpYnV0ZUJpbmRpbmdzKGJ1ZmZlciwgYXR0cmlidXRlTmFtZSwgYXR0cmlidXRl
VmFsdWUpOwogICAgfSwgdGhpcyk7CiAgfSwKCiAgLyoqCiAgICBHaXZlbiBhIHByb3BlcnR5IG5h
bWUsIHJldHVybnMgYSBkYXNoZXJpemVkIHZlcnNpb24gb2YgdGhhdAogICAgcHJvcGVydHkgbmFt
ZSBpZiB0aGUgcHJvcGVydHkgZXZhbHVhdGVzIHRvIGEgbm9uLWZhbHN5IHZhbHVlLgoKICAgIEZv
ciBleGFtcGxlLCBpZiB0aGUgdmlldyBoYXMgcHJvcGVydHkgYGlzVXJnZW50YCB0aGF0IGV2YWx1
YXRlcyB0byB0cnVlLAogICAgcGFzc2luZyBgaXNVcmdlbnRgIHRvIHRoaXMgbWV0aG9kIHdpbGwg
cmV0dXJuIGAiaXMtdXJnZW50ImAuCgogICAgQG1ldGhvZCBfY2xhc3NTdHJpbmdGb3JQcm9wZXJ0
eQogICAgQHBhcmFtIHByb3BlcnR5CiAgICBAcHJpdmF0ZQogICovCiAgX2NsYXNzU3RyaW5nRm9y
UHJvcGVydHk6IGZ1bmN0aW9uKHByb3BlcnR5KSB7CiAgICB2YXIgcGFyc2VkUGF0aCA9IEVtYmVy
LlZpZXcuX3BhcnNlUHJvcGVydHlQYXRoKHByb3BlcnR5KTsKICAgIHZhciBwYXRoID0gcGFyc2Vk
UGF0aC5wYXRoOwoKICAgIHZhciB2YWwgPSBnZXQodGhpcywgcGF0aCk7CiAgICBpZiAodmFsID09
PSB1bmRlZmluZWQgJiYgRW1iZXIuaXNHbG9iYWxQYXRoKHBhdGgpKSB7CiAgICAgIHZhbCA9IGdl
dChFbWJlci5sb29rdXAsIHBhdGgpOwogICAgfQoKICAgIHJldHVybiBFbWJlci5WaWV3Ll9jbGFz
c1N0cmluZ0ZvclZhbHVlKHBhdGgsIHZhbCwgcGFyc2VkUGF0aC5jbGFzc05hbWUsIHBhcnNlZFBh
dGguZmFsc3lDbGFzc05hbWUpOwogIH0sCgogIC8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAvLyBFTEVNRU5UIFNVUFBPUlQKICAv
LwoKICAvKioKICAgIFJldHVybnMgdGhlIGN1cnJlbnQgRE9NIGVsZW1lbnQgZm9yIHRoZSB2aWV3
LgoKICAgIEBwcm9wZXJ0eSBlbGVtZW50CiAgICBAdHlwZSBET01FbGVtZW50CiAgKi8KICBlbGVt
ZW50OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICBpZiAodmFsdWUg
IT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUuc2V0RWxlbWVu
dCh0aGlzLCB2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3Rh
dGUuZ2V0RWxlbWVudCh0aGlzKTsKICAgIH0KICB9KS5wcm9wZXJ0eSgnX3BhcmVudFZpZXcnKSwK
CiAgLyoqCiAgICBSZXR1cm5zIGEgalF1ZXJ5IG9iamVjdCBmb3IgdGhpcyB2aWV3J3MgZWxlbWVu
dC4gSWYgeW91IHBhc3MgaW4gYSBzZWxlY3RvcgogICAgc3RyaW5nLCB0aGlzIG1ldGhvZCB3aWxs
IHJldHVybiBhIGpRdWVyeSBvYmplY3QsIHVzaW5nIHRoZSBjdXJyZW50IGVsZW1lbnQKICAgIGFz
IGl0cyBidWZmZXIuCgogICAgRm9yIGV4YW1wbGUsIGNhbGxpbmcgYHZpZXcuJCgnbGknKWAgd2ls
bCByZXR1cm4gYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcKICAgIGFsbCBvZiB0aGUgYGxpYCBl
bGVtZW50cyBpbnNpZGUgdGhlIERPTSBlbGVtZW50IG9mIHRoaXMgdmlldy4KCiAgICBAbWV0aG9k
ICQKICAgIEBwYXJhbSB7U3RyaW5nfSBbc2VsZWN0b3JdIGEgalF1ZXJ5LWNvbXBhdGlibGUgc2Vs
ZWN0b3Igc3RyaW5nCiAgICBAcmV0dXJuIHtqUXVlcnl9IHRoZSBqUXVlcnkgb2JqZWN0IGZvciB0
aGUgRE9NIG5vZGUKICAqLwogICQ6IGZ1bmN0aW9uKHNlbCkgewogICAgcmV0dXJuIHRoaXMuY3Vy
cmVudFN0YXRlLiQodGhpcywgc2VsKTsKICB9LAoKICBtdXRhdGVDaGlsZFZpZXdzOiBmdW5jdGlv
bihjYWxsYmFjaykgewogICAgdmFyIGNoaWxkVmlld3MgPSB0aGlzLl9jaGlsZFZpZXdzLAogICAg
ICAgIGlkeCA9IGNoaWxkVmlld3MubGVuZ3RoLAogICAgICAgIHZpZXc7CgogICAgd2hpbGUoLS1p
ZHggPj0gMCkgewogICAgICB2aWV3ID0gY2hpbGRWaWV3c1tpZHhdOwogICAgICBjYWxsYmFjayh0
aGlzLCB2aWV3LCBpZHgpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIGZvckVhY2hD
aGlsZFZpZXc6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgY2hpbGRWaWV3cyA9IHRoaXMu
X2NoaWxkVmlld3M7CgogICAgaWYgKCFjaGlsZFZpZXdzKSB7IHJldHVybiB0aGlzOyB9CgogICAg
dmFyIGxlbiA9IGNoaWxkVmlld3MubGVuZ3RoLAogICAgICAgIHZpZXcsIGlkeDsKCiAgICBmb3Ig
KGlkeCA9IDA7IGlkeCA8IGxlbjsgaWR4KyspIHsKICAgICAgdmlldyA9IGNoaWxkVmlld3NbaWR4
XTsKICAgICAgY2FsbGJhY2sodmlldyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAg
LyoqCiAgICBBcHBlbmRzIHRoZSB2aWV3J3MgZWxlbWVudCB0byB0aGUgc3BlY2lmaWVkIHBhcmVu
dCBlbGVtZW50LgoKICAgIElmIHRoZSB2aWV3IGRvZXMgbm90IGhhdmUgYW4gSFRNTCByZXByZXNl
bnRhdGlvbiB5ZXQsIGBjcmVhdGVFbGVtZW50KClgCiAgICB3aWxsIGJlIGNhbGxlZCBhdXRvbWF0
aWNhbGx5LgoKICAgIE5vdGUgdGhhdCB0aGlzIG1ldGhvZCBqdXN0IHNjaGVkdWxlcyB0aGUgdmll
dyB0byBiZSBhcHBlbmRlZDsgdGhlIERPTQogICAgZWxlbWVudCB3aWxsIG5vdCBiZSBhcHBlbmRl
ZCB0byB0aGUgZ2l2ZW4gZWxlbWVudCB1bnRpbCBhbGwgYmluZGluZ3MgaGF2ZQogICAgZmluaXNo
ZWQgc3luY2hyb25pemluZy4KCiAgICBUaGlzIGlzIG5vdCB0eXBpY2FsbHkgYSBmdW5jdGlvbiB0
aGF0IHlvdSB3aWxsIG5lZWQgdG8gY2FsbCBkaXJlY3RseSB3aGVuCiAgICBidWlsZGluZyB5b3Vy
IGFwcGxpY2F0aW9uLiBZb3UgbWlnaHQgY29uc2lkZXIgdXNpbmcgYEVtYmVyLkNvbnRhaW5lclZp
ZXdgCiAgICBpbnN0ZWFkLiBJZiB5b3UgZG8gbmVlZCB0byB1c2UgYGFwcGVuZFRvYCwgYmUgc3Vy
ZSB0aGF0IHRoZSB0YXJnZXQgZWxlbWVudAogICAgeW91IGFyZSBwcm92aWRpbmcgaXMgYXNzb2Np
YXRlZCB3aXRoIGFuIGBFbWJlci5BcHBsaWNhdGlvbmAgYW5kIGRvZXMgbm90CiAgICBoYXZlIGFu
IGFuY2VzdG9yIGVsZW1lbnQgdGhhdCBpcyBhc3NvY2lhdGVkIHdpdGggYW4gRW1iZXIgdmlldy4K
CiAgICBAbWV0aG9kIGFwcGVuZFRvCiAgICBAcGFyYW0ge1N0cmluZ3xET01FbGVtZW50fGpRdWVy
eX0gQSBzZWxlY3RvciwgZWxlbWVudCwgSFRNTCBzdHJpbmcsIG9yIGpRdWVyeSBvYmplY3QKICAg
IEByZXR1cm4ge0VtYmVyLlZpZXd9IHJlY2VpdmVyCiAgKi8KICBhcHBlbmRUbzogZnVuY3Rpb24o
dGFyZ2V0KSB7CiAgICAvLyBTY2hlZHVsZSB0aGUgRE9NIGVsZW1lbnQgdG8gYmUgY3JlYXRlZCBh
bmQgYXBwZW5kZWQgdG8gdGhlIGdpdmVuCiAgICAvLyBlbGVtZW50IGFmdGVyIGJpbmRpbmdzIGhh
dmUgc3luY2hyb25pemVkLgogICAgdGhpcy5faW5zZXJ0RWxlbWVudExhdGVyKGZ1bmN0aW9uKCkg
ewogICAgICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBhcHBlbmQgdG8gKCIgKyB0YXJnZXQg
KyAiKSBidXQgdGhhdCBpc24ndCBpbiB0aGUgRE9NIiwgRW1iZXIuJCh0YXJnZXQpLmxlbmd0aCA+
IDApOwogICAgICBFbWJlci5hc3NlcnQoIllvdSBjYW5ub3QgYXBwZW5kIHRvIGFuIGV4aXN0aW5n
IEVtYmVyLlZpZXcuIENvbnNpZGVyIHVzaW5nIEVtYmVyLkNvbnRhaW5lclZpZXcgaW5zdGVhZC4i
LCAhRW1iZXIuJCh0YXJnZXQpLmlzKCcuZW1iZXItdmlldycpICYmICFFbWJlci4kKHRhcmdldCku
cGFyZW50cygpLmlzKCcuZW1iZXItdmlldycpKTsKICAgICAgdGhpcy4kKCkuYXBwZW5kVG8odGFy
Z2V0KTsKICAgIH0pOwoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgUmVwbGFjZXMg
dGhlIGNvbnRlbnQgb2YgdGhlIHNwZWNpZmllZCBwYXJlbnQgZWxlbWVudCB3aXRoIHRoaXMgdmll
dydzCiAgICBlbGVtZW50LiBJZiB0aGUgdmlldyBkb2VzIG5vdCBoYXZlIGFuIEhUTUwgcmVwcmVz
ZW50YXRpb24geWV0LAogICAgYGNyZWF0ZUVsZW1lbnQoKWAgd2lsbCBiZSBjYWxsZWQgYXV0b21h
dGljYWxseS4KCiAgICBOb3RlIHRoYXQgdGhpcyBtZXRob2QganVzdCBzY2hlZHVsZXMgdGhlIHZp
ZXcgdG8gYmUgYXBwZW5kZWQ7IHRoZSBET00KICAgIGVsZW1lbnQgd2lsbCBub3QgYmUgYXBwZW5k
ZWQgdG8gdGhlIGdpdmVuIGVsZW1lbnQgdW50aWwgYWxsIGJpbmRpbmdzIGhhdmUKICAgIGZpbmlz
aGVkIHN5bmNocm9uaXppbmcKCiAgICBAbWV0aG9kIHJlcGxhY2VJbgogICAgQHBhcmFtIHtTdHJp
bmd8RE9NRWxlbWVudHxqUXVlcnl9IHRhcmdldCBBIHNlbGVjdG9yLCBlbGVtZW50LCBIVE1MIHN0
cmluZywgb3IgalF1ZXJ5IG9iamVjdAogICAgQHJldHVybiB7RW1iZXIuVmlld30gcmVjZWl2ZWQK
ICAqLwogIHJlcGxhY2VJbjogZnVuY3Rpb24odGFyZ2V0KSB7CiAgICBFbWJlci5hc3NlcnQoIllv
dSB0cmllZCB0byByZXBsYWNlIGluICgiICsgdGFyZ2V0ICsgIikgYnV0IHRoYXQgaXNuJ3QgaW4g
dGhlIERPTSIsIEVtYmVyLiQodGFyZ2V0KS5sZW5ndGggPiAwKTsKICAgIEVtYmVyLmFzc2VydCgi
WW91IGNhbm5vdCByZXBsYWNlIGFuIGV4aXN0aW5nIEVtYmVyLlZpZXcuIENvbnNpZGVyIHVzaW5n
IEVtYmVyLkNvbnRhaW5lclZpZXcgaW5zdGVhZC4iLCAhRW1iZXIuJCh0YXJnZXQpLmlzKCcuZW1i
ZXItdmlldycpICYmICFFbWJlci4kKHRhcmdldCkucGFyZW50cygpLmlzKCcuZW1iZXItdmlldycp
KTsKCiAgICB0aGlzLl9pbnNlcnRFbGVtZW50TGF0ZXIoZnVuY3Rpb24oKSB7CiAgICAgIEVtYmVy
LiQodGFyZ2V0KS5lbXB0eSgpOwogICAgICB0aGlzLiQoKS5hcHBlbmRUbyh0YXJnZXQpOwogICAg
fSk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBTY2hlZHVsZXMgYSBET00gb3Bl
cmF0aW9uIHRvIG9jY3VyIGR1cmluZyB0aGUgbmV4dCByZW5kZXIgcGhhc2UuIFRoaXMKICAgIGVu
c3VyZXMgdGhhdCBhbGwgYmluZGluZ3MgaGF2ZSBmaW5pc2hlZCBzeW5jaHJvbml6aW5nIGJlZm9y
ZSB0aGUgdmlldyBpcwogICAgcmVuZGVyZWQuCgogICAgVG8gdXNlLCBwYXNzIGEgZnVuY3Rpb24g
dGhhdCBwZXJmb3JtcyBhIERPTSBvcGVyYXRpb24uCgogICAgQmVmb3JlIHlvdXIgZnVuY3Rpb24g
aXMgY2FsbGVkLCB0aGlzIHZpZXcgYW5kIGFsbCBjaGlsZCB2aWV3cyB3aWxsIHJlY2VpdmUKICAg
IHRoZSBgd2lsbEluc2VydEVsZW1lbnRgIGV2ZW50LiBBZnRlciB5b3VyIGZ1bmN0aW9uIGlzIGlu
dm9rZWQsIHRoaXMgdmlldwogICAgYW5kIGFsbCBvZiBpdHMgY2hpbGQgdmlld3Mgd2lsbCByZWNl
aXZlIHRoZSBgZGlkSW5zZXJ0RWxlbWVudGAgZXZlbnQuCgogICAgYGBgamF2YXNjcmlwdAogICAg
dmlldy5faW5zZXJ0RWxlbWVudExhdGVyKGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNyZWF0ZUVs
ZW1lbnQoKTsKICAgICAgdGhpcy4kKCkuYXBwZW5kVG8oJ2JvZHknKTsKICAgIH0pOwogICAgYGBg
CgogICAgQG1ldGhvZCBfaW5zZXJ0RWxlbWVudExhdGVyCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSBm
biB0aGUgZnVuY3Rpb24gdGhhdCBpbnNlcnRzIHRoZSBlbGVtZW50IGludG8gdGhlIERPTQogICAg
QHByaXZhdGUKICAqLwogIF9pbnNlcnRFbGVtZW50TGF0ZXI6IGZ1bmN0aW9uKGZuKSB7CiAgICB0
aGlzLl9zY2hlZHVsZWRJbnNlcnQgPSBFbWJlci5ydW4uc2NoZWR1bGVPbmNlKCdyZW5kZXInLCB0
aGlzLCAnX2luc2VydEVsZW1lbnQnLCBmbik7CiAgfSwKCiAgX2luc2VydEVsZW1lbnQ6IGZ1bmN0
aW9uIChmbikgewogICAgdGhpcy5fc2NoZWR1bGVkSW5zZXJ0ID0gbnVsbDsKICAgIHRoaXMuY3Vy
cmVudFN0YXRlLmluc2VydEVsZW1lbnQodGhpcywgZm4pOwogIH0sCgogIC8qKgogICAgQXBwZW5k
cyB0aGUgdmlldydzIGVsZW1lbnQgdG8gdGhlIGRvY3VtZW50IGJvZHkuIElmIHRoZSB2aWV3IGRv
ZXMKICAgIG5vdCBoYXZlIGFuIEhUTUwgcmVwcmVzZW50YXRpb24geWV0LCBgY3JlYXRlRWxlbWVu
dCgpYCB3aWxsIGJlIGNhbGxlZAogICAgYXV0b21hdGljYWxseS4KCiAgICBJZiB5b3VyIGFwcGxp
Y2F0aW9uIHVzZXMgdGhlIGByb290RWxlbWVudGAgcHJvcGVydHksIHlvdSBtdXN0IGFwcGVuZAog
ICAgdGhlIHZpZXcgd2l0aGluIHRoYXQgZWxlbWVudC4gUmVuZGVyaW5nIHZpZXdzIG91dHNpZGUg
b2YgdGhlIGByb290RWxlbWVudGAKICAgIGlzIG5vdCBzdXBwb3J0ZWQuCgogICAgTm90ZSB0aGF0
IHRoaXMgbWV0aG9kIGp1c3Qgc2NoZWR1bGVzIHRoZSB2aWV3IHRvIGJlIGFwcGVuZGVkOyB0aGUg
RE9NCiAgICBlbGVtZW50IHdpbGwgbm90IGJlIGFwcGVuZGVkIHRvIHRoZSBkb2N1bWVudCBib2R5
IHVudGlsIGFsbCBiaW5kaW5ncyBoYXZlCiAgICBmaW5pc2hlZCBzeW5jaHJvbml6aW5nLgoKICAg
IEBtZXRob2QgYXBwZW5kCiAgICBAcmV0dXJuIHtFbWJlci5WaWV3fSByZWNlaXZlcgogICovCiAg
YXBwZW5kOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmFwcGVuZFRvKGRvY3VtZW50LmJv
ZHkpOwogIH0sCgogIC8qKgogICAgUmVtb3ZlcyB0aGUgdmlldydzIGVsZW1lbnQgZnJvbSB0aGUg
ZWxlbWVudCB0byB3aGljaCBpdCBpcyBhdHRhY2hlZC4KCiAgICBAbWV0aG9kIHJlbW92ZQogICAg
QHJldHVybiB7RW1iZXIuVmlld30gcmVjZWl2ZXIKICAqLwogIHJlbW92ZTogZnVuY3Rpb24oKSB7
CiAgICAvLyBXaGF0IHdlIHNob3VsZCByZWFsbHkgZG8gaGVyZSBpcyB3YWl0IHVudGlsIHRoZSBl
bmQgb2YgdGhlIHJ1biBsb29wCiAgICAvLyB0byBkZXRlcm1pbmUgaWYgdGhlIGVsZW1lbnQgaGFz
IGJlZW4gcmUtYXBwZW5kZWQgdG8gYSBkaWZmZXJlbnQKICAgIC8vIGVsZW1lbnQuCiAgICAvLyBJ
biB0aGUgaW50ZXJpbSwgd2Ugd2lsbCBqdXN0IHJlLXJlbmRlciBpZiB0aGF0IGhhcHBlbnMuIEl0
IGlzIG1vcmUKICAgIC8vIGltcG9ydGFudCB0aGFuIGVsZW1lbnRzIGdldCBnYXJiYWdlIGNvbGxl
Y3RlZC4KICAgIGlmICghdGhpcy5yZW1vdmVkRnJvbURPTSkgeyB0aGlzLmRlc3Ryb3lFbGVtZW50
KCk7IH0KICAgIHRoaXMuaW52b2tlUmVjdXJzaXZlbHkoZnVuY3Rpb24odmlldykgewogICAgICBp
ZiAodmlldy5jbGVhclJlbmRlcmVkQ2hpbGRyZW4pIHsgdmlldy5jbGVhclJlbmRlcmVkQ2hpbGRy
ZW4oKTsgfQogICAgfSk7CiAgfSwKCiAgZWxlbWVudElkOiBudWxsLAoKICAvKioKICAgIEF0dGVt
cHRzIHRvIGRpc2NvdmVyIHRoZSBlbGVtZW50IGluIHRoZSBwYXJlbnQgZWxlbWVudC4gVGhlIGRl
ZmF1bHQKICAgIGltcGxlbWVudGF0aW9uIGxvb2tzIGZvciBhbiBlbGVtZW50IHdpdGggYW4gSUQg
b2YgYGVsZW1lbnRJZGAgKG9yIHRoZQogICAgdmlldydzIGd1aWQgaWYgYGVsZW1lbnRJZGAgaXMg
bnVsbCkuIFlvdSBjYW4gb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8KICAgIHByb3ZpZGUgeW91ciBv
d24gZm9ybSBvZiBsb29rdXAuIEZvciBleGFtcGxlLCBpZiB5b3Ugd2FudCB0byBkaXNjb3ZlciB5
b3VyCiAgICBlbGVtZW50IHVzaW5nIGEgQ1NTIGNsYXNzIG5hbWUgaW5zdGVhZCBvZiBhbiBJRC4K
CiAgICBAbWV0aG9kIGZpbmRFbGVtZW50SW5QYXJlbnRFbGVtZW50CiAgICBAcGFyYW0ge0RPTUVs
ZW1lbnR9IHBhcmVudEVsZW1lbnQgVGhlIHBhcmVudCdzIERPTSBlbGVtZW50CiAgICBAcmV0dXJu
IHtET01FbGVtZW50fSBUaGUgZGlzY292ZXJlZCBlbGVtZW50CiAgKi8KICBmaW5kRWxlbWVudElu
UGFyZW50RWxlbWVudDogZnVuY3Rpb24ocGFyZW50RWxlbSkgewogICAgdmFyIGlkID0gIiMiICsg
dGhpcy5lbGVtZW50SWQ7CiAgICByZXR1cm4gRW1iZXIuJChpZClbMF0gfHwgRW1iZXIuJChpZCwg
cGFyZW50RWxlbSlbMF07CiAgfSwKCiAgLyoqCiAgICBDcmVhdGVzIGEgRE9NIHJlcHJlc2VudGF0
aW9uIG9mIHRoZSB2aWV3IGFuZCBhbGwgb2YgaXRzCiAgICBjaGlsZCB2aWV3cyBieSByZWN1cnNp
dmVseSBjYWxsaW5nIHRoZSBgcmVuZGVyKClgIG1ldGhvZC4KCiAgICBBZnRlciB0aGUgZWxlbWVu
dCBoYXMgYmVlbiBjcmVhdGVkLCBgZGlkSW5zZXJ0RWxlbWVudGAgd2lsbAogICAgYmUgY2FsbGVk
IG9uIHRoaXMgdmlldyBhbmQgYWxsIG9mIGl0cyBjaGlsZCB2aWV3cy4KCiAgICBAbWV0aG9kIGNy
ZWF0ZUVsZW1lbnQKICAgIEByZXR1cm4ge0VtYmVyLlZpZXd9IHJlY2VpdmVyCiAgKi8KICBjcmVh
dGVFbGVtZW50OiBmdW5jdGlvbigpIHsKICAgIGlmIChnZXQodGhpcywgJ2VsZW1lbnQnKSkgeyBy
ZXR1cm4gdGhpczsgfQoKICAgIHZhciBidWZmZXIgPSB0aGlzLnJlbmRlclRvQnVmZmVyKCk7CiAg
ICBzZXQodGhpcywgJ2VsZW1lbnQnLCBidWZmZXIuZWxlbWVudCgpKTsKCiAgICByZXR1cm4gdGhp
czsKICB9LAoKICAvKioKICAgIENhbGxlZCB3aGVuIGEgdmlldyBpcyBnb2luZyB0byBpbnNlcnQg
YW4gZWxlbWVudCBpbnRvIHRoZSBET00uCgogICAgQGV2ZW50IHdpbGxJbnNlcnRFbGVtZW50CiAg
Ki8KICB3aWxsSW5zZXJ0RWxlbWVudDogRW1iZXIuSywKCiAgLyoqCiAgICBDYWxsZWQgd2hlbiB0
aGUgZWxlbWVudCBvZiB0aGUgdmlldyBoYXMgYmVlbiBpbnNlcnRlZCBpbnRvIHRoZSBET00KICAg
IG9yIGFmdGVyIHRoZSB2aWV3IHdhcyByZS1yZW5kZXJlZC4gT3ZlcnJpZGUgdGhpcyBmdW5jdGlv
biB0byBkbyBhbnkKICAgIHNldCB1cCB0aGF0IHJlcXVpcmVzIGFuIGVsZW1lbnQgaW4gdGhlIGRv
Y3VtZW50IGJvZHkuCgogICAgQGV2ZW50IGRpZEluc2VydEVsZW1lbnQKICAqLwogIGRpZEluc2Vy
dEVsZW1lbnQ6IEVtYmVyLkssCgogIC8qKgogICAgQ2FsbGVkIHdoZW4gdGhlIHZpZXcgaXMgYWJv
dXQgdG8gcmVyZW5kZXIsIGJ1dCBiZWZvcmUgYW55dGhpbmcgaGFzCiAgICBiZWVuIHRvcm4gZG93
bi4gVGhpcyBpcyBhIGdvb2Qgb3Bwb3J0dW5pdHkgdG8gdGVhciBkb3duIGFueSBtYW51YWwKICAg
IG9ic2VydmVycyB5b3UgaGF2ZSBpbnN0YWxsZWQgYmFzZWQgb24gdGhlIERPTSBzdGF0ZQoKICAg
IEBldmVudCB3aWxsQ2xlYXJSZW5kZXIKICAqLwogIHdpbGxDbGVhclJlbmRlcjogRW1iZXIuSywK
CiAgLyoqCiAgICBSdW4gdGhpcyBjYWxsYmFjayBvbiB0aGUgY3VycmVudCB2aWV3ICh1bmxlc3Mg
aW5jbHVkZVNlbGYgaXMgZmFsc2UpIGFuZCByZWN1cnNpdmVseSBvbiBjaGlsZCB2aWV3cy4KCiAg
ICBAbWV0aG9kIGludm9rZVJlY3Vyc2l2ZWx5CiAgICBAcGFyYW0gZm4ge0Z1bmN0aW9ufQogICAg
QHBhcmFtIGluY2x1ZGVTZWxmIHtCb29sZWFufSBJbmNsdWRlcyBpdHNlbGYgaWYgdHJ1ZS4KICAg
IEBwcml2YXRlCiAgKi8KICBpbnZva2VSZWN1cnNpdmVseTogZnVuY3Rpb24oZm4sIGluY2x1ZGVT
ZWxmKSB7CiAgICB2YXIgY2hpbGRWaWV3cyA9IChpbmNsdWRlU2VsZiA9PT0gZmFsc2UpID8gdGhp
cy5fY2hpbGRWaWV3cyA6IFt0aGlzXTsKICAgIHZhciBjdXJyZW50Vmlld3MsIHZpZXcsIGN1cnJl
bnRDaGlsZFZpZXdzOwoKICAgIHdoaWxlIChjaGlsZFZpZXdzLmxlbmd0aCkgewogICAgICBjdXJy
ZW50Vmlld3MgPSBjaGlsZFZpZXdzLnNsaWNlKCk7CiAgICAgIGNoaWxkVmlld3MgPSBbXTsKCiAg
ICAgIGZvciAodmFyIGk9MCwgbD1jdXJyZW50Vmlld3MubGVuZ3RoOyBpPGw7IGkrKykgewogICAg
ICAgIHZpZXcgPSBjdXJyZW50Vmlld3NbaV07CiAgICAgICAgY3VycmVudENoaWxkVmlld3MgPSB2
aWV3Ll9jaGlsZFZpZXdzID8gdmlldy5fY2hpbGRWaWV3cy5zbGljZSgwKSA6IG51bGw7CiAgICAg
ICAgZm4odmlldyk7CiAgICAgICAgaWYgKGN1cnJlbnRDaGlsZFZpZXdzKSB7CiAgICAgICAgICBj
aGlsZFZpZXdzLnB1c2guYXBwbHkoY2hpbGRWaWV3cywgY3VycmVudENoaWxkVmlld3MpOwogICAg
ICAgIH0KICAgICAgfQogICAgfQogIH0sCgogIHRyaWdnZXJSZWN1cnNpdmVseTogZnVuY3Rpb24o
ZXZlbnROYW1lKSB7CiAgICB2YXIgY2hpbGRWaWV3cyA9IFt0aGlzXSwgY3VycmVudFZpZXdzLCB2
aWV3LCBjdXJyZW50Q2hpbGRWaWV3czsKCiAgICB3aGlsZSAoY2hpbGRWaWV3cy5sZW5ndGgpIHsK
ICAgICAgY3VycmVudFZpZXdzID0gY2hpbGRWaWV3cy5zbGljZSgpOwogICAgICBjaGlsZFZpZXdz
ID0gW107CgogICAgICBmb3IgKHZhciBpPTAsIGw9Y3VycmVudFZpZXdzLmxlbmd0aDsgaTxsOyBp
KyspIHsKICAgICAgICB2aWV3ID0gY3VycmVudFZpZXdzW2ldOwogICAgICAgIGN1cnJlbnRDaGls
ZFZpZXdzID0gdmlldy5fY2hpbGRWaWV3cyA/IHZpZXcuX2NoaWxkVmlld3Muc2xpY2UoMCkgOiBu
dWxsOwogICAgICAgIGlmICh2aWV3LnRyaWdnZXIpIHsgdmlldy50cmlnZ2VyKGV2ZW50TmFtZSk7
IH0KICAgICAgICBpZiAoY3VycmVudENoaWxkVmlld3MpIHsKICAgICAgICAgIGNoaWxkVmlld3Mu
cHVzaC5hcHBseShjaGlsZFZpZXdzLCBjdXJyZW50Q2hpbGRWaWV3cyk7CiAgICAgICAgfQoKICAg
ICAgfQogICAgfQogIH0sCgogIHZpZXdIaWVyYXJjaHlDb2xsZWN0aW9uOiBmdW5jdGlvbigpIHsK
ICAgIHZhciBjdXJyZW50Vmlldywgdmlld0NvbGxlY3Rpb24gPSBuZXcgVmlld0NvbGxlY3Rpb24o
W3RoaXNdKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXdDb2xsZWN0aW9uLmxlbmd0aDsg
aSsrKSB7CiAgICAgIGN1cnJlbnRWaWV3ID0gdmlld0NvbGxlY3Rpb24ub2JqZWN0QXQoaSk7CiAg
ICAgIGlmIChjdXJyZW50Vmlldy5fY2hpbGRWaWV3cykgewogICAgICAgIHZpZXdDb2xsZWN0aW9u
LnB1c2guYXBwbHkodmlld0NvbGxlY3Rpb24sIGN1cnJlbnRWaWV3Ll9jaGlsZFZpZXdzKTsKICAg
ICAgfQogICAgfQoKICAgIHJldHVybiB2aWV3Q29sbGVjdGlvbjsKICB9LAoKICAvKioKICAgIERl
c3Ryb3lzIGFueSBleGlzdGluZyBlbGVtZW50IGFsb25nIHdpdGggdGhlIGVsZW1lbnQgZm9yIGFu
eSBjaGlsZCB2aWV3cwogICAgYXMgd2VsbC4gSWYgdGhlIHZpZXcgZG9lcyBub3QgY3VycmVudGx5
IGhhdmUgYSBlbGVtZW50LCB0aGVuIHRoaXMgbWV0aG9kCiAgICB3aWxsIGRvIG5vdGhpbmcuCgog
ICAgSWYgeW91IGltcGxlbWVudCBgd2lsbERlc3Ryb3lFbGVtZW50KClgIG9uIHlvdXIgdmlldywg
dGhlbiB0aGlzIG1ldGhvZCB3aWxsCiAgICBiZSBpbnZva2VkIG9uIHlvdXIgdmlldyBiZWZvcmUg
eW91ciBlbGVtZW50IGlzIGRlc3Ryb3llZCB0byBnaXZlIHlvdSBhCiAgICBjaGFuY2UgdG8gY2xl
YW4gdXAgYW55IGV2ZW50IGhhbmRsZXJzLCBldGMuCgogICAgSWYgeW91IHdyaXRlIGEgYHdpbGxE
ZXN0cm95RWxlbWVudCgpYCBoYW5kbGVyLCB5b3UgY2FuIGFzc3VtZSB0aGF0IHlvdXIKICAgIGBk
aWRJbnNlcnRFbGVtZW50KClgIGhhbmRsZXIgd2FzIGNhbGxlZCBlYXJsaWVyIGZvciB0aGUgc2Ft
ZSBlbGVtZW50LgoKICAgIFlvdSBzaG91bGQgbm90IGNhbGwgb3Igb3ZlcnJpZGUgdGhpcyBtZXRo
b2QgeW91cnNlbGYsIGJ1dCB5b3UgbWF5CiAgICB3YW50IHRvIGltcGxlbWVudCB0aGUgYWJvdmUg
Y2FsbGJhY2tzLgoKICAgIEBtZXRob2QgZGVzdHJveUVsZW1lbnQKICAgIEByZXR1cm4ge0VtYmVy
LlZpZXd9IHJlY2VpdmVyCiAgKi8KICBkZXN0cm95RWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICBy
ZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUuZGVzdHJveUVsZW1lbnQodGhpcyk7CiAgfSwKCiAgLyoq
CiAgICBDYWxsZWQgd2hlbiB0aGUgZWxlbWVudCBvZiB0aGUgdmlldyBpcyBnb2luZyB0byBiZSBk
ZXN0cm95ZWQuIE92ZXJyaWRlCiAgICB0aGlzIGZ1bmN0aW9uIHRvIGRvIGFueSB0ZWFyZG93biB0
aGF0IHJlcXVpcmVzIGFuIGVsZW1lbnQsIGxpa2UgcmVtb3ZpbmcKICAgIGV2ZW50IGxpc3RlbmVy
cy4KCiAgICBAZXZlbnQgd2lsbERlc3Ryb3lFbGVtZW50CiAgKi8KICB3aWxsRGVzdHJveUVsZW1l
bnQ6IEVtYmVyLkssCgogIC8qKgogICAgVHJpZ2dlcnMgdGhlIGB3aWxsRGVzdHJveUVsZW1lbnRg
IGV2ZW50ICh3aGljaCBpbnZva2VzIHRoZQogICAgYHdpbGxEZXN0cm95RWxlbWVudCgpYCBtZXRo
b2QgaWYgaXQgZXhpc3RzKSBvbiB0aGlzIHZpZXcgYW5kIGFsbCBjaGlsZAogICAgdmlld3MuCgog
ICAgQmVmb3JlIHRyaWdnZXJpbmcgYHdpbGxEZXN0cm95RWxlbWVudGAsIGl0IGZpcnN0IHRyaWdn
ZXJzIHRoZQogICAgYHdpbGxDbGVhclJlbmRlcmAgZXZlbnQgcmVjdXJzaXZlbHkuCgogICAgQG1l
dGhvZCBfbm90aWZ5V2lsbERlc3Ryb3lFbGVtZW50CiAgICBAcHJpdmF0ZQogICovCiAgX25vdGlm
eVdpbGxEZXN0cm95RWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICB2YXIgdmlld0NvbGxlY3Rpb24g
PSB0aGlzLnZpZXdIaWVyYXJjaHlDb2xsZWN0aW9uKCk7CiAgICB2aWV3Q29sbGVjdGlvbi50cmln
Z2VyKCd3aWxsQ2xlYXJSZW5kZXInKTsKICAgIHZpZXdDb2xsZWN0aW9uLnRyaWdnZXIoJ3dpbGxE
ZXN0cm95RWxlbWVudCcpOwogICAgcmV0dXJuIHZpZXdDb2xsZWN0aW9uOwogIH0sCgogIC8qKgog
ICAgSWYgdGhpcyB2aWV3J3MgZWxlbWVudCBjaGFuZ2VzLCB3ZSBuZWVkIHRvIGludmFsaWRhdGUg
dGhlIGNhY2hlcyBvZiBvdXIKICAgIGNoaWxkIHZpZXdzIHNvIHRoYXQgd2UgZG8gbm90IHJldGFp
biByZWZlcmVuY2VzIHRvIERPTSBlbGVtZW50cyB0aGF0IGFyZQogICAgbm8gbG9uZ2VyIG5lZWRl
ZC4KCiAgICBAbWV0aG9kIF9lbGVtZW50RGlkQ2hhbmdlCiAgICBAcHJpdmF0ZQogICovCiAgX2Vs
ZW1lbnREaWRDaGFuZ2U6IEVtYmVyLm9ic2VydmVyKCdlbGVtZW50JywgZnVuY3Rpb24oKSB7CiAg
ICB0aGlzLmZvckVhY2hDaGlsZFZpZXcoZnVuY3Rpb24odmlldykgewogICAgICBkZWxldGUgbWV0
YSh2aWV3KS5jYWNoZS5lbGVtZW50OwogICAgfSk7CiAgfSksCgogIC8qKgogICAgQ2FsbGVkIHdo
ZW4gdGhlIHBhcmVudFZpZXcgcHJvcGVydHkgaGFzIGNoYW5nZWQuCgogICAgQGV2ZW50IHBhcmVu
dFZpZXdEaWRDaGFuZ2UKICAqLwogIHBhcmVudFZpZXdEaWRDaGFuZ2U6IEVtYmVyLkssCgogIGlu
c3RydW1lbnROYW1lOiAndmlldycsCgogIGluc3RydW1lbnREZXRhaWxzOiBmdW5jdGlvbihoYXNo
KSB7CiAgICBoYXNoLnRlbXBsYXRlID0gZ2V0KHRoaXMsICd0ZW1wbGF0ZU5hbWUnKTsKICAgIHRo
aXMuX3N1cGVyKGhhc2gpOwogIH0sCgogIF9yZW5kZXJUb0J1ZmZlcjogZnVuY3Rpb24ocGFyZW50
QnVmZmVyLCBidWZmZXJPcGVyYXRpb24pIHsKICAgIHRoaXMubGVuZ3RoQmVmb3JlUmVuZGVyID0g
dGhpcy5fY2hpbGRWaWV3cy5sZW5ndGg7CiAgICB2YXIgYnVmZmVyID0gdGhpcy5fc3VwZXIocGFy
ZW50QnVmZmVyLCBidWZmZXJPcGVyYXRpb24pOwogICAgdGhpcy5sZW5ndGhBZnRlclJlbmRlciA9
IHRoaXMuX2NoaWxkVmlld3MubGVuZ3RoOwoKICAgIHJldHVybiBidWZmZXI7CiAgfSwKCiAgcmVu
ZGVyVG9CdWZmZXJJZk5lZWRlZDogZnVuY3Rpb24gKGJ1ZmZlcikgewogICAgcmV0dXJuIHRoaXMu
Y3VycmVudFN0YXRlLnJlbmRlclRvQnVmZmVySWZOZWVkZWQodGhpcywgYnVmZmVyKTsKICB9LAoK
ICBiZWZvcmVSZW5kZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgdGhpcy5hcHBseUF0dHJpYnV0
ZXNUb0J1ZmZlcihidWZmZXIpOwogICAgYnVmZmVyLnB1c2hPcGVuaW5nVGFnKCk7CiAgfSwKCiAg
YWZ0ZXJSZW5kZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgYnVmZmVyLnB1c2hDbG9zaW5nVGFn
KCk7CiAgfSwKCiAgYXBwbHlBdHRyaWJ1dGVzVG9CdWZmZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewog
ICAgLy8gQ3JlYXRlcyBvYnNlcnZlcnMgZm9yIGFsbCByZWdpc3RlcmVkIGNsYXNzIG5hbWUgYW5k
IGF0dHJpYnV0ZSBiaW5kaW5ncywKICAgIC8vIHRoZW4gYWRkcyB0aGVtIHRvIHRoZSBlbGVtZW50
LgogICAgdmFyIGNsYXNzTmFtZUJpbmRpbmdzID0gZ2V0KHRoaXMsICdjbGFzc05hbWVCaW5kaW5n
cycpOwogICAgaWYgKGNsYXNzTmFtZUJpbmRpbmdzLmxlbmd0aCkgewogICAgICB0aGlzLl9hcHBs
eUNsYXNzTmFtZUJpbmRpbmdzKGNsYXNzTmFtZUJpbmRpbmdzKTsKICAgIH0KCiAgICAvLyBQYXNz
IHRoZSByZW5kZXIgYnVmZmVyIHNvIHRoZSBtZXRob2QgY2FuIGFwcGx5IGF0dHJpYnV0ZXMgZGly
ZWN0bHkuCiAgICAvLyBUaGlzIGlzbid0IG5lZWRlZCBmb3IgY2xhc3MgbmFtZSBiaW5kaW5ncyBi
ZWNhdXNlIHRoZXkgdXNlIHRoZQogICAgLy8gZXhpc3RpbmcgY2xhc3NOYW1lcyBpbmZyYXN0cnVj
dHVyZS4KICAgIHZhciBhdHRyaWJ1dGVCaW5kaW5ncyA9IGdldCh0aGlzLCAnYXR0cmlidXRlQmlu
ZGluZ3MnKTsKICAgIGlmIChhdHRyaWJ1dGVCaW5kaW5ncy5sZW5ndGgpIHsKICAgICAgdGhpcy5f
YXBwbHlBdHRyaWJ1dGVCaW5kaW5ncyhidWZmZXIsIGF0dHJpYnV0ZUJpbmRpbmdzKTsKICAgIH0K
CiAgICBidWZmZXIuc2V0Q2xhc3Nlcyh0aGlzLmNsYXNzTmFtZXMpOwogICAgYnVmZmVyLmlkKHRo
aXMuZWxlbWVudElkKTsKCiAgICB2YXIgcm9sZSA9IGdldCh0aGlzLCAnYXJpYVJvbGUnKTsKICAg
IGlmIChyb2xlKSB7CiAgICAgIGJ1ZmZlci5hdHRyKCdyb2xlJywgcm9sZSk7CiAgICB9CgogICAg
aWYgKGdldCh0aGlzLCAnaXNWaXNpYmxlJykgPT09IGZhbHNlKSB7CiAgICAgIGJ1ZmZlci5zdHls
ZSgnZGlzcGxheScsICdub25lJyk7CiAgICB9CiAgfSwKCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogIC8vIFNUQU5EQVJEIFJF
TkRFUiBQUk9QRVJUSUVTCiAgLy8KCiAgLyoqCiAgICBUYWcgbmFtZSBmb3IgdGhlIHZpZXcncyBv
dXRlciBlbGVtZW50LiBUaGUgdGFnIG5hbWUgaXMgb25seSB1c2VkIHdoZW4gYW4KICAgIGVsZW1l
bnQgaXMgZmlyc3QgY3JlYXRlZC4gSWYgeW91IGNoYW5nZSB0aGUgYHRhZ05hbWVgIGZvciBhbiBl
bGVtZW50LCB5b3UKICAgIG11c3QgZGVzdHJveSBhbmQgcmVjcmVhdGUgdGhlIHZpZXcgZWxlbWVu
dC4KCiAgICBCeSBkZWZhdWx0LCB0aGUgcmVuZGVyIGJ1ZmZlciB3aWxsIHVzZSBhIGA8ZGl2PmAg
dGFnIGZvciB2aWV3cy4KCiAgICBAcHJvcGVydHkgdGFnTmFtZQogICAgQHR5cGUgU3RyaW5nCiAg
ICBAZGVmYXVsdCBudWxsCiAgKi8KCiAgLy8gV2UgbGVhdmUgdGhpcyBudWxsIGJ5IGRlZmF1bHQg
c28gd2UgY2FuIHRlbGwgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbgogIC8vIHRoZSBkZWZhdWx0IGNh
c2UgYW5kIGEgdXNlci1zcGVjaWZpZWQgdGFnLgogIHRhZ05hbWU6IG51bGwsCgogIC8qKgogICAg
VGhlIFdBSS1BUklBIHJvbGUgb2YgdGhlIGNvbnRyb2wgcmVwcmVzZW50ZWQgYnkgdGhpcyB2aWV3
LiBGb3IgZXhhbXBsZSwgYQogICAgYnV0dG9uIG1heSBoYXZlIGEgcm9sZSBvZiB0eXBlICdidXR0
b24nLCBvciBhIHBhbmUgbWF5IGhhdmUgYSByb2xlIG9mCiAgICB0eXBlICdhbGVydGRpYWxvZycu
IFRoaXMgcHJvcGVydHkgaXMgdXNlZCBieSBhc3Npc3RpdmUgc29mdHdhcmUgdG8gaGVscAogICAg
dmlzdWFsbHkgY2hhbGxlbmdlZCB1c2VycyBuYXZpZ2F0ZSByaWNoIHdlYiBhcHBsaWNhdGlvbnMu
CgogICAgVGhlIGZ1bGwgbGlzdCBvZiB2YWxpZCBXQUktQVJJQSByb2xlcyBpcyBhdmFpbGFibGUg
YXQ6CiAgICBbaHR0cDovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEvcm9sZXMjcm9sZXNfY2F0ZWdv
cml6YXRpb25dKGh0dHA6Ly93d3cudzMub3JnL1RSL3dhaS1hcmlhL3JvbGVzI3JvbGVzX2NhdGVn
b3JpemF0aW9uKQoKICAgIEBwcm9wZXJ0eSBhcmlhUm9sZQogICAgQHR5cGUgU3RyaW5nCiAgICBA
ZGVmYXVsdCBudWxsCiAgKi8KICBhcmlhUm9sZTogbnVsbCwKCiAgLyoqCiAgICBTdGFuZGFyZCBD
U1MgY2xhc3MgbmFtZXMgdG8gYXBwbHkgdG8gdGhlIHZpZXcncyBvdXRlciBlbGVtZW50LiBUaGlz
CiAgICBwcm9wZXJ0eSBhdXRvbWF0aWNhbGx5IGluaGVyaXRzIGFueSBjbGFzcyBuYW1lcyBkZWZp
bmVkIGJ5IHRoZSB2aWV3J3MKICAgIHN1cGVyY2xhc3NlcyBhcyB3ZWxsLgoKICAgIEBwcm9wZXJ0
eSBjbGFzc05hbWVzCiAgICBAdHlwZSBBcnJheQogICAgQGRlZmF1bHQgWydlbWJlci12aWV3J10K
ICAqLwogIGNsYXNzTmFtZXM6IFsnZW1iZXItdmlldyddLAoKICAvKioKICAgIEEgbGlzdCBvZiBw
cm9wZXJ0aWVzIG9mIHRoZSB2aWV3IHRvIGFwcGx5IGFzIGNsYXNzIG5hbWVzLiBJZiB0aGUgcHJv
cGVydHkKICAgIGlzIGEgc3RyaW5nIHZhbHVlLCB0aGUgdmFsdWUgb2YgdGhhdCBzdHJpbmcgd2ls
bCBiZSBhcHBsaWVkIGFzIGEgY2xhc3MKICAgIG5hbWUuCgogICAgYGBgamF2YXNjcmlwdAogICAg
Ly8gQXBwbGllcyB0aGUgJ2hpZ2gnIGNsYXNzIHRvIHRoZSB2aWV3IGVsZW1lbnQKICAgIEVtYmVy
LlZpZXcuZXh0ZW5kKHsKICAgICAgY2xhc3NOYW1lQmluZGluZ3M6IFsncHJpb3JpdHknXQogICAg
ICBwcmlvcml0eTogJ2hpZ2gnCiAgICB9KTsKICAgIGBgYAoKICAgIElmIHRoZSB2YWx1ZSBvZiB0
aGUgcHJvcGVydHkgaXMgYSBCb29sZWFuLCB0aGUgbmFtZSBvZiB0aGF0IHByb3BlcnR5IGlzCiAg
ICBhZGRlZCBhcyBhIGRhc2hlcml6ZWQgY2xhc3MgbmFtZS4KCiAgICBgYGBqYXZhc2NyaXB0CiAg
ICAvLyBBcHBsaWVzIHRoZSAnaXMtdXJnZW50JyBjbGFzcyB0byB0aGUgdmlldyBlbGVtZW50CiAg
ICBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICAgIGNsYXNzTmFtZUJpbmRpbmdzOiBbJ2lzVXJnZW50
J10KICAgICAgaXNVcmdlbnQ6IHRydWUKICAgIH0pOwogICAgYGBgCgogICAgSWYgeW91IHdvdWxk
IHByZWZlciB0byB1c2UgYSBjdXN0b20gdmFsdWUgaW5zdGVhZCBvZiB0aGUgZGFzaGVyaXplZAog
ICAgcHJvcGVydHkgbmFtZSwgeW91IGNhbiBwYXNzIGEgYmluZGluZyBsaWtlIHRoaXM6CgogICAg
YGBgamF2YXNjcmlwdAogICAgLy8gQXBwbGllcyB0aGUgJ3VyZ2VudCcgY2xhc3MgdG8gdGhlIHZp
ZXcgZWxlbWVudAogICAgRW1iZXIuVmlldy5leHRlbmQoewogICAgICBjbGFzc05hbWVCaW5kaW5n
czogWydpc1VyZ2VudDp1cmdlbnQnXQogICAgICBpc1VyZ2VudDogdHJ1ZQogICAgfSk7CiAgICBg
YGAKCiAgICBUaGlzIGxpc3Qgb2YgcHJvcGVydGllcyBpcyBpbmhlcml0ZWQgZnJvbSB0aGUgdmll
dydzIHN1cGVyY2xhc3NlcyBhcyB3ZWxsLgoKICAgIEBwcm9wZXJ0eSBjbGFzc05hbWVCaW5kaW5n
cwogICAgQHR5cGUgQXJyYXkKICAgIEBkZWZhdWx0IFtdCiAgKi8KICBjbGFzc05hbWVCaW5kaW5n
czogRU1QVFlfQVJSQVksCgogIC8qKgogICAgQSBsaXN0IG9mIHByb3BlcnRpZXMgb2YgdGhlIHZp
ZXcgdG8gYXBwbHkgYXMgYXR0cmlidXRlcy4gSWYgdGhlIHByb3BlcnR5IGlzCiAgICBhIHN0cmlu
ZyB2YWx1ZSwgdGhlIHZhbHVlIG9mIHRoYXQgc3RyaW5nIHdpbGwgYmUgYXBwbGllZCBhcyB0aGUg
YXR0cmlidXRlLgoKICAgIGBgYGphdmFzY3JpcHQKICAgIC8vIEFwcGxpZXMgdGhlIHR5cGUgYXR0
cmlidXRlIHRvIHRoZSBlbGVtZW50CiAgICAvLyB3aXRoIHRoZSB2YWx1ZSAiYnV0dG9uIiwgbGlr
ZSA8ZGl2IHR5cGU9ImJ1dHRvbiI+CiAgICBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICAgIGF0dHJp
YnV0ZUJpbmRpbmdzOiBbJ3R5cGUnXSwKICAgICAgdHlwZTogJ2J1dHRvbicKICAgIH0pOwogICAg
YGBgCgogICAgSWYgdGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBpcyBhIEJvb2xlYW4sIHRoZSBu
YW1lIG9mIHRoYXQgcHJvcGVydHkgaXMKICAgIGFkZGVkIGFzIGFuIGF0dHJpYnV0ZS4KCiAgICBg
YGBqYXZhc2NyaXB0CiAgICAvLyBSZW5kZXJzIHNvbWV0aGluZyBsaWtlIDxkaXYgZW5hYmxlZD0i
ZW5hYmxlZCI+CiAgICBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICAgIGF0dHJpYnV0ZUJpbmRpbmdz
OiBbJ2VuYWJsZWQnXSwKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgfSk7CiAgICBgYGAKCiAgICBA
cHJvcGVydHkgYXR0cmlidXRlQmluZGluZ3MKICAqLwogIGF0dHJpYnV0ZUJpbmRpbmdzOiBFTVBU
WV9BUlJBWSwKCiAgLy8gLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u
Li4uLi4uLi4uLi4uLgogIC8vIENPUkUgRElTUExBWSBNRVRIT0RTCiAgLy8KCiAgLyoqCiAgICBT
ZXR1cCBhIHZpZXcsIGJ1dCBkbyBub3QgZmluaXNoIHdha2luZyBpdCB1cC4KCiAgICAqIGNvbmZp
Z3VyZSBgY2hpbGRWaWV3c2AKICAgICogcmVnaXN0ZXIgdGhlIHZpZXcgd2l0aCB0aGUgZ2xvYmFs
IHZpZXdzIGhhc2gsIHdoaWNoIGlzIHVzZWQgZm9yIGV2ZW50CiAgICAgIGRpc3BhdGNoCgogICAg
QG1ldGhvZCBpbml0CiAgICBAcHJpdmF0ZQogICovCiAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICB0
aGlzLmVsZW1lbnRJZCA9IHRoaXMuZWxlbWVudElkIHx8IGd1aWRGb3IodGhpcyk7CgogICAgdGhp
cy5fc3VwZXIoKTsKCiAgICAvLyBzZXR1cCBjaGlsZCB2aWV3cy4gYmUgc3VyZSB0byBjbG9uZSB0
aGUgY2hpbGQgdmlld3MgYXJyYXkgZmlyc3QKICAgIHRoaXMuX2NoaWxkVmlld3MgPSB0aGlzLl9j
aGlsZFZpZXdzLnNsaWNlKCk7CgogICAgRW1iZXIuYXNzZXJ0KCJPbmx5IGFycmF5cyBhcmUgYWxs
b3dlZCBmb3IgJ2NsYXNzTmFtZUJpbmRpbmdzJyIsIEVtYmVyLnR5cGVPZih0aGlzLmNsYXNzTmFt
ZUJpbmRpbmdzKSA9PT0gJ2FycmF5Jyk7CiAgICB0aGlzLmNsYXNzTmFtZUJpbmRpbmdzID0gRW1i
ZXIuQSh0aGlzLmNsYXNzTmFtZUJpbmRpbmdzLnNsaWNlKCkpOwoKICAgIEVtYmVyLmFzc2VydCgi
T25seSBhcnJheXMgYXJlIGFsbG93ZWQgZm9yICdjbGFzc05hbWVzJyIsIEVtYmVyLnR5cGVPZih0
aGlzLmNsYXNzTmFtZXMpID09PSAnYXJyYXknKTsKICAgIHRoaXMuY2xhc3NOYW1lcyA9IEVtYmVy
LkEodGhpcy5jbGFzc05hbWVzLnNsaWNlKCkpOwogIH0sCgogIGFwcGVuZENoaWxkOiBmdW5jdGlv
bih2aWV3LCBvcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUuYXBwZW5kQ2hp
bGQodGhpcywgdmlldywgb3B0aW9ucyk7CiAgfSwKCiAgLyoqCiAgICBSZW1vdmVzIHRoZSBjaGls
ZCB2aWV3IGZyb20gdGhlIHBhcmVudCB2aWV3LgoKICAgIEBtZXRob2QgcmVtb3ZlQ2hpbGQKICAg
IEBwYXJhbSB7RW1iZXIuVmlld30gdmlldwogICAgQHJldHVybiB7RW1iZXIuVmlld30gcmVjZWl2
ZXIKICAqLwogIHJlbW92ZUNoaWxkOiBmdW5jdGlvbih2aWV3KSB7CiAgICAvLyBJZiB3ZSdyZSBk
ZXN0cm95aW5nLCB0aGUgZW50aXJlIHN1YnRyZWUgd2lsbCBiZQogICAgLy8gZnJlZWQsIGFuZCB0
aGUgRE9NIHdpbGwgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5LAogICAgLy8gc28gbm8gbmVlZCB0byBt
ZXNzIHdpdGggY2hpbGRWaWV3cy4KICAgIGlmICh0aGlzLmlzRGVzdHJveWluZykgeyByZXR1cm47
IH0KCiAgICAvLyB1cGRhdGUgcGFyZW50IG5vZGUKICAgIHNldCh2aWV3LCAnX3BhcmVudFZpZXcn
LCBudWxsKTsKCiAgICAvLyByZW1vdmUgdmlldyBmcm9tIGNoaWxkVmlld3MgYXJyYXkuCiAgICB2
YXIgY2hpbGRWaWV3cyA9IHRoaXMuX2NoaWxkVmlld3M7CgogICAgRW1iZXIuRW51bWVyYWJsZVV0
aWxzLnJlbW92ZU9iamVjdChjaGlsZFZpZXdzLCB2aWV3KTsKCiAgICB0aGlzLnByb3BlcnR5RGlk
Q2hhbmdlKCdjaGlsZFZpZXdzJyk7IC8vIEhVSD8hIHdoYXQgaGFwcGVuZWQgdG8gd2lsbCBjaGFu
Z2U/CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICBSZW1vdmVzIGFsbCBjaGlsZHJl
biBmcm9tIHRoZSBgcGFyZW50Vmlld2AuCgogICAgQG1ldGhvZCByZW1vdmVBbGxDaGlsZHJlbgog
ICAgQHJldHVybiB7RW1iZXIuVmlld30gcmVjZWl2ZXIKICAqLwogIHJlbW92ZUFsbENoaWxkcmVu
OiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLm11dGF0ZUNoaWxkVmlld3MoZnVuY3Rpb24o
cGFyZW50VmlldywgdmlldykgewogICAgICBwYXJlbnRWaWV3LnJlbW92ZUNoaWxkKHZpZXcpOwog
ICAgfSk7CiAgfSwKCiAgZGVzdHJveUFsbENoaWxkcmVuOiBmdW5jdGlvbigpIHsKICAgIHJldHVy
biB0aGlzLm11dGF0ZUNoaWxkVmlld3MoZnVuY3Rpb24ocGFyZW50VmlldywgdmlldykgewogICAg
ICB2aWV3LmRlc3Ryb3koKTsKICAgIH0pOwogIH0sCgogIC8qKgogICAgUmVtb3ZlcyB0aGUgdmll
dyBmcm9tIGl0cyBgcGFyZW50Vmlld2AsIGlmIG9uZSBpcyBmb3VuZC4gT3RoZXJ3aXNlCiAgICBk
b2VzIG5vdGhpbmcuCgogICAgQG1ldGhvZCByZW1vdmVGcm9tUGFyZW50CiAgICBAcmV0dXJuIHtF
bWJlci5WaWV3fSByZWNlaXZlcgogICovCiAgcmVtb3ZlRnJvbVBhcmVudDogZnVuY3Rpb24oKSB7
CiAgICB2YXIgcGFyZW50ID0gdGhpcy5fcGFyZW50VmlldzsKCiAgICAvLyBSZW1vdmUgRE9NIGVs
ZW1lbnQgZnJvbSBwYXJlbnQKICAgIHRoaXMucmVtb3ZlKCk7CgogICAgaWYgKHBhcmVudCkgeyBw
YXJlbnQucmVtb3ZlQ2hpbGQodGhpcyk7IH0KICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgog
ICAgWW91IG11c3QgY2FsbCBgZGVzdHJveWAgb24gYSB2aWV3IHRvIGRlc3Ryb3kgdGhlIHZpZXcg
KGFuZCBhbGwgb2YgaXRzCiAgICBjaGlsZCB2aWV3cykuIFRoaXMgd2lsbCByZW1vdmUgdGhlIHZp
ZXcgZnJvbSBhbnkgcGFyZW50IG5vZGUsIHRoZW4gbWFrZQogICAgc3VyZSB0aGF0IHRoZSBET00g
ZWxlbWVudCBtYW5hZ2VkIGJ5IHRoZSB2aWV3IGNhbiBiZSByZWxlYXNlZCBieSB0aGUKICAgIG1l
bW9yeSBtYW5hZ2VyLgoKICAgIEBtZXRob2QgZGVzdHJveQogICovCiAgZGVzdHJveTogZnVuY3Rp
b24oKSB7CiAgICB2YXIgY2hpbGRWaWV3cyA9IHRoaXMuX2NoaWxkVmlld3MsCiAgICAgICAgLy8g
Z2V0IHBhcmVudFZpZXcgYmVmb3JlIGNhbGxpbmcgc3VwZXIgYmVjYXVzZSBpdCdsbCBiZSBkZXN0
cm95ZWQKICAgICAgICBub25WaXJ0dWFsUGFyZW50VmlldyA9IGdldCh0aGlzLCAncGFyZW50Vmll
dycpLAogICAgICAgIHZpZXdOYW1lID0gdGhpcy52aWV3TmFtZSwKICAgICAgICBjaGlsZExlbiwg
aTsKCiAgICBpZiAoIXRoaXMuX3N1cGVyKCkpIHsgcmV0dXJuOyB9CgogICAgY2hpbGRMZW4gPSBj
aGlsZFZpZXdzLmxlbmd0aDsKICAgIGZvciAoaT1jaGlsZExlbi0xOyBpPj0wOyBpLS0pIHsKICAg
ICAgY2hpbGRWaWV3c1tpXS5yZW1vdmVkRnJvbURPTSA9IHRydWU7CiAgICB9CgogICAgLy8gcmVt
b3ZlIGZyb20gbm9uLXZpcnR1YWwgcGFyZW50IHZpZXcgaWYgdmlld05hbWUgd2FzIHNwZWNpZmll
ZAogICAgaWYgKHZpZXdOYW1lICYmIG5vblZpcnR1YWxQYXJlbnRWaWV3KSB7CiAgICAgIG5vblZp
cnR1YWxQYXJlbnRWaWV3LnNldCh2aWV3TmFtZSwgbnVsbCk7CiAgICB9CgogICAgY2hpbGRMZW4g
PSBjaGlsZFZpZXdzLmxlbmd0aDsKICAgIGZvciAoaT1jaGlsZExlbi0xOyBpPj0wOyBpLS0pIHsK
ICAgICAgY2hpbGRWaWV3c1tpXS5kZXN0cm95KCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAg
fSwKCiAgLyoqCiAgICBJbnN0YW50aWF0ZXMgYSB2aWV3IHRvIGJlIGFkZGVkIHRvIHRoZSBjaGls
ZFZpZXdzIGFycmF5IGR1cmluZyB2aWV3CiAgICBpbml0aWFsaXphdGlvbi4gWW91IGdlbmVyYWxs
eSB3aWxsIG5vdCBjYWxsIHRoaXMgbWV0aG9kIGRpcmVjdGx5IHVubGVzcwogICAgeW91IGFyZSBv
dmVycmlkaW5nIGBjcmVhdGVDaGlsZFZpZXdzKClgLiBOb3RlIHRoYXQgdGhpcyBtZXRob2Qgd2ls
bAogICAgYXV0b21hdGljYWxseSBjb25maWd1cmUgdGhlIGNvcnJlY3Qgc2V0dGluZ3Mgb24gdGhl
IG5ldyB2aWV3IGluc3RhbmNlIHRvCiAgICBhY3QgYXMgYSBjaGlsZCBvZiB0aGUgcGFyZW50LgoK
ICAgIEBtZXRob2QgY3JlYXRlQ2hpbGRWaWV3CiAgICBAcGFyYW0ge0NsYXNzfFN0cmluZ30gdmll
d0NsYXNzCiAgICBAcGFyYW0ge0hhc2h9IFthdHRyc10gQXR0cmlidXRlcyB0byBhZGQKICAgIEBy
ZXR1cm4ge0VtYmVyLlZpZXd9IG5ldyBpbnN0YW5jZQogICovCiAgY3JlYXRlQ2hpbGRWaWV3OiBm
dW5jdGlvbih2aWV3LCBhdHRycykgewogICAgaWYgKCF2aWV3KSB7CiAgICAgIHRocm93IG5ldyBU
eXBlRXJyb3IoImNyZWF0ZUNoaWxkVmlld3MgZmlyc3QgYXJndW1lbnQgbXVzdCBleGlzdCIpOwog
ICAgfQoKICAgIGlmICh2aWV3LmlzVmlldyAmJiB2aWV3Ll9wYXJlbnRWaWV3ID09PSB0aGlzICYm
IHZpZXcuY29udGFpbmVyID09PSB0aGlzLmNvbnRhaW5lcikgewogICAgICByZXR1cm4gdmlldzsK
ICAgIH0KCiAgICBhdHRycyA9IGF0dHJzIHx8IHt9OwogICAgYXR0cnMuX3BhcmVudFZpZXcgPSB0
aGlzOwoKICAgIGlmIChFbWJlci5Db3JlVmlldy5kZXRlY3QodmlldykpIHsKICAgICAgYXR0cnMu
dGVtcGxhdGVEYXRhID0gYXR0cnMudGVtcGxhdGVEYXRhIHx8IGdldCh0aGlzLCAndGVtcGxhdGVE
YXRhJyk7CgogICAgICBhdHRycy5jb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjsKICAgICAgdmll
dyA9IHZpZXcuY3JlYXRlKGF0dHJzKTsKCiAgICAgIC8vIGRvbid0IHNldCB0aGUgcHJvcGVydHkg
b24gYSB2aXJ0dWFsIHZpZXcsIGFzIHRoZXkgYXJlIGludmlzaWJsZSB0bwogICAgICAvLyBjb25z
dW1lcnMgb2YgdGhlIHZpZXcgQVBJCiAgICAgIGlmICh2aWV3LnZpZXdOYW1lKSB7CiAgICAgICAg
c2V0KGdldCh0aGlzLCAnY29uY3JldGVWaWV3JyksIHZpZXcudmlld05hbWUsIHZpZXcpOwogICAg
ICB9CiAgICB9IGVsc2UgaWYgKCdzdHJpbmcnID09PSB0eXBlb2YgdmlldykgewogICAgICB2YXIg
ZnVsbE5hbWUgPSAndmlldzonICsgdmlldzsKICAgICAgdmFyIFZpZXcgPSB0aGlzLmNvbnRhaW5l
ci5sb29rdXBGYWN0b3J5KGZ1bGxOYW1lKTsKCiAgICAgIEVtYmVyLmFzc2VydCgiQ291bGQgbm90
IGZpbmQgdmlldzogJyIgKyBmdWxsTmFtZSArICInIiwgISFWaWV3KTsKCiAgICAgIGF0dHJzLnRl
bXBsYXRlRGF0YSA9IGdldCh0aGlzLCAndGVtcGxhdGVEYXRhJyk7CiAgICAgIHZpZXcgPSBWaWV3
LmNyZWF0ZShhdHRycyk7CiAgICB9IGVsc2UgewogICAgICBFbWJlci5hc3NlcnQoJ1lvdSBtdXN0
IHBhc3MgaW5zdGFuY2Ugb3Igc3ViY2xhc3Mgb2YgVmlldycsIHZpZXcuaXNWaWV3KTsKICAgICAg
YXR0cnMuY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7CgogICAgICBpZiAoIWdldCh2aWV3LCAn
dGVtcGxhdGVEYXRhJykpIHsKICAgICAgICBhdHRycy50ZW1wbGF0ZURhdGEgPSBnZXQodGhpcywg
J3RlbXBsYXRlRGF0YScpOwogICAgICB9CgogICAgICBFbWJlci5zZXRQcm9wZXJ0aWVzKHZpZXcs
IGF0dHJzKTsKCiAgICB9CgogICAgcmV0dXJuIHZpZXc7CiAgfSwKCiAgYmVjYW1lVmlzaWJsZTog
RW1iZXIuSywKICBiZWNhbWVIaWRkZW46IEVtYmVyLkssCgogIC8qKgogICAgV2hlbiB0aGUgdmll
dydzIGBpc1Zpc2libGVgIHByb3BlcnR5IGNoYW5nZXMsIHRvZ2dsZSB0aGUgdmlzaWJpbGl0eQog
ICAgZWxlbWVudCBvZiB0aGUgYWN0dWFsIERPTSBlbGVtZW50LgoKICAgIEBtZXRob2QgX2lzVmlz
aWJsZURpZENoYW5nZQogICAgQHByaXZhdGUKICAqLwogIF9pc1Zpc2libGVEaWRDaGFuZ2U6IEVt
YmVyLm9ic2VydmVyKCdpc1Zpc2libGUnLCBmdW5jdGlvbigpIHsKICAgIHZhciAkZWwgPSB0aGlz
LiQoKTsKICAgIGlmICghJGVsKSB7IHJldHVybjsgfQoKICAgIHZhciBpc1Zpc2libGUgPSBnZXQo
dGhpcywgJ2lzVmlzaWJsZScpOwoKICAgICRlbC50b2dnbGUoaXNWaXNpYmxlKTsKCiAgICBpZiAo
dGhpcy5faXNBbmNlc3RvckhpZGRlbigpKSB7IHJldHVybjsgfQoKICAgIGlmIChpc1Zpc2libGUp
IHsKICAgICAgdGhpcy5fbm90aWZ5QmVjYW1lVmlzaWJsZSgpOwogICAgfSBlbHNlIHsKICAgICAg
dGhpcy5fbm90aWZ5QmVjYW1lSGlkZGVuKCk7CiAgICB9CiAgfSksCgogIF9ub3RpZnlCZWNhbWVW
aXNpYmxlOiBmdW5jdGlvbigpIHsKICAgIHRoaXMudHJpZ2dlcignYmVjYW1lVmlzaWJsZScpOwoK
ICAgIHRoaXMuZm9yRWFjaENoaWxkVmlldyhmdW5jdGlvbih2aWV3KSB7CiAgICAgIHZhciBpc1Zp
c2libGUgPSBnZXQodmlldywgJ2lzVmlzaWJsZScpOwoKICAgICAgaWYgKGlzVmlzaWJsZSB8fCBp
c1Zpc2libGUgPT09IG51bGwpIHsKICAgICAgICB2aWV3Ll9ub3RpZnlCZWNhbWVWaXNpYmxlKCk7
CiAgICAgIH0KICAgIH0pOwogIH0sCgogIF9ub3RpZnlCZWNhbWVIaWRkZW46IGZ1bmN0aW9uKCkg
ewogICAgdGhpcy50cmlnZ2VyKCdiZWNhbWVIaWRkZW4nKTsKICAgIHRoaXMuZm9yRWFjaENoaWxk
VmlldyhmdW5jdGlvbih2aWV3KSB7CiAgICAgIHZhciBpc1Zpc2libGUgPSBnZXQodmlldywgJ2lz
VmlzaWJsZScpOwoKICAgICAgaWYgKGlzVmlzaWJsZSB8fCBpc1Zpc2libGUgPT09IG51bGwpIHsK
ICAgICAgICB2aWV3Ll9ub3RpZnlCZWNhbWVIaWRkZW4oKTsKICAgICAgfQogICAgfSk7CiAgfSwK
CiAgX2lzQW5jZXN0b3JIaWRkZW46IGZ1bmN0aW9uKCkgewogICAgdmFyIHBhcmVudCA9IGdldCh0
aGlzLCAncGFyZW50VmlldycpOwoKICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgaWYgKGdldChw
YXJlbnQsICdpc1Zpc2libGUnKSA9PT0gZmFsc2UpIHsgcmV0dXJuIHRydWU7IH0KCiAgICAgIHBh
cmVudCA9IGdldChwYXJlbnQsICdwYXJlbnRWaWV3Jyk7CiAgICB9CgogICAgcmV0dXJuIGZhbHNl
OwogIH0sCgogIGNsZWFyQnVmZmVyOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuaW52b2tlUmVjdXJz
aXZlbHkoZnVuY3Rpb24odmlldykgewogICAgICB2aWV3LmJ1ZmZlciA9IG51bGw7CiAgICB9KTsK
ICB9LAoKICB0cmFuc2l0aW9uVG86IGZ1bmN0aW9uKHN0YXRlLCBjaGlsZHJlbikgewogICAgdmFy
IHByaW9yU3RhdGUgPSB0aGlzLmN1cnJlbnRTdGF0ZSwKICAgICAgICBjdXJyZW50U3RhdGUgPSB0
aGlzLmN1cnJlbnRTdGF0ZSA9IHRoaXMuc3RhdGVzW3N0YXRlXTsKICAgIHRoaXMuc3RhdGUgPSBz
dGF0ZTsKCiAgICBpZiAocHJpb3JTdGF0ZSAmJiBwcmlvclN0YXRlLmV4aXQpIHsgcHJpb3JTdGF0
ZS5leGl0KHRoaXMpOyB9CiAgICBpZiAoY3VycmVudFN0YXRlLmVudGVyKSB7IGN1cnJlbnRTdGF0
ZS5lbnRlcih0aGlzKTsgfQogICAgaWYgKHN0YXRlID09PSAnaW5ET00nKSB7IGRlbGV0ZSBFbWJl
ci5tZXRhKHRoaXMpLmNhY2hlLmVsZW1lbnQ7IH0KCiAgICBpZiAoY2hpbGRyZW4gIT09IGZhbHNl
KSB7CiAgICAgIHRoaXMuZm9yRWFjaENoaWxkVmlldyhmdW5jdGlvbih2aWV3KSB7CiAgICAgICAg
dmlldy50cmFuc2l0aW9uVG8oc3RhdGUpOwogICAgICB9KTsKICAgIH0KICB9LAoKICAvLyAuLi4u
Li4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgLy8g
RVZFTlQgSEFORExJTkcKICAvLwoKICAvKioKICAgIEhhbmRsZSBldmVudHMgZnJvbSBgRW1iZXIu
RXZlbnREaXNwYXRjaGVyYAoKICAgIEBtZXRob2QgaGFuZGxlRXZlbnQKICAgIEBwYXJhbSBldmVu
dE5hbWUge1N0cmluZ30KICAgIEBwYXJhbSBldnQge0V2ZW50fQogICAgQHByaXZhdGUKICAqLwog
IGhhbmRsZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUsIGV2dCkgewogICAgcmV0dXJuIHRoaXMu
Y3VycmVudFN0YXRlLmhhbmRsZUV2ZW50KHRoaXMsIGV2ZW50TmFtZSwgZXZ0KTsKICB9LAoKICBy
ZWdpc3Rlck9ic2VydmVyOiBmdW5jdGlvbihyb290LCBwYXRoLCB0YXJnZXQsIG9ic2VydmVyKSB7
CiAgICBpZiAoIW9ic2VydmVyICYmICdmdW5jdGlvbicgPT09IHR5cGVvZiB0YXJnZXQpIHsKICAg
ICAgb2JzZXJ2ZXIgPSB0YXJnZXQ7CiAgICAgIHRhcmdldCA9IG51bGw7CiAgICB9CgogICAgaWYg
KCFyb290IHx8IHR5cGVvZiByb290ICE9PSAnb2JqZWN0JykgewogICAgICByZXR1cm47CiAgICB9
CgogICAgdmFyIHZpZXcgPSB0aGlzLAogICAgICAgIHN0YXRlQ2hlY2tlZE9ic2VydmVyID0gZnVu
Y3Rpb24oKSB7CiAgICAgICAgICB2aWV3LmN1cnJlbnRTdGF0ZS5pbnZva2VPYnNlcnZlcih0aGlz
LCBvYnNlcnZlcik7CiAgICAgICAgfSwKICAgICAgICBzY2hlZHVsZWRPYnNlcnZlciA9IGZ1bmN0
aW9uKCkgewogICAgICAgICAgRW1iZXIucnVuLnNjaGVkdWxlT25jZSgncmVuZGVyJywgdGhpcywg
c3RhdGVDaGVja2VkT2JzZXJ2ZXIpOwogICAgICAgIH07CgogICAgRW1iZXIuYWRkT2JzZXJ2ZXIo
cm9vdCwgcGF0aCwgdGFyZ2V0LCBzY2hlZHVsZWRPYnNlcnZlcik7CgogICAgdGhpcy5vbmUoJ3dp
bGxDbGVhclJlbmRlcicsIGZ1bmN0aW9uKCkgewogICAgICBFbWJlci5yZW1vdmVPYnNlcnZlcihy
b290LCBwYXRoLCB0YXJnZXQsIHNjaGVkdWxlZE9ic2VydmVyKTsKICAgIH0pOwogIH0KCn0pOwoK
LyoKICBEZXNjcmliZSBob3cgdGhlIHNwZWNpZmllZCBhY3Rpb25zIHNob3VsZCBiZWhhdmUgaW4g
dGhlIHZhcmlvdXMKICBzdGF0ZXMgdGhhdCBhIHZpZXcgY2FuIGV4aXN0IGluLiBQb3NzaWJsZSBz
dGF0ZXM6CgogICogcHJlUmVuZGVyOiB3aGVuIGEgdmlldyBpcyBmaXJzdCBpbnN0YW50aWF0ZWQs
IGFuZCBhZnRlciBpdHMKICAgIGVsZW1lbnQgd2FzIGRlc3Ryb3llZCwgaXQgaXMgaW4gdGhlIHBy
ZVJlbmRlciBzdGF0ZQogICogaW5CdWZmZXI6IG9uY2UgYSB2aWV3IGhhcyBiZWVuIHJlbmRlcmVk
LCBidXQgYmVmb3JlIGl0IGhhcwogICAgYmVlbiBpbnNlcnRlZCBpbnRvIHRoZSBET00sIGl0IGlz
IGluIHRoZSBpbkJ1ZmZlciBzdGF0ZQogICogaW5ET006IG9uY2UgYSB2aWV3IGhhcyBiZWVuIGlu
c2VydGVkIGludG8gdGhlIERPTSBpdCBpcyBpbgogICAgdGhlIGluRE9NIHN0YXRlLiBBIHZpZXcg
c3BlbmRzIHRoZSB2YXN0IG1ham9yaXR5IG9mIGl0cwogICAgZXhpc3RlbmNlIGluIHRoaXMgc3Rh
dGUuCiAgKiBkZXN0cm95ZWQ6IG9uY2UgYSB2aWV3IGhhcyBiZWVuIGRlc3Ryb3llZCAodXNpbmcg
dGhlIGRlc3Ryb3kKICAgIG1ldGhvZCksIGl0IGlzIGluIHRoaXMgc3RhdGUuIE5vIGZ1cnRoZXIg
YWN0aW9ucyBjYW4gYmUgaW52b2tlZAogICAgb24gYSBkZXN0cm95ZWQgdmlldy4KKi8KCiAgLy8g
aW4gdGhlIGRlc3Ryb3llZCBzdGF0ZSwgZXZlcnl0aGluZyBpcyBpbGxlZ2FsCgogIC8vIGJlZm9y
ZSByZW5kZXJpbmcgaGFzIGJlZ3VuLCBhbGwgbGVnYWwgbWFuaXB1bGF0aW9ucyBhcmUgbm9vcHMu
CgogIC8vIGluc2lkZSB0aGUgYnVmZmVyLCBsZWdhbCBtYW5pcHVsYXRpb25zIGFyZSBkb25lIG9u
IHRoZSBidWZmZXIKCiAgLy8gb25jZSB0aGUgdmlldyBoYXMgYmVlbiBpbnNlcnRlZCBpbnRvIHRo
ZSBET00sIGxlZ2FsIG1hbmlwdWxhdGlvbnMKICAvLyBhcmUgZG9uZSBvbiB0aGUgRE9NIGVsZW1l
bnQuCgpmdW5jdGlvbiBub3RpZnlNdXRhdGlvbkxpc3RlbmVycygpIHsKICBFbWJlci5ydW4ub25j
ZShFbWJlci5WaWV3LCAnbm90aWZ5TXV0YXRpb25MaXN0ZW5lcnMnKTsKfQoKdmFyIERPTU1hbmFn
ZXIgPSB7CiAgcHJlcGVuZDogZnVuY3Rpb24odmlldywgaHRtbCkgewogICAgdmlldy4kKCkucHJl
cGVuZChodG1sKTsKICAgIG5vdGlmeU11dGF0aW9uTGlzdGVuZXJzKCk7CiAgfSwKCiAgYWZ0ZXI6
IGZ1bmN0aW9uKHZpZXcsIGh0bWwpIHsKICAgIHZpZXcuJCgpLmFmdGVyKGh0bWwpOwogICAgbm90
aWZ5TXV0YXRpb25MaXN0ZW5lcnMoKTsKICB9LAoKICBodG1sOiBmdW5jdGlvbih2aWV3LCBodG1s
KSB7CiAgICB2aWV3LiQoKS5odG1sKGh0bWwpOwogICAgbm90aWZ5TXV0YXRpb25MaXN0ZW5lcnMo
KTsKICB9LAoKICByZXBsYWNlOiBmdW5jdGlvbih2aWV3KSB7CiAgICB2YXIgZWxlbWVudCA9IGdl
dCh2aWV3LCAnZWxlbWVudCcpOwoKICAgIHNldCh2aWV3LCAnZWxlbWVudCcsIG51bGwpOwoKICAg
IHZpZXcuX2luc2VydEVsZW1lbnRMYXRlcihmdW5jdGlvbigpIHsKICAgICAgRW1iZXIuJChlbGVt
ZW50KS5yZXBsYWNlV2l0aChnZXQodmlldywgJ2VsZW1lbnQnKSk7CiAgICAgIG5vdGlmeU11dGF0
aW9uTGlzdGVuZXJzKCk7CiAgICB9KTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uKHZpZXcpIHsK
ICAgIHZpZXcuJCgpLnJlbW92ZSgpOwogICAgbm90aWZ5TXV0YXRpb25MaXN0ZW5lcnMoKTsKICB9
LAoKICBlbXB0eTogZnVuY3Rpb24odmlldykgewogICAgdmlldy4kKCkuZW1wdHkoKTsKICAgIG5v
dGlmeU11dGF0aW9uTGlzdGVuZXJzKCk7CiAgfQp9OwoKRW1iZXIuVmlldy5yZW9wZW4oewogIGRv
bU1hbmFnZXI6IERPTU1hbmFnZXIKfSk7CgpFbWJlci5WaWV3LnJlb3BlbkNsYXNzKHsKCiAgLyoq
CiAgICBQYXJzZSBhIHBhdGggYW5kIHJldHVybiBhbiBvYmplY3Qgd2hpY2ggaG9sZHMgdGhlIHBh
cnNlZCBwcm9wZXJ0aWVzLgoKICAgIEZvciBleGFtcGxlIGEgcGF0aCBsaWtlICJjb250ZW50Lmlz
RW5hYmxlZDplbmFibGVkOmRpc2FibGVkIiB3aWxsIHJldHVybiB0aGUKICAgIGZvbGxvd2luZyBv
YmplY3Q6CgogICAgYGBgamF2YXNjcmlwdAogICAgewogICAgICBwYXRoOiAiY29udGVudC5pc0Vu
YWJsZWQiLAogICAgICBjbGFzc05hbWU6ICJlbmFibGVkIiwKICAgICAgZmFsc3lDbGFzc05hbWU6
ICJkaXNhYmxlZCIsCiAgICAgIGNsYXNzTmFtZXM6ICI6ZW5hYmxlZDpkaXNhYmxlZCIKICAgIH0K
ICAgIGBgYAoKICAgIEBtZXRob2QgX3BhcnNlUHJvcGVydHlQYXRoCiAgICBAc3RhdGljCiAgICBA
cHJpdmF0ZQogICovCiAgX3BhcnNlUHJvcGVydHlQYXRoOiBmdW5jdGlvbihwYXRoKSB7CiAgICB2
YXIgc3BsaXQgPSBwYXRoLnNwbGl0KCc6JyksCiAgICAgICAgcHJvcGVydHlQYXRoID0gc3BsaXRb
MF0sCiAgICAgICAgY2xhc3NOYW1lcyA9ICIiLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgICBm
YWxzeUNsYXNzTmFtZTsKCiAgICAvLyBjaGVjayBpZiB0aGUgcHJvcGVydHkgaXMgZGVmaW5lZCBh
cyBwcm9wOmNsYXNzIG9yIHByb3A6dHJ1ZUNsYXNzOmZhbHNlQ2xhc3MKICAgIGlmIChzcGxpdC5s
ZW5ndGggPiAxKSB7CiAgICAgIGNsYXNzTmFtZSA9IHNwbGl0WzFdOwogICAgICBpZiAoc3BsaXQu
bGVuZ3RoID09PSAzKSB7IGZhbHN5Q2xhc3NOYW1lID0gc3BsaXRbMl07IH0KCiAgICAgIGNsYXNz
TmFtZXMgPSAnOicgKyBjbGFzc05hbWU7CiAgICAgIGlmIChmYWxzeUNsYXNzTmFtZSkgeyBjbGFz
c05hbWVzICs9ICI6IiArIGZhbHN5Q2xhc3NOYW1lOyB9CiAgICB9CgogICAgcmV0dXJuIHsKICAg
ICAgcGF0aDogcHJvcGVydHlQYXRoLAogICAgICBjbGFzc05hbWVzOiBjbGFzc05hbWVzLAogICAg
ICBjbGFzc05hbWU6IChjbGFzc05hbWUgPT09ICcnKSA/IHVuZGVmaW5lZCA6IGNsYXNzTmFtZSwK
ICAgICAgZmFsc3lDbGFzc05hbWU6IGZhbHN5Q2xhc3NOYW1lCiAgICB9OwogIH0sCgogIC8qKgog
ICAgR2V0IHRoZSBjbGFzcyBuYW1lIGZvciBhIGdpdmVuIHZhbHVlLCBiYXNlZCBvbiB0aGUgcGF0
aCwgb3B0aW9uYWwKICAgIGBjbGFzc05hbWVgIGFuZCBvcHRpb25hbCBgZmFsc3lDbGFzc05hbWVg
LgoKICAgIC0gaWYgYSBgY2xhc3NOYW1lYCBvciBgZmFsc3lDbGFzc05hbWVgIGhhcyBiZWVuIHNw
ZWNpZmllZDoKICAgICAgLSBpZiB0aGUgdmFsdWUgaXMgdHJ1dGh5IGFuZCBgY2xhc3NOYW1lYCBo
YXMgYmVlbiBzcGVjaWZpZWQsCiAgICAgICAgYGNsYXNzTmFtZWAgaXMgcmV0dXJuZWQKICAgICAg
LSBpZiB0aGUgdmFsdWUgaXMgZmFsc3kgYW5kIGBmYWxzeUNsYXNzTmFtZWAgaGFzIGJlZW4gc3Bl
Y2lmaWVkLAogICAgICAgIGBmYWxzeUNsYXNzTmFtZWAgaXMgcmV0dXJuZWQKICAgICAgLSBvdGhl
cndpc2UgYG51bGxgIGlzIHJldHVybmVkCiAgICAtIGlmIHRoZSB2YWx1ZSBpcyBgdHJ1ZWAsIHRo
ZSBkYXNoZXJpemVkIGxhc3QgcGFydCBvZiB0aGUgc3VwcGxpZWQgcGF0aAogICAgICBpcyByZXR1
cm5lZAogICAgLSBpZiB0aGUgdmFsdWUgaXMgbm90IGBmYWxzZWAsIGB1bmRlZmluZWRgIG9yIGBu
dWxsYCwgdGhlIGB2YWx1ZWAKICAgICAgaXMgcmV0dXJuZWQKICAgIC0gaWYgbm9uZSBvZiB0aGUg
YWJvdmUgcnVsZXMgYXBwbHksIGBudWxsYCBpcyByZXR1cm5lZAoKICAgIEBtZXRob2QgX2NsYXNz
U3RyaW5nRm9yVmFsdWUKICAgIEBwYXJhbSBwYXRoCiAgICBAcGFyYW0gdmFsCiAgICBAcGFyYW0g
Y2xhc3NOYW1lCiAgICBAcGFyYW0gZmFsc3lDbGFzc05hbWUKICAgIEBzdGF0aWMKICAgIEBwcml2
YXRlCiAgKi8KICBfY2xhc3NTdHJpbmdGb3JWYWx1ZTogZnVuY3Rpb24ocGF0aCwgdmFsLCBjbGFz
c05hbWUsIGZhbHN5Q2xhc3NOYW1lKSB7CiAgICAvLyBXaGVuIHVzaW5nIHRoZSBjb2xvbiBzeW50
YXgsIGV2YWx1YXRlIHRoZSB0cnV0aGluZXNzIG9yIGZhbHNpbmVzcwogICAgLy8gb2YgdGhlIHZh
bHVlIHRvIGRldGVybWluZSB3aGljaCBjbGFzc05hbWUgdG8gcmV0dXJuCiAgICBpZiAoY2xhc3NO
YW1lIHx8IGZhbHN5Q2xhc3NOYW1lKSB7CiAgICAgIGlmIChjbGFzc05hbWUgJiYgISF2YWwpIHsK
ICAgICAgICByZXR1cm4gY2xhc3NOYW1lOwoKICAgICAgfSBlbHNlIGlmIChmYWxzeUNsYXNzTmFt
ZSAmJiAhdmFsKSB7CiAgICAgICAgcmV0dXJuIGZhbHN5Q2xhc3NOYW1lOwoKICAgICAgfSBlbHNl
IHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgIC8vIElmIHZhbHVlIGlzIGEgQm9v
bGVhbiBhbmQgdHJ1ZSwgcmV0dXJuIHRoZSBkYXNoZXJpemVkIHByb3BlcnR5CiAgICAvLyBuYW1l
LgogICAgfSBlbHNlIGlmICh2YWwgPT09IHRydWUpIHsKICAgICAgLy8gTm9ybWFsaXplIHByb3Bl
cnR5IHBhdGggdG8gYmUgc3VpdGFibGUgZm9yIHVzZQogICAgICAvLyBhcyBhIGNsYXNzIG5hbWUu
IEZvciBleGFwbGUsIGNvbnRlbnQuZm9vLmJhckJhegogICAgICAvLyBiZWNvbWVzIGJhci1iYXou
CiAgICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoJy4nKTsKICAgICAgcmV0dXJuIEVtYmVyLlN0
cmluZy5kYXNoZXJpemUocGFydHNbcGFydHMubGVuZ3RoLTFdKTsKCiAgICAvLyBJZiB0aGUgdmFs
dWUgaXMgbm90IGZhbHNlLCB1bmRlZmluZWQsIG9yIG51bGwsIHJldHVybiB0aGUgY3VycmVudAog
ICAgLy8gdmFsdWUgb2YgdGhlIHByb3BlcnR5LgogICAgfSBlbHNlIGlmICh2YWwgIT09IGZhbHNl
ICYmIHZhbCAhPSBudWxsKSB7CiAgICAgIHJldHVybiB2YWw7CgogICAgLy8gTm90aGluZyB0byBk
aXNwbGF5LiBSZXR1cm4gbnVsbCBzbyB0aGF0IHRoZSBvbGQgY2xhc3MgaXMgcmVtb3ZlZAogICAg
Ly8gYnV0IG5vIG5ldyBjbGFzcyBpcyBhZGRlZC4KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBu
dWxsOwogICAgfQogIH0KfSk7Cgp2YXIgbXV0YXRpb24gPSBFbWJlci5PYmplY3QuZXh0ZW5kKEVt
YmVyLkV2ZW50ZWQpLmNyZWF0ZSgpOwoKRW1iZXIuVmlldy5hZGRNdXRhdGlvbkxpc3RlbmVyID0g
ZnVuY3Rpb24oY2FsbGJhY2spIHsKICBtdXRhdGlvbi5vbignY2hhbmdlJywgY2FsbGJhY2spOwp9
OwoKRW1iZXIuVmlldy5yZW1vdmVNdXRhdGlvbkxpc3RlbmVyID0gZnVuY3Rpb24oY2FsbGJhY2sp
IHsKICBtdXRhdGlvbi5vZmYoJ2NoYW5nZScsIGNhbGxiYWNrKTsKfTsKCkVtYmVyLlZpZXcubm90
aWZ5TXV0YXRpb25MaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICBtdXRhdGlvbi50cmlnZ2VyKCdj
aGFuZ2UnKTsKfTsKCi8qKgogIEdsb2JhbCB2aWV3cyBoYXNoCgogIEBwcm9wZXJ0eSB2aWV3cwog
IEBzdGF0aWMKICBAdHlwZSBIYXNoCiovCkVtYmVyLlZpZXcudmlld3MgPSB7fTsKCi8vIElmIHNv
bWVvbmUgb3ZlcnJpZGVzIHRoZSBjaGlsZCB2aWV3cyBjb21wdXRlZCBwcm9wZXJ0eSB3aGVuCi8v
IGRlZmluaW5nIHRoZWlyIGNsYXNzLCB3ZSB3YW50IHRvIGJlIGFibGUgdG8gcHJvY2VzcyB0aGUg
dXNlcidzCi8vIHN1cHBsaWVkIGNoaWxkVmlld3MgYW5kIHRoZW4gcmVzdG9yZSB0aGUgb3JpZ2lu
YWwgY29tcHV0ZWQgcHJvcGVydHkKLy8gYXQgdmlldyBpbml0aWFsaXphdGlvbiB0aW1lLiBUaGlz
IGhhcHBlbnMgaW4gRW1iZXIuQ29udGFpbmVyVmlldydzIGluaXQKLy8gbWV0aG9kLgpFbWJlci5W
aWV3LmNoaWxkVmlld3NQcm9wZXJ0eSA9IGNoaWxkVmlld3NQcm9wZXJ0eTsKCkVtYmVyLlZpZXcu
YXBwbHlBdHRyaWJ1dGVCaW5kaW5ncyA9IGZ1bmN0aW9uKGVsZW0sIG5hbWUsIHZhbHVlKSB7CiAg
dmFyIHR5cGUgPSBFbWJlci50eXBlT2YodmFsdWUpOwoKICAvLyBpZiB0aGlzIGNoYW5nZXMsIGFs
c28gY2hhbmdlIHRoZSBsb2dpYyBpbiBlbWJlci1oYW5kbGViYXJzL2xpYi9oZWxwZXJzL2JpbmRp
bmcuanMKICBpZiAobmFtZSAhPT0gJ3ZhbHVlJyAmJiAodHlwZSA9PT0gJ3N0cmluZycgfHwgKHR5
cGUgPT09ICdudW1iZXInICYmICFpc05hTih2YWx1ZSkpKSkgewogICAgaWYgKHZhbHVlICE9PSBl
bGVtLmF0dHIobmFtZSkpIHsKICAgICAgZWxlbS5hdHRyKG5hbWUsIHZhbHVlKTsKICAgIH0KICB9
IGVsc2UgaWYgKG5hbWUgPT09ICd2YWx1ZScgfHwgdHlwZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAv
LyBXZSBjYW4ndCBzZXQgcHJvcGVydGllcyB0byB1bmRlZmluZWQgb3IgbnVsbAogICAgaWYgKEVt
YmVyLmlzTm9uZSh2YWx1ZSkpIHsgdmFsdWUgPSAnJzsgfQoKICAgIGlmICghdmFsdWUpIHsKICAg
ICAgZWxlbS5yZW1vdmVBdHRyKG5hbWUpOwogICAgfQoKICAgIGlmICh2YWx1ZSAhPT0gZWxlbS5w
cm9wKG5hbWUpKSB7CiAgICAgIC8vIHZhbHVlIGFuZCBib29sZWFucyBzaG91bGQgYWx3YXlzIGJl
IHByb3BlcnRpZXMKICAgICAgZWxlbS5wcm9wKG5hbWUsIHZhbHVlKTsKICAgIH0KICB9IGVsc2Ug
aWYgKCF2YWx1ZSkgewogICAgZWxlbS5yZW1vdmVBdHRyKG5hbWUpOwogIH0KfTsKCkVtYmVyLlZp
ZXcuc3RhdGVzID0gc3RhdGVzOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBl
bWJlcgpAc3VibW9kdWxlIGVtYmVyLXZpZXdzCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQg
PSBFbWJlci5zZXQ7CgpFbWJlci5WaWV3LnN0YXRlcy5fZGVmYXVsdCA9IHsKICAvLyBhcHBlbmRD
aGlsZCBpcyBvbmx5IGxlZ2FsIHdoaWxlIHJlbmRlcmluZyB0aGUgYnVmZmVyLgogIGFwcGVuZENo
aWxkOiBmdW5jdGlvbigpIHsKICAgIHRocm93ICJZb3UgY2FuJ3QgdXNlIGFwcGVuZENoaWxkIG91
dHNpZGUgb2YgdGhlIHJlbmRlcmluZyBwcm9jZXNzIjsKICB9LAoKICAkOiBmdW5jdGlvbigpIHsK
ICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfSwKCiAgZ2V0RWxlbWVudDogZnVuY3Rpb24oKSB7CiAg
ICByZXR1cm4gbnVsbDsKICB9LAoKICAvLyBIYW5kbGUgZXZlbnRzIGZyb20gYEVtYmVyLkV2ZW50
RGlzcGF0Y2hlcmAKICBoYW5kbGVFdmVudDogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdHJ1ZTsg
Ly8gY29udGludWUgZXZlbnQgcHJvcGFnYXRpb24KICB9LAoKICBkZXN0cm95RWxlbWVudDogZnVu
Y3Rpb24odmlldykgewogICAgc2V0KHZpZXcsICdlbGVtZW50JywgbnVsbCk7CiAgICBpZiAodmll
dy5fc2NoZWR1bGVkSW5zZXJ0KSB7CiAgICAgIEVtYmVyLnJ1bi5jYW5jZWwodmlldy5fc2NoZWR1
bGVkSW5zZXJ0KTsKICAgICAgdmlldy5fc2NoZWR1bGVkSW5zZXJ0ID0gbnVsbDsKICAgIH0KICAg
IHJldHVybiB2aWV3OwogIH0sCgogIHJlbmRlclRvQnVmZmVySWZOZWVkZWQ6IGZ1bmN0aW9uICgp
IHsKICAgIHJldHVybiBmYWxzZTsKICB9LAoKICByZXJlbmRlcjogRW1iZXIuSywKICBpbnZva2VP
YnNlcnZlcjogRW1iZXIuSwp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBl
bWJlcgpAc3VibW9kdWxlIGVtYmVyLXZpZXdzCiovCgp2YXIgcHJlUmVuZGVyID0gRW1iZXIuVmll
dy5zdGF0ZXMucHJlUmVuZGVyID0gRW1iZXIuY3JlYXRlKEVtYmVyLlZpZXcuc3RhdGVzLl9kZWZh
dWx0KTsKCkVtYmVyLm1lcmdlKHByZVJlbmRlciwgewogIC8vIGEgdmlldyBsZWF2ZXMgdGhlIHBy
ZVJlbmRlciBzdGF0ZSBvbmNlIGl0cyBlbGVtZW50IGhhcyBiZWVuCiAgLy8gY3JlYXRlZCAoY3Jl
YXRlRWxlbWVudCkuCiAgaW5zZXJ0RWxlbWVudDogZnVuY3Rpb24odmlldywgZm4pIHsKICAgIHZp
ZXcuY3JlYXRlRWxlbWVudCgpOwogICAgdmFyIHZpZXdDb2xsZWN0aW9uID0gdmlldy52aWV3SGll
cmFyY2h5Q29sbGVjdGlvbigpOwoKICAgIHZpZXdDb2xsZWN0aW9uLnRyaWdnZXIoJ3dpbGxJbnNl
cnRFbGVtZW50Jyk7CgogICAgZm4uY2FsbCh2aWV3KTsKCiAgICAvLyBXZSB0cmFuc2l0aW9uIHRv
IGBpbkRPTWAgaWYgdGhlIGVsZW1lbnQgZXhpc3RzIGluIHRoZSBET00KICAgIHZhciBlbGVtZW50
ID0gdmlldy5nZXQoJ2VsZW1lbnQnKTsKICAgIHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5wYXJl
bnROb2RlKSB7CiAgICAgIGlmIChlbGVtZW50ID09PSBkb2N1bWVudCkgewogICAgICAgIHZpZXdD
b2xsZWN0aW9uLnRyYW5zaXRpb25UbygnaW5ET00nLCBmYWxzZSk7CiAgICAgICAgdmlld0NvbGxl
Y3Rpb24udHJpZ2dlcignZGlkSW5zZXJ0RWxlbWVudCcpOwogICAgICB9CiAgICB9CgogIH0sCgog
IHJlbmRlclRvQnVmZmVySWZOZWVkZWQ6IGZ1bmN0aW9uKHZpZXcsIGJ1ZmZlcikgewogICAgdmll
dy5yZW5kZXJUb0J1ZmZlcihidWZmZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfSwKCiAgZW1wdHk6
IEVtYmVyLkssCgogIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKHZpZXcsIHZhbHVlKSB7CiAgICBpZiAo
dmFsdWUgIT09IG51bGwpIHsKICAgICAgdmlldy50cmFuc2l0aW9uVG8oJ2hhc0VsZW1lbnQnKTsK
ICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewov
KioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXZpZXdzCiovCgp2YXIgZ2V0ID0gRW1i
ZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7Cgp2YXIgaW5CdWZmZXIgPSBFbWJlci5WaWV3LnN0YXRl
cy5pbkJ1ZmZlciA9IEVtYmVyLmNyZWF0ZShFbWJlci5WaWV3LnN0YXRlcy5fZGVmYXVsdCk7CgpF
bWJlci5tZXJnZShpbkJ1ZmZlciwgewogICQ6IGZ1bmN0aW9uKHZpZXcsIHNlbCkgewogICAgLy8g
aWYgd2UgZG9uJ3QgaGF2ZSBhbiBlbGVtZW50IHlldCwgc29tZW9uZSBjYWxsaW5nIHRoaXMuJCgp
IGlzCiAgICAvLyB0cnlpbmcgdG8gdXBkYXRlIGFuIGVsZW1lbnQgdGhhdCBpc24ndCBpbiB0aGUg
RE9NLiBJbnN0ZWFkLAogICAgLy8gcmVyZW5kZXIgdGhlIHZpZXcgdG8gYWxsb3cgdGhlIHJlbmRl
ciBtZXRob2QgdG8gcmVmbGVjdCB0aGUKICAgIC8vIGNoYW5nZXMuCiAgICB2aWV3LnJlcmVuZGVy
KCk7CiAgICByZXR1cm4gRW1iZXIuJCgpOwogIH0sCgogIC8vIHdoZW4gYSB2aWV3IGlzIHJlbmRl
cmVkIGluIGEgYnVmZmVyLCByZXJlbmRlcmluZyBpdCBzaW1wbHkKICAvLyByZXBsYWNlcyB0aGUg
ZXhpc3RpbmcgYnVmZmVyIHdpdGggYSBuZXcgb25lCiAgcmVyZW5kZXI6IGZ1bmN0aW9uKHZpZXcp
IHsKICAgIHRocm93IG5ldyBFbWJlci5FcnJvcigiU29tZXRoaW5nIHlvdSBkaWQgY2F1c2VkIGEg
dmlldyB0byByZS1yZW5kZXIgYWZ0ZXIgaXQgcmVuZGVyZWQgYnV0IGJlZm9yZSBpdCB3YXMgaW5z
ZXJ0ZWQgaW50byB0aGUgRE9NLiIpOwogIH0sCgogIC8vIHdoZW4gYSB2aWV3IGlzIHJlbmRlcmVk
IGluIGEgYnVmZmVyLCBhcHBlbmRpbmcgYSBjaGlsZAogIC8vIHZpZXcgd2lsbCByZW5kZXIgdGhh
dCB2aWV3IGFuZCBhcHBlbmQgdGhlIHJlc3VsdGluZwogIC8vIGJ1ZmZlciBpbnRvIGl0cyBidWZm
ZXIuCiAgYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKHZpZXcsIGNoaWxkVmlldywgb3B0aW9ucykgewog
ICAgdmFyIGJ1ZmZlciA9IHZpZXcuYnVmZmVyLCBfY2hpbGRWaWV3cyA9IHZpZXcuX2NoaWxkVmll
d3M7CgogICAgY2hpbGRWaWV3ID0gdmlldy5jcmVhdGVDaGlsZFZpZXcoY2hpbGRWaWV3LCBvcHRp
b25zKTsKICAgIGlmICghX2NoaWxkVmlld3MubGVuZ3RoKSB7IF9jaGlsZFZpZXdzID0gdmlldy5f
Y2hpbGRWaWV3cyA9IF9jaGlsZFZpZXdzLnNsaWNlKCk7IH0KICAgIF9jaGlsZFZpZXdzLnB1c2go
Y2hpbGRWaWV3KTsKCiAgICBjaGlsZFZpZXcucmVuZGVyVG9CdWZmZXIoYnVmZmVyKTsKCiAgICB2
aWV3LnByb3BlcnR5RGlkQ2hhbmdlKCdjaGlsZFZpZXdzJyk7CgogICAgcmV0dXJuIGNoaWxkVmll
dzsKICB9LAoKICAvLyB3aGVuIGEgdmlldyBpcyByZW5kZXJlZCBpbiBhIGJ1ZmZlciwgZGVzdHJv
eWluZyB0aGUKICAvLyBlbGVtZW50IHdpbGwgc2ltcGx5IGRlc3Ryb3kgdGhlIGJ1ZmZlciBhbmQg
cHV0IHRoZQogIC8vIHN0YXRlIGJhY2sgaW50byB0aGUgcHJlUmVuZGVyIHN0YXRlLgogIGRlc3Ry
b3lFbGVtZW50OiBmdW5jdGlvbih2aWV3KSB7CiAgICB2aWV3LmNsZWFyQnVmZmVyKCk7CiAgICB2
YXIgdmlld0NvbGxlY3Rpb24gPSB2aWV3Ll9ub3RpZnlXaWxsRGVzdHJveUVsZW1lbnQoKTsKICAg
IHZpZXdDb2xsZWN0aW9uLnRyYW5zaXRpb25UbygncHJlUmVuZGVyJywgZmFsc2UpOwoKICAgIHJl
dHVybiB2aWV3OwogIH0sCgogIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgIEVtYmVyLmFzc2VydCgi
RW1wdHlpbmcgYSB2aWV3IGluIHRoZSBpbkJ1ZmZlciBzdGF0ZSBpcyBub3QgYWxsb3dlZCBhbmQg
IiArCiAgICAgICAgICAgICAgICAgInNob3VsZCBub3QgaGFwcGVuIHVuZGVyIG5vcm1hbCBjaXJj
dW1zdGFuY2VzLiBNb3N0IGxpa2VseSAiICsKICAgICAgICAgICAgICAgICAidGhlcmUgaXMgYSBi
dWcgaW4geW91ciBhcHBsaWNhdGlvbi4gVGhpcyBtYXkgYmUgZHVlIHRvICIgKwogICAgICAgICAg
ICAgICAgICJleGNlc3NpdmUgcHJvcGVydHkgY2hhbmdlIG5vdGlmaWNhdGlvbnMuIik7CiAgfSwK
CiAgcmVuZGVyVG9CdWZmZXJJZk5lZWRlZDogZnVuY3Rpb24gKHZpZXcsIGJ1ZmZlcikgewogICAg
cmV0dXJuIGZhbHNlOwogIH0sCgogIC8vIEl0IHNob3VsZCBiZSBpbXBvc3NpYmxlIGZvciBhIHJl
bmRlcmVkIHZpZXcgdG8gYmUgc2NoZWR1bGVkIGZvcgogIC8vIGluc2VydGlvbi4KICBpbnNlcnRF
bGVtZW50OiBmdW5jdGlvbigpIHsKICAgIHRocm93ICJZb3UgY2FuJ3QgaW5zZXJ0IGFuIGVsZW1l
bnQgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHJlbmRlcmVkIjsKICB9LAoKICBzZXRFbGVtZW50OiBm
dW5jdGlvbih2aWV3LCB2YWx1ZSkgewogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIHZp
ZXcudHJhbnNpdGlvblRvKCdwcmVSZW5kZXInKTsKICAgIH0gZWxzZSB7CiAgICAgIHZpZXcuY2xl
YXJCdWZmZXIoKTsKICAgICAgdmlldy50cmFuc2l0aW9uVG8oJ2hhc0VsZW1lbnQnKTsKICAgIH0K
CiAgICByZXR1cm4gdmFsdWU7CiAgfSwKCiAgaW52b2tlT2JzZXJ2ZXI6IGZ1bmN0aW9uKHRhcmdl
dCwgb2JzZXJ2ZXIpIHsKICAgIG9ic2VydmVyLmNhbGwodGFyZ2V0KTsKICB9Cn0pOwoKCn0pKCk7
CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3
cwoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0OwoKdmFyIGhhc0VsZW1l
bnQgPSBFbWJlci5WaWV3LnN0YXRlcy5oYXNFbGVtZW50ID0gRW1iZXIuY3JlYXRlKEVtYmVyLlZp
ZXcuc3RhdGVzLl9kZWZhdWx0KTsKCkVtYmVyLm1lcmdlKGhhc0VsZW1lbnQsIHsKICAkOiBmdW5j
dGlvbih2aWV3LCBzZWwpIHsKICAgIHZhciBlbGVtID0gZ2V0KHZpZXcsICdlbGVtZW50Jyk7CiAg
ICByZXR1cm4gc2VsID8gRW1iZXIuJChzZWwsIGVsZW0pIDogRW1iZXIuJChlbGVtKTsKICB9LAoK
ICBnZXRFbGVtZW50OiBmdW5jdGlvbih2aWV3KSB7CiAgICB2YXIgcGFyZW50ID0gZ2V0KHZpZXcs
ICdwYXJlbnRWaWV3Jyk7CiAgICBpZiAocGFyZW50KSB7IHBhcmVudCA9IGdldChwYXJlbnQsICdl
bGVtZW50Jyk7IH0KICAgIGlmIChwYXJlbnQpIHsgcmV0dXJuIHZpZXcuZmluZEVsZW1lbnRJblBh
cmVudEVsZW1lbnQocGFyZW50KTsgfQogICAgcmV0dXJuIEVtYmVyLiQoIiMiICsgZ2V0KHZpZXcs
ICdlbGVtZW50SWQnKSlbMF07CiAgfSwKCiAgc2V0RWxlbWVudDogZnVuY3Rpb24odmlldywgdmFs
dWUpIHsKICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICB2aWV3LnRyYW5zaXRpb25Ubygn
cHJlUmVuZGVyJyk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyAiWW91IGNhbm5vdCBzZXQgYW4g
ZWxlbWVudCB0byBhIG5vbi1udWxsIHZhbHVlIHdoZW4gdGhlIGVsZW1lbnQgaXMgYWxyZWFkeSBp
biB0aGUgRE9NLiI7CiAgICB9CgogICAgcmV0dXJuIHZhbHVlOwogIH0sCgogIC8vIG9uY2UgdGhl
IHZpZXcgaGFzIGJlZW4gaW5zZXJ0ZWQgaW50byB0aGUgRE9NLCByZXJlbmRlcmluZyBpcwogIC8v
IGRlZmVycmVkIHRvIGFsbG93IGJpbmRpbmdzIHRvIHN5bmNocm9uaXplLgogIHJlcmVuZGVyOiBm
dW5jdGlvbih2aWV3KSB7CiAgICB2aWV3LnRyaWdnZXJSZWN1cnNpdmVseSgnd2lsbENsZWFyUmVu
ZGVyJyk7CgogICAgdmlldy5jbGVhclJlbmRlcmVkQ2hpbGRyZW4oKTsKCiAgICB2aWV3LmRvbU1h
bmFnZXIucmVwbGFjZSh2aWV3KTsKICAgIHJldHVybiB2aWV3OwogIH0sCgogIC8vIG9uY2UgdGhl
IHZpZXcgaXMgYWxyZWFkeSBpbiB0aGUgRE9NLCBkZXN0cm95aW5nIGl0IHJlbW92ZXMgaXQKICAv
LyBmcm9tIHRoZSBET00sIG51a2VzIGl0cyBlbGVtZW50LCBhbmQgcHV0cyBpdCBiYWNrIGludG8g
dGhlCiAgLy8gcHJlUmVuZGVyIHN0YXRlIGlmIGluRE9NLgoKICBkZXN0cm95RWxlbWVudDogZnVu
Y3Rpb24odmlldykgewogICAgdmlldy5fbm90aWZ5V2lsbERlc3Ryb3lFbGVtZW50KCk7CiAgICB2
aWV3LmRvbU1hbmFnZXIucmVtb3ZlKHZpZXcpOwogICAgc2V0KHZpZXcsICdlbGVtZW50JywgbnVs
bCk7CiAgICBpZiAodmlldy5fc2NoZWR1bGVkSW5zZXJ0KSB7CiAgICAgIEVtYmVyLnJ1bi5jYW5j
ZWwodmlldy5fc2NoZWR1bGVkSW5zZXJ0KTsKICAgICAgdmlldy5fc2NoZWR1bGVkSW5zZXJ0ID0g
bnVsbDsKICAgIH0KICAgIHJldHVybiB2aWV3OwogIH0sCgogIGVtcHR5OiBmdW5jdGlvbih2aWV3
KSB7CiAgICB2YXIgX2NoaWxkVmlld3MgPSB2aWV3Ll9jaGlsZFZpZXdzLCBsZW4sIGlkeDsKICAg
IGlmIChfY2hpbGRWaWV3cykgewogICAgICBsZW4gPSBfY2hpbGRWaWV3cy5sZW5ndGg7CiAgICAg
IGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuOyBpZHgrKykgewogICAgICAgIF9jaGlsZFZpZXdzW2lk
eF0uX25vdGlmeVdpbGxEZXN0cm95RWxlbWVudCgpOwogICAgICB9CiAgICB9CiAgICB2aWV3LmRv
bU1hbmFnZXIuZW1wdHkodmlldyk7CiAgfSwKCiAgLy8gSGFuZGxlIGV2ZW50cyBmcm9tIGBFbWJl
ci5FdmVudERpc3BhdGNoZXJgCiAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uKHZpZXcsIGV2ZW50TmFt
ZSwgZXZ0KSB7CiAgICBpZiAodmlldy5oYXMoZXZlbnROYW1lKSkgewogICAgICAvLyBIYW5kbGVy
IHNob3VsZCBiZSBhYmxlIHRvIHJlLWRpc3BhdGNoIGV2ZW50cywgc28gd2UgZG9uJ3QKICAgICAg
Ly8gcHJldmVudERlZmF1bHQgb3Igc3RvcFByb3BhZ2F0aW9uLgogICAgICByZXR1cm4gdmlldy50
cmlnZ2VyKGV2ZW50TmFtZSwgZXZ0KTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0cnVlOyAv
LyBjb250aW51ZSBldmVudCBwcm9wYWdhdGlvbgogICAgfQogIH0sCgogIGludm9rZU9ic2VydmVy
OiBmdW5jdGlvbih0YXJnZXQsIG9ic2VydmVyKSB7CiAgICBvYnNlcnZlci5jYWxsKHRhcmdldCk7
CiAgfQp9KTsKCnZhciBpbkRPTSA9IEVtYmVyLlZpZXcuc3RhdGVzLmluRE9NID0gRW1iZXIuY3Jl
YXRlKGhhc0VsZW1lbnQpOwoKRW1iZXIubWVyZ2UoaW5ET00sIHsKICBlbnRlcjogZnVuY3Rpb24o
dmlldykgewogICAgLy8gUmVnaXN0ZXIgdGhlIHZpZXcgZm9yIGV2ZW50IGhhbmRsaW5nLiBUaGlz
IGhhc2ggaXMgdXNlZCBieQogICAgLy8gRW1iZXIuRXZlbnREaXNwYXRjaGVyIHRvIGRpc3BhdGNo
IGluY29taW5nIGV2ZW50cy4KICAgIGlmICghdmlldy5pc1ZpcnR1YWwpIHsKICAgICAgRW1iZXIu
YXNzZXJ0KCJBdHRlbXB0ZWQgdG8gcmVnaXN0ZXIgYSB2aWV3IHdpdGggYW4gaWQgYWxyZWFkeSBp
biB1c2U6ICIrdmlldy5lbGVtZW50SWQsICFFbWJlci5WaWV3LnZpZXdzW3ZpZXcuZWxlbWVudElk
XSk7CiAgICAgIEVtYmVyLlZpZXcudmlld3Nbdmlldy5lbGVtZW50SWRdID0gdmlldzsKICAgIH0K
CiAgICB2aWV3LmFkZEJlZm9yZU9ic2VydmVyKCdlbGVtZW50SWQnLCBmdW5jdGlvbigpIHsKICAg
ICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCJDaGFuZ2luZyBhIHZpZXcncyBlbGVtZW50SWQgYWZ0
ZXIgY3JlYXRpb24gaXMgbm90IGFsbG93ZWQiKTsKICAgIH0pOwogIH0sCgogIGV4aXQ6IGZ1bmN0
aW9uKHZpZXcpIHsKICAgIGlmICghdGhpcy5pc1ZpcnR1YWwpIGRlbGV0ZSBFbWJlci5WaWV3LnZp
ZXdzW3ZpZXcuZWxlbWVudElkXTsKICB9LAoKICBpbnNlcnRFbGVtZW50OiBmdW5jdGlvbih2aWV3
LCBmbikgewogICAgdGhyb3cgIllvdSBjYW4ndCBpbnNlcnQgYW4gZWxlbWVudCBpbnRvIHRoZSBE
T00gdGhhdCBoYXMgYWxyZWFkeSBiZWVuIGluc2VydGVkIjsKICB9Cn0pOwoKfSkoKTsKCgoKKGZ1
bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXZpZXdzCiovCgp2
YXIgZGVzdHJveWluZ0Vycm9yID0gIllvdSBjYW4ndCBjYWxsICVAIG9uIGEgdmlldyBiZWluZyBk
ZXN0cm95ZWQiLCBmbXQgPSBFbWJlci5TdHJpbmcuZm10OwoKdmFyIGRlc3Ryb3lpbmcgPSBFbWJl
ci5WaWV3LnN0YXRlcy5kZXN0cm95aW5nID0gRW1iZXIuY3JlYXRlKEVtYmVyLlZpZXcuc3RhdGVz
Ll9kZWZhdWx0KTsKCkVtYmVyLm1lcmdlKGRlc3Ryb3lpbmcsIHsKICBhcHBlbmRDaGlsZDogZnVu
Y3Rpb24oKSB7CiAgICB0aHJvdyBmbXQoZGVzdHJveWluZ0Vycm9yLCBbJ2FwcGVuZENoaWxkJ10p
OwogIH0sCiAgcmVyZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgZm10KGRlc3Ryb3lpbmdF
cnJvciwgWydyZXJlbmRlciddKTsKICB9LAogIGRlc3Ryb3lFbGVtZW50OiBmdW5jdGlvbigpIHsK
ICAgIHRocm93IGZtdChkZXN0cm95aW5nRXJyb3IsIFsnZGVzdHJveUVsZW1lbnQnXSk7CiAgfSwK
ICBlbXB0eTogZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBmbXQoZGVzdHJveWluZ0Vycm9yLCBbJ2Vt
cHR5J10pOwogIH0sCgogIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgZm10KGRl
c3Ryb3lpbmdFcnJvciwgWyJzZXQoJ2VsZW1lbnQnLCAuLi4pIl0pOwogIH0sCgogIHJlbmRlclRv
QnVmZmVySWZOZWVkZWQ6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0sCgogIC8v
IFNpbmNlIGVsZW1lbnQgaW5zZXJ0aW9uIGlzIHNjaGVkdWxlZCwgZG9uJ3QgZG8gYW55dGhpbmcg
aWYKICAvLyB0aGUgdmlldyBoYXMgYmVlbiBkZXN0cm95ZWQgYmV0d2VlbiBzY2hlZHVsaW5nIGFu
ZCBleGVjdXRpb24KICBpbnNlcnRFbGVtZW50OiBFbWJlci5LCn0pOwoKCn0pKCk7CgoKCihmdW5j
dGlvbigpIHsKRW1iZXIuVmlldy5jbG9uZVN0YXRlcyA9IGZ1bmN0aW9uKGZyb20pIHsKICB2YXIg
aW50byA9IHt9OwoKICBpbnRvLl9kZWZhdWx0ID0ge307CiAgaW50by5wcmVSZW5kZXIgPSBFbWJl
ci5jcmVhdGUoaW50by5fZGVmYXVsdCk7CiAgaW50by5kZXN0cm95aW5nID0gRW1iZXIuY3JlYXRl
KGludG8uX2RlZmF1bHQpOwogIGludG8uaW5CdWZmZXIgPSBFbWJlci5jcmVhdGUoaW50by5fZGVm
YXVsdCk7CiAgaW50by5oYXNFbGVtZW50ID0gRW1iZXIuY3JlYXRlKGludG8uX2RlZmF1bHQpOwog
IGludG8uaW5ET00gPSBFbWJlci5jcmVhdGUoaW50by5oYXNFbGVtZW50KTsKCiAgZm9yICh2YXIg
c3RhdGVOYW1lIGluIGZyb20pIHsKICAgIGlmICghZnJvbS5oYXNPd25Qcm9wZXJ0eShzdGF0ZU5h
bWUpKSB7IGNvbnRpbnVlOyB9CiAgICBFbWJlci5tZXJnZShpbnRvW3N0YXRlTmFtZV0sIGZyb21b
c3RhdGVOYW1lXSk7CiAgfQoKICByZXR1cm4gaW50bzsKfTsKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKdmFyIHN0YXRlcyA9IEVtYmVyLlZpZXcuY2xvbmVTdGF0ZXMoRW1iZXIuVmlldy5zdGF0ZXMp
OwoKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwoqLwoKdmFyIGdldCA9
IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0Owp2YXIgZm9yRWFjaCA9IEVtYmVyLkVudW1lcmFi
bGVVdGlscy5mb3JFYWNoOwp2YXIgVmlld0NvbGxlY3Rpb24gPSBFbWJlci5fVmlld0NvbGxlY3Rp
b247CgovKioKICBBIGBDb250YWluZXJWaWV3YCBpcyBhbiBgRW1iZXIuVmlld2Agc3ViY2xhc3Mg
dGhhdCBpbXBsZW1lbnRzIGBFbWJlci5NdXRhYmxlQXJyYXlgCiAgYWxsb3dpbmcgcHJvZ3JhbW1h
dGljIG1hbmFnZW1lbnQgb2YgaXRzIGNoaWxkIHZpZXdzLgoKICAjIyBTZXR0aW5nIEluaXRpYWwg
Q2hpbGQgVmlld3MKCiAgVGhlIGluaXRpYWwgYXJyYXkgb2YgY2hpbGQgdmlld3MgY2FuIGJlIHNl
dCBpbiBvbmUgb2YgdHdvIHdheXMuIFlvdSBjYW4KICBwcm92aWRlIGEgYGNoaWxkVmlld3NgIHBy
b3BlcnR5IGF0IGNyZWF0aW9uIHRpbWUgdGhhdCBjb250YWlucyBpbnN0YW5jZSBvZgogIGBFbWJl
ci5WaWV3YDoKCiAgYGBgamF2YXNjcmlwdAogIGFDb250YWluZXIgPSBFbWJlci5Db250YWluZXJW
aWV3LmNyZWF0ZSh7CiAgICBjaGlsZFZpZXdzOiBbRW1iZXIuVmlldy5jcmVhdGUoKSwgRW1iZXIu
Vmlldy5jcmVhdGUoKV0KICB9KTsKICBgYGAKCiAgWW91IGNhbiBhbHNvIHByb3ZpZGUgYSBsaXN0
IG9mIHByb3BlcnR5IG5hbWVzIHdob3NlIHZhbHVlcyBhcmUgaW5zdGFuY2VzIG9mCiAgYEVtYmVy
LlZpZXdgOgoKICBgYGBqYXZhc2NyaXB0CiAgYUNvbnRhaW5lciA9IEVtYmVyLkNvbnRhaW5lclZp
ZXcuY3JlYXRlKHsKICAgIGNoaWxkVmlld3M6IFsnYVZpZXcnLCAnYlZpZXcnLCAnY1ZpZXcnXSwK
ICAgIGFWaWV3OiBFbWJlci5WaWV3LmNyZWF0ZSgpLAogICAgYlZpZXc6IEVtYmVyLlZpZXcuY3Jl
YXRlKCksCiAgICBjVmlldzogRW1iZXIuVmlldy5jcmVhdGUoKQogIH0pOwogIGBgYAoKICBUaGUg
dHdvIHN0cmF0ZWdpZXMgY2FuIGJlIGNvbWJpbmVkOgoKICBgYGBqYXZhc2NyaXB0CiAgYUNvbnRh
aW5lciA9IEVtYmVyLkNvbnRhaW5lclZpZXcuY3JlYXRlKHsKICAgIGNoaWxkVmlld3M6IFsnYVZp
ZXcnLCBFbWJlci5WaWV3LmNyZWF0ZSgpXSwKICAgIGFWaWV3OiBFbWJlci5WaWV3LmNyZWF0ZSgp
CiAgfSk7CiAgYGBgCgogIEVhY2ggY2hpbGQgdmlldydzIHJlbmRlcmluZyB3aWxsIGJlIGluc2Vy
dGVkIGludG8gdGhlIGNvbnRhaW5lcidzIHJlbmRlcmVkCiAgSFRNTCBpbiB0aGUgc2FtZSBvcmRl
ciBhcyBpdHMgcG9zaXRpb24gaW4gdGhlIGBjaGlsZFZpZXdzYCBwcm9wZXJ0eS4KCiAgIyMgQWRk
aW5nIGFuZCBSZW1vdmluZyBDaGlsZCBWaWV3cwoKICBUaGUgY29udGFpbmVyIHZpZXcgaW1wbGVt
ZW50cyBgRW1iZXIuTXV0YWJsZUFycmF5YCBhbGxvd2luZyBwcm9ncmFtbWF0aWMgbWFuYWdlbWVu
dCBvZiBpdHMgY2hpbGQgdmlld3MuCgogIFRvIHJlbW92ZSBhIHZpZXcsIHBhc3MgdGhhdCB2aWV3
IGludG8gYSBgcmVtb3ZlT2JqZWN0YCBjYWxsIG9uIHRoZSBjb250YWluZXIgdmlldy4KCiAgR2l2
ZW4gYW4gZW1wdHkgYDxib2R5PmAgdGhlIGZvbGxvd2luZyBjb2RlCgogIGBgYGphdmFzY3JpcHQK
ICBhQ29udGFpbmVyID0gRW1iZXIuQ29udGFpbmVyVmlldy5jcmVhdGUoewogICAgY2xhc3NOYW1l
czogWyd0aGUtY29udGFpbmVyJ10sCiAgICBjaGlsZFZpZXdzOiBbJ2FWaWV3JywgJ2JWaWV3J10s
CiAgICBhVmlldzogRW1iZXIuVmlldy5jcmVhdGUoewogICAgICB0ZW1wbGF0ZTogRW1iZXIuSGFu
ZGxlYmFycy5jb21waWxlKCJBIikKICAgIH0pLAogICAgYlZpZXc6IEVtYmVyLlZpZXcuY3JlYXRl
KHsKICAgICAgdGVtcGxhdGU6IEVtYmVyLkhhbmRsZWJhcnMuY29tcGlsZSgiQiIpCiAgICB9KQog
IH0pOwoKICBhQ29udGFpbmVyLmFwcGVuZFRvKCdib2R5Jyk7CiAgYGBgCgogIFJlc3VsdHMgaW4g
dGhlIEhUTUwKCiAgYGBgaHRtbAogIDxkaXYgY2xhc3M9ImVtYmVyLXZpZXcgdGhlLWNvbnRhaW5l
ciI+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5BPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJl
bWJlci12aWV3Ij5CPC9kaXY+CiAgPC9kaXY+CiAgYGBgCgogIFJlbW92aW5nIGEgdmlldwoKICBg
YGBqYXZhc2NyaXB0CiAgYUNvbnRhaW5lci50b0FycmF5KCk7ICAvLyBbYUNvbnRhaW5lci5hVmll
dywgYUNvbnRhaW5lci5iVmlld10KICBhQ29udGFpbmVyLnJlbW92ZU9iamVjdChhQ29udGFpbmVy
LmdldCgnYlZpZXcnKSk7CiAgYUNvbnRhaW5lci50b0FycmF5KCk7ICAvLyBbYUNvbnRhaW5lci5h
Vmlld10KICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdGhlIGZvbGxvd2luZyBIVE1MCgogIGBgYGh0
bWwKICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3IHRoZS1jb250YWluZXIiPgogICAgPGRpdiBjbGFz
cz0iZW1iZXItdmlldyI+QTwvZGl2PgogIDwvZGl2PgogIGBgYAoKICBTaW1pbGFybHksIGFkZGlu
ZyBhIGNoaWxkIHZpZXcgaXMgYWNjb21wbGlzaGVkIGJ5IGFkZGluZyBgRW1iZXIuVmlld2AgaW5z
dGFuY2VzIHRvIHRoZQogIGNvbnRhaW5lciB2aWV3LgoKICBHaXZlbiBhbiBlbXB0eSBgPGJvZHk+
YCB0aGUgZm9sbG93aW5nIGNvZGUKCiAgYGBgamF2YXNjcmlwdAogIGFDb250YWluZXIgPSBFbWJl
ci5Db250YWluZXJWaWV3LmNyZWF0ZSh7CiAgICBjbGFzc05hbWVzOiBbJ3RoZS1jb250YWluZXIn
XSwKICAgIGNoaWxkVmlld3M6IFsnYVZpZXcnLCAnYlZpZXcnXSwKICAgIGFWaWV3OiBFbWJlci5W
aWV3LmNyZWF0ZSh7CiAgICAgIHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoIkEi
KQogICAgfSksCiAgICBiVmlldzogRW1iZXIuVmlldy5jcmVhdGUoewogICAgICB0ZW1wbGF0ZTog
RW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCJCIikKICAgIH0pCiAgfSk7CgogIGFDb250YWluZXIu
YXBwZW5kVG8oJ2JvZHknKTsKICBgYGAKCiAgUmVzdWx0cyBpbiB0aGUgSFRNTAoKICBgYGBodG1s
CiAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyB0aGUtY29udGFpbmVyIj4KICAgIDxkaXYgY2xhc3M9
ImVtYmVyLXZpZXciPkE8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImVtYmVyLXZpZXciPkI8L2Rpdj4K
ICA8L2Rpdj4KICBgYGAKCiAgQWRkaW5nIGEgdmlldwoKICBgYGBqYXZhc2NyaXB0CiAgQW5vdGhl
clZpZXdDbGFzcyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgIHRlbXBsYXRlOiBFbWJlci5IYW5k
bGViYXJzLmNvbXBpbGUoIkFub3RoZXIgdmlldyIpCiAgfSk7CgogIGFDb250YWluZXIudG9BcnJh
eSgpOyAgLy8gW2FDb250YWluZXIuYVZpZXcsIGFDb250YWluZXIuYlZpZXddCiAgYUNvbnRhaW5l
ci5wdXNoT2JqZWN0KEFub3RoZXJWaWV3Q2xhc3MuY3JlYXRlKCkpOwogIGFDb250YWluZXIudG9B
cnJheSgpOyAvLyBbYUNvbnRhaW5lci5hVmlldywgYUNvbnRhaW5lci5iVmlldywgPEFub3RoZXJW
aWV3Q2xhc3MgaW5zdGFuY2U+XQogIGBgYAoKICBXaWxsIHJlc3VsdCBpbiB0aGUgZm9sbG93aW5n
IEhUTUwKCiAgYGBgaHRtbAogIDxkaXYgY2xhc3M9ImVtYmVyLXZpZXcgdGhlLWNvbnRhaW5lciI+
CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5BPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJlbWJl
ci12aWV3Ij5CPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5Bbm90aGVyIHZpZXc8
L2Rpdj4KICA8L2Rpdj4KICBgYGAKCiAgIyMgVGVtcGxhdGVzIGFuZCBMYXlvdXQKCiAgQSBgdGVt
cGxhdGVgLCBgdGVtcGxhdGVOYW1lYCwgYGRlZmF1bHRUZW1wbGF0ZWAsIGBsYXlvdXRgLCBgbGF5
b3V0TmFtZWAgb3IKICBgZGVmYXVsdExheW91dGAgcHJvcGVydHkgb24gYSBjb250YWluZXIgdmll
dyB3aWxsIG5vdCByZXN1bHQgaW4gdGhlIHRlbXBsYXRlCiAgb3IgbGF5b3V0IGJlaW5nIHJlbmRl
cmVkLiBUaGUgSFRNTCBjb250ZW50cyBvZiBhIGBFbWJlci5Db250YWluZXJWaWV3YCdzIERPTQog
IHJlcHJlc2VudGF0aW9uIHdpbGwgb25seSBiZSB0aGUgcmVuZGVyZWQgSFRNTCBvZiBpdHMgY2hp
bGQgdmlld3MuCgogIEBjbGFzcyBDb250YWluZXJWaWV3CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBl
eHRlbmRzIEVtYmVyLlZpZXcKKi8KRW1iZXIuQ29udGFpbmVyVmlldyA9IEVtYmVyLlZpZXcuZXh0
ZW5kKEVtYmVyLk11dGFibGVBcnJheSwgewogIHN0YXRlczogc3RhdGVzLAoKICBpbml0OiBmdW5j
dGlvbigpIHsKICAgIHRoaXMuX3N1cGVyKCk7CgogICAgdmFyIGNoaWxkVmlld3MgPSBnZXQodGhp
cywgJ2NoaWxkVmlld3MnKTsKCiAgICAvLyByZWRlZmluZSB2aWV3J3MgY2hpbGRWaWV3cyBwcm9w
ZXJ0eSB0aGF0IHdhcyBvYmxpdGVyYXRlZAogICAgRW1iZXIuZGVmaW5lUHJvcGVydHkodGhpcywg
J2NoaWxkVmlld3MnLCBFbWJlci5WaWV3LmNoaWxkVmlld3NQcm9wZXJ0eSk7CgogICAgdmFyIF9j
aGlsZFZpZXdzID0gdGhpcy5fY2hpbGRWaWV3czsKCiAgICBmb3JFYWNoKGNoaWxkVmlld3MsIGZ1
bmN0aW9uKHZpZXdOYW1lLCBpZHgpIHsKICAgICAgdmFyIHZpZXc7CgogICAgICBpZiAoJ3N0cmlu
ZycgPT09IHR5cGVvZiB2aWV3TmFtZSkgewogICAgICAgIHZpZXcgPSBnZXQodGhpcywgdmlld05h
bWUpOwogICAgICAgIHZpZXcgPSB0aGlzLmNyZWF0ZUNoaWxkVmlldyh2aWV3KTsKICAgICAgICBz
ZXQodGhpcywgdmlld05hbWUsIHZpZXcpOwogICAgICB9IGVsc2UgewogICAgICAgIHZpZXcgPSB0
aGlzLmNyZWF0ZUNoaWxkVmlldyh2aWV3TmFtZSk7CiAgICAgIH0KCiAgICAgIF9jaGlsZFZpZXdz
W2lkeF0gPSB2aWV3OwogICAgfSwgdGhpcyk7CgogICAgdmFyIGN1cnJlbnRWaWV3ID0gZ2V0KHRo
aXMsICdjdXJyZW50VmlldycpOwogICAgaWYgKGN1cnJlbnRWaWV3KSB7CiAgICAgIGlmICghX2No
aWxkVmlld3MubGVuZ3RoKSB7IF9jaGlsZFZpZXdzID0gdGhpcy5fY2hpbGRWaWV3cyA9IHRoaXMu
X2NoaWxkVmlld3Muc2xpY2UoKTsgfQogICAgICBfY2hpbGRWaWV3cy5wdXNoKHRoaXMuY3JlYXRl
Q2hpbGRWaWV3KGN1cnJlbnRWaWV3KSk7CiAgICB9CiAgfSwKCiAgcmVwbGFjZTogZnVuY3Rpb24o
aWR4LCByZW1vdmVkQ291bnQsIGFkZGVkVmlld3MpIHsKICAgIHZhciBhZGRlZENvdW50ID0gYWRk
ZWRWaWV3cyA/IGdldChhZGRlZFZpZXdzLCAnbGVuZ3RoJykgOiAwOwogICAgdmFyIHNlbGYgPSB0
aGlzOwogICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2FuJ3QgYWRkIGEgY2hpbGQgdG8gYSBjb250YWlu
ZXIgdGhhdCBpcyBhbHJlYWR5IGEgY2hpbGQgb2YgYW5vdGhlciB2aWV3IiwgRW1iZXIuQShhZGRl
ZFZpZXdzKS5ldmVyeShmdW5jdGlvbihpdGVtKSB7IHJldHVybiAhZ2V0KGl0ZW0sICdfcGFyZW50
VmlldycpIHx8IGdldChpdGVtLCAnX3BhcmVudFZpZXcnKSA9PT0gc2VsZjsgfSkpOwoKICAgIHRo
aXMuYXJyYXlDb250ZW50V2lsbENoYW5nZShpZHgsIHJlbW92ZWRDb3VudCwgYWRkZWRDb3VudCk7
CiAgICB0aGlzLmNoaWxkVmlld3NXaWxsQ2hhbmdlKHRoaXMuX2NoaWxkVmlld3MsIGlkeCwgcmVt
b3ZlZENvdW50KTsKCiAgICBpZiAoYWRkZWRDb3VudCA9PT0gMCkgewogICAgICB0aGlzLl9jaGls
ZFZpZXdzLnNwbGljZShpZHgsIHJlbW92ZWRDb3VudCkgOwogICAgfSBlbHNlIHsKICAgICAgdmFy
IGFyZ3MgPSBbaWR4LCByZW1vdmVkQ291bnRdLmNvbmNhdChhZGRlZFZpZXdzKTsKICAgICAgaWYg
KGFkZGVkVmlld3MubGVuZ3RoICYmICF0aGlzLl9jaGlsZFZpZXdzLmxlbmd0aCkgeyB0aGlzLl9j
aGlsZFZpZXdzID0gdGhpcy5fY2hpbGRWaWV3cy5zbGljZSgpOyB9CiAgICAgIHRoaXMuX2NoaWxk
Vmlld3Muc3BsaWNlLmFwcGx5KHRoaXMuX2NoaWxkVmlld3MsIGFyZ3MpOwogICAgfQoKICAgIHRo
aXMuYXJyYXlDb250ZW50RGlkQ2hhbmdlKGlkeCwgcmVtb3ZlZENvdW50LCBhZGRlZENvdW50KTsK
ICAgIHRoaXMuY2hpbGRWaWV3c0RpZENoYW5nZSh0aGlzLl9jaGlsZFZpZXdzLCBpZHgsIHJlbW92
ZWRDb3VudCwgYWRkZWRDb3VudCk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgb2JqZWN0QXQ6
IGZ1bmN0aW9uKGlkeCkgewogICAgcmV0dXJuIHRoaXMuX2NoaWxkVmlld3NbaWR4XTsKICB9LAoK
ICBsZW5ndGg6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLl9j
aGlsZFZpZXdzLmxlbmd0aDsKICB9KS52b2xhdGlsZSgpLAoKICAvKioKICAgIEluc3RydWN0cyBl
YWNoIGNoaWxkIHZpZXcgdG8gcmVuZGVyIHRvIHRoZSBwYXNzZWQgcmVuZGVyIGJ1ZmZlci4KCiAg
ICBAcHJpdmF0ZQogICAgQG1ldGhvZCByZW5kZXIKICAgIEBwYXJhbSB7RW1iZXIuUmVuZGVyQnVm
ZmVyfSBidWZmZXIgdGhlIGJ1ZmZlciB0byByZW5kZXIgdG8KICAqLwogIHJlbmRlcjogZnVuY3Rp
b24oYnVmZmVyKSB7CiAgICB0aGlzLmZvckVhY2hDaGlsZFZpZXcoZnVuY3Rpb24odmlldykgewog
ICAgICB2aWV3LnJlbmRlclRvQnVmZmVyKGJ1ZmZlcik7CiAgICB9KTsKICB9LAoKICBpbnN0cnVt
ZW50TmFtZTogJ2NvbnRhaW5lcicsCgogIC8qKgogICAgV2hlbiBhIGNoaWxkIHZpZXcgaXMgcmVt
b3ZlZCwgZGVzdHJveSBpdHMgZWxlbWVudCBzbyB0aGF0CiAgICBpdCBpcyByZW1vdmVkIGZyb20g
dGhlIERPTS4KCiAgICBUaGUgYXJyYXkgb2JzZXJ2ZXIgdGhhdCB0cmlnZ2VycyB0aGlzIGFjdGlv
biBpcyBzZXQgdXAgaW4gdGhlCiAgICBgcmVuZGVyVG9CdWZmZXJgIG1ldGhvZC4KCiAgICBAcHJp
dmF0ZQogICAgQG1ldGhvZCBjaGlsZFZpZXdzV2lsbENoYW5nZQogICAgQHBhcmFtIHtFbWJlci5B
cnJheX0gdmlld3MgdGhlIGNoaWxkIHZpZXdzIGFycmF5IGJlZm9yZSBtdXRhdGlvbgogICAgQHBh
cmFtIHtOdW1iZXJ9IHN0YXJ0IHRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgbXV0YXRpb24KICAg
IEBwYXJhbSB7TnVtYmVyfSByZW1vdmVkIHRoZSBudW1iZXIgb2YgY2hpbGQgdmlld3MgcmVtb3Zl
ZAogICoqLwogIGNoaWxkVmlld3NXaWxsQ2hhbmdlOiBmdW5jdGlvbih2aWV3cywgc3RhcnQsIHJl
bW92ZWQpIHsKICAgIHRoaXMucHJvcGVydHlXaWxsQ2hhbmdlKCdjaGlsZFZpZXdzJyk7CgogICAg
aWYgKHJlbW92ZWQgPiAwKSB7CiAgICAgIHZhciBjaGFuZ2VkVmlld3MgPSB2aWV3cy5zbGljZShz
dGFydCwgc3RhcnQrcmVtb3ZlZCk7CiAgICAgIC8vIHRyYW5zaXRpb24gdG8gcHJlUmVuZGVyIGJl
Zm9yZSBjbGVhcmluZyBwYXJlbnRWaWV3CiAgICAgIHRoaXMuY3VycmVudFN0YXRlLmNoaWxkVmll
d3NXaWxsQ2hhbmdlKHRoaXMsIHZpZXdzLCBzdGFydCwgcmVtb3ZlZCk7CiAgICAgIHRoaXMuaW5p
dGlhbGl6ZVZpZXdzKGNoYW5nZWRWaWV3cywgbnVsbCwgbnVsbCk7CiAgICB9CiAgfSwKCiAgcmVt
b3ZlQ2hpbGQ6IGZ1bmN0aW9uKGNoaWxkKSB7CiAgICB0aGlzLnJlbW92ZU9iamVjdChjaGlsZCk7
CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgIFdoZW4gYSBjaGlsZCB2aWV3IGlzIGFk
ZGVkLCBtYWtlIHN1cmUgdGhlIERPTSBnZXRzIHVwZGF0ZWQgYXBwcm9wcmlhdGVseS4KCiAgICBJ
ZiB0aGUgdmlldyBoYXMgYWxyZWFkeSByZW5kZXJlZCBhbiBlbGVtZW50LCB3ZSB0ZWxsIHRoZSBj
aGlsZCB2aWV3IHRvCiAgICBjcmVhdGUgYW4gZWxlbWVudCBhbmQgaW5zZXJ0IGl0IGludG8gdGhl
IERPTS4gSWYgdGhlIGVuY2xvc2luZyBjb250YWluZXIKICAgIHZpZXcgaGFzIGFscmVhZHkgd3Jp
dHRlbiB0byBhIGJ1ZmZlciwgYnV0IG5vdCB5ZXQgY29udmVydGVkIHRoYXQgYnVmZmVyCiAgICBp
bnRvIGFuIGVsZW1lbnQsIHdlIGluc2VydCB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRo
ZSBjaGlsZCBpbnRvIHRoZQogICAgYXBwcm9wcmlhdGUgcGxhY2UgaW4gdGhlIGJ1ZmZlci4KCiAg
ICBAcHJpdmF0ZQogICAgQG1ldGhvZCBjaGlsZFZpZXdzRGlkQ2hhbmdlCiAgICBAcGFyYW0ge0Vt
YmVyLkFycmF5fSB2aWV3cyB0aGUgYXJyYXkgb2YgY2hpbGQgdmlld3MgYWZ0ZSB0aGUgbXV0YXRp
b24gaGFzIG9jY3VycmVkCiAgICBAcGFyYW0ge051bWJlcn0gc3RhcnQgdGhlIHN0YXJ0IHBvc2l0
aW9uIG9mIHRoZSBtdXRhdGlvbgogICAgQHBhcmFtIHtOdW1iZXJ9IHJlbW92ZWQgdGhlIG51bWJl
ciBvZiBjaGlsZCB2aWV3cyByZW1vdmVkCiAgICBAcGFyYW0ge051bWJlcn0gdGhlIG51bWJlciBv
ZiBjaGlsZCB2aWV3cyBhZGRlZAogICovCiAgY2hpbGRWaWV3c0RpZENoYW5nZTogZnVuY3Rpb24o
dmlld3MsIHN0YXJ0LCByZW1vdmVkLCBhZGRlZCkgewogICAgaWYgKGFkZGVkID4gMCkgewogICAg
ICB2YXIgY2hhbmdlZFZpZXdzID0gdmlld3Muc2xpY2Uoc3RhcnQsIHN0YXJ0K2FkZGVkKTsKICAg
ICAgdGhpcy5pbml0aWFsaXplVmlld3MoY2hhbmdlZFZpZXdzLCB0aGlzLCBnZXQodGhpcywgJ3Rl
bXBsYXRlRGF0YScpKTsKICAgICAgdGhpcy5jdXJyZW50U3RhdGUuY2hpbGRWaWV3c0RpZENoYW5n
ZSh0aGlzLCB2aWV3cywgc3RhcnQsIGFkZGVkKTsKICAgIH0KICAgIHRoaXMucHJvcGVydHlEaWRD
aGFuZ2UoJ2NoaWxkVmlld3MnKTsKICB9LAoKICBpbml0aWFsaXplVmlld3M6IGZ1bmN0aW9uKHZp
ZXdzLCBwYXJlbnRWaWV3LCB0ZW1wbGF0ZURhdGEpIHsKICAgIGZvckVhY2godmlld3MsIGZ1bmN0
aW9uKHZpZXcpIHsKICAgICAgc2V0KHZpZXcsICdfcGFyZW50VmlldycsIHBhcmVudFZpZXcpOwoK
ICAgICAgaWYgKCF2aWV3LmNvbnRhaW5lciAmJiBwYXJlbnRWaWV3KSB7CiAgICAgICAgc2V0KHZp
ZXcsICdjb250YWluZXInLCBwYXJlbnRWaWV3LmNvbnRhaW5lcik7CiAgICAgIH0KCiAgICAgIGlm
ICghZ2V0KHZpZXcsICd0ZW1wbGF0ZURhdGEnKSkgewogICAgICAgIHNldCh2aWV3LCAndGVtcGxh
dGVEYXRhJywgdGVtcGxhdGVEYXRhKTsKICAgICAgfQogICAgfSk7CiAgfSwKCiAgY3VycmVudFZp
ZXc6IG51bGwsCgogIF9jdXJyZW50Vmlld1dpbGxDaGFuZ2U6IEVtYmVyLmJlZm9yZU9ic2VydmVy
KCdjdXJyZW50VmlldycsIGZ1bmN0aW9uKCkgewogICAgdmFyIGN1cnJlbnRWaWV3ID0gZ2V0KHRo
aXMsICdjdXJyZW50VmlldycpOwogICAgaWYgKGN1cnJlbnRWaWV3KSB7CiAgICAgIGN1cnJlbnRW
aWV3LmRlc3Ryb3koKTsKICAgIH0KICB9KSwKCiAgX2N1cnJlbnRWaWV3RGlkQ2hhbmdlOiBFbWJl
ci5vYnNlcnZlcignY3VycmVudFZpZXcnLCBmdW5jdGlvbigpIHsKICAgIHZhciBjdXJyZW50Vmll
dyA9IGdldCh0aGlzLCAnY3VycmVudFZpZXcnKTsKICAgIGlmIChjdXJyZW50VmlldykgewogICAg
ICBFbWJlci5hc3NlcnQoIllvdSB0cmllZCB0byBzZXQgYSBjdXJyZW50IHZpZXcgdGhhdCBhbHJl
YWR5IGhhcyBhIHBhcmVudC4gTWFrZSBzdXJlIHlvdSBkb24ndCBoYXZlIG11bHRpcGxlIG91dGxl
dHMgaW4gdGhlIHNhbWUgdmlldy4iLCAhZ2V0KGN1cnJlbnRWaWV3LCAnX3BhcmVudFZpZXcnKSk7
CiAgICAgIHRoaXMucHVzaE9iamVjdChjdXJyZW50Vmlldyk7CiAgICB9CiAgfSksCgogIF9lbnN1
cmVDaGlsZHJlbkFyZUluRE9NOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmN1cnJlbnRTdGF0ZS5l
bnN1cmVDaGlsZHJlbkFyZUluRE9NKHRoaXMpOwogIH0KfSk7CgpFbWJlci5tZXJnZShzdGF0ZXMu
X2RlZmF1bHQsIHsKICBjaGlsZFZpZXdzV2lsbENoYW5nZTogRW1iZXIuSywKICBjaGlsZFZpZXdz
RGlkQ2hhbmdlOiBFbWJlci5LLAogIGVuc3VyZUNoaWxkcmVuQXJlSW5ET006IEVtYmVyLksKfSk7
CgpFbWJlci5tZXJnZShzdGF0ZXMuaW5CdWZmZXIsIHsKICBjaGlsZFZpZXdzRGlkQ2hhbmdlOiBm
dW5jdGlvbihwYXJlbnRWaWV3LCB2aWV3cywgc3RhcnQsIGFkZGVkKSB7CiAgICB0aHJvdyBuZXcg
RW1iZXIuRXJyb3IoJ1lvdSBjYW5ub3QgbW9kaWZ5IGNoaWxkIHZpZXdzIHdoaWxlIGluIHRoZSBp
bkJ1ZmZlciBzdGF0ZScpOwogIH0KfSk7CgpFbWJlci5tZXJnZShzdGF0ZXMuaGFzRWxlbWVudCwg
ewogIGNoaWxkVmlld3NXaWxsQ2hhbmdlOiBmdW5jdGlvbih2aWV3LCB2aWV3cywgc3RhcnQsIHJl
bW92ZWQpIHsKICAgIGZvciAodmFyIGk9c3RhcnQ7IGk8c3RhcnQrcmVtb3ZlZDsgaSsrKSB7CiAg
ICAgIHZpZXdzW2ldLnJlbW92ZSgpOwogICAgfQogIH0sCgogIGNoaWxkVmlld3NEaWRDaGFuZ2U6
IGZ1bmN0aW9uKHZpZXcsIHZpZXdzLCBzdGFydCwgYWRkZWQpIHsKICAgIEVtYmVyLnJ1bi5zY2hl
ZHVsZU9uY2UoJ3JlbmRlcicsIHZpZXcsICdfZW5zdXJlQ2hpbGRyZW5BcmVJbkRPTScpOwogIH0s
CgogIGVuc3VyZUNoaWxkcmVuQXJlSW5ET006IGZ1bmN0aW9uKHZpZXcpIHsKICAgIHZhciBjaGls
ZFZpZXdzID0gdmlldy5fY2hpbGRWaWV3cywgaSwgbGVuLCBjaGlsZFZpZXcsIHByZXZpb3VzLCBi
dWZmZXIsIHZpZXdDb2xsZWN0aW9uID0gbmV3IFZpZXdDb2xsZWN0aW9uKCk7CgogICAgZm9yIChp
ID0gMCwgbGVuID0gY2hpbGRWaWV3cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICBjaGls
ZFZpZXcgPSBjaGlsZFZpZXdzW2ldOwoKICAgICAgaWYgKCFidWZmZXIpIHsgYnVmZmVyID0gRW1i
ZXIuUmVuZGVyQnVmZmVyKCk7IGJ1ZmZlci5faGFzRWxlbWVudCA9IGZhbHNlOyB9CgogICAgICBp
ZiAoY2hpbGRWaWV3LnJlbmRlclRvQnVmZmVySWZOZWVkZWQoYnVmZmVyKSkgewogICAgICAgIHZp
ZXdDb2xsZWN0aW9uLnB1c2goY2hpbGRWaWV3KTsKICAgICAgfSBlbHNlIGlmICh2aWV3Q29sbGVj
dGlvbi5sZW5ndGgpIHsKICAgICAgICBpbnNlcnRWaWV3Q29sbGVjdGlvbih2aWV3LCB2aWV3Q29s
bGVjdGlvbiwgcHJldmlvdXMsIGJ1ZmZlcik7CiAgICAgICAgYnVmZmVyID0gbnVsbDsKICAgICAg
ICBwcmV2aW91cyA9IGNoaWxkVmlldzsKICAgICAgICB2aWV3Q29sbGVjdGlvbi5jbGVhcigpOwog
ICAgICB9IGVsc2UgewogICAgICAgIHByZXZpb3VzID0gY2hpbGRWaWV3OwogICAgICB9CiAgICB9
CgogICAgaWYgKHZpZXdDb2xsZWN0aW9uLmxlbmd0aCkgewogICAgICBpbnNlcnRWaWV3Q29sbGVj
dGlvbih2aWV3LCB2aWV3Q29sbGVjdGlvbiwgcHJldmlvdXMsIGJ1ZmZlcik7CiAgICB9CiAgfQp9
KTsKCmZ1bmN0aW9uIGluc2VydFZpZXdDb2xsZWN0aW9uKHZpZXcsIHZpZXdDb2xsZWN0aW9uLCBw
cmV2aW91cywgYnVmZmVyKSB7CiAgdmlld0NvbGxlY3Rpb24udHJpZ2dlclJlY3Vyc2l2ZWx5KCd3
aWxsSW5zZXJ0RWxlbWVudCcpOwoKICBpZiAocHJldmlvdXMpIHsKICAgIHByZXZpb3VzLmRvbU1h
bmFnZXIuYWZ0ZXIocHJldmlvdXMsIGJ1ZmZlci5zdHJpbmcoKSk7CiAgfSBlbHNlIHsKICAgIHZp
ZXcuZG9tTWFuYWdlci5wcmVwZW5kKHZpZXcsIGJ1ZmZlci5zdHJpbmcoKSk7CiAgfQoKICB2aWV3
Q29sbGVjdGlvbi5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgIHYudHJhbnNpdGlvblRvKCdpbkRP
TScpOwogICAgdi5wcm9wZXJ0eURpZENoYW5nZSgnZWxlbWVudCcpOwogICAgdi50cmlnZ2VyUmVj
dXJzaXZlbHkoJ2RpZEluc2VydEVsZW1lbnQnKTsKICB9KTsKfQoKCn0pKCk7CgoKCihmdW5jdGlv
bigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwoqLwoKdmFyIGdl
dCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0LCBmbXQgPSBFbWJlci5TdHJpbmcuZm10OwoK
LyoqCiAgYEVtYmVyLkNvbGxlY3Rpb25WaWV3YCBpcyBhbiBgRW1iZXIuVmlld2AgZGVzY2VuZGVu
dCByZXNwb25zaWJsZSBmb3IgbWFuYWdpbmcKICBhIGNvbGxlY3Rpb24gKGFuIGFycmF5IG9yIGFy
cmF5LWxpa2Ugb2JqZWN0KSBieSBtYWludGFpbmluZyBhIGNoaWxkIHZpZXcgb2JqZWN0CiAgYW5k
IGFzc29jaWF0ZWQgRE9NIHJlcHJlc2VudGF0aW9uIGZvciBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5
IGFuZCBlbnN1cmluZwogIHRoYXQgY2hpbGQgdmlld3MgYW5kIHRoZWlyIGFzc29jaWF0ZWQgcmVu
ZGVyZWQgSFRNTCBhcmUgdXBkYXRlZCB3aGVuIGl0ZW1zIGluCiAgdGhlIGFycmF5IGFyZSBhZGRl
ZCwgcmVtb3ZlZCwgb3IgcmVwbGFjZWQuCgogICMjIFNldHRpbmcgY29udGVudAoKICBUaGUgbWFu
YWdlZCBjb2xsZWN0aW9uIG9mIG9iamVjdHMgaXMgcmVmZXJlbmNlZCBhcyB0aGUgYEVtYmVyLkNv
bGxlY3Rpb25WaWV3YAogIGluc3RhbmNlJ3MgYGNvbnRlbnRgIHByb3BlcnR5LgoKICBgYGBqYXZh
c2NyaXB0CiAgc29tZUl0ZW1zVmlldyA9IEVtYmVyLkNvbGxlY3Rpb25WaWV3LmNyZWF0ZSh7CiAg
ICBjb250ZW50OiBbJ0EnLCAnQicsJ0MnXQogIH0pCiAgYGBgCgogIFRoZSB2aWV3IGZvciBlYWNo
IGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24gd2lsbCBoYXZlIGl0cyBgY29udGVudGAgcHJvcGVydHkg
c2V0CiAgdG8gdGhlIGl0ZW0uCgogICMjIFNwZWNpZnlpbmcgaXRlbVZpZXdDbGFzcwoKICBCeSBk
ZWZhdWx0IHRoZSB2aWV3IGNsYXNzIGZvciBlYWNoIGl0ZW0gaW4gdGhlIG1hbmFnZWQgY29sbGVj
dGlvbiB3aWxsIGJlIGFuCiAgaW5zdGFuY2Ugb2YgYEVtYmVyLlZpZXdgLiBZb3UgY2FuIHN1cHBs
eSBhIGRpZmZlcmVudCBjbGFzcyBieSBzZXR0aW5nIHRoZQogIGBDb2xsZWN0aW9uVmlld2AncyBg
aXRlbVZpZXdDbGFzc2AgcHJvcGVydHkuCgogIEdpdmVuIGFuIGVtcHR5IGA8Ym9keT5gIGFuZCB0
aGUgZm9sbG93aW5nIGNvZGU6CgogIGBgYGphdmFzY3JpcHQKICBzb21lSXRlbXNWaWV3ID0gRW1i
ZXIuQ29sbGVjdGlvblZpZXcuY3JlYXRlKHsKICAgIGNsYXNzTmFtZXM6IFsnYS1jb2xsZWN0aW9u
J10sCiAgICBjb250ZW50OiBbJ0EnLCdCJywnQyddLAogICAgaXRlbVZpZXdDbGFzczogRW1iZXIu
Vmlldy5leHRlbmQoewogICAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCJ0
aGUgbGV0dGVyOiB7e3ZpZXcuY29udGVudH19IikKICAgIH0pCiAgfSk7CgogIHNvbWVJdGVtc1Zp
ZXcuYXBwZW5kVG8oJ2JvZHknKTsKICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdGhlIGZvbGxvd2lu
ZyBIVE1MIHN0cnVjdHVyZQoKICBgYGBodG1sCiAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyBhLWNv
bGxlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+dGhlIGxldHRlcjogQTwvZGl2
PgogICAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+dGhlIGxldHRlcjogQjwvZGl2PgogICAgPGRp
diBjbGFzcz0iZW1iZXItdmlldyI+dGhlIGxldHRlcjogQzwvZGl2PgogIDwvZGl2PgogIGBgYAoK
ICAjIyBBdXRvbWF0aWMgbWF0Y2hpbmcgb2YgcGFyZW50L2NoaWxkIHRhZ05hbWVzCgogIFNldHRp
bmcgdGhlIGB0YWdOYW1lYCBwcm9wZXJ0eSBvZiBhIGBDb2xsZWN0aW9uVmlld2AgdG8gYW55IG9m
CiAgInVsIiwgIm9sIiwgInRhYmxlIiwgInRoZWFkIiwgInRib2R5IiwgInRmb290IiwgInRyIiwg
b3IgInNlbGVjdCIgd2lsbCByZXN1bHQKICBpbiB0aGUgaXRlbSB2aWV3cyByZWNlaXZpbmcgYW4g
YXBwcm9wcmlhdGVseSBtYXRjaGVkIGB0YWdOYW1lYCBwcm9wZXJ0eS4KCiAgR2l2ZW4gYW4gZW1w
dHkgYDxib2R5PmAgYW5kIHRoZSBmb2xsb3dpbmcgY29kZToKCiAgYGBgamF2YXNjcmlwdAogIGFu
VW5kb3JkZXJlZExpc3RWaWV3ID0gRW1iZXIuQ29sbGVjdGlvblZpZXcuY3JlYXRlKHsKICAgIHRh
Z05hbWU6ICd1bCcsCiAgICBjb250ZW50OiBbJ0EnLCdCJywnQyddLAogICAgaXRlbVZpZXdDbGFz
czogRW1iZXIuVmlldy5leHRlbmQoewogICAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5j
b21waWxlKCJ0aGUgbGV0dGVyOiB7e3ZpZXcuY29udGVudH19IikKICAgIH0pCiAgfSk7CgogIGFu
VW5kb3JkZXJlZExpc3RWaWV3LmFwcGVuZFRvKCdib2R5Jyk7CiAgYGBgCgogIFdpbGwgcmVzdWx0
IGluIHRoZSBmb2xsb3dpbmcgSFRNTCBzdHJ1Y3R1cmUKCiAgYGBgaHRtbAogIDx1bCBjbGFzcz0i
ZW1iZXItdmlldyBhLWNvbGxlY3Rpb24iPgogICAgPGxpIGNsYXNzPSJlbWJlci12aWV3Ij50aGUg
bGV0dGVyOiBBPC9saT4KICAgIDxsaSBjbGFzcz0iZW1iZXItdmlldyI+dGhlIGxldHRlcjogQjwv
bGk+CiAgICA8bGkgY2xhc3M9ImVtYmVyLXZpZXciPnRoZSBsZXR0ZXI6IEM8L2xpPgogIDwvdWw+
CiAgYGBgCgogIEFkZGl0aW9uYWwgYHRhZ05hbWVgIHBhaXJzIGNhbiBiZSBwcm92aWRlZCBieSBh
ZGRpbmcgdG8KICBgRW1iZXIuQ29sbGVjdGlvblZpZXcuQ09OVEFJTkVSX01BUCBgCgogIGBgYGph
dmFzY3JpcHQKICBFbWJlci5Db2xsZWN0aW9uVmlldy5DT05UQUlORVJfTUFQWydhcnRpY2xlJ10g
PSAnc2VjdGlvbicKICBgYGAKCiAgIyMgUHJvZ3JhbW1hdGljIGNyZWF0aW9uIG9mIGNoaWxkIHZp
ZXdzCgogIEZvciBjYXNlcyB3aGVyZSBhZGRpdGlvbmFsIGN1c3RvbWl6YXRpb24gYmV5b25kIHRo
ZSB1c2Ugb2YgYSBzaW5nbGUKICBgaXRlbVZpZXdDbGFzc2Agb3IgYHRhZ05hbWVgIG1hdGNoaW5n
IGlzIHJlcXVpcmVkIENvbGxlY3Rpb25WaWV3J3MKICBgY3JlYXRlQ2hpbGRWaWV3YCBtZXRob2Qg
Y2FuIGJlIG92ZXJpZGRlbjoKCiAgYGBgamF2YXNjcmlwdAogIEN1c3RvbUNvbGxlY3Rpb25WaWV3
ID0gRW1iZXIuQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHsKICAgIGNyZWF0ZUNoaWxkVmlldzogZnVu
Y3Rpb24odmlld0NsYXNzLCBhdHRycykgewogICAgICBpZiAoYXR0cnMuY29udGVudC5raW5kID09
ICdhbGJ1bScpIHsKICAgICAgICB2aWV3Q2xhc3MgPSBBcHAuQWxidW1WaWV3OwogICAgICB9IGVs
c2UgewogICAgICAgIHZpZXdDbGFzcyA9IEFwcC5Tb25nVmlldzsKICAgICAgfQogICAgICByZXR1
cm4gdGhpcy5fc3VwZXIodmlld0NsYXNzLCBhdHRycyk7CiAgICB9CiAgfSk7CiAgYGBgCgogICMj
IEVtcHR5IFZpZXcKCiAgWW91IGNhbiBwcm92aWRlIGFuIGBFbWJlci5WaWV3YCBzdWJjbGFzcyB0
byB0aGUgYEVtYmVyLkNvbGxlY3Rpb25WaWV3YAogIGluc3RhbmNlIGFzIGl0cyBgZW1wdHlWaWV3
YCBwcm9wZXJ0eS4gSWYgdGhlIGBjb250ZW50YCBwcm9wZXJ0eSBvZiBhCiAgYENvbGxlY3Rpb25W
aWV3YCBpcyBzZXQgdG8gYG51bGxgIG9yIGFuIGVtcHR5IGFycmF5LCBhbiBpbnN0YW5jZSBvZiB0
aGlzIHZpZXcKICB3aWxsIGJlIHRoZSBgQ29sbGVjdGlvblZpZXdgcyBvbmx5IGNoaWxkLgoKICBg
YGBqYXZhc2NyaXB0CiAgYUxpc3RXaXRoTm90aGluZyA9IEVtYmVyLkNvbGxlY3Rpb25WaWV3LmNy
ZWF0ZSh7CiAgICBjbGFzc05hbWVzOiBbJ25vdGhpbmcnXQogICAgY29udGVudDogbnVsbCwKICAg
IGVtcHR5VmlldzogRW1iZXIuVmlldy5leHRlbmQoewogICAgICB0ZW1wbGF0ZTogRW1iZXIuSGFu
ZGxlYmFycy5jb21waWxlKCJUaGUgY29sbGVjdGlvbiBpcyBlbXB0eSIpCiAgICB9KQogIH0pOwoK
ICBhTGlzdFdpdGhOb3RoaW5nLmFwcGVuZFRvKCdib2R5Jyk7CiAgYGBgCgogIFdpbGwgcmVzdWx0
IGluIHRoZSBmb2xsb3dpbmcgSFRNTCBzdHJ1Y3R1cmUKCiAgYGBgaHRtbAogIDxkaXYgY2xhc3M9
ImVtYmVyLXZpZXcgbm90aGluZyI+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij4KICAgICAg
VGhlIGNvbGxlY3Rpb24gaXMgZW1wdHkKICAgIDwvZGl2PgogIDwvZGl2PgogIGBgYAoKICAjIyBB
ZGRpbmcgYW5kIFJlbW92aW5nIGl0ZW1zCgogIFRoZSBgY2hpbGRWaWV3c2AgcHJvcGVydHkgb2Yg
YSBgQ29sbGVjdGlvblZpZXdgIHNob3VsZCBub3QgYmUgZGlyZWN0bHkKICBtYW5pcHVsYXRlZC4g
SW5zdGVhZCwgYWRkLCByZW1vdmUsIHJlcGxhY2UgaXRlbXMgZnJvbSBpdHMgYGNvbnRlbnRgIHBy
b3BlcnR5LgogIFRoaXMgd2lsbCB0cmlnZ2VyIGFwcHJvcHJpYXRlIGNoYW5nZXMgdG8gaXRzIHJl
bmRlcmVkIEhUTUwuCgoKICBAY2xhc3MgQ29sbGVjdGlvblZpZXcKICBAbmFtZXNwYWNlIEVtYmVy
CiAgQGV4dGVuZHMgRW1iZXIuQ29udGFpbmVyVmlldwogIEBzaW5jZSBFbWJlciAwLjkKKi8KRW1i
ZXIuQ29sbGVjdGlvblZpZXcgPSBFbWJlci5Db250YWluZXJWaWV3LmV4dGVuZCh7CgogIC8qKgog
ICAgQSBsaXN0IG9mIGl0ZW1zIHRvIGJlIGRpc3BsYXllZCBieSB0aGUgYEVtYmVyLkNvbGxlY3Rp
b25WaWV3YC4KCiAgICBAcHJvcGVydHkgY29udGVudAogICAgQHR5cGUgRW1iZXIuQXJyYXkKICAg
IEBkZWZhdWx0IG51bGwKICAqLwogIGNvbnRlbnQ6IG51bGwsCgogIC8qKgogICAgVGhpcyBwcm92
aWRlcyBtZXRhZGF0YSBhYm91dCB3aGF0IGtpbmQgb2YgZW1wdHkgdmlldyBjbGFzcyB0aGlzCiAg
ICBjb2xsZWN0aW9uIHdvdWxkIGxpa2UgaWYgaXQgaXMgYmVpbmcgaW5zdGFudGlhdGVkIGZyb20g
YW5vdGhlcgogICAgc3lzdGVtIChsaWtlIEhhbmRsZWJhcnMpCgogICAgQHByaXZhdGUKICAgIEBw
cm9wZXJ0eSBlbXB0eVZpZXdDbGFzcwogICovCiAgZW1wdHlWaWV3Q2xhc3M6IEVtYmVyLlZpZXcs
CgogIC8qKgogICAgQW4gb3B0aW9uYWwgdmlldyB0byBkaXNwbGF5IGlmIGNvbnRlbnQgaXMgc2V0
IHRvIGFuIGVtcHR5IGFycmF5LgoKICAgIEBwcm9wZXJ0eSBlbXB0eVZpZXcKICAgIEB0eXBlIEVt
YmVyLlZpZXcKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIGVtcHR5VmlldzogbnVsbCwKCiAgLyoq
CiAgICBAcHJvcGVydHkgaXRlbVZpZXdDbGFzcwogICAgQHR5cGUgRW1iZXIuVmlldwogICAgQGRl
ZmF1bHQgRW1iZXIuVmlldwogICovCiAgaXRlbVZpZXdDbGFzczogRW1iZXIuVmlldywKCiAgLyoq
CiAgICBTZXR1cCBhIENvbGxlY3Rpb25WaWV3CgogICAgQG1ldGhvZCBpbml0CiAgKi8KICBpbml0
OiBmdW5jdGlvbigpIHsKICAgIHZhciByZXQgPSB0aGlzLl9zdXBlcigpOwogICAgdGhpcy5fY29u
dGVudERpZENoYW5nZSgpOwogICAgcmV0dXJuIHJldDsKICB9LAoKICAvKioKICAgIEludm9rZWQg
d2hlbiB0aGUgY29udGVudCBwcm9wZXJ0eSBpcyBhYm91dCB0byBjaGFuZ2UuIE5vdGlmaWVzIG9i
c2VydmVycyB0aGF0IHRoZQogICAgZW50aXJlIGFycmF5IGNvbnRlbnQgd2lsbCBjaGFuZ2UuCgog
ICAgQHByaXZhdGUKICAgIEBtZXRob2QgX2NvbnRlbnRXaWxsQ2hhbmdlCiAgKi8KICBfY29udGVu
dFdpbGxDaGFuZ2U6IEVtYmVyLmJlZm9yZU9ic2VydmVyKCdjb250ZW50JywgZnVuY3Rpb24oKSB7
CiAgICB2YXIgY29udGVudCA9IHRoaXMuZ2V0KCdjb250ZW50Jyk7CgogICAgaWYgKGNvbnRlbnQp
IHsgY29udGVudC5yZW1vdmVBcnJheU9ic2VydmVyKHRoaXMpOyB9CiAgICB2YXIgbGVuID0gY29u
dGVudCA/IGdldChjb250ZW50LCAnbGVuZ3RoJykgOiAwOwogICAgdGhpcy5hcnJheVdpbGxDaGFu
Z2UoY29udGVudCwgMCwgbGVuKTsKICB9KSwKCiAgLyoqCiAgICBDaGVjayB0byBtYWtlIHN1cmUg
dGhhdCB0aGUgY29udGVudCBoYXMgY2hhbmdlZCwgYW5kIGlmIHNvLAogICAgdXBkYXRlIHRoZSBj
aGlsZHJlbiBkaXJlY3RseS4gVGhpcyBpcyBhbHdheXMgc2NoZWR1bGVkCiAgICBhc3luY2hyb25v
dXNseSwgdG8gYWxsb3cgdGhlIGVsZW1lbnQgdG8gYmUgY3JlYXRlZCBiZWZvcmUKICAgIGJpbmRp
bmdzIGhhdmUgc3luY2hyb25pemVkIGFuZCB2aWNlIHZlcnNhLgoKICAgIEBwcml2YXRlCiAgICBA
bWV0aG9kIF9jb250ZW50RGlkQ2hhbmdlCiAgKi8KICBfY29udGVudERpZENoYW5nZTogRW1iZXIu
b2JzZXJ2ZXIoJ2NvbnRlbnQnLCBmdW5jdGlvbigpIHsKICAgIHZhciBjb250ZW50ID0gZ2V0KHRo
aXMsICdjb250ZW50Jyk7CgogICAgaWYgKGNvbnRlbnQpIHsKICAgICAgdGhpcy5fYXNzZXJ0QXJy
YXlMaWtlKGNvbnRlbnQpOwogICAgICBjb250ZW50LmFkZEFycmF5T2JzZXJ2ZXIodGhpcyk7CiAg
ICB9CgogICAgdmFyIGxlbiA9IGNvbnRlbnQgPyBnZXQoY29udGVudCwgJ2xlbmd0aCcpIDogMDsK
ICAgIHRoaXMuYXJyYXlEaWRDaGFuZ2UoY29udGVudCwgMCwgbnVsbCwgbGVuKTsKICB9KSwKCiAg
LyoqCiAgICBFbnN1cmUgdGhhdCB0aGUgY29udGVudCBpbXBsZW1lbnRzIEVtYmVyLkFycmF5Cgog
ICAgQHByaXZhdGUKICAgIEBtZXRob2QgX2Fzc2VydEFycmF5TGlrZQogICovCiAgX2Fzc2VydEFy
cmF5TGlrZTogZnVuY3Rpb24oY29udGVudCkgewogICAgRW1iZXIuYXNzZXJ0KGZtdCgiYW4gRW1i
ZXIuQ29sbGVjdGlvblZpZXcncyBjb250ZW50IG11c3QgaW1wbGVtZW50IEVtYmVyLkFycmF5LiBZ
b3UgcGFzc2VkICVAIiwgW2NvbnRlbnRdKSwgRW1iZXIuQXJyYXkuZGV0ZWN0KGNvbnRlbnQpKTsK
ICB9LAoKICAvKioKICAgIFJlbW92ZXMgdGhlIGNvbnRlbnQgYW5kIGNvbnRlbnQgb2JzZXJ2ZXJz
LgoKICAgIEBtZXRob2QgZGVzdHJveQogICovCiAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICBp
ZiAoIXRoaXMuX3N1cGVyKCkpIHsgcmV0dXJuOyB9CgogICAgdmFyIGNvbnRlbnQgPSBnZXQodGhp
cywgJ2NvbnRlbnQnKTsKICAgIGlmIChjb250ZW50KSB7IGNvbnRlbnQucmVtb3ZlQXJyYXlPYnNl
cnZlcih0aGlzKTsgfQoKICAgIGlmICh0aGlzLl9jcmVhdGVkRW1wdHlWaWV3KSB7CiAgICAgIHRo
aXMuX2NyZWF0ZWRFbXB0eVZpZXcuZGVzdHJveSgpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwog
IH0sCgogIC8qKgogICAgQ2FsbGVkIHdoZW4gYSBtdXRhdGlvbiB0byB0aGUgdW5kZXJseWluZyBj
b250ZW50IGFycmF5IHdpbGwgb2NjdXIuCgogICAgVGhpcyBtZXRob2Qgd2lsbCByZW1vdmUgYW55
IHZpZXdzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgdW5kZXJseWluZwogICAgY29udGVudCBh
cnJheS4KCiAgICBJbnZva2VzIHdoZW5ldmVyIHRoZSBjb250ZW50IGFycmF5IGl0c2VsZiB3aWxs
IGNoYW5nZS4KCiAgICBAbWV0aG9kIGFycmF5V2lsbENoYW5nZQogICAgQHBhcmFtIHtBcnJheX0g
Y29udGVudCB0aGUgbWFuYWdlZCBjb2xsZWN0aW9uIG9mIG9iamVjdHMKICAgIEBwYXJhbSB7TnVt
YmVyfSBzdGFydCB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGNoYW5nZXMgd2lsbCBvY2N1cnIKICAg
IEBwYXJhbSB7TnVtYmVyfSByZW1vdmVkIG51bWJlciBvZiBvYmplY3QgdG8gYmUgcmVtb3ZlZCBm
cm9tIGNvbnRlbnQKICAqLwogIGFycmF5V2lsbENoYW5nZTogZnVuY3Rpb24oY29udGVudCwgc3Rh
cnQsIHJlbW92ZWRDb3VudCkgewogICAgLy8gSWYgdGhlIGNvbnRlbnRzIHdlcmUgZW1wdHkgYmVm
b3JlIGFuZCB0aGlzIHRlbXBsYXRlIGNvbGxlY3Rpb24gaGFzIGFuCiAgICAvLyBlbXB0eSB2aWV3
IHJlbW92ZSBpdCBub3cuCiAgICB2YXIgZW1wdHlWaWV3ID0gZ2V0KHRoaXMsICdlbXB0eVZpZXcn
KTsKICAgIGlmIChlbXB0eVZpZXcgJiYgZW1wdHlWaWV3IGluc3RhbmNlb2YgRW1iZXIuVmlldykg
ewogICAgICBlbXB0eVZpZXcucmVtb3ZlRnJvbVBhcmVudCgpOwogICAgfQoKICAgIC8vIExvb3Ag
dGhyb3VnaCBjaGlsZCB2aWV3cyB0aGF0IGNvcnJlc3BvbmQgd2l0aCB0aGUgcmVtb3ZlZCBpdGVt
cy4KICAgIC8vIE5vdGUgdGhhdCB3ZSBsb29wIGZyb20gdGhlIGVuZCBvZiB0aGUgYXJyYXkgdG8g
dGhlIGJlZ2lubmluZyBiZWNhdXNlCiAgICAvLyB3ZSBhcmUgbXV0YXRpbmcgaXQgYXMgd2UgZ28u
CiAgICB2YXIgY2hpbGRWaWV3cyA9IHRoaXMuX2NoaWxkVmlld3MsIGNoaWxkVmlldywgaWR4LCBs
ZW47CgogICAgbGVuID0gdGhpcy5fY2hpbGRWaWV3cy5sZW5ndGg7CgogICAgdmFyIHJlbW92aW5n
QWxsID0gcmVtb3ZlZENvdW50ID09PSBsZW47CgogICAgaWYgKHJlbW92aW5nQWxsKSB7CiAgICAg
IHRoaXMuY3VycmVudFN0YXRlLmVtcHR5KHRoaXMpOwogICAgICB0aGlzLmludm9rZVJlY3Vyc2l2
ZWx5KGZ1bmN0aW9uKHZpZXcpIHsKICAgICAgICB2aWV3LnJlbW92ZWRGcm9tRE9NID0gdHJ1ZTsK
ICAgICAgfSwgZmFsc2UpOwogICAgfQoKICAgIGZvciAoaWR4ID0gc3RhcnQgKyByZW1vdmVkQ291
bnQgLSAxOyBpZHggPj0gc3RhcnQ7IGlkeC0tKSB7CiAgICAgIGNoaWxkVmlldyA9IGNoaWxkVmll
d3NbaWR4XTsKICAgICAgY2hpbGRWaWV3LmRlc3Ryb3koKTsKICAgIH0KICB9LAoKICAvKioKICAg
IENhbGxlZCB3aGVuIGEgbXV0YXRpb24gdG8gdGhlIHVuZGVybHlpbmcgY29udGVudCBhcnJheSBv
Y2N1cnMuCgogICAgVGhpcyBtZXRob2Qgd2lsbCByZXBsYXkgdGhhdCBtdXRhdGlvbiBhZ2FpbnN0
IHRoZSB2aWV3cyB0aGF0IGNvbXBvc2UgdGhlCiAgICBgRW1iZXIuQ29sbGVjdGlvblZpZXdgLCBl
bnN1cmluZyB0aGF0IHRoZSB2aWV3IHJlZmxlY3RzIHRoZSBtb2RlbC4KCiAgICBUaGlzIGFycmF5
IG9ic2VydmVyIGlzIGFkZGVkIGluIGBjb250ZW50RGlkQ2hhbmdlYC4KCiAgICBAbWV0aG9kIGFy
cmF5RGlkQ2hhbmdlCiAgICBAcGFyYW0ge0FycmF5fSBjb250ZW50IHRoZSBtYW5hZ2VkIGNvbGxl
Y3Rpb24gb2Ygb2JqZWN0cwogICAgQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0IHRoZSBpbmRleCBhdCB3
aGljaCB0aGUgY2hhbmdlcyBvY2N1cnJlZAogICAgQHBhcmFtIHtOdW1iZXJ9IHJlbW92ZWQgbnVt
YmVyIG9mIG9iamVjdCByZW1vdmVkIGZyb20gY29udGVudAogICAgQHBhcmFtIHtOdW1iZXJ9IGFk
ZGVkIG51bWJlciBvZiBvYmplY3QgYWRkZWQgdG8gY29udGVudAogICovCiAgYXJyYXlEaWRDaGFu
Z2U6IGZ1bmN0aW9uKGNvbnRlbnQsIHN0YXJ0LCByZW1vdmVkLCBhZGRlZCkgewogICAgdmFyIGFk
ZGVkVmlld3MgPSBbXSwgdmlldywgaXRlbSwgaWR4LCBsZW4sIGl0ZW1WaWV3Q2xhc3MsCiAgICAg
IGVtcHR5VmlldzsKCiAgICBsZW4gPSBjb250ZW50ID8gZ2V0KGNvbnRlbnQsICdsZW5ndGgnKSA6
IDA7CgogICAgaWYgKGxlbikgewogICAgICBpdGVtVmlld0NsYXNzID0gZ2V0KHRoaXMsICdpdGVt
Vmlld0NsYXNzJyk7CgogICAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBpdGVtVmlld0NsYXNz
KSB7CiAgICAgICAgaXRlbVZpZXdDbGFzcyA9IGdldChpdGVtVmlld0NsYXNzKSB8fCBpdGVtVmll
d0NsYXNzOwogICAgICB9CgogICAgICBFbWJlci5hc3NlcnQoZm10KCJpdGVtVmlld0NsYXNzIG11
c3QgYmUgYSBzdWJjbGFzcyBvZiBFbWJlci5WaWV3LCBub3QgJUAiLCBbaXRlbVZpZXdDbGFzc10p
LCAnc3RyaW5nJyA9PT0gdHlwZW9mIGl0ZW1WaWV3Q2xhc3MgfHwgRW1iZXIuVmlldy5kZXRlY3Qo
aXRlbVZpZXdDbGFzcykpOwoKICAgICAgZm9yIChpZHggPSBzdGFydDsgaWR4IDwgc3RhcnQrYWRk
ZWQ7IGlkeCsrKSB7CiAgICAgICAgaXRlbSA9IGNvbnRlbnQub2JqZWN0QXQoaWR4KTsKCiAgICAg
ICAgdmlldyA9IHRoaXMuY3JlYXRlQ2hpbGRWaWV3KGl0ZW1WaWV3Q2xhc3MsIHsKICAgICAgICAg
IGNvbnRlbnQ6IGl0ZW0sCiAgICAgICAgICBjb250ZW50SW5kZXg6IGlkeAogICAgICAgIH0pOwoK
ICAgICAgICBhZGRlZFZpZXdzLnB1c2godmlldyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAg
IGVtcHR5VmlldyA9IGdldCh0aGlzLCAnZW1wdHlWaWV3Jyk7CgogICAgICBpZiAoIWVtcHR5Vmll
dykgeyByZXR1cm47IH0KCiAgICAgIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIGVtcHR5Vmlldykg
ewogICAgICAgIGVtcHR5VmlldyA9IGdldChlbXB0eVZpZXcpIHx8IGVtcHR5VmlldzsKICAgICAg
fQoKICAgICAgZW1wdHlWaWV3ID0gdGhpcy5jcmVhdGVDaGlsZFZpZXcoZW1wdHlWaWV3KTsKICAg
ICAgYWRkZWRWaWV3cy5wdXNoKGVtcHR5Vmlldyk7CiAgICAgIHNldCh0aGlzLCAnZW1wdHlWaWV3
JywgZW1wdHlWaWV3KTsKCiAgICAgIGlmIChFbWJlci5Db3JlVmlldy5kZXRlY3QoZW1wdHlWaWV3
KSkgewogICAgICAgIHRoaXMuX2NyZWF0ZWRFbXB0eVZpZXcgPSBlbXB0eVZpZXc7CiAgICAgIH0K
ICAgIH0KCiAgICB0aGlzLnJlcGxhY2Uoc3RhcnQsIDAsIGFkZGVkVmlld3MpOwogIH0sCgogIC8q
KgogICAgSW5zdGFudGlhdGVzIGEgdmlldyB0byBiZSBhZGRlZCB0byB0aGUgY2hpbGRWaWV3cyBh
cnJheSBkdXJpbmcgdmlldwogICAgaW5pdGlhbGl6YXRpb24uIFlvdSBnZW5lcmFsbHkgd2lsbCBu
b3QgY2FsbCB0aGlzIG1ldGhvZCBkaXJlY3RseSB1bmxlc3MKICAgIHlvdSBhcmUgb3ZlcnJpZGlu
ZyBgY3JlYXRlQ2hpbGRWaWV3cygpYC4gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIHdpbGwKICAgIGF1
dG9tYXRpY2FsbHkgY29uZmlndXJlIHRoZSBjb3JyZWN0IHNldHRpbmdzIG9uIHRoZSBuZXcgdmll
dyBpbnN0YW5jZSB0bwogICAgYWN0IGFzIGEgY2hpbGQgb2YgdGhlIHBhcmVudC4KCiAgICBUaGUg
dGFnIG5hbWUgZm9yIHRoZSB2aWV3IHdpbGwgYmUgc2V0IHRvIHRoZSB0YWdOYW1lIG9mIHRoZSB2
aWV3Q2xhc3MKICAgIHBhc3NlZCBpbi4KCiAgICBAbWV0aG9kIGNyZWF0ZUNoaWxkVmlldwogICAg
QHBhcmFtIHtDbGFzc30gdmlld0NsYXNzCiAgICBAcGFyYW0ge0hhc2h9IFthdHRyc10gQXR0cmli
dXRlcyB0byBhZGQKICAgIEByZXR1cm4ge0VtYmVyLlZpZXd9IG5ldyBpbnN0YW5jZQogICovCiAg
Y3JlYXRlQ2hpbGRWaWV3OiBmdW5jdGlvbih2aWV3LCBhdHRycykgewogICAgdmlldyA9IHRoaXMu
X3N1cGVyKHZpZXcsIGF0dHJzKTsKCiAgICB2YXIgaXRlbVRhZ05hbWUgPSBnZXQodmlldywgJ3Rh
Z05hbWUnKTsKCiAgICBpZiAoaXRlbVRhZ05hbWUgPT09IG51bGwgfHwgaXRlbVRhZ05hbWUgPT09
IHVuZGVmaW5lZCkgewogICAgICBpdGVtVGFnTmFtZSA9IEVtYmVyLkNvbGxlY3Rpb25WaWV3LkNP
TlRBSU5FUl9NQVBbZ2V0KHRoaXMsICd0YWdOYW1lJyldOwogICAgICBzZXQodmlldywgJ3RhZ05h
bWUnLCBpdGVtVGFnTmFtZSk7CiAgICB9CgogICAgcmV0dXJuIHZpZXc7CiAgfQp9KTsKCi8qKgog
IEEgbWFwIG9mIHBhcmVudCB0YWdzIHRvIHRoZWlyIGRlZmF1bHQgY2hpbGQgdGFncy4gWW91IGNh
biBhZGQKICBhZGRpdGlvbmFsIHBhcmVudCB0YWdzIGlmIHlvdSB3YW50IGNvbGxlY3Rpb24gdmll
d3MgdGhhdCB1c2UKICBhIHBhcnRpY3VsYXIgcGFyZW50IHRhZyB0byBkZWZhdWx0IHRvIGEgY2hp
bGQgdGFnLgoKICBAcHJvcGVydHkgQ09OVEFJTkVSX01BUAogIEB0eXBlIEhhc2gKICBAc3RhdGlj
CiAgQGZpbmFsCiovCkVtYmVyLkNvbGxlY3Rpb25WaWV3LkNPTlRBSU5FUl9NQVAgPSB7CiAgdWw6
ICdsaScsCiAgb2w6ICdsaScsCiAgdGFibGU6ICd0cicsCiAgdGhlYWQ6ICd0cicsCiAgdGJvZHk6
ICd0cicsCiAgdGZvb3Q6ICd0cicsCiAgdHI6ICd0ZCcsCiAgc2VsZWN0OiAnb3B0aW9uJwp9OwoK
fSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5z
ZXQsIGlzTm9uZSA9IEVtYmVyLmlzTm9uZSwKICAgIGFfc2xpY2UgPSBBcnJheS5wcm90b3R5cGUu
c2xpY2U7CgoKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwoqLwoKLyoq
CiAgQW4gYEVtYmVyLkNvbXBvbmVudGAgaXMgYSB2aWV3IHRoYXQgaXMgY29tcGxldGVseQogIGlz
b2xhdGVkLiBQcm9wZXJ0eSBhY2Nlc3MgaW4gaXRzIHRlbXBsYXRlcyBnbwogIHRvIHRoZSB2aWV3
IG9iamVjdCBhbmQgYWN0aW9ucyBhcmUgdGFyZ2V0ZWQgYXQKICB0aGUgdmlldyBvYmplY3QuIFRo
ZXJlIGlzIG5vIGFjY2VzcyB0byB0aGUKICBzdXJyb3VuZGluZyBjb250ZXh0IG9yIG91dGVyIGNv
bnRyb2xsZXI7IGFsbAogIGNvbnRleHR1YWwgaW5mb3JtYXRpb24gbXVzdCBiZSBwYXNzZWQgaW4u
CgogIFRoZSBlYXNpZXN0IHdheSB0byBjcmVhdGUgYW4gYEVtYmVyLkNvbXBvbmVudGAgaXMgdmlh
CiAgYSB0ZW1wbGF0ZS4gSWYgeW91IG5hbWUgYSB0ZW1wbGF0ZQogIGBjb21wb25lbnRzL215LWZv
b2AsIHlvdSB3aWxsIGJlIGFibGUgdG8gdXNlCiAgYHt7bXktZm9vfX1gIGluIG90aGVyIHRlbXBs
YXRlcywgd2hpY2ggd2lsbCBtYWtlCiAgYW4gaW5zdGFuY2Ugb2YgdGhlIGlzb2xhdGVkIGNvbXBv
bmVudC4KCiAgYGBgaHRtbAogIHt7YXBwLXByb2ZpbGUgcGVyc29uPWN1cnJlbnRVc2VyfX0KICBg
YGAKCiAgYGBgaHRtbAogIDwhLS0gYXBwLXByb2ZpbGUgdGVtcGxhdGUgLS0+CiAgPGgxPnt7cGVy
c29uLnRpdGxlfX08L2gxPgogIDxpbWcge3tiaW5kLWF0dHIgc3JjPXBlcnNvbi5hdmF0YXJ9fT4K
ICA8cCBjbGFzcz0nc2lnbmF0dXJlJz57e3BlcnNvbi5zaWduYXR1cmV9fTwvcD4KICBgYGAKCiAg
WW91IGNhbiB1c2UgYHlpZWxkYCBpbnNpZGUgYSB0ZW1wbGF0ZSB0bwogIGluY2x1ZGUgdGhlICoq
Y29udGVudHMqKiBvZiBhbnkgYmxvY2sgYXR0YWNoZWQgdG8KICB0aGUgY29tcG9uZW50LiBUaGUg
YmxvY2sgd2lsbCBiZSBleGVjdXRlZCBpbiB0aGUKICBjb250ZXh0IG9mIHRoZSBzdXJyb3VuZGlu
ZyBjb250ZXh0IG9yIG91dGVyIGNvbnRyb2xsZXI6CgogIGBgYGhhbmRsZWJhcnMKICB7eyNhcHAt
cHJvZmlsZSBwZXJzb249Y3VycmVudFVzZXJ9fQogICAgPHA+QWRtaW4gbW9kZTwvcD4KICAgIHt7
ISBFeGVjdXRlZCBpbiB0aGUgY29udHJvbGxlcnMgY29udGV4dC4gfX0KICB7ey9hcHAtcHJvZmls
ZX19CiAgYGBgCgogIGBgYGhhbmRsZWJhcnMKICA8IS0tIGFwcC1wcm9maWxlIHRlbXBsYXRlIC0t
PgogIDxoMT57e3BlcnNvbi50aXRsZX19PC9oMT4KICB7eyEgRXhlY3V0ZWQgaW4gdGhlIGNvbXBv
bmVudHMgY29udGV4dC4gfX0KICB7e3lpZWxkfX0ge3shIGJsb2NrIGNvbnRlbnRzIH19CiAgYGBg
CgogIElmIHlvdSB3YW50IHRvIGN1c3RvbWl6ZSB0aGUgY29tcG9uZW50LCBpbiBvcmRlciB0bwog
IGhhbmRsZSBldmVudHMgb3IgYWN0aW9ucywgeW91IGltcGxlbWVudCBhIHN1YmNsYXNzCiAgb2Yg
YEVtYmVyLkNvbXBvbmVudGAgbmFtZWQgYWZ0ZXIgdGhlIG5hbWUgb2YgdGhlCiAgY29tcG9uZW50
LiBOb3RlIHRoYXQgYENvbXBvbmVudGAgbmVlZHMgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIG5hbWUg
b2YKICB5b3VyIHN1YmNsYXNzIGxpa2UgYEFwcFByb2ZpbGVDb21wb25lbnRgLgoKICBGb3IgZXhh
bXBsZSwgeW91IGNvdWxkIGltcGxlbWVudCB0aGUgYWN0aW9uCiAgYGhlbGxvYCBmb3IgdGhlIGBh
cHAtcHJvZmlsZWAgY29tcG9uZW50OgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLkFwcFByb2ZpbGVD
b21wb25lbnQgPSBFbWJlci5Db21wb25lbnQuZXh0ZW5kKHsKICAgIGFjdGlvbnM6IHsKICAgICAg
aGVsbG86IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBjb25zb2xlLmxvZygiSGVsbG8iLCBuYW1l
KTsKICAgICAgfQogICAgfQogIH0pOwogIGBgYAoKICBBbmQgdGhlbiB1c2UgaXQgaW4gdGhlIGNv
bXBvbmVudCdzIHRlbXBsYXRlOgoKICBgYGBodG1sCiAgPCEtLSBhcHAtcHJvZmlsZSB0ZW1wbGF0
ZSAtLT4KCiAgPGgxPnt7cGVyc29uLnRpdGxlfX08L2gxPgogIHt7eWllbGR9fSA8IS0tIGJsb2Nr
IGNvbnRlbnRzIC0tPgoKICA8YnV0dG9uIHt7YWN0aW9uICdoZWxsbycgcGVyc29uLm5hbWV9fT4K
ICAgIFNheSBIZWxsbyB0byB7e3BlcnNvbi5uYW1lfX0KICA8L2J1dHRvbj4KICBgYGAKCiAgQ29t
cG9uZW50cyBtdXN0IGhhdmUgYSBgLWAgaW4gdGhlaXIgbmFtZSB0byBhdm9pZAogIGNvbmZsaWN0
cyB3aXRoIGJ1aWx0LWluIGNvbnRyb2xzIHRoYXQgd3JhcCBIVE1MCiAgZWxlbWVudHMuIFRoaXMg
aXMgY29uc2lzdGVudCB3aXRoIHRoZSBzYW1lCiAgcmVxdWlyZW1lbnQgaW4gd2ViIGNvbXBvbmVu
dHMuCgogIEBjbGFzcyBDb21wb25lbnQKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1i
ZXIuVmlldwoqLwpFbWJlci5Db21wb25lbnQgPSBFbWJlci5WaWV3LmV4dGVuZChFbWJlci5UYXJn
ZXRBY3Rpb25TdXBwb3J0LCB7CiAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9zdXBlcigp
OwogICAgc2V0KHRoaXMsICdjb250ZXh0JywgdGhpcyk7CiAgICBzZXQodGhpcywgJ2NvbnRyb2xs
ZXInLCB0aGlzKTsKICB9LAoKICBkZWZhdWx0TGF5b3V0OiBmdW5jdGlvbihvcHRpb25zKXsKICAg
IG9wdGlvbnMuZGF0YSA9IHt2aWV3OiBvcHRpb25zLl9jb250ZXh0fTsKICAgIEVtYmVyLkhhbmRs
ZWJhcnMuaGVscGVyc1sneWllbGQnXS5hcHBseSh0aGlzLCBbb3B0aW9uc10pOwogIH0sCgogIC8v
IGR1cmluZyByZW5kZXIsIGlzb2xhdGUga2V5d29yZHMKICBjbG9uZUtleXdvcmRzOiBmdW5jdGlv
bigpIHsKICAgIHJldHVybiB7CiAgICAgIHZpZXc6IHRoaXMsCiAgICAgIGNvbnRyb2xsZXI6IHRo
aXMKICAgIH07CiAgfSwKCiAgX3lpZWxkOiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAg
ICB2YXIgdmlldyA9IG9wdGlvbnMuZGF0YS52aWV3LAogICAgICAgIHBhcmVudFZpZXcgPSB0aGlz
Ll9wYXJlbnRWaWV3LAogICAgICAgIHRlbXBsYXRlID0gZ2V0KHRoaXMsICd0ZW1wbGF0ZScpOwoK
ICAgIGlmICh0ZW1wbGF0ZSkgewogICAgICBFbWJlci5hc3NlcnQoIkEgQ29tcG9uZW50IG11c3Qg
aGF2ZSBhIHBhcmVudCB2aWV3IGluIG9yZGVyIHRvIHlpZWxkLiIsIHBhcmVudFZpZXcpOwoKICAg
ICAgdmlldy5hcHBlbmRDaGlsZChFbWJlci5WaWV3LCB7CiAgICAgICAgaXNWaXJ0dWFsOiB0cnVl
LAogICAgICAgIHRhZ05hbWU6ICcnLAogICAgICAgIF9jb250ZXh0VmlldzogcGFyZW50VmlldywK
ICAgICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsCiAgICAgICAgY29udGV4dDogZ2V0KHBhcmVudFZp
ZXcsICdjb250ZXh0JyksCiAgICAgICAgY29udHJvbGxlcjogZ2V0KHBhcmVudFZpZXcsICdjb250
cm9sbGVyJyksCiAgICAgICAgdGVtcGxhdGVEYXRhOiB7IGtleXdvcmRzOiBwYXJlbnRWaWV3LmNs
b25lS2V5d29yZHMoKSB9CiAgICAgIH0pOwogICAgfQogIH0sCgogIC8qKgogICAgSWYgdGhlIGNv
bXBvbmVudCBpcyBjdXJyZW50bHkgaW5zZXJ0ZWQgaW50byB0aGUgRE9NIG9mIGEgcGFyZW50IHZp
ZXcsIHRoaXMKICAgIHByb3BlcnR5IHdpbGwgcG9pbnQgdG8gdGhlIGNvbnRyb2xsZXIgb2YgdGhl
IHBhcmVudCB2aWV3LgoKICAgIEBwcm9wZXJ0eSB0YXJnZXRPYmplY3QKICAgIEB0eXBlIEVtYmVy
LkNvbnRyb2xsZXIKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIHRhcmdldE9iamVjdDogRW1iZXIu
Y29tcHV0ZWQoZnVuY3Rpb24oa2V5KSB7CiAgICB2YXIgcGFyZW50VmlldyA9IGdldCh0aGlzLCAn
X3BhcmVudFZpZXcnKTsKICAgIHJldHVybiBwYXJlbnRWaWV3ID8gZ2V0KHBhcmVudFZpZXcsICdj
b250cm9sbGVyJykgOiBudWxsOwogIH0pLnByb3BlcnR5KCdfcGFyZW50VmlldycpLAoKICAvKioK
ICAgIFRyaWdnZXJzIGEgbmFtZWQgYWN0aW9uIG9uIHRoZSBjb250cm9sbGVyIGNvbnRleHQgd2hl
cmUgdGhlIGNvbXBvbmVudCBpcyB1c2VkIGlmCiAgICB0aGlzIGNvbnRyb2xsZXIgaGFzIHJlZ2lz
dGVyZWQgZm9yIG5vdGlmaWNhdGlvbnMgb2YgdGhlIGFjdGlvbi4KCiAgICBGb3IgZXhhbXBsZSBh
IGNvbXBvbmVudCBmb3IgcGxheWluZyBvciBwYXVzaW5nIG11c2ljIG1heSB0cmFuc2xhdGUgY2xp
Y2sgZXZlbnRzCiAgICBpbnRvIGFjdGlvbiBub3RpZmljYXRpb25zIG9mICJwbGF5IiBvciAic3Rv
cCIgZGVwZW5kaW5nIG9uIHNvbWUgaW50ZXJuYWwgc3RhdGUKICAgIG9mIHRoZSBjb21wb25lbnQ6
CgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5QbGF5QnV0dG9uQ29tcG9uZW50ID0gRW1iZXIu
Q29tcG9uZW50LmV4dGVuZCh7CiAgICAgIGNsaWNrOiBmdW5jdGlvbigpewogICAgICAgIGlmICh0
aGlzLmdldCgnaXNQbGF5aW5nJykpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlckFjdGlvbigncGxh
eScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRyaWdnZXJBY3Rpb24oJ3N0b3An
KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgV2hlbiB1c2VkIGluc2lk
ZSBhIHRlbXBsYXRlIHRoZXNlIGNvbXBvbmVudCBhY3Rpb25zIGFyZSBjb25maWd1cmVkIHRvCiAg
ICB0cmlnZ2VyIGFjdGlvbnMgaW4gdGhlIG91dGVyIGFwcGxpY2F0aW9uIGNvbnRleHQ6CgogICAg
YGBgaGFuZGxlYmFycwogICAge3shIGFwcGxpY2F0aW9uLmhicyB9fQogICAge3twbGF5LWJ1dHRv
biBwbGF5PSJtdXNpY1N0YXJ0ZWQiIHN0b3A9Im11c2ljU3RvcHBlZCJ9fQogICAgYGBgCgogICAg
V2hlbiB0aGUgY29tcG9uZW50IHJlY2VpdmVzIGEgYnJvd3NlciBgY2xpY2tgIGV2ZW50IGl0IHRy
YW5zbGF0ZSB0aGlzCiAgICBpbnRlcmFjdGlvbiBpbnRvIGFwcGxpY2F0aW9uLXNwZWNpZmljIHNl
bWFudGljcyAoInBsYXkiIG9yICJzdG9wIikgYW5kCiAgICB0cmlnZ2VycyB0aGUgc3BlY2lmaWVk
IGFjdGlvbiBuYW1lIG9uIHRoZSBjb250cm9sbGVyIGZvciB0aGUgdGVtcGxhdGUKICAgIHdoZXJl
IHRoZSBjb21wb25lbnQgaXMgdXNlZDogCgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5BcHBs
aWNhdGlvbkNvbnRyb2xsZXIgPSBFbWJlci5Db250cm9sbGVyLmV4dGVuZCh7CiAgICAgIGFjdGlv
bnM6IHsKICAgICAgICBtdXNpY1N0YXJ0ZWQ6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAvLyBjYWxs
ZWQgd2hlbiB0aGUgcGxheSBidXR0b24gaXMgY2xpY2tlZAogICAgICAgICAgLy8gYW5kIHRoZSBt
dXNpYyBzdGFydGVkIHBsYXlpbmcKICAgICAgICB9LAogICAgICAgIG11c2ljU3RvcHBlZDogZnVu
Y3Rpb24oKXsKICAgICAgICAgIC8vIGNhbGxlZCB3aGVuIHRoZSBwbGF5IGJ1dHRvbiBpcyBjbGlj
a2VkCiAgICAgICAgICAvLyBhbmQgdGhlIG11c2ljIHN0b3BwZWQgcGxheWluZwogICAgICAgIH0K
ICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBJZiBubyBhY3Rpb24gbmFtZSBpcyBwYXNzZWQg
dG8gYHNlbmRBY3Rpb25gIGEgZGVmYXVsdCBuYW1lIG9mICJhY3Rpb24iCiAgICBpcyBhc3N1bWVk
LgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5OZXh0QnV0dG9uQ29tcG9uZW50ID0gRW1iZXIu
Q29tcG9uZW50LmV4dGVuZCh7CiAgICAgIGNsaWNrOiBmdW5jdGlvbigpewogICAgICAgIHRoaXMu
c2VuZEFjdGlvbigpOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIGBgYGhhbmRsZWJhcnMK
ICAgIHt7ISBhcHBsaWNhdGlvbi5oYnMgfX0KICAgIHt7bmV4dC1idXR0b24gYWN0aW9uPSJwbGF5
TmV4dFNvbmdJbkFsYnVtIn19CiAgICBgYGAKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQXBw
bGljYXRpb25Db250cm9sbGVyID0gRW1iZXIuQ29udHJvbGxlci5leHRlbmQoewogICAgICBhY3Rp
b25zOiB7CiAgICAgICAgcGxheU5leHRTb25nSW5BbGJ1bTogZnVuY3Rpb24oKXsKICAgICAgICAg
IC4uLgogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIHNlbmRB
Y3Rpb24KICAgIEBwYXJhbSBbYWN0aW9uXSB7U3RyaW5nfSB0aGUgYWN0aW9uIHRvIHRyaWdnZXIK
ICAgIEBwYXJhbSBbY29udGV4dF0geyp9IGEgY29udGV4dCB0byBzZW5kIHdpdGggdGhlIGFjdGlv
bgogICovCiAgc2VuZEFjdGlvbjogZnVuY3Rpb24oYWN0aW9uKSB7CiAgICB2YXIgYWN0aW9uTmFt
ZSwKICAgICAgICBjb250ZXh0cyA9IGFfc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKICAgIC8v
IFNlbmQgdGhlIGRlZmF1bHQgYWN0aW9uCiAgICBpZiAoYWN0aW9uID09PSB1bmRlZmluZWQpIHsK
ICAgICAgYWN0aW9uTmFtZSA9IGdldCh0aGlzLCAnYWN0aW9uJyk7CiAgICAgIEVtYmVyLmFzc2Vy
dCgiVGhlIGRlZmF1bHQgYWN0aW9uIHdhcyB0cmlnZ2VyZWQgb24gdGhlIGNvbXBvbmVudCAiICsg
dGhpcy50b1N0cmluZygpICsKICAgICAgICAgICAgICAgICAgICIsIGJ1dCB0aGUgYWN0aW9uIG5h
bWUgKCIgKyBhY3Rpb25OYW1lICsgIikgd2FzIG5vdCBhIHN0cmluZy4iLAogICAgICAgICAgICAg
ICAgICAgaXNOb25lKGFjdGlvbk5hbWUpIHx8IHR5cGVvZiBhY3Rpb25OYW1lID09PSAnc3RyaW5n
Jyk7CiAgICB9IGVsc2UgewogICAgICBhY3Rpb25OYW1lID0gZ2V0KHRoaXMsIGFjdGlvbik7CiAg
ICAgIEVtYmVyLmFzc2VydCgiVGhlICIgKyBhY3Rpb24gKyAiIGFjdGlvbiB3YXMgdHJpZ2dlcmVk
IG9uIHRoZSBjb21wb25lbnQgIiArCiAgICAgICAgICAgICAgICAgICB0aGlzLnRvU3RyaW5nKCkg
KyAiLCBidXQgdGhlIGFjdGlvbiBuYW1lICgiICsgYWN0aW9uTmFtZSArCiAgICAgICAgICAgICAg
ICAgICAiKSB3YXMgbm90IGEgc3RyaW5nLiIsCiAgICAgICAgICAgICAgICAgICBpc05vbmUoYWN0
aW9uTmFtZSkgfHwgdHlwZW9mIGFjdGlvbk5hbWUgPT09ICdzdHJpbmcnKTsKICAgIH0KCiAgICAv
LyBJZiBubyBhY3Rpb24gbmFtZSBmb3IgdGhhdCBhY3Rpb24gY291bGQgYmUgZm91bmQsIGp1c3Qg
YWJvcnQuCiAgICBpZiAoYWN0aW9uTmFtZSA9PT0gdW5kZWZpbmVkKSB7IHJldHVybjsgfQoKICAg
IHRoaXMudHJpZ2dlckFjdGlvbih7CiAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgYWN0
aW9uQ29udGV4dDogY29udGV4dHMKICAgIH0pOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpgRW1iZXIuVmlld1RhcmdldEFjdGlvblN1
cHBvcnRgIGlzIGEgbWl4aW4gdGhhdCBjYW4gYmUgaW5jbHVkZWQgaW4gYQp2aWV3IGNsYXNzIHRv
IGFkZCBhIGB0cmlnZ2VyQWN0aW9uYCBtZXRob2Qgd2l0aCBzZW1hbnRpY3Mgc2ltaWxhciB0bwp0
aGUgSGFuZGxlYmFycyBge3thY3Rpb259fWAgaGVscGVyLiBJdCBwcm92aWRlcyBpbnRlbGxpZ2Vu
dCBkZWZhdWx0cwpmb3IgdGhlIGFjdGlvbidzIHRhcmdldDogdGhlIHZpZXcncyBjb250cm9sbGVy
OyBhbmQgdGhlIGNvbnRleHQgdGhhdCBpcwpzZW50IHdpdGggdGhlIGFjdGlvbjogdGhlIHZpZXcn
cyBjb250ZXh0LgoKTm90ZTogSW4gbm9ybWFsIEVtYmVyIHVzYWdlLCB0aGUgYHt7YWN0aW9ufX1g
IGhlbHBlciBpcyB1c3VhbGx5IHRoZSBiZXN0CmNob2ljZS4gVGhpcyBtaXhpbiBpcyBtb3N0IG9m
dGVuIHVzZWZ1bCB3aGVuIHlvdSBhcmUgZG9pbmcgbW9yZSBjb21wbGV4CmV2ZW50IGhhbmRsaW5n
IGluIGN1c3RvbSBWaWV3IHN1YmNsYXNzZXMuCgpGb3IgZXhhbXBsZToKCmBgYGphdmFzY3JpcHQK
QXBwLlNhdmVCdXR0b25WaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoRW1iZXIuVmlld1RhcmdldEFj
dGlvblN1cHBvcnQsIHsKICBhY3Rpb246ICdzYXZlJywKICBjbGljazogZnVuY3Rpb24oKSB7CiAg
ICB0aGlzLnRyaWdnZXJBY3Rpb24oKTsgLy8gU2VuZHMgdGhlIGBzYXZlYCBhY3Rpb24sIGFsb25n
IHdpdGggdGhlIGN1cnJlbnQgY29udGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRv
IHRoZSBjdXJyZW50IGNvbnRyb2xsZXIKICB9Cn0pOwpgYGAKClRoZSBgYWN0aW9uYCBjYW4gYmUg
cHJvdmlkZWQgYXMgcHJvcGVydGllcyBvZiBhbiBvcHRpb25hbCBvYmplY3QgYXJndW1lbnQKdG8g
YHRyaWdnZXJBY3Rpb25gIGFzIHdlbGwuCgpgYGBqYXZhc2NyaXB0CkFwcC5TYXZlQnV0dG9uVmll
dyA9IEVtYmVyLlZpZXcuZXh0ZW5kKEVtYmVyLlZpZXdUYXJnZXRBY3Rpb25TdXBwb3J0LCB7CiAg
Y2xpY2s6IGZ1bmN0aW9uKCkgewogICAgdGhpcy50cmlnZ2VyQWN0aW9uKHsKICAgICAgYWN0aW9u
OiAnc2F2ZScKICAgIH0pOyAvLyBTZW5kcyB0aGUgYHNhdmVgIGFjdGlvbiwgYWxvbmcgd2l0aCB0
aGUgY3VycmVudCBjb250ZXh0CiAgICAgICAgLy8gdG8gdGhlIGN1cnJlbnQgY29udHJvbGxlcgog
IH0KfSk7CmBgYAoKQGNsYXNzIFZpZXdUYXJnZXRBY3Rpb25TdXBwb3J0CkBuYW1lc3BhY2UgRW1i
ZXIKQGV4dGVuZHMgRW1iZXIuVGFyZ2V0QWN0aW9uU3VwcG9ydAoqLwpFbWJlci5WaWV3VGFyZ2V0
QWN0aW9uU3VwcG9ydCA9IEVtYmVyLk1peGluLmNyZWF0ZShFbWJlci5UYXJnZXRBY3Rpb25TdXBw
b3J0LCB7CiAgLyoqCiAgQHByb3BlcnR5IHRhcmdldAogICovCiAgdGFyZ2V0OiBFbWJlci5jb21w
dXRlZC5hbGlhcygnY29udHJvbGxlcicpLAogIC8qKgogIEBwcm9wZXJ0eSBhY3Rpb25Db250ZXh0
CiAgKi8KICBhY3Rpb25Db250ZXh0OiBFbWJlci5jb21wdXRlZC5hbGlhcygnY29udGV4dCcpCn0p
OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKRW1i
ZXIgVmlld3MKCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci12aWV3cwpAcmVxdWlyZXMg
ZW1iZXItcnVudGltZQpAbWFpbiBlbWJlci12aWV3cwoqLwoKfSkoKTsKCihmdW5jdGlvbigpIHsK
ZGVmaW5lKCJtZXRhbW9ycGgiLAogIFtdLAogIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3Qi
OwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIFByb2plY3Q6ICAgbWV0YW1vcnBoCiAg
ICAvLyBDb3B5cmlnaHQ6IMKpMjAxNCBUaWxkZSwgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLgog
ICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICB2YXIgSyA9IGZ1bmN0aW9uKCkge30sCiAgICAg
ICAgZ3VpZCA9IDAsCiAgICAgICAgZGlzYWJsZVJhbmdlID0gKGZ1bmN0aW9uKCl7CiAgICAgICAg
ICBpZiAoJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBNZXRhbW9ycGhFTlYpIHsKICAgICAgICAgICAg
cmV0dXJuIE1ldGFtb3JwaEVOVi5ESVNBQkxFX1JBTkdFX0FQSTsKICAgICAgICAgIH0gZWxzZSBp
ZiAoJ3VuZGVmaW5lZCcgIT09IEVOVikgewogICAgICAgICAgICByZXR1cm4gRU5WLkRJU0FCTEVf
UkFOR0VfQVBJOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog
ICAgICAgICAgfQogICAgICAgIH0pKCksCgogICAgICAgIC8vIEZlYXR1cmUtZGV0ZWN0IHRoZSBX
M0MgcmFuZ2UgQVBJLCB0aGUgZXh0ZW5kZWQgY2hlY2sgaXMgZm9yIElFOSB3aGljaCBvbmx5IHBh
cnRpYWxseSBzdXBwb3J0cyByYW5nZXMKICAgICAgICBzdXBwb3J0c1JhbmdlID0gKCFkaXNhYmxl
UmFuZ2UpICYmIGRvY3VtZW50ICYmICgnY3JlYXRlUmFuZ2UnIGluIGRvY3VtZW50KSAmJiAodHlw
ZW9mIFJhbmdlICE9PSAndW5kZWZpbmVkJykgJiYgUmFuZ2UucHJvdG90eXBlLmNyZWF0ZUNvbnRl
eHR1YWxGcmFnbWVudCwKCiAgICAgICAgLy8gSW50ZXJuZXQgRXhwbG9yZXIgcHJpb3IgdG8gOSBk
b2VzIG5vdCBhbGxvdyBzZXR0aW5nIGlubmVySFRNTCBpZiB0aGUgZmlyc3QgZWxlbWVudAogICAg
ICAgIC8vIGlzIGEgInplcm8tc2NvcGUiIGVsZW1lbnQuIFRoaXMgcHJvYmxlbSBjYW4gYmUgd29y
a2VkIGFyb3VuZCBieSBtYWtpbmcKICAgICAgICAvLyB0aGUgZmlyc3Qgbm9kZSBhbiBpbnZpc2li
bGUgdGV4dCBub2RlLiBXZSwgbGlrZSBNb2Rlcm5penIsIHVzZSAmc2h5OwogICAgICAgIG5lZWRz
U2h5ID0gZG9jdW1lbnQgJiYgKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHRlc3RFbCA9IGRv
Y3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgdGVzdEVsLmlubmVySFRNTCA9
ICI8ZGl2PjwvZGl2PiI7CiAgICAgICAgICB0ZXN0RWwuZmlyc3RDaGlsZC5pbm5lckhUTUwgPSAi
PHNjcmlwdD48L3NjcmlwdD4iOwogICAgICAgICAgcmV0dXJuIHRlc3RFbC5maXJzdENoaWxkLmlu
bmVySFRNTCA9PT0gJyc7CiAgICAgICAgfSkoKSwKCgogICAgICAgIC8vIElFIDggKGFuZCBsaWtl
bHkgZWFybGllcikgbGlrZXMgdG8gbW92ZSB3aGl0ZXNwYWNlIHByZWNlZWRpbmcKICAgICAgICAv
LyBhIHNjcmlwdCB0YWcgdG8gYXBwZWFyIGFmdGVyIGl0LiBUaGlzIG1lYW5zIHRoYXQgd2UgY2Fu
CiAgICAgICAgLy8gYWNjaWRlbnRhbGx5IHJlbW92ZSB3aGl0ZXNwYWNlIHdoZW4gdXBkYXRpbmcg
YSBtb3JwaC4KICAgICAgICBtb3Zlc1doaXRlc3BhY2UgPSBkb2N1bWVudCAmJiAoZnVuY3Rpb24o
KSB7CiAgICAgICAgICB2YXIgdGVzdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7
CiAgICAgICAgICB0ZXN0RWwuaW5uZXJIVE1MID0gIlRlc3Q6IDxzY3JpcHQgdHlwZT0ndGV4dC94
LXBsYWNlaG9sZGVyJz48L3NjcmlwdD5WYWx1ZSI7CiAgICAgICAgICByZXR1cm4gdGVzdEVsLmNo
aWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAnVGVzdDonICYmCiAgICAgICAgICAgICAgICAgIHRl
c3RFbC5jaGlsZE5vZGVzWzJdLm5vZGVWYWx1ZSA9PT0gJyBWYWx1ZSc7CiAgICAgICAgfSkoKTsK
CiAgICAvLyBDb25zdHJ1Y3RvciB0aGF0IHN1cHBvcnRzIGVpdGhlciBNZXRhbW9ycGgoJ2Zvbycp
IG9yIG5ldwogICAgLy8gTWV0YW1vcnBoKCdmb28nKTsKICAgIC8vCiAgICAvLyBUYWtlcyBhIHN0
cmluZyBvZiBIVE1MIGFzIHRoZSBhcmd1bWVudC4KCiAgICB2YXIgTWV0YW1vcnBoID0gZnVuY3Rp
b24oaHRtbCkgewogICAgICB2YXIgc2VsZjsKCiAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgTWV0
YW1vcnBoKSB7CiAgICAgICAgc2VsZiA9IHRoaXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2Vs
ZiA9IG5ldyBLKCk7CiAgICAgIH0KCiAgICAgIHNlbGYuaW5uZXJIVE1MID0gaHRtbDsKICAgICAg
dmFyIG15R3VpZCA9ICdtZXRhbW9ycGgtJysoZ3VpZCsrKTsKICAgICAgc2VsZi5zdGFydCA9IG15
R3VpZCArICctc3RhcnQnOwogICAgICBzZWxmLmVuZCA9IG15R3VpZCArICctZW5kJzsKCiAgICAg
IHJldHVybiBzZWxmOwogICAgfTsKCiAgICBLLnByb3RvdHlwZSA9IE1ldGFtb3JwaC5wcm90b3R5
cGU7CgogICAgdmFyIHJhbmdlRm9yLCBodG1sRnVuYywgcmVtb3ZlRnVuYywgb3V0ZXJIVE1MRnVu
YywgYXBwZW5kVG9GdW5jLCBhZnRlckZ1bmMsIHByZXBlbmRGdW5jLCBzdGFydFRhZ0Z1bmMsIGVu
ZFRhZ0Z1bmM7CgogICAgb3V0ZXJIVE1MRnVuYyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4g
dGhpcy5zdGFydFRhZygpICsgdGhpcy5pbm5lckhUTUwgKyB0aGlzLmVuZFRhZygpOwogICAgfTsK
CiAgICBzdGFydFRhZ0Z1bmMgPSBmdW5jdGlvbigpIHsKICAgICAgLyoKICAgICAgICogV2UgcmVw
bGFjZSBjaGV2cm9uIGJ5IGl0cyBoZXggY29kZSBpbiBvcmRlciB0byBwcmV2ZW50IGVzY2FwaW5n
IHByb2JsZW1zLgogICAgICAgKiBDaGVjayB0aGlzIHRocmVhZCBmb3IgbW9yZSBleHBsYWluYXRp
b246CiAgICAgICAqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODIzMTA0OC93
aHktdXNlLXgzYy1pbnN0ZWFkLW9mLXdoZW4tZ2VuZXJhdGluZy1odG1sLWZyb20tamF2YXNjcmlw
dAogICAgICAgKi8KICAgICAgcmV0dXJuICI8c2NyaXB0IGlkPSciICsgdGhpcy5zdGFydCArICIn
IHR5cGU9J3RleHQveC1wbGFjZWhvbGRlcic+XHgzQy9zY3JpcHQ+IjsKICAgIH07CgogICAgZW5k
VGFnRnVuYyA9IGZ1bmN0aW9uKCkgewogICAgICAvKgogICAgICAgKiBXZSByZXBsYWNlIGNoZXZy
b24gYnkgaXRzIGhleCBjb2RlIGluIG9yZGVyIHRvIHByZXZlbnQgZXNjYXBpbmcgcHJvYmxlbXMu
CiAgICAgICAqIENoZWNrIHRoaXMgdGhyZWFkIGZvciBtb3JlIGV4cGxhaW5hdGlvbjoKICAgICAg
ICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy84MjMxMDQ4L3doeS11c2UteDNj
LWluc3RlYWQtb2Ytd2hlbi1nZW5lcmF0aW5nLWh0bWwtZnJvbS1qYXZhc2NyaXB0CiAgICAgICAq
LwogICAgICByZXR1cm4gIjxzY3JpcHQgaWQ9JyIgKyB0aGlzLmVuZCArICInIHR5cGU9J3RleHQv
eC1wbGFjZWhvbGRlcic+XHgzQy9zY3JpcHQ+IjsKICAgIH07CgogICAgLy8gSWYgd2UgaGF2ZSB0
aGUgVzNDIHJhbmdlIEFQSSwgdGhpcyBwcm9jZXNzIGlzIHJlbGF0aXZlbHkgc3RyYWlnaHQgZm9y
d2FyZC4KICAgIGlmIChzdXBwb3J0c1JhbmdlKSB7CgogICAgICAvLyBHZXQgYSByYW5nZSBmb3Ig
dGhlIGN1cnJlbnQgbW9ycGguIE9wdGlvbmFsbHkgaW5jbHVkZSB0aGUgc3RhcnRpbmcgYW5kCiAg
ICAgIC8vIGVuZGluZyBwbGFjZWhvbGRlcnMuCiAgICAgIHJhbmdlRm9yID0gZnVuY3Rpb24obW9y
cGgsIG91dGVyVG9vKSB7CiAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2Uo
KTsKICAgICAgICB2YXIgYmVmb3JlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9ycGguc3Rh
cnQpOwogICAgICAgIHZhciBhZnRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vcnBoLmVu
ZCk7CgogICAgICAgIGlmIChvdXRlclRvbykgewogICAgICAgICAgcmFuZ2Uuc2V0U3RhcnRCZWZv
cmUoYmVmb3JlKTsKICAgICAgICAgIHJhbmdlLnNldEVuZEFmdGVyKGFmdGVyKTsKICAgICAgICB9
IGVsc2UgewogICAgICAgICAgcmFuZ2Uuc2V0U3RhcnRBZnRlcihiZWZvcmUpOwogICAgICAgICAg
cmFuZ2Uuc2V0RW5kQmVmb3JlKGFmdGVyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByYW5n
ZTsKICAgICAgfTsKCiAgICAgIGh0bWxGdW5jID0gZnVuY3Rpb24oaHRtbCwgb3V0ZXJUb28pIHsK
ICAgICAgICAvLyBnZXQgYSByYW5nZSBmb3IgdGhlIGN1cnJlbnQgbWV0YW1vcnBoIG9iamVjdAog
ICAgICAgIHZhciByYW5nZSA9IHJhbmdlRm9yKHRoaXMsIG91dGVyVG9vKTsKCiAgICAgICAgLy8g
ZGVsZXRlIHRoZSBjb250ZW50cyBvZiB0aGUgcmFuZ2UsIHdoaWNoIHdpbGwgYmUgdGhlCiAgICAg
ICAgLy8gbm9kZXMgYmV0d2VlbiB0aGUgc3RhcnRpbmcgYW5kIGVuZGluZyBwbGFjZWhvbGRlci4K
ICAgICAgICByYW5nZS5kZWxldGVDb250ZW50cygpOwoKICAgICAgICAvLyBjcmVhdGUgYSBuZXcg
ZG9jdW1lbnQgZnJhZ21lbnQgZm9yIHRoZSBIVE1MCiAgICAgICAgdmFyIGZyYWdtZW50ID0gcmFu
Z2UuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGh0bWwpOwoKICAgICAgICAvLyBpbnNlcnQgdGhl
IGZyYWdtZW50IGludG8gdGhlIHJhbmdlCiAgICAgICAgcmFuZ2UuaW5zZXJ0Tm9kZShmcmFnbWVu
dCk7CiAgICAgIH07CgogICAgICAvKioKICAgICAgKiBAcHVibGljCiAgICAgICoKICAgICAgKiBS
ZW1vdmUgdGhpcyBvYmplY3QgKGluY2x1ZGluZyBzdGFydGluZyBhbmQgZW5kaW5nCiAgICAgICog
cGxhY2Vob2xkZXJzKS4KICAgICAgKgogICAgICAqIEBtZXRob2QgcmVtb3ZlCiAgICAgICovCiAg
ICAgIHJlbW92ZUZ1bmMgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBnZXQgYSByYW5nZSBmb3Ig
dGhlIGN1cnJlbnQgbWV0YW1vcnBoIG9iamVjdCBpbmNsdWRpbmcKICAgICAgICAvLyB0aGUgc3Rh
cnRpbmcgYW5kIGVuZGluZyBwbGFjZWhvbGRlcnMuCiAgICAgICAgdmFyIHJhbmdlID0gcmFuZ2VG
b3IodGhpcywgdHJ1ZSk7CgogICAgICAgIC8vIGRlbGV0ZSB0aGUgZW50aXJlIHJhbmdlLgogICAg
ICAgIHJhbmdlLmRlbGV0ZUNvbnRlbnRzKCk7CiAgICAgIH07CgogICAgICBhcHBlbmRUb0Z1bmMg
PSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFu
Z2UoKTsKICAgICAgICByYW5nZS5zZXRTdGFydChub2RlKTsKICAgICAgICByYW5nZS5jb2xsYXBz
ZShmYWxzZSk7CiAgICAgICAgdmFyIGZyYWcgPSByYW5nZS5jcmVhdGVDb250ZXh0dWFsRnJhZ21l
bnQodGhpcy5vdXRlckhUTUwoKSk7CiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChmcmFnKTsKICAg
ICAgfTsKCiAgICAgIGFmdGVyRnVuYyA9IGZ1bmN0aW9uKGh0bWwpIHsKICAgICAgICB2YXIgcmFu
Z2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgICAgIHZhciBhZnRlciA9IGRvY3VtZW50
LmdldEVsZW1lbnRCeUlkKHRoaXMuZW5kKTsKCiAgICAgICAgcmFuZ2Uuc2V0U3RhcnRBZnRlcihh
ZnRlcik7CiAgICAgICAgcmFuZ2Uuc2V0RW5kQWZ0ZXIoYWZ0ZXIpOwoKICAgICAgICB2YXIgZnJh
Z21lbnQgPSByYW5nZS5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQoaHRtbCk7CiAgICAgICAgcmFu
Z2UuaW5zZXJ0Tm9kZShmcmFnbWVudCk7CiAgICAgIH07CgogICAgICBwcmVwZW5kRnVuYyA9IGZ1
bmN0aW9uKGh0bWwpIHsKICAgICAgICB2YXIgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgp
OwogICAgICAgIHZhciBzdGFydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc3RhcnQp
OwoKICAgICAgICByYW5nZS5zZXRTdGFydEFmdGVyKHN0YXJ0KTsKICAgICAgICByYW5nZS5zZXRF
bmRBZnRlcihzdGFydCk7CgogICAgICAgIHZhciBmcmFnbWVudCA9IHJhbmdlLmNyZWF0ZUNvbnRl
eHR1YWxGcmFnbWVudChodG1sKTsKICAgICAgICByYW5nZS5pbnNlcnROb2RlKGZyYWdtZW50KTsK
ICAgICAgfTsKCiAgICB9IGVsc2UgewogICAgICAvKgogICAgICAgKiBUaGlzIGNvZGUgaXMgbW9z
dGx5IHRha2VuIGZyb20galF1ZXJ5LCB3aXRoIG9uZSBleGNlcHRpb24uIEluIGpRdWVyeSdzIGNh
c2UsIHdlCiAgICAgICAqIGhhdmUgc29tZSBIVE1MIGFuZCB3ZSBuZWVkIHRvIGZpZ3VyZSBvdXQg
aG93IHRvIGNvbnZlcnQgaXQgaW50byBzb21lIG5vZGVzLgogICAgICAgKgogICAgICAgKiBJbiB0
aGlzIGNhc2UsIGpRdWVyeSBuZWVkcyB0byBzY2FuIHRoZSBIVE1MIGxvb2tpbmcgZm9yIGFuIG9w
ZW5pbmcgdGFnIGFuZCB1c2UKICAgICAgICogdGhhdCBhcyB0aGUga2V5IGZvciB0aGUgd3JhcCBt
YXAuIEluIG91ciBjYXNlLCB3ZSBrbm93IHRoZSBwYXJlbnQgbm9kZSwgYW5kCiAgICAgICAqIGNh
biB1c2UgaXRzIHR5cGUgYXMgdGhlIGtleSBmb3IgdGhlIHdyYXAgbWFwLgogICAgICAgKiovCiAg
ICAgIHZhciB3cmFwTWFwID0gewogICAgICAgIHNlbGVjdDogWyAxLCAiPHNlbGVjdCBtdWx0aXBs
ZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iIF0sCiAgICAgICAgZmllbGRzZXQ6IFsgMSwgIjxm
aWVsZHNldD4iLCAiPC9maWVsZHNldD4iIF0sCiAgICAgICAgdGFibGU6IFsgMSwgIjx0YWJsZT4i
LCAiPC90YWJsZT4iIF0sCiAgICAgICAgdGJvZHk6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwv
dGJvZHk+PC90YWJsZT4iIF0sCiAgICAgICAgdHI6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIs
ICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCiAgICAgICAgY29sZ3JvdXA6IFsgMiwgIjx0YWJs
ZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCiAg
ICAgICAgbWFwOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCiAgICAgICAgX2RlZmF1bHQ6IFsg
MCwgIiIsICIiIF0KICAgICAgfTsKCiAgICAgIHZhciBmaW5kQ2hpbGRCeUlkID0gZnVuY3Rpb24o
ZWxlbWVudCwgaWQpIHsKICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09
IGlkKSB7IHJldHVybiBlbGVtZW50OyB9CgogICAgICAgIHZhciBsZW4gPSBlbGVtZW50LmNoaWxk
Tm9kZXMubGVuZ3RoLCBpZHgsIG5vZGUsIGZvdW5kOwogICAgICAgIGZvciAoaWR4PTA7IGlkeDxs
ZW47IGlkeCsrKSB7CiAgICAgICAgICBub2RlID0gZWxlbWVudC5jaGlsZE5vZGVzW2lkeF07CiAg
ICAgICAgICBmb3VuZCA9IG5vZGUubm9kZVR5cGUgPT09IDEgJiYgZmluZENoaWxkQnlJZChub2Rl
LCBpZCk7CiAgICAgICAgICBpZiAoZm91bmQpIHsgcmV0dXJuIGZvdW5kOyB9CiAgICAgICAgfQog
ICAgICB9OwoKICAgICAgdmFyIHNldElubmVySFRNTCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGh0bWwp
IHsKICAgICAgICB2YXIgbWF0Y2hlcyA9IFtdOwogICAgICAgIGlmIChtb3Zlc1doaXRlc3BhY2Up
IHsKICAgICAgICAgIC8vIFJpZ2h0IG5vdyB3ZSBvbmx5IGNoZWNrIGZvciBzY3JpcHQgdGFncyB3
aXRoIGlkcyB3aXRoIHRoZQogICAgICAgICAgLy8gZ29hbCBvZiB0YXJnZXRpbmcgbW9ycGhzLgog
ICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvKFxzKykoPHNjcmlwdCBpZD0nKFteJ10rKScp
L2csIGZ1bmN0aW9uKG1hdGNoLCBzcGFjZXMsIHRhZywgaWQpIHsKICAgICAgICAgICAgbWF0Y2hl
cy5wdXNoKFtpZCwgc3BhY2VzXSk7CiAgICAgICAgICAgIHJldHVybiB0YWc7CiAgICAgICAgICB9
KTsKICAgICAgICB9CgogICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gaHRtbDsKCiAgICAgICAg
Ly8gSWYgd2UgaGF2ZSB0byBkbyBhbnkgd2hpdGVzcGFjZSBhZGp1c3RtZW50cyBkbyB0aGVtIG5v
dwogICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBsZW4gPSBt
YXRjaGVzLmxlbmd0aCwgaWR4OwogICAgICAgICAgZm9yIChpZHg9MDsgaWR4PGxlbjsgaWR4Kysp
IHsKICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGZpbmRDaGlsZEJ5SWQoZWxlbWVudCwgbWF0Y2hl
c1tpZHhdWzBdKSwKICAgICAgICAgICAgICAgIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9k
ZShtYXRjaGVzW2lkeF1bMV0pOwogICAgICAgICAgICBzY3JpcHQucGFyZW50Tm9kZS5pbnNlcnRC
ZWZvcmUobm9kZSwgc2NyaXB0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAg
ICAvKgogICAgICAgKiBHaXZlbiBhIHBhcmVudCBub2RlIGFuZCBzb21lIEhUTUwsIGdlbmVyYXRl
IGEgc2V0IG9mIG5vZGVzLiBSZXR1cm4gdGhlIGZpcnN0CiAgICAgICAqIG5vZGUsIHdoaWNoIHdp
bGwgYWxsb3cgdXMgdG8gdHJhdmVyc2UgdGhlIHJlc3QgdXNpbmcgbmV4dFNpYmxpbmcuCiAgICAg
ICAqCiAgICAgICAqIFdlIG5lZWQgdG8gZG8gdGhpcyBiZWNhdXNlIGlubmVySFRNTCBpbiBJRSBk
b2VzIG5vdCByZWFsbHkgcGFyc2UgdGhlIG5vZGVzLgogICAgICAgKi8KICAgICAgdmFyIGZpcnN0
Tm9kZUZvciA9IGZ1bmN0aW9uKHBhcmVudE5vZGUsIGh0bWwpIHsKICAgICAgICB2YXIgYXJyID0g
d3JhcE1hcFtwYXJlbnROb2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKV0gfHwgd3JhcE1hcC5fZGVm
YXVsdDsKICAgICAgICB2YXIgZGVwdGggPSBhcnJbMF0sIHN0YXJ0ID0gYXJyWzFdLCBlbmQgPSBh
cnJbMl07CgogICAgICAgIGlmIChuZWVkc1NoeSkgeyBodG1sID0gJyZzaHk7JytodG1sOyB9Cgog
ICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgogICAg
ICAgIHNldElubmVySFRNTChlbGVtZW50LCBzdGFydCArIGh0bWwgKyBlbmQpOwoKICAgICAgICBm
b3IgKHZhciBpPTA7IGk8PWRlcHRoOyBpKyspIHsKICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50
LmZpcnN0Q2hpbGQ7CiAgICAgICAgfQoKICAgICAgICAvLyBMb29rIGZvciAmc2h5OyB0byByZW1v
dmUgaXQuCiAgICAgICAgaWYgKG5lZWRzU2h5KSB7CiAgICAgICAgICB2YXIgc2h5RWxlbWVudCA9
IGVsZW1lbnQ7CgogICAgICAgICAgLy8gU29tZXRpbWVzIHdlIGdldCBuYW1lbGVzcyBlbGVtZW50
cyB3aXRoIHRoZSBzaHkgaW5zaWRlCiAgICAgICAgICB3aGlsZSAoc2h5RWxlbWVudC5ub2RlVHlw
ZSA9PT0gMSAmJiAhc2h5RWxlbWVudC5ub2RlTmFtZSkgewogICAgICAgICAgICBzaHlFbGVtZW50
ID0gc2h5RWxlbWVudC5maXJzdENoaWxkOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIEF0IHRo
aXMgcG9pbnQgaXQncyB0aGUgYWN0dWFsIHVuaWNvZGUgY2hhcmFjdGVyLgogICAgICAgICAgaWYg
KHNoeUVsZW1lbnQubm9kZVR5cGUgPT09IDMgJiYgc2h5RWxlbWVudC5ub2RlVmFsdWUuY2hhckF0
KDApID09PSAiXHUwMEFEIikgewogICAgICAgICAgICBzaHlFbGVtZW50Lm5vZGVWYWx1ZSA9IHNo
eUVsZW1lbnQubm9kZVZhbHVlLnNsaWNlKDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAg
ICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgIH07CgogICAgICAvKgogICAgICAgKiBJbiBzb21lIGNh
c2VzLCBJbnRlcm5ldCBFeHBsb3JlciBjYW4gY3JlYXRlIGFuIGFub255bW91cyBub2RlIGluCiAg
ICAgICAqIHRoZSBoaWVyYXJjaHkgd2l0aCBubyB0YWdOYW1lLiBZb3UgY2FuIGNyZWF0ZSB0aGlz
IHNjZW5hcmlvIHZpYToKICAgICAgICoKICAgICAgICogICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0
ZUVsZW1lbnQoImRpdiIpOwogICAgICAgKiAgICAgZGl2LmlubmVySFRNTCA9ICI8dGFibGU+JnNo
eTxzY3JpcHQ+PC9zY3JpcHQ+PHRyPjx0ZD5oaTwvdGQ+PC90cj48L3RhYmxlPiI7CiAgICAgICAq
ICAgICBkaXYuZmlyc3RDaGlsZC5maXJzdENoaWxkLnRhZ05hbWUgLy89PiAiIgogICAgICAgKgog
ICAgICAgKiBJZiBvdXIgc2NyaXB0IG1hcmtlcnMgYXJlIGluc2lkZSBzdWNoIGEgbm9kZSwgd2Ug
bmVlZCB0byBmaW5kIHRoYXQKICAgICAgICogbm9kZSBhbmQgdXNlICppdCogYXMgdGhlIG1hcmtl
ci4KICAgICAgICovCiAgICAgIHZhciByZWFsTm9kZSA9IGZ1bmN0aW9uKHN0YXJ0KSB7CiAgICAg
ICAgd2hpbGUgKHN0YXJ0LnBhcmVudE5vZGUudGFnTmFtZSA9PT0gIiIpIHsKICAgICAgICAgIHN0
YXJ0ID0gc3RhcnQucGFyZW50Tm9kZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdGFydDsK
ICAgICAgfTsKCiAgICAgIC8qCiAgICAgICAqIFdoZW4gYXV0b21hdGljYWxseSBhZGRpbmcgYSB0
Ym9keSwgSW50ZXJuZXQgRXhwbG9yZXIgaW5zZXJ0cyB0aGUKICAgICAgICogdGJvZHkgaW1tZWRp
YXRlbHkgYmVmb3JlIHRoZSBmaXJzdCA8dHI+LiBPdGhlciBicm93c2VycyBjcmVhdGUgaXQKICAg
ICAgICogYmVmb3JlIHRoZSBmaXJzdCBub2RlLCBubyBtYXR0ZXIgd2hhdC4KICAgICAgICoKICAg
ICAgICogVGhpcyBtZWFucyB0aGUgdGhlIGZvbGxvd2luZyBjb2RlOgogICAgICAgKgogICAgICAg
KiAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAqICAgICBk
aXYuaW5uZXJIVE1MID0gIjx0YWJsZT48c2NyaXB0IGlkPSdmaXJzdCc+PC9zY3JpcHQ+PHRyPjx0
ZD5oaTwvdGQ+PC90cj48c2NyaXB0IGlkPSdsYXN0Jz48L3NjcmlwdD48L3RhYmxlPgogICAgICAg
KgogICAgICAgKiBHZW5lcmF0ZXMgdGhlIGZvbGxvd2luZyBET00gaW4gSUU6CiAgICAgICAqCiAg
ICAgICAqICAgICArIGRpdgogICAgICAgKiAgICAgICArIHRhYmxlCiAgICAgICAqICAgICAgICAg
LSBzY3JpcHQgaWQ9J2ZpcnN0JwogICAgICAgKiAgICAgICAgICsgdGJvZHkKICAgICAgICogICAg
ICAgICAgICsgdHIKICAgICAgICogICAgICAgICAgICAgKyB0ZAogICAgICAgKiAgICAgICAgICAg
ICAgIC0gImhpIgogICAgICAgKiAgICAgICAgICAgLSBzY3JpcHQgaWQ9J2xhc3QnCiAgICAgICAq
CiAgICAgICAqIFdoaWNoIG1lYW5zIHRoYXQgdGhlIHR3byBzY3JpcHQgdGFncywgZXZlbiB0aG91
Z2ggdGhleSB3ZXJlCiAgICAgICAqIGluc2VydGVkIGF0IHRoZSBzYW1lIHBvaW50IGluIHRoZSBo
aWVyYXJjaHkgaW4gdGhlIG9yaWdpbmFsCiAgICAgICAqIEhUTUwsIG5vdyBoYXZlIGRpZmZlcmVu
dCBwYXJlbnRzLgogICAgICAgKgogICAgICAgKiBUaGlzIGNvZGUgcmVwYXJlbnRzIHRoZSBmaXJz
dCBzY3JpcHQgdGFnIGJ5IG1ha2luZyBpdCB0aGUgdGJvZHkncwogICAgICAgKiBmaXJzdCBjaGls
ZC4KICAgICAgICoKICAgICAgICovCiAgICAgIHZhciBmaXhQYXJlbnRhZ2UgPSBmdW5jdGlvbihz
dGFydCwgZW5kKSB7CiAgICAgICAgaWYgKHN0YXJ0LnBhcmVudE5vZGUgIT09IGVuZC5wYXJlbnRO
b2RlKSB7CiAgICAgICAgICBlbmQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc3RhcnQsIGVuZC5w
YXJlbnROb2RlLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGh0bWxGdW5j
ID0gZnVuY3Rpb24oaHRtbCwgb3V0ZXJUb28pIHsKICAgICAgICAvLyBnZXQgdGhlIHJlYWwgc3Rh
cnRpbmcgbm9kZS4gc2VlIHJlYWxOb2RlIGZvciBkZXRhaWxzLgogICAgICAgIHZhciBzdGFydCA9
IHJlYWxOb2RlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc3RhcnQpKTsKICAgICAgICB2
YXIgZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5lbmQpOwogICAgICAgIHZhciBw
YXJlbnROb2RlID0gZW5kLnBhcmVudE5vZGU7CiAgICAgICAgdmFyIG5vZGUsIG5leHRTaWJsaW5n
LCBsYXN0OwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgc3RhcnQgYW5kIGVuZCBub2Rl
cyBzaGFyZSB0aGUgc2FtZQogICAgICAgIC8vIHBhcmVudC4gSWYgbm90LCBmaXggaXQuCiAgICAg
ICAgZml4UGFyZW50YWdlKHN0YXJ0LCBlbmQpOwoKICAgICAgICAvLyByZW1vdmUgYWxsIG9mIHRo
ZSBub2RlcyBhZnRlciB0aGUgc3RhcnRpbmcgcGxhY2Vob2xkZXIgYW5kCiAgICAgICAgLy8gYmVm
b3JlIHRoZSBlbmRpbmcgcGxhY2Vob2xkZXIuCiAgICAgICAgbm9kZSA9IHN0YXJ0Lm5leHRTaWJs
aW5nOwogICAgICAgIHdoaWxlIChub2RlKSB7CiAgICAgICAgICBuZXh0U2libGluZyA9IG5vZGUu
bmV4dFNpYmxpbmc7CiAgICAgICAgICBsYXN0ID0gbm9kZSA9PT0gZW5kOwoKICAgICAgICAgIC8v
IGlmIHRoaXMgaXMgdGhlIGxhc3Qgbm9kZSwgYW5kIHdlIHdhbnQgdG8gcmVtb3ZlIGl0IGFzIHdl
bGwsCiAgICAgICAgICAvLyBzZXQgdGhlIGBlbmRgIG5vZGUgdG8gdGhlIG5leHQgc2libGluZy4g
VGhpcyBpcyBiZWNhdXNlCiAgICAgICAgICAvLyBmb3IgdGhlIHJlc3Qgb2YgdGhlIGZ1bmN0aW9u
LCB3ZSBpbnNlcnQgdGhlIG5ldyBub2RlcwogICAgICAgICAgLy8gYmVmb3JlIHRoZSBlbmQgKG5v
dGUgdGhhdCBpbnNlcnRCZWZvcmUobm9kZSwgbnVsbCkgaXMKICAgICAgICAgIC8vIHRoZSBzYW1l
IGFzIGFwcGVuZENoaWxkKG5vZGUpKS4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBpZiB3ZSBk
byBub3Qgd2FudCB0byByZW1vdmUgaXQsIGp1c3QgYnJlYWsuCiAgICAgICAgICBpZiAobGFzdCkg
ewogICAgICAgICAgICBpZiAob3V0ZXJUb28pIHsgZW5kID0gbm9kZS5uZXh0U2libGluZzsgfSBl
bHNlIHsgYnJlYWs7IH0KICAgICAgICAgIH0KCiAgICAgICAgICBub2RlLnBhcmVudE5vZGUucmVt
b3ZlQ2hpbGQobm9kZSk7CgogICAgICAgICAgLy8gaWYgdGhpcyBpcyB0aGUgbGFzdCBub2RlIGFu
ZCB3ZSBkaWRuJ3QgYnJlYWsgYmVmb3JlCiAgICAgICAgICAvLyAoYmVjYXVzZSB3ZSB3YW50ZWQg
dG8gcmVtb3ZlIHRoZSBvdXRlciBub2RlcyksIGJyZWFrCiAgICAgICAgICAvLyBub3cuCiAgICAg
ICAgICBpZiAobGFzdCkgeyBicmVhazsgfQoKICAgICAgICAgIG5vZGUgPSBuZXh0U2libGluZzsK
ICAgICAgICB9CgogICAgICAgIC8vIGdldCB0aGUgZmlyc3Qgbm9kZSBmb3IgdGhlIEhUTUwgc3Ry
aW5nLCBldmVuIGluIGNhc2VzIGxpa2UKICAgICAgICAvLyB0YWJsZXMgYW5kIGxpc3RzIHdoZXJl
IGEgc2ltcGxlIGlubmVySFRNTCBvbiBhIGRpdiB3b3VsZAogICAgICAgIC8vIHN3YWxsb3cgc29t
ZSBvZiB0aGUgY29udGVudC4KICAgICAgICBub2RlID0gZmlyc3ROb2RlRm9yKHN0YXJ0LnBhcmVu
dE5vZGUsIGh0bWwpOwoKICAgICAgICBpZiAob3V0ZXJUb28pIHsKICAgICAgICAgIHN0YXJ0LnBh
cmVudE5vZGUucmVtb3ZlQ2hpbGQoc3RhcnQpOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSB0
aGUgbm9kZXMgZm9yIHRoZSBIVE1MIGJldHdlZW4gdGhlIHN0YXJ0aW5nIGFuZCBlbmRpbmcKICAg
ICAgICAvLyBwbGFjZWhvbGRlci4KICAgICAgICB3aGlsZSAobm9kZSkgewogICAgICAgICAgbmV4
dFNpYmxpbmcgPSBub2RlLm5leHRTaWJsaW5nOwogICAgICAgICAgcGFyZW50Tm9kZS5pbnNlcnRC
ZWZvcmUobm9kZSwgZW5kKTsKICAgICAgICAgIG5vZGUgPSBuZXh0U2libGluZzsKICAgICAgICB9
CiAgICAgIH07CgogICAgICAvLyByZW1vdmUgdGhlIG5vZGVzIGluIHRoZSBET00gcmVwcmVzZW50
aW5nIHRoaXMgbWV0YW1vcnBoLgogICAgICAvLwogICAgICAvLyB0aGlzIGluY2x1ZGVzIHRoZSBz
dGFydGluZyBhbmQgZW5kaW5nIHBsYWNlaG9sZGVycy4KICAgICAgcmVtb3ZlRnVuYyA9IGZ1bmN0
aW9uKCkgewogICAgICAgIHZhciBzdGFydCA9IHJlYWxOb2RlKGRvY3VtZW50LmdldEVsZW1lbnRC
eUlkKHRoaXMuc3RhcnQpKTsKICAgICAgICB2YXIgZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5
SWQodGhpcy5lbmQpOwoKICAgICAgICB0aGlzLmh0bWwoJycpOwogICAgICAgIHN0YXJ0LnBhcmVu
dE5vZGUucmVtb3ZlQ2hpbGQoc3RhcnQpOwogICAgICAgIGVuZC5wYXJlbnROb2RlLnJlbW92ZUNo
aWxkKGVuZCk7CiAgICAgIH07CgogICAgICBhcHBlbmRUb0Z1bmMgPSBmdW5jdGlvbihwYXJlbnRO
b2RlKSB7CiAgICAgICAgdmFyIG5vZGUgPSBmaXJzdE5vZGVGb3IocGFyZW50Tm9kZSwgdGhpcy5v
dXRlckhUTUwoKSk7CiAgICAgICAgdmFyIG5leHRTaWJsaW5nOwoKICAgICAgICB3aGlsZSAobm9k
ZSkgewogICAgICAgICAgbmV4dFNpYmxpbmcgPSBub2RlLm5leHRTaWJsaW5nOwogICAgICAgICAg
cGFyZW50Tm9kZS5hcHBlbmRDaGlsZChub2RlKTsKICAgICAgICAgIG5vZGUgPSBuZXh0U2libGlu
ZzsKICAgICAgICB9CiAgICAgIH07CgogICAgICBhZnRlckZ1bmMgPSBmdW5jdGlvbihodG1sKSB7
CiAgICAgICAgLy8gZ2V0IHRoZSByZWFsIHN0YXJ0aW5nIG5vZGUuIHNlZSByZWFsTm9kZSBmb3Ig
ZGV0YWlscy4KICAgICAgICB2YXIgZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5l
bmQpOwogICAgICAgIHZhciBpbnNlcnRCZWZvcmUgPSBlbmQubmV4dFNpYmxpbmc7CiAgICAgICAg
dmFyIHBhcmVudE5vZGUgPSBlbmQucGFyZW50Tm9kZTsKICAgICAgICB2YXIgbmV4dFNpYmxpbmc7
CiAgICAgICAgdmFyIG5vZGU7CgogICAgICAgIC8vIGdldCB0aGUgZmlyc3Qgbm9kZSBmb3IgdGhl
IEhUTUwgc3RyaW5nLCBldmVuIGluIGNhc2VzIGxpa2UKICAgICAgICAvLyB0YWJsZXMgYW5kIGxp
c3RzIHdoZXJlIGEgc2ltcGxlIGlubmVySFRNTCBvbiBhIGRpdiB3b3VsZAogICAgICAgIC8vIHN3
YWxsb3cgc29tZSBvZiB0aGUgY29udGVudC4KICAgICAgICBub2RlID0gZmlyc3ROb2RlRm9yKHBh
cmVudE5vZGUsIGh0bWwpOwoKICAgICAgICAvLyBjb3B5IHRoZSBub2RlcyBmb3IgdGhlIEhUTUwg
YmV0d2VlbiB0aGUgc3RhcnRpbmcgYW5kIGVuZGluZwogICAgICAgIC8vIHBsYWNlaG9sZGVyLgog
ICAgICAgIHdoaWxlIChub2RlKSB7CiAgICAgICAgICBuZXh0U2libGluZyA9IG5vZGUubmV4dFNp
Ymxpbmc7CiAgICAgICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBpbnNlcnRCZWZv
cmUpOwogICAgICAgICAgbm9kZSA9IG5leHRTaWJsaW5nOwogICAgICAgIH0KICAgICAgfTsKCiAg
ICAgIHByZXBlbmRGdW5jID0gZnVuY3Rpb24oaHRtbCkgewogICAgICAgIHZhciBzdGFydCA9IGRv
Y3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc3RhcnQpOwogICAgICAgIHZhciBwYXJlbnROb2Rl
ID0gc3RhcnQucGFyZW50Tm9kZTsKICAgICAgICB2YXIgbmV4dFNpYmxpbmc7CiAgICAgICAgdmFy
IG5vZGU7CgogICAgICAgIG5vZGUgPSBmaXJzdE5vZGVGb3IocGFyZW50Tm9kZSwgaHRtbCk7CiAg
ICAgICAgdmFyIGluc2VydEJlZm9yZSA9IHN0YXJ0Lm5leHRTaWJsaW5nOwoKICAgICAgICB3aGls
ZSAobm9kZSkgewogICAgICAgICAgbmV4dFNpYmxpbmcgPSBub2RlLm5leHRTaWJsaW5nOwogICAg
ICAgICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgaW5zZXJ0QmVmb3JlKTsKICAgICAg
ICAgIG5vZGUgPSBuZXh0U2libGluZzsKICAgICAgICB9CiAgICAgIH07CiAgICB9CgogICAgTWV0
YW1vcnBoLnByb3RvdHlwZS5odG1sID0gZnVuY3Rpb24oaHRtbCkgewogICAgICB0aGlzLmNoZWNr
UmVtb3ZlZCgpOwogICAgICBpZiAoaHRtbCA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB0aGlzLmlu
bmVySFRNTDsgfQoKICAgICAgaHRtbEZ1bmMuY2FsbCh0aGlzLCBodG1sKTsKCiAgICAgIHRoaXMu
aW5uZXJIVE1MID0gaHRtbDsKICAgIH07CgogICAgTWV0YW1vcnBoLnByb3RvdHlwZS5yZXBsYWNl
V2l0aCA9IGZ1bmN0aW9uKGh0bWwpIHsKICAgICAgdGhpcy5jaGVja1JlbW92ZWQoKTsKICAgICAg
aHRtbEZ1bmMuY2FsbCh0aGlzLCBodG1sLCB0cnVlKTsKICAgIH07CgogICAgTWV0YW1vcnBoLnBy
b3RvdHlwZS5yZW1vdmUgPSByZW1vdmVGdW5jOwogICAgTWV0YW1vcnBoLnByb3RvdHlwZS5vdXRl
ckhUTUwgPSBvdXRlckhUTUxGdW5jOwogICAgTWV0YW1vcnBoLnByb3RvdHlwZS5hcHBlbmRUbyA9
IGFwcGVuZFRvRnVuYzsKICAgIE1ldGFtb3JwaC5wcm90b3R5cGUuYWZ0ZXIgPSBhZnRlckZ1bmM7
CiAgICBNZXRhbW9ycGgucHJvdG90eXBlLnByZXBlbmQgPSBwcmVwZW5kRnVuYzsKICAgIE1ldGFt
b3JwaC5wcm90b3R5cGUuc3RhcnRUYWcgPSBzdGFydFRhZ0Z1bmM7CiAgICBNZXRhbW9ycGgucHJv
dG90eXBlLmVuZFRhZyA9IGVuZFRhZ0Z1bmM7CgogICAgTWV0YW1vcnBoLnByb3RvdHlwZS5pc1Jl
bW92ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJlZm9yZSA9IGRvY3VtZW50LmdldEVsZW1l
bnRCeUlkKHRoaXMuc3RhcnQpOwogICAgICB2YXIgYWZ0ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50
QnlJZCh0aGlzLmVuZCk7CgogICAgICByZXR1cm4gIWJlZm9yZSB8fCAhYWZ0ZXI7CiAgICB9OwoK
ICAgIE1ldGFtb3JwaC5wcm90b3R5cGUuY2hlY2tSZW1vdmVkID0gZnVuY3Rpb24oKSB7CiAgICAg
IGlmICh0aGlzLmlzUmVtb3ZlZCgpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qg
cGVyZm9ybSBvcGVyYXRpb25zIG9uIGEgTWV0YW1vcnBoIHRoYXQgaXMgbm90IGluIHRoZSBET00u
Iik7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIE1ldGFtb3JwaDsKICB9KTsKCn0pKCk7Cgoo
ZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItaGFuZGxlYmFy
cy1jb21waWxlcgoqLwoKLy8gRWxpbWluYXRlIGRlcGVuZGVuY3kgb24gYW55IEVtYmVyIHRvIHNp
bXBsaWZ5IHByZWNvbXBpbGF0aW9uIHdvcmtmbG93CnZhciBvYmplY3RDcmVhdGUgPSBPYmplY3Qu
Y3JlYXRlIHx8IGZ1bmN0aW9uKHBhcmVudCkgewogIGZ1bmN0aW9uIEYoKSB7fQogIEYucHJvdG90
eXBlID0gcGFyZW50OwogIHJldHVybiBuZXcgRigpOwp9OwoKdmFyIEhhbmRsZWJhcnMgPSAoRW1i
ZXIuaW1wb3J0cyAmJiBFbWJlci5pbXBvcnRzLkhhbmRsZWJhcnMpIHx8ICh0aGlzICYmIHRoaXMu
SGFuZGxlYmFycyk7CmlmICghSGFuZGxlYmFycyAmJiB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0
aW9uJykgewogIEhhbmRsZWJhcnMgPSByZXF1aXJlKCdoYW5kbGViYXJzJyk7Cn0KCkVtYmVyLmFz
c2VydCgiRW1iZXIgSGFuZGxlYmFycyByZXF1aXJlcyBIYW5kbGViYXJzIHZlcnNpb24gMS4wIG9y
IDEuMS4gSW5jbHVkZSAiICsKICAgICAgICAgICAgICJhIFNDUklQVCB0YWcgaW4gdGhlIEhUTUwg
SEVBRCBsaW5raW5nIHRvIHRoZSBIYW5kbGViYXJzIGZpbGUgIiArCiAgICAgICAgICAgICAiYmVm
b3JlIHlvdSBsaW5rIHRvIEVtYmVyLiIsIEhhbmRsZWJhcnMpOwoKRW1iZXIuYXNzZXJ0KCJFbWJl
ciBIYW5kbGViYXJzIHJlcXVpcmVzIEhhbmRsZWJhcnMgdmVyc2lvbiAxLjAgb3IgMS4xLCAiICsK
ICAgICAgICAgICAgICJDT01QSUxFUl9SRVZJU0lPTiBleHBlY3RlZDogNCwgZ290OiAiICsgIEhh
bmRsZWJhcnMuQ09NUElMRVJfUkVWSVNJT04gKwogICAgICAgICAgICAgIiAtIFBsZWFzZSBub3Rl
OiBCdWlsZHMgb2YgbWFzdGVyIG1heSBoYXZlIG90aGVyIENPTVBJTEVSX1JFVklTSU9OIHZhbHVl
cy4iLAogICAgICAgICAgICAgSGFuZGxlYmFycy5DT01QSUxFUl9SRVZJU0lPTiA9PT0gNCk7Cgov
KioKICBQcmVwYXJlcyB0aGUgSGFuZGxlYmFycyB0ZW1wbGF0aW5nIGxpYnJhcnkgZm9yIHVzZSBp
bnNpZGUgRW1iZXIncyB2aWV3CiAgc3lzdGVtLgoKICBUaGUgYEVtYmVyLkhhbmRsZWJhcnNgIG9i
amVjdCBpcyB0aGUgc3RhbmRhcmQgSGFuZGxlYmFycyBsaWJyYXJ5LCBleHRlbmRlZCB0bwogIHVz
ZSBFbWJlcidzIGBnZXQoKWAgbWV0aG9kIGluc3RlYWQgb2YgZGlyZWN0IHByb3BlcnR5IGFjY2Vz
cywgd2hpY2ggYWxsb3dzCiAgY29tcHV0ZWQgcHJvcGVydGllcyB0byBiZSB1c2VkIGluc2lkZSB0
ZW1wbGF0ZXMuCgogIFRvIGNyZWF0ZSBhbiBgRW1iZXIuSGFuZGxlYmFyc2AgdGVtcGxhdGUsIGNh
bGwgYEVtYmVyLkhhbmRsZWJhcnMuY29tcGlsZSgpYC4KICBUaGlzIHdpbGwgcmV0dXJuIGEgZnVu
Y3Rpb24gdGhhdCBjYW4gYmUgdXNlZCBieSBgRW1iZXIuVmlld2AgZm9yIHJlbmRlcmluZy4KCiAg
QGNsYXNzIEhhbmRsZWJhcnMKICBAbmFtZXNwYWNlIEVtYmVyCiovCkVtYmVyLkhhbmRsZWJhcnMg
PSBvYmplY3RDcmVhdGUoSGFuZGxlYmFycyk7CgovKioKICBSZWdpc3RlciBhIGJvdW5kIGhlbHBl
ciBvciBjdXN0b20gdmlldyBoZWxwZXIuCgogICMjIFNpbXBsZSBib3VuZCBoZWxwZXIgZXhhbXBs
ZQoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXIoJ2NhcGl0YWxpemUn
LCBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlLnRvVXBwZXJDYXNlKCk7CiAgfSk7
CiAgYGBgCgogIFRoZSBhYm92ZSBib3VuZCBoZWxwZXIgY2FuIGJlIHVzZWQgaW5zaWRlIG9mIHRl
bXBsYXRlcyBhcyBmb2xsb3dzOgoKICBgYGBoYW5kbGViYXJzCiAge3tjYXBpdGFsaXplIG5hbWV9
fQogIGBgYAoKICBJbiB0aGlzIGNhc2UsIHdoZW4gdGhlIGBuYW1lYCBwcm9wZXJ0eSBvZiB0aGUg
dGVtcGxhdGUncyBjb250ZXh0IGNoYW5nZXMsCiAgdGhlIHJlbmRlcmVkIHZhbHVlIG9mIHRoZSBo
ZWxwZXIgd2lsbCB1cGRhdGUgdG8gcmVmbGVjdCB0aGlzIGNoYW5nZS4KCiAgRm9yIG1vcmUgZXhh
bXBsZXMgb2YgYm91bmQgaGVscGVycywgc2VlIGRvY3VtZW50YXRpb24gZm9yCiAgYEVtYmVyLkhh
bmRsZWJhcnMucmVnaXN0ZXJCb3VuZEhlbHBlcmAuCgogICMjIEN1c3RvbSB2aWV3IGhlbHBlciBl
eGFtcGxlCgogIEFzc3VtaW5nIGEgdmlldyBzdWJjbGFzcyBuYW1lZCBgQXBwLkNhbGVuZGFyVmll
d2Agd2VyZSBkZWZpbmVkLCBhIGhlbHBlcgogIGZvciByZW5kZXJpbmcgaW5zdGFuY2VzIG9mIHRo
aXMgdmlldyBjb3VsZCBiZSByZWdpc3RlcmVkIGFzIGZvbGxvd3M6CgogIGBgYGphdmFzY3JpcHQK
ICBFbWJlci5IYW5kbGViYXJzLmhlbHBlcignY2FsZW5kYXInLCBBcHAuQ2FsZW5kYXJWaWV3KToK
ICBgYGAKCiAgVGhlIGFib3ZlIGJvdW5kIGhlbHBlciBjYW4gYmUgdXNlZCBpbnNpZGUgb2YgdGVt
cGxhdGVzIGFzIGZvbGxvd3M6CgogIGBgYGhhbmRsZWJhcnMKICB7e2NhbGVuZGFyfX0KICBgYGAK
CiAgV2hpY2ggaXMgZnVuY3Rpb25hbGx5IGVxdWl2YWxlbnQgdG86CgogIGBgYGhhbmRsZWJhcnMK
ICB7e3ZpZXcgQXBwLkNhbGVuZGFyVmlld319CiAgYGBgCgogIE9wdGlvbnMgaW4gdGhlIGhlbHBl
ciB3aWxsIGJlIHBhc3NlZCB0byB0aGUgdmlldyBpbiBleGFjdGx5IHRoZSBzYW1lCiAgbWFubmVy
IGFzIHdpdGggdGhlIGB2aWV3YCBoZWxwZXIuCgogIEBtZXRob2QgaGVscGVyCiAgQGZvciBFbWJl
ci5IYW5kbGViYXJzCiAgQHBhcmFtIHtTdHJpbmd9IG5hbWUKICBAcGFyYW0ge0Z1bmN0aW9ufEVt
YmVyLlZpZXd9IGZ1bmN0aW9uIG9yIHZpZXcgY2xhc3MgY29uc3RydWN0b3IKICBAcGFyYW0ge1N0
cmluZ30gZGVwZW5kZW50S2V5cyoKKi8KRW1iZXIuSGFuZGxlYmFycy5oZWxwZXIgPSBmdW5jdGlv
bihuYW1lLCB2YWx1ZSkgewogIEVtYmVyLmFzc2VydCgiWW91IHRyaWVkIHRvIHJlZ2lzdGVyIGEg
Y29tcG9uZW50IG5hbWVkICciICsgbmFtZSArICInLCBidXQgY29tcG9uZW50IG5hbWVzIG11c3Qg
aW5jbHVkZSBhICctJyIsICFFbWJlci5Db21wb25lbnQuZGV0ZWN0KHZhbHVlKSB8fCBuYW1lLm1h
dGNoKC8tLykpOwoKICBpZiAoRW1iZXIuVmlldy5kZXRlY3QodmFsdWUpKSB7CiAgICBFbWJlci5I
YW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKG5hbWUsIEVtYmVyLkhhbmRsZWJhcnMubWFrZVZpZXdI
ZWxwZXIodmFsdWUpKTsKICB9IGVsc2UgewogICAgRW1iZXIuSGFuZGxlYmFycy5yZWdpc3RlckJv
dW5kSGVscGVyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgfQp9OwoKLyoqCiAgUmV0dXJucyBh
IGhlbHBlciBmdW5jdGlvbiB0aGF0IHJlbmRlcnMgdGhlIHByb3ZpZGVkIFZpZXdDbGFzcy4KCiAg
VXNlZCBpbnRlcm5hbGx5IGJ5IEVtYmVyLkhhbmRsZWJhcnMuaGVscGVyIGFuZCBvdGhlciBtZXRo
b2RzCiAgaW52b2x2aW5nIGhlbHBlci9jb21wb25lbnQgcmVnaXN0cmF0aW9uLgoKICBAcHJpdmF0
ZQogIEBtZXRob2QgaGVscGVyCiAgQGZvciBFbWJlci5IYW5kbGViYXJzCiAgQHBhcmFtIHtGdW5j
dGlvbn0gVmlld0NsYXNzIHZpZXcgY2xhc3MgY29uc3RydWN0b3IKKi8KRW1iZXIuSGFuZGxlYmFy
cy5tYWtlVmlld0hlbHBlciA9IGZ1bmN0aW9uKFZpZXdDbGFzcykgewogIHJldHVybiBmdW5jdGlv
bihvcHRpb25zKSB7CiAgICBFbWJlci5hc3NlcnQoIllvdSBjYW4gb25seSBwYXNzIGF0dHJpYnV0
ZXMgKHN1Y2ggYXMgbmFtZT12YWx1ZSkgbm90IGJhcmUgdmFsdWVzIHRvIGEgaGVscGVyIGZvciBh
IFZpZXcgZm91bmQgaW4gJyIgKyBWaWV3Q2xhc3MudG9TdHJpbmcoKSArICInIiwgYXJndW1lbnRz
Lmxlbmd0aCA8IDIpOwogICAgcmV0dXJuIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycy52aWV3LmNh
bGwodGhpcywgVmlld0NsYXNzLCBvcHRpb25zKTsKICB9Owp9OwoKLyoqCkBjbGFzcyBoZWxwZXJz
CkBuYW1lc3BhY2UgRW1iZXIuSGFuZGxlYmFycwoqLwpFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMg
PSBvYmplY3RDcmVhdGUoSGFuZGxlYmFycy5oZWxwZXJzKTsKCi8qKgogIE92ZXJyaWRlIHRoZSB0
aGUgb3Bjb2RlIGNvbXBpbGVyIGFuZCBKYXZhU2NyaXB0IGNvbXBpbGVyIGZvciBIYW5kbGViYXJz
LgoKICBAY2xhc3MgQ29tcGlsZXIKICBAbmFtZXNwYWNlIEVtYmVyLkhhbmRsZWJhcnMKICBAcHJp
dmF0ZQogIEBjb25zdHJ1Y3RvcgoqLwpFbWJlci5IYW5kbGViYXJzLkNvbXBpbGVyID0gZnVuY3Rp
b24oKSB7fTsKCi8vIEhhbmRsZWJhcnMuQ29tcGlsZXIgZG9lc24ndCBleGlzdCBpbiBydW50aW1l
LW9ubHkKaWYgKEhhbmRsZWJhcnMuQ29tcGlsZXIpIHsKICBFbWJlci5IYW5kbGViYXJzLkNvbXBp
bGVyLnByb3RvdHlwZSA9IG9iamVjdENyZWF0ZShIYW5kbGViYXJzLkNvbXBpbGVyLnByb3RvdHlw
ZSk7Cn0KCkVtYmVyLkhhbmRsZWJhcnMuQ29tcGlsZXIucHJvdG90eXBlLmNvbXBpbGVyID0gRW1i
ZXIuSGFuZGxlYmFycy5Db21waWxlcjsKCi8qKgogIEBjbGFzcyBKYXZhU2NyaXB0Q29tcGlsZXIK
ICBAbmFtZXNwYWNlIEVtYmVyLkhhbmRsZWJhcnMKICBAcHJpdmF0ZQogIEBjb25zdHJ1Y3Rvcgoq
LwpFbWJlci5IYW5kbGViYXJzLkphdmFTY3JpcHRDb21waWxlciA9IGZ1bmN0aW9uKCkge307Cgov
LyBIYW5kbGViYXJzLkphdmFTY3JpcHRDb21waWxlciBkb2Vzbid0IGV4aXN0IGluIHJ1bnRpbWUt
b25seQppZiAoSGFuZGxlYmFycy5KYXZhU2NyaXB0Q29tcGlsZXIpIHsKICBFbWJlci5IYW5kbGVi
YXJzLkphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUgPSBvYmplY3RDcmVhdGUoSGFuZGxlYmFy
cy5KYXZhU2NyaXB0Q29tcGlsZXIucHJvdG90eXBlKTsKICBFbWJlci5IYW5kbGViYXJzLkphdmFT
Y3JpcHRDb21waWxlci5wcm90b3R5cGUuY29tcGlsZXIgPSBFbWJlci5IYW5kbGViYXJzLkphdmFT
Y3JpcHRDb21waWxlcjsKfQoKCkVtYmVyLkhhbmRsZWJhcnMuSmF2YVNjcmlwdENvbXBpbGVyLnBy
b3RvdHlwZS5uYW1lc3BhY2UgPSAiRW1iZXIuSGFuZGxlYmFycyI7CgpFbWJlci5IYW5kbGViYXJz
LkphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUuaW5pdGlhbGl6ZUJ1ZmZlciA9IGZ1bmN0aW9u
KCkgewogIHJldHVybiAiJyciOwp9OwoKLyoqCiAgT3ZlcnJpZGUgdGhlIGRlZmF1bHQgYnVmZmVy
IGZvciBFbWJlciBIYW5kbGViYXJzLiBCeSBkZWZhdWx0LCBIYW5kbGViYXJzCiAgY3JlYXRlcyBh
biBlbXB0eSBTdHJpbmcgYXQgdGhlIGJlZ2lubmluZyBvZiBlYWNoIGludm9jYXRpb24gYW5kIGFw
cGVuZHMgdG8KICBpdC4gRW1iZXIncyBIYW5kbGViYXJzIG92ZXJyaWRlcyB0aGlzIHRvIGFwcGVu
ZCB0byBhIHNpbmdsZSBzaGFyZWQgYnVmZmVyLgoKICBAcHJpdmF0ZQogIEBtZXRob2QgYXBwZW5k
VG9CdWZmZXIKICBAcGFyYW0gc3RyaW5nIHtTdHJpbmd9CiovCkVtYmVyLkhhbmRsZWJhcnMuSmF2
YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5hcHBlbmRUb0J1ZmZlciA9IGZ1bmN0aW9uKHN0cmlu
ZykgewogIHJldHVybiAiZGF0YS5idWZmZXIucHVzaCgiK3N0cmluZysiKTsiOwp9OwoKLy8gSGFj
a3MgYWhlYWQ6Ci8vIEhhbmRsZWJhcnMgcHJlc2VudGx5IGhhcyBhIGJ1ZyB3aGVyZSB0aGUgYGJs
b2NrSGVscGVyTWlzc2luZ2AgaG9vawovLyBkb2Vzbid0IGdldCBwYXNzZWQgdGhlIG5hbWUgb2Yg
dGhlIG1pc3NpbmcgaGVscGVyIG5hbWUsIGJ1dCByYXRoZXIKLy8gZ2V0cyBwYXNzZWQgdGhlIHZh
bHVlIG9mIHRoYXQgbWlzc2luZyBoZWxwZXIgZXZhbHVhdGVkIG9uIHRoZSBjdXJyZW50Ci8vIGNv
bnRleHQsIHdoaWNoIGlzIG1vc3QgbGlrZWx5IGB1bmRlZmluZWRgIGFuZCB0b3RhbGx5IHVzZWxl
c3MuCi8vCi8vIFNvIHdlIGFsdGVyIHRoZSBjb21waWxlZCB0ZW1wbGF0ZSBmdW5jdGlvbiB0byBw
YXNzIHRoZSBuYW1lIG9mIHRoZSBoZWxwZXIKLy8gaW5zdGVhZCwgYXMgZXhwZWN0ZWQuCi8vCi8v
IFRoaXMgY2FuIGdvIGF3YXkgb25jZSB0aGUgZm9sbG93aW5nIGlzIGNsb3NlZDoKLy8gaHR0cHM6
Ly9naXRodWIuY29tL3d5Y2F0cy9oYW5kbGViYXJzLmpzL2lzc3Vlcy82MzQKCnZhciBET1RfTE9P
S1VQX1JFR0VYID0gL2hlbHBlcnNcLiguKj8pXCkvLAogICAgQlJBQ0tFVF9TVFJJTkdfTE9PS1VQ
X1JFR0VYID0gL2hlbHBlcnNcWycoLio/KScvLAogICAgSU5WT0NBVElPTl9TUExJVFRJTkdfUkVH
RVggPSAvKC4qYmxvY2tIZWxwZXJNaXNzaW5nXC5jYWxsXCguKikoc3RhY2tbMC05XSspKCwuKikv
OwoKRW1iZXIuSGFuZGxlYmFycy5KYXZhU2NyaXB0Q29tcGlsZXIuc3RyaW5naWZ5TGFzdEJsb2Nr
SGVscGVyTWlzc2luZ0ludm9jYXRpb24gPSBmdW5jdGlvbihzb3VyY2UpIHsKICB2YXIgaGVscGVy
SW52b2NhdGlvbiA9IHNvdXJjZVtzb3VyY2UubGVuZ3RoIC0gMV0sCiAgICAgIGhlbHBlck5hbWUg
PSAoRE9UX0xPT0tVUF9SRUdFWC5leGVjKGhlbHBlckludm9jYXRpb24pIHx8IEJSQUNLRVRfU1RS
SU5HX0xPT0tVUF9SRUdFWC5leGVjKGhlbHBlckludm9jYXRpb24pKVsxXSwKICAgICAgbWF0Y2hl
cyA9IElOVk9DQVRJT05fU1BMSVRUSU5HX1JFR0VYLmV4ZWMoaGVscGVySW52b2NhdGlvbik7Cgog
IHNvdXJjZVtzb3VyY2UubGVuZ3RoIC0gMV0gPSBtYXRjaGVzWzFdICsgIiciICsgaGVscGVyTmFt
ZSArICInIiArIG1hdGNoZXNbM107Cn0KdmFyIHN0cmluZ2lmeUJsb2NrSGVscGVyTWlzc2luZyA9
IEVtYmVyLkhhbmRsZWJhcnMuSmF2YVNjcmlwdENvbXBpbGVyLnN0cmluZ2lmeUxhc3RCbG9ja0hl
bHBlck1pc3NpbmdJbnZvY2F0aW9uOwoKdmFyIG9yaWdpbmFsQmxvY2tWYWx1ZSA9IEVtYmVyLkhh
bmRsZWJhcnMuSmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5ibG9ja1ZhbHVlOwpFbWJlci5I
YW5kbGViYXJzLkphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUuYmxvY2tWYWx1ZSA9IGZ1bmN0
aW9uKCkgewogIG9yaWdpbmFsQmxvY2tWYWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIHN0
cmluZ2lmeUJsb2NrSGVscGVyTWlzc2luZyh0aGlzLnNvdXJjZSk7Cn07Cgp2YXIgb3JpZ2luYWxB
bWJpZ3VvdXNCbG9ja1ZhbHVlID0gRW1iZXIuSGFuZGxlYmFycy5KYXZhU2NyaXB0Q29tcGlsZXIu
cHJvdG90eXBlLmFtYmlndW91c0Jsb2NrVmFsdWU7CkVtYmVyLkhhbmRsZWJhcnMuSmF2YVNjcmlw
dENvbXBpbGVyLnByb3RvdHlwZS5hbWJpZ3VvdXNCbG9ja1ZhbHVlID0gZnVuY3Rpb24oKSB7CiAg
b3JpZ2luYWxBbWJpZ3VvdXNCbG9ja1ZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgc3Ry
aW5naWZ5QmxvY2tIZWxwZXJNaXNzaW5nKHRoaXMuc291cmNlKTsKfTsKCnZhciBwcmVmaXggPSAi
ZW1iZXIiICsgKCtuZXcgRGF0ZSgpKSwgaW5jciA9IDE7CgovKioKICBSZXdyaXRlIHNpbXBsZSBt
dXN0YWNoZXMgZnJvbSBge3tmb299fWAgdG8gYHt7YmluZCAiZm9vIn19YC4gVGhpcyBtZWFucyB0
aGF0CiAgYWxsIHNpbXBsZSBtdXN0YWNoZXMgaW4gRW1iZXIncyBIYW5kbGViYXJzIHdpbGwgYWxz
byBzZXQgdXAgYW4gb2JzZXJ2ZXIgdG8KICBrZWVwIHRoZSBET00gdXAgdG8gZGF0ZSB3aGVuIHRo
ZSB1bmRlcmx5aW5nIHByb3BlcnR5IGNoYW5nZXMuCgogIEBwcml2YXRlCiAgQG1ldGhvZCBtdXN0
YWNoZQogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5Db21waWxlcgogIEBwYXJhbSBtdXN0YWNoZQoq
LwpFbWJlci5IYW5kbGViYXJzLkNvbXBpbGVyLnByb3RvdHlwZS5tdXN0YWNoZSA9IGZ1bmN0aW9u
KG11c3RhY2hlKSB7CiAgaWYgKG11c3RhY2hlLmlzSGVscGVyICYmIG11c3RhY2hlLmlkLnN0cmlu
ZyA9PT0gJ2NvbnRyb2wnKSB7CiAgICBtdXN0YWNoZS5oYXNoID0gbXVzdGFjaGUuaGFzaCB8fCBu
ZXcgSGFuZGxlYmFycy5BU1QuSGFzaE5vZGUoW10pOwogICAgbXVzdGFjaGUuaGFzaC5wYWlycy5w
dXNoKFsiY29udHJvbElEIiwgbmV3IEhhbmRsZWJhcnMuQVNULlN0cmluZ05vZGUocHJlZml4ICsg
aW5jcisrKV0pOwogIH0gZWxzZSBpZiAobXVzdGFjaGUucGFyYW1zLmxlbmd0aCB8fCBtdXN0YWNo
ZS5oYXNoKSB7CiAgICAvLyBubyBjaGFuZ2VzIHJlcXVpcmVkCiAgfSBlbHNlIHsKICAgIHZhciBp
ZCA9IG5ldyBIYW5kbGViYXJzLkFTVC5JZE5vZGUoW3sgcGFydDogJ190cmlhZ2VNdXN0YWNoZScg
fV0pOwoKICAgIC8vIFVwZGF0ZSB0aGUgbXVzdGFjaGUgbm9kZSB0byBpbmNsdWRlIGEgaGFzaCB2
YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIG9yaWdpbmFsIG5vZGUKICAgIC8vIHdhcyBlc2Nh
cGVkLiBUaGlzIHdpbGwgYWxsb3cgdXMgdG8gcHJvcGVybHkgZXNjYXBlIHZhbHVlcyB3aGVuIHRo
ZSB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyBjaGFuZ2VzIGFuZCB3ZSBuZWVkIHRvIHJlLXJlbmRl
ciB0aGUgdmFsdWUuCiAgICBpZiAoIW11c3RhY2hlLmVzY2FwZWQpIHsKICAgICAgbXVzdGFjaGUu
aGFzaCA9IG11c3RhY2hlLmhhc2ggfHwgbmV3IEhhbmRsZWJhcnMuQVNULkhhc2hOb2RlKFtdKTsK
ICAgICAgbXVzdGFjaGUuaGFzaC5wYWlycy5wdXNoKFsidW5lc2NhcGVkIiwgbmV3IEhhbmRsZWJh
cnMuQVNULlN0cmluZ05vZGUoInRydWUiKV0pOwogICAgfQogICAgbXVzdGFjaGUgPSBuZXcgSGFu
ZGxlYmFycy5BU1QuTXVzdGFjaGVOb2RlKFtpZF0uY29uY2F0KFttdXN0YWNoZS5pZF0pLCBtdXN0
YWNoZS5oYXNoLCAhbXVzdGFjaGUuZXNjYXBlZCk7CiAgfQoKICByZXR1cm4gSGFuZGxlYmFycy5D
b21waWxlci5wcm90b3R5cGUubXVzdGFjaGUuY2FsbCh0aGlzLCBtdXN0YWNoZSk7Cn07CgovKioK
ICBVc2VkIGZvciBwcmVjb21waWxhdGlvbiBvZiBFbWJlciBIYW5kbGViYXJzIHRlbXBsYXRlcy4g
VGhpcyB3aWxsIG5vdCBiZSB1c2VkCiAgZHVyaW5nIG5vcm1hbCBhcHAgZXhlY3V0aW9uLgoKICBA
bWV0aG9kIHByZWNvbXBpbGUKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMKICBAc3RhdGljCiAgQHBh
cmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgdGVtcGxhdGUgdG8gcHJlY29tcGlsZQoqLwpFbWJlci5I
YW5kbGViYXJzLnByZWNvbXBpbGUgPSBmdW5jdGlvbihzdHJpbmcpIHsKICB2YXIgYXN0ID0gSGFu
ZGxlYmFycy5wYXJzZShzdHJpbmcpOwoKICB2YXIgb3B0aW9ucyA9IHsKICAgIGtub3duSGVscGVy
czogewogICAgICBhY3Rpb246IHRydWUsCiAgICAgIHVuYm91bmQ6IHRydWUsCiAgICAgICdiaW5k
LWF0dHInOiB0cnVlLAogICAgICB0ZW1wbGF0ZTogdHJ1ZSwKICAgICAgdmlldzogdHJ1ZSwKICAg
ICAgX3RyaWFnZU11c3RhY2hlOiB0cnVlCiAgICB9LAogICAgZGF0YTogdHJ1ZSwKICAgIHN0cmlu
Z1BhcmFtczogdHJ1ZQogIH07CgogIHZhciBlbnZpcm9ubWVudCA9IG5ldyBFbWJlci5IYW5kbGVi
YXJzLkNvbXBpbGVyKCkuY29tcGlsZShhc3QsIG9wdGlvbnMpOwogIHJldHVybiBuZXcgRW1iZXIu
SGFuZGxlYmFycy5KYXZhU2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGVudmlyb25tZW50LCBvcHRp
b25zLCB1bmRlZmluZWQsIHRydWUpOwp9OwoKLy8gV2UgZG9uJ3Qgc3VwcG9ydCB0aGlzIGZvciBI
YW5kbGViYXJzIHJ1bnRpbWUtb25seQppZiAoSGFuZGxlYmFycy5jb21waWxlKSB7CiAgLyoqCiAg
ICBUaGUgZW50cnkgcG9pbnQgZm9yIEVtYmVyIEhhbmRsZWJhcnMuIFRoaXMgcmVwbGFjZXMgdGhl
IGRlZmF1bHQKICAgIGBIYW5kbGViYXJzLmNvbXBpbGVgIGFuZCB0dXJucyBvbiB0ZW1wbGF0ZS1s
b2NhbCBkYXRhIGFuZCBTdHJpbmcKICAgIHBhcmFtZXRlcnMuCgogICAgQG1ldGhvZCBjb21waWxl
CiAgICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMKICAgIEBzdGF0aWMKICAgIEBwYXJhbSB7U3RyaW5n
fSBzdHJpbmcgVGhlIHRlbXBsYXRlIHRvIGNvbXBpbGUKICAgIEByZXR1cm4ge0Z1bmN0aW9ufQog
ICovCiAgRW1iZXIuSGFuZGxlYmFycy5jb21waWxlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2
YXIgYXN0ID0gSGFuZGxlYmFycy5wYXJzZShzdHJpbmcpOwogICAgdmFyIG9wdGlvbnMgPSB7IGRh
dGE6IHRydWUsIHN0cmluZ1BhcmFtczogdHJ1ZSB9OwogICAgdmFyIGVudmlyb25tZW50ID0gbmV3
IEVtYmVyLkhhbmRsZWJhcnMuQ29tcGlsZXIoKS5jb21waWxlKGFzdCwgb3B0aW9ucyk7CiAgICB2
YXIgdGVtcGxhdGVTcGVjID0gbmV3IEVtYmVyLkhhbmRsZWJhcnMuSmF2YVNjcmlwdENvbXBpbGVy
KCkuY29tcGlsZShlbnZpcm9ubWVudCwgb3B0aW9ucywgdW5kZWZpbmVkLCB0cnVlKTsKCiAgICB2
YXIgdGVtcGxhdGUgPSBFbWJlci5IYW5kbGViYXJzLnRlbXBsYXRlKHRlbXBsYXRlU3BlYyk7CiAg
ICB0ZW1wbGF0ZS5pc01ldGhvZCA9IGZhbHNlOyAvL01ha2Ugc3VyZSB3ZSBkb24ndCB3cmFwIHRl
bXBsYXRlcyB3aXRoIC5fc3VwZXIKCiAgICByZXR1cm4gdGVtcGxhdGU7CiAgfTsKfQoKCn0pKCk7
CgooZnVuY3Rpb24oKSB7CnZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIG9y
aWdpbmFsVGVtcGxhdGUgPSBFbWJlci5IYW5kbGViYXJzLnRlbXBsYXRlOwoKLyoqCiAgSWYgYSBw
YXRoIHN0YXJ0cyB3aXRoIGEgcmVzZXJ2ZWQga2V5d29yZCwgcmV0dXJucyB0aGUgcm9vdAogIHRo
YXQgc2hvdWxkIGJlIHVzZWQuCgogIEBwcml2YXRlCiAgQG1ldGhvZCBub3JtYWxpemVQYXRoCiAg
QGZvciBFbWJlcgogIEBwYXJhbSByb290IHtPYmplY3R9CiAgQHBhcmFtIHBhdGgge1N0cmluZ30K
ICBAcGFyYW0gZGF0YSB7SGFzaH0KKi8KdmFyIG5vcm1hbGl6ZVBhdGggPSBFbWJlci5IYW5kbGVi
YXJzLm5vcm1hbGl6ZVBhdGggPSBmdW5jdGlvbihyb290LCBwYXRoLCBkYXRhKSB7CiAgdmFyIGtl
eXdvcmRzID0gKGRhdGEgJiYgZGF0YS5rZXl3b3JkcykgfHwge30sCiAgICAgIGtleXdvcmQsIGlz
S2V5d29yZDsKCiAgLy8gR2V0IHRoZSBmaXJzdCBzZWdtZW50IG9mIHRoZSBwYXRoLiBGb3IgZXhh
bXBsZSwgaWYgdGhlCiAgLy8gcGF0aCBpcyAiZm9vLmJhci5iYXoiLCByZXR1cm5zICJmb28iLgog
IGtleXdvcmQgPSBwYXRoLnNwbGl0KCcuJywgMSlbMF07CgogIC8vIFRlc3QgdG8gc2VlIGlmIHRo
ZSBmaXJzdCBwYXRoIGlzIGEga2V5d29yZCB0aGF0IGhhcyBiZWVuCiAgLy8gcGFzc2VkIGFsb25n
IGluIHRoZSB2aWV3J3MgZGF0YSBoYXNoLiBJZiBzbywgd2Ugd2lsbCB0cmVhdAogIC8vIHRoYXQg
b2JqZWN0IGFzIHRoZSBuZXcgcm9vdC4KICBpZiAoa2V5d29yZHMuaGFzT3duUHJvcGVydHkoa2V5
d29yZCkpIHsKICAgIC8vIExvb2sgdXAgdGhlIHZhbHVlIGluIHRoZSB0ZW1wbGF0ZSdzIGRhdGEg
aGFzaC4KICAgIHJvb3QgPSBrZXl3b3Jkc1trZXl3b3JkXTsKICAgIGlzS2V5d29yZCA9IHRydWU7
CgogICAgLy8gSGFuZGxlIGNhc2VzIHdoZXJlIHRoZSBlbnRpcmUgcGF0aCBpcyB0aGUgcmVzZXJ2
ZWQKICAgIC8vIHdvcmQuIEluIHRoYXQgY2FzZSwgcmV0dXJuIHRoZSBvYmplY3QgaXRzZWxmLgog
ICAgaWYgKHBhdGggPT09IGtleXdvcmQpIHsKICAgICAgcGF0aCA9ICcnOwogICAgfSBlbHNlIHsK
ICAgICAgLy8gU3RyaXAgdGhlIGtleXdvcmQgZnJvbSB0aGUgcGF0aCBhbmQgbG9vayB1cAogICAg
ICAvLyB0aGUgcmVtYWluZGVyIGZyb20gdGhlIG5ld2x5IGZvdW5kIHJvb3QuCiAgICAgIHBhdGgg
PSBwYXRoLnN1YnN0cihrZXl3b3JkLmxlbmd0aCsxKTsKICAgIH0KICB9CgogIHJldHVybiB7IHJv
b3Q6IHJvb3QsIHBhdGg6IHBhdGgsIGlzS2V5d29yZDogaXNLZXl3b3JkIH07Cn07CgoKLyoqCiAg
TG9va3VwIGJvdGggb24gcm9vdCBhbmQgb24gd2luZG93LiBJZiB0aGUgcGF0aCBzdGFydHMgd2l0
aAogIGEga2V5d29yZCwgdGhlIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdpbGwgYmUgbG9va2VkIHVw
IGluIHRoZQogIHRlbXBsYXRlJ3MgZGF0YSBoYXNoIGFuZCB1c2VkIHRvIHJlc29sdmUgdGhlIHBh
dGguCgogIEBtZXRob2QgZ2V0CiAgQGZvciBFbWJlci5IYW5kbGViYXJzCiAgQHBhcmFtIHtPYmpl
Y3R9IHJvb3QgVGhlIG9iamVjdCB0byBsb29rIHVwIHRoZSBwcm9wZXJ0eSBvbgogIEBwYXJhbSB7
U3RyaW5nfSBwYXRoIFRoZSBwYXRoIHRvIGJlIGxvb2tlZHVwCiAgQHBhcmFtIHtPYmplY3R9IG9w
dGlvbnMgVGhlIHRlbXBsYXRlJ3Mgb3B0aW9uIGhhc2gKKi8KdmFyIGhhbmRsZWJhcnNHZXQgPSBF
bWJlci5IYW5kbGViYXJzLmdldCA9IGZ1bmN0aW9uKHJvb3QsIHBhdGgsIG9wdGlvbnMpIHsKICB2
YXIgZGF0YSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kYXRhLAogICAgICBub3JtYWxpemVkUGF0aCA9
IG5vcm1hbGl6ZVBhdGgocm9vdCwgcGF0aCwgZGF0YSksCiAgICAgIHZhbHVlOwoKICAKICAgIHJv
b3QgPSBub3JtYWxpemVkUGF0aC5yb290OwogICAgcGF0aCA9IG5vcm1hbGl6ZWRQYXRoLnBhdGg7
CgogICAgdmFsdWUgPSBFbWJlci5nZXQocm9vdCwgcGF0aCk7CgogICAgaWYgKHZhbHVlID09PSB1
bmRlZmluZWQgJiYgcm9vdCAhPT0gRW1iZXIubG9va3VwICYmIEVtYmVyLmlzR2xvYmFsUGF0aChw
YXRoKSkgewogICAgICB2YWx1ZSA9IEVtYmVyLmdldChFbWJlci5sb29rdXAsIHBhdGgpOwogICAg
fQogIAoKICByZXR1cm4gdmFsdWU7Cn07CgpFbWJlci5IYW5kbGViYXJzLnJlc29sdmVQYXJhbXMg
PSBmdW5jdGlvbihjb250ZXh0LCBwYXJhbXMsIG9wdGlvbnMpIHsKICB2YXIgcmVzb2x2ZWRQYXJh
bXMgPSBbXSwgdHlwZXMgPSBvcHRpb25zLnR5cGVzLCBwYXJhbSwgdHlwZTsKCiAgZm9yICh2YXIg
aT0wLCBsPXBhcmFtcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICBwYXJhbSA9IHBhcmFtc1tpXTsK
ICAgIHR5cGUgPSB0eXBlc1tpXTsKCiAgICBpZiAodHlwZSA9PT0gJ0lEJykgewogICAgICByZXNv
bHZlZFBhcmFtcy5wdXNoKGhhbmRsZWJhcnNHZXQoY29udGV4dCwgcGFyYW0sIG9wdGlvbnMpKTsK
ICAgIH0gZWxzZSB7CiAgICAgIHJlc29sdmVkUGFyYW1zLnB1c2gocGFyYW0pOwogICAgfQogIH0K
CiAgcmV0dXJuIHJlc29sdmVkUGFyYW1zOwp9OwoKRW1iZXIuSGFuZGxlYmFycy5yZXNvbHZlSGFz
aCA9IGZ1bmN0aW9uKGNvbnRleHQsIGhhc2gsIG9wdGlvbnMpIHsKICB2YXIgcmVzb2x2ZWRIYXNo
ID0ge30sIHR5cGVzID0gb3B0aW9ucy5oYXNoVHlwZXMsIHR5cGU7CgogIGZvciAodmFyIGtleSBp
biBoYXNoKSB7CiAgICBpZiAoIWhhc2guaGFzT3duUHJvcGVydHkoa2V5KSkgeyBjb250aW51ZTsg
fQoKICAgIHR5cGUgPSB0eXBlc1trZXldOwoKICAgIGlmICh0eXBlID09PSAnSUQnKSB7CiAgICAg
IHJlc29sdmVkSGFzaFtrZXldID0gaGFuZGxlYmFyc0dldChjb250ZXh0LCBoYXNoW2tleV0sIG9w
dGlvbnMpOwogICAgfSBlbHNlIHsKICAgICAgcmVzb2x2ZWRIYXNoW2tleV0gPSBoYXNoW2tleV07
CiAgICB9CiAgfQoKICByZXR1cm4gcmVzb2x2ZWRIYXNoOwp9OwoKLyoqCiAgUmVnaXN0ZXJzIGEg
aGVscGVyIGluIEhhbmRsZWJhcnMgdGhhdCB3aWxsIGJlIGNhbGxlZCBpZiBubyBwcm9wZXJ0eSB3
aXRoIHRoZQogIGdpdmVuIG5hbWUgY2FuIGJlIGZvdW5kIG9uIHRoZSBjdXJyZW50IGNvbnRleHQg
b2JqZWN0LCBhbmQgbm8gaGVscGVyIHdpdGgKICB0aGF0IG5hbWUgaXMgcmVnaXN0ZXJlZC4KCiAg
VGhpcyB0aHJvd3MgYW4gZXhjZXB0aW9uIHdpdGggYSBtb3JlIGhlbHBmdWwgZXJyb3IgbWVzc2Fn
ZSBzbyB0aGUgdXNlciBjYW4KICB0cmFjayBkb3duIHdoZXJlIHRoZSBwcm9ibGVtIGlzIGhhcHBl
bmluZy4KCiAgQHByaXZhdGUKICBAbWV0aG9kIGhlbHBlck1pc3NpbmcKICBAZm9yIEVtYmVyLkhh
bmRsZWJhcnMuaGVscGVycwogIEBwYXJhbSB7U3RyaW5nfSBwYXRoCiAgQHBhcmFtIHtIYXNofSBv
cHRpb25zCiovCkVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2hlbHBlck1pc3Npbmcn
LCBmdW5jdGlvbihwYXRoKSB7CiAgdmFyIGVycm9yLCB2aWV3ID0gIiI7CgogIHZhciBvcHRpb25z
ID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTsKCiAgdmFyIGhlbHBlciA9IEVtYmVy
LkhhbmRsZWJhcnMucmVzb2x2ZUhlbHBlcihvcHRpb25zLmRhdGEudmlldy5jb250YWluZXIsIHBh
dGgpOwoKICBpZiAoaGVscGVyKSB7CiAgICByZXR1cm4gaGVscGVyLmFwcGx5KHRoaXMsIHNsaWNl
LmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgfQoKICBlcnJvciA9ICIlQCBIYW5kbGViYXJzIGVycm9y
OiBDb3VsZCBub3QgZmluZCBwcm9wZXJ0eSAnJUAnIG9uIG9iamVjdCAlQC4iOwogIGlmIChvcHRp
b25zLmRhdGEpIHsKICAgIHZpZXcgPSBvcHRpb25zLmRhdGEudmlldzsKICB9CiAgdGhyb3cgbmV3
IEVtYmVyLkVycm9yKEVtYmVyLlN0cmluZy5mbXQoZXJyb3IsIFt2aWV3LCBwYXRoLCB0aGlzXSkp
Owp9KTsKCi8qKgogIFJlZ2lzdGVycyBhIGhlbHBlciBpbiBIYW5kbGViYXJzIHRoYXQgd2lsbCBi
ZSBjYWxsZWQgaWYgbm8gcHJvcGVydHkgd2l0aCB0aGUKICBnaXZlbiBuYW1lIGNhbiBiZSBmb3Vu
ZCBvbiB0aGUgY3VycmVudCBjb250ZXh0IG9iamVjdCwgYW5kIG5vIGhlbHBlciB3aXRoCiAgdGhh
dCBuYW1lIGlzIHJlZ2lzdGVyZWQuCgogIFRoaXMgdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aXRoIGEg
bW9yZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2Ugc28gdGhlIHVzZXIgY2FuCiAgdHJhY2sgZG93biB3
aGVyZSB0aGUgcHJvYmxlbSBpcyBoYXBwZW5pbmcuCgogIEBwcml2YXRlCiAgQG1ldGhvZCBoZWxw
ZXJNaXNzaW5nCiAgQGZvciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0ge1N0cmlu
Z30gcGF0aAogIEBwYXJhbSB7SGFzaH0gb3B0aW9ucwoqLwpFbWJlci5IYW5kbGViYXJzLnJlZ2lz
dGVySGVscGVyKCdibG9ja0hlbHBlck1pc3NpbmcnLCBmdW5jdGlvbihwYXRoKSB7CgogIHZhciBv
cHRpb25zID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTsKCiAgRW1iZXIuYXNzZXJ0
KCJgYmxvY2tIZWxwZXJNaXNzaW5nYCB3YXMgaW52b2tlZCB3aXRob3V0IGEgaGVscGVyIG5hbWUs
IHdoaWNoICIgKwogICAgICAgICAgICAgICAiaXMgbW9zdCBsaWtlbHkgZHVlIHRvIGEgbWlzbWF0
Y2ggYmV0d2VlbiB0aGUgdmVyc2lvbiBvZiAiICsKICAgICAgICAgICAgICAgIkVtYmVyLmpzIHlv
dSdyZSBydW5uaW5nIG5vdyBhbmQgdGhlIG9uZSB1c2VkIHRvIHByZWNvbXBpbGUgeW91ciAiICsK
ICAgICAgICAgICAgICAgInRlbXBsYXRlcy4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgdmVyc2lvbiBv
ZiAiICsKICAgICAgICAgICAgICAgImBlbWJlci1oYW5kbGViYXJzLWNvbXBpbGVyYCB5b3UncmUg
dXNpbmcgaXMgdXAgdG8gZGF0ZS4iLCBwYXRoKTsKCiAgdmFyIGhlbHBlciA9IEVtYmVyLkhhbmRs
ZWJhcnMucmVzb2x2ZUhlbHBlcihvcHRpb25zLmRhdGEudmlldy5jb250YWluZXIsIHBhdGgpOwoK
ICBpZiAoaGVscGVyKSB7CiAgICByZXR1cm4gaGVscGVyLmFwcGx5KHRoaXMsIHNsaWNlLmNhbGwo
YXJndW1lbnRzLCAxKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBIYW5kbGViYXJzLmhlbHBlcnMu
aGVscGVyTWlzc2luZy5jYWxsKHRoaXMsIHBhdGgpOwogIH0KCiAgcmV0dXJuIEhhbmRsZWJhcnMu
aGVscGVycy5ibG9ja0hlbHBlck1pc3NpbmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfSk7Cgov
KioKICBSZWdpc3RlciBhIGJvdW5kIGhhbmRsZWJhcnMgaGVscGVyLiBCb3VuZCBoZWxwZXJzIGJl
aGF2ZSBzaW1pbGFybHkgdG8gcmVndWxhcgogIGhhbmRsZWJhcnMgaGVscGVycywgd2l0aCB0aGUg
YWRkZWQgYWJpbGl0eSB0byByZS1yZW5kZXIgd2hlbiB0aGUgdW5kZXJseWluZyBkYXRhCiAgY2hh
bmdlcy4KCiAgIyMgU2ltcGxlIGV4YW1wbGUKCiAgYGBgamF2YXNjcmlwdAogIEVtYmVyLkhhbmRs
ZWJhcnMucmVnaXN0ZXJCb3VuZEhlbHBlcignY2FwaXRhbGl6ZScsIGZ1bmN0aW9uKHZhbHVlKSB7
CiAgICByZXR1cm4gdmFsdWUudG9VcHBlckNhc2UoKTsKICB9KTsKICBgYGAKCiAgVGhlIGFib3Zl
IGJvdW5kIGhlbHBlciBjYW4gYmUgdXNlZCBpbnNpZGUgb2YgdGVtcGxhdGVzIGFzIGZvbGxvd3M6
CgogIGBgYGhhbmRsZWJhcnMKICB7e2NhcGl0YWxpemUgbmFtZX19CiAgYGBgCgogIEluIHRoaXMg
Y2FzZSwgd2hlbiB0aGUgYG5hbWVgIHByb3BlcnR5IG9mIHRoZSB0ZW1wbGF0ZSdzIGNvbnRleHQg
Y2hhbmdlcywKICB0aGUgcmVuZGVyZWQgdmFsdWUgb2YgdGhlIGhlbHBlciB3aWxsIHVwZGF0ZSB0
byByZWZsZWN0IHRoaXMgY2hhbmdlLgoKICAjIyBFeGFtcGxlIHdpdGggb3B0aW9ucwoKICBMaWtl
IG5vcm1hbCBoYW5kbGViYXJzIGhlbHBlcnMsIGJvdW5kIGhlbHBlcnMgaGF2ZSBhY2Nlc3MgdG8g
dGhlIG9wdGlvbnMKICBwYXNzZWQgaW50byB0aGUgaGVscGVyIGNhbGwuCgogIGBgYGphdmFzY3Jp
cHQKICBFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVyQm91bmRIZWxwZXIoJ3JlcGVhdCcsIGZ1bmN0
aW9uKHZhbHVlLCBvcHRpb25zKSB7CiAgICB2YXIgY291bnQgPSBvcHRpb25zLmhhc2guY291bnQ7
CiAgICB2YXIgYSA9IFtdOwogICAgd2hpbGUoYS5sZW5ndGggPCBjb3VudCkgewogICAgICAgIGEu
cHVzaCh2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gYS5qb2luKCcnKTsKICB9KTsKICBgYGAKCiAg
VGhpcyBoZWxwZXIgY291bGQgYmUgdXNlZCBpbiBhIHRlbXBsYXRlIGFzIGZvbGxvd3M6CgogIGBg
YGhhbmRsZWJhcnMKICB7e3JlcGVhdCB0ZXh0IGNvdW50PTN9fQogIGBgYAoKICAjIyBFeGFtcGxl
IHdpdGggYm91bmQgb3B0aW9ucwoKICBCb3VuZCBoYXNoIG9wdGlvbnMgYXJlIGFsc28gc3VwcG9y
dGVkLiBFeGFtcGxlOgoKICBgYGBoYW5kbGViYXJzCiAge3tyZXBlYXQgdGV4dCBjb3VudEJpbmRp
bmc9Im51bVJlcGVhdHMifX0KICBgYGAKCiAgSW4gdGhpcyBleGFtcGxlLCBjb3VudCB3aWxsIGJl
IGJvdW5kIHRvIHRoZSB2YWx1ZSBvZgogIHRoZSBgbnVtUmVwZWF0c2AgcHJvcGVydHkgb24gdGhl
IGNvbnRleHQuIElmIHRoYXQgcHJvcGVydHkKICBjaGFuZ2VzLCB0aGUgaGVscGVyIHdpbGwgYmUg
cmUtcmVuZGVyZWQuCgogICMjIEV4YW1wbGUgd2l0aCBleHRyYSBkZXBlbmRlbmNpZXMKCiAgVGhl
IGBFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVyQm91bmRIZWxwZXJgIG1ldGhvZCB0YWtlcyBhIHZh
cmlhYmxlIGxlbmd0aAogIHRoaXJkIHBhcmFtZXRlciB3aGljaCBpbmRpY2F0ZXMgZXh0cmEgZGVw
ZW5kZW5jaWVzIG9uIHRoZSBwYXNzZWQgaW4gdmFsdWUuCiAgVGhpcyBhbGxvd3MgdGhlIGhhbmRs
ZWJhcnMgaGVscGVyIHRvIHVwZGF0ZSB3aGVuIHRoZXNlIGRlcGVuZGVuY2llcyBjaGFuZ2UuCgog
IGBgYGphdmFzY3JpcHQKICBFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVyQm91bmRIZWxwZXIoJ2Nh
cGl0YWxpemVOYW1lJywgZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZS5nZXQoJ25h
bWUnKS50b1VwcGVyQ2FzZSgpOwogIH0sICduYW1lJyk7CiAgYGBgCgogICMjIEV4YW1wbGUgd2l0
aCBtdWx0aXBsZSBib3VuZCBwcm9wZXJ0aWVzCgogIGBFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVy
Qm91bmRIZWxwZXJgIHN1cHBvcnRzIGJpbmRpbmcgdG8KICBtdWx0aXBsZSBwcm9wZXJ0aWVzLCBl
LmcuOgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuSGFuZGxlYmFycy5yZWdpc3RlckJvdW5kSGVs
cGVyKCdjb25jYXRlbmF0ZScsIGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlcyA9IEFycmF5LnBy
b3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCwgLTEpOwogICAgcmV0dXJuIHZhbHVlcy5q
b2luKCd8fCcpOwogIH0pOwogIGBgYAoKICBXaGljaCBhbGxvd3MgZm9yIHRlbXBsYXRlIHN5bnRh
eCBzdWNoIGFzIGB7e2NvbmNhdGVuYXRlIHByb3AxIHByb3AyfX1gIG9yCiAgYHt7Y29uY2F0ZW5h
dGUgcHJvcDEgcHJvcDIgcHJvcDN9fWAuIElmIGFueSBvZiB0aGUgcHJvcGVydGllcyBjaGFuZ2Us
CiAgdGhlIGhlbHByIHdpbGwgcmUtcmVuZGVyLiAgTm90ZSB0aGF0IGRlcGVuZGVuY3kga2V5cyBj
YW5ub3QgYmUKICB1c2luZyBpbiBjb25qdW5jdGlvbiB3aXRoIG11bHRpLXByb3BlcnR5IGhlbHBl
cnMsIHNpbmNlIGl0IGlzIGFtYmlndW91cwogIHdoaWNoIHByb3BlcnR5IHRoZSBkZXBlbmRlbnQg
a2V5cyB3b3VsZCBiZWxvbmcgdG8uCgogICMjIFVzZSB3aXRoIHVuYm91bmQgaGVscGVyCgogIFRo
ZSBge3t1bmJvdW5kfX1gIGhlbHBlciBjYW4gYmUgdXNlZCB3aXRoIGJvdW5kIGhlbHBlciBpbnZv
Y2F0aW9ucwogIHRvIHJlbmRlciB0aGVtIGluIHRoZWlyIHVuYm91bmQgZm9ybSwgZS5nLgoKICBg
YGBoYW5kbGViYXJzCiAge3t1bmJvdW5kIGNhcGl0YWxpemUgbmFtZX19CiAgYGBgCgogIEluIHRo
aXMgZXhhbXBsZSwgaWYgdGhlIG5hbWUgcHJvcGVydHkgY2hhbmdlcywgdGhlIGhlbHBlcgogIHdp
bGwgbm90IHJlLXJlbmRlci4KCiAgIyMgVXNlIHdpdGggYmxvY2tzIG5vdCBzdXBwb3J0ZWQKCiAg
Qm91bmQgaGVscGVycyBkbyBub3Qgc3VwcG9ydCB1c2Ugd2l0aCBIYW5kbGViYXJzIGJsb2NrcyBv
cgogIHRoZSBhZGRpdGlvbiBvZiBjaGlsZCB2aWV3cyBvZiBhbnkga2luZC4KCiAgQG1ldGhvZCBy
ZWdpc3RlckJvdW5kSGVscGVyCiAgQGZvciBFbWJlci5IYW5kbGViYXJzCiAgQHBhcmFtIHtTdHJp
bmd9IG5hbWUKICBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jdGlvbgogIEBwYXJhbSB7U3RyaW5nfSBk
ZXBlbmRlbnRLZXlzKgoqLwpFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVyQm91bmRIZWxwZXIgPSBm
dW5jdGlvbihuYW1lLCBmbikgewogIHZhciBib3VuZEhlbHBlckFyZ3MgPSBzbGljZS5jYWxsKGFy
Z3VtZW50cywgMSksCiAgICAgIGJvdW5kRm4gPSBFbWJlci5IYW5kbGViYXJzLm1ha2VCb3VuZEhl
bHBlci5hcHBseSh0aGlzLCBib3VuZEhlbHBlckFyZ3MpOwogIEVtYmVyLkhhbmRsZWJhcnMucmVn
aXN0ZXJIZWxwZXIobmFtZSwgYm91bmRGbik7Cn07CgovKioKICBBIChtb3N0bHkpIHByaXZhdGUg
aGVscGVyIGZ1bmN0aW9uIHRvIGByZWdpc3RlckJvdW5kSGVscGVyYC4gVGFrZXMgdGhlCiAgcHJv
dmlkZWQgSGFuZGxlYmFycyBoZWxwZXIgZnVuY3Rpb24gZm4gYW5kIHJldHVybnMgaXQgaW4gd3Jh
cHBlZAogIGJvdW5kIGhlbHBlciBmb3JtLgoKICBUaGUgbWFpbiB1c2UgY2FzZSBmb3IgdXNpbmcg
dGhpcyBvdXRzaWRlIG9mIGByZWdpc3RlckJvdW5kSGVscGVyYAogIGlzIGZvciByZWdpc3Rlcmlu
ZyBoZWxwZXJzIG9uIHRoZSBjb250YWluZXI6CgogIGBgYGpzCiAgdmFyIGJvdW5kSGVscGVyRm4g
PSBFbWJlci5IYW5kbGViYXJzLm1ha2VCb3VuZEhlbHBlcihmdW5jdGlvbih3b3JkKSB7CiAgICBy
ZXR1cm4gd29yZC50b1VwcGVyQ2FzZSgpOwogIH0pOwoKICBjb250YWluZXIucmVnaXN0ZXIoJ2hl
bHBlcjpteS1ib3VuZC1oZWxwZXInLCBib3VuZEhlbHBlckZuKTsKICBgYGAKCiAgSW4gdGhlIGFi
b3ZlIGV4YW1wbGUsIGlmIHRoZSBoZWxwZXIgZnVuY3Rpb24gaGFkbid0IGJlZW4gd3JhcHBlZCBp
bgogIGBtYWtlQm91bmRIZWxwZXJgLCB0aGUgcmVnaXN0ZXJlZCBoZWxwZXIgd291bGQgYmUgdW5i
b3VuZC4KCiAgQHByaXZhdGUKICBAbWV0aG9kIG1ha2VCb3VuZEhlbHBlcgogIEBmb3IgRW1iZXIu
SGFuZGxlYmFycwogIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmN0aW9uCiAgQHBhcmFtIHtTdHJpbmd9
IGRlcGVuZGVudEtleXMqCiovCkVtYmVyLkhhbmRsZWJhcnMubWFrZUJvdW5kSGVscGVyID0gZnVu
Y3Rpb24oZm4pIHsKICB2YXIgZGVwZW5kZW50S2V5cyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAx
KTsKCiAgZnVuY3Rpb24gaGVscGVyKCkgewogICAgdmFyIHByb3BlcnRpZXMgPSBzbGljZS5jYWxs
KGFyZ3VtZW50cywgMCwgLTEpLAogICAgICBudW1Qcm9wZXJ0aWVzID0gcHJvcGVydGllcy5sZW5n
dGgsCiAgICAgIG9wdGlvbnMgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdLAogICAg
ICBub3JtYWxpemVkUHJvcGVydGllcyA9IFtdLAogICAgICBkYXRhID0gb3B0aW9ucy5kYXRhLAog
ICAgICB0eXBlcyA9IGRhdGEuaXNVbmJvdW5kID8gc2xpY2UuY2FsbChvcHRpb25zLnR5cGVzLCAx
KSA6IG9wdGlvbnMudHlwZXMsCiAgICAgIGhhc2ggPSBvcHRpb25zLmhhc2gsCiAgICAgIHZpZXcg
PSBkYXRhLnZpZXcsCiAgICAgIGNvbnRleHRzID0gb3B0aW9ucy5jb250ZXh0cywKICAgICAgY3Vy
cmVudENvbnRleHQgPSAoY29udGV4dHMgJiYgY29udGV4dHMubGVuZ3RoKSA/IGNvbnRleHRzWzBd
IDogdGhpcywKICAgICAgcHJlZml4UGF0aEZvckRlcGVuZGVudEtleXMgPSAnJywKICAgICAgbG9j
LCBsZW4sIGhhc2hPcHRpb24sCiAgICAgIGJvdW5kT3B0aW9uLCBwcm9wZXJ0eSwKICAgICAgbm9y
bWFsaXplZFZhbHVlID0gRW1iZXIuX1NpbXBsZUhhbmRsZWJhcnNWaWV3LnByb3RvdHlwZS5ub3Jt
YWxpemVkVmFsdWU7CgogICAgRW1iZXIuYXNzZXJ0KCJyZWdpc3RlckJvdW5kSGVscGVyLWdlbmVy
YXRlZCBoZWxwZXJzIGRvIG5vdCBzdXBwb3J0IHVzZSB3aXRoIEhhbmRsZWJhcnMgYmxvY2tzLiIs
ICFvcHRpb25zLmZuKTsKCiAgICAvLyBEZXRlY3QgYm91bmQgb3B0aW9ucyAoZS5nLiBjb3VudEJp
bmRpbmc9Im90aGVyQ291bnQiKQogICAgdmFyIGJvdW5kT3B0aW9ucyA9IGhhc2guYm91bmRPcHRp
b25zID0ge307CiAgICBmb3IgKGhhc2hPcHRpb24gaW4gaGFzaCkgewogICAgICBpZiAoRW1iZXIu
SVNfQklORElORy50ZXN0KGhhc2hPcHRpb24pKSB7CiAgICAgICAgLy8gTG9wIG9mZiAnQmluZGlu
Zycgc3VmZml4LgogICAgICAgIGJvdW5kT3B0aW9uc1toYXNoT3B0aW9uLnNsaWNlKDAsIC03KV0g
PSBoYXNoW2hhc2hPcHRpb25dOwogICAgICB9CiAgICB9CgogICAgLy8gRXhwb3NlIHByb3BlcnR5
IG5hbWVzIG9uIGRhdGEucHJvcGVydGllcyBvYmplY3QuCiAgICB2YXIgd2F0Y2hlZFByb3BlcnRp
ZXMgPSBbXTsKICAgIGRhdGEucHJvcGVydGllcyA9IFtdOwogICAgZm9yIChsb2MgPSAwOyBsb2Mg
PCBudW1Qcm9wZXJ0aWVzOyArK2xvYykgewogICAgICBkYXRhLnByb3BlcnRpZXMucHVzaChwcm9w
ZXJ0aWVzW2xvY10pOwogICAgICBpZiAodHlwZXNbbG9jXSA9PT0gJ0lEJykgewogICAgICAgIHZh
ciBub3JtYWxpemVkUHJvcCA9IG5vcm1hbGl6ZVBhdGgoY3VycmVudENvbnRleHQsIHByb3BlcnRp
ZXNbbG9jXSwgZGF0YSk7CiAgICAgICAgbm9ybWFsaXplZFByb3BlcnRpZXMucHVzaChub3JtYWxp
emVkUHJvcCk7CiAgICAgICAgd2F0Y2hlZFByb3BlcnRpZXMucHVzaChub3JtYWxpemVkUHJvcCk7
CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYoZGF0YS5pc1VuYm91bmQpIHsKICAgICAgICAgIG5v
cm1hbGl6ZWRQcm9wZXJ0aWVzLnB1c2goe3BhdGg6IHByb3BlcnRpZXNbbG9jXX0pOwogICAgICAg
IH1lbHNlIHsKICAgICAgICAgIG5vcm1hbGl6ZWRQcm9wZXJ0aWVzLnB1c2gobnVsbCk7CiAgICAg
ICAgfQogICAgICB9CiAgICB9CgogICAgLy8gSGFuZGxlIGNhc2Ugd2hlbiBoZWxwZXIgaW52b2Nh
dGlvbiBpcyBwcmVjZWRlZCBieSBgdW5ib3VuZGAsIGUuZy4KICAgIC8vIHt7dW5ib3VuZCBteUhl
bHBlciBmb299fQogICAgaWYgKGRhdGEuaXNVbmJvdW5kKSB7CiAgICAgIHJldHVybiBldmFsdWF0
ZVVuYm91bmRIZWxwZXIodGhpcywgZm4sIG5vcm1hbGl6ZWRQcm9wZXJ0aWVzLCBvcHRpb25zKTsK
ICAgIH0KCiAgICB2YXIgYmluZFZpZXcgPSBuZXcgRW1iZXIuX1NpbXBsZUhhbmRsZWJhcnNWaWV3
KG51bGwsIG51bGwsICFvcHRpb25zLmhhc2gudW5lc2NhcGVkLCBvcHRpb25zLmRhdGEpOwoKICAg
IC8vIE92ZXJyaWRlIFNpbXBsZUhhbmRsZWJhcnNWaWV3J3MgbWV0aG9kIGZvciBnZW5lcmF0aW5n
IHRoZSB2aWV3J3MgY29udGVudC4KICAgIGJpbmRWaWV3Lm5vcm1hbGl6ZWRWYWx1ZSA9IGZ1bmN0
aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBib3VuZE9wdGlvbjsKCiAgICAgIC8vIENvcHkg
b3ZlciBib3VuZCBoYXNoIG9wdGlvbnMuCiAgICAgIGZvciAoYm91bmRPcHRpb24gaW4gYm91bmRP
cHRpb25zKSB7CiAgICAgICAgaWYgKCFib3VuZE9wdGlvbnMuaGFzT3duUHJvcGVydHkoYm91bmRP
cHRpb24pKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgcHJvcGVydHkgPSBub3JtYWxpemVQYXRoKGN1
cnJlbnRDb250ZXh0LCBib3VuZE9wdGlvbnNbYm91bmRPcHRpb25dLCBkYXRhKTsKICAgICAgICBi
aW5kVmlldy5wYXRoID0gcHJvcGVydHkucGF0aDsKICAgICAgICBiaW5kVmlldy5wYXRoUm9vdCA9
IHByb3BlcnR5LnJvb3Q7CiAgICAgICAgaGFzaFtib3VuZE9wdGlvbl0gPSBub3JtYWxpemVkVmFs
dWUuY2FsbChiaW5kVmlldyk7CiAgICAgIH0KCiAgICAgIGZvciAobG9jID0gMDsgbG9jIDwgbnVt
UHJvcGVydGllczsgKytsb2MpIHsKICAgICAgICBwcm9wZXJ0eSA9IG5vcm1hbGl6ZWRQcm9wZXJ0
aWVzW2xvY107CiAgICAgICAgaWYgKHByb3BlcnR5KSB7CiAgICAgICAgICBiaW5kVmlldy5wYXRo
ID0gcHJvcGVydHkucGF0aDsKICAgICAgICAgIGJpbmRWaWV3LnBhdGhSb290ID0gcHJvcGVydHku
cm9vdDsKICAgICAgICAgIGFyZ3MucHVzaChub3JtYWxpemVkVmFsdWUuY2FsbChiaW5kVmlldykp
OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhcmdzLnB1c2gocHJvcGVydGllc1tsb2NdKTsK
ICAgICAgICB9CiAgICAgIH0KICAgICAgYXJncy5wdXNoKG9wdGlvbnMpOwoKICAgICAgLy8gUnVu
IHRoZSBzdXBwbGllZCBoZWxwZXIgZnVuY3Rpb24uCiAgICAgIHJldHVybiBmbi5hcHBseShjdXJy
ZW50Q29udGV4dCwgYXJncyk7CiAgICB9OwoKICAgIHZpZXcuYXBwZW5kQ2hpbGQoYmluZFZpZXcp
OwoKICAgIC8vIEFzc2VtYmxlIGxpc3Qgb2Ygd2F0Y2hlZCBwcm9wZXJ0aWVzIHRoYXQnbGwgcmUt
cmVuZGVyIHRoaXMgaGVscGVyLgogICAgZm9yIChib3VuZE9wdGlvbiBpbiBib3VuZE9wdGlvbnMp
IHsKICAgICAgaWYgKGJvdW5kT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShib3VuZE9wdGlvbikpIHsK
ICAgICAgICB3YXRjaGVkUHJvcGVydGllcy5wdXNoKG5vcm1hbGl6ZVBhdGgoY3VycmVudENvbnRl
eHQsIGJvdW5kT3B0aW9uc1tib3VuZE9wdGlvbl0sIGRhdGEpKTsKICAgICAgfQogICAgfQoKICAg
IC8vIE9ic2VydmUgZWFjaCBwcm9wZXJ0eS4KICAgIGZvciAobG9jID0gMCwgbGVuID0gd2F0Y2hl
ZFByb3BlcnRpZXMubGVuZ3RoOyBsb2MgPCBsZW47ICsrbG9jKSB7CiAgICAgIHByb3BlcnR5ID0g
d2F0Y2hlZFByb3BlcnRpZXNbbG9jXTsKICAgICAgdmlldy5yZWdpc3Rlck9ic2VydmVyKHByb3Bl
cnR5LnJvb3QsIHByb3BlcnR5LnBhdGgsIGJpbmRWaWV3LCBiaW5kVmlldy5yZXJlbmRlcik7CiAg
ICB9CgogICAgaWYgKHR5cGVzWzBdICE9PSAnSUQnIHx8IG5vcm1hbGl6ZWRQcm9wZXJ0aWVzLmxl
bmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQWRkIGRlcGVuZGVudCBr
ZXkgb2JzZXJ2ZXJzIHRvIHRoZSBmaXJzdCBwYXJhbQogICAgdmFyIG5vcm1hbGl6ZWQgPSBub3Jt
YWxpemVkUHJvcGVydGllc1swXSwKICAgICAgICBwYXRoUm9vdCA9IG5vcm1hbGl6ZWQucm9vdCwK
ICAgICAgICBwYXRoID0gbm9ybWFsaXplZC5wYXRoOwoKICAgIGlmKCFFbWJlci5pc0VtcHR5KHBh
dGgpKSB7CiAgICAgIHByZWZpeFBhdGhGb3JEZXBlbmRlbnRLZXlzID0gcGF0aCArICcuJzsKICAg
IH0KICAgIGZvciAodmFyIGk9MCwgbD1kZXBlbmRlbnRLZXlzLmxlbmd0aDsgaTxsOyBpKyspIHsK
ICAgICAgdmlldy5yZWdpc3Rlck9ic2VydmVyKHBhdGhSb290LCBwcmVmaXhQYXRoRm9yRGVwZW5k
ZW50S2V5cyArIGRlcGVuZGVudEtleXNbaV0sIGJpbmRWaWV3LCBiaW5kVmlldy5yZXJlbmRlcik7
CiAgICB9CiAgfQoKICBoZWxwZXIuX3Jhd0Z1bmN0aW9uID0gZm47CiAgcmV0dXJuIGhlbHBlcjsK
fTsKCi8qKgogIFJlbmRlcnMgdGhlIHVuYm91bmQgZm9ybSBvZiBhbiBvdGhlcndpc2UgYm91bmQg
aGVscGVyIGZ1bmN0aW9uLgoKICBAcHJpdmF0ZQogIEBtZXRob2QgZXZhbHVhdGVVbmJvdW5kSGVs
cGVyCiAgQHBhcmFtIHtGdW5jdGlvbn0gZm4KICBAcGFyYW0ge09iamVjdH0gY29udGV4dAogIEBw
YXJhbSB7QXJyYXl9IG5vcm1hbGl6ZWRQcm9wZXJ0aWVzCiAgQHBhcmFtIHtTdHJpbmd9IG9wdGlv
bnMKKi8KZnVuY3Rpb24gZXZhbHVhdGVVbmJvdW5kSGVscGVyKGNvbnRleHQsIGZuLCBub3JtYWxp
emVkUHJvcGVydGllcywgb3B0aW9ucykgewogIHZhciBhcmdzID0gW10sCiAgIGhhc2ggPSBvcHRp
b25zLmhhc2gsCiAgIGJvdW5kT3B0aW9ucyA9IGhhc2guYm91bmRPcHRpb25zLAogICB0eXBlcyA9
IHNsaWNlLmNhbGwob3B0aW9ucy50eXBlcywgMSksCiAgIGxvYywKICAgbGVuLAogICBwcm9wZXJ0
eSwKICAgcHJvcGVydHlUeXBlLAogICBib3VuZE9wdGlvbjsKCiAgZm9yIChib3VuZE9wdGlvbiBp
biBib3VuZE9wdGlvbnMpIHsKICAgIGlmICghYm91bmRPcHRpb25zLmhhc093blByb3BlcnR5KGJv
dW5kT3B0aW9uKSkgeyBjb250aW51ZTsgfQogICAgaGFzaFtib3VuZE9wdGlvbl0gPSBFbWJlci5I
YW5kbGViYXJzLmdldChjb250ZXh0LCBib3VuZE9wdGlvbnNbYm91bmRPcHRpb25dLCBvcHRpb25z
KTsKICB9CgogIGZvcihsb2MgPSAwLCBsZW4gPSBub3JtYWxpemVkUHJvcGVydGllcy5sZW5ndGg7
IGxvYyA8IGxlbjsgKytsb2MpIHsKICAgIHByb3BlcnR5ID0gbm9ybWFsaXplZFByb3BlcnRpZXNb
bG9jXTsKICAgIHByb3BlcnR5VHlwZSA9IHR5cGVzW2xvY107CiAgICBpZihwcm9wZXJ0eVR5cGUg
PT09ICJJRCIpIHsKICAgICAgYXJncy5wdXNoKEVtYmVyLkhhbmRsZWJhcnMuZ2V0KHByb3BlcnR5
LnJvb3QsIHByb3BlcnR5LnBhdGgsIG9wdGlvbnMpKTsKICAgIH0gZWxzZSB7CiAgICAgIGFyZ3Mu
cHVzaChwcm9wZXJ0eS5wYXRoKTsKICAgIH0KICB9CiAgYXJncy5wdXNoKG9wdGlvbnMpOwogIHJl
dHVybiBmbi5hcHBseShjb250ZXh0LCBhcmdzKTsKfQoKLyoqCiAgT3ZlcnJpZGVzIEhhbmRsZWJh
cnMudGVtcGxhdGUgc28gdGhhdCB3ZSBjYW4gZGlzdGluZ3Vpc2gKICB1c2VyLWNyZWF0ZWQsIHRv
cC1sZXZlbCB0ZW1wbGF0ZXMgZnJvbSBpbm5lciBjb250ZXh0cy4KCiAgQHByaXZhdGUKICBAbWV0
aG9kIHRlbXBsYXRlCiAgQGZvciBFbWJlci5IYW5kbGViYXJzCiAgQHBhcmFtIHtTdHJpbmd9IHNw
ZWMKKi8KRW1iZXIuSGFuZGxlYmFycy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHNwZWMpIHsKICB2YXIg
dCA9IG9yaWdpbmFsVGVtcGxhdGUoc3BlYyk7CiAgdC5pc1RvcCA9IHRydWU7CiAgcmV0dXJuIHQ7
Cn07Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgogIE1hcmsgYSBzdHJpbmcgYXMgc2FmZSBm
b3IgdW5lc2NhcGVkIG91dHB1dCB3aXRoIEhhbmRsZWJhcnMuIElmIHlvdQogIHJldHVybiBIVE1M
IGZyb20gYSBIYW5kbGViYXJzIGhlbHBlciwgdXNlIHRoaXMgZnVuY3Rpb24gdG8KICBlbnN1cmUg
SGFuZGxlYmFycyBkb2VzIG5vdCBlc2NhcGUgdGhlIEhUTUwuCgogIGBgYGphdmFzY3JpcHQKICBF
bWJlci5TdHJpbmcuaHRtbFNhZmUoJzxkaXY+c29tZVN0cmluZzwvZGl2PicpCiAgYGBgCgogIEBt
ZXRob2QgaHRtbFNhZmUKICBAZm9yIEVtYmVyLlN0cmluZwogIEBzdGF0aWMKICBAcmV0dXJuIHtI
YW5kbGViYXJzLlNhZmVTdHJpbmd9IGEgc3RyaW5nIHRoYXQgd2lsbCBub3QgYmUgaHRtbCBlc2Nh
cGVkIGJ5IEhhbmRsZWJhcnMKKi8KRW1iZXIuU3RyaW5nLmh0bWxTYWZlID0gZnVuY3Rpb24oc3Ry
KSB7CiAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcoc3RyKTsKfTsKCnZhciBodG1s
U2FmZSA9IEVtYmVyLlN0cmluZy5odG1sU2FmZTsKCmlmIChFbWJlci5FWFRFTkRfUFJPVE9UWVBF
UyA9PT0gdHJ1ZSB8fCBFbWJlci5FWFRFTkRfUFJPVE9UWVBFUy5TdHJpbmcpIHsKCiAgLyoqCiAg
ICBNYXJrIGEgc3RyaW5nIGFzIGJlaW5nIHNhZmUgZm9yIHVuZXNjYXBlZCBvdXRwdXQgd2l0aCBI
YW5kbGViYXJzLgoKICAgIGBgYGphdmFzY3JpcHQKICAgICc8ZGl2PnNvbWVTdHJpbmc8L2Rpdj4n
Lmh0bWxTYWZlKCkKICAgIGBgYAoKICAgIFNlZSBbRW1iZXIuU3RyaW5nLmh0bWxTYWZlXSgvYXBp
L2NsYXNzZXMvRW1iZXIuU3RyaW5nLmh0bWwjbWV0aG9kX2h0bWxTYWZlKS4KCiAgICBAbWV0aG9k
IGh0bWxTYWZlCiAgICBAZm9yIFN0cmluZwogICAgQHJldHVybiB7SGFuZGxlYmFycy5TYWZlU3Ry
aW5nfSBhIHN0cmluZyB0aGF0IHdpbGwgbm90IGJlIGh0bWwgZXNjYXBlZCBieSBIYW5kbGViYXJz
CiAgKi8KICBTdHJpbmcucHJvdG90eXBlLmh0bWxTYWZlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1
cm4gaHRtbFNhZmUodGhpcyk7CiAgfTsKfQoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewpFbWJlci5I
YW5kbGViYXJzLnJlc29sdmVQYXRocyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICB2YXIgcmV0ID0g
W10sCiAgICAgIGNvbnRleHRzID0gb3B0aW9ucy5jb250ZXh0cywKICAgICAgcm9vdHMgPSBvcHRp
b25zLnJvb3RzLAogICAgICBkYXRhID0gb3B0aW9ucy5kYXRhOwoKICBmb3IgKHZhciBpPTAsIGw9
Y29udGV4dHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgcmV0LnB1c2goIEVtYmVyLkhhbmRsZWJh
cnMuZ2V0KHJvb3RzW2ldLCBjb250ZXh0c1tpXSwgeyBkYXRhOiBkYXRhIH0pICk7CiAgfQoKICBy
ZXR1cm4gcmV0Owp9OwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKmpzaGludCBuZXdjYXA6ZmFs
c2UqLwovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRsZWJhcnMKKi8KCnZh
ciBzZXQgPSBFbWJlci5zZXQsIGdldCA9IEVtYmVyLmdldDsKdmFyIE1ldGFtb3JwaCA9IHJlcXVp
cmVNb2R1bGUoJ21ldGFtb3JwaCcpOwoKZnVuY3Rpb24gbm90aWZ5TXV0YXRpb25MaXN0ZW5lcnMo
KSB7CiAgRW1iZXIucnVuLm9uY2UoRW1iZXIuVmlldywgJ25vdGlmeU11dGF0aW9uTGlzdGVuZXJz
Jyk7Cn0KCi8vIERPTU1hbmFnZXIgc2hvdWxkIGp1c3QgYWJzdHJhY3QgZG9tIG1hbmlwdWxhdGlv
biBiZXR3ZWVuIGpxdWVyeSBhbmQgbWV0YW1vcnBoCnZhciBET01NYW5hZ2VyID0gewogIHJlbW92
ZTogZnVuY3Rpb24odmlldykgewogICAgdmlldy5tb3JwaC5yZW1vdmUoKTsKICAgIG5vdGlmeU11
dGF0aW9uTGlzdGVuZXJzKCk7CiAgfSwKCiAgcHJlcGVuZDogZnVuY3Rpb24odmlldywgaHRtbCkg
ewogICAgdmlldy5tb3JwaC5wcmVwZW5kKGh0bWwpOwogICAgbm90aWZ5TXV0YXRpb25MaXN0ZW5l
cnMoKTsKICB9LAoKICBhZnRlcjogZnVuY3Rpb24odmlldywgaHRtbCkgewogICAgdmlldy5tb3Jw
aC5hZnRlcihodG1sKTsKICAgIG5vdGlmeU11dGF0aW9uTGlzdGVuZXJzKCk7CiAgfSwKCiAgaHRt
bDogZnVuY3Rpb24odmlldywgaHRtbCkgewogICAgdmlldy5tb3JwaC5odG1sKGh0bWwpOwogICAg
bm90aWZ5TXV0YXRpb25MaXN0ZW5lcnMoKTsKICB9LAoKICAvLyBUaGlzIGlzIG1lc3NlZCB1cC4K
ICByZXBsYWNlOiBmdW5jdGlvbih2aWV3KSB7CiAgICB2YXIgbW9ycGggPSB2aWV3Lm1vcnBoOwoK
ICAgIHZpZXcudHJhbnNpdGlvblRvKCdwcmVSZW5kZXInKTsKCiAgICBFbWJlci5ydW4uc2NoZWR1
bGUoJ3JlbmRlcicsIHRoaXMsIGZ1bmN0aW9uIHJlbmRlck1ldGFtb3JwaFZpZXcoKSB7CiAgICAg
IGlmICh2aWV3LmlzRGVzdHJveWluZykgeyByZXR1cm47IH0KCiAgICAgIHZpZXcuY2xlYXJSZW5k
ZXJlZENoaWxkcmVuKCk7CiAgICAgIHZhciBidWZmZXIgPSB2aWV3LnJlbmRlclRvQnVmZmVyKCk7
CgogICAgICB2aWV3Lmludm9rZVJlY3Vyc2l2ZWx5KGZ1bmN0aW9uKHZpZXcpIHsKICAgICAgICB2
aWV3LnByb3BlcnR5V2lsbENoYW5nZSgnZWxlbWVudCcpOwogICAgICB9KTsKICAgICAgdmlldy50
cmlnZ2VyUmVjdXJzaXZlbHkoJ3dpbGxJbnNlcnRFbGVtZW50Jyk7CgogICAgICBtb3JwaC5yZXBs
YWNlV2l0aChidWZmZXIuc3RyaW5nKCkpOwogICAgICB2aWV3LnRyYW5zaXRpb25UbygnaW5ET00n
KTsKCiAgICAgIHZpZXcuaW52b2tlUmVjdXJzaXZlbHkoZnVuY3Rpb24odmlldykgewogICAgICAg
IHZpZXcucHJvcGVydHlEaWRDaGFuZ2UoJ2VsZW1lbnQnKTsKICAgICAgfSk7CiAgICAgIHZpZXcu
dHJpZ2dlclJlY3Vyc2l2ZWx5KCdkaWRJbnNlcnRFbGVtZW50Jyk7CgogICAgICBub3RpZnlNdXRh
dGlvbkxpc3RlbmVycygpOwogICAgfSk7CiAgfSwKCiAgZW1wdHk6IGZ1bmN0aW9uKHZpZXcpIHsK
ICAgIHZpZXcubW9ycGguaHRtbCgiIik7CiAgICBub3RpZnlNdXRhdGlvbkxpc3RlbmVycygpOwog
IH0KfTsKCi8vIFRoZSBgbW9ycGhgIGFuZCBgb3V0ZXJIVE1MYCBwcm9wZXJ0aWVzIGFyZSBpbnRl
cm5hbCBvbmx5Ci8vIGFuZCBub3Qgb2JzZXJ2YWJsZS4KCi8qKgogIEBjbGFzcyBfTWV0YW1vcnBo
CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBwcml2YXRlCiovCkVtYmVyLl9NZXRhbW9ycGggPSBFbWJl
ci5NaXhpbi5jcmVhdGUoewogIGlzVmlydHVhbDogdHJ1ZSwKICB0YWdOYW1lOiAnJywKCiAgaW5z
dHJ1bWVudE5hbWU6ICdtZXRhbW9ycGgnLAoKICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMu
X3N1cGVyKCk7CiAgICB0aGlzLm1vcnBoID0gTWV0YW1vcnBoKCk7CiAgICBFbWJlci5kZXByZWNh
dGUoJ1N1cHBseWluZyBhIHRhZ05hbWUgdG8gTWV0YW1vcnBoIHZpZXdzIGlzIHVucmVsaWFibGUg
YW5kIGlzIGRlcHJlY2F0ZWQuIFlvdSBtYXkgYmUgc2V0dGluZyB0aGUgdGFnTmFtZSBvbiBhIEhh
bmRsZWJhcnMgaGVscGVyIHRoYXQgY3JlYXRlcyBhIE1ldGFtb3JwaC4nLCAhdGhpcy50YWdOYW1l
KTsKICB9LAoKICBiZWZvcmVSZW5kZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgYnVmZmVyLnB1
c2godGhpcy5tb3JwaC5zdGFydFRhZygpKTsKICAgIGJ1ZmZlci5wdXNoT3BlbmluZ1RhZygpOwog
IH0sCgogIGFmdGVyUmVuZGVyOiBmdW5jdGlvbihidWZmZXIpIHsKICAgIGJ1ZmZlci5wdXNoQ2xv
c2luZ1RhZygpOwogICAgYnVmZmVyLnB1c2godGhpcy5tb3JwaC5lbmRUYWcoKSk7CiAgfSwKCiAg
Y3JlYXRlRWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICB2YXIgYnVmZmVyID0gdGhpcy5yZW5kZXJU
b0J1ZmZlcigpOwogICAgdGhpcy5vdXRlckhUTUwgPSBidWZmZXIuc3RyaW5nKCk7CiAgICB0aGlz
LmNsZWFyQnVmZmVyKCk7CiAgfSwKCiAgZG9tTWFuYWdlcjogRE9NTWFuYWdlcgp9KTsKCi8qKgog
IEBjbGFzcyBfTWV0YW1vcnBoVmlldwogIEBuYW1lc3BhY2UgRW1iZXIKICBAZXh0ZW5kcyBFbWJl
ci5WaWV3CiAgQHVzZXMgRW1iZXIuX01ldGFtb3JwaAogIEBwcml2YXRlCiovCkVtYmVyLl9NZXRh
bW9ycGhWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoRW1iZXIuX01ldGFtb3JwaCk7CgovKioKICBA
Y2xhc3MgX1NpbXBsZU1ldGFtb3JwaFZpZXcKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMg
RW1iZXIuQ29yZVZpZXcKICBAdXNlcyBFbWJlci5fTWV0YW1vcnBoCiAgQHByaXZhdGUKKi8KRW1i
ZXIuX1NpbXBsZU1ldGFtb3JwaFZpZXcgPSBFbWJlci5Db3JlVmlldy5leHRlbmQoRW1iZXIuX01l
dGFtb3JwaCk7CgoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKmdsb2JhbHMgSGFuZGxlYmFycyAq
LwovKmpzaGludCBuZXdjYXA6ZmFsc2UqLwovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVt
YmVyLWhhbmRsZWJhcnMKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldCwg
aGFuZGxlYmFyc0dldCA9IEVtYmVyLkhhbmRsZWJhcnMuZ2V0Owp2YXIgTWV0YW1vcnBoID0gcmVx
dWlyZU1vZHVsZSgnbWV0YW1vcnBoJyk7CmZ1bmN0aW9uIFNpbXBsZUhhbmRsZWJhcnNWaWV3KHBh
dGgsIHBhdGhSb290LCBpc0VzY2FwZWQsIHRlbXBsYXRlRGF0YSkgewogIHRoaXMucGF0aCA9IHBh
dGg7CiAgdGhpcy5wYXRoUm9vdCA9IHBhdGhSb290OwogIHRoaXMuaXNFc2NhcGVkID0gaXNFc2Nh
cGVkOwogIHRoaXMudGVtcGxhdGVEYXRhID0gdGVtcGxhdGVEYXRhOwoKICB0aGlzLm1vcnBoID0g
TWV0YW1vcnBoKCk7CiAgdGhpcy5zdGF0ZSA9ICdwcmVSZW5kZXInOwogIHRoaXMudXBkYXRlSWQg
PSBudWxsOwogIHRoaXMuX3BhcmVudFZpZXcgPSBudWxsOwogIHRoaXMuYnVmZmVyID0gbnVsbDsK
fQoKRW1iZXIuX1NpbXBsZUhhbmRsZWJhcnNWaWV3ID0gU2ltcGxlSGFuZGxlYmFyc1ZpZXc7CgpT
aW1wbGVIYW5kbGViYXJzVmlldy5wcm90b3R5cGUgPSB7CiAgaXNWaXJ0dWFsOiB0cnVlLAogIGlz
VmlldzogdHJ1ZSwKCiAgZGVzdHJveTogZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMudXBkYXRl
SWQpIHsKICAgICAgRW1iZXIucnVuLmNhbmNlbCh0aGlzLnVwZGF0ZUlkKTsKICAgICAgdGhpcy51
cGRhdGVJZCA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5fcGFyZW50VmlldykgewogICAgICB0
aGlzLl9wYXJlbnRWaWV3LnJlbW92ZUNoaWxkKHRoaXMpOwogICAgfQogICAgdGhpcy5tb3JwaCA9
IG51bGw7CiAgICB0aGlzLnN0YXRlID0gJ2Rlc3Ryb3llZCc7CiAgfSwKCiAgcHJvcGVydHlXaWxs
Q2hhbmdlOiBFbWJlci5LLAoKICBwcm9wZXJ0eURpZENoYW5nZTogRW1iZXIuSywKCiAgbm9ybWFs
aXplZFZhbHVlOiBmdW5jdGlvbigpIHsKICAgIHZhciBwYXRoID0gdGhpcy5wYXRoLAogICAgICAg
IHBhdGhSb290ID0gdGhpcy5wYXRoUm9vdCwKICAgICAgICByZXN1bHQsIHRlbXBsYXRlRGF0YTsK
CiAgICAvLyBVc2UgdGhlIHBhdGhSb290IGFzIHRoZSByZXN1bHQgaWYgbm8gcGF0aCBpcyBwcm92
aWRlZC4gVGhpcwogICAgLy8gaGFwcGVucyBpZiB0aGUgcGF0aCBpcyBgdGhpc2AsIHdoaWNoIGdl
dHMgbm9ybWFsaXplZCBpbnRvCiAgICAvLyBhIGBwYXRoUm9vdGAgb2YgdGhlIGN1cnJlbnQgSGFu
ZGxlYmFycyBjb250ZXh0IGFuZCBhIHBhdGgKICAgIC8vIG9mIGAnJ2AuCiAgICBpZiAocGF0aCA9
PT0gJycpIHsKICAgICAgcmVzdWx0ID0gcGF0aFJvb3Q7CiAgICB9IGVsc2UgewogICAgICB0ZW1w
bGF0ZURhdGEgPSB0aGlzLnRlbXBsYXRlRGF0YTsKICAgICAgcmVzdWx0ID0gaGFuZGxlYmFyc0dl
dChwYXRoUm9vdCwgcGF0aCwgeyBkYXRhOiB0ZW1wbGF0ZURhdGEgfSk7CiAgICB9CgogICAgcmV0
dXJuIHJlc3VsdDsKICB9LAoKICByZW5kZXJUb0J1ZmZlcjogZnVuY3Rpb24oYnVmZmVyKSB7CiAg
ICB2YXIgc3RyaW5nID0gJyc7CgogICAgc3RyaW5nICs9IHRoaXMubW9ycGguc3RhcnRUYWcoKTsK
ICAgIHN0cmluZyArPSB0aGlzLnJlbmRlcigpOwogICAgc3RyaW5nICs9IHRoaXMubW9ycGguZW5k
VGFnKCk7CgogICAgYnVmZmVyLnB1c2goc3RyaW5nKTsKICB9LAoKICByZW5kZXI6IGZ1bmN0aW9u
KCkgewogICAgLy8gSWYgbm90IGludm9rZWQgdmlhIGEgdHJpcGxlLW11c3RhY2hlICh7e3tmb299
fX0pLCBlc2NhcGUKICAgIC8vIHRoZSBjb250ZW50IG9mIHRoZSB0ZW1wbGF0ZS4KICAgIHZhciBl
c2NhcGUgPSB0aGlzLmlzRXNjYXBlZDsKICAgIHZhciByZXN1bHQgPSB0aGlzLm5vcm1hbGl6ZWRW
YWx1ZSgpOwoKICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgcmVzdWx0ID09PSB1bmRlZmluZWQp
IHsKICAgICAgcmVzdWx0ID0gIiI7CiAgICB9IGVsc2UgaWYgKCEocmVzdWx0IGluc3RhbmNlb2Yg
SGFuZGxlYmFycy5TYWZlU3RyaW5nKSkgewogICAgICByZXN1bHQgPSBTdHJpbmcocmVzdWx0KTsK
ICAgIH0KCiAgICBpZiAoZXNjYXBlKSB7IHJlc3VsdCA9IEhhbmRsZWJhcnMuVXRpbHMuZXNjYXBl
RXhwcmVzc2lvbihyZXN1bHQpOyB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0sCgogIHJlcmVuZGVy
OiBmdW5jdGlvbigpIHsKICAgIHN3aXRjaCh0aGlzLnN0YXRlKSB7CiAgICAgIGNhc2UgJ3ByZVJl
bmRlcic6CiAgICAgIGNhc2UgJ2Rlc3Ryb3llZCc6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2Ug
J2luQnVmZmVyJzoKICAgICAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoIlNvbWV0aGluZyB5b3Ug
ZGlkIHRyaWVkIHRvIHJlcGxhY2UgYW4ge3tleHByZXNzaW9ufX0gYmVmb3JlIGl0IHdhcyBpbnNl
cnRlZCBpbnRvIHRoZSBET00uIik7CiAgICAgIGNhc2UgJ2hhc0VsZW1lbnQnOgogICAgICBjYXNl
ICdpbkRPTSc6CiAgICAgICAgdGhpcy51cGRhdGVJZCA9IEVtYmVyLnJ1bi5zY2hlZHVsZU9uY2Uo
J3JlbmRlcicsIHRoaXMsICd1cGRhdGUnKTsKICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1
cm4gdGhpczsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMudXBkYXRlSWQg
PSBudWxsOwogICAgdGhpcy5tb3JwaC5odG1sKHRoaXMucmVuZGVyKCkpOwogIH0sCgogIHRyYW5z
aXRpb25UbzogZnVuY3Rpb24oc3RhdGUpIHsKICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKICB9Cn07
Cgp2YXIgc3RhdGVzID0gRW1iZXIuVmlldy5jbG9uZVN0YXRlcyhFbWJlci5WaWV3LnN0YXRlcyks
IG1lcmdlID0gRW1iZXIubWVyZ2U7CgptZXJnZShzdGF0ZXMuX2RlZmF1bHQsIHsKICByZXJlbmRl
cklmTmVlZGVkOiBFbWJlci5LCn0pOwoKbWVyZ2Uoc3RhdGVzLmluRE9NLCB7CiAgcmVyZW5kZXJJ
Zk5lZWRlZDogZnVuY3Rpb24odmlldykgewogICAgaWYgKHZpZXcubm9ybWFsaXplZFZhbHVlKCkg
IT09IHZpZXcuX2xhc3ROb3JtYWxpemVkVmFsdWUpIHsKICAgICAgdmlldy5yZXJlbmRlcigpOwog
ICAgfQogIH0KfSk7CgovKioKICBgRW1iZXIuX0hhbmRsZWJhcnNCb3VuZFZpZXdgIGlzIGEgcHJp
dmF0ZSB2aWV3IGNyZWF0ZWQgYnkgdGhlIEhhbmRsZWJhcnMKICBge3tiaW5kfX1gIGhlbHBlcnMg
dGhhdCBpcyB1c2VkIHRvIGtlZXAgdHJhY2sgb2YgYm91bmQgcHJvcGVydGllcy4KCiAgRXZlcnkg
dGltZSBhIHByb3BlcnR5IGlzIGJvdW5kIHVzaW5nIGEgYHt7bXVzdGFjaGV9fWAsIGFuIGFub255
bW91cyBzdWJjbGFzcwogIG9mIGBFbWJlci5fSGFuZGxlYmFyc0JvdW5kVmlld2AgaXMgY3JlYXRl
ZCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBzdWItdGVtcGxhdGUKICBhbmQgY29udGV4dCBzZXQgdXAu
IFdoZW4gdGhlIGFzc29jaWF0ZWQgcHJvcGVydHkgY2hhbmdlcywganVzdCB0aGUgdGVtcGxhdGUK
ICBmb3IgdGhpcyB2aWV3IHdpbGwgcmUtcmVuZGVyLgoKICBAY2xhc3MgX0hhbmRsZWJhcnNCb3Vu
ZFZpZXcKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuX01ldGFtb3JwaFZpZXcK
ICBAcHJpdmF0ZQoqLwpFbWJlci5fSGFuZGxlYmFyc0JvdW5kVmlldyA9IEVtYmVyLl9NZXRhbW9y
cGhWaWV3LmV4dGVuZCh7CiAgaW5zdHJ1bWVudE5hbWU6ICdib3VuZEhhbmRsZWJhcnMnLAogIHN0
YXRlczogc3RhdGVzLAoKICAvKioKICAgIFRoZSBmdW5jdGlvbiB1c2VkIHRvIGRldGVybWluZSBp
ZiB0aGUgYGRpc3BsYXlUZW1wbGF0ZWAgb3IKICAgIGBpbnZlcnNlVGVtcGxhdGVgIHNob3VsZCBi
ZSByZW5kZXJlZC4gVGhpcyBzaG91bGQgYmUgYSBmdW5jdGlvbiB0aGF0IHRha2VzCiAgICBhIHZh
bHVlIGFuZCByZXR1cm5zIGEgQm9vbGVhbi4KCiAgICBAcHJvcGVydHkgc2hvdWxkRGlzcGxheUZ1
bmMKICAgIEB0eXBlIEZ1bmN0aW9uCiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBzaG91bGREaXNw
bGF5RnVuYzogbnVsbCwKCiAgLyoqCiAgICBXaGV0aGVyIHRoZSB0ZW1wbGF0ZSByZW5kZXJlZCBi
eSB0aGlzIHZpZXcgZ2V0cyBwYXNzZWQgdGhlIGNvbnRleHQgb2JqZWN0CiAgICBvZiBpdHMgcGFy
ZW50IHRlbXBsYXRlLCBvciBnZXRzIHBhc3NlZCB0aGUgdmFsdWUgb2YgcmV0cmlldmluZyBgcGF0
aGAKICAgIGZyb20gdGhlIGBwYXRoUm9vdGAuCgogICAgRm9yIGV4YW1wbGUsIHRoaXMgaXMgdHJ1
ZSB3aGVuIHVzaW5nIHRoZSBge3sjaWZ9fWAgaGVscGVyLCBiZWNhdXNlIHRoZQogICAgdGVtcGxh
dGUgaW5zaWRlIHRoZSBoZWxwZXIgc2hvdWxkIGxvb2sgdXAgcHJvcGVydGllcyByZWxhdGl2ZSB0
byB0aGUgc2FtZQogICAgb2JqZWN0IGFzIG91dHNpZGUgdGhlIGJsb2NrLiBUaGlzIHdvdWxkIGJl
IGBmYWxzZWAgd2hlbiB1c2VkIHdpdGggYHt7I3dpdGgKICAgIGZvb319YCBiZWNhdXNlIHRoZSB0
ZW1wbGF0ZSBzaG91bGQgcmVjZWl2ZSB0aGUgb2JqZWN0IGZvdW5kIGJ5IGV2YWx1YXRpbmcKICAg
IGBmb29gLgoKICAgIEBwcm9wZXJ0eSBwcmVzZXJ2ZUNvbnRleHQKICAgIEB0eXBlIEJvb2xlYW4K
ICAgIEBkZWZhdWx0IGZhbHNlCiAgKi8KICBwcmVzZXJ2ZUNvbnRleHQ6IGZhbHNlLAoKICAvKioK
ICAgIElmIGBwcmVzZXJ2ZUNvbnRleHRgIGlzIHRydWUsIHRoaXMgaXMgdGhlIG9iamVjdCB0aGF0
IHdpbGwgYmUgdXNlZAogICAgdG8gcmVuZGVyIHRoZSB0ZW1wbGF0ZS4KCiAgICBAcHJvcGVydHkg
cHJldmlvdXNDb250ZXh0CiAgICBAdHlwZSBPYmplY3QKICAqLwogIHByZXZpb3VzQ29udGV4dDog
bnVsbCwKCiAgLyoqCiAgICBUaGUgdGVtcGxhdGUgdG8gcmVuZGVyIHdoZW4gYHNob3VsZERpc3Bs
YXlGdW5jYCBldmFsdWF0ZXMgdG8gYHRydWVgLgoKICAgIEBwcm9wZXJ0eSBkaXNwbGF5VGVtcGxh
dGUKICAgIEB0eXBlIEZ1bmN0aW9uCiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBkaXNwbGF5VGVt
cGxhdGU6IG51bGwsCgogIC8qKgogICAgVGhlIHRlbXBsYXRlIHRvIHJlbmRlciB3aGVuIGBzaG91
bGREaXNwbGF5RnVuY2AgZXZhbHVhdGVzIHRvIGBmYWxzZWAuCgogICAgQHByb3BlcnR5IGludmVy
c2VUZW1wbGF0ZQogICAgQHR5cGUgRnVuY3Rpb24KICAgIEBkZWZhdWx0IG51bGwKICAqLwogIGlu
dmVyc2VUZW1wbGF0ZTogbnVsbCwKCgogIC8qKgogICAgVGhlIHBhdGggdG8gbG9vayB1cCBvbiBg
cGF0aFJvb3RgIHRoYXQgaXMgcGFzc2VkIHRvCiAgICBgc2hvdWxkRGlzcGxheUZ1bmNgIHRvIGRl
dGVybWluZSB3aGljaCB0ZW1wbGF0ZSB0byByZW5kZXIuCgogICAgSW4gYWRkaXRpb24sIGlmIGBw
cmVzZXJ2ZUNvbnRleHRgIGlzIGBmYWxzZSxgIHRoZSBvYmplY3QgYXQgdGhpcyBwYXRoIHdpbGwK
ICAgIGJlIHBhc3NlZCB0byB0aGUgdGVtcGxhdGUgd2hlbiByZW5kZXJpbmcuCgogICAgQHByb3Bl
cnR5IHBhdGgKICAgIEB0eXBlIFN0cmluZwogICAgQGRlZmF1bHQgbnVsbAogICovCiAgcGF0aDog
bnVsbCwKCiAgLyoqCiAgICBUaGUgb2JqZWN0IGZyb20gd2hpY2ggdGhlIGBwYXRoYCB3aWxsIGJl
IGxvb2tlZCB1cC4gU29tZXRpbWVzIHRoaXMgaXMgdGhlCiAgICBzYW1lIGFzIHRoZSBgcHJldmlv
dXNDb250ZXh0YCwgYnV0IGluIGNhc2VzIHdoZXJlIHRoaXMgdmlldyBoYXMgYmVlbgogICAgZ2Vu
ZXJhdGVkIGZvciBwYXRocyB0aGF0IHN0YXJ0IHdpdGggYSBrZXl3b3JkIHN1Y2ggYXMgYHZpZXdg
IG9yCiAgICBgY29udHJvbGxlcmAsIHRoZSBwYXRoIHJvb3Qgd2lsbCBiZSB0aGF0IHJlc29sdmVk
IG9iamVjdC4KCiAgICBAcHJvcGVydHkgcGF0aFJvb3QKICAgIEB0eXBlIE9iamVjdAogICovCiAg
cGF0aFJvb3Q6IG51bGwsCgogIG5vcm1hbGl6ZWRWYWx1ZTogZnVuY3Rpb24oKSB7CiAgICB2YXIg
cGF0aCA9IGdldCh0aGlzLCAncGF0aCcpLAogICAgICAgIHBhdGhSb290ICA9IGdldCh0aGlzLCAn
cGF0aFJvb3QnKSwKICAgICAgICB2YWx1ZU5vcm1hbGl6ZXIgPSBnZXQodGhpcywgJ3ZhbHVlTm9y
bWFsaXplckZ1bmMnKSwKICAgICAgICByZXN1bHQsIHRlbXBsYXRlRGF0YTsKCiAgICAvLyBVc2Ug
dGhlIHBhdGhSb290IGFzIHRoZSByZXN1bHQgaWYgbm8gcGF0aCBpcyBwcm92aWRlZC4gVGhpcwog
ICAgLy8gaGFwcGVucyBpZiB0aGUgcGF0aCBpcyBgdGhpc2AsIHdoaWNoIGdldHMgbm9ybWFsaXpl
ZCBpbnRvCiAgICAvLyBhIGBwYXRoUm9vdGAgb2YgdGhlIGN1cnJlbnQgSGFuZGxlYmFycyBjb250
ZXh0IGFuZCBhIHBhdGgKICAgIC8vIG9mIGAnJ2AuCiAgICBpZiAocGF0aCA9PT0gJycpIHsKICAg
ICAgcmVzdWx0ID0gcGF0aFJvb3Q7CiAgICB9IGVsc2UgewogICAgICB0ZW1wbGF0ZURhdGEgPSBn
ZXQodGhpcywgJ3RlbXBsYXRlRGF0YScpOwogICAgICByZXN1bHQgPSBoYW5kbGViYXJzR2V0KHBh
dGhSb290LCBwYXRoLCB7IGRhdGE6IHRlbXBsYXRlRGF0YSB9KTsKICAgIH0KCiAgICByZXR1cm4g
dmFsdWVOb3JtYWxpemVyID8gdmFsdWVOb3JtYWxpemVyKHJlc3VsdCkgOiByZXN1bHQ7CiAgfSwK
CiAgcmVyZW5kZXJJZk5lZWRlZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmN1cnJlbnRTdGF0ZS5y
ZXJlbmRlcklmTmVlZGVkKHRoaXMpOwogIH0sCgogIC8qKgogICAgRGV0ZXJtaW5lcyB3aGljaCB0
ZW1wbGF0ZSB0byBpbnZva2UsIHNldHMgdXAgdGhlIGNvcnJlY3Qgc3RhdGUgYmFzZWQgb24KICAg
IHRoYXQgbG9naWMsIHRoZW4gaW52b2tlcyB0aGUgZGVmYXVsdCBgRW1iZXIuVmlld2AgYHJlbmRl
cmAgaW1wbGVtZW50YXRpb24uCgogICAgVGhpcyBtZXRob2Qgd2lsbCBmaXJzdCBsb29rIHVwIHRo
ZSBgcGF0aGAga2V5IG9uIGBwYXRoUm9vdGAsCiAgICB0aGVuIHBhc3MgdGhhdCB2YWx1ZSB0byB0
aGUgYHNob3VsZERpc3BsYXlGdW5jYCBmdW5jdGlvbi4gSWYgdGhhdCByZXR1cm5zCiAgICBgdHJ1
ZSxgIHRoZSBgZGlzcGxheVRlbXBsYXRlYCBmdW5jdGlvbiB3aWxsIGJlIHJlbmRlcmVkIHRvIERP
TS4gT3RoZXJ3aXNlLAogICAgYGludmVyc2VUZW1wbGF0ZWAsIGlmIHNwZWNpZmllZCwgd2lsbCBi
ZSByZW5kZXJlZC4KCiAgICBGb3IgZXhhbXBsZSwgaWYgdGhpcyBgRW1iZXIuX0hhbmRsZWJhcnNC
b3VuZFZpZXdgIHJlcHJlc2VudGVkIHRoZSBge3sjd2l0aAogICAgZm9vfX1gIGhlbHBlciwgaXQg
d291bGQgbG9vayB1cCB0aGUgYGZvb2AgcHJvcGVydHkgb2YgaXRzIGNvbnRleHQsIGFuZAogICAg
YHNob3VsZERpc3BsYXlGdW5jYCB3b3VsZCBhbHdheXMgcmV0dXJuIHRydWUuIFRoZSBvYmplY3Qg
Zm91bmQgYnkgbG9va2luZwogICAgdXAgYGZvb2Agd291bGQgYmUgcGFzc2VkIHRvIGBkaXNwbGF5
VGVtcGxhdGVgLgoKICAgIEBtZXRob2QgcmVuZGVyCiAgICBAcGFyYW0ge0VtYmVyLlJlbmRlckJ1
ZmZlcn0gYnVmZmVyCiAgKi8KICByZW5kZXI6IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgLy8gSWYg
bm90IGludm9rZWQgdmlhIGEgdHJpcGxlLW11c3RhY2hlICh7e3tmb299fX0pLCBlc2NhcGUKICAg
IC8vIHRoZSBjb250ZW50IG9mIHRoZSB0ZW1wbGF0ZS4KICAgIHZhciBlc2NhcGUgPSBnZXQodGhp
cywgJ2lzRXNjYXBlZCcpOwoKICAgIHZhciBzaG91bGREaXNwbGF5ID0gZ2V0KHRoaXMsICdzaG91
bGREaXNwbGF5RnVuYycpLAogICAgICAgIHByZXNlcnZlQ29udGV4dCA9IGdldCh0aGlzLCAncHJl
c2VydmVDb250ZXh0JyksCiAgICAgICAgY29udGV4dCA9IGdldCh0aGlzLCAncHJldmlvdXNDb250
ZXh0Jyk7CgogICAgdmFyIGludmVyc2VUZW1wbGF0ZSA9IGdldCh0aGlzLCAnaW52ZXJzZVRlbXBs
YXRlJyksCiAgICAgICAgZGlzcGxheVRlbXBsYXRlID0gZ2V0KHRoaXMsICdkaXNwbGF5VGVtcGxh
dGUnKTsKCiAgICB2YXIgcmVzdWx0ID0gdGhpcy5ub3JtYWxpemVkVmFsdWUoKTsKICAgIHRoaXMu
X2xhc3ROb3JtYWxpemVkVmFsdWUgPSByZXN1bHQ7CgogICAgLy8gRmlyc3QsIHRlc3QgdGhlIGNv
bmRpdGlvbmFsIHRvIHNlZSBpZiB3ZSBzaG91bGQKICAgIC8vIHJlbmRlciB0aGUgdGVtcGxhdGUg
b3Igbm90LgogICAgaWYgKHNob3VsZERpc3BsYXkocmVzdWx0KSkgewogICAgICBzZXQodGhpcywg
J3RlbXBsYXRlJywgZGlzcGxheVRlbXBsYXRlKTsKCiAgICAgIC8vIElmIHdlIGFyZSBwcmVzZXJ2
aW5nIHRoZSBjb250ZXh0IChmb3IgZXhhbXBsZSwgaWYgdGhpcwogICAgICAvLyBpcyBhbiAjaWYg
YmxvY2ssIGNhbGwgdGhlIHRlbXBsYXRlIHdpdGggdGhlIHNhbWUgb2JqZWN0LgogICAgICBpZiAo
cHJlc2VydmVDb250ZXh0KSB7CiAgICAgICAgc2V0KHRoaXMsICdfY29udGV4dCcsIGNvbnRleHQp
OwogICAgICB9IGVsc2UgewogICAgICAvLyBPdGhlcndpc2UsIGRldGVybWluZSBpZiB0aGlzIGlz
IGEgYmxvY2sgYmluZCBvciBub3QuCiAgICAgIC8vIElmIHNvLCBwYXNzIHRoZSBzcGVjaWZpZWQg
b2JqZWN0IHRvIHRoZSB0ZW1wbGF0ZQogICAgICAgIGlmIChkaXNwbGF5VGVtcGxhdGUpIHsKICAg
ICAgICAgIHNldCh0aGlzLCAnX2NvbnRleHQnLCByZXN1bHQpOwogICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgLy8gVGhpcyBpcyBub3QgYSBiaW5kIGJsb2NrLCBqdXN0IHB1c2ggdGhlIHJlc3VsdCBv
ZiB0aGUKICAgICAgICAvLyBleHByZXNzaW9uIHRvIHRoZSByZW5kZXIgY29udGV4dCBhbmQgcmV0
dXJuLgogICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5l
ZCkgewogICAgICAgICAgICByZXN1bHQgPSAiIjsKICAgICAgICAgIH0gZWxzZSBpZiAoIShyZXN1
bHQgaW5zdGFuY2VvZiBIYW5kbGViYXJzLlNhZmVTdHJpbmcpKSB7CiAgICAgICAgICAgIHJlc3Vs
dCA9IFN0cmluZyhyZXN1bHQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlc2NhcGUpIHsg
cmVzdWx0ID0gSGFuZGxlYmFycy5VdGlscy5lc2NhcGVFeHByZXNzaW9uKHJlc3VsdCk7IH0KICAg
ICAgICAgIGJ1ZmZlci5wdXNoKHJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog
ICAgICB9CiAgICB9IGVsc2UgaWYgKGludmVyc2VUZW1wbGF0ZSkgewogICAgICBzZXQodGhpcywg
J3RlbXBsYXRlJywgaW52ZXJzZVRlbXBsYXRlKTsKCiAgICAgIGlmIChwcmVzZXJ2ZUNvbnRleHQp
IHsKICAgICAgICBzZXQodGhpcywgJ19jb250ZXh0JywgY29udGV4dCk7CiAgICAgIH0gZWxzZSB7
CiAgICAgICAgc2V0KHRoaXMsICdfY29udGV4dCcsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0gZWxz
ZSB7CiAgICAgIHNldCh0aGlzLCAndGVtcGxhdGUnLCBmdW5jdGlvbigpIHsgcmV0dXJuICcnOyB9
KTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fc3VwZXIoYnVmZmVyKTsKICB9Cn0pOwoKfSkoKTsK
CgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRs
ZWJhcnMKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldCwgZm10ID0gRW1i
ZXIuU3RyaW5nLmZtdDsKdmFyIGhhbmRsZWJhcnNHZXQgPSBFbWJlci5IYW5kbGViYXJzLmdldCwg
bm9ybWFsaXplUGF0aCA9IEVtYmVyLkhhbmRsZWJhcnMubm9ybWFsaXplUGF0aDsKdmFyIGZvckVh
Y2ggPSBFbWJlci5BcnJheVBvbHlmaWxscy5mb3JFYWNoOwp2YXIgb19jcmVhdGUgPSBFbWJlci5j
cmVhdGU7Cgp2YXIgRW1iZXJIYW5kbGViYXJzID0gRW1iZXIuSGFuZGxlYmFycywgaGVscGVycyA9
IEVtYmVySGFuZGxlYmFycy5oZWxwZXJzOwoKZnVuY3Rpb24gZXhpc3RzKHZhbHVlKSB7CiAgcmV0
dXJuICFFbWJlci5pc05vbmUodmFsdWUpOwp9CgpmdW5jdGlvbiBzYW5pdGl6ZWRIYW5kbGViYXJz
R2V0KGN1cnJlbnRDb250ZXh0LCBwcm9wZXJ0eSwgb3B0aW9ucykgewogIHZhciByZXN1bHQgPSBo
YW5kbGViYXJzR2V0KGN1cnJlbnRDb250ZXh0LCBwcm9wZXJ0eSwgb3B0aW9ucyk7CiAgaWYgKHJl
c3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5lZCkgewogICAgcmVzdWx0ID0gIiI7
CiAgfSBlbHNlIGlmICghKHJlc3VsdCBpbnN0YW5jZW9mIEhhbmRsZWJhcnMuU2FmZVN0cmluZykp
IHsKICAgIHJlc3VsdCA9IFN0cmluZyhyZXN1bHQpOwogIH0KICBpZiAoIW9wdGlvbnMuaGFzaC51
bmVzY2FwZWQpewogICAgcmVzdWx0ID0gSGFuZGxlYmFycy5VdGlscy5lc2NhcGVFeHByZXNzaW9u
KHJlc3VsdCk7CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9CgovLyBCaW5kcyBhIHByb3BlcnR5IGlu
dG8gdGhlIERPTS4gVGhpcyB3aWxsIGNyZWF0ZSBhIGhvb2sgaW4gRE9NIHRoYXQgdGhlCi8vIEtW
TyBzeXN0ZW0gd2lsbCBsb29rIGZvciBhbmQgdXBkYXRlIGlmIHRoZSBwcm9wZXJ0eSBjaGFuZ2Vz
LgpmdW5jdGlvbiBiaW5kKHByb3BlcnR5LCBvcHRpb25zLCBwcmVzZXJ2ZUNvbnRleHQsIHNob3Vs
ZERpc3BsYXksIHZhbHVlTm9ybWFsaXplciwgY2hpbGRQcm9wZXJ0aWVzKSB7CiAgdmFyIGRhdGEg
PSBvcHRpb25zLmRhdGEsCiAgICAgIGZuID0gb3B0aW9ucy5mbiwKICAgICAgaW52ZXJzZSA9IG9w
dGlvbnMuaW52ZXJzZSwKICAgICAgdmlldyA9IGRhdGEudmlldywKICAgICAgY3VycmVudENvbnRl
eHQgPSB0aGlzLAogICAgICBub3JtYWxpemVkLCBvYnNlcnZlciwgaTsKCiAgbm9ybWFsaXplZCA9
IG5vcm1hbGl6ZVBhdGgoY3VycmVudENvbnRleHQsIHByb3BlcnR5LCBkYXRhKTsKCiAgLy8gU2V0
IHVwIG9ic2VydmVycyBmb3Igb2JzZXJ2YWJsZSBvYmplY3RzCiAgaWYgKCdvYmplY3QnID09PSB0
eXBlb2YgdGhpcykgewogICAgaWYgKGRhdGEuaW5zaWRlR3JvdXApIHsKICAgICAgb2JzZXJ2ZXIg
PSBmdW5jdGlvbigpIHsKICAgICAgICBFbWJlci5ydW4ub25jZSh2aWV3LCAncmVyZW5kZXInKTsK
ICAgICAgfTsKCiAgICAgIHZhciB0ZW1wbGF0ZSwgY29udGV4dCwgcmVzdWx0ID0gaGFuZGxlYmFy
c0dldChjdXJyZW50Q29udGV4dCwgcHJvcGVydHksIG9wdGlvbnMpOwoKICAgICAgcmVzdWx0ID0g
dmFsdWVOb3JtYWxpemVyID8gdmFsdWVOb3JtYWxpemVyKHJlc3VsdCkgOiByZXN1bHQ7CgogICAg
ICBjb250ZXh0ID0gcHJlc2VydmVDb250ZXh0ID8gY3VycmVudENvbnRleHQgOiByZXN1bHQ7CiAg
ICAgIGlmIChzaG91bGREaXNwbGF5KHJlc3VsdCkpIHsKICAgICAgICB0ZW1wbGF0ZSA9IGZuOwog
ICAgICB9IGVsc2UgaWYgKGludmVyc2UpIHsKICAgICAgICB0ZW1wbGF0ZSA9IGludmVyc2U7CiAg
ICAgIH0KCiAgICAgIHRlbXBsYXRlKGNvbnRleHQsIHsgZGF0YTogb3B0aW9ucy5kYXRhIH0pOwog
ICAgfSBlbHNlIHsKICAgICAgLy8gQ3JlYXRlIHRoZSB2aWV3IHRoYXQgd2lsbCB3cmFwIHRoZSBv
dXRwdXQgb2YgdGhpcyB0ZW1wbGF0ZS9wcm9wZXJ0eQogICAgICAvLyBhbmQgYWRkIGl0IHRvIHRo
ZSBuZWFyZXN0IHZpZXcncyBjaGlsZFZpZXdzIGFycmF5LgogICAgICAvLyBTZWUgdGhlIGRvY3Vt
ZW50YXRpb24gb2YgRW1iZXIuX0hhbmRsZWJhcnNCb3VuZFZpZXcgZm9yIG1vcmUuCiAgICAgIHZh
ciBiaW5kVmlldyA9IHZpZXcuY3JlYXRlQ2hpbGRWaWV3KEVtYmVyLl9IYW5kbGViYXJzQm91bmRW
aWV3LCB7CiAgICAgICAgcHJlc2VydmVDb250ZXh0OiBwcmVzZXJ2ZUNvbnRleHQsCiAgICAgICAg
c2hvdWxkRGlzcGxheUZ1bmM6IHNob3VsZERpc3BsYXksCiAgICAgICAgdmFsdWVOb3JtYWxpemVy
RnVuYzogdmFsdWVOb3JtYWxpemVyLAogICAgICAgIGRpc3BsYXlUZW1wbGF0ZTogZm4sCiAgICAg
ICAgaW52ZXJzZVRlbXBsYXRlOiBpbnZlcnNlLAogICAgICAgIHBhdGg6IHByb3BlcnR5LAogICAg
ICAgIHBhdGhSb290OiBjdXJyZW50Q29udGV4dCwKICAgICAgICBwcmV2aW91c0NvbnRleHQ6IGN1
cnJlbnRDb250ZXh0LAogICAgICAgIGlzRXNjYXBlZDogIW9wdGlvbnMuaGFzaC51bmVzY2FwZWQs
CiAgICAgICAgdGVtcGxhdGVEYXRhOiBvcHRpb25zLmRhdGEKICAgICAgfSk7CgogICAgICB2aWV3
LmFwcGVuZENoaWxkKGJpbmRWaWV3KTsKCiAgICAgIG9ic2VydmVyID0gZnVuY3Rpb24oKSB7CiAg
ICAgICAgRW1iZXIucnVuLnNjaGVkdWxlT25jZSgncmVuZGVyJywgYmluZFZpZXcsICdyZXJlbmRl
cklmTmVlZGVkJyk7CiAgICAgIH07CiAgICB9CgogICAgLy8gT2JzZXJ2ZXMgdGhlIGdpdmVuIHBy
b3BlcnR5IG9uIHRoZSBjb250ZXh0IGFuZAogICAgLy8gdGVsbHMgdGhlIEVtYmVyLl9IYW5kbGVi
YXJzQm91bmRWaWV3IHRvIHJlLXJlbmRlci4gSWYgcHJvcGVydHkKICAgIC8vIGlzIGFuIGVtcHR5
IHN0cmluZywgd2UgYXJlIHByaW50aW5nIHRoZSBjdXJyZW50IGNvbnRleHQKICAgIC8vIG9iamVj
dCAoe3t0aGlzfX0pIHNvIHVwZGF0aW5nIGl0IGlzIG5vdCBvdXIgcmVzcG9uc2liaWxpdHkuCiAg
ICBpZiAobm9ybWFsaXplZC5wYXRoICE9PSAnJykgewogICAgICB2aWV3LnJlZ2lzdGVyT2JzZXJ2
ZXIobm9ybWFsaXplZC5yb290LCBub3JtYWxpemVkLnBhdGgsIG9ic2VydmVyKTsKICAgICAgaWYg
KGNoaWxkUHJvcGVydGllcykgewogICAgICAgIGZvciAoaT0wOyBpPGNoaWxkUHJvcGVydGllcy5s
ZW5ndGg7IGkrKykgewogICAgICAgICAgdmlldy5yZWdpc3Rlck9ic2VydmVyKG5vcm1hbGl6ZWQu
cm9vdCwgbm9ybWFsaXplZC5wYXRoKycuJytjaGlsZFByb3BlcnRpZXNbaV0sIG9ic2VydmVyKTsK
ICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgLy8gVGhlIG9iamVjdCBpcyBu
b3Qgb2JzZXJ2YWJsZSwgc28ganVzdCByZW5kZXIgaXQgb3V0IGFuZAogICAgLy8gYmUgZG9uZSB3
aXRoIGl0LgogICAgZGF0YS5idWZmZXIucHVzaChoYW5kbGViYXJzR2V0KGN1cnJlbnRDb250ZXh0
LCBwcm9wZXJ0eSwgb3B0aW9ucykpOwogIH0KfQoKRW1iZXJIYW5kbGViYXJzLmJpbmQgPSBiaW5k
OwoKZnVuY3Rpb24gc2ltcGxlQmluZChjdXJyZW50Q29udGV4dCwgcHJvcGVydHksIG9wdGlvbnMp
IHsKICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YSwKICAgICAgdmlldyA9IGRhdGEudmlldywKICAg
ICAgbm9ybWFsaXplZCwgb2JzZXJ2ZXIsIHBhdGhSb290LCBvdXRwdXQ7CgogIG5vcm1hbGl6ZWQg
PSBub3JtYWxpemVQYXRoKGN1cnJlbnRDb250ZXh0LCBwcm9wZXJ0eSwgZGF0YSk7CiAgcGF0aFJv
b3QgPSBub3JtYWxpemVkLnJvb3Q7CgogIC8vIFNldCB1cCBvYnNlcnZlcnMgZm9yIG9ic2VydmFi
bGUgb2JqZWN0cwogIGlmIChwYXRoUm9vdCAmJiAoJ29iamVjdCcgPT09IHR5cGVvZiBwYXRoUm9v
dCkpIHsKICAgIGlmIChkYXRhLmluc2lkZUdyb3VwKSB7CiAgICAgIG9ic2VydmVyID0gZnVuY3Rp
b24oKSB7CiAgICAgICAgRW1iZXIucnVuLm9uY2UodmlldywgJ3JlcmVuZGVyJyk7CiAgICAgIH07
CgogICAgICBvdXRwdXQgPSBzYW5pdGl6ZWRIYW5kbGViYXJzR2V0KGN1cnJlbnRDb250ZXh0LCBw
cm9wZXJ0eSwgb3B0aW9ucyk7CgogICAgICBkYXRhLmJ1ZmZlci5wdXNoKG91dHB1dCk7CiAgICB9
IGVsc2UgewogICAgICB2YXIgYmluZFZpZXcgPSBuZXcgRW1iZXIuX1NpbXBsZUhhbmRsZWJhcnNW
aWV3KAogICAgICAgIHByb3BlcnR5LCBjdXJyZW50Q29udGV4dCwgIW9wdGlvbnMuaGFzaC51bmVz
Y2FwZWQsIG9wdGlvbnMuZGF0YQogICAgICApOwoKICAgICAgYmluZFZpZXcuX3BhcmVudFZpZXcg
PSB2aWV3OwogICAgICB2aWV3LmFwcGVuZENoaWxkKGJpbmRWaWV3KTsKCiAgICAgIG9ic2VydmVy
ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgRW1iZXIucnVuLnNjaGVkdWxlT25jZSgncmVuZGVyJywg
YmluZFZpZXcsICdyZXJlbmRlcicpOwogICAgICB9OwogICAgfQoKICAgIC8vIE9ic2VydmVzIHRo
ZSBnaXZlbiBwcm9wZXJ0eSBvbiB0aGUgY29udGV4dCBhbmQKICAgIC8vIHRlbGxzIHRoZSBFbWJl
ci5fSGFuZGxlYmFyc0JvdW5kVmlldyB0byByZS1yZW5kZXIuIElmIHByb3BlcnR5CiAgICAvLyBp
cyBhbiBlbXB0eSBzdHJpbmcsIHdlIGFyZSBwcmludGluZyB0aGUgY3VycmVudCBjb250ZXh0CiAg
ICAvLyBvYmplY3QgKHt7dGhpc319KSBzbyB1cGRhdGluZyBpdCBpcyBub3Qgb3VyIHJlc3BvbnNp
YmlsaXR5LgogICAgaWYgKG5vcm1hbGl6ZWQucGF0aCAhPT0gJycpIHsKICAgICAgdmlldy5yZWdp
c3Rlck9ic2VydmVyKG5vcm1hbGl6ZWQucm9vdCwgbm9ybWFsaXplZC5wYXRoLCBvYnNlcnZlcik7
CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIFRoZSBvYmplY3QgaXMgbm90IG9ic2VydmFibGUsIHNv
IGp1c3QgcmVuZGVyIGl0IG91dCBhbmQKICAgIC8vIGJlIGRvbmUgd2l0aCBpdC4KICAgIG91dHB1
dCA9IHNhbml0aXplZEhhbmRsZWJhcnNHZXQoY3VycmVudENvbnRleHQsIHByb3BlcnR5LCBvcHRp
b25zKTsKCiAgICBkYXRhLmJ1ZmZlci5wdXNoKG91dHB1dCk7CiAgfQp9CgovKioKICAnX3RyaWFn
ZU11c3RhY2hlJyBpcyB1c2VkIGludGVybmFsbHkgc2VsZWN0IGJldHdlZW4gYSBiaW5kaW5nLCBo
ZWxwZXIsIG9yIGNvbXBvbmVudCBmb3IKICB0aGUgZ2l2ZW4gY29udGV4dC4gVW50aWwgdGhpcyBw
b2ludCwgaXQgd291bGQgYmUgaGFyZCB0byBkZXRlcm1pbmUgaWYgdGhlCiAgbXVzdGFjaGUgaXMg
YSBwcm9wZXJ0eSByZWZlcmVuY2Ugb3IgYSByZWd1bGFyIGhlbHBlciByZWZlcmVuY2UuIFRoaXMg
dHJpYWdlCiAgaGVscGVyIHJlc29sdmVzIHRoYXQuCgogIFRoaXMgd291bGQgbm90IGJlIHR5cGlj
YWxseSBpbnZva2VkIGJ5IGRpcmVjdGx5LgoKICBAcHJpdmF0ZQogIEBtZXRob2QgX3RyaWFnZU11
c3RhY2hlCiAgQGZvciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0ge1N0cmluZ30g
cHJvcGVydHkgUHJvcGVydHkvaGVscGVySUQgdG8gdHJpYWdlCiAgQHBhcmFtIHtPYmplY3R9IG9w
dGlvbnMgaGFzaCBvZiB0ZW1wbGF0ZS9yZW5kZXJpbmcgb3B0aW9ucwogIEByZXR1cm4ge1N0cmlu
Z30gSFRNTCBzdHJpbmcKKi8KRW1iZXJIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdfdHJpYWdl
TXVzdGFjaGUnLCBmdW5jdGlvbihwcm9wZXJ0eSwgb3B0aW9ucykgewogIEVtYmVyLmFzc2VydCgi
WW91IGNhbm5vdCBwYXNzIG1vcmUgdGhhbiBvbmUgYXJndW1lbnQgdG8gdGhlIF90cmlhZ2VNdXN0
YWNoZSBoZWxwZXIiLCBhcmd1bWVudHMubGVuZ3RoIDw9IDIpOwoKICBpZiAoaGVscGVyc1twcm9w
ZXJ0eV0pIHsKICAgIHJldHVybiBoZWxwZXJzW3Byb3BlcnR5XS5jYWxsKHRoaXMsIG9wdGlvbnMp
OwogIH0KCiAgdmFyIGhlbHBlciA9IEVtYmVyLkhhbmRsZWJhcnMucmVzb2x2ZUhlbHBlcihvcHRp
b25zLmRhdGEudmlldy5jb250YWluZXIsIHByb3BlcnR5KTsKICBpZiAoaGVscGVyKSB7CiAgICBy
ZXR1cm4gaGVscGVyLmNhbGwodGhpcywgb3B0aW9ucyk7CiAgfQoKICByZXR1cm4gaGVscGVycy5i
aW5kLmNhbGwodGhpcywgcHJvcGVydHksIG9wdGlvbnMpOwp9KTsKCkVtYmVyLkhhbmRsZWJhcnMu
cmVzb2x2ZUhlbHBlciA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgbmFtZSkgewoKICBpZiAoIWNvbnRh
aW5lciB8fCBuYW1lLmluZGV4T2YoJy0nKSA9PT0gLTEpIHsKICAgIHJldHVybjsKICB9CgogIHZh
ciBoZWxwZXIgPSBjb250YWluZXIubG9va3VwKCdoZWxwZXI6JyArIG5hbWUpOwogIGlmICghaGVs
cGVyKSB7CiAgICB2YXIgY29tcG9uZW50TG9va3VwID0gY29udGFpbmVyLmxvb2t1cCgnY29tcG9u
ZW50LWxvb2t1cDptYWluJyk7CiAgICBFbWJlci5hc3NlcnQoIkNvdWxkIG5vdCBmaW5kICdjb21w
b25lbnQtbG9va3VwOm1haW4nIG9uIHRoZSBwcm92aWRlZCBjb250YWluZXIsIHdoaWNoIGlzIG5l
Y2Vzc2FyeSBmb3IgcGVyZm9ybWluZyBjb21wb25lbnQgbG9va3VwcyIsIGNvbXBvbmVudExvb2t1
cCk7CgogICAgdmFyIENvbXBvbmVudCA9IGNvbXBvbmVudExvb2t1cC5sb29rdXBGYWN0b3J5KG5h
bWUsIGNvbnRhaW5lcik7CiAgICBpZiAoQ29tcG9uZW50KSB7CiAgICAgIGhlbHBlciA9IEVtYmVy
SGFuZGxlYmFycy5tYWtlVmlld0hlbHBlcihDb21wb25lbnQpOwogICAgICBjb250YWluZXIucmVn
aXN0ZXIoJ2hlbHBlcjonICsgbmFtZSwgaGVscGVyKTsKICAgIH0KICB9CiAgcmV0dXJuIGhlbHBl
cjsKfTsKCi8qKgogIGBiaW5kYCBjYW4gYmUgdXNlZCB0byBkaXNwbGF5IGEgdmFsdWUsIHRoZW4g
dXBkYXRlIHRoYXQgdmFsdWUgaWYgaXQKICBjaGFuZ2VzLiBGb3IgZXhhbXBsZSwgaWYgeW91IHdh
bnRlZCB0byBwcmludCB0aGUgYHRpdGxlYCBwcm9wZXJ0eSBvZgogIGBjb250ZW50YDoKCiAgYGBg
aGFuZGxlYmFycwogIHt7YmluZCAiY29udGVudC50aXRsZSJ9fQogIGBgYAoKICBUaGlzIHdpbGwg
cmV0dXJuIHRoZSBgdGl0bGVgIHByb3BlcnR5IGFzIGEgc3RyaW5nLCB0aGVuIGNyZWF0ZSBhIG5l
dyBvYnNlcnZlcgogIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4gSWYgaXQgY2hhbmdlcywgaXQgd2ls
bCB1cGRhdGUgdGhlIHZhbHVlIGluIERPTS4gTm90ZQogIHRoYXQgaWYgeW91IG5lZWQgdG8gc3Vw
cG9ydCBJRTcgYW5kIElFOCB5b3UgbXVzdCBtb2RpZnkgdGhlIG1vZGVsIG9iamVjdHMKICBwcm9w
ZXJ0aWVzIHVzaW5nIGBFbWJlci5nZXQoKWAgYW5kIGBFbWJlci5zZXQoKWAgZm9yIHRoaXMgdG8g
d29yayBhcyBpdAogIHJlbGllcyBvbiBFbWJlcidzIEtWTyBzeXN0ZW0uIEZvciBhbGwgb3RoZXIg
YnJvd3NlcnMgdGhpcyB3aWxsIGJlIGhhbmRsZWQgZm9yCiAgeW91IGF1dG9tYXRpY2FsbHkuCgog
IEBwcml2YXRlCiAgQG1ldGhvZCBiaW5kCiAgQGZvciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMK
ICBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHkgUHJvcGVydHkgdG8gYmluZAogIEBwYXJhbSB7RnVu
Y3Rpb259IGZuIENvbnRleHQgdG8gcHJvdmlkZSBmb3IgcmVuZGVyaW5nCiAgQHJldHVybiB7U3Ry
aW5nfSBIVE1MIHN0cmluZwoqLwpFbWJlckhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2JpbmQn
LCBmdW5jdGlvbiBiaW5kSGVscGVyKHByb3BlcnR5LCBvcHRpb25zKSB7CiAgRW1iZXIuYXNzZXJ0
KCJZb3UgY2Fubm90IHBhc3MgbW9yZSB0aGFuIG9uZSBhcmd1bWVudCB0byB0aGUgYmluZCBoZWxw
ZXIiLCBhcmd1bWVudHMubGVuZ3RoIDw9IDIpOwoKICB2YXIgY29udGV4dCA9IChvcHRpb25zLmNv
bnRleHRzICYmIG9wdGlvbnMuY29udGV4dHMubGVuZ3RoKSA/IG9wdGlvbnMuY29udGV4dHNbMF0g
OiB0aGlzOwoKICBpZiAoIW9wdGlvbnMuZm4pIHsKICAgIHJldHVybiBzaW1wbGVCaW5kKGNvbnRl
eHQsIHByb3BlcnR5LCBvcHRpb25zKTsKICB9CgogIHJldHVybiBiaW5kLmNhbGwoY29udGV4dCwg
cHJvcGVydHksIG9wdGlvbnMsIGZhbHNlLCBleGlzdHMpOwp9KTsKCi8qKgogIFVzZSB0aGUgYGJv
dW5kSWZgIGhlbHBlciB0byBjcmVhdGUgYSBjb25kaXRpb25hbCB0aGF0IHJlLWV2YWx1YXRlcwog
IHdoZW5ldmVyIHRoZSB0cnV0aGluZXNzIG9mIHRoZSBib3VuZCB2YWx1ZSBjaGFuZ2VzLgoKICBg
YGBoYW5kbGViYXJzCiAge3sjYm91bmRJZiAiY29udGVudC5zaG91bGREaXNwbGF5VGl0bGUifX0K
ICAgIHt7Y29udGVudC50aXRsZX19CiAge3svYm91bmRJZn19CiAgYGBgCgogIEBwcml2YXRlCiAg
QG1ldGhvZCBib3VuZElmCiAgQGZvciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0g
e1N0cmluZ30gcHJvcGVydHkgUHJvcGVydHkgdG8gYmluZAogIEBwYXJhbSB7RnVuY3Rpb259IGZu
IENvbnRleHQgdG8gcHJvdmlkZSBmb3IgcmVuZGVyaW5nCiAgQHJldHVybiB7U3RyaW5nfSBIVE1M
IHN0cmluZwoqLwpFbWJlckhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2JvdW5kSWYnLCBmdW5j
dGlvbiBib3VuZElmSGVscGVyKHByb3BlcnR5LCBmbikgewogIHZhciBjb250ZXh0ID0gKGZuLmNv
bnRleHRzICYmIGZuLmNvbnRleHRzLmxlbmd0aCkgPyBmbi5jb250ZXh0c1swXSA6IHRoaXM7CiAg
dmFyIGZ1bmMgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgIHZhciB0cnV0aHkgPSByZXN1bHQgJiYg
Z2V0KHJlc3VsdCwgJ2lzVHJ1dGh5Jyk7CiAgICBpZiAodHlwZW9mIHRydXRoeSA9PT0gJ2Jvb2xl
YW4nKSB7IHJldHVybiB0cnV0aHk7IH0KCiAgICBpZiAoRW1iZXIuaXNBcnJheShyZXN1bHQpKSB7
CiAgICAgIHJldHVybiBnZXQocmVzdWx0LCAnbGVuZ3RoJykgIT09IDA7CiAgICB9IGVsc2Ugewog
ICAgICByZXR1cm4gISFyZXN1bHQ7CiAgICB9CiAgfTsKCiAgcmV0dXJuIGJpbmQuY2FsbChjb250
ZXh0LCBwcm9wZXJ0eSwgZm4sIHRydWUsIGZ1bmMsIGZ1bmMsIFsnaXNUcnV0aHknLCAnbGVuZ3Ro
J10pOwp9KTsKCi8qKgogIFVzZSB0aGUgYHt7d2l0aH19YCBoZWxwZXIgd2hlbiB5b3Ugd2FudCB0
byBzY29wZSBjb250ZXh0LiBUYWtlIHRoZSBmb2xsb3dpbmcgY29kZSBhcyBhbiBleGFtcGxlOgoK
ICBgYGBoYW5kbGViYXJzCiAgPGg1Pnt7dXNlci5uYW1lfX08L2g1PgoKICA8ZGl2IGNsYXNzPSJy
b2xlIj4KICAgIDxoNj57e3VzZXIucm9sZS5sYWJlbH19PC9oNj4KICAgIDxzcGFuIGNsYXNzPSJy
b2xlLWlkIj57e3VzZXIucm9sZS5pZH19PC9zcGFuPgoKICAgIDxwIGNsYXNzPSJyb2xlLWRlc2Mi
Pnt7dXNlci5yb2xlLmRlc2NyaXB0aW9ufX08L3A+CiAgPC9kaXY+CiAgYGBgCgogIGB7e3dpdGh9
fWAgY2FuIGJlIG91ciBiZXN0IGZyaWVuZCBpbiB0aGVzZSBjYXNlcywgCiAgaW5zdGVhZCBvZiB3
cml0aW5nIGB1c2VyLnJvbGUuKmAgb3ZlciBhbmQgb3Zlciwgd2UgdXNlIGB7eyN3aXRoIHVzZXIu
cm9sZX19YC4KICBOb3cgdGhlIGNvbnRleHQgd2l0aGluIHRoZSBge3sjd2l0aH19IC4uIHt7L3dp
dGh9fWAgYmxvY2sgaXMgYHVzZXIucm9sZWAgc28geW91IGNhbiBkbyB0aGUgZm9sbG93aW5nOgoK
ICBgYGBoYW5kbGViYXJzCiAgPGg1Pnt7dXNlci5uYW1lfX08L2g1PgoKICA8ZGl2IGNsYXNzPSJy
b2xlIj4KICAgIHt7I3dpdGggdXNlci5yb2xlfX0KICAgICAgPGg2Pnt7bGFiZWx9fTwvaDY+CiAg
ICAgIDxzcGFuIGNsYXNzPSJyb2xlLWlkIj57e2lkfX08L3NwYW4+CgogICAgICA8cCBjbGFzcz0i
cm9sZS1kZXNjIj57e2Rlc2NyaXB0aW9ufX08L3A+CiAgICB7ey93aXRofX0KICA8L2Rpdj4KICBg
YGAKCiAgIyMjIGBhc2Agb3BlcmF0b3IKCiAgVGhpcyBvcGVyYXRvciBhbGlhc2VzIHRoZSBzY29w
ZSB0byBhIG5ldyBuYW1lLiBJdCdzIGhlbHBmdWwgZm9yIHNlbWFudGljIGNsYXJpdHkgYW5kIHRv
IHJldGFpbiAKICBkZWZhdWx0IHNjb3BlIG9yIHRvIHJlZmVyZW5jZSBmcm9tIGFub3RoZXIgYHt7
d2l0aH19YCBibG9jay4KCiAgYGBgaGFuZGxlYmFycwogIC8vIHBvc3RzIG1pZ2h0IG5vdCBiZQog
IHt7I3dpdGggdXNlci5wb3N0cyBhcyBibG9nUG9zdHN9fQogICAgPGRpdiBjbGFzcz0ibm90aWNl
Ij4KICAgICAgVGhlcmUgYXJlIHt7YmxvZ1Bvc3RzLmxlbmd0aH19IGJsb2cgcG9zdHMgd3JpdHRl
biBieSB7e3VzZXIubmFtZX19LgogICAgPC9kaXY+CgogICAge3sjZWFjaCBwb3N0IGluIGJsb2dQ
b3N0c319CiAgICAgIDxsaT57e3Bvc3QudGl0bGV9fTwvbGk+CiAgICB7ey9lYWNofX0KICB7ey93
aXRofX0KICBgYGAKCiAgV2l0aG91dCB0aGUgYGFzYCBvcGVyYXRvciwgaXQgd291bGQgYmUgaW1w
b3NzaWJsZSB0byByZWZlcmVuY2UgYHVzZXIubmFtZWAgaW4gdGhlIGV4YW1wbGUgYWJvdmUuCgog
IEBtZXRob2Qgd2l0aAogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtG
dW5jdGlvbn0gY29udGV4dAogIEBwYXJhbSB7SGFzaH0gb3B0aW9ucwogIEByZXR1cm4ge1N0cmlu
Z30gSFRNTCBzdHJpbmcKKi8KRW1iZXJIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCd3aXRoJywg
ZnVuY3Rpb24gd2l0aEhlbHBlcihjb250ZXh0LCBvcHRpb25zKSB7CiAgaWYgKGFyZ3VtZW50cy5s
ZW5ndGggPT09IDQpIHsKICAgIHZhciBrZXl3b3JkTmFtZSwgcGF0aCwgcm9vdFBhdGgsIG5vcm1h
bGl6ZWQsIGNvbnRleHRQYXRoOwoKICAgIEVtYmVyLmFzc2VydCgiSWYgeW91IHBhc3MgbW9yZSB0
aGFuIG9uZSBhcmd1bWVudCB0byB0aGUgd2l0aCBoZWxwZXIsIGl0IG11c3QgYmUgaW4gdGhlIGZv
cm0gI3dpdGggZm9vIGFzIGJhciIsIGFyZ3VtZW50c1sxXSA9PT0gImFzIik7CiAgICBvcHRpb25z
ID0gYXJndW1lbnRzWzNdOwogICAga2V5d29yZE5hbWUgPSBhcmd1bWVudHNbMl07CiAgICBwYXRo
ID0gYXJndW1lbnRzWzBdOwoKICAgIEVtYmVyLmFzc2VydCgiWW91IG11c3QgcGFzcyBhIGJsb2Nr
IHRvIHRoZSB3aXRoIGhlbHBlciIsIG9wdGlvbnMuZm4gJiYgb3B0aW9ucy5mbiAhPT0gSGFuZGxl
YmFycy5WTS5ub29wKTsKCiAgICB2YXIgbG9jYWxpemVkT3B0aW9ucyA9IG9fY3JlYXRlKG9wdGlv
bnMpOwogICAgbG9jYWxpemVkT3B0aW9ucy5kYXRhID0gb19jcmVhdGUob3B0aW9ucy5kYXRhKTsK
ICAgIGxvY2FsaXplZE9wdGlvbnMuZGF0YS5rZXl3b3JkcyA9IG9fY3JlYXRlKG9wdGlvbnMuZGF0
YS5rZXl3b3JkcyB8fCB7fSk7CgogICAgaWYgKEVtYmVyLmlzR2xvYmFsUGF0aChwYXRoKSkgewog
ICAgICBjb250ZXh0UGF0aCA9IHBhdGg7CiAgICB9IGVsc2UgewogICAgICBub3JtYWxpemVkID0g
bm9ybWFsaXplUGF0aCh0aGlzLCBwYXRoLCBvcHRpb25zLmRhdGEpOwogICAgICBwYXRoID0gbm9y
bWFsaXplZC5wYXRoOwogICAgICByb290UGF0aCA9IG5vcm1hbGl6ZWQucm9vdDsKCiAgICAgIC8v
IFRoaXMgaXMgYSB3b3JrYXJvdW5kIGZvciB0aGUgZmFjdCB0aGF0IHlvdSBjYW5ub3QgYmluZCBz
ZXBhcmF0ZSBvYmplY3RzCiAgICAgIC8vIHRvZ2V0aGVyLiBXaGVuIHdlIGltcGxlbWVudCB0aGF0
IGZ1bmN0aW9uYWxpdHksIHdlIHNob3VsZCB1c2UgaXQgaGVyZS4KICAgICAgdmFyIGNvbnRleHRL
ZXkgPSBFbWJlci4kLmV4cGFuZG8gKyBFbWJlci5ndWlkRm9yKHJvb3RQYXRoKTsKICAgICAgbG9j
YWxpemVkT3B0aW9ucy5kYXRhLmtleXdvcmRzW2NvbnRleHRLZXldID0gcm9vdFBhdGg7CiAgICAg
IC8vIGlmIHRoZSBwYXRoIGlzICcnICgidGhpcyIpLCBqdXN0IGJpbmQgZGlyZWN0bHkgdG8gdGhl
IGN1cnJlbnQgY29udGV4dAogICAgICBjb250ZXh0UGF0aCA9IHBhdGggPyBjb250ZXh0S2V5ICsg
Jy4nICsgcGF0aCA6IGNvbnRleHRLZXk7CiAgICB9CgogICAgRW1iZXIuYmluZChsb2NhbGl6ZWRP
cHRpb25zLmRhdGEua2V5d29yZHMsIGtleXdvcmROYW1lLCBjb250ZXh0UGF0aCk7CgogICAgcmV0
dXJuIGJpbmQuY2FsbCh0aGlzLCBwYXRoLCBsb2NhbGl6ZWRPcHRpb25zLCB0cnVlLCBleGlzdHMp
OwogIH0gZWxzZSB7CiAgICBFbWJlci5hc3NlcnQoIllvdSBtdXN0IHBhc3MgZXhhY3RseSBvbmUg
YXJndW1lbnQgdG8gdGhlIHdpdGggaGVscGVyIiwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMik7CiAg
ICBFbWJlci5hc3NlcnQoIllvdSBtdXN0IHBhc3MgYSBibG9jayB0byB0aGUgd2l0aCBoZWxwZXIi
LCBvcHRpb25zLmZuICYmIG9wdGlvbnMuZm4gIT09IEhhbmRsZWJhcnMuVk0ubm9vcCk7CiAgICBy
ZXR1cm4gaGVscGVycy5iaW5kLmNhbGwob3B0aW9ucy5jb250ZXh0c1swXSwgY29udGV4dCwgb3B0
aW9ucyk7CiAgfQp9KTsKCgovKioKICBTZWUgW2JvdW5kSWZdKC9hcGkvY2xhc3Nlcy9FbWJlci5I
YW5kbGViYXJzLmhlbHBlcnMuaHRtbCNtZXRob2RfYm91bmRJZikKCiAgQG1ldGhvZCBpZgogIEBm
b3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtGdW5jdGlvbn0gY29udGV4dAog
IEBwYXJhbSB7SGFzaH0gb3B0aW9ucwogIEByZXR1cm4ge1N0cmluZ30gSFRNTCBzdHJpbmcKKi8K
RW1iZXJIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZicsIGZ1bmN0aW9uIGlmSGVscGVyKGNv
bnRleHQsIG9wdGlvbnMpIHsKICBFbWJlci5hc3NlcnQoIllvdSBtdXN0IHBhc3MgZXhhY3RseSBv
bmUgYXJndW1lbnQgdG8gdGhlIGlmIGhlbHBlciIsIGFyZ3VtZW50cy5sZW5ndGggPT09IDIpOwog
IEVtYmVyLmFzc2VydCgiWW91IG11c3QgcGFzcyBhIGJsb2NrIHRvIHRoZSBpZiBoZWxwZXIiLCBv
cHRpb25zLmZuICYmIG9wdGlvbnMuZm4gIT09IEhhbmRsZWJhcnMuVk0ubm9vcCk7CgogIHJldHVy
biBoZWxwZXJzLmJvdW5kSWYuY2FsbChvcHRpb25zLmNvbnRleHRzWzBdLCBjb250ZXh0LCBvcHRp
b25zKTsKfSk7CgovKioKICBAbWV0aG9kIHVubGVzcwogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5o
ZWxwZXJzCiAgQHBhcmFtIHtGdW5jdGlvbn0gY29udGV4dAogIEBwYXJhbSB7SGFzaH0gb3B0aW9u
cwogIEByZXR1cm4ge1N0cmluZ30gSFRNTCBzdHJpbmcKKi8KRW1iZXJIYW5kbGViYXJzLnJlZ2lz
dGVySGVscGVyKCd1bmxlc3MnLCBmdW5jdGlvbiB1bmxlc3NIZWxwZXIoY29udGV4dCwgb3B0aW9u
cykgewogIEVtYmVyLmFzc2VydCgiWW91IG11c3QgcGFzcyBleGFjdGx5IG9uZSBhcmd1bWVudCB0
byB0aGUgdW5sZXNzIGhlbHBlciIsIGFyZ3VtZW50cy5sZW5ndGggPT09IDIpOwogIEVtYmVyLmFz
c2VydCgiWW91IG11c3QgcGFzcyBhIGJsb2NrIHRvIHRoZSB1bmxlc3MgaGVscGVyIiwgb3B0aW9u
cy5mbiAmJiBvcHRpb25zLmZuICE9PSBIYW5kbGViYXJzLlZNLm5vb3ApOwoKICB2YXIgZm4gPSBv
cHRpb25zLmZuLCBpbnZlcnNlID0gb3B0aW9ucy5pbnZlcnNlOwoKICBvcHRpb25zLmZuID0gaW52
ZXJzZTsKICBvcHRpb25zLmludmVyc2UgPSBmbjsKCiAgcmV0dXJuIGhlbHBlcnMuYm91bmRJZi5j
YWxsKG9wdGlvbnMuY29udGV4dHNbMF0sIGNvbnRleHQsIG9wdGlvbnMpOwp9KTsKCi8qKgogIGBi
aW5kLWF0dHJgIGFsbG93cyB5b3UgdG8gY3JlYXRlIGEgYmluZGluZyBiZXR3ZWVuIERPTSBlbGVt
ZW50IGF0dHJpYnV0ZXMgYW5kCiAgRW1iZXIgb2JqZWN0cy4gRm9yIGV4YW1wbGU6CgogIGBgYGhh
bmRsZWJhcnMKICA8aW1nIHt7YmluZC1hdHRyIHNyYz0iaW1hZ2VVcmwiIGFsdD0iaW1hZ2VUaXRs
ZSJ9fT4KICBgYGAKCiAgVGhlIGFib3ZlIGhhbmRsZWJhcnMgdGVtcGxhdGUgd2lsbCBmaWxsIHRo
ZSBgPGltZz5gJ3MgYHNyY2AgYXR0cmlidXRlIHdpbGwKICB0aGUgdmFsdWUgb2YgdGhlIHByb3Bl
cnR5IHJlZmVyZW5jZWQgd2l0aCBgImltYWdlVXJsImAgYW5kIGl0cyBgYWx0YAogIGF0dHJpYnV0
ZSB3aXRoIHRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgcmVmZXJlbmNlZCB3aXRoIGAiaW1hZ2VU
aXRsZSJgLgoKICBJZiB0aGUgcmVuZGVyaW5nIGNvbnRleHQgb2YgdGhpcyB0ZW1wbGF0ZSBpcyB0
aGUgZm9sbG93aW5nIG9iamVjdDoKCiAgYGBgamF2YXNjcmlwdAogIHsKICAgIGltYWdlVXJsOiAn
aHR0cDovL2xvbGNhdHMuaW5mby9oYXotYS1mdW5ueScsCiAgICBpbWFnZVRpdGxlOiAnQSBodW1v
cm91cyBpbWFnZSBvZiBhIGNhdCcKICB9CiAgYGBgCgogIFRoZSByZXN1bHRpbmcgSFRNTCBvdXRw
dXQgd2lsbCBiZToKCiAgYGBgaHRtbAogIDxpbWcgc3JjPSJodHRwOi8vbG9sY2F0cy5pbmZvL2hh
ei1hLWZ1bm55IiBhbHQ9IkEgaHVtb3JvdXMgaW1hZ2Ugb2YgYSBjYXQiPgogIGBgYAoKICBgYmlu
ZC1hdHRyYCBjYW5ub3QgcmVkZWNsYXJlIGV4aXN0aW5nIERPTSBlbGVtZW50IGF0dHJpYnV0ZXMu
IFRoZSB1c2Ugb2YgYHNyY2AKICBpbiB0aGUgZm9sbG93aW5nIGBiaW5kLWF0dHJgIGV4YW1wbGUg
d2lsbCBiZSBpZ25vcmVkIGFuZCB0aGUgaGFyZCBjb2RlZCB2YWx1ZQogIG9mIGBzcmM9Ii9mYWls
d2hhbGUuZ2lmImAgd2lsbCB0YWtlIHByZWNlZGVuY2U6CgogIGBgYGhhbmRsZWJhcnMKICA8aW1n
IHNyYz0iL2ZhaWx3aGFsZS5naWYiIHt7YmluZC1hdHRyIHNyYz0iaW1hZ2VVcmwiIGFsdD0iaW1h
Z2VUaXRsZSJ9fT4KICBgYGAKCiAgIyMjIGBiaW5kLWF0dHJgIGFuZCB0aGUgYGNsYXNzYCBhdHRy
aWJ1dGUKCiAgYGJpbmQtYXR0cmAgc3VwcG9ydHMgYSBzcGVjaWFsIHN5bnRheCBmb3IgaGFuZGxp
bmcgYSBudW1iZXIgb2YgY2FzZXMgdW5pcXVlCiAgdG8gdGhlIGBjbGFzc2AgRE9NIGVsZW1lbnQg
YXR0cmlidXRlLiBUaGUgYGNsYXNzYCBhdHRyaWJ1dGUgY29tYmluZXMKICBtdWx0aXBsZSBkaXNj
cmV0ZSB2YWx1ZXMgaW50byBhIHNpbmdsZSBhdHRyaWJ1dGUgYXMgYSBzcGFjZS1kZWxpbWl0ZWQK
ICBsaXN0IG9mIHN0cmluZ3MuIEVhY2ggc3RyaW5nIGNhbiBiZToKCiAgKiBhIHN0cmluZyByZXR1
cm4gdmFsdWUgb2YgYW4gb2JqZWN0J3MgcHJvcGVydHkuCiAgKiBhIGJvb2xlYW4gcmV0dXJuIHZh
bHVlIG9mIGFuIG9iamVjdCdzIHByb3BlcnR5CiAgKiBhIGhhcmQtY29kZWQgdmFsdWUKCiAgQSBz
dHJpbmcgcmV0dXJuIHZhbHVlIHdvcmtzIGlkZW50aWNhbGx5IHRvIG90aGVyIHVzZXMgb2YgYGJp
bmQtYXR0cmAuIFRoZQogIHJldHVybiB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgd2lsbCBiZWNvbWUg
dGhlIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUuIEZvcgogIGV4YW1wbGUsIHRoZSBmb2xsb3dpbmcg
dmlldyBhbmQgdGVtcGxhdGU6CgogIGBgYGphdmFzY3JpcHQKICAgIEFWaWV3ID0gRW1iZXIuVmll
dy5leHRlbmQoewogICAgICBzb21lUHJvcGVydHk6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVy
biAiYVZhbHVlIjsKICAgICAgfS5wcm9wZXJ0eSgpCiAgICB9KQogIGBgYAoKICBgYGBoYW5kbGVi
YXJzCiAgPGltZyB7e2JpbmQtYXR0ciBjbGFzcz0idmlldy5zb21lUHJvcGVydHl9fT4KICBgYGAK
CiAgUmVzdWx0IGluIHRoZSBmb2xsb3dpbmcgcmVuZGVyZWQgb3V0cHV0OgoKICBgYGBodG1sCiAg
PGltZyBjbGFzcz0iYVZhbHVlIj4KICBgYGAKCiAgQSBib29sZWFuIHJldHVybiB2YWx1ZSB3aWxs
IGluc2VydCBhIHNwZWNpZmllZCBjbGFzcyBuYW1lIGlmIHRoZSBwcm9wZXJ0eQogIHJldHVybnMg
YHRydWVgIGFuZCByZW1vdmUgdGhlIGNsYXNzIG5hbWUgaWYgdGhlIHByb3BlcnR5IHJldHVybnMg
YGZhbHNlYC4KCiAgQSBjbGFzcyBuYW1lIGlzIHByb3ZpZGVkIHZpYSB0aGUgc3ludGF4CiAgYHNv
bWVQcm9wZXJ0eU5hbWU6Y2xhc3MtbmFtZS1pZi10cnVlYC4KCiAgYGBgamF2YXNjcmlwdAogIEFW
aWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgc29tZUJvb2w6IHRydWUKICB9KQogIGBgYAoK
ICBgYGBoYW5kbGViYXJzCiAgPGltZyB7e2JpbmQtYXR0ciBjbGFzcz0idmlldy5zb21lQm9vbDpj
bGFzcy1uYW1lLWlmLXRydWUifX0+CiAgYGBgCgogIFJlc3VsdCBpbiB0aGUgZm9sbG93aW5nIHJl
bmRlcmVkIG91dHB1dDoKCiAgYGBgaHRtbAogIDxpbWcgY2xhc3M9ImNsYXNzLW5hbWUtaWYtdHJ1
ZSI+CiAgYGBgCgogIEFuIGFkZGl0aW9uYWwgc2VjdGlvbiBvZiB0aGUgYmluZGluZyBjYW4gYmUg
cHJvdmlkZWQgaWYgeW91IHdhbnQgdG8KICByZXBsYWNlIHRoZSBleGlzdGluZyBjbGFzcyBpbnN0
ZWFkIG9mIHJlbW92aW5nIGl0IHdoZW4gdGhlIGJvb2xlYW4KICB2YWx1ZSBjaGFuZ2VzOgoKICBg
YGBoYW5kbGViYXJzCiAgPGltZyB7e2JpbmQtYXR0ciBjbGFzcz0idmlldy5zb21lQm9vbDpjbGFz
cy1uYW1lLWlmLXRydWU6Y2xhc3MtbmFtZS1pZi1mYWxzZSJ9fT4KICBgYGAKCiAgQSBoYXJkLWNv
ZGVkIHZhbHVlIGNhbiBiZSB1c2VkIGJ5IHByZXBlbmRpbmcgYDpgIHRvIHRoZSBkZXNpcmVkCiAg
Y2xhc3MgbmFtZTogYDpjbGFzcy1uYW1lLXRvLWFsd2F5cy1hcHBseWAuCgogIGBgYGhhbmRsZWJh
cnMKICA8aW1nIHt7YmluZC1hdHRyIGNsYXNzPSI6Y2xhc3MtbmFtZS10by1hbHdheXMtYXBwbHki
fX0+CiAgYGBgCgogIFJlc3VsdHMgaW4gdGhlIGZvbGxvd2luZyByZW5kZXJlZCBvdXRwdXQ6Cgog
IGBgYGh0bWwKICA8aW1nIGNsYXNzPSJjbGFzcy1uYW1lLXRvLWFsd2F5cy1hcHBseSI+CiAgYGBg
CgogIEFsbCB0aHJlZSBzdHJhdGVnaWVzIC0gc3RyaW5nIHJldHVybiB2YWx1ZSwgYm9vbGVhbiBy
ZXR1cm4gdmFsdWUsIGFuZAogIGhhcmQtY29kZWQgdmFsdWUg4oCTIGNhbiBiZSBjb21iaW5lZCBp
biBhIHNpbmdsZSBkZWNsYXJhdGlvbjoKCiAgYGBgaGFuZGxlYmFycwogIDxpbWcge3tiaW5kLWF0
dHIgY2xhc3M9IjpjbGFzcy1uYW1lLXRvLWFsd2F5cy1hcHBseSB2aWV3LnNvbWVCb29sOmNsYXNz
LW5hbWUtaWYtdHJ1ZSB2aWV3LnNvbWVQcm9wZXJ0eSJ9fT4KICBgYGAKCiAgQG1ldGhvZCBiaW5k
LWF0dHIKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwogIEBwYXJhbSB7SGFzaH0gb3B0
aW9ucwogIEByZXR1cm4ge1N0cmluZ30gSFRNTCBzdHJpbmcKKi8KRW1iZXJIYW5kbGViYXJzLnJl
Z2lzdGVySGVscGVyKCdiaW5kLWF0dHInLCBmdW5jdGlvbiBiaW5kQXR0ckhlbHBlcihvcHRpb25z
KSB7CgogIHZhciBhdHRycyA9IG9wdGlvbnMuaGFzaDsKCiAgRW1iZXIuYXNzZXJ0KCJZb3UgbXVz
dCBzcGVjaWZ5IGF0IGxlYXN0IG9uZSBoYXNoIGFyZ3VtZW50IHRvIGJpbmQtYXR0ciIsICEhRW1i
ZXIua2V5cyhhdHRycykubGVuZ3RoKTsKCiAgdmFyIHZpZXcgPSBvcHRpb25zLmRhdGEudmlldzsK
ICB2YXIgcmV0ID0gW107CiAgdmFyIGN0eCA9IHRoaXM7CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVl
IGlkIGZvciB0aGlzIGVsZW1lbnQuIFRoaXMgd2lsbCBiZSBhZGRlZCBhcyBhCiAgLy8gZGF0YSBh
dHRyaWJ1dGUgdG8gdGhlIGVsZW1lbnQgc28gaXQgY2FuIGJlIGxvb2tlZCB1cCB3aGVuCiAgLy8g
dGhlIGJvdW5kIHByb3BlcnR5IGNoYW5nZXMuCiAgdmFyIGRhdGFJZCA9ICsrRW1iZXIudXVpZDsK
CiAgLy8gSGFuZGxlIGNsYXNzZXMgZGlmZmVyZW50bHksIGFzIHdlIGNhbiBiaW5kIG11bHRpcGxl
IGNsYXNzZXMKICB2YXIgY2xhc3NCaW5kaW5ncyA9IGF0dHJzWydjbGFzcyddOwogIGlmIChjbGFz
c0JpbmRpbmdzICE9IG51bGwpIHsKICAgIHZhciBjbGFzc1Jlc3VsdHMgPSBFbWJlckhhbmRsZWJh
cnMuYmluZENsYXNzZXModGhpcywgY2xhc3NCaW5kaW5ncywgdmlldywgZGF0YUlkLCBvcHRpb25z
KTsKCiAgICByZXQucHVzaCgnY2xhc3M9IicgKyBIYW5kbGViYXJzLlV0aWxzLmVzY2FwZUV4cHJl
c3Npb24oY2xhc3NSZXN1bHRzLmpvaW4oJyAnKSkgKyAnIicpOwogICAgZGVsZXRlIGF0dHJzWydj
bGFzcyddOwogIH0KCiAgdmFyIGF0dHJLZXlzID0gRW1iZXIua2V5cyhhdHRycyk7CgogIC8vIEZv
ciBlYWNoIGF0dHJpYnV0ZSBwYXNzZWQsIGNyZWF0ZSBhbiBvYnNlcnZlciBhbmQgZW1pdCB0aGUK
ICAvLyBjdXJyZW50IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBhcyBhbiBhdHRyaWJ1dGUuCiAgZm9y
RWFjaC5jYWxsKGF0dHJLZXlzLCBmdW5jdGlvbihhdHRyKSB7CiAgICB2YXIgcGF0aCA9IGF0dHJz
W2F0dHJdLAogICAgICAgIG5vcm1hbGl6ZWQ7CgogICAgRW1iZXIuYXNzZXJ0KGZtdCgiWW91IG11
c3QgcHJvdmlkZSBhbiBleHByZXNzaW9uIGFzIHRoZSB2YWx1ZSBvZiBib3VuZCBhdHRyaWJ1dGUu
IFlvdSBzcGVjaWZpZWQ6ICVAPSVAIiwgW2F0dHIsIHBhdGhdKSwgdHlwZW9mIHBhdGggPT09ICdz
dHJpbmcnKTsKCiAgICBub3JtYWxpemVkID0gbm9ybWFsaXplUGF0aChjdHgsIHBhdGgsIG9wdGlv
bnMuZGF0YSk7CgogICAgdmFyIHZhbHVlID0gKHBhdGggPT09ICd0aGlzJykgPyBub3JtYWxpemVk
LnJvb3QgOiBoYW5kbGViYXJzR2V0KGN0eCwgcGF0aCwgb3B0aW9ucyksCiAgICAgICAgdHlwZSA9
IEVtYmVyLnR5cGVPZih2YWx1ZSk7CgogICAgRW1iZXIuYXNzZXJ0KGZtdCgiQXR0cmlidXRlcyBt
dXN0IGJlIG51bWJlcnMsIHN0cmluZ3Mgb3IgYm9vbGVhbnMsIG5vdCAlQCIsIFt2YWx1ZV0pLCB2
YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHR5cGUgPT09ICdudW1iZXIn
IHx8IHR5cGUgPT09ICdzdHJpbmcnIHx8IHR5cGUgPT09ICdib29sZWFuJyk7CgogICAgdmFyIG9i
c2VydmVyLCBpbnZva2VyOwoKICAgIG9ic2VydmVyID0gZnVuY3Rpb24gb2JzZXJ2ZXIoKSB7CiAg
ICAgIHZhciByZXN1bHQgPSBoYW5kbGViYXJzR2V0KGN0eCwgcGF0aCwgb3B0aW9ucyk7CgogICAg
ICBFbWJlci5hc3NlcnQoZm10KCJBdHRyaWJ1dGVzIG11c3QgYmUgbnVtYmVycywgc3RyaW5ncyBv
ciBib29sZWFucywgbm90ICVAIiwgW3Jlc3VsdF0pLAogICAgICAgICAgICAgICAgICAgcmVzdWx0
ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiByZXN1bHQgPT09ICdu
dW1iZXInIHx8CiAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcn
IHx8IHR5cGVvZiByZXN1bHQgPT09ICdib29sZWFuJyk7CgogICAgICB2YXIgZWxlbSA9IHZpZXcu
JCgiW2RhdGEtYmluZGF0dHItIiArIGRhdGFJZCArICI9JyIgKyBkYXRhSWQgKyAiJ10iKTsKCiAg
ICAgIC8vIElmIHdlIGFyZW4ndCBhYmxlIHRvIGZpbmQgdGhlIGVsZW1lbnQsIGl0IG1lYW5zIHRo
ZSBlbGVtZW50CiAgICAgIC8vIHRvIHdoaWNoIHdlIHdlcmUgYm91bmQgaGFzIGJlZW4gcmVtb3Zl
ZCBmcm9tIHRoZSB2aWV3LgogICAgICAvLyBJbiB0aGF0IGNhc2UsIHdlIGNhbiBhc3N1bWUgdGhl
IHRlbXBsYXRlIGhhcyBiZWVuIHJlLXJlbmRlcmVkCiAgICAgIC8vIGFuZCB3ZSBuZWVkIHRvIGNs
ZWFuIHVwIHRoZSBvYnNlcnZlci4KICAgICAgaWYgKCFlbGVtIHx8IGVsZW0ubGVuZ3RoID09PSAw
KSB7CiAgICAgICAgRW1iZXIucmVtb3ZlT2JzZXJ2ZXIobm9ybWFsaXplZC5yb290LCBub3JtYWxp
emVkLnBhdGgsIGludm9rZXIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgRW1iZXIu
Vmlldy5hcHBseUF0dHJpYnV0ZUJpbmRpbmdzKGVsZW0sIGF0dHIsIHJlc3VsdCk7CiAgICB9OwoK
ICAgIC8vIEFkZCBhbiBvYnNlcnZlciB0byB0aGUgdmlldyBmb3Igd2hlbiB0aGUgcHJvcGVydHkg
Y2hhbmdlcy4KICAgIC8vIFdoZW4gdGhlIG9ic2VydmVyIGZpcmVzLCBmaW5kIHRoZSBlbGVtZW50
IHVzaW5nIHRoZQogICAgLy8gdW5pcXVlIGRhdGEgaWQgYW5kIHVwZGF0ZSB0aGUgYXR0cmlidXRl
IHRvIHRoZSBuZXcgdmFsdWUuCiAgICAvLyBOb3RlOiBkb24ndCBhZGQgb2JzZXJ2ZXIgd2hlbiBw
YXRoIGlzICd0aGlzJyBvciBwYXRoCiAgICAvLyBpcyB3aG9sZSBrZXl3b3JkIGUuZy4ge3sjZWFj
aCB4IGluIGxpc3R9fSAuLi4ge3tiaW5kLWF0dHIgYXR0cj0ieCJ9fQogICAgaWYgKHBhdGggIT09
ICd0aGlzJyAmJiAhKG5vcm1hbGl6ZWQuaXNLZXl3b3JkICYmIG5vcm1hbGl6ZWQucGF0aCA9PT0g
JycgKSkgewogICAgICB2aWV3LnJlZ2lzdGVyT2JzZXJ2ZXIobm9ybWFsaXplZC5yb290LCBub3Jt
YWxpemVkLnBhdGgsIG9ic2VydmVyKTsKICAgIH0KCiAgICAvLyBpZiB0aGlzIGNoYW5nZXMsIGFs
c28gY2hhbmdlIHRoZSBsb2dpYyBpbiBlbWJlci12aWV3cy9saWIvdmlld3Mvdmlldy5qcwogICAg
aWYgKCh0eXBlID09PSAnc3RyaW5nJyB8fCAodHlwZSA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZh
bHVlKSkpKSB7CiAgICAgIHJldC5wdXNoKGF0dHIgKyAnPSInICsgSGFuZGxlYmFycy5VdGlscy5l
c2NhcGVFeHByZXNzaW9uKHZhbHVlKSArICciJyk7CiAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHR5
cGUgPT09ICdib29sZWFuJykgewogICAgICAvLyBUaGUgZGV2ZWxvcGVyIGNvbnRyb2xzIHRoZSBh
dHRyIG5hbWUsIHNvIGl0IHNob3VsZCBhbHdheXMgYmUgc2FmZQogICAgICByZXQucHVzaChhdHRy
ICsgJz0iJyArIGF0dHIgKyAnIicpOwogICAgfQogIH0sIHRoaXMpOwoKICAvLyBBZGQgdGhlIHVu
aXF1ZSBpZGVudGlmaWVyCiAgLy8gTk9URTogV2UgdXNlIGFsbCBsb3dlci1jYXNlIHNpbmNlIEZp
cmVmb3ggaGFzIHByb2JsZW1zIHdpdGggbWl4ZWQgY2FzZSBpbiBTVkcKICByZXQucHVzaCgnZGF0
YS1iaW5kYXR0ci0nICsgZGF0YUlkICsgJz0iJyArIGRhdGFJZCArICciJyk7CiAgcmV0dXJuIG5l
dyBFbWJlckhhbmRsZWJhcnMuU2FmZVN0cmluZyhyZXQuam9pbignICcpKTsKfSk7CgovKioKICBT
ZWUgYGJpbmQtYXR0cmAKCiAgQG1ldGhvZCBiaW5kQXR0cgogIEBmb3IgRW1iZXIuSGFuZGxlYmFy
cy5oZWxwZXJzCiAgQGRlcHJlY2F0ZWQKICBAcGFyYW0ge0Z1bmN0aW9ufSBjb250ZXh0CiAgQHBh
cmFtIHtIYXNofSBvcHRpb25zCiAgQHJldHVybiB7U3RyaW5nfSBIVE1MIHN0cmluZwoqLwpFbWJl
ckhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2JpbmRBdHRyJywgZnVuY3Rpb24gYmluZEF0dHJI
ZWxwZXIoKSB7CiAgRW1iZXIud2FybigiVGhlICdiaW5kQXR0cicgdmlldyBoZWxwZXIgaXMgZGVw
cmVjYXRlZCBpbiBmYXZvciBvZiAnYmluZC1hdHRyJyIpOwogIHJldHVybiBFbWJlckhhbmRsZWJh
cnMuaGVscGVyc1snYmluZC1hdHRyJ10uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfSk7CgovKioK
ICBIZWxwZXIgdGhhdCwgZ2l2ZW4gYSBzcGFjZS1zZXBhcmF0ZWQgc3RyaW5nIG9mIHByb3BlcnR5
IHBhdGhzIGFuZCBhIGNvbnRleHQsCiAgcmV0dXJucyBhbiBhcnJheSBvZiBjbGFzcyBuYW1lcy4g
Q2FsbGluZyB0aGlzIG1ldGhvZCBhbHNvIGhhcyB0aGUgc2lkZQogIGVmZmVjdCBvZiBzZXR0aW5n
IHVwIG9ic2VydmVycyBhdCB0aG9zZSBwcm9wZXJ0eSBwYXRocywgc3VjaCB0aGF0IGlmIHRoZXkK
ICBjaGFuZ2UsIHRoZSBjb3JyZWN0IGNsYXNzIG5hbWUgd2lsbCBiZSByZWFwcGxpZWQgdG8gdGhl
IERPTSBlbGVtZW50LgoKICBGb3IgZXhhbXBsZSwgaWYgeW91IHBhc3MgdGhlIHN0cmluZyAiZm9v
QmFyIiwgaXQgd2lsbCBmaXJzdCBsb29rIHVwIHRoZQogICJmb29CYXIiIHZhbHVlIG9mIHRoZSBj
b250ZXh0LiBJZiB0aGF0IHZhbHVlIGlzIHRydWUsIGl0IHdpbGwgYWRkIHRoZQogICJmb28tYmFy
IiBjbGFzcyB0byB0aGUgY3VycmVudCBlbGVtZW50IChpLmUuLCB0aGUgZGFzaGVyaXplZCBmb3Jt
IG9mCiAgImZvb0JhciIpLiBJZiB0aGUgdmFsdWUgaXMgYSBzdHJpbmcsIGl0IHdpbGwgYWRkIHRo
YXQgc3RyaW5nIGFzIHRoZSBjbGFzcy4KICBPdGhlcndpc2UsIGl0IHdpbGwgbm90IGFkZCBhbnkg
bmV3IGNsYXNzIG5hbWUuCgogIEBwcml2YXRlCiAgQG1ldGhvZCBiaW5kQ2xhc3NlcwogIEBmb3Ig
RW1iZXIuSGFuZGxlYmFycwogIEBwYXJhbSB7RW1iZXIuT2JqZWN0fSBjb250ZXh0IFRoZSBjb250
ZXh0IGZyb20gd2hpY2ggdG8gbG9va3VwIHByb3BlcnRpZXMKICBAcGFyYW0ge1N0cmluZ30gY2xh
c3NCaW5kaW5ncyBBIHN0cmluZywgc3BhY2Utc2VwYXJhdGVkLCBvZiBjbGFzcyBiaW5kaW5ncwog
ICAgdG8gdXNlCiAgQHBhcmFtIHtFbWJlci5WaWV3fSB2aWV3IFRoZSB2aWV3IGluIHdoaWNoIG9i
c2VydmVycyBzaG91bGQgbG9vayBmb3IgdGhlCiAgICBlbGVtZW50IHRvIHVwZGF0ZQogIEBwYXJh
bSB7U3J0aW5nfSBiaW5kQXR0cklkIE9wdGlvbmFsIGJpbmRBdHRyIGlkIHVzZWQgdG8gbG9va3Vw
IGVsZW1lbnRzCiAgQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IG9mIGNsYXNzIG5hbWVzIHRvIGFk
ZAoqLwpFbWJlckhhbmRsZWJhcnMuYmluZENsYXNzZXMgPSBmdW5jdGlvbihjb250ZXh0LCBjbGFz
c0JpbmRpbmdzLCB2aWV3LCBiaW5kQXR0cklkLCBvcHRpb25zKSB7CiAgdmFyIHJldCA9IFtdLCBu
ZXdDbGFzcywgdmFsdWUsIGVsZW07CgogIC8vIEhlbHBlciBtZXRob2QgdG8gcmV0cmlldmUgdGhl
IHByb3BlcnR5IGZyb20gdGhlIGNvbnRleHQgYW5kCiAgLy8gZGV0ZXJtaW5lIHdoaWNoIGNsYXNz
IHN0cmluZyB0byByZXR1cm4sIGJhc2VkIG9uIHdoZXRoZXIgaXQgaXMKICAvLyBhIEJvb2xlYW4g
b3Igbm90LgogIHZhciBjbGFzc1N0cmluZ0ZvclBhdGggPSBmdW5jdGlvbihyb290LCBwYXJzZWRQ
YXRoLCBvcHRpb25zKSB7CiAgICB2YXIgdmFsLAogICAgICAgIHBhdGggPSBwYXJzZWRQYXRoLnBh
dGg7CgogICAgaWYgKHBhdGggPT09ICd0aGlzJykgewogICAgICB2YWwgPSByb290OwogICAgfSBl
bHNlIGlmIChwYXRoID09PSAnJykgewogICAgICB2YWwgPSB0cnVlOwogICAgfSBlbHNlIHsKICAg
ICAgdmFsID0gaGFuZGxlYmFyc0dldChyb290LCBwYXRoLCBvcHRpb25zKTsKICAgIH0KCiAgICBy
ZXR1cm4gRW1iZXIuVmlldy5fY2xhc3NTdHJpbmdGb3JWYWx1ZShwYXRoLCB2YWwsIHBhcnNlZFBh
dGguY2xhc3NOYW1lLCBwYXJzZWRQYXRoLmZhbHN5Q2xhc3NOYW1lKTsKICB9OwoKICAvLyBGb3Ig
ZWFjaCBwcm9wZXJ0eSBwYXNzZWQsIGxvb3AgdGhyb3VnaCBhbmQgc2V0dXAKICAvLyBhbiBvYnNl
cnZlci4KICBmb3JFYWNoLmNhbGwoY2xhc3NCaW5kaW5ncy5zcGxpdCgnICcpLCBmdW5jdGlvbihi
aW5kaW5nKSB7CgogICAgLy8gVmFyaWFibGUgaW4gd2hpY2ggdGhlIG9sZCBjbGFzcyB2YWx1ZSBp
cyBzYXZlZC4gVGhlIG9ic2VydmVyIGZ1bmN0aW9uCiAgICAvLyBjbG9zZXMgb3ZlciB0aGlzIHZh
cmlhYmxlLCBzbyBpdCBrbm93cyB3aGljaCBzdHJpbmcgdG8gcmVtb3ZlIHdoZW4KICAgIC8vIHRo
ZSBwcm9wZXJ0eSBjaGFuZ2VzLgogICAgdmFyIG9sZENsYXNzOwoKICAgIHZhciBvYnNlcnZlciwg
aW52b2tlcjsKCiAgICB2YXIgcGFyc2VkUGF0aCA9IEVtYmVyLlZpZXcuX3BhcnNlUHJvcGVydHlQ
YXRoKGJpbmRpbmcpLAogICAgICAgIHBhdGggPSBwYXJzZWRQYXRoLnBhdGgsCiAgICAgICAgcGF0
aFJvb3QgPSBjb250ZXh0LAogICAgICAgIG5vcm1hbGl6ZWQ7CgogICAgaWYgKHBhdGggIT09ICcn
ICYmIHBhdGggIT09ICd0aGlzJykgewogICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplUGF0aChj
b250ZXh0LCBwYXRoLCBvcHRpb25zLmRhdGEpOwoKICAgICAgcGF0aFJvb3QgPSBub3JtYWxpemVk
LnJvb3Q7CiAgICAgIHBhdGggPSBub3JtYWxpemVkLnBhdGg7CiAgICB9CgogICAgLy8gU2V0IHVw
IGFuIG9ic2VydmVyIG9uIHRoZSBjb250ZXh0LiBJZiB0aGUgcHJvcGVydHkgY2hhbmdlcywgdG9n
Z2xlIHRoZQogICAgLy8gY2xhc3MgbmFtZS4KICAgIG9ic2VydmVyID0gZnVuY3Rpb24oKSB7CiAg
ICAgIC8vIEdldCB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgcHJvcGVydHkKICAgICAgbmV3Q2xh
c3MgPSBjbGFzc1N0cmluZ0ZvclBhdGgoY29udGV4dCwgcGFyc2VkUGF0aCwgb3B0aW9ucyk7CiAg
ICAgIGVsZW0gPSBiaW5kQXR0cklkID8gdmlldy4kKCJbZGF0YS1iaW5kYXR0ci0iICsgYmluZEF0
dHJJZCArICI9JyIgKyBiaW5kQXR0cklkICsgIiddIikgOiB2aWV3LiQoKTsKCiAgICAgIC8vIElm
IHdlIGNhbid0IGZpbmQgdGhlIGVsZW1lbnQgYW55bW9yZSwgYSBwYXJlbnQgdGVtcGxhdGUgaGFz
IGJlZW4KICAgICAgLy8gcmUtcmVuZGVyZWQgYW5kIHdlJ3ZlIGJlZW4gbnVrZWQuIFJlbW92ZSB0
aGUgb2JzZXJ2ZXIuCiAgICAgIGlmICghZWxlbSB8fCBlbGVtLmxlbmd0aCA9PT0gMCkgewogICAg
ICAgIEVtYmVyLnJlbW92ZU9ic2VydmVyKHBhdGhSb290LCBwYXRoLCBpbnZva2VyKTsKICAgICAg
fSBlbHNlIHsKICAgICAgICAvLyBJZiB3ZSBoYWQgcHJldmlvdXNseSBhZGRlZCBhIGNsYXNzIHRv
IHRoZSBlbGVtZW50LCByZW1vdmUgaXQuCiAgICAgICAgaWYgKG9sZENsYXNzKSB7CiAgICAgICAg
ICBlbGVtLnJlbW92ZUNsYXNzKG9sZENsYXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIElmIG5l
Y2Vzc2FyeSwgYWRkIGEgbmV3IGNsYXNzLiBNYWtlIHN1cmUgd2Uga2VlcCB0cmFjayBvZiBpdCBz
bwogICAgICAgIC8vIGl0IGNhbiBiZSByZW1vdmVkIGluIHRoZSBmdXR1cmUuCiAgICAgICAgaWYg
KG5ld0NsYXNzKSB7CiAgICAgICAgICBlbGVtLmFkZENsYXNzKG5ld0NsYXNzKTsKICAgICAgICAg
IG9sZENsYXNzID0gbmV3Q2xhc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9sZENsYXNz
ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgaWYgKHBhdGggIT09ICcnICYm
IHBhdGggIT09ICd0aGlzJykgewogICAgICB2aWV3LnJlZ2lzdGVyT2JzZXJ2ZXIocGF0aFJvb3Qs
IHBhdGgsIG9ic2VydmVyKTsKICAgIH0KCiAgICAvLyBXZSd2ZSBhbHJlYWR5IHNldHVwIHRoZSBv
YnNlcnZlcjsgbm93IHdlIGp1c3QgbmVlZCB0byBmaWd1cmUgb3V0IHRoZQogICAgLy8gY29ycmVj
dCBiZWhhdmlvciByaWdodCBub3cgb24gdGhlIGZpcnN0IHBhc3MgdGhyb3VnaC4KICAgIHZhbHVl
ID0gY2xhc3NTdHJpbmdGb3JQYXRoKGNvbnRleHQsIHBhcnNlZFBhdGgsIG9wdGlvbnMpOwoKICAg
IGlmICh2YWx1ZSkgewogICAgICByZXQucHVzaCh2YWx1ZSk7CgogICAgICAvLyBNYWtlIHN1cmUg
d2Ugc2F2ZSB0aGUgY3VycmVudCB2YWx1ZSBzbyB0aGF0IGl0IGNhbiBiZSByZW1vdmVkIGlmIHRo
ZQogICAgICAvLyBvYnNlcnZlciBmaXJlcy4KICAgICAgb2xkQ2xhc3MgPSB2YWx1ZTsKICAgIH0K
ICB9KTsKCiAgcmV0dXJuIHJldDsKfTsKCgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qZ2xvYmFs
cyBIYW5kbGViYXJzICovCgovLyBUT0RPOiBEb24ndCByZXF1aXJlIHRoZSBlbnRpcmUgbW9kdWxl
Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItaGFuZGxlYmFycwoqLwoKdmFyIGdl
dCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0Owp2YXIgRW1iZXJIYW5kbGViYXJzID0gRW1i
ZXIuSGFuZGxlYmFyczsKdmFyIExPV0VSQ0FTRV9BX1ogPSAvXlthLXpdLzsKdmFyIFZJRVdfUFJF
RklYID0gL152aWV3XC4vOwoKZnVuY3Rpb24gbWFrZUJpbmRpbmdzKHRoaXNDb250ZXh0LCBvcHRp
b25zKSB7CiAgdmFyIGhhc2ggPSBvcHRpb25zLmhhc2gsCiAgICAgIGhhc2hUeXBlID0gb3B0aW9u
cy5oYXNoVHlwZXM7CgogIGZvciAodmFyIHByb3AgaW4gaGFzaCkgewogICAgaWYgKGhhc2hUeXBl
W3Byb3BdID09PSAnSUQnKSB7CgogICAgICB2YXIgdmFsdWUgPSBoYXNoW3Byb3BdOwoKICAgICAg
aWYgKEVtYmVyLklTX0JJTkRJTkcudGVzdChwcm9wKSkgewogICAgICAgIEVtYmVyLndhcm4oIllv
dSdyZSBhdHRlbXB0aW5nIHRvIHJlbmRlciBhIHZpZXcgYnkgcGFzc2luZyAiICsgcHJvcCArICI9
IiArIHZhbHVlICsgIiB0byBhIHZpZXcgaGVscGVyLCBidXQgdGhpcyBzeW50YXggaXMgYW1iaWd1
b3VzLiBZb3Ugc2hvdWxkIGVpdGhlciBzdXJyb3VuZCAiICsgdmFsdWUgKyAiIGluIHF1b3RlcyBv
ciByZW1vdmUgYEJpbmRpbmdgIGZyb20gIiArIHByb3AgKyAiLiIpOwogICAgICB9IGVsc2Ugewog
ICAgICAgIGhhc2hbcHJvcCArICdCaW5kaW5nJ10gPSB2YWx1ZTsKICAgICAgICBoYXNoVHlwZVtw
cm9wICsgJ0JpbmRpbmcnXSA9ICdTVFJJTkcnOwogICAgICAgIGRlbGV0ZSBoYXNoW3Byb3BdOwog
ICAgICAgIGRlbGV0ZSBoYXNoVHlwZVtwcm9wXTsKICAgICAgfQogICAgfQogIH0KCiAgaWYgKGhh
c2guaGFzT3duUHJvcGVydHkoJ2lkQmluZGluZycpKSB7CiAgICAvLyBpZCBjYW4ndCBiZSBib3Vu
ZCwgc28ganVzdCBwZXJmb3JtIG9uZS10aW1lIGxvb2t1cC4KICAgIGhhc2guaWQgPSBFbWJlckhh
bmRsZWJhcnMuZ2V0KHRoaXNDb250ZXh0LCBoYXNoLmlkQmluZGluZywgb3B0aW9ucyk7CiAgICBo
YXNoVHlwZS5pZCA9ICdTVFJJTkcnOwogICAgZGVsZXRlIGhhc2guaWRCaW5kaW5nOwogICAgZGVs
ZXRlIGhhc2hUeXBlLmlkQmluZGluZzsKICB9Cn0KCkVtYmVySGFuZGxlYmFycy5WaWV3SGVscGVy
ID0gRW1iZXIuT2JqZWN0LmNyZWF0ZSh7CgogIHByb3BlcnRpZXNGcm9tSFRNTE9wdGlvbnM6IGZ1
bmN0aW9uKG9wdGlvbnMpIHsKICAgIHZhciBoYXNoID0gb3B0aW9ucy5oYXNoLCBkYXRhID0gb3B0
aW9ucy5kYXRhOwogICAgdmFyIGV4dGVuc2lvbnMgPSB7fSwKICAgICAgICBjbGFzc2VzID0gaGFz
aFsnY2xhc3MnXSwKICAgICAgICBkdXAgPSBmYWxzZTsKCiAgICBpZiAoaGFzaC5pZCkgewogICAg
ICBleHRlbnNpb25zLmVsZW1lbnRJZCA9IGhhc2guaWQ7CiAgICAgIGR1cCA9IHRydWU7CiAgICB9
CgogICAgaWYgKGhhc2gudGFnKSB7CiAgICAgIGV4dGVuc2lvbnMudGFnTmFtZSA9IGhhc2gudGFn
OwogICAgICBkdXAgPSB0cnVlOwogICAgfQoKICAgIGlmIChjbGFzc2VzKSB7CiAgICAgIGNsYXNz
ZXMgPSBjbGFzc2VzLnNwbGl0KCcgJyk7CiAgICAgIGV4dGVuc2lvbnMuY2xhc3NOYW1lcyA9IGNs
YXNzZXM7CiAgICAgIGR1cCA9IHRydWU7CiAgICB9CgogICAgaWYgKGhhc2guY2xhc3NCaW5kaW5n
KSB7CiAgICAgIGV4dGVuc2lvbnMuY2xhc3NOYW1lQmluZGluZ3MgPSBoYXNoLmNsYXNzQmluZGlu
Zy5zcGxpdCgnICcpOwogICAgICBkdXAgPSB0cnVlOwogICAgfQoKICAgIGlmIChoYXNoLmNsYXNz
TmFtZUJpbmRpbmdzKSB7CiAgICAgIGlmIChleHRlbnNpb25zLmNsYXNzTmFtZUJpbmRpbmdzID09
PSB1bmRlZmluZWQpIGV4dGVuc2lvbnMuY2xhc3NOYW1lQmluZGluZ3MgPSBbXTsKICAgICAgZXh0
ZW5zaW9ucy5jbGFzc05hbWVCaW5kaW5ncyA9IGV4dGVuc2lvbnMuY2xhc3NOYW1lQmluZGluZ3Mu
Y29uY2F0KGhhc2guY2xhc3NOYW1lQmluZGluZ3Muc3BsaXQoJyAnKSk7CiAgICAgIGR1cCA9IHRy
dWU7CiAgICB9CgogICAgaWYgKGhhc2guYXR0cmlidXRlQmluZGluZ3MpIHsKICAgICAgRW1iZXIu
YXNzZXJ0KCJTZXR0aW5nICdhdHRyaWJ1dGVCaW5kaW5ncycgdmlhIEhhbmRsZWJhcnMgaXMgbm90
IGFsbG93ZWQuIFBsZWFzZSBzdWJjbGFzcyBFbWJlci5WaWV3IGFuZCBzZXQgaXQgdGhlcmUgaW5z
dGVhZC4iKTsKICAgICAgZXh0ZW5zaW9ucy5hdHRyaWJ1dGVCaW5kaW5ncyA9IG51bGw7CiAgICAg
IGR1cCA9IHRydWU7CiAgICB9CgogICAgaWYgKGR1cCkgewogICAgICBoYXNoID0gRW1iZXIuJC5l
eHRlbmQoe30sIGhhc2gpOwogICAgICBkZWxldGUgaGFzaC5pZDsKICAgICAgZGVsZXRlIGhhc2gu
dGFnOwogICAgICBkZWxldGUgaGFzaFsnY2xhc3MnXTsKICAgICAgZGVsZXRlIGhhc2guY2xhc3NC
aW5kaW5nOwogICAgfQoKICAgIC8vIFNldCB0aGUgcHJvcGVyIGNvbnRleHQgZm9yIGFsbCBiaW5k
aW5ncyBwYXNzZWQgdG8gdGhlIGhlbHBlci4gVGhpcyBhcHBsaWVzIHRvIHJlZ3VsYXIgYXR0cmli
dXRlIGJpbmRpbmdzCiAgICAvLyBhcyB3ZWxsIGFzIGNsYXNzIG5hbWUgYmluZGluZ3MuIElmIHRo
ZSBiaW5kaW5ncyBhcmUgbG9jYWwsIG1ha2UgdGhlbSByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBj
b250ZXh0CiAgICAvLyBpbnN0ZWFkIG9mIHRoZSB2aWV3LgogICAgdmFyIHBhdGg7CgogICAgLy8g
RXZhbHVhdGUgdGhlIGNvbnRleHQgb2YgcmVndWxhciBhdHRyaWJ1dGUgYmluZGluZ3M6CiAgICBm
b3IgKHZhciBwcm9wIGluIGhhc2gpIHsKICAgICAgaWYgKCFoYXNoLmhhc093blByb3BlcnR5KHBy
b3ApKSB7IGNvbnRpbnVlOyB9CgogICAgICAvLyBUZXN0IGlmIHRoZSBwcm9wZXJ0eSBlbmRzIGlu
ICJCaW5kaW5nIgogICAgICBpZiAoRW1iZXIuSVNfQklORElORy50ZXN0KHByb3ApICYmIHR5cGVv
ZiBoYXNoW3Byb3BdID09PSAnc3RyaW5nJykgewogICAgICAgIHBhdGggPSB0aGlzLmNvbnRleHR1
YWxpemVCaW5kaW5nUGF0aChoYXNoW3Byb3BdLCBkYXRhKTsKICAgICAgICBpZiAocGF0aCkgeyBo
YXNoW3Byb3BdID0gcGF0aDsgfQogICAgICB9CiAgICB9CgogICAgLy8gRXZhbHVhdGUgdGhlIGNv
bnRleHQgb2YgY2xhc3MgbmFtZSBiaW5kaW5nczoKICAgIGlmIChleHRlbnNpb25zLmNsYXNzTmFt
ZUJpbmRpbmdzKSB7CiAgICAgIGZvciAodmFyIGIgaW4gZXh0ZW5zaW9ucy5jbGFzc05hbWVCaW5k
aW5ncykgewogICAgICAgIHZhciBmdWxsID0gZXh0ZW5zaW9ucy5jbGFzc05hbWVCaW5kaW5nc1ti
XTsKICAgICAgICBpZiAodHlwZW9mIGZ1bGwgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAvLyBD
b250ZXh0dWFsaXplIHRoZSBwYXRoIG9mIGNsYXNzTmFtZUJpbmRpbmcgc28gdGhpczoKICAgICAg
ICAgIC8vCiAgICAgICAgICAvLyAgICAgY2xhc3NOYW1lQmluZGluZz0iaXNHcmVlbjpncmVlbiIK
ICAgICAgICAgIC8vCiAgICAgICAgICAvLyBpcyBjb252ZXJ0ZWQgdG8gdGhpczoKICAgICAgICAg
IC8vCiAgICAgICAgICAvLyAgICAgY2xhc3NOYW1lQmluZGluZz0iX3BhcmVudFZpZXcuY29udGV4
dC5pc0dyZWVuOmdyZWVuIgogICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSBFbWJlci5WaWV3Ll9w
YXJzZVByb3BlcnR5UGF0aChmdWxsKTsKICAgICAgICAgIHBhdGggPSB0aGlzLmNvbnRleHR1YWxp
emVCaW5kaW5nUGF0aChwYXJzZWRQYXRoLnBhdGgsIGRhdGEpOwogICAgICAgICAgaWYgKHBhdGgp
IHsgZXh0ZW5zaW9ucy5jbGFzc05hbWVCaW5kaW5nc1tiXSA9IHBhdGggKyBwYXJzZWRQYXRoLmNs
YXNzTmFtZXM7IH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gRW1iZXIuJC5l
eHRlbmQoaGFzaCwgZXh0ZW5zaW9ucyk7CiAgfSwKCiAgLy8gVHJhbnNmb3JtIGJpbmRpbmdzIGZy
b20gdGhlIGN1cnJlbnQgY29udGV4dCB0byBhIGNvbnRleHQgdGhhdCBjYW4gYmUgZXZhbHVhdGVk
IHdpdGhpbiB0aGUgdmlldy4KICAvLyBSZXR1cm5zIG51bGwgaWYgdGhlIHBhdGggc2hvdWxkbid0
IGJlIGNoYW5nZWQuCiAgLy8KICAvLyBUT0RPOiBjb25zaWRlciB0aGUgYWRkaXRpb24gb2YgYSBw
cmVmaXggdGhhdCB3b3VsZCBhbGxvdyB0aGlzIG1ldGhvZCB0byByZXR1cm4gYHBhdGhgLgogIGNv
bnRleHR1YWxpemVCaW5kaW5nUGF0aDogZnVuY3Rpb24ocGF0aCwgZGF0YSkgewogICAgdmFyIG5v
cm1hbGl6ZWQgPSBFbWJlci5IYW5kbGViYXJzLm5vcm1hbGl6ZVBhdGgobnVsbCwgcGF0aCwgZGF0
YSk7CiAgICBpZiAobm9ybWFsaXplZC5pc0tleXdvcmQpIHsKICAgICAgcmV0dXJuICd0ZW1wbGF0
ZURhdGEua2V5d29yZHMuJyArIHBhdGg7CiAgICB9IGVsc2UgaWYgKEVtYmVyLmlzR2xvYmFsUGF0
aChwYXRoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gJ3Ro
aXMnIHx8IHBhdGggPT09ICcnKSB7CiAgICAgIHJldHVybiAnX3BhcmVudFZpZXcuY29udGV4dCc7
CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJ19wYXJlbnRWaWV3LmNvbnRleHQuJyArIHBhdGg7
CiAgICB9CiAgfSwKCiAgaGVscGVyOiBmdW5jdGlvbih0aGlzQ29udGV4dCwgcGF0aCwgb3B0aW9u
cykgewogICAgdmFyIGRhdGEgPSBvcHRpb25zLmRhdGEsCiAgICAgICAgZm4gPSBvcHRpb25zLmZu
LAogICAgICAgIG5ld1ZpZXc7CgogICAgbWFrZUJpbmRpbmdzKHRoaXNDb250ZXh0LCBvcHRpb25z
KTsKCiAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBwYXRoKSB7CgogICAgICAvLyBUT0RPOiB0
aGlzIGlzIGEgbGFtZSBjb25kaXRpb25hbCwgdGhpcyBzaG91bGQgbGlrZWx5IGNoYW5nZQogICAg
ICAvLyBidXQgc29tZXRoaW5nIGFsb25nIHRoZXNlIGxpbmVzIHdpbGwgbGlrZWx5IG5lZWQgdG8g
YmUgYWRkZWQKICAgICAgLy8gYXMgZGVwcmVjYXRpb24gd2FybmluZ3MKICAgICAgLy8KICAgICAg
aWYgKG9wdGlvbnMudHlwZXNbMF0gPT09ICdTVFJJTkcnICYmIExPV0VSQ0FTRV9BX1oudGVzdChw
YXRoKSAmJiAhVklFV19QUkVGSVgudGVzdChwYXRoKSkgewogICAgICAgIEVtYmVyLmFzc2VydCgi
VmlldyByZXF1aXJlcyBhIGNvbnRhaW5lciIsICEhZGF0YS52aWV3LmNvbnRhaW5lcik7CiAgICAg
ICAgbmV3VmlldyA9IGRhdGEudmlldy5jb250YWluZXIubG9va3VwRmFjdG9yeSgndmlldzonICsg
cGF0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3VmlldyA9IEVtYmVySGFuZGxlYmFycy5n
ZXQodGhpc0NvbnRleHQsIHBhdGgsIG9wdGlvbnMpOwogICAgICB9CgogICAgICBFbWJlci5hc3Nl
cnQoIlVuYWJsZSB0byBmaW5kIHZpZXcgYXQgcGF0aCAnIiArIHBhdGggKyAiJyIsICEhbmV3Vmll
dyk7CiAgICB9IGVsc2UgewogICAgICBuZXdWaWV3ID0gcGF0aDsKICAgIH0KCiAgICBFbWJlci5h
c3NlcnQoRW1iZXIuU3RyaW5nLmZtdCgnWW91IG11c3QgcGFzcyBhIHZpZXcgdG8gdGhlICN2aWV3
IGhlbHBlciwgbm90ICVAICglQCknLCBbcGF0aCwgbmV3Vmlld10pLCBFbWJlci5WaWV3LmRldGVj
dChuZXdWaWV3KSB8fCBFbWJlci5WaWV3LmRldGVjdEluc3RhbmNlKG5ld1ZpZXcpKTsKCiAgICB2
YXIgdmlld09wdGlvbnMgPSB0aGlzLnByb3BlcnRpZXNGcm9tSFRNTE9wdGlvbnMob3B0aW9ucywg
dGhpc0NvbnRleHQpOwogICAgdmFyIGN1cnJlbnRWaWV3ID0gZGF0YS52aWV3OwogICAgdmlld09w
dGlvbnMudGVtcGxhdGVEYXRhID0gZGF0YTsKICAgIHZhciBuZXdWaWV3UHJvdG8gPSBuZXdWaWV3
LnByb3RvID8gbmV3Vmlldy5wcm90bygpIDogbmV3VmlldzsKCiAgICBpZiAoZm4pIHsKICAgICAg
RW1iZXIuYXNzZXJ0KCJZb3UgY2Fubm90IHByb3ZpZGUgYSB0ZW1wbGF0ZSBibG9jayBpZiB5b3Ug
YWxzbyBzcGVjaWZpZWQgYSB0ZW1wbGF0ZU5hbWUiLCAhZ2V0KHZpZXdPcHRpb25zLCAndGVtcGxh
dGVOYW1lJykgJiYgIWdldChuZXdWaWV3UHJvdG8sICd0ZW1wbGF0ZU5hbWUnKSk7CiAgICAgIHZp
ZXdPcHRpb25zLnRlbXBsYXRlID0gZm47CiAgICB9CgogICAgLy8gV2Ugb25seSB3YW50IHRvIG92
ZXJyaWRlIHRoZSBgX2NvbnRleHRgIGNvbXB1dGVkIHByb3BlcnR5IGlmIHRoZXJlIGlzCiAgICAv
LyBubyBzcGVjaWZpZWQgY29udHJvbGxlci4gU2VlIFZpZXcjX2NvbnRleHQgZm9yIG1vcmUgaW5m
b3JtYXRpb24uCiAgICBpZiAoIW5ld1ZpZXdQcm90by5jb250cm9sbGVyICYmICFuZXdWaWV3UHJv
dG8uY29udHJvbGxlckJpbmRpbmcgJiYgIXZpZXdPcHRpb25zLmNvbnRyb2xsZXIgJiYgIXZpZXdP
cHRpb25zLmNvbnRyb2xsZXJCaW5kaW5nKSB7CiAgICAgIHZpZXdPcHRpb25zLl9jb250ZXh0ID0g
dGhpc0NvbnRleHQ7CiAgICB9CgogICAgY3VycmVudFZpZXcuYXBwZW5kQ2hpbGQobmV3Vmlldywg
dmlld09wdGlvbnMpOwogIH0KfSk7CgovKioKICBge3t2aWV3fX1gIGluc2VydHMgYSBuZXcgaW5z
dGFuY2Ugb2YgYEVtYmVyLlZpZXdgIGludG8gYSB0ZW1wbGF0ZSBwYXNzaW5nIGl0cwogIG9wdGlv
bnMgdG8gdGhlIGBFbWJlci5WaWV3YCdzIGBjcmVhdGVgIG1ldGhvZCBhbmQgdXNpbmcgdGhlIHN1
cHBsaWVkIGJsb2NrIGFzCiAgdGhlIHZpZXcncyBvd24gdGVtcGxhdGUuCgogIEFuIGVtcHR5IGA8
Ym9keT5gIGFuZCB0aGUgZm9sbG93aW5nIHRlbXBsYXRlOgoKICBgYGBoYW5kbGViYXJzCiAgQSBz
cGFuOgogIHt7I3ZpZXcgdGFnTmFtZT0ic3BhbiJ9fQogICAgaGVsbG8uCiAge3svdmlld319CiAg
YGBgCgogIFdpbGwgcmVzdWx0IGluIEhUTUwgc3RydWN0dXJlOgoKICBgYGBodG1sCiAgPGJvZHk+
CiAgICA8IS0tIE5vdGU6IHRoZSBoYW5kbGViYXJzIHRlbXBsYXRlIHNjcmlwdAogICAgICAgICBh
bHNvIHJlc3VsdHMgaW4gYSByZW5kZXJlZCBFbWJlci5WaWV3CiAgICAgICAgIHdoaWNoIGlzIHRo
ZSBvdXRlciA8ZGl2PiBoZXJlIC0tPgoKICAgIDxkaXYgY2xhc3M9ImVtYmVyLXZpZXciPgogICAg
ICBBIHNwYW46CiAgICAgIDxzcGFuIGlkPSJlbWJlcjEiIGNsYXNzPSJlbWJlci12aWV3Ij4KICAg
ICAgICBIZWxsby4KICAgICAgPC9zcGFuPgogICAgPC9kaXY+CiAgPC9ib2R5PgogIGBgYAoKICAj
IyMgYHBhcmVudFZpZXdgIHNldHRpbmcKCiAgVGhlIGBwYXJlbnRWaWV3YCBwcm9wZXJ0eSBvZiB0
aGUgbmV3IGBFbWJlci5WaWV3YCBpbnN0YW5jZSBjcmVhdGVkIHRocm91Z2gKICBge3t2aWV3fX1g
IHdpbGwgYmUgc2V0IHRvIHRoZSBgRW1iZXIuVmlld2AgaW5zdGFuY2Ugb2YgdGhlIHRlbXBsYXRl
IHdoZXJlCiAgYHt7dmlld319YCB3YXMgY2FsbGVkLgoKICBgYGBqYXZhc2NyaXB0CiAgYVZpZXcg
PSBFbWJlci5WaWV3LmNyZWF0ZSh7CiAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21w
aWxlKCJ7eyN2aWV3fX0gbXkgcGFyZW50OiB7e3BhcmVudFZpZXcuZWxlbWVudElkfX0ge3svdmll
d319IikKICB9KTsKCiAgYVZpZXcuYXBwZW5kVG8oJ2JvZHknKTsKICBgYGAKCiAgV2lsbCByZXN1
bHQgaW4gSFRNTCBzdHJ1Y3R1cmU6CgogIGBgYGh0bWwKICA8ZGl2IGlkPSJlbWJlcjEiIGNsYXNz
PSJlbWJlci12aWV3Ij4KICAgIDxkaXYgaWQ9ImVtYmVyMiIgY2xhc3M9ImVtYmVyLXZpZXciPgog
ICAgICBteSBwYXJlbnQ6IGVtYmVyMQogICAgPC9kaXY+CiAgPC9kaXY+CiAgYGBgCgogICMjIyBT
ZXR0aW5nIENTUyBpZCBhbmQgY2xhc3MgYXR0cmlidXRlcwoKICBUaGUgSFRNTCBgaWRgIGF0dHJp
YnV0ZSBjYW4gYmUgc2V0IG9uIHRoZSBge3t2aWV3fX1gJ3MgcmVzdWx0aW5nIGVsZW1lbnQgd2l0
aAogIHRoZSBgaWRgIG9wdGlvbi4gVGhpcyBvcHRpb24gd2lsbCBfbm90XyBiZSBwYXNzZWQgdG8g
YEVtYmVyLlZpZXcuY3JlYXRlYC4KCiAgYGBgaGFuZGxlYmFycwogIHt7I3ZpZXcgdGFnTmFtZT0i
c3BhbiIgaWQ9ImEtY3VzdG9tLWlkIn19CiAgICBoZWxsby4KICB7ey92aWV3fX0KICBgYGAKCiAg
UmVzdWx0cyBpbiB0aGUgZm9sbG93aW5nIEhUTUwgc3RydWN0dXJlOgoKICBgYGBodG1sCiAgPGRp
diBjbGFzcz0iZW1iZXItdmlldyI+CiAgICA8c3BhbiBpZD0iYS1jdXN0b20taWQiIGNsYXNzPSJl
bWJlci12aWV3Ij4KICAgICAgaGVsbG8uCiAgICA8L3NwYW4+CiAgPC9kaXY+CiAgYGBgCgogIFRo
ZSBIVE1MIGBjbGFzc2AgYXR0cmlidXRlIGNhbiBiZSBzZXQgb24gdGhlIGB7e3ZpZXd9fWAncyBy
ZXN1bHRpbmcgZWxlbWVudAogIHdpdGggdGhlIGBjbGFzc2Agb3IgYGNsYXNzTmFtZUJpbmRpbmdz
YCBvcHRpb25zLiBUaGUgYGNsYXNzYCBvcHRpb24gd2lsbAogIGRpcmVjdGx5IHNldCB0aGUgQ1NT
IGBjbGFzc2AgYXR0cmlidXRlIGFuZCB3aWxsIG5vdCBiZSBwYXNzZWQgdG8KICBgRW1iZXIuVmll
dy5jcmVhdGVgLiBgY2xhc3NOYW1lQmluZGluZ3NgIHdpbGwgYmUgcGFzc2VkIHRvIGBjcmVhdGVg
IGFuZCB1c2UKICBgRW1iZXIuVmlld2AncyBjbGFzcyBuYW1lIGJpbmRpbmcgZnVuY3Rpb25hbGl0
eToKCiAgYGBgaGFuZGxlYmFycwogIHt7I3ZpZXcgdGFnTmFtZT0ic3BhbiIgY2xhc3M9ImEtY3Vz
dG9tLWNsYXNzIn19CiAgICBoZWxsby4KICB7ey92aWV3fX0KICBgYGAKCiAgUmVzdWx0cyBpbiB0
aGUgZm9sbG93aW5nIEhUTUwgc3RydWN0dXJlOgoKICBgYGBodG1sCiAgPGRpdiBjbGFzcz0iZW1i
ZXItdmlldyI+CiAgICA8c3BhbiBpZD0iZW1iZXIyIiBjbGFzcz0iZW1iZXItdmlldyBhLWN1c3Rv
bS1jbGFzcyI+CiAgICAgIGhlbGxvLgogICAgPC9zcGFuPgogIDwvZGl2PgogIGBgYAoKICAjIyMg
U3VwcGx5aW5nIGEgZGlmZmVyZW50IHZpZXcgY2xhc3MKCiAgYHt7dmlld319YCBjYW4gdGFrZSBh
biBvcHRpb25hbCBmaXJzdCBhcmd1bWVudCBiZWZvcmUgaXRzIHN1cHBsaWVkIG9wdGlvbnMgdG8K
ICBzcGVjaWZ5IGEgcGF0aCB0byBhIGN1c3RvbSB2aWV3IGNsYXNzLgoKICBgYGBoYW5kbGViYXJz
CiAge3sjdmlldyAiTXlBcHAuQ3VzdG9tVmlldyJ9fQogICAgaGVsbG8uCiAge3svdmlld319CiAg
YGBgCgogIFRoZSBmaXJzdCBhcmd1bWVudCBjYW4gYWxzbyBiZSBhIHJlbGF0aXZlIHBhdGggYWNj
ZXNzaWJsZSBmcm9tIHRoZSBjdXJyZW50CiAgY29udGV4dC4KCiAgYGBgamF2YXNjcmlwdAogIE15
QXBwID0gRW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKHt9KTsKICBNeUFwcC5PdXRlclZpZXcgPSBF
bWJlci5WaWV3LmV4dGVuZCh7CiAgICBpbm5lclZpZXdDbGFzczogRW1iZXIuVmlldy5leHRlbmQo
ewogICAgICBjbGFzc05hbWVzOiBbJ2EtY3VzdG9tLXZpZXctY2xhc3MtYXMtcHJvcGVydHknXQog
ICAgfSksCiAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCd7eyN2aWV3ICJ2
aWV3LmlubmVyVmlld0NsYXNzIn19IGhpIHt7L3ZpZXd9fScpCiAgfSk7CgogIE15QXBwLk91dGVy
Vmlldy5jcmVhdGUoKS5hcHBlbmRUbygnYm9keScpOwogIGBgYAoKICBXaWxsIHJlc3VsdCBpbiB0
aGUgZm9sbG93aW5nIEhUTUw6CgogIGBgYGh0bWwKICA8ZGl2IGlkPSJlbWJlcjEiIGNsYXNzPSJl
bWJlci12aWV3Ij4KICAgIDxkaXYgaWQ9ImVtYmVyMiIgY2xhc3M9ImVtYmVyLXZpZXcgYS1jdXN0
b20tdmlldy1jbGFzcy1hcy1wcm9wZXJ0eSI+CiAgICAgIGhpCiAgICA8L2Rpdj4KICA8L2Rpdj4K
ICBgYGAKCiAgIyMjIEJsb2NrbGVzcyB1c2UKCiAgSWYgeW91IHN1cHBseSBhIGN1c3RvbSBgRW1i
ZXIuVmlld2Agc3ViY2xhc3MgdGhhdCBzcGVjaWZpZXMgaXRzIG93biB0ZW1wbGF0ZQogIG9yIHBy
b3ZpZGUgYSBgdGVtcGxhdGVOYW1lYCBvcHRpb24gdG8gYHt7dmlld319YCBpdCBjYW4gYmUgdXNl
ZCB3aXRob3V0CiAgc3VwcGx5aW5nIGEgYmxvY2suIEF0dGVtcHRzIHRvIHVzZSBib3RoIGEgYHRl
bXBsYXRlTmFtZWAgb3B0aW9uIGFuZCBzdXBwbHkgYQogIGJsb2NrIHdpbGwgdGhyb3cgYW4gZXJy
b3IuCgogIGBgYGhhbmRsZWJhcnMKICB7e3ZpZXcgIk15QXBwLlZpZXdXaXRoQVRlbXBsYXRlRGVm
aW5lZCJ9fQogIGBgYAoKICAjIyMgYHZpZXdOYW1lYCBwcm9wZXJ0eQoKICBZb3UgY2FuIHN1cHBs
eSBhIGB2aWV3TmFtZWAgb3B0aW9uIHRvIGB7e3ZpZXd9fWAuIFRoZSBgRW1iZXIuVmlld2AgaW5z
dGFuY2UKICB3aWxsIGJlIHJlZmVyZW5jZWQgYXMgYSBwcm9wZXJ0eSBvZiBpdHMgcGFyZW50IHZp
ZXcgYnkgdGhpcyBuYW1lLgoKICBgYGBqYXZhc2NyaXB0CiAgYVZpZXcgPSBFbWJlci5WaWV3LmNy
ZWF0ZSh7CiAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCd7eyN2aWV3IHZp
ZXdOYW1lPSJhQ2hpbGRCeU5hbWUifX0gaGkge3svdmlld319JykKICB9KTsKCiAgYVZpZXcuYXBw
ZW5kVG8oJ2JvZHknKTsKICBhVmlldy5nZXQoJ2FDaGlsZEJ5TmFtZScpIC8vIHRoZSBpbnN0YW5j
ZSBvZiBFbWJlci5WaWV3IGNyZWF0ZWQgYnkge3t2aWV3fX0gaGVscGVyCiAgYGBgCgogIEBtZXRo
b2QgdmlldwogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtTdHJpbmd9
IHBhdGgKICBAcGFyYW0ge0hhc2h9IG9wdGlvbnMKICBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3Ry
aW5nCiovCkVtYmVySGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcigndmlldycsIGZ1bmN0aW9uIHZp
ZXdIZWxwZXIocGF0aCwgb3B0aW9ucykgewogIEVtYmVyLmFzc2VydCgiVGhlIHZpZXcgaGVscGVy
IG9ubHkgdGFrZXMgYSBzaW5nbGUgYXJndW1lbnQiLCBhcmd1bWVudHMubGVuZ3RoIDw9IDIpOwoK
ICAvLyBJZiBubyBwYXRoIGlzIHByb3ZpZGVkLCB0cmVhdCBwYXRoIHBhcmFtIGFzIG9wdGlvbnMu
CiAgaWYgKHBhdGggJiYgcGF0aC5kYXRhICYmIHBhdGguZGF0YS5pc1JlbmRlckRhdGEpIHsKICAg
IG9wdGlvbnMgPSBwYXRoOwogICAgcGF0aCA9ICJFbWJlci5WaWV3IjsKICB9CgogIHJldHVybiBF
bWJlckhhbmRsZWJhcnMuVmlld0hlbHBlci5oZWxwZXIodGhpcywgcGF0aCwgb3B0aW9ucyk7Cn0p
OwoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLy8gVE9ETzogRG9uJ3QgcmVxdWlyZSBhbGwgb2Yg
dGhpcyBtb2R1bGUKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1oYW5kbGViYXJz
CiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBoYW5kbGViYXJzR2V0ID0gRW1iZXIuSGFuZGxlYmFy
cy5nZXQsIGZtdCA9IEVtYmVyLlN0cmluZy5mbXQ7CgovKioKICBge3tjb2xsZWN0aW9ufX1gIGlz
IGEgYEVtYmVyLkhhbmRsZWJhcnNgIGhlbHBlciBmb3IgYWRkaW5nIGluc3RhbmNlcyBvZgogIGBF
bWJlci5Db2xsZWN0aW9uVmlld2AgdG8gYSB0ZW1wbGF0ZS4gU2VlIFtFbWJlci5Db2xsZWN0aW9u
Vmlld10oL2FwaS9jbGFzc2VzL0VtYmVyLkNvbGxlY3Rpb25WaWV3Lmh0bWwpCiAgIGZvciBhZGRp
dGlvbmFsIGluZm9ybWF0aW9uIG9uIGhvdyBhIGBDb2xsZWN0aW9uVmlld2AgZnVuY3Rpb25zLgoK
ICBge3tjb2xsZWN0aW9ufX1gJ3MgcHJpbWFyeSB1c2UgaXMgYXMgYSBibG9jayBoZWxwZXIgd2l0
aCBhIGBjb250ZW50QmluZGluZ2AKICBvcHRpb24gcG9pbnRpbmcgdG93YXJkcyBhbiBgRW1iZXIu
QXJyYXlgLWNvbXBhdGlibGUgb2JqZWN0LiBBbiBgRW1iZXIuVmlld2AKICBpbnN0YW5jZSB3aWxs
IGJlIGNyZWF0ZWQgZm9yIGVhY2ggaXRlbSBpbiBpdHMgYGNvbnRlbnRgIHByb3BlcnR5LiBFYWNo
IHZpZXcKICB3aWxsIGhhdmUgaXRzIG93biBgY29udGVudGAgcHJvcGVydHkgc2V0IHRvIHRoZSBh
cHByb3ByaWF0ZSBpdGVtIGluIHRoZQogIGNvbGxlY3Rpb24uCgogIFRoZSBwcm92aWRlZCBibG9j
ayB3aWxsIGJlIGFwcGxpZWQgYXMgdGhlIHRlbXBsYXRlIGZvciBlYWNoIGl0ZW0ncyB2aWV3LgoK
ICBHaXZlbiBhbiBlbXB0eSBgPGJvZHk+YCB0aGUgZm9sbG93aW5nIHRlbXBsYXRlOgoKICBgYGBo
YW5kbGViYXJzCiAge3sjY29sbGVjdGlvbiBjb250ZW50QmluZGluZz0iQXBwLml0ZW1zIn19CiAg
ICBIaSB7e3ZpZXcuY29udGVudC5uYW1lfX0KICB7ey9jb2xsZWN0aW9ufX0KICBgYGAKCiAgQW5k
IHRoZSBmb2xsb3dpbmcgYXBwbGljYXRpb24gY29kZQoKICBgYGBqYXZhc2NyaXB0CiAgQXBwID0g
RW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKCkKICBBcHAuaXRlbXMgPSBbCiAgICBFbWJlci5PYmpl
Y3QuY3JlYXRlKHtuYW1lOiAnRGF2ZSd9KSwKICAgIEVtYmVyLk9iamVjdC5jcmVhdGUoe25hbWU6
ICdNYXJ5J30pLAogICAgRW1iZXIuT2JqZWN0LmNyZWF0ZSh7bmFtZTogJ1NhcmEnfSkKICBdCiAg
YGBgCgogIFdpbGwgcmVzdWx0IGluIHRoZSBIVE1MIHN0cnVjdHVyZSBiZWxvdwoKICBgYGBodG1s
CiAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5I
aSBEYXZlPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5IaSBNYXJ5PC9kaXY+CiAg
ICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij5IaSBTYXJhPC9kaXY+CiAgPC9kaXY+CiAgYGBgCgog
ICMjIyBCbG9ja2xlc3MgVXNlCgogIElmIHlvdSBwcm92aWRlIGFuIGBpdGVtVmlld0NsYXNzYCBv
cHRpb24gdGhhdCBoYXMgaXRzIG93biBgdGVtcGxhdGVgIHlvdSBjYW4KICBvbWl0IHRoZSBibG9j
ay4KCiAgVGhlIGZvbGxvd2luZyB0ZW1wbGF0ZToKCiAgYGBgaGFuZGxlYmFycwogIHt7Y29sbGVj
dGlvbiBjb250ZW50QmluZGluZz0iQXBwLml0ZW1zIiBpdGVtVmlld0NsYXNzPSJBcHAuQW5JdGVt
VmlldyJ9fQogIGBgYAoKICBBbmQgYXBwbGljYXRpb24gY29kZQoKICBgYGBqYXZhc2NyaXB0CiAg
QXBwID0gRW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKCk7CiAgQXBwLml0ZW1zID0gWwogICAgRW1i
ZXIuT2JqZWN0LmNyZWF0ZSh7bmFtZTogJ0RhdmUnfSksCiAgICBFbWJlci5PYmplY3QuY3JlYXRl
KHtuYW1lOiAnTWFyeSd9KSwKICAgIEVtYmVyLk9iamVjdC5jcmVhdGUoe25hbWU6ICdTYXJhJ30p
CiAgXTsKCiAgQXBwLkFuSXRlbVZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICB0ZW1wbGF0
ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCJHcmVldGluZ3Mge3t2aWV3LmNvbnRlbnQubmFt
ZX19IikKICB9KTsKICBgYGAKCiAgV2lsbCByZXN1bHQgaW4gdGhlIEhUTUwgc3RydWN0dXJlIGJl
bG93CgogIGBgYGh0bWwKICA8ZGl2IGNsYXNzPSJlbWJlci12aWV3Ij4KICAgIDxkaXYgY2xhc3M9
ImVtYmVyLXZpZXciPkdyZWV0aW5ncyBEYXZlPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJlbWJlci12
aWV3Ij5HcmVldGluZ3MgTWFyeTwvZGl2PgogICAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+R3Jl
ZXRpbmdzIFNhcmE8L2Rpdj4KICA8L2Rpdj4KICBgYGAKCiAgIyMjIFNwZWNpZnlpbmcgYSBDb2xs
ZWN0aW9uVmlldyBzdWJjbGFzcwoKICBCeSBkZWZhdWx0IHRoZSBge3tjb2xsZWN0aW9ufX1gIGhl
bHBlciB3aWxsIGNyZWF0ZSBhbiBpbnN0YW5jZSBvZgogIGBFbWJlci5Db2xsZWN0aW9uVmlld2Au
IFlvdSBjYW4gc3VwcGx5IGEgYEVtYmVyLkNvbGxlY3Rpb25WaWV3YCBzdWJjbGFzcyB0bwogIHRo
ZSBoZWxwZXIgYnkgcGFzc2luZyBpdCBhcyB0aGUgZmlyc3QgYXJndW1lbnQ6CgogIGBgYGhhbmRs
ZWJhcnMKICB7eyNjb2xsZWN0aW9uIEFwcC5NeUN1c3RvbUNvbGxlY3Rpb25DbGFzcyBjb250ZW50
QmluZGluZz0iQXBwLml0ZW1zIn19CiAgICBIaSB7e3ZpZXcuY29udGVudC5uYW1lfX0KICB7ey9j
b2xsZWN0aW9ufX0KICBgYGAKCiAgIyMjIEZvcndhcmRlZCBgaXRlbS4qYC1uYW1lZCBPcHRpb25z
CgogIEFzIHdpdGggdGhlIGB7e3ZpZXd9fWAsIGhlbHBlciBvcHRpb25zIHBhc3NlZCB0byB0aGUg
YHt7Y29sbGVjdGlvbn19YCB3aWxsIGJlCiAgc2V0IG9uIHRoZSByZXN1bHRpbmcgYEVtYmVyLkNv
bGxlY3Rpb25WaWV3YCBhcyBwcm9wZXJ0aWVzLiBBZGRpdGlvbmFsbHksCiAgb3B0aW9ucyBwcmVm
aXhlZCB3aXRoIGBpdGVtYCB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIHZpZXdzIHJlbmRlcmVkIGZv
ciBlYWNoCiAgaXRlbSAobm90ZSB0aGUgY2FtZWxjYXNpbmcpOgoKICBgYGBoYW5kbGViYXJzCiAg
e3sjY29sbGVjdGlvbiBjb250ZW50QmluZGluZz0iQXBwLml0ZW1zIgogICAgICAgICAgICAgICAg
aXRlbVRhZ05hbWU9InAiCiAgICAgICAgICAgICAgICBpdGVtQ2xhc3NOYW1lcz0iZ3JlZXRpbmci
fX0KICAgIEhvd2R5IHt7dmlldy5jb250ZW50Lm5hbWV9fQogIHt7L2NvbGxlY3Rpb259fQogIGBg
YAoKICBXaWxsIHJlc3VsdCBpbiB0aGUgZm9sbG93aW5nIEhUTUwgc3RydWN0dXJlOgoKICBgYGBo
dG1sCiAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+CiAgICA8cCBjbGFzcz0iZW1iZXItdmlldyBn
cmVldGluZyI+SG93ZHkgRGF2ZTwvcD4KICAgIDxwIGNsYXNzPSJlbWJlci12aWV3IGdyZWV0aW5n
Ij5Ib3dkeSBNYXJ5PC9wPgogICAgPHAgY2xhc3M9ImVtYmVyLXZpZXcgZ3JlZXRpbmciPkhvd2R5
IFNhcmE8L3A+CiAgPC9kaXY+CiAgYGBgCgogIEBtZXRob2QgY29sbGVjdGlvbgogIEBmb3IgRW1i
ZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtTdHJpbmd9IHBhdGgKICBAcGFyYW0ge0hh
c2h9IG9wdGlvbnMKICBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nCiAgQGRlcHJlY2F0ZWQg
VXNlIGB7e2VhY2h9fWAgaGVscGVyIGluc3RlYWQuCiovCkVtYmVyLkhhbmRsZWJhcnMucmVnaXN0
ZXJIZWxwZXIoJ2NvbGxlY3Rpb24nLCBmdW5jdGlvbiBjb2xsZWN0aW9uSGVscGVyKHBhdGgsIG9w
dGlvbnMpIHsKICBFbWJlci5kZXByZWNhdGUoIlVzaW5nIHRoZSB7e2NvbGxlY3Rpb259fSBoZWxw
ZXIgd2l0aG91dCBzcGVjaWZ5aW5nIGEgY2xhc3MgaGFzIGJlZW4gZGVwcmVjYXRlZCBhcyB0aGUg
e3tlYWNofX0gaGVscGVyIG5vdyBzdXBwb3J0cyB0aGUgc2FtZSBmdW5jdGlvbmFsaXR5LiIsIHBh
dGggIT09ICdjb2xsZWN0aW9uJyk7CgogIC8vIElmIG5vIHBhdGggaXMgcHJvdmlkZWQsIHRyZWF0
IHBhdGggcGFyYW0gYXMgb3B0aW9ucy4KICBpZiAocGF0aCAmJiBwYXRoLmRhdGEgJiYgcGF0aC5k
YXRhLmlzUmVuZGVyRGF0YSkgewogICAgb3B0aW9ucyA9IHBhdGg7CiAgICBwYXRoID0gdW5kZWZp
bmVkOwogICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2Fubm90IHBhc3MgbW9yZSB0aGFuIG9uZSBhcmd1
bWVudCB0byB0aGUgY29sbGVjdGlvbiBoZWxwZXIiLCBhcmd1bWVudHMubGVuZ3RoID09PSAxKTsK
ICB9IGVsc2UgewogICAgRW1iZXIuYXNzZXJ0KCJZb3UgY2Fubm90IHBhc3MgbW9yZSB0aGFuIG9u
ZSBhcmd1bWVudCB0byB0aGUgY29sbGVjdGlvbiBoZWxwZXIiLCBhcmd1bWVudHMubGVuZ3RoID09
PSAyKTsKICB9CgogIHZhciBmbiA9IG9wdGlvbnMuZm47CiAgdmFyIGRhdGEgPSBvcHRpb25zLmRh
dGE7CiAgdmFyIGludmVyc2UgPSBvcHRpb25zLmludmVyc2U7CiAgdmFyIHZpZXcgPSBvcHRpb25z
LmRhdGEudmlldzsKCiAgLy8gSWYgcGFzc2VkIGEgcGF0aCBzdHJpbmcsIGNvbnZlcnQgdGhhdCBp
bnRvIGFuIG9iamVjdC4KICAvLyBPdGhlcndpc2UsIGp1c3QgZGVmYXVsdCB0byB0aGUgc3RhbmRh
cmQgY2xhc3MuCiAgdmFyIGNvbGxlY3Rpb25DbGFzczsKICBjb2xsZWN0aW9uQ2xhc3MgPSBwYXRo
ID8gaGFuZGxlYmFyc0dldCh0aGlzLCBwYXRoLCBvcHRpb25zKSA6IEVtYmVyLkNvbGxlY3Rpb25W
aWV3OwogIEVtYmVyLmFzc2VydChmbXQoIiVAICNjb2xsZWN0aW9uOiBDb3VsZCBub3QgZmluZCBj
b2xsZWN0aW9uIGNsYXNzICVAIiwgW2RhdGEudmlldywgcGF0aF0pLCAhIWNvbGxlY3Rpb25DbGFz
cyk7CgogIHZhciBoYXNoID0gb3B0aW9ucy5oYXNoLCBpdGVtSGFzaCA9IHt9LCBtYXRjaDsKCiAg
Ly8gRXh0cmFjdCBpdGVtIHZpZXcgY2xhc3MgaWYgcHJvdmlkZWQgZWxzZSBkZWZhdWx0IHRvIHRo
ZSBzdGFuZGFyZCBjbGFzcwogIHZhciBjb2xsZWN0aW9uUHJvdG90eXBlID0gY29sbGVjdGlvbkNs
YXNzLnByb3RvKCksCiAgICAgIGl0ZW1WaWV3Q2xhc3M7CgogIGlmIChoYXNoLml0ZW1WaWV3KSB7
CiAgICB2YXIgY29udHJvbGxlciA9IGRhdGEua2V5d29yZHMuY29udHJvbGxlcjsKICAgIEVtYmVy
LmFzc2VydCgnWW91IHNwZWNpZmllZCBhbiBpdGVtVmlldywgYnV0IHRoZSBjdXJyZW50IGNvbnRl
eHQgaGFzIG5vICcgKwogICAgICAgICAgICAgICAgICdjb250YWluZXIgdG8gbG9vayB0aGUgaXRl
bVZpZXcgdXAgaW4uIFRoaXMgcHJvYmFibHkgbWVhbnMgJyArCiAgICAgICAgICAgICAgICAgJ3Ro
YXQgeW91IGNyZWF0ZWQgYSB2aWV3IG1hbnVhbGx5LCBpbnN0ZWFkIG9mIHRocm91Z2ggdGhlICcg
KwogICAgICAgICAgICAgICAgICdjb250YWluZXIuIEluc3RlYWQsIHVzZSBjb250YWluZXIubG9v
a3VwKCJ2aWV3OnZpZXdOYW1lIiksICcgKwogICAgICAgICAgICAgICAgICd3aGljaCB3aWxsIHBy
b3Blcmx5IGluc3RhbnRpYXRlIHlvdXIgdmlldy4nLAogICAgICAgICAgICAgICAgIGNvbnRyb2xs
ZXIgJiYgY29udHJvbGxlci5jb250YWluZXIpOwogICAgdmFyIGNvbnRhaW5lciA9IGNvbnRyb2xs
ZXIuY29udGFpbmVyOwogICAgaXRlbVZpZXdDbGFzcyA9IGNvbnRhaW5lci5yZXNvbHZlKCd2aWV3
OicgKyBoYXNoLml0ZW1WaWV3KTsKICAgIEVtYmVyLmFzc2VydCgnWW91IHNwZWNpZmllZCB0aGUg
aXRlbVZpZXcgJyArIGhhc2guaXRlbVZpZXcgKyAiLCBidXQgaXQgd2FzICIgKwogICAgICAgICAg
ICAgICAgICJub3QgZm91bmQgYXQgIiArIGNvbnRhaW5lci5kZXNjcmliZSgidmlldzoiICsgaGFz
aC5pdGVtVmlldykgKwogICAgICAgICAgICAgICAgICIgKGFuZCBpdCB3YXMgbm90IHJlZ2lzdGVy
ZWQgaW4gdGhlIGNvbnRhaW5lcikiLCAhIWl0ZW1WaWV3Q2xhc3MpOwogIH0gZWxzZSBpZiAoaGFz
aC5pdGVtVmlld0NsYXNzKSB7CiAgICBpdGVtVmlld0NsYXNzID0gaGFuZGxlYmFyc0dldChjb2xs
ZWN0aW9uUHJvdG90eXBlLCBoYXNoLml0ZW1WaWV3Q2xhc3MsIG9wdGlvbnMpOwogIH0gZWxzZSB7
CiAgICBpdGVtVmlld0NsYXNzID0gY29sbGVjdGlvblByb3RvdHlwZS5pdGVtVmlld0NsYXNzOwog
IH0KCiAgRW1iZXIuYXNzZXJ0KGZtdCgiJUAgI2NvbGxlY3Rpb246IENvdWxkIG5vdCBmaW5kIGl0
ZW1WaWV3Q2xhc3MgJUAiLCBbZGF0YS52aWV3LCBpdGVtVmlld0NsYXNzXSksICEhaXRlbVZpZXdD
bGFzcyk7CgogIGRlbGV0ZSBoYXNoLml0ZW1WaWV3Q2xhc3M7CiAgZGVsZXRlIGhhc2guaXRlbVZp
ZXc7CgogIC8vIEdvIHRocm91Z2ggb3B0aW9ucyBwYXNzZWQgdG8gdGhlIHt7Y29sbGVjdGlvbn19
IGhlbHBlciBhbmQgZXh0cmFjdCBvcHRpb25zCiAgLy8gdGhhdCBjb25maWd1cmUgaXRlbSB2aWV3
cyBpbnN0ZWFkIG9mIHRoZSBjb2xsZWN0aW9uIGl0c2VsZi4KICBmb3IgKHZhciBwcm9wIGluIGhh
c2gpIHsKICAgIGlmIChoYXNoLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgIG1hdGNoID0g
cHJvcC5tYXRjaCgvXml0ZW0oLikoLiopJC8pOwoKICAgICAgaWYgKG1hdGNoICYmIHByb3AgIT09
ICdpdGVtQ29udHJvbGxlcicpIHsKICAgICAgICAvLyBDb252ZXJ0IGl0ZW1TaG91bGRGb28gLT4g
c2hvdWxkRm9vCiAgICAgICAgaXRlbUhhc2hbbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSArIG1hdGNo
WzJdXSA9IGhhc2hbcHJvcF07CiAgICAgICAgLy8gRGVsZXRlIGZyb20gaGFzaCBhcyB0aGlzIHdp
bGwgZW5kIHVwIGdldHRpbmcgcGFzc2VkIHRvIHRoZQogICAgICAgIC8vIHt7dmlld319IGhlbHBl
ciBtZXRob2QuCiAgICAgICAgZGVsZXRlIGhhc2hbcHJvcF07CiAgICAgIH0KICAgIH0KICB9Cgog
IGlmIChmbikgewogICAgaXRlbUhhc2gudGVtcGxhdGUgPSBmbjsKICAgIGRlbGV0ZSBvcHRpb25z
LmZuOwogIH0KCiAgdmFyIGVtcHR5Vmlld0NsYXNzOwogIGlmIChpbnZlcnNlICYmIGludmVyc2Ug
IT09IEVtYmVyLkhhbmRsZWJhcnMuVk0ubm9vcCkgewogICAgZW1wdHlWaWV3Q2xhc3MgPSBnZXQo
Y29sbGVjdGlvblByb3RvdHlwZSwgJ2VtcHR5Vmlld0NsYXNzJyk7CiAgICBlbXB0eVZpZXdDbGFz
cyA9IGVtcHR5Vmlld0NsYXNzLmV4dGVuZCh7CiAgICAgICAgICB0ZW1wbGF0ZTogaW52ZXJzZSwK
ICAgICAgICAgIHRhZ05hbWU6IGl0ZW1IYXNoLnRhZ05hbWUKICAgIH0pOwogIH0gZWxzZSBpZiAo
aGFzaC5lbXB0eVZpZXdDbGFzcykgewogICAgZW1wdHlWaWV3Q2xhc3MgPSBoYW5kbGViYXJzR2V0
KHRoaXMsIGhhc2guZW1wdHlWaWV3Q2xhc3MsIG9wdGlvbnMpOwogIH0KICBpZiAoZW1wdHlWaWV3
Q2xhc3MpIHsgaGFzaC5lbXB0eVZpZXcgPSBlbXB0eVZpZXdDbGFzczsgfQoKICBpZiAoIWhhc2gu
a2V5d29yZCkgewogICAgaXRlbUhhc2guX2NvbnRleHQgPSBFbWJlci5jb21wdXRlZC5hbGlhcygn
Y29udGVudCcpOwogIH0KCiAgdmFyIHZpZXdPcHRpb25zID0gRW1iZXIuSGFuZGxlYmFycy5WaWV3
SGVscGVyLnByb3BlcnRpZXNGcm9tSFRNTE9wdGlvbnMoeyBkYXRhOiBkYXRhLCBoYXNoOiBpdGVt
SGFzaCB9LCB0aGlzKTsKICBoYXNoLml0ZW1WaWV3Q2xhc3MgPSBpdGVtVmlld0NsYXNzLmV4dGVu
ZCh2aWV3T3B0aW9ucyk7CgogIHJldHVybiBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMudmlldy5j
YWxsKHRoaXMsIGNvbGxlY3Rpb25DbGFzcywgb3B0aW9ucyk7Cn0pOwoKCn0pKCk7CgoKCihmdW5j
dGlvbigpIHsKLypnbG9iYWxzIEhhbmRsZWJhcnMgKi8KLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1v
ZHVsZSBlbWJlci1oYW5kbGViYXJzCiovCgp2YXIgaGFuZGxlYmFyc0dldCA9IEVtYmVyLkhhbmRs
ZWJhcnMuZ2V0OwoKLyoqCiAgYHVuYm91bmRgIGFsbG93cyB5b3UgdG8gb3V0cHV0IGEgcHJvcGVy
dHkgd2l0aG91dCBiaW5kaW5nLiAqSW1wb3J0YW50OiogVGhlCiAgb3V0cHV0IHdpbGwgbm90IGJl
IHVwZGF0ZWQgaWYgdGhlIHByb3BlcnR5IGNoYW5nZXMuIFVzZSB3aXRoIGNhdXRpb24uCgogIGBg
YGhhbmRsZWJhcnMKICA8ZGl2Pnt7dW5ib3VuZCBzb21lUHJvcGVydHlUaGF0RG9lc250Q2hhbmdl
fX08L2Rpdj4KICBgYGAKCiAgYHVuYm91bmRgIGNhbiBhbHNvIGJlIHVzZWQgaW4gY29uanVuY3Rp
b24gd2l0aCBhIGJvdW5kIGhlbHBlciB0bwogIHJlbmRlciBpdCBpbiBpdHMgdW5ib3VuZCBmb3Jt
OgoKICBgYGBoYW5kbGViYXJzCiAgPGRpdj57e3VuYm91bmQgaGVscGVyTmFtZSBzb21lUHJvcGVy
dHlUaGF0RG9lc250Q2hhbmdlfX08L2Rpdj4KICBgYGAKCiAgQG1ldGhvZCB1bmJvdW5kCiAgQGZv
ciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHkKICBA
cmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nCiovCkVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJI
ZWxwZXIoJ3VuYm91bmQnLCBmdW5jdGlvbiB1bmJvdW5kSGVscGVyKHByb3BlcnR5LCBmbikgewog
IHZhciBvcHRpb25zID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSwgaGVscGVyLCBj
b250ZXh0LCBvdXQ7CgogIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikgewogICAgLy8gVW5ib3Vu
ZCBoZWxwZXIgY2FsbC4KICAgIG9wdGlvbnMuZGF0YS5pc1VuYm91bmQgPSB0cnVlOwogICAgaGVs
cGVyID0gRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzW2FyZ3VtZW50c1swXV0gfHwgRW1iZXIuSGFu
ZGxlYmFycy5oZWxwZXJzLmhlbHBlck1pc3Npbmc7CiAgICBvdXQgPSBoZWxwZXIuYXBwbHkodGhp
cywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBkZWxldGUg
b3B0aW9ucy5kYXRhLmlzVW5ib3VuZDsKICAgIHJldHVybiBvdXQ7CiAgfQoKICBjb250ZXh0ID0g
KGZuLmNvbnRleHRzICYmIGZuLmNvbnRleHRzLmxlbmd0aCkgPyBmbi5jb250ZXh0c1swXSA6IHRo
aXM7CiAgcmV0dXJuIGhhbmRsZWJhcnNHZXQoY29udGV4dCwgcHJvcGVydHksIGZuKTsKfSk7Cgp9
KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qanNoaW50IGRlYnVnOnRydWUqLwovKioKQG1vZHVsZSBl
bWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRsZWJhcnMKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQs
IGhhbmRsZWJhcnNHZXQgPSBFbWJlci5IYW5kbGViYXJzLmdldCwgbm9ybWFsaXplUGF0aCA9IEVt
YmVyLkhhbmRsZWJhcnMubm9ybWFsaXplUGF0aDsKCi8qKgogIGBsb2dgIGFsbG93cyB5b3UgdG8g
b3V0cHV0IHRoZSB2YWx1ZSBvZiBhIHZhcmlhYmxlIGluIHRoZSBjdXJyZW50IHJlbmRlcmluZwog
IGNvbnRleHQuCgogIGBgYGhhbmRsZWJhcnMKICB7e2xvZyBteVZhcmlhYmxlfX0KICBgYGAKCiAg
QG1ldGhvZCBsb2cKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwogIEBwYXJhbSB7U3Ry
aW5nfSBwcm9wZXJ0eQoqLwpFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdsb2cnLCBm
dW5jdGlvbiBsb2dIZWxwZXIocHJvcGVydHksIG9wdGlvbnMpIHsKICB2YXIgY29udGV4dCA9IChv
cHRpb25zLmNvbnRleHRzICYmIG9wdGlvbnMuY29udGV4dHMubGVuZ3RoKSA/IG9wdGlvbnMuY29u
dGV4dHNbMF0gOiB0aGlzLAogICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplUGF0aChjb250ZXh0
LCBwcm9wZXJ0eSwgb3B0aW9ucy5kYXRhKSwKICAgICAgcGF0aFJvb3QgPSBub3JtYWxpemVkLnJv
b3QsCiAgICAgIHBhdGggPSBub3JtYWxpemVkLnBhdGgsCiAgICAgIHZhbHVlID0gKHBhdGggPT09
ICd0aGlzJykgPyBwYXRoUm9vdCA6IGhhbmRsZWJhcnNHZXQocGF0aFJvb3QsIHBhdGgsIG9wdGlv
bnMpOwogIEVtYmVyLkxvZ2dlci5sb2codmFsdWUpOwp9KTsKCi8qKgogIEV4ZWN1dGUgdGhlIGBk
ZWJ1Z2dlcmAgc3RhdGVtZW50IGluIHRoZSBjdXJyZW50IGNvbnRleHQuCgogIGBgYGhhbmRsZWJh
cnMKICB7e2RlYnVnZ2VyfX0KICBgYGAKCiAgQmVmb3JlIGludm9raW5nIHRoZSBgZGVidWdnZXJg
IHN0YXRlbWVudCwgdGhlcmUKICBhcmUgYSBmZXcgaGVscGZ1bCB2YXJpYWJsZXMgZGVmaW5lZCBp
biB0aGUKICBib2R5IG9mIHRoaXMgaGVscGVyIHRoYXQgeW91IGNhbiBpbnNwZWN0IHdoaWxlCiAg
ZGVidWdnaW5nIHRoYXQgZGVzY3JpYmUgaG93IGFuZCB3aGVyZSB0aGlzCiAgaGVscGVyIHdhcyBp
bnZva2VkOgoKICAtIHRlbXBsYXRlQ29udGV4dDogdGhpcyBpcyBtb3N0IGxpa2VseSBhIGNvbnRy
b2xsZXIKICAgIGZyb20gd2hpY2ggdGhpcyB0ZW1wbGF0ZSBsb29rcyB1cCAvIGRpc3BsYXlzIHBy
b3BlcnRpZXMKICAtIHR5cGVPZlRlbXBsYXRlQ29udGV4dDogYSBzdHJpbmcgZGVzY3JpcHRpb24g
b2YKICAgIHdoYXQgdGhlIHRlbXBsYXRlQ29udGV4dCBpcwoKICBGb3IgZXhhbXBsZSwgaWYgeW91
J3JlIHdvbmRlcmluZyB3aHkgYSB2YWx1ZSBge3tmb299fWAKICBpc24ndCByZW5kZXJpbmcgYXMg
ZXhwZWN0ZWQgd2l0aGluIGEgdGVtcGxhdGUsIHlvdQogIGNvdWxkIHBsYWNlIGEgYHt7ZGVidWdn
ZXJ9fWAgc3RhdGVtZW50LCBhbmQgd2hlbgogIHRoZSBgZGVidWdnZXI7YCBicmVha3BvaW50IGlz
IGhpdCwgeW91IGNhbiBpbnNwZWN0CiAgYHRlbXBsYXRlQ29udGV4dGAsIGRldGVybWluZSBpZiBp
dCdzIHRoZSBvYmplY3QgeW91CiAgZXhwZWN0LCBhbmQvb3IgZXZhbHVhdGUgZXhwcmVzc2lvbnMg
aW4gdGhlIGNvbnNvbGUKICB0byBwZXJmb3JtIHByb3BlcnR5IGxvb2t1cHMgb24gdGhlIGB0ZW1w
bGF0ZUNvbnRleHRgOgoKICBgYGAKICAgID4gdGVtcGxhdGVDb250ZXh0LmdldCgnZm9vJykgLy8g
LT4gIjx2YWx1ZSBvZiB7e2Zvb319PiIKICBgYGAKCiAgQG1ldGhvZCBkZWJ1Z2dlcgogIEBmb3Ig
RW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5CiovCkVt
YmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2RlYnVnZ2VyJywgZnVuY3Rpb24gZGVidWdn
ZXJIZWxwZXIob3B0aW9ucykgewoKICAvLyBUaGVzZSBhcmUgaGVscGZ1bCB2YWx1ZXMgeW91IGNh
biBpbnNwZWN0IHdoaWxlIGRlYnVnZ2luZy4KICB2YXIgdGVtcGxhdGVDb250ZXh0ID0gdGhpczsK
ICB2YXIgdHlwZU9mVGVtcGxhdGVDb250ZXh0ID0gRW1iZXIuaW5zcGVjdCh0ZW1wbGF0ZUNvbnRl
eHQpOwoKICBkZWJ1Z2dlcjsKfSk7CgoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1
bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1oYW5kbGViYXJzCiovCgp2YXIgZ2V0ID0gRW1iZXIu
Z2V0LCBzZXQgPSBFbWJlci5zZXQ7CgpFbWJlci5IYW5kbGViYXJzLkVhY2hWaWV3ID0gRW1iZXIu
Q29sbGVjdGlvblZpZXcuZXh0ZW5kKEVtYmVyLl9NZXRhbW9ycGgsIHsKICBpbml0OiBmdW5jdGlv
bigpIHsKICAgIHZhciBpdGVtQ29udHJvbGxlciA9IGdldCh0aGlzLCAnaXRlbUNvbnRyb2xsZXIn
KTsKICAgIHZhciBiaW5kaW5nOwoKICAgIGlmIChpdGVtQ29udHJvbGxlcikgewogICAgICB2YXIg
Y29udHJvbGxlciA9IGdldCh0aGlzLCAnY29udHJvbGxlci5jb250YWluZXInKS5sb29rdXBGYWN0
b3J5KCdjb250cm9sbGVyOmFycmF5JykuY3JlYXRlKHsKICAgICAgICBwYXJlbnRDb250cm9sbGVy
OiBnZXQodGhpcywgJ2NvbnRyb2xsZXInKSwKICAgICAgICBpdGVtQ29udHJvbGxlcjogaXRlbUNv
bnRyb2xsZXIsCiAgICAgICAgdGFyZ2V0OiBnZXQodGhpcywgJ2NvbnRyb2xsZXInKSwKICAgICAg
ICBfZWFjaFZpZXc6IHRoaXMKICAgICAgfSk7CgogICAgICB0aGlzLmRpc2FibGVDb250ZW50T2Jz
ZXJ2ZXJzKGZ1bmN0aW9uKCkgewogICAgICAgIHNldCh0aGlzLCAnY29udGVudCcsIGNvbnRyb2xs
ZXIpOwogICAgICAgIGJpbmRpbmcgPSBuZXcgRW1iZXIuQmluZGluZygnY29udGVudCcsICdfZWFj
aFZpZXcuZGF0YVNvdXJjZScpLm9uZVdheSgpOwogICAgICAgIGJpbmRpbmcuY29ubmVjdChjb250
cm9sbGVyKTsKICAgICAgfSk7CgogICAgICBzZXQodGhpcywgJ19hcnJheUNvbnRyb2xsZXInLCBj
b250cm9sbGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGlzYWJsZUNvbnRlbnRPYnNlcnZl
cnMoZnVuY3Rpb24oKSB7CiAgICAgICAgYmluZGluZyA9IG5ldyBFbWJlci5CaW5kaW5nKCdjb250
ZW50JywgJ2RhdGFTb3VyY2UnKS5vbmVXYXkoKTsKICAgICAgICBiaW5kaW5nLmNvbm5lY3QodGhp
cyk7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9zdXBlcigpOwogIH0sCgogIF9h
c3NlcnRBcnJheUxpa2U6IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgIEVtYmVyLmFzc2VydCgiVGhl
IHZhbHVlIHRoYXQgI2VhY2ggbG9vcHMgb3ZlciBtdXN0IGJlIGFuIEFycmF5LiBZb3UgcGFzc2Vk
ICIgKyBjb250ZW50LmNvbnN0cnVjdG9yICsgIiwgYnV0IGl0IHNob3VsZCBoYXZlIGJlZW4gYW4g
QXJyYXlDb250cm9sbGVyIiwgIUVtYmVyLkNvbnRyb2xsZXJNaXhpbi5kZXRlY3QoY29udGVudCkg
fHwgKGNvbnRlbnQgJiYgY29udGVudC5pc0dlbmVyYXRlZCkgfHwgY29udGVudCBpbnN0YW5jZW9m
IEVtYmVyLkFycmF5Q29udHJvbGxlcik7CiAgICBFbWJlci5hc3NlcnQoIlRoZSB2YWx1ZSB0aGF0
ICNlYWNoIGxvb3BzIG92ZXIgbXVzdCBiZSBhbiBBcnJheS4gWW91IHBhc3NlZCAiICsgKChFbWJl
ci5Db250cm9sbGVyTWl4aW4uZGV0ZWN0KGNvbnRlbnQpICYmIGNvbnRlbnQuZ2V0KCdtb2RlbCcp
ICE9PSB1bmRlZmluZWQpID8gKCIiICsgY29udGVudC5nZXQoJ21vZGVsJykgKyAiICh3cmFwcGVk
IGluICIgKyBjb250ZW50ICsgIikiKSA6ICgiIiArIGNvbnRlbnQpKSwgRW1iZXIuQXJyYXkuZGV0
ZWN0KGNvbnRlbnQpKTsKICB9LAoKICBkaXNhYmxlQ29udGVudE9ic2VydmVyczogZnVuY3Rpb24o
Y2FsbGJhY2spIHsKICAgIEVtYmVyLnJlbW92ZUJlZm9yZU9ic2VydmVyKHRoaXMsICdjb250ZW50
JywgbnVsbCwgJ19jb250ZW50V2lsbENoYW5nZScpOwogICAgRW1iZXIucmVtb3ZlT2JzZXJ2ZXIo
dGhpcywgJ2NvbnRlbnQnLCBudWxsLCAnX2NvbnRlbnREaWRDaGFuZ2UnKTsKCiAgICBjYWxsYmFj
ay5jYWxsKHRoaXMpOwoKICAgIEVtYmVyLmFkZEJlZm9yZU9ic2VydmVyKHRoaXMsICdjb250ZW50
JywgbnVsbCwgJ19jb250ZW50V2lsbENoYW5nZScpOwogICAgRW1iZXIuYWRkT2JzZXJ2ZXIodGhp
cywgJ2NvbnRlbnQnLCBudWxsLCAnX2NvbnRlbnREaWRDaGFuZ2UnKTsKICB9LAoKICBpdGVtVmll
d0NsYXNzOiBFbWJlci5fTWV0YW1vcnBoVmlldywKICBlbXB0eVZpZXdDbGFzczogRW1iZXIuX01l
dGFtb3JwaFZpZXcsCgogIGNyZWF0ZUNoaWxkVmlldzogZnVuY3Rpb24odmlldywgYXR0cnMpIHsK
ICAgIHZpZXcgPSB0aGlzLl9zdXBlcih2aWV3LCBhdHRycyk7CgogICAgLy8gQXQgdGhlIG1vbWVu
dCwgaWYgYSBjb250YWluZXIgdmlldyBzdWJjbGFzcyB3YW50cwogICAgLy8gdG8gaW5zZXJ0IGtl
eXdvcmRzLCBpdCBpcyByZXNwb25zaWJsZSBmb3IgY2xvbmluZwogICAgLy8gdGhlIGtleXdvcmRz
IGhhc2guIFRoaXMgd2lsbCBiZSBmaXhlZCBtb21lbnRhcmlseS4KICAgIHZhciBrZXl3b3JkID0g
Z2V0KHRoaXMsICdrZXl3b3JkJyk7CiAgICB2YXIgY29udGVudCA9IGdldCh2aWV3LCAnY29udGVu
dCcpOwoKICAgIGlmIChrZXl3b3JkKSB7CiAgICAgIHZhciBkYXRhID0gZ2V0KHZpZXcsICd0ZW1w
bGF0ZURhdGEnKTsKCiAgICAgIGRhdGEgPSBFbWJlci5jb3B5KGRhdGEpOwogICAgICBkYXRhLmtl
eXdvcmRzID0gdmlldy5jbG9uZUtleXdvcmRzKCk7CiAgICAgIHNldCh2aWV3LCAndGVtcGxhdGVE
YXRhJywgZGF0YSk7CgogICAgICAvLyBJbiB0aGlzIGNhc2UsIHdlIGRvIG5vdCBiaW5kLCBiZWNh
dXNlIHRoZSBgY29udGVudGAgb2YKICAgICAgLy8gYSAjZWFjaCBpdGVtIGNhbm5vdCBjaGFuZ2Uu
CiAgICAgIGRhdGEua2V5d29yZHNba2V5d29yZF0gPSBjb250ZW50OwogICAgfQoKICAgIC8vIElm
IHt7I2VhY2h9fSBpcyBsb29waW5nIG92ZXIgYW4gYXJyYXkgb2YgY29udHJvbGxlcnMsCiAgICAv
LyBwb2ludCBlYWNoIGNoaWxkIHZpZXcgYXQgdGhlaXIgcmVzcGVjdGl2ZSBjb250cm9sbGVyLgog
ICAgaWYgKGNvbnRlbnQgJiYgZ2V0KGNvbnRlbnQsICdpc0NvbnRyb2xsZXInKSkgewogICAgICBz
ZXQodmlldywgJ2NvbnRyb2xsZXInLCBjb250ZW50KTsKICAgIH0KCiAgICByZXR1cm4gdmlldzsK
ICB9LAoKICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5fc3VwZXIoKSkgeyBy
ZXR1cm47IH0KCiAgICB2YXIgYXJyYXlDb250cm9sbGVyID0gZ2V0KHRoaXMsICdfYXJyYXlDb250
cm9sbGVyJyk7CgogICAgaWYgKGFycmF5Q29udHJvbGxlcikgewogICAgICBhcnJheUNvbnRyb2xs
ZXIuZGVzdHJveSgpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KfSk7Cgp2YXIgR3JvdXBl
ZEVhY2ggPSBFbWJlci5IYW5kbGViYXJzLkdyb3VwZWRFYWNoID0gZnVuY3Rpb24oY29udGV4dCwg
cGF0aCwgb3B0aW9ucykgewogIHZhciBzZWxmID0gdGhpcywKICAgICAgbm9ybWFsaXplZCA9IEVt
YmVyLkhhbmRsZWJhcnMubm9ybWFsaXplUGF0aChjb250ZXh0LCBwYXRoLCBvcHRpb25zLmRhdGEp
OwoKICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogIHRoaXMucGF0aCA9IHBhdGg7CiAgdGhpcy5v
cHRpb25zID0gb3B0aW9uczsKICB0aGlzLnRlbXBsYXRlID0gb3B0aW9ucy5mbjsKICB0aGlzLmNv
bnRhaW5pbmdWaWV3ID0gb3B0aW9ucy5kYXRhLnZpZXc7CiAgdGhpcy5ub3JtYWxpemVkUm9vdCA9
IG5vcm1hbGl6ZWQucm9vdDsKICB0aGlzLm5vcm1hbGl6ZWRQYXRoID0gbm9ybWFsaXplZC5wYXRo
OwogIHRoaXMuY29udGVudCA9IHRoaXMubG9va3VwQ29udGVudCgpOwoKICB0aGlzLmFkZENvbnRl
bnRPYnNlcnZlcnMoKTsKICB0aGlzLmFkZEFycmF5T2JzZXJ2ZXJzKCk7CgogIHRoaXMuY29udGFp
bmluZ1ZpZXcub24oJ3dpbGxDbGVhclJlbmRlcicsIGZ1bmN0aW9uKCkgewogICAgc2VsZi5kZXN0
cm95KCk7CiAgfSk7Cn07CgpHcm91cGVkRWFjaC5wcm90b3R5cGUgPSB7CiAgY29udGVudFdpbGxD
aGFuZ2U6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5yZW1vdmVBcnJheU9ic2VydmVycygpOwogIH0s
CgogIGNvbnRlbnREaWRDaGFuZ2U6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5jb250ZW50ID0gdGhp
cy5sb29rdXBDb250ZW50KCk7CiAgICB0aGlzLmFkZEFycmF5T2JzZXJ2ZXJzKCk7CiAgICB0aGlz
LnJlcmVuZGVyQ29udGFpbmluZ1ZpZXcoKTsKICB9LAoKICBjb250ZW50QXJyYXlXaWxsQ2hhbmdl
OiBFbWJlci5LLAoKICBjb250ZW50QXJyYXlEaWRDaGFuZ2U6IGZ1bmN0aW9uKCkgewogICAgdGhp
cy5yZXJlbmRlckNvbnRhaW5pbmdWaWV3KCk7CiAgfSwKCiAgbG9va3VwQ29udGVudDogZnVuY3Rp
b24oKSB7CiAgICByZXR1cm4gRW1iZXIuSGFuZGxlYmFycy5nZXQodGhpcy5ub3JtYWxpemVkUm9v
dCwgdGhpcy5ub3JtYWxpemVkUGF0aCwgdGhpcy5vcHRpb25zKTsKICB9LAoKICBhZGRBcnJheU9i
c2VydmVyczogZnVuY3Rpb24oKSB7CiAgICBpZiAoIXRoaXMuY29udGVudCkgeyByZXR1cm47IH0K
CiAgICB0aGlzLmNvbnRlbnQuYWRkQXJyYXlPYnNlcnZlcih0aGlzLCB7CiAgICAgIHdpbGxDaGFu
Z2U6ICdjb250ZW50QXJyYXlXaWxsQ2hhbmdlJywKICAgICAgZGlkQ2hhbmdlOiAnY29udGVudEFy
cmF5RGlkQ2hhbmdlJwogICAgfSk7CiAgfSwKCiAgcmVtb3ZlQXJyYXlPYnNlcnZlcnM6IGZ1bmN0
aW9uKCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnQpIHsgcmV0dXJuOyB9CgogICAgdGhpcy5jb250
ZW50LnJlbW92ZUFycmF5T2JzZXJ2ZXIodGhpcywgewogICAgICB3aWxsQ2hhbmdlOiAnY29udGVu
dEFycmF5V2lsbENoYW5nZScsCiAgICAgIGRpZENoYW5nZTogJ2NvbnRlbnRBcnJheURpZENoYW5n
ZScKICAgIH0pOwogIH0sCgogIGFkZENvbnRlbnRPYnNlcnZlcnM6IGZ1bmN0aW9uKCkgewogICAg
RW1iZXIuYWRkQmVmb3JlT2JzZXJ2ZXIodGhpcy5ub3JtYWxpemVkUm9vdCwgdGhpcy5ub3JtYWxp
emVkUGF0aCwgdGhpcywgdGhpcy5jb250ZW50V2lsbENoYW5nZSk7CiAgICBFbWJlci5hZGRPYnNl
cnZlcih0aGlzLm5vcm1hbGl6ZWRSb290LCB0aGlzLm5vcm1hbGl6ZWRQYXRoLCB0aGlzLCB0aGlz
LmNvbnRlbnREaWRDaGFuZ2UpOwogIH0sCgogIHJlbW92ZUNvbnRlbnRPYnNlcnZlcnM6IGZ1bmN0
aW9uKCkgewogICAgRW1iZXIucmVtb3ZlQmVmb3JlT2JzZXJ2ZXIodGhpcy5ub3JtYWxpemVkUm9v
dCwgdGhpcy5ub3JtYWxpemVkUGF0aCwgdGhpcy5jb250ZW50V2lsbENoYW5nZSk7CiAgICBFbWJl
ci5yZW1vdmVPYnNlcnZlcih0aGlzLm5vcm1hbGl6ZWRSb290LCB0aGlzLm5vcm1hbGl6ZWRQYXRo
LCB0aGlzLmNvbnRlbnREaWRDaGFuZ2UpOwogIH0sCgogIHJlbmRlcjogZnVuY3Rpb24oKSB7CiAg
ICBpZiAoIXRoaXMuY29udGVudCkgeyByZXR1cm47IH0KCiAgICB2YXIgY29udGVudCA9IHRoaXMu
Y29udGVudCwKICAgICAgICBjb250ZW50TGVuZ3RoID0gZ2V0KGNvbnRlbnQsICdsZW5ndGgnKSwK
ICAgICAgICBkYXRhID0gdGhpcy5vcHRpb25zLmRhdGEsCiAgICAgICAgdGVtcGxhdGUgPSB0aGlz
LnRlbXBsYXRlOwoKICAgIGRhdGEuaW5zaWRlRWFjaCA9IHRydWU7CiAgICBmb3IgKHZhciBpID0g
MDsgaSA8IGNvbnRlbnRMZW5ndGg7IGkrKykgewogICAgICB0ZW1wbGF0ZShjb250ZW50Lm9iamVj
dEF0KGkpLCB7IGRhdGE6IGRhdGEgfSk7CiAgICB9CiAgfSwKCiAgcmVyZW5kZXJDb250YWluaW5n
VmlldzogZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBFbWJlci5ydW4uc2No
ZWR1bGVPbmNlKCdyZW5kZXInLCB0aGlzLCBmdW5jdGlvbigpIHsKICAgICAgLy8gSXQncyBwb3Nz
aWJsZSBpdCdzIGJlZW4gZGVzdHJveWVkIGFmdGVyIHdlIGVucXVldWVkIGEgcmUtcmVuZGVyIGNh
bGwuCiAgICAgIGlmICghc2VsZi5kZXN0cm95ZWQpIHsKICAgICAgICBzZWxmLmNvbnRhaW5pbmdW
aWV3LnJlcmVuZGVyKCk7CiAgICAgIH0KICAgIH0pOwogIH0sCgogIGRlc3Ryb3k6IGZ1bmN0aW9u
KCkgewogICAgdGhpcy5yZW1vdmVDb250ZW50T2JzZXJ2ZXJzKCk7CiAgICBpZiAodGhpcy5jb250
ZW50KSB7CiAgICAgIHRoaXMucmVtb3ZlQXJyYXlPYnNlcnZlcnMoKTsKICAgIH0KICAgIHRoaXMu
ZGVzdHJveWVkID0gdHJ1ZTsKICB9Cn07CgovKioKICBUaGUgYHt7I2VhY2h9fWAgaGVscGVyIGxv
b3BzIG92ZXIgZWxlbWVudHMgaW4gYSBjb2xsZWN0aW9uLCByZW5kZXJpbmcgaXRzCiAgYmxvY2sg
b25jZSBmb3IgZWFjaCBpdGVtLiBJdCBpcyBhbiBleHRlbnNpb24gb2YgdGhlIGJhc2UgSGFuZGxl
YmFycyBge3sjZWFjaH19YAogIGhlbHBlcjoKCiAgYGBgamF2YXNjcmlwdAogIERldmVsb3BlcnMg
PSBbe25hbWU6ICdZZWh1ZGEnfSx7bmFtZTogJ1RvbSd9LCB7bmFtZTogJ1BhdWwnfV07CiAgYGBg
CgogIGBgYGhhbmRsZWJhcnMKICB7eyNlYWNoIERldmVsb3BlcnN9fQogICAge3tuYW1lfX0KICB7
ey9lYWNofX0KICBgYGAKCiAgYHt7ZWFjaH19YCBzdXBwb3J0cyBhbiBhbHRlcm5hdGl2ZSBzeW50
YXggd2l0aCBlbGVtZW50IG5hbWluZzoKCiAgYGBgaGFuZGxlYmFycwogIHt7I2VhY2ggcGVyc29u
IGluIERldmVsb3BlcnN9fQogICAge3twZXJzb24ubmFtZX19CiAge3svZWFjaH19CiAgYGBgCgog
IFdoZW4gbG9vcGluZyBvdmVyIG9iamVjdHMgdGhhdCBkbyBub3QgaGF2ZSBwcm9wZXJ0aWVzLCBg
e3t0aGlzfX1gIGNhbiBiZSB1c2VkCiAgdG8gcmVuZGVyIHRoZSBvYmplY3Q6CgogIGBgYGphdmFz
Y3JpcHQKICBEZXZlbG9wZXJOYW1lcyA9IFsnWWVodWRhJywgJ1RvbScsICdQYXVsJ10KICBgYGAK
CiAgYGBgaGFuZGxlYmFycwogIHt7I2VhY2ggRGV2ZWxvcGVyTmFtZXN9fQogICAge3t0aGlzfX0K
ICB7ey9lYWNofX0KICBgYGAKICAjIyMge3tlbHNlfX0gY29uZGl0aW9uCiAgYHt7I2VhY2h9fWAg
Y2FuIGhhdmUgYSBtYXRjaGluZyBge3tlbHNlfX1gLiBUaGUgY29udGVudHMgb2YgdGhpcyBibG9j
ayB3aWxsIHJlbmRlcgogIGlmIHRoZSBjb2xsZWN0aW9uIGlzIGVtcHR5LgoKICBgYGAKICB7eyNl
YWNoIHBlcnNvbiBpbiBEZXZlbG9wZXJzfX0KICAgIHt7cGVyc29uLm5hbWV9fQogIHt7ZWxzZX19
CiAgICA8cD5Tb3JyeSwgbm9ib2R5IGlzIGF2YWlsYWJsZSBmb3IgdGhpcyB0YXNrLjwvcD4KICB7
ey9lYWNofX0KICBgYGAKICAjIyMgU3BlY2lmeWluZyBhIFZpZXcgY2xhc3MgZm9yIGl0ZW1zCiAg
SWYgeW91IHByb3ZpZGUgYW4gYGl0ZW1WaWV3Q2xhc3NgIG9wdGlvbiB0aGF0IHJlZmVyZW5jZXMg
YSB2aWV3IGNsYXNzCiAgd2l0aCBpdHMgb3duIGB0ZW1wbGF0ZWAgeW91IGNhbiBvbWl0IHRoZSBi
bG9jay4KCiAgVGhlIGZvbGxvd2luZyB0ZW1wbGF0ZToKCiAgYGBgaGFuZGxlYmFycwogIHt7I3Zp
ZXcgQXBwLk15VmlldyB9fQogICAge3tlYWNoIHZpZXcuaXRlbXMgaXRlbVZpZXdDbGFzcz0iQXBw
LkFuSXRlbVZpZXcifX0KICB7ey92aWV3fX0KICBgYGAKCiAgQW5kIGFwcGxpY2F0aW9uIGNvZGUK
CiAgYGBgamF2YXNjcmlwdAogIEFwcCA9IEVtYmVyLkFwcGxpY2F0aW9uLmNyZWF0ZSh7CiAgICBN
eVZpZXc6IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgICAgaXRlbXM6IFsKICAgICAgICBFbWJlci5P
YmplY3QuY3JlYXRlKHtuYW1lOiAnRGF2ZSd9KSwKICAgICAgICBFbWJlci5PYmplY3QuY3JlYXRl
KHtuYW1lOiAnTWFyeSd9KSwKICAgICAgICBFbWJlci5PYmplY3QuY3JlYXRlKHtuYW1lOiAnU2Fy
YSd9KQogICAgICBdCiAgICB9KQogIH0pOwoKICBBcHAuQW5JdGVtVmlldyA9IEVtYmVyLlZpZXcu
ZXh0ZW5kKHsKICAgIHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoIkdyZWV0aW5n
cyB7e25hbWV9fSIpCiAgfSk7CiAgYGBgCgogIFdpbGwgcmVzdWx0IGluIHRoZSBIVE1MIHN0cnVj
dHVyZSBiZWxvdwoKICBgYGBodG1sCiAgPGRpdiBjbGFzcz0iZW1iZXItdmlldyI+CiAgICA8ZGl2
IGNsYXNzPSJlbWJlci12aWV3Ij5HcmVldGluZ3MgRGF2ZTwvZGl2PgogICAgPGRpdiBjbGFzcz0i
ZW1iZXItdmlldyI+R3JlZXRpbmdzIE1hcnk8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImVtYmVyLXZp
ZXciPkdyZWV0aW5ncyBTYXJhPC9kaXY+CiAgPC9kaXY+CiAgYGBgCgogIElmIGFuIGBpdGVtVmll
d0NsYXNzYCBpcyBkZWZpbmVkIG9uIHRoZSBoZWxwZXIsIGFuZCB0aGVyZWZvcmUgdGhlIGhlbHBl
ciBpcyBub3QKICBiZWluZyB1c2VkIGFzIGEgYmxvY2ssIGFuIGBlbXB0eVZpZXdDbGFzc2AgY2Fu
IGFsc28gYmUgcHJvdmlkZWQgb3B0aW9uYWxseS4KICBUaGUgYGVtcHR5Vmlld0NsYXNzYCB3aWxs
IG1hdGNoIHRoZSBiZWhhdmlvciBvZiB0aGUgYHt7ZWxzZX19YCBjb25kaXRpb24KICBkZXNjcmli
ZWQgYWJvdmUuIFRoYXQgaXMsIHRoZSBgZW1wdHlWaWV3Q2xhc3NgIHdpbGwgcmVuZGVyIGlmIHRo
ZSBjb2xsZWN0aW9uCiAgaXMgZW1wdHkuCgogICMjIyBSZXByZXNlbnRpbmcgZWFjaCBpdGVtIHdp
dGggYSBDb250cm9sbGVyLgogIEJ5IGRlZmF1bHQgdGhlIGNvbnRyb2xsZXIgbG9va3VwIHdpdGhp
biBhbiBge3sjZWFjaH19YCBibG9jayB3aWxsIGJlCiAgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIHRl
bXBsYXRlIHdoZXJlIHRoZSBge3sjZWFjaH19YCB3YXMgdXNlZC4gSWYgZWFjaAogIGl0ZW0gbmVl
ZHMgdG8gYmUgcHJlc2VudGVkIGJ5IGEgY3VzdG9tIGNvbnRyb2xsZXIgeW91IGNhbiBwcm92aWRl
IGEKICBgaXRlbUNvbnRyb2xsZXJgIG9wdGlvbiB3aGljaCByZWZlcmVuY2VzIGEgY29udHJvbGxl
ciBieSBsb29rdXAgbmFtZS4KICBFYWNoIGl0ZW0gaW4gdGhlIGxvb3Agd2lsbCBiZSB3cmFwcGVk
IGluIGFuIGluc3RhbmNlIG9mIHRoaXMgY29udHJvbGxlcgogIGFuZCB0aGUgaXRlbSBpdHNlbGYg
d2lsbCBiZSBzZXQgdG8gdGhlIGBjb250ZW50YCBwcm9wZXJ0eSBvZiB0aGF0IGNvbnRyb2xsZXIu
CgogIFRoaXMgaXMgdXNlZnVsIGluIGNhc2VzIHdoZXJlIHByb3BlcnRpZXMgb2YgbW9kZWwgb2Jq
ZWN0cyBuZWVkIHRyYW5zZm9ybWF0aW9uCiAgb3Igc3ludGhlc2lzIGZvciBkaXNwbGF5OgoKICBg
YGBqYXZhc2NyaXB0CiAgQXBwLkRldmVsb3BlckNvbnRyb2xsZXIgPSBFbWJlci5PYmplY3RDb250
cm9sbGVyLmV4dGVuZCh7CiAgICBpc0F2YWlsYWJsZUZvckhpcmU6IGZ1bmN0aW9uKCkgewogICAg
ICByZXR1cm4gIXRoaXMuZ2V0KCdjb250ZW50LmlzRW1wbG95ZWQnKSAmJiB0aGlzLmdldCgnY29u
dGVudC5pc1NlZWtpbmdXb3JrJyk7CiAgICB9LnByb3BlcnR5KCdpc0VtcGxveWVkJywgJ2lzU2Vl
a2luZ1dvcmsnKQogIH0pCiAgYGBgCgogIGBgYGhhbmRsZWJhcnMKICB7eyNlYWNoIHBlcnNvbiBp
biBkZXZlbG9wZXJzIGl0ZW1Db250cm9sbGVyPSJkZXZlbG9wZXIifX0KICAgIHt7cGVyc29uLm5h
bWV9fSB7eyNpZiBwZXJzb24uaXNBdmFpbGFibGVGb3JIaXJlfX1IaXJlIG1lIXt7L2lmfX0KICB7
ey9lYWNofX0KICBgYGAKCiAgRWFjaCBpdGVtQ29udHJvbGxlciB3aWxsIHJlY2VpdmUgYSByZWZl
cmVuY2UgdG8gdGhlIGN1cnJlbnQgY29udHJvbGxlciBhcwogIGEgYHBhcmVudENvbnRyb2xsZXJg
IHByb3BlcnR5LgoKICAjIyMgKEV4cGVyaW1lbnRhbCkgR3JvdXBlZCBFYWNoCgogIFdoZW4gdXNl
ZCBpbiBjb25qdW5jdGlvbiB3aXRoIHRoZSBleHBlcmltZW50YWwgW2dyb3VwIGhlbHBlcl0oaHR0
cHM6Ly9naXRodWIuY29tL2VtYmVyanMvZ3JvdXAtaGVscGVyKSwKICB5b3UgY2FuIGluZm9ybSBI
YW5kbGViYXJzIHRvIHJlLXJlbmRlciBhbiBlbnRpcmUgZ3JvdXAgb2YgaXRlbXMgaW5zdGVhZCBv
ZgogIHJlLXJlbmRlcmluZyB0aGVtIG9uZSBhdCBhIHRpbWUgKGluIHRoZSBldmVudCB0aGF0IHRo
ZXkgYXJlIGNoYW5nZWQgZW4gbWFzc2UKICBvciBhbiBpdGVtIGlzIGFkZGVkL3JlbW92ZWQpLgoK
ICBgYGBoYW5kbGViYXJzCiAge3sjZ3JvdXB9fQogICAge3sjZWFjaCBwZW9wbGV9fQogICAgICB7
e2ZpcnN0TmFtZX19IHt7bGFzdE5hbWV9fQogICAge3svZWFjaH19CiAge3svZ3JvdXB9fQogIGBg
YAoKICBUaGlzIGNhbiBiZSBmYXN0ZXIgdGhhbiB0aGUgbm9ybWFsIHdheSB0aGF0IEhhbmRsZWJh
cnMgcmUtcmVuZGVycyBpdGVtcwogIGluIHNvbWUgY2FzZXMuCgogIElmIGZvciBzb21lIHJlYXNv
biB5b3UgaGF2ZSBhIGdyb3VwIHdpdGggbW9yZSB0aGFuIG9uZSBgI2VhY2hgLCB5b3UgY2FuIG1h
a2UKICBvbmUgb2YgdGhlIGNvbGxlY3Rpb25zIGJlIHVwZGF0ZWQgaW4gbm9ybWFsIChub24tZ3Jv
dXBlZCkgZmFzaGlvbiBieSBzZXR0aW5nCiAgdGhlIG9wdGlvbiBgZ3JvdXBlZFJvd3M9dHJ1ZWAg
KGNvdW50ZXItaW50dWl0aXZlLCBJIGtub3cpLgoKICBGb3IgZXhhbXBsZSwKCiAgYGBgaGFuZGxl
YmFycwogIHt7ZGVhbGVyc2hpcE5hbWV9fQoKICB7eyNncm91cH19CiAgICB7eyNlYWNoIGRlYWxl
cnN9fQogICAgICB7e2ZpcnN0TmFtZX19IHt7bGFzdE5hbWV9fQogICAge3svZWFjaH19CgogICAg
e3sjZWFjaCBjYXIgaW4gY2FycyBncm91cGVkUm93cz10cnVlfX0KICAgICAge3tjYXIubWFrZX19
IHt7Y2FyLm1vZGVsfX0ge3tjYXIuY29sb3J9fQogICAge3svZWFjaH19CiAge3svZ3JvdXB9fQog
IGBgYAogIEFueSBjaGFuZ2UgdG8gYGRlYWxlcnNoaXBOYW1lYCBvciB0aGUgYGRlYWxlcnNgIGNv
bGxlY3Rpb24gd2lsbCBjYXVzZSB0aGUKICBlbnRpcmUgZ3JvdXAgdG8gYmUgcmUtcmVuZGVyZWQu
IEhvd2V2ZXIsIGNoYW5nZXMgdG8gdGhlIGBjYXJzYCBjb2xsZWN0aW9uCiAgd2lsbCBiZSByZS1y
ZW5kZXJlZCBpbmRpdmlkdWFsbHkgKGFzIG5vcm1hbCkuCgogIE5vdGUgdGhhdCBgZ3JvdXBgIGJl
aGF2aW9yIGlzIGFsc28gZGlzYWJsZWQgYnkgc3BlY2lmeWluZyBhbiBgaXRlbVZpZXdDbGFzc2Au
CgogIEBtZXRob2QgZWFjaAogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFt
IFtuYW1lXSB7U3RyaW5nfSBuYW1lIGZvciBpdGVtICh1c2VkIHdpdGggYGluYCkKICBAcGFyYW0g
W3BhdGhdIHtTdHJpbmd9IHBhdGgKICBAcGFyYW0gW29wdGlvbnNdIHtPYmplY3R9IEhhbmRsZWJh
cnMga2V5L3ZhbHVlIHBhaXJzIG9mIG9wdGlvbnMKICBAcGFyYW0gW29wdGlvbnMuaXRlbVZpZXdD
bGFzc10ge1N0cmluZ30gYSBwYXRoIHRvIGEgdmlldyBjbGFzcyB1c2VkIGZvciBlYWNoIGl0ZW0K
ICBAcGFyYW0gW29wdGlvbnMuaXRlbUNvbnRyb2xsZXJdIHtTdHJpbmd9IG5hbWUgb2YgYSBjb250
cm9sbGVyIHRvIGJlIGNyZWF0ZWQgZm9yIGVhY2ggaXRlbQogIEBwYXJhbSBbb3B0aW9ucy5ncm91
cGVkUm93c10ge2Jvb2xlYW59IGVuYWJsZSBub3JtYWwgaXRlbS1ieS1pdGVtIHJlbmRlcmluZyB3
aGVuIGluc2lkZSBhIGAjZ3JvdXBgIGhlbHBlcgoqLwpFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVy
SGVscGVyKCdlYWNoJywgZnVuY3Rpb24gZWFjaEhlbHBlcihwYXRoLCBvcHRpb25zKSB7CiAgaWYg
KGFyZ3VtZW50cy5sZW5ndGggPT09IDQpIHsKICAgIEVtYmVyLmFzc2VydCgiSWYgeW91IHBhc3Mg
bW9yZSB0aGFuIG9uZSBhcmd1bWVudCB0byB0aGUgZWFjaCBoZWxwZXIsIGl0IG11c3QgYmUgaW4g
dGhlIGZvcm0gI2VhY2ggZm9vIGluIGJhciIsIGFyZ3VtZW50c1sxXSA9PT0gImluIik7CgogICAg
dmFyIGtleXdvcmROYW1lID0gYXJndW1lbnRzWzBdOwoKICAgIG9wdGlvbnMgPSBhcmd1bWVudHNb
M107CiAgICBwYXRoID0gYXJndW1lbnRzWzJdOwogICAgaWYgKHBhdGggPT09ICcnKSB7IHBhdGgg
PSAidGhpcyI7IH0KCiAgICBvcHRpb25zLmhhc2gua2V5d29yZCA9IGtleXdvcmROYW1lOwogIH0K
CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgIG9wdGlvbnMgPSBwYXRoOwogICAg
cGF0aCA9ICd0aGlzJzsKICB9CgogIG9wdGlvbnMuaGFzaC5kYXRhU291cmNlQmluZGluZyA9IHBh
dGg7CiAgLy8gU2V0IHVwIGVtcHR5VmlldyBhcyBhIG1ldGFtb3JwaCB3aXRoIG5vIHRhZwogIC8v
b3B0aW9ucy5oYXNoLmVtcHR5Vmlld0NsYXNzID0gRW1iZXIuX01ldGFtb3JwaFZpZXc7CgogIGlm
IChvcHRpb25zLmRhdGEuaW5zaWRlR3JvdXAgJiYgIW9wdGlvbnMuaGFzaC5ncm91cGVkUm93cyAm
JiAhb3B0aW9ucy5oYXNoLml0ZW1WaWV3Q2xhc3MpIHsKICAgIG5ldyBFbWJlci5IYW5kbGViYXJz
Lkdyb3VwZWRFYWNoKHRoaXMsIHBhdGgsIG9wdGlvbnMpLnJlbmRlcigpOwogIH0gZWxzZSB7CiAg
ICByZXR1cm4gRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLmNvbGxlY3Rpb24uY2FsbCh0aGlzLCAn
RW1iZXIuSGFuZGxlYmFycy5FYWNoVmlldycsIG9wdGlvbnMpOwogIH0KfSk7Cgp9KSgpOwoKCgoo
ZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItaGFuZGxlYmFy
cwoqLwoKLyoqCiAgYHRlbXBsYXRlYCBhbGxvd3MgeW91IHRvIHJlbmRlciBhIHRlbXBsYXRlIGZy
b20gaW5zaWRlIGFub3RoZXIgdGVtcGxhdGUuCiAgVGhpcyBhbGxvd3MgeW91IHRvIHJlLXVzZSB0
aGUgc2FtZSB0ZW1wbGF0ZSBpbiBtdWx0aXBsZSBwbGFjZXMuIEZvciBleGFtcGxlOgoKICBgYGBo
dG1sCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L3gtaGFuZGxlYmFycyIgZGF0YS10ZW1wbGF0ZS1uYW1l
PSJsb2dnZWRfaW5fdXNlciI+CiAgICB7eyN3aXRoIGxvZ2dlZEluVXNlcn19CiAgICAgIExhc3Qg
TG9naW46IHt7bGFzdExvZ2lufX0KICAgICAgVXNlciBJbmZvOiB7e3RlbXBsYXRlICJ1c2VyX2lu
Zm8ifX0KICAgIHt7L3dpdGh9fQogIDwvc2NyaXB0PgogIGBgYAoKICBgYGBodG1sCiAgPHNjcmlw
dCB0eXBlPSJ0ZXh0L3gtaGFuZGxlYmFycyIgZGF0YS10ZW1wbGF0ZS1uYW1lPSJ1c2VyX2luZm8i
PgogICAgTmFtZTogPGVtPnt7bmFtZX19PC9lbT4KICAgIEthcm1hOiA8ZW0+e3trYXJtYX19PC9l
bT4KICA8L3NjcmlwdD4KICBgYGAKCiAgYGBgaGFuZGxlYmFycwogIHt7I2lmIGlzVXNlcn19CiAg
ICB7e3RlbXBsYXRlICJ1c2VyX2luZm8ifX0KICB7e2Vsc2V9fQogICAge3t0ZW1wbGF0ZSAidW5s
b2dnZWRfdXNlcl9pbmZvIn19CiAge3svaWZ9fQogIGBgYAoKICBUaGlzIGhlbHBlciBsb29rcyBm
b3IgdGVtcGxhdGVzIGluIHRoZSBnbG9iYWwgYEVtYmVyLlRFTVBMQVRFU2AgaGFzaC4gSWYgeW91
CiAgYWRkIGA8c2NyaXB0PmAgdGFncyB0byB5b3VyIHBhZ2Ugd2l0aCB0aGUgYGRhdGEtdGVtcGxh
dGUtbmFtZWAgYXR0cmlidXRlIHNldCwKICB0aGV5IHdpbGwgYmUgY29tcGlsZWQgYW5kIHBsYWNl
ZCBpbiB0aGlzIGhhc2ggYXV0b21hdGljYWxseS4KCiAgWW91IGNhbiBhbHNvIG1hbnVhbGx5IHJl
Z2lzdGVyIHRlbXBsYXRlcyBieSBhZGRpbmcgdGhlbSB0byB0aGUgaGFzaDoKCiAgYGBgamF2YXNj
cmlwdAogIEVtYmVyLlRFTVBMQVRFU1sibXlfY29vbF90ZW1wbGF0ZSJdID0gRW1iZXIuSGFuZGxl
YmFycy5jb21waWxlKCc8Yj57e3VzZXJ9fTwvYj4nKTsKICBgYGAKCiAgQGRlcHJlY2F0ZWQKICBA
bWV0aG9kIHRlbXBsYXRlCiAgQGZvciBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0g
e1N0cmluZ30gdGVtcGxhdGVOYW1lIHRoZSB0ZW1wbGF0ZSB0byByZW5kZXIKKi8KCkVtYmVyLkhh
bmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3RlbXBsYXRlJywgZnVuY3Rpb24obmFtZSwgb3B0aW9u
cykgewogIEVtYmVyLmRlcHJlY2F0ZSgiVGhlIGB0ZW1wbGF0ZWAgaGVscGVyIGhhcyBiZWVuIGRl
cHJlY2F0ZWQgaW4gZmF2b3Igb2YgdGhlIGBwYXJ0aWFsYCBoZWxwZXIuIFBsZWFzZSB1c2UgYHBh
cnRpYWxgIGluc3RlYWQsIHdoaWNoIHdpbGwgd29yayB0aGUgc2FtZSB3YXkuIik7CiAgcmV0dXJu
IEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycy5wYXJ0aWFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7
Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxl
IGVtYmVyLWhhbmRsZWJhcnMKKi8KCi8qKgogIFRoZSBgcGFydGlhbGAgaGVscGVyIHJlbmRlcnMg
YW5vdGhlciB0ZW1wbGF0ZSB3aXRob3V0CiAgY2hhbmdpbmcgdGhlIHRlbXBsYXRlIGNvbnRleHQ6
CgogIGBgYGhhbmRsZWJhcnMKICB7e2Zvb319CiAge3twYXJ0aWFsICJuYXYifX0KICBgYGAKCiAg
VGhlIGFib3ZlIGV4YW1wbGUgdGVtcGxhdGUgd2lsbCByZW5kZXIgYSB0ZW1wbGF0ZSBuYW1lZAog
ICJfbmF2Iiwgd2hpY2ggaGFzIHRoZSBzYW1lIGNvbnRleHQgYXMgdGhlIHBhcmVudCB0ZW1wbGF0
ZQogIGl0J3MgcmVuZGVyZWQgaW50bywgc28gaWYgdGhlICJfbmF2IiB0ZW1wbGF0ZSBhbHNvIHJl
ZmVyZW5jZWQKICBge3tmb299fWAsIGl0IHdvdWxkIHByaW50IHRoZSBzYW1lIHRoaW5nIGFzIHRo
ZSBge3tmb299fWAKICBpbiB0aGUgYWJvdmUgZXhhbXBsZS4KCiAgSWYgYSAiX25hdiIgdGVtcGxh
dGUgaXNuJ3QgZm91bmQsIHRoZSBgcGFydGlhbGAgaGVscGVyIHdpbGwKICBmYWxsIGJhY2sgdG8g
YSB0ZW1wbGF0ZSBuYW1lZCAibmF2Ii4KCiAgIyMgQm91bmQgdGVtcGxhdGUgbmFtZXMKCiAgVGhl
IHBhcmFtZXRlciBzdXBwbGllZCB0byBgcGFydGlhbGAgY2FuIGFsc28gYmUgYSBwYXRoCiAgdG8g
YSBwcm9wZXJ0eSBjb250YWluaW5nIGEgdGVtcGxhdGUgbmFtZSwgZS5nLjoKCiAgYGBgaGFuZGxl
YmFycwogIHt7cGFydGlhbCBzb21lVGVtcGxhdGVOYW1lfX0KICBgYGAKCiAgVGhlIGFib3ZlIGV4
YW1wbGUgd2lsbCBsb29rIHVwIHRoZSB2YWx1ZSBvZiBgc29tZVRlbXBsYXRlTmFtZWAKICBvbiB0
aGUgdGVtcGxhdGUgY29udGV4dCAoZS5nLiBhIGNvbnRyb2xsZXIpIGFuZCB1c2UgdGhhdAogIHZh
bHVlIGFzIHRoZSBuYW1lIG9mIHRoZSB0ZW1wbGF0ZSB0byByZW5kZXIuIElmIHRoZSByZXNvbHZl
ZAogIHZhbHVlIGlzIGZhbHN5LCBub3RoaW5nIHdpbGwgYmUgcmVuZGVyZWQuIElmIGBzb21lVGVt
cGxhdGVOYW1lYAogIGNoYW5nZXMsIHRoZSBwYXJ0aWFsIHdpbGwgYmUgcmUtcmVuZGVyZWQgdXNp
bmcgdGhlIG5ldyB0ZW1wbGF0ZQogIG5hbWUuCgogICMjIFNldHRpbmcgdGhlIHBhcnRpYWwncyBj
b250ZXh0IHdpdGggYHdpdGhgCgogIFRoZSBgcGFydGlhbGAgaGVscGVyIGNhbiBiZSB1c2VkIGlu
IGNvbmp1bmN0aW9uIHdpdGggdGhlIGB3aXRoYAogIGhlbHBlciB0byBzZXQgYSBjb250ZXh0IHRo
YXQgd2lsbCBiZSB1c2VkIGJ5IHRoZSBwYXJ0aWFsOgoKICBgYGBoYW5kbGViYXJzCiAge3sjd2l0
aCBjdXJyZW50VXNlcn19CiAgICB7e3BhcnRpYWwgInVzZXJfaW5mbyJ9fQogIHt7L3dpdGh9fQog
IGBgYAoKICBAbWV0aG9kIHBhcnRpYWwKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwog
IEBwYXJhbSB7U3RyaW5nfSBwYXJ0aWFsTmFtZSB0aGUgbmFtZSBvZiB0aGUgdGVtcGxhdGUgdG8g
cmVuZGVyIG1pbnVzIHRoZSBsZWFkaW5nIHVuZGVyc2NvcmUKKi8KCkVtYmVyLkhhbmRsZWJhcnMu
cmVnaXN0ZXJIZWxwZXIoJ3BhcnRpYWwnLCBmdW5jdGlvbiBwYXJ0aWFsSGVscGVyKG5hbWUsIG9w
dGlvbnMpIHsKCiAgdmFyIGNvbnRleHQgPSAob3B0aW9ucy5jb250ZXh0cyAmJiBvcHRpb25zLmNv
bnRleHRzLmxlbmd0aCkgPyBvcHRpb25zLmNvbnRleHRzWzBdIDogdGhpczsKCiAgaWYgKG9wdGlv
bnMudHlwZXNbMF0gPT09ICJJRCIpIHsKICAgIC8vIEhlbHBlciB3YXMgcGFzc2VkIGEgcHJvcGVy
dHkgcGF0aDsgd2UgbmVlZCB0bwogICAgLy8gY3JlYXRlIGEgYmluZGluZyB0aGF0IHdpbGwgcmUt
cmVuZGVyIHdoZW5ldmVyCiAgICAvLyB0aGlzIHByb3BlcnR5IGNoYW5nZXMuCiAgICBvcHRpb25z
LmZuID0gZnVuY3Rpb24oY29udGV4dCwgZm5PcHRpb25zKSB7CiAgICAgIHZhciBwYXJ0aWFsTmFt
ZSA9IEVtYmVyLkhhbmRsZWJhcnMuZ2V0KGNvbnRleHQsIG5hbWUsIGZuT3B0aW9ucyk7CiAgICAg
IHJlbmRlclBhcnRpYWwoY29udGV4dCwgcGFydGlhbE5hbWUsIGZuT3B0aW9ucyk7CiAgICB9OwoK
ICAgIHJldHVybiBFbWJlci5IYW5kbGViYXJzLmJpbmQuY2FsbChjb250ZXh0LCBuYW1lLCBvcHRp
b25zLCB0cnVlLCBleGlzdHMpOwogIH0gZWxzZSB7CiAgICAvLyBSZW5kZXIgdGhlIHBhcnRpYWwg
cmlnaHQgaW50byBwYXJlbnQgdGVtcGxhdGUuCiAgICByZW5kZXJQYXJ0aWFsKGNvbnRleHQsIG5h
bWUsIG9wdGlvbnMpOwogIH0KfSk7CgpmdW5jdGlvbiBleGlzdHModmFsdWUpIHsKICByZXR1cm4g
IUVtYmVyLmlzTm9uZSh2YWx1ZSk7Cn0KCmZ1bmN0aW9uIHJlbmRlclBhcnRpYWwoY29udGV4dCwg
bmFtZSwgb3B0aW9ucykgewogIHZhciBuYW1lUGFydHMgPSBuYW1lLnNwbGl0KCIvIiksCiAgICAg
IGxhc3RQYXJ0ID0gbmFtZVBhcnRzW25hbWVQYXJ0cy5sZW5ndGggLSAxXTsKCiAgbmFtZVBhcnRz
W25hbWVQYXJ0cy5sZW5ndGggLSAxXSA9ICJfIiArIGxhc3RQYXJ0OwoKICB2YXIgdmlldyA9IG9w
dGlvbnMuZGF0YS52aWV3LAogICAgICB1bmRlcnNjb3JlZE5hbWUgPSBuYW1lUGFydHMuam9pbigi
LyIpLAogICAgICB0ZW1wbGF0ZSA9IHZpZXcudGVtcGxhdGVGb3JOYW1lKHVuZGVyc2NvcmVkTmFt
ZSksCiAgICAgIGRlcHJlY2F0ZWRUZW1wbGF0ZSA9ICF0ZW1wbGF0ZSAmJiB2aWV3LnRlbXBsYXRl
Rm9yTmFtZShuYW1lKTsKCiAgRW1iZXIuYXNzZXJ0KCJVbmFibGUgdG8gZmluZCBwYXJ0aWFsIHdp
dGggbmFtZSAnIituYW1lKyInLiIsIHRlbXBsYXRlIHx8IGRlcHJlY2F0ZWRUZW1wbGF0ZSk7Cgog
IHRlbXBsYXRlID0gdGVtcGxhdGUgfHwgZGVwcmVjYXRlZFRlbXBsYXRlOwoKICB0ZW1wbGF0ZShj
b250ZXh0LCB7IGRhdGE6IG9wdGlvbnMuZGF0YSB9KTsKfQoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkg
ewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRsZWJhcnMKKi8KCnZhciBn
ZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCi8qKgogIGB7e3lpZWxkfX1gIGRlbm90
ZXMgYW4gYXJlYSBvZiBhIHRlbXBsYXRlIHRoYXQgd2lsbCBiZSByZW5kZXJlZCBpbnNpZGUKICBv
ZiBhbm90aGVyIHRlbXBsYXRlLiBJdCBoYXMgdHdvIG1haW4gdXNlczoKCiAgIyMjIFVzZSB3aXRo
IGBsYXlvdXRgCiAgV2hlbiB1c2VkIGluIGEgSGFuZGxlYmFycyB0ZW1wbGF0ZSB0aGF0IGlzIGFz
c2lnbmVkIHRvIGFuIGBFbWJlci5WaWV3YAogIGluc3RhbmNlJ3MgYGxheW91dGAgcHJvcGVydHkg
RW1iZXIgd2lsbCByZW5kZXIgdGhlIGxheW91dCB0ZW1wbGF0ZSBmaXJzdCwKICBpbnNlcnRpbmcg
dGhlIHZpZXcncyBvd24gcmVuZGVyZWQgb3V0cHV0IGF0IHRoZSBge3t5aWVsZH19YCBsb2NhdGlv
bi4KCiAgQW4gZW1wdHkgYDxib2R5PmAgYW5kIHRoZSBmb2xsb3dpbmcgYXBwbGljYXRpb24gY29k
ZToKCiAgYGBgamF2YXNjcmlwdAogIEFWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xh
c3NOYW1lczogWydhLXZpZXctd2l0aC1sYXlvdXQnXSwKICAgIGxheW91dDogRW1iZXIuSGFuZGxl
YmFycy5jb21waWxlKCc8ZGl2IGNsYXNzPSJ3cmFwcGVyIj57e3lpZWxkfX08L2Rpdj4nKSwKICAg
IHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoJzxzcGFuPkkgYW0gd3JhcHBlZDwv
c3Bhbj4nKQogIH0pOwoKICBhVmlldyA9IEFWaWV3LmNyZWF0ZSgpOwogIGFWaWV3LmFwcGVuZFRv
KCdib2R5Jyk7CiAgYGBgCgogIFdpbGwgcmVzdWx0IGluIHRoZSBmb2xsb3dpbmcgSFRNTCBvdXRw
dXQ6CgogIGBgYGh0bWwKICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9J2VtYmVyLXZpZXcgYS12aWV3
LXdpdGgtbGF5b3V0Jz4KICAgICAgPGRpdiBjbGFzcz0id3JhcHBlciI+CiAgICAgICAgPHNwYW4+
SSBhbSB3cmFwcGVkPC9zcGFuPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvYm9keT4KICBg
YGAKCiAgVGhlIGB5aWVsZGAgaGVscGVyIGNhbm5vdCBiZSB1c2VkIG91dHNpZGUgb2YgYSB0ZW1w
bGF0ZSBhc3NpZ25lZCB0byBhbgogIGBFbWJlci5WaWV3YCdzIGBsYXlvdXRgIHByb3BlcnR5IGFu
ZCB3aWxsIHRocm93IGFuIGVycm9yIGlmIGF0dGVtcHRlZC4KCiAgYGBgamF2YXNjcmlwdAogIEJW
aWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgY2xhc3NOYW1lczogWydhLXZpZXctd2l0aC1s
YXlvdXQnXSwKICAgIHRlbXBsYXRlOiBFbWJlci5IYW5kbGViYXJzLmNvbXBpbGUoJ3t7eWllbGR9
fScpCiAgfSk7CgogIGJWaWV3ID0gQlZpZXcuY3JlYXRlKCk7CiAgYlZpZXcuYXBwZW5kVG8oJ2Jv
ZHknKTsKCiAgLy8gdGhyb3dzCiAgLy8gVW5jYXVnaHQgRXJyb3I6IGFzc2VydGlvbiBmYWlsZWQ6
CiAgLy8gWW91IGNhbGxlZCB5aWVsZCBpbiBhIHRlbXBsYXRlIHRoYXQgd2FzIG5vdCBhIGxheW91
dAogIGBgYAoKICAjIyMgVXNlIHdpdGggRW1iZXIuQ29tcG9uZW50CiAgV2hlbiBkZXNpZ25pbmcg
Y29tcG9uZW50cyBge3t5aWVsZH19YCBpcyB1c2VkIHRvIGRlbm90ZSB3aGVyZSwgaW5zaWRlIHRo
ZSBjb21wb25lbnQncwogIHRlbXBsYXRlLCBhbiBvcHRpb25hbCBibG9jayBwYXNzZWQgdG8gdGhl
IGNvbXBvbmVudCBzaG91bGQgcmVuZGVyOgoKICBgYGBoYW5kbGViYXJzCiAgPCEtLSBhcHBsaWNh
dGlvbi5oYnMgLS0+CiAge3sjbGFiZWxlZC10ZXh0ZmllbGQgdmFsdWU9c29tZVByb3BlcnR5fX0K
ICAgIEZpcnN0IG5hbWU6CiAge3svbGFiZWxlZC10ZXh0ZmllbGR9fQogIGBgYAoKICBgYGBoYW5k
bGViYXJzCiAgPCEtLSBjb21wb25lbnRzL2xhYmVsZWQtdGV4dGZpZWxkLmhicyAtLT4KICA8bGFi
ZWw+CiAgICB7e3lpZWxkfX0ge3tpbnB1dCB2YWx1ZT12YWx1ZX19CiAgPC9sYWJlbD4KICBgYGAK
CiAgUmVzdWx0OgoKICBgYGBodG1sCiAgPGxhYmVsPgogICAgRmlyc3QgbmFtZTogPGlucHV0IHR5
cGU9InRleHQiIC8+CiAgPGxhYmVsPgogIGBgYAoKICBAbWV0aG9kIHlpZWxkCiAgQGZvciBFbWJl
ci5IYW5kbGViYXJzLmhlbHBlcnMKICBAcGFyYW0ge0hhc2h9IG9wdGlvbnMKICBAcmV0dXJuIHtT
dHJpbmd9IEhUTUwgc3RyaW5nCiovCkVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3lp
ZWxkJywgZnVuY3Rpb24geWllbGRIZWxwZXIob3B0aW9ucykgewogIHZhciB2aWV3ID0gb3B0aW9u
cy5kYXRhLnZpZXc7CgogIHdoaWxlICh2aWV3ICYmICFnZXQodmlldywgJ2xheW91dCcpKSB7CiAg
ICBpZiAodmlldy5fY29udGV4dFZpZXcpIHsKICAgICAgdmlldyA9IHZpZXcuX2NvbnRleHRWaWV3
OwogICAgfSBlbHNlIHsKICAgICAgdmlldyA9IGdldCh2aWV3LCAncGFyZW50VmlldycpOwogICAg
fQogIH0KCiAgRW1iZXIuYXNzZXJ0KCJZb3UgY2FsbGVkIHlpZWxkIGluIGEgdGVtcGxhdGUgdGhh
dCB3YXMgbm90IGEgbGF5b3V0IiwgISF2aWV3KTsKCiAgdmlldy5feWllbGQodGhpcywgb3B0aW9u
cyk7Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9k
dWxlIGVtYmVyLWhhbmRsZWJhcnMKKi8KCi8qKgogIGBsb2NgIGxvb2tzIHVwIHRoZSBzdHJpbmcg
aW4gdGhlIGxvY2FsaXplZCBzdHJpbmdzIGhhc2guCiAgVGhpcyBpcyBhIGNvbnZlbmllbnQgd2F5
IHRvIGxvY2FsaXplIHRleHQuIEZvciBleGFtcGxlOgoKICBgYGBodG1sCiAgPHNjcmlwdCB0eXBl
PSJ0ZXh0L3gtaGFuZGxlYmFycyIgZGF0YS10ZW1wbGF0ZS1uYW1lPSJob21lIj4KICAgIHt7bG9j
ICJ3ZWxjb21lIn19CiAgPC9zY3JpcHQ+CiAgYGBgCgogIFRha2Ugbm90ZSB0aGF0IGAid2VsY29t
ZSJgIGlzIGEgc3RyaW5nIGFuZCBub3QgYW4gb2JqZWN0CiAgcmVmZXJlbmNlLgoKICBAbWV0aG9k
IGxvYwogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtTdHJpbmd9IHN0
ciBUaGUgc3RyaW5nIHRvIGZvcm1hdAoqLwoKRW1iZXIuSGFuZGxlYmFycy5yZWdpc3RlckhlbHBl
cignbG9jJywgZnVuY3Rpb24gbG9jSGVscGVyKHN0cikgewogIHJldHVybiBFbWJlci5TdHJpbmcu
bG9jKHN0cik7Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgoKKGZ1bmN0aW9u
KCkgewoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxl
IGVtYmVyLWhhbmRsZWJhcnMKKi8KCnZhciBzZXQgPSBFbWJlci5zZXQsIGdldCA9IEVtYmVyLmdl
dDsKCi8qKgogIFRoZSBpbnRlcm5hbCBjbGFzcyB1c2VkIHRvIGNyZWF0ZSB0ZXh0IGlucHV0cyB3
aGVuIHRoZSBge3tpbnB1dH19YAogIGhlbHBlciBpcyB1c2VkIHdpdGggYHR5cGVgIG9mIGBjaGVj
a2JveGAuCgogIFNlZSBbaGFuZGxlYmFycy5oZWxwZXJzLmlucHV0XSgvYXBpL2NsYXNzZXMvRW1i
ZXIuSGFuZGxlYmFycy5oZWxwZXJzLmh0bWwjbWV0aG9kX2lucHV0KSAgZm9yIHVzYWdlIGRldGFp
bHMuCgogICMjIERpcmVjdCBtYW5pcHVsYXRpb24gb2YgYGNoZWNrZWRgCgogIFRoZSBgY2hlY2tl
ZGAgYXR0cmlidXRlIG9mIGFuIGBFbWJlci5DaGVja2JveGAgb2JqZWN0IHNob3VsZCBhbHdheXMg
YmUgc2V0CiAgdGhyb3VnaCB0aGUgRW1iZXIgb2JqZWN0IG9yIGJ5IGludGVyYWN0aW5nIHdpdGgg
aXRzIHJlbmRlcmVkIGVsZW1lbnQKICByZXByZXNlbnRhdGlvbiB2aWEgdGhlIG1vdXNlLCBrZXli
b2FyZCwgb3IgdG91Y2guIFVwZGF0aW5nIHRoZSB2YWx1ZSBvZiB0aGUKICBjaGVja2JveCB2aWEg
alF1ZXJ5IHdpbGwgcmVzdWx0IGluIHRoZSBjaGVja2VkIHZhbHVlIG9mIHRoZSBvYmplY3QgYW5k
IGl0cwogIGVsZW1lbnQgbG9zaW5nIHN5bmNocm9uaXphdGlvbi4KCiAgIyMgTGF5b3V0IGFuZCBM
YXlvdXROYW1lIHByb3BlcnRpZXMKCiAgQmVjYXVzZSBIVE1MIGBpbnB1dGAgZWxlbWVudHMgYXJl
IHNlbGYgY2xvc2luZyBgbGF5b3V0YCBhbmQgYGxheW91dE5hbWVgCiAgcHJvcGVydGllcyB3aWxs
IG5vdCBiZSBhcHBsaWVkLiBTZWUgW0VtYmVyLlZpZXddKC9hcGkvY2xhc3Nlcy9FbWJlci5WaWV3
Lmh0bWwpJ3MKICBsYXlvdXQgc2VjdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCiAgQGNsYXNz
IENoZWNrYm94CiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLlZpZXcKKi8KRW1i
ZXIuQ2hlY2tib3ggPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgY2xhc3NOYW1lczogWydlbWJlci1j
aGVja2JveCddLAoKICB0YWdOYW1lOiAnaW5wdXQnLAoKICBhdHRyaWJ1dGVCaW5kaW5nczogWyd0
eXBlJywgJ2NoZWNrZWQnLCAnaW5kZXRlcm1pbmF0ZScsICdkaXNhYmxlZCcsICd0YWJpbmRleCcs
ICduYW1lJ10sCgogIHR5cGU6ICJjaGVja2JveCIsCiAgY2hlY2tlZDogZmFsc2UsCiAgZGlzYWJs
ZWQ6IGZhbHNlLAogIGluZGV0ZXJtaW5hdGU6IGZhbHNlLAoKICBpbml0OiBmdW5jdGlvbigpIHsK
ICAgIHRoaXMuX3N1cGVyKCk7CiAgICB0aGlzLm9uKCJjaGFuZ2UiLCB0aGlzLCB0aGlzLl91cGRh
dGVFbGVtZW50VmFsdWUpOwogIH0sCgogIGRpZEluc2VydEVsZW1lbnQ6IGZ1bmN0aW9uKCkgewog
ICAgdGhpcy5fc3VwZXIoKTsKICAgIHRoaXMuZ2V0KCdlbGVtZW50JykuaW5kZXRlcm1pbmF0ZSA9
ICEhdGhpcy5nZXQoJ2luZGV0ZXJtaW5hdGUnKTsKICB9LAoKICBfdXBkYXRlRWxlbWVudFZhbHVl
OiBmdW5jdGlvbigpIHsKICAgIHNldCh0aGlzLCAnY2hlY2tlZCcsIHRoaXMuJCgpLnByb3AoJ2No
ZWNrZWQnKSk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1i
ZXIKQHN1Ym1vZHVsZSBlbWJlci1oYW5kbGViYXJzCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBz
ZXQgPSBFbWJlci5zZXQ7CgovKioKICBTaGFyZWQgbWl4aW4gdXNlZCBieSBgRW1iZXIuVGV4dEZp
ZWxkYCBhbmQgYEVtYmVyLlRleHRBcmVhYC4KCiAgQGNsYXNzIFRleHRTdXBwb3J0CiAgQG5hbWVz
cGFjZSBFbWJlcgogIEBwcml2YXRlCiovCkVtYmVyLlRleHRTdXBwb3J0ID0gRW1iZXIuTWl4aW4u
Y3JlYXRlKHsKICB2YWx1ZTogIiIsCgogIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ3BsYWNlaG9sZGVy
JywgJ2Rpc2FibGVkJywgJ21heGxlbmd0aCcsICd0YWJpbmRleCcsICdyZWFkb25seSddLAogIHBs
YWNlaG9sZGVyOiBudWxsLAogIGRpc2FibGVkOiBmYWxzZSwKICBtYXhsZW5ndGg6IG51bGwsCgog
IGluaXQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fc3VwZXIoKTsKICAgIHRoaXMub24oImZvY3Vz
T3V0IiwgdGhpcywgdGhpcy5fZWxlbWVudFZhbHVlRGlkQ2hhbmdlKTsKICAgIHRoaXMub24oImNo
YW5nZSIsIHRoaXMsIHRoaXMuX2VsZW1lbnRWYWx1ZURpZENoYW5nZSk7CiAgICB0aGlzLm9uKCJw
YXN0ZSIsIHRoaXMsIHRoaXMuX2VsZW1lbnRWYWx1ZURpZENoYW5nZSk7CiAgICB0aGlzLm9uKCJj
dXQiLCB0aGlzLCB0aGlzLl9lbGVtZW50VmFsdWVEaWRDaGFuZ2UpOwogICAgdGhpcy5vbigiaW5w
dXQiLCB0aGlzLCB0aGlzLl9lbGVtZW50VmFsdWVEaWRDaGFuZ2UpOwogICAgdGhpcy5vbigia2V5
VXAiLCB0aGlzLCB0aGlzLmludGVycHJldEtleUV2ZW50cyk7CiAgfSwKCiAgLyoqCiAgICBUaGUg
YWN0aW9uIHRvIGJlIHNlbnQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIHRoZSByZXR1cm4ga2V5LgoK
ICAgIFRoaXMgaXMgc2ltaWxhciB0byB0aGUgYHt7YWN0aW9ufX1gIGhlbHBlciwgYnV0IGlzIGZp
cmVkIHdoZW4KICAgIHRoZSB1c2VyIHByZXNzZXMgdGhlIHJldHVybiBrZXkgd2hlbiBlZGl0aW5n
IGEgdGV4dCBmaWVsZCwgYW5kIHNlbmRzCiAgICB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkIGFzIHRo
ZSBjb250ZXh0LgoKICAgIEBwcm9wZXJ0eSBhY3Rpb24KICAgIEB0eXBlIFN0cmluZwogICAgQGRl
ZmF1bHQgbnVsbAogICovCiAgYWN0aW9uOiBudWxsLAoKICAvKioKICAgIFRoZSBldmVudCB0aGF0
IHNob3VsZCBzZW5kIHRoZSBhY3Rpb24uCgogICAgT3B0aW9ucyBhcmU6CgogICAgKiBgZW50ZXJg
OiB0aGUgdXNlciBwcmVzc2VkIGVudGVyCiAgICAqIGBrZXlQcmVzc2A6IHRoZSB1c2VyIHByZXNz
ZWQgYSBrZXkKCiAgICBAcHJvcGVydHkgb25FdmVudAogICAgQHR5cGUgU3RyaW5nCiAgICBAZGVm
YXVsdCBlbnRlcgogICovCiAgb25FdmVudDogJ2VudGVyJywKCiAgLyoqCiAgICBXaGV0aGVyIHRo
ZXkgYGtleVVwYCBldmVudCB0aGF0IHRyaWdnZXJzIGFuIGBhY3Rpb25gIHRvIGJlIHNlbnQgY29u
dGludWVzCiAgICBwcm9wYWdhdGluZyB0byBvdGhlciB2aWV3cy4KCiAgICBCeSBkZWZhdWx0LCB3
aGVuIHRoZSB1c2VyIHByZXNzZXMgdGhlIHJldHVybiBrZXkgb24gdGhlaXIga2V5Ym9hcmQgYW5k
CiAgICB0aGUgdGV4dCBmaWVsZCBoYXMgYW4gYGFjdGlvbmAgc2V0LCB0aGUgYWN0aW9uIHdpbGwg
YmUgc2VudCB0byB0aGUgdmlldydzCiAgICBjb250cm9sbGVyIGFuZCB0aGUga2V5IGV2ZW50IHdp
bGwgc3RvcCBwcm9wYWdhdGluZy4KCiAgICBJZiB5b3Ugd291bGQgbGlrZSBwYXJlbnQgdmlld3Mg
dG8gcmVjZWl2ZSB0aGUgYGtleVVwYCBldmVudCBldmVuIGFmdGVyIGFuCiAgICBhY3Rpb24gaGFz
IGJlZW4gZGlzcGF0Y2hlZCwgc2V0IGBidWJibGVzYCB0byB0cnVlLgoKICAgIEBwcm9wZXJ0eSBi
dWJibGVzCiAgICBAdHlwZSBCb29sZWFuCiAgICBAZGVmYXVsdCBmYWxzZQogICovCiAgYnViYmxl
czogZmFsc2UsCgogIGludGVycHJldEtleUV2ZW50czogZnVuY3Rpb24oZXZlbnQpIHsKICAgIHZh
ciBtYXAgPSBFbWJlci5UZXh0U3VwcG9ydC5LRVlfRVZFTlRTOwogICAgdmFyIG1ldGhvZCA9IG1h
cFtldmVudC5rZXlDb2RlXTsKCiAgICB0aGlzLl9lbGVtZW50VmFsdWVEaWRDaGFuZ2UoKTsKICAg
IGlmIChtZXRob2QpIHsgcmV0dXJuIHRoaXNbbWV0aG9kXShldmVudCk7IH0KICB9LAoKICBfZWxl
bWVudFZhbHVlRGlkQ2hhbmdlOiBmdW5jdGlvbigpIHsKICAgIHNldCh0aGlzLCAndmFsdWUnLCB0
aGlzLiQoKS52YWwoKSk7CiAgfSwKCiAgLyoqCiAgICBUaGUgYWN0aW9uIHRvIGJlIHNlbnQgd2hl
biB0aGUgdXNlciBpbnNlcnRzIGEgbmV3IGxpbmUuCgogICAgQ2FsbGVkIGJ5IHRoZSBgRW1iZXIu
VGV4dFN1cHBvcnRgIG1peGluIG9uIGtleVVwIGlmIGtleWNvZGUgbWF0Y2hlcyAxMy4KICAgIFVz
ZXMgc2VuZEFjdGlvbiB0byBzZW5kIHRoZSBgZW50ZXJgIGFjdGlvbiB0byB0aGUgY29udHJvbGxl
ci4KCiAgICBAbWV0aG9kIGluc2VydE5ld2xpbmUKICAgIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAg
Ki8KICBpbnNlcnROZXdsaW5lOiBmdW5jdGlvbihldmVudCkgewogICAgc2VuZEFjdGlvbignZW50
ZXInLCB0aGlzLCBldmVudCk7CiAgICBzZW5kQWN0aW9uKCdpbnNlcnQtbmV3bGluZScsIHRoaXMs
IGV2ZW50KTsKICB9LAoKICAvKioKICAgIENhbGxlZCB3aGVuIHRoZSB1c2VyIGhpdHMgZXNjYXBl
LgoKICAgIENhbGxlZCBieSB0aGUgYEVtYmVyLlRleHRTdXBwb3J0YCBtaXhpbiBvbiBrZXlVcCBp
ZiBrZXljb2RlIG1hdGNoZXMgMjcuCiAgICBVc2VzIHNlbmRBY3Rpb24gdG8gc2VuZCB0aGUgYGVz
Y2FwZS1wcmVzc2AgYWN0aW9uIHRvIHRoZSBjb250cm9sbGVyLgoKICAgIEBtZXRob2QgY2FuY2Vs
CiAgICBAcGFyYW0ge0V2ZW50fSBldmVudAogICovCiAgY2FuY2VsOiBmdW5jdGlvbihldmVudCkg
ewogICAgc2VuZEFjdGlvbignZXNjYXBlLXByZXNzJywgdGhpcywgZXZlbnQpOwogIH0sCgogIC8q
KgogICAgQ2FsbGVkIHdoZW4gdGhlIHRleHQgYXJlYSBpcyBmb2N1c2VkLgoKICAgIEBtZXRob2Qg
Zm9jdXNJbgogICAgQHBhcmFtIHtFdmVudH0gZXZlbnQKICAqLwogIGZvY3VzSW46IGZ1bmN0aW9u
KGV2ZW50KSB7CiAgICBzZW5kQWN0aW9uKCdmb2N1cy1pbicsIHRoaXMsIGV2ZW50KTsKICB9LAoK
ICAvKioKICAgIENhbGxlZCB3aGVuIHRoZSB0ZXh0IGFyZWEgaXMgYmx1cnJlZC4KCiAgICBAbWV0
aG9kIGZvY3VzT3V0CiAgICBAcGFyYW0ge0V2ZW50fSBldmVudAogICovCiAgZm9jdXNPdXQ6IGZ1
bmN0aW9uKGV2ZW50KSB7CiAgICBzZW5kQWN0aW9uKCdmb2N1cy1vdXQnLCB0aGlzLCBldmVudCk7
CiAgfSwKCiAgLyoqCiAgICBUaGUgYWN0aW9uIHRvIGJlIHNlbnQgd2hlbiB0aGUgdXNlciBwcmVz
c2VzIGEga2V5LiBFbmFibGVkIGJ5IHNldHRpbmcKICAgIHRoZSBgb25FdmVudGAgcHJvcGVydHkg
dG8gYGtleVByZXNzYC4KCiAgICBVc2VzIHNlbmRBY3Rpb24gdG8gc2VuZCB0aGUgYGtleVByZXNz
YCBhY3Rpb24gdG8gdGhlIGNvbnRyb2xsZXIuCgogICAgQG1ldGhvZCBrZXlQcmVzcwogICAgQHBh
cmFtIHtFdmVudH0gZXZlbnQKICAqLwogIGtleVByZXNzOiBmdW5jdGlvbihldmVudCkgewogICAg
c2VuZEFjdGlvbigna2V5LXByZXNzJywgdGhpcywgZXZlbnQpOwogIH0KCn0pOwoKRW1iZXIuVGV4
dFN1cHBvcnQuS0VZX0VWRU5UUyA9IHsKICAxMzogJ2luc2VydE5ld2xpbmUnLAogIDI3OiAnY2Fu
Y2VsJwp9OwoKLy8gSW4gcHJpbmNpcGxlLCB0aGlzIHNob3VsZG4ndCBiZSBuZWNlc3NhcnksIGJ1
dCB0aGUgbGVnYWN5Ci8vIHNlY3Rpb25BY3Rpb24gc2VtYW50aWNzIGZvciBUZXh0RmllbGQgYXJl
IGRpZmZlcmVudCBmcm9tCi8vIHRoZSBjb21wb25lbnQgc2VtYW50aWNzIHNvIHRoaXMgbWV0aG9k
IG5vcm1hbGl6ZXMgdGhlbS4KZnVuY3Rpb24gc2VuZEFjdGlvbihldmVudE5hbWUsIHZpZXcsIGV2
ZW50KSB7CiAgdmFyIGFjdGlvbiA9IGdldCh2aWV3LCBldmVudE5hbWUpLAogICAgICBvbiA9IGdl
dCh2aWV3LCAnb25FdmVudCcpLAogICAgICB2YWx1ZSA9IGdldCh2aWV3LCAndmFsdWUnKTsKCiAg
Ly8gYmFjay1jb21wYXQgc3VwcG9ydCBmb3Iga2V5UHJlc3MgYXMgYW4gZXZlbnQgbmFtZSBldmVu
IHRob3VnaAogIC8vIGl0J3MgYWxzbyBhIG1ldGhvZCBuYW1lIHRoYXQgY29uc3VtZXMgdGhlIGV2
ZW50IChhbmQgdGhlcmVmb3JlCiAgLy8gaW5jb21wYXRpYmxlIHdpdGggc2VuZEFjdGlvbiBzZW1h
bnRpY3MpLgogIGlmIChvbiA9PT0gZXZlbnROYW1lIHx8IChvbiA9PT0gJ2tleVByZXNzJyAmJiBl
dmVudE5hbWUgPT09ICdrZXktcHJlc3MnKSkgewogICAgdmlldy5zZW5kQWN0aW9uKCdhY3Rpb24n
LCB2YWx1ZSk7CiAgfQoKICB2aWV3LnNlbmRBY3Rpb24oZXZlbnROYW1lLCB2YWx1ZSk7CgogIGlm
IChhY3Rpb24gfHwgb24gPT09IGV2ZW50TmFtZSkgewogICAgaWYoIWdldCh2aWV3LCAnYnViYmxl
cycpKSB7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQogIH0KfQoKfSkoKTsK
CgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRs
ZWJhcnMKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCi8qKgoKICBU
aGUgaW50ZXJuYWwgY2xhc3MgdXNlZCB0byBjcmVhdGUgdGV4dCBpbnB1dHMgd2hlbiB0aGUgYHt7
aW5wdXR9fWAKICBoZWxwZXIgaXMgdXNlZCB3aXRoIGB0eXBlYCBvZiBgdGV4dGAuCgogIFNlZSBb
SGFuZGxlYmFycy5oZWxwZXJzLmlucHV0XSgvYXBpL2NsYXNzZXMvRW1iZXIuSGFuZGxlYmFycy5o
ZWxwZXJzLmh0bWwjbWV0aG9kX2lucHV0KSAgZm9yIHVzYWdlIGRldGFpbHMuCgogICMjIExheW91
dCBhbmQgTGF5b3V0TmFtZSBwcm9wZXJ0aWVzCgogIEJlY2F1c2UgSFRNTCBgaW5wdXRgIGVsZW1l
bnRzIGFyZSBzZWxmIGNsb3NpbmcgYGxheW91dGAgYW5kIGBsYXlvdXROYW1lYAogIHByb3BlcnRp
ZXMgd2lsbCBub3QgYmUgYXBwbGllZC4gU2VlIFtFbWJlci5WaWV3XSgvYXBpL2NsYXNzZXMvRW1i
ZXIuVmlldy5odG1sKSdzCiAgbGF5b3V0IHNlY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCgog
IEBjbGFzcyBUZXh0RmllbGQKICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuQ29t
cG9uZW50CiAgQHVzZXMgRW1iZXIuVGV4dFN1cHBvcnQKKi8KRW1iZXIuVGV4dEZpZWxkID0gRW1i
ZXIuQ29tcG9uZW50LmV4dGVuZChFbWJlci5UZXh0U3VwcG9ydCwgewoKICBjbGFzc05hbWVzOiBb
J2VtYmVyLXRleHQtZmllbGQnXSwKICB0YWdOYW1lOiAiaW5wdXQiLAogIGF0dHJpYnV0ZUJpbmRp
bmdzOiBbJ3R5cGUnLCAndmFsdWUnLCAnc2l6ZScsICdwYXR0ZXJuJywgJ25hbWUnXSwKCiAgLyoq
CiAgICBUaGUgYHZhbHVlYCBhdHRyaWJ1dGUgb2YgdGhlIGlucHV0IGVsZW1lbnQuIEFzIHRoZSB1
c2VyIGlucHV0cyB0ZXh0LCB0aGlzCiAgICBwcm9wZXJ0eSBpcyB1cGRhdGVkIGxpdmUuCgogICAg
QHByb3BlcnR5IHZhbHVlCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0ICIiCiAgKi8KICB2
YWx1ZTogIiIsCgogIC8qKgogICAgVGhlIGB0eXBlYCBhdHRyaWJ1dGUgb2YgdGhlIGlucHV0IGVs
ZW1lbnQuCgogICAgQHByb3BlcnR5IHR5cGUKICAgIEB0eXBlIFN0cmluZwogICAgQGRlZmF1bHQg
InRleHQiCiAgKi8KICB0eXBlOiAidGV4dCIsCgogIC8qKgogICAgVGhlIGBzaXplYCBvZiB0aGUg
dGV4dCBmaWVsZCBpbiBjaGFyYWN0ZXJzLgoKICAgIEBwcm9wZXJ0eSBzaXplCiAgICBAdHlwZSBT
dHJpbmcKICAgIEBkZWZhdWx0IG51bGwKICAqLwogIHNpemU6IG51bGwsCgogIC8qKgogICAgVGhl
IGBwYXR0ZXJuYCB0aGUgcGF0dGVybiBhdHRyaWJ1dGUgb2YgaW5wdXQgZWxlbWVudC4KCiAgICBA
cHJvcGVydHkgcGF0dGVybgogICAgQHR5cGUgU3RyaW5nCiAgICBAZGVmYXVsdCBudWxsCiAgKi8K
ICBwYXR0ZXJuOiBudWxsCn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKgpAbW9kdWxlIGVt
YmVyCkBzdWJtb2R1bGUgZW1iZXItaGFuZGxlYmFycwoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwg
c2V0ID0gRW1iZXIuc2V0OwoKLyoKICBAY2xhc3MgQnV0dG9uCiAgQG5hbWVzcGFjZSBFbWJlcgog
IEBleHRlbmRzIEVtYmVyLlZpZXcKICBAdXNlcyBFbWJlci5UYXJnZXRBY3Rpb25TdXBwb3J0CiAg
QGRlcHJlY2F0ZWQKKi8KRW1iZXIuQnV0dG9uID0gRW1iZXIuVmlldy5leHRlbmQoRW1iZXIuVGFy
Z2V0QWN0aW9uU3VwcG9ydCwgewogIGNsYXNzTmFtZXM6IFsnZW1iZXItYnV0dG9uJ10sCiAgY2xh
c3NOYW1lQmluZGluZ3M6IFsnaXNBY3RpdmUnXSwKCiAgdGFnTmFtZTogJ2J1dHRvbicsCgogIHBy
b3BhZ2F0ZUV2ZW50czogZmFsc2UsCgogIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ3R5cGUnLCAnZGlz
YWJsZWQnLCAnaHJlZicsICd0YWJpbmRleCddLAoKICAvKgogICAgQHByaXZhdGUKCiAgICBPdmVy
cmlkZXMgYFRhcmdldEFjdGlvblN1cHBvcnRgJ3MgYHRhcmdldE9iamVjdGAgY29tcHV0ZWQKICAg
IHByb3BlcnR5IHRvIHVzZSBIYW5kbGViYXJzLXNwZWNpZmljIHBhdGggcmVzb2x1dGlvbi4KCiAg
ICBAcHJvcGVydHkgdGFyZ2V0T2JqZWN0CiAgKi8KICB0YXJnZXRPYmplY3Q6IEVtYmVyLmNvbXB1
dGVkKGZ1bmN0aW9uKCkgewogICAgdmFyIHRhcmdldCA9IGdldCh0aGlzLCAndGFyZ2V0JyksCiAg
ICAgICAgcm9vdCA9IGdldCh0aGlzLCAnY29udGV4dCcpLAogICAgICAgIGRhdGEgPSBnZXQodGhp
cywgJ3RlbXBsYXRlRGF0YScpOwoKICAgIGlmICh0eXBlb2YgdGFyZ2V0ICE9PSAnc3RyaW5nJykg
eyByZXR1cm4gdGFyZ2V0OyB9CgogICAgcmV0dXJuIEVtYmVyLkhhbmRsZWJhcnMuZ2V0KHJvb3Qs
IHRhcmdldCwgeyBkYXRhOiBkYXRhIH0pOwogIH0pLnByb3BlcnR5KCd0YXJnZXQnKSwKCiAgLy8g
RGVmYXVsdHMgdG8gJ2J1dHRvbicgaWYgdGFnTmFtZSBpcyAnaW5wdXQnIG9yICdidXR0b24nCiAg
dHlwZTogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oa2V5KSB7CiAgICB2YXIgdGFnTmFtZSA9IHRo
aXMudGFnTmFtZTsKICAgIGlmICh0YWdOYW1lID09PSAnaW5wdXQnIHx8IHRhZ05hbWUgPT09ICdi
dXR0b24nKSB7IHJldHVybiAnYnV0dG9uJzsgfQogIH0pLAoKICBkaXNhYmxlZDogZmFsc2UsCgog
IC8vIEFsbG93ICdhJyB0YWdzIHRvIGFjdCBsaWtlIGJ1dHRvbnMKICBocmVmOiBFbWJlci5jb21w
dXRlZChmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnRhZ05hbWUgPT09ICdhJyA/ICcjJyA6
IG51bGw7CiAgfSksCgogIG1vdXNlRG93bjogZnVuY3Rpb24oKSB7CiAgICBpZiAoIWdldCh0aGlz
LCAnZGlzYWJsZWQnKSkgewogICAgICBzZXQodGhpcywgJ2lzQWN0aXZlJywgdHJ1ZSk7CiAgICAg
IHRoaXMuX21vdXNlRG93biA9IHRydWU7CiAgICAgIHRoaXMuX21vdXNlRW50ZXJlZCA9IHRydWU7
CiAgICB9CiAgICByZXR1cm4gZ2V0KHRoaXMsICdwcm9wYWdhdGVFdmVudHMnKTsKICB9LAoKICBt
b3VzZUxlYXZlOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9tb3VzZURvd24pIHsKICAgICAg
c2V0KHRoaXMsICdpc0FjdGl2ZScsIGZhbHNlKTsKICAgICAgdGhpcy5fbW91c2VFbnRlcmVkID0g
ZmFsc2U7CiAgICB9CiAgfSwKCiAgbW91c2VFbnRlcjogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhp
cy5fbW91c2VEb3duKSB7CiAgICAgIHNldCh0aGlzLCAnaXNBY3RpdmUnLCB0cnVlKTsKICAgICAg
dGhpcy5fbW91c2VFbnRlcmVkID0gdHJ1ZTsKICAgIH0KICB9LAoKICBtb3VzZVVwOiBmdW5jdGlv
bihldmVudCkgewogICAgaWYgKGdldCh0aGlzLCAnaXNBY3RpdmUnKSkgewogICAgICAvLyBBY3R1
YWxseSBpbnZva2UgdGhlIGJ1dHRvbidzIHRhcmdldCBhbmQgYWN0aW9uLgogICAgICAvLyBUaGlz
IG1ldGhvZCBjb21lcyBmcm9tIHRoZSBFbWJlci5UYXJnZXRBY3Rpb25TdXBwb3J0IG1peGluLgog
ICAgICB0aGlzLnRyaWdnZXJBY3Rpb24oKTsKICAgICAgc2V0KHRoaXMsICdpc0FjdGl2ZScsIGZh
bHNlKTsKICAgIH0KCiAgICB0aGlzLl9tb3VzZURvd24gPSBmYWxzZTsKICAgIHRoaXMuX21vdXNl
RW50ZXJlZCA9IGZhbHNlOwogICAgcmV0dXJuIGdldCh0aGlzLCAncHJvcGFnYXRlRXZlbnRzJyk7
CiAgfSwKCiAga2V5RG93bjogZnVuY3Rpb24oZXZlbnQpIHsKICAgIC8vIEhhbmRsZSBzcGFjZSBv
ciBlbnRlcgogICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzIHx8IGV2ZW50LmtleUNvZGUgPT09
IDMyKSB7CiAgICAgIHRoaXMubW91c2VEb3duKCk7CiAgICB9CiAgfSwKCiAga2V5VXA6IGZ1bmN0
aW9uKGV2ZW50KSB7CiAgICAvLyBIYW5kbGUgc3BhY2Ugb3IgZW50ZXIKICAgIGlmIChldmVudC5r
ZXlDb2RlID09PSAxMyB8fCBldmVudC5rZXlDb2RlID09PSAzMikgewogICAgICB0aGlzLm1vdXNl
VXAoKTsKICAgIH0KICB9LAoKICAvLyBUT0RPOiBIYW5kbGUgcHJvcGVyIHRvdWNoIGJlaGF2aW9y
LiBJbmNsdWRpbmcgc2hvdWxkIG1ha2UgaW5hY3RpdmUgd2hlbgogIC8vIGZpbmdlciBtb3ZlcyBt
b3JlIHRoYW4gMjB4IG91dHNpZGUgb2YgdGhlIGVkZ2Ugb2YgdGhlIGJ1dHRvbiAodnMgbW91c2UK
ICAvLyB3aGljaCBnb2VzIGluYWN0aXZlIGFzIHNvb24gYXMgbW91c2UgZ29lcyBvdXQgb2YgZWRn
ZXMuKQoKICB0b3VjaFN0YXJ0OiBmdW5jdGlvbih0b3VjaCkgewogICAgcmV0dXJuIHRoaXMubW91
c2VEb3duKHRvdWNoKTsKICB9LAoKICB0b3VjaEVuZDogZnVuY3Rpb24odG91Y2gpIHsKICAgIHJl
dHVybiB0aGlzLm1vdXNlVXAodG91Y2gpOwogIH0sCgogIGluaXQ6IGZ1bmN0aW9uKCkgewogICAg
RW1iZXIuZGVwcmVjYXRlKCJFbWJlci5CdXR0b24gaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSBy
ZW1vdmVkIGZyb20gZnV0dXJlIHJlbGVhc2VzLiBDb25zaWRlciB1c2luZyB0aGUgYHt7YWN0aW9u
fX1gIGhlbHBlci4iKTsKICAgIHRoaXMuX3N1cGVyKCk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5j
dGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1oYW5kbGViYXJzCiov
Cgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CgovKioKICBUaGUgaW50ZXJu
YWwgY2xhc3MgdXNlZCB0byBjcmVhdGUgdGV4dGFyZWEgZWxlbWVudCB3aGVuIHRoZSBge3t0ZXh0
YXJlYX19YAogIGhlbHBlciBpcyB1c2VkLgoKICBTZWUgW2hhbmRsZWJhcnMuaGVscGVycy50ZXh0
YXJlYV0oL2FwaS9jbGFzc2VzL0VtYmVyLkhhbmRsZWJhcnMuaGVscGVycy5odG1sI21ldGhvZF90
ZXh0YXJlYSkgIGZvciB1c2FnZSBkZXRhaWxzLgoKICAjIyBMYXlvdXQgYW5kIExheW91dE5hbWUg
cHJvcGVydGllcwoKICBCZWNhdXNlIEhUTUwgYHRleHRhcmVhYCBlbGVtZW50cyBkbyBub3QgY29u
dGFpbiBpbm5lciBIVE1MIHRoZSBgbGF5b3V0YCBhbmQKICBgbGF5b3V0TmFtZWAgcHJvcGVydGll
cyB3aWxsIG5vdCBiZSBhcHBsaWVkLiBTZWUgW0VtYmVyLlZpZXddKC9hcGkvY2xhc3Nlcy9FbWJl
ci5WaWV3Lmh0bWwpJ3MKICBsYXlvdXQgc2VjdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCiAg
QGNsYXNzIFRleHRBcmVhCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLkNvbXBv
bmVudAogIEB1c2VzIEVtYmVyLlRleHRTdXBwb3J0CiovCkVtYmVyLlRleHRBcmVhID0gRW1iZXIu
Q29tcG9uZW50LmV4dGVuZChFbWJlci5UZXh0U3VwcG9ydCwgewogIGNsYXNzTmFtZXM6IFsnZW1i
ZXItdGV4dC1hcmVhJ10sCgogIHRhZ05hbWU6ICJ0ZXh0YXJlYSIsCiAgYXR0cmlidXRlQmluZGlu
Z3M6IFsncm93cycsICdjb2xzJywgJ25hbWUnXSwKICByb3dzOiBudWxsLAogIGNvbHM6IG51bGws
CgogIF91cGRhdGVFbGVtZW50VmFsdWU6IEVtYmVyLm9ic2VydmVyKCd2YWx1ZScsIGZ1bmN0aW9u
KCkgewogICAgLy8gV2UgZG8gdGhpcyBjaGVjayBzbyBjdXJzb3IgcG9zaXRpb24gZG9lc24ndCBn
ZXQgYWZmZWN0ZWQgaW4gSUUKICAgIHZhciB2YWx1ZSA9IGdldCh0aGlzLCAndmFsdWUnKSwKICAg
ICAgICAkZWwgPSB0aGlzLiQoKTsKICAgIGlmICgkZWwgJiYgdmFsdWUgIT09ICRlbC52YWwoKSkg
ewogICAgICAkZWwudmFsKHZhbHVlKTsKICAgIH0KICB9KSwKCiAgaW5pdDogZnVuY3Rpb24oKSB7
CiAgICB0aGlzLl9zdXBlcigpOwogICAgdGhpcy5vbigiZGlkSW5zZXJ0RWxlbWVudCIsIHRoaXMs
IHRoaXMuX3VwZGF0ZUVsZW1lbnRWYWx1ZSk7CiAgfQoKfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Ci8qanNoaW50IGVxZXFlcTpmYWxzZSAqLwoKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVs
ZSBlbWJlci1oYW5kbGViYXJzCiovCgp2YXIgc2V0ID0gRW1iZXIuc2V0LAogICAgZ2V0ID0gRW1i
ZXIuZ2V0LAogICAgaW5kZXhPZiA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5pbmRleE9mLAogICAg
aW5kZXhlc09mID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLmluZGV4ZXNPZiwKICAgIGZvckVhY2gg
PSBFbWJlci5FbnVtZXJhYmxlVXRpbHMuZm9yRWFjaCwKICAgIHJlcGxhY2UgPSBFbWJlci5FbnVt
ZXJhYmxlVXRpbHMucmVwbGFjZSwKICAgIGlzQXJyYXkgPSBFbWJlci5pc0FycmF5LAogICAgcHJl
Y29tcGlsZVRlbXBsYXRlID0gRW1iZXIuSGFuZGxlYmFycy5jb21waWxlOwoKRW1iZXIuU2VsZWN0
T3B0aW9uID0gRW1iZXIuVmlldy5leHRlbmQoewogIHRhZ05hbWU6ICdvcHRpb24nLAogIGF0dHJp
YnV0ZUJpbmRpbmdzOiBbJ3ZhbHVlJywgJ3NlbGVjdGVkJ10sCgogIGRlZmF1bHRUZW1wbGF0ZTog
ZnVuY3Rpb24oY29udGV4dCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IHsgZGF0YTogb3B0aW9u
cy5kYXRhLCBoYXNoOiB7fSB9OwogICAgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLmJpbmQuY2Fs
bChjb250ZXh0LCAidmlldy5sYWJlbCIsIG9wdGlvbnMpOwogIH0sCgogIGluaXQ6IGZ1bmN0aW9u
KCkgewogICAgdGhpcy5sYWJlbFBhdGhEaWRDaGFuZ2UoKTsKICAgIHRoaXMudmFsdWVQYXRoRGlk
Q2hhbmdlKCk7CgogICAgdGhpcy5fc3VwZXIoKTsKICB9LAoKICBzZWxlY3RlZDogRW1iZXIuY29t
cHV0ZWQoZnVuY3Rpb24oKSB7CiAgICB2YXIgY29udGVudCA9IGdldCh0aGlzLCAnY29udGVudCcp
LAogICAgICAgIHNlbGVjdGlvbiA9IGdldCh0aGlzLCAncGFyZW50Vmlldy5zZWxlY3Rpb24nKTsK
ICAgIGlmIChnZXQodGhpcywgJ3BhcmVudFZpZXcubXVsdGlwbGUnKSkgewogICAgICByZXR1cm4g
c2VsZWN0aW9uICYmIGluZGV4T2Yoc2VsZWN0aW9uLCBjb250ZW50LnZhbHVlT2YoKSkgPiAtMTsK
ICAgIH0gZWxzZSB7CiAgICAgIC8vIFByaW1pdGl2ZXMgZ2V0IHBhc3NlZCB0aHJvdWdoIGJpbmRp
bmdzIGFzIG9iamVjdHMuLi4gc2luY2UKICAgICAgLy8gYG5ldyBOdW1iZXIoNCkgIT09IDRgLCB3
ZSB1c2UgYD09YCBiZWxvdwogICAgICByZXR1cm4gY29udGVudCA9PSBzZWxlY3Rpb247CiAgICB9
CiAgfSkucHJvcGVydHkoJ2NvbnRlbnQnLCAncGFyZW50Vmlldy5zZWxlY3Rpb24nKSwKCiAgbGFi
ZWxQYXRoRGlkQ2hhbmdlOiBFbWJlci5vYnNlcnZlcigncGFyZW50Vmlldy5vcHRpb25MYWJlbFBh
dGgnLCBmdW5jdGlvbigpIHsKICAgIHZhciBsYWJlbFBhdGggPSBnZXQodGhpcywgJ3BhcmVudFZp
ZXcub3B0aW9uTGFiZWxQYXRoJyk7CgogICAgaWYgKCFsYWJlbFBhdGgpIHsgcmV0dXJuOyB9Cgog
ICAgRW1iZXIuZGVmaW5lUHJvcGVydHkodGhpcywgJ2xhYmVsJywgRW1iZXIuY29tcHV0ZWQoZnVu
Y3Rpb24oKSB7CiAgICAgIHJldHVybiBnZXQodGhpcywgbGFiZWxQYXRoKTsKICAgIH0pLnByb3Bl
cnR5KGxhYmVsUGF0aCkpOwogIH0pLAoKICB2YWx1ZVBhdGhEaWRDaGFuZ2U6IEVtYmVyLm9ic2Vy
dmVyKCdwYXJlbnRWaWV3Lm9wdGlvblZhbHVlUGF0aCcsIGZ1bmN0aW9uKCkgewogICAgdmFyIHZh
bHVlUGF0aCA9IGdldCh0aGlzLCAncGFyZW50Vmlldy5vcHRpb25WYWx1ZVBhdGgnKTsKCiAgICBp
ZiAoIXZhbHVlUGF0aCkgeyByZXR1cm47IH0KCiAgICBFbWJlci5kZWZpbmVQcm9wZXJ0eSh0aGlz
LCAndmFsdWUnLCBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGdldCh0
aGlzLCB2YWx1ZVBhdGgpOwogICAgfSkucHJvcGVydHkodmFsdWVQYXRoKSk7CiAgfSkKfSk7CgpF
bWJlci5TZWxlY3RPcHRncm91cCA9IEVtYmVyLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7CiAgdGFn
TmFtZTogJ29wdGdyb3VwJywKICBhdHRyaWJ1dGVCaW5kaW5nczogWydsYWJlbCddLAoKICBzZWxl
Y3Rpb25CaW5kaW5nOiAncGFyZW50Vmlldy5zZWxlY3Rpb24nLAogIG11bHRpcGxlQmluZGluZzog
J3BhcmVudFZpZXcubXVsdGlwbGUnLAogIG9wdGlvbkxhYmVsUGF0aEJpbmRpbmc6ICdwYXJlbnRW
aWV3Lm9wdGlvbkxhYmVsUGF0aCcsCiAgb3B0aW9uVmFsdWVQYXRoQmluZGluZzogJ3BhcmVudFZp
ZXcub3B0aW9uVmFsdWVQYXRoJywKCiAgaXRlbVZpZXdDbGFzc0JpbmRpbmc6ICdwYXJlbnRWaWV3
Lm9wdGlvblZpZXcnCn0pOwoKLyoqCiAgVGhlIGBFbWJlci5TZWxlY3RgIHZpZXcgY2xhc3MgcmVu
ZGVycyBhCiAgW3NlbGVjdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vSFRNTC9F
bGVtZW50L3NlbGVjdCkgSFRNTCBlbGVtZW50LAogIGFsbG93aW5nIHRoZSB1c2VyIHRvIGNob29z
ZSBmcm9tIGEgbGlzdCBvZiBvcHRpb25zLgoKICBUaGUgdGV4dCBhbmQgYHZhbHVlYCBwcm9wZXJ0
eSBvZiBlYWNoIGA8b3B0aW9uPmAgZWxlbWVudCB3aXRoaW4gdGhlCiAgYDxzZWxlY3Q+YCBlbGVt
ZW50IGFyZSBwb3B1bGF0ZWQgZnJvbSB0aGUgb2JqZWN0cyBpbiB0aGUgYEVsZW1lbnQuU2VsZWN0
YCdzCiAgYGNvbnRlbnRgIHByb3BlcnR5LiBUaGUgdW5kZXJseWluZyBkYXRhIG9iamVjdCBvZiB0
aGUgc2VsZWN0ZWQgYDxvcHRpb24+YCBpcwogIHN0b3JlZCBpbiB0aGUgYEVsZW1lbnQuU2VsZWN0
YCdzIGB2YWx1ZWAgcHJvcGVydHkuCgogICMjIFRoZSBDb250ZW50IFByb3BlcnR5IChhcnJheSBv
ZiBzdHJpbmdzKQoKICBUaGUgc2ltcGxlc3QgdmVyc2lvbiBvZiBhbiBgRW1iZXIuU2VsZWN0YCB0
YWtlcyBhbiBhcnJheSBvZiBzdHJpbmdzIGFzIGl0cwogIGBjb250ZW50YCBwcm9wZXJ0eS4gVGhl
IHN0cmluZyB3aWxsIGJlIHVzZWQgYXMgYm90aCB0aGUgYHZhbHVlYCBwcm9wZXJ0eSBhbmQKICB0
aGUgaW5uZXIgdGV4dCBvZiBlYWNoIGA8b3B0aW9uPmAgZWxlbWVudCBpbnNpZGUgdGhlIHJlbmRl
cmVkIGA8c2VsZWN0PmAuCgogIEV4YW1wbGU6CgogIGBgYGphdmFzY3JpcHQKICBBcHAuQXBwbGlj
YXRpb25Db250cm9sbGVyID0gRW1iZXIuQ29udHJvbGxlci5leHRlbmQoewogICAgbmFtZXM6IFsi
WWVodWRhIiwgIlRvbSJdCiAgfSk7CiAgYGBgCgogIGBgYGhhbmRsZWJhcnMKICB7e3ZpZXcgRW1i
ZXIuU2VsZWN0IGNvbnRlbnQ9bmFtZXN9fQogIGBgYAoKICBXb3VsZCByZXN1bHQgaW4gdGhlIGZv
bGxvd2luZyBIVE1MOgoKICBgYGBodG1sCiAgPHNlbGVjdCBjbGFzcz0iZW1iZXItc2VsZWN0Ij4K
ICAgIDxvcHRpb24gdmFsdWU9IlllaHVkYSI+WWVodWRhPC9vcHRpb24+CiAgICA8b3B0aW9uIHZh
bHVlPSJUb20iPlRvbTwvb3B0aW9uPgogIDwvc2VsZWN0PgogIGBgYAoKICBZb3UgY2FuIGNvbnRy
b2wgd2hpY2ggYDxvcHRpb24+YCBpcyBzZWxlY3RlZCB0aHJvdWdoIHRoZSBgRW1iZXIuU2VsZWN0
YCdzCiAgYHZhbHVlYCBwcm9wZXJ0eToKCiAgYGBgamF2YXNjcmlwdAogIEFwcC5BcHBsaWNhdGlv
bkNvbnRyb2xsZXIgPSBFbWJlci5Db250cm9sbGVyLmV4dGVuZCh7CiAgICBzZWxlY3RlZE5hbWU6
ICdUb20nLAogICAgbmFtZXM6IFsiWWVodWRhIiwgIlRvbSJdCiAgfSk7CiAgYGBgCgogIGBgYGhh
bmRsZWJhcnMKICB7e3ZpZXcgRW1iZXIuU2VsZWN0CiAgICAgICAgIGNvbnRlbnQ9bmFtZXMKICAg
ICAgICAgdmFsdWU9c2VsZWN0ZWROYW1lCiAgfX0KICBgYGAKCiAgV291bGQgcmVzdWx0IGluIHRo
ZSBmb2xsb3dpbmcgSFRNTCB3aXRoIHRoZSBgPG9wdGlvbj5gIGZvciAnVG9tJyBzZWxlY3RlZDoK
CiAgYGBgaHRtbAogIDxzZWxlY3QgY2xhc3M9ImVtYmVyLXNlbGVjdCI+CiAgICA8b3B0aW9uIHZh
bHVlPSJZZWh1ZGEiPlllaHVkYTwvb3B0aW9uPgogICAgPG9wdGlvbiB2YWx1ZT0iVG9tIiBzZWxl
Y3RlZD0ic2VsZWN0ZWQiPlRvbTwvb3B0aW9uPgogIDwvc2VsZWN0PgogIGBgYAoKICBBIHVzZXIg
aW50ZXJhY3Rpbmcgd2l0aCB0aGUgcmVuZGVyZWQgYDxzZWxlY3Q+YCB0byBjaG9vc2UgIlllaHVk
YSIgd291bGQKICB1cGRhdGUgdGhlIHZhbHVlIG9mIGBzZWxlY3RlZE5hbWVgIHRvICJZZWh1ZGEi
LgoKICAjIyBUaGUgQ29udGVudCBQcm9wZXJ0eSAoYXJyYXkgb2YgT2JqZWN0cykKCiAgQW4gYEVt
YmVyLlNlbGVjdGAgY2FuIGFsc28gdGFrZSBhbiBhcnJheSBvZiBKYXZhU2NyaXB0IG9yIEVtYmVy
IG9iamVjdHMgYXMKICBpdHMgYGNvbnRlbnRgIHByb3BlcnR5LgoKICBXaGVuIHVzaW5nIG9iamVj
dHMgeW91IG5lZWQgdG8gdGVsbCB0aGUgYEVtYmVyLlNlbGVjdGAgd2hpY2ggcHJvcGVydHkgc2hv
dWxkCiAgYmUgYWNjZXNzZWQgb24gZWFjaCBvYmplY3QgdG8gc3VwcGx5IHRoZSBgdmFsdWVgIGF0
dHJpYnV0ZSBvZiB0aGUgYDxvcHRpb24+YAogIGFuZCB3aGljaCBwcm9wZXJ0eSBzaG91bGQgYmUg
dXNlZCB0byBzdXBwbHkgdGhlIGVsZW1lbnQgdGV4dC4KCiAgVGhlIGBvcHRpb25WYWx1ZVBhdGhg
IG9wdGlvbiBpcyB1c2VkIHRvIHNwZWNpZnkgdGhlIHBhdGggb24gZWFjaCBvYmplY3QgdG8KICB0
aGUgZGVzaXJlZCBwcm9wZXJ0eSBmb3IgdGhlIGB2YWx1ZWAgYXR0cmlidXRlLiBUaGUgYG9wdGlv
bkxhYmVsUGF0aGAKICBzcGVjaWZpZXMgdGhlIHBhdGggb24gZWFjaCBvYmplY3QgdG8gdGhlIGRl
c2lyZWQgcHJvcGVydHkgZm9yIHRoZQogIGVsZW1lbnQncyB0ZXh0LiBCb3RoIHBhdGhzIG11c3Qg
cmVmZXJlbmNlIGVhY2ggb2JqZWN0IGl0c2VsZiBhcyBgY29udGVudGA6CgogIGBgYGphdmFzY3Jp
cHQKICBBcHAuQXBwbGljYXRpb25Db250cm9sbGVyID0gRW1iZXIuQ29udHJvbGxlci5leHRlbmQo
ewogICAgcHJvZ3JhbW1lcnM6IFsKICAgICAge2ZpcnN0TmFtZTogIlllaHVkYSIsIGlkOiAxfSwK
ICAgICAge2ZpcnN0TmFtZTogIlRvbSIsICAgIGlkOiAyfQogICAgXQogIH0pOwogIGBgYAoKICBg
YGBoYW5kbGViYXJzCiAge3t2aWV3IEVtYmVyLlNlbGVjdAogICAgICAgICBjb250ZW50PXByb2dy
YW1tZXJzCiAgICAgICAgIG9wdGlvblZhbHVlUGF0aD0iY29udGVudC5pZCIKICAgICAgICAgb3B0
aW9uTGFiZWxQYXRoPSJjb250ZW50LmZpcnN0TmFtZSJ9fQogIGBgYAoKICBXb3VsZCByZXN1bHQg
aW4gdGhlIGZvbGxvd2luZyBIVE1MOgoKICBgYGBodG1sCiAgPHNlbGVjdCBjbGFzcz0iZW1iZXIt
c2VsZWN0Ij4KICAgIDxvcHRpb24gdmFsdWU9IjEiPlllaHVkYTwvb3B0aW9uPgogICAgPG9wdGlv
biB2YWx1ZT0iMiI+VG9tPC9vcHRpb24+CiAgPC9zZWxlY3Q+CiAgYGBgCgogIFRoZSBgdmFsdWVg
IGF0dHJpYnV0ZSBvZiB0aGUgc2VsZWN0ZWQgYDxvcHRpb24+YCB3aXRoaW4gYW4gYEVtYmVyLlNl
bGVjdGAKICBjYW4gYmUgYm91bmQgdG8gYSBwcm9wZXJ0eSBvbiBhbm90aGVyIG9iamVjdDoKCiAg
YGBgamF2YXNjcmlwdAogIEFwcC5BcHBsaWNhdGlvbkNvbnRyb2xsZXIgPSBFbWJlci5Db250cm9s
bGVyLmV4dGVuZCh7CiAgICBwcm9ncmFtbWVyczogWwogICAgICB7Zmlyc3ROYW1lOiAiWWVodWRh
IiwgaWQ6IDF9LAogICAgICB7Zmlyc3ROYW1lOiAiVG9tIiwgICAgaWQ6IDJ9CiAgICBdLAogICAg
Y3VycmVudFByb2dyYW1tZXI6IHsKICAgICAgaWQ6IDIKICAgIH0KICB9KTsKICBgYGAKCiAgYGBg
aGFuZGxlYmFycwogIHt7dmlldyBFbWJlci5TZWxlY3QKICAgICAgICAgY29udGVudD1wcm9ncmFt
bWVycwogICAgICAgICBvcHRpb25WYWx1ZVBhdGg9ImNvbnRlbnQuaWQiCiAgICAgICAgIG9wdGlv
bkxhYmVsUGF0aD0iY29udGVudC5maXJzdE5hbWUiCiAgICAgICAgIHZhbHVlPWN1cnJlbnRQcm9n
cmFtbWVyLmlkfX0KICBgYGAKCiAgV291bGQgcmVzdWx0IGluIHRoZSBmb2xsb3dpbmcgSFRNTCB3
aXRoIGEgc2VsZWN0ZWQgb3B0aW9uOgoKICBgYGBodG1sCiAgPHNlbGVjdCBjbGFzcz0iZW1iZXIt
c2VsZWN0Ij4KICAgIDxvcHRpb24gdmFsdWU9IjEiPlllaHVkYTwvb3B0aW9uPgogICAgPG9wdGlv
biB2YWx1ZT0iMiIgc2VsZWN0ZWQ9InNlbGVjdGVkIj5Ub208L29wdGlvbj4KICA8L3NlbGVjdD4K
ICBgYGAKCiAgSW50ZXJhY3Rpbmcgd2l0aCB0aGUgcmVuZGVyZWQgZWxlbWVudCBieSBzZWxlY3Rp
bmcgdGhlIGZpcnN0IG9wdGlvbgogICgnWWVodWRhJykgd2lsbCB1cGRhdGUgdGhlIGBpZGAgb2Yg
YGN1cnJlbnRQcm9ncmFtbWVyYAogIHRvIG1hdGNoIHRoZSBgdmFsdWVgIHByb3BlcnR5IG9mIHRo
ZSBuZXdseSBzZWxlY3RlZCBgPG9wdGlvbj5gLgoKICBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIGNv
bnRyb2wgc2VsZWN0aW9uIHRocm91Z2ggdGhlIHVuZGVybHlpbmcgb2JqZWN0cwogIHVzZWQgdG8g
cmVuZGVyIGVhY2ggb2JqZWN0IGJ5IGJpbmRpbmcgdGhlIGBzZWxlY3Rpb25gIG9wdGlvbi4gV2hl
biB0aGUgc2VsZWN0ZWQKICBgPG9wdGlvbj5gIGlzIGNoYW5nZWQsIHRoZSBwcm9wZXJ0eSBwYXRo
IHByb3ZpZGVkIHRvIGBzZWxlY3Rpb25gCiAgd2lsbCBiZSB1cGRhdGVkIHRvIG1hdGNoIHRoZSBj
b250ZW50IG9iamVjdCBvZiB0aGUgcmVuZGVyZWQgYDxvcHRpb24+YAogIGVsZW1lbnQ6CgogIGBg
YGphdmFzY3JpcHQKICBBcHAuQXBwbGljYXRpb25Db250cm9sbGVyID0gRW1iZXIuQ29udHJvbGxl
ci5leHRlbmQoewogICAgc2VsZWN0ZWRQZXJzb246IG51bGwsCiAgICBwcm9ncmFtbWVyczogWwog
ICAgICB7Zmlyc3ROYW1lOiAiWWVodWRhIiwgaWQ6IDF9LAogICAgICB7Zmlyc3ROYW1lOiAiVG9t
IiwgICAgaWQ6IDJ9CiAgICBdCiAgfSk7CiAgYGBgCgogIGBgYGhhbmRsZWJhcnMKICB7e3ZpZXcg
RW1iZXIuU2VsZWN0CiAgICAgICAgIGNvbnRlbnQ9cHJvZ3JhbW1lcnMKICAgICAgICAgb3B0aW9u
VmFsdWVQYXRoPSJjb250ZW50LmlkIgogICAgICAgICBvcHRpb25MYWJlbFBhdGg9ImNvbnRlbnQu
Zmlyc3ROYW1lIgogICAgICAgICBzZWxlY3Rpb249c2VsZWN0ZWRQZXJzb259fQogIGBgYAoKICBX
b3VsZCByZXN1bHQgaW4gdGhlIGZvbGxvd2luZyBIVE1MIHdpdGggYSBzZWxlY3RlZCBvcHRpb246
CgogIGBgYGh0bWwKICA8c2VsZWN0IGNsYXNzPSJlbWJlci1zZWxlY3QiPgogICAgPG9wdGlvbiB2
YWx1ZT0iMSI+WWVodWRhPC9vcHRpb24+CiAgICA8b3B0aW9uIHZhbHVlPSIyIiBzZWxlY3RlZD0i
c2VsZWN0ZWQiPlRvbTwvb3B0aW9uPgogIDwvc2VsZWN0PgogIGBgYAoKICBJbnRlcmFjdGluZyB3
aXRoIHRoZSByZW5kZXJlZCBlbGVtZW50IGJ5IHNlbGVjdGluZyB0aGUgZmlyc3Qgb3B0aW9uCiAg
KCdZZWh1ZGEnKSB3aWxsIHVwZGF0ZSB0aGUgYHNlbGVjdGVkUGVyc29uYCB0byBtYXRjaCB0aGUg
b2JqZWN0IG9mCiAgdGhlIG5ld2x5IHNlbGVjdGVkIGA8b3B0aW9uPmAuIEluIHRoaXMgY2FzZSBp
dCBpcyB0aGUgZmlyc3Qgb2JqZWN0CiAgaW4gdGhlIGBwcm9ncmFtbWVyc2AKCiAgIyMgU3VwcGx5
aW5nIGEgUHJvbXB0CgogIEEgYG51bGxgIHZhbHVlIGZvciB0aGUgYEVtYmVyLlNlbGVjdGAncyBg
dmFsdWVgIG9yIGBzZWxlY3Rpb25gIHByb3BlcnR5CiAgcmVzdWx0cyBpbiB0aGVyZSBiZWluZyBu
byBgPG9wdGlvbj5gIHdpdGggYSBgc2VsZWN0ZWRgIGF0dHJpYnV0ZToKCiAgYGBgamF2YXNjcmlw
dAogIEFwcC5BcHBsaWNhdGlvbkNvbnRyb2xsZXIgPSBFbWJlci5Db250cm9sbGVyLmV4dGVuZCh7
CiAgICBzZWxlY3RlZFByb2dyYW1tZXI6IG51bGwsCiAgICBwcm9ncmFtbWVyczogWwogICAgICAi
WWVodWRhIiwKICAgICAgIlRvbSIKICAgIF0KICB9KTsKICBgYGAKCiAgYGBgIGhhbmRsZWJhcnMK
ICB7e3ZpZXcgRW1iZXIuU2VsZWN0CiAgICAgICAgIGNvbnRlbnQ9cHJvZ3JhbW1lcnMKICAgICAg
ICAgdmFsdWU9c2VsZWN0ZWRQcm9ncmFtbWVyCiAgfX0KICBgYGAKCiAgV291bGQgcmVzdWx0IGlu
IHRoZSBmb2xsb3dpbmcgSFRNTDoKCiAgYGBgaHRtbAogIDxzZWxlY3QgY2xhc3M9ImVtYmVyLXNl
bGVjdCI+CiAgICA8b3B0aW9uIHZhbHVlPSJZZWh1ZGEiPlllaHVkYTwvb3B0aW9uPgogICAgPG9w
dGlvbiB2YWx1ZT0iVG9tIj5Ub208L29wdGlvbj4KICA8L3NlbGVjdD4KICBgYGAKCiAgQWx0aG91
Z2ggYHNlbGVjdGVkUHJvZ3JhbW1lcmAgaXMgYG51bGxgIGFuZCBubyBgPG9wdGlvbj5gCiAgaGFz
IGEgYHNlbGVjdGVkYCBhdHRyaWJ1dGUgdGhlIHJlbmRlcmVkIEhUTUwgd2lsbCBkaXNwbGF5IHRo
ZQogIGZpcnN0IGl0ZW0gYXMgdGhvdWdoIGl0IHdlcmUgc2VsZWN0ZWQuIFlvdSBjYW4gc3VwcGx5
IGEgc3RyaW5nCiAgdmFsdWUgZm9yIHRoZSBgRW1iZXIuU2VsZWN0YCB0byBkaXNwbGF5IHdoZW4g
dGhlcmUgaXMgbm8gc2VsZWN0aW9uCiAgd2l0aCB0aGUgYHByb21wdGAgb3B0aW9uOgoKICBgYGBq
YXZhc2NyaXB0CiAgQXBwLkFwcGxpY2F0aW9uQ29udHJvbGxlciA9IEVtYmVyLkNvbnRyb2xsZXIu
ZXh0ZW5kKHsKICAgIHNlbGVjdGVkUHJvZ3JhbW1lcjogbnVsbCwKICAgIHByb2dyYW1tZXJzOiBb
CiAgICAgICJZZWh1ZGEiLAogICAgICAiVG9tIgogICAgXQogIH0pOwogIGBgYAoKICBgYGBoYW5k
bGViYXJzCiAge3t2aWV3IEVtYmVyLlNlbGVjdAogICAgICAgICBjb250ZW50PXByb2dyYW1tZXJz
CiAgICAgICAgIHZhbHVlPXNlbGVjdGVkUHJvZ3JhbW1lcgogICAgICAgICBwcm9tcHQ9IlBsZWFz
ZSBzZWxlY3QgYSBuYW1lIgogIH19CiAgYGBgCgogIFdvdWxkIHJlc3VsdCBpbiB0aGUgZm9sbG93
aW5nIEhUTUw6CgogIGBgYGh0bWwKICA8c2VsZWN0IGNsYXNzPSJlbWJlci1zZWxlY3QiPgogICAg
PG9wdGlvbj5QbGVhc2Ugc2VsZWN0IGEgbmFtZTwvb3B0aW9uPgogICAgPG9wdGlvbiB2YWx1ZT0i
WWVodWRhIj5ZZWh1ZGE8L29wdGlvbj4KICAgIDxvcHRpb24gdmFsdWU9IlRvbSI+VG9tPC9vcHRp
b24+CiAgPC9zZWxlY3Q+CiAgYGBgCgogIEBjbGFzcyBTZWxlY3QKICBAbmFtZXNwYWNlIEVtYmVy
CiAgQGV4dGVuZHMgRW1iZXIuVmlldwoqLwpFbWJlci5TZWxlY3QgPSBFbWJlci5WaWV3LmV4dGVu
ZCh7CiAgdGFnTmFtZTogJ3NlbGVjdCcsCiAgY2xhc3NOYW1lczogWydlbWJlci1zZWxlY3QnXSwK
ICBkZWZhdWx0VGVtcGxhdGU6IEVtYmVyLkhhbmRsZWJhcnMudGVtcGxhdGUoZnVuY3Rpb24gYW5v
bnltb3VzKEhhbmRsZWJhcnMsZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkgewp0aGlzLmNv
bXBpbGVySW5mbyA9IFs0LCc+PSAxLjAuMCddOwpoZWxwZXJzID0gdGhpcy5tZXJnZShoZWxwZXJz
LCBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnMpOyBkYXRhID0gZGF0YSB8fCB7fTsKICB2YXIgYnVm
ZmVyID0gJycsIHN0YWNrMSwgaGFzaFR5cGVzLCBoYXNoQ29udGV4dHMsIGVzY2FwZUV4cHJlc3Np
b249dGhpcy5lc2NhcGVFeHByZXNzaW9uLCBzZWxmPXRoaXM7CgpmdW5jdGlvbiBwcm9ncmFtMShk
ZXB0aDAsZGF0YSkgewogIAogIHZhciBidWZmZXIgPSAnJywgc3RhY2sxLCBoYXNoVHlwZXMsIGhh
c2hDb250ZXh0czsKICBkYXRhLmJ1ZmZlci5wdXNoKCI8b3B0aW9uIHZhbHVlPVwiXCI+Iik7CiAg
aGFzaFR5cGVzID0ge307CiAgaGFzaENvbnRleHRzID0ge307CiAgc3RhY2sxID0gaGVscGVycy5f
dHJpYWdlTXVzdGFjaGUuY2FsbChkZXB0aDAsICJ2aWV3LnByb21wdCIsIHtoYXNoOnt9LGNvbnRl
eHRzOltkZXB0aDBdLHR5cGVzOlsiSUQiXSxoYXNoQ29udGV4dHM6aGFzaENvbnRleHRzLGhhc2hU
eXBlczpoYXNoVHlwZXMsZGF0YTpkYXRhfSk7CiAgaWYoc3RhY2sxIHx8IHN0YWNrMSA9PT0gMCkg
eyBkYXRhLmJ1ZmZlci5wdXNoKHN0YWNrMSk7IH0KICBkYXRhLmJ1ZmZlci5wdXNoKCI8L29wdGlv
bj4iKTsKICByZXR1cm4gYnVmZmVyOwogIH0KCmZ1bmN0aW9uIHByb2dyYW0zKGRlcHRoMCxkYXRh
KSB7CiAgCiAgdmFyIHN0YWNrMSwgaGFzaFR5cGVzLCBoYXNoQ29udGV4dHM7CiAgaGFzaFR5cGVz
ID0ge307CiAgaGFzaENvbnRleHRzID0ge307CiAgc3RhY2sxID0gaGVscGVycy5lYWNoLmNhbGwo
ZGVwdGgwLCAidmlldy5ncm91cGVkQ29udGVudCIsIHtoYXNoOnt9LGludmVyc2U6c2VsZi5ub29w
LGZuOnNlbGYucHJvZ3JhbSg0LCBwcm9ncmFtNCwgZGF0YSksY29udGV4dHM6W2RlcHRoMF0sdHlw
ZXM6WyJJRCJdLGhhc2hDb250ZXh0czpoYXNoQ29udGV4dHMsaGFzaFR5cGVzOmhhc2hUeXBlcyxk
YXRhOmRhdGF9KTsKICBpZihzdGFjazEgfHwgc3RhY2sxID09PSAwKSB7IGRhdGEuYnVmZmVyLnB1
c2goc3RhY2sxKTsgfQogIGVsc2UgeyBkYXRhLmJ1ZmZlci5wdXNoKCcnKTsgfQogIH0KZnVuY3Rp
b24gcHJvZ3JhbTQoZGVwdGgwLGRhdGEpIHsKICAKICB2YXIgaGFzaENvbnRleHRzLCBoYXNoVHlw
ZXM7CiAgaGFzaENvbnRleHRzID0geydjb250ZW50JzogZGVwdGgwLCdsYWJlbCc6IGRlcHRoMH07
CiAgaGFzaFR5cGVzID0geydjb250ZW50JzogIklEIiwnbGFiZWwnOiAiSUQifTsKICBkYXRhLmJ1
ZmZlci5wdXNoKGVzY2FwZUV4cHJlc3Npb24oaGVscGVycy52aWV3LmNhbGwoZGVwdGgwLCAidmll
dy5ncm91cFZpZXciLCB7aGFzaDp7CiAgICAnY29udGVudCc6ICgiY29udGVudCIpLAogICAgJ2xh
YmVsJzogKCJsYWJlbCIpCiAgfSxjb250ZXh0czpbZGVwdGgwXSx0eXBlczpbIklEIl0saGFzaENv
bnRleHRzOmhhc2hDb250ZXh0cyxoYXNoVHlwZXM6aGFzaFR5cGVzLGRhdGE6ZGF0YX0pKSk7CiAg
fQoKZnVuY3Rpb24gcHJvZ3JhbTYoZGVwdGgwLGRhdGEpIHsKICAKICB2YXIgc3RhY2sxLCBoYXNo
VHlwZXMsIGhhc2hDb250ZXh0czsKICBoYXNoVHlwZXMgPSB7fTsKICBoYXNoQ29udGV4dHMgPSB7
fTsKICBzdGFjazEgPSBoZWxwZXJzLmVhY2guY2FsbChkZXB0aDAsICJ2aWV3LmNvbnRlbnQiLCB7
aGFzaDp7fSxpbnZlcnNlOnNlbGYubm9vcCxmbjpzZWxmLnByb2dyYW0oNywgcHJvZ3JhbTcsIGRh
dGEpLGNvbnRleHRzOltkZXB0aDBdLHR5cGVzOlsiSUQiXSxoYXNoQ29udGV4dHM6aGFzaENvbnRl
eHRzLGhhc2hUeXBlczpoYXNoVHlwZXMsZGF0YTpkYXRhfSk7CiAgaWYoc3RhY2sxIHx8IHN0YWNr
MSA9PT0gMCkgeyBkYXRhLmJ1ZmZlci5wdXNoKHN0YWNrMSk7IH0KICBlbHNlIHsgZGF0YS5idWZm
ZXIucHVzaCgnJyk7IH0KICB9CmZ1bmN0aW9uIHByb2dyYW03KGRlcHRoMCxkYXRhKSB7CiAgCiAg
dmFyIGhhc2hDb250ZXh0cywgaGFzaFR5cGVzOwogIGhhc2hDb250ZXh0cyA9IHsnY29udGVudCc6
IGRlcHRoMH07CiAgaGFzaFR5cGVzID0geydjb250ZW50JzogIklEIn07CiAgZGF0YS5idWZmZXIu
cHVzaChlc2NhcGVFeHByZXNzaW9uKGhlbHBlcnMudmlldy5jYWxsKGRlcHRoMCwgInZpZXcub3B0
aW9uVmlldyIsIHtoYXNoOnsKICAgICdjb250ZW50JzogKCIiKQogIH0sY29udGV4dHM6W2RlcHRo
MF0sdHlwZXM6WyJJRCJdLGhhc2hDb250ZXh0czpoYXNoQ29udGV4dHMsaGFzaFR5cGVzOmhhc2hU
eXBlcyxkYXRhOmRhdGF9KSkpOwogIH0KCiAgaGFzaFR5cGVzID0ge307CiAgaGFzaENvbnRleHRz
ID0ge307CiAgc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwgInZpZXcucHJvbXB0
Iiwge2hhc2g6e30saW52ZXJzZTpzZWxmLm5vb3AsZm46c2VsZi5wcm9ncmFtKDEsIHByb2dyYW0x
LCBkYXRhKSxjb250ZXh0czpbZGVwdGgwXSx0eXBlczpbIklEIl0saGFzaENvbnRleHRzOmhhc2hD
b250ZXh0cyxoYXNoVHlwZXM6aGFzaFR5cGVzLGRhdGE6ZGF0YX0pOwogIGlmKHN0YWNrMSB8fCBz
dGFjazEgPT09IDApIHsgZGF0YS5idWZmZXIucHVzaChzdGFjazEpOyB9CiAgaGFzaFR5cGVzID0g
e307CiAgaGFzaENvbnRleHRzID0ge307CiAgc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRl
cHRoMCwgInZpZXcub3B0aW9uR3JvdXBQYXRoIiwge2hhc2g6e30saW52ZXJzZTpzZWxmLnByb2dy
YW0oNiwgcHJvZ3JhbTYsIGRhdGEpLGZuOnNlbGYucHJvZ3JhbSgzLCBwcm9ncmFtMywgZGF0YSks
Y29udGV4dHM6W2RlcHRoMF0sdHlwZXM6WyJJRCJdLGhhc2hDb250ZXh0czpoYXNoQ29udGV4dHMs
aGFzaFR5cGVzOmhhc2hUeXBlcyxkYXRhOmRhdGF9KTsKICBpZihzdGFjazEgfHwgc3RhY2sxID09
PSAwKSB7IGRhdGEuYnVmZmVyLnB1c2goc3RhY2sxKTsgfQogIHJldHVybiBidWZmZXI7CiAgCn0p
LAogIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ211bHRpcGxlJywgJ2Rpc2FibGVkJywgJ3RhYmluZGV4
JywgJ25hbWUnXSwKCiAgLyoqCiAgICBUaGUgYG11bHRpcGxlYCBhdHRyaWJ1dGUgb2YgdGhlIHNl
bGVjdCBlbGVtZW50LiBJbmRpY2F0ZXMgd2hldGhlciBtdWx0aXBsZQogICAgb3B0aW9ucyBjYW4g
YmUgc2VsZWN0ZWQuCgogICAgQHByb3BlcnR5IG11bHRpcGxlCiAgICBAdHlwZSBCb29sZWFuCiAg
ICBAZGVmYXVsdCBmYWxzZQogICovCiAgbXVsdGlwbGU6IGZhbHNlLAoKICAvKioKICAgIFRoZSBg
ZGlzYWJsZWRgIGF0dHJpYnV0ZSBvZiB0aGUgc2VsZWN0IGVsZW1lbnQuIEluZGljYXRlcyB3aGV0
aGVyCiAgICB0aGUgZWxlbWVudCBpcyBkaXNhYmxlZCBmcm9tIGludGVyYWN0aW9ucy4KCiAgICBA
cHJvcGVydHkgZGlzYWJsZWQKICAgIEB0eXBlIEJvb2xlYW4KICAgIEBkZWZhdWx0IGZhbHNlCiAg
Ki8KICBkaXNhYmxlZDogZmFsc2UsCgogIC8qKgogICAgVGhlIGxpc3Qgb2Ygb3B0aW9ucy4KCiAg
ICBJZiBgb3B0aW9uTGFiZWxQYXRoYCBhbmQgYG9wdGlvblZhbHVlUGF0aGAgYXJlIG5vdCBvdmVy
cmlkZGVuLCB0aGlzIHNob3VsZAogICAgYmUgYSBsaXN0IG9mIHN0cmluZ3MsIHdoaWNoIHdpbGwg
c2VydmUgc2ltdWx0YW5lb3VzbHkgYXMgbGFiZWxzIGFuZCB2YWx1ZXMuCgogICAgT3RoZXJ3aXNl
LCB0aGlzIHNob3VsZCBiZSBhIGxpc3Qgb2Ygb2JqZWN0cy4gRm9yIGluc3RhbmNlOgoKICAgIGBg
YGphdmFzY3JpcHQKICAgIEVtYmVyLlNlbGVjdC5jcmVhdGUoewogICAgICBjb250ZW50OiBFbWJl
ci5BKFsKICAgICAgICAgIHsgaWQ6IDEsIGZpcnN0TmFtZTogJ1llaHVkYScgfSwKICAgICAgICAg
IHsgaWQ6IDIsIGZpcnN0TmFtZTogJ1RvbScgfQogICAgICAgIF0pLAogICAgICBvcHRpb25MYWJl
bFBhdGg6ICdjb250ZW50LmZpcnN0TmFtZScsCiAgICAgIG9wdGlvblZhbHVlUGF0aDogJ2NvbnRl
bnQuaWQnCiAgICB9KTsKICAgIGBgYAoKICAgIEBwcm9wZXJ0eSBjb250ZW50CiAgICBAdHlwZSBB
cnJheQogICAgQGRlZmF1bHQgbnVsbAogICovCiAgY29udGVudDogbnVsbCwKCiAgLyoqCiAgICBX
aGVuIGBtdWx0aXBsZWAgaXMgYGZhbHNlYCwgdGhlIGVsZW1lbnQgb2YgYGNvbnRlbnRgIHRoYXQg
aXMgY3VycmVudGx5CiAgICBzZWxlY3RlZCwgaWYgYW55LgoKICAgIFdoZW4gYG11bHRpcGxlYCBp
cyBgdHJ1ZWAsIGFuIGFycmF5IG9mIHN1Y2ggZWxlbWVudHMuCgogICAgQHByb3BlcnR5IHNlbGVj
dGlvbgogICAgQHR5cGUgT2JqZWN0IG9yIEFycmF5CiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBz
ZWxlY3Rpb246IG51bGwsCgogIC8qKgogICAgSW4gc2luZ2xlIHNlbGVjdGlvbiBtb2RlICh3aGVu
IGBtdWx0aXBsZWAgaXMgYGZhbHNlYCksIHZhbHVlIGNhbiBiZSB1c2VkIHRvCiAgICBnZXQgdGhl
IGN1cnJlbnQgc2VsZWN0aW9uJ3MgdmFsdWUgb3Igc2V0IHRoZSBzZWxlY3Rpb24gYnkgaXQncyB2
YWx1ZS4KCiAgICBJdCBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBpbiBtdWx0aXBsZSBzZWxl
Y3Rpb24gbW9kZS4KCiAgICBAcHJvcGVydHkgdmFsdWUKICAgIEB0eXBlIFN0cmluZwogICAgQGRl
ZmF1bHQgbnVsbAogICovCiAgdmFsdWU6IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uKGtleSwgdmFs
dWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7IHJldHVybiB2YWx1ZTsgfQog
ICAgdmFyIHZhbHVlUGF0aCA9IGdldCh0aGlzLCAnb3B0aW9uVmFsdWVQYXRoJykucmVwbGFjZSgv
XmNvbnRlbnRcLj8vLCAnJyk7CiAgICByZXR1cm4gdmFsdWVQYXRoID8gZ2V0KHRoaXMsICdzZWxl
Y3Rpb24uJyArIHZhbHVlUGF0aCkgOiBnZXQodGhpcywgJ3NlbGVjdGlvbicpOwogIH0pLnByb3Bl
cnR5KCdzZWxlY3Rpb24nKSwKCiAgLyoqCiAgICBJZiBnaXZlbiwgYSB0b3AtbW9zdCBkdW1teSBv
cHRpb24gd2lsbCBiZSByZW5kZXJlZCB0byBzZXJ2ZSBhcyBhIHVzZXIKICAgIHByb21wdC4KCiAg
ICBAcHJvcGVydHkgcHJvbXB0CiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0IG51bGwKICAq
LwogIHByb21wdDogbnVsbCwKCiAgLyoqCiAgICBUaGUgcGF0aCBvZiB0aGUgb3B0aW9uIGxhYmVs
cy4gU2VlIFtjb250ZW50XSgvYXBpL2NsYXNzZXMvRW1iZXIuU2VsZWN0Lmh0bWwjcHJvcGVydHlf
Y29udGVudCkuCgogICAgQHByb3BlcnR5IG9wdGlvbkxhYmVsUGF0aAogICAgQHR5cGUgU3RyaW5n
CiAgICBAZGVmYXVsdCAnY29udGVudCcKICAqLwogIG9wdGlvbkxhYmVsUGF0aDogJ2NvbnRlbnQn
LAoKICAvKioKICAgIFRoZSBwYXRoIG9mIHRoZSBvcHRpb24gdmFsdWVzLiBTZWUgW2NvbnRlbnRd
KC9hcGkvY2xhc3Nlcy9FbWJlci5TZWxlY3QuaHRtbCNwcm9wZXJ0eV9jb250ZW50KS4KCiAgICBA
cHJvcGVydHkgb3B0aW9uVmFsdWVQYXRoCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0ICdj
b250ZW50JwogICovCiAgb3B0aW9uVmFsdWVQYXRoOiAnY29udGVudCcsCgogIC8qKgogICAgVGhl
IHBhdGggb2YgdGhlIG9wdGlvbiBncm91cC4KICAgIFdoZW4gdGhpcyBwcm9wZXJ0eSBpcyB1c2Vk
LCBgY29udGVudGAgc2hvdWxkIGJlIHNvcnRlZCBieSBgb3B0aW9uR3JvdXBQYXRoYC4KCiAgICBA
cHJvcGVydHkgb3B0aW9uR3JvdXBQYXRoCiAgICBAdHlwZSBTdHJpbmcKICAgIEBkZWZhdWx0IG51
bGwKICAqLwogIG9wdGlvbkdyb3VwUGF0aDogbnVsbCwKCiAgLyoqCiAgICBUaGUgdmlldyBjbGFz
cyBmb3Igb3B0Z3JvdXAuCgogICAgQHByb3BlcnR5IGdyb3VwVmlldwogICAgQHR5cGUgRW1iZXIu
VmlldwogICAgQGRlZmF1bHQgRW1iZXIuU2VsZWN0T3B0Z3JvdXAKICAqLwogIGdyb3VwVmlldzog
RW1iZXIuU2VsZWN0T3B0Z3JvdXAsCgogIGdyb3VwZWRDb250ZW50OiBFbWJlci5jb21wdXRlZChm
dW5jdGlvbigpIHsKICAgIHZhciBncm91cFBhdGggPSBnZXQodGhpcywgJ29wdGlvbkdyb3VwUGF0
aCcpOwogICAgdmFyIGdyb3VwZWRDb250ZW50ID0gRW1iZXIuQSgpOwogICAgdmFyIGNvbnRlbnQg
PSBnZXQodGhpcywgJ2NvbnRlbnQnKSB8fCBbXTsKCiAgICBmb3JFYWNoKGNvbnRlbnQsIGZ1bmN0
aW9uKGl0ZW0pIHsKICAgICAgdmFyIGxhYmVsID0gZ2V0KGl0ZW0sIGdyb3VwUGF0aCk7CgogICAg
ICBpZiAoZ2V0KGdyb3VwZWRDb250ZW50LCAnbGFzdE9iamVjdC5sYWJlbCcpICE9PSBsYWJlbCkg
ewogICAgICAgIGdyb3VwZWRDb250ZW50LnB1c2hPYmplY3QoewogICAgICAgICAgbGFiZWw6IGxh
YmVsLAogICAgICAgICAgY29udGVudDogRW1iZXIuQSgpCiAgICAgICAgfSk7CiAgICAgIH0KCiAg
ICAgIGdldChncm91cGVkQ29udGVudCwgJ2xhc3RPYmplY3QuY29udGVudCcpLnB1c2goaXRlbSk7
CiAgICB9KTsKCiAgICByZXR1cm4gZ3JvdXBlZENvbnRlbnQ7CiAgfSkucHJvcGVydHkoJ29wdGlv
bkdyb3VwUGF0aCcsICdjb250ZW50LkBlYWNoJyksCgogIC8qKgogICAgVGhlIHZpZXcgY2xhc3Mg
Zm9yIG9wdGlvbi4KCiAgICBAcHJvcGVydHkgb3B0aW9uVmlldwogICAgQHR5cGUgRW1iZXIuVmll
dwogICAgQGRlZmF1bHQgRW1iZXIuU2VsZWN0T3B0aW9uCiAgKi8KICBvcHRpb25WaWV3OiBFbWJl
ci5TZWxlY3RPcHRpb24sCgogIF9jaGFuZ2U6IGZ1bmN0aW9uKCkgewogICAgaWYgKGdldCh0aGlz
LCAnbXVsdGlwbGUnKSkgewogICAgICB0aGlzLl9jaGFuZ2VNdWx0aXBsZSgpOwogICAgfSBlbHNl
IHsKICAgICAgdGhpcy5fY2hhbmdlU2luZ2xlKCk7CiAgICB9CiAgfSwKCiAgc2VsZWN0aW9uRGlk
Q2hhbmdlOiBFbWJlci5vYnNlcnZlcignc2VsZWN0aW9uLkBlYWNoJywgZnVuY3Rpb24oKSB7CiAg
ICB2YXIgc2VsZWN0aW9uID0gZ2V0KHRoaXMsICdzZWxlY3Rpb24nKTsKICAgIGlmIChnZXQodGhp
cywgJ211bHRpcGxlJykpIHsKICAgICAgaWYgKCFpc0FycmF5KHNlbGVjdGlvbikpIHsKICAgICAg
ICBzZXQodGhpcywgJ3NlbGVjdGlvbicsIEVtYmVyLkEoW3NlbGVjdGlvbl0pKTsKICAgICAgICBy
ZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fc2VsZWN0aW9uRGlkQ2hhbmdlTXVsdGlwbGUoKTsK
ICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3NlbGVjdGlvbkRpZENoYW5nZVNpbmdsZSgpOwogICAg
fQogIH0pLAoKICB2YWx1ZURpZENoYW5nZTogRW1iZXIub2JzZXJ2ZXIoJ3ZhbHVlJywgZnVuY3Rp
b24oKSB7CiAgICB2YXIgY29udGVudCA9IGdldCh0aGlzLCAnY29udGVudCcpLAogICAgICAgIHZh
bHVlID0gZ2V0KHRoaXMsICd2YWx1ZScpLAogICAgICAgIHZhbHVlUGF0aCA9IGdldCh0aGlzLCAn
b3B0aW9uVmFsdWVQYXRoJykucmVwbGFjZSgvXmNvbnRlbnRcLj8vLCAnJyksCiAgICAgICAgc2Vs
ZWN0ZWRWYWx1ZSA9ICh2YWx1ZVBhdGggPyBnZXQodGhpcywgJ3NlbGVjdGlvbi4nICsgdmFsdWVQ
YXRoKSA6IGdldCh0aGlzLCAnc2VsZWN0aW9uJykpLAogICAgICAgIHNlbGVjdGlvbjsKCiAgICBp
ZiAodmFsdWUgIT09IHNlbGVjdGVkVmFsdWUpIHsKICAgICAgc2VsZWN0aW9uID0gY29udGVudCA/
IGNvbnRlbnQuZmluZChmdW5jdGlvbihvYmopIHsKICAgICAgICByZXR1cm4gdmFsdWUgPT09ICh2
YWx1ZVBhdGggPyBnZXQob2JqLCB2YWx1ZVBhdGgpIDogb2JqKTsKICAgICAgfSkgOiBudWxsOwoK
ICAgICAgdGhpcy5zZXQoJ3NlbGVjdGlvbicsIHNlbGVjdGlvbik7CiAgICB9CiAgfSksCgoKICBf
dHJpZ2dlckNoYW5nZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZWN0aW9uID0gZ2V0KHRoaXMs
ICdzZWxlY3Rpb24nKTsKICAgIHZhciB2YWx1ZSA9IGdldCh0aGlzLCAndmFsdWUnKTsKCiAgICBp
ZiAoIUVtYmVyLmlzTm9uZShzZWxlY3Rpb24pKSB7IHRoaXMuc2VsZWN0aW9uRGlkQ2hhbmdlKCk7
IH0KICAgIGlmICghRW1iZXIuaXNOb25lKHZhbHVlKSkgeyB0aGlzLnZhbHVlRGlkQ2hhbmdlKCk7
IH0KCiAgICB0aGlzLl9jaGFuZ2UoKTsKICB9LAoKICBfY2hhbmdlU2luZ2xlOiBmdW5jdGlvbigp
IHsKICAgIHZhciBzZWxlY3RlZEluZGV4ID0gdGhpcy4kKClbMF0uc2VsZWN0ZWRJbmRleCwKICAg
ICAgICBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50JyksCiAgICAgICAgcHJvbXB0ID0gZ2V0
KHRoaXMsICdwcm9tcHQnKTsKCiAgICBpZiAoIWNvbnRlbnQgfHwgIWdldChjb250ZW50LCAnbGVu
Z3RoJykpIHsgcmV0dXJuOyB9CiAgICBpZiAocHJvbXB0ICYmIHNlbGVjdGVkSW5kZXggPT09IDAp
IHsgc2V0KHRoaXMsICdzZWxlY3Rpb24nLCBudWxsKTsgcmV0dXJuOyB9CgogICAgaWYgKHByb21w
dCkgeyBzZWxlY3RlZEluZGV4IC09IDE7IH0KICAgIHNldCh0aGlzLCAnc2VsZWN0aW9uJywgY29u
dGVudC5vYmplY3RBdChzZWxlY3RlZEluZGV4KSk7CiAgfSwKCgogIF9jaGFuZ2VNdWx0aXBsZTog
ZnVuY3Rpb24oKSB7CiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuJCgnb3B0aW9uOnNlbGVjdGVkJyks
CiAgICAgICAgcHJvbXB0ID0gZ2V0KHRoaXMsICdwcm9tcHQnKSwKICAgICAgICBvZmZzZXQgPSBw
cm9tcHQgPyAxIDogMCwKICAgICAgICBjb250ZW50ID0gZ2V0KHRoaXMsICdjb250ZW50JyksCiAg
ICAgICAgc2VsZWN0aW9uID0gZ2V0KHRoaXMsICdzZWxlY3Rpb24nKTsKCiAgICBpZiAoIWNvbnRl
bnQpIHsgcmV0dXJuOyB9CiAgICBpZiAob3B0aW9ucykgewogICAgICB2YXIgc2VsZWN0ZWRJbmRl
eGVzID0gb3B0aW9ucy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXgg
LSBvZmZzZXQ7CiAgICAgIH0pLnRvQXJyYXkoKTsKICAgICAgdmFyIG5ld1NlbGVjdGlvbiA9IGNv
bnRlbnQub2JqZWN0c0F0KHNlbGVjdGVkSW5kZXhlcyk7CgogICAgICBpZiAoaXNBcnJheShzZWxl
Y3Rpb24pKSB7CiAgICAgICAgcmVwbGFjZShzZWxlY3Rpb24sIDAsIGdldChzZWxlY3Rpb24sICds
ZW5ndGgnKSwgbmV3U2VsZWN0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXQodGhpcywg
J3NlbGVjdGlvbicsIG5ld1NlbGVjdGlvbik7CiAgICAgIH0KICAgIH0KICB9LAoKICBfc2VsZWN0
aW9uRGlkQ2hhbmdlU2luZ2xlOiBmdW5jdGlvbigpIHsKICAgIHZhciBlbCA9IHRoaXMuZ2V0KCdl
bGVtZW50Jyk7CiAgICBpZiAoIWVsKSB7IHJldHVybjsgfQoKICAgIHZhciBjb250ZW50ID0gZ2V0
KHRoaXMsICdjb250ZW50JyksCiAgICAgICAgc2VsZWN0aW9uID0gZ2V0KHRoaXMsICdzZWxlY3Rp
b24nKSwKICAgICAgICBzZWxlY3Rpb25JbmRleCA9IGNvbnRlbnQgPyBpbmRleE9mKGNvbnRlbnQs
IHNlbGVjdGlvbikgOiAtMSwKICAgICAgICBwcm9tcHQgPSBnZXQodGhpcywgJ3Byb21wdCcpOwoK
ICAgIGlmIChwcm9tcHQpIHsgc2VsZWN0aW9uSW5kZXggKz0gMTsgfQogICAgaWYgKGVsKSB7IGVs
LnNlbGVjdGVkSW5kZXggPSBzZWxlY3Rpb25JbmRleDsgfQogIH0sCgogIF9zZWxlY3Rpb25EaWRD
aGFuZ2VNdWx0aXBsZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgY29udGVudCA9IGdldCh0aGlzLCAn
Y29udGVudCcpLAogICAgICAgIHNlbGVjdGlvbiA9IGdldCh0aGlzLCAnc2VsZWN0aW9uJyksCiAg
ICAgICAgc2VsZWN0ZWRJbmRleGVzID0gY29udGVudCA/IGluZGV4ZXNPZihjb250ZW50LCBzZWxl
Y3Rpb24pIDogWy0xXSwKICAgICAgICBwcm9tcHQgPSBnZXQodGhpcywgJ3Byb21wdCcpLAogICAg
ICAgIG9mZnNldCA9IHByb21wdCA/IDEgOiAwLAogICAgICAgIG9wdGlvbnMgPSB0aGlzLiQoJ29w
dGlvbicpLAogICAgICAgIGFkanVzdGVkOwoKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIG9wdGlv
bnMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICBhZGp1c3RlZCA9IHRoaXMuaW5kZXggPiAtMSA/
IHRoaXMuaW5kZXggLSBvZmZzZXQgOiAtMTsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gaW5kZXhP
ZihzZWxlY3RlZEluZGV4ZXMsIGFkanVzdGVkKSA+IC0xOwogICAgICB9KTsKICAgIH0KICB9LAoK
ICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3N1cGVyKCk7CiAgICB0aGlzLm9uKCJkaWRJ
bnNlcnRFbGVtZW50IiwgdGhpcywgdGhpcy5fdHJpZ2dlckNoYW5nZSk7CiAgICB0aGlzLm9uKCJj
aGFuZ2UiLCB0aGlzLCB0aGlzLl9jaGFuZ2UpOwogIH0KfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItaGFuZGxlYmFycy1jb21waWxl
cgoqLwoKLyoqCgogIFRoZSBge3tpbnB1dH19YCBoZWxwZXIgaW5zZXJ0cyBhbiBIVE1MIGA8aW5w
dXQ+YCB0YWcgaW50byB0aGUgdGVtcGxhdGUsCiAgd2l0aCBhIGB0eXBlYCB2YWx1ZSBvZiBlaXRo
ZXIgYHRleHRgIG9yIGBjaGVja2JveGAuIElmIG5vIGB0eXBlYCBpcyBwcm92aWRlZCwKICBgdGV4
dGAgd2lsbCBiZSB0aGUgZGVmYXVsdCB2YWx1ZSBhcHBsaWVkLiBUaGUgYXR0cmlidXRlcyBvZiBg
e3tpbnB1dH19YAogIG1hdGNoIHRob3NlIG9mIHRoZSBuYXRpdmUgSFRNTCB0YWcgYXMgY2xvc2Vs
eSBhcyBwb3NzaWJsZSBmb3IgdGhlc2UgdHdvIHR5cGVzLgoKICAjIyBVc2UgYXMgdGV4dCBmaWVs
ZAogIEFuIGB7e2lucHV0fX1gIHdpdGggbm8gYHR5cGVgIG9yIGEgYHR5cGVgIG9mIGB0ZXh0YCB3
aWxsIHJlbmRlciBhbiBIVE1MIHRleHQgaW5wdXQuCiAgVGhlIGZvbGxvd2luZyBIVE1MIGF0dHJp
YnV0ZXMgY2FuIGJlIHNldCB2aWEgdGhlIGhlbHBlcjoKCiogYHZhbHVlYAoqIGBzaXplYAoqIGBu
YW1lYAoqIGBwYXR0ZXJuYAoqIGBwbGFjZWhvbGRlcmAKKiBgZGlzYWJsZWRgCiogYG1heGxlbmd0
aGAKKiBgdGFiaW5kZXhgCgoKICBXaGVuIHNldCB0byBhIHF1b3RlZCBzdHJpbmcsIHRoZXNlIHZh
bHVlcyB3aWxsIGJlIGRpcmVjdGx5IGFwcGxpZWQgdG8gdGhlIEhUTUwKICBlbGVtZW50LiBXaGVu
IGxlZnQgdW5xdW90ZWQsIHRoZXNlIHZhbHVlcyB3aWxsIGJlIGJvdW5kIHRvIGEgcHJvcGVydHkg
b24gdGhlCiAgdGVtcGxhdGUncyBjdXJyZW50IHJlbmRlcmluZyBjb250ZXh0IChtb3N0IHR5cGlj
YWxseSBhIGNvbnRyb2xsZXIgaW5zdGFuY2UpLgoKICAjIyBVbmJvdW5kOgoKICBgYGBoYW5kbGVi
YXJzCiAge3tpbnB1dCB2YWx1ZT0iaHR0cDovL3d3dy5mYWNlYm9vay5jb20ifX0KICBgYGAKCgog
IGBgYGh0bWwKICA8aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9Imh0dHA6Ly93d3cuZmFjZWJvb2su
Y29tIi8+CiAgYGBgCgogICMjIEJvdW5kOgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLkFwcGxpY2F0
aW9uQ29udHJvbGxlciA9IEVtYmVyLkNvbnRyb2xsZXIuZXh0ZW5kKHsKICAgIGZpcnN0TmFtZTog
IlN0YW5sZXkiLAogICAgZW50cnlOb3RBbGxvd2VkOiB0cnVlCiAgfSk7CiAgYGBgCgoKICBgYGBo
YW5kbGViYXJzCiAge3tpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT1maXJzdE5hbWUgZGlzYWJsZWQ9
ZW50cnlOb3RBbGxvd2VkIHNpemU9IjUwIn19CiAgYGBgCgoKICBgYGBodG1sCiAgPGlucHV0IHR5
cGU9InRleHQiIHZhbHVlPSJTdGFubGV5IiBkaXNhYmxlZD0iZGlzYWJsZWQiIHNpemU9IjUwIi8+
CiAgYGBgCgogICMjIEV4dGVuc2lvbgoKICBJbnRlcm5hbGx5LCBge3tpbnB1dCB0eXBlPSJ0ZXh0
In19YCBjcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBFbWJlci5UZXh0RmllbGRgLCBwYXNzaW5nCiAg
YXJndW1lbnRzIGZyb20gdGhlIGhlbHBlciB0byBgRW1iZXIuVGV4dEZpZWxkYCdzIGBjcmVhdGVg
IG1ldGhvZC4gWW91IGNhbiBleHRlbmQgdGhlCiAgY2FwYWJsaWx0aWVzIG9mIHRleHQgaW5wdXRz
IGluIHlvdXIgYXBwbGljYXRpb25zIGJ5IHJlb3BlbmluZyB0aGlzIGNsYXNzLiBGb3IgZXhhbXBs
ZSwKICBpZiB5b3UgYXJlIGRlcGxveWluZyB0byBicm93c2VycyB3aGVyZSB0aGUgYHJlcXVpcmVk
YCBhdHRyaWJ1dGUgaXMgdXNlZCwgeW91CiAgY2FuIGFkZCB0aGlzIHRvIHRoZSBgVGV4dEZpZWxk
YCdzIGBhdHRyaWJ1dGVCaW5kaW5nc2AgcHJvcGVydHk6CgoKICBgYGBqYXZhc2NyaXB0CiAgRW1i
ZXIuVGV4dEZpZWxkLnJlb3Blbih7CiAgICBhdHRyaWJ1dGVCaW5kaW5nczogWydyZXF1aXJlZCdd
CiAgfSk7CiAgYGBgCgogIEtlZXAgaW4gbWluZCB3aGVuIHdyaXRpbmcgYEVtYmVyLlRleHRGaWVs
ZGAgc3ViY2xhc3NlcyB0aGF0IGBFbWJlci5UZXh0RmllbGRgCiAgaXRzZWxmIGV4dGVuZHMgYEVt
YmVyLkNvbXBvbmVudGAsIG1lYW5pbmcgdGhhdCBpdCBkb2VzIE5PVCBpbmhlcml0CiAgdGhlIGBj
b250cm9sbGVyYCBvZiB0aGUgcGFyZW50IHZpZXcuCgogIFNlZSBtb3JlIGFib3V0IFtFbWJlciBj
b21wb25lbnRzXShhcGkvY2xhc3Nlcy9FbWJlci5Db21wb25lbnQuaHRtbCkKCgogICMjIFVzZSBh
cyBjaGVja2JveAoKICBBbiBge3tpbnB1dH19YCB3aXRoIGEgYHR5cGVgIG9mIGBjaGVja2JveGAg
d2lsbCByZW5kZXIgYW4gSFRNTCBjaGVja2JveCBpbnB1dC4KICBUaGUgZm9sbG93aW5nIEhUTUwg
YXR0cmlidXRlcyBjYW4gYmUgc2V0IHZpYSB0aGUgaGVscGVyOgoKKiBgY2hlY2tlZGAKKiBgZGlz
YWJsZWRgCiogYHRhYmluZGV4YAoqIGBpbmRldGVybWluYXRlYAoqIGBuYW1lYAoKCiAgV2hlbiBz
ZXQgdG8gYSBxdW90ZWQgc3RyaW5nLCB0aGVzZSB2YWx1ZXMgd2lsbCBiZSBkaXJlY3RseSBhcHBs
aWVkIHRvIHRoZSBIVE1MCiAgZWxlbWVudC4gV2hlbiBsZWZ0IHVucXVvdGVkLCB0aGVzZSB2YWx1
ZXMgd2lsbCBiZSBib3VuZCB0byBhIHByb3BlcnR5IG9uIHRoZQogIHRlbXBsYXRlJ3MgY3VycmVu
dCByZW5kZXJpbmcgY29udGV4dCAobW9zdCB0eXBpY2FsbHkgYSBjb250cm9sbGVyIGluc3RhbmNl
KS4KCiAgIyMgVW5ib3VuZDoKCiAgYGBgaGFuZGxlYmFycwogIHt7aW5wdXQgdHlwZT0iY2hlY2ti
b3giIG5hbWU9ImlzQWRtaW4ifX0KICBgYGAKCiAgYGBgaHRtbAogIDxpbnB1dCB0eXBlPSJjaGVj
a2JveCIgbmFtZT0iaXNBZG1pbiIgLz4KICBgYGAKCiAgIyMgQm91bmQ6CgogIGBgYGphdmFzY3Jp
cHQKICBBcHAuQXBwbGljYXRpb25Db250cm9sbGVyID0gRW1iZXIuQ29udHJvbGxlci5leHRlbmQo
ewogICAgaXNBZG1pbjogdHJ1ZQogIH0pOwogIGBgYAoKCiAgYGBgaGFuZGxlYmFycwogIHt7aW5w
dXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9aXNBZG1pbiB9fQogIGBgYAoKCiAgYGBgaHRtbAog
IDxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2hlY2tlZD0iY2hlY2tlZCIgLz4KICBgYGAKCiAgIyMg
RXh0ZW5zaW9uCgogIEludGVybmFsbHksIGB7e2lucHV0IHR5cGU9ImNoZWNrYm94In19YCBjcmVh
dGVzIGFuIGluc3RhbmNlIG9mIGBFbWJlci5DaGVja2JveGAsIHBhc3NpbmcKICBhcmd1bWVudHMg
ZnJvbSB0aGUgaGVscGVyIHRvIGBFbWJlci5DaGVja2JveGAncyBgY3JlYXRlYCBtZXRob2QuIFlv
dSBjYW4gZXh0ZW5kIHRoZQogIGNhcGFibGlsdGllcyBvZiBjaGVja2JveCBpbnB1dHMgaW4geW91
ciBhcHBsaWNhdGlvbnMgYnkgcmVvcGVuaW5nIHRoaXMgY2xhc3MuIEZvciBleGFtcGxlLAogIGlm
IHlvdSB3YW50ZWQgdG8gYWRkIGEgY3NzIGNsYXNzIHRvIGFsbCBjaGVja2JveGVzIGluIHlvdXIg
YXBwbGljYXRpb246CgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuQ2hlY2tib3gucmVvcGVuKHsK
ICAgIGNsYXNzTmFtZXM6IFsnbXktYXBwLWNoZWNrYm94J10KICB9KTsKICBgYGAKCgogIEBtZXRo
b2QgaW5wdXQKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwogIEBwYXJhbSB7SGFzaH0g
b3B0aW9ucwoqLwpFbWJlci5IYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpbnB1dCcsIGZ1bmN0
aW9uKG9wdGlvbnMpIHsKICBFbWJlci5hc3NlcnQoJ1lvdSBjYW4gb25seSBwYXNzIGF0dHJpYnV0
ZXMgdG8gdGhlIGBpbnB1dGAgaGVscGVyLCBub3QgYXJndW1lbnRzJywgYXJndW1lbnRzLmxlbmd0
aCA8IDIpOwoKICB2YXIgaGFzaCA9IG9wdGlvbnMuaGFzaCwKICAgICAgdHlwZXMgPSBvcHRpb25z
Lmhhc2hUeXBlcywKICAgICAgaW5wdXRUeXBlID0gaGFzaC50eXBlLAogICAgICBvbkV2ZW50ID0g
aGFzaC5vbjsKCiAgZGVsZXRlIGhhc2gudHlwZTsKICBkZWxldGUgaGFzaC5vbjsKCiAgaWYgKGlu
cHV0VHlwZSA9PT0gJ2NoZWNrYm94JykgewogICAgcmV0dXJuIEVtYmVyLkhhbmRsZWJhcnMuaGVs
cGVycy52aWV3LmNhbGwodGhpcywgRW1iZXIuQ2hlY2tib3gsIG9wdGlvbnMpOwogIH0gZWxzZSB7
CiAgICBpZiAoaW5wdXRUeXBlKSB7IGhhc2gudHlwZSA9IGlucHV0VHlwZTsgfQogICAgaGFzaC5v
bkV2ZW50ID0gb25FdmVudCB8fCAnZW50ZXInOwogICAgcmV0dXJuIEVtYmVyLkhhbmRsZWJhcnMu
aGVscGVycy52aWV3LmNhbGwodGhpcywgRW1iZXIuVGV4dEZpZWxkLCBvcHRpb25zKTsKICB9Cn0p
OwoKLyoqCiAgYHt7dGV4dGFyZWF9fWAgaW5zZXJ0cyBhIG5ldyBpbnN0YW5jZSBvZiBgPHRleHRh
cmVhPmAgdGFnIGludG8gdGhlIHRlbXBsYXRlLgogIFRoZSBhdHRyaWJ1dGVzIG9mIGB7e3RleHRh
cmVhfX1gIG1hdGNoIHRob3NlIG9mIHRoZSBuYXRpdmUgSFRNTCB0YWdzIGFzCiAgY2xvc2VseSBh
cyBwb3NzaWJsZS4KCiAgVGhlIGZvbGxvd2luZyBIVE1MIGF0dHJpYnV0ZXMgY2FuIGJlIHNldDoK
CiAgICAqIGB2YWx1ZWAKICAgICogYG5hbWVgCiAgICAqIGByb3dzYAogICAgKiBgY29sc2AKICAg
ICogYHBsYWNlaG9sZGVyYAogICAgKiBgZGlzYWJsZWRgCiAgICAqIGBtYXhsZW5ndGhgCiAgICAq
IGB0YWJpbmRleGAKCiAgV2hlbiBzZXQgdG8gYSBxdW90ZWQgc3RyaW5nLCB0aGVzZSB2YWx1ZSB3
aWxsIGJlIGRpcmVjdGx5IGFwcGxpZWQgdG8gdGhlIEhUTUwKICBlbGVtZW50LiBXaGVuIGxlZnQg
dW5xdW90ZWQsIHRoZXNlIHZhbHVlcyB3aWxsIGJlIGJvdW5kIHRvIGEgcHJvcGVydHkgb24gdGhl
CiAgdGVtcGxhdGUncyBjdXJyZW50IHJlbmRlcmluZyBjb250ZXh0IChtb3N0IHR5cGljYWxseSBh
IGNvbnRyb2xsZXIgaW5zdGFuY2UpLgoKICBVbmJvdW5kOgoKICBgYGBoYW5kbGViYXJzCiAge3t0
ZXh0YXJlYSB2YWx1ZT0iTG90cyBvZiBzdGF0aWMgdGV4dCB0aGF0IElTTidUIGJvdW5kIn19CiAg
YGBgCgogIFdvdWxkIHJlc3VsdCBpbiB0aGUgZm9sbG93aW5nIEhUTUw6CgogIGBgYGh0bWwKICA8
dGV4dGFyZWEgY2xhc3M9ImVtYmVyLXRleHQtYXJlYSI+CiAgICBMb3RzIG9mIHN0YXRpYyB0ZXh0
IHRoYXQgSVNOJ1QgYm91bmQKICA8L3RleHRhcmVhPgogIGBgYAoKICBCb3VuZDoKCiAgSW4gdGhl
IGZvbGxvd2luZyBleGFtcGxlLCB0aGUgYHdyaXR0ZW5Xb3Jkc2AgcHJvcGVydHkgb24gYEFwcC5B
cHBsaWNhdGlvbkNvbnRyb2xsZXJgCiAgd2lsbCBiZSB1cGRhdGVkIGxpdmUgYXMgdGhlIHVzZXIg
dHlwZXMgJ0xvdHMgb2YgdGV4dCB0aGF0IElTIGJvdW5kJyBpbnRvCiAgdGhlIHRleHQgYXJlYSBv
ZiB0aGVpciBicm93c2VyJ3Mgd2luZG93LgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLkFwcGxpY2F0
aW9uQ29udHJvbGxlciA9IEVtYmVyLkNvbnRyb2xsZXIuZXh0ZW5kKHsKICAgIHdyaXR0ZW5Xb3Jk
czogIkxvdHMgb2YgdGV4dCB0aGF0IElTIGJvdW5kIgogIH0pOwogIGBgYAoKICBgYGBoYW5kbGVi
YXJzCiAge3t0ZXh0YXJlYSB2YWx1ZT13cml0dGVuV29yZHN9fQogIGBgYAoKICAgV291bGQgcmVz
dWx0IGluIHRoZSBmb2xsb3dpbmcgSFRNTDoKCiAgYGBgaHRtbAogIDx0ZXh0YXJlYSBjbGFzcz0i
ZW1iZXItdGV4dC1hcmVhIj4KICAgIExvdHMgb2YgdGV4dCB0aGF0IElTIGJvdW5kCiAgPC90ZXh0
YXJlYT4KICBgYGAKCiAgSWYgeW91IHdhbnRlZCBhIG9uZSB3YXkgYmluZGluZyBiZXR3ZWVuIHRo
ZSB0ZXh0IGFyZWEgYW5kIGEgZGl2IHRhZwogIHNvbWV3aGVyZSBlbHNlIG9uIHlvdXIgc2NyZWVu
LCB5b3UgY291bGQgdXNlIGBFbWJlci5jb21wdXRlZC5vbmVXYXlgOgoKICBgYGBqYXZhc2NyaXB0
CiAgQXBwLkFwcGxpY2F0aW9uQ29udHJvbGxlciA9IEVtYmVyLkNvbnRyb2xsZXIuZXh0ZW5kKHsK
ICAgIHdyaXR0ZW5Xb3JkczogIkxvdHMgb2YgdGV4dCB0aGF0IElTIGJvdW5kIiwKICAgIG91dHB1
dFdyaXR0ZW5Xb3JkczogRW1iZXIuY29tcHV0ZWQub25lV2F5KCJ3cml0dGVuV29yZHMiKQogIH0p
OwogIGBgYAoKICBgYGBoYW5kbGViYXJzCiAge3t0ZXh0YXJlYSB2YWx1ZT13cml0dGVuV29yZHN9
fQoKICA8ZGl2PgogICAge3tvdXRwdXRXcml0dGVuV29yZHN9fQogIDwvZGl2PgogIGBgYAoKICBX
b3VsZCByZXN1bHQgaW4gdGhlIGZvbGxvd2luZyBIVE1MOgoKICBgYGBodG1sCiAgPHRleHRhcmVh
IGNsYXNzPSJlbWJlci10ZXh0LWFyZWEiPgogICAgTG90cyBvZiB0ZXh0IHRoYXQgSVMgYm91bmQK
ICA8L3RleHRhcmVhPgoKICA8LS0gdGhlIGZvbGxvd2luZyBkaXYgd2lsbCBiZSB1cGRhdGVkIGlu
IHJlYWwgdGltZSBhcyB5b3UgdHlwZSAtLT4KCiAgPGRpdj4KICAgIExvdHMgb2YgdGV4dCB0aGF0
IElTIGJvdW5kCiAgPC9kaXY+CiAgYGBgCgogIEZpbmFsbHksIHRoaXMgZXhhbXBsZSByZWFsbHkg
c2hvd3MgdGhlIHBvd2VyIGFuZCBlYXNlIG9mIEVtYmVyIHdoZW4gdHdvCiAgcHJvcGVydGllcyBh
cmUgYm91bmQgdG8gZWFjaG90aGVyIHZpYSBgRW1iZXIuY29tcHV0ZWQuYWxpYXNgLiBUeXBlIGlu
dG8KICBlaXRoZXIgdGV4dCBhcmVhIGJveCBhbmQgdGhleSdsbCBib3RoIHN0YXkgaW4gc3luYy4g
Tm90ZSB0aGF0CiAgYEVtYmVyLmNvbXB1dGVkLmFsaWFzYCBjb3N0cyBtb3JlIGluIHRlcm1zIG9m
IHBlcmZvcm1hbmNlLCBzbyBvbmx5IHVzZSBpdCB3aGVuCiAgeW91ciByZWFsbHkgYmluZGluZyBp
biBib3RoIGRpcmVjdGlvbnM6CgogIGBgYGphdmFzY3JpcHQKICBBcHAuQXBwbGljYXRpb25Db250
cm9sbGVyID0gRW1iZXIuQ29udHJvbGxlci5leHRlbmQoewogICAgd3JpdHRlbldvcmRzOiAiTG90
cyBvZiB0ZXh0IHRoYXQgSVMgYm91bmQiLAogICAgdHdvV2F5V3JpdHRlbldvcmRzOiBFbWJlci5j
b21wdXRlZC5hbGlhcygid3JpdHRlbldvcmRzIikKICB9KTsKICBgYGAKCiAgYGBgaGFuZGxlYmFy
cwogIHt7dGV4dGFyZWEgdmFsdWU9d3JpdHRlbldvcmRzfX0KICB7e3RleHRhcmVhIHZhbHVlPXR3
b1dheVdyaXR0ZW5Xb3Jkc319CiAgYGBgCgogIGBgYGh0bWwKICA8dGV4dGFyZWEgaWQ9ImVtYmVy
MSIgY2xhc3M9ImVtYmVyLXRleHQtYXJlYSI+CiAgICBMb3RzIG9mIHRleHQgdGhhdCBJUyBib3Vu
ZAogIDwvdGV4dGFyZWE+CgogIDwtLSBib3RoIHVwZGF0ZWQgaW4gcmVhbCB0aW1lIC0tPgoKICA8
dGV4dGFyZWEgaWQ9ImVtYmVyMiIgY2xhc3M9ImVtYmVyLXRleHQtYXJlYSI+CiAgICBMb3RzIG9m
IHRleHQgdGhhdCBJUyBib3VuZAogIDwvdGV4dGFyZWE+CiAgYGBgCgogICMjIEV4dGVuc2lvbgoK
ICBJbnRlcm5hbGx5LCBge3t0ZXh0YXJlYX19YCBjcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBFbWJl
ci5UZXh0QXJlYWAsIHBhc3NpbmcKICBhcmd1bWVudHMgZnJvbSB0aGUgaGVscGVyIHRvIGBFbWJl
ci5UZXh0QXJlYWAncyBgY3JlYXRlYCBtZXRob2QuIFlvdSBjYW4KICBleHRlbmQgdGhlIGNhcGFi
aWxpdGllcyBvZiB0ZXh0IGFyZWFzIGluIHlvdXIgYXBwbGljYXRpb24gYnkgcmVvcGVuaW5nIHRo
aXMKICBjbGFzcy4gRm9yIGV4YW1wbGUsIGlmIHlvdSBhcmUgZGVwbG95aW5nIHRvIGJyb3dzZXJz
IHdoZXJlIHRoZSBgcmVxdWlyZWRgCiAgYXR0cmlidXRlIGlzIHVzZWQsIHlvdSBjYW4gZ2xvYmFs
bHkgYWRkIHN1cHBvcnQgZm9yIHRoZSBgcmVxdWlyZWRgIGF0dHJpYnV0ZQogIG9uIGFsbCBge3t0
ZXh0YXJlYX19YHMnIGluIHlvdXIgYXBwIGJ5IHJlb3BlbmluZyBgRW1iZXIuVGV4dEFyZWFgIG9y
CiAgYEVtYmVyLlRleHRTdXBwb3J0YCBhbmQgYWRkaW5nIGl0IHRvIHRoZSBgYXR0cmlidXRlQmlu
ZGluZ3NgIGNvbmNhdGVuYXRlZAogIHByb3BlcnR5OgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIu
VGV4dEFyZWEucmVvcGVuKHsKICAgIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ3JlcXVpcmVkJ10KICB9
KTsKICBgYGAKCiAgS2VlcCBpbiBtaW5kIHdoZW4gd3JpdGluZyBgRW1iZXIuVGV4dEFyZWFgIHN1
YmNsYXNzZXMgdGhhdCBgRW1iZXIuVGV4dEFyZWFgCiAgaXRzZWxmIGV4dGVuZHMgYEVtYmVyLkNv
bXBvbmVudGAsIG1lYW5pbmcgdGhhdCBpdCBkb2VzIE5PVCBpbmhlcml0CiAgdGhlIGBjb250cm9s
bGVyYCBvZiB0aGUgcGFyZW50IHZpZXcuCgogIFNlZSBtb3JlIGFib3V0IFtFbWJlciBjb21wb25l
bnRzXShhcGkvY2xhc3Nlcy9FbWJlci5Db21wb25lbnQuaHRtbCkKCiAgQG1ldGhvZCB0ZXh0YXJl
YQogIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgQHBhcmFtIHtIYXNofSBvcHRpb25z
CiovCkVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3RleHRhcmVhJywgZnVuY3Rpb24o
b3B0aW9ucykgewogIEVtYmVyLmFzc2VydCgnWW91IGNhbiBvbmx5IHBhc3MgYXR0cmlidXRlcyB0
byB0aGUgYHRleHRhcmVhYCBoZWxwZXIsIG5vdCBhcmd1bWVudHMnLCBhcmd1bWVudHMubGVuZ3Ro
IDwgMik7CgogIHZhciBoYXNoID0gb3B0aW9ucy5oYXNoLAogICAgICB0eXBlcyA9IG9wdGlvbnMu
aGFzaFR5cGVzOwoKICByZXR1cm4gRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzLnZpZXcuY2FsbCh0
aGlzLCBFbWJlci5UZXh0QXJlYSwgb3B0aW9ucyk7Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkg
ewpFbWJlci5Db21wb25lbnRMb29rdXAgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICBsb29rdXBG
YWN0b3J5OiBmdW5jdGlvbihuYW1lLCBjb250YWluZXIpIHsKCiAgICBjb250YWluZXIgPSBjb250
YWluZXIgfHwgdGhpcy5jb250YWluZXI7CgogICAgdmFyIGZ1bGxOYW1lID0gJ2NvbXBvbmVudDon
ICsgbmFtZSwKICAgICAgICB0ZW1wbGF0ZUZ1bGxOYW1lID0gJ3RlbXBsYXRlOmNvbXBvbmVudHMv
JyArIG5hbWUsCiAgICAgICAgdGVtcGxhdGVSZWdpc3RlcmVkID0gY29udGFpbmVyICYmIGNvbnRh
aW5lci5oYXModGVtcGxhdGVGdWxsTmFtZSk7CgogICAgaWYgKHRlbXBsYXRlUmVnaXN0ZXJlZCkg
ewogICAgICBjb250YWluZXIuaW5qZWN0aW9uKGZ1bGxOYW1lLCAnbGF5b3V0JywgdGVtcGxhdGVG
dWxsTmFtZSk7CiAgICB9CgogICAgdmFyIENvbXBvbmVudCA9IGNvbnRhaW5lci5sb29rdXBGYWN0
b3J5KGZ1bGxOYW1lKTsKCiAgICAvLyBPbmx5IHRyZWF0IGFzIGEgY29tcG9uZW50IGlmIGVpdGhl
ciB0aGUgY29tcG9uZW50CiAgICAvLyBvciBhIHRlbXBsYXRlIGhhcyBiZWVuIHJlZ2lzdGVyZWQu
CiAgICBpZiAodGVtcGxhdGVSZWdpc3RlcmVkIHx8IENvbXBvbmVudCkgewogICAgICBpZiAoIUNv
bXBvbmVudCkgewogICAgICAgIGNvbnRhaW5lci5yZWdpc3RlcihmdWxsTmFtZSwgRW1iZXIuQ29t
cG9uZW50KTsKICAgICAgICBDb21wb25lbnQgPSBjb250YWluZXIubG9va3VwRmFjdG9yeShmdWxs
TmFtZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIENvbXBvbmVudDsKICAgIH0KICB9Cn0pOwoKfSko
KTsKCgoKKGZ1bmN0aW9uKCkgewovKmdsb2JhbHMgSGFuZGxlYmFycyAqLwovKioKQG1vZHVsZSBl
bWJlcgpAc3VibW9kdWxlIGVtYmVyLWhhbmRsZWJhcnMKKi8KCi8qKgogIEZpbmQgdGVtcGxhdGVz
IHN0b3JlZCBpbiB0aGUgaGVhZCB0YWcgYXMgc2NyaXB0IHRhZ3MgYW5kIG1ha2UgdGhlbSBhdmFp
bGFibGUKICB0byBgRW1iZXIuQ29yZVZpZXdgIGluIHRoZSBnbG9iYWwgYEVtYmVyLlRFTVBMQVRF
U2Agb2JqZWN0LiBUaGlzIHdpbGwgYmUgcnVuCiAgYXMgYXMgalF1ZXJ5IERPTS1yZWFkeSBjYWxs
YmFjay4KCiAgU2NyaXB0IHRhZ3Mgd2l0aCBgdGV4dC94LWhhbmRsZWJhcnNgIHdpbGwgYmUgY29t
cGlsZWQKICB3aXRoIEVtYmVyJ3MgSGFuZGxlYmFycyBhbmQgYXJlIHN1aXRhYmxlIGZvciB1c2Ug
YXMgYSB2aWV3J3MgdGVtcGxhdGUuCiAgVGhvc2Ugd2l0aCB0eXBlIGB0ZXh0L3gtcmF3LWhhbmRs
ZWJhcnNgIHdpbGwgYmUgY29tcGlsZWQgd2l0aCByZWd1bGFyCiAgSGFuZGxlYmFycyBhbmQgYXJl
IHN1aXRhYmxlIGZvciB1c2UgaW4gdmlld3MnIGNvbXB1dGVkIHByb3BlcnRpZXMuCgogIEBwcml2
YXRlCiAgQG1ldGhvZCBib290c3RyYXAKICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMKICBAc3RhdGlj
CiAgQHBhcmFtIGN0eAoqLwpFbWJlci5IYW5kbGViYXJzLmJvb3RzdHJhcCA9IGZ1bmN0aW9uKGN0
eCkgewogIHZhciBzZWxlY3RvcnMgPSAnc2NyaXB0W3R5cGU9InRleHQveC1oYW5kbGViYXJzIl0s
IHNjcmlwdFt0eXBlPSJ0ZXh0L3gtcmF3LWhhbmRsZWJhcnMiXSc7CgogIEVtYmVyLiQoc2VsZWN0
b3JzLCBjdHgpCiAgICAuZWFjaChmdW5jdGlvbigpIHsKICAgIC8vIEdldCBhIHJlZmVyZW5jZSB0
byB0aGUgc2NyaXB0IHRhZwogICAgdmFyIHNjcmlwdCA9IEVtYmVyLiQodGhpcyk7CgogICAgdmFy
IGNvbXBpbGUgPSAoc2NyaXB0LmF0dHIoJ3R5cGUnKSA9PT0gJ3RleHQveC1yYXctaGFuZGxlYmFy
cycpID8KICAgICAgICAgICAgICAgICAgRW1iZXIuJC5wcm94eShIYW5kbGViYXJzLmNvbXBpbGUs
IEhhbmRsZWJhcnMpIDoKICAgICAgICAgICAgICAgICAgRW1iZXIuJC5wcm94eShFbWJlci5IYW5k
bGViYXJzLmNvbXBpbGUsIEVtYmVyLkhhbmRsZWJhcnMpLAogICAgICAvLyBHZXQgdGhlIG5hbWUg
b2YgdGhlIHNjcmlwdCwgdXNlZCBieSBFbWJlci5WaWV3J3MgdGVtcGxhdGVOYW1lIHByb3BlcnR5
LgogICAgICAvLyBGaXJzdCBsb29rIGZvciBkYXRhLXRlbXBsYXRlLW5hbWUgYXR0cmlidXRlLCB0
aGVuIGZhbGwgYmFjayB0byBpdHMKICAgICAgLy8gaWQgaWYgbm8gbmFtZSBpcyBmb3VuZC4KICAg
ICAgdGVtcGxhdGVOYW1lID0gc2NyaXB0LmF0dHIoJ2RhdGEtdGVtcGxhdGUtbmFtZScpIHx8IHNj
cmlwdC5hdHRyKCdpZCcpIHx8ICdhcHBsaWNhdGlvbicsCiAgICAgIHRlbXBsYXRlID0gY29tcGls
ZShzY3JpcHQuaHRtbCgpKTsKCiAgICAvLyBDaGVjayBpZiB0ZW1wbGF0ZSBvZiBzYW1lIG5hbWUg
YWxyZWFkeSBleGlzdHMKICAgIGlmIChFbWJlci5URU1QTEFURVNbdGVtcGxhdGVOYW1lXSAhPT0g
dW5kZWZpbmVkKSB7CiAgICAgIHRocm93IG5ldyBFbWJlci5FcnJvcignVGVtcGxhdGUgbmFtZWQg
IicgKyB0ZW1wbGF0ZU5hbWUgICsgJyIgYWxyZWFkeSBleGlzdHMuJyk7CiAgICB9CgogICAgLy8g
Rm9yIHRlbXBsYXRlcyB3aGljaCBoYXZlIGEgbmFtZSwgd2Ugc2F2ZSB0aGVtIGFuZCB0aGVuIHJl
bW92ZSB0aGVtIGZyb20gdGhlIERPTQogICAgRW1iZXIuVEVNUExBVEVTW3RlbXBsYXRlTmFtZV0g
PSB0ZW1wbGF0ZTsKCiAgICAvLyBSZW1vdmUgc2NyaXB0IHRhZyBmcm9tIERPTQogICAgc2NyaXB0
LnJlbW92ZSgpOwogIH0pOwp9OwoKZnVuY3Rpb24gYm9vdHN0cmFwKCkgewogIEVtYmVyLkhhbmRs
ZWJhcnMuYm9vdHN0cmFwKCBFbWJlci4kKGRvY3VtZW50KSApOwp9CgpmdW5jdGlvbiByZWdpc3Rl
ckNvbXBvbmVudExvb2t1cChjb250YWluZXIpIHsKICBjb250YWluZXIucmVnaXN0ZXIoJ2NvbXBv
bmVudC1sb29rdXA6bWFpbicsIEVtYmVyLkNvbXBvbmVudExvb2t1cCk7Cn0KCi8qCiAgV2UgdGll
IHRoaXMgdG8gYXBwbGljYXRpb24ubG9hZCB0byBlbnN1cmUgdGhhdCB3ZSd2ZSBhdCBsZWFzdAog
IGF0dGVtcHRlZCB0byBib290c3RyYXAgYXQgdGhlIHBvaW50IHRoYXQgdGhlIGFwcGxpY2F0aW9u
IGlzIGxvYWRlZC4KCiAgV2UgYWxzbyB0aWUgdGhpcyB0byBkb2N1bWVudCByZWFkeSBzaW5jZSB3
ZSdyZSBndWFyYW50ZWVkIHRoYXQgYWxsCiAgdGhlIGlubGluZSB0ZW1wbGF0ZXMgYXJlIHByZXNl
bnQgYXQgdGhpcyBwb2ludC4KCiAgVGhlcmUncyBubyBoYXJtIHRvIHJ1bm5pbmcgdGhpcyB0d2lj
ZSwgc2luY2Ugd2UgcmVtb3ZlIHRoZSB0ZW1wbGF0ZXMKICBmcm9tIHRoZSBET00gYWZ0ZXIgcHJv
Y2Vzc2luZy4KKi8KCkVtYmVyLm9uTG9hZCgnRW1iZXIuQXBwbGljYXRpb24nLCBmdW5jdGlvbihB
cHBsaWNhdGlvbikgewogIEFwcGxpY2F0aW9uLmluaXRpYWxpemVyKHsKICAgIG5hbWU6ICdkb21U
ZW1wbGF0ZXMnLAogICAgaW5pdGlhbGl6ZTogYm9vdHN0cmFwCiAgfSk7CgogIEFwcGxpY2F0aW9u
LmluaXRpYWxpemVyKHsKICAgIG5hbWU6ICdyZWdpc3RlckNvbXBvbmVudExvb2t1cCcsCiAgICBh
ZnRlcjogJ2RvbVRlbXBsYXRlcycsCiAgICBpbml0aWFsaXplOiByZWdpc3RlckNvbXBvbmVudExv
b2t1cAogIH0pOwp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkVtYmVyIEhhbmRsZWJh
cnMKCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1oYW5kbGViYXJzCkByZXF1aXJlcyBl
bWJlci12aWV3cwoqLwoKRW1iZXIucnVuTG9hZEhvb2tzKCdFbWJlci5IYW5kbGViYXJzJywgRW1i
ZXIuSGFuZGxlYmFycyk7Cgp9KSgpOwoKKGZ1bmN0aW9uKCkgewpkZWZpbmUoInJvdXRlLXJlY29n
bml6ZXIiLAogIFtdLAogIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHNw
ZWNpYWxzID0gWwogICAgICAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLAogICAgICAnKCcs
ICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnCiAgICBdOwoKICAgIHZhciBlc2NhcGVSZWdl
eCA9IG5ldyBSZWdFeHAoJyhcXCcgKyBzcGVjaWFscy5qb2luKCd8XFwnKSArICcpJywgJ2cnKTsK
CiAgICAvLyBBIFNlZ21lbnQgcmVwcmVzZW50cyBhIHNlZ21lbnQgaW4gdGhlIG9yaWdpbmFsIHJv
dXRlIGRlc2NyaXB0aW9uLgogICAgLy8gRWFjaCBTZWdtZW50IHR5cGUgcHJvdmlkZXMgYW4gYGVh
Y2hDaGFyYCBhbmQgYHJlZ2V4YCBtZXRob2QuCiAgICAvLwogICAgLy8gVGhlIGBlYWNoQ2hhcmAg
bWV0aG9kIGludm9rZXMgdGhlIGNhbGxiYWNrIHdpdGggb25lIG9yIG1vcmUgY2hhcmFjdGVyCiAg
ICAvLyBzcGVjaWZpY2F0aW9ucy4gQSBjaGFyYWN0ZXIgc3BlY2lmaWNhdGlvbiBjb25zdW1lcyBv
bmUgb3IgbW9yZSBpbnB1dAogICAgLy8gY2hhcmFjdGVycy4KICAgIC8vCiAgICAvLyBUaGUgYHJl
Z2V4YCBtZXRob2QgcmV0dXJucyBhIHJlZ2V4IGZyYWdtZW50IGZvciB0aGUgc2VnbWVudC4gSWYg
dGhlCiAgICAvLyBzZWdtZW50IGlzIGEgZHluYW1pYyBvZiBzdGFyIHNlZ21lbnQsIHRoZSByZWdl
eCBmcmFnbWVudCBhbHNvIGluY2x1ZGVzCiAgICAvLyBhIGNhcHR1cmUuCiAgICAvLwogICAgLy8g
QSBjaGFyYWN0ZXIgc3BlY2lmaWNhdGlvbiBjb250YWluczoKICAgIC8vCiAgICAvLyAqIGB2YWxp
ZENoYXJzYDogYSBTdHJpbmcgd2l0aCBhIGxpc3Qgb2YgYWxsIHZhbGlkIGNoYXJhY3RlcnMsIG9y
CiAgICAvLyAqIGBpbnZhbGlkQ2hhcnNgOiBhIFN0cmluZyB3aXRoIGEgbGlzdCBvZiBhbGwgaW52
YWxpZCBjaGFyYWN0ZXJzCiAgICAvLyAqIGByZXBlYXRgOiB0cnVlIGlmIHRoZSBjaGFyYWN0ZXIg
c3BlY2lmaWNhdGlvbiBjYW4gcmVwZWF0CgogICAgZnVuY3Rpb24gU3RhdGljU2VnbWVudChzdHJp
bmcpIHsgdGhpcy5zdHJpbmcgPSBzdHJpbmc7IH0KICAgIFN0YXRpY1NlZ21lbnQucHJvdG90eXBl
ID0gewogICAgICBlYWNoQ2hhcjogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgICB2YXIgc3Ry
aW5nID0gdGhpcy5zdHJpbmcsIGNoYXI7CgogICAgICAgIGZvciAodmFyIGk9MCwgbD1zdHJpbmcu
bGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgICAgY2hhciA9IHN0cmluZy5jaGFyQXQoaSk7CiAg
ICAgICAgICBjYWxsYmFjayh7IHZhbGlkQ2hhcnM6IGNoYXIgfSk7CiAgICAgICAgfQogICAgICB9
LAoKICAgICAgcmVnZXg6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnN0cmluZy5y
ZXBsYWNlKGVzY2FwZVJlZ2V4LCAnXFwkMScpOwogICAgICB9LAoKICAgICAgZ2VuZXJhdGU6IGZ1
bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnN0cmluZzsKICAgICAgfQogICAgfTsKCiAg
ICBmdW5jdGlvbiBEeW5hbWljU2VnbWVudChuYW1lKSB7IHRoaXMubmFtZSA9IG5hbWU7IH0KICAg
IER5bmFtaWNTZWdtZW50LnByb3RvdHlwZSA9IHsKICAgICAgZWFjaENoYXI6IGZ1bmN0aW9uKGNh
bGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soeyBpbnZhbGlkQ2hhcnM6ICIvIiwgcmVwZWF0OiB0
cnVlIH0pOwogICAgICB9LAoKICAgICAgcmVnZXg6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVy
biAiKFteL10rKSI7CiAgICAgIH0sCgogICAgICBnZW5lcmF0ZTogZnVuY3Rpb24ocGFyYW1zKSB7
CiAgICAgICAgcmV0dXJuIHBhcmFtc1t0aGlzLm5hbWVdOwogICAgICB9CiAgICB9OwoKICAgIGZ1
bmN0aW9uIFN0YXJTZWdtZW50KG5hbWUpIHsgdGhpcy5uYW1lID0gbmFtZTsgfQogICAgU3RhclNl
Z21lbnQucHJvdG90eXBlID0gewogICAgICBlYWNoQ2hhcjogZnVuY3Rpb24oY2FsbGJhY2spIHsK
ICAgICAgICBjYWxsYmFjayh7IGludmFsaWRDaGFyczogIiIsIHJlcGVhdDogdHJ1ZSB9KTsKICAg
ICAgfSwKCiAgICAgIHJlZ2V4OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gIiguKykiOwog
ICAgICB9LAoKICAgICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgIHJldHVy
biBwYXJhbXNbdGhpcy5uYW1lXTsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBFcHNpbG9u
U2VnbWVudCgpIHt9CiAgICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUgPSB7CiAgICAgIGVhY2hD
aGFyOiBmdW5jdGlvbigpIHt9LAogICAgICByZWdleDogZnVuY3Rpb24oKSB7IHJldHVybiAiIjsg
fSwKICAgICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gIiI7IH0KICAgIH07CgogICAg
ZnVuY3Rpb24gcGFyc2Uocm91dGUsIG5hbWVzLCB0eXBlcykgewogICAgICAvLyBub3JtYWxpemUg
cm91dGUgYXMgbm90IHN0YXJ0aW5nIHdpdGggYSAiLyIuIFJlY29nbml0aW9uIHdpbGwKICAgICAg
Ly8gYWxzbyBub3JtYWxpemUuCiAgICAgIGlmIChyb3V0ZS5jaGFyQXQoMCkgPT09ICIvIikgeyBy
b3V0ZSA9IHJvdXRlLnN1YnN0cigxKTsgfQoKICAgICAgdmFyIHNlZ21lbnRzID0gcm91dGUuc3Bs
aXQoIi8iKSwgcmVzdWx0cyA9IFtdOwoKICAgICAgZm9yICh2YXIgaT0wLCBsPXNlZ21lbnRzLmxl
bmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldLCBtYXRj
aDsKCiAgICAgICAgaWYgKG1hdGNoID0gc2VnbWVudC5tYXRjaCgvXjooW15cL10rKSQvKSkgewog
ICAgICAgICAgcmVzdWx0cy5wdXNoKG5ldyBEeW5hbWljU2VnbWVudChtYXRjaFsxXSkpOwogICAg
ICAgICAgbmFtZXMucHVzaChtYXRjaFsxXSk7CiAgICAgICAgICB0eXBlcy5keW5hbWljcysrOwog
ICAgICAgIH0gZWxzZSBpZiAobWF0Y2ggPSBzZWdtZW50Lm1hdGNoKC9eXCooW15cL10rKSQvKSkg
ewogICAgICAgICAgcmVzdWx0cy5wdXNoKG5ldyBTdGFyU2VnbWVudChtYXRjaFsxXSkpOwogICAg
ICAgICAgbmFtZXMucHVzaChtYXRjaFsxXSk7CiAgICAgICAgICB0eXBlcy5zdGFycysrOwogICAg
ICAgIH0gZWxzZSBpZihzZWdtZW50ID09PSAiIikgewogICAgICAgICAgcmVzdWx0cy5wdXNoKG5l
dyBFcHNpbG9uU2VnbWVudCgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0cy5w
dXNoKG5ldyBTdGF0aWNTZWdtZW50KHNlZ21lbnQpKTsKICAgICAgICAgIHR5cGVzLnN0YXRpY3Mr
KzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfQoKICAgIC8v
IEEgU3RhdGUgaGFzIGEgY2hhcmFjdGVyIHNwZWNpZmljYXRpb24gYW5kIChgY2hhclNwZWNgKSBh
bmQgYSBsaXN0IG9mIHBvc3NpYmxlCiAgICAvLyBzdWJzZXF1ZW50IHN0YXRlcyAoYG5leHRTdGF0
ZXNgKS4KICAgIC8vCiAgICAvLyBJZiBhIFN0YXRlIGlzIGFuIGFjY2VwdGluZyBzdGF0ZSwgaXQg
d2lsbCBhbHNvIGhhdmUgc2V2ZXJhbCBhZGRpdGlvbmFsCiAgICAvLyBwcm9wZXJ0aWVzOgogICAg
Ly8KICAgIC8vICogYHJlZ2V4YDogQSByZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBpcyB1c2VkIHRv
IGV4dHJhY3QgcGFyYW1ldGVycyBmcm9tIHBhdGhzCiAgICAvLyAgIHRoYXQgcmVhY2hlZCB0aGlz
IGFjY2VwdGluZyBzdGF0ZS4KICAgIC8vICogYGhhbmRsZXJzYDogSW5mb3JtYXRpb24gb24gaG93
IHRvIGNvbnZlcnQgdGhlIGxpc3Qgb2YgY2FwdHVyZXMgaW50byBjYWxscwogICAgLy8gICB0byBy
ZWdpc3RlcmVkIGhhbmRsZXJzIHdpdGggdGhlIHNwZWNpZmllZCBwYXJhbWV0ZXJzCiAgICAvLyAq
IGB0eXBlc2A6IEhvdyBtYW55IHN0YXRpYywgZHluYW1pYyBvciBzdGFyIHNlZ21lbnRzIGluIHRo
aXMgcm91dGUuIFVzZWQgdG8KICAgIC8vICAgZGVjaWRlIHdoaWNoIHJvdXRlIHRvIHVzZSBpZiBt
dWx0aXBsZSByZWdpc3RlcmVkIHJvdXRlcyBtYXRjaCBhIHBhdGguCiAgICAvLwogICAgLy8gQ3Vy
cmVudGx5LCBTdGF0ZSBpcyBpbXBsZW1lbnRlZCBuYWl2ZWx5IGJ5IGxvb3Bpbmcgb3ZlciBgbmV4
dFN0YXRlc2AgYW5kCiAgICAvLyBjb21wYXJpbmcgYSBjaGFyYWN0ZXIgc3BlY2lmaWNhdGlvbiBh
Z2FpbnN0IGEgY2hhcmFjdGVyLiBBIG1vcmUgZWZmaWNpZW50CiAgICAvLyBpbXBsZW1lbnRhdGlv
biB3b3VsZCB1c2UgYSBoYXNoIG9mIGtleXMgcG9pbnRpbmcgYXQgb25lIG9yIG1vcmUgbmV4dCBz
dGF0ZXMuCgogICAgZnVuY3Rpb24gU3RhdGUoY2hhclNwZWMpIHsKICAgICAgdGhpcy5jaGFyU3Bl
YyA9IGNoYXJTcGVjOwogICAgICB0aGlzLm5leHRTdGF0ZXMgPSBbXTsKICAgIH0KCiAgICBTdGF0
ZS5wcm90b3R5cGUgPSB7CiAgICAgIGdldDogZnVuY3Rpb24oY2hhclNwZWMpIHsKICAgICAgICB2
YXIgbmV4dFN0YXRlcyA9IHRoaXMubmV4dFN0YXRlczsKCiAgICAgICAgZm9yICh2YXIgaT0wLCBs
PW5leHRTdGF0ZXMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgICAgdmFyIGNoaWxkID0gbmV4
dFN0YXRlc1tpXTsKCiAgICAgICAgICB2YXIgaXNFcXVhbCA9IGNoaWxkLmNoYXJTcGVjLnZhbGlk
Q2hhcnMgPT09IGNoYXJTcGVjLnZhbGlkQ2hhcnM7CiAgICAgICAgICBpc0VxdWFsID0gaXNFcXVh
bCAmJiBjaGlsZC5jaGFyU3BlYy5pbnZhbGlkQ2hhcnMgPT09IGNoYXJTcGVjLmludmFsaWRDaGFy
czsKCiAgICAgICAgICBpZiAoaXNFcXVhbCkgeyByZXR1cm4gY2hpbGQ7IH0KICAgICAgICB9CiAg
ICAgIH0sCgogICAgICBwdXQ6IGZ1bmN0aW9uKGNoYXJTcGVjKSB7CiAgICAgICAgdmFyIHN0YXRl
OwoKICAgICAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIHNwZWNpZmljYXRpb24gYWxyZWFkeSBleGlz
dHMgaW4gYSBjaGlsZCBvZiB0aGUgY3VycmVudAogICAgICAgIC8vIHN0YXRlLCBqdXN0IHJldHVy
biB0aGF0IHN0YXRlLgogICAgICAgIGlmIChzdGF0ZSA9IHRoaXMuZ2V0KGNoYXJTcGVjKSkgeyBy
ZXR1cm4gc3RhdGU7IH0KCiAgICAgICAgLy8gTWFrZSBhIG5ldyBzdGF0ZSBmb3IgdGhlIGNoYXJh
Y3RlciBzcGVjCiAgICAgICAgc3RhdGUgPSBuZXcgU3RhdGUoY2hhclNwZWMpOwoKICAgICAgICAv
LyBJbnNlcnQgdGhlIG5ldyBzdGF0ZSBhcyBhIGNoaWxkIG9mIHRoZSBjdXJyZW50IHN0YXRlCiAg
ICAgICAgdGhpcy5uZXh0U3RhdGVzLnB1c2goc3RhdGUpOwoKICAgICAgICAvLyBJZiB0aGlzIGNo
YXJhY3RlciBzcGVjaWZpY2F0aW9uIHJlcGVhdHMsIGluc2VydCB0aGUgbmV3IHN0YXRlIGFzIGEg
Y2hpbGQKICAgICAgICAvLyBvZiBpdHNlbGYuIE5vdGUgdGhhdCB0aGlzIHdpbGwgbm90IHRyaWdn
ZXIgYW4gaW5maW5pdGUgbG9vcCBiZWNhdXNlIGVhY2gKICAgICAgICAvLyB0cmFuc2l0aW9uIGR1
cmluZyByZWNvZ25pdGlvbiBjb25zdW1lcyBhIGNoYXJhY3Rlci4KICAgICAgICBpZiAoY2hhclNw
ZWMucmVwZWF0KSB7CiAgICAgICAgICBzdGF0ZS5uZXh0U3RhdGVzLnB1c2goc3RhdGUpOwogICAg
ICAgIH0KCiAgICAgICAgLy8gUmV0dXJuIHRoZSBuZXcgc3RhdGUKICAgICAgICByZXR1cm4gc3Rh
dGU7CiAgICAgIH0sCgogICAgICAvLyBGaW5kIGEgbGlzdCBvZiBjaGlsZCBzdGF0ZXMgbWF0Y2hp
bmcgdGhlIG5leHQgY2hhcmFjdGVyCiAgICAgIG1hdGNoOiBmdW5jdGlvbihjaGFyKSB7CiAgICAg
ICAgLy8gREVCVUcgIlByb2Nlc3NpbmcgYCIgKyBjaGFyICsgImA6IgogICAgICAgIHZhciBuZXh0
U3RhdGVzID0gdGhpcy5uZXh0U3RhdGVzLAogICAgICAgICAgICBjaGlsZCwgY2hhclNwZWMsIGNo
YXJzOwoKICAgICAgICAvLyBERUJVRyAiICAiICsgZGVidWdTdGF0ZSh0aGlzKQogICAgICAgIHZh
ciByZXR1cm5lZCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpPTAsIGw9bmV4dFN0YXRlcy5sZW5n
dGg7IGk8bDsgaSsrKSB7CiAgICAgICAgICBjaGlsZCA9IG5leHRTdGF0ZXNbaV07CgogICAgICAg
ICAgY2hhclNwZWMgPSBjaGlsZC5jaGFyU3BlYzsKCiAgICAgICAgICBpZiAodHlwZW9mIChjaGFy
cyA9IGNoYXJTcGVjLnZhbGlkQ2hhcnMpICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBp
ZiAoY2hhcnMuaW5kZXhPZihjaGFyKSAhPT0gLTEpIHsgcmV0dXJuZWQucHVzaChjaGlsZCk7IH0K
ICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIChjaGFycyA9IGNoYXJTcGVjLmludmFsaWRDaGFy
cykgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGlmIChjaGFycy5pbmRleE9mKGNoYXIp
ID09PSAtMSkgeyByZXR1cm5lZC5wdXNoKGNoaWxkKTsgfQogICAgICAgICAgfQogICAgICAgIH0K
CiAgICAgICAgcmV0dXJuIHJldHVybmVkOwogICAgICB9CgogICAgICAvKiogSUYgREVCVUcKICAg
ICAgLCBkZWJ1ZzogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGNoYXJTcGVjID0gdGhpcy5jaGFy
U3BlYywKICAgICAgICAgICAgZGVidWcgPSAiWyIsCiAgICAgICAgICAgIGNoYXJzID0gY2hhclNw
ZWMudmFsaWRDaGFycyB8fCBjaGFyU3BlYy5pbnZhbGlkQ2hhcnM7CgogICAgICAgIGlmIChjaGFy
U3BlYy5pbnZhbGlkQ2hhcnMpIHsgZGVidWcgKz0gIl4iOyB9CiAgICAgICAgZGVidWcgKz0gY2hh
cnM7CiAgICAgICAgZGVidWcgKz0gIl0iOwoKICAgICAgICBpZiAoY2hhclNwZWMucmVwZWF0KSB7
IGRlYnVnICs9ICIrIjsgfQoKICAgICAgICByZXR1cm4gZGVidWc7CiAgICAgIH0KICAgICAgRU5E
IElGICoqLwogICAgfTsKCiAgICAvKiogSUYgREVCVUcKICAgIGZ1bmN0aW9uIGRlYnVnKGxvZykg
ewogICAgICBjb25zb2xlLmxvZyhsb2cpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlYnVnU3RhdGUo
c3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLm5leHRTdGF0ZXMubWFwKGZ1bmN0aW9uKG4pIHsK
ICAgICAgICBpZiAobi5uZXh0U3RhdGVzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gIiggIiArIG4u
ZGVidWcoKSArICIgW2FjY2VwdGluZ10gKSI7IH0KICAgICAgICByZXR1cm4gIiggIiArIG4uZGVi
dWcoKSArICIgPHRoZW4+ICIgKyBuLm5leHRTdGF0ZXMubWFwKGZ1bmN0aW9uKHMpIHsgcmV0dXJu
IHMuZGVidWcoKSB9KS5qb2luKCIgb3IgIikgKyAiICkiOwogICAgICB9KS5qb2luKCIsICIpCiAg
ICB9CiAgICBFTkQgSUYgKiovCgogICAgLy8gVGhpcyBpcyBhIHNvbWV3aGF0IG5haXZlIHN0cmF0
ZWd5LCBidXQgc2hvdWxkIHdvcmsgaW4gYSBsb3Qgb2YgY2FzZXMKICAgIC8vIEEgYmV0dGVyIHN0
cmF0ZWd5IHdvdWxkIHByb3Blcmx5IHJlc29sdmUgL3Bvc3RzLzppZC9uZXcgYW5kIC9wb3N0cy9l
ZGl0LzppZAogICAgZnVuY3Rpb24gc29ydFNvbHV0aW9ucyhzdGF0ZXMpIHsKICAgICAgcmV0dXJu
IHN0YXRlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBpZiAoYS50eXBlcy5zdGFycyAh
PT0gYi50eXBlcy5zdGFycykgeyByZXR1cm4gYS50eXBlcy5zdGFycyAtIGIudHlwZXMuc3RhcnM7
IH0KICAgICAgICBpZiAoYS50eXBlcy5keW5hbWljcyAhPT0gYi50eXBlcy5keW5hbWljcykgeyBy
ZXR1cm4gYS50eXBlcy5keW5hbWljcyAtIGIudHlwZXMuZHluYW1pY3M7IH0KICAgICAgICBpZiAo
YS50eXBlcy5zdGF0aWNzICE9PSBiLnR5cGVzLnN0YXRpY3MpIHsgcmV0dXJuIGIudHlwZXMuc3Rh
dGljcyAtIGEudHlwZXMuc3RhdGljczsgfQoKICAgICAgICByZXR1cm4gMDsKICAgICAgfSk7CiAg
ICB9CgogICAgZnVuY3Rpb24gcmVjb2duaXplQ2hhcihzdGF0ZXMsIGNoYXIpIHsKICAgICAgdmFy
IG5leHRTdGF0ZXMgPSBbXTsKCiAgICAgIGZvciAodmFyIGk9MCwgbD1zdGF0ZXMubGVuZ3RoOyBp
PGw7IGkrKykgewogICAgICAgIHZhciBzdGF0ZSA9IHN0YXRlc1tpXTsKCiAgICAgICAgbmV4dFN0
YXRlcyA9IG5leHRTdGF0ZXMuY29uY2F0KHN0YXRlLm1hdGNoKGNoYXIpKTsKICAgICAgfQoKICAg
ICAgcmV0dXJuIG5leHRTdGF0ZXM7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEhhbmRsZXIoc3Rh
dGUsIHBhdGgsIHF1ZXJ5UGFyYW1zKSB7CiAgICAgIHZhciBoYW5kbGVycyA9IHN0YXRlLmhhbmRs
ZXJzLCByZWdleCA9IHN0YXRlLnJlZ2V4OwogICAgICB2YXIgY2FwdHVyZXMgPSBwYXRoLm1hdGNo
KHJlZ2V4KSwgY3VycmVudENhcHR1cmUgPSAxOwogICAgICB2YXIgcmVzdWx0ID0gW107CgogICAg
ICBmb3IgKHZhciBpPTAsIGw9aGFuZGxlcnMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIHZh
ciBoYW5kbGVyID0gaGFuZGxlcnNbaV0sIG5hbWVzID0gaGFuZGxlci5uYW1lcywgcGFyYW1zID0g
e30sCiAgICAgICAgICB3YXRjaGVkUXVlcnlQYXJhbXMgPSBoYW5kbGVyLnF1ZXJ5UGFyYW1zIHx8
IFtdLAogICAgICAgICAgYWN0aXZlUXVlcnlQYXJhbXMgPSB7fSwKICAgICAgICAgIGosIG07Cgog
ICAgICAgIGZvciAoaj0wLCBtPW5hbWVzLmxlbmd0aDsgajxtOyBqKyspIHsKICAgICAgICAgIHBh
cmFtc1tuYW1lc1tqXV0gPSBjYXB0dXJlc1tjdXJyZW50Q2FwdHVyZSsrXTsKICAgICAgICB9CiAg
ICAgICAgZm9yIChqPTAsIG09d2F0Y2hlZFF1ZXJ5UGFyYW1zLmxlbmd0aDsgaiA8IG07IGorKykg
ewogICAgICAgICAgdmFyIGtleSA9IHdhdGNoZWRRdWVyeVBhcmFtc1tqXTsKICAgICAgICAgIGlm
KHF1ZXJ5UGFyYW1zW2tleV0pewogICAgICAgICAgICBhY3RpdmVRdWVyeVBhcmFtc1trZXldID0g
cXVlcnlQYXJhbXNba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIGN1cnJl
bnRSZXN1bHQgPSB7IGhhbmRsZXI6IGhhbmRsZXIuaGFuZGxlciwgcGFyYW1zOiBwYXJhbXMsIGlz
RHluYW1pYzogISFuYW1lcy5sZW5ndGggfTsKICAgICAgICBpZih3YXRjaGVkUXVlcnlQYXJhbXMg
JiYgd2F0Y2hlZFF1ZXJ5UGFyYW1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGN1cnJlbnRSZXN1
bHQucXVlcnlQYXJhbXMgPSBhY3RpdmVRdWVyeVBhcmFtczsKICAgICAgICB9CiAgICAgICAgcmVz
dWx0LnB1c2goY3VycmVudFJlc3VsdCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAg
ICB9CgogICAgZnVuY3Rpb24gYWRkU2VnbWVudChjdXJyZW50U3RhdGUsIHNlZ21lbnQpIHsKICAg
ICAgc2VnbWVudC5lYWNoQ2hhcihmdW5jdGlvbihjaGFyKSB7CiAgICAgICAgdmFyIHN0YXRlOwoK
ICAgICAgICBjdXJyZW50U3RhdGUgPSBjdXJyZW50U3RhdGUucHV0KGNoYXIpOwogICAgICB9KTsK
CiAgICAgIHJldHVybiBjdXJyZW50U3RhdGU7CiAgICB9CgogICAgLy8gVGhlIG1haW4gaW50ZXJm
YWNlCgogICAgdmFyIFJvdXRlUmVjb2duaXplciA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJv
b3RTdGF0ZSA9IG5ldyBTdGF0ZSgpOwogICAgICB0aGlzLm5hbWVzID0ge307CiAgICB9OwoKCiAg
ICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlID0gewogICAgICBhZGQ6IGZ1bmN0aW9uKHJvdXRl
cywgb3B0aW9ucykgewogICAgICAgIHZhciBjdXJyZW50U3RhdGUgPSB0aGlzLnJvb3RTdGF0ZSwg
cmVnZXggPSAiXiIsCiAgICAgICAgICAgIHR5cGVzID0geyBzdGF0aWNzOiAwLCBkeW5hbWljczog
MCwgc3RhcnM6IDAgfSwKICAgICAgICAgICAgaGFuZGxlcnMgPSBbXSwgYWxsU2VnbWVudHMgPSBb
XSwgbmFtZTsKCiAgICAgICAgdmFyIGlzRW1wdHkgPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBp
PTAsIGw9cm91dGVzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICAgIHZhciByb3V0ZSA9IHJv
dXRlc1tpXSwgbmFtZXMgPSBbXTsKCiAgICAgICAgICB2YXIgc2VnbWVudHMgPSBwYXJzZShyb3V0
ZS5wYXRoLCBuYW1lcywgdHlwZXMpOwoKICAgICAgICAgIGFsbFNlZ21lbnRzID0gYWxsU2VnbWVu
dHMuY29uY2F0KHNlZ21lbnRzKTsKCiAgICAgICAgICBmb3IgKHZhciBqPTAsIG09c2VnbWVudHMu
bGVuZ3RoOyBqPG07IGorKykgewogICAgICAgICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2pd
OwoKICAgICAgICAgICAgaWYgKHNlZ21lbnQgaW5zdGFuY2VvZiBFcHNpbG9uU2VnbWVudCkgeyBj
b250aW51ZTsgfQoKICAgICAgICAgICAgaXNFbXB0eSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8g
QWRkIGEgIi8iIGZvciB0aGUgbmV3IHNlZ21lbnQKICAgICAgICAgICAgY3VycmVudFN0YXRlID0g
Y3VycmVudFN0YXRlLnB1dCh7IHZhbGlkQ2hhcnM6ICIvIiB9KTsKICAgICAgICAgICAgcmVnZXgg
Kz0gIi8iOwoKICAgICAgICAgICAgLy8gQWRkIGEgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNlZ21l
bnQgdG8gdGhlIE5GQSBhbmQgcmVnZXgKICAgICAgICAgICAgY3VycmVudFN0YXRlID0gYWRkU2Vn
bWVudChjdXJyZW50U3RhdGUsIHNlZ21lbnQpOwogICAgICAgICAgICByZWdleCArPSBzZWdtZW50
LnJlZ2V4KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGhhbmRsZXIgPSB7IGhhbmRsZXI6
IHJvdXRlLmhhbmRsZXIsIG5hbWVzOiBuYW1lcyB9OwogICAgICAgICAgaWYocm91dGUucXVlcnlQ
YXJhbXMpIHsKICAgICAgICAgICAgaGFuZGxlci5xdWVyeVBhcmFtcyA9IHJvdXRlLnF1ZXJ5UGFy
YW1zOwogICAgICAgICAgfQogICAgICAgICAgaGFuZGxlcnMucHVzaChoYW5kbGVyKTsKICAgICAg
ICB9CgogICAgICAgIGlmIChpc0VtcHR5KSB7CiAgICAgICAgICBjdXJyZW50U3RhdGUgPSBjdXJy
ZW50U3RhdGUucHV0KHsgdmFsaWRDaGFyczogIi8iIH0pOwogICAgICAgICAgcmVnZXggKz0gIi8i
OwogICAgICAgIH0KCiAgICAgICAgY3VycmVudFN0YXRlLmhhbmRsZXJzID0gaGFuZGxlcnM7CiAg
ICAgICAgY3VycmVudFN0YXRlLnJlZ2V4ID0gbmV3IFJlZ0V4cChyZWdleCArICIkIik7CiAgICAg
ICAgY3VycmVudFN0YXRlLnR5cGVzID0gdHlwZXM7CgogICAgICAgIGlmIChuYW1lID0gb3B0aW9u
cyAmJiBvcHRpb25zLmFzKSB7CiAgICAgICAgICB0aGlzLm5hbWVzW25hbWVdID0gewogICAgICAg
ICAgICBzZWdtZW50czogYWxsU2VnbWVudHMsCiAgICAgICAgICAgIGhhbmRsZXJzOiBoYW5kbGVy
cwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBoYW5kbGVyc0ZvcjogZnVu
Y3Rpb24obmFtZSkgewogICAgICAgIHZhciByb3V0ZSA9IHRoaXMubmFtZXNbbmFtZV0sIHJlc3Vs
dCA9IFtdOwogICAgICAgIGlmICghcm91dGUpIHsgdGhyb3cgbmV3IEVycm9yKCJUaGVyZSBpcyBu
byByb3V0ZSBuYW1lZCAiICsgbmFtZSk7IH0KCiAgICAgICAgZm9yICh2YXIgaT0wLCBsPXJvdXRl
LmhhbmRsZXJzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKHJvdXRl
LmhhbmRsZXJzW2ldKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0s
CgogICAgICBoYXNSb3V0ZTogZnVuY3Rpb24obmFtZSkgewogICAgICAgIHJldHVybiAhIXRoaXMu
bmFtZXNbbmFtZV07CiAgICAgIH0sCgogICAgICBnZW5lcmF0ZTogZnVuY3Rpb24obmFtZSwgcGFy
YW1zKSB7CiAgICAgICAgdmFyIHJvdXRlID0gdGhpcy5uYW1lc1tuYW1lXSwgb3V0cHV0ID0gIiI7
CiAgICAgICAgaWYgKCFyb3V0ZSkgeyB0aHJvdyBuZXcgRXJyb3IoIlRoZXJlIGlzIG5vIHJvdXRl
IG5hbWVkICIgKyBuYW1lKTsgfQoKICAgICAgICB2YXIgc2VnbWVudHMgPSByb3V0ZS5zZWdtZW50
czsKCiAgICAgICAgZm9yICh2YXIgaT0wLCBsPXNlZ21lbnRzLmxlbmd0aDsgaTxsOyBpKyspIHsK
ICAgICAgICAgIHZhciBzZWdtZW50ID0gc2VnbWVudHNbaV07CgogICAgICAgICAgaWYgKHNlZ21l
bnQgaW5zdGFuY2VvZiBFcHNpbG9uU2VnbWVudCkgeyBjb250aW51ZTsgfQoKICAgICAgICAgIG91
dHB1dCArPSAiLyI7CiAgICAgICAgICBvdXRwdXQgKz0gc2VnbWVudC5nZW5lcmF0ZShwYXJhbXMp
OwogICAgICAgIH0KCiAgICAgICAgaWYgKG91dHB1dC5jaGFyQXQoMCkgIT09ICcvJykgeyBvdXRw
dXQgPSAnLycgKyBvdXRwdXQ7IH0KCiAgICAgICAgaWYgKHBhcmFtcyAmJiBwYXJhbXMucXVlcnlQ
YXJhbXMpIHsKICAgICAgICAgIG91dHB1dCArPSB0aGlzLmdlbmVyYXRlUXVlcnlTdHJpbmcocGFy
YW1zLnF1ZXJ5UGFyYW1zLCByb3V0ZS5oYW5kbGVycyk7CiAgICAgICAgfQoKICAgICAgICByZXR1
cm4gb3V0cHV0OwogICAgICB9LAoKICAgICAgZ2VuZXJhdGVRdWVyeVN0cmluZzogZnVuY3Rpb24o
cGFyYW1zLCBoYW5kbGVycykgewogICAgICAgIHZhciBwYWlycyA9IFtdLCBhbGxvd2VkUGFyYW1z
ID0gW107CiAgICAgICAgZm9yKHZhciBpPTA7IGkgPCBoYW5kbGVycy5sZW5ndGg7IGkrKykgewog
ICAgICAgICAgdmFyIGN1cnJlbnRQYXJhbUxpc3QgPSBoYW5kbGVyc1tpXS5xdWVyeVBhcmFtczsK
ICAgICAgICAgIGlmKGN1cnJlbnRQYXJhbUxpc3QpIHsKICAgICAgICAgICAgYWxsb3dlZFBhcmFt
cy5wdXNoLmFwcGx5KGFsbG93ZWRQYXJhbXMsIGN1cnJlbnRQYXJhbUxpc3QpOwogICAgICAgICAg
fQogICAgICAgIH0KICAgICAgICBmb3IodmFyIGtleSBpbiBwYXJhbXMpIHsKICAgICAgICAgIGlm
IChwYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICBpZihhbGxvd2VkUGFy
YW1zLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgICB0aHJvdyAnUXVlcnkgcGFy
YW0gIicgKyBrZXkgKyAnIiBpcyBub3Qgc3BlY2lmaWVkIGFzIGEgdmFsaWQgcGFyYW0gZm9yIHRo
aXMgcm91dGUnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcmFtc1tr
ZXldOwogICAgICAgICAgICB2YXIgcGFpciA9IGVuY29kZVVSSUNvbXBvbmVudChrZXkpOwogICAg
ICAgICAgICBpZih2YWx1ZSAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgIHBhaXIgKz0gIj0iICsg
ZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYWly
cy5wdXNoKHBhaXIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBhaXJzLmxl
bmd0aCA9PT0gMCkgeyByZXR1cm4gJyc7IH0KCiAgICAgICAgcmV0dXJuICI/IiArIHBhaXJzLmpv
aW4oIiYiKTsKICAgICAgfSwKCiAgICAgIHBhcnNlUXVlcnlTdHJpbmc6IGZ1bmN0aW9uKHF1ZXJ5
U3RyaW5nKSB7CiAgICAgICAgdmFyIHBhaXJzID0gcXVlcnlTdHJpbmcuc3BsaXQoIiYiKSwgcXVl
cnlQYXJhbXMgPSB7fTsKICAgICAgICBmb3IodmFyIGk9MDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsr
KSB7CiAgICAgICAgICB2YXIgcGFpciAgICAgID0gcGFpcnNbaV0uc3BsaXQoJz0nKSwKICAgICAg
ICAgICAgICBrZXkgICAgICAgPSBkZWNvZGVVUklDb21wb25lbnQocGFpclswXSksCiAgICAgICAg
ICAgICAgdmFsdWUgICAgID0gcGFpclsxXSA/IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzFdKSA6
IHRydWU7CiAgICAgICAgICBxdWVyeVBhcmFtc1trZXldID0gdmFsdWU7CiAgICAgICAgfQogICAg
ICAgIHJldHVybiBxdWVyeVBhcmFtczsKICAgICAgfSwKCiAgICAgIHJlY29nbml6ZTogZnVuY3Rp
b24ocGF0aCkgewogICAgICAgIHZhciBzdGF0ZXMgPSBbIHRoaXMucm9vdFN0YXRlIF0sCiAgICAg
ICAgICAgIHBhdGhMZW4sIGksIGwsIHF1ZXJ5U3RhcnQsIHF1ZXJ5UGFyYW1zID0ge307CgogICAg
ICAgIHF1ZXJ5U3RhcnQgPSBwYXRoLmluZGV4T2YoJz8nKTsKICAgICAgICBpZiAocXVlcnlTdGFy
dCAhPT0gLTEpIHsKICAgICAgICAgIHZhciBxdWVyeVN0cmluZyA9IHBhdGguc3Vic3RyKHF1ZXJ5
U3RhcnQgKyAxLCBwYXRoLmxlbmd0aCk7CiAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwg
cXVlcnlTdGFydCk7CiAgICAgICAgICBxdWVyeVBhcmFtcyA9IHRoaXMucGFyc2VRdWVyeVN0cmlu
ZyhxdWVyeVN0cmluZyk7CiAgICAgICAgfQoKICAgICAgICAvLyBERUJVRyBHUk9VUCBwYXRoCgog
ICAgICAgIGlmIChwYXRoLmNoYXJBdCgwKSAhPT0gIi8iKSB7IHBhdGggPSAiLyIgKyBwYXRoOyB9
CgogICAgICAgIHBhdGhMZW4gPSBwYXRoLmxlbmd0aDsKICAgICAgICBpZiAocGF0aExlbiA+IDEg
JiYgcGF0aC5jaGFyQXQocGF0aExlbiAtIDEpID09PSAiLyIpIHsKICAgICAgICAgIHBhdGggPSBw
YXRoLnN1YnN0cigwLCBwYXRoTGVuIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGk9MCwg
bD1wYXRoLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICAgIHN0YXRlcyA9IHJlY29nbml6ZUNo
YXIoc3RhdGVzLCBwYXRoLmNoYXJBdChpKSk7CiAgICAgICAgICBpZiAoIXN0YXRlcy5sZW5ndGgp
IHsgYnJlYWs7IH0KICAgICAgICB9CgogICAgICAgIC8vIEVORCBERUJVRyBHUk9VUAoKICAgICAg
ICB2YXIgc29sdXRpb25zID0gW107CiAgICAgICAgZm9yIChpPTAsIGw9c3RhdGVzLmxlbmd0aDsg
aTxsOyBpKyspIHsKICAgICAgICAgIGlmIChzdGF0ZXNbaV0uaGFuZGxlcnMpIHsgc29sdXRpb25z
LnB1c2goc3RhdGVzW2ldKTsgfQogICAgICAgIH0KCiAgICAgICAgc3RhdGVzID0gc29ydFNvbHV0
aW9ucyhzb2x1dGlvbnMpOwoKICAgICAgICB2YXIgc3RhdGUgPSBzb2x1dGlvbnNbMF07CgogICAg
ICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5oYW5kbGVycykgewogICAgICAgICAgcmV0dXJuIGZpbmRI
YW5kbGVyKHN0YXRlLCBwYXRoLCBxdWVyeVBhcmFtcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9
OwoKICAgIGZ1bmN0aW9uIFRhcmdldChwYXRoLCBtYXRjaGVyLCBkZWxlZ2F0ZSkgewogICAgICB0
aGlzLnBhdGggPSBwYXRoOwogICAgICB0aGlzLm1hdGNoZXIgPSBtYXRjaGVyOwogICAgICB0aGlz
LmRlbGVnYXRlID0gZGVsZWdhdGU7CiAgICB9CgogICAgVGFyZ2V0LnByb3RvdHlwZSA9IHsKICAg
ICAgdG86IGZ1bmN0aW9uKHRhcmdldCwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgZGVsZWdhdGUg
PSB0aGlzLmRlbGVnYXRlOwoKICAgICAgICBpZiAoZGVsZWdhdGUgJiYgZGVsZWdhdGUud2lsbEFk
ZFJvdXRlKSB7CiAgICAgICAgICB0YXJnZXQgPSBkZWxlZ2F0ZS53aWxsQWRkUm91dGUodGhpcy5t
YXRjaGVyLnRhcmdldCwgdGFyZ2V0KTsKICAgICAgICB9CgogICAgICAgIHRoaXMubWF0Y2hlci5h
ZGQodGhpcy5wYXRoLCB0YXJnZXQpOwoKICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAg
IGlmIChjYWxsYmFjay5sZW5ndGggPT09IDApIHsgdGhyb3cgbmV3IEVycm9yKCJZb3UgbXVzdCBo
YXZlIGFuIGFyZ3VtZW50IGluIHRoZSBmdW5jdGlvbiBwYXNzZWQgdG8gYHRvYCIpOyB9CiAgICAg
ICAgICB0aGlzLm1hdGNoZXIuYWRkQ2hpbGQodGhpcy5wYXRoLCB0YXJnZXQsIGNhbGxiYWNrLCB0
aGlzLmRlbGVnYXRlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCgog
ICAgICB3aXRoUXVlcnlQYXJhbXM6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChhcmd1bWVudHMu
bGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcigieW91IG11c3QgcHJvdmlkZSBhcmd1bWVu
dHMgdG8gdGhlIHdpdGhRdWVyeVBhcmFtcyBtZXRob2QiKTsgfQogICAgICAgIGZvciAodmFyIGkg
PSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGFy
Z3VtZW50c1tpXSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd5
b3Ugc2hvdWxkIGNhbGwgd2l0aFF1ZXJ5UGFyYW1zIHdpdGggYSBsaXN0IG9mIHN0cmluZ3MsIGUu
Zy4gd2l0aFF1ZXJ5UGFyYW1zKCJmb28iLCAiYmFyIiknKTsKICAgICAgICAgIH0KICAgICAgICB9
CiAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAg
ICAgIHRoaXMubWF0Y2hlci5hZGRRdWVyeVBhcmFtcyh0aGlzLnBhdGgsIHF1ZXJ5UGFyYW1zKTsK
ICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBNYXRjaGVyKHRhcmdldCkgewogICAgICB0aGlz
LnJvdXRlcyA9IHt9OwogICAgICB0aGlzLmNoaWxkcmVuID0ge307CiAgICAgIHRoaXMucXVlcnlQ
YXJhbXMgPSB7fTsKICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICB9CgogICAgTWF0Y2hl
ci5wcm90b3R5cGUgPSB7CiAgICAgIGFkZDogZnVuY3Rpb24ocGF0aCwgaGFuZGxlcikgewogICAg
ICAgIHRoaXMucm91dGVzW3BhdGhdID0gaGFuZGxlcjsKICAgICAgfSwKCiAgICAgIGFkZFF1ZXJ5
UGFyYW1zOiBmdW5jdGlvbihwYXRoLCBwYXJhbXMpIHsKICAgICAgICB0aGlzLnF1ZXJ5UGFyYW1z
W3BhdGhdID0gcGFyYW1zOwogICAgICB9LAoKICAgICAgYWRkQ2hpbGQ6IGZ1bmN0aW9uKHBhdGgs
IHRhcmdldCwgY2FsbGJhY2ssIGRlbGVnYXRlKSB7CiAgICAgICAgdmFyIG1hdGNoZXIgPSBuZXcg
TWF0Y2hlcih0YXJnZXQpOwogICAgICAgIHRoaXMuY2hpbGRyZW5bcGF0aF0gPSBtYXRjaGVyOwoK
ICAgICAgICB2YXIgbWF0Y2ggPSBnZW5lcmF0ZU1hdGNoKHBhdGgsIG1hdGNoZXIsIGRlbGVnYXRl
KTsKCiAgICAgICAgaWYgKGRlbGVnYXRlICYmIGRlbGVnYXRlLmNvbnRleHRFbnRlcmVkKSB7CiAg
ICAgICAgICBkZWxlZ2F0ZS5jb250ZXh0RW50ZXJlZCh0YXJnZXQsIG1hdGNoKTsKICAgICAgICB9
CgogICAgICAgIGNhbGxiYWNrKG1hdGNoKTsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBn
ZW5lcmF0ZU1hdGNoKHN0YXJ0aW5nUGF0aCwgbWF0Y2hlciwgZGVsZWdhdGUpIHsKICAgICAgcmV0
dXJuIGZ1bmN0aW9uKHBhdGgsIG5lc3RlZENhbGxiYWNrKSB7CiAgICAgICAgdmFyIGZ1bGxQYXRo
ID0gc3RhcnRpbmdQYXRoICsgcGF0aDsKCiAgICAgICAgaWYgKG5lc3RlZENhbGxiYWNrKSB7CiAg
ICAgICAgICBuZXN0ZWRDYWxsYmFjayhnZW5lcmF0ZU1hdGNoKGZ1bGxQYXRoLCBtYXRjaGVyLCBk
ZWxlZ2F0ZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChz
dGFydGluZ1BhdGggKyBwYXRoLCBtYXRjaGVyLCBkZWxlZ2F0ZSk7CiAgICAgICAgfQogICAgICB9
OwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFJvdXRlKHJvdXRlQXJyYXksIHBhdGgsIGhhbmRsZXIs
IHF1ZXJ5UGFyYW1zKSB7CiAgICAgIHZhciBsZW4gPSAwOwogICAgICBmb3IgKHZhciBpPTAsIGw9
cm91dGVBcnJheS5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgbGVuICs9IHJvdXRlQXJyYXlb
aV0ucGF0aC5sZW5ndGg7CiAgICAgIH0KCiAgICAgIHBhdGggPSBwYXRoLnN1YnN0cihsZW4pOwog
ICAgICB2YXIgcm91dGUgPSB7IHBhdGg6IHBhdGgsIGhhbmRsZXI6IGhhbmRsZXIgfTsKICAgICAg
aWYocXVlcnlQYXJhbXMpIHsgcm91dGUucXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtczsgfQogICAg
ICByb3V0ZUFycmF5LnB1c2gocm91dGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVhY2hSb3V0ZShi
YXNlUm91dGUsIG1hdGNoZXIsIGNhbGxiYWNrLCBiaW5kaW5nKSB7CiAgICAgIHZhciByb3V0ZXMg
PSBtYXRjaGVyLnJvdXRlczsKICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gbWF0Y2hlci5xdWVyeVBh
cmFtczsKCiAgICAgIGZvciAodmFyIHBhdGggaW4gcm91dGVzKSB7CiAgICAgICAgaWYgKHJvdXRl
cy5oYXNPd25Qcm9wZXJ0eShwYXRoKSkgewogICAgICAgICAgdmFyIHJvdXRlQXJyYXkgPSBiYXNl
Um91dGUuc2xpY2UoKTsKICAgICAgICAgIGFkZFJvdXRlKHJvdXRlQXJyYXksIHBhdGgsIHJvdXRl
c1twYXRoXSwgcXVlcnlQYXJhbXNbcGF0aF0pOwoKICAgICAgICAgIGlmIChtYXRjaGVyLmNoaWxk
cmVuW3BhdGhdKSB7CiAgICAgICAgICAgIGVhY2hSb3V0ZShyb3V0ZUFycmF5LCBtYXRjaGVyLmNo
aWxkcmVuW3BhdGhdLCBjYWxsYmFjaywgYmluZGluZyk7CiAgICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICBjYWxsYmFjay5jYWxsKGJpbmRpbmcsIHJvdXRlQXJyYXkpOwogICAgICAgICAgfQog
ICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIFJvdXRlUmVjb2duaXplci5wcm90b3R5cGUubWFw
ID0gZnVuY3Rpb24oY2FsbGJhY2ssIGFkZFJvdXRlQ2FsbGJhY2spIHsKICAgICAgdmFyIG1hdGNo
ZXIgPSBuZXcgTWF0Y2hlcigpOwoKICAgICAgY2FsbGJhY2soZ2VuZXJhdGVNYXRjaCgiIiwgbWF0
Y2hlciwgdGhpcy5kZWxlZ2F0ZSkpOwoKICAgICAgZWFjaFJvdXRlKFtdLCBtYXRjaGVyLCBmdW5j
dGlvbihyb3V0ZSkgewogICAgICAgIGlmIChhZGRSb3V0ZUNhbGxiYWNrKSB7IGFkZFJvdXRlQ2Fs
bGJhY2sodGhpcywgcm91dGUpOyB9CiAgICAgICAgZWxzZSB7IHRoaXMuYWRkKHJvdXRlKTsgfQog
ICAgICB9LCB0aGlzKTsKICAgIH07CiAgICByZXR1cm4gUm91dGVSZWNvZ25pemVyOwogIH0pOwoK
fSkoKTsKCgoKKGZ1bmN0aW9uKCkgewpkZWZpbmUoInJvdXRlciIsCiAgWyJyb3V0ZS1yZWNvZ25p
emVyIiwicnN2cCIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVw
ZW5kZW5jeTJfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIC8qKgogICAg
ICBAcHJpdmF0ZQoKICAgICAgVGhpcyBmaWxlIHJlZmVyZW5jZXMgc2V2ZXJhbCBpbnRlcm5hbCBz
dHJ1Y3R1cmVzOgoKICAgICAgIyMgYFJlY29nbml6ZWRIYW5kbGVyYAoKICAgICAgKiBge1N0cmlu
Z30gaGFuZGxlcmA6IEEgaGFuZGxlciBuYW1lCiAgICAgICogYHtPYmplY3R9IHBhcmFtc2A6IEEg
aGFzaCBvZiByZWNvZ25pemVkIHBhcmFtZXRlcnMKCiAgICAgICMjIGBIYW5kbGVySW5mb2AKCiAg
ICAgICogYHtCb29sZWFufSBpc0R5bmFtaWNgOiB3aGV0aGVyIGEgaGFuZGxlciBoYXMgYW55IGR5
bmFtaWMgc2VnbWVudHMKICAgICAgKiBge1N0cmluZ30gbmFtZWA6IHRoZSBuYW1lIG9mIGEgaGFu
ZGxlcgogICAgICAqIGB7T2JqZWN0fSBoYW5kbGVyYDogYSBoYW5kbGVyIG9iamVjdAogICAgICAq
IGB7T2JqZWN0fSBjb250ZXh0YDogdGhlIGFjdGl2ZSBjb250ZXh0IGZvciB0aGUgaGFuZGxlcgog
ICAgKi8KCiAgICB2YXIgUm91dGVSZWNvZ25pemVyID0gX19kZXBlbmRlbmN5MV9fOwogICAgdmFy
IFJTVlAgPSBfX2RlcGVuZGVuY3kyX187CgogICAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBl
LnNsaWNlOwoKCgogICAgLyoqCiAgICAgIEBwcml2YXRlCgogICAgICBBIFRyYW5zaXRpb24gaXMg
YSB0aGVubmFibGUgKGEgcHJvbWlzZS1saWtlIG9iamVjdCkgdGhhdCByZXByZXNlbnRzCiAgICAg
IGFuIGF0dGVtcHQgdG8gdHJhbnNpdGlvbiB0byBhbm90aGVyIHJvdXRlLiBJdCBjYW4gYmUgYWJv
cnRlZCwgZWl0aGVyCiAgICAgIGV4cGxpY2l0bHkgdmlhIGBhYm9ydGAgb3IgYnkgYXR0ZW1wdGlu
ZyBhbm90aGVyIHRyYW5zaXRpb24gd2hpbGUgYQogICAgICBwcmV2aW91cyBvbmUgaXMgc3RpbGwg
dW5kZXJ3YXkuIEFuIGFib3J0ZWQgdHJhbnNpdGlvbiBjYW4gYWxzbwogICAgICBiZSBgcmV0cnko
KWBkIGxhdGVyLgogICAgICovCgogICAgZnVuY3Rpb24gVHJhbnNpdGlvbihyb3V0ZXIsIHByb21p
c2UpIHsKICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7CiAgICAgIHRoaXMucHJvbWlzZSA9IHBy
b21pc2U7CiAgICAgIHRoaXMuZGF0YSA9IHt9OwogICAgICB0aGlzLnJlc29sdmVkTW9kZWxzID0g
e307CiAgICAgIHRoaXMucHJvdmlkZWRNb2RlbHMgPSB7fTsKICAgICAgdGhpcy5wcm92aWRlZE1v
ZGVsc0FycmF5ID0gW107CiAgICAgIHRoaXMuc2VxdWVuY2UgPSArK1RyYW5zaXRpb24uY3VycmVu
dFNlcXVlbmNlOwogICAgICB0aGlzLnBhcmFtcyA9IHt9OwogICAgfQoKICAgIFRyYW5zaXRpb24u
Y3VycmVudFNlcXVlbmNlID0gMDsKCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZSA9IHsKICAgICAg
dGFyZ2V0TmFtZTogbnVsbCwKICAgICAgdXJsTWV0aG9kOiAndXBkYXRlJywKICAgICAgcHJvdmlk
ZWRNb2RlbHM6IG51bGwsCiAgICAgIHJlc29sdmVkTW9kZWxzOiBudWxsLAogICAgICBwYXJhbXM6
IG51bGwsCiAgICAgIHBpdm90SGFuZGxlcjogbnVsbCwKICAgICAgcmVzb2x2ZUluZGV4OiAwLAog
ICAgICBoYW5kbGVySW5mb3M6IG51bGwsCgogICAgICBpc0FjdGl2ZTogdHJ1ZSwKCiAgICAgIC8q
KgogICAgICAgIFRoZSBUcmFuc2l0aW9uJ3MgaW50ZXJuYWwgcHJvbWlzZS4gQ2FsbGluZyBgLnRo
ZW5gIG9uIHRoaXMgcHJvcGVydHkKICAgICAgICBpcyB0aGF0IHNhbWUgYXMgY2FsbGluZyBgLnRo
ZW5gIG9uIHRoZSBUcmFuc2l0aW9uIG9iamVjdCBpdHNlbGYsIGJ1dAogICAgICAgIHRoaXMgcHJv
cGVydHkgaXMgZXhwb3NlZCBmb3Igd2hlbiB5b3Ugd2FudCB0byBwYXNzIGFyb3VuZCBhCiAgICAg
ICAgVHJhbnNpdGlvbidzIHByb21pc2UsIGJ1dCBub3QgdGhlIFRyYW5zaXRpb24gb2JqZWN0IGl0
c2VsZiwgc2luY2UKICAgICAgICBUcmFuc2l0aW9uIG9iamVjdCBjYW4gYmUgZXh0ZXJuYWxseSBg
YWJvcnRgZWQsIHdoaWxlIHRoZSBwcm9taXNlCiAgICAgICAgY2Fubm90LgogICAgICAgKi8KICAg
ICAgcHJvbWlzZTogbnVsbCwKCiAgICAgIC8qKgogICAgICAgIEN1c3RvbSBzdGF0ZSBjYW4gYmUg
c3RvcmVkIG9uIGEgVHJhbnNpdGlvbidzIGBkYXRhYCBvYmplY3QuCiAgICAgICAgVGhpcyBjYW4g
YmUgdXNlZnVsIGZvciBkZWNvcmF0aW5nIGEgVHJhbnNpdGlvbiB3aXRoaW4gYW4gZWFybGllcgog
ICAgICAgIGhvb2sgYW5kIHNoYXJlZCB3aXRoIGEgbGF0ZXIgaG9vay4gUHJvcGVydGllcyBzZXQg
b24gYGRhdGFgIHdpbGwKICAgICAgICBiZSBjb3BpZWQgdG8gbmV3IHRyYW5zaXRpb25zIGdlbmVy
YXRlZCBieSBjYWxsaW5nIGByZXRyeWAgb24gdGhpcwogICAgICAgIHRyYW5zaXRpb24uCiAgICAg
ICAqLwogICAgICBkYXRhOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAgQSBzdGFuZGFyZCBwcm9t
aXNlIGhvb2sgdGhhdCByZXNvbHZlcyBpZiB0aGUgdHJhbnNpdGlvbgogICAgICAgIHN1Y2NlZWRz
IGFuZCByZWplY3RzIGlmIGl0IGZhaWxzL3JlZGlyZWN0cy9hYm9ydHMuCgogICAgICAgIEZvcndh
cmRzIHRvIHRoZSBpbnRlcm5hbCBgcHJvbWlzZWAgcHJvcGVydHkgd2hpY2ggeW91IGNhbgogICAg
ICAgIHVzZSBpbiBzaXR1YXRpb25zIHdoZXJlIHlvdSB3YW50IHRvIHBhc3MgYXJvdW5kIGEgdGhl
bm5hYmxlLAogICAgICAgIGJ1dCBub3QgdGhlIFRyYW5zaXRpb24gaXRzZWxmLgoKICAgICAgICBA
cGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzCiAgICAgICAgQHBhcmFtIHtGdW5jdGlvbn0gZmFpbHVy
ZQogICAgICAgKi8KICAgICAgdGhlbjogZnVuY3Rpb24oc3VjY2VzcywgZmFpbHVyZSkgewogICAg
ICAgIHJldHVybiB0aGlzLnByb21pc2UudGhlbihzdWNjZXNzLCBmYWlsdXJlKTsKICAgICAgfSwK
CiAgICAgIC8qKgogICAgICAgIEFib3J0cyB0aGUgVHJhbnNpdGlvbi4gTm90ZSB5b3UgY2FuIGFs
c28gaW1wbGljaXRseSBhYm9ydCBhIHRyYW5zaXRpb24KICAgICAgICBieSBpbml0aWF0aW5nIGFu
b3RoZXIgdHJhbnNpdGlvbiB3aGlsZSBhIHByZXZpb3VzIG9uZSBpcyB1bmRlcndheS4KICAgICAg
ICovCiAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5pc0Fib3J0ZWQp
IHsgcmV0dXJuIHRoaXM7IH0KICAgICAgICBsb2codGhpcy5yb3V0ZXIsIHRoaXMuc2VxdWVuY2Us
IHRoaXMudGFyZ2V0TmFtZSArICI6IHRyYW5zaXRpb24gd2FzIGFib3J0ZWQiKTsKICAgICAgICB0
aGlzLmlzQWJvcnRlZCA9IHRydWU7CiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlOwogICAg
ICAgIHRoaXMucm91dGVyLmFjdGl2ZVRyYW5zaXRpb24gPSBudWxsOwogICAgICAgIHJldHVybiB0
aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgUmV0cmllcyBhIHByZXZpb3VzbHktYWJv
cnRlZCB0cmFuc2l0aW9uIChtYWtpbmcgc3VyZSB0byBhYm9ydCB0aGUKICAgICAgICB0cmFuc2l0
aW9uIGlmIGl0J3Mgc3RpbGwgYWN0aXZlKS4gUmV0dXJucyBhIG5ldyB0cmFuc2l0aW9uIHRoYXQK
ICAgICAgICByZXByZXNlbnRzIHRoZSBuZXcgYXR0ZW1wdCB0byB0cmFuc2l0aW9uLgogICAgICAg
Ki8KICAgICAgcmV0cnk6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuYWJvcnQoKTsKICAgICAg
ICB2YXIgcmVjb2dIYW5kbGVycyA9IHRoaXMucm91dGVyLnJlY29nbml6ZXIuaGFuZGxlcnNGb3Io
dGhpcy50YXJnZXROYW1lKSwKICAgICAgICAgICAgaGFuZGxlckluZm9zICA9IGdlbmVyYXRlSGFu
ZGxlckluZm9zV2l0aFF1ZXJ5UGFyYW1zKHRoaXMucm91dGVyLCByZWNvZ0hhbmRsZXJzLCB0aGlz
LnF1ZXJ5UGFyYW1zKSwKICAgICAgICAgICAgbmV3VHJhbnNpdGlvbiA9IHBlcmZvcm1UcmFuc2l0
aW9uKHRoaXMucm91dGVyLCBoYW5kbGVySW5mb3MsIHRoaXMucHJvdmlkZWRNb2RlbHNBcnJheSwg
dGhpcy5wYXJhbXMsIHRoaXMucXVlcnlQYXJhbXMsIHRoaXMuZGF0YSk7CgogICAgICAgIHJldHVy
biBuZXdUcmFuc2l0aW9uOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgU2V0cyB0aGUgVVJM
LWNoYW5naW5nIG1ldGhvZCB0byBiZSBlbXBsb3llZCBhdCB0aGUgZW5kIG9mIGEKICAgICAgICBz
dWNjZXNzZnVsIHRyYW5zaXRpb24uIEJ5IGRlZmF1bHQsIGEgbmV3IFRyYW5zaXRpb24gd2lsbCBq
dXN0CiAgICAgICAgdXNlIGB1cGRhdGVVUkxgLCBidXQgcGFzc2luZyAncmVwbGFjZScgdG8gdGhp
cyBtZXRob2Qgd2lsbAogICAgICAgIGNhdXNlIHRoZSBVUkwgdG8gdXBkYXRlIHVzaW5nICdyZXBs
YWNlV2l0aCcgaW5zdGVhZC4gT21pdHRpbmcKICAgICAgICBhIHBhcmFtZXRlciB3aWxsIGRpc2Fi
bGUgdGhlIFVSTCBjaGFuZ2UsIGFsbG93aW5nIGZvciB0cmFuc2l0aW9ucwogICAgICAgIHRoYXQg
ZG9uJ3QgdXBkYXRlIHRoZSBVUkwgYXQgY29tcGxldGlvbiAodGhpcyBpcyBhbHNvIHVzZWQgZm9y
CiAgICAgICAgaGFuZGxlVVJMLCBzaW5jZSB0aGUgVVJMIGhhcyBhbHJlYWR5IGNoYW5nZWQgYmVm
b3JlIHRoZQogICAgICAgIHRyYW5zaXRpb24gdG9vayBwbGFjZSkuCgogICAgICAgIEBwYXJhbSB7
U3RyaW5nfSBtZXRob2QgdGhlIHR5cGUgb2YgVVJMLWNoYW5naW5nIG1ldGhvZCB0byB1c2UKICAg
ICAgICAgIGF0IHRoZSBlbmQgb2YgYSB0cmFuc2l0aW9uLiBBY2NlcHRlZCB2YWx1ZXMgYXJlICdy
ZXBsYWNlJywKICAgICAgICAgIGZhbHN5IHZhbHVlcywgb3IgYW55IG90aGVyIG5vbi1mYWxzeSB2
YWx1ZSAod2hpY2ggaXMKICAgICAgICAgIGludGVycHJldGVkIGFzIGFuIHVwZGF0ZVVSTCB0cmFu
c2l0aW9uKS4KCiAgICAgICAgQHJldHVybiB7VHJhbnNpdGlvbn0gdGhpcyB0cmFuc2l0aW9uCiAg
ICAgICAqLwogICAgICBtZXRob2Q6IGZ1bmN0aW9uKG1ldGhvZCkgewogICAgICAgIHRoaXMudXJs
TWV0aG9kID0gbWV0aG9kOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoq
CiAgICAgICAgRmlyZXMgYW4gZXZlbnQgb24gdGhlIGN1cnJlbnQgbGlzdCBvZiByZXNvbHZlZC9y
ZXNvbHZpbmcKICAgICAgICBoYW5kbGVycyB3aXRoaW4gdGhpcyB0cmFuc2l0aW9uLiBVc2VmdWwg
Zm9yIGZpcmluZyBldmVudHMKICAgICAgICBvbiByb3V0ZSBoaWVyYXJjaGllcyB0aGF0IGhhdmVu
J3QgZnVsbHkgYmVlbiBlbnRlcmVkIHlldC4KCiAgICAgICAgQHBhcmFtIHtCb29sZWFufSBpZ25v
cmVGYWlsdXJlIHRoZSBuYW1lIG9mIHRoZSBldmVudCB0byBmaXJlCiAgICAgICAgQHBhcmFtIHtT
dHJpbmd9IG5hbWUgdGhlIG5hbWUgb2YgdGhlIGV2ZW50IHRvIGZpcmUKICAgICAgICovCiAgICAg
IHRyaWdnZXI6IGZ1bmN0aW9uKGlnbm9yZUZhaWx1cmUpIHsKICAgICAgICB2YXIgYXJncyA9IHNs
aWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgICBpZiAodHlwZW9mIGlnbm9yZUZhaWx1cmUgPT09
ICdib29sZWFuJykgewogICAgICAgICAgYXJncy5zaGlmdCgpOwogICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgICAvLyBUaHJvdyBlcnJvcnMgb24gdW5oYW5kbGVkIHRyaWdnZXIgZXZlbnRzIGJ5IGRl
ZmF1bHQKICAgICAgICAgIGlnbm9yZUZhaWx1cmUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAg
dHJpZ2dlcih0aGlzLnJvdXRlciwgdGhpcy5oYW5kbGVySW5mb3Muc2xpY2UoMCwgdGhpcy5yZXNv
bHZlSW5kZXggKyAxKSwgaWdub3JlRmFpbHVyZSwgYXJncyk7CiAgICAgIH0sCgogICAgICB0b1N0
cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICJUcmFuc2l0aW9uIChzZXF1ZW5jZSAi
ICsgdGhpcy5zZXF1ZW5jZSArICIpIjsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBSb3V0
ZXIoKSB7CiAgICAgIHRoaXMucmVjb2duaXplciA9IG5ldyBSb3V0ZVJlY29nbml6ZXIoKTsKICAg
IH0KCiAgICAvLyBUT0RPOiBzZXBhcmF0ZSBpbnRvIG1vZHVsZT8KICAgIFJvdXRlci5UcmFuc2l0
aW9uID0gVHJhbnNpdGlvbjsKCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gUm91dGVyOwoK
CiAgICAvKioKICAgICAgUHJvbWlzZSByZWplY3QgcmVhc29ucyBwYXNzZWQgdG8gcHJvbWlzZSBy
ZWplY3Rpb24KICAgICAgaGFuZGxlcnMgZm9yIGZhaWxlZCB0cmFuc2l0aW9ucy4KICAgICAqLwog
ICAgUm91dGVyLlVucmVjb2duaXplZFVSTEVycm9yID0gZnVuY3Rpb24obWVzc2FnZSkgewogICAg
ICB0aGlzLm1lc3NhZ2UgPSAobWVzc2FnZSB8fCAiVW5yZWNvZ25pemVkVVJMRXJyb3IiKTsKICAg
ICAgdGhpcy5uYW1lID0gIlVucmVjb2duaXplZFVSTEVycm9yIjsKICAgIH07CgogICAgUm91dGVy
LlRyYW5zaXRpb25BYm9ydGVkID0gZnVuY3Rpb24obWVzc2FnZSkgewogICAgICB0aGlzLm1lc3Nh
Z2UgPSAobWVzc2FnZSB8fCAiVHJhbnNpdGlvbkFib3J0ZWQiKTsKICAgICAgdGhpcy5uYW1lID0g
IlRyYW5zaXRpb25BYm9ydGVkIjsKICAgIH07CgogICAgZnVuY3Rpb24gZXJyb3JUcmFuc2l0aW9u
KHJvdXRlciwgcmVhc29uKSB7CiAgICAgIHJldHVybiBuZXcgVHJhbnNpdGlvbihyb3V0ZXIsIFJT
VlAucmVqZWN0KHJlYXNvbikpOwogICAgfQoKCiAgICBSb3V0ZXIucHJvdG90eXBlID0gewogICAg
ICAvKioKICAgICAgICBUaGUgbWFpbiBlbnRyeSBwb2ludCBpbnRvIHRoZSByb3V0ZXIuIFRoZSBB
UEkgaXMgZXNzZW50aWFsbHkKICAgICAgICB0aGUgc2FtZSBhcyB0aGUgYG1hcGAgbWV0aG9kIGlu
IGByb3V0ZS1yZWNvZ25pemVyYC4KCiAgICAgICAgVGhpcyBtZXRob2QgZXh0cmFjdHMgdGhlIFN0
cmluZyBoYW5kbGVyIGF0IHRoZSBsYXN0IGAudG8oKWAKICAgICAgICBjYWxsIGFuZCB1c2VzIGl0
IGFzIHRoZSBuYW1lIG9mIHRoZSB3aG9sZSByb3V0ZS4KCiAgICAgICAgQHBhcmFtIHtGdW5jdGlv
bn0gY2FsbGJhY2sKICAgICAgKi8KICAgICAgbWFwOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAg
ICAgIHRoaXMucmVjb2duaXplci5kZWxlZ2F0ZSA9IHRoaXMuZGVsZWdhdGU7CgogICAgICAgIHRo
aXMucmVjb2duaXplci5tYXAoY2FsbGJhY2ssIGZ1bmN0aW9uKHJlY29nbml6ZXIsIHJvdXRlKSB7
CiAgICAgICAgICB2YXIgbGFzdEhhbmRsZXIgPSByb3V0ZVtyb3V0ZS5sZW5ndGggLSAxXS5oYW5k
bGVyOwogICAgICAgICAgdmFyIGFyZ3MgPSBbcm91dGUsIHsgYXM6IGxhc3RIYW5kbGVyIH1dOwog
ICAgICAgICAgcmVjb2duaXplci5hZGQuYXBwbHkocmVjb2duaXplciwgYXJncyk7CiAgICAgICAg
fSk7CiAgICAgIH0sCgogICAgICBoYXNSb3V0ZTogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgICBy
ZXR1cm4gdGhpcy5yZWNvZ25pemVyLmhhc1JvdXRlKHJvdXRlKTsKICAgICAgfSwKCiAgICAgIC8q
KgogICAgICAgIENsZWFycyB0aGUgY3VycmVudCBhbmQgdGFyZ2V0IHJvdXRlIGhhbmRsZXJzIGFu
ZCB0cmlnZ2VycyBleGl0CiAgICAgICAgb24gZWFjaCBvZiB0aGVtIHN0YXJ0aW5nIGF0IHRoZSBs
ZWFmIGFuZCB0cmF2ZXJzaW5nIHVwIHRocm91Z2gKICAgICAgICBpdHMgYW5jZXN0b3JzLgogICAg
ICAqLwogICAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgZWFjaEhhbmRsZXIodGhpcy5j
dXJyZW50SGFuZGxlckluZm9zIHx8IFtdLCBmdW5jdGlvbihoYW5kbGVySW5mbykgewogICAgICAg
ICAgdmFyIGhhbmRsZXIgPSBoYW5kbGVySW5mby5oYW5kbGVyOwogICAgICAgICAgaWYgKGhhbmRs
ZXIuZXhpdCkgewogICAgICAgICAgICBoYW5kbGVyLmV4aXQoKTsKICAgICAgICAgIH0KICAgICAg
ICB9KTsKICAgICAgICB0aGlzLmN1cnJlbnRIYW5kbGVySW5mb3MgPSBudWxsOwogICAgICAgIHRo
aXMudGFyZ2V0SGFuZGxlckluZm9zID0gbnVsbDsKICAgICAgfSwKCiAgICAgIGFjdGl2ZVRyYW5z
aXRpb246IG51bGwsCgogICAgICAvKioKICAgICAgICB2YXIgaGFuZGxlciA9IGhhbmRsZXJJbmZv
LmhhbmRsZXI7CiAgICAgICAgVGhlIGVudHJ5IHBvaW50IGZvciBoYW5kbGluZyBhIGNoYW5nZSB0
byB0aGUgVVJMICh1c3VhbGx5CiAgICAgICAgdmlhIHRoZSBiYWNrIGFuZCBmb3J3YXJkIGJ1dHRv
bikuCgogICAgICAgIFJldHVybnMgYW4gQXJyYXkgb2YgaGFuZGxlcnMgYW5kIHRoZSBwYXJhbWV0
ZXJzIGFzc29jaWF0ZWQKICAgICAgICB3aXRoIHRob3NlIHBhcmFtZXRlcnMuCgogICAgICAgIEBw
YXJhbSB7U3RyaW5nfSB1cmwgYSBVUkwgdG8gcHJvY2VzcwoKICAgICAgICBAcmV0dXJuIHtBcnJh
eX0gYW4gQXJyYXkgb2YgYFtoYW5kbGVyLCBwYXJhbWV0ZXJdYCB0dXBsZXMKICAgICAgKi8KICAg
ICAgaGFuZGxlVVJMOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAvLyBQZXJmb3JtIGEgVVJMLWJh
c2VkIHRyYW5zaXRpb24sIGJ1dCBkb24ndCBjaGFuZ2UKICAgICAgICAvLyB0aGUgVVJMIGFmdGVy
d2FyZCwgc2luY2UgaXQgYWxyZWFkeSBoYXBwZW5lZC4KICAgICAgICB2YXIgYXJncyA9IHNsaWNl
LmNhbGwoYXJndW1lbnRzKTsKICAgICAgICBpZiAodXJsLmNoYXJBdCgwKSAhPT0gJy8nKSB7IGFy
Z3NbMF0gPSAnLycgKyB1cmw7IH0KICAgICAgICByZXR1cm4gZG9UcmFuc2l0aW9uKHRoaXMsIGFy
Z3MpLm1ldGhvZChudWxsKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEhvb2sgcG9pbnQg
Zm9yIHVwZGF0aW5nIHRoZSBVUkwuCgogICAgICAgIEBwYXJhbSB7U3RyaW5nfSB1cmwgYSBVUkwg
dG8gdXBkYXRlIHRvCiAgICAgICovCiAgICAgIHVwZGF0ZVVSTDogZnVuY3Rpb24oKSB7CiAgICAg
ICAgdGhyb3cgbmV3IEVycm9yKCJ1cGRhdGVVUkwgaXMgbm90IGltcGxlbWVudGVkIik7CiAgICAg
IH0sCgogICAgICAvKioKICAgICAgICBIb29rIHBvaW50IGZvciByZXBsYWNpbmcgdGhlIGN1cnJl
bnQgVVJMLCBpLmUuIHdpdGggcmVwbGFjZVN0YXRlCgogICAgICAgIEJ5IGRlZmF1bHQgdGhpcyBi
ZWhhdmVzIHRoZSBzYW1lIGFzIGB1cGRhdGVVUkxgCgogICAgICAgIEBwYXJhbSB7U3RyaW5nfSB1
cmwgYSBVUkwgdG8gdXBkYXRlIHRvCiAgICAgICovCiAgICAgIHJlcGxhY2VVUkw6IGZ1bmN0aW9u
KHVybCkgewogICAgICAgIHRoaXMudXBkYXRlVVJMKHVybCk7CiAgICAgIH0sCgogICAgICAvKioK
ICAgICAgICBUcmFuc2l0aW9uIGludG8gdGhlIHNwZWNpZmllZCBuYW1lZCByb3V0ZS4KCiAgICAg
ICAgSWYgbmVjZXNzYXJ5LCB0cmlnZ2VyIHRoZSBleGl0IGNhbGxiYWNrIG9uIGFueSBoYW5kbGVy
cwogICAgICAgIHRoYXQgYXJlIG5vIGxvbmdlciByZXByZXNlbnRlZCBieSB0aGUgdGFyZ2V0IHJv
dXRlLgoKICAgICAgICBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgcm91dGUK
ICAgICAgKi8KICAgICAgdHJhbnNpdGlvblRvOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgcmV0
dXJuIGRvVHJhbnNpdGlvbih0aGlzLCBhcmd1bWVudHMpOwogICAgICB9LAoKICAgICAgaW50ZXJt
ZWRpYXRlVHJhbnNpdGlvblRvOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgZG9UcmFuc2l0aW9u
KHRoaXMsIGFyZ3VtZW50cywgdHJ1ZSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBJZGVu
dGljYWwgdG8gYHRyYW5zaXRpb25Ub2AgZXhjZXB0IHRoYXQgdGhlIGN1cnJlbnQgVVJMIHdpbGwg
YmUgcmVwbGFjZWQKICAgICAgICBpZiBwb3NzaWJsZS4KCiAgICAgICAgVGhpcyBtZXRob2QgaXMg
aW50ZW5kZWQgcHJpbWFyaWx5IGZvciB1c2Ugd2l0aCBgcmVwbGFjZVN0YXRlYC4KCiAgICAgICAg
QHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvdXRlCiAgICAgICovCiAgICAg
IHJlcGxhY2VXaXRoOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNpdGlv
bih0aGlzLCBhcmd1bWVudHMpLm1ldGhvZCgncmVwbGFjZScpOwogICAgICB9LAoKICAgICAgLyoq
CiAgICAgICAgQHByaXZhdGUKCiAgICAgICAgVGhpcyBtZXRob2QgdGFrZXMgYSBoYW5kbGVyIG5h
bWUgYW5kIGEgbGlzdCBvZiBjb250ZXh0cyBhbmQgcmV0dXJucwogICAgICAgIGEgc2VyaWFsaXpl
ZCBwYXJhbWV0ZXIgaGFzaCBzdWl0YWJsZSB0byBwYXNzIHRvIGByZWNvZ25pemVyLmdlbmVyYXRl
KClgLgoKICAgICAgICBAcGFyYW0ge1N0cmluZ30gaGFuZGxlck5hbWUKICAgICAgICBAcGFyYW0g
e0FycmF5W09iamVjdF19IGNvbnRleHRzCiAgICAgICAgQHJldHVybiB7T2JqZWN0fSBhIHNlcmlh
bGl6ZWQgcGFyYW1ldGVyIGhhc2gKICAgICAgKi8KCiAgICAgIHBhcmFtc0ZvckhhbmRsZXI6IGZ1
bmN0aW9uKGhhbmRsZXJOYW1lLCBjb250ZXh0cykgewogICAgICAgIHZhciBwYXJ0aXRpb25lZEFy
Z3MgPSBleHRyYWN0UXVlcnlQYXJhbXMoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAg
ICByZXR1cm4gcGFyYW1zRm9ySGFuZGxlcih0aGlzLCBoYW5kbGVyTmFtZSwgcGFydGl0aW9uZWRB
cmdzWzBdLCBwYXJ0aXRpb25lZEFyZ3NbMV0pOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAg
VGhpcyBtZXRob2QgdGFrZXMgYSBoYW5kbGVyIG5hbWUgYW5kIHJldHVybnMgYSBsaXN0IG9mIHF1
ZXJ5IHBhcmFtcwogICAgICAgIHRoYXQgYXJlIHZhbGlkIHRvIHBhc3MgdG8gdGhlIGhhbmRsZXIg
b3IgaXRzIHBhcmVudHMKCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGhhbmRsZXJOYW1lCiAgICAg
ICAgQHJldHVybiB7QXJyYXlbU3RyaW5nXX0gYSBsaXN0IG9mIHF1ZXJ5IHBhcmFtZXRlcnMKICAg
ICAgKi8KICAgICAgcXVlcnlQYXJhbXNGb3JIYW5kbGVyOiBmdW5jdGlvbiAoaGFuZGxlck5hbWUp
IHsKICAgICAgICByZXR1cm4gcXVlcnlQYXJhbXNGb3JIYW5kbGVyKHRoaXMsIGhhbmRsZXJOYW1l
KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFRha2UgYSBuYW1lZCByb3V0ZSBhbmQgY29u
dGV4dCBvYmplY3RzIGFuZCBnZW5lcmF0ZSBhCiAgICAgICAgVVJMLgoKICAgICAgICBAcGFyYW0g
e1N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgcm91dGUgdG8gZ2VuZXJhdGUKICAgICAgICAg
IGEgVVJMIGZvcgogICAgICAgIEBwYXJhbSB7Li4uT2JqZWN0fSBvYmplY3RzIGEgbGlzdCBvZiBv
YmplY3RzIHRvIHNlcmlhbGl6ZQoKICAgICAgICBAcmV0dXJuIHtTdHJpbmd9IGEgVVJMCiAgICAg
ICovCiAgICAgIGdlbmVyYXRlOiBmdW5jdGlvbihoYW5kbGVyTmFtZSkgewogICAgICAgIHZhciBw
YXJ0aXRpb25lZEFyZ3MgPSBleHRyYWN0UXVlcnlQYXJhbXMoc2xpY2UuY2FsbChhcmd1bWVudHMs
IDEpKSwKICAgICAgICAgIHN1cHBsaWVkUGFyYW1zID0gcGFydGl0aW9uZWRBcmdzWzBdLAogICAg
ICAgICAgcXVlcnlQYXJhbXMgPSBwYXJ0aXRpb25lZEFyZ3NbMV07CgogICAgICAgIHZhciBwYXJh
bXMgPSBwYXJhbXNGb3JIYW5kbGVyKHRoaXMsIGhhbmRsZXJOYW1lLCBzdXBwbGllZFBhcmFtcywg
cXVlcnlQYXJhbXMpLAogICAgICAgICAgdmFsaWRRdWVyeVBhcmFtcyA9IHF1ZXJ5UGFyYW1zRm9y
SGFuZGxlcih0aGlzLCBoYW5kbGVyTmFtZSk7CgogICAgICAgIHZhciBtaXNzaW5nUGFyYW1zID0g
W107CgogICAgICAgIGZvciAodmFyIGtleSBpbiBxdWVyeVBhcmFtcykgewogICAgICAgICAgaWYg
KHF1ZXJ5UGFyYW1zLmhhc093blByb3BlcnR5KGtleSkgJiYgIX52YWxpZFF1ZXJ5UGFyYW1zLmlu
ZGV4T2Yoa2V5KSkgewogICAgICAgICAgICBtaXNzaW5nUGFyYW1zLnB1c2goa2V5KTsKICAgICAg
ICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChtaXNzaW5nUGFyYW1zLmxlbmd0aCA+IDApIHsK
ICAgICAgICAgIHZhciBlcnIgPSAnWW91IHN1cHBsaWVkIHRoZSBwYXJhbXMgJzsKICAgICAgICAg
IGVyciArPSBtaXNzaW5nUGFyYW1zLm1hcChmdW5jdGlvbihwYXJhbSkgewogICAgICAgICAgICBy
ZXR1cm4gJyInICsgcGFyYW0gKyAiPSIgKyBxdWVyeVBhcmFtc1twYXJhbV0gKyAnIic7CiAgICAg
ICAgICB9KS5qb2luKCcgYW5kICcpOwoKICAgICAgICAgIGVyciArPSAnIHdoaWNoIGFyZSBub3Qg
dmFsaWQgZm9yIHRoZSAiJyArIGhhbmRsZXJOYW1lICsgJyIgaGFuZGxlciBvciBpdHMgcGFyZW50
cyc7CgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycik7CiAgICAgICAgfQoKICAgICAgICBy
ZXR1cm4gdGhpcy5yZWNvZ25pemVyLmdlbmVyYXRlKGhhbmRsZXJOYW1lLCBwYXJhbXMpOwogICAg
ICB9LAoKICAgICAgaXNBY3RpdmU6IGZ1bmN0aW9uKGhhbmRsZXJOYW1lKSB7CiAgICAgICAgdmFy
IHBhcnRpdGlvbmVkQXJncyAgID0gZXh0cmFjdFF1ZXJ5UGFyYW1zKHNsaWNlLmNhbGwoYXJndW1l
bnRzLCAxKSksCiAgICAgICAgICAgIGNvbnRleHRzICAgICAgICAgID0gcGFydGl0aW9uZWRBcmdz
WzBdLAogICAgICAgICAgICBxdWVyeVBhcmFtcyAgICAgICA9IHBhcnRpdGlvbmVkQXJnc1sxXSwK
ICAgICAgICAgICAgYWN0aXZlUXVlcnlQYXJhbXMgID0ge30sCiAgICAgICAgICAgIGVmZmVjdGl2
ZVF1ZXJ5UGFyYW1zID0ge307CgogICAgICAgIHZhciB0YXJnZXRIYW5kbGVySW5mb3MgPSB0aGlz
LnRhcmdldEhhbmRsZXJJbmZvcywKICAgICAgICAgICAgZm91bmQgPSBmYWxzZSwgbmFtZXMsIG9i
amVjdCwgaGFuZGxlckluZm8sIGhhbmRsZXJPYmo7CgogICAgICAgIGlmICghdGFyZ2V0SGFuZGxl
ckluZm9zKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICB2YXIgcmVjb2dIYW5kbGVycyA9IHRo
aXMucmVjb2duaXplci5oYW5kbGVyc0Zvcih0YXJnZXRIYW5kbGVySW5mb3NbdGFyZ2V0SGFuZGxl
ckluZm9zLmxlbmd0aCAtIDFdLm5hbWUpOwogICAgICAgIGZvciAodmFyIGk9dGFyZ2V0SGFuZGxl
ckluZm9zLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHsKICAgICAgICAgIGhhbmRsZXJJbmZvID0gdGFy
Z2V0SGFuZGxlckluZm9zW2ldOwogICAgICAgICAgaWYgKGhhbmRsZXJJbmZvLm5hbWUgPT09IGhh
bmRsZXJOYW1lKSB7IGZvdW5kID0gdHJ1ZTsgfQoKICAgICAgICAgIGlmIChmb3VuZCkgewogICAg
ICAgICAgICB2YXIgcmVjb2dIYW5kbGVyID0gcmVjb2dIYW5kbGVyc1tpXTsKCiAgICAgICAgICAg
IG1lcmdlKGFjdGl2ZVF1ZXJ5UGFyYW1zLCBoYW5kbGVySW5mby5xdWVyeVBhcmFtcyk7CiAgICAg
ICAgICAgIGlmIChxdWVyeVBhcmFtcyAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICBtZXJnZShl
ZmZlY3RpdmVRdWVyeVBhcmFtcywgaGFuZGxlckluZm8ucXVlcnlQYXJhbXMpOwogICAgICAgICAg
ICAgIG1lcmdlU29tZUtleXMoZWZmZWN0aXZlUXVlcnlQYXJhbXMsIHF1ZXJ5UGFyYW1zLCByZWNv
Z0hhbmRsZXIucXVlcnlQYXJhbXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaGFu
ZGxlckluZm8uaXNEeW5hbWljICYmIGNvbnRleHRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAg
ICBvYmplY3QgPSBjb250ZXh0cy5wb3AoKTsKCiAgICAgICAgICAgICAgaWYgKGlzUGFyYW0ob2Jq
ZWN0KSkgewogICAgICAgICAgICAgICAgdmFyIG5hbWUgPSByZWNvZ0hhbmRsZXIubmFtZXNbMF07
CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3VycmVudFBhcmFtcyB8fCAiIiArIG9iamVjdCAh
PT0gdGhpcy5jdXJyZW50UGFyYW1zW25hbWVdKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgICAg
ICAgIH0gZWxzZSBpZiAoaGFuZGxlckluZm8uY29udGV4dCAhPT0gb2JqZWN0KSB7CiAgICAgICAg
ICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg
ICAgICB9CiAgICAgICAgfQoKCiAgICAgICAgcmV0dXJuIGNvbnRleHRzLmxlbmd0aCA9PT0gMCAm
JiBmb3VuZCAmJiBxdWVyeVBhcmFtc0VxdWFsKGFjdGl2ZVF1ZXJ5UGFyYW1zLCBlZmZlY3RpdmVR
dWVyeVBhcmFtcyk7CiAgICAgIH0sCgogICAgICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAg
ICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdHJpZ2dlcih0
aGlzLCB0aGlzLmN1cnJlbnRIYW5kbGVySW5mb3MsIGZhbHNlLCBhcmdzKTsKICAgICAgfSwKCiAg
ICAgIC8qKgogICAgICAgIEhvb2sgcG9pbnQgZm9yIGxvZ2dpbmcgdHJhbnNpdGlvbiBzdGF0dXMg
dXBkYXRlcy4KCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8g
bG9nLgogICAgICAqLwogICAgICBsb2c6IG51bGwKICAgIH07CgogICAgLyoqCiAgICAgIEBwcml2
YXRlCgogICAgICBVc2VkIGludGVybmFsbHkgZm9yIGJvdGggVVJMIGFuZCBuYW1lZCB0cmFuc2l0
aW9uIHRvIGRldGVybWluZQogICAgICBhIHNoYXJlZCBwaXZvdCBwYXJlbnQgcm91dGUgYW5kIG90
aGVyIGRhdGEgbmVjZXNzYXJ5IHRvIHBlcmZvcm0KICAgICAgYSB0cmFuc2l0aW9uLgogICAgICov
CiAgICBmdW5jdGlvbiBnZXRNYXRjaFBvaW50KHJvdXRlciwgaGFuZGxlcnMsIG9iamVjdHMsIGlu
cHV0UGFyYW1zLCBxdWVyeVBhcmFtcykgewoKICAgICAgdmFyIG1hdGNoUG9pbnQgPSBoYW5kbGVy
cy5sZW5ndGgsCiAgICAgICAgICBwcm92aWRlZE1vZGVscyA9IHt9LCBpLAogICAgICAgICAgY3Vy
cmVudEhhbmRsZXJJbmZvcyA9IHJvdXRlci5jdXJyZW50SGFuZGxlckluZm9zIHx8IFtdLAogICAg
ICAgICAgcGFyYW1zID0ge30sCiAgICAgICAgICBvbGRQYXJhbXMgPSByb3V0ZXIuY3VycmVudFBh
cmFtcyB8fCB7fSwKICAgICAgICAgIGFjdGl2ZVRyYW5zaXRpb24gPSByb3V0ZXIuYWN0aXZlVHJh
bnNpdGlvbiwKICAgICAgICAgIGhhbmRsZXJQYXJhbXMgPSB7fSwKICAgICAgICAgIG9iajsKCiAg
ICAgIG9iamVjdHMgPSBzbGljZS5jYWxsKG9iamVjdHMpOwogICAgICBtZXJnZShwYXJhbXMsIGlu
cHV0UGFyYW1zKTsKCiAgICAgIGZvciAoaSA9IGhhbmRsZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsg
aS0tKSB7CiAgICAgICAgdmFyIGhhbmRsZXJPYmogPSBoYW5kbGVyc1tpXSwKICAgICAgICAgICAg
aGFuZGxlck5hbWUgPSBoYW5kbGVyT2JqLmhhbmRsZXIsCiAgICAgICAgICAgIG9sZEhhbmRsZXJJ
bmZvID0gY3VycmVudEhhbmRsZXJJbmZvc1tpXSwKICAgICAgICAgICAgaGFzQ2hhbmdlZCA9IGZh
bHNlOwoKICAgICAgICAvLyBDaGVjayBpZiBoYW5kbGVyIG5hbWVzIGhhdmUgY2hhbmdlZC4KICAg
ICAgICBpZiAoIW9sZEhhbmRsZXJJbmZvIHx8IG9sZEhhbmRsZXJJbmZvLm5hbWUgIT09IGhhbmRs
ZXJPYmouaGFuZGxlcikgeyBoYXNDaGFuZ2VkID0gdHJ1ZTsgfQoKICAgICAgICBpZiAoaGFuZGxl
ck9iai5pc0R5bmFtaWMpIHsKICAgICAgICAgIC8vIFVSTCB0cmFuc2l0aW9uLgoKICAgICAgICAg
IGlmIChvYmogPSBnZXRNYXRjaFBvaW50T2JqZWN0KG9iamVjdHMsIGhhbmRsZXJOYW1lLCBhY3Rp
dmVUcmFuc2l0aW9uLCB0cnVlLCBwYXJhbXMpKSB7CiAgICAgICAgICAgIGhhc0NoYW5nZWQgPSB0
cnVlOwogICAgICAgICAgICBwcm92aWRlZE1vZGVsc1toYW5kbGVyTmFtZV0gPSBvYmo7CiAgICAg
ICAgICB9IGVsc2UgewogICAgICAgICAgICBoYW5kbGVyUGFyYW1zW2hhbmRsZXJOYW1lXSA9IHt9
OwogICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGhhbmRsZXJPYmoucGFyYW1zKSB7CiAgICAg
ICAgICAgICAgaWYgKCFoYW5kbGVyT2JqLnBhcmFtcy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgeyBj
b250aW51ZTsgfQogICAgICAgICAgICAgIHZhciBuZXdQYXJhbSA9IGhhbmRsZXJPYmoucGFyYW1z
W3Byb3BdOwogICAgICAgICAgICAgIGlmIChvbGRQYXJhbXNbcHJvcF0gIT09IG5ld1BhcmFtKSB7
IGhhc0NoYW5nZWQgPSB0cnVlOyB9CiAgICAgICAgICAgICAgaGFuZGxlclBhcmFtc1toYW5kbGVy
TmFtZV1bcHJvcF0gPSBwYXJhbXNbcHJvcF0gPSBuZXdQYXJhbTsKICAgICAgICAgICAgfQogICAg
ICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaGFuZGxlck9iai5oYXNPd25Qcm9wZXJ0eSgnbmFt
ZXMnKSkgewogICAgICAgICAgLy8gTmFtZWQgdHJhbnNpdGlvbi4KCiAgICAgICAgICBpZiAob2Jq
ZWN0cy5sZW5ndGgpIHsgaGFzQ2hhbmdlZCA9IHRydWU7IH0KCiAgICAgICAgICBpZiAob2JqID0g
Z2V0TWF0Y2hQb2ludE9iamVjdChvYmplY3RzLCBoYW5kbGVyTmFtZSwgYWN0aXZlVHJhbnNpdGlv
biwgaGFuZGxlck9iai5uYW1lc1swXSwgcGFyYW1zKSkgewogICAgICAgICAgICBwcm92aWRlZE1v
ZGVsc1toYW5kbGVyTmFtZV0gPSBvYmo7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2
YXIgbmFtZXMgPSBoYW5kbGVyT2JqLm5hbWVzOwogICAgICAgICAgICBoYW5kbGVyUGFyYW1zW2hh
bmRsZXJOYW1lXSA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgbGVuID0gbmFtZXMu
bGVuZ3RoOyBqIDwgbGVuOyArK2opIHsKICAgICAgICAgICAgICB2YXIgbmFtZSA9IG5hbWVzW2pd
OwogICAgICAgICAgICAgIGhhbmRsZXJQYXJhbXNbaGFuZGxlck5hbWVdW25hbWVdID0gcGFyYW1z
W25hbWVdID0gcGFyYW1zW25hbWVdIHx8IG9sZFBhcmFtc1tuYW1lXTsKICAgICAgICAgICAgfQog
ICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW4gb2xkIGhhbmRs
ZXIsIHNlZSBpZiBxdWVyeSBwYXJhbXMgYXJlIHRoZSBzYW1lLiBJZiB0aGVyZSBpc24ndCBhbiBv
bGQgaGFuZGxlciwKICAgICAgICAvLyBoYXNDaGFuZ2VkIHdpbGwgYWxyZWFkeSBiZSB0cnVlIGhl
cmUKICAgICAgICBpZihvbGRIYW5kbGVySW5mbyAmJiAhcXVlcnlQYXJhbXNFcXVhbChvbGRIYW5k
bGVySW5mby5xdWVyeVBhcmFtcywgaGFuZGxlck9iai5xdWVyeVBhcmFtcykpIHsKICAgICAgICAg
ICAgaGFzQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoaGFzQ2hhbmdlZCkg
eyBtYXRjaFBvaW50ID0gaTsgfQogICAgICB9CgogICAgICBpZiAob2JqZWN0cy5sZW5ndGggPiAw
KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNb3JlIGNvbnRleHQgb2JqZWN0cyB3ZXJlIHBh
c3NlZCB0aGFuIHRoZXJlIGFyZSBkeW5hbWljIHNlZ21lbnRzIGZvciB0aGUgcm91dGU6ICIgKyBo
YW5kbGVyc1toYW5kbGVycy5sZW5ndGggLSAxXS5oYW5kbGVyKTsKICAgICAgfQoKICAgICAgdmFy
IHBpdm90SGFuZGxlckluZm8gPSBjdXJyZW50SGFuZGxlckluZm9zW21hdGNoUG9pbnQgLSAxXSwK
ICAgICAgICAgIHBpdm90SGFuZGxlciA9IHBpdm90SGFuZGxlckluZm8gJiYgcGl2b3RIYW5kbGVy
SW5mby5oYW5kbGVyOwoKICAgICAgcmV0dXJuIHsgbWF0Y2hQb2ludDogbWF0Y2hQb2ludCwgcHJv
dmlkZWRNb2RlbHM6IHByb3ZpZGVkTW9kZWxzLCBwYXJhbXM6IHBhcmFtcywgaGFuZGxlclBhcmFt
czogaGFuZGxlclBhcmFtcywgcGl2b3RIYW5kbGVyOiBwaXZvdEhhbmRsZXIgfTsKICAgIH0KCiAg
ICBmdW5jdGlvbiBnZXRNYXRjaFBvaW50T2JqZWN0KG9iamVjdHMsIGhhbmRsZXJOYW1lLCBhY3Rp
dmVUcmFuc2l0aW9uLCBwYXJhbU5hbWUsIHBhcmFtcykgewoKICAgICAgaWYgKG9iamVjdHMubGVu
Z3RoICYmIHBhcmFtTmFtZSkgewoKICAgICAgICB2YXIgb2JqZWN0ID0gb2JqZWN0cy5wb3AoKTsK
CiAgICAgICAgLy8gSWYgcHJvdmlkZWQgb2JqZWN0IGlzIHN0cmluZyBvciBudW1iZXIsIHRyZWF0
IGFzIHBhcmFtLgogICAgICAgIGlmIChpc1BhcmFtKG9iamVjdCkpIHsKICAgICAgICAgIHBhcmFt
c1twYXJhbU5hbWVdID0gb2JqZWN0LnRvU3RyaW5nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg
ICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRyYW5z
aXRpb24pIHsKICAgICAgICAvLyBVc2UgbW9kZWwgZnJvbSBwcmV2aW91cyB0cmFuc2l0aW9uIGF0
dGVtcHQsIHByZWZlcmFibHkgdGhlIHJlc29sdmVkIG9uZS4KICAgICAgICByZXR1cm4gYWN0aXZl
VHJhbnNpdGlvbi5yZXNvbHZlZE1vZGVsc1toYW5kbGVyTmFtZV0gfHwKICAgICAgICAgICAgICAg
KHBhcmFtTmFtZSAmJiBhY3RpdmVUcmFuc2l0aW9uLnByb3ZpZGVkTW9kZWxzW2hhbmRsZXJOYW1l
XSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1BhcmFtKG9iamVjdCkgewogICAgICBy
ZXR1cm4gKHR5cGVvZiBvYmplY3QgPT09ICJzdHJpbmciIHx8IG9iamVjdCBpbnN0YW5jZW9mIFN0
cmluZyB8fCB0eXBlb2Ygb2JqZWN0ID09PSAibnVtYmVyIiB8fCBvYmplY3QgaW5zdGFuY2VvZiBO
dW1iZXIpOwogICAgfQoKCgogICAgLyoqCiAgICAgIEBwcml2YXRlCgogICAgICBUaGlzIG1ldGhv
ZCB0YWtlcyBhIGhhbmRsZXIgbmFtZSBhbmQgcmV0dXJucyBhIGxpc3Qgb2YgcXVlcnkgcGFyYW1z
CiAgICAgIHRoYXQgYXJlIHZhbGlkIHRvIHBhc3MgdG8gdGhlIGhhbmRsZXIgb3IgaXRzIHBhcmVu
dHMKCiAgICAgIEBwYXJhbSB7Um91dGVyfSByb3V0ZXIKICAgICAgQHBhcmFtIHtTdHJpbmd9IGhh
bmRsZXJOYW1lCiAgICAgIEByZXR1cm4ge0FycmF5W1N0cmluZ119IGEgbGlzdCBvZiBxdWVyeSBw
YXJhbWV0ZXJzCiAgICAqLwogICAgZnVuY3Rpb24gcXVlcnlQYXJhbXNGb3JIYW5kbGVyKHJvdXRl
ciwgaGFuZGxlck5hbWUpIHsKICAgICAgdmFyIGhhbmRsZXJzID0gcm91dGVyLnJlY29nbml6ZXIu
aGFuZGxlcnNGb3IoaGFuZGxlck5hbWUpLAogICAgICAgIHF1ZXJ5UGFyYW1zID0gW107CgogICAg
ICBmb3IgKHZhciBpID0gMDsgaSA8IGhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVl
cnlQYXJhbXMucHVzaC5hcHBseShxdWVyeVBhcmFtcywgaGFuZGxlcnNbaV0ucXVlcnlQYXJhbXMg
fHwgW10pOwogICAgICB9CgogICAgICByZXR1cm4gcXVlcnlQYXJhbXM7CiAgICB9CiAgICAvKioK
ICAgICAgQHByaXZhdGUKCiAgICAgIFRoaXMgbWV0aG9kIHRha2VzIGEgaGFuZGxlciBuYW1lIGFu
ZCBhIGxpc3Qgb2YgY29udGV4dHMgYW5kIHJldHVybnMKICAgICAgYSBzZXJpYWxpemVkIHBhcmFt
ZXRlciBoYXNoIHN1aXRhYmxlIHRvIHBhc3MgdG8gYHJlY29nbml6ZXIuZ2VuZXJhdGUoKWAuCgog
ICAgICBAcGFyYW0ge1JvdXRlcn0gcm91dGVyCiAgICAgIEBwYXJhbSB7U3RyaW5nfSBoYW5kbGVy
TmFtZQogICAgICBAcGFyYW0ge0FycmF5W09iamVjdF19IG9iamVjdHMKICAgICAgQHJldHVybiB7
T2JqZWN0fSBhIHNlcmlhbGl6ZWQgcGFyYW1ldGVyIGhhc2gKICAgICovCiAgICBmdW5jdGlvbiBw
YXJhbXNGb3JIYW5kbGVyKHJvdXRlciwgaGFuZGxlck5hbWUsIG9iamVjdHMsIHF1ZXJ5UGFyYW1z
KSB7CgogICAgICB2YXIgaGFuZGxlcnMgPSByb3V0ZXIucmVjb2duaXplci5oYW5kbGVyc0Zvciho
YW5kbGVyTmFtZSksCiAgICAgICAgICBwYXJhbXMgPSB7fSwKICAgICAgICAgIGhhbmRsZXJJbmZv
cyA9IGdlbmVyYXRlSGFuZGxlckluZm9zV2l0aFF1ZXJ5UGFyYW1zKHJvdXRlciwgaGFuZGxlcnMs
IHF1ZXJ5UGFyYW1zKSwKICAgICAgICAgIG1hdGNoUG9pbnQgPSBnZXRNYXRjaFBvaW50KHJvdXRl
ciwgaGFuZGxlckluZm9zLCBvYmplY3RzKS5tYXRjaFBvaW50LAogICAgICAgICAgbWVyZ2VkUXVl
cnlQYXJhbXMgPSB7fSwKICAgICAgICAgIG9iamVjdCwgaGFuZGxlck9iaiwgaGFuZGxlciwgbmFt
ZXMsIGk7CgogICAgICBwYXJhbXMucXVlcnlQYXJhbXMgPSB7fTsKCiAgICAgIGZvciAoaT0wOyBp
PGhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaGFuZGxlck9iaiA9IGhhbmRsZXJzW2ld
OwogICAgICAgIGhhbmRsZXIgPSByb3V0ZXIuZ2V0SGFuZGxlcihoYW5kbGVyT2JqLmhhbmRsZXIp
OwogICAgICAgIG5hbWVzID0gaGFuZGxlck9iai5uYW1lczsKCiAgICAgICAgLy8gSWYgaXQncyBh
IGR5bmFtaWMgc2VnbWVudAogICAgICAgIGlmIChuYW1lcy5sZW5ndGgpIHsKICAgICAgICAgIC8v
IElmIHdlIGhhdmUgb2JqZWN0cywgdXNlIHRoZW0KICAgICAgICAgIGlmIChpID49IG1hdGNoUG9p
bnQpIHsKICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0cy5zaGlmdCgpOwogICAgICAgICAgLy8g
T3RoZXJ3aXNlIHVzZSBleGlzdGluZyBjb250ZXh0CiAgICAgICAgICB9IGVsc2UgewogICAgICAg
ICAgICBvYmplY3QgPSBoYW5kbGVyLmNvbnRleHQ7CiAgICAgICAgICB9CgogICAgICAgICAgLy8g
U2VyaWFsaXplIHRvIGdlbmVyYXRlIHBhcmFtcwogICAgICAgICAgbWVyZ2UocGFyYW1zLCBzZXJp
YWxpemUoaGFuZGxlciwgb2JqZWN0LCBuYW1lcykpOwogICAgICAgIH0KICAgICAgICBpZiAocXVl
cnlQYXJhbXMgIT09IGZhbHNlKSB7CiAgICAgICAgICBtZXJnZVNvbWVLZXlzKHBhcmFtcy5xdWVy
eVBhcmFtcywgcm91dGVyLmN1cnJlbnRRdWVyeVBhcmFtcywgaGFuZGxlck9iai5xdWVyeVBhcmFt
cyk7CiAgICAgICAgICBtZXJnZVNvbWVLZXlzKHBhcmFtcy5xdWVyeVBhcmFtcywgcXVlcnlQYXJh
bXMsIGhhbmRsZXJPYmoucXVlcnlQYXJhbXMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYg
KHF1ZXJ5UGFyYW1zRXF1YWwocGFyYW1zLnF1ZXJ5UGFyYW1zLCB7fSkpIHsgZGVsZXRlIHBhcmFt
cy5xdWVyeVBhcmFtczsgfQogICAgICByZXR1cm4gcGFyYW1zOwogICAgfQoKICAgIGZ1bmN0aW9u
IG1lcmdlKGhhc2gsIG90aGVyKSB7CiAgICAgIGZvciAodmFyIHByb3AgaW4gb3RoZXIpIHsKICAg
ICAgICBpZiAob3RoZXIuaGFzT3duUHJvcGVydHkocHJvcCkpIHsgaGFzaFtwcm9wXSA9IG90aGVy
W3Byb3BdOyB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtZXJnZVNvbWVLZXlzKGhhc2gs
IG90aGVyLCBrZXlzKSB7CiAgICAgIGlmICghb3RoZXIgfHwgIWtleXMpIHsgcmV0dXJuOyB9CiAg
ICAgIGZvcih2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGtl
eSA9IGtleXNbaV0sIHZhbHVlOwogICAgICAgIGlmKG90aGVyLmhhc093blByb3BlcnR5KGtleSkp
IHsKICAgICAgICAgIHZhbHVlID0gb3RoZXJba2V5XTsKICAgICAgICAgIGlmKHZhbHVlID09PSBu
dWxsIHx8IHZhbHVlID09PSBmYWxzZSB8fCB0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7
CiAgICAgICAgICAgIGRlbGV0ZSBoYXNoW2tleV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAg
ICAgICBoYXNoW2tleV0gPSBvdGhlcltrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAg
fQogICAgfQoKICAgIC8qKgogICAgICBAcHJpdmF0ZQogICAgKi8KCiAgICBmdW5jdGlvbiBnZW5l
cmF0ZUhhbmRsZXJJbmZvc1dpdGhRdWVyeVBhcmFtcyhyb3V0ZXIsIGhhbmRsZXJzLCBxdWVyeVBh
cmFtcykgewogICAgICB2YXIgaGFuZGxlckluZm9zID0gW107CgogICAgICBmb3IgKHZhciBpID0g
MDsgaSA8IGhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBoYW5k
bGVyc1tpXSwKICAgICAgICAgIGhhbmRsZXJJbmZvID0geyBoYW5kbGVyOiBoYW5kbGVyLmhhbmRs
ZXIsIG5hbWVzOiBoYW5kbGVyLm5hbWVzLCBjb250ZXh0OiBoYW5kbGVyLmNvbnRleHQsIGlzRHlu
YW1pYzogaGFuZGxlci5pc0R5bmFtaWMgfSwKICAgICAgICAgIGFjdGl2ZVF1ZXJ5UGFyYW1zID0g
e307CgogICAgICAgIGlmIChxdWVyeVBhcmFtcyAhPT0gZmFsc2UpIHsKICAgICAgICAgIG1lcmdl
U29tZUtleXMoYWN0aXZlUXVlcnlQYXJhbXMsIHJvdXRlci5jdXJyZW50UXVlcnlQYXJhbXMsIGhh
bmRsZXIucXVlcnlQYXJhbXMpOwogICAgICAgICAgbWVyZ2VTb21lS2V5cyhhY3RpdmVRdWVyeVBh
cmFtcywgcXVlcnlQYXJhbXMsIGhhbmRsZXIucXVlcnlQYXJhbXMpOwogICAgICAgIH0KCiAgICAg
ICAgaWYgKGhhbmRsZXIucXVlcnlQYXJhbXMgJiYgaGFuZGxlci5xdWVyeVBhcmFtcy5sZW5ndGgg
PiAwKSB7CiAgICAgICAgICBoYW5kbGVySW5mby5xdWVyeVBhcmFtcyA9IGFjdGl2ZVF1ZXJ5UGFy
YW1zOwogICAgICAgIH0KCiAgICAgICAgaGFuZGxlckluZm9zLnB1c2goaGFuZGxlckluZm8pOwog
ICAgICB9CgogICAgICByZXR1cm4gaGFuZGxlckluZm9zOwogICAgfQoKICAgIC8qKgogICAgICBA
cHJpdmF0ZQogICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVF1ZXJ5UGFyYW1UcmFuc2l0aW9uKHJv
dXRlciwgcXVlcnlQYXJhbXMsIGlzSW50ZXJtZWRpYXRlKSB7CiAgICAgIHZhciBjdXJyZW50SGFu
ZGxlcnMgPSByb3V0ZXIuY3VycmVudEhhbmRsZXJJbmZvcywKICAgICAgICAgIGN1cnJlbnRIYW5k
bGVyID0gY3VycmVudEhhbmRsZXJzW2N1cnJlbnRIYW5kbGVycy5sZW5ndGggLSAxXSwKICAgICAg
ICAgIG5hbWUgPSBjdXJyZW50SGFuZGxlci5uYW1lOwoKICAgICAgbG9nKHJvdXRlciwgIkF0dGVt
cHRpbmcgcXVlcnkgcGFyYW0gdHJhbnNpdGlvbiIpOwoKICAgICAgcmV0dXJuIGNyZWF0ZU5hbWVk
VHJhbnNpdGlvbihyb3V0ZXIsIFtuYW1lLCBxdWVyeVBhcmFtc10sIGlzSW50ZXJtZWRpYXRlKTsK
ICAgIH0KCiAgICAvKioKICAgICAgQHByaXZhdGUKICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVO
YW1lZFRyYW5zaXRpb24ocm91dGVyLCBhcmdzLCBpc0ludGVybWVkaWF0ZSkgewogICAgICB2YXIg
cGFydGl0aW9uZWRBcmdzICAgICA9IGV4dHJhY3RRdWVyeVBhcmFtcyhhcmdzKSwKICAgICAgICBw
dXJlQXJncyAgICAgICAgICAgICAgPSBwYXJ0aXRpb25lZEFyZ3NbMF0sCiAgICAgICAgcXVlcnlQ
YXJhbXMgICAgICAgICAgID0gcGFydGl0aW9uZWRBcmdzWzFdLAogICAgICAgIGhhbmRsZXJzICAg
ICAgICAgICAgICA9IHJvdXRlci5yZWNvZ25pemVyLmhhbmRsZXJzRm9yKHB1cmVBcmdzWzBdKSwK
ICAgICAgICBoYW5kbGVySW5mb3MgICAgICAgICAgPSBnZW5lcmF0ZUhhbmRsZXJJbmZvc1dpdGhR
dWVyeVBhcmFtcyhyb3V0ZXIsIGhhbmRsZXJzLCBxdWVyeVBhcmFtcyk7CgoKICAgICAgbG9nKHJv
dXRlciwgIkF0dGVtcHRpbmcgdHJhbnNpdGlvbiB0byAiICsgcHVyZUFyZ3NbMF0pOwoKICAgICAg
cmV0dXJuIHBlcmZvcm1UcmFuc2l0aW9uKHJvdXRlciwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGhhbmRsZXJJbmZvcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWNl
LmNhbGwocHVyZUFyZ3MsIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVy
LmN1cnJlbnRQYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFt
cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpc0ludGVybWVkaWF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgIEBwcml2
YXRlCiAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlVVJMVHJhbnNpdGlvbihyb3V0ZXIsIHVybCwg
aXNJbnRlcm1lZGlhdGUpIHsKICAgICAgdmFyIHJlc3VsdHMgPSByb3V0ZXIucmVjb2duaXplci5y
ZWNvZ25pemUodXJsKSwKICAgICAgICAgIGN1cnJlbnRIYW5kbGVySW5mb3MgPSByb3V0ZXIuY3Vy
cmVudEhhbmRsZXJJbmZvcywKICAgICAgICAgIHF1ZXJ5UGFyYW1zID0ge30sCiAgICAgICAgICBp
LCBsZW47CgogICAgICBsb2cocm91dGVyLCAiQXR0ZW1wdGluZyBVUkwgdHJhbnNpdGlvbiB0byAi
ICsgdXJsKTsKCiAgICAgIGlmIChyZXN1bHRzKSB7CiAgICAgICAgLy8gTWFrZSBzdXJlIHRoaXMg
cm91dGUgaXMgYWN0dWFsbHkgYWNjZXNzaWJsZSBieSBVUkwuCiAgICAgICAgZm9yIChpID0gMCwg
bGVuID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewoKICAgICAgICAgIGlmIChyb3V0
ZXIuZ2V0SGFuZGxlcihyZXN1bHRzW2ldLmhhbmRsZXIpLmluYWNjZXNzaWJsZUJ5VVJMKSB7CiAg
ICAgICAgICAgIHJlc3VsdHMgPSBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0K
ICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghcmVzdWx0cykgewogICAgICAgIHJldHVybiBl
cnJvclRyYW5zaXRpb24ocm91dGVyLCBuZXcgUm91dGVyLlVucmVjb2duaXplZFVSTEVycm9yKHVy
bCkpOwogICAgICB9CgogICAgICBmb3IoaSA9IDAsIGxlbiA9IHJlc3VsdHMubGVuZ3RoOyBpIDwg
bGVuOyBpKyspIHsKICAgICAgICBtZXJnZShxdWVyeVBhcmFtcywgcmVzdWx0c1tpXS5xdWVyeVBh
cmFtcyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwZXJmb3JtVHJhbnNpdGlvbihyb3V0ZXIsIHJl
c3VsdHMsIFtdLCB7fSwgcXVlcnlQYXJhbXMsIG51bGwsIGlzSW50ZXJtZWRpYXRlKTsKICAgIH0K
CgogICAgLyoqCiAgICAgIEBwcml2YXRlCgogICAgICBUYWtlcyBhbiBBcnJheSBvZiBgSGFuZGxl
ckluZm9gcywgZmlndXJlcyBvdXQgd2hpY2ggb25lcyBhcmUKICAgICAgZXhpdGluZywgZW50ZXJp
bmcsIG9yIGNoYW5naW5nIGNvbnRleHRzLCBhbmQgY2FsbHMgdGhlCiAgICAgIHByb3BlciBoYW5k
bGVyIGhvb2tzLgoKICAgICAgRm9yIGV4YW1wbGUsIGNvbnNpZGVyIHRoZSBmb2xsb3dpbmcgdHJl
ZSBvZiBoYW5kbGVycy4gRWFjaCBoYW5kbGVyIGlzCiAgICAgIGZvbGxvd2VkIGJ5IHRoZSBVUkwg
c2VnbWVudCBpdCBoYW5kbGVzLgoKICAgICAgYGBgCiAgICAgIHx+aW5kZXggKCIvIikKICAgICAg
fCB8fnBvc3RzICgiL3Bvc3RzIikKICAgICAgfCB8IHwtc2hvd1Bvc3QgKCIvOmlkIikKICAgICAg
fCB8IHwtbmV3UG9zdCAoIi9uZXciKQogICAgICB8IHwgfC1lZGl0UG9zdCAoIi9lZGl0IikKICAg
ICAgfCB8fmFib3V0ICgiL2Fib3V0LzppZCIpCiAgICAgIGBgYAoKICAgICAgQ29uc2lkZXIgdGhl
IGZvbGxvd2luZyB0cmFuc2l0aW9uczoKCiAgICAgIDEuIEEgVVJMIHRyYW5zaXRpb24gdG8gYC9w
b3N0cy8xYC4KICAgICAgICAgMS4gVHJpZ2dlcnMgdGhlIGAqbW9kZWxgIGNhbGxiYWNrcyBvbiB0
aGUKICAgICAgICAgICAgYGluZGV4YCwgYHBvc3RzYCwgYW5kIGBzaG93UG9zdGAgaGFuZGxlcnMK
ICAgICAgICAgMi4gVHJpZ2dlcnMgdGhlIGBlbnRlcmAgY2FsbGJhY2sgb24gdGhlIHNhbWUKICAg
ICAgICAgMy4gVHJpZ2dlcnMgdGhlIGBzZXR1cGAgY2FsbGJhY2sgb24gdGhlIHNhbWUKICAgICAg
Mi4gQSBkaXJlY3QgdHJhbnNpdGlvbiB0byBgbmV3UG9zdGAKICAgICAgICAgMS4gVHJpZ2dlcnMg
dGhlIGBleGl0YCBjYWxsYmFjayBvbiBgc2hvd1Bvc3RgCiAgICAgICAgIDIuIFRyaWdnZXJzIHRo
ZSBgZW50ZXJgIGNhbGxiYWNrIG9uIGBuZXdQb3N0YAogICAgICAgICAzLiBUcmlnZ2VycyB0aGUg
YHNldHVwYCBjYWxsYmFjayBvbiBgbmV3UG9zdGAKICAgICAgMy4gQSBkaXJlY3QgdHJhbnNpdGlv
biB0byBgYWJvdXRgIHdpdGggYSBzcGVjaWZpZWQKICAgICAgICAgY29udGV4dCBvYmplY3QKICAg
ICAgICAgMS4gVHJpZ2dlcnMgdGhlIGBleGl0YCBjYWxsYmFjayBvbiBgbmV3UG9zdGAKICAgICAg
ICAgICAgYW5kIGBwb3N0c2AKICAgICAgICAgMi4gVHJpZ2dlcnMgdGhlIGBzZXJpYWxpemVgIGNh
bGxiYWNrIG9uIGBhYm91dGAKICAgICAgICAgMy4gVHJpZ2dlcnMgdGhlIGBlbnRlcmAgY2FsbGJh
Y2sgb24gYGFib3V0YAogICAgICAgICA0LiBUcmlnZ2VycyB0aGUgYHNldHVwYCBjYWxsYmFjayBv
biBgYWJvdXRgCgogICAgICBAcGFyYW0ge1RyYW5zaXRpb259IHRyYW5zaXRpb24KICAgICAgQHBh
cmFtIHtBcnJheVtIYW5kbGVySW5mb119IGhhbmRsZXJJbmZvcwogICAgKi8KICAgIGZ1bmN0aW9u
IHNldHVwQ29udGV4dHModHJhbnNpdGlvbiwgaGFuZGxlckluZm9zKSB7CiAgICAgIHZhciByb3V0
ZXIgPSB0cmFuc2l0aW9uLnJvdXRlciwKICAgICAgICAgIHBhcnRpdGlvbiA9IHBhcnRpdGlvbkhh
bmRsZXJzKHJvdXRlci5jdXJyZW50SGFuZGxlckluZm9zIHx8IFtdLCBoYW5kbGVySW5mb3MpOwoK
ICAgICAgcm91dGVyLnRhcmdldEhhbmRsZXJJbmZvcyA9IGhhbmRsZXJJbmZvczsKCiAgICAgIGVh
Y2hIYW5kbGVyKHBhcnRpdGlvbi5leGl0ZWQsIGZ1bmN0aW9uKGhhbmRsZXJJbmZvKSB7CiAgICAg
ICAgdmFyIGhhbmRsZXIgPSBoYW5kbGVySW5mby5oYW5kbGVyOwogICAgICAgIGRlbGV0ZSBoYW5k
bGVyLmNvbnRleHQ7CiAgICAgICAgaWYgKGhhbmRsZXIuZXhpdCkgeyBoYW5kbGVyLmV4aXQoKTsg
fQogICAgICB9KTsKCiAgICAgIHZhciBjdXJyZW50SGFuZGxlckluZm9zID0gcGFydGl0aW9uLnVu
Y2hhbmdlZC5zbGljZSgpOwogICAgICByb3V0ZXIuY3VycmVudEhhbmRsZXJJbmZvcyA9IGN1cnJl
bnRIYW5kbGVySW5mb3M7CgogICAgICBlYWNoSGFuZGxlcihwYXJ0aXRpb24udXBkYXRlZENvbnRl
eHQsIGZ1bmN0aW9uKGhhbmRsZXJJbmZvKSB7CiAgICAgICAgaGFuZGxlckVudGVyZWRPclVwZGF0
ZWQodHJhbnNpdGlvbiwgY3VycmVudEhhbmRsZXJJbmZvcywgaGFuZGxlckluZm8sIGZhbHNlKTsK
ICAgICAgfSk7CgogICAgICBlYWNoSGFuZGxlcihwYXJ0aXRpb24uZW50ZXJlZCwgZnVuY3Rpb24o
aGFuZGxlckluZm8pIHsKICAgICAgICBoYW5kbGVyRW50ZXJlZE9yVXBkYXRlZCh0cmFuc2l0aW9u
LCBjdXJyZW50SGFuZGxlckluZm9zLCBoYW5kbGVySW5mbywgdHJ1ZSk7CiAgICAgIH0pOwogICAg
fQoKICAgIC8qKgogICAgICBAcHJpdmF0ZQoKICAgICAgSGVscGVyIG1ldGhvZCB1c2VkIGJ5IHNl
dHVwQ29udGV4dHMuIEhhbmRsZXMgZXJyb3JzIG9yIHJlZGlyZWN0cwogICAgICB0aGF0IG1heSBo
YXBwZW4gaW4gZW50ZXIvc2V0dXAuCiAgICAqLwogICAgZnVuY3Rpb24gaGFuZGxlckVudGVyZWRP
clVwZGF0ZWQodHJhbnNpdGlvbiwgY3VycmVudEhhbmRsZXJJbmZvcywgaGFuZGxlckluZm8sIGVu
dGVyKSB7CiAgICAgIHZhciBoYW5kbGVyID0gaGFuZGxlckluZm8uaGFuZGxlciwKICAgICAgICAg
IGNvbnRleHQgPSBoYW5kbGVySW5mby5jb250ZXh0OwoKICAgICAgdHJ5IHsKICAgICAgICBpZiAo
ZW50ZXIgJiYgaGFuZGxlci5lbnRlcikgeyBoYW5kbGVyLmVudGVyKCk7IH0KICAgICAgICBjaGVj
a0Fib3J0KHRyYW5zaXRpb24pOwoKICAgICAgICBzZXRDb250ZXh0KGhhbmRsZXIsIGNvbnRleHQp
OwogICAgICAgIHNldFF1ZXJ5UGFyYW1zKGhhbmRsZXIsIGhhbmRsZXJJbmZvLnF1ZXJ5UGFyYW1z
KTsKCiAgICAgICAgaWYgKGhhbmRsZXIuc2V0dXApIHsgaGFuZGxlci5zZXR1cChjb250ZXh0LCBo
YW5kbGVySW5mby5xdWVyeVBhcmFtcyk7IH0KICAgICAgICBjaGVja0Fib3J0KHRyYW5zaXRpb24p
OwogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgUm91dGVyLlRy
YW5zaXRpb25BYm9ydGVkKSkgewogICAgICAgICAgLy8gVHJpZ2dlciB0aGUgYGVycm9yYCBldmVu
dCBzdGFydGluZyBmcm9tIHRoaXMgZmFpbGVkIGhhbmRsZXIuCiAgICAgICAgICB0cmFuc2l0aW9u
LnRyaWdnZXIodHJ1ZSwgJ2Vycm9yJywgZSwgdHJhbnNpdGlvbiwgaGFuZGxlcik7CiAgICAgICAg
fQoKICAgICAgICAvLyBQcm9wYWdhdGUgdGhlIGVycm9yIHNvIHRoYXQgdGhlIHRyYW5zaXRpb24g
cHJvbWlzZSB3aWxsIHJlamVjdC4KICAgICAgICB0aHJvdyBlOwogICAgICB9CgogICAgICBjdXJy
ZW50SGFuZGxlckluZm9zLnB1c2goaGFuZGxlckluZm8pOwogICAgfQoKCiAgICAvKioKICAgICAg
QHByaXZhdGUKCiAgICAgIEl0ZXJhdGVzIG92ZXIgYW4gYXJyYXkgb2YgYEhhbmRsZXJJbmZvYHMs
IHBhc3NpbmcgdGhlIGhhbmRsZXIKICAgICAgYW5kIGNvbnRleHQgaW50byB0aGUgY2FsbGJhY2su
CgogICAgICBAcGFyYW0ge0FycmF5W0hhbmRsZXJJbmZvXX0gaGFuZGxlckluZm9zCiAgICAgIEBw
YXJhbSB7RnVuY3Rpb24oT2JqZWN0LCBPYmplY3QpfSBjYWxsYmFjawogICAgKi8KICAgIGZ1bmN0
aW9uIGVhY2hIYW5kbGVyKGhhbmRsZXJJbmZvcywgY2FsbGJhY2spIHsKICAgICAgZm9yICh2YXIg
aT0wLCBsPWhhbmRsZXJJbmZvcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgY2FsbGJhY2so
aGFuZGxlckluZm9zW2ldKTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICBAcHJpdmF0ZQoK
ICAgICAgZGV0ZXJtaW5lcyBpZiB0d28gcXVlcnlwYXJhbSBvYmplY3RzIGFyZSB0aGUgc2FtZSBv
ciBub3QKICAgICoqLwogICAgZnVuY3Rpb24gcXVlcnlQYXJhbXNFcXVhbChhLCBiKSB7CiAgICAg
IGEgPSBhIHx8IHt9OwogICAgICBiID0gYiB8fCB7fTsKICAgICAgdmFyIGNoZWNrZWRLZXlzID0g
W10sIGtleTsKICAgICAgZm9yKGtleSBpbiBhKSB7CiAgICAgICAgaWYgKCFhLmhhc093blByb3Bl
cnR5KGtleSkpIHsgY29udGludWU7IH0KICAgICAgICBpZihiW2tleV0gIT09IGFba2V5XSkgeyBy
ZXR1cm4gZmFsc2U7IH0KICAgICAgICBjaGVja2VkS2V5cy5wdXNoKGtleSk7CiAgICAgIH0KICAg
ICAgZm9yKGtleSBpbiBiKSB7CiAgICAgICAgaWYgKCFiLmhhc093blByb3BlcnR5KGtleSkpIHsg
Y29udGludWU7IH0KICAgICAgICBpZiAofmNoZWNrZWRLZXlzLmluZGV4T2Yoa2V5KSkgeyBjb250
aW51ZTsgfQogICAgICAgIC8vIGIgaGFzIGEga2V5IG5vdCBpbiBhCiAgICAgICAgcmV0dXJuIGZh
bHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICBAcHJp
dmF0ZQoKICAgICAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB0cmFuc2l0aW9uaW5nIGZy
b20gb25lIFVSTCB0bwogICAgICBhbm90aGVyIHRvIGRldGVybWluZSB3aGljaCBoYW5kbGVycyBh
cmUgbm8gbG9uZ2VyIGFjdGl2ZSwKICAgICAgd2hpY2ggaGFuZGxlcnMgYXJlIG5ld2x5IGFjdGl2
ZSwgYW5kIHdoaWNoIGhhbmRsZXJzIHJlbWFpbgogICAgICBhY3RpdmUgYnV0IGhhdmUgdGhlaXIg
Y29udGV4dCBjaGFuZ2VkLgoKICAgICAgVGFrZSBhIGxpc3Qgb2Ygb2xkIGhhbmRsZXJzIGFuZCBu
ZXcgaGFuZGxlcnMgYW5kIHBhcnRpdGlvbgogICAgICB0aGVtIGludG8gZm91ciBidWNrZXRzOgoK
ICAgICAgKiB1bmNoYW5nZWQ6IHRoZSBoYW5kbGVyIHdhcyBhY3RpdmUgaW4gYm90aCB0aGUgb2xk
IGFuZAogICAgICAgIG5ldyBVUkwsIGFuZCBpdHMgY29udGV4dCByZW1haW5zIHRoZSBzYW1lCiAg
ICAgICogdXBkYXRlZCBjb250ZXh0OiB0aGUgaGFuZGxlciB3YXMgYWN0aXZlIGluIGJvdGggdGhl
CiAgICAgICAgb2xkIGFuZCBuZXcgVVJMLCBidXQgaXRzIGNvbnRleHQgY2hhbmdlZC4gVGhlIGhh
bmRsZXIncwogICAgICAgIGBzZXR1cGAgbWV0aG9kLCBpZiBhbnksIHdpbGwgYmUgY2FsbGVkIHdp
dGggdGhlIG5ldwogICAgICAgIGNvbnRleHQuCiAgICAgICogZXhpdGVkOiB0aGUgaGFuZGxlciB3
YXMgYWN0aXZlIGluIHRoZSBvbGQgVVJMLCBidXQgaXMKICAgICAgICBubyBsb25nZXIgYWN0aXZl
LgogICAgICAqIGVudGVyZWQ6IHRoZSBoYW5kbGVyIHdhcyBub3QgYWN0aXZlIGluIHRoZSBvbGQg
VVJMLCBidXQKICAgICAgICBpcyBub3cgYWN0aXZlLgoKICAgICAgVGhlIFBhcnRpdGlvbmVkSGFu
ZGxlcnMgc3RydWN0dXJlIGhhcyBmb3VyIGZpZWxkczoKCiAgICAgICogYHVwZGF0ZWRDb250ZXh0
YDogYSBsaXN0IG9mIGBIYW5kbGVySW5mb2Agb2JqZWN0cyB0aGF0CiAgICAgICAgcmVwcmVzZW50
IGhhbmRsZXJzIHRoYXQgcmVtYWluIGFjdGl2ZSBidXQgaGF2ZSBhIGNoYW5nZWQKICAgICAgICBj
b250ZXh0CiAgICAgICogYGVudGVyZWRgOiBhIGxpc3Qgb2YgYEhhbmRsZXJJbmZvYCBvYmplY3Rz
IHRoYXQgcmVwcmVzZW50CiAgICAgICAgaGFuZGxlcnMgdGhhdCBhcmUgbmV3bHkgYWN0aXZlCiAg
ICAgICogYGV4aXRlZGA6IGEgbGlzdCBvZiBgSGFuZGxlckluZm9gIG9iamVjdHMgdGhhdCBhcmUg
bm8KICAgICAgICBsb25nZXIgYWN0aXZlLgogICAgICAqIGB1bmNoYW5nZWRgOiBhIGxpc3Qgb2Yg
YEhhbmRlckluZm9gIG9iamVjdHMgdGhhdCByZW1haW4gYWN0aXZlLgoKICAgICAgQHBhcmFtIHtB
cnJheVtIYW5kbGVySW5mb119IG9sZEhhbmRsZXJzIGEgbGlzdCBvZiB0aGUgaGFuZGxlcgogICAg
ICAgIGluZm9ybWF0aW9uIGZvciB0aGUgcHJldmlvdXMgVVJMIChvciBgW11gIGlmIHRoaXMgaXMg
dGhlCiAgICAgICAgZmlyc3QgaGFuZGxlZCB0cmFuc2l0aW9uKQogICAgICBAcGFyYW0ge0FycmF5
W0hhbmRsZXJJbmZvXX0gbmV3SGFuZGxlcnMgYSBsaXN0IG9mIHRoZSBoYW5kbGVyCiAgICAgICAg
aW5mb3JtYXRpb24gZm9yIHRoZSBuZXcgVVJMCgogICAgICBAcmV0dXJuIHtQYXJ0aXRpb259CiAg
ICAqLwogICAgZnVuY3Rpb24gcGFydGl0aW9uSGFuZGxlcnMob2xkSGFuZGxlcnMsIG5ld0hhbmRs
ZXJzKSB7CiAgICAgIHZhciBoYW5kbGVycyA9IHsKICAgICAgICAgICAgdXBkYXRlZENvbnRleHQ6
IFtdLAogICAgICAgICAgICBleGl0ZWQ6IFtdLAogICAgICAgICAgICBlbnRlcmVkOiBbXSwKICAg
ICAgICAgICAgdW5jaGFuZ2VkOiBbXQogICAgICAgICAgfTsKCiAgICAgIHZhciBoYW5kbGVyQ2hh
bmdlZCwgY29udGV4dENoYW5nZWQsIHF1ZXJ5UGFyYW1zQ2hhbmdlZCwgaSwgbDsKCiAgICAgIGZv
ciAoaT0wLCBsPW5ld0hhbmRsZXJzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB2YXIgb2xk
SGFuZGxlciA9IG9sZEhhbmRsZXJzW2ldLCBuZXdIYW5kbGVyID0gbmV3SGFuZGxlcnNbaV07Cgog
ICAgICAgIGlmICghb2xkSGFuZGxlciB8fCBvbGRIYW5kbGVyLmhhbmRsZXIgIT09IG5ld0hhbmRs
ZXIuaGFuZGxlcikgewogICAgICAgICAgaGFuZGxlckNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0g
ZWxzZSBpZiAoIXF1ZXJ5UGFyYW1zRXF1YWwob2xkSGFuZGxlci5xdWVyeVBhcmFtcywgbmV3SGFu
ZGxlci5xdWVyeVBhcmFtcykpIHsKICAgICAgICAgIHF1ZXJ5UGFyYW1zQ2hhbmdlZCA9IHRydWU7
CiAgICAgICAgfQoKICAgICAgICBpZiAoaGFuZGxlckNoYW5nZWQpIHsKICAgICAgICAgIGhhbmRs
ZXJzLmVudGVyZWQucHVzaChuZXdIYW5kbGVyKTsKICAgICAgICAgIGlmIChvbGRIYW5kbGVyKSB7
IGhhbmRsZXJzLmV4aXRlZC51bnNoaWZ0KG9sZEhhbmRsZXIpOyB9CiAgICAgICAgfSBlbHNlIGlm
IChjb250ZXh0Q2hhbmdlZCB8fCBvbGRIYW5kbGVyLmNvbnRleHQgIT09IG5ld0hhbmRsZXIuY29u
dGV4dCB8fCBxdWVyeVBhcmFtc0NoYW5nZWQpIHsKICAgICAgICAgIGNvbnRleHRDaGFuZ2VkID0g
dHJ1ZTsKICAgICAgICAgIGhhbmRsZXJzLnVwZGF0ZWRDb250ZXh0LnB1c2gobmV3SGFuZGxlcik7
CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhhbmRsZXJzLnVuY2hhbmdlZC5wdXNoKG9sZEhh
bmRsZXIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChpPW5ld0hhbmRsZXJzLmxlbmd0
aCwgbD1vbGRIYW5kbGVycy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgaGFuZGxlcnMuZXhp
dGVkLnVuc2hpZnQob2xkSGFuZGxlcnNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gaGFuZGxl
cnM7CiAgICB9CgogICAgZnVuY3Rpb24gdHJpZ2dlcihyb3V0ZXIsIGhhbmRsZXJJbmZvcywgaWdu
b3JlRmFpbHVyZSwgYXJncykgewogICAgICBpZiAocm91dGVyLnRyaWdnZXJFdmVudCkgewogICAg
ICAgIHJvdXRlci50cmlnZ2VyRXZlbnQoaGFuZGxlckluZm9zLCBpZ25vcmVGYWlsdXJlLCBhcmdz
KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBuYW1lID0gYXJncy5zaGlmdCgp
OwoKICAgICAgaWYgKCFoYW5kbGVySW5mb3MpIHsKICAgICAgICBpZiAoaWdub3JlRmFpbHVyZSkg
eyByZXR1cm47IH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCB0cmlnZ2VyIGV2
ZW50ICciICsgbmFtZSArICInLiBUaGVyZSBhcmUgbm8gYWN0aXZlIGhhbmRsZXJzIik7CiAgICAg
IH0KCiAgICAgIHZhciBldmVudFdhc0hhbmRsZWQgPSBmYWxzZTsKCiAgICAgIGZvciAodmFyIGk9
aGFuZGxlckluZm9zLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHsKICAgICAgICB2YXIgaGFuZGxlcklu
Zm8gPSBoYW5kbGVySW5mb3NbaV0sCiAgICAgICAgICAgIGhhbmRsZXIgPSBoYW5kbGVySW5mby5o
YW5kbGVyOwoKICAgICAgICBpZiAoaGFuZGxlci5ldmVudHMgJiYgaGFuZGxlci5ldmVudHNbbmFt
ZV0pIHsKICAgICAgICAgIGlmIChoYW5kbGVyLmV2ZW50c1tuYW1lXS5hcHBseShoYW5kbGVyLCBh
cmdzKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBldmVudFdhc0hhbmRsZWQgPSB0cnVlOwogICAg
ICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0K
ICAgICAgfQoKICAgICAgaWYgKCFldmVudFdhc0hhbmRsZWQgJiYgIWlnbm9yZUZhaWx1cmUpIHsK
ICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdGhpbmcgaGFuZGxlZCB0aGUgZXZlbnQgJyIgKyBu
YW1lICsgIicuIik7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb250ZXh0KGhhbmRs
ZXIsIGNvbnRleHQpIHsKICAgICAgaGFuZGxlci5jb250ZXh0ID0gY29udGV4dDsKICAgICAgaWYg
KGhhbmRsZXIuY29udGV4dERpZENoYW5nZSkgeyBoYW5kbGVyLmNvbnRleHREaWRDaGFuZ2UoKTsg
fQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFF1ZXJ5UGFyYW1zKGhhbmRsZXIsIHF1ZXJ5UGFyYW1z
KSB7CiAgICAgIGhhbmRsZXIucXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtczsKICAgICAgaWYgKGhh
bmRsZXIucXVlcnlQYXJhbXNEaWRDaGFuZ2UpIHsgaGFuZGxlci5xdWVyeVBhcmFtc0RpZENoYW5n
ZSgpOyB9CiAgICB9CgoKICAgIC8qKgogICAgICBAcHJpdmF0ZQoKICAgICAgRXh0cmFjdHMgcXVl
cnkgcGFyYW1zIGZyb20gdGhlIGVuZCBvZiBhbiBhcnJheQogICAgKiovCgogICAgZnVuY3Rpb24g
ZXh0cmFjdFF1ZXJ5UGFyYW1zKGFycmF5KSB7CiAgICAgIHZhciBsZW4gPSAoYXJyYXkgJiYgYXJy
YXkubGVuZ3RoKSwgaGVhZCwgcXVlcnlQYXJhbXM7CgogICAgICBpZihsZW4gJiYgbGVuID4gMCAm
JiBhcnJheVtsZW4gLSAxXSAmJiBhcnJheVtsZW4gLSAxXS5oYXNPd25Qcm9wZXJ0eSgncXVlcnlQ
YXJhbXMnKSkgewogICAgICAgIHF1ZXJ5UGFyYW1zID0gYXJyYXlbbGVuIC0gMV0ucXVlcnlQYXJh
bXM7CiAgICAgICAgaGVhZCA9IHNsaWNlLmNhbGwoYXJyYXksIDAsIGxlbiAtIDEpOwogICAgICAg
IHJldHVybiBbaGVhZCwgcXVlcnlQYXJhbXNdOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVy
biBbYXJyYXksIG51bGxdOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGVyZm9ybUludGVy
bWVkaWF0ZVRyYW5zaXRpb24ocm91dGVyLCByZWNvZ0hhbmRsZXJzLCBtYXRjaFBvaW50UmVzdWx0
cykgewoKICAgICAgdmFyIGhhbmRsZXJJbmZvcyA9IGdlbmVyYXRlSGFuZGxlckluZm9zKHJvdXRl
ciwgcmVjb2dIYW5kbGVycyk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlckluZm9z
Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgdmFyIGhhbmRsZXJJbmZvID0gaGFuZGxlckluZm9zW2ld
OwogICAgICAgIGhhbmRsZXJJbmZvLmNvbnRleHQgPSBtYXRjaFBvaW50UmVzdWx0cy5wcm92aWRl
ZE1vZGVsc1toYW5kbGVySW5mby5uYW1lXTsKICAgICAgfQoKICAgICAgdmFyIHN0dWJiZWRUcmFu
c2l0aW9uID0gewogICAgICAgIHJvdXRlcjogcm91dGVyLAogICAgICAgIGlzQWJvcnRlZDogZmFs
c2UKICAgICAgfTsKCiAgICAgIHNldHVwQ29udGV4dHMoc3R1YmJlZFRyYW5zaXRpb24sIGhhbmRs
ZXJJbmZvcyk7CiAgICB9CgogICAgLyoqCiAgICAgIEBwcml2YXRlCgogICAgICBDcmVhdGVzLCBi
ZWdpbnMsIGFuZCByZXR1cm5zIGEgVHJhbnNpdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gcGVy
Zm9ybVRyYW5zaXRpb24ocm91dGVyLCByZWNvZ0hhbmRsZXJzLCBwcm92aWRlZE1vZGVsc0FycmF5
LCBwYXJhbXMsIHF1ZXJ5UGFyYW1zLCBkYXRhLCBpc0ludGVybWVkaWF0ZSkgewoKICAgICAgdmFy
IG1hdGNoUG9pbnRSZXN1bHRzID0gZ2V0TWF0Y2hQb2ludChyb3V0ZXIsIHJlY29nSGFuZGxlcnMs
IHByb3ZpZGVkTW9kZWxzQXJyYXksIHBhcmFtcywgcXVlcnlQYXJhbXMpLAogICAgICAgICAgdGFy
Z2V0TmFtZSA9IHJlY29nSGFuZGxlcnNbcmVjb2dIYW5kbGVycy5sZW5ndGggLSAxXS5oYW5kbGVy
LAogICAgICAgICAgd2FzVHJhbnNpdGlvbmluZyA9IGZhbHNlLAogICAgICAgICAgY3VycmVudEhh
bmRsZXJJbmZvcyA9IHJvdXRlci5jdXJyZW50SGFuZGxlckluZm9zOwoKICAgICAgaWYgKGlzSW50
ZXJtZWRpYXRlKSB7CiAgICAgICAgcmV0dXJuIHBlcmZvcm1JbnRlcm1lZGlhdGVUcmFuc2l0aW9u
KHJvdXRlciwgcmVjb2dIYW5kbGVycywgbWF0Y2hQb2ludFJlc3VsdHMpOwogICAgICB9CgogICAg
ICAvLyBDaGVjayBpZiB0aGVyZSdzIGFscmVhZHkgYSB0cmFuc2l0aW9uIHVuZGVyd2F5LgogICAg
ICBpZiAocm91dGVyLmFjdGl2ZVRyYW5zaXRpb24pIHsKICAgICAgICBpZiAodHJhbnNpdGlvbnNJ
ZGVudGljYWwocm91dGVyLmFjdGl2ZVRyYW5zaXRpb24sIHRhcmdldE5hbWUsIHByb3ZpZGVkTW9k
ZWxzQXJyYXksIHF1ZXJ5UGFyYW1zKSkgewogICAgICAgICAgcmV0dXJuIHJvdXRlci5hY3RpdmVU
cmFuc2l0aW9uOwogICAgICAgIH0KICAgICAgICByb3V0ZXIuYWN0aXZlVHJhbnNpdGlvbi5hYm9y
dCgpOwogICAgICAgIHdhc1RyYW5zaXRpb25pbmcgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIg
ZGVmZXJyZWQgPSBSU1ZQLmRlZmVyKCksCiAgICAgICAgICB0cmFuc2l0aW9uID0gbmV3IFRyYW5z
aXRpb24ocm91dGVyLCBkZWZlcnJlZC5wcm9taXNlKTsKCiAgICAgIHRyYW5zaXRpb24udGFyZ2V0
TmFtZSA9IHRhcmdldE5hbWU7CiAgICAgIHRyYW5zaXRpb24ucHJvdmlkZWRNb2RlbHMgPSBtYXRj
aFBvaW50UmVzdWx0cy5wcm92aWRlZE1vZGVsczsKICAgICAgdHJhbnNpdGlvbi5wcm92aWRlZE1v
ZGVsc0FycmF5ID0gcHJvdmlkZWRNb2RlbHNBcnJheTsKICAgICAgdHJhbnNpdGlvbi5wYXJhbXMg
PSBtYXRjaFBvaW50UmVzdWx0cy5wYXJhbXM7CiAgICAgIHRyYW5zaXRpb24uZGF0YSA9IGRhdGEg
fHwge307CiAgICAgIHRyYW5zaXRpb24ucXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtczsKICAgICAg
dHJhbnNpdGlvbi5waXZvdEhhbmRsZXIgPSBtYXRjaFBvaW50UmVzdWx0cy5waXZvdEhhbmRsZXI7
CiAgICAgIHJvdXRlci5hY3RpdmVUcmFuc2l0aW9uID0gdHJhbnNpdGlvbjsKCiAgICAgIHZhciBo
YW5kbGVySW5mb3MgPSBnZW5lcmF0ZUhhbmRsZXJJbmZvcyhyb3V0ZXIsIHJlY29nSGFuZGxlcnMp
OwogICAgICB0cmFuc2l0aW9uLmhhbmRsZXJJbmZvcyA9IGhhbmRsZXJJbmZvczsKCiAgICAgIC8v
IEZpcmUgJ3dpbGxUcmFuc2l0aW9uJyBldmVudCBvbiBjdXJyZW50IGhhbmRsZXJzLCBidXQgZG9u
J3QgZmlyZSBpdAogICAgICAvLyBpZiBhIHRyYW5zaXRpb24gd2FzIGFscmVhZHkgdW5kZXJ3YXku
CiAgICAgIGlmICghd2FzVHJhbnNpdGlvbmluZykgewogICAgICAgIHRyaWdnZXIocm91dGVyLCBj
dXJyZW50SGFuZGxlckluZm9zLCB0cnVlLCBbJ3dpbGxUcmFuc2l0aW9uJywgdHJhbnNpdGlvbl0p
OwogICAgICB9CgogICAgICBsb2cocm91dGVyLCB0cmFuc2l0aW9uLnNlcXVlbmNlLCAiQmVnaW5u
aW5nIHZhbGlkYXRpb24gZm9yIHRyYW5zaXRpb24gdG8gIiArIHRyYW5zaXRpb24udGFyZ2V0TmFt
ZSk7CiAgICAgIHZhbGlkYXRlRW50cnkodHJhbnNpdGlvbiwgbWF0Y2hQb2ludFJlc3VsdHMubWF0
Y2hQb2ludCwgbWF0Y2hQb2ludFJlc3VsdHMuaGFuZGxlclBhcmFtcykKICAgICAgICAgICAgICAg
ICAgIC50aGVuKHRyYW5zaXRpb25TdWNjZXNzLCB0cmFuc2l0aW9uRmFpbHVyZSk7CgogICAgICBy
ZXR1cm4gdHJhbnNpdGlvbjsKCiAgICAgIGZ1bmN0aW9uIHRyYW5zaXRpb25TdWNjZXNzKCkgewog
ICAgICAgIGNoZWNrQWJvcnQodHJhbnNpdGlvbik7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBm
aW5hbGl6ZVRyYW5zaXRpb24odHJhbnNpdGlvbiwgaGFuZGxlckluZm9zKTsKCiAgICAgICAgICAv
LyBjdXJyZW50SGFuZGxlckluZm9zIHdhcyB1cGRhdGVkIGluIGZpbmFsaXplVHJhbnNpdGlvbgog
ICAgICAgICAgdHJpZ2dlcihyb3V0ZXIsIHJvdXRlci5jdXJyZW50SGFuZGxlckluZm9zLCB0cnVl
LCBbJ2RpZFRyYW5zaXRpb24nXSk7CgogICAgICAgICAgaWYgKHJvdXRlci5kaWRUcmFuc2l0aW9u
KSB7CiAgICAgICAgICAgIHJvdXRlci5kaWRUcmFuc2l0aW9uKGhhbmRsZXJJbmZvcyk7CiAgICAg
ICAgICB9CgogICAgICAgICAgbG9nKHJvdXRlciwgdHJhbnNpdGlvbi5zZXF1ZW5jZSwgIlRSQU5T
SVRJT04gQ09NUExFVEUuIik7CgogICAgICAgICAgLy8gUmVzb2x2ZSB3aXRoIHRoZSBmaW5hbCBo
YW5kbGVyLgogICAgICAgICAgdHJhbnNpdGlvbi5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAg
ZGVmZXJyZWQucmVzb2x2ZShoYW5kbGVySW5mb3NbaGFuZGxlckluZm9zLmxlbmd0aCAtIDFdLmhh
bmRsZXIpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGUp
OwogICAgICAgIH0KCiAgICAgICAgLy8gRG9uJ3QgbnVsbGlmeSBpZiBhbm90aGVyIHRyYW5zaXRp
b24gaXMgdW5kZXJ3YXkgKG1lYW5pbmcKICAgICAgICAvLyB0aGVyZSB3YXMgYSB0cmFuc2l0aW9u
IGluaXRpYXRlZCB3aXRoIGVudGVyL3NldHVwKS4KICAgICAgICBpZiAoIXRyYW5zaXRpb24uaXNB
Ym9ydGVkKSB7CiAgICAgICAgICByb3V0ZXIuYWN0aXZlVHJhbnNpdGlvbiA9IG51bGw7CiAgICAg
ICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB0cmFuc2l0aW9uRmFpbHVyZShyZWFzb24pIHsK
ICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVhc29uKTsKICAgICAgfQogICAgfQoKICAgIC8qKgog
ICAgICBAcHJpdmF0ZQoKICAgICAgQWNjZXB0cyBoYW5kbGVycyBpbiBSZWNvZ25pemVyIGZvcm1h
dCwgZWl0aGVyIHJldHVybmVkIGZyb20KICAgICAgcmVjb2duaXplKCkgb3IgaGFuZGxlcnNGb3Io
KSwgYW5kIHJldHVybnMgdW5pZmllZAogICAgICBgSGFuZGxlckluZm9gcy4KICAgICAqLwogICAg
ZnVuY3Rpb24gZ2VuZXJhdGVIYW5kbGVySW5mb3Mocm91dGVyLCByZWNvZ0hhbmRsZXJzKSB7CiAg
ICAgIHZhciBoYW5kbGVySW5mb3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHJl
Y29nSGFuZGxlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICB2YXIgaGFuZGxlck9i
aiA9IHJlY29nSGFuZGxlcnNbaV0sCiAgICAgICAgICAgIGlzRHluYW1pYyA9IGhhbmRsZXJPYmou
aXNEeW5hbWljIHx8IChoYW5kbGVyT2JqLm5hbWVzICYmIGhhbmRsZXJPYmoubmFtZXMubGVuZ3Ro
KTsKCiAgICAgICAgdmFyIGhhbmRsZXJJbmZvID0gewogICAgICAgICAgaXNEeW5hbWljOiAhIWlz
RHluYW1pYywKICAgICAgICAgIG5hbWU6IGhhbmRsZXJPYmouaGFuZGxlciwKICAgICAgICAgIGhh
bmRsZXI6IHJvdXRlci5nZXRIYW5kbGVyKGhhbmRsZXJPYmouaGFuZGxlcikKICAgICAgICB9Owog
ICAgICAgIGlmKGhhbmRsZXJPYmoucXVlcnlQYXJhbXMpIHsKICAgICAgICAgIGhhbmRsZXJJbmZv
LnF1ZXJ5UGFyYW1zID0gaGFuZGxlck9iai5xdWVyeVBhcmFtczsKICAgICAgICB9CiAgICAgICAg
aGFuZGxlckluZm9zLnB1c2goaGFuZGxlckluZm8pOwogICAgICB9CiAgICAgIHJldHVybiBoYW5k
bGVySW5mb3M7CiAgICB9CgogICAgLyoqCiAgICAgIEBwcml2YXRlCiAgICAgKi8KICAgIGZ1bmN0
aW9uIHRyYW5zaXRpb25zSWRlbnRpY2FsKG9sZFRyYW5zaXRpb24sIHRhcmdldE5hbWUsIHByb3Zp
ZGVkTW9kZWxzQXJyYXksIHF1ZXJ5UGFyYW1zKSB7CgogICAgICBpZiAob2xkVHJhbnNpdGlvbi50
YXJnZXROYW1lICE9PSB0YXJnZXROYW1lKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgdmFyIG9s
ZE1vZGVscyA9IG9sZFRyYW5zaXRpb24ucHJvdmlkZWRNb2RlbHNBcnJheTsKICAgICAgaWYgKG9s
ZE1vZGVscy5sZW5ndGggIT09IHByb3ZpZGVkTW9kZWxzQXJyYXkubGVuZ3RoKSB7IHJldHVybiBm
YWxzZTsgfQoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG9sZE1vZGVscy5sZW5ndGg7IGkg
PCBsZW47ICsraSkgewogICAgICAgIGlmIChvbGRNb2RlbHNbaV0gIT09IHByb3ZpZGVkTW9kZWxz
QXJyYXlbaV0pIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgIH0KCiAgICAgIGlmKCFxdWVyeVBhcmFt
c0VxdWFsKG9sZFRyYW5zaXRpb24ucXVlcnlQYXJhbXMsIHF1ZXJ5UGFyYW1zKSkgewogICAgICAg
IHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq
CiAgICAgIEBwcml2YXRlCgogICAgICBVcGRhdGVzIHRoZSBVUkwgKGlmIG5lY2Vzc2FyeSkgYW5k
IGNhbGxzIGBzZXR1cENvbnRleHRzYAogICAgICB0byB1cGRhdGUgdGhlIHJvdXRlcidzIGFycmF5
IG9mIGBjdXJyZW50SGFuZGxlckluZm9zYC4KICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemVU
cmFuc2l0aW9uKHRyYW5zaXRpb24sIGhhbmRsZXJJbmZvcykgewoKICAgICAgbG9nKHRyYW5zaXRp
b24ucm91dGVyLCB0cmFuc2l0aW9uLnNlcXVlbmNlLCAiVmFsaWRhdGlvbiBzdWNjZWVkZWQsIGZp
bmFsaXppbmcgdHJhbnNpdGlvbjsiKTsKCiAgICAgIHZhciByb3V0ZXIgPSB0cmFuc2l0aW9uLnJv
dXRlciwKICAgICAgICAgIHNlcSA9IHRyYW5zaXRpb24uc2VxdWVuY2UsCiAgICAgICAgICBoYW5k
bGVyTmFtZSA9IGhhbmRsZXJJbmZvc1toYW5kbGVySW5mb3MubGVuZ3RoIC0gMV0ubmFtZSwKICAg
ICAgICAgIHVybE1ldGhvZCA9IHRyYW5zaXRpb24udXJsTWV0aG9kLAogICAgICAgICAgaTsKCiAg
ICAgIC8vIENvbGxlY3QgcGFyYW1zIGZvciBVUkwuCiAgICAgIHZhciBvYmplY3RzID0gW10sIHBy
b3ZpZGVkTW9kZWxzID0gdHJhbnNpdGlvbi5wcm92aWRlZE1vZGVsc0FycmF5LnNsaWNlKCk7CiAg
ICAgIGZvciAoaSA9IGhhbmRsZXJJbmZvcy5sZW5ndGggLSAxOyBpPj0wOyAtLWkpIHsKICAgICAg
ICB2YXIgaGFuZGxlckluZm8gPSBoYW5kbGVySW5mb3NbaV07CiAgICAgICAgaWYgKGhhbmRsZXJJ
bmZvLmlzRHluYW1pYykgewogICAgICAgICAgdmFyIHByb3ZpZGVkTW9kZWwgPSBwcm92aWRlZE1v
ZGVscy5wb3AoKTsKICAgICAgICAgIG9iamVjdHMudW5zaGlmdChpc1BhcmFtKHByb3ZpZGVkTW9k
ZWwpID8gcHJvdmlkZWRNb2RlbC50b1N0cmluZygpIDogaGFuZGxlckluZm8uY29udGV4dCk7CiAg
ICAgICAgfQoKICAgICAgICBpZiAoaGFuZGxlckluZm8uaGFuZGxlci5pbmFjY2Vzc2libGVCeVVS
TCkgewogICAgICAgICAgdXJsTWV0aG9kID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAg
IHZhciBuZXdRdWVyeVBhcmFtcyA9IHt9OwogICAgICBmb3IgKGkgPSBoYW5kbGVySW5mb3MubGVu
Z3RoIC0gMTsgaT49MDsgLS1pKSB7CiAgICAgICAgbWVyZ2UobmV3UXVlcnlQYXJhbXMsIGhhbmRs
ZXJJbmZvc1tpXS5xdWVyeVBhcmFtcyk7CiAgICAgIH0KICAgICAgcm91dGVyLmN1cnJlbnRRdWVy
eVBhcmFtcyA9IG5ld1F1ZXJ5UGFyYW1zOwoKCiAgICAgIHZhciBwYXJhbXMgPSBwYXJhbXNGb3JI
YW5kbGVyKHJvdXRlciwgaGFuZGxlck5hbWUsIG9iamVjdHMsIHRyYW5zaXRpb24ucXVlcnlQYXJh
bXMpOwoKICAgICAgcm91dGVyLmN1cnJlbnRQYXJhbXMgPSBwYXJhbXM7CgogICAgICBpZiAodXJs
TWV0aG9kKSB7CiAgICAgICAgdmFyIHVybCA9IHJvdXRlci5yZWNvZ25pemVyLmdlbmVyYXRlKGhh
bmRsZXJOYW1lLCBwYXJhbXMpOwoKICAgICAgICBpZiAodXJsTWV0aG9kID09PSAncmVwbGFjZScp
IHsKICAgICAgICAgIHJvdXRlci5yZXBsYWNlVVJMKHVybCk7CiAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgIC8vIEFzc3VtZSBldmVyeXRoaW5nIGVsc2UgaXMganVzdCBhIFVSTCB1cGRhdGUgZm9y
IG5vdy4KICAgICAgICAgIHJvdXRlci51cGRhdGVVUkwodXJsKTsKICAgICAgICB9CiAgICAgIH0K
CiAgICAgIHNldHVwQ29udGV4dHModHJhbnNpdGlvbiwgaGFuZGxlckluZm9zKTsKICAgIH0KCiAg
ICAvKioKICAgICAgQHByaXZhdGUKCiAgICAgIEludGVybmFsIGZ1bmN0aW9uIHVzZWQgdG8gY29u
c3RydWN0IHRoZSBjaGFpbiBvZiBwcm9taXNlcyB1c2VkCiAgICAgIHRvIHZhbGlkYXRlIGEgdHJh
bnNpdGlvbi4gV3JhcHMgY2FsbHMgdG8gYGJlZm9yZU1vZGVsYCwgYG1vZGVsYCwKICAgICAgYW5k
IGBhZnRlck1vZGVsYCBpbiBwcm9taXNlcywgYW5kIGNoZWNrcyBmb3IgcmVkaXJlY3RzL2Fib3J0
cwogICAgICBiZXR3ZWVuIGVhY2guCiAgICAgKi8KICAgIGZ1bmN0aW9uIHZhbGlkYXRlRW50cnko
dHJhbnNpdGlvbiwgbWF0Y2hQb2ludCwgaGFuZGxlclBhcmFtcykgewoKICAgICAgdmFyIGhhbmRs
ZXJJbmZvcyA9IHRyYW5zaXRpb24uaGFuZGxlckluZm9zLAogICAgICAgICAgaW5kZXggPSB0cmFu
c2l0aW9uLnJlc29sdmVJbmRleDsKCiAgICAgIGlmIChpbmRleCA9PT0gaGFuZGxlckluZm9zLmxl
bmd0aCkgewogICAgICAgIC8vIE5vIG1vcmUgY29udGV4dHMgdG8gcmVzb2x2ZS4KICAgICAgICBy
ZXR1cm4gUlNWUC5yZXNvbHZlKHRyYW5zaXRpb24ucmVzb2x2ZWRNb2RlbHMpOwogICAgICB9Cgog
ICAgICB2YXIgcm91dGVyID0gdHJhbnNpdGlvbi5yb3V0ZXIsCiAgICAgICAgICBoYW5kbGVySW5m
byA9IGhhbmRsZXJJbmZvc1tpbmRleF0sCiAgICAgICAgICBoYW5kbGVyID0gaGFuZGxlckluZm8u
aGFuZGxlciwKICAgICAgICAgIGhhbmRsZXJOYW1lID0gaGFuZGxlckluZm8ubmFtZSwKICAgICAg
ICAgIHNlcSA9IHRyYW5zaXRpb24uc2VxdWVuY2U7CgogICAgICBpZiAoaW5kZXggPCBtYXRjaFBv
aW50KSB7CiAgICAgICAgbG9nKHJvdXRlciwgc2VxLCBoYW5kbGVyTmFtZSArICI6IHVzaW5nIGNv
bnRleHQgZnJvbSBhbHJlYWR5LWFjdGl2ZSBoYW5kbGVyIik7CgogICAgICAgIC8vIFdlJ3JlIGJl
Zm9yZSB0aGUgbWF0Y2ggcG9pbnQsIHNvIGRvbid0IHJ1biBhbnkgaG9va3MsCiAgICAgICAgLy8g
anVzdCB1c2UgdGhlIGFscmVhZHkgcmVzb2x2ZWQgY29udGV4dCBmcm9tIHRoZSBoYW5kbGVyLgog
ICAgICAgIHRyYW5zaXRpb24ucmVzb2x2ZWRNb2RlbHNbaGFuZGxlckluZm8ubmFtZV0gPQogICAg
ICAgICAgdHJhbnNpdGlvbi5wcm92aWRlZE1vZGVsc1toYW5kbGVySW5mby5uYW1lXSB8fAogICAg
ICAgICAgaGFuZGxlckluZm8uaGFuZGxlci5jb250ZXh0OwogICAgICAgIHJldHVybiBwcm9jZWVk
KCk7CiAgICAgIH0KCiAgICAgIHRyYW5zaXRpb24udHJpZ2dlcih0cnVlLCAnd2lsbFJlc29sdmVN
b2RlbCcsIHRyYW5zaXRpb24sIGhhbmRsZXIpOwoKICAgICAgcmV0dXJuIFJTVlAucmVzb2x2ZSgp
LnRoZW4oaGFuZGxlQWJvcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGJlZm9y
ZU1vZGVsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVBYm9ydCkKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obW9kZWwpCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC50aGVuKGhhbmRsZUFib3J0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAudGhl
bihhZnRlck1vZGVsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVBYm9y
dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obnVsbCwgaGFuZGxlRXJyb3IpCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHByb2NlZWQpOwoKICAgICAgZnVuY3Rpb24g
aGFuZGxlQWJvcnQocmVzdWx0KSB7CiAgICAgICAgaWYgKHRyYW5zaXRpb24uaXNBYm9ydGVkKSB7
CiAgICAgICAgICBsb2codHJhbnNpdGlvbi5yb3V0ZXIsIHRyYW5zaXRpb24uc2VxdWVuY2UsICJk
ZXRlY3RlZCBhYm9ydC4iKTsKICAgICAgICAgIHJldHVybiBSU1ZQLnJlamVjdChuZXcgUm91dGVy
LlRyYW5zaXRpb25BYm9ydGVkKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsK
ICAgICAgfQoKICAgICAgZnVuY3Rpb24gaGFuZGxlRXJyb3IocmVhc29uKSB7CiAgICAgICAgaWYg
KHJlYXNvbiBpbnN0YW5jZW9mIFJvdXRlci5UcmFuc2l0aW9uQWJvcnRlZCB8fCB0cmFuc2l0aW9u
LmlzQWJvcnRlZCkgewogICAgICAgICAgLy8gaWYgdGhlIHRyYW5zaXRpb24gd2FzIGFib3J0ZWQg
YW5kICpubyBhZGRpdGlvbmFsKiBlcnJvciB3YXMgdGhyb3duLAogICAgICAgICAgLy8gcmVqZWN0
IHdpdGggdGhlIFJvdXRlci5UcmFuc2l0aW9uQWJvcnRlZCBpbnN0YW5jZQogICAgICAgICAgcmV0
dXJuIFJTVlAucmVqZWN0KHJlYXNvbik7CiAgICAgICAgfQoKICAgICAgICAvLyBvdGhlcndpc2Us
IHdlJ3JlIGhlcmUgYmVjYXVzZSBvZiBhIGRpZmZlcmVudCBlcnJvcgogICAgICAgIHRyYW5zaXRp
b24uYWJvcnQoKTsKCiAgICAgICAgbG9nKHJvdXRlciwgc2VxLCBoYW5kbGVyTmFtZSArICI6IGhh
bmRsaW5nIGVycm9yOiAiICsgcmVhc29uKTsKCiAgICAgICAgLy8gQW4gZXJyb3Igd2FzIHRocm93
biAvIHByb21pc2UgcmVqZWN0ZWQsIHNvIGZpcmUgYW4KICAgICAgICAvLyBgZXJyb3JgIGV2ZW50
IGZyb20gdGhpcyBoYW5kbGVyIGluZm8gdXAgdG8gcm9vdC4KICAgICAgICB0cmFuc2l0aW9uLnRy
aWdnZXIodHJ1ZSwgJ2Vycm9yJywgcmVhc29uLCB0cmFuc2l0aW9uLCBoYW5kbGVySW5mby5oYW5k
bGVyKTsKCiAgICAgICAgLy8gUHJvcGFnYXRlIHRoZSBvcmlnaW5hbCBlcnJvci4KICAgICAgICBy
ZXR1cm4gUlNWUC5yZWplY3QocmVhc29uKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYmVmb3Jl
TW9kZWwoKSB7CgogICAgICAgIGxvZyhyb3V0ZXIsIHNlcSwgaGFuZGxlck5hbWUgKyAiOiBjYWxs
aW5nIGJlZm9yZU1vZGVsIGhvb2siKTsKCiAgICAgICAgdmFyIGFyZ3M7CgogICAgICAgIGlmICho
YW5kbGVySW5mby5xdWVyeVBhcmFtcykgewogICAgICAgICAgYXJncyA9IFtoYW5kbGVySW5mby5x
dWVyeVBhcmFtcywgdHJhbnNpdGlvbl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFyZ3Mg
PSBbdHJhbnNpdGlvbl07CiAgICAgICAgfQoKICAgICAgICB2YXIgcCA9IGhhbmRsZXIuYmVmb3Jl
TW9kZWwgJiYgaGFuZGxlci5iZWZvcmVNb2RlbC5hcHBseShoYW5kbGVyLCBhcmdzKTsKICAgICAg
ICByZXR1cm4gKHAgaW5zdGFuY2VvZiBUcmFuc2l0aW9uKSA/IG51bGwgOiBwOwogICAgICB9Cgog
ICAgICBmdW5jdGlvbiBtb2RlbCgpIHsKICAgICAgICBsb2cocm91dGVyLCBzZXEsIGhhbmRsZXJO
YW1lICsgIjogcmVzb2x2aW5nIG1vZGVsIik7CiAgICAgICAgdmFyIHAgPSBnZXRNb2RlbChoYW5k
bGVySW5mbywgdHJhbnNpdGlvbiwgaGFuZGxlclBhcmFtc1toYW5kbGVyTmFtZV0sIGluZGV4ID49
IG1hdGNoUG9pbnQpOwogICAgICAgIHJldHVybiAocCBpbnN0YW5jZW9mIFRyYW5zaXRpb24pID8g
bnVsbCA6IHA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFmdGVyTW9kZWwoY29udGV4dCkgewoK
ICAgICAgICBsb2cocm91dGVyLCBzZXEsIGhhbmRsZXJOYW1lICsgIjogY2FsbGluZyBhZnRlck1v
ZGVsIGhvb2siKTsKCiAgICAgICAgLy8gUGFzcyB0aGUgY29udGV4dCBhbmQgcmVzb2x2ZWQgcGFy
ZW50IGNvbnRleHRzIHRvIGFmdGVyTW9kZWwsIGJ1dCB3ZSBkb24ndAogICAgICAgIC8vIHdhbnQg
dG8gdXNlIHRoZSB2YWx1ZSByZXR1cm5lZCBmcm9tIGBhZnRlck1vZGVsYCBpbiBhbnkgd2F5LCBi
dXQgcmF0aGVyCiAgICAgICAgLy8gYWx3YXlzIHJlc29sdmUgd2l0aCB0aGUgb3JpZ2luYWwgYGNv
bnRleHRgIG9iamVjdC4KCiAgICAgICAgdHJhbnNpdGlvbi5yZXNvbHZlZE1vZGVsc1toYW5kbGVy
SW5mby5uYW1lXSA9IGNvbnRleHQ7CgogICAgICAgIHZhciBhcmdzOwoKICAgICAgICBpZiAoaGFu
ZGxlckluZm8ucXVlcnlQYXJhbXMpIHsKICAgICAgICAgIGFyZ3MgPSBbY29udGV4dCwgaGFuZGxl
ckluZm8ucXVlcnlQYXJhbXMsIHRyYW5zaXRpb25dOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg
ICBhcmdzID0gW2NvbnRleHQsIHRyYW5zaXRpb25dOwogICAgICAgIH0KCiAgICAgICAgdmFyIHAg
PSBoYW5kbGVyLmFmdGVyTW9kZWwgJiYgaGFuZGxlci5hZnRlck1vZGVsLmFwcGx5KGhhbmRsZXIs
IGFyZ3MpOwogICAgICAgIHJldHVybiAocCBpbnN0YW5jZW9mIFRyYW5zaXRpb24pID8gbnVsbCA6
IHA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHByb2NlZWQoKSB7CiAgICAgICAgbG9nKHJvdXRl
ciwgc2VxLCBoYW5kbGVyTmFtZSArICI6IHZhbGlkYXRpb24gc3VjY2VlZGVkLCBwcm9jZWVkaW5n
Iik7CgogICAgICAgIGhhbmRsZXJJbmZvLmNvbnRleHQgPSB0cmFuc2l0aW9uLnJlc29sdmVkTW9k
ZWxzW2hhbmRsZXJJbmZvLm5hbWVdOwogICAgICAgIHRyYW5zaXRpb24ucmVzb2x2ZUluZGV4Kys7
CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlRW50cnkodHJhbnNpdGlvbiwgbWF0Y2hQb2ludCwgaGFu
ZGxlclBhcmFtcyk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgQHByaXZhdGUKCiAgICAg
IFRocm93cyBhIFRyYW5zaXRpb25BYm9ydGVkIGlmIHRoZSBwcm92aWRlZCB0cmFuc2l0aW9uIGhh
cyBiZWVuIGFib3J0ZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrQWJvcnQodHJhbnNpdGlv
bikgewogICAgICBpZiAodHJhbnNpdGlvbi5pc0Fib3J0ZWQpIHsKICAgICAgICBsb2codHJhbnNp
dGlvbi5yb3V0ZXIsIHRyYW5zaXRpb24uc2VxdWVuY2UsICJkZXRlY3RlZCBhYm9ydC4iKTsKICAg
ICAgICB0aHJvdyBuZXcgUm91dGVyLlRyYW5zaXRpb25BYm9ydGVkKCk7CiAgICAgIH0KICAgIH0K
CiAgICAvKioKICAgICAgQHByaXZhdGUKCiAgICAgIEVuY2Fwc3VsYXRlcyB0aGUgbG9naWMgZm9y
IHdoZXRoZXIgdG8gY2FsbCBgbW9kZWxgIG9uIGEgcm91dGUsCiAgICAgIG9yIHVzZSBvbmUgb2Yg
dGhlIG1vZGVscyBwcm92aWRlZCB0byBgdHJhbnNpdGlvblRvYC4KICAgICAqLwogICAgZnVuY3Rp
b24gZ2V0TW9kZWwoaGFuZGxlckluZm8sIHRyYW5zaXRpb24sIGhhbmRsZXJQYXJhbXMsIG5lZWRz
VXBkYXRlKSB7CiAgICAgIHZhciBoYW5kbGVyID0gaGFuZGxlckluZm8uaGFuZGxlciwKICAgICAg
ICAgIGhhbmRsZXJOYW1lID0gaGFuZGxlckluZm8ubmFtZSwgYXJnczsKCiAgICAgIGlmICghbmVl
ZHNVcGRhdGUgJiYgaGFuZGxlci5oYXNPd25Qcm9wZXJ0eSgnY29udGV4dCcpKSB7CiAgICAgICAg
cmV0dXJuIGhhbmRsZXIuY29udGV4dDsKICAgICAgfQoKICAgICAgaWYgKHRyYW5zaXRpb24ucHJv
dmlkZWRNb2RlbHMuaGFzT3duUHJvcGVydHkoaGFuZGxlck5hbWUpKSB7CiAgICAgICAgdmFyIHBy
b3ZpZGVkTW9kZWwgPSB0cmFuc2l0aW9uLnByb3ZpZGVkTW9kZWxzW2hhbmRsZXJOYW1lXTsKICAg
ICAgICByZXR1cm4gdHlwZW9mIHByb3ZpZGVkTW9kZWwgPT09ICdmdW5jdGlvbicgPyBwcm92aWRl
ZE1vZGVsKCkgOiBwcm92aWRlZE1vZGVsOwogICAgICB9CgogICAgICBpZiAoaGFuZGxlckluZm8u
cXVlcnlQYXJhbXMpIHsKICAgICAgICBhcmdzID0gW2hhbmRsZXJQYXJhbXMgfHwge30sIGhhbmRs
ZXJJbmZvLnF1ZXJ5UGFyYW1zLCB0cmFuc2l0aW9uXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBh
cmdzID0gW2hhbmRsZXJQYXJhbXMgfHwge30sIHRyYW5zaXRpb24sIGhhbmRsZXJJbmZvLnF1ZXJ5
UGFyYW1zXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhbmRsZXIubW9kZWwgJiYgaGFuZGxlci5t
b2RlbC5hcHBseShoYW5kbGVyLCBhcmdzKTsKICAgIH0KCiAgICAvKioKICAgICAgQHByaXZhdGUK
ICAgICAqLwogICAgZnVuY3Rpb24gbG9nKHJvdXRlciwgc2VxdWVuY2UsIG1zZykgewoKICAgICAg
aWYgKCFyb3V0ZXIubG9nKSB7IHJldHVybjsgfQoKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgg
PT09IDMpIHsKICAgICAgICByb3V0ZXIubG9nKCJUcmFuc2l0aW9uICMiICsgc2VxdWVuY2UgKyAi
OiAiICsgbXNnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtc2cgPSBzZXF1ZW5jZTsKICAgICAg
ICByb3V0ZXIubG9nKG1zZyk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgQHByaXZhdGUK
CiAgICAgIEJlZ2lucyBhbmQgcmV0dXJucyBhIFRyYW5zaXRpb24gYmFzZWQgb24gdGhlIHByb3Zp
ZGVkCiAgICAgIGFyZ3VtZW50cy4gQWNjZXB0cyBhcmd1bWVudHMgaW4gdGhlIGZvcm0gb2YgYm90
aCBVUkwKICAgICAgdHJhbnNpdGlvbnMgYW5kIG5hbWVkIHRyYW5zaXRpb25zLgoKICAgICAgQHBh
cmFtIHtSb3V0ZXJ9IHJvdXRlcgogICAgICBAcGFyYW0ge0FycmF5W09iamVjdF19IGFyZ3MgYXJn
dW1lbnRzIHBhc3NlZCB0byB0cmFuc2l0aW9uVG8sCiAgICAgICAgcmVwbGFjZVdpdGgsIG9yIGhh
bmRsZVVSTAogICAgKi8KICAgIGZ1bmN0aW9uIGRvVHJhbnNpdGlvbihyb3V0ZXIsIGFyZ3MsIGlz
SW50ZXJtZWRpYXRlKSB7CiAgICAgIC8vIE5vcm1hbGl6ZSBibGFuayB0cmFuc2l0aW9ucyB0byBy
b290IFVSTCB0cmFuc2l0aW9ucy4KICAgICAgdmFyIG5hbWUgPSBhcmdzWzBdIHx8ICcvJzsKCiAg
ICAgIGlmKGFyZ3MubGVuZ3RoID09PSAxICYmIGFyZ3NbMF0uaGFzT3duUHJvcGVydHkoJ3F1ZXJ5
UGFyYW1zJykpIHsKICAgICAgICByZXR1cm4gY3JlYXRlUXVlcnlQYXJhbVRyYW5zaXRpb24ocm91
dGVyLCBhcmdzWzBdLCBpc0ludGVybWVkaWF0ZSk7CiAgICAgIH0gZWxzZSBpZiAobmFtZS5jaGFy
QXQoMCkgPT09ICcvJykgewogICAgICAgIHJldHVybiBjcmVhdGVVUkxUcmFuc2l0aW9uKHJvdXRl
ciwgbmFtZSwgaXNJbnRlcm1lZGlhdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBj
cmVhdGVOYW1lZFRyYW5zaXRpb24ocm91dGVyLCBzbGljZS5jYWxsKGFyZ3MpLCBpc0ludGVybWVk
aWF0ZSk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgQHByaXZhdGUKCiAgICAgIFNlcmlh
bGl6ZXMgYSBoYW5kbGVyIHVzaW5nIGl0cyBjdXN0b20gYHNlcmlhbGl6ZWAgbWV0aG9kIG9yCiAg
ICAgIGJ5IGEgZGVmYXVsdCB0aGF0IGxvb2tzIHVwIHRoZSBleHBlY3RlZCBwcm9wZXJ0eSBuYW1l
IGZyb20KICAgICAgdGhlIGR5bmFtaWMgc2VnbWVudC4KCiAgICAgIEBwYXJhbSB7T2JqZWN0fSBo
YW5kbGVyIGEgcm91dGVyIGhhbmRsZXIKICAgICAgQHBhcmFtIHtPYmplY3R9IG1vZGVsIHRoZSBt
b2RlbCB0byBiZSBzZXJpYWxpemVkIGZvciB0aGlzIGhhbmRsZXIKICAgICAgQHBhcmFtIHtBcnJh
eVtPYmplY3RdfSBuYW1lcyB0aGUgbmFtZXMgYXJyYXkgYXR0YWNoZWQgdG8gYW4KICAgICAgICBo
YW5kbGVyIG9iamVjdCByZXR1cm5lZCBmcm9tIHJvdXRlci5yZWNvZ25pemVyLmhhbmRsZXJzRm9y
KCkKICAgICovCiAgICBmdW5jdGlvbiBzZXJpYWxpemUoaGFuZGxlciwgbW9kZWwsIG5hbWVzKSB7
CgogICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgIGlmIChpc1BhcmFtKG1vZGVsKSkgewogICAg
ICAgIG9iamVjdFtuYW1lc1swXV0gPSBtb2RlbDsKICAgICAgICByZXR1cm4gb2JqZWN0OwogICAg
ICB9CgogICAgICAvLyBVc2UgY3VzdG9tIHNlcmlhbGl6ZSBpZiBpdCBleGlzdHMuCiAgICAgIGlm
IChoYW5kbGVyLnNlcmlhbGl6ZSkgewogICAgICAgIHJldHVybiBoYW5kbGVyLnNlcmlhbGl6ZSht
b2RlbCwgbmFtZXMpOwogICAgICB9CgogICAgICBpZiAobmFtZXMubGVuZ3RoICE9PSAxKSB7IHJl
dHVybjsgfQoKICAgICAgdmFyIG5hbWUgPSBuYW1lc1swXTsKCiAgICAgIGlmICgvX2lkJC8udGVz
dChuYW1lKSkgewogICAgICAgIG9iamVjdFtuYW1lXSA9IG1vZGVsLmlkOwogICAgICB9IGVsc2Ug
ewogICAgICAgIG9iamVjdFtuYW1lXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHJldHVybiBvYmpl
Y3Q7CiAgICB9CiAgfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVy
CkBzdWJtb2R1bGUgZW1iZXItcm91dGluZwoqLwoKZnVuY3Rpb24gRFNMKG5hbWUpIHsKICB0aGlz
LnBhcmVudCA9IG5hbWU7CiAgdGhpcy5tYXRjaGVzID0gW107Cn0KCkRTTC5wcm90b3R5cGUgPSB7
CiAgcmVzb3VyY2U6IGZ1bmN0aW9uKG5hbWUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICBpZiAo
YXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykg
ewogICAgICBjYWxsYmFjayA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KCiAg
ICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICBvcHRpb25zID0ge307CiAgICB9
CgogICAgaWYgKHR5cGVvZiBvcHRpb25zLnBhdGggIT09ICdzdHJpbmcnKSB7CiAgICAgIG9wdGlv
bnMucGF0aCA9ICIvIiArIG5hbWU7CiAgICB9CgogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIHZh
ciBkc2wgPSBuZXcgRFNMKG5hbWUpOwogICAgICByb3V0ZShkc2wsICdsb2FkaW5nJyk7CiAgICAg
IHJvdXRlKGRzbCwgJ2Vycm9yJywgeyBwYXRoOiAiL191bnVzZWRfZHVtbXlfZXJyb3JfcGF0aF9y
b3V0ZV8iICsgbmFtZSArICIvOmVycm9yIiB9KTsKICAgICAgY2FsbGJhY2suY2FsbChkc2wpOwog
ICAgICB0aGlzLnB1c2gob3B0aW9ucy5wYXRoLCBuYW1lLCBkc2wuZ2VuZXJhdGUoKSwgb3B0aW9u
cy5xdWVyeVBhcmFtcyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnB1c2gob3B0aW9ucy5wYXRo
LCBuYW1lLCBudWxsLCBvcHRpb25zLnF1ZXJ5UGFyYW1zKTsKICAgIH0KCgogICAgICB9LAoKICBw
dXNoOiBmdW5jdGlvbih1cmwsIG5hbWUsIGNhbGxiYWNrLCBxdWVyeVBhcmFtcykgewogICAgdmFy
IHBhcnRzID0gbmFtZS5zcGxpdCgnLicpOwogICAgaWYgKHVybCA9PT0gIiIgfHwgdXJsID09PSAi
LyIgfHwgcGFydHNbcGFydHMubGVuZ3RoLTFdID09PSAiaW5kZXgiKSB7IHRoaXMuZXhwbGljaXRJ
bmRleCA9IHRydWU7IH0KCiAgICB0aGlzLm1hdGNoZXMucHVzaChbdXJsLCBuYW1lLCBjYWxsYmFj
aywgcXVlcnlQYXJhbXNdKTsKICB9LAoKICByb3V0ZTogZnVuY3Rpb24obmFtZSwgb3B0aW9ucykg
ewogICAgcm91dGUodGhpcywgbmFtZSwgb3B0aW9ucyk7CiAgICAgIH0sCgogIGdlbmVyYXRlOiBm
dW5jdGlvbigpIHsKICAgIHZhciBkc2xNYXRjaGVzID0gdGhpcy5tYXRjaGVzOwoKICAgIGlmICgh
dGhpcy5leHBsaWNpdEluZGV4KSB7CiAgICAgIHRoaXMucm91dGUoImluZGV4IiwgeyBwYXRoOiAi
LyIgfSk7CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgIGZvciAodmFy
IGk9MCwgbD1kc2xNYXRjaGVzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB2YXIgZHNsTWF0
Y2ggPSBkc2xNYXRjaGVzW2ldOwogICAgICAgIHZhciBtYXRjaE9iaiA9IG1hdGNoKGRzbE1hdGNo
WzBdKS50byhkc2xNYXRjaFsxXSwgZHNsTWF0Y2hbMl0pOwogICAgICAgICAgICAgIH0KICAgIH07
CiAgfQp9OwoKZnVuY3Rpb24gcm91dGUoZHNsLCBuYW1lLCBvcHRpb25zKSB7CiAgRW1iZXIuYXNz
ZXJ0KCJZb3UgbXVzdCB1c2UgYHRoaXMucmVzb3VyY2VgIHRvIG5lc3QiLCB0eXBlb2Ygb3B0aW9u
cyAhPT0gJ2Z1bmN0aW9uJyk7CgogIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICBpZiAodHlw
ZW9mIG9wdGlvbnMucGF0aCAhPT0gJ3N0cmluZycpIHsKICAgIG9wdGlvbnMucGF0aCA9ICIvIiAr
IG5hbWU7CiAgfQoKICBpZiAoZHNsLnBhcmVudCAmJiBkc2wucGFyZW50ICE9PSAnYXBwbGljYXRp
b24nKSB7CiAgICBuYW1lID0gZHNsLnBhcmVudCArICIuIiArIG5hbWU7CiAgfQoKICBkc2wucHVz
aChvcHRpb25zLnBhdGgsIG5hbWUsIG51bGwsIG9wdGlvbnMucXVlcnlQYXJhbXMpOwp9CgpEU0wu
bWFwID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICB2YXIgZHNsID0gbmV3IERTTCgpOwogIGNhbGxi
YWNrLmNhbGwoZHNsKTsKICByZXR1cm4gZHNsOwp9OwoKRW1iZXIuUm91dGVyRFNMID0gRFNMOwoK
fSkoKTsKCgoKKGZ1bmN0aW9uKCkgewp2YXIgZ2V0ID0gRW1iZXIuZ2V0OwoKLyoqCkBtb2R1bGUg
ZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1yb3V0aW5nCiovCgovKioKCiAgRmluZHMgYSBjb250cm9s
bGVyIGluc3RhbmNlLgoKICBAZm9yIEVtYmVyCiAgQG1ldGhvZCBjb250cm9sbGVyRm9yCiAgQHBy
aXZhdGUKKi8KRW1iZXIuY29udHJvbGxlckZvciA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgY29udHJv
bGxlck5hbWUsIGxvb2t1cE9wdGlvbnMpIHsKICByZXR1cm4gY29udGFpbmVyLmxvb2t1cCgnY29u
dHJvbGxlcjonICsgY29udHJvbGxlck5hbWUsIGxvb2t1cE9wdGlvbnMpOwp9OwoKLyoqCiAgR2Vu
ZXJhdGVzIGEgY29udHJvbGxlciBmYWN0b3J5CgogIFRoZSB0eXBlIG9mIHRoZSBnZW5lcmF0ZWQg
Y29udHJvbGxlciBmYWN0b3J5IGlzIGRlcml2ZWQKICBmcm9tIHRoZSBjb250ZXh0LiBJZiB0aGUg
Y29udGV4dCBpcyBhbiBhcnJheSBhbiBhcnJheSBjb250cm9sbGVyCiAgaXMgZ2VuZXJhdGVkLCBp
ZiBhbiBvYmplY3QsIGFuIG9iamVjdCBjb250cm9sbGVyIG90aGVyd2lzZSwgYSBiYXNpYwogIGNv
bnRyb2xsZXIgaXMgZ2VuZXJhdGVkLgoKICBZb3UgY2FuIGN1c3RvbWl6ZSB5b3VyIGdlbmVyYXRl
ZCBjb250cm9sbGVycyBieSBkZWZpbmluZwogIGBBcHAuT2JqZWN0Q29udHJvbGxlcmAgb3IgYEFw
cC5BcnJheUNvbnRyb2xsZXJgLgoKICBAZm9yIEVtYmVyCiAgQG1ldGhvZCBnZW5lcmF0ZUNvbnRy
b2xsZXJGYWN0b3J5CiAgQHByaXZhdGUKKi8KRW1iZXIuZ2VuZXJhdGVDb250cm9sbGVyRmFjdG9y
eSA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgY29udHJvbGxlck5hbWUsIGNvbnRleHQpIHsKICB2YXIg
RmFjdG9yeSwgZnVsbE5hbWUsIGluc3RhbmNlLCBuYW1lLCBmYWN0b3J5TmFtZSwgY29udHJvbGxl
clR5cGU7CgogIGlmIChjb250ZXh0ICYmIEVtYmVyLmlzQXJyYXkoY29udGV4dCkpIHsKICAgIGNv
bnRyb2xsZXJUeXBlID0gJ2FycmF5JzsKICB9IGVsc2UgaWYgKGNvbnRleHQpIHsKICAgIGNvbnRy
b2xsZXJUeXBlID0gJ29iamVjdCc7CiAgfSBlbHNlIHsKICAgIGNvbnRyb2xsZXJUeXBlID0gJ2Jh
c2ljJzsKICB9CgogIGZhY3RvcnlOYW1lID0gJ2NvbnRyb2xsZXI6JyArIGNvbnRyb2xsZXJUeXBl
OwoKICBGYWN0b3J5ID0gY29udGFpbmVyLmxvb2t1cEZhY3RvcnkoZmFjdG9yeU5hbWUpLmV4dGVu
ZCh7CiAgICBpc0dlbmVyYXRlZDogdHJ1ZSwKICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAg
ICAgcmV0dXJuICIoZ2VuZXJhdGVkICIgKyBjb250cm9sbGVyTmFtZSArICIgY29udHJvbGxlciki
OwogICAgfQogIH0pOwoKICBmdWxsTmFtZSA9ICdjb250cm9sbGVyOicgKyBjb250cm9sbGVyTmFt
ZTsKCiAgY29udGFpbmVyLnJlZ2lzdGVyKGZ1bGxOYW1lLCAgRmFjdG9yeSk7CgogIHJldHVybiBG
YWN0b3J5Owp9OwoKLyoqCiAgR2VuZXJhdGVzIGFuZCBpbnN0YW50aWF0ZXMgYSBjb250cm9sbGVy
LgoKICBUaGUgdHlwZSBvZiB0aGUgZ2VuZXJhdGVkIGNvbnRyb2xsZXIgZmFjdG9yeSBpcyBkZXJp
dmVkCiAgZnJvbSB0aGUgY29udGV4dC4gSWYgdGhlIGNvbnRleHQgaXMgYW4gYXJyYXkgYW4gYXJy
YXkgY29udHJvbGxlcgogIGlzIGdlbmVyYXRlZCwgaWYgYW4gb2JqZWN0LCBhbiBvYmplY3QgY29u
dHJvbGxlciBvdGhlcndpc2UsIGEgYmFzaWMKICBjb250cm9sbGVyIGlzIGdlbmVyYXRlZC4KCiAg
QGZvciBFbWJlcgogIEBtZXRob2QgZ2VuZXJhdGVDb250cm9sbGVyCiAgQHByaXZhdGUKKi8KRW1i
ZXIuZ2VuZXJhdGVDb250cm9sbGVyID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb250cm9sbGVyTmFt
ZSwgY29udGV4dCkgewogIEVtYmVyLmdlbmVyYXRlQ29udHJvbGxlckZhY3RvcnkoY29udGFpbmVy
LCBjb250cm9sbGVyTmFtZSwgY29udGV4dCk7CiAgdmFyIGZ1bGxOYW1lID0gJ2NvbnRyb2xsZXI6
JyArIGNvbnRyb2xsZXJOYW1lOwogIHZhciBpbnN0YW5jZSA9IGNvbnRhaW5lci5sb29rdXAoZnVs
bE5hbWUpOwoKICBpZiAoZ2V0KGluc3RhbmNlLCAnbmFtZXNwYWNlLkxPR19BQ1RJVkVfR0VORVJB
VElPTicpKSB7CiAgICBFbWJlci5Mb2dnZXIuaW5mbygiZ2VuZXJhdGVkIC0+ICIgKyBmdWxsTmFt
ZSwgeyBmdWxsTmFtZTogZnVsbE5hbWUgfSk7CiAgfQoKICByZXR1cm4gaW5zdGFuY2U7Cn07Cgp9
KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXIt
cm91dGluZwoqLwoKdmFyIFJvdXRlciA9IHJlcXVpcmVNb2R1bGUoInJvdXRlciIpWydkZWZhdWx0
J107CnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKdmFyIGRlZmluZVByb3Bl
cnR5ID0gRW1iZXIuZGVmaW5lUHJvcGVydHk7CnZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5z
bGljZTsKCnZhciBEZWZhdWx0VmlldyA9IEVtYmVyLl9NZXRhbW9ycGhWaWV3OwovKioKICBUaGUg
YEVtYmVyLlJvdXRlcmAgY2xhc3MgbWFuYWdlcyB0aGUgYXBwbGljYXRpb24gc3RhdGUgYW5kIFVS
THMuIFJlZmVyIHRvCiAgdGhlIFtyb3V0aW5nIGd1aWRlXShodHRwOi8vZW1iZXJqcy5jb20vZ3Vp
ZGVzL3JvdXRpbmcvKSBmb3IgZG9jdW1lbnRhdGlvbi4KCiAgQGNsYXNzIFJvdXRlcgogIEBuYW1l
c3BhY2UgRW1iZXIKICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKKi8KRW1iZXIuUm91dGVyID0gRW1i
ZXIuT2JqZWN0LmV4dGVuZChFbWJlci5FdmVudGVkLCB7CiAgLyoqCiAgICBUaGUgYGxvY2F0aW9u
YCBwcm9wZXJ0eSBkZXRlcm1pbmVzIHRoZSB0eXBlIG9mIFVSTCdzIHRoYXQgeW91cgogICAgYXBw
bGljYXRpb24gd2lsbCB1c2UuCgogICAgVGhlIGZvbGxvd2luZyBsb2NhdGlvbiB0eXBlcyBhcmUg
Y3VycmVudGx5IGF2YWlsYWJsZToKCiAgICAqIGBoYXNoYAogICAgKiBgaGlzdG9yeWAKICAgICog
YG5vbmVgCgogICAgQHByb3BlcnR5IGxvY2F0aW9uCiAgICBAZGVmYXVsdCAnaGFzaCcKICAgIEBz
ZWUge0VtYmVyLkxvY2F0aW9ufQogICovCiAgbG9jYXRpb246ICdoYXNoJywKCiAgaW5pdDogZnVu
Y3Rpb24oKSB7CiAgICB0aGlzLnJvdXRlciA9IHRoaXMuY29uc3RydWN0b3Iucm91dGVyIHx8IHRo
aXMuY29uc3RydWN0b3IubWFwKEVtYmVyLkspOwogICAgdGhpcy5fYWN0aXZlVmlld3MgPSB7fTsK
ICAgIHRoaXMuX3NldHVwTG9jYXRpb24oKTsKCiAgICBpZiAoZ2V0KHRoaXMsICduYW1lc3BhY2Uu
TE9HX1RSQU5TSVRJT05TX0lOVEVSTkFMJykpIHsKICAgICAgdGhpcy5yb3V0ZXIubG9nID0gRW1i
ZXIuTG9nZ2VyLmRlYnVnOwogICAgfQogIH0sCgogIC8qKgogICAgUmVwcmVzZW50cyB0aGUgY3Vy
cmVudCBVUkwuCgogICAgQG1ldGhvZCB1cmwKICAgIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBjdXJy
ZW50IFVSTC4KICAqLwogIHVybDogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICByZXR1
cm4gZ2V0KHRoaXMsICdsb2NhdGlvbicpLmdldFVSTCgpOwogIH0pLAoKICAvKioKICAgIEluaXRp
YWxpemVzIHRoZSBjdXJyZW50IHJvdXRlciBpbnN0YW5jZSBhbmQgc2V0cyB1cCB0aGUgY2hhbmdl
IGhhbmRsaW5nCiAgICBldmVudCBsaXN0ZW5lcnMgdXNlZCBieSB0aGUgaW5zdGFuY2VzIGBsb2Nh
dGlvbmAgaW1wbGVtZW50YXRpb24uCgogICAgQG1ldGhvZCBzdGFydFJvdXRpbmcKICAgIEBwcml2
YXRlCiAgKi8KICBzdGFydFJvdXRpbmc6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5yb3V0ZXIgPSB0
aGlzLnJvdXRlciB8fCB0aGlzLmNvbnN0cnVjdG9yLm1hcChFbWJlci5LKTsKCiAgICB2YXIgcm91
dGVyID0gdGhpcy5yb3V0ZXIsCiAgICAgICAgbG9jYXRpb24gPSBnZXQodGhpcywgJ2xvY2F0aW9u
JyksCiAgICAgICAgY29udGFpbmVyID0gdGhpcy5jb250YWluZXIsCiAgICAgICAgc2VsZiA9IHRo
aXM7CgogICAgdGhpcy5fc2V0dXBSb3V0ZXIocm91dGVyLCBsb2NhdGlvbik7CgogICAgY29udGFp
bmVyLnJlZ2lzdGVyKCd2aWV3OmRlZmF1bHQnLCBEZWZhdWx0Vmlldyk7CiAgICBjb250YWluZXIu
cmVnaXN0ZXIoJ3ZpZXc6dG9wbGV2ZWwnLCBFbWJlci5WaWV3LmV4dGVuZCgpKTsKCiAgICBsb2Nh
dGlvbi5vblVwZGF0ZVVSTChmdW5jdGlvbih1cmwpIHsKICAgICAgc2VsZi5oYW5kbGVVUkwodXJs
KTsKICAgIH0pOwoKICAgIHRoaXMuaGFuZGxlVVJMKGxvY2F0aW9uLmdldFVSTCgpKTsKICB9LAoK
ICAvKioKICAgIEhhbmRsZXMgdXBkYXRpbmcgdGhlIHBhdGhzIGFuZCBub3RpZnlpbmcgYW55IGxp
c3RlbmVycyBvZiB0aGUgVVJMCiAgICBjaGFuZ2UuCgogICAgVHJpZ2dlcnMgdGhlIHJvdXRlciBs
ZXZlbCBgZGlkVHJhbnNpdGlvbmAgaG9vay4KCiAgICBAbWV0aG9kIGRpZFRyYW5zaXRpb24KICAg
IEBwcml2YXRlCiAgKi8KICBkaWRUcmFuc2l0aW9uOiBmdW5jdGlvbihpbmZvcykgewogICAgdXBk
YXRlUGF0aHModGhpcyk7CgogICAgdGhpcy5fY2FuY2VsTG9hZGluZ0V2ZW50KCk7CgogICAgdGhp
cy5ub3RpZnlQcm9wZXJ0eUNoYW5nZSgndXJsJyk7CgogICAgLy8gUHV0IHRoaXMgaW4gdGhlIHJ1
bmxvb3Agc28gdXJsIHdpbGwgYmUgYWNjdXJhdGUuIFNlZW1zCiAgICAvLyBsZXNzIHN1cnByaXNp
bmcgdGhhbiBkaWRUcmFuc2l0aW9uIGJlaW5nIG91dCBvZiBzeW5jLgogICAgRW1iZXIucnVuLm9u
Y2UodGhpcywgdGhpcy50cmlnZ2VyLCAnZGlkVHJhbnNpdGlvbicpOwoKICAgIGlmIChnZXQodGhp
cywgJ25hbWVzcGFjZScpLkxPR19UUkFOU0lUSU9OUykgewogICAgICBFbWJlci5Mb2dnZXIubG9n
KCJUcmFuc2l0aW9uZWQgaW50byAnIiArIEVtYmVyLlJvdXRlci5fcm91dGVQYXRoKGluZm9zKSAr
ICInIik7CiAgICB9CiAgfSwKCiAgaGFuZGxlVVJMOiBmdW5jdGlvbih1cmwpIHsKICAgIHJldHVy
biB0aGlzLl9kb1RyYW5zaXRpb24oJ2hhbmRsZVVSTCcsIFt1cmxdKTsKICB9LAoKICB0cmFuc2l0
aW9uVG86IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuX2RvVHJhbnNpdGlvbigndHJhbnNp
dGlvblRvJywgYXJndW1lbnRzKTsKICB9LAoKICBpbnRlcm1lZGlhdGVUcmFuc2l0aW9uVG86IGZ1
bmN0aW9uKCkgewogICAgdGhpcy5yb3V0ZXIuaW50ZXJtZWRpYXRlVHJhbnNpdGlvblRvLmFwcGx5
KHRoaXMucm91dGVyLCBhcmd1bWVudHMpOwoKICAgIHVwZGF0ZVBhdGhzKHRoaXMpOwoKICAgIHZh
ciBpbmZvcyA9IHRoaXMucm91dGVyLmN1cnJlbnRIYW5kbGVySW5mb3M7CiAgICBpZiAoZ2V0KHRo
aXMsICduYW1lc3BhY2UnKS5MT0dfVFJBTlNJVElPTlMpIHsKICAgICAgRW1iZXIuTG9nZ2VyLmxv
ZygiSW50ZXJtZWRpYXRlLXRyYW5zaXRpb25lZCBpbnRvICciICsgRW1iZXIuUm91dGVyLl9yb3V0
ZVBhdGgoaW5mb3MpICsgIiciKTsKICAgIH0KICB9LAoKICByZXBsYWNlV2l0aDogZnVuY3Rpb24o
KSB7CiAgICByZXR1cm4gdGhpcy5fZG9UcmFuc2l0aW9uKCdyZXBsYWNlV2l0aCcsIGFyZ3VtZW50
cyk7CiAgfSwKCiAgZ2VuZXJhdGU6IGZ1bmN0aW9uKCkgewogICAgdmFyIHVybCA9IHRoaXMucm91
dGVyLmdlbmVyYXRlLmFwcGx5KHRoaXMucm91dGVyLCBhcmd1bWVudHMpOwogICAgcmV0dXJuIHRo
aXMubG9jYXRpb24uZm9ybWF0VVJMKHVybCk7CiAgfSwKCiAgLyoqCiAgICBEZXRlcm1pbmVzIGlm
IHRoZSBzdXBwbGllZCByb3V0ZSBpcyBjdXJyZW50bHkgYWN0aXZlLgoKICAgIEBtZXRob2QgaXNB
Y3RpdmUKICAgIEBwYXJhbSByb3V0ZU5hbWUKICAgIEByZXR1cm5zIHtCb29sZWFufQogICAgQHBy
aXZhdGUKICAqLwogIGlzQWN0aXZlOiBmdW5jdGlvbihyb3V0ZU5hbWUpIHsKICAgIHZhciByb3V0
ZXIgPSB0aGlzLnJvdXRlcjsKICAgIHJldHVybiByb3V0ZXIuaXNBY3RpdmUuYXBwbHkocm91dGVy
LCBhcmd1bWVudHMpOwogIH0sCgogIHNlbmQ6IGZ1bmN0aW9uKG5hbWUsIGNvbnRleHQpIHsKICAg
IHRoaXMucm91dGVyLnRyaWdnZXIuYXBwbHkodGhpcy5yb3V0ZXIsIGFyZ3VtZW50cyk7CiAgfSwK
CiAgLyoqCiAgICBEb2VzIHRoaXMgcm91dGVyIGluc3RhbmNlIGhhdmUgdGhlIGdpdmVuIHJvdXRl
LgoKICAgIEBtZXRob2QgaGFzUm91dGUKICAgIEByZXR1cm5zIHtCb29sZWFufQogICAgQHByaXZh
dGUKICAqLwogIGhhc1JvdXRlOiBmdW5jdGlvbihyb3V0ZSkgewogICAgcmV0dXJuIHRoaXMucm91
dGVyLmhhc1JvdXRlKHJvdXRlKTsKICB9LAoKICAvKioKICAgIFJlc2V0cyB0aGUgc3RhdGUgb2Yg
dGhlIHJvdXRlciBieSBjbGVhcmluZyB0aGUgY3VycmVudCByb3V0ZQogICAgaGFuZGxlcnMgYW5k
IGRlYWN0aXZhdGluZyB0aGVtLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIHJlc2V0CiAgICov
CiAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5yb3V0ZXIucmVzZXQoKTsKICB9LAoKICB3
aWxsRGVzdHJveTogZnVuY3Rpb24oKXsKICAgIHZhciBsb2NhdGlvbiA9IGdldCh0aGlzLCAnbG9j
YXRpb24nKTsKICAgIGxvY2F0aW9uLmRlc3Ryb3koKTsKCiAgICB0aGlzLl9zdXBlci5hcHBseSh0
aGlzLCBhcmd1bWVudHMpOwogIH0sCgogIF9sb29rdXBBY3RpdmVWaWV3OiBmdW5jdGlvbih0ZW1w
bGF0ZU5hbWUpIHsKICAgIHZhciBhY3RpdmUgPSB0aGlzLl9hY3RpdmVWaWV3c1t0ZW1wbGF0ZU5h
bWVdOwogICAgcmV0dXJuIGFjdGl2ZSAmJiBhY3RpdmVbMF07CiAgfSwKCiAgX2Nvbm5lY3RBY3Rp
dmVWaWV3OiBmdW5jdGlvbih0ZW1wbGF0ZU5hbWUsIHZpZXcpIHsKICAgIHZhciBleGlzdGluZyA9
IHRoaXMuX2FjdGl2ZVZpZXdzW3RlbXBsYXRlTmFtZV07CgogICAgaWYgKGV4aXN0aW5nKSB7CiAg
ICAgIGV4aXN0aW5nWzBdLm9mZignd2lsbERlc3Ryb3lFbGVtZW50JywgdGhpcywgZXhpc3Rpbmdb
MV0pOwogICAgfQoKICAgIHZhciBkaXNjb25uZWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0
ZSB0aGlzLl9hY3RpdmVWaWV3c1t0ZW1wbGF0ZU5hbWVdOwogICAgfTsKCiAgICB0aGlzLl9hY3Rp
dmVWaWV3c1t0ZW1wbGF0ZU5hbWVdID0gW3ZpZXcsIGRpc2Nvbm5lY3RdOwogICAgdmlldy5vbmUo
J3dpbGxEZXN0cm95RWxlbWVudCcsIHRoaXMsIGRpc2Nvbm5lY3QpOwogIH0sCgogIF9zZXR1cExv
Y2F0aW9uOiBmdW5jdGlvbigpIHsKICAgIHZhciBsb2NhdGlvbiA9IGdldCh0aGlzLCAnbG9jYXRp
b24nKSwKICAgICAgICByb290VVJMID0gZ2V0KHRoaXMsICdyb290VVJMJyksCiAgICAgICAgb3B0
aW9ucyA9IHt9OwoKICAgIGlmICh0eXBlb2Ygcm9vdFVSTCA9PT0gJ3N0cmluZycpIHsKICAgICAg
b3B0aW9ucy5yb290VVJMID0gcm9vdFVSTDsKICAgIH0KCiAgICBpZiAoJ3N0cmluZycgPT09IHR5
cGVvZiBsb2NhdGlvbikgewogICAgICBvcHRpb25zLmltcGxlbWVudGF0aW9uID0gbG9jYXRpb247
CiAgICAgIGxvY2F0aW9uID0gc2V0KHRoaXMsICdsb2NhdGlvbicsIEVtYmVyLkxvY2F0aW9uLmNy
ZWF0ZShvcHRpb25zKSk7CiAgICB9CgogICAgLy8gZW5zdXJlIHRoYXQgaW5pdFN0YXRlIGlzIGNh
bGxlZCBBRlRFUiB0aGUgcm9vdFVSTCBpcyBzZXQgb24KICAgIC8vIHRoZSBsb2NhdGlvbiBpbnN0
YW5jZQogICAgaWYgKHR5cGVvZiBsb2NhdGlvbi5pbml0U3RhdGUgPT09ICdmdW5jdGlvbicpIHsg
bG9jYXRpb24uaW5pdFN0YXRlKCk7IH0KICB9LAoKICBfZ2V0SGFuZGxlckZ1bmN0aW9uOiBmdW5j
dGlvbigpIHsKICAgIHZhciBzZWVuID0ge30sIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLAog
ICAgICAgIERlZmF1bHRSb3V0ZSA9IGNvbnRhaW5lci5sb29rdXBGYWN0b3J5KCdyb3V0ZTpiYXNp
YycpLAogICAgICAgIHNlbGYgPSB0aGlzOwoKICAgIHJldHVybiBmdW5jdGlvbihuYW1lKSB7CiAg
ICAgIHZhciByb3V0ZU5hbWUgPSAncm91dGU6JyArIG5hbWUsCiAgICAgICAgICBoYW5kbGVyID0g
Y29udGFpbmVyLmxvb2t1cChyb3V0ZU5hbWUpOwoKICAgICAgaWYgKHNlZW5bbmFtZV0pIHsgcmV0
dXJuIGhhbmRsZXI7IH0KCiAgICAgIHNlZW5bbmFtZV0gPSB0cnVlOwoKICAgICAgaWYgKCFoYW5k
bGVyKSB7CiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKHJvdXRlTmFtZSwgRGVmYXVsdFJvdXRl
LmV4dGVuZCgpKTsKICAgICAgICBoYW5kbGVyID0gY29udGFpbmVyLmxvb2t1cChyb3V0ZU5hbWUp
OwoKICAgICAgICBpZiAoZ2V0KHNlbGYsICduYW1lc3BhY2UuTE9HX0FDVElWRV9HRU5FUkFUSU9O
JykpIHsKICAgICAgICAgIEVtYmVyLkxvZ2dlci5pbmZvKCJnZW5lcmF0ZWQgLT4gIiArIHJvdXRl
TmFtZSwgeyBmdWxsTmFtZTogcm91dGVOYW1lIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAg
aGFuZGxlci5yb3V0ZU5hbWUgPSBuYW1lOwogICAgICByZXR1cm4gaGFuZGxlcjsKICAgIH07CiAg
fSwKCiAgX3NldHVwUm91dGVyOiBmdW5jdGlvbihyb3V0ZXIsIGxvY2F0aW9uKSB7CiAgICB2YXIg
bGFzdFVSTCwgZW1iZXJSb3V0ZXIgPSB0aGlzOwoKICAgIHJvdXRlci5nZXRIYW5kbGVyID0gdGhp
cy5fZ2V0SGFuZGxlckZ1bmN0aW9uKCk7CgogICAgdmFyIGRvVXBkYXRlVVJMID0gZnVuY3Rpb24o
KSB7CiAgICAgIGxvY2F0aW9uLnNldFVSTChsYXN0VVJMKTsKICAgIH07CgogICAgcm91dGVyLnVw
ZGF0ZVVSTCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgbGFzdFVSTCA9IHBhdGg7CiAgICAgIEVt
YmVyLnJ1bi5vbmNlKGRvVXBkYXRlVVJMKTsKICAgIH07CgogICAgaWYgKGxvY2F0aW9uLnJlcGxh
Y2VVUkwpIHsKICAgICAgdmFyIGRvUmVwbGFjZVVSTCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxv
Y2F0aW9uLnJlcGxhY2VVUkwobGFzdFVSTCk7CiAgICAgIH07CgogICAgICByb3V0ZXIucmVwbGFj
ZVVSTCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgICBsYXN0VVJMID0gcGF0aDsKICAgICAgICBF
bWJlci5ydW4ub25jZShkb1JlcGxhY2VVUkwpOwogICAgICB9OwogICAgfQoKICAgIHJvdXRlci5k
aWRUcmFuc2l0aW9uID0gZnVuY3Rpb24oaW5mb3MpIHsKICAgICAgZW1iZXJSb3V0ZXIuZGlkVHJh
bnNpdGlvbihpbmZvcyk7CiAgICB9OwogIH0sCgogIF9kb1RyYW5zaXRpb246IGZ1bmN0aW9uKG1l
dGhvZCwgYXJncykgewogICAgLy8gTm9ybWFsaXplIGJsYW5rIHJvdXRlIHRvIHJvb3QgVVJMLgog
ICAgYXJncyA9IHNsaWNlLmNhbGwoYXJncyk7CiAgICBhcmdzWzBdID0gYXJnc1swXSB8fCAnLyc7
CgogICAgdmFyIHBhc3NlZE5hbWUgPSBhcmdzWzBdLCBuYW1lLCBzZWxmID0gdGhpcywKICAgICAg
aXNRdWVyeVBhcmFtc09ubHkgPSBmYWxzZTsKCiAgICAKICAgIGlmICghaXNRdWVyeVBhcmFtc09u
bHkgJiYgcGFzc2VkTmFtZS5jaGFyQXQoMCkgPT09ICcvJykgewogICAgICBuYW1lID0gcGFzc2Vk
TmFtZTsKICAgIH0gZWxzZSBpZiAoIWlzUXVlcnlQYXJhbXNPbmx5KSB7CiAgICAgIGlmICghdGhp
cy5yb3V0ZXIuaGFzUm91dGUocGFzc2VkTmFtZSkpIHsKICAgICAgICBuYW1lID0gYXJnc1swXSA9
IHBhc3NlZE5hbWUgKyAnLmluZGV4JzsKICAgICAgfSBlbHNlIHsKICAgICAgICBuYW1lID0gcGFz
c2VkTmFtZTsKICAgICAgfQoKICAgICAgRW1iZXIuYXNzZXJ0KCJUaGUgcm91dGUgIiArIHBhc3Nl
ZE5hbWUgKyAiIHdhcyBub3QgZm91bmQiLCB0aGlzLnJvdXRlci5oYXNSb3V0ZShuYW1lKSk7CiAg
ICB9CgogICAgdmFyIHRyYW5zaXRpb25Qcm9taXNlID0gdGhpcy5yb3V0ZXJbbWV0aG9kXS5hcHBs
eSh0aGlzLnJvdXRlciwgYXJncyk7CgogICAgdHJhbnNpdGlvblByb21pc2UudGhlbihudWxsLCBm
dW5jdGlvbihlcnJvcikgewogICAgICBpZiAoZXJyb3IubmFtZSA9PT0gIlVucmVjb2duaXplZFVS
TEVycm9yIikgewogICAgICAgIEVtYmVyLmFzc2VydCgiVGhlIFVSTCAnIiArIGVycm9yLm1lc3Nh
Z2UgKyAiJyBkaWQgbm90IG1hdGNoIGFueSByb3V0ZXMgaW4geW91ciBhcHBsaWNhdGlvbiIpOwog
ICAgICB9CiAgICB9LCAnRW1iZXI6IENoZWNrIGZvciBSb3V0ZXIgdW5yZWNvZ25pemVkIFVSTCBl
cnJvcicpOwoKICAgIC8vIFdlIHdhbnQgdG8gcmV0dXJuIHRoZSBjb25maWd1cmFibGUgcHJvbWlz
ZSBvYmplY3QKICAgIC8vIHNvIHRoYXQgY2FsbGVycyBvZiB0aGlzIGZ1bmN0aW9uIGNhbiB1c2Ug
YC5tZXRob2QoKWAgb24gaXQsCiAgICAvLyB3aGljaCBvYnZpb3VzbHkgZG9lc24ndCBleGlzdCBm
b3Igbm9ybWFsIFJTVlAgcHJvbWlzZXMuCiAgICByZXR1cm4gdHJhbnNpdGlvblByb21pc2U7CiAg
fSwKCiAgX3NjaGVkdWxlTG9hZGluZ0V2ZW50OiBmdW5jdGlvbih0cmFuc2l0aW9uLCBvcmlnaW5S
b3V0ZSkgewogICAgdGhpcy5fY2FuY2VsTG9hZGluZ0V2ZW50KCk7CiAgICB0aGlzLl9sb2FkaW5n
U3RhdGVUaW1lciA9IEVtYmVyLnJ1bi5zY2hlZHVsZU9uY2UoJ3JvdXRlclRyYW5zaXRpb25zJywg
dGhpcywgJ19maXJlTG9hZGluZ0V2ZW50JywgdHJhbnNpdGlvbiwgb3JpZ2luUm91dGUpOwogIH0s
CgogIF9maXJlTG9hZGluZ0V2ZW50OiBmdW5jdGlvbih0cmFuc2l0aW9uLCBvcmlnaW5Sb3V0ZSkg
ewogICAgaWYgKCF0aGlzLnJvdXRlci5hY3RpdmVUcmFuc2l0aW9uKSB7CiAgICAgIC8vIERvbid0
IGZpcmUgYW4gZXZlbnQgaWYgd2UndmUgc2luY2UgbW92ZWQgb24gZnJvbQogICAgICAvLyB0aGUg
dHJhbnNpdGlvbiB0aGF0IHB1dCB1cyBpbiBhIGxvYWRpbmcgc3RhdGUuCiAgICAgIHJldHVybjsK
ICAgIH0KCiAgICB0cmFuc2l0aW9uLnRyaWdnZXIodHJ1ZSwgJ2xvYWRpbmcnLCB0cmFuc2l0aW9u
LCBvcmlnaW5Sb3V0ZSk7CiAgfSwKCiAgX2NhbmNlbExvYWRpbmdFdmVudDogZnVuY3Rpb24gKCkg
ewogICAgaWYgKHRoaXMuX2xvYWRpbmdTdGF0ZVRpbWVyKSB7CiAgICAgIEVtYmVyLnJ1bi5jYW5j
ZWwodGhpcy5fbG9hZGluZ1N0YXRlVGltZXIpOwogICAgfQogICAgdGhpcy5fbG9hZGluZ1N0YXRl
VGltZXIgPSBudWxsOwogIH0KfSk7CgovKioKICBIZWxwZXIgZnVuY3Rpb24gZm9yIGl0ZXJhdGlu
ZyByb290LXdhcmQsIHN0YXJ0aW5nCiAgZnJvbSAoYnV0IG5vdCBpbmNsdWRpbmcpIHRoZSBwcm92
aWRlZCBgb3JpZ2luUm91dGVgLgoKICBSZXR1cm5zIHRydWUgaWYgdGhlIGxhc3QgY2FsbGJhY2sg
ZmlyZWQgcmVxdWVzdGVkCiAgdG8gYnViYmxlIHVwd2FyZC4KCiAgQHByaXZhdGUKICovCmZ1bmN0
aW9uIGZvckVhY2hSb3V0ZUFib3ZlKG9yaWdpblJvdXRlLCB0cmFuc2l0aW9uLCBjYWxsYmFjaykg
ewogIHZhciBoYW5kbGVySW5mb3MgPSB0cmFuc2l0aW9uLmhhbmRsZXJJbmZvcywKICAgICAgb3Jp
Z2luUm91dGVGb3VuZCA9IGZhbHNlOwoKICBmb3IgKHZhciBpID0gaGFuZGxlckluZm9zLmxlbmd0
aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICB2YXIgaGFuZGxlckluZm8gPSBoYW5kbGVySW5mb3Nb
aV0sCiAgICAgICAgcm91dGUgPSBoYW5kbGVySW5mby5oYW5kbGVyOwoKICAgIGlmICghb3JpZ2lu
Um91dGVGb3VuZCkgewogICAgICBpZiAob3JpZ2luUm91dGUgPT09IHJvdXRlKSB7CiAgICAgICAg
b3JpZ2luUm91dGVGb3VuZCA9IHRydWU7CiAgICAgIH0KICAgICAgY29udGludWU7CiAgICB9Cgog
ICAgaWYgKGNhbGxiYWNrKHJvdXRlLCBoYW5kbGVySW5mb3NbaSArIDFdLmhhbmRsZXIpICE9PSB0
cnVlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgcmV0dXJuIHRydWU7Cn0KCi8v
IFRoZXNlIGdldCBpbnZva2VkIHdoZW4gYW4gYWN0aW9uIGJ1YmJsZXMgYWJvdmUgQXBwbGljYXRp
b25Sb3V0ZQovLyBhbmQgYXJlIG5vdCBtZWFudCB0byBiZSBvdmVycmlkYWJsZS4KdmFyIGRlZmF1
bHRBY3Rpb25IYW5kbGVycyA9IHsKCiAgd2lsbFJlc29sdmVNb2RlbDogZnVuY3Rpb24odHJhbnNp
dGlvbiwgb3JpZ2luUm91dGUpIHsKICAgIG9yaWdpblJvdXRlLnJvdXRlci5fc2NoZWR1bGVMb2Fk
aW5nRXZlbnQodHJhbnNpdGlvbiwgb3JpZ2luUm91dGUpOwogIH0sCgogIGVycm9yOiBmdW5jdGlv
bihlcnJvciwgdHJhbnNpdGlvbiwgb3JpZ2luUm91dGUpIHsKICAgIC8vIEF0dGVtcHQgdG8gZmlu
ZCBhbiBhcHByb3ByaWF0ZSBlcnJvciBzdWJzdGF0ZSB0byBlbnRlci4KICAgIHZhciByb3V0ZXIg
PSBvcmlnaW5Sb3V0ZS5yb3V0ZXI7CgogICAgdmFyIHRyeVRvcExldmVsID0gZm9yRWFjaFJvdXRl
QWJvdmUob3JpZ2luUm91dGUsIHRyYW5zaXRpb24sIGZ1bmN0aW9uKHJvdXRlLCBjaGlsZFJvdXRl
KSB7CiAgICAgIHZhciBjaGlsZEVycm9yUm91dGVOYW1lID0gZmluZENoaWxkUm91dGVOYW1lKHJv
dXRlLCBjaGlsZFJvdXRlLCAnZXJyb3InKTsKICAgICAgaWYgKGNoaWxkRXJyb3JSb3V0ZU5hbWUp
IHsKICAgICAgICByb3V0ZXIuaW50ZXJtZWRpYXRlVHJhbnNpdGlvblRvKGNoaWxkRXJyb3JSb3V0
ZU5hbWUsIGVycm9yKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7
CiAgICB9KTsKCiAgICBpZiAodHJ5VG9wTGV2ZWwpIHsKICAgICAgLy8gQ2hlY2sgZm9yIHRvcC1s
ZXZlbCBlcnJvciBzdGF0ZSB0byBlbnRlci4KICAgICAgaWYgKHJvdXRlSGFzQmVlbkRlZmluZWQo
b3JpZ2luUm91dGUucm91dGVyLCAnYXBwbGljYXRpb25fZXJyb3InKSkgewogICAgICAgIHJvdXRl
ci5pbnRlcm1lZGlhdGVUcmFuc2l0aW9uVG8oJ2FwcGxpY2F0aW9uX2Vycm9yJywgZXJyb3IpOwog
ICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gRG9uJ3QgZmlyZSBh
biBhc3NlcnRpb24gaWYgd2UgZm91bmQgYW4gZXJyb3Igc3Vic3RhdGUuCiAgICAgIHJldHVybjsK
ICAgIH0KCiAgICBFbWJlci5Mb2dnZXIuZXJyb3IoJ0Vycm9yIHdoaWxlIGxvYWRpbmcgcm91dGU6
ICcgKyBlcnJvci5zdGFjayk7CiAgfSwKCiAgbG9hZGluZzogZnVuY3Rpb24odHJhbnNpdGlvbiwg
b3JpZ2luUm91dGUpIHsKICAgIC8vIEF0dGVtcHQgdG8gZmluZCBhbiBhcHByb3ByaWF0ZSBsb2Fk
aW5nIHN1YnN0YXRlIHRvIGVudGVyLgogICAgdmFyIHJvdXRlciA9IG9yaWdpblJvdXRlLnJvdXRl
cjsKCiAgICB2YXIgdHJ5VG9wTGV2ZWwgPSBmb3JFYWNoUm91dGVBYm92ZShvcmlnaW5Sb3V0ZSwg
dHJhbnNpdGlvbiwgZnVuY3Rpb24ocm91dGUsIGNoaWxkUm91dGUpIHsKICAgICAgdmFyIGNoaWxk
TG9hZGluZ1JvdXRlTmFtZSA9IGZpbmRDaGlsZFJvdXRlTmFtZShyb3V0ZSwgY2hpbGRSb3V0ZSwg
J2xvYWRpbmcnKTsKCiAgICAgIGlmIChjaGlsZExvYWRpbmdSb3V0ZU5hbWUpIHsKICAgICAgICBy
b3V0ZXIuaW50ZXJtZWRpYXRlVHJhbnNpdGlvblRvKGNoaWxkTG9hZGluZ1JvdXRlTmFtZSk7CiAg
ICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBEb24ndCBidWJibGUgYWJvdmUgcGl2b3Qg
cm91dGUuCiAgICAgIGlmICh0cmFuc2l0aW9uLnBpdm90SGFuZGxlciAhPT0gcm91dGUpIHsKICAg
ICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKHRyeVRvcExldmVsKSB7
CiAgICAgIC8vIENoZWNrIGZvciB0b3AtbGV2ZWwgbG9hZGluZyBzdGF0ZSB0byBlbnRlci4KICAg
ICAgaWYgKHJvdXRlSGFzQmVlbkRlZmluZWQob3JpZ2luUm91dGUucm91dGVyLCAnYXBwbGljYXRp
b25fbG9hZGluZycpKSB7CiAgICAgICAgcm91dGVyLmludGVybWVkaWF0ZVRyYW5zaXRpb25Ubygn
YXBwbGljYXRpb25fbG9hZGluZycpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0K
fTsKCmZ1bmN0aW9uIGZpbmRDaGlsZFJvdXRlTmFtZShwYXJlbnRSb3V0ZSwgb3JpZ2luYXRpbmdD
aGlsZFJvdXRlLCBuYW1lKSB7CiAgdmFyIHJvdXRlciA9IHBhcmVudFJvdXRlLnJvdXRlciwKICAg
ICAgY2hpbGROYW1lLAogICAgICB0YXJnZXRDaGlsZFJvdXRlTmFtZSA9IG9yaWdpbmF0aW5nQ2hp
bGRSb3V0ZS5yb3V0ZU5hbWUuc3BsaXQoJy4nKS5wb3AoKSwKICAgICAgbmFtZXNwYWNlID0gcGFy
ZW50Um91dGUucm91dGVOYW1lID09PSAnYXBwbGljYXRpb24nID8gJycgOiBwYXJlbnRSb3V0ZS5y
b3V0ZU5hbWUgKyAnLic7CgogIAogIC8vIFNlY29uZCwgdHJ5IGdlbmVyYWwgbG9hZGluZyBzdGF0
ZSwgZS5nLiAnbG9hZGluZycKICBjaGlsZE5hbWUgPSBuYW1lc3BhY2UgKyBuYW1lOwogIGlmIChy
b3V0ZUhhc0JlZW5EZWZpbmVkKHJvdXRlciwgY2hpbGROYW1lKSkgewogICAgcmV0dXJuIGNoaWxk
TmFtZTsKICB9Cn0KCmZ1bmN0aW9uIHJvdXRlSGFzQmVlbkRlZmluZWQocm91dGVyLCBuYW1lKSB7
CiAgdmFyIGNvbnRhaW5lciA9IHJvdXRlci5jb250YWluZXI7CiAgcmV0dXJuIHJvdXRlci5oYXNS
b3V0ZShuYW1lKSAmJgogICAgICAgICAoY29udGFpbmVyLmhhcygndGVtcGxhdGU6JyArIG5hbWUp
IHx8IGNvbnRhaW5lci5oYXMoJ3JvdXRlOicgKyBuYW1lKSk7Cn0KCmZ1bmN0aW9uIHRyaWdnZXJF
dmVudChoYW5kbGVySW5mb3MsIGlnbm9yZUZhaWx1cmUsIGFyZ3MpIHsKICB2YXIgbmFtZSA9IGFy
Z3Muc2hpZnQoKTsKCiAgaWYgKCFoYW5kbGVySW5mb3MpIHsKICAgIGlmIChpZ25vcmVGYWlsdXJl
KSB7IHJldHVybjsgfQogICAgdGhyb3cgbmV3IEVtYmVyLkVycm9yKCJDYW4ndCB0cmlnZ2VyIGFj
dGlvbiAnIiArIG5hbWUgKyAiJyBiZWNhdXNlIHlvdXIgYXBwIGhhc24ndCBmaW5pc2hlZCB0cmFu
c2l0aW9uaW5nIGludG8gaXRzIGZpcnN0IHJvdXRlLiBUbyB0cmlnZ2VyIGFuIGFjdGlvbiBvbiBk
ZXN0aW5hdGlvbiByb3V0ZXMgZHVyaW5nIGEgdHJhbnNpdGlvbiwgeW91IGNhbiBjYWxsIGAuc2Vu
ZCgpYCBvbiB0aGUgYFRyYW5zaXRpb25gIG9iamVjdCBwYXNzZWQgdG8gdGhlIGBtb2RlbC9iZWZv
cmVNb2RlbC9hZnRlck1vZGVsYCBob29rcy4iKTsKICB9CgogIHZhciBldmVudFdhc0hhbmRsZWQg
PSBmYWxzZTsKCiAgZm9yICh2YXIgaSA9IGhhbmRsZXJJbmZvcy5sZW5ndGggLSAxOyBpID49IDA7
IGktLSkgewogICAgdmFyIGhhbmRsZXJJbmZvID0gaGFuZGxlckluZm9zW2ldLAogICAgICAgIGhh
bmRsZXIgPSBoYW5kbGVySW5mby5oYW5kbGVyOwoKICAgIGlmIChoYW5kbGVyLl9hY3Rpb25zICYm
IGhhbmRsZXIuX2FjdGlvbnNbbmFtZV0pIHsKICAgICAgaWYgKGhhbmRsZXIuX2FjdGlvbnNbbmFt
ZV0uYXBwbHkoaGFuZGxlciwgYXJncykgPT09IHRydWUpIHsKICAgICAgICBldmVudFdhc0hhbmRs
ZWQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQog
IH0KCiAgaWYgKGRlZmF1bHRBY3Rpb25IYW5kbGVyc1tuYW1lXSkgewogICAgZGVmYXVsdEFjdGlv
bkhhbmRsZXJzW25hbWVdLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgcmV0dXJuOwogIH0KCiAgaWYg
KCFldmVudFdhc0hhbmRsZWQgJiYgIWlnbm9yZUZhaWx1cmUpIHsKICAgIHRocm93IG5ldyBFbWJl
ci5FcnJvcigiTm90aGluZyBoYW5kbGVkIHRoZSBhY3Rpb24gJyIgKyBuYW1lICsgIicuIElmIHlv
dSBkaWQgaGFuZGxlIHRoZSBhY3Rpb24sIHRoaXMgZXJyb3IgY2FuIGJlIGNhdXNlZCBieSByZXR1
cm5pbmcgdHJ1ZSBmcm9tIGFuIGFjdGlvbiBoYW5kbGVyIGluIGEgY29udHJvbGxlciwgY2F1c2lu
ZyB0aGUgYWN0aW9uIHRvIGJ1YmJsZS4iKTsKICB9Cn0KCmZ1bmN0aW9uIHVwZGF0ZVBhdGhzKHJv
dXRlcikgewogIHZhciBhcHBDb250cm9sbGVyID0gcm91dGVyLmNvbnRhaW5lci5sb29rdXAoJ2Nv
bnRyb2xsZXI6YXBwbGljYXRpb24nKTsKCiAgaWYgKCFhcHBDb250cm9sbGVyKSB7CiAgICAvLyBh
cHBDb250cm9sbGVyIG1pZ2h0IG5vdCBleGlzdCB3aGVuIHRvcC1sZXZlbCBsb2FkaW5nL2Vycm9y
CiAgICAvLyBzdWJzdGF0ZXMgaGF2ZSBiZWVuIGVudGVyZWQgc2luY2UgQXBwbGljYXRpb25Sb3V0
ZSBoYXNuJ3QKICAgIC8vIGFjdHVhbGx5IGJlZW4gZW50ZXJlZCBhdCB0aGF0IHBvaW50LgogICAg
cmV0dXJuOwogIH0KCiAgdmFyIGluZm9zID0gcm91dGVyLnJvdXRlci5jdXJyZW50SGFuZGxlcklu
Zm9zLAogICAgICBwYXRoID0gRW1iZXIuUm91dGVyLl9yb3V0ZVBhdGgoaW5mb3MpOwoKICBpZiAo
ISgnY3VycmVudFBhdGgnIGluIGFwcENvbnRyb2xsZXIpKSB7CiAgICBkZWZpbmVQcm9wZXJ0eShh
cHBDb250cm9sbGVyLCAnY3VycmVudFBhdGgnKTsKICB9CgogIHNldChhcHBDb250cm9sbGVyLCAn
Y3VycmVudFBhdGgnLCBwYXRoKTsKCiAgaWYgKCEoJ2N1cnJlbnRSb3V0ZU5hbWUnIGluIGFwcENv
bnRyb2xsZXIpKSB7CiAgICBkZWZpbmVQcm9wZXJ0eShhcHBDb250cm9sbGVyLCAnY3VycmVudFJv
dXRlTmFtZScpOwogIH0KCiAgc2V0KGFwcENvbnRyb2xsZXIsICdjdXJyZW50Um91dGVOYW1lJywg
aW5mb3NbaW5mb3MubGVuZ3RoIC0gMV0ubmFtZSk7Cn0KCkVtYmVyLlJvdXRlci5yZW9wZW5DbGFz
cyh7CiAgcm91dGVyOiBudWxsLAogIG1hcDogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBy
b3V0ZXIgPSB0aGlzLnJvdXRlcjsKICAgIGlmICghcm91dGVyKSB7CiAgICAgIHJvdXRlciA9IG5l
dyBSb3V0ZXIoKTsKICAgICAgcm91dGVyLmNhbGxiYWNrcyA9IFtdOwogICAgICByb3V0ZXIudHJp
Z2dlckV2ZW50ID0gdHJpZ2dlckV2ZW50OwogICAgICB0aGlzLnJlb3BlbkNsYXNzKHsgcm91dGVy
OiByb3V0ZXIgfSk7CiAgICB9CgogICAgdmFyIGRzbCA9IEVtYmVyLlJvdXRlckRTTC5tYXAoZnVu
Y3Rpb24oKSB7CiAgICAgIHRoaXMucmVzb3VyY2UoJ2FwcGxpY2F0aW9uJywgeyBwYXRoOiAiLyIg
fSwgZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgcm91dGVyLmNhbGxiYWNr
cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcm91dGVyLmNhbGxiYWNrc1tpXS5jYWxsKHRoaXMp
OwogICAgICAgIH0KICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgICB9KTsKICAgIH0p
OwoKICAgIHJvdXRlci5jYWxsYmFja3MucHVzaChjYWxsYmFjayk7CiAgICByb3V0ZXIubWFwKGRz
bC5nZW5lcmF0ZSgpKTsKICAgIHJldHVybiByb3V0ZXI7CiAgfSwKCiAgX3JvdXRlUGF0aDogZnVu
Y3Rpb24oaGFuZGxlckluZm9zKSB7CiAgICB2YXIgcGF0aCA9IFtdOwoKICAgIC8vIFdlIGhhdmUg
dG8gaGFuZGxlIGNvYWxlc2NpbmcgcmVzb3VyY2UgbmFtZXMgdGhhdAogICAgLy8gYXJlIHByZWZp
eGVkIHdpdGggdGhlaXIgcGFyZW50J3MgbmFtZXMsIGUuZy4KICAgIC8vIFsnZm9vJywgJ2Zvby5i
YXIuYmF6J10gPT4gJ2Zvby5iYXIuYmF6Jywgbm90ICdmb28uZm9vLmJhci5iYXonCgogICAgZnVu
Y3Rpb24gaW50ZXJzZWN0aW9uTWF0Y2hlcyhhMSwgYTIpIHsKICAgICAgZm9yICh2YXIgaSA9IDAs
IGxlbiA9IGExLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgaWYgKGExW2ldICE9PSBh
MltpXSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBy
ZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmb3IgKHZhciBpPTEsIGw9aGFuZGxlckluZm9zLmxlbmd0
aDsgaTxsOyBpKyspIHsKICAgICAgdmFyIG5hbWUgPSBoYW5kbGVySW5mb3NbaV0ubmFtZSwKICAg
ICAgICAgIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoIi4iKSwKICAgICAgICAgIG9sZE5hbWVQYXJ0
cyA9IHNsaWNlLmNhbGwocGF0aCk7CgogICAgICB3aGlsZSAob2xkTmFtZVBhcnRzLmxlbmd0aCkg
ewogICAgICAgIGlmIChpbnRlcnNlY3Rpb25NYXRjaGVzKG9sZE5hbWVQYXJ0cywgbmFtZVBhcnRz
KSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG9sZE5hbWVQYXJ0cy5zaGlm
dCgpOwogICAgICB9CgogICAgICBwYXRoLnB1c2guYXBwbHkocGF0aCwgbmFtZVBhcnRzLnNsaWNl
KG9sZE5hbWVQYXJ0cy5sZW5ndGgpKTsKICAgIH0KCiAgICByZXR1cm4gcGF0aC5qb2luKCIuIik7
CiAgfQp9KTsKClJvdXRlci5UcmFuc2l0aW9uLnByb3RvdHlwZS5zZW5kID0gUm91dGVyLlRyYW5z
aXRpb24ucHJvdG90eXBlLnRyaWdnZXI7CgoKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBt
b2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1yb3V0aW5nCiovCgp2YXIgZ2V0ID0gRW1iZXIu
Z2V0LCBzZXQgPSBFbWJlci5zZXQsCiAgICBnZXRQcm9wZXJ0aWVzID0gRW1iZXIuZ2V0UHJvcGVy
dGllcywKICAgIGNsYXNzaWZ5ID0gRW1iZXIuU3RyaW5nLmNsYXNzaWZ5LAogICAgZm10ID0gRW1i
ZXIuU3RyaW5nLmZtdCwKICAgIGFfZm9yRWFjaCA9IEVtYmVyLkVudW1lcmFibGVVdGlscy5mb3JF
YWNoLAogICAgYV9yZXBsYWNlID0gRW1iZXIuRW51bWVyYWJsZVV0aWxzLnJlcGxhY2U7CgoKLyoq
CiAgVGhlIGBFbWJlci5Sb3V0ZWAgY2xhc3MgaXMgdXNlZCB0byBkZWZpbmUgaW5kaXZpZHVhbCBy
b3V0ZXMuIFJlZmVyIHRvCiAgdGhlIFtyb3V0aW5nIGd1aWRlXShodHRwOi8vZW1iZXJqcy5jb20v
Z3VpZGVzL3JvdXRpbmcvKSBmb3IgZG9jdW1lbnRhdGlvbi4KCiAgQGNsYXNzIFJvdXRlCiAgQG5h
bWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLk9iamVjdAogIEB1c2VzIEVtYmVyLkFjdGlv
bkhhbmRsZXIKKi8KRW1iZXIuUm91dGUgPSBFbWJlci5PYmplY3QuZXh0ZW5kKEVtYmVyLkFjdGlv
bkhhbmRsZXIsIHsKCiAgLyoqCiAgICBAcHJpdmF0ZQoKICAgIEBtZXRob2QgZXhpdAogICovCiAg
ZXhpdDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgIHRoaXMudGVhcmRv
d25WaWV3cygpOwogIH0sCgogIC8qKgogICAgQHByaXZhdGUKCiAgICBAbWV0aG9kIGVudGVyCiAg
Ki8KICBlbnRlcjogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmFjdGl2YXRlKCk7CiAgfSwKCiAgLyoq
CiAgICBUaGUgY29sbGVjdGlvbiBvZiBmdW5jdGlvbnMsIGtleWVkIGJ5IG5hbWUsIGF2YWlsYWJs
ZSBvbiB0aGlzIHJvdXRlIGFzCiAgICBhY3Rpb24gdGFyZ2V0cy4KCiAgICBUaGVzZSBmdW5jdGlv
bnMgd2lsbCBiZSBpbnZva2VkIHdoZW4gYSBtYXRjaGluZyBge3thY3Rpb259fWAgaXMgdHJpZ2dl
cmVkCiAgICBmcm9tIHdpdGhpbiBhIHRlbXBsYXRlIGFuZCB0aGUgYXBwbGljYXRpb24ncyBjdXJy
ZW50IHJvdXRlIGlzIHRoaXMgcm91dGUuCgogICAgQWN0aW9ucyBjYW4gYWxzbyBiZSBpbnZva2Vk
IGZyb20gb3RoZXIgcGFydHMgb2YgeW91ciBhcHBsaWNhdGlvbiB2aWEgYFJvdXRlI3NlbmRgCiAg
ICBvciBgQ29udHJvbGxlciNzZW5kYC4KCiAgICBUaGUgYGFjdGlvbnNgIGhhc2ggd2lsbCBpbmhl
cml0IGFjdGlvbiBoYW5kbGVycyBmcm9tCiAgICB0aGUgYGFjdGlvbnNgIGhhc2ggZGVmaW5lZCBv
biBleHRlbmRlZCBSb3V0ZSBwYXJlbnQgY2xhc3NlcwogICAgb3IgbWl4aW5zIHJhdGhlciB0aGFu
IGp1c3QgcmVwbGFjZSB0aGUgZW50aXJlIGhhc2gsIGUuZy46CgogICAgYGBganMKICAgIEFwcC5D
YW5EaXNwbGF5QmFubmVyID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgYWN0aW9uczogewog
ICAgICAgIGRpc3BsYXlCYW5uZXI6IGZ1bmN0aW9uKG1zZykgewogICAgICAgICAgLy8gLi4uCiAg
ICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBBcHAuV2VsY29tZVJvdXRlID0gRW1iZXIuUm91
dGUuZXh0ZW5kKEFwcC5DYW5EaXNwbGF5QmFubmVyLCB7CiAgICAgIGFjdGlvbnM6IHsKICAgICAg
ICBwbGF5TXVzaWM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgLy8gLi4uCiAgICAgICAgfQogICAg
ICB9CiAgICB9KTsKCiAgICAvLyBgV2VsY29tZVJvdXRlYCwgd2hlbiBhY3RpdmUsIHdpbGwgYmUg
YWJsZSB0byByZXNwb25kCiAgICAvLyB0byBib3RoIGFjdGlvbnMsIHNpbmNlIHRoZSBhY3Rpb25z
IGhhc2ggaXMgbWVyZ2VkIHJhdGhlcgogICAgLy8gdGhlbiByZXBsYWNlZCB3aGVuIGV4dGVuZGlu
ZyBtaXhpbnMgLyBwYXJlbnQgY2xhc3Nlcy4KICAgIHRoaXMuc2VuZCgnZGlzcGxheUJhbm5lcicp
OwogICAgdGhpcy5zZW5kKCdwbGF5TXVzaWMnKTsKICAgIGBgYAoKICAgIFdpdGhpbiBhIHJvdXRl
J3MgYWN0aW9uIGhhbmRsZXIsIHRoZSB2YWx1ZSBvZiB0aGUgYHRoaXNgIGNvbnRleHQKICAgIGlz
IHRoZSBSb3V0ZSBvYmplY3Q6CgogICAgYGBganMKICAgIEFwcC5Tb25nUm91dGUgPSBFbWJlci5S
b3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgbXlBY3Rpb246IGZ1bmN0aW9u
KCkgewogICAgICAgICAgdGhpcy5jb250cm9sbGVyRm9yKCJzb25nIik7CiAgICAgICAgICB0aGlz
LnRyYW5zaXRpb25Ubygib3RoZXIucm91dGUiKTsKICAgICAgICAgIC4uLgogICAgICAgIH0KICAg
ICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIGNhbGwgYHRo
aXMuX3N1cGVyKClgIGZyb20gd2l0aGluIGFuCiAgICBhY3Rpb24gaGFuZGxlciBpZiBpdCBvdmVy
cmlkZXMgYSBoYW5kbGVyIGRlZmluZWQgb24gYSBwYXJlbnQKICAgIGNsYXNzIG9yIG1peGluOgoK
ICAgIFRha2UgZm9yIGV4YW1wbGUgdGhlIGZvbGxvd2luZyByb3V0ZXM6CgogICAgYGBganMKICAg
IEFwcC5EZWJ1Z1JvdXRlID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgYWN0aW9uczogewog
ICAgICAgIGRlYnVnUm91dGVJbmZvcm1hdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBjb25z
b2xlLmRlYnVnKCJ0cm9sb2xvIik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBBcHAu
QW5ub3lpbmdEZWJ1Z1JvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKEFwcC5EZWJ1Z1JvdXRlLCB7
CiAgICAgIGFjdGlvbnM6IHsKICAgICAgICBkZWJ1Z1JvdXRlSW5mb3JtYXRpb246IGZ1bmN0aW9u
KCkgewogICAgICAgICAgLy8gYWxzbyBjYWxsIHRoZSBkZWJ1Z1JvdXRlSW5mb3JtYXRpb24gb2Yg
bWl4ZWQgaW4gQXBwLkRlYnVnUm91dGUKICAgICAgICAgIHRoaXMuX3N1cGVyKCk7CgogICAgICAg
ICAgLy8gc2hvdyBhZGRpdGlvbmFsIGFubm95YW5jZQogICAgICAgICAgd2luZG93LmFsZXJ0KC4u
Lik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgICMjIEJ1YmJsaW5nCgog
ICAgQnkgZGVmYXVsdCwgYW4gYWN0aW9uIHdpbGwgc3RvcCBidWJibGluZyBvbmNlIGEgaGFuZGxl
ciBkZWZpbmVkCiAgICBvbiB0aGUgYGFjdGlvbnNgIGhhc2ggaGFuZGxlcyBpdC4gVG8gY29udGlu
dWUgYnViYmxpbmcgdGhlIGFjdGlvbiwKICAgIHlvdSBtdXN0IHJldHVybiBgdHJ1ZWAgZnJvbSB0
aGUgaGFuZGxlcjoKCiAgICBgYGBqcwogICAgQXBwLlJvdXRlci5tYXAoZnVuY3Rpb24oKSB7CiAg
ICAgIHRoaXMucmVzb3VyY2UoImFsYnVtIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5yb3V0
ZSgic29uZyIpOwogICAgICB9KTsKICAgIH0pOwoKICAgIEFwcC5BbGJ1bVJvdXRlID0gRW1iZXIu
Um91dGUuZXh0ZW5kKHsKICAgICAgYWN0aW9uczogewogICAgICAgIHN0YXJ0UGxheWluZzogZnVu
Y3Rpb24oKSB7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBBcHAuQWxidW1Tb25nUm91
dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgc3RhcnRQ
bGF5aW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgIC8vIC4uLgoKICAgICAgICAgIGlmIChhY3Rp
b25TaG91bGRBbHNvQmVUcmlnZ2VyZWRPblBhcmVudFJvdXRlKSB7CiAgICAgICAgICAgIHJldHVy
biB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAg
ICAjIyBCdWlsdC1pbiBhY3Rpb25zCgogICAgVGhlcmUgYXJlIGEgZmV3IGJ1aWx0LWluIGFjdGlv
bnMgcGVydGFpbmluZyB0byB0cmFuc2l0aW9ucyB0aGF0IHlvdQogICAgY2FuIHVzZSB0byBjdXN0
b21pemUgdHJhbnNpdGlvbiBiZWhhdmlvcjogYHdpbGxUcmFuc2l0aW9uYCBhbmQKICAgIGBlcnJv
cmAuCgogICAgIyMjIGB3aWxsVHJhbnNpdGlvbmAKCiAgICBUaGUgYHdpbGxUcmFuc2l0aW9uYCBh
Y3Rpb24gaXMgZmlyZWQgYXQgdGhlIGJlZ2lubmluZyBvZiBhbnkKICAgIGF0dGVtcHRlZCB0cmFu
c2l0aW9uIHdpdGggYSBgVHJhbnNpdGlvbmAgb2JqZWN0IGFzIHRoZSBzb2xlCiAgICBhcmd1bWVu
dC4gVGhpcyBhY3Rpb24gY2FuIGJlIHVzZWQgZm9yIGFib3J0aW5nLCByZWRpcmVjdGluZywKICAg
IG9yIGRlY29yYXRpbmcgdGhlIHRyYW5zaXRpb24gZnJvbSB0aGUgY3VycmVudGx5IGFjdGl2ZSBy
b3V0ZXMuCgogICAgQSBnb29kIGV4YW1wbGUgaXMgcHJldmVudGluZyBuYXZpZ2F0aW9uIHdoZW4g
YSBmb3JtIGlzCiAgICBoYWxmLWZpbGxlZCBvdXQ6CgogICAgYGBganMKICAgIEFwcC5Db250YWN0
Rm9ybVJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKHsKICAgICAgYWN0aW9uczogewogICAgICAg
IHdpbGxUcmFuc2l0aW9uOiBmdW5jdGlvbih0cmFuc2l0aW9uKSB7CiAgICAgICAgICBpZiAodGhp
cy5jb250cm9sbGVyLmdldCgndXNlckhhc0VudGVyZWREYXRhJykpIHsKICAgICAgICAgICAgdGhp
cy5jb250cm9sbGVyLmRpc3BsYXlOYXZpZ2F0aW9uQ29uZmlybSgpOwogICAgICAgICAgICB0cmFu
c2l0aW9uLmFib3J0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAg
IGBgYAoKICAgIFlvdSBjYW4gYWxzbyByZWRpcmVjdCBlbHNld2hlcmUgYnkgY2FsbGluZwogICAg
YHRoaXMudHJhbnNpdGlvblRvKCdlbHNld2hlcmUnKWAgZnJvbSB3aXRoaW4gYHdpbGxUcmFuc2l0
aW9uYC4KICAgIE5vdGUgdGhhdCBgd2lsbFRyYW5zaXRpb25gIHdpbGwgbm90IGJlIGZpcmVkIGZv
ciB0aGUKICAgIHJlZGlyZWN0aW5nIGB0cmFuc2l0aW9uVG9gLCBzaW5jZSBgd2lsbFRyYW5zaXRp
b25gIGRvZXNuJ3QKICAgIGZpcmUgd2hlbiB0aGVyZSBpcyBhbHJlYWR5IGEgdHJhbnNpdGlvbiB1
bmRlcndheS4gSWYgeW91IHdhbnQKICAgIHN1YnNlcXVlbnQgYHdpbGxUcmFuc2l0aW9uYCBhY3Rp
b25zIHRvIGZpcmUgZm9yIHRoZSByZWRpcmVjdGluZwogICAgdHJhbnNpdGlvbiwgeW91IG11c3Qg
Zmlyc3QgZXhwbGljaXRseSBjYWxsCiAgICBgdHJhbnNpdGlvbi5hYm9ydCgpYC4KCiAgICAjIyMg
YGVycm9yYAoKICAgIFdoZW4gYXR0ZW1wdGluZyB0byB0cmFuc2l0aW9uIGludG8gYSByb3V0ZSwg
YW55IG9mIHRoZSBob29rcwogICAgbWF5IHJldHVybiBhIHByb21pc2UgdGhhdCByZWplY3RzLCBh
dCB3aGljaCBwb2ludCBhbiBgZXJyb3JgCiAgICBhY3Rpb24gd2lsbCBiZSBmaXJlZCBvbiB0aGUg
cGFydGlhbGx5LWVudGVyZWQgcm91dGVzLCBhbGxvd2luZwogICAgZm9yIHBlci1yb3V0ZSBlcnJv
ciBoYW5kbGluZyBsb2dpYywgb3Igc2hhcmVkIGVycm9yIGhhbmRsaW5nCiAgICBsb2dpYyBkZWZp
bmVkIG9uIGEgcGFyZW50IHJvdXRlLgoKICAgIEhlcmUgaXMgYW4gZXhhbXBsZSBvZiBhbiBlcnJv
ciBoYW5kbGVyIHRoYXQgd2lsbCBiZSBpbnZva2VkCiAgICBmb3IgcmVqZWN0ZWQgcHJvbWlzZXMg
ZnJvbSB0aGUgdmFyaW91cyBob29rcyBvbiB0aGUgcm91dGUsCiAgICBhcyB3ZWxsIGFzIGFueSB1
bmhhbmRsZWQgZXJyb3JzIGZyb20gY2hpbGQgcm91dGVzOgoKICAgIGBgYGpzCiAgICBBcHAuQWRt
aW5Sb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlv
bigpIHsKICAgICAgICByZXR1cm4gRW1iZXIuUlNWUC5yZWplY3QoImJhZCB0aGluZ3MhIik7CiAg
ICAgIH0sCgogICAgICBhY3Rpb25zOiB7CiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycm9yLCB0
cmFuc2l0aW9uKSB7CiAgICAgICAgICAvLyBBc3N1bWluZyB3ZSBnb3QgaGVyZSBkdWUgdG8gdGhl
IGVycm9yIGluIGBiZWZvcmVNb2RlbGAsCiAgICAgICAgICAvLyB3ZSBjYW4gZXhwZWN0IHRoYXQg
ZXJyb3IgPT09ICJiYWQgdGhpbmdzISIsCiAgICAgICAgICAvLyBidXQgYSBwcm9taXNlIG1vZGVs
IHJlamVjdGluZyB3b3VsZCBhbHNvCiAgICAgICAgICAvLyBjYWxsIHRoaXMgaG9vaywgYXMgd291
bGQgYW55IGVycm9ycyBlbmNvdW50ZXJlZAogICAgICAgICAgLy8gaW4gYGFmdGVyTW9kZWxgLgoK
ICAgICAgICAgIC8vIFRoZSBgZXJyb3JgIGhvb2sgaXMgYWxzbyBwcm92aWRlZCB0aGUgZmFpbGVk
CiAgICAgICAgICAvLyBgdHJhbnNpdGlvbmAsIHdoaWNoIGNhbiBiZSBzdG9yZWQgYW5kIGxhdGVy
CiAgICAgICAgICAvLyBgLnJldHJ5KClgZCBpZiBkZXNpcmVkLgoKICAgICAgICAgIHRoaXMudHJh
bnNpdGlvblRvKCdsb2dpbicpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAg
ICBgZXJyb3JgIGFjdGlvbnMgdGhhdCBidWJibGUgdXAgYWxsIHRoZSB3YXkgdG8gYEFwcGxpY2F0
aW9uUm91dGVgCiAgICB3aWxsIGZpcmUgYSBkZWZhdWx0IGVycm9yIGhhbmRsZXIgdGhhdCBsb2dz
IHRoZSBlcnJvci4gWW91IGNhbgogICAgc3BlY2lmeSB5b3VyIG93biBnbG9iYWwgZGVmYXVsdCBl
cnJvciBoYW5kbGVyIGJ5IG92ZXJyaWRpbmcgdGhlCiAgICBgZXJyb3JgIGhhbmRsZXIgb24gYEFw
cGxpY2F0aW9uUm91dGVgOgoKICAgIGBgYGpzCiAgICBBcHAuQXBwbGljYXRpb25Sb3V0ZSA9IEVt
YmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIGFjdGlvbnM6IHsKICAgICAgICBlcnJvcjogZnVuY3Rp
b24oZXJyb3IsIHRyYW5zaXRpb24pIHsKICAgICAgICAgIHRoaXMuY29udHJvbGxlckZvcignYmFu
bmVyJykuZGlzcGxheUVycm9yKGVycm9yLm1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfQogICAg
fSk7CiAgICBgYGAKCiAgICBAcHJvcGVydHkgYWN0aW9ucwogICAgQHR5cGUgSGFzaAogICAgQGRl
ZmF1bHQgbnVsbAogICovCiAgX2FjdGlvbnM6IHsKICAgIGZpbmFsaXplUXVlcnlQYXJhbUNoYW5n
ZTogZnVuY3Rpb24ocGFyYW1zLCBmaW5hbFBhcmFtcykgewogICAgICAgICAgfQogIH0sCgogIC8q
KgogICAgQGRlcHJlY2F0ZWQKCiAgICBQbGVhc2UgdXNlIGBhY3Rpb25zYCBpbnN0ZWFkLgogICAg
QG1ldGhvZCBldmVudHMKICAqLwogIGV2ZW50czogbnVsbCwKCiAgbWVyZ2VkUHJvcGVydGllczog
WydldmVudHMnXSwKCiAgLyoqCiAgICBUaGlzIGhvb2sgaXMgZXhlY3V0ZWQgd2hlbiB0aGUgcm91
dGVyIGNvbXBsZXRlbHkgZXhpdHMgdGhpcyByb3V0ZS4gSXQgaXMKICAgIG5vdCBleGVjdXRlZCB3
aGVuIHRoZSBtb2RlbCBmb3IgdGhlIHJvdXRlIGNoYW5nZXMuCgogICAgQG1ldGhvZCBkZWFjdGl2
YXRlCiAgKi8KICBkZWFjdGl2YXRlOiBFbWJlci5LLAoKICAvKioKICAgIFRoaXMgaG9vayBpcyBl
eGVjdXRlZCB3aGVuIHRoZSByb3V0ZXIgZW50ZXJzIHRoZSByb3V0ZS4gSXQgaXMgbm90IGV4ZWN1
dGVkCiAgICB3aGVuIHRoZSBtb2RlbCBmb3IgdGhlIHJvdXRlIGNoYW5nZXMuCgogICAgQG1ldGhv
ZCBhY3RpdmF0ZQogICovCiAgYWN0aXZhdGU6IEVtYmVyLkssCgogIC8qKgogICAgVHJhbnNpdGlv
biBpbnRvIGFub3RoZXIgcm91dGUuIE9wdGlvbmFsbHkgc3VwcGx5IG1vZGVsKHMpIGZvciB0aGUK
ICAgIHJvdXRlIGluIHF1ZXN0aW9uLiBJZiBtdWx0aXBsZSBtb2RlbHMgYXJlIHN1cHBsaWVkIHRo
ZXkgd2lsbCBiZSBhcHBsaWVkCiAgICBsYXN0IHRvIGZpcnN0IHJlY3Vyc2l2ZWx5IHVwIHRoZSBy
ZXNvdXJjZSB0cmVlIChzZWUgTXVsdGlwbGUgTW9kZWxzIEV4YW1wbGUKICAgIGJlbG93KS4gVGhl
IG1vZGVsKHMpIHdpbGwgYmUgc2VyaWFsaXplZCBpbnRvIHRoZSBVUkwgdXNpbmcgdGhlIGFwcHJv
cHJpYXRlCiAgICByb3V0ZSdzIGBzZXJpYWxpemVgIGhvb2suIFNlZSBhbHNvICdyZXBsYWNlV2l0
aCcuCgogICAgU2ltcGxlIFRyYW5zaXRpb24gRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAg
IEFwcC5Sb3V0ZXIubWFwKGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJvdXRlKCJpbmRleCIpOwog
ICAgICB0aGlzLnJvdXRlKCJzZWNyZXQiKTsKICAgICAgdGhpcy5yb3V0ZSgiZm91ck9oRm91ciIs
IHsgcGF0aDogIio6In0pOwogICAgfSk7CgogICAgQXBwLkluZGV4Um91dGUgPSBFbWJlci5Sb3V0
ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgbW92ZVRvU2VjcmV0OiBmdW5jdGlv
bihjb250ZXh0KXsKICAgICAgICAgIGlmIChhdXRob3JpemVkKCkpewogICAgICAgICAgICB0aGlz
LnRyYW5zaXRpb25Ubygnc2VjcmV0JywgY29udGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICAg
IHRoaXMudHJhbnNpdGlvblRvKCdmb3VyT2hGb3VyJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9
KTsKICAgIGBgYAoKICAgVHJhbnNpdGlvbiB0byBhIG5lc3RlZCByb3V0ZQoKICAgYGBgamF2YXNj
cmlwdAogICBBcHAuUm91dGVyLm1hcChmdW5jdGlvbigpIHsKICAgICB0aGlzLnJlc291cmNlKCdh
cnRpY2xlcycsIHsgcGF0aDogJy9hcnRpY2xlcycgfSwgZnVuY3Rpb24oKSB7CiAgICAgICB0aGlz
LnJvdXRlKCduZXcnKTsKICAgICB9KTsKICAgfSk7CgogICBBcHAuSW5kZXhSb3V0ZSA9IEVtYmVy
LlJvdXRlLmV4dGVuZCh7CiAgICAgYWN0aW9uczogewogICAgICAgdHJhbnNpdGlvblRvTmV3QXJ0
aWNsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKCdhcnRpY2xlcy5u
ZXcnKTsKICAgICAgIH0KICAgICB9CiAgIH0pOwogICBgYGAKCiAgICBNdWx0aXBsZSBNb2RlbHMg
RXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5Sb3V0ZXIubWFwKGZ1bmN0aW9uKCkg
ewogICAgICB0aGlzLnJvdXRlKCJpbmRleCIpOwogICAgICB0aGlzLnJlc291cmNlKCdicmVha2Zh
c3QnLCB7cGF0aDonOmJyZWFrZmFzdElkJ30sIGZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5yZXNv
dXJjZSgnY2VyZWFsJywge3BhdGg6ICc6Y2VyZWFsSWQnfSk7CiAgICAgIH0pOwogICAgfSk7Cgog
ICAgQXBwLkluZGV4Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7
CiAgICAgICAgbW92ZVRvQ2hvY29sYXRlQ2VyZWFsOiBmdW5jdGlvbigpewogICAgICAgICAgdmFy
IGNlcmVhbCA9IHsgY2VyZWFsSWQ6ICJDaG9jb2xhdGVZdW1taW5lc3MifSwKICAgICAgICAgICAg
ICBicmVha2Zhc3QgPSB7YnJlYWtmYXN0SWQ6ICJDZXJlYWxBbmRNaWxrIn07CgogICAgICAgICAg
dGhpcy50cmFuc2l0aW9uVG8oJ2NlcmVhbCcsIGJyZWFrZmFzdCwgY2VyZWFsKTsKICAgICAgICB9
CiAgICAgIH0KICAgIH0pOwoKICAgIEBtZXRob2QgdHJhbnNpdGlvblRvCiAgICBAcGFyYW0ge1N0
cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgcm91dGUKICAgIEBwYXJhbSB7Li4uT2JqZWN0fSBt
b2RlbHMgdGhlIG1vZGVsKHMpIHRvIGJlIHVzZWQgd2hpbGUgdHJhbnNpdGlvbmluZwogICAgdG8g
dGhlIHJvdXRlLgogICovCiAgdHJhbnNpdGlvblRvOiBmdW5jdGlvbihuYW1lLCBjb250ZXh0KSB7
CiAgICB2YXIgcm91dGVyID0gdGhpcy5yb3V0ZXI7CiAgICByZXR1cm4gcm91dGVyLnRyYW5zaXRp
b25Uby5hcHBseShyb3V0ZXIsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgICBQZXJmb3JtIGEg
c3luY2hyb25vdXMgdHJhbnNpdGlvbiBpbnRvIGFub3RoZXIgcm91dGUgd2l0aCBvdXQgYXR0ZW1w
dGluZwogICAgdG8gcmVzb2x2ZSBwcm9taXNlcywgdXBkYXRlIHRoZSBVUkwsIG9yIGFib3J0IGFu
eSBjdXJyZW50bHkgYWN0aXZlCiAgICBhc3luY2hyb25vdXMgdHJhbnNpdGlvbnMgKGkuZS4gcmVn
dWxhciB0cmFuc2l0aW9ucyBjYXVzZWQgYnkKICAgIGB0cmFuc2l0aW9uVG9gIG9yIFVSTCBjaGFu
Z2VzKS4KCiAgICBUaGlzIG1ldGhvZCBpcyBoYW5keSBmb3IgcGVyZm9ybWluZyBpbnRlcm1lZGlh
dGUgdHJhbnNpdGlvbnMgb24gdGhlCiAgICB3YXkgdG8gYSBmaW5hbCBkZXN0aW5hdGlvbiByb3V0
ZSwgYW5kIGlzIGNhbGxlZCBpbnRlcm5hbGx5IGJ5IHRoZQogICAgZGVmYXVsdCBpbXBsZW1lbnRh
dGlvbnMgb2YgdGhlIGBlcnJvcmAgYW5kIGBsb2FkaW5nYCBoYW5kbGVycy4KCiAgICBAbWV0aG9k
IGludGVybWVkaWF0ZVRyYW5zaXRpb25UbwogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIG5h
bWUgb2YgdGhlIHJvdXRlCiAgICBAcGFyYW0gey4uLk9iamVjdH0gbW9kZWxzIHRoZSBtb2RlbChz
KSB0byBiZSB1c2VkIHdoaWxlIHRyYW5zaXRpb25pbmcKICAgIHRvIHRoZSByb3V0ZS4KICAgKi8K
ICBpbnRlcm1lZGlhdGVUcmFuc2l0aW9uVG86IGZ1bmN0aW9uKCkgewogICAgdmFyIHJvdXRlciA9
IHRoaXMucm91dGVyOwogICAgcm91dGVyLmludGVybWVkaWF0ZVRyYW5zaXRpb25Uby5hcHBseShy
b3V0ZXIsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgICBUcmFuc2l0aW9uIGludG8gYW5vdGhl
ciByb3V0ZSB3aGlsZSByZXBsYWNpbmcgdGhlIGN1cnJlbnQgVVJMLCBpZiBwb3NzaWJsZS4KICAg
IFRoaXMgd2lsbCByZXBsYWNlIHRoZSBjdXJyZW50IGhpc3RvcnkgZW50cnkgaW5zdGVhZCBvZiBh
ZGRpbmcgYSBuZXcgb25lLgogICAgQmVzaWRlIHRoYXQsIGl0IGlzIGlkZW50aWNhbCB0byBgdHJh
bnNpdGlvblRvYCBpbiBhbGwgb3RoZXIgcmVzcGVjdHMuIFNlZQogICAgJ3RyYW5zaXRpb25Ubycg
Zm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIG11bHRpcGxlIG1vZGVscy4KCiAg
ICBFeGFtcGxlCgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlJvdXRlci5tYXAoZnVuY3Rpb24o
KSB7CiAgICAgIHRoaXMucm91dGUoImluZGV4Iik7CiAgICAgIHRoaXMucm91dGUoInNlY3JldCIp
OwogICAgfSk7CgogICAgQXBwLlNlY3JldFJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKHsKICAg
ICAgYWZ0ZXJNb2RlbDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCFhdXRob3JpemVkKCkpewog
ICAgICAgICAgdGhpcy5yZXBsYWNlV2l0aCgnaW5kZXgnKTsKICAgICAgICB9CiAgICAgIH0KICAg
IH0pOwogICAgYGBgCgogICAgQG1ldGhvZCByZXBsYWNlV2l0aAogICAgQHBhcmFtIHtTdHJpbmd9
IG5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvdXRlCiAgICBAcGFyYW0gey4uLk9iamVjdH0gbW9kZWxz
IHRoZSBtb2RlbChzKSB0byBiZSB1c2VkIHdoaWxlIHRyYW5zaXRpb25pbmcKICAgIHRvIHRoZSBy
b3V0ZS4KICAqLwogIHJlcGxhY2VXaXRoOiBmdW5jdGlvbigpIHsKICAgIHZhciByb3V0ZXIgPSB0
aGlzLnJvdXRlcjsKICAgIHJldHVybiByb3V0ZXIucmVwbGFjZVdpdGguYXBwbHkocm91dGVyLCBh
cmd1bWVudHMpOwogIH0sCgogIC8qKgogICAgU2VuZHMgYW4gYWN0aW9uIHRvIHRoZSByb3V0ZXIs
IHdoaWNoIHdpbGwgZGVsZWdhdGUgaXQgdG8gdGhlIGN1cnJlbnRseQogICAgYWN0aXZlIHJvdXRl
IGhpZXJhcmNoeSBwZXIgdGhlIGJ1YmJsaW5nIHJ1bGVzIGV4cGxhaW5lZCB1bmRlciBgYWN0aW9u
c2AuCgogICAgRXhhbXBsZQoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5Sb3V0ZXIubWFwKGZ1
bmN0aW9uKCkgewogICAgICB0aGlzLnJvdXRlKCJpbmRleCIpOwogICAgfSk7CgogICAgQXBwLkFw
cGxpY2F0aW9uUm91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAg
ICAgICAgdHJhY2s6IGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgY29uc29sZS5sb2coYXJnLCAn
d2FzIGNsaWNrZWQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIEFwcC5JbmRleFJv
dXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKHsKICAgICAgYWN0aW9uczogewogICAgICAgIHRyYWNr
SWZEZWJ1ZzogZnVuY3Rpb24oYXJnKSB7CiAgICAgICAgICBpZiAoZGVidWcpIHsKICAgICAgICAg
ICAgdGhpcy5zZW5kKCd0cmFjaycsIGFyZyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9
CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2Qgc2VuZAogICAgQHBhcmFtIHtTdHJpbmd9IG5h
bWUgdGhlIG5hbWUgb2YgdGhlIGFjdGlvbiB0byB0cmlnZ2VyCiAgICBAcGFyYW0gey4uLip9IGFy
Z3MKICAqLwogIHNlbmQ6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucm91dGVyLnNlbmQu
YXBwbHkodGhpcy5yb3V0ZXIsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgICBUaGlzIGhvb2sg
aXMgdGhlIGVudHJ5IHBvaW50IGZvciByb3V0ZXIuanMKCiAgICBAcHJpdmF0ZQogICAgQG1ldGhv
ZCBzZXR1cAogICovCiAgc2V0dXA6IGZ1bmN0aW9uKGNvbnRleHQsIHF1ZXJ5UGFyYW1zKSB7CiAg
ICB2YXIgY29udHJvbGxlck5hbWUgPSB0aGlzLmNvbnRyb2xsZXJOYW1lIHx8IHRoaXMucm91dGVO
YW1lLAogICAgICAgIGNvbnRyb2xsZXIgPSB0aGlzLmNvbnRyb2xsZXJGb3IoY29udHJvbGxlck5h
bWUsIHRydWUpOwogICAgaWYgKCFjb250cm9sbGVyKSB7CiAgICAgIGNvbnRyb2xsZXIgPSAgdGhp
cy5nZW5lcmF0ZUNvbnRyb2xsZXIoY29udHJvbGxlck5hbWUsIGNvbnRleHQpOwogICAgfQoKICAg
IC8vIEFzc2lnbiB0aGUgcm91dGUncyBjb250cm9sbGVyIHNvIHRoYXQgaXQgY2FuIG1vcmUgZWFz
aWx5IGJlCiAgICAvLyByZWZlcmVuY2VkIGluIGFjdGlvbiBoYW5kbGVycwogICAgdGhpcy5jb250
cm9sbGVyID0gY29udHJvbGxlcjsKCiAgICB2YXIgYXJncyA9IFtjb250cm9sbGVyLCBjb250ZXh0
XTsKCiAgICAKICAgIGlmICh0aGlzLnNldHVwQ29udHJvbGxlcnMpIHsKICAgICAgRW1iZXIuZGVw
cmVjYXRlKCJFbWJlci5Sb3V0ZS5zZXR1cENvbnRyb2xsZXJzIGlzIGRlcHJlY2F0ZWQuIFBsZWFz
ZSB1c2UgRW1iZXIuUm91dGUuc2V0dXBDb250cm9sbGVyKGNvbnRyb2xsZXIsIG1vZGVsKSBpbnN0
ZWFkLiIpOwogICAgICB0aGlzLnNldHVwQ29udHJvbGxlcnMoY29udHJvbGxlciwgY29udGV4dCk7
CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldHVwQ29udHJvbGxlci5hcHBseSh0aGlzLCBhcmdz
KTsKICAgIH0KCiAgICBpZiAodGhpcy5yZW5kZXJUZW1wbGF0ZXMpIHsKICAgICAgRW1iZXIuZGVw
cmVjYXRlKCJFbWJlci5Sb3V0ZS5yZW5kZXJUZW1wbGF0ZXMgaXMgZGVwcmVjYXRlZC4gUGxlYXNl
IHVzZSBFbWJlci5Sb3V0ZS5yZW5kZXJUZW1wbGF0ZShjb250cm9sbGVyLCBtb2RlbCkgaW5zdGVh
ZC4iKTsKICAgICAgdGhpcy5yZW5kZXJUZW1wbGF0ZXMoY29udGV4dCk7CiAgICB9IGVsc2Ugewog
ICAgICB0aGlzLnJlbmRlclRlbXBsYXRlLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfQogIH0sCgog
IC8qKgogICAgQSBob29rIHlvdSBjYW4gaW1wbGVtZW50IHRvIG9wdGlvbmFsbHkgcmVkaXJlY3Qg
dG8gYW5vdGhlciByb3V0ZS4KCiAgICBJZiB5b3UgY2FsbCBgdGhpcy50cmFuc2l0aW9uVG9gIGZy
b20gaW5zaWRlIG9mIHRoaXMgaG9vaywgdGhpcyByb3V0ZQogICAgd2lsbCBub3QgYmUgZW50ZXJl
ZCBpbiBmYXZvciBvZiB0aGUgb3RoZXIgaG9vay4KCiAgICBOb3RlIHRoYXQgdGhpcyBob29rIGlz
IGNhbGxlZCBieSB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZgogICAgYGFmdGVyTW9kZWxg
LCBzbyBpZiB5b3Ugb3ZlcnJpZGUgYGFmdGVyTW9kZWxgLCB5b3UgbXVzdCBlaXRoZXIKICAgIGV4
cGxpY2l0bHkgY2FsbCBgcmVkaXJlY3RgIG9yIGp1c3QgcHV0IHlvdXIgcmVkaXJlY3RpbmcKICAg
IGB0aGlzLnRyYW5zaXRpb25UbygpYCBjYWxsIHdpdGhpbiBgYWZ0ZXJNb2RlbGAuCgogICAgQG1l
dGhvZCByZWRpcmVjdAogICAgQHBhcmFtIHtPYmplY3R9IG1vZGVsIHRoZSBtb2RlbCBmb3IgdGhp
cyByb3V0ZQogICovCiAgcmVkaXJlY3Q6IEVtYmVyLkssCgogIC8qKgogICAgVGhpcyBob29rIGlz
IHRoZSBmaXJzdCBvZiB0aGUgcm91dGUgZW50cnkgdmFsaWRhdGlvbiBob29rcwogICAgY2FsbGVk
IHdoZW4gYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIHRyYW5zaXRpb24gaW50byBhIHJvdXRlCiAgICBv
ciBvbmUgb2YgaXRzIGNoaWxkcmVuLiBJdCBpcyBjYWxsZWQgYmVmb3JlIGBtb2RlbGAgYW5kCiAg
ICBgYWZ0ZXJNb2RlbGAsIGFuZCBpcyBhcHByb3ByaWF0ZSBmb3IgY2FzZXMgd2hlbjoKCiAgICAx
KSBBIGRlY2lzaW9uIGNhbiBiZSBtYWRlIHRvIHJlZGlyZWN0IGVsc2V3aGVyZSB3aXRob3V0CiAg
ICAgICBuZWVkaW5nIHRvIHJlc29sdmUgdGhlIG1vZGVsIGZpcnN0LgogICAgMikgQW55IGFzeW5j
IG9wZXJhdGlvbnMgbmVlZCB0byBvY2N1ciBmaXJzdCBiZWZvcmUgdGhlCiAgICAgICBtb2RlbCBp
cyBhdHRlbXB0ZWQgdG8gYmUgcmVzb2x2ZWQuCgogICAgVGhpcyBob29rIGlzIHByb3ZpZGVkIHRo
ZSBjdXJyZW50IGB0cmFuc2l0aW9uYCBhdHRlbXB0CiAgICBhcyBhIHBhcmFtZXRlciwgd2hpY2gg
Y2FuIGJlIHVzZWQgdG8gYC5hYm9ydCgpYCB0aGUgdHJhbnNpdGlvbiwKICAgIHNhdmUgaXQgZm9y
IGEgbGF0ZXIgYC5yZXRyeSgpYCwgb3IgcmV0cmlldmUgdmFsdWVzIHNldAogICAgb24gaXQgZnJv
bSBhIHByZXZpb3VzIGhvb2suIFlvdSBjYW4gYWxzbyBqdXN0IGNhbGwKICAgIGB0aGlzLnRyYW5z
aXRpb25Ub2AgdG8gYW5vdGhlciByb3V0ZSB0byBpbXBsaWNpdGx5CiAgICBhYm9ydCB0aGUgYHRy
YW5zaXRpb25gLgoKICAgIFlvdSBjYW4gcmV0dXJuIGEgcHJvbWlzZSBmcm9tIHRoaXMgaG9vayB0
byBwYXVzZSB0aGUKICAgIHRyYW5zaXRpb24gdW50aWwgdGhlIHByb21pc2UgcmVzb2x2ZXMgKG9y
IHJlamVjdHMpLiBUaGlzIGNvdWxkCiAgICBiZSB1c2VmdWwsIGZvciBpbnN0YW5jZSwgZm9yIHJl
dHJpZXZpbmcgYXN5bmMgY29kZSBmcm9tCiAgICB0aGUgc2VydmVyIHRoYXQgaXMgcmVxdWlyZWQg
dG8gZW50ZXIgYSByb3V0ZS4KCiAgICBgYGBqcwogICAgQXBwLlBvc3RSb3V0ZSA9IEVtYmVyLlJv
dXRlLmV4dGVuZCh7CiAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbih0cmFuc2l0aW9uKSB7CiAg
ICAgICAgaWYgKCFBcHAuUG9zdCkgewogICAgICAgICAgcmV0dXJuIEVtYmVyLiQuZ2V0U2NyaXB0
KCcvbW9kZWxzL3Bvc3QuanMnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgog
ICAgSWYgYEFwcC5Qb3N0YCBkb2Vzbid0IGV4aXN0IGluIHRoZSBhYm92ZSBleGFtcGxlLAogICAg
YGJlZm9yZU1vZGVsYCB3aWxsIHVzZSBqUXVlcnkncyBgZ2V0U2NyaXB0YCwgd2hpY2gKICAgIHJl
dHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgdGhlIHNlcnZlciBoYXMKICAgIHN1
Y2Nlc3NmdWxseSByZXRyaWV2ZWQgYW5kIGV4ZWN1dGVkIHRoZSBjb2RlIGZyb20gdGhlCiAgICBz
ZXJ2ZXIuIE5vdGUgdGhhdCBpZiBhbiBlcnJvciB3ZXJlIHRvIG9jY3VyLCBpdCB3b3VsZAogICAg
YmUgcGFzc2VkIHRvIHRoZSBgZXJyb3JgIGhvb2sgb24gYEVtYmVyLlJvdXRlYCwgYnV0CiAgICBp
dCdzIGFsc28gcG9zc2libGUgdG8gaGFuZGxlIGVycm9ycyBzcGVjaWZpYyB0bwogICAgYGJlZm9y
ZU1vZGVsYCByaWdodCBmcm9tIHdpdGhpbiB0aGUgaG9vayAodG8gZGlzdGluZ3Vpc2gKICAgIGZy
b20gdGhlIHNoYXJlZCBlcnJvciBoYW5kbGluZyBiZWhhdmlvciBvZiB0aGUgYGVycm9yYAogICAg
aG9vayk6CgogICAgYGBganMKICAgIEFwcC5Qb3N0Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQo
ewogICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24odHJhbnNpdGlvbikgewogICAgICAgIGlmICgh
QXBwLlBvc3QpIHsKICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgIHJldHVybiBF
bWJlci4kLmdldFNjcmlwdCgncG9zdC5qcycpLnRoZW4obnVsbCwgZnVuY3Rpb24oZSkgewogICAg
ICAgICAgICBzZWxmLnRyYW5zaXRpb25UbygnaGVscCcpOwoKICAgICAgICAgICAgLy8gTm90ZSB0
aGF0IHRoZSBhYm92ZSB0cmFuc2l0aW9uVG8gd2lsbCBpbXBsaWNpdGx5CiAgICAgICAgICAgIC8v
IGhhbHQgdGhlIHRyYW5zaXRpb24uIElmIHlvdSB3ZXJlIHRvIHJldHVybgogICAgICAgICAgICAv
LyBub3RoaW5nIGZyb20gdGhpcyBwcm9taXNlIHJlamVjdCBoYW5kbGVyLAogICAgICAgICAgICAv
LyBhY2NvcmRpbmcgdG8gcHJvbWlzZSBzZW1hbnRpY3MsIHRoYXQgd291bGQKICAgICAgICAgICAg
Ly8gY29udmVydCB0aGUgcmVqZWN0IGludG8gYSByZXNvbHZlIGFuZCB0aGUKICAgICAgICAgICAg
Ly8gdHJhbnNpdGlvbiB3b3VsZCBjb250aW51ZS4gVG8gcHJvcGFnYXRlIHRoZQogICAgICAgICAg
ICAvLyBlcnJvciBzbyB0aGF0IGl0J2QgYmUgaGFuZGxlZCBieSB0aGUgYGVycm9yYAogICAgICAg
ICAgICAvLyBob29rLCB5b3Ugd291bGQgaGF2ZSB0byBlaXRoZXIKICAgICAgICAgICAgcmV0dXJu
IEVtYmVyLlJTVlAucmVqZWN0KGUpOwogICAgICAgICAgICAvLyBvcgogICAgICAgICAgICB0aHJv
dyBlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAg
IEBtZXRob2QgYmVmb3JlTW9kZWwKICAgIEBwYXJhbSB7VHJhbnNpdGlvbn0gdHJhbnNpdGlvbgog
ICAgQHBhcmFtIHtPYmplY3R9IHF1ZXJ5UGFyYW1zIHRoZSBhY3RpdmUgcXVlcnkgcGFyYW1zIGZv
ciB0aGlzIHJvdXRlCiAgICBAcmV0dXJuIHtQcm9taXNlfSBpZiB0aGUgdmFsdWUgcmV0dXJuZWQg
ZnJvbSB0aGlzIGhvb2sgaXMKICAgICAgYSBwcm9taXNlLCB0aGUgdHJhbnNpdGlvbiB3aWxsIHBh
dXNlIHVudGlsIHRoZSB0cmFuc2l0aW9uCiAgICAgIHJlc29sdmVzLiBPdGhlcndpc2UsIG5vbi1w
cm9taXNlIHJldHVybiB2YWx1ZXMgYXJlIG5vdAogICAgICB1dGlsaXplZCBpbiBhbnkgd2F5Lgog
ICovCiAgYmVmb3JlTW9kZWw6IEVtYmVyLkssCgogIC8qKgogICAgVGhpcyBob29rIGlzIGNhbGxl
ZCBhZnRlciB0aGlzIHJvdXRlJ3MgbW9kZWwgaGFzIHJlc29sdmVkLgogICAgSXQgZm9sbG93cyBp
ZGVudGljYWwgYXN5bmMvcHJvbWlzZSBzZW1hbnRpY3MgdG8gYGJlZm9yZU1vZGVsYAogICAgYnV0
IGlzIHByb3ZpZGVkIHRoZSByb3V0ZSdzIHJlc29sdmVkIG1vZGVsIGluIGFkZGl0aW9uIHRvCiAg
ICB0aGUgYHRyYW5zaXRpb25gLCBhbmQgaXMgdGhlcmVmb3JlIHN1aXRlZCB0byBwZXJmb3JtaW5n
CiAgICBsb2dpYyB0aGF0IGNhbiBvbmx5IHRha2UgcGxhY2UgYWZ0ZXIgdGhlIG1vZGVsIGhhcyBh
bHJlYWR5CiAgICByZXNvbHZlZC4KCiAgICBgYGBqcwogICAgQXBwLlBvc3RzUm91dGUgPSBFbWJl
ci5Sb3V0ZS5leHRlbmQoewogICAgICBhZnRlck1vZGVsOiBmdW5jdGlvbihwb3N0cywgdHJhbnNp
dGlvbikgewogICAgICAgIGlmIChwb3N0cy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHRoaXMu
dHJhbnNpdGlvblRvKCdwb3N0LnNob3cnLCBwb3N0c1swXSk7CiAgICAgICAgfQogICAgICB9CiAg
ICB9KTsKICAgIGBgYAoKICAgIFJlZmVyIHRvIGRvY3VtZW50YXRpb24gZm9yIGBiZWZvcmVNb2Rl
bGAgZm9yIGEgZGVzY3JpcHRpb24KICAgIG9mIHRyYW5zaXRpb24tcGF1c2luZyBzZW1hbnRpY3Mg
d2hlbiBhIHByb21pc2UgaXMgcmV0dXJuZWQKICAgIGZyb20gdGhpcyBob29rLgoKICAgIEBtZXRo
b2QgYWZ0ZXJNb2RlbAogICAgQHBhcmFtIHtPYmplY3R9IHJlc29sdmVkTW9kZWwgdGhlIHZhbHVl
IHJldHVybmVkIGZyb20gYG1vZGVsYCwKICAgICAgb3IgaXRzIHJlc29sdmVkIHZhbHVlIGlmIGl0
IHdhcyBhIHByb21pc2UKICAgIEBwYXJhbSB7VHJhbnNpdGlvbn0gdHJhbnNpdGlvbgogICAgQHBh
cmFtIHtPYmplY3R9IHF1ZXJ5UGFyYW1zIHRoZSBhY3RpdmUgcXVlcnkgcGFyYW1zIGZvciB0aGlz
IGhhbmRsZXIKICAgIEByZXR1cm4ge1Byb21pc2V9IGlmIHRoZSB2YWx1ZSByZXR1cm5lZCBmcm9t
IHRoaXMgaG9vayBpcwogICAgICBhIHByb21pc2UsIHRoZSB0cmFuc2l0aW9uIHdpbGwgcGF1c2Ug
dW50aWwgdGhlIHRyYW5zaXRpb24KICAgICAgcmVzb2x2ZXMuIE90aGVyd2lzZSwgbm9uLXByb21p
c2UgcmV0dXJuIHZhbHVlcyBhcmUgbm90CiAgICAgIHV0aWxpemVkIGluIGFueSB3YXkuCiAgICov
CiAgYWZ0ZXJNb2RlbDogZnVuY3Rpb24ocmVzb2x2ZWRNb2RlbCwgdHJhbnNpdGlvbiwgcXVlcnlQ
YXJhbXMpIHsKICAgIHRoaXMucmVkaXJlY3QocmVzb2x2ZWRNb2RlbCwgdHJhbnNpdGlvbik7CiAg
fSwKCgogIC8qKgogICAgQ2FsbGVkIHdoZW4gdGhlIGNvbnRleHQgaXMgY2hhbmdlZCBieSByb3V0
ZXIuanMuCgogICAgQHByaXZhdGUKICAgIEBtZXRob2QgY29udGV4dERpZENoYW5nZQogICovCiAg
Y29udGV4dERpZENoYW5nZTogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmN1cnJlbnRNb2RlbCA9IHRo
aXMuY29udGV4dDsKICB9LAoKICAvKioKICAgIEEgaG9vayB5b3UgY2FuIGltcGxlbWVudCB0byBj
b252ZXJ0IHRoZSBVUkwgaW50byB0aGUgbW9kZWwgZm9yCiAgICB0aGlzIHJvdXRlLgoKICAgIGBg
YGpzCiAgICBBcHAuUm91dGVyLm1hcChmdW5jdGlvbigpIHsKICAgICAgdGhpcy5yZXNvdXJjZSgn
cG9zdCcsIHtwYXRoOiAnL3Bvc3RzLzpwb3N0X2lkJ30pOwogICAgfSk7CiAgICBgYGAKCiAgICBU
aGUgbW9kZWwgZm9yIHRoZSBgcG9zdGAgcm91dGUgaXMgYEFwcC5Qb3N0LmZpbmQocGFyYW1zLnBv
c3RfaWQpYC4KCiAgICBCeSBkZWZhdWx0LCBpZiB5b3VyIHJvdXRlIGhhcyBhIGR5bmFtaWMgc2Vn
bWVudCBlbmRpbmcgaW4gYF9pZGA6CgogICAgKiBUaGUgbW9kZWwgY2xhc3MgaXMgZGV0ZXJtaW5l
ZCBmcm9tIHRoZSBzZWdtZW50IChgcG9zdF9pZGAncwogICAgICBjbGFzcyBpcyBgQXBwLlBvc3Rg
KQogICAgKiBUaGUgZmluZCBtZXRob2QgaXMgY2FsbGVkIG9uIHRoZSBtb2RlbCBjbGFzcyB3aXRo
IHRoZSB2YWx1ZSBvZgogICAgICB0aGUgZHluYW1pYyBzZWdtZW50LgoKICAgIE5vdGUgdGhhdCBm
b3Igcm91dGVzIHdpdGggZHluYW1pYyBzZWdtZW50cywgdGhpcyBob29rIGlzIG9ubHkKICAgIGV4
ZWN1dGVkIHdoZW4gZW50ZXJlZCB2aWEgdGhlIFVSTC4gSWYgdGhlIHJvdXRlIGlzIGVudGVyZWQK
ICAgIHRocm91Z2ggYSB0cmFuc2l0aW9uIChlLmcuIHdoZW4gdXNpbmcgdGhlIGBsaW5rLXRvYCBI
YW5kbGViYXJzCiAgICBoZWxwZXIpLCB0aGVuIGEgbW9kZWwgY29udGV4dCBpcyBhbHJlYWR5IHBy
b3ZpZGVkIGFuZCB0aGlzIGhvb2sKICAgIGlzIG5vdCBjYWxsZWQuIFJvdXRlcyB3aXRob3V0IGR5
bmFtaWMgc2VnbWVudHMgd2lsbCBhbHdheXMKICAgIGV4ZWN1dGUgdGhlIG1vZGVsIGhvb2suCgog
ICAgVGhpcyBob29rIGZvbGxvd3MgdGhlIGFzeW5jaHJvbm91cy9wcm9taXNlIHNlbWFudGljcwog
ICAgZGVzY3JpYmVkIGluIHRoZSBkb2N1bWVudGF0aW9uIGZvciBgYmVmb3JlTW9kZWxgLiBJbiBw
YXJ0aWN1bGFyLAogICAgaWYgYSBwcm9taXNlIHJldHVybmVkIGZyb20gYG1vZGVsYCBmYWlscywg
dGhlIGVycm9yIHdpbGwgYmUKICAgIGhhbmRsZWQgYnkgdGhlIGBlcnJvcmAgaG9vayBvbiBgRW1i
ZXIuUm91dGVgLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqcwogICAgQXBwLlBvc3RSb3V0ZSA9IEVt
YmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIG1vZGVsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAg
ICByZXR1cm4gQXBwLlBvc3QuZmluZChwYXJhbXMucG9zdF9pZCk7CiAgICAgIH0KICAgIH0pOwog
ICAgYGBgCgogICAgQG1ldGhvZCBtb2RlbAogICAgQHBhcmFtIHtPYmplY3R9IHBhcmFtcyB0aGUg
cGFyYW1ldGVycyBleHRyYWN0ZWQgZnJvbSB0aGUgVVJMCiAgICBAcGFyYW0ge1RyYW5zaXRpb259
IHRyYW5zaXRpb24KICAgIEBwYXJhbSB7T2JqZWN0fSBxdWVyeVBhcmFtcyB0aGUgcXVlcnkgcGFy
YW1zIGZvciB0aGlzIHJvdXRlCiAgICBAcmV0dXJuIHtPYmplY3R8UHJvbWlzZX0gdGhlIG1vZGVs
IGZvciB0aGlzIHJvdXRlLiBJZgogICAgICBhIHByb21pc2UgaXMgcmV0dXJuZWQsIHRoZSB0cmFu
c2l0aW9uIHdpbGwgcGF1c2UgdW50aWwKICAgICAgdGhlIHByb21pc2UgcmVzb2x2ZXMsIGFuZCB0
aGUgcmVzb2x2ZWQgdmFsdWUgb2YgdGhlIHByb21pc2UKICAgICAgd2lsbCBiZSB1c2VkIGFzIHRo
ZSBtb2RlbCBmb3IgdGhpcyByb3V0ZS4KICAqLwogIG1vZGVsOiBmdW5jdGlvbihwYXJhbXMsIHRy
YW5zaXRpb24pIHsKICAgIHZhciBtYXRjaCwgbmFtZSwgc2F3UGFyYW1zLCB2YWx1ZTsKCiAgICBm
b3IgKHZhciBwcm9wIGluIHBhcmFtcykgewogICAgICBpZiAobWF0Y2ggPSBwcm9wLm1hdGNoKC9e
KC4qKV9pZCQvKSkgewogICAgICAgIG5hbWUgPSBtYXRjaFsxXTsKICAgICAgICB2YWx1ZSA9IHBh
cmFtc1twcm9wXTsKICAgICAgfQogICAgICBzYXdQYXJhbXMgPSB0cnVlOwogICAgfQoKICAgIGlm
ICghbmFtZSAmJiBzYXdQYXJhbXMpIHsgcmV0dXJuIHBhcmFtczsgfQogICAgZWxzZSBpZiAoIW5h
bWUpIHsgcmV0dXJuOyB9CgogICAgcmV0dXJuIHRoaXMuZmluZE1vZGVsKG5hbWUsIHZhbHVlKTsK
ICB9LAoKICAvKioKCiAgICBAbWV0aG9kIGZpbmRNb2RlbAogICAgQHBhcmFtIHtTdHJpbmd9IHR5
cGUgdGhlIG1vZGVsIHR5cGUKICAgIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSB0aGUgdmFsdWUgcGFz
c2VkIHRvIGZpbmQKICAqLwogIGZpbmRNb2RlbDogZnVuY3Rpb24oKXsKICAgIHZhciBzdG9yZSA9
IGdldCh0aGlzLCAnc3RvcmUnKTsKICAgIHJldHVybiBzdG9yZS5maW5kLmFwcGx5KHN0b3JlLCBh
cmd1bWVudHMpOwogIH0sCgogIC8qKgogICAgU3RvcmUgcHJvcGVydHkgcHJvdmlkZXMgYSBob29r
IGZvciBkYXRhIHBlcnNpc3RlbmNlIGxpYnJhcmllcyB0byBpbmplY3QgdGhlbXNlbHZlcy4KCiAg
ICBCeSBkZWZhdWx0LCB0aGlzIHN0b3JlIHByb3BlcnR5IHByb3ZpZGVzIHRoZSBleGFjdCBzYW1l
IGZ1bmN0aW9uYWxpdHkgcHJldmlvdXNseQogICAgaW4gdGhlIG1vZGVsIGhvb2suCgogICAgQ3Vy
cmVudGx5LCB0aGUgcmVxdWlyZWQgaW50ZXJmYWNlIGlzOgoKICAgIGBzdG9yZS5maW5kKG1vZGVs
TmFtZSwgZmluZEFyZ3VtZW50cylgCgogICAgQG1ldGhvZCBzdG9yZQogICAgQHBhcmFtIHtPYmpl
Y3R9IHN0b3JlCiAgKi8KICBzdG9yZTogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKXsKICAgIHZh
ciBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjsKICAgIHZhciByb3V0ZU5hbWUgPSB0aGlzLnJv
dXRlTmFtZTsKICAgIHZhciBuYW1lc3BhY2UgPSBnZXQodGhpcywgJ3JvdXRlci5uYW1lc3BhY2Un
KTsKCiAgICByZXR1cm4gewogICAgICBmaW5kOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAg
ICAgIHZhciBtb2RlbENsYXNzID0gY29udGFpbmVyLmxvb2t1cEZhY3RvcnkoJ21vZGVsOicgKyBu
YW1lKTsKCiAgICAgICAgRW1iZXIuYXNzZXJ0KCJZb3UgdXNlZCB0aGUgZHluYW1pYyBzZWdtZW50
ICIgKyBuYW1lICsgIl9pZCBpbiB5b3VyIHJvdXRlICIgKwogICAgICAgICAgICAgICAgICAgICBy
b3V0ZU5hbWUgKyAiLCBidXQgIiArIG5hbWVzcGFjZSArICIuIiArIGNsYXNzaWZ5KG5hbWUpICsK
ICAgICAgICAgICAgICAgICAgICAgIiBkaWQgbm90IGV4aXN0IGFuZCB5b3UgZGlkIG5vdCBvdmVy
cmlkZSB5b3VyIHJvdXRlJ3MgYG1vZGVsYCAiICsKICAgICAgICAgICAgICAgICAgICAgImhvb2su
IiwgbW9kZWxDbGFzcyk7CgogICAgICAgIHJldHVybiBtb2RlbENsYXNzLmZpbmQodmFsdWUpOwog
ICAgICB9CiAgICB9OwogIH0pLAoKICAvKioKICAgIEEgaG9vayB5b3UgY2FuIGltcGxlbWVudCB0
byBjb252ZXJ0IHRoZSByb3V0ZSdzIG1vZGVsIGludG8gcGFyYW1ldGVycwogICAgZm9yIHRoZSBV
UkwuCgogICAgYGBganMKICAgIEFwcC5Sb3V0ZXIubWFwKGZ1bmN0aW9uKCkgewogICAgICB0aGlz
LnJlc291cmNlKCdwb3N0Jywge3BhdGg6ICcvcG9zdHMvOnBvc3RfaWQnfSk7CiAgICB9KTsKCiAg
ICBBcHAuUG9zdFJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKHsKICAgICAgbW9kZWw6IGZ1bmN0
aW9uKHBhcmFtcykgewogICAgICAgIC8vIHRoZSBzZXJ2ZXIgcmV0dXJucyBgeyBpZDogMTIgfWAK
ICAgICAgICByZXR1cm4galF1ZXJ5LmdldEpTT04oIi9wb3N0cy8iICsgcGFyYW1zLnBvc3RfaWQp
OwogICAgICB9LAoKICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbihtb2RlbCkgewogICAgICAgIC8v
IHRoaXMgd2lsbCBtYWtlIHRoZSBVUkwgYC9wb3N0cy8xMmAKICAgICAgICByZXR1cm4geyBwb3N0
X2lkOiBtb2RlbC5pZCB9OwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIFRoZSBkZWZhdWx0
IGBzZXJpYWxpemVgIG1ldGhvZCB3aWxsIGluc2VydCB0aGUgbW9kZWwncyBgaWRgIGludG8gdGhl
CiAgICByb3V0ZSdzIGR5bmFtaWMgc2VnbWVudCAoaW4gdGhpcyBjYXNlLCBgOnBvc3RfaWRgKSBp
ZiB0aGUgc2VnbWVudCBjb250YWlucyAnX2lkJy4KICAgIElmIHRoZSByb3V0ZSBoYXMgbXVsdGlw
bGUgZHluYW1pYyBzZWdtZW50cyBvciBkb2VzIG5vdCBjb250YWluICdfaWQnLCBgc2VyaWFsaXpl
YAogICAgd2lsbCByZXR1cm4gYEVtYmVyLmdldFByb3BlcnRpZXMobW9kZWwsIHBhcmFtcylgCgog
ICAgVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gYHRyYW5zaXRpb25Ub2AgaXMgY2FsbGVkIHdp
dGggYSBjb250ZXh0CiAgICBpbiBvcmRlciB0byBwb3B1bGF0ZSB0aGUgVVJMLgoKICAgIEBtZXRo
b2Qgc2VyaWFsaXplCiAgICBAcGFyYW0ge09iamVjdH0gbW9kZWwgdGhlIHJvdXRlJ3MgbW9kZWwK
ICAgIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhbiBBcnJheSBvZiBwYXJhbWV0ZXIgbmFtZXMgZm9y
IHRoZSBjdXJyZW50CiAgICAgIHJvdXRlIChpbiB0aGUgZXhhbXBsZSwgYFsncG9zdF9pZCddYC4K
ICAgIEByZXR1cm4ge09iamVjdH0gdGhlIHNlcmlhbGl6ZWQgcGFyYW1ldGVycwogICovCiAgc2Vy
aWFsaXplOiBmdW5jdGlvbihtb2RlbCwgcGFyYW1zKSB7CiAgICBpZiAocGFyYW1zLmxlbmd0aCA8
IDEpIHsgcmV0dXJuOyB9CiAgICBpZiAoIW1vZGVsKSB7IHJldHVybjsgfQoKICAgIHZhciBuYW1l
ID0gcGFyYW1zWzBdLCBvYmplY3QgPSB7fTsKCiAgICBpZiAoL19pZCQvLnRlc3QobmFtZSkgJiYg
cGFyYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICBvYmplY3RbbmFtZV0gPSBnZXQobW9kZWwsICJp
ZCIpOwogICAgfSBlbHNlIHsKICAgICAgb2JqZWN0ID0gZ2V0UHJvcGVydGllcyhtb2RlbCwgcGFy
YW1zKTsKICAgIH0KCiAgICByZXR1cm4gb2JqZWN0OwogIH0sCgogIC8qKgogICAgQSBob29rIHlv
dSBjYW4gdXNlIHRvIHNldHVwIHRoZSBjb250cm9sbGVyIGZvciB0aGUgY3VycmVudCByb3V0ZS4K
CiAgICBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2l0aCB0aGUgY29udHJvbGxlciBmb3IgdGhlIGN1
cnJlbnQgcm91dGUgYW5kIHRoZQogICAgbW9kZWwgc3VwcGxpZWQgYnkgdGhlIGBtb2RlbGAgaG9v
ay4KCiAgICBCeSBkZWZhdWx0LCB0aGUgYHNldHVwQ29udHJvbGxlcmAgaG9vayBzZXRzIHRoZSBg
Y29udGVudGAgcHJvcGVydHkgb2YKICAgIHRoZSBjb250cm9sbGVyIHRvIHRoZSBgbW9kZWxgLgoK
ICAgIFRoaXMgbWVhbnMgdGhhdCB5b3VyIHRlbXBsYXRlIHdpbGwgZ2V0IGEgcHJveHkgZm9yIHRo
ZSBtb2RlbCBhcyBpdHMKICAgIGNvbnRleHQsIGFuZCB5b3UgY2FuIGFjdCBhcyB0aG91Z2ggdGhl
IG1vZGVsIGl0c2VsZiB3YXMgdGhlIGNvbnRleHQuCgogICAgVGhlIHByb3ZpZGVkIGNvbnRyb2xs
ZXIgd2lsbCBiZSBvbmUgcmVzb2x2ZWQgYmFzZWQgb24gdGhlIG5hbWUKICAgIG9mIHRoaXMgcm91
dGUuCgogICAgSWYgbm8gZXhwbGljaXQgY29udHJvbGxlciBpcyBkZWZpbmVkLCBFbWJlciB3aWxs
IGF1dG9tYXRpY2FsbHkgY3JlYXRlCiAgICBhbiBhcHByb3ByaWF0ZSBjb250cm9sbGVyIGZvciB0
aGUgbW9kZWwuCgogICAgKiBpZiB0aGUgbW9kZWwgaXMgYW4gYEVtYmVyLkFycmF5YCAoaW5jbHVk
aW5nIHJlY29yZCBhcnJheXMgZnJvbSBFbWJlcgogICAgICBEYXRhKSwgdGhlIGNvbnRyb2xsZXIg
aXMgYW4gYEVtYmVyLkFycmF5Q29udHJvbGxlcmAuCiAgICAqIG90aGVyd2lzZSwgdGhlIGNvbnRy
b2xsZXIgaXMgYW4gYEVtYmVyLk9iamVjdENvbnRyb2xsZXJgLgoKICAgIEFzIGFuIGV4YW1wbGUs
IGNvbnNpZGVyIHRoZSByb3V0ZXI6CgogICAgYGBganMKICAgIEFwcC5Sb3V0ZXIubWFwKGZ1bmN0
aW9uKCkgewogICAgICB0aGlzLnJlc291cmNlKCdwb3N0Jywge3BhdGg6ICcvcG9zdHMvOnBvc3Rf
aWQnfSk7CiAgICB9KTsKICAgIGBgYAoKICAgIEZvciB0aGUgYHBvc3RgIHJvdXRlLCBhIGNvbnRy
b2xsZXIgbmFtZWQgYEFwcC5Qb3N0Q29udHJvbGxlcmAgd291bGQKICAgIGJlIHVzZWQgaWYgaXQg
aXMgZGVmaW5lZC4gSWYgaXQgaXMgbm90IGRlZmluZWQsIGFuIGBFbWJlci5PYmplY3RDb250cm9s
bGVyYAogICAgaW5zdGFuY2Ugd291bGQgYmUgdXNlZC4KCiAgICBFeGFtcGxlCgogICAgYGBganMK
ICAgIEFwcC5Qb3N0Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICBzZXR1cENvbnRy
b2xsZXI6IGZ1bmN0aW9uKGNvbnRyb2xsZXIsIG1vZGVsKSB7CiAgICAgICAgY29udHJvbGxlci5z
ZXQoJ21vZGVsJywgbW9kZWwpOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2Qg
c2V0dXBDb250cm9sbGVyCiAgICBAcGFyYW0ge0NvbnRyb2xsZXJ9IGNvbnRyb2xsZXIgaW5zdGFu
Y2UKICAgIEBwYXJhbSB7T2JqZWN0fSBtb2RlbAogICovCiAgc2V0dXBDb250cm9sbGVyOiBmdW5j
dGlvbihjb250cm9sbGVyLCBjb250ZXh0KSB7CiAgICBpZiAoY29udHJvbGxlciAmJiAoY29udGV4
dCAhPT0gdW5kZWZpbmVkKSkgewogICAgICBzZXQoY29udHJvbGxlciwgJ21vZGVsJywgY29udGV4
dCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRoZSBjb250cm9sbGVyIGZvciBhIHBh
cnRpY3VsYXIgcm91dGUgb3IgbmFtZS4KCiAgICBUaGUgY29udHJvbGxlciBpbnN0YW5jZSBtdXN0
IGFscmVhZHkgaGF2ZSBiZWVuIGNyZWF0ZWQsIGVpdGhlciB0aHJvdWdoIGVudGVyaW5nIHRoZQog
ICAgYXNzb2NpYXRlZCByb3V0ZSBvciB1c2luZyBgZ2VuZXJhdGVDb250cm9sbGVyYC4KCiAgICBg
YGBqcwogICAgQXBwLlBvc3RSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIHNldHVw
Q29udHJvbGxlcjogZnVuY3Rpb24oY29udHJvbGxlciwgcG9zdCkgewogICAgICAgIHRoaXMuX3N1
cGVyKGNvbnRyb2xsZXIsIHBvc3QpOwogICAgICAgIHRoaXMuY29udHJvbGxlckZvcigncG9zdHMn
KS5zZXQoJ2N1cnJlbnRQb3N0JywgcG9zdCk7CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAg
QG1ldGhvZCBjb250cm9sbGVyRm9yCiAgICBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgbmFtZSBv
ZiB0aGUgcm91dGUgb3IgY29udHJvbGxlcgogICAgQHJldHVybiB7RW1iZXIuQ29udHJvbGxlcn0K
ICAqLwogIGNvbnRyb2xsZXJGb3I6IGZ1bmN0aW9uKG5hbWUsIF9za2lwQXNzZXJ0KSB7CiAgICB2
YXIgY29udGFpbmVyID0gdGhpcy5jb250YWluZXIsCiAgICAgICAgcm91dGUgPSBjb250YWluZXIu
bG9va3VwKCdyb3V0ZTonK25hbWUpLAogICAgICAgIGNvbnRyb2xsZXI7CgogICAgaWYgKHJvdXRl
ICYmIHJvdXRlLmNvbnRyb2xsZXJOYW1lKSB7CiAgICAgIG5hbWUgPSByb3V0ZS5jb250cm9sbGVy
TmFtZTsKICAgIH0KCiAgICBjb250cm9sbGVyID0gY29udGFpbmVyLmxvb2t1cCgnY29udHJvbGxl
cjonICsgbmFtZSk7CgogICAgLy8gTk9URTogV2UncmUgc3BlY2lmaWNhbGx5IGNoZWNraW5nIHRo
YXQgc2tpcEFzc2VydCBpcyB0cnVlLCBiZWNhdXNlIGFjY29yZGluZwogICAgLy8gICB0byB0aGUg
b2xkIEFQSSB0aGUgc2Vjb25kIHBhcmFtZXRlciB3YXMgbW9kZWwuIFdlIGRvIG5vdCB3YW50IHBl
b3BsZSB3aG8KICAgIC8vICAgcGFzc2VkIGEgbW9kZWwgdG8gc2tpcCB0aGUgYXNzZXJ0aW9uLgog
ICAgRW1iZXIuYXNzZXJ0KCJUaGUgY29udHJvbGxlciBuYW1lZCAnIituYW1lKyInIGNvdWxkIG5v
dCBiZSBmb3VuZC4gTWFrZSBzdXJlICIgKwogICAgICAgICAgICAgICAgICJ0aGF0IHRoaXMgcm91
dGUgZXhpc3RzIGFuZCBoYXMgYWxyZWFkeSBiZWVuIGVudGVyZWQgYXQgbGVhc3QgIiArCiAgICAg
ICAgICAgICAgICAgIm9uY2UuIElmIHlvdSBhcmUgYWNjZXNzaW5nIGEgY29udHJvbGxlciBub3Qg
YXNzb2NpYXRlZCB3aXRoIGEgIiArCiAgICAgICAgICAgICAgICAgInJvdXRlLCBtYWtlIHN1cmUg
dGhlIGNvbnRyb2xsZXIgY2xhc3MgaXMgZXhwbGljaXRseSBkZWZpbmVkLiIsCiAgICAgICAgICAg
ICAgICAgY29udHJvbGxlciB8fCBfc2tpcEFzc2VydCA9PT0gdHJ1ZSk7CgogICAgcmV0dXJuIGNv
bnRyb2xsZXI7CiAgfSwKCiAgLyoqCiAgICBHZW5lcmF0ZXMgYSBjb250cm9sbGVyIGZvciBhIHJv
dXRlLgoKICAgIElmIHRoZSBvcHRpb25hbCBtb2RlbCBpcyBwYXNzZWQgdGhlbiB0aGUgY29udHJv
bGxlciB0eXBlIGlzIGRldGVybWluZWQgYXV0b21hdGljYWxseSwKICAgIGUuZy4sIGFuIEFycmF5
Q29udHJvbGxlciBmb3IgYXJyYXlzLgoKICAgIEV4YW1wbGUKCiAgICBgYGBqcwogICAgQXBwLlBv
c3RSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIHNldHVwQ29udHJvbGxlcjogZnVu
Y3Rpb24oY29udHJvbGxlciwgcG9zdCkgewogICAgICAgIHRoaXMuX3N1cGVyKGNvbnRyb2xsZXIs
IHBvc3QpOwogICAgICAgIHRoaXMuZ2VuZXJhdGVDb250cm9sbGVyKCdwb3N0cycsIHBvc3QpOwog
ICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2QgZ2VuZXJhdGVDb250cm9sbGVyCiAg
ICBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgY29udHJvbGxlcgogICAgQHBh
cmFtIHtPYmplY3R9IG1vZGVsIHRoZSBtb2RlbCB0byBpbmZlciB0aGUgdHlwZSBvZiB0aGUgY29u
dHJvbGxlciAob3B0aW9uYWwpCiAgKi8KICBnZW5lcmF0ZUNvbnRyb2xsZXI6IGZ1bmN0aW9uKG5h
bWUsIG1vZGVsKSB7CiAgICB2YXIgY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7CgogICAgbW9k
ZWwgPSBtb2RlbCB8fCB0aGlzLm1vZGVsRm9yKG5hbWUpOwoKICAgIHJldHVybiBFbWJlci5nZW5l
cmF0ZUNvbnRyb2xsZXIoY29udGFpbmVyLCBuYW1lLCBtb2RlbCk7CiAgfSwKCiAgLyoqCiAgICBS
ZXR1cm5zIHRoZSBtb2RlbCBvZiBhIHBhcmVudCAob3IgYW55IGFuY2VzdG9yKSByb3V0ZQogICAg
aW4gYSByb3V0ZSBoaWVyYXJjaHkuICBEdXJpbmcgYSB0cmFuc2l0aW9uLCBhbGwgcm91dGVzCiAg
ICBtdXN0IHJlc29sdmUgYSBtb2RlbCBvYmplY3QsIGFuZCBpZiBhIHJvdXRlCiAgICBuZWVkcyBh
Y2Nlc3MgdG8gYSBwYXJlbnQgcm91dGUncyBtb2RlbCBpbiBvcmRlciB0bwogICAgcmVzb2x2ZSBh
IG1vZGVsIChvciBqdXN0IHJldXNlIHRoZSBtb2RlbCBmcm9tIGEgcGFyZW50KSwKICAgIGl0IGNh
biBjYWxsIGB0aGlzLm1vZGVsRm9yKHRoZU5hbWVPZlBhcmVudFJvdXRlKWAgdG8KICAgIHJldHJp
ZXZlIGl0LgoKICAgIEV4YW1wbGUKCiAgICBgYGBqcwogICAgQXBwLlJvdXRlci5tYXAoZnVuY3Rp
b24oKSB7CiAgICAgICAgdGhpcy5yZXNvdXJjZSgncG9zdCcsIHsgcGF0aDogJy9wb3N0Lzpwb3N0
X2lkJyB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5yZXNvdXJjZSgnY29tbWVudHMn
KTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgIEFwcC5Db21tZW50c1JvdXRlID0gRW1iZXIuUm91
dGUuZXh0ZW5kKHsKICAgICAgICBhZnRlck1vZGVsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAg
dGhpcy5zZXQoJ3Bvc3QnLCB0aGlzLm1vZGVsRm9yKCdwb3N0JykpOwogICAgICAgIH0KICAgIH0p
OwogICAgYGBgCgogICAgQG1ldGhvZCBtb2RlbEZvcgogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUg
dGhlIG5hbWUgb2YgdGhlIHJvdXRlCiAgICBAcmV0dXJuIHtPYmplY3R9IHRoZSBtb2RlbCBvYmpl
Y3QKICAqLwogIG1vZGVsRm9yOiBmdW5jdGlvbihuYW1lKSB7CgogICAgdmFyIHJvdXRlID0gdGhp
cy5jb250YWluZXIubG9va3VwKCdyb3V0ZTonICsgbmFtZSksCiAgICAgICAgdHJhbnNpdGlvbiA9
IHRoaXMucm91dGVyLnJvdXRlci5hY3RpdmVUcmFuc2l0aW9uOwoKICAgIC8vIElmIHdlIGFyZSBt
aWQtdHJhbnNpdGlvbiwgd2Ugd2FudCB0byB0cnkgYW5kIGxvb2sgdXAKICAgIC8vIHJlc29sdmVk
IHBhcmVudCBjb250ZXh0cyBvbiB0aGUgY3VycmVudCB0cmFuc2l0aW9uRXZlbnQuCiAgICBpZiAo
dHJhbnNpdGlvbikgewogICAgICB2YXIgbW9kZWxMb29rdXBOYW1lID0gKHJvdXRlICYmIHJvdXRl
LnJvdXRlTmFtZSkgfHwgbmFtZTsKICAgICAgaWYgKHRyYW5zaXRpb24ucmVzb2x2ZWRNb2RlbHMu
aGFzT3duUHJvcGVydHkobW9kZWxMb29rdXBOYW1lKSkgewogICAgICAgIHJldHVybiB0cmFuc2l0
aW9uLnJlc29sdmVkTW9kZWxzW21vZGVsTG9va3VwTmFtZV07CiAgICAgIH0KICAgIH0KCiAgICBy
ZXR1cm4gcm91dGUgJiYgcm91dGUuY3VycmVudE1vZGVsOwogIH0sCgogIC8qKgogICAgQSBob29r
IHlvdSBjYW4gdXNlIHRvIHJlbmRlciB0aGUgdGVtcGxhdGUgZm9yIHRoZSBjdXJyZW50IHJvdXRl
LgoKICAgIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRoIHRoZSBjb250cm9sbGVyIGZvciB0aGUg
Y3VycmVudCByb3V0ZSBhbmQgdGhlCiAgICBtb2RlbCBzdXBwbGllZCBieSB0aGUgYG1vZGVsYCBo
b29rLiBCeSBkZWZhdWx0LCBpdCByZW5kZXJzIHRoZSByb3V0ZSdzCiAgICB0ZW1wbGF0ZSwgY29u
ZmlndXJlZCB3aXRoIHRoZSBjb250cm9sbGVyIGZvciB0aGUgcm91dGUuCgogICAgVGhpcyBtZXRo
b2QgY2FuIGJlIG92ZXJyaWRkZW4gdG8gc2V0IHVwIGFuZCByZW5kZXIgYWRkaXRpb25hbCBvcgog
ICAgYWx0ZXJuYXRpdmUgdGVtcGxhdGVzLgoKICAgIGBgYGpzCiAgICBBcHAuUG9zdHNSb3V0ZSA9
IEVtYmVyLlJvdXRlLmV4dGVuZCh7CiAgICAgIHJlbmRlclRlbXBsYXRlOiBmdW5jdGlvbihjb250
cm9sbGVyLCBtb2RlbCkgewogICAgICAgIHZhciBmYXZDb250cm9sbGVyID0gdGhpcy5jb250cm9s
bGVyRm9yKCdmYXZvcml0ZVBvc3QnKTsKCiAgICAgICAgLy8gUmVuZGVyIHRoZSBgZmF2b3JpdGVQ
b3N0YCB0ZW1wbGF0ZSBpbnRvCiAgICAgICAgLy8gdGhlIG91dGxldCBgcG9zdHNgLCBhbmQgZGlz
cGxheSB0aGUgYGZhdm9yaXRlUG9zdGAKICAgICAgICAvLyBjb250cm9sbGVyLgogICAgICAgIHRo
aXMucmVuZGVyKCdmYXZvcml0ZVBvc3QnLCB7CiAgICAgICAgICBvdXRsZXQ6ICdwb3N0cycsCiAg
ICAgICAgICBjb250cm9sbGVyOiBmYXZDb250cm9sbGVyCiAgICAgICAgfSk7CiAgICAgIH0KICAg
IH0pOwogICAgYGBgCgogICAgQG1ldGhvZCByZW5kZXJUZW1wbGF0ZQogICAgQHBhcmFtIHtPYmpl
Y3R9IGNvbnRyb2xsZXIgdGhlIHJvdXRlJ3MgY29udHJvbGxlcgogICAgQHBhcmFtIHtPYmplY3R9
IG1vZGVsIHRoZSByb3V0ZSdzIG1vZGVsCiAgKi8KICByZW5kZXJUZW1wbGF0ZTogZnVuY3Rpb24o
Y29udHJvbGxlciwgbW9kZWwpIHsKICAgIHRoaXMucmVuZGVyKCk7CiAgfSwKCiAgLyoqCiAgICBS
ZW5kZXJzIGEgdGVtcGxhdGUgaW50byBhbiBvdXRsZXQuCgogICAgVGhpcyBtZXRob2QgaGFzIGEg
bnVtYmVyIG9mIGRlZmF1bHRzLCBiYXNlZCBvbiB0aGUgbmFtZSBvZiB0aGUKICAgIHJvdXRlIHNw
ZWNpZmllZCBpbiB0aGUgcm91dGVyLgoKICAgIEZvciBleGFtcGxlOgoKICAgIGBgYGpzCiAgICBB
cHAuUm91dGVyLm1hcChmdW5jdGlvbigpIHsKICAgICAgdGhpcy5yb3V0ZSgnaW5kZXgnKTsKICAg
ICAgdGhpcy5yZXNvdXJjZSgncG9zdCcsIHtwYXRoOiAnL3Bvc3RzLzpwb3N0X2lkJ30pOwogICAg
fSk7CgogICAgQXBwLlBvc3RSb3V0ZSA9IEFwcC5Sb3V0ZS5leHRlbmQoewogICAgICByZW5kZXJU
ZW1wbGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgfQogICAg
fSk7CiAgICBgYGAKCiAgICBUaGUgbmFtZSBvZiB0aGUgYFBvc3RSb3V0ZWAsIGFzIGRlZmluZWQg
YnkgdGhlIHJvdXRlciwgaXMgYHBvc3RgLgoKICAgIEJ5IGRlZmF1bHQsIHJlbmRlciB3aWxsOgoK
ICAgICogcmVuZGVyIHRoZSBgcG9zdGAgdGVtcGxhdGUKICAgICogd2l0aCB0aGUgYHBvc3RgIHZp
ZXcgKGBQb3N0Vmlld2ApIGZvciBldmVudCBoYW5kbGluZywgaWYgb25lIGV4aXN0cwogICAgKiBh
bmQgdGhlIGBwb3N0YCBjb250cm9sbGVyIChgUG9zdENvbnRyb2xsZXJgKSwgaWYgb25lIGV4aXN0
cwogICAgKiBpbnRvIHRoZSBgbWFpbmAgb3V0bGV0IG9mIHRoZSBgYXBwbGljYXRpb25gIHRlbXBs
YXRlCgogICAgWW91IGNhbiBvdmVycmlkZSB0aGlzIGJlaGF2aW9yOgoKICAgIGBgYGpzCiAgICBB
cHAuUG9zdFJvdXRlID0gQXBwLlJvdXRlLmV4dGVuZCh7CiAgICAgIHJlbmRlclRlbXBsYXRlOiBm
dW5jdGlvbigpIHsKICAgICAgICB0aGlzLnJlbmRlcignbXlQb3N0JywgeyAgIC8vIHRoZSB0ZW1w
bGF0ZSB0byByZW5kZXIKICAgICAgICAgIGludG86ICdpbmRleCcsICAgICAgICAgIC8vIHRoZSB0
ZW1wbGF0ZSB0byByZW5kZXIgaW50bwogICAgICAgICAgb3V0bGV0OiAnZGV0YWlsJywgICAgICAg
Ly8gdGhlIG5hbWUgb2YgdGhlIG91dGxldCBpbiB0aGF0IHRlbXBsYXRlCiAgICAgICAgICBjb250
cm9sbGVyOiAnYmxvZ1Bvc3QnICAvLyB0aGUgY29udHJvbGxlciB0byB1c2UgZm9yIHRoZSB0ZW1w
bGF0ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIFJlbWVtYmVyIHRo
YXQgdGhlIGNvbnRyb2xsZXIncyBgY29udGVudGAgd2lsbCBiZSB0aGUgcm91dGUncyBtb2RlbC4g
SW4KICAgIHRoaXMgY2FzZSwgdGhlIGRlZmF1bHQgbW9kZWwgd2lsbCBiZSBgQXBwLlBvc3QuZmlu
ZChwYXJhbXMucG9zdF9pZClgLgoKICAgIEBtZXRob2QgcmVuZGVyCiAgICBAcGFyYW0ge1N0cmlu
Z30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgdGVtcGxhdGUgdG8gcmVuZGVyCiAgICBAcGFyYW0ge09i
amVjdH0gb3B0aW9ucyB0aGUgb3B0aW9ucwogICovCiAgcmVuZGVyOiBmdW5jdGlvbihuYW1lLCBv
cHRpb25zKSB7CiAgICBFbWJlci5hc3NlcnQoIlRoZSBuYW1lIGluIHRoZSBnaXZlbiBhcmd1bWVu
dHMgaXMgdW5kZWZpbmVkIiwgYXJndW1lbnRzLmxlbmd0aCA+IDAgPyAhRW1iZXIuaXNOb25lKGFy
Z3VtZW50c1swXSkgOiB0cnVlKTsKCiAgICB2YXIgbmFtZVBhc3NlZCA9ICEhbmFtZTsKCiAgICBp
ZiAodHlwZW9mIG5hbWUgPT09ICdvYmplY3QnICYmICFvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMg
PSBuYW1lOwogICAgICBuYW1lID0gdGhpcy5yb3V0ZU5hbWU7CiAgICB9CgogICAgb3B0aW9ucyA9
IG9wdGlvbnMgfHwge307CgogICAgdmFyIHRlbXBsYXRlTmFtZTsKCiAgICBpZiAobmFtZSkgewog
ICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9cLy9nLCAnLicpOwogICAgICB0ZW1wbGF0ZU5hbWUg
PSBuYW1lOwogICAgfSBlbHNlIHsKICAgICAgbmFtZSA9IHRoaXMucm91dGVOYW1lOwogICAgICB0
ZW1wbGF0ZU5hbWUgPSB0aGlzLnRlbXBsYXRlTmFtZSB8fCBuYW1lOwogICAgfQoKICAgIHZhciB2
aWV3TmFtZSA9IG9wdGlvbnMudmlldyB8fCB0aGlzLnZpZXdOYW1lIHx8IG5hbWU7CgogICAgdmFy
IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLAogICAgICAgIHZpZXcgPSBjb250YWluZXIubG9v
a3VwKCd2aWV3OicgKyB2aWV3TmFtZSksCiAgICAgICAgdGVtcGxhdGUgPSB2aWV3ID8gdmlldy5n
ZXQoJ3RlbXBsYXRlJykgOiBudWxsOwoKICAgIGlmICghdGVtcGxhdGUpIHsKICAgICAgdGVtcGxh
dGUgPSBjb250YWluZXIubG9va3VwKCd0ZW1wbGF0ZTonICsgdGVtcGxhdGVOYW1lKTsKICAgIH0K
CiAgICBpZiAoIXZpZXcgJiYgIXRlbXBsYXRlKSB7CiAgICAgIEVtYmVyLmFzc2VydCgiQ291bGQg
bm90IGZpbmQgXCIiICsgbmFtZSArICJcIiB0ZW1wbGF0ZSBvciB2aWV3LiIsICFuYW1lUGFzc2Vk
KTsKICAgICAgaWYgKGdldCh0aGlzLnJvdXRlciwgJ25hbWVzcGFjZS5MT0dfVklFV19MT09LVVBT
JykpIHsKICAgICAgICBFbWJlci5Mb2dnZXIuaW5mbygiQ291bGQgbm90IGZpbmQgXCIiICsgbmFt
ZSArICJcIiB0ZW1wbGF0ZSBvciB2aWV3LiBOb3RoaW5nIHdpbGwgYmUgcmVuZGVyZWQiLCB7IGZ1
bGxOYW1lOiAndGVtcGxhdGU6JyArIG5hbWUgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAg
fQoKICAgIG9wdGlvbnMgPSBub3JtYWxpemVPcHRpb25zKHRoaXMsIG5hbWUsIHRlbXBsYXRlLCBv
cHRpb25zKTsKICAgIHZpZXcgPSBzZXR1cFZpZXcodmlldywgY29udGFpbmVyLCBvcHRpb25zKTsK
CiAgICBpZiAob3B0aW9ucy5vdXRsZXQgPT09ICdtYWluJykgeyB0aGlzLmxhc3RSZW5kZXJlZFRl
bXBsYXRlID0gbmFtZTsgfQoKICAgIGFwcGVuZFZpZXcodGhpcywgdmlldywgb3B0aW9ucyk7CiAg
fSwKCiAgLyoqCiAgICBEaXNjb25uZWN0cyBhIHZpZXcgdGhhdCBoYXMgYmVlbiByZW5kZXJlZCBp
bnRvIGFuIG91dGxldC4KCiAgICBZb3UgbWF5IHBhc3MgYW55IG9yIGFsbCBvZiB0aGUgZm9sbG93
aW5nIG9wdGlvbnMgdG8gYGRpc2Nvbm5lY3RPdXRsZXRgOgoKICAgICogYG91dGxldGA6IHRoZSBu
YW1lIG9mIHRoZSBvdXRsZXQgdG8gY2xlYXIgKGRlZmF1bHQ6ICdtYWluJykKICAgICogYHBhcmVu
dFZpZXdgOiB0aGUgbmFtZSBvZiB0aGUgdmlldyBjb250YWluaW5nIHRoZSBvdXRsZXQgdG8gY2xl
YXIKICAgICAgIChkZWZhdWx0OiB0aGUgdmlldyByZW5kZXJlZCBieSB0aGUgcGFyZW50IHJvdXRl
KQoKICAgIEV4YW1wbGU6CgogICAgYGBganMKICAgIEFwcC5BcHBsaWNhdGlvblJvdXRlID0gQXBw
LlJvdXRlLmV4dGVuZCh7CiAgICAgIGFjdGlvbnM6IHsKICAgICAgICBzaG93TW9kYWw6IGZ1bmN0
aW9uKGV2dCkgewogICAgICAgICAgdGhpcy5yZW5kZXIoZXZ0Lm1vZGFsTmFtZSwgewogICAgICAg
ICAgICBvdXRsZXQ6ICdtb2RhbCcsCiAgICAgICAgICAgIGludG86ICdhcHBsaWNhdGlvbicKICAg
ICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaGlkZU1vZGFsOiBmdW5jdGlvbihldnQpIHsK
ICAgICAgICAgIHRoaXMuZGlzY29ubmVjdE91dGxldCh7CiAgICAgICAgICAgIG91dGxldDogJ21v
ZGFsJywKICAgICAgICAgICAgcGFyZW50VmlldzogJ2FwcGxpY2F0aW9uJwogICAgICAgICAgfSk7
CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGBgYAoKICAgIEBtZXRob2QgZGlzY29ubmVj
dE91dGxldAogICAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgdGhlIG9wdGlvbnMKICAqLwogIGRp
c2Nvbm5lY3RPdXRsZXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25z
IHx8IHt9OwogICAgb3B0aW9ucy5wYXJlbnRWaWV3ID0gb3B0aW9ucy5wYXJlbnRWaWV3ID8gb3B0
aW9ucy5wYXJlbnRWaWV3LnJlcGxhY2UoL1wvL2csICcuJykgOiBwYXJlbnRUZW1wbGF0ZSh0aGlz
KTsKICAgIG9wdGlvbnMub3V0bGV0ID0gb3B0aW9ucy5vdXRsZXQgfHwgJ21haW4nOwoKICAgIHZh
ciBwYXJlbnRWaWV3ID0gdGhpcy5yb3V0ZXIuX2xvb2t1cEFjdGl2ZVZpZXcob3B0aW9ucy5wYXJl
bnRWaWV3KTsKICAgIHBhcmVudFZpZXcuZGlzY29ubmVjdE91dGxldChvcHRpb25zLm91dGxldCk7
CiAgfSwKCiAgd2lsbERlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgdGhpcy50ZWFyZG93blZpZXdz
KCk7CiAgfSwKCiAgLyoqCiAgICBAcHJpdmF0ZQoKICAgIEBtZXRob2QgdGVhcmRvd25WaWV3cwog
ICovCiAgdGVhcmRvd25WaWV3czogZnVuY3Rpb24oKSB7CiAgICAvLyBUZWFyIGRvd24gdGhlIHRv
cCBsZXZlbCB2aWV3CiAgICBpZiAodGhpcy50ZWFyZG93blRvcExldmVsVmlldykgeyB0aGlzLnRl
YXJkb3duVG9wTGV2ZWxWaWV3KCk7IH0KCiAgICAvLyBUZWFyIGRvd24gYW55IG91dGxldHMgcmVu
ZGVyZWQgd2l0aCAnaW50bycKICAgIHZhciB0ZWFyZG93bk91dGxldFZpZXdzID0gdGhpcy50ZWFy
ZG93bk91dGxldFZpZXdzIHx8IFtdOwogICAgYV9mb3JFYWNoKHRlYXJkb3duT3V0bGV0Vmlld3Ms
IGZ1bmN0aW9uKHRlYXJkb3duT3V0bGV0VmlldykgewogICAgICB0ZWFyZG93bk91dGxldFZpZXco
KTsKICAgIH0pOwoKICAgIGRlbGV0ZSB0aGlzLnRlYXJkb3duVG9wTGV2ZWxWaWV3OwogICAgZGVs
ZXRlIHRoaXMudGVhcmRvd25PdXRsZXRWaWV3czsKICAgIGRlbGV0ZSB0aGlzLmxhc3RSZW5kZXJl
ZFRlbXBsYXRlOwogIH0KfSk7CgpmdW5jdGlvbiBwYXJlbnRSb3V0ZShyb3V0ZSkgewogIHZhciBo
YW5kbGVySW5mb3MgPSByb3V0ZS5yb3V0ZXIucm91dGVyLnRhcmdldEhhbmRsZXJJbmZvczsKCiAg
aWYgKCFoYW5kbGVySW5mb3MpIHsgcmV0dXJuOyB9CgogIHZhciBwYXJlbnQsIGN1cnJlbnQ7Cgog
IGZvciAodmFyIGk9MCwgbD1oYW5kbGVySW5mb3MubGVuZ3RoOyBpPGw7IGkrKykgewogICAgY3Vy
cmVudCA9IGhhbmRsZXJJbmZvc1tpXS5oYW5kbGVyOwogICAgaWYgKGN1cnJlbnQgPT09IHJvdXRl
KSB7IHJldHVybiBwYXJlbnQ7IH0KICAgIHBhcmVudCA9IGN1cnJlbnQ7CiAgfQp9CgpmdW5jdGlv
biBwYXJlbnRUZW1wbGF0ZShyb3V0ZSkgewogIHZhciBwYXJlbnQgPSBwYXJlbnRSb3V0ZShyb3V0
ZSksIHRlbXBsYXRlOwoKICBpZiAoIXBhcmVudCkgeyByZXR1cm47IH0KCiAgaWYgKHRlbXBsYXRl
ID0gcGFyZW50Lmxhc3RSZW5kZXJlZFRlbXBsYXRlKSB7CiAgICByZXR1cm4gdGVtcGxhdGU7CiAg
fSBlbHNlIHsKICAgIHJldHVybiBwYXJlbnRUZW1wbGF0ZShwYXJlbnQpOwogIH0KfQoKZnVuY3Rp
b24gbm9ybWFsaXplT3B0aW9ucyhyb3V0ZSwgbmFtZSwgdGVtcGxhdGUsIG9wdGlvbnMpIHsKICBv
cHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBvcHRpb25zLmludG8gPSBvcHRpb25zLmludG8gPyBv
cHRpb25zLmludG8ucmVwbGFjZSgvXC8vZywgJy4nKSA6IHBhcmVudFRlbXBsYXRlKHJvdXRlKTsK
ICBvcHRpb25zLm91dGxldCA9IG9wdGlvbnMub3V0bGV0IHx8ICdtYWluJzsKICBvcHRpb25zLm5h
bWUgPSBuYW1lOwogIG9wdGlvbnMudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKICBvcHRpb25zLkxPR19W
SUVXX0xPT0tVUFMgPSBnZXQocm91dGUucm91dGVyLCAnbmFtZXNwYWNlLkxPR19WSUVXX0xPT0tV
UFMnKTsKCiAgRW1iZXIuYXNzZXJ0KCJBbiBvdXRsZXQgKCIrb3B0aW9ucy5vdXRsZXQrIikgd2Fz
IHNwZWNpZmllZCBidXQgd2FzIG5vdCBmb3VuZC4iLCBvcHRpb25zLm91dGxldCA9PT0gJ21haW4n
IHx8IG9wdGlvbnMuaW50byk7CgogIHZhciBjb250cm9sbGVyID0gb3B0aW9ucy5jb250cm9sbGVy
LCBuYW1lZENvbnRyb2xsZXI7CgogIGlmIChvcHRpb25zLmNvbnRyb2xsZXIpIHsKICAgIGNvbnRy
b2xsZXIgPSBvcHRpb25zLmNvbnRyb2xsZXI7CiAgfSBlbHNlIGlmIChuYW1lZENvbnRyb2xsZXIg
PSByb3V0ZS5jb250YWluZXIubG9va3VwKCdjb250cm9sbGVyOicgKyBuYW1lKSkgewogICAgY29u
dHJvbGxlciA9IG5hbWVkQ29udHJvbGxlcjsKICB9IGVsc2UgewogICAgY29udHJvbGxlciA9IHJv
dXRlLmNvbnRyb2xsZXJOYW1lIHx8IHJvdXRlLnJvdXRlTmFtZTsKICB9CgogIGlmICh0eXBlb2Yg
Y29udHJvbGxlciA9PT0gJ3N0cmluZycpIHsKICAgIGNvbnRyb2xsZXIgPSByb3V0ZS5jb250YWlu
ZXIubG9va3VwKCdjb250cm9sbGVyOicgKyBjb250cm9sbGVyKTsKICB9CgogIG9wdGlvbnMuY29u
dHJvbGxlciA9IGNvbnRyb2xsZXI7CgogIHJldHVybiBvcHRpb25zOwp9CgpmdW5jdGlvbiBzZXR1
cFZpZXcodmlldywgY29udGFpbmVyLCBvcHRpb25zKSB7CiAgaWYgKHZpZXcpIHsKICAgIGlmIChv
cHRpb25zLkxPR19WSUVXX0xPT0tVUFMpIHsKICAgICAgRW1iZXIuTG9nZ2VyLmluZm8oIlJlbmRl
cmluZyAiICsgb3B0aW9ucy5uYW1lICsgIiB3aXRoICIgKyB2aWV3LCB7IGZ1bGxOYW1lOiAndmll
dzonICsgb3B0aW9ucy5uYW1lIH0pOwogICAgfQogIH0gZWxzZSB7CiAgICB2YXIgZGVmYXVsdFZp
ZXcgPSBvcHRpb25zLmludG8gPyAndmlldzpkZWZhdWx0JyA6ICd2aWV3OnRvcGxldmVsJzsKICAg
IHZpZXcgPSBjb250YWluZXIubG9va3VwKGRlZmF1bHRWaWV3KTsKICAgIGlmIChvcHRpb25zLkxP
R19WSUVXX0xPT0tVUFMpIHsKICAgICAgRW1iZXIuTG9nZ2VyLmluZm8oIlJlbmRlcmluZyAiICsg
b3B0aW9ucy5uYW1lICsgIiB3aXRoIGRlZmF1bHQgdmlldyAiICsgdmlldywgeyBmdWxsTmFtZTog
J3ZpZXc6JyArIG9wdGlvbnMubmFtZSB9KTsKICAgIH0KICB9CgogIGlmICghZ2V0KHZpZXcsICd0
ZW1wbGF0ZU5hbWUnKSkgewogICAgc2V0KHZpZXcsICd0ZW1wbGF0ZScsIG9wdGlvbnMudGVtcGxh
dGUpOwoKICAgIHNldCh2aWV3LCAnX2RlYnVnVGVtcGxhdGVOYW1lJywgb3B0aW9ucy5uYW1lKTsK
ICB9CgogIHNldCh2aWV3LCAncmVuZGVyZWROYW1lJywgb3B0aW9ucy5uYW1lKTsKICBzZXQodmll
dywgJ2NvbnRyb2xsZXInLCBvcHRpb25zLmNvbnRyb2xsZXIpOwoKICByZXR1cm4gdmlldzsKfQoK
ZnVuY3Rpb24gYXBwZW5kVmlldyhyb3V0ZSwgdmlldywgb3B0aW9ucykgewogIGlmIChvcHRpb25z
LmludG8pIHsKICAgIHZhciBwYXJlbnRWaWV3ID0gcm91dGUucm91dGVyLl9sb29rdXBBY3RpdmVW
aWV3KG9wdGlvbnMuaW50byk7CiAgICB2YXIgdGVhcmRvd25PdXRsZXRWaWV3ID0gZ2VuZXJhdGVP
dXRsZXRUZWFyZG93bihwYXJlbnRWaWV3LCBvcHRpb25zLm91dGxldCk7CiAgICBpZiAoIXJvdXRl
LnRlYXJkb3duT3V0bGV0Vmlld3MpIHsgcm91dGUudGVhcmRvd25PdXRsZXRWaWV3cyA9IFtdOyB9
CiAgICBhX3JlcGxhY2Uocm91dGUudGVhcmRvd25PdXRsZXRWaWV3cywgMCwgMCwgW3RlYXJkb3du
T3V0bGV0Vmlld10pOwogICAgcGFyZW50Vmlldy5jb25uZWN0T3V0bGV0KG9wdGlvbnMub3V0bGV0
LCB2aWV3KTsKICB9IGVsc2UgewogICAgdmFyIHJvb3RFbGVtZW50ID0gZ2V0KHJvdXRlLCAncm91
dGVyLm5hbWVzcGFjZS5yb290RWxlbWVudCcpOwogICAgLy8gdGVhciBkb3duIHZpZXcgaWYgb25l
IGlzIGFscmVhZHkgcmVuZGVyZWQKICAgIGlmIChyb3V0ZS50ZWFyZG93blRvcExldmVsVmlldykg
ewogICAgICByb3V0ZS50ZWFyZG93blRvcExldmVsVmlldygpOwogICAgfQogICAgcm91dGUucm91
dGVyLl9jb25uZWN0QWN0aXZlVmlldyhvcHRpb25zLm5hbWUsIHZpZXcpOwogICAgcm91dGUudGVh
cmRvd25Ub3BMZXZlbFZpZXcgPSBnZW5lcmF0ZVRvcExldmVsVGVhcmRvd24odmlldyk7CiAgICB2
aWV3LmFwcGVuZFRvKHJvb3RFbGVtZW50KTsKICB9Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlVG9wTGV2
ZWxUZWFyZG93bih2aWV3KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgeyB2aWV3LmRlc3Ryb3koKTsg
fTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVPdXRsZXRUZWFyZG93bihwYXJlbnRWaWV3LCBvdXRsZXQp
IHsKICByZXR1cm4gZnVuY3Rpb24oKSB7IHBhcmVudFZpZXcuZGlzY29ubmVjdE91dGxldChvdXRs
ZXQpOyB9Owp9Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7
CkVtYmVyLm9uTG9hZCgnRW1iZXIuSGFuZGxlYmFycycsIGZ1bmN0aW9uKCkgewogIHZhciBoYW5k
bGViYXJzUmVzb2x2ZSA9IEVtYmVyLkhhbmRsZWJhcnMucmVzb2x2ZVBhcmFtcywKICAgICAgbWFw
ID0gRW1iZXIuQXJyYXlQb2x5ZmlsbHMubWFwLAogICAgICBnZXQgPSBFbWJlci5nZXQsCiAgICAg
IGhhbmRsZWJhcnNHZXQgPSBFbWJlci5IYW5kbGViYXJzLmdldDsKCiAgZnVuY3Rpb24gcmVzb2x2
ZVBhcmFtcyhjb250ZXh0LCBwYXJhbXMsIG9wdGlvbnMpIHsKICAgIHJldHVybiBtYXAuY2FsbChy
ZXNvbHZlUGF0aHMoY29udGV4dCwgcGFyYW1zLCBvcHRpb25zKSwgZnVuY3Rpb24ocGF0aCwgaSkg
ewogICAgICBpZiAobnVsbCA9PT0gcGF0aCkgewogICAgICAgIC8vIFBhcmFtIHdhcyBzdHJpbmcv
bnVtYmVyLCBub3QgYSBwYXRoLCBzbyBqdXN0IHJldHVybiByYXcgc3RyaW5nL251bWJlci4KICAg
ICAgICByZXR1cm4gcGFyYW1zW2ldOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBoYW5k
bGViYXJzR2V0KGNvbnRleHQsIHBhdGgsIG9wdGlvbnMpOwogICAgICB9CiAgICB9KTsKICB9Cgog
IGZ1bmN0aW9uIHJlc29sdmVQYXRocyhjb250ZXh0LCBwYXJhbXMsIG9wdGlvbnMpIHsKICAgIHZh
ciByZXNvbHZlZCA9IGhhbmRsZWJhcnNSZXNvbHZlKGNvbnRleHQsIHBhcmFtcywgb3B0aW9ucyks
CiAgICAgICAgdHlwZXMgPSBvcHRpb25zLnR5cGVzOwoKICAgIHJldHVybiBtYXAuY2FsbChyZXNv
bHZlZCwgZnVuY3Rpb24ob2JqZWN0LCBpKSB7CiAgICAgIGlmICh0eXBlc1tpXSA9PT0gJ0lEJykg
ewogICAgICAgIHJldHVybiB1bndyYXAob2JqZWN0LCBwYXJhbXNbaV0pOwogICAgICB9IGVsc2Ug
ewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9KTsKCiAgICBmdW5jdGlvbiB1bndy
YXAob2JqZWN0LCBwYXRoKSB7CiAgICAgIGlmIChwYXRoID09PSAnY29udHJvbGxlcicpIHsgcmV0
dXJuIHBhdGg7IH0KCiAgICAgIGlmIChFbWJlci5Db250cm9sbGVyTWl4aW4uZGV0ZWN0KG9iamVj
dCkpIHsKICAgICAgICByZXR1cm4gdW53cmFwKGdldChvYmplY3QsICdtb2RlbCcpLCBwYXRoID8g
cGF0aCArICcubW9kZWwnIDogJ21vZGVsJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJu
IHBhdGg7CiAgICAgIH0KICAgIH0KICB9CgogIEVtYmVyLlJvdXRlci5yZXNvbHZlUGFyYW1zID0g
cmVzb2x2ZVBhcmFtczsKICBFbWJlci5Sb3V0ZXIucmVzb2x2ZVBhdGhzID0gcmVzb2x2ZVBhdGhz
Owp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVs
ZSBlbWJlci1yb3V0aW5nCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQs
IGZtdCA9IEVtYmVyLlN0cmluZy5mbXQ7CkVtYmVyLm9uTG9hZCgnRW1iZXIuSGFuZGxlYmFycycs
IGZ1bmN0aW9uKEhhbmRsZWJhcnMpIHsKCiAgdmFyIHJlc29sdmVQYXJhbXMgPSBFbWJlci5Sb3V0
ZXIucmVzb2x2ZVBhcmFtcywKICAgICAgcmVzb2x2ZVBhdGhzICA9IEVtYmVyLlJvdXRlci5yZXNv
bHZlUGF0aHMsCiAgICAgIGlzU2ltcGxlQ2xpY2sgPSBFbWJlci5WaWV3VXRpbHMuaXNTaW1wbGVD
bGljazsKCiAgZnVuY3Rpb24gZnVsbFJvdXRlTmFtZShyb3V0ZXIsIG5hbWUpIHsKICAgIHZhciBu
YW1lV2l0aEluZGV4OwogICAgaWYgKCFyb3V0ZXIuaGFzUm91dGUobmFtZSkpIHsKICAgICAgbmFt
ZVdpdGhJbmRleCA9IG5hbWUgKyAnLmluZGV4JzsKICAgICAgRW1iZXIuYXNzZXJ0KGZtdCgiVGhl
IGF0dGVtcHQgdG8gbGluay10byByb3V0ZSAnJUAnIGZhaWxlZCAoYWxzbyB0cmllZCAnJUAnKS4g
IiArCiAgICAgICAgICAgICAgICAgICAgICAgIlRoZSByb3V0ZXIgZGlkIG5vdCBmaW5kICclQCcg
aW4gaXRzIHBvc3NpYmxlIHJvdXRlczogJyVAJyIsCiAgICAgICAgICAgICAgICAgICAgICAgW25h
bWUsIG5hbWVXaXRoSW5kZXgsIG5hbWUsIEVtYmVyLmtleXMocm91dGVyLnJvdXRlci5yZWNvZ25p
emVyLm5hbWVzKS5qb2luKCInLCAnIildKSwKICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXIu
aGFzUm91dGUobmFtZVdpdGhJbmRleCkpOwogICAgICBuYW1lID0gbmFtZVdpdGhJbmRleDsKICAg
IH0KCiAgICByZXR1cm4gbmFtZTsKICB9CgogIGZ1bmN0aW9uIGdldFJlc29sdmVkUGF0aHMob3B0
aW9ucykgewoKICAgIHZhciB0eXBlcyA9IG9wdGlvbnMub3B0aW9ucy50eXBlcywKICAgICAgICBk
YXRhID0gb3B0aW9ucy5vcHRpb25zLmRhdGE7CgogICAgcmV0dXJuIHJlc29sdmVQYXRocyhvcHRp
b25zLmNvbnRleHQsIG9wdGlvbnMucGFyYW1zLCB7IHR5cGVzOiB0eXBlcywgZGF0YTogZGF0YSB9
KTsKICB9CgogIC8qKgogICAgYEVtYmVyLkxpbmtWaWV3YCByZW5kZXJzIGFuIGVsZW1lbnQgd2hv
c2UgYGNsaWNrYCBldmVudCB0cmlnZ2VycyBhCiAgICB0cmFuc2l0aW9uIG9mIHRoZSBhcHBsaWNh
dGlvbidzIGluc3RhbmNlIG9mIGBFbWJlci5Sb3V0ZXJgIHRvCiAgICBhIHN1cHBsaWVkIHJvdXRl
IGJ5IG5hbWUuCgogICAgSW5zdGFuY2VzIG9mIGBMaW5rVmlld2Agd2lsbCBtb3N0IGxpa2VseSBi
ZSBjcmVhdGVkIHRocm91Z2gKICAgIHRoZSBgbGluay10b2AgSGFuZGxlYmFycyBoZWxwZXIsIGJ1
dCBwcm9wZXJ0aWVzIG9mIHRoaXMgY2xhc3MKICAgIGNhbiBiZSBvdmVycmlkZGVuIHRvIGN1c3Rv
bWl6ZSBhcHBsaWNhdGlvbi13aWRlIGJlaGF2aW9yLgoKICAgIEBjbGFzcyBMaW5rVmlldwogICAg
QG5hbWVzcGFjZSBFbWJlcgogICAgQGV4dGVuZHMgRW1iZXIuVmlldwogICAgQHNlZSB7SGFuZGxl
YmFycy5oZWxwZXJzLmxpbmstdG99CiAgKiovCiAgdmFyIExpbmtWaWV3ID0gRW1iZXIuTGlua1Zp
ZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7CiAgICB0YWdOYW1lOiAnYScsCiAgICBjdXJyZW50V2hl
bjogbnVsbCwKCiAgICAvKioKICAgICAgU2V0cyB0aGUgYHRpdGxlYCBhdHRyaWJ1dGUgb2YgdGhl
IGBMaW5rVmlld2AncyBIVE1MIGVsZW1lbnQuCgogICAgICBAcHJvcGVydHkgdGl0bGUKICAgICAg
QGRlZmF1bHQgbnVsbAogICAgKiovCiAgICB0aXRsZTogbnVsbCwKCiAgICAvKioKICAgICAgU2V0
cyB0aGUgYHJlbGAgYXR0cmlidXRlIG9mIHRoZSBgTGlua1ZpZXdgJ3MgSFRNTCBlbGVtZW50LgoK
ICAgICAgQHByb3BlcnR5IHJlbAogICAgICBAZGVmYXVsdCBudWxsCiAgICAqKi8KICAgIHJlbDog
bnVsbCwKCiAgICAvKioKICAgICAgVGhlIENTUyBjbGFzcyB0byBhcHBseSB0byBgTGlua1ZpZXdg
J3MgZWxlbWVudCB3aGVuIGl0cyBgYWN0aXZlYAogICAgICBwcm9wZXJ0eSBpcyBgdHJ1ZWAuCgog
ICAgICBAcHJvcGVydHkgYWN0aXZlQ2xhc3MKICAgICAgQHR5cGUgU3RyaW5nCiAgICAgIEBkZWZh
dWx0IGFjdGl2ZQogICAgKiovCiAgICBhY3RpdmVDbGFzczogJ2FjdGl2ZScsCgogICAgLyoqCiAg
ICAgIFRoZSBDU1MgY2xhc3MgdG8gYXBwbHkgdG8gYExpbmtWaWV3YCdzIGVsZW1lbnQgd2hlbiBp
dHMgYGxvYWRpbmdgCiAgICAgIHByb3BlcnR5IGlzIGB0cnVlYC4KCiAgICAgIEBwcm9wZXJ0eSBs
b2FkaW5nQ2xhc3MKICAgICAgQHR5cGUgU3RyaW5nCiAgICAgIEBkZWZhdWx0IGxvYWRpbmcKICAg
ICoqLwogICAgbG9hZGluZ0NsYXNzOiAnbG9hZGluZycsCgogICAgLyoqCiAgICAgIFRoZSBDU1Mg
Y2xhc3MgdG8gYXBwbHkgdG8gYSBgTGlua1ZpZXdgJ3MgZWxlbWVudCB3aGVuIGl0cyBgZGlzYWJs
ZWRgCiAgICAgIHByb3BlcnR5IGlzIGB0cnVlYC4KCiAgICAgIEBwcm9wZXJ0eSBkaXNhYmxlZENs
YXNzCiAgICAgIEB0eXBlIFN0cmluZwogICAgICBAZGVmYXVsdCBkaXNhYmxlZAogICAgKiovCiAg
ICBkaXNhYmxlZENsYXNzOiAnZGlzYWJsZWQnLAogICAgX2lzRGlzYWJsZWQ6IGZhbHNlLAoKICAg
IC8qKgogICAgICBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGBMaW5rVmlld2Agd2lsbCB0cmlnZ2Vy
IHJvdXRpbmcgdmlhCiAgICAgIHRoZSBgcmVwbGFjZVdpdGhgIHJvdXRpbmcgc3RyYXRlZ3kuCgog
ICAgICBAcHJvcGVydHkgcmVwbGFjZQogICAgICBAdHlwZSBCb29sZWFuCiAgICAgIEBkZWZhdWx0
IGZhbHNlCiAgICAqKi8KICAgIHJlcGxhY2U6IGZhbHNlLAoKICAgIC8qKgogICAgICBCeSBkZWZh
dWx0IHRoZSBge3tsaW5rLXRvfX1gIGhlbHBlciB3aWxsIGJpbmQgdG8gdGhlIGBocmVmYCBhbmQK
ICAgICAgYHRpdGxlYCBhdHRyaWJ1dGVzLiBJdCdzIGRpc2NvdXJhZ2UgdGhhdCB5b3Ugb3ZlcnJp
ZGUgdGhlc2UgZGVmYXVsdHMsCiAgICAgIGhvd2V2ZXIgeW91IGNhbiBwdXNoIG9udG8gdGhlIGFy
cmF5IGlmIG5lZWRlZC4KCiAgICAgIEBwcm9wZXJ0eSBhdHRyaWJ1dGVCaW5kaW5ncwogICAgICBA
dHlwZSBBcnJheSB8IFN0cmluZwogICAgICBAZGVmYXVsdCBbJ2hyZWYnLCAndGl0bGUnLCAncmVs
J10KICAgICAqKi8KICAgIGF0dHJpYnV0ZUJpbmRpbmdzOiBbJ2hyZWYnLCAndGl0bGUnLCAncmVs
J10sCgogICAgLyoqCiAgICAgIEJ5IGRlZmF1bHQgdGhlIGB7e2xpbmstdG99fWAgaGVscGVyIHdp
bGwgYmluZCB0byB0aGUgYGFjdGl2ZWAsIGBsb2FkaW5nYCwgYW5kCiAgICAgIGBkaXNhYmxlZGAg
Y2xhc3Nlcy4gSXQgaXMgZGlzY291cmFnZWQgdG8gb3ZlcnJpZGUgdGhlc2UgZGlyZWN0bHkuCgog
ICAgICBAcHJvcGVydHkgY2xhc3NOYW1lQmluZGluZ3MKICAgICAgQHR5cGUgQXJyYXkKICAgICAg
QGRlZmF1bHQgWydhY3RpdmUnLCAnbG9hZGluZycsICdkaXNhYmxlZCddCiAgICAgKiovCiAgICBj
bGFzc05hbWVCaW5kaW5nczogWydhY3RpdmUnLCAnbG9hZGluZycsICdkaXNhYmxlZCddLAoKICAg
IC8qKgogICAgICBCeSBkZWZhdWx0IHRoZSBge3tsaW5rLXRvfX1gIGhlbHBlciByZXNwb25kcyB0
byB0aGUgYGNsaWNrYCBldmVudC4gWW91CiAgICAgIGNhbiBvdmVycmlkZSB0aGlzIGdsb2JhbGx5
IGJ5IHNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byB5b3VyIGN1c3RvbQogICAgICBldmVudCBuYW1l
LgoKICAgICAgVGhpcyBpcyBwYXJ0aWN1bGFybHkgdXNlZnVsIG9uIG1vYmlsZSB3aGVuIG9uZSB3
YW50cyB0byBhdm9pZCB0aGUgMzAwbXMKICAgICAgY2xpY2sgZGVsYXkgdXNpbmcgc29tZSBzb3J0
IG9mIGN1c3RvbSBgdGFwYCBldmVudC4KCiAgICAgIEBwcm9wZXJ0eSBldmVudE5hbWUKICAgICAg
QHR5cGUgU3RyaW5nCiAgICAgIEBkZWZhdWx0IGNsaWNrCiAgICAqLwogICAgZXZlbnROYW1lOiAn
Y2xpY2snLAoKICAgIC8vIHRoaXMgaXMgZG9jJ2VkIGhlcmUgc28gaXQgc2hvd3MgdXAgaW4gdGhl
IGV2ZW50cwogICAgLy8gc2VjdGlvbiBvZiB0aGUgQVBJIGRvY3VtZW50YXRpb24sIHdoaWNoIGlz
IHdoZXJlCiAgICAvLyBwZW9wbGUgd2lsbCBsaWtlbHkgZ28gbG9va2luZyBmb3IgaXQuCiAgICAv
KioKICAgICAgVHJpZ2dlcnMgdGhlIGBMaW5rVmlld2AncyByb3V0aW5nIGJlaGF2aW9yLiBJZgog
ICAgICBgZXZlbnROYW1lYCBpcyBjaGFuZ2VkIHRvIGEgdmFsdWUgb3RoZXIgdGhhbiBgY2xpY2tg
CiAgICAgIHRoZSByb3V0aW5nIGJlaGF2aW9yIHdpbGwgdHJpZ2dlciBvbiB0aGF0IGN1c3RvbSBl
dmVudAogICAgICBpbnN0ZWFkLgoKICAgICAgQGV2ZW50IGNsaWNrCiAgICAqKi8KCiAgICAvKioK
ICAgICAgQW4gb3ZlcnJpZGFibGUgbWV0aG9kIGNhbGxlZCB3aGVuIExpbmtWaWV3IG9iamVjdHMg
YXJlIGluc3RhbnRpYXRlZC4KCiAgICAgIEV4YW1wbGU6CgogICAgICBgYGBqYXZhc2NyaXB0CiAg
ICAgIEFwcC5NeUxpbmtWaWV3ID0gRW1iZXIuTGlua1ZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0
OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuX3N1cGVyKCk7CiAgICAgICAgICBFbWJlci5M
b2dnZXIubG9nKCdFdmVudCBpcyAnICsgdGhpcy5nZXQoJ2V2ZW50TmFtZScpKTsKICAgICAgICB9
CiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIE5PVEU6IElmIHlvdSBkbyBvdmVycmlkZSBgaW5p
dGAgZm9yIGEgZnJhbWV3b3JrIGNsYXNzIGxpa2UgYEVtYmVyLlZpZXdgIG9yCiAgICAgIGBFbWJl
ci5BcnJheUNvbnRyb2xsZXJgLCBiZSBzdXJlIHRvIGNhbGwgYHRoaXMuX3N1cGVyKClgIGluIHlv
dXIKICAgICAgYGluaXRgIGRlY2xhcmF0aW9uISBJZiB5b3UgZG9uJ3QsIEVtYmVyIG1heSBub3Qg
aGF2ZSBhbiBvcHBvcnR1bml0eSB0bwogICAgICBkbyBpbXBvcnRhbnQgc2V0dXAgd29yaywgYW5k
IHlvdSdsbCBzZWUgc3RyYW5nZSBiZWhhdmlvciBpbiB5b3VyCiAgICAgIGFwcGxpY2F0aW9uLgoK
ICAgICAgQG1ldGhvZCBpbml0CiAgICAqLwogICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgIHRo
aXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgogICAgICAvLyBNYXAgZGVzaXJlZCBl
dmVudCBuYW1lIHRvIGludm9rZSBmdW5jdGlvbgogICAgICB2YXIgZXZlbnROYW1lID0gZ2V0KHRo
aXMsICdldmVudE5hbWUnKSwgaTsKICAgICAgdGhpcy5vbihldmVudE5hbWUsIHRoaXMsIHRoaXMu
X2ludm9rZSk7CgogICAgICAgICAgfSwKCiAgICAvKioKICAgICAgVGhpcyBtZXRob2QgaXMgaW52
b2tlZCBieSBvYnNlcnZlcnMgaW5zdGFsbGVkIGR1cmluZyBgaW5pdGAgdGhhdCBmaXJlCiAgICAg
IHdoZW5ldmVyIHRoZSBwYXJhbXMgY2hhbmdlCgogICAgICBAcHJpdmF0ZQogICAgICBAbWV0aG9k
IF9wYXJhbXNDaGFuZ2VkCiAgICAgKi8KICAgIF9wYXJhbXNDaGFuZ2VkOiBmdW5jdGlvbigpIHsK
ICAgICAgdGhpcy5ub3RpZnlQcm9wZXJ0eUNoYW5nZSgncmVzb2x2ZWRQYXJhbXMnKTsKICAgIH0s
CgogICAgLyoqCiAgICAgVGhpcyBpcyBjYWxsZWQgdG8gc2V0dXAgb2JzZXJ2ZXJzIHRoYXQgd2ls
bCB0cmlnZ2VyIGEgcmVyZW5kZXIuCgogICAgIEBwcml2YXRlCiAgICAgQG1ldGhvZCBfc2V0dXBQ
YXRoT2JzZXJ2ZXJzCiAgICAqKi8KICAgIF9zZXR1cFBhdGhPYnNlcnZlcnM6IGZ1bmN0aW9uKCl7
CiAgICAgIHZhciBoZWxwZXJQYXJhbWV0ZXJzID0gdGhpcy5wYXJhbWV0ZXJzLAogICAgICAgICAg
bGlua1RleHRQYXRoICAgICA9IGhlbHBlclBhcmFtZXRlcnMub3B0aW9ucy5saW5rVGV4dFBhdGgs
CiAgICAgICAgICBwYXRocyA9IGdldFJlc29sdmVkUGF0aHMoaGVscGVyUGFyYW1ldGVycyksCiAg
ICAgICAgICBsZW5ndGggPSBwYXRocy5sZW5ndGgsCiAgICAgICAgICBwYXRoLCBpLCBub3JtYWxp
emVkUGF0aDsKCiAgICAgIGlmIChsaW5rVGV4dFBhdGgpIHsKICAgICAgICBub3JtYWxpemVkUGF0
aCA9IEVtYmVyLkhhbmRsZWJhcnMubm9ybWFsaXplUGF0aChoZWxwZXJQYXJhbWV0ZXJzLmNvbnRl
eHQsIGxpbmtUZXh0UGF0aCwgaGVscGVyUGFyYW1ldGVycy5vcHRpb25zLmRhdGEpOwogICAgICAg
IHRoaXMucmVnaXN0ZXJPYnNlcnZlcihub3JtYWxpemVkUGF0aC5yb290LCBub3JtYWxpemVkUGF0
aC5wYXRoLCB0aGlzLCB0aGlzLnJlcmVuZGVyKTsKICAgICAgfQoKICAgICAgZm9yKGk9MDsgaSA8
IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgcGF0aCA9IHBhdGhzW2ldOwogICAgICAgIGlmIChudWxs
ID09PSBwYXRoKSB7CiAgICAgICAgICAvLyBBIGxpdGVyYWwgdmFsdWUgd2FzIHByb3ZpZGVkLCBu
b3QgYSBwYXRoLCBzbyBub3RoaW5nIHRvIG9ic2VydmUuCiAgICAgICAgICBjb250aW51ZTsKICAg
ICAgICB9CgogICAgICAgIG5vcm1hbGl6ZWRQYXRoID0gRW1iZXIuSGFuZGxlYmFycy5ub3JtYWxp
emVQYXRoKGhlbHBlclBhcmFtZXRlcnMuY29udGV4dCwgcGF0aCwgaGVscGVyUGFyYW1ldGVycy5v
cHRpb25zLmRhdGEpOwogICAgICAgIHRoaXMucmVnaXN0ZXJPYnNlcnZlcihub3JtYWxpemVkUGF0
aC5yb290LCBub3JtYWxpemVkUGF0aC5wYXRoLCB0aGlzLCB0aGlzLl9wYXJhbXNDaGFuZ2VkKTsK
ICAgICAgfQogICAgfSwKCiAgICBhZnRlclJlbmRlcjogZnVuY3Rpb24oKXsKICAgICAgdGhpcy5f
c3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5fc2V0dXBQYXRoT2JzZXJ2
ZXJzKCk7CiAgICB9LAoKICAgIC8qKgogICAgICBUaGlzIG1ldGhvZCBpcyBpbnZva2VkIGJ5IG9i
c2VydmVycyBpbnN0YWxsZWQgZHVyaW5nIGBpbml0YCB0aGF0IGZpcmUKICAgICAgd2hlbmV2ZXIg
dGhlIHF1ZXJ5IHBhcmFtcyBjaGFuZ2UKICAgICAgQHByaXZhdGUKICAgICAqLwogICAgX3F1ZXJ5
UGFyYW1zQ2hhbmdlZDogZnVuY3Rpb24gKG9iamVjdCwgcGF0aCkgewogICAgICB0aGlzLm5vdGlm
eVByb3BlcnR5Q2hhbmdlKCdxdWVyeVBhcmFtcycpOwogICAgfSwKCgogICAgLyoqCiAgICAgIEV2
ZW4gdGhvdWdoIHRoaXMgaXNuJ3QgYSB2aXJ0dWFsIHZpZXcsIHdlIHdhbnQgdG8gdHJlYXQgaXQg
YXMgaWYgaXQgaXMKICAgICAgc28gdGhhdCB5b3UgY2FuIGFjY2VzcyB0aGUgcGFyZW50IHdpdGgg
e3t2aWV3LnByb3B9fQoKICAgICAgQHByaXZhdGUKICAgICAgQG1ldGhvZCBjb25jcmV0ZVZpZXcK
ICAgICoqLwogICAgY29uY3JldGVWaWV3OiBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsKICAg
ICAgcmV0dXJuIGdldCh0aGlzLCAncGFyZW50VmlldycpOwogICAgfSkucHJvcGVydHkoJ3BhcmVu
dFZpZXcnKSwKCiAgICAvKioKCiAgICAgIEFjY2Vzc2VkIGFzIGEgY2xhc3NuYW1lIGJpbmRpbmcg
dG8gYXBwbHkgdGhlIGBMaW5rVmlld2AncyBgZGlzYWJsZWRDbGFzc2AKICAgICAgQ1NTIGBjbGFz
c2AgdG8gdGhlIGVsZW1lbnQgd2hlbiB0aGUgbGluayBpcyBkaXNhYmxlZC4KCiAgICAgIFdoZW4g
YHRydWVgIGludGVyYWN0aW9ucyB3aXRoIHRoZSBlbGVtZW50IHdpbGwgbm90IHRyaWdnZXIgcm91
dGUgY2hhbmdlcy4KICAgICAgQHByb3BlcnR5IGRpc2FibGVkCiAgICAqLwogICAgZGlzYWJsZWQ6
IEVtYmVyLmNvbXB1dGVkKGZ1bmN0aW9uIGNvbXB1dGVMaW5rVmlld0Rpc2FibGVkKGtleSwgdmFs
dWUpIHsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsgdGhpcy5zZXQoJ19pc0Rpc2Fi
bGVkJywgdmFsdWUpOyB9CgogICAgICByZXR1cm4gdmFsdWUgPyBnZXQodGhpcywgJ2Rpc2FibGVk
Q2xhc3MnKSA6IGZhbHNlOwogICAgfSksCgogICAgLyoqCiAgICAgIEFjY2Vzc2VkIGFzIGEgY2xh
c3NuYW1lIGJpbmRpbmcgdG8gYXBwbHkgdGhlIGBMaW5rVmlld2AncyBgYWN0aXZlQ2xhc3NgCiAg
ICAgIENTUyBgY2xhc3NgIHRvIHRoZSBlbGVtZW50IHdoZW4gdGhlIGxpbmsgaXMgYWN0aXZlLgoK
ICAgICAgQSBgTGlua1ZpZXdgIGlzIGNvbnNpZGVyZWQgYWN0aXZlIHdoZW4gaXRzIGBjdXJyZW50
V2hlbmAgcHJvcGVydHkgaXMgYHRydWVgCiAgICAgIG9yIHRoZSBhcHBsaWNhdGlvbidzIGN1cnJl
bnQgcm91dGUgaXMgdGhlIHJvdXRlIHRoZSBgTGlua1ZpZXdgIHdvdWxkIHRyaWdnZXIKICAgICAg
dHJhbnNpdGlvbnMgaW50by4KCiAgICAgIEBwcm9wZXJ0eSBhY3RpdmUKICAgICoqLwogICAgYWN0
aXZlOiBFbWJlci5jb21wdXRlZChmdW5jdGlvbiBjb21wdXRlTGlua1ZpZXdBY3RpdmUoKSB7CiAg
ICAgIGlmIChnZXQodGhpcywgJ2xvYWRpbmcnKSkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICAgIHZh
ciByb3V0ZXIgPSBnZXQodGhpcywgJ3JvdXRlcicpLAogICAgICAgICAgcm91dGVBcmdzID0gZ2V0
KHRoaXMsICdyb3V0ZUFyZ3MnKSwKICAgICAgICAgIGNvbnRleHRzID0gcm91dGVBcmdzLnNsaWNl
KDEpLAogICAgICAgICAgcmVzb2x2ZWRQYXJhbXMgPSBnZXQodGhpcywgJ3Jlc29sdmVkUGFyYW1z
JyksCiAgICAgICAgICBjdXJyZW50V2hlbiA9IHRoaXMuY3VycmVudFdoZW4gfHwgcmVzb2x2ZWRQ
YXJhbXNbMF0sCiAgICAgICAgICBjdXJyZW50V2l0aEluZGV4ID0gY3VycmVudFdoZW4gKyAnLmlu
ZGV4JywKICAgICAgICAgIGlzQWN0aXZlID0gcm91dGVyLmlzQWN0aXZlLmFwcGx5KHJvdXRlciwg
W2N1cnJlbnRXaGVuXS5jb25jYXQoY29udGV4dHMpKSB8fAogICAgICAgICAgICAgICAgICAgICBy
b3V0ZXIuaXNBY3RpdmUuYXBwbHkocm91dGVyLCBbY3VycmVudFdpdGhJbmRleF0uY29uY2F0KGNv
bnRleHRzKSk7CgogICAgICBpZiAoaXNBY3RpdmUpIHsgcmV0dXJuIGdldCh0aGlzLCAnYWN0aXZl
Q2xhc3MnKTsgfQogICAgfSkucHJvcGVydHkoJ3Jlc29sdmVkUGFyYW1zJywgJ3JvdXRlQXJncycs
ICdyb3V0ZXIudXJsJyksCgogICAgLyoqCiAgICAgIEFjY2Vzc2VkIGFzIGEgY2xhc3NuYW1lIGJp
bmRpbmcgdG8gYXBwbHkgdGhlIGBMaW5rVmlld2AncyBgbG9hZGluZ0NsYXNzYAogICAgICBDU1Mg
YGNsYXNzYCB0byB0aGUgZWxlbWVudCB3aGVuIHRoZSBsaW5rIGlzIGxvYWRpbmcuCgogICAgICBB
IGBMaW5rVmlld2AgaXMgY29uc2lkZXJlZCBsb2FkaW5nIHdoZW4gaXQgaGFzIGF0IGxlYXN0IG9u
ZQogICAgICBwYXJhbWV0ZXIgd2hvc2UgdmFsdWUgaXMgY3VycmVudGx5IG51bGwgb3IgdW5kZWZp
bmVkLiBEdXJpbmcKICAgICAgdGhpcyB0aW1lLCBjbGlja2luZyB0aGUgbGluayB3aWxsIHBlcmZv
cm0gbm8gdHJhbnNpdGlvbiBhbmQKICAgICAgZW1pdCBhIHdhcm5pbmcgdGhhdCB0aGUgbGluayBp
cyBzdGlsbCBpbiBhIGxvYWRpbmcgc3RhdGUuCgogICAgICBAcHJvcGVydHkgbG9hZGluZwogICAg
KiovCiAgICBsb2FkaW5nOiBFbWJlci5jb21wdXRlZChmdW5jdGlvbiBjb21wdXRlTGlua1ZpZXdM
b2FkaW5nKCkgewogICAgICBpZiAoIWdldCh0aGlzLCAncm91dGVBcmdzJykpIHsgcmV0dXJuIGdl
dCh0aGlzLCAnbG9hZGluZ0NsYXNzJyk7IH0KICAgIH0pLnByb3BlcnR5KCdyb3V0ZUFyZ3MnKSwK
CiAgICAvKioKICAgICAgUmV0dXJucyB0aGUgYXBwbGljYXRpb24ncyBtYWluIHJvdXRlciBmcm9t
IHRoZSBjb250YWluZXIuCgogICAgICBAcHJpdmF0ZQogICAgICBAcHJvcGVydHkgcm91dGVyCiAg
ICAqKi8KICAgIHJvdXRlcjogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVy
biBnZXQodGhpcywgJ2NvbnRyb2xsZXInKS5jb250YWluZXIubG9va3VwKCdyb3V0ZXI6bWFpbicp
OwogICAgfSksCgogICAgLyoqCiAgICAgIEV2ZW50IGhhbmRsZXIgdGhhdCBpbnZva2VzIHRoZSBs
aW5rLCBhY3RpdmF0aW5nIHRoZSBhc3NvY2lhdGVkIHJvdXRlLgoKICAgICAgQHByaXZhdGUKICAg
ICAgQG1ldGhvZCBfaW52b2tlCiAgICAgIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICAqLwogICAg
X2ludm9rZTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgaWYgKCFpc1NpbXBsZUNsaWNrKGV2ZW50
KSkgeyByZXR1cm4gdHJ1ZTsgfQoKICAgICAgaWYgKHRoaXMucHJldmVudERlZmF1bHQgIT09IGZh
bHNlKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgaWYgKHRoaXMuYnViYmxlcyA9
PT0gZmFsc2UpIHsgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IH0KCiAgICAgIGlmIChnZXQodGhp
cywgJ19pc0Rpc2FibGVkJykpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICBpZiAoZ2V0KHRoaXMs
ICdsb2FkaW5nJykpIHsKICAgICAgICBFbWJlci5Mb2dnZXIud2FybigiVGhpcyBsaW5rLXRvIGlz
IGluIGFuIGluYWN0aXZlIGxvYWRpbmcgc3RhdGUgYmVjYXVzZSBhdCBsZWFzdCBvbmUgb2YgaXRz
IHBhcmFtZXRlcnMgcHJlc2VudGx5IGhhcyBhIG51bGwvdW5kZWZpbmVkIHZhbHVlLCBvciB0aGUg
cHJvdmlkZWQgcm91dGUgbmFtZSBpcyBpbnZhbGlkLiIpOwogICAgICAgIHJldHVybiBmYWxzZTsK
ICAgICAgfQoKICAgICAgdmFyIHJvdXRlciA9IGdldCh0aGlzLCAncm91dGVyJyksCiAgICAgICAg
ICByb3V0ZUFyZ3MgPSBnZXQodGhpcywgJ3JvdXRlQXJncycpOwoKICAgICAgaWYgKGdldCh0aGlz
LCAncmVwbGFjZScpKSB7CiAgICAgICAgcm91dGVyLnJlcGxhY2VXaXRoLmFwcGx5KHJvdXRlciwg
cm91dGVBcmdzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByb3V0ZXIudHJhbnNpdGlvblRvLmFw
cGx5KHJvdXRlciwgcm91dGVBcmdzKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAgQ29t
cHV0ZWQgcHJvcGVydHkgdGhhdCByZXR1cm5zIHRoZSByZXNvbHZlZCBwYXJhbWV0ZXJzLgoKICAg
ICAgQHByaXZhdGUKICAgICAgQHByb3BlcnR5CiAgICAgIEByZXR1cm4ge0FycmF5fQogICAgICov
CiAgICByZXNvbHZlZFBhcmFtczogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24oKSB7CiAgICAgIHZh
ciBwYXJhbWV0ZXJzID0gdGhpcy5wYXJhbWV0ZXJzLAogICAgICAgICAgb3B0aW9ucyA9IHBhcmFt
ZXRlcnMub3B0aW9ucywKICAgICAgICAgIHR5cGVzID0gb3B0aW9ucy50eXBlcywKICAgICAgICAg
IGRhdGEgPSBvcHRpb25zLmRhdGE7CgogICAgICAKICAgICAgLy8gT3JpZ2luYWwgaW1wbGVtZW50
YXRpb24gaWYgcXVlcnkgcGFyYW1zIG5vdCBlbmFibGVkCiAgICAgIHJldHVybiByZXNvbHZlUGFy
YW1zKHBhcmFtZXRlcnMuY29udGV4dCwgcGFyYW1ldGVycy5wYXJhbXMsIHsgdHlwZXM6IHR5cGVz
LCBkYXRhOiBkYXRhIH0pOwogICAgfSkucHJvcGVydHkoKSwKCiAgICAvKioKICAgICAgQ29tcHV0
ZWQgcHJvcGVydHkgdGhhdCByZXR1cm5zIHRoZSBjdXJyZW50IHJvdXRlIG5hbWUgYW5kCiAgICAg
IGFueSBkeW5hbWljIHNlZ21lbnRzLgoKICAgICAgQHByaXZhdGUKICAgICAgQHByb3BlcnR5CiAg
ICAgIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSB3aXRoIHRoZSByb3V0ZSBuYW1lIGFuZCBhbnkg
ZHluYW1pYyBzZWdtZW50cwogICAgICovCiAgICByb3V0ZUFyZ3M6IEVtYmVyLmNvbXB1dGVkKGZ1
bmN0aW9uIGNvbXB1dGVMaW5rVmlld1JvdXRlQXJncygpIHsKICAgICAgdmFyIHJlc29sdmVkUGFy
YW1zID0gZ2V0KHRoaXMsICdyZXNvbHZlZFBhcmFtcycpLnNsaWNlKDApLAogICAgICAgICAgcm91
dGVyID0gZ2V0KHRoaXMsICdyb3V0ZXInKSwKICAgICAgICAgIG5hbWVkUm91dGUgPSByZXNvbHZl
ZFBhcmFtc1swXTsKCiAgICAgIGlmICghbmFtZWRSb3V0ZSkgeyByZXR1cm47IH0KCiAgICAgIG5h
bWVkUm91dGUgPSBmdWxsUm91dGVOYW1lKHJvdXRlciwgbmFtZWRSb3V0ZSk7CiAgICAgIHJlc29s
dmVkUGFyYW1zWzBdID0gbmFtZWRSb3V0ZTsKCiAgICAgIGZvciAodmFyIGkgPSAxLCBsZW4gPSBy
ZXNvbHZlZFBhcmFtcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgIHZhciBwYXJhbSA9
IHJlc29sdmVkUGFyYW1zW2ldOwogICAgICAgIGlmIChwYXJhbSA9PT0gbnVsbCB8fCB0eXBlb2Yg
cGFyYW0gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAvLyBJZiBjb250ZXh0cyBhcmVuJ3Qg
cHJlc2VudCwgY29uc2lkZXIgdGhlIGxpbmtWaWV3IHVubG9hZGVkLgogICAgICAgICAgcmV0dXJu
OwogICAgICAgIH0KICAgICAgfQoKICAgICAgCiAgICAgIHJldHVybiByZXNvbHZlZFBhcmFtczsK
ICAgIH0pLnByb3BlcnR5KCdyZXNvbHZlZFBhcmFtcycsICdxdWVyeVBhcmFtcycsICdyb3V0ZXIu
dXJsJyksCgoKICAgIF9wb3RlbnRpYWxRdWVyeVBhcmFtczogRW1iZXIuY29tcHV0ZWQoZnVuY3Rp
b24gKCkgewogICAgICB2YXIgbmFtZWRSb3V0ZSA9IGdldCh0aGlzLCAncmVzb2x2ZWRQYXJhbXMn
KVswXTsKICAgICAgaWYgKCFuYW1lZFJvdXRlKSB7IHJldHVybiBudWxsOyB9CiAgICAgIHZhciBy
b3V0ZXIgICAgICAgICAgPSBnZXQodGhpcywgJ3JvdXRlcicpOwoKICAgICAgbmFtZWRSb3V0ZSA9
IGZ1bGxSb3V0ZU5hbWUocm91dGVyLCBuYW1lZFJvdXRlKTsKCiAgICAgIHJldHVybiByb3V0ZXIu
cm91dGVyLnF1ZXJ5UGFyYW1zRm9ySGFuZGxlcihuYW1lZFJvdXRlKTsKICAgIH0pLnByb3BlcnR5
KCdyZXNvbHZlZFBhcmFtcycpLAoKICAgIHF1ZXJ5UGFyYW1zOiBFbWJlci5jb21wdXRlZChmdW5j
dGlvbiAoKSB7CiAgICAgIHZhciBzZWxmICAgICAgICAgICAgICA9IHRoaXMsCiAgICAgICAgcXVl
cnlQYXJhbXMgICAgICAgICA9IG51bGwsCiAgICAgICAgYWxsb3dlZFF1ZXJ5UGFyYW1zICA9IGdl
dCh0aGlzLCAnX3BvdGVudGlhbFF1ZXJ5UGFyYW1zJyk7CgogICAgICBpZiAoIWFsbG93ZWRRdWVy
eVBhcmFtcykgeyByZXR1cm4gbnVsbDsgfQogICAgICBhbGxvd2VkUXVlcnlQYXJhbXMuZm9yRWFj
aChmdW5jdGlvbiAocGFyYW0pIHsKICAgICAgICB2YXIgdmFsdWUgPSBnZXQoc2VsZiwgcGFyYW0p
OwogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBx
dWVyeVBhcmFtcyA9IHF1ZXJ5UGFyYW1zIHx8IHt9OwogICAgICAgICAgcXVlcnlQYXJhbXNbcGFy
YW1dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKCgogICAgICByZXR1cm4gcXVlcnlQYXJh
bXM7CiAgICB9KS5wcm9wZXJ0eSgnX3BvdGVudGlhbFF1ZXJ5UGFyYW1zLltdJyksCgogICAgLyoq
CiAgICAgIFNldHMgdGhlIGVsZW1lbnQncyBgaHJlZmAgYXR0cmlidXRlIHRvIHRoZSB1cmwgZm9y
CiAgICAgIHRoZSBgTGlua1ZpZXdgJ3MgdGFyZ2V0ZWQgcm91dGUuCgogICAgICBJZiB0aGUgYExp
bmtWaWV3YCdzIGB0YWdOYW1lYCBpcyBjaGFuZ2VkIHRvIGEgdmFsdWUgb3RoZXIKICAgICAgdGhh
biBgYWAsIHRoaXMgcHJvcGVydHkgd2lsbCBiZSBpZ25vcmVkLgoKICAgICAgQHByb3BlcnR5IGhy
ZWYKICAgICoqLwogICAgaHJlZjogRW1iZXIuY29tcHV0ZWQoZnVuY3Rpb24gY29tcHV0ZUxpbmtW
aWV3SHJlZigpIHsKICAgICAgaWYgKGdldCh0aGlzLCAndGFnTmFtZScpICE9PSAnYScpIHsgcmV0
dXJuOyB9CgogICAgICB2YXIgcm91dGVyID0gZ2V0KHRoaXMsICdyb3V0ZXInKSwKICAgICAgICAg
IHJvdXRlQXJncyA9IGdldCh0aGlzLCAncm91dGVBcmdzJyk7CgogICAgICByZXR1cm4gcm91dGVB
cmdzID8gcm91dGVyLmdlbmVyYXRlLmFwcGx5KHJvdXRlciwgcm91dGVBcmdzKSA6IGdldCh0aGlz
LCAnbG9hZGluZ0hyZWYnKTsKICAgIH0pLnByb3BlcnR5KCdyb3V0ZUFyZ3MnKSwKCiAgICAvKioK
ICAgICAgVGhlIGRlZmF1bHQgaHJlZiB2YWx1ZSB0byB1c2Ugd2hpbGUgYSBsaW5rLXRvIGlzIGxv
YWRpbmcuCiAgICAgIE9ubHkgYXBwbGllcyB3aGVuIHRhZ05hbWUgaXMgJ2EnCgogICAgICBAcHJv
cGVydHkgbG9hZGluZ0hyZWYKICAgICAgQHR5cGUgU3RyaW5nCiAgICAgIEBkZWZhdWx0ICMKICAg
ICovCiAgICBsb2FkaW5nSHJlZjogJyMnCiAgfSk7CgogIExpbmtWaWV3LnRvU3RyaW5nID0gZnVu
Y3Rpb24oKSB7IHJldHVybiAiTGlua1ZpZXciOyB9OwoKICAvKioKICAgIFRoZSBge3tsaW5rLXRv
fX1gIGhlbHBlciByZW5kZXJzIGEgbGluayB0byB0aGUgc3VwcGxpZWQKICAgIGByb3V0ZU5hbWVg
IHBhc3NpbmcgYW4gb3B0aW9uYWxseSBzdXBwbGllZCBtb2RlbCB0byB0aGUKICAgIHJvdXRlIGFz
IGl0cyBgbW9kZWxgIGNvbnRleHQgb2YgdGhlIHJvdXRlLiBUaGUgYmxvY2sKICAgIGZvciBge3ts
aW5rLXRvfX1gIGJlY29tZXMgdGhlIGlubmVySFRNTCBvZiB0aGUgcmVuZGVyZWQKICAgIGVsZW1l
bnQ6CgogICAgYGBgaGFuZGxlYmFycwogICAge3sjbGluay10byAncGhvdG9HYWxsZXJ5J319CiAg
ICAgIEdyZWF0IEhhbXN0ZXIgUGhvdG9zCiAgICB7ey9saW5rLXRvfX0KICAgIGBgYAoKICAgIGBg
YGh0bWwKICAgIDxhIGhyZWY9Ii9oYW1zdGVyLXBob3RvcyI+CiAgICAgIEdyZWF0IEhhbXN0ZXIg
UGhvdG9zCiAgICA8L2E+CiAgICBgYGAKCiAgICAjIyMgU3VwcGx5aW5nIGEgdGFnTmFtZQogICAg
QnkgZGVmYXVsdCBge3tsaW5rLXRvfX1gIHJlbmRlcnMgYW4gYDxhPmAgZWxlbWVudC4gVGhpcyBj
YW4KICAgIGJlIG92ZXJyaWRkZW4gZm9yIGEgc2luZ2xlIHVzZSBvZiBge3tsaW5rLXRvfX1gIGJ5
IHN1cHBseWluZwogICAgYSBgdGFnTmFtZWAgb3B0aW9uOgoKICAgIGBgYGhhbmRsZWJhcnMKICAg
IHt7I2xpbmstdG8gJ3Bob3RvR2FsbGVyeScgdGFnTmFtZT0ibGkifX0KICAgICAgR3JlYXQgSGFt
c3RlciBQaG90b3MKICAgIHt7L2xpbmstdG99fQogICAgYGBgCgogICAgYGBgaHRtbAogICAgPGxp
PgogICAgICBHcmVhdCBIYW1zdGVyIFBob3RvcwogICAgPC9saT4KICAgIGBgYAoKICAgIFRvIG92
ZXJyaWRlIHRoaXMgb3B0aW9uIGZvciB5b3VyIGVudGlyZSBhcHBsaWNhdGlvbiwgc2VlCiAgICAi
T3ZlcnJpZGluZyBBcHBsaWNhdGlvbi13aWRlIERlZmF1bHRzIi4KCiAgICAjIyMgRGlzYWJsaW5n
IHRoZSBgbGluay10b2AgaGVscGVyCiAgICBCeSBkZWZhdWx0IGB7e2xpbmstdG99fWAgaXMgZW5h
YmxlZC4KICAgIGFueSBwYXNzZWQgdmFsdWUgdG8gYGRpc2FibGVkYCBoZWxwZXIgcHJvcGVydHkg
d2lsbCBkaXNhYmxlIHRoZSBgbGluay10b2AgaGVscGVyLgoKICAgIHN0YXRpYyB1c2U6IHRoZSBg
ZGlzYWJsZWRgIG9wdGlvbjoKCiAgICBgYGBoYW5kbGViYXJzCiAgICB7eyNsaW5rLXRvICdwaG90
b0dhbGxlcnknIGRpc2FibGVkPXRydWV9fQogICAgICBHcmVhdCBIYW1zdGVyIFBob3RvcwogICAg
e3svbGluay10b319CiAgICBgYGAKCiAgICBkeW5hbWljIHVzZTogdGhlIGBkaXNhYmxlZFdoZW5g
IG9wdGlvbjoKCiAgICBgYGBoYW5kbGViYXJzCiAgICB7eyNsaW5rLXRvICdwaG90b0dhbGxlcnkn
IGRpc2FibGVkV2hlbj1jb250cm9sbGVyLnNvbWVQcm9wZXJ0eX19CiAgICAgIEdyZWF0IEhhbXN0
ZXIgUGhvdG9zCiAgICB7ey9saW5rLXRvfX0KICAgIGBgYAoKICAgIGFueSBwYXNzZWQgdmFsdWUg
dG8gYGRpc2FibGVkYCB3aWxsIGRpc2FibGUgaXQgZXhjZXB0IGB1bmRlZmluZWRgLgogICAgdG8g
ZW5zdXJlIHRoYXQgb25seSBgdHJ1ZWAgZGlzYWJsZSB0aGUgYGxpbmstdG9gIGhlbHBlciB5b3Ug
Y2FuCiAgICBvdmVycmlkZSB0aGUgZ2xvYmFsIGJlaGF2aW91ciBvZiBgRW1iZXIuTGlua1ZpZXdg
LgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLkxpbmtWaWV3LnJlb3Blbih7CiAgICAgIGRp
c2FibGVkOiBFbWJlci5jb21wdXRlZChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgaWYg
KHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc2V0KCdfaXNEaXNhYmxlZCcs
IHZhbHVlID09PSB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB0cnVl
ID8gZ2V0KHRoaXMsICdkaXNhYmxlZENsYXNzJykgOiBmYWxzZTsKICAgICAgfSkKICAgIH0pOwog
ICAgYGBgCgogICAgc2VlICJPdmVycmlkaW5nIEFwcGxpY2F0aW9uLXdpZGUgRGVmYXVsdHMiIGZv
ciBtb3JlLgoKICAgICMjIyBIYW5kbGluZyBgaHJlZmAKICAgIGB7e2xpbmstdG99fWAgd2lsbCB1
c2UgeW91ciBhcHBsaWNhdGlvbidzIFJvdXRlciB0bwogICAgZmlsbCB0aGUgZWxlbWVudCdzIGBo
cmVmYCBwcm9wZXJ0eSB3aXRoIGEgdXJsIHRoYXQKICAgIG1hdGNoZXMgdGhlIHBhdGggdG8gdGhl
IHN1cHBsaWVkIGByb3V0ZU5hbWVgIGZvciB5b3VyCiAgICByb3V0ZXJzJ3MgY29uZmlndXJlZCBg
TG9jYXRpb25gIHNjaGVtZSwgd2hpY2ggZGVmYXVsdHMKICAgIHRvIEVtYmVyLkhhc2hMb2NhdGlv
bi4KCiAgICAjIyMgSGFuZGxpbmcgY3VycmVudCByb3V0ZQogICAgYHt7bGluay10b319YCB3aWxs
IGFwcGx5IGEgQ1NTIGNsYXNzIG5hbWUgb2YgJ2FjdGl2ZScKICAgIHdoZW4gdGhlIGFwcGxpY2F0
aW9uJ3MgY3VycmVudCByb3V0ZSBtYXRjaGVzCiAgICB0aGUgc3VwcGxpZWQgcm91dGVOYW1lLiBG
b3IgZXhhbXBsZSwgaWYgdGhlIGFwcGxpY2F0aW9uJ3MKICAgIGN1cnJlbnQgcm91dGUgaXMgJ3Bo
b3RvR2FsbGVyeS5yZWNlbnQnIHRoZSBmb2xsb3dpbmcKICAgIHVzZSBvZiBge3tsaW5rLXRvfX1g
OgoKICAgIGBgYGhhbmRsZWJhcnMKICAgIHt7I2xpbmstdG8gJ3Bob3RvR2FsbGVyeS5yZWNlbnQn
fX0KICAgICAgR3JlYXQgSGFtc3RlciBQaG90b3MgZnJvbSB0aGUgbGFzdCB3ZWVrCiAgICB7ey9s
aW5rLXRvfX0KICAgIGBgYAoKICAgIHdpbGwgcmVzdWx0IGluCgogICAgYGBgaHRtbAogICAgPGEg
aHJlZj0iL2hhbXN0ZXItcGhvdG9zL3RoaXMtd2VlayIgY2xhc3M9ImFjdGl2ZSI+CiAgICAgIEdy
ZWF0IEhhbXN0ZXIgUGhvdG9zCiAgICA8L2E+CiAgICBgYGAKCiAgICBUaGUgQ1NTIGNsYXNzIG5h
bWUgdXNlZCBmb3IgYWN0aXZlIGNsYXNzZXMgY2FuIGJlIGN1c3RvbWl6ZWQKICAgIGZvciBhIHNp
bmdsZSB1c2Ugb2YgYHt7bGluay10b319YCBieSBwYXNzaW5nIGFuIGBhY3RpdmVDbGFzc2AKICAg
IG9wdGlvbjoKCiAgICBgYGBoYW5kbGViYXJzCiAgICB7eyNsaW5rLXRvICdwaG90b0dhbGxlcnku
cmVjZW50JyBhY3RpdmVDbGFzcz0iY3VycmVudC11cmwifX0KICAgICAgR3JlYXQgSGFtc3RlciBQ
aG90b3MgZnJvbSB0aGUgbGFzdCB3ZWVrCiAgICB7ey9saW5rLXRvfX0KICAgIGBgYAoKICAgIGBg
YGh0bWwKICAgIDxhIGhyZWY9Ii9oYW1zdGVyLXBob3Rvcy90aGlzLXdlZWsiIGNsYXNzPSJjdXJy
ZW50LXVybCI+CiAgICAgIEdyZWF0IEhhbXN0ZXIgUGhvdG9zCiAgICA8L2E+CiAgICBgYGAKCiAg
ICBUbyBvdmVycmlkZSB0aGlzIG9wdGlvbiBmb3IgeW91ciBlbnRpcmUgYXBwbGljYXRpb24sIHNl
ZQogICAgIk92ZXJyaWRpbmcgQXBwbGljYXRpb24td2lkZSBEZWZhdWx0cyIuCgogICAgIyMjIFN1
cHBseWluZyBhIG1vZGVsCiAgICBBbiBvcHRpb25hbCBtb2RlbCBhcmd1bWVudCBjYW4gYmUgdXNl
ZCBmb3Igcm91dGVzIHdob3NlCiAgICBwYXRocyBjb250YWluIGR5bmFtaWMgc2VnbWVudHMuIFRo
aXMgYXJndW1lbnQgd2lsbCBiZWNvbWUKICAgIHRoZSBtb2RlbCBjb250ZXh0IG9mIHRoZSBsaW5r
ZWQgcm91dGU6CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlJvdXRlci5tYXAoZnVuY3Rpb24o
KSB7CiAgICAgIHRoaXMucmVzb3VyY2UoInBob3RvR2FsbGVyeSIsIHtwYXRoOiAiaGFtc3Rlci1w
aG90b3MvOnBob3RvX2lkIn0pOwogICAgfSk7CiAgICBgYGAKCiAgICBgYGBoYW5kbGViYXJzCiAg
ICB7eyNsaW5rLXRvICdwaG90b0dhbGxlcnknIGFQaG90b319CiAgICAgIHt7YVBob3RvLnRpdGxl
fX0KICAgIHt7L2xpbmstdG99fQogICAgYGBgCgogICAgYGBgaHRtbAogICAgPGEgaHJlZj0iL2hh
bXN0ZXItcGhvdG9zLzQyIj4KICAgICAgVG9tc3RlcgogICAgPC9hPgogICAgYGBgCgogICAgIyMj
IFN1cHBseWluZyBtdWx0aXBsZSBtb2RlbHMKICAgIEZvciBkZWVwLWxpbmtpbmcgdG8gcm91dGUg
cGF0aHMgdGhhdCBjb250YWluIG11bHRpcGxlCiAgICBkeW5hbWljIHNlZ21lbnRzLCBtdWx0aXBs
ZSBtb2RlbCBhcmd1bWVudHMgY2FuIGJlIHVzZWQuCiAgICBBcyB0aGUgcm91dGVyIHRyYW5zaXRp
b25zIHRocm91Z2ggdGhlIHJvdXRlIHBhdGgsIGVhY2gKICAgIHN1cHBsaWVkIG1vZGVsIGFyZ3Vt
ZW50IHdpbGwgYmVjb21lIHRoZSBjb250ZXh0IGZvciB0aGUKICAgIHJvdXRlIHdpdGggdGhlIGR5
bmFtaWMgc2VnbWVudHM6CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwLlJvdXRlci5tYXAoZnVu
Y3Rpb24oKSB7CiAgICAgIHRoaXMucmVzb3VyY2UoInBob3RvR2FsbGVyeSIsIHtwYXRoOiAiaGFt
c3Rlci1waG90b3MvOnBob3RvX2lkIn0sIGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMucm91dGUo
ImNvbW1lbnQiLCB7cGF0aDogImNvbW1lbnRzLzpjb21tZW50X2lkIn0pOwogICAgICB9KTsKICAg
IH0pOwogICAgYGBgCiAgICBUaGlzIGFyZ3VtZW50IHdpbGwgYmVjb21lIHRoZSBtb2RlbCBjb250
ZXh0IG9mIHRoZSBsaW5rZWQgcm91dGU6CgogICAgYGBgaGFuZGxlYmFycwogICAge3sjbGluay10
byAncGhvdG9HYWxsZXJ5LmNvbW1lbnQnIGFQaG90byBjb21tZW50fX0KICAgICAge3tjb21tZW50
LmJvZHl9fQogICAge3svbGluay10b319CiAgICBgYGAKCiAgICBgYGBodG1sCiAgICA8YSBocmVm
PSIvaGFtc3Rlci1waG90b3MvNDIvY29tbWVudC83MTgiPgogICAgICBBKysrIHdvdWxkIHNudWdn
bGUgYWdhaW4uCiAgICA8L2E+CiAgICBgYGAKCiAgICAjIyMgU3VwcGx5aW5nIGFuIGV4cGxpY2l0
IGR5bmFtaWMgc2VnbWVudCB2YWx1ZQogICAgSWYgeW91IGRvbid0IGhhdmUgYSBtb2RlbCBvYmpl
Y3QgYXZhaWxhYmxlIHRvIHBhc3MgdG8gYHt7bGluay10b319YCwKICAgIGFuIG9wdGlvbmFsIHN0
cmluZyBvciBpbnRlZ2VyIGFyZ3VtZW50IGNhbiBiZSBwYXNzZWQgZm9yIHJvdXRlcyB3aG9zZQog
ICAgcGF0aHMgY29udGFpbiBkeW5hbWljIHNlZ21lbnRzLiBUaGlzIGFyZ3VtZW50IHdpbGwgYmVj
b21lIHRoZSB2YWx1ZQogICAgb2YgdGhlIGR5bmFtaWMgc2VnbWVudDoKCiAgICBgYGBqYXZhc2Ny
aXB0CiAgICBBcHAuUm91dGVyLm1hcChmdW5jdGlvbigpIHsKICAgICAgdGhpcy5yZXNvdXJjZSgi
cGhvdG9HYWxsZXJ5Iiwge3BhdGg6ICJoYW1zdGVyLXBob3Rvcy86cGhvdG9faWQifSk7CiAgICB9
KTsKICAgIGBgYAoKICAgIGBgYGhhbmRsZWJhcnMKICAgIHt7I2xpbmstdG8gJ3Bob3RvR2FsbGVy
eScgYVBob3RvSWR9fQogICAgICB7e2FQaG90by50aXRsZX19CiAgICB7ey9saW5rLXRvfX0KICAg
IGBgYAoKICAgIGBgYGh0bWwKICAgIDxhIGhyZWY9Ii9oYW1zdGVyLXBob3Rvcy80MiI+CiAgICAg
IFRvbXN0ZXIKICAgIDwvYT4KICAgIGBgYAoKICAgIFdoZW4gdHJhbnNpdGlvbmluZyBpbnRvIHRo
ZSBsaW5rZWQgcm91dGUsIHRoZSBgbW9kZWxgIGhvb2sgd2lsbAogICAgYmUgdHJpZ2dlcmVkIHdp
dGggcGFyYW1ldGVycyBpbmNsdWRpbmcgdGhpcyBwYXNzZWQgaWRlbnRpZmllci4KCiAgICAjIyMg
QWxsb3dpbmcgRGVmYXVsdCBBY3Rpb24KCiAgIEJ5IGRlZmF1bHQgdGhlIGB7e2xpbmstdG99fWAg
aGVscGVyIHByZXZlbnRzIHRoZSBkZWZhdWx0IGJyb3dzZXIgYWN0aW9uCiAgIGJ5IGNhbGxpbmcg
YHByZXZlbnREZWZhdWx0KClgIGFzIHRoaXMgc29ydCBvZiBhY3Rpb24gYnViYmxpbmcgaXMgbm9y
bWFsbHkKICAgaGFuZGxlZCBpbnRlcm5hbGx5IGFuZCB3ZSBkbyBub3Qgd2FudCB0byB0YWtlIHRo
ZSBicm93c2VyIHRvIGEgbmV3IFVSTCAoZm9yCiAgIGV4YW1wbGUpLgoKICAgSWYgeW91IG5lZWQg
dG8gb3ZlcnJpZGUgdGhpcyBiZWhhdmlvciBzcGVjaWZ5IGBwcmV2ZW50RGVmYXVsdD1mYWxzZWAg
aW4KICAgeW91ciB0ZW1wbGF0ZToKCiAgICBgYGBoYW5kbGViYXJzCiAgICB7eyNsaW5rLXRvICdw
aG90b0dhbGxlcnknIGFQaG90b0lkIHByZXZlbnREZWZhdWx0PWZhbHNlfX0KICAgICAge3thUGhv
dG9JZC50aXRsZX19CiAgICB7ey9saW5rLXRvfX0KICAgIGBgYAoKICAgICMjIyBPdmVycmlkaW5n
IGF0dHJpYnV0ZXMKICAgIFlvdSBjYW4gb3ZlcnJpZGUgYW55IGdpdmVuIHByb3BlcnR5IG9mIHRo
ZSBFbWJlci5MaW5rVmlldwogICAgdGhhdCBpcyBnZW5lcmF0ZWQgYnkgdGhlIGB7e2xpbmstdG99
fWAgaGVscGVyIGJ5IHBhc3NpbmcKICAgIGtleS92YWx1ZSBwYWlycywgbGlrZSBzbzoKCiAgICBg
YGBoYW5kbGViYXJzCiAgICB7eyNsaW5rLXRvICBhUGhvdG8gdGFnTmFtZT0nbGknIHRpdGxlPSdG
b2xsb3dpbmcgdGhpcyBsaW5rIHdpbGwgY2hhbmdlIHlvdXIgbGlmZScgY2xhc3NOYW1lcz0ncGlj
IHN3ZWV0J319CiAgICAgIFVoLW1hemluZyEKICAgIHt7L2xpbmstdG99fQogICAgYGBgCgogICAg
U2VlIFtFbWJlci5MaW5rVmlld10oL2FwaS9jbGFzc2VzL0VtYmVyLkxpbmtWaWV3Lmh0bWwpIGZv
ciBhCiAgICBjb21wbGV0ZSBsaXN0IG9mIG92ZXJyaWRlYWJsZSBwcm9wZXJ0aWVzLiBCZSBzdXJl
IHRvIGFsc28KICAgIGNoZWNrIG91dCBpbmhlcml0ZWQgcHJvcGVydGllcyBvZiBgTGlua1ZpZXdg
LgoKICAgICMjIyBPdmVycmlkaW5nIEFwcGxpY2F0aW9uLXdpZGUgRGVmYXVsdHMKICAgIGBge3ts
aW5rLXRvfX1gYCBjcmVhdGVzIGFuIGluc3RhbmNlIG9mIEVtYmVyLkxpbmtWaWV3CiAgICBmb3Ig
cmVuZGVyaW5nLiBUbyBvdmVycmlkZSBvcHRpb25zIGZvciB5b3VyIGVudGlyZQogICAgYXBwbGlj
YXRpb24sIHJlb3BlbiBFbWJlci5MaW5rVmlldyBhbmQgc3VwcGx5IHRoZQogICAgZGVzaXJlZCB2
YWx1ZXM6CgogICAgYGBgIGphdmFzY3JpcHQKICAgIEVtYmVyLkxpbmtWaWV3LnJlb3Blbih7CiAg
ICAgIGFjdGl2ZUNsYXNzOiAiaXMtYWN0aXZlIiwKICAgICAgdGFnTmFtZTogJ2xpJwogICAgfSkK
ICAgIGBgYAoKICAgIEl0IGlzIGFsc28gcG9zc2libGUgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQg
ZXZlbnQgaW4KICAgIHRoaXMgbWFubmVyOgoKICAgIGBgYCBqYXZhc2NyaXB0CiAgICBFbWJlci5M
aW5rVmlldy5yZW9wZW4oewogICAgICBldmVudE5hbWU6ICdjdXN0b21FdmVudE5hbWUnCiAgICB9
KTsKICAgIGBgYAoKICAgIEBtZXRob2QgbGluay10bwogICAgQGZvciBFbWJlci5IYW5kbGViYXJz
LmhlbHBlcnMKICAgIEBwYXJhbSB7U3RyaW5nfSByb3V0ZU5hbWUKICAgIEBwYXJhbSB7T2JqZWN0
fSBbY29udGV4dF0qCiAgICBAcGFyYW0gW29wdGlvbnNdIHtPYmplY3R9IEhhbmRsZWJhcnMga2V5
L3ZhbHVlIHBhaXJzIG9mIG9wdGlvbnMsIHlvdSBjYW4gb3ZlcnJpZGUgYW55IHByb3BlcnR5IG9m
IEVtYmVyLkxpbmtWaWV3CiAgICBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nCiAgICBAc2Vl
IHtFbWJlci5MaW5rVmlld30KICAqLwogIEVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIo
J2xpbmstdG8nLCBmdW5jdGlvbiBsaW5rVG9IZWxwZXIobmFtZSkgewogICAgdmFyIG9wdGlvbnMg
PSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgLTEpWzBdLAogICAgICAgIHBhcmFtcyA9IFtdLnNs
aWNlLmNhbGwoYXJndW1lbnRzLCAwLCAtMSksCiAgICAgICAgaGFzaCA9IG9wdGlvbnMuaGFzaDsK
CiAgICBoYXNoLmRpc2FibGVkQmluZGluZyA9IGhhc2guZGlzYWJsZWRXaGVuOwoKICAgIGlmICgh
b3B0aW9ucy5mbikgewogICAgICB2YXIgbGlua1RpdGxlID0gcGFyYW1zLnNoaWZ0KCk7CiAgICAg
IHZhciBsaW5rVHlwZSA9IG9wdGlvbnMudHlwZXMuc2hpZnQoKTsKICAgICAgdmFyIGNvbnRleHQg
PSB0aGlzOwogICAgICBpZiAobGlua1R5cGUgPT09ICdJRCcpIHsKICAgICAgICBvcHRpb25zLmxp
bmtUZXh0UGF0aCA9IGxpbmtUaXRsZTsKICAgICAgICBvcHRpb25zLmZuID0gZnVuY3Rpb24oKSB7
CiAgICAgICAgICByZXR1cm4gRW1iZXIuSGFuZGxlYmFycy5nZXQoY29udGV4dCwgbGlua1RpdGxl
LCBvcHRpb25zKTsKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnMuZm4g
PSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBsaW5rVGl0bGU7CiAgICAgICAgfTsKICAg
ICAgfQogICAgfQoKICAgIGhhc2gucGFyYW1ldGVycyA9IHsKICAgICAgY29udGV4dDogdGhpcywK
ICAgICAgb3B0aW9uczogb3B0aW9ucywKICAgICAgcGFyYW1zOiBwYXJhbXMKICAgIH07CgogICAg
cmV0dXJuIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycy52aWV3LmNhbGwodGhpcywgTGlua1ZpZXcs
IG9wdGlvbnMpOwogIH0pOwoKICAvKioKICAgIFNlZSBbbGluay10b10oL2FwaS9jbGFzc2VzL0Vt
YmVyLkhhbmRsZWJhcnMuaGVscGVycy5odG1sI21ldGhvZF9saW5rLXRvKQoKICAgIEBtZXRob2Qg
bGlua1RvCiAgICBAZm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwogICAgQGRlcHJlY2F0ZWQK
ICAgIEBwYXJhbSB7U3RyaW5nfSByb3V0ZU5hbWUKICAgIEBwYXJhbSB7T2JqZWN0fSBbY29udGV4
dF0qCiAgICBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nCiAgKi8KICBFbWJlci5IYW5kbGVi
YXJzLnJlZ2lzdGVySGVscGVyKCdsaW5rVG8nLCBmdW5jdGlvbiBsaW5rVG9IZWxwZXIoKSB7CiAg
ICBFbWJlci53YXJuKCJUaGUgJ2xpbmtUbycgdmlldyBoZWxwZXIgaXMgZGVwcmVjYXRlZCBpbiBm
YXZvciBvZiAnbGluay10byciKTsKICAgIHJldHVybiBFbWJlci5IYW5kbGViYXJzLmhlbHBlcnNb
J2xpbmstdG8nXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0pOwp9KTsKCgoKfSkoKTsKCgoK
KGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLXJvdXRpbmcK
Ki8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKRW1iZXIub25Mb2FkKCdF
bWJlci5IYW5kbGViYXJzJywgZnVuY3Rpb24oSGFuZGxlYmFycykgewogIC8qKgogIEBtb2R1bGUg
ZW1iZXIKICBAc3VibW9kdWxlIGVtYmVyLXJvdXRpbmcKICAqLwoKICBIYW5kbGViYXJzLk91dGxl
dFZpZXcgPSBFbWJlci5Db250YWluZXJWaWV3LmV4dGVuZChFbWJlci5fTWV0YW1vcnBoKTsKCiAg
LyoqCiAgICBUaGUgYG91dGxldGAgaGVscGVyIGlzIGEgcGxhY2Vob2xkZXIgdGhhdCB0aGUgcm91
dGVyIHdpbGwgZmlsbCBpbiB3aXRoCiAgICB0aGUgYXBwcm9wcmlhdGUgdGVtcGxhdGUgYmFzZWQg
b24gdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGFwcGxpY2F0aW9uLgoKICAgIGBgYCBoYW5kbGVi
YXJzCiAgICB7e291dGxldH19CiAgICBgYGAKCiAgICBCeSBkZWZhdWx0LCBhIHRlbXBsYXRlIGJh
c2VkIG9uIEVtYmVyJ3MgbmFtaW5nIGNvbnZlbnRpb25zIHdpbGwgYmUgcmVuZGVyZWQKICAgIGlu
dG8gdGhlIGBvdXRsZXRgIChlLmcuIGBBcHAuUG9zdHNSb3V0ZWAgd2lsbCByZW5kZXIgdGhlIGBw
b3N0c2AgdGVtcGxhdGUpLgoKICAgIFlvdSBjYW4gcmVuZGVyIGEgZGlmZmVyZW50IHRlbXBsYXRl
IGJ5IHVzaW5nIHRoZSBgcmVuZGVyKClgIG1ldGhvZCBpbiB0aGUKICAgIHJvdXRlJ3MgYHJlbmRl
clRlbXBsYXRlYCBob29rLiBUaGUgZm9sbG93aW5nIHdpbGwgcmVuZGVyIHRoZSBgZmF2b3JpdGVQ
b3N0YAogICAgdGVtcGxhdGUgaW50byB0aGUgYG91dGxldGAuCgogICAgYGBgIGphdmFzY3JpcHQK
ICAgIEFwcC5Qb3N0c1JvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKHsKICAgICAgcmVuZGVyVGVt
cGxhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMucmVuZGVyKCdmYXZvcml0ZVBvc3QnKTsK
ICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBZb3UgY2FuIGNyZWF0ZSBjdXN0b20gbmFtZWQg
b3V0bGV0cyBmb3IgbW9yZSBjb250cm9sLgoKICAgIGBgYCBoYW5kbGViYXJzCiAgICB7e291dGxl
dCAnZmF2b3JpdGVQb3N0J319CiAgICB7e291dGxldCAncG9zdHMnfX0KICAgIGBgYAoKICAgIFRo
ZW4geW91IGNhbiBkZWZpbmUgd2hhdCB0ZW1wbGF0ZSBpcyByZW5kZXJlZCBpbnRvIGVhY2ggb3V0
bGV0IGluIHlvdXIKICAgIHJvdXRlLgoKCiAgICBgYGAgamF2YXNjcmlwdAogICAgQXBwLlBvc3Rz
Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoewogICAgICByZW5kZXJUZW1wbGF0ZTogZnVuY3Rp
b24oKSB7CiAgICAgICAgdGhpcy5yZW5kZXIoJ2Zhdm9yaXRlUG9zdCcsIHsgb3V0bGV0OiAnZmF2
b3JpdGVQb3N0JyB9KTsKICAgICAgICB0aGlzLnJlbmRlcigncG9zdHMnLCB7IG91dGxldDogJ3Bv
c3RzJyB9KTsKICAgICAgfQogICAgfSk7CiAgICBgYGAKCiAgICBZb3UgY2FuIHNwZWNpZnkgdGhl
IHZpZXcgdGhhdCB0aGUgb3V0bGV0IHVzZXMgdG8gY29udGFpbiBhbmQgbWFuYWdlIHRoZQogICAg
dGVtcGxhdGVzIHJlbmRlcmVkIGludG8gaXQuCgogICAgYGBgIGhhbmRsZWJhcnMKICAgIHt7b3V0
bGV0IHZpZXc9J3NlY3Rpb25Db250YWluZXInfX0KICAgIGBgYAoKICAgIGBgYCBqYXZhc2NyaXB0
CiAgICBBcHAuU2VjdGlvbkNvbnRhaW5lciA9IEVtYmVyLkNvbnRhaW5lclZpZXcuZXh0ZW5kKHsK
ICAgICAgdGFnTmFtZTogJ3NlY3Rpb24nLAogICAgICBjbGFzc05hbWVzOiBbJ3NwZWNpYWwnXQog
ICAgfSk7CiAgICBgYGAKCiAgICBAbWV0aG9kIG91dGxldAogICAgQGZvciBFbWJlci5IYW5kbGVi
YXJzLmhlbHBlcnMKICAgIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eSB0aGUgcHJvcGVydHkgb24g
dGhlIGNvbnRyb2xsZXIKICAgICAgdGhhdCBob2xkcyB0aGUgdmlldyBmb3IgdGhpcyBvdXRsZXQK
ICAgIEByZXR1cm4ge1N0cmluZ30gSFRNTCBzdHJpbmcKICAqLwogIEhhbmRsZWJhcnMucmVnaXN0
ZXJIZWxwZXIoJ291dGxldCcsIGZ1bmN0aW9uIG91dGxldEhlbHBlcihwcm9wZXJ0eSwgb3B0aW9u
cykgewogICAKICAgIHZhciBvdXRsZXRTb3VyY2UsCiAgICAgICAgY29udGFpbmVyLAogICAgICAg
IHZpZXdOYW1lLAogICAgICAgIHZpZXdDbGFzcywKICAgICAgICB2aWV3RnVsbE5hbWU7CgogICAg
aWYgKHByb3BlcnR5ICYmIHByb3BlcnR5LmRhdGEgJiYgcHJvcGVydHkuZGF0YS5pc1JlbmRlckRh
dGEpIHsKICAgICAgb3B0aW9ucyA9IHByb3BlcnR5OwogICAgICBwcm9wZXJ0eSA9ICdtYWluJzsK
ICAgIH0KCiAgICBjb250YWluZXIgPSBvcHRpb25zLmRhdGEudmlldy5jb250YWluZXI7CgogICAg
b3V0bGV0U291cmNlID0gb3B0aW9ucy5kYXRhLnZpZXc7CiAgICB3aGlsZSAoIW91dGxldFNvdXJj
ZS5nZXQoJ3RlbXBsYXRlLmlzVG9wJykpIHsKICAgICAgb3V0bGV0U291cmNlID0gb3V0bGV0U291
cmNlLmdldCgnX3BhcmVudFZpZXcnKTsKICAgIH0KCiAgICAvLyBwcm92aWRlIGNvbnRyb2xsZXIg
b3ZlcnJpZGUKICAgIHZpZXdOYW1lID0gb3B0aW9ucy5oYXNoLnZpZXc7CgogICAgaWYgKHZpZXdO
YW1lKSB7CiAgICAgIHZpZXdGdWxsTmFtZSA9ICd2aWV3OicgKyB2aWV3TmFtZTsKICAgICAgRW1i
ZXIuYXNzZXJ0KCJVc2luZyBhIHF1b3RlbGVzcyB2aWV3IHBhcmFtZXRlciB3aXRoIHt7b3V0bGV0
fX0gaXMgbm90IHN1cHBvcnRlZC4gUGxlYXNlIHVwZGF0ZSB0byBxdW90ZWQgdXNhZ2UgJ3t7b3V0
bGV0IFwiIiArIHZpZXdOYW1lICsgIlwifX0uIiwgb3B0aW9ucy5oYXNoVHlwZXMudmlldyAhPT0g
J0lEJyk7CiAgICAgIEVtYmVyLmFzc2VydCgiVGhlIHZpZXcgbmFtZSB5b3Ugc3VwcGxpZWQgJyIg
KyB2aWV3TmFtZSArICInIGRpZCBub3QgcmVzb2x2ZSB0byBhIHZpZXcuIiwgY29udGFpbmVyLmhh
cyh2aWV3RnVsbE5hbWUpKTsKICAgIH0KCiAgICB2aWV3Q2xhc3MgPSB2aWV3TmFtZSA/IGNvbnRh
aW5lci5sb29rdXBGYWN0b3J5KHZpZXdGdWxsTmFtZSkgOiBvcHRpb25zLmhhc2gudmlld0NsYXNz
IHx8IEhhbmRsZWJhcnMuT3V0bGV0VmlldzsKCiAgICBvcHRpb25zLmRhdGEudmlldy5zZXQoJ291
dGxldFNvdXJjZScsIG91dGxldFNvdXJjZSk7CiAgICBvcHRpb25zLmhhc2guY3VycmVudFZpZXdC
aW5kaW5nID0gJ192aWV3Lm91dGxldFNvdXJjZS5fb3V0bGV0cy4nICsgcHJvcGVydHk7CgogICAg
cmV0dXJuIEhhbmRsZWJhcnMuaGVscGVycy52aWV3LmNhbGwodGhpcywgdmlld0NsYXNzLCBvcHRp
b25zKTsKICB9KTsKfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVy
CkBzdWJtb2R1bGUgZW1iZXItcm91dGluZwoqLwoKdmFyIGdldCA9IEVtYmVyLmdldCwgc2V0ID0g
RW1iZXIuc2V0OwpFbWJlci5vbkxvYWQoJ0VtYmVyLkhhbmRsZWJhcnMnLCBmdW5jdGlvbihIYW5k
bGViYXJzKSB7CgogIC8qKgogICAgQ2FsbGluZyBgYHt7cmVuZGVyfX1gYCBmcm9tIHdpdGhpbiBh
IHRlbXBsYXRlIHdpbGwgaW5zZXJ0IGFub3RoZXIKICAgIHRlbXBsYXRlIHRoYXQgbWF0Y2hlcyB0
aGUgcHJvdmlkZWQgbmFtZS4gVGhlIGluc2VydGVkIHRlbXBsYXRlIHdpbGwKICAgIGFjY2VzcyBp
dHMgcHJvcGVydGllcyBvbiBpdHMgb3duIGNvbnRyb2xsZXIgKHJhdGhlciB0aGFuIHRoZSBjb250
cm9sbGVyCiAgICBvZiB0aGUgcGFyZW50IHRlbXBsYXRlKS4KCiAgICBJZiBhIHZpZXcgY2xhc3Mg
d2l0aCB0aGUgc2FtZSBuYW1lIGV4aXN0cywgdGhlIHZpZXcgY2xhc3MgYWxzbyB3aWxsIGJlIHVz
ZWQuCgogICAgTm90ZTogQSBnaXZlbiBjb250cm9sbGVyIG1heSBvbmx5IGJlIHVzZWQgKm9uY2Uq
IGluIHlvdXIgYXBwIGluIHRoaXMgbWFubmVyLgogICAgQSBzaW5nbGV0b24gaW5zdGFuY2Ugb2Yg
dGhlIGNvbnRyb2xsZXIgd2lsbCBiZSBjcmVhdGVkIGZvciB5b3UuCgogICAgRXhhbXBsZToKCiAg
ICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBFbWJlci5Db250
cm9sbGVyLmV4dGVuZCh7CiAgICAgIHdobzogIndvcmxkIgogICAgfSk7CiAgICBgYGAKCiAgICBg
YGBoYW5kbGViYXJzCiAgICA8IS0tIG5hdmlnYXRpb24uaGJzIC0tPgogICAgSGVsbG8sIHt7d2hv
fX0uCiAgICBgYGAKCiAgICBgYGBoYW5kZWxiYXJzCiAgICA8IS0tIGFwcGxpY2F0aW9uLmhicyAt
LT4KICAgIDxoMT5NeSBncmVhdCBhcHA8L2gxPgogICAge3tyZW5kZXIgbmF2aWdhdGlvbn19CiAg
ICBgYGAKCiAgICBgYGBodG1sCiAgICA8aDE+TXkgZ3JlYXQgYXBwPC9oMT4KICAgIDxkaXYgY2xh
c3M9J2VtYmVyLXZpZXcnPgogICAgICBIZWxsbywgd29ybGQuCiAgICA8L2Rpdj4KICAgIGBgYAoK
ICAgIE9wdGlvbmFsbHkgeW91IG1heSBwcm92aWRlIGEgc2Vjb25kIGFyZ3VtZW50OiBhIHByb3Bl
cnR5IHBhdGgKICAgIHRoYXQgd2lsbCBiZSBib3VuZCB0byB0aGUgYG1vZGVsYCBwcm9wZXJ0eSBv
ZiB0aGUgY29udHJvbGxlci4KCiAgICBJZiBhIGBtb2RlbGAgcHJvcGVydHkgcGF0aCBpcyBzcGVj
aWZpZWQsIHRoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgdGhlCiAgICBjb250cm9sbGVyIHdpbGwgYmUg
Y3JlYXRlZCBhbmQgYHt7cmVuZGVyfX1gIGNhbiBiZSB1c2VkIG11bHRpcGxlIHRpbWVzCiAgICB3
aXRoIHRoZSBzYW1lIG5hbWUuCgogICBGb3IgZXhhbXBsZSBpZiB5b3UgaGFkIHRoaXMgYGF1dGhv
cmAgdGVtcGxhdGUuCgogICBgYGBoYW5kbGViYXJzCjxkaXYgY2xhc3M9ImF1dGhvciI+CiAgV3Jp
dHRlbiBieSB7e2ZpcnN0TmFtZX19IHt7bGFzdE5hbWV9fS4KICBUb3RhbCBQb3N0czoge3twb3N0
Q291bnR9fQo8L2Rpdj4KICBgYGAKCiAgWW91IGNvdWxkIHJlbmRlciBpdCBpbnNpZGUgdGhlIGBw
b3N0YCB0ZW1wbGF0ZSB1c2luZyB0aGUgYHJlbmRlcmAgaGVscGVyLgoKICBgYGBoYW5kbGViYXJz
CjxkaXYgY2xhc3M9InBvc3QiPgogIDxoMT57e3RpdGxlfX08L2gxPgogIDxkaXY+e3tib2R5fX08
L2Rpdj4KICB7e3JlbmRlciAiYXV0aG9yIiBhdXRob3J9fQo8L2Rpdj4KICAgYGBgCgogICAgQG1l
dGhvZCByZW5kZXIKICAgIEBmb3IgRW1iZXIuSGFuZGxlYmFycy5oZWxwZXJzCiAgICBAcGFyYW0g
e1N0cmluZ30gbmFtZQogICAgQHBhcmFtIHtPYmplY3Q/fSBjb250ZXh0U3RyaW5nCiAgICBAcGFy
YW0ge0hhc2h9IG9wdGlvbnMKICAgIEByZXR1cm4ge1N0cmluZ30gSFRNTCBzdHJpbmcKICAqLwog
IEVtYmVyLkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3JlbmRlcicsIGZ1bmN0aW9uIHJlbmRl
ckhlbHBlcihuYW1lLCBjb250ZXh0U3RyaW5nLCBvcHRpb25zKSB7CiAgICB2YXIgbGVuZ3RoID0g
YXJndW1lbnRzLmxlbmd0aDsKICAgIEVtYmVyLmFzc2VydCgiWW91IG11c3QgcGFzcyBhIHRlbXBs
YXRlIHRvIHJlbmRlciIsIGxlbmd0aCA+PSAyKTsKICAgIHZhciBjb250ZXh0UHJvdmlkZWQgPSBs
ZW5ndGggPT09IDMsCiAgICAgICAgY29udGFpbmVyLCByb3V0ZXIsIGNvbnRyb2xsZXIsIHZpZXcs
IGNvbnRleHQsIGxvb2t1cE9wdGlvbnM7CgogICAgY29udGFpbmVyID0gKG9wdGlvbnMgfHwgY29u
dGV4dFN0cmluZykuZGF0YS5rZXl3b3Jkcy5jb250cm9sbGVyLmNvbnRhaW5lcjsKICAgIHJvdXRl
ciA9IGNvbnRhaW5lci5sb29rdXAoJ3JvdXRlcjptYWluJyk7CgogICAgaWYgKGxlbmd0aCA9PT0g
MikgewogICAgICAvLyB1c2UgdGhlIHNpbmdsZXRvbiBjb250cm9sbGVyCiAgICAgIG9wdGlvbnMg
PSBjb250ZXh0U3RyaW5nOwogICAgICBjb250ZXh0U3RyaW5nID0gdW5kZWZpbmVkOwogICAgICBF
bWJlci5hc3NlcnQoIllvdSBjYW4gb25seSB1c2UgdGhlIHt7cmVuZGVyfX0gaGVscGVyIG9uY2Ug
d2l0aG91dCBhIG1vZGVsIG9iamVjdCBhcyBpdHMgc2Vjb25kIGFyZ3VtZW50LCBhcyBpbiB7e3Jl
bmRlciBcInBvc3RcIiBwb3N0fX0uIiwgIXJvdXRlciB8fCAhcm91dGVyLl9sb29rdXBBY3RpdmVW
aWV3KG5hbWUpKTsKICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSAzKSB7CiAgICAgIC8vIGNyZWF0
ZSBhIG5ldyBjb250cm9sbGVyCiAgICAgIGNvbnRleHQgPSBFbWJlci5IYW5kbGViYXJzLmdldChv
cHRpb25zLmNvbnRleHRzWzFdLCBjb250ZXh0U3RyaW5nLCBvcHRpb25zKTsKICAgIH0gZWxzZSB7
CiAgICAgIHRocm93IEVtYmVyLkVycm9yKCJZb3UgbXVzdCBwYXNzIGEgdGVtcGxhdGVOYW1lIHRv
IHJlbmRlciIpOwogICAgfQoKICAgIC8vICMgbGVnYWN5IG5hbWVzcGFjZQogICAgbmFtZSA9IG5h
bWUucmVwbGFjZSgvXC8vZywgJy4nKTsKICAgIC8vIFwgbGVnYWN5IHNsYXNoIGFzIG5hbWVzcGFj
ZSBzdXBwb3J0CgoKICAgIHZpZXcgPSBjb250YWluZXIubG9va3VwKCd2aWV3OicgKyBuYW1lKSB8
fCBjb250YWluZXIubG9va3VwKCd2aWV3OmRlZmF1bHQnKTsKCiAgICAvLyBwcm92aWRlIGNvbnRy
b2xsZXIgb3ZlcnJpZGUKICAgIHZhciBjb250cm9sbGVyTmFtZSA9IG9wdGlvbnMuaGFzaC5jb250
cm9sbGVyIHx8IG5hbWU7CiAgICB2YXIgY29udHJvbGxlckZ1bGxOYW1lID0gJ2NvbnRyb2xsZXI6
JyArIGNvbnRyb2xsZXJOYW1lOwoKICAgIGlmIChvcHRpb25zLmhhc2guY29udHJvbGxlcikgewog
ICAgICBFbWJlci5hc3NlcnQoIlRoZSBjb250cm9sbGVyIG5hbWUgeW91IHN1cHBsaWVkICciICsg
Y29udHJvbGxlck5hbWUgKyAiJyBkaWQgbm90IHJlc29sdmUgdG8gYSBjb250cm9sbGVyLiIsIGNv
bnRhaW5lci5oYXMoY29udHJvbGxlckZ1bGxOYW1lKSk7CiAgICB9CgogICAgdmFyIHBhcmVudENv
bnRyb2xsZXIgPSBvcHRpb25zLmRhdGEua2V5d29yZHMuY29udHJvbGxlcjsKCiAgICAvLyBjaG9v
c2UgbmFtZQogICAgaWYgKGxlbmd0aCA+IDIpIHsKICAgICAgdmFyIGZhY3RvcnkgPSBjb250YWlu
ZXIubG9va3VwRmFjdG9yeShjb250cm9sbGVyRnVsbE5hbWUpIHx8CiAgICAgICAgICAgICAgICAg
ICAgRW1iZXIuZ2VuZXJhdGVDb250cm9sbGVyRmFjdG9yeShjb250YWluZXIsIGNvbnRyb2xsZXJO
YW1lLCBjb250ZXh0KTsKCiAgICAgIGNvbnRyb2xsZXIgPSBmYWN0b3J5LmNyZWF0ZSh7CiAgICAg
ICAgbW9kZWw6IGNvbnRleHQsCiAgICAgICAgcGFyZW50Q29udHJvbGxlcjogcGFyZW50Q29udHJv
bGxlciwKICAgICAgICB0YXJnZXQ6IHBhcmVudENvbnRyb2xsZXIKICAgICAgfSk7CgogICAgfSBl
bHNlIHsKICAgICAgY29udHJvbGxlciA9IGNvbnRhaW5lci5sb29rdXAoY29udHJvbGxlckZ1bGxO
YW1lKSB8fAogICAgICAgICAgICAgICAgICAgRW1iZXIuZ2VuZXJhdGVDb250cm9sbGVyKGNvbnRh
aW5lciwgY29udHJvbGxlck5hbWUpOwoKICAgICAgY29udHJvbGxlci5zZXRQcm9wZXJ0aWVzKHsK
ICAgICAgICB0YXJnZXQ6IHBhcmVudENvbnRyb2xsZXIsCiAgICAgICAgcGFyZW50Q29udHJvbGxl
cjogcGFyZW50Q29udHJvbGxlcgogICAgICB9KTsKICAgIH0KCiAgICB2YXIgcm9vdCA9IG9wdGlv
bnMuY29udGV4dHNbMV07CgogICAgaWYgKHJvb3QpIHsKICAgICAgdmlldy5yZWdpc3Rlck9ic2Vy
dmVyKHJvb3QsIGNvbnRleHRTdHJpbmcsIGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnRyb2xsZXIu
c2V0KCdtb2RlbCcsIEVtYmVyLkhhbmRsZWJhcnMuZ2V0KHJvb3QsIGNvbnRleHRTdHJpbmcsIG9w
dGlvbnMpKTsKICAgICAgfSk7CiAgICB9CgogICAgb3B0aW9ucy5oYXNoLnZpZXdOYW1lID0gRW1i
ZXIuU3RyaW5nLmNhbWVsaXplKG5hbWUpOwoKICAgIHZhciB0ZW1wbGF0ZU5hbWUgPSAndGVtcGxh
dGU6JyArIG5hbWU7CiAgICBFbWJlci5hc3NlcnQoIllvdSB1c2VkIGB7e3JlbmRlciAnIiArIG5h
bWUgKyAiJ319YCwgYnV0ICciICsgbmFtZSArICInIGNhbiBub3QgYmUgZm91bmQgYXMgZWl0aGVy
IGEgdGVtcGxhdGUgb3IgYSB2aWV3LiIsIGNvbnRhaW5lci5oYXMoInZpZXc6IiArIG5hbWUpIHx8
IGNvbnRhaW5lci5oYXModGVtcGxhdGVOYW1lKSk7CiAgICBvcHRpb25zLmhhc2gudGVtcGxhdGUg
PSBjb250YWluZXIubG9va3VwKHRlbXBsYXRlTmFtZSk7CgogICAgb3B0aW9ucy5oYXNoLmNvbnRy
b2xsZXIgPSBjb250cm9sbGVyOwoKICAgIGlmIChyb3V0ZXIgJiYgIWNvbnRleHQpIHsKICAgICAg
cm91dGVyLl9jb25uZWN0QWN0aXZlVmlldyhuYW1lLCB2aWV3KTsKICAgIH0KCiAgICBFbWJlci5I
YW5kbGViYXJzLmhlbHBlcnMudmlldy5jYWxsKHRoaXMsIHZpZXcsIG9wdGlvbnMpOwogIH0pOwp9
KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBl
bWJlci1yb3V0aW5nCiovCkVtYmVyLm9uTG9hZCgnRW1iZXIuSGFuZGxlYmFycycsIGZ1bmN0aW9u
KEhhbmRsZWJhcnMpIHsKCiAgdmFyIHJlc29sdmVQYXJhbXMgPSBFbWJlci5Sb3V0ZXIucmVzb2x2
ZVBhcmFtcywKICAgICAgaXNTaW1wbGVDbGljayA9IEVtYmVyLlZpZXdVdGlscy5pc1NpbXBsZUNs
aWNrOwoKICB2YXIgRW1iZXJIYW5kbGViYXJzID0gRW1iZXIuSGFuZGxlYmFycywKICAgICAgaGFu
ZGxlYmFyc0dldCA9IEVtYmVySGFuZGxlYmFycy5nZXQsCiAgICAgIFNhZmVTdHJpbmcgPSBFbWJl
ckhhbmRsZWJhcnMuU2FmZVN0cmluZywKICAgICAgZm9yRWFjaCA9IEVtYmVyLkFycmF5UG9seWZp
bGxzLmZvckVhY2gsCiAgICAgIGdldCA9IEVtYmVyLmdldCwKICAgICAgYV9zbGljZSA9IEFycmF5
LnByb3RvdHlwZS5zbGljZTsKCiAgZnVuY3Rpb24gYXJncyhvcHRpb25zLCBhY3Rpb25OYW1lKSB7
CiAgICB2YXIgcmV0ID0gW107CiAgICBpZiAoYWN0aW9uTmFtZSkgeyByZXQucHVzaChhY3Rpb25O
YW1lKTsgfQoKICAgIHZhciB0eXBlcyA9IG9wdGlvbnMub3B0aW9ucy50eXBlcy5zbGljZSgxKSwK
ICAgICAgICBkYXRhID0gb3B0aW9ucy5vcHRpb25zLmRhdGE7CgogICAgcmV0dXJuIHJldC5jb25j
YXQocmVzb2x2ZVBhcmFtcyhvcHRpb25zLmNvbnRleHQsIG9wdGlvbnMucGFyYW1zLCB7IHR5cGVz
OiB0eXBlcywgZGF0YTogZGF0YSB9KSk7CiAgfQoKICB2YXIgQWN0aW9uSGVscGVyID0gRW1iZXJI
YW5kbGViYXJzLkFjdGlvbkhlbHBlciA9IHsKICAgIHJlZ2lzdGVyZWRBY3Rpb25zOiB7fQogIH07
CgogIHZhciBrZXlzID0gWyJhbHQiLCAic2hpZnQiLCAibWV0YSIsICJjdHJsIl07CgogIHZhciBQ
T0lOVEVSX0VWRU5UX1RZUEVfUkVHRVggPSAvXmNsaWNrfG1vdXNlfHRvdWNoLzsKCiAgdmFyIGlz
QWxsb3dlZEV2ZW50ID0gZnVuY3Rpb24oZXZlbnQsIGFsbG93ZWRLZXlzKSB7CiAgICBpZiAodHlw
ZW9mIGFsbG93ZWRLZXlzID09PSAidW5kZWZpbmVkIikgewogICAgICBpZiAoUE9JTlRFUl9FVkVO
VF9UWVBFX1JFR0VYLnRlc3QoZXZlbnQudHlwZSkpIHsKICAgICAgICByZXR1cm4gaXNTaW1wbGVD
bGljayhldmVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWxsb3dlZEtleXMgPSAnJzsKICAg
ICAgfQogICAgfQoKICAgIGlmIChhbGxvd2VkS2V5cy5pbmRleE9mKCJhbnkiKSA+PSAwKSB7CiAg
ICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHZhciBhbGxvd2VkID0gdHJ1ZTsKCiAgICBmb3JF
YWNoLmNhbGwoa2V5cywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChldmVudFtrZXkgKyAiS2V5
Il0gJiYgYWxsb3dlZEtleXMuaW5kZXhPZihrZXkpID09PSAtMSkgewogICAgICAgIGFsbG93ZWQg
PSBmYWxzZTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIGFsbG93ZWQ7CiAgfTsKCiAgQWN0
aW9uSGVscGVyLnJlZ2lzdGVyQWN0aW9uID0gZnVuY3Rpb24oYWN0aW9uTmFtZSwgb3B0aW9ucywg
YWxsb3dlZEtleXMpIHsKICAgIHZhciBhY3Rpb25JZCA9ICgrK0VtYmVyLnV1aWQpLnRvU3RyaW5n
KCk7CgogICAgQWN0aW9uSGVscGVyLnJlZ2lzdGVyZWRBY3Rpb25zW2FjdGlvbklkXSA9IHsKICAg
ICAgZXZlbnROYW1lOiBvcHRpb25zLmV2ZW50TmFtZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24g
aGFuZGxlUmVnaXN0ZXJlZEFjdGlvbihldmVudCkgewogICAgICAgIGlmICghaXNBbGxvd2VkRXZl
bnQoZXZlbnQsIGFsbG93ZWRLZXlzKSkgeyByZXR1cm4gdHJ1ZTsgfQoKICAgICAgICBpZiAob3B0
aW9ucy5wcmV2ZW50RGVmYXVsdCAhPT0gZmFsc2UpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnRE
ZWZhdWx0KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5idWJibGVzID09PSBmYWxz
ZSkgewogICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgfQoKICAgICAg
ICB2YXIgdGFyZ2V0ID0gb3B0aW9ucy50YXJnZXQ7CgogICAgICAgIGlmICh0YXJnZXQudGFyZ2V0
KSB7CiAgICAgICAgICB0YXJnZXQgPSBoYW5kbGViYXJzR2V0KHRhcmdldC5yb290LCB0YXJnZXQu
dGFyZ2V0LCB0YXJnZXQub3B0aW9ucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRhcmdl
dCA9IHRhcmdldC5yb290OwogICAgICAgIH0KCiAgICAgICAgRW1iZXIucnVuKGZ1bmN0aW9uIHJ1
blJlZ2lzdGVyZWRBY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGFyZ2V0LnNlbmQpIHsKICAgICAg
ICAgICAgdGFyZ2V0LnNlbmQuYXBwbHkodGFyZ2V0LCBhcmdzKG9wdGlvbnMucGFyYW1ldGVycywg
YWN0aW9uTmFtZSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgRW1iZXIuYXNzZXJ0
KCJUaGUgYWN0aW9uICciICsgYWN0aW9uTmFtZSArICInIGRpZCBub3QgZXhpc3Qgb24gIiArIHRh
cmdldCwgdHlwZW9mIHRhcmdldFthY3Rpb25OYW1lXSA9PT0gJ2Z1bmN0aW9uJyk7CiAgICAgICAg
ICAgIHRhcmdldFthY3Rpb25OYW1lXS5hcHBseSh0YXJnZXQsIGFyZ3Mob3B0aW9ucy5wYXJhbWV0
ZXJzKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgb3B0aW9u
cy52aWV3Lm9uKCd3aWxsQ2xlYXJSZW5kZXInLCBmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlIEFj
dGlvbkhlbHBlci5yZWdpc3RlcmVkQWN0aW9uc1thY3Rpb25JZF07CiAgICB9KTsKCiAgICByZXR1
cm4gYWN0aW9uSWQ7CiAgfTsKCiAgLyoqCiAgICBUaGUgYHt7YWN0aW9ufX1gIGhlbHBlciByZWdp
c3RlcnMgYW4gSFRNTCBlbGVtZW50IHdpdGhpbiBhIHRlbXBsYXRlIGZvciBET00KICAgIGV2ZW50
IGhhbmRsaW5nIGFuZCBmb3J3YXJkcyB0aGF0IGludGVyYWN0aW9uIHRvIHRoZSB0ZW1wbGF0ZXMn
cyBjb250cm9sbGVyCiAgICBvciBzdXBwbGllZCBgdGFyZ2V0YCBvcHRpb24gKHNlZSAnU3BlY2lm
eWluZyBhIFRhcmdldCcpLgoKICAgIElmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGltcGxlbWVu
dCB0aGUgZXZlbnQsIHRoZSBldmVudCBpcyBzZW50CiAgICB0byB0aGUgY3VycmVudCByb3V0ZSwg
YW5kIGl0IGJ1YmJsZXMgdXAgdGhlIHJvdXRlIGhpZXJhcmNoeSBmcm9tIHRoZXJlLgoKICAgIFVz
ZXIgaW50ZXJhY3Rpb24gd2l0aCB0aGF0IGVsZW1lbnQgd2lsbCBpbnZva2UgdGhlIHN1cHBsaWVk
IGFjdGlvbiBuYW1lIG9uCiAgICB0aGUgYXBwcm9wcmlhdGUgdGFyZ2V0LgoKICAgIEdpdmVuIHRo
ZSBmb2xsb3dpbmcgYXBwbGljYXRpb24gSGFuZGxlYmFycyB0ZW1wbGF0ZSBvbiB0aGUgcGFnZQoK
ICAgIGBgYGhhbmRsZWJhcnMKICAgIDxkaXYge3thY3Rpb24gJ2FuQWN0aW9uTmFtZSd9fT4KICAg
ICAgY2xpY2sgbWUKICAgIDwvZGl2PgogICAgYGBgCgogICAgQW5kIGFwcGxpY2F0aW9uIGNvZGUK
CiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuQXBwbGljYXRpb25Db250cm9sbGVyID0gRW1iZXIu
Q29udHJvbGxlci5leHRlbmQoewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgYW5BY3Rpb25OYW1l
OiBmdW5jdGlvbigpIHsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgV2ls
bCByZXN1bHQgaW4gdGhlIGZvbGxvd2luZyByZW5kZXJlZCBIVE1MCgogICAgYGBgaHRtbAogICAg
PGRpdiBjbGFzcz0iZW1iZXItdmlldyI+CiAgICAgIDxkaXYgZGF0YS1lbWJlci1hY3Rpb249IjEi
PgogICAgICAgIGNsaWNrIG1lCiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICBgYGAKCiAgICBD
bGlja2luZyAiY2xpY2sgbWUiIHdpbGwgdHJpZ2dlciB0aGUgYGFuQWN0aW9uTmFtZWAgYWN0aW9u
IG9mIHRoZQogICAgYEFwcC5BcHBsaWNhdGlvbkNvbnRyb2xsZXJgLiBJbiB0aGlzIGNhc2UsIG5v
IGFkZGl0aW9uYWwgcGFyYW1ldGVycyB3aWxsIGJlIHBhc3NlZC4KCiAgICBJZiB5b3UgcHJvdmlk
ZSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgdG8gdGhlIGhlbHBlcjoKCiAgICBgYGBoYW5kbGViYXJz
CiAgICA8YnV0dG9uIHt7YWN0aW9uICdlZGl0JyBwb3N0fX0+RWRpdDwvYnV0dG9uPgogICAgYGBg
CgogICAgVGhvc2UgcGFyYW1ldGVycyB3aWxsIGJlIHBhc3NlZCBhbG9uZyBhcyBhcmd1bWVudHMg
dG8gdGhlIEphdmFTY3JpcHQKICAgIGZ1bmN0aW9uIGltcGxlbWVudGluZyB0aGUgYWN0aW9uLgoK
ICAgICMjIyBFdmVudCBQcm9wYWdhdGlvbgoKICAgIEV2ZW50cyB0cmlnZ2VyZWQgdGhyb3VnaCB0
aGUgYWN0aW9uIGhlbHBlciB3aWxsIGF1dG9tYXRpY2FsbHkgaGF2ZQogICAgYC5wcmV2ZW50RGVm
YXVsdCgpYCBjYWxsZWQgb24gdGhlbS4gWW91IGRvIG5vdCBuZWVkIHRvIGRvIHNvIGluIHlvdXIg
ZXZlbnQKICAgIGhhbmRsZXJzLiBJZiB5b3UgbmVlZCB0byBhbGxvdyBldmVudCBwcm9wYWdhdGlv
biAodG8gaGFuZGxlIGZpbGUgaW5wdXRzIGZvcgogICAgZXhhbXBsZSkgeW91IGNhbiBzdXBwbHkg
dGhlIGBwcmV2ZW50RGVmYXVsdD1mYWxzZWAgb3B0aW9uIHRvIHRoZSBge3thY3Rpb259fWAgaGVs
cGVyOgoKICAgIGBgYGhhbmRsZWJhcnMKICAgIDxkaXYge3thY3Rpb24gInNheUhlbGxvIiBwcmV2
ZW50RGVmYXVsdD1mYWxzZX19PgogICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgLz4KICAgICAgPGlu
cHV0IHR5cGU9ImNoZWNrYm94IiAvPgogICAgPC9kaXY+CiAgICBgYGAKCiAgICBUbyBkaXNhYmxl
IGJ1YmJsaW5nLCBwYXNzIGBidWJibGVzPWZhbHNlYCB0byB0aGUgaGVscGVyOgoKICAgIGBgYGhh
bmRsZWJhcnMKICAgIDxidXR0b24ge3thY3Rpb24gJ2VkaXQnIHBvc3QgYnViYmxlcz1mYWxzZX19
PkVkaXQ8L2J1dHRvbj4KICAgIGBgYAoKICAgIElmIHlvdSBuZWVkIHRoZSBkZWZhdWx0IGhhbmRs
ZXIgdG8gdHJpZ2dlciB5b3Ugc2hvdWxkIGVpdGhlciByZWdpc3RlciB5b3VyCiAgICBvd24gZXZl
bnQgaGFuZGxlciwgb3IgdXNlIGV2ZW50IG1ldGhvZHMgb24geW91ciB2aWV3IGNsYXNzLiBTZWUg
W0VtYmVyLlZpZXddKC9hcGkvY2xhc3Nlcy9FbWJlci5WaWV3Lmh0bWwpCiAgICAnUmVzcG9uZGlu
ZyB0byBCcm93c2VyIEV2ZW50cycgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgIyMjIFNwZWNp
ZnlpbmcgRE9NIGV2ZW50IHR5cGUKCiAgICBCeSBkZWZhdWx0IHRoZSBge3thY3Rpb259fWAgaGVs
cGVyIHJlZ2lzdGVycyBmb3IgRE9NIGBjbGlja2AgZXZlbnRzLiBZb3UgY2FuCiAgICBzdXBwbHkg
YW4gYG9uYCBvcHRpb24gdG8gdGhlIGhlbHBlciB0byBzcGVjaWZ5IGEgZGlmZmVyZW50IERPTSBl
dmVudCBuYW1lOgoKICAgIGBgYGhhbmRsZWJhcnMKICAgIDxkaXYge3thY3Rpb24gImFuQWN0aW9u
TmFtZSIgb249ImRvdWJsZUNsaWNrIn19PgogICAgICBjbGljayBtZQogICAgPC9kaXY+CiAgICBg
YGAKCiAgICBTZWUgYEVtYmVyLlZpZXdgICdSZXNwb25kaW5nIHRvIEJyb3dzZXIgRXZlbnRzJyBm
b3IgYSBsaXN0IG9mCiAgICBhY2NlcHRhYmxlIERPTSBldmVudCBuYW1lcy4KCiAgICBOT1RFOiBC
ZWNhdXNlIGB7e2FjdGlvbn19YCBkZXBlbmRzIG9uIEVtYmVyJ3MgZXZlbnQgZGlzcGF0Y2ggc3lz
dGVtIGl0IHdpbGwKICAgIG9ubHkgZnVuY3Rpb24gaWYgYW4gYEVtYmVyLkV2ZW50RGlzcGF0Y2hl
cmAgaW5zdGFuY2UgaXMgYXZhaWxhYmxlLiBBbgogICAgYEVtYmVyLkV2ZW50RGlzcGF0Y2hlcmAg
aW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkIHdoZW4gYSBuZXcgYEVtYmVyLkFwcGxpY2F0aW9uYAog
ICAgaXMgY3JlYXRlZC4gSGF2aW5nIGFuIGluc3RhbmNlIG9mIGBFbWJlci5BcHBsaWNhdGlvbmAg
d2lsbCBzYXRpc2Z5IHRoaXMKICAgIHJlcXVpcmVtZW50LgoKICAgICMjIyBTcGVjaWZ5aW5nIHdo
aXRlbGlzdGVkIG1vZGlmaWVyIGtleXMKCiAgICBCeSBkZWZhdWx0IHRoZSBge3thY3Rpb259fWAg
aGVscGVyIHdpbGwgaWdub3JlIGNsaWNrIGV2ZW50IHdpdGggcHJlc3NlZCBtb2RpZmllcgogICAg
a2V5cy4gWW91IGNhbiBzdXBwbHkgYW4gYGFsbG93ZWRLZXlzYCBvcHRpb24gdG8gc3BlY2lmeSB3
aGljaCBrZXlzIHNob3VsZCBub3QgYmUgaWdub3JlZC4KCiAgICBgYGBoYW5kbGViYXJzCiAgICA8
ZGl2IHt7YWN0aW9uICJhbkFjdGlvbk5hbWUiIGFsbG93ZWRLZXlzPSJhbHQifX0+CiAgICAgIGNs
aWNrIG1lCiAgICA8L2Rpdj4KICAgIGBgYAoKICAgIFRoaXMgd2F5IHRoZSBge3thY3Rpb259fWAg
d2lsbCBmaXJlIHdoZW4gY2xpY2tpbmcgd2l0aCB0aGUgYWx0IGtleSBwcmVzc2VkIGRvd24uCgog
ICAgQWx0ZXJuYXRpdmVseSwgc3VwcGx5ICJhbnkiIHRvIHRoZSBgYWxsb3dlZEtleXNgIG9wdGlv
biB0byBhY2NlcHQgYW55IGNvbWJpbmF0aW9uIG9mIG1vZGlmaWVyIGtleXMuCgogICAgYGBgaGFu
ZGxlYmFycwogICAgPGRpdiB7e2FjdGlvbiAiYW5BY3Rpb25OYW1lIiBhbGxvd2VkS2V5cz0iYW55
In19PgogICAgICBjbGljayBtZSB3aXRoIGFueSBrZXkgcHJlc3NlZAogICAgPC9kaXY+CiAgICBg
YGAKCiAgICAjIyMgU3BlY2lmeWluZyBhIFRhcmdldAoKICAgIFRoZXJlIGFyZSBzZXZlcmFsIHBv
c3NpYmxlIHRhcmdldCBvYmplY3RzIGZvciBge3thY3Rpb259fWAgaGVscGVyczoKCiAgICBJbiBh
IHR5cGljYWwgRW1iZXIgYXBwbGljYXRpb24sIHdoZXJlIHZpZXdzIGFyZSBtYW5hZ2VkIHRocm91
Z2ggdXNlIG9mIHRoZQogICAgYHt7b3V0bGV0fX1gIGhlbHBlciwgYWN0aW9ucyB3aWxsIGJ1YmJs
ZSB0byB0aGUgY3VycmVudCBjb250cm9sbGVyLCB0aGVuCiAgICB0byB0aGUgY3VycmVudCByb3V0
ZSwgYW5kIHRoZW4gdXAgdGhlIHJvdXRlIGhpZXJhcmNoeS4KCiAgICBBbHRlcm5hdGl2ZWx5LCBh
IGB0YXJnZXRgIG9wdGlvbiBjYW4gYmUgcHJvdmlkZWQgdG8gdGhlIGhlbHBlciB0byBjaGFuZ2UK
ICAgIHdoaWNoIG9iamVjdCB3aWxsIHJlY2VpdmUgdGhlIG1ldGhvZCBjYWxsLiBUaGlzIG9wdGlv
biBtdXN0IGJlIGEgcGF0aAogICAgdG8gYW4gb2JqZWN0LCBhY2Nlc3NpYmxlIGluIHRoZSBjdXJy
ZW50IGNvbnRleHQ6CgogICAgYGBgaGFuZGxlYmFycwogICAge3shIHRoZSBhcHBsaWNhdGlvbiB0
ZW1wbGF0ZSB9fQogICAgPGRpdiB7e2FjdGlvbiAiYW5BY3Rpb25OYW1lIiB0YXJnZXQ9dmlld319
PgogICAgICBjbGljayBtZQogICAgPC9kaXY+CiAgICBgYGAKCiAgICBgYGBqYXZhc2NyaXB0CiAg
ICBBcHAuQXBwbGljYXRpb25WaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgICBhY3Rpb25z
OiB7CiAgICAgICAgYW5BY3Rpb25OYW1lOiBmdW5jdGlvbigpe30KICAgICAgfQogICAgfSk7Cgog
ICAgYGBgCgogICAgIyMjIEFkZGl0aW9uYWwgUGFyYW1ldGVycwoKICAgIFlvdSBtYXkgc3BlY2lm
eSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgdG8gdGhlIGB7e2FjdGlvbn19YCBoZWxwZXIuIFRoZXNl
CiAgICBwYXJhbWV0ZXJzIGFyZSBwYXNzZWQgYWxvbmcgYXMgdGhlIGFyZ3VtZW50cyB0byB0aGUg
SmF2YVNjcmlwdCBmdW5jdGlvbgogICAgaW1wbGVtZW50aW5nIHRoZSBhY3Rpb24uCgogICAgYGBg
aGFuZGxlYmFycwogICAge3sjZWFjaCBwZXJzb24gaW4gcGVvcGxlfX0KICAgICAgPGRpdiB7e2Fj
dGlvbiAiZWRpdCIgcGVyc29ufX0+CiAgICAgICAgY2xpY2sgbWUKICAgICAgPC9kaXY+CiAgICB7
ey9lYWNofX0KICAgIGBgYAoKICAgIENsaWNraW5nICJjbGljayBtZSIgd2lsbCB0cmlnZ2VyIHRo
ZSBgZWRpdGAgbWV0aG9kIG9uIHRoZSBjdXJyZW50IGNvbnRyb2xsZXIKICAgIHdpdGggdGhlIHZh
bHVlIG9mIGBwZXJzb25gIGFzIGEgcGFyYW1ldGVyLgoKICAgIEBtZXRob2QgYWN0aW9uCiAgICBA
Zm9yIEVtYmVyLkhhbmRsZWJhcnMuaGVscGVycwogICAgQHBhcmFtIHtTdHJpbmd9IGFjdGlvbk5h
bWUKICAgIEBwYXJhbSB7T2JqZWN0fSBbY29udGV4dF0qCiAgICBAcGFyYW0ge0hhc2h9IG9wdGlv
bnMKICAqLwogIEVtYmVySGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignYWN0aW9uJywgZnVuY3Rp
b24gYWN0aW9uSGVscGVyKGFjdGlvbk5hbWUpIHsKICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRz
W2FyZ3VtZW50cy5sZW5ndGggLSAxXSwKICAgICAgICBjb250ZXh0cyA9IGFfc2xpY2UuY2FsbChh
cmd1bWVudHMsIDEsIC0xKTsKCiAgICB2YXIgaGFzaCA9IG9wdGlvbnMuaGFzaCwKICAgICAgICBj
b250cm9sbGVyOwoKICAgIC8vIGNyZWF0ZSBhIGhhc2ggdG8gcGFzcyBhbG9uZyB0byByZWdpc3Rl
ckFjdGlvbgogICAgdmFyIGFjdGlvbiA9IHsKICAgICAgZXZlbnROYW1lOiBoYXNoLm9uIHx8ICJj
bGljayIKICAgIH07CgogICAgYWN0aW9uLnBhcmFtZXRlcnMgPSB7CiAgICAgIGNvbnRleHQ6IHRo
aXMsCiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsCiAgICAgIHBhcmFtczogY29udGV4dHMKICAgIH07
CgogICAgYWN0aW9uLnZpZXcgPSBvcHRpb25zLmRhdGEudmlldzsKCiAgICB2YXIgcm9vdCwgdGFy
Z2V0OwoKICAgIGlmIChoYXNoLnRhcmdldCkgewogICAgICByb290ID0gdGhpczsKICAgICAgdGFy
Z2V0ID0gaGFzaC50YXJnZXQ7CiAgICB9IGVsc2UgaWYgKGNvbnRyb2xsZXIgPSBvcHRpb25zLmRh
dGEua2V5d29yZHMuY29udHJvbGxlcikgewogICAgICByb290ID0gY29udHJvbGxlcjsKICAgIH0K
CiAgICBhY3Rpb24udGFyZ2V0ID0geyByb290OiByb290LCB0YXJnZXQ6IHRhcmdldCwgb3B0aW9u
czogb3B0aW9ucyB9OwogICAgYWN0aW9uLmJ1YmJsZXMgPSBoYXNoLmJ1YmJsZXM7CiAgICBhY3Rp
b24ucHJldmVudERlZmF1bHQgPSBoYXNoLnByZXZlbnREZWZhdWx0OwoKICAgIHZhciBhY3Rpb25J
ZCA9IEFjdGlvbkhlbHBlci5yZWdpc3RlckFjdGlvbihhY3Rpb25OYW1lLCBhY3Rpb24sIGhhc2gu
YWxsb3dlZEtleXMpOwogICAgcmV0dXJuIG5ldyBTYWZlU3RyaW5nKCdkYXRhLWVtYmVyLWFjdGlv
bj0iJyArIGFjdGlvbklkICsgJyInKTsKICB9KTsKCn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkg
ewoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVt
YmVyLXJvdXRpbmcKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCkVt
YmVyLkNvbnRyb2xsZXJNaXhpbi5yZW9wZW4oewogIC8qKgogICAgVHJhbnNpdGlvbiB0aGUgYXBw
bGljYXRpb24gaW50byBhbm90aGVyIHJvdXRlLiBUaGUgcm91dGUgbWF5CiAgICBiZSBlaXRoZXIg
YSBzaW5nbGUgcm91dGUgb3Igcm91dGUgcGF0aDoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBhQ29u
dHJvbGxlci50cmFuc2l0aW9uVG9Sb3V0ZSgnYmxvZ1Bvc3RzJyk7CiAgICBhQ29udHJvbGxlci50
cmFuc2l0aW9uVG9Sb3V0ZSgnYmxvZ1Bvc3RzLnJlY2VudEVudHJpZXMnKTsKICAgIGBgYAoKICAg
IE9wdGlvbmFsbHkgc3VwcGx5IGEgbW9kZWwgZm9yIHRoZSByb3V0ZSBpbiBxdWVzdGlvbi4gVGhl
IG1vZGVsCiAgICB3aWxsIGJlIHNlcmlhbGl6ZWQgaW50byB0aGUgVVJMIHVzaW5nIHRoZSBgc2Vy
aWFsaXplYCBob29rIG9mCiAgICB0aGUgcm91dGU6CgogICAgYGBgamF2YXNjcmlwdAogICAgYUNv
bnRyb2xsZXIudHJhbnNpdGlvblRvUm91dGUoJ2Jsb2dQb3N0JywgYVBvc3QpOwogICAgYGBgCgog
ICAgTXVsdGlwbGUgbW9kZWxzIHdpbGwgYmUgYXBwbGllZCBsYXN0IHRvIGZpcnN0IHJlY3Vyc2l2
ZWx5IHVwIHRoZQogICAgcmVzb3VyY2UgdHJlZS4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICB0aGlz
LnJlc291cmNlKCdibG9nUG9zdCcsIHtwYXRoOic6YmxvZ1Bvc3RJZCd9LCBmdW5jdGlvbigpewog
ICAgICB0aGlzLnJlc291cmNlKCdibG9nQ29tbWVudCcsIHtwYXRoOiAnOmJsb2dDb21tZW50SWQn
fSk7CiAgICB9KTsKCiAgICBhQ29udHJvbGxlci50cmFuc2l0aW9uVG9Sb3V0ZSgnYmxvZ0NvbW1l
bnQnLCBhUG9zdCwgYUNvbW1lbnQpOwogICAgYGBgCgogICAgU2VlIGFsc28gJ3JlcGxhY2VSb3V0
ZScuCgogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvdXRlCiAgICBA
cGFyYW0gey4uLk9iamVjdH0gbW9kZWxzIHRoZSBtb2RlbChzKSB0byBiZSB1c2VkIHdoaWxlIHRy
YW5zaXRpb25pbmcKICAgIHRvIHRoZSByb3V0ZS4KICAgIEBmb3IgRW1iZXIuQ29udHJvbGxlck1p
eGluCiAgICBAbWV0aG9kIHRyYW5zaXRpb25Ub1JvdXRlCiAgKi8KICB0cmFuc2l0aW9uVG9Sb3V0
ZTogZnVuY3Rpb24oKSB7CiAgICAvLyB0YXJnZXQgbWF5IGJlIGVpdGhlciBhbm90aGVyIGNvbnRy
b2xsZXIgb3IgYSByb3V0ZXIKICAgIHZhciB0YXJnZXQgPSBnZXQodGhpcywgJ3RhcmdldCcpLAog
ICAgICAgIG1ldGhvZCA9IHRhcmdldC50cmFuc2l0aW9uVG9Sb3V0ZSB8fCB0YXJnZXQudHJhbnNp
dGlvblRvOwogICAgcmV0dXJuIG1ldGhvZC5hcHBseSh0YXJnZXQsIGFyZ3VtZW50cyk7CiAgfSwK
CiAgLyoqCiAgICBAZGVwcmVjYXRlZAogICAgQGZvciBFbWJlci5Db250cm9sbGVyTWl4aW4KICAg
IEBtZXRob2QgdHJhbnNpdGlvblRvCiAgKi8KICB0cmFuc2l0aW9uVG86IGZ1bmN0aW9uKCkgewog
ICAgRW1iZXIuZGVwcmVjYXRlKCJ0cmFuc2l0aW9uVG8gaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVz
ZSB0cmFuc2l0aW9uVG9Sb3V0ZS4iKTsKICAgIHJldHVybiB0aGlzLnRyYW5zaXRpb25Ub1JvdXRl
LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgICBUcmFuc2l0aW9uIGludG8g
YW5vdGhlciByb3V0ZSB3aGlsZSByZXBsYWNpbmcgdGhlIGN1cnJlbnQgVVJMLCBpZiBwb3NzaWJs
ZS4KICAgIFRoaXMgd2lsbCByZXBsYWNlIHRoZSBjdXJyZW50IGhpc3RvcnkgZW50cnkgaW5zdGVh
ZCBvZiBhZGRpbmcgYSBuZXcgb25lLiAKICAgIEJlc2lkZSB0aGF0LCBpdCBpcyBpZGVudGljYWwg
dG8gYHRyYW5zaXRpb25Ub1JvdXRlYCBpbiBhbGwgb3RoZXIgcmVzcGVjdHMuCgogICAgYGBgamF2
YXNjcmlwdAogICAgYUNvbnRyb2xsZXIucmVwbGFjZVJvdXRlKCdibG9nUG9zdHMnKTsKICAgIGFD
b250cm9sbGVyLnJlcGxhY2VSb3V0ZSgnYmxvZ1Bvc3RzLnJlY2VudEVudHJpZXMnKTsKICAgIGBg
YAoKICAgIE9wdGlvbmFsbHkgc3VwcGx5IGEgbW9kZWwgZm9yIHRoZSByb3V0ZSBpbiBxdWVzdGlv
bi4gVGhlIG1vZGVsCiAgICB3aWxsIGJlIHNlcmlhbGl6ZWQgaW50byB0aGUgVVJMIHVzaW5nIHRo
ZSBgc2VyaWFsaXplYCBob29rIG9mCiAgICB0aGUgcm91dGU6CgogICAgYGBgamF2YXNjcmlwdAog
ICAgYUNvbnRyb2xsZXIucmVwbGFjZVJvdXRlKCdibG9nUG9zdCcsIGFQb3N0KTsKICAgIGBgYAoK
ICAgIE11bHRpcGxlIG1vZGVscyB3aWxsIGJlIGFwcGxpZWQgbGFzdCB0byBmaXJzdCByZWN1cnNp
dmVseSB1cCB0aGUKICAgIHJlc291cmNlIHRyZWUuCgogICAgYGBgamF2YXNjcmlwdAogICAgdGhp
cy5yZXNvdXJjZSgnYmxvZ1Bvc3QnLCB7cGF0aDonOmJsb2dQb3N0SWQnfSwgZnVuY3Rpb24oKXsK
ICAgICAgdGhpcy5yZXNvdXJjZSgnYmxvZ0NvbW1lbnQnLCB7cGF0aDogJzpibG9nQ29tbWVudElk
J30pOwogICAgfSk7CgogICAgYUNvbnRyb2xsZXIucmVwbGFjZVJvdXRlKCdibG9nQ29tbWVudCcs
IGFQb3N0LCBhQ29tbWVudCk7CiAgICBgYGAKCiAgICBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUg
bmFtZSBvZiB0aGUgcm91dGUKICAgIEBwYXJhbSB7Li4uT2JqZWN0fSBtb2RlbHMgdGhlIG1vZGVs
KHMpIHRvIGJlIHVzZWQgd2hpbGUgdHJhbnNpdGlvbmluZwogICAgdG8gdGhlIHJvdXRlLgogICAg
QGZvciBFbWJlci5Db250cm9sbGVyTWl4aW4KICAgIEBtZXRob2QgcmVwbGFjZVJvdXRlCiAgKi8K
ICByZXBsYWNlUm91dGU6IGZ1bmN0aW9uKCkgewogICAgLy8gdGFyZ2V0IG1heSBiZSBlaXRoZXIg
YW5vdGhlciBjb250cm9sbGVyIG9yIGEgcm91dGVyCiAgICB2YXIgdGFyZ2V0ID0gZ2V0KHRoaXMs
ICd0YXJnZXQnKSwKICAgICAgICBtZXRob2QgPSB0YXJnZXQucmVwbGFjZVJvdXRlIHx8IHRhcmdl
dC5yZXBsYWNlV2l0aDsKICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMp
OwogIH0sCgogIC8qKgogICAgQGRlcHJlY2F0ZWQKICAgIEBmb3IgRW1iZXIuQ29udHJvbGxlck1p
eGluCiAgICBAbWV0aG9kIHJlcGxhY2VXaXRoCiAgKi8KICByZXBsYWNlV2l0aDogZnVuY3Rpb24o
KSB7CiAgICBFbWJlci5kZXByZWNhdGUoInJlcGxhY2VXaXRoIGlzIGRlcHJlY2F0ZWQuIFBsZWFz
ZSB1c2UgcmVwbGFjZVJvdXRlLiIpOwogICAgcmV0dXJuIHRoaXMucmVwbGFjZVJvdXRlLmFwcGx5
KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBt
b2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1yb3V0aW5nCiovCgp2YXIgZ2V0ID0gRW1iZXIu
Z2V0LCBzZXQgPSBFbWJlci5zZXQ7CgpFbWJlci5WaWV3LnJlb3Blbih7CgogIC8qKgogICAgU2V0
cyB0aGUgcHJpdmF0ZSBgX291dGxldHNgIG9iamVjdCBvbiB0aGUgdmlldy4KCiAgICBAbWV0aG9k
IGluaXQKICAgKi8KICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHNldCh0aGlzLCAnX291dGxldHMn
LCB7fSk7CiAgICB0aGlzLl9zdXBlcigpOwogIH0sCgogIC8qKgogICAgTWFudWFsbHkgZmlsbCBh
bnkgb2YgYSB2aWV3J3MgYHt7b3V0bGV0fX1gIGFyZWFzIHdpdGggdGhlCiAgICBzdXBwbGllZCB2
aWV3LgoKICAgIEV4YW1wbGUKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB2YXIgTXlWaWV3ID0gRW1i
ZXIuVmlldy5leHRlbmQoewogICAgICB0ZW1wbGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxl
KCdDaGlsZCB2aWV3OiB7e291dGxldCAibWFpbiJ9fSAnKQogICAgfSk7CiAgICB2YXIgbXlWaWV3
ID0gTXlWaWV3LmNyZWF0ZSgpOwogICAgbXlWaWV3LmFwcGVuZFRvKCdib2R5Jyk7CiAgICAvLyBU
aGUgaHRtbCBmb3IgbXlWaWV3IG5vdyBsb29rcyBsaWtlOgogICAgLy8gPGRpdiBpZD0iZW1iZXIy
MjgiIGNsYXNzPSJlbWJlci12aWV3Ij5DaGlsZCB2aWV3OiA8L2Rpdj4KCiAgICB2YXIgRm9vVmll
dyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgICAgdGVtcGxhdGU6IEVtYmVyLkhhbmRsZWJhcnMu
Y29tcGlsZSgnPGgxPkZvbzwvaDE+ICcpCiAgICB9KTsKICAgIHZhciBmb29WaWV3ID0gRm9vVmll
dy5jcmVhdGUoKTsKICAgIG15Vmlldy5jb25uZWN0T3V0bGV0KCdtYWluJywgZm9vVmlldyk7CiAg
ICAvLyBUaGUgaHRtbCBmb3IgbXlWaWV3IG5vdyBsb29rcyBsaWtlOgogICAgLy8gPGRpdiBpZD0i
ZW1iZXIyMjgiIGNsYXNzPSJlbWJlci12aWV3Ij5DaGlsZCB2aWV3OgogICAgLy8gICA8ZGl2IGlk
PSJlbWJlcjIzNCIgY2xhc3M9ImVtYmVyLXZpZXciPjxoMT5Gb288L2gxPiA8L2Rpdj4KICAgIC8v
IDwvZGl2PgogICAgYGBgCiAgICBAbWV0aG9kIGNvbm5lY3RPdXRsZXQKICAgIEBwYXJhbSAge1N0
cmluZ30gb3V0bGV0TmFtZSBBIHVuaXF1ZSBuYW1lIGZvciB0aGUgb3V0bGV0CiAgICBAcGFyYW0g
IHtPYmplY3R9IHZpZXcgICAgICAgQW4gRW1iZXIuVmlldwogICAqLwogIGNvbm5lY3RPdXRsZXQ6
IGZ1bmN0aW9uKG91dGxldE5hbWUsIHZpZXcpIHsKICAgIGlmICh0aGlzLl9wZW5kaW5nRGlzY29u
bmVjdGlvbnMpIHsKICAgICAgZGVsZXRlIHRoaXMuX3BlbmRpbmdEaXNjb25uZWN0aW9uc1tvdXRs
ZXROYW1lXTsKICAgIH0KCiAgICBpZiAodGhpcy5faGFzRXF1aXZhbGVudFZpZXcob3V0bGV0TmFt
ZSwgdmlldykpIHsKICAgICAgdmlldy5kZXN0cm95KCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAg
ICB2YXIgb3V0bGV0cyA9IGdldCh0aGlzLCAnX291dGxldHMnKSwKICAgICAgICBjb250YWluZXIg
PSBnZXQodGhpcywgJ2NvbnRhaW5lcicpLAogICAgICAgIHJvdXRlciA9IGNvbnRhaW5lciAmJiBj
b250YWluZXIubG9va3VwKCdyb3V0ZXI6bWFpbicpLAogICAgICAgIHJlbmRlcmVkTmFtZSA9IGdl
dCh2aWV3LCAncmVuZGVyZWROYW1lJyk7CgogICAgc2V0KG91dGxldHMsIG91dGxldE5hbWUsIHZp
ZXcpOwoKICAgIGlmIChyb3V0ZXIgJiYgcmVuZGVyZWROYW1lKSB7CiAgICAgIHJvdXRlci5fY29u
bmVjdEFjdGl2ZVZpZXcocmVuZGVyZWROYW1lLCB2aWV3KTsKICAgIH0KICB9LAoKICAvKioKICAg
IERldGVybWluZXMgaWYgdGhlIHZpZXcgaGFzIGFscmVhZHkgYmVlbiBjcmVhdGVkIGJ5IGNoZWNr
aW5nIGlmCiAgICB0aGUgdmlldyBoYXMgdGhlIHNhbWUgY29uc3RydWN0b3IsIHRlbXBsYXRlLCBh
bmQgY29udGV4dCBhcyB0aGUKICAgIHZpZXcgaW4gdGhlIGBfb3V0bGV0c2Agb2JqZWN0LgoKICAg
IEBwcml2YXRlCiAgICBAbWV0aG9kIF9oYXNFcXVpdmFsZW50VmlldwogICAgQHBhcmFtICB7U3Ry
aW5nfSBvdXRsZXROYW1lIFRoZSBuYW1lIG9mIHRoZSBvdXRsZXQgd2UgYXJlIGNoZWNraW5nCiAg
ICBAcGFyYW0gIHtPYmplY3R9IHZpZXcgICAgICAgQW4gRW1iZXIuVmlldwogICAgQHJldHVybiB7
Qm9vbGVhbn0KICAgKi8KICBfaGFzRXF1aXZhbGVudFZpZXc6IGZ1bmN0aW9uKG91dGxldE5hbWUs
IHZpZXcpIHsKICAgIHZhciBleGlzdGluZ1ZpZXcgPSBnZXQodGhpcywgJ19vdXRsZXRzLicrb3V0
bGV0TmFtZSk7CiAgICByZXR1cm4gZXhpc3RpbmdWaWV3ICYmCiAgICAgIGV4aXN0aW5nVmlldy5j
b25zdHJ1Y3RvciA9PT0gdmlldy5jb25zdHJ1Y3RvciAmJgogICAgICBleGlzdGluZ1ZpZXcuZ2V0
KCd0ZW1wbGF0ZScpID09PSB2aWV3LmdldCgndGVtcGxhdGUnKSAmJgogICAgICBleGlzdGluZ1Zp
ZXcuZ2V0KCdjb250ZXh0JykgPT09IHZpZXcuZ2V0KCdjb250ZXh0Jyk7CiAgfSwKCiAgLyoqCiAg
ICBSZW1vdmVzIGFuIG91dGxldCBmcm9tIHRoZSB2aWV3LgoKICAgIEV4YW1wbGUKCiAgICBgYGBq
YXZhc2NyaXB0CiAgICB2YXIgTXlWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoewogICAgICB0ZW1w
bGF0ZTogRW1iZXIuSGFuZGxlYmFycy5jb21waWxlKCdDaGlsZCB2aWV3OiB7e291dGxldCAibWFp
biJ9fSAnKQogICAgfSk7CiAgICB2YXIgbXlWaWV3ID0gTXlWaWV3LmNyZWF0ZSgpOwogICAgbXlW
aWV3LmFwcGVuZFRvKCdib2R5Jyk7CiAgICAvLyBteVZpZXcncyBodG1sOgogICAgLy8gPGRpdiBp
ZD0iZW1iZXIyMjgiIGNsYXNzPSJlbWJlci12aWV3Ij5DaGlsZCB2aWV3OiA8L2Rpdj4KCiAgICB2
YXIgRm9vVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHsKICAgICAgdGVtcGxhdGU6IEVtYmVyLkhh
bmRsZWJhcnMuY29tcGlsZSgnPGgxPkZvbzwvaDE+ICcpCiAgICB9KTsKICAgIHZhciBmb29WaWV3
ID0gRm9vVmlldy5jcmVhdGUoKTsKICAgIG15Vmlldy5jb25uZWN0T3V0bGV0KCdtYWluJywgZm9v
Vmlldyk7CiAgICAvLyBteVZpZXcncyBodG1sOgogICAgLy8gPGRpdiBpZD0iZW1iZXIyMjgiIGNs
YXNzPSJlbWJlci12aWV3Ij5DaGlsZCB2aWV3OgogICAgLy8gICA8ZGl2IGlkPSJlbWJlcjIzNCIg
Y2xhc3M9ImVtYmVyLXZpZXciPjxoMT5Gb288L2gxPiA8L2Rpdj4KICAgIC8vIDwvZGl2PgoKICAg
IG15Vmlldy5kaXNjb25uZWN0T3V0bGV0KCdtYWluJyk7CiAgICAvLyBteVZpZXcncyBodG1sOgog
ICAgLy8gPGRpdiBpZD0iZW1iZXIyMjgiIGNsYXNzPSJlbWJlci12aWV3Ij5DaGlsZCB2aWV3OiA8
L2Rpdj4KICAgIGBgYAoKICAgIEBtZXRob2QgZGlzY29ubmVjdE91dGxldAogICAgQHBhcmFtICB7
U3RyaW5nfSBvdXRsZXROYW1lIFRoZSBuYW1lIG9mIHRoZSBvdXRsZXQgdG8gYmUgcmVtb3ZlZAog
ICAqLwogIGRpc2Nvbm5lY3RPdXRsZXQ6IGZ1bmN0aW9uKG91dGxldE5hbWUpIHsKICAgIGlmICgh
dGhpcy5fcGVuZGluZ0Rpc2Nvbm5lY3Rpb25zKSB7CiAgICAgIHRoaXMuX3BlbmRpbmdEaXNjb25u
ZWN0aW9ucyA9IHt9OwogICAgfQogICAgdGhpcy5fcGVuZGluZ0Rpc2Nvbm5lY3Rpb25zW291dGxl
dE5hbWVdID0gdHJ1ZTsKICAgIEVtYmVyLnJ1bi5vbmNlKHRoaXMsICdfZmluaXNoRGlzY29ubmVj
dGlvbnMnKTsKICB9LAoKICAvKioKICAgIEdldHMgYW4gb3V0bGV0IHRoYXQgaXMgcGVuZGluZyBk
aXNjb25uZWN0aW9uIGFuZCB0aGVuCiAgICBudWxsaWZ5cyB0aGUgb2JqZWN0IG9uIHRoZSBgX291
dGxldGAgb2JqZWN0LgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIF9maW5pc2hEaXNjb25uZWN0
aW9ucwogICAqLwogIF9maW5pc2hEaXNjb25uZWN0aW9uczogZnVuY3Rpb24oKSB7CiAgICB2YXIg
b3V0bGV0cyA9IGdldCh0aGlzLCAnX291dGxldHMnKTsKICAgIHZhciBwZW5kaW5nRGlzY29ubmVj
dGlvbnMgPSB0aGlzLl9wZW5kaW5nRGlzY29ubmVjdGlvbnM7CiAgICB0aGlzLl9wZW5kaW5nRGlz
Y29ubmVjdGlvbnMgPSBudWxsOwoKICAgIGZvciAodmFyIG91dGxldE5hbWUgaW4gcGVuZGluZ0Rp
c2Nvbm5lY3Rpb25zKSB7CiAgICAgIHNldChvdXRsZXRzLCBvdXRsZXROYW1lLCBudWxsKTsKICAg
IH0KICB9Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3Vi
bW9kdWxlIGVtYmVyLXZpZXdzCiovCgovLyBBZGQgYSBuZXcgbmFtZWQgcXVldWUgYWZ0ZXIgdGhl
ICdhY3Rpb25zJyBxdWV1ZSAod2hlcmUgUlNWUCBwcm9taXNlcwovLyByZXNvbHZlKSwgd2hpY2gg
aXMgdXNlZCBpbiByb3V0ZXIgdHJhbnNpdGlvbnMgdG8gcHJldmVudCB1bm5lY2Vzc2FyeQovLyBs
b2FkaW5nIHN0YXRlIGVudHJ5IGlmIGFsbCBjb250ZXh0IHByb21pc2VzIHJlc29sdmUgb24gdGhl
IAovLyAnYWN0aW9ucycgcXVldWUgZmlyc3QuCgp2YXIgcXVldWVzID0gRW1iZXIucnVuLnF1ZXVl
cywKICAgIGluZGV4T2YgPSBFbWJlci5BcnJheVBvbHlmaWxscy5pbmRleE9mOwpxdWV1ZXMuc3Bs
aWNlKGluZGV4T2YuY2FsbChxdWV1ZXMsICdhY3Rpb25zJykgKyAxLCAwLCAncm91dGVyVHJhbnNp
dGlvbnMnKTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1v
ZHVsZSBlbWJlci1yb3V0aW5nCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5z
ZXQ7CgovKioKICBFbWJlci5Mb2NhdGlvbiByZXR1cm5zIGFuIGluc3RhbmNlIG9mIHRoZSBjb3Jy
ZWN0IGltcGxlbWVudGF0aW9uIG9mCiAgdGhlIGBsb2NhdGlvbmAgQVBJLgoKICAjIyBJbXBsZW1l
bnRhdGlvbnMKCiAgWW91IGNhbiBwYXNzIGFuIGltcGxlbWVudGF0aW9uIG5hbWUgKGBoYXNoYCwg
YGhpc3RvcnlgLCBgbm9uZWApIHRvIGZvcmNlIGEKICBwYXJ0aWN1bGFyIGltcGxlbWVudGF0aW9u
IHRvIGJlIHVzZWQgaW4geW91ciBhcHBsaWNhdGlvbi4KCiAgIyMjIEhhc2hMb2NhdGlvbgoKICBV
c2luZyBgSGFzaExvY2F0aW9uYCByZXN1bHRzIGluIFVSTHMgd2l0aCBhIGAjYCAoaGFzaCBzaWdu
KSBzZXBhcmF0aW5nIHRoZQogIHNlcnZlciBzaWRlIFVSTCBwb3J0aW9uIG9mIHRoZSBVUkwgZnJv
bSB0aGUgcG9ydGlvbiB0aGF0IGlzIHVzZWQgYnkgRW1iZXIuCiAgVGhpcyByZWxpZXMgdXBvbiB0
aGUgYGhhc2hjaGFuZ2VgIGV2ZW50IGV4aXN0aW5nIGluIHRoZSBicm93c2VyLgoKICBFeGFtcGxl
OgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLlJvdXRlci5tYXAoZnVuY3Rpb24oKSB7CiAgICB0aGlz
LnJlc291cmNlKCdwb3N0cycsIGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJvdXRlKCduZXcnKTsK
ICAgIH0pOwogIH0pOwoKICBBcHAuUm91dGVyLnJlb3Blbih7CiAgICBsb2NhdGlvbjogJ2hhc2gn
CiAgfSk7CiAgYGBgCgogIFRoaXMgd2lsbCByZXN1bHQgaW4gYSBwb3N0cy5uZXcgdXJsIG9mIGAv
Iy9wb3N0cy9uZXdgLgoKICAjIyMgSGlzdG9yeUxvY2F0aW9uCgogIFVzaW5nIGBIaXN0b3J5TG9j
YXRpb25gIHJlc3VsdHMgaW4gVVJMcyB0aGF0IGFyZSBpbmRpc3Rpbmd1aXNoYWJsZSBmcm9tIGEK
ICBzdGFuZGFyZCBVUkwuIFRoaXMgcmVsaWVzIHVwb24gdGhlIGJyb3dzZXIncyBgaGlzdG9yeWAg
QVBJLgoKICBFeGFtcGxlOgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwLlJvdXRlci5tYXAoZnVuY3Rp
b24oKSB7CiAgICB0aGlzLnJlc291cmNlKCdwb3N0cycsIGZ1bmN0aW9uKCkgewogICAgICB0aGlz
LnJvdXRlKCduZXcnKTsKICAgIH0pOwogIH0pOwoKICBBcHAuUm91dGVyLnJlb3Blbih7CiAgICBs
b2NhdGlvbjogJ2hpc3RvcnknCiAgfSk7CiAgYGBgCgogIFRoaXMgd2lsbCByZXN1bHQgaW4gYSBw
b3N0cy5uZXcgdXJsIG9mIGAvcG9zdHMvbmV3YC4KCiAgIyMjIE5vbmVMb2NhdGlvbgoKICBVc2lu
ZyBgTm9uZUxvY2F0aW9uYCBjYXVzZXMgRW1iZXIgdG8gbm90IHN0b3JlIHRoZSBhcHBsaWNhdGlv
bnMgVVJMIHN0YXRlCiAgaW4gdGhlIGFjdHVhbCBVUkwuIFRoaXMgaXMgZ2VuZXJhbGx5IHVzZWQg
Zm9yIHRlc3RpbmcgcHVycG9zZXMsIGFuZCBpcyBvbmUKICBvZiB0aGUgY2hhbmdlcyBtYWRlIHdo
ZW4gY2FsbGluZyBgQXBwLnNldHVwRm9yVGVzdGluZygpYC4KCiAgIyMgTG9jYXRpb24gQVBJCgog
IEVhY2ggbG9jYXRpb24gaW1wbGVtZW50YXRpb24gbXVzdCBwcm92aWRlIHRoZSBmb2xsb3dpbmcg
bWV0aG9kczoKCiAgKiBpbXBsZW1lbnRhdGlvbjogcmV0dXJucyB0aGUgc3RyaW5nIG5hbWUgdXNl
ZCB0byByZWZlcmVuY2UgdGhlIGltcGxlbWVudGF0aW9uLgogICogZ2V0VVJMOiByZXR1cm5zIHRo
ZSBjdXJyZW50IFVSTC4KICAqIHNldFVSTChwYXRoKTogc2V0cyB0aGUgY3VycmVudCBVUkwuCiAg
KiByZXBsYWNlVVJMKHBhdGgpOiByZXBsYWNlIHRoZSBjdXJyZW50IFVSTCAob3B0aW9uYWwpLgog
ICogb25VcGRhdGVVUkwoY2FsbGJhY2spOiB0cmlnZ2VycyB0aGUgY2FsbGJhY2sgd2hlbiB0aGUg
VVJMIGNoYW5nZXMuCiAgKiBmb3JtYXRVUkwodXJsKTogZm9ybWF0cyBgdXJsYCB0byBiZSBwbGFj
ZWQgaW50byBgaHJlZmAgYXR0cmlidXRlLgoKICBDYWxsaW5nIHNldFVSTCBvciByZXBsYWNlVVJM
IHdpbGwgbm90IHRyaWdnZXIgb25VcGRhdGVVUkwgY2FsbGJhY2tzLgoKICBAY2xhc3MgTG9jYXRp
b24KICBAbmFtZXNwYWNlIEVtYmVyCiAgQHN0YXRpYwoqLwpFbWJlci5Mb2NhdGlvbiA9IHsKICAv
KioKICAgVGhpcyBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHVzaW5nIHRoZSBjb250YWluZXIg
dG8gbG9va3VwIHRoZSBsb2NhdGlvbgogICBpbXBsZW1lbnRhdGlvbiBhcyBkZXNpcmVkLgoKICAg
Rm9yIGV4YW1wbGU6CgogICBgYGBqYXZhc2NyaXB0CiAgIC8vIEdpdmVuIGEgbG9jYXRpb24gcmVn
aXN0ZXJlZCBhcyBmb2xsb3dzOgogICBjb250YWluZXIucmVnaXN0ZXIoJ2xvY2F0aW9uOmhpc3Rv
cnktdGVzdCcsIEhpc3RvcnlUZXN0TG9jYXRpb24pOwoKICAgLy8gWW91IGNvdWxkIGNyZWF0ZSBh
IG5ldyBpbnN0YW5jZSB2aWE6CiAgIGNvbnRhaW5lci5sb29rdXAoJ2xvY2F0aW9uOmhpc3Rvcnkt
dGVzdCcpOwogICBgYGAKCiAgICBAbWV0aG9kIGNyZWF0ZQogICAgQHBhcmFtIHtPYmplY3R9IG9w
dGlvbnMKICAgIEByZXR1cm4ge09iamVjdH0gYW4gaW5zdGFuY2Ugb2YgYW4gaW1wbGVtZW50YXRp
b24gb2YgdGhlIGBsb2NhdGlvbmAgQVBJCiAgICBAZGVwcmVjYXRlZCBVc2UgdGhlIGNvbnRhaW5l
ciB0byBsb29rdXAgdGhlIGxvY2F0aW9uIGltcGxlbWVudGF0aW9uIHRoYXQgeW91CiAgICBuZWVk
LgogICovCiAgY3JlYXRlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB2YXIgaW1wbGVtZW50YXRp
b24gPSBvcHRpb25zICYmIG9wdGlvbnMuaW1wbGVtZW50YXRpb247CiAgICBFbWJlci5hc3NlcnQo
IkVtYmVyLkxvY2F0aW9uLmNyZWF0ZTogeW91IG11c3Qgc3BlY2lmeSBhICdpbXBsZW1lbnRhdGlv
bicgb3B0aW9uIiwgISFpbXBsZW1lbnRhdGlvbik7CgogICAgdmFyIGltcGxlbWVudGF0aW9uQ2xh
c3MgPSB0aGlzLmltcGxlbWVudGF0aW9uc1tpbXBsZW1lbnRhdGlvbl07CiAgICBFbWJlci5hc3Nl
cnQoIkVtYmVyLkxvY2F0aW9uLmNyZWF0ZTogIiArIGltcGxlbWVudGF0aW9uICsgIiBpcyBub3Qg
YSB2YWxpZCBpbXBsZW1lbnRhdGlvbiIsICEhaW1wbGVtZW50YXRpb25DbGFzcyk7CgogICAgcmV0
dXJuIGltcGxlbWVudGF0aW9uQ2xhc3MuY3JlYXRlLmFwcGx5KGltcGxlbWVudGF0aW9uQ2xhc3Ms
IGFyZ3VtZW50cyk7CiAgfSwKCiAgLyoqCiAgIFRoaXMgaXMgZGVwcmVjYXRlZCBpbiBmYXZvciBv
ZiB1c2luZyB0aGUgY29udGFpbmVyIHRvIHJlZ2lzdGVyIHRoZQogICBsb2NhdGlvbiBpbXBsZW1l
bnRhdGlvbiBhcyBkZXNpcmVkLgoKICAgRXhhbXBsZToKCiAgIGBgYGphdmFzY3JpcHQKICAgQXBw
bGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAgbmFtZTogImhpc3RvcnktdGVzdC1sb2NhdGlvbiIs
CgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29udGFpbmVyLCBhcHBsaWNhdGlvbikgewogICAg
ICBhcHBsaWNhdGlvbi5yZWdpc3RlcignbG9jYXRpb246aGlzdG9yeS10ZXN0JywgSGlzdG9yeVRl
c3RMb2NhdGlvbik7CiAgICB9CiAgIH0pOwogICBgYGAKCiAgIEBtZXRob2QgcmVnaXN0ZXJJbXBs
ZW1lbnRhdGlvbgogICBAcGFyYW0ge1N0cmluZ30gbmFtZQogICBAcGFyYW0ge09iamVjdH0gaW1w
bGVtZW50YXRpb24gb2YgdGhlIGBsb2NhdGlvbmAgQVBJCiAgIEBkZXByZWNhdGVkIFJlZ2lzdGVy
IHlvdXIgY3VzdG9tIGxvY2F0aW9uIGltcGxlbWVudGF0aW9uIHdpdGggdGhlCiAgIGNvbnRhaW5l
ciBkaXJlY3RseS4KICAqLwogIHJlZ2lzdGVySW1wbGVtZW50YXRpb246IGZ1bmN0aW9uKG5hbWUs
IGltcGxlbWVudGF0aW9uKSB7CiAgICB0aGlzLmltcGxlbWVudGF0aW9uc1tuYW1lXSA9IGltcGxl
bWVudGF0aW9uOwogIH0sCgogIGltcGxlbWVudGF0aW9uczoge30KfTsKCn0pKCk7CgoKCihmdW5j
dGlvbigpIHsKLyoqCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1yb3V0aW5nCiovCgp2
YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CgovKioKICBFbWJlci5Ob25lTG9j
YXRpb24gZG9lcyBub3QgaW50ZXJhY3Qgd2l0aCB0aGUgYnJvd3Nlci4gSXQgaXMgdXNlZnVsIGZv
cgogIHRlc3RpbmcsIG9yIHdoZW4geW91IG5lZWQgdG8gbWFuYWdlIHN0YXRlIHdpdGggeW91ciBS
b3V0ZXIsIGJ1dCB0ZW1wb3JhcmlseQogIGRvbid0IHdhbnQgaXQgdG8gbXVjayB3aXRoIHRoZSBV
UkwgKGZvciBleGFtcGxlIHdoZW4geW91IGVtYmVkIHlvdXIKICBhcHBsaWNhdGlvbiBpbiBhIGxh
cmdlciBwYWdlKS4KCiAgQGNsYXNzIE5vbmVMb2NhdGlvbgogIEBuYW1lc3BhY2UgRW1iZXIKICBA
ZXh0ZW5kcyBFbWJlci5PYmplY3QKKi8KRW1iZXIuTm9uZUxvY2F0aW9uID0gRW1iZXIuT2JqZWN0
LmV4dGVuZCh7CiAgcGF0aDogJycsCgogIC8qKgogICAgUmV0dXJucyB0aGUgY3VycmVudCBwYXRo
LgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGdldFVSTAogICAgQHJldHVybiB7U3RyaW5nfSBw
YXRoCiAgKi8KICBnZXRVUkw6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGdldCh0aGlzLCAncGF0
aCcpOwogIH0sCgogIC8qKgogICAgU2V0IHRoZSBwYXRoIGFuZCByZW1lbWJlcnMgd2hhdCB3YXMg
c2V0LiBVc2luZyB0aGlzIG1ldGhvZAogICAgdG8gY2hhbmdlIHRoZSBwYXRoIHdpbGwgbm90IGlu
dm9rZSB0aGUgYHVwZGF0ZVVSTGAgY2FsbGJhY2suCgogICAgQHByaXZhdGUKICAgIEBtZXRob2Qg
c2V0VVJMCiAgICBAcGFyYW0gcGF0aCB7U3RyaW5nfQogICovCiAgc2V0VVJMOiBmdW5jdGlvbihw
YXRoKSB7CiAgICBzZXQodGhpcywgJ3BhdGgnLCBwYXRoKTsKICB9LAoKICAvKioKICAgIFJlZ2lz
dGVyIGEgY2FsbGJhY2sgdG8gYmUgaW52b2tlZCB3aGVuIHRoZSBwYXRoIGNoYW5nZXMuIFRoZXNl
CiAgICBjYWxsYmFja3Mgd2lsbCBleGVjdXRlIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyB0aGUgYmFj
ayBvciBmb3J3YXJkCiAgICBidXR0b24sIGJ1dCBub3QgYWZ0ZXIgYHNldFVSTGAgaXMgaW52b2tl
ZC4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBvblVwZGF0ZVVSTAogICAgQHBhcmFtIGNhbGxi
YWNrIHtGdW5jdGlvbn0KICAqLwogIG9uVXBkYXRlVVJMOiBmdW5jdGlvbihjYWxsYmFjaykgewog
ICAgdGhpcy51cGRhdGVDYWxsYmFjayA9IGNhbGxiYWNrOwogIH0sCgogIC8qKgogICAgU2V0cyB0
aGUgcGF0aCBhbmQgY2FsbHMgdGhlIGB1cGRhdGVVUkxgIGNhbGxiYWNrLgoKICAgIEBwcml2YXRl
CiAgICBAbWV0aG9kIGhhbmRsZVVSTAogICAgQHBhcmFtIGNhbGxiYWNrIHtGdW5jdGlvbn0KICAq
LwogIGhhbmRsZVVSTDogZnVuY3Rpb24odXJsKSB7CiAgICBzZXQodGhpcywgJ3BhdGgnLCB1cmwp
OwogICAgdGhpcy51cGRhdGVDYWxsYmFjayh1cmwpOwogIH0sCgogIC8qKgogICAgR2l2ZW4gYSBV
UkwsIGZvcm1hdHMgaXQgdG8gYmUgcGxhY2VkIGludG8gdGhlIHBhZ2UgYXMgcGFydAogICAgb2Yg
YW4gZWxlbWVudCdzIGBocmVmYCBhdHRyaWJ1dGUuCgogICAgVGhpcyBpcyB1c2VkLCBmb3IgZXhh
bXBsZSwgd2hlbiB1c2luZyB0aGUge3thY3Rpb259fSBoZWxwZXIKICAgIHRvIGdlbmVyYXRlIGEg
VVJMIGJhc2VkIG9uIGFuIGV2ZW50LgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGZvcm1hdFVS
TAogICAgQHBhcmFtIHVybCB7U3RyaW5nfQogICAgQHJldHVybiB7U3RyaW5nfSB1cmwKICAqLwog
IGZvcm1hdFVSTDogZnVuY3Rpb24odXJsKSB7CiAgICAvLyBUaGUgcmV0dXJuIHZhbHVlIGlzIG5v
dCBvdmVybHkgbWVhbmluZ2Z1bCwgYnV0IHdlIGRvIG5vdCB3YW50IHRvIHRocm93CiAgICAvLyBl
cnJvcnMgd2hlbiB0ZXN0IGNvZGUgcmVuZGVycyB0ZW1wbGF0ZXMgY29udGFpbmluZyB7e2FjdGlv
biBocmVmPXRydWV9fQogICAgLy8gaGVscGVycy4KICAgIHJldHVybiB1cmw7CiAgfQp9KTsKCkVt
YmVyLkxvY2F0aW9uLnJlZ2lzdGVySW1wbGVtZW50YXRpb24oJ25vbmUnLCBFbWJlci5Ob25lTG9j
YXRpb24pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9k
dWxlIGVtYmVyLXJvdXRpbmcKKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNl
dDsKCi8qKgogIGBFbWJlci5IYXNoTG9jYXRpb25gIGltcGxlbWVudHMgdGhlIGxvY2F0aW9uIEFQ
SSB1c2luZyB0aGUgYnJvd3NlcidzCiAgaGFzaC4gQXQgcHJlc2VudCwgaXQgcmVsaWVzIG9uIGEg
YGhhc2hjaGFuZ2VgIGV2ZW50IGV4aXN0aW5nIGluIHRoZQogIGJyb3dzZXIuCgogIEBjbGFzcyBI
YXNoTG9jYXRpb24KICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0Ciov
CkVtYmVyLkhhc2hMb2NhdGlvbiA9IEVtYmVyLk9iamVjdC5leHRlbmQoewoKICBpbml0OiBmdW5j
dGlvbigpIHsKICAgIHNldCh0aGlzLCAnbG9jYXRpb24nLCBnZXQodGhpcywgJ2xvY2F0aW9uJykg
fHwgd2luZG93LmxvY2F0aW9uKTsKICB9LAoKICAvKioKICAgIFJldHVybnMgdGhlIGN1cnJlbnQg
YGxvY2F0aW9uLmhhc2hgLCBtaW51cyB0aGUgJyMnIGF0IHRoZSBmcm9udC4KCiAgICBAcHJpdmF0
ZQogICAgQG1ldGhvZCBnZXRVUkwKICAqLwogIGdldFVSTDogZnVuY3Rpb24oKSB7CiAgICAgICAg
Ly8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiB3aXRob3V0IGZlYXR1cmUgZmxhZyBlbmFibGVkCiAg
ICByZXR1cm4gZ2V0KHRoaXMsICdsb2NhdGlvbicpLmhhc2guc3Vic3RyKDEpOwogIH0sCgogIC8q
KgogICAgU2V0IHRoZSBgbG9jYXRpb24uaGFzaGAgYW5kIHJlbWVtYmVycyB3aGF0IHdhcyBzZXQu
IFRoaXMgcHJldmVudHMKICAgIGBvblVwZGF0ZVVSTGAgY2FsbGJhY2tzIGZyb20gdHJpZ2dlcmlu
ZyB3aGVuIHRoZSBoYXNoIHdhcyBzZXQgYnkKICAgIGBIYXNoTG9jYXRpb25gLgoKICAgIEBwcml2
YXRlCiAgICBAbWV0aG9kIHNldFVSTAogICAgQHBhcmFtIHBhdGgge1N0cmluZ30KICAqLwogIHNl
dFVSTDogZnVuY3Rpb24ocGF0aCkgewogICAgZ2V0KHRoaXMsICdsb2NhdGlvbicpLmhhc2ggPSBw
YXRoOwogICAgc2V0KHRoaXMsICdsYXN0U2V0VVJMJywgcGF0aCk7CiAgfSwKCiAgLyoqCiAgICBV
c2VzIGxvY2F0aW9uLnJlcGxhY2UgdG8gdXBkYXRlIHRoZSB1cmwgd2l0aG91dCBhIHBhZ2UgcmVs
b2FkCiAgICBvciBoaXN0b3J5IG1vZGlmaWNhdGlvbi4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhv
ZCByZXBsYWNlVVJMCiAgICBAcGFyYW0gcGF0aCB7U3RyaW5nfQogICovCiAgcmVwbGFjZVVSTDog
ZnVuY3Rpb24ocGF0aCkgewogICAgZ2V0KHRoaXMsICdsb2NhdGlvbicpLnJlcGxhY2UoJyMnICsg
cGF0aCk7CiAgfSwKCiAgLyoqCiAgICBSZWdpc3RlciBhIGNhbGxiYWNrIHRvIGJlIGludm9rZWQg
d2hlbiB0aGUgaGFzaCBjaGFuZ2VzLiBUaGVzZQogICAgY2FsbGJhY2tzIHdpbGwgZXhlY3V0ZSB3
aGVuIHRoZSB1c2VyIHByZXNzZXMgdGhlIGJhY2sgb3IgZm9yd2FyZAogICAgYnV0dG9uLCBidXQg
bm90IGFmdGVyIGBzZXRVUkxgIGlzIGludm9rZWQuCgogICAgQHByaXZhdGUKICAgIEBtZXRob2Qg
b25VcGRhdGVVUkwKICAgIEBwYXJhbSBjYWxsYmFjayB7RnVuY3Rpb259CiAgKi8KICBvblVwZGF0
ZVVSTDogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBn
dWlkID0gRW1iZXIuZ3VpZEZvcih0aGlzKTsKCiAgICBFbWJlci4kKHdpbmRvdykub24oJ2hhc2hj
aGFuZ2UuZW1iZXItbG9jYXRpb24tJytndWlkLCBmdW5jdGlvbigpIHsKICAgICAgRW1iZXIucnVu
KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwYXRoID0gbG9jYXRpb24uaGFzaC5zdWJzdHIoMSk7
CiAgICAgICAgaWYgKGdldChzZWxmLCAnbGFzdFNldFVSTCcpID09PSBwYXRoKSB7IHJldHVybjsg
fQoKICAgICAgICBzZXQoc2VsZiwgJ2xhc3RTZXRVUkwnLCBudWxsKTsKCiAgICAgICAgY2FsbGJh
Y2socGF0aCk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKCiAgLyoqCiAgICBHaXZlbiBhIFVSTCwg
Zm9ybWF0cyBpdCB0byBiZSBwbGFjZWQgaW50byB0aGUgcGFnZSBhcyBwYXJ0CiAgICBvZiBhbiBl
bGVtZW50J3MgYGhyZWZgIGF0dHJpYnV0ZS4KCiAgICBUaGlzIGlzIHVzZWQsIGZvciBleGFtcGxl
LCB3aGVuIHVzaW5nIHRoZSB7e2FjdGlvbn19IGhlbHBlcgogICAgdG8gZ2VuZXJhdGUgYSBVUkwg
YmFzZWQgb24gYW4gZXZlbnQuCgogICAgQHByaXZhdGUKICAgIEBtZXRob2QgZm9ybWF0VVJMCiAg
ICBAcGFyYW0gdXJsIHtTdHJpbmd9CiAgKi8KICBmb3JtYXRVUkw6IGZ1bmN0aW9uKHVybCkgewog
ICAgcmV0dXJuICcjJyt1cmw7CiAgfSwKCiAgLyoqCiAgICBDbGVhbnMgdXAgdGhlIEhhc2hMb2Nh
dGlvbiBldmVudCBsaXN0ZW5lci4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCB3aWxsRGVzdHJv
eQogICovCiAgd2lsbERlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgdmFyIGd1aWQgPSBFbWJlci5n
dWlkRm9yKHRoaXMpOwoKICAgIEVtYmVyLiQod2luZG93KS5vZmYoJ2hhc2hjaGFuZ2UuZW1iZXIt
bG9jYXRpb24tJytndWlkKTsKICB9Cn0pOwoKRW1iZXIuTG9jYXRpb24ucmVnaXN0ZXJJbXBsZW1l
bnRhdGlvbignaGFzaCcsIEVtYmVyLkhhc2hMb2NhdGlvbik7Cgp9KSgpOwoKCgooZnVuY3Rpb24o
KSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItcm91dGluZwoqLwoKdmFyIGdl
dCA9IEVtYmVyLmdldCwgc2V0ID0gRW1iZXIuc2V0Owp2YXIgcG9wc3RhdGVGaXJlZCA9IGZhbHNl
Owp2YXIgc3VwcG9ydHNIaXN0b3J5U3RhdGUgPSB3aW5kb3cuaGlzdG9yeSAmJiAnc3RhdGUnIGlu
IHdpbmRvdy5oaXN0b3J5OwoKLyoqCiAgRW1iZXIuSGlzdG9yeUxvY2F0aW9uIGltcGxlbWVudHMg
dGhlIGxvY2F0aW9uIEFQSSB1c2luZyB0aGUgYnJvd3NlcidzCiAgaGlzdG9yeS5wdXNoU3RhdGUg
QVBJLgoKICBAY2xhc3MgSGlzdG9yeUxvY2F0aW9uCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRl
bmRzIEVtYmVyLk9iamVjdAoqLwpFbWJlci5IaXN0b3J5TG9jYXRpb24gPSBFbWJlci5PYmplY3Qu
ZXh0ZW5kKHsKCiAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICBzZXQodGhpcywgJ2xvY2F0aW9uJywg
Z2V0KHRoaXMsICdsb2NhdGlvbicpIHx8IHdpbmRvdy5sb2NhdGlvbik7CiAgfSwKCiAgLyoqCiAg
ICBVc2VkIHRvIHNldCBzdGF0ZSBvbiBmaXJzdCBjYWxsIHRvIHNldFVSTAoKICAgIEBwcml2YXRl
CiAgICBAbWV0aG9kIGluaXRTdGF0ZQogICovCiAgaW5pdFN0YXRlOiBmdW5jdGlvbigpIHsKICAg
IHNldCh0aGlzLCAnaGlzdG9yeScsIGdldCh0aGlzLCAnaGlzdG9yeScpIHx8IHdpbmRvdy5oaXN0
b3J5KTsKICAgIHRoaXMucmVwbGFjZVN0YXRlKHRoaXMuZm9ybWF0VVJMKHRoaXMuZ2V0VVJMKCkp
KTsKICB9LAoKICAvKioKICAgIFdpbGwgYmUgcHJlLXBlbmRlZCB0byBwYXRoIHVwb24gc3RhdGUg
Y2hhbmdlCgogICAgQHByb3BlcnR5IHJvb3RVUkwKICAgIEBkZWZhdWx0ICcvJwogICovCiAgcm9v
dFVSTDogJy8nLAoKICAvKioKICAgIFJldHVybnMgdGhlIGN1cnJlbnQgYGxvY2F0aW9uLnBhdGhu
YW1lYCB3aXRob3V0IGByb290VVJMYC4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBnZXRVUkwK
ICAgIEByZXR1cm4gdXJsIHtTdHJpbmd9CiAgKi8KICBnZXRVUkw6IGZ1bmN0aW9uKCkgewogICAg
dmFyIHJvb3RVUkwgPSBnZXQodGhpcywgJ3Jvb3RVUkwnKSwKICAgICAgICBsb2NhdGlvbiA9IGdl
dCh0aGlzLCAnbG9jYXRpb24nKSwKICAgICAgICBwYXRoID0gbG9jYXRpb24ucGF0aG5hbWU7Cgog
ICAgcm9vdFVSTCA9IHJvb3RVUkwucmVwbGFjZSgvXC8kLywgJycpOwogICAgdmFyIHVybCA9IHBh
dGgucmVwbGFjZShyb290VVJMLCAnJyk7CgogICAgCiAgICByZXR1cm4gdXJsOwogIH0sCgogIC8q
KgogICAgVXNlcyBgaGlzdG9yeS5wdXNoU3RhdGVgIHRvIHVwZGF0ZSB0aGUgdXJsIHdpdGhvdXQg
YSBwYWdlIHJlbG9hZC4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBzZXRVUkwKICAgIEBwYXJh
bSBwYXRoIHtTdHJpbmd9CiAgKi8KICBzZXRVUkw6IGZ1bmN0aW9uKHBhdGgpIHsKICAgIHZhciBz
dGF0ZSA9IHRoaXMuZ2V0U3RhdGUoKTsKICAgIHBhdGggPSB0aGlzLmZvcm1hdFVSTChwYXRoKTsK
CiAgICBpZiAoc3RhdGUgJiYgc3RhdGUucGF0aCAhPT0gcGF0aCkgewogICAgICB0aGlzLnB1c2hT
dGF0ZShwYXRoKTsKICAgIH0KICB9LAoKICAvKioKICAgIFVzZXMgYGhpc3RvcnkucmVwbGFjZVN0
YXRlYCB0byB1cGRhdGUgdGhlIHVybCB3aXRob3V0IGEgcGFnZSByZWxvYWQKICAgIG9yIGhpc3Rv
cnkgbW9kaWZpY2F0aW9uLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIHJlcGxhY2VVUkwKICAg
IEBwYXJhbSBwYXRoIHtTdHJpbmd9CiAgKi8KICByZXBsYWNlVVJMOiBmdW5jdGlvbihwYXRoKSB7
CiAgICB2YXIgc3RhdGUgPSB0aGlzLmdldFN0YXRlKCk7CiAgICBwYXRoID0gdGhpcy5mb3JtYXRV
UkwocGF0aCk7CgogICAgaWYgKHN0YXRlICYmIHN0YXRlLnBhdGggIT09IHBhdGgpIHsKICAgICAg
dGhpcy5yZXBsYWNlU3RhdGUocGF0aCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgIEdldCB0aGUgY3Vy
cmVudCBgaGlzdG9yeS5zdGF0ZWAKICAgUG9seWZpbGwgY2hlY2tzIGZvciBuYXRpdmUgYnJvd3Nl
ciBzdXBwb3J0IGFuZCBmYWxscyBiYWNrIHRvIHJldHJpZXZpbmcKICAgZnJvbSBhIHByaXZhdGUg
X2hpc3RvcnlTdGF0ZSB2YXJpYWJsZQoKICAgQHByaXZhdGUKICAgQG1ldGhvZCBnZXRTdGF0ZQog
ICBAcmV0dXJuIHN0YXRlIHtPYmplY3R9CiAgKi8KICBnZXRTdGF0ZTogZnVuY3Rpb24oKSB7CiAg
ICByZXR1cm4gc3VwcG9ydHNIaXN0b3J5U3RhdGUgPyBnZXQodGhpcywgJ2hpc3RvcnknKS5zdGF0
ZSA6IHRoaXMuX2hpc3RvcnlTdGF0ZTsKICB9LAoKICAvKioKICAgUHVzaGVzIGEgbmV3IHN0YXRl
LgoKICAgQHByaXZhdGUKICAgQG1ldGhvZCBwdXNoU3RhdGUKICAgQHBhcmFtIHBhdGgge1N0cmlu
Z30KICAqLwogIHB1c2hTdGF0ZTogZnVuY3Rpb24ocGF0aCkgewogICAgdmFyIHN0YXRlID0geyBw
YXRoOiBwYXRoIH07CgogICAgZ2V0KHRoaXMsICdoaXN0b3J5JykucHVzaFN0YXRlKHN0YXRlLCBu
dWxsLCBwYXRoKTsKCiAgICAvLyBzdG9yZSBzdGF0ZSBpZiBicm93c2VyIGRvZXNuJ3Qgc3VwcG9y
dCBgaGlzdG9yeS5zdGF0ZWAKICAgIGlmICghc3VwcG9ydHNIaXN0b3J5U3RhdGUpIHsKICAgICAg
dGhpcy5faGlzdG9yeVN0YXRlID0gc3RhdGU7CiAgICB9CgogICAgLy8gdXNlZCBmb3Igd2Via2l0
IHdvcmthcm91bmQKICAgIHRoaXMuX3ByZXZpb3VzVVJMID0gdGhpcy5nZXRVUkwoKTsKICB9LAoK
ICAvKioKICAgUmVwbGFjZXMgdGhlIGN1cnJlbnQgc3RhdGUuCgogICBAcHJpdmF0ZQogICBAbWV0
aG9kIHJlcGxhY2VTdGF0ZQogICBAcGFyYW0gcGF0aCB7U3RyaW5nfQogICovCiAgcmVwbGFjZVN0
YXRlOiBmdW5jdGlvbihwYXRoKSB7CiAgICB2YXIgc3RhdGUgPSB7IHBhdGg6IHBhdGggfTsKCiAg
ICBnZXQodGhpcywgJ2hpc3RvcnknKS5yZXBsYWNlU3RhdGUoc3RhdGUsIG51bGwsIHBhdGgpOwoK
ICAgIC8vIHN0b3JlIHN0YXRlIGlmIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IGBoaXN0b3J5LnN0
YXRlYAogICAgaWYgKCFzdXBwb3J0c0hpc3RvcnlTdGF0ZSkgewogICAgICB0aGlzLl9oaXN0b3J5
U3RhdGUgPSBzdGF0ZTsKICAgIH0KCiAgICAvLyB1c2VkIGZvciB3ZWJraXQgd29ya2Fyb3VuZAog
ICAgdGhpcy5fcHJldmlvdXNVUkwgPSB0aGlzLmdldFVSTCgpOwogIH0sCgogIC8qKgogICAgUmVn
aXN0ZXIgYSBjYWxsYmFjayB0byBiZSBpbnZva2VkIHdoZW5ldmVyIHRoZSBicm93c2VyCiAgICBo
aXN0b3J5IGNoYW5nZXMsIGluY2x1ZGluZyB1c2luZyBmb3J3YXJkIGFuZCBiYWNrIGJ1dHRvbnMu
CgogICAgQHByaXZhdGUKICAgIEBtZXRob2Qgb25VcGRhdGVVUkwKICAgIEBwYXJhbSBjYWxsYmFj
ayB7RnVuY3Rpb259CiAgKi8KICBvblVwZGF0ZVVSTDogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAg
IHZhciBndWlkID0gRW1iZXIuZ3VpZEZvcih0aGlzKSwKICAgICAgICBzZWxmID0gdGhpczsKCiAg
ICBFbWJlci4kKHdpbmRvdykub24oJ3BvcHN0YXRlLmVtYmVyLWxvY2F0aW9uLScrZ3VpZCwgZnVu
Y3Rpb24oZSkgewogICAgICAvLyBJZ25vcmUgaW5pdGlhbCBwYWdlIGxvYWQgcG9wc3RhdGUgZXZl
bnQgaW4gQ2hyb21lCiAgICAgIGlmICghcG9wc3RhdGVGaXJlZCkgewogICAgICAgIHBvcHN0YXRl
RmlyZWQgPSB0cnVlOwogICAgICAgIGlmIChzZWxmLmdldFVSTCgpID09PSBzZWxmLl9wcmV2aW91
c1VSTCkgeyByZXR1cm47IH0KICAgICAgfQogICAgICBjYWxsYmFjayhzZWxmLmdldFVSTCgpKTsK
ICAgIH0pOwogIH0sCgogIC8qKgogICAgVXNlZCB3aGVuIHVzaW5nIGB7e2FjdGlvbn19YCBoZWxw
ZXIuICBUaGUgdXJsIGlzIGFsd2F5cyBhcHBlbmRlZCB0byB0aGUgcm9vdFVSTC4KCiAgICBAcHJp
dmF0ZQogICAgQG1ldGhvZCBmb3JtYXRVUkwKICAgIEBwYXJhbSB1cmwge1N0cmluZ30KICAgIEBy
ZXR1cm4gZm9ybWF0dGVkIHVybCB7U3RyaW5nfQogICovCiAgZm9ybWF0VVJMOiBmdW5jdGlvbih1
cmwpIHsKICAgIHZhciByb290VVJMID0gZ2V0KHRoaXMsICdyb290VVJMJyk7CgogICAgaWYgKHVy
bCAhPT0gJycpIHsKICAgICAgcm9vdFVSTCA9IHJvb3RVUkwucmVwbGFjZSgvXC8kLywgJycpOwog
ICAgfQoKICAgIHJldHVybiByb290VVJMICsgdXJsOwogIH0sCgogIC8qKgogICAgQ2xlYW5zIHVw
IHRoZSBIaXN0b3J5TG9jYXRpb24gZXZlbnQgbGlzdGVuZXIuCgogICAgQHByaXZhdGUKICAgIEBt
ZXRob2Qgd2lsbERlc3Ryb3kKICAqLwogIHdpbGxEZXN0cm95OiBmdW5jdGlvbigpIHsKICAgIHZh
ciBndWlkID0gRW1iZXIuZ3VpZEZvcih0aGlzKTsKCiAgICBFbWJlci4kKHdpbmRvdykub2ZmKCdw
b3BzdGF0ZS5lbWJlci1sb2NhdGlvbi0nK2d1aWQpOwogIH0KfSk7CgpFbWJlci5Mb2NhdGlvbi5y
ZWdpc3RlckltcGxlbWVudGF0aW9uKCdoaXN0b3J5JywgRW1iZXIuSGlzdG9yeUxvY2F0aW9uKTsK
Cn0pKCk7CgoKCihmdW5jdGlvbigpIHsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKLyoqCkVtYmVy
IFJvdXRpbmcKCkBtb2R1bGUgZW1iZXIKQHN1Ym1vZHVsZSBlbWJlci1yb3V0aW5nCkByZXF1aXJl
cyBlbWJlci12aWV3cwoqLwoKfSkoKTsKCihmdW5jdGlvbigpIHsKZnVuY3Rpb24gdmlzaXQodmVy
dGV4LCBmbiwgdmlzaXRlZCwgcGF0aCkgewogIHZhciBuYW1lID0gdmVydGV4Lm5hbWUsCiAgICB2
ZXJ0aWNlcyA9IHZlcnRleC5pbmNvbWluZywKICAgIG5hbWVzID0gdmVydGV4LmluY29taW5nTmFt
ZXMsCiAgICBsZW4gPSBuYW1lcy5sZW5ndGgsCiAgICBpOwogIGlmICghdmlzaXRlZCkgewogICAg
dmlzaXRlZCA9IHt9OwogIH0KICBpZiAoIXBhdGgpIHsKICAgIHBhdGggPSBbXTsKICB9CiAgaWYg
KHZpc2l0ZWQuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgIHJldHVybjsKICB9CiAgcGF0aC5w
dXNoKG5hbWUpOwogIHZpc2l0ZWRbbmFtZV0gPSB0cnVlOwogIGZvciAoaSA9IDA7IGkgPCBsZW47
IGkrKykgewogICAgdmlzaXQodmVydGljZXNbbmFtZXNbaV1dLCBmbiwgdmlzaXRlZCwgcGF0aCk7
CiAgfQogIGZuKHZlcnRleCwgcGF0aCk7CiAgcGF0aC5wb3AoKTsKfQoKZnVuY3Rpb24gREFHKCkg
ewogIHRoaXMubmFtZXMgPSBbXTsKICB0aGlzLnZlcnRpY2VzID0ge307Cn0KCkRBRy5wcm90b3R5
cGUuYWRkID0gZnVuY3Rpb24obmFtZSkgewogIGlmICghbmFtZSkgeyByZXR1cm47IH0KICBpZiAo
dGhpcy52ZXJ0aWNlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgcmV0dXJuIHRoaXMudmVy
dGljZXNbbmFtZV07CiAgfQogIHZhciB2ZXJ0ZXggPSB7CiAgICBuYW1lOiBuYW1lLCBpbmNvbWlu
Zzoge30sIGluY29taW5nTmFtZXM6IFtdLCBoYXNPdXRnb2luZzogZmFsc2UsIHZhbHVlOiBudWxs
CiAgfTsKICB0aGlzLnZlcnRpY2VzW25hbWVdID0gdmVydGV4OwogIHRoaXMubmFtZXMucHVzaChu
YW1lKTsKICByZXR1cm4gdmVydGV4Owp9OwoKREFHLnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbihu
YW1lLCB2YWx1ZSkgewogIHRoaXMuYWRkKG5hbWUpLnZhbHVlID0gdmFsdWU7Cn07CgpEQUcucHJv
dG90eXBlLmFkZEVkZ2UgPSBmdW5jdGlvbihmcm9tTmFtZSwgdG9OYW1lKSB7CiAgaWYgKCFmcm9t
TmFtZSB8fCAhdG9OYW1lIHx8IGZyb21OYW1lID09PSB0b05hbWUpIHsKICAgIHJldHVybjsKICB9
CiAgdmFyIGZyb20gPSB0aGlzLmFkZChmcm9tTmFtZSksIHRvID0gdGhpcy5hZGQodG9OYW1lKTsK
ICBpZiAodG8uaW5jb21pbmcuaGFzT3duUHJvcGVydHkoZnJvbU5hbWUpKSB7CiAgICByZXR1cm47
CiAgfQogIGZ1bmN0aW9uIGNoZWNrQ3ljbGUodmVydGV4LCBwYXRoKSB7CiAgICBpZiAodmVydGV4
Lm5hbWUgPT09IHRvTmFtZSkgewogICAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoImN5Y2xlIGRl
dGVjdGVkOiAiICsgdG9OYW1lICsgIiA8LSAiICsgcGF0aC5qb2luKCIgPC0gIikpOwogICAgfQog
IH0KICB2aXNpdChmcm9tLCBjaGVja0N5Y2xlKTsKICBmcm9tLmhhc091dGdvaW5nID0gdHJ1ZTsK
ICB0by5pbmNvbWluZ1tmcm9tTmFtZV0gPSBmcm9tOwogIHRvLmluY29taW5nTmFtZXMucHVzaChm
cm9tTmFtZSk7Cn07CgpEQUcucHJvdG90eXBlLnRvcHNvcnQgPSBmdW5jdGlvbihmbikgewogIHZh
ciB2aXNpdGVkID0ge30sCiAgICB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsCiAgICBuYW1lcyA9
IHRoaXMubmFtZXMsCiAgICBsZW4gPSBuYW1lcy5sZW5ndGgsCiAgICBpLCB2ZXJ0ZXg7CiAgZm9y
IChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICB2ZXJ0ZXggPSB2ZXJ0aWNlc1tuYW1lc1tpXV07
CiAgICBpZiAoIXZlcnRleC5oYXNPdXRnb2luZykgewogICAgICB2aXNpdCh2ZXJ0ZXgsIGZuLCB2
aXNpdGVkKTsKICAgIH0KICB9Cn07CgpEQUcucHJvdG90eXBlLmFkZEVkZ2VzID0gZnVuY3Rpb24o
bmFtZSwgdmFsdWUsIGJlZm9yZSwgYWZ0ZXIpIHsKICB2YXIgaTsKICB0aGlzLm1hcChuYW1lLCB2
YWx1ZSk7CiAgaWYgKGJlZm9yZSkgewogICAgaWYgKHR5cGVvZiBiZWZvcmUgPT09ICdzdHJpbmcn
KSB7CiAgICAgIHRoaXMuYWRkRWRnZShuYW1lLCBiZWZvcmUpOwogICAgfSBlbHNlIHsKICAgICAg
Zm9yIChpID0gMDsgaSA8IGJlZm9yZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYWRkRWRn
ZShuYW1lLCBiZWZvcmVbaV0pOwogICAgICB9CiAgICB9CiAgfQogIGlmIChhZnRlcikgewogICAg
aWYgKHR5cGVvZiBhZnRlciA9PT0gJ3N0cmluZycpIHsKICAgICAgdGhpcy5hZGRFZGdlKGFmdGVy
LCBuYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBhZnRlci5sZW5ndGg7
IGkrKykgewogICAgICAgIHRoaXMuYWRkRWRnZShhZnRlcltpXSwgbmFtZSk7CiAgICAgIH0KICAg
IH0KICB9Cn07CgpFbWJlci5EQUcgPSBEQUc7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpA
bW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItYXBwbGljYXRpb24KKi8KCnZhciBnZXQgPSBF
bWJlci5nZXQsCiAgICBjbGFzc2lmeSA9IEVtYmVyLlN0cmluZy5jbGFzc2lmeSwKICAgIGNhcGl0
YWxpemUgPSBFbWJlci5TdHJpbmcuY2FwaXRhbGl6ZSwKICAgIGRlY2FtZWxpemUgPSBFbWJlci5T
dHJpbmcuZGVjYW1lbGl6ZTsKCi8qKgogIFRoZSBEZWZhdWx0UmVzb2x2ZXIgZGVmaW5lcyB0aGUg
ZGVmYXVsdCBsb29rdXAgcnVsZXMgdG8gcmVzb2x2ZQogIGNvbnRhaW5lciBsb29rdXBzIGJlZm9y
ZSBjb25zdWx0aW5nIHRoZSBjb250YWluZXIgZm9yIHJlZ2lzdGVyZWQKICBpdGVtczoKCiogdGVt
cGxhdGVzIGFyZSBsb29rZWQgdXAgb24gYEVtYmVyLlRFTVBMQVRFU2AKKiBvdGhlciBuYW1lcyBh
cmUgbG9va2VkIHVwIG9uIHRoZSBhcHBsaWNhdGlvbiBhZnRlciBjb252ZXJ0aW5nCiAgdGhlIG5h
bWUuIEZvciBleGFtcGxlLCBgY29udHJvbGxlcjpwb3N0YCBsb29rcyB1cAogIGBBcHAuUG9zdENv
bnRyb2xsZXJgIGJ5IGRlZmF1bHQuCiogdGhlcmUgYXJlIHNvbWUgbnVhbmNlcyAoc2VlIGV4YW1w
bGVzIGJlbG93KQoKICAjIyMgSG93IFJlc29sdmluZyBXb3JrcwoKICBUaGUgY29udGFpbmVyIGNh
bGxzIHRoaXMgb2JqZWN0J3MgYHJlc29sdmVgIG1ldGhvZCB3aXRoIHRoZQogIGBmdWxsTmFtZWAg
YXJndW1lbnQuCgogIEl0IGZpcnN0IHBhcnNlcyB0aGUgZnVsbE5hbWUgaW50byBhbiBvYmplY3Qg
dXNpbmcgYHBhcnNlTmFtZWAuCgogIFRoZW4gaXQgY2hlY2tzIGZvciB0aGUgcHJlc2VuY2Ugb2Yg
YSB0eXBlLXNwZWNpZmljIGluc3RhbmNlCiAgbWV0aG9kIG9mIHRoZSBmb3JtIGByZXNvbHZlW1R5
cGVdYCBhbmQgY2FsbHMgaXQgaWYgaXQgZXhpc3RzLgogIEZvciBleGFtcGxlIGlmIGl0IHdhcyBy
ZXNvbHZpbmcgJ3RlbXBsYXRlOnBvc3QnLCBpdCB3b3VsZCBjYWxsCiAgdGhlIGByZXNvbHZlVGVt
cGxhdGVgIG1ldGhvZC4KCiAgSXRzIGxhc3QgcmVzb3J0IGlzIHRvIGNhbGwgdGhlIGByZXNvbHZl
T3RoZXJgIG1ldGhvZC4KCiAgVGhlIG1ldGhvZHMgb2YgdGhpcyBvYmplY3QgYXJlIGRlc2lnbmVk
IHRvIGJlIGVhc3kgdG8gb3ZlcnJpZGUKICBpbiBhIHN1YmNsYXNzLiBGb3IgZXhhbXBsZSwgeW91
IGNvdWxkIGVuaGFuY2UgaG93IGEgdGVtcGxhdGUKICBpcyByZXNvbHZlZCBsaWtlIHNvOgoKICBg
YGBqYXZhc2NyaXB0CiAgQXBwID0gRW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKHsKICAgIFJlc29s
dmVyOiBFbWJlci5EZWZhdWx0UmVzb2x2ZXIuZXh0ZW5kKHsKICAgICAgcmVzb2x2ZVRlbXBsYXRl
OiBmdW5jdGlvbihwYXJzZWROYW1lKSB7CiAgICAgICAgdmFyIHJlc29sdmVkVGVtcGxhdGUgPSB0
aGlzLl9zdXBlcihwYXJzZWROYW1lKTsKICAgICAgICBpZiAocmVzb2x2ZWRUZW1wbGF0ZSkgeyBy
ZXR1cm4gcmVzb2x2ZWRUZW1wbGF0ZTsgfQogICAgICAgIHJldHVybiBFbWJlci5URU1QTEFURVNb
J25vdF9mb3VuZCddOwogICAgICB9CiAgICB9KQogIH0pOwogIGBgYAoKICBTb21lIGV4YW1wbGVz
IG9mIGhvdyBuYW1lcyBhcmUgcmVzb2x2ZWQ6CgogIGBgYAogICd0ZW1wbGF0ZTpwb3N0JyAvLz0+
IEVtYmVyLlRFTVBMQVRFU1sncG9zdCddCiAgJ3RlbXBsYXRlOnBvc3RzL2J5bGluZScgLy89PiBF
bWJlci5URU1QTEFURVNbJ3Bvc3RzL2J5bGluZSddCiAgJ3RlbXBsYXRlOnBvc3RzLmJ5bGluZScg
Ly89PiBFbWJlci5URU1QTEFURVNbJ3Bvc3RzL2J5bGluZSddCiAgJ3RlbXBsYXRlOmJsb2dQb3N0
JyAvLz0+IEVtYmVyLlRFTVBMQVRFU1snYmxvZ1Bvc3QnXQogICAgICAgICAgICAgICAgICAgICAg
Ly8gICBPUgogICAgICAgICAgICAgICAgICAgICAgLy8gICBFbWJlci5URU1QTEFURVNbJ2Jsb2df
cG9zdCddCiAgJ2NvbnRyb2xsZXI6cG9zdCcgLy89PiBBcHAuUG9zdENvbnRyb2xsZXIKICAnY29u
dHJvbGxlcjpwb3N0cy5pbmRleCcgLy89PiBBcHAuUG9zdHNJbmRleENvbnRyb2xsZXIKICAnY29u
dHJvbGxlcjpibG9nL3Bvc3QnIC8vPT4gQmxvZy5Qb3N0Q29udHJvbGxlcgogICdjb250cm9sbGVy
OmJhc2ljJyAvLz0+IEVtYmVyLkNvbnRyb2xsZXIKICAncm91dGU6cG9zdCcgLy89PiBBcHAuUG9z
dFJvdXRlCiAgJ3JvdXRlOnBvc3RzLmluZGV4JyAvLz0+IEFwcC5Qb3N0c0luZGV4Um91dGUKICAn
cm91dGU6YmxvZy9wb3N0JyAvLz0+IEJsb2cuUG9zdFJvdXRlCiAgJ3JvdXRlOmJhc2ljJyAvLz0+
IEVtYmVyLlJvdXRlCiAgJ3ZpZXc6cG9zdCcgLy89PiBBcHAuUG9zdFZpZXcKICAndmlldzpwb3N0
cy5pbmRleCcgLy89PiBBcHAuUG9zdHNJbmRleFZpZXcKICAndmlldzpibG9nL3Bvc3QnIC8vPT4g
QmxvZy5Qb3N0VmlldwogICd2aWV3OmJhc2ljJyAvLz0+IEVtYmVyLlZpZXcKICAnZm9vOnBvc3Qn
IC8vPT4gQXBwLlBvc3RGb28KICAnbW9kZWw6cG9zdCcgLy89PiBBcHAuUG9zdAogIGBgYAoKICBA
Y2xhc3MgRGVmYXVsdFJlc29sdmVyCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVy
Lk9iamVjdAoqLwpFbWJlci5EZWZhdWx0UmVzb2x2ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsK
ICAvKioKICAgIFRoaXMgd2lsbCBiZSBzZXQgdG8gdGhlIEFwcGxpY2F0aW9uIGluc3RhbmNlIHdo
ZW4gaXQgaXMKICAgIGNyZWF0ZWQuCgogICAgQHByb3BlcnR5IG5hbWVzcGFjZQogICovCiAgbmFt
ZXNwYWNlOiBudWxsLAoKICBub3JtYWxpemU6IGZ1bmN0aW9uKGZ1bGxOYW1lKSB7CiAgICB2YXIg
c3BsaXQgPSBmdWxsTmFtZS5zcGxpdCgnOicsIDIpLAogICAgICAgIHR5cGUgPSBzcGxpdFswXSwK
ICAgICAgICBuYW1lID0gc3BsaXRbMV07CgogICAgRW1iZXIuYXNzZXJ0KCJUcmllZCB0byBub3Jt
YWxpemUgYSBjb250YWluZXIgbmFtZSB3aXRob3V0IGEgY29sb24gKDopIGluICIgKwogICAgICAg
ICAgICAgICAgICJpdC4gWW91IHByb2JhYmx5IHRyaWVkIHRvIGxvb2t1cCBhIG5hbWUgdGhhdCBk
aWQgbm90IGNvbnRhaW4gIiArCiAgICAgICAgICAgICAgICAgImEgdHlwZSwgYSBjb2xvbiwgYW5k
IGEgbmFtZS4gQSBwcm9wZXIgbG9va3VwIG5hbWUgd291bGQgYmUgIiArCiAgICAgICAgICAgICAg
ICAgImB2aWV3OnBvc3RgLiIsIHNwbGl0Lmxlbmd0aCA9PT0gMik7CgogICAgaWYgKHR5cGUgIT09
ICd0ZW1wbGF0ZScpIHsKICAgICAgdmFyIHJlc3VsdCA9IG5hbWU7CgogICAgICBpZiAocmVzdWx0
LmluZGV4T2YoJy4nKSA+IC0xKSB7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL1wu
KC4pL2csIGZ1bmN0aW9uKG0pIHsgcmV0dXJuIG0uY2hhckF0KDEpLnRvVXBwZXJDYXNlKCk7IH0p
OwogICAgICB9CgogICAgICBpZiAobmFtZS5pbmRleE9mKCdfJykgPiAtMSkgewogICAgICAgIHJl
c3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fKC4pL2csIGZ1bmN0aW9uKG0pIHsgcmV0dXJuIG0uY2hh
ckF0KDEpLnRvVXBwZXJDYXNlKCk7IH0pOwogICAgICB9CgogICAgICByZXR1cm4gdHlwZSArICc6
JyArIHJlc3VsdDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmdWxsTmFtZTsKICAgIH0KICB9
LAoKCiAgLyoqCiAgICBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgdmlhIHRoZSBjb250YWluZXIncyBy
ZXNvbHZlciBtZXRob2QuCiAgICBJdCBwYXJzZXMgdGhlIHByb3ZpZGVkIGBmdWxsTmFtZWAgYW5k
IHRoZW4gbG9va3MgdXAgYW5kCiAgICByZXR1cm5zIHRoZSBhcHByb3ByaWF0ZSB0ZW1wbGF0ZSBv
ciBjbGFzcy4KCiAgICBAbWV0aG9kIHJlc29sdmUKICAgIEBwYXJhbSB7U3RyaW5nfSBmdWxsTmFt
ZSB0aGUgbG9va3VwIHN0cmluZwogICAgQHJldHVybiB7T2JqZWN0fSB0aGUgcmVzb2x2ZWQgZmFj
dG9yeQogICovCiAgcmVzb2x2ZTogZnVuY3Rpb24oZnVsbE5hbWUpIHsKICAgIHZhciBwYXJzZWRO
YW1lID0gdGhpcy5wYXJzZU5hbWUoZnVsbE5hbWUpLAogICAgICAgIHR5cGVTcGVjaWZpY1Jlc29s
dmVNZXRob2QgPSB0aGlzW3BhcnNlZE5hbWUucmVzb2x2ZU1ldGhvZE5hbWVdOwoKICAgIGlmICgh
cGFyc2VkTmFtZS5uYW1lIHx8ICFwYXJzZWROYW1lLnR5cGUpIHsKICAgICAgdGhyb3cgbmV3IFR5
cGVFcnJvcigiSW52YWxpZCBmdWxsTmFtZTogYCIgKyBmdWxsTmFtZSArICJgLCBtdXN0IGJlIG9m
IHRoZSBmb3JtIGB0eXBlOm5hbWVgICIpOwogICAgfQoKICAgIGlmICh0eXBlU3BlY2lmaWNSZXNv
bHZlTWV0aG9kKSB7CiAgICAgIHZhciByZXNvbHZlZCA9IHR5cGVTcGVjaWZpY1Jlc29sdmVNZXRo
b2QuY2FsbCh0aGlzLCBwYXJzZWROYW1lKTsKICAgICAgaWYgKHJlc29sdmVkKSB7IHJldHVybiBy
ZXNvbHZlZDsgfQogICAgfQogICAgcmV0dXJuIHRoaXMucmVzb2x2ZU90aGVyKHBhcnNlZE5hbWUp
OwogIH0sCiAgLyoqCiAgICBDb252ZXJ0IHRoZSBzdHJpbmcgbmFtZSBvZiB0aGUgZm9ybSAidHlw
ZTpuYW1lIiB0bwogICAgYSBKYXZhc2NyaXB0IG9iamVjdCB3aXRoIHRoZSBwYXJzZWQgYXNwZWN0
cyBvZiB0aGUgbmFtZQogICAgYnJva2VuIG91dC4KCiAgICBAcHJvdGVjdGVkCiAgICBAcGFyYW0g
e1N0cmluZ30gZnVsbE5hbWUgdGhlIGxvb2t1cCBzdHJpbmcKICAgIEBtZXRob2QgcGFyc2VOYW1l
CiAgKi8KICBwYXJzZU5hbWU6IGZ1bmN0aW9uKGZ1bGxOYW1lKSB7CiAgICB2YXIgbmFtZVBhcnRz
ID0gZnVsbE5hbWUuc3BsaXQoIjoiKSwKICAgICAgICB0eXBlID0gbmFtZVBhcnRzWzBdLCBmdWxs
TmFtZVdpdGhvdXRUeXBlID0gbmFtZVBhcnRzWzFdLAogICAgICAgIG5hbWUgPSBmdWxsTmFtZVdp
dGhvdXRUeXBlLAogICAgICAgIG5hbWVzcGFjZSA9IGdldCh0aGlzLCAnbmFtZXNwYWNlJyksCiAg
ICAgICAgcm9vdCA9IG5hbWVzcGFjZTsKCiAgICBpZiAodHlwZSAhPT0gJ3RlbXBsYXRlJyAmJiBu
YW1lLmluZGV4T2YoJy8nKSAhPT0gLTEpIHsKICAgICAgdmFyIHBhcnRzID0gbmFtZS5zcGxpdCgn
LycpOwogICAgICBuYW1lID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07CiAgICAgIHZhciBuYW1l
c3BhY2VOYW1lID0gY2FwaXRhbGl6ZShwYXJ0cy5zbGljZSgwLCAtMSkuam9pbignLicpKTsKICAg
ICAgcm9vdCA9IEVtYmVyLk5hbWVzcGFjZS5ieU5hbWUobmFtZXNwYWNlTmFtZSk7CgogICAgICBF
bWJlci5hc3NlcnQoJ1lvdSBhcmUgbG9va2luZyBmb3IgYSAnICsgbmFtZSArICcgJyArIHR5cGUg
KyAnIGluIHRoZSAnICsgbmFtZXNwYWNlTmFtZSArICcgbmFtZXNwYWNlLCBidXQgdGhlIG5hbWVz
cGFjZSBjb3VsZCBub3QgYmUgZm91bmQnLCByb290KTsKICAgIH0KCiAgICByZXR1cm4gewogICAg
ICBmdWxsTmFtZTogZnVsbE5hbWUsCiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGZ1bGxOYW1lV2l0
aG91dFR5cGU6IGZ1bGxOYW1lV2l0aG91dFR5cGUsCiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHJv
b3Q6IHJvb3QsCiAgICAgIHJlc29sdmVNZXRob2ROYW1lOiAicmVzb2x2ZSIgKyBjbGFzc2lmeSh0
eXBlKQogICAgfTsKICB9LAogIC8qKgogICAgTG9vayB1cCB0aGUgdGVtcGxhdGUgaW4gRW1iZXIu
VEVNUExBVEVTCgogICAgQHByb3RlY3RlZAogICAgQHBhcmFtIHtPYmplY3R9IHBhcnNlZE5hbWUg
YSBwYXJzZU5hbWUgb2JqZWN0IHdpdGggdGhlIHBhcnNlZAogICAgICBmdWxsTmFtZSBsb29rdXAg
c3RyaW5nCiAgICBAbWV0aG9kIHJlc29sdmVUZW1wbGF0ZQogICovCiAgcmVzb2x2ZVRlbXBsYXRl
OiBmdW5jdGlvbihwYXJzZWROYW1lKSB7CiAgICB2YXIgdGVtcGxhdGVOYW1lID0gcGFyc2VkTmFt
ZS5mdWxsTmFtZVdpdGhvdXRUeXBlLnJlcGxhY2UoL1wuL2csICcvJyk7CgogICAgaWYgKEVtYmVy
LlRFTVBMQVRFU1t0ZW1wbGF0ZU5hbWVdKSB7CiAgICAgIHJldHVybiBFbWJlci5URU1QTEFURVNb
dGVtcGxhdGVOYW1lXTsKICAgIH0KCiAgICB0ZW1wbGF0ZU5hbWUgPSBkZWNhbWVsaXplKHRlbXBs
YXRlTmFtZSk7CiAgICBpZiAoRW1iZXIuVEVNUExBVEVTW3RlbXBsYXRlTmFtZV0pIHsKICAgICAg
cmV0dXJuIEVtYmVyLlRFTVBMQVRFU1t0ZW1wbGF0ZU5hbWVdOwogICAgfQogIH0sCiAgLyoqCiAg
ICBHaXZlbiBhIHBhcnNlTmFtZSBvYmplY3QgKG91dHB1dCBmcm9tIGBwYXJzZU5hbWVgKSwgYXBw
bHkKICAgIHRoZSBjb252ZW50aW9ucyBleHBlY3RlZCBieSBgRW1iZXIuUm91dGVyYAoKICAgIEBw
cm90ZWN0ZWQKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJzZWROYW1lIGEgcGFyc2VOYW1lIG9iamVj
dCB3aXRoIHRoZSBwYXJzZWQKICAgICAgZnVsbE5hbWUgbG9va3VwIHN0cmluZwogICAgQG1ldGhv
ZCB1c2VSb3V0ZXJOYW1pbmcKICAqLwogIHVzZVJvdXRlck5hbWluZzogZnVuY3Rpb24ocGFyc2Vk
TmFtZSkgewogICAgcGFyc2VkTmFtZS5uYW1lID0gcGFyc2VkTmFtZS5uYW1lLnJlcGxhY2UoL1wu
L2csICdfJyk7CiAgICBpZiAocGFyc2VkTmFtZS5uYW1lID09PSAnYmFzaWMnKSB7CiAgICAgIHBh
cnNlZE5hbWUubmFtZSA9ICcnOwogICAgfQogIH0sCiAgLyoqCiAgICBMb29rdXAgdGhlIGNvbnRy
b2xsZXIgdXNpbmcgYHJlc29sdmVPdGhlcmAKCiAgICBAcHJvdGVjdGVkCiAgICBAcGFyYW0ge09i
amVjdH0gcGFyc2VkTmFtZSBhIHBhcnNlTmFtZSBvYmplY3Qgd2l0aCB0aGUgcGFyc2VkCiAgICAg
IGZ1bGxOYW1lIGxvb2t1cCBzdHJpbmcKICAgIEBtZXRob2QgcmVzb2x2ZUNvbnRyb2xsZXIKICAq
LwogIHJlc29sdmVDb250cm9sbGVyOiBmdW5jdGlvbihwYXJzZWROYW1lKSB7CiAgICB0aGlzLnVz
ZVJvdXRlck5hbWluZyhwYXJzZWROYW1lKTsKICAgIHJldHVybiB0aGlzLnJlc29sdmVPdGhlcihw
YXJzZWROYW1lKTsKICB9LAogIC8qKgogICAgTG9va3VwIHRoZSByb3V0ZSB1c2luZyBgcmVzb2x2
ZU90aGVyYAoKICAgIEBwcm90ZWN0ZWQKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJzZWROYW1lIGEg
cGFyc2VOYW1lIG9iamVjdCB3aXRoIHRoZSBwYXJzZWQKICAgICAgZnVsbE5hbWUgbG9va3VwIHN0
cmluZwogICAgQG1ldGhvZCByZXNvbHZlUm91dGUKICAqLwogIHJlc29sdmVSb3V0ZTogZnVuY3Rp
b24ocGFyc2VkTmFtZSkgewogICAgdGhpcy51c2VSb3V0ZXJOYW1pbmcocGFyc2VkTmFtZSk7CiAg
ICByZXR1cm4gdGhpcy5yZXNvbHZlT3RoZXIocGFyc2VkTmFtZSk7CiAgfSwKICAvKioKICAgIExv
b2t1cCB0aGUgdmlldyB1c2luZyBgcmVzb2x2ZU90aGVyYAoKICAgIEBwcm90ZWN0ZWQKICAgIEBw
YXJhbSB7T2JqZWN0fSBwYXJzZWROYW1lIGEgcGFyc2VOYW1lIG9iamVjdCB3aXRoIHRoZSBwYXJz
ZWQKICAgICAgZnVsbE5hbWUgbG9va3VwIHN0cmluZwogICAgQG1ldGhvZCByZXNvbHZlVmlldwog
ICovCiAgcmVzb2x2ZVZpZXc6IGZ1bmN0aW9uKHBhcnNlZE5hbWUpIHsKICAgIHRoaXMudXNlUm91
dGVyTmFtaW5nKHBhcnNlZE5hbWUpOwogICAgcmV0dXJuIHRoaXMucmVzb2x2ZU90aGVyKHBhcnNl
ZE5hbWUpOwogIH0sCgogIHJlc29sdmVIZWxwZXI6IGZ1bmN0aW9uKHBhcnNlZE5hbWUpIHsKICAg
IHJldHVybiB0aGlzLnJlc29sdmVPdGhlcihwYXJzZWROYW1lKSB8fCBFbWJlci5IYW5kbGViYXJz
LmhlbHBlcnNbcGFyc2VkTmFtZS5mdWxsTmFtZVdpdGhvdXRUeXBlXTsKICB9LAoKICAvKioKICAg
IExvb2t1cCB0aGUgbW9kZWwgb24gdGhlIEFwcGxpY2F0aW9uIG5hbWVzcGFjZQoKICAgIEBwcm90
ZWN0ZWQKICAgIEBwYXJhbSB7T2JqZWN0fSBwYXJzZWROYW1lIGEgcGFyc2VOYW1lIG9iamVjdCB3
aXRoIHRoZSBwYXJzZWQKICAgICAgZnVsbE5hbWUgbG9va3VwIHN0cmluZwogICAgQG1ldGhvZCBy
ZXNvbHZlTW9kZWwKICAqLwogIHJlc29sdmVNb2RlbDogZnVuY3Rpb24ocGFyc2VkTmFtZSkgewog
ICAgdmFyIGNsYXNzTmFtZSA9IGNsYXNzaWZ5KHBhcnNlZE5hbWUubmFtZSksCiAgICAgICAgZmFj
dG9yeSA9IGdldChwYXJzZWROYW1lLnJvb3QsIGNsYXNzTmFtZSk7CgogICAgIGlmIChmYWN0b3J5
KSB7IHJldHVybiBmYWN0b3J5OyB9CiAgfSwKICAvKioKICAgIExvb2sgdXAgdGhlIHNwZWNpZmll
ZCBvYmplY3QgKGZyb20gcGFyc2VkTmFtZSkgb24gdGhlIGFwcHJvcHJpYXRlCiAgICBuYW1lc3Bh
Y2UgKHVzdWFsbHkgb24gdGhlIEFwcGxpY2F0aW9uKQoKICAgIEBwcm90ZWN0ZWQKICAgIEBwYXJh
bSB7T2JqZWN0fSBwYXJzZWROYW1lIGEgcGFyc2VOYW1lIG9iamVjdCB3aXRoIHRoZSBwYXJzZWQK
ICAgICAgZnVsbE5hbWUgbG9va3VwIHN0cmluZwogICAgQG1ldGhvZCByZXNvbHZlT3RoZXIKICAq
LwogIHJlc29sdmVPdGhlcjogZnVuY3Rpb24ocGFyc2VkTmFtZSkgewogICAgdmFyIGNsYXNzTmFt
ZSA9IGNsYXNzaWZ5KHBhcnNlZE5hbWUubmFtZSkgKyBjbGFzc2lmeShwYXJzZWROYW1lLnR5cGUp
LAogICAgICAgIGZhY3RvcnkgPSBnZXQocGFyc2VkTmFtZS5yb290LCBjbGFzc05hbWUpOwogICAg
aWYgKGZhY3RvcnkpIHsgcmV0dXJuIGZhY3Rvcnk7IH0KICB9LAoKICAvKioKICAgIFJldHVybnMg
YSBodW1hbi1yZWFkYWJsZSBkZXNjcmlwdGlvbiBmb3IgYSBmdWxsTmFtZS4gVXNlZCBieSB0aGUK
ICAgIEFwcGxpY2F0aW9uIG5hbWVzcGFjZSBpbiBhc3NlcnRpb25zIHRvIGRlc2NyaWJlIHRoZQog
ICAgcHJlY2lzZSBuYW1lIG9mIHRoZSBjbGFzcyB0aGF0IEVtYmVyIGlzIGxvb2tpbmcgZm9yLCBy
YXRoZXIgdGhhbgogICAgY29udGFpbmVyIGtleXMuCgogICAgQHByb3RlY3RlZAogICAgQHBhcmFt
IHtTdHJpbmd9IGZ1bGxOYW1lIHRoZSBsb29rdXAgc3RyaW5nCiAgICBAbWV0aG9kIGxvb2t1cERl
c2NyaXB0aW9uCiAgKi8KICBsb29rdXBEZXNjcmlwdGlvbjogZnVuY3Rpb24oZnVsbE5hbWUpIHsK
ICAgIHZhciBwYXJzZWROYW1lID0gdGhpcy5wYXJzZU5hbWUoZnVsbE5hbWUpOwoKICAgIGlmIChw
YXJzZWROYW1lLnR5cGUgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgcmV0dXJuICJ0ZW1wbGF0ZSBh
dCAiICsgcGFyc2VkTmFtZS5mdWxsTmFtZVdpdGhvdXRUeXBlLnJlcGxhY2UoL1wuL2csICcvJyk7
CiAgICB9CgogICAgdmFyIGRlc2NyaXB0aW9uID0gcGFyc2VkTmFtZS5yb290ICsgIi4iICsgY2xh
c3NpZnkocGFyc2VkTmFtZS5uYW1lKTsKICAgIGlmIChwYXJzZWROYW1lLnR5cGUgIT09ICdtb2Rl
bCcpIHsgZGVzY3JpcHRpb24gKz0gY2xhc3NpZnkocGFyc2VkTmFtZS50eXBlKTsgfQoKICAgIHJl
dHVybiBkZXNjcmlwdGlvbjsKICB9LAoKICBtYWtlVG9TdHJpbmc6IGZ1bmN0aW9uKGZhY3Rvcnks
IGZ1bGxOYW1lKSB7CiAgICByZXR1cm4gZmFjdG9yeS50b1N0cmluZygpOwogIH0KfSk7Cgp9KSgp
OwoKCgooZnVuY3Rpb24oKSB7Ci8qKgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXItYXBw
bGljYXRpb24KKi8KCnZhciBnZXQgPSBFbWJlci5nZXQsIHNldCA9IEVtYmVyLnNldDsKCmZ1bmN0
aW9uIERlcHJlY2F0ZWRDb250YWluZXIoY29udGFpbmVyKSB7CiAgdGhpcy5fY29udGFpbmVyID0g
Y29udGFpbmVyOwp9CgpEZXByZWNhdGVkQ29udGFpbmVyLmRlcHJlY2F0ZSA9IGZ1bmN0aW9uKG1l
dGhvZCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9j
b250YWluZXI7CgogICAgRW1iZXIuZGVwcmVjYXRlKCdVc2luZyB0aGUgZGVmYXVsdENvbnRhaW5l
ciBpcyBubyBsb25nZXIgc3VwcG9ydGVkLiBbZGVmYXVsdENvbnRhaW5lciMnICsgbWV0aG9kICsg
J10gc2VlOiBodHRwOi8vZ2l0LmlvL0VLUHBuQScsIGZhbHNlKTsKICAgIHJldHVybiBjb250YWlu
ZXJbbWV0aG9kXS5hcHBseShjb250YWluZXIsIGFyZ3VtZW50cyk7CiAgfTsKfTsKCkRlcHJlY2F0
ZWRDb250YWluZXIucHJvdG90eXBlID0gewogIF9jb250YWluZXI6IG51bGwsCiAgbG9va3VwOiBE
ZXByZWNhdGVkQ29udGFpbmVyLmRlcHJlY2F0ZSgnbG9va3VwJyksCiAgcmVzb2x2ZTogRGVwcmVj
YXRlZENvbnRhaW5lci5kZXByZWNhdGUoJ3Jlc29sdmUnKSwKICByZWdpc3RlcjogRGVwcmVjYXRl
ZENvbnRhaW5lci5kZXByZWNhdGUoJ3JlZ2lzdGVyJykKfTsKCi8qKgogIEFuIGluc3RhbmNlIG9m
IGBFbWJlci5BcHBsaWNhdGlvbmAgaXMgdGhlIHN0YXJ0aW5nIHBvaW50IGZvciBldmVyeSBFbWJl
cgogIGFwcGxpY2F0aW9uLiBJdCBoZWxwcyB0byBpbnN0YW50aWF0ZSwgaW5pdGlhbGl6ZSBhbmQg
Y29vcmRpbmF0ZSB0aGUgbWFueQogIG9iamVjdHMgdGhhdCBtYWtlIHVwIHlvdXIgYXBwLgoKICBF
YWNoIEVtYmVyIGFwcCBoYXMgb25lIGFuZCBvbmx5IG9uZSBgRW1iZXIuQXBwbGljYXRpb25gIG9i
amVjdC4gSW4gZmFjdCwgdGhlCiAgdmVyeSBmaXJzdCB0aGluZyB5b3Ugc2hvdWxkIGRvIGluIHlv
dXIgYXBwbGljYXRpb24gaXMgY3JlYXRlIHRoZSBpbnN0YW5jZToKCiAgYGBgamF2YXNjcmlwdAog
IHdpbmRvdy5BcHAgPSBFbWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoKTsKICBgYGAKCiAgVHlwaWNh
bGx5LCB0aGUgYXBwbGljYXRpb24gb2JqZWN0IGlzIHRoZSBvbmx5IGdsb2JhbCB2YXJpYWJsZS4g
QWxsIG90aGVyCiAgY2xhc3NlcyBpbiB5b3VyIGFwcCBzaG91bGQgYmUgcHJvcGVydGllcyBvbiB0
aGUgYEVtYmVyLkFwcGxpY2F0aW9uYCBpbnN0YW5jZSwKICB3aGljaCBoaWdobGlnaHRzIGl0cyBm
aXJzdCByb2xlOiBhIGdsb2JhbCBuYW1lc3BhY2UuCgogIEZvciBleGFtcGxlLCBpZiB5b3UgZGVm
aW5lIGEgdmlldyBjbGFzcywgaXQgbWlnaHQgbG9vayBsaWtlIHRoaXM6CgogIGBgYGphdmFzY3Jp
cHQKICBBcHAuTXlWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoKTsKICBgYGAKCiAgQnkgZGVmYXVs
dCwgY2FsbGluZyBgRW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKClgIHdpbGwgYXV0b21hdGljYWxs
eSBpbml0aWFsaXplCiAgeW91ciBhcHBsaWNhdGlvbiBieSBjYWxsaW5nIHRoZSBgRW1iZXIuQXBw
bGljYXRpb24uaW5pdGlhbGl6ZSgpYCBtZXRob2QuIElmCiAgeW91IG5lZWQgdG8gZGVsYXkgaW5p
dGlhbGl6YXRpb24sIHlvdSBjYW4gY2FsbCB5b3VyIGFwcCdzIGBkZWZlclJlYWRpbmVzcygpYAog
IG1ldGhvZC4gV2hlbiB5b3UgYXJlIHJlYWR5IGZvciB5b3VyIGFwcCB0byBiZSBpbml0aWFsaXpl
ZCwgY2FsbCBpdHMKICBgYWR2YW5jZVJlYWRpbmVzcygpYCBtZXRob2QuCgogIFlvdSBjYW4gZGVm
aW5lIGEgYHJlYWR5YCBtZXRob2Qgb24gdGhlIGBFbWJlci5BcHBsaWNhdGlvbmAgaW5zdGFuY2Us
IHdoaWNoCiAgd2lsbCBiZSBydW4gYnkgRW1iZXIgd2hlbiB0aGUgYXBwbGljYXRpb24gaXMgaW5p
dGlhbGl6ZWQuCgogIEJlY2F1c2UgYEVtYmVyLkFwcGxpY2F0aW9uYCBpbmhlcml0cyBmcm9tIGBF
bWJlci5OYW1lc3BhY2VgLCBhbnkgY2xhc3NlcwogIHlvdSBjcmVhdGUgd2lsbCBoYXZlIHVzZWZ1
bCBzdHJpbmcgcmVwcmVzZW50YXRpb25zIHdoZW4gY2FsbGluZyBgdG9TdHJpbmcoKWAuCiAgU2Vl
IHRoZSBgRW1iZXIuTmFtZXNwYWNlYCBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9u
LgoKICBXaGlsZSB5b3UgY2FuIHRoaW5rIG9mIHlvdXIgYEVtYmVyLkFwcGxpY2F0aW9uYCBhcyBh
IGNvbnRhaW5lciB0aGF0IGhvbGRzIHRoZQogIG90aGVyIGNsYXNzZXMgaW4geW91ciBhcHBsaWNh
dGlvbiwgdGhlcmUgYXJlIHNldmVyYWwgb3RoZXIgcmVzcG9uc2liaWxpdGllcwogIGdvaW5nIG9u
IHVuZGVyLXRoZS1ob29kIHRoYXQgeW91IG1heSB3YW50IHRvIHVuZGVyc3RhbmQuCgogICMjIyBF
dmVudCBEZWxlZ2F0aW9uCgogIEVtYmVyIHVzZXMgYSB0ZWNobmlxdWUgY2FsbGVkIF9ldmVudCBk
ZWxlZ2F0aW9uXy4gVGhpcyBhbGxvd3MgdGhlIGZyYW1ld29yawogIHRvIHNldCB1cCBhIGdsb2Jh
bCwgc2hhcmVkIGV2ZW50IGxpc3RlbmVyIGluc3RlYWQgb2YgcmVxdWlyaW5nIGVhY2ggdmlldyB0
bwogIGRvIGl0IG1hbnVhbGx5LiBGb3IgZXhhbXBsZSwgaW5zdGVhZCBvZiBlYWNoIHZpZXcgcmVn
aXN0ZXJpbmcgaXRzIG93bgogIGBtb3VzZWRvd25gIGxpc3RlbmVyIG9uIGl0cyBhc3NvY2lhdGVk
IGVsZW1lbnQsIEVtYmVyIHNldHMgdXAgYSBgbW91c2Vkb3duYAogIGxpc3RlbmVyIG9uIHRoZSBg
Ym9keWAuCgogIElmIGEgYG1vdXNlZG93bmAgZXZlbnQgb2NjdXJzLCBFbWJlciB3aWxsIGxvb2sg
YXQgdGhlIHRhcmdldCBvZiB0aGUgZXZlbnQgYW5kCiAgc3RhcnQgd2Fsa2luZyB1cCB0aGUgRE9N
IG5vZGUgdHJlZSwgZmluZGluZyBjb3JyZXNwb25kaW5nIHZpZXdzIGFuZCBpbnZva2luZwogIHRo
ZWlyIGBtb3VzZURvd25gIG1ldGhvZCBhcyBpdCBnb2VzLgoKICBgRW1iZXIuQXBwbGljYXRpb25g
IGhhcyBhIG51bWJlciBvZiBkZWZhdWx0IGV2ZW50cyB0aGF0IGl0IGxpc3RlbnMgZm9yLCBhcwog
IHdlbGwgYXMgYSBtYXBwaW5nIGZyb20gbG93ZXJjYXNlIGV2ZW50cyB0byBjYW1lbC1jYXNlZCB2
aWV3IG1ldGhvZCBuYW1lcy4gRm9yCiAgZXhhbXBsZSwgdGhlIGBrZXlwcmVzc2AgZXZlbnQgY2F1
c2VzIHRoZSBga2V5UHJlc3NgIG1ldGhvZCBvbiB0aGUgdmlldyB0byBiZQogIGNhbGxlZCwgdGhl
IGBkYmxjbGlja2AgZXZlbnQgY2F1c2VzIGBkb3VibGVDbGlja2AgdG8gYmUgY2FsbGVkLCBhbmQg
c28gb24uCgogIElmIHRoZXJlIGlzIGEgYnViYmxpbmcgYnJvd3NlciBldmVudCB0aGF0IEVtYmVy
IGRvZXMgbm90IGxpc3RlbiBmb3IgYnkKICBkZWZhdWx0LCB5b3UgY2FuIHNwZWNpZnkgY3VzdG9t
IGV2ZW50cyBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyB2aWV3IG1ldGhvZAogIG5hbWVzIGJ5IHNl
dHRpbmcgdGhlIGFwcGxpY2F0aW9uJ3MgYGN1c3RvbUV2ZW50c2AgcHJvcGVydHk6CgogIGBgYGph
dmFzY3JpcHQKICBBcHAgPSBFbWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoewogICAgY3VzdG9tRXZl
bnRzOiB7CiAgICAgIC8vIGFkZCBzdXBwb3J0IGZvciB0aGUgcGFzdGUgZXZlbnQKICAgICAgcGFz
dGU6ICJwYXN0ZSIKICAgIH0KICB9KTsKICBgYGAKCiAgQnkgZGVmYXVsdCwgdGhlIGFwcGxpY2F0
aW9uIHNldHMgdXAgdGhlc2UgZXZlbnQgbGlzdGVuZXJzIG9uIHRoZSBkb2N1bWVudAogIGJvZHku
IEhvd2V2ZXIsIGluIGNhc2VzIHdoZXJlIHlvdSBhcmUgZW1iZWRkaW5nIGFuIEVtYmVyIGFwcGxp
Y2F0aW9uIGluc2lkZQogIGFuIGV4aXN0aW5nIHBhZ2UsIHlvdSBtYXkgd2FudCBpdCB0byBzZXQg
dXAgdGhlIGxpc3RlbmVycyBvbiBhbiBlbGVtZW50CiAgaW5zaWRlIHRoZSBib2R5LgoKICBGb3Ig
ZXhhbXBsZSwgaWYgb25seSBldmVudHMgaW5zaWRlIGEgRE9NIGVsZW1lbnQgd2l0aCB0aGUgSUQg
b2YgYGVtYmVyLWFwcGAKICBzaG91bGQgYmUgZGVsZWdhdGVkLCBzZXQgeW91ciBhcHBsaWNhdGlv
bidzIGByb290RWxlbWVudGAgcHJvcGVydHk6CgogIGBgYGphdmFzY3JpcHQKICB3aW5kb3cuQXBw
ID0gRW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKHsKICAgIHJvb3RFbGVtZW50OiAnI2VtYmVyLWFw
cCcKICB9KTsKICBgYGAKCiAgVGhlIGByb290RWxlbWVudGAgY2FuIGJlIGVpdGhlciBhIERPTSBl
bGVtZW50IG9yIGEgalF1ZXJ5LWNvbXBhdGlibGUgc2VsZWN0b3IKICBzdHJpbmcuIE5vdGUgdGhh
dCAqdmlld3MgYXBwZW5kZWQgdG8gdGhlIERPTSBvdXRzaWRlIHRoZSByb290IGVsZW1lbnQgd2ls
bAogIG5vdCByZWNlaXZlIGV2ZW50cy4qIElmIHlvdSBzcGVjaWZ5IGEgY3VzdG9tIHJvb3QgZWxl
bWVudCwgbWFrZSBzdXJlIHlvdSBvbmx5CiAgYXBwZW5kIHZpZXdzIGluc2lkZSBpdCEKCiAgVG8g
bGVhcm4gbW9yZSBhYm91dCB0aGUgYWR2YW50YWdlcyBvZiBldmVudCBkZWxlZ2F0aW9uIGFuZCB0
aGUgRW1iZXIgdmlldwogIGxheWVyLCBhbmQgYSBsaXN0IG9mIHRoZSBldmVudCBsaXN0ZW5lcnMg
dGhhdCBhcmUgc2V0dXAgYnkgZGVmYXVsdCwgdmlzaXQgdGhlCiAgW0VtYmVyIFZpZXcgTGF5ZXIg
Z3VpZGVdKGh0dHA6Ly9lbWJlcmpzLmNvbS9ndWlkZXMvdW5kZXJzdGFuZGluZy1lbWJlci90aGUt
dmlldy1sYXllci8jdG9jX2V2ZW50LWRlbGVnYXRpb24pLgoKICAjIyMgSW5pdGlhbGl6ZXJzCgog
IExpYnJhcmllcyBvbiB0b3Agb2YgRW1iZXIgY2FuIHJlZ2lzdGVyIGFkZGl0aW9uYWwgaW5pdGlh
bGl6ZXJzLCBsaWtlIHNvOgoKICBgYGBqYXZhc2NyaXB0CiAgRW1iZXIuQXBwbGljYXRpb24uaW5p
dGlhbGl6ZXIoewogICAgbmFtZTogInN0b3JlIiwKCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihj
b250YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgIGNvbnRhaW5lci5yZWdpc3Rlcignc3RvcmU6
bWFpbicsIGFwcGxpY2F0aW9uLlN0b3JlKTsKICAgIH0KICB9KTsKICBgYGAKCiAgIyMjIFJvdXRp
bmcKCiAgSW4gYWRkaXRpb24gdG8gY3JlYXRpbmcgeW91ciBhcHBsaWNhdGlvbidzIHJvdXRlciwg
YEVtYmVyLkFwcGxpY2F0aW9uYCBpcwogIGFsc28gcmVzcG9uc2libGUgZm9yIHRlbGxpbmcgdGhl
IHJvdXRlciB3aGVuIHRvIHN0YXJ0IHJvdXRpbmcuIFRyYW5zaXRpb25zCiAgYmV0d2VlbiByb3V0
ZXMgY2FuIGJlIGxvZ2dlZCB3aXRoIHRoZSBgTE9HX1RSQU5TSVRJT05TYCBmbGFnLCBhbmQgbW9y
ZQogIGRldGFpbGVkIGludHJhLXRyYW5zaXRpb24gbG9nZ2luZyBjYW4gYmUgbG9nZ2VkIHdpdGgK
ICB0aGUgYExPR19UUkFOU0lUSU9OU19JTlRFUk5BTGAgZmxhZzoKCiAgYGBgamF2YXNjcmlwdAog
IHdpbmRvdy5BcHAgPSBFbWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoewogICAgTE9HX1RSQU5TSVRJ
T05TOiB0cnVlLCAvLyBiYXNpYyBsb2dnaW5nIG9mIHN1Y2Nlc3NmdWwgdHJhbnNpdGlvbnMKICAg
IExPR19UUkFOU0lUSU9OU19JTlRFUk5BTDogdHJ1ZSAvLyBkZXRhaWxlZCBsb2dnaW5nIG9mIGFs
bCByb3V0aW5nIHN0ZXBzCiAgfSk7CiAgYGBgCgogIEJ5IGRlZmF1bHQsIHRoZSByb3V0ZXIgd2ls
bCBiZWdpbiB0cnlpbmcgdG8gdHJhbnNsYXRlIHRoZSBjdXJyZW50IFVSTCBpbnRvCiAgYXBwbGlj
YXRpb24gc3RhdGUgb25jZSB0aGUgYnJvd3NlciBlbWl0cyB0aGUgYERPTUNvbnRlbnRSZWFkeWAg
ZXZlbnQuIElmIHlvdQogIG5lZWQgdG8gZGVmZXIgcm91dGluZywgeW91IGNhbiBjYWxsIHRoZSBh
cHBsaWNhdGlvbidzIGBkZWZlclJlYWRpbmVzcygpYAogIG1ldGhvZC4gT25jZSByb3V0aW5nIGNh
biBiZWdpbiwgY2FsbCB0aGUgYGFkdmFuY2VSZWFkaW5lc3MoKWAgbWV0aG9kLgoKICBJZiB0aGVy
ZSBpcyBhbnkgc2V0dXAgcmVxdWlyZWQgYmVmb3JlIHJvdXRpbmcgYmVnaW5zLCB5b3UgY2FuIGlt
cGxlbWVudCBhCiAgYHJlYWR5KClgIG1ldGhvZCBvbiB5b3VyIGFwcCB0aGF0IHdpbGwgYmUgaW52
b2tlZCBpbW1lZGlhdGVseSBiZWZvcmUgcm91dGluZwogIGJlZ2lucy4KICBgYGAKCiAgQGNsYXNz
IEFwcGxpY2F0aW9uCiAgQG5hbWVzcGFjZSBFbWJlcgogIEBleHRlbmRzIEVtYmVyLk5hbWVzcGFj
ZQoqLwoKdmFyIEFwcGxpY2F0aW9uID0gRW1iZXIuQXBwbGljYXRpb24gPSBFbWJlci5OYW1lc3Bh
Y2UuZXh0ZW5kKEVtYmVyLkRlZmVycmVkTWl4aW4sIHsKCiAgLyoqCiAgICBUaGUgcm9vdCBET00g
ZWxlbWVudCBvZiB0aGUgQXBwbGljYXRpb24uIFRoaXMgY2FuIGJlIHNwZWNpZmllZCBhcyBhbgog
ICAgZWxlbWVudCBvciBhCiAgICBbalF1ZXJ5LWNvbXBhdGlibGUgc2VsZWN0b3Igc3RyaW5nXSho
dHRwOi8vYXBpLmpxdWVyeS5jb20vY2F0ZWdvcnkvc2VsZWN0b3JzLykuCgogICAgVGhpcyBpcyB0
aGUgZWxlbWVudCB0aGF0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBBcHBsaWNhdGlvbidzLAogICAg
YGV2ZW50RGlzcGF0Y2hlcmAsIHdoaWNoIHNldHMgdXAgdGhlIGxpc3RlbmVycyBmb3IgZXZlbnQg
ZGVsZWdhdGlvbi4gRXZlcnkKICAgIHZpZXcgaW4geW91ciBhcHBsaWNhdGlvbiBzaG91bGQgYmUg
YSBjaGlsZCBvZiB0aGUgZWxlbWVudCB5b3Ugc3BlY2lmeSBoZXJlLgoKICAgIEBwcm9wZXJ0eSBy
b290RWxlbWVudAogICAgQHR5cGUgRE9NRWxlbWVudAogICAgQGRlZmF1bHQgJ2JvZHknCiAgKi8K
ICByb290RWxlbWVudDogJ2JvZHknLAoKICAvKioKICAgIFRoZSBgRW1iZXIuRXZlbnREaXNwYXRj
aGVyYCByZXNwb25zaWJsZSBmb3IgZGVsZWdhdGluZyBldmVudHMgdG8gdGhpcwogICAgYXBwbGlj
YXRpb24ncyB2aWV3cy4KCiAgICBUaGUgZXZlbnQgZGlzcGF0Y2hlciBpcyBjcmVhdGVkIGJ5IHRo
ZSBhcHBsaWNhdGlvbiBhdCBpbml0aWFsaXphdGlvbiB0aW1lCiAgICBhbmQgc2V0cyB1cCBldmVu
dCBsaXN0ZW5lcnMgb24gdGhlIERPTSBlbGVtZW50IGRlc2NyaWJlZCBieSB0aGUKICAgIGFwcGxp
Y2F0aW9uJ3MgYHJvb3RFbGVtZW50YCBwcm9wZXJ0eS4KCiAgICBTZWUgdGhlIGRvY3VtZW50YXRp
b24gZm9yIGBFbWJlci5FdmVudERpc3BhdGNoZXJgIGZvciBtb3JlIGluZm9ybWF0aW9uLgoKICAg
IEBwcm9wZXJ0eSBldmVudERpc3BhdGNoZXIKICAgIEB0eXBlIEVtYmVyLkV2ZW50RGlzcGF0Y2hl
cgogICAgQGRlZmF1bHQgbnVsbAogICovCiAgZXZlbnREaXNwYXRjaGVyOiBudWxsLAoKICAvKioK
ICAgIFRoZSBET00gZXZlbnRzIGZvciB3aGljaCB0aGUgZXZlbnQgZGlzcGF0Y2hlciBzaG91bGQg
bGlzdGVuLgoKICAgIEJ5IGRlZmF1bHQsIHRoZSBhcHBsaWNhdGlvbidzIGBFbWJlci5FdmVudERp
c3BhdGNoZXJgIGxpc3RlbnMKICAgIGZvciBhIHNldCBvZiBzdGFuZGFyZCBET00gZXZlbnRzLCBz
dWNoIGFzIGBtb3VzZWRvd25gIGFuZAogICAgYGtleXVwYCwgYW5kIGRlbGVnYXRlcyB0aGVtIHRv
IHlvdXIgYXBwbGljYXRpb24ncyBgRW1iZXIuVmlld2AKICAgIGluc3RhbmNlcy4KCiAgICBJZiB5
b3Ugd291bGQgbGlrZSBhZGRpdGlvbmFsIGJ1YmJsaW5nIGV2ZW50cyB0byBiZSBkZWxlZ2F0ZWQg
dG8geW91cgogICAgdmlld3MsIHNldCB5b3VyIGBFbWJlci5BcHBsaWNhdGlvbmAncyBgY3VzdG9t
RXZlbnRzYCBwcm9wZXJ0eQogICAgdG8gYSBoYXNoIGNvbnRhaW5pbmcgdGhlIERPTSBldmVudCBu
YW1lIGFzIHRoZSBrZXkgYW5kIHRoZQogICAgY29ycmVzcG9uZGluZyB2aWV3IG1ldGhvZCBuYW1l
IGFzIHRoZSB2YWx1ZS4gRm9yIGV4YW1wbGU6CgogICAgYGBgamF2YXNjcmlwdAogICAgQXBwID0g
RW1iZXIuQXBwbGljYXRpb24uY3JlYXRlKHsKICAgICAgY3VzdG9tRXZlbnRzOiB7CiAgICAgICAg
Ly8gYWRkIHN1cHBvcnQgZm9yIHRoZSBwYXN0ZSBldmVudAogICAgICAgIHBhc3RlOiAicGFzdGUi
CiAgICAgIH0KICAgIH0pOwogICAgYGBgCgogICAgQHByb3BlcnR5IGN1c3RvbUV2ZW50cwogICAg
QHR5cGUgT2JqZWN0CiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBjdXN0b21FdmVudHM6IG51bGws
CgogIC8vIFN0YXJ0IG9mZiB0aGUgbnVtYmVyIG9mIGRlZmVycmFscyBhdCAxLiBUaGlzIHdpbGwg
YmUKICAvLyBkZWNyZW1lbnRlZCBieSB0aGUgQXBwbGljYXRpb24ncyBvd24gYGluaXRpYWxpemVg
IG1ldGhvZC4KICBfcmVhZGluZXNzRGVmZXJyYWxzOiAxLAoKICBpbml0OiBmdW5jdGlvbigpIHsK
ICAgIGlmICghdGhpcy4kKSB7IHRoaXMuJCA9IEVtYmVyLiQ7IH0KICAgIHRoaXMuX19jb250YWlu
ZXJfXyA9IHRoaXMuYnVpbGRDb250YWluZXIoKTsKCiAgICB0aGlzLlJvdXRlciA9IHRoaXMuZGVm
YXVsdFJvdXRlcigpOwoKICAgIHRoaXMuX3N1cGVyKCk7CgogICAgdGhpcy5zY2hlZHVsZUluaXRp
YWxpemUoKTsKCiAgICBFbWJlci5saWJyYXJpZXMucmVnaXN0ZXJDb3JlTGlicmFyeSgnSGFuZGxl
YmFycycsIEVtYmVyLkhhbmRsZWJhcnMuVkVSU0lPTik7CiAgICBFbWJlci5saWJyYXJpZXMucmVn
aXN0ZXJDb3JlTGlicmFyeSgnalF1ZXJ5JywgRW1iZXIuJCgpLmpxdWVyeSk7CgogICAgaWYgKCBF
bWJlci5MT0dfVkVSU0lPTiApIHsKICAgICAgRW1iZXIuTE9HX1ZFUlNJT04gPSBmYWxzZTsgLy8g
d2Ugb25seSBuZWVkIHRvIHNlZSB0aGlzIG9uY2UgcGVyIEFwcGxpY2F0aW9uI2luaXQKICAgICAg
dmFyIG1heE5hbWVMZW5ndGggPSBNYXRoLm1heC5hcHBseSh0aGlzLCBFbWJlci5BKEVtYmVyLmxp
YnJhcmllcykubWFwQnkoIm5hbWUubGVuZ3RoIikpOwoKICAgICAgRW1iZXIuZGVidWcoJy0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTsKICAgICAgRW1iZXIubGlicmFyaWVzLmVhY2go
ZnVuY3Rpb24obmFtZSwgdmVyc2lvbikgewogICAgICAgIHZhciBzcGFjZXMgPSBuZXcgQXJyYXko
bWF4TmFtZUxlbmd0aCAtIG5hbWUubGVuZ3RoICsgMSkuam9pbigiICIpOwogICAgICAgIEVtYmVy
LmRlYnVnKFtuYW1lLCBzcGFjZXMsICcgOiAnLCB2ZXJzaW9uXS5qb2luKCIiKSk7CiAgICAgIH0p
OwogICAgICBFbWJlci5kZWJ1ZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpOwog
ICAgfQogIH0sCgogIC8qKgogICAgQnVpbGQgdGhlIGNvbnRhaW5lciBmb3IgdGhlIGN1cnJlbnQg
YXBwbGljYXRpb24uCgogICAgQWxzbyByZWdpc3RlciBhIGRlZmF1bHQgYXBwbGljYXRpb24gdmll
dyBpbiBjYXNlIHRoZSBhcHBsaWNhdGlvbgogICAgaXRzZWxmIGRvZXMgbm90LgoKICAgIEBwcml2
YXRlCiAgICBAbWV0aG9kIGJ1aWxkQ29udGFpbmVyCiAgICBAcmV0dXJuIHtFbWJlci5Db250YWlu
ZXJ9IHRoZSBjb25maWd1cmVkIGNvbnRhaW5lcgogICovCiAgYnVpbGRDb250YWluZXI6IGZ1bmN0
aW9uKCkgewogICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuX19jb250YWluZXJfXyA9IEFwcGxpY2F0
aW9uLmJ1aWxkQ29udGFpbmVyKHRoaXMpOwoKICAgIHJldHVybiBjb250YWluZXI7CiAgfSwKCiAg
LyoqCiAgICBJZiB0aGUgYXBwbGljYXRpb24gaGFzIG5vdCBvcHRlZCBvdXQgb2Ygcm91dGluZyBh
bmQgaGFzIG5vdCBleHBsaWNpdGx5CiAgICBkZWZpbmVkIGEgcm91dGVyLCBzdXBwbHkgYSBkZWZh
dWx0IHJvdXRlciBmb3IgdGhlIGFwcGxpY2F0aW9uIGF1dGhvcgogICAgdG8gY29uZmlndXJlLgoK
ICAgIFRoaXMgYWxsb3dzIGFwcGxpY2F0aW9uIGRldmVsb3BlcnMgdG8gZG86CgogICAgYGBgamF2
YXNjcmlwdAogICAgdmFyIEFwcCA9IEVtYmVyLkFwcGxpY2F0aW9uLmNyZWF0ZSgpOwoKICAgIEFw
cC5Sb3V0ZXIubWFwKGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJlc291cmNlKCdwb3N0cycpOwog
ICAgfSk7CiAgICBgYGAKCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBkZWZhdWx0Um91dGVyCiAg
ICBAcmV0dXJuIHtFbWJlci5Sb3V0ZXJ9IHRoZSBkZWZhdWx0IHJvdXRlcgogICovCgogIGRlZmF1
bHRSb3V0ZXI6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuUm91dGVyID09PSBmYWxzZSkgeyBy
ZXR1cm47IH0KICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9fY29udGFpbmVyX187CgogICAgaWYg
KHRoaXMuUm91dGVyKSB7CiAgICAgIGNvbnRhaW5lci51bnJlZ2lzdGVyKCdyb3V0ZXI6bWFpbicp
OwogICAgICBjb250YWluZXIucmVnaXN0ZXIoJ3JvdXRlcjptYWluJywgdGhpcy5Sb3V0ZXIpOwog
ICAgfQoKICAgIHJldHVybiBjb250YWluZXIubG9va3VwRmFjdG9yeSgncm91dGVyOm1haW4nKTsK
ICB9LAoKICAvKioKICAgIEF1dG9tYXRpY2FsbHkgaW5pdGlhbGl6ZSB0aGUgYXBwbGljYXRpb24g
b25jZSB0aGUgRE9NIGhhcwogICAgYmVjb21lIHJlYWR5LgoKICAgIFRoZSBpbml0aWFsaXphdGlv
biBpdHNlbGYgaXMgc2NoZWR1bGVkIG9uIHRoZSBhY3Rpb25zIHF1ZXVlCiAgICB3aGljaCBlbnN1
cmVzIHRoYXQgYXBwbGljYXRpb24gbG9hZGluZyBmaW5pc2hlcyBiZWZvcmUKICAgIGJvb3Rpbmcu
CgogICAgSWYgeW91IGFyZSBhc3luY2hyb25vdXNseSBsb2FkaW5nIGNvZGUsIHlvdSBzaG91bGQg
Y2FsbAogICAgYGRlZmVyUmVhZGluZXNzKClgIHRvIGRlZmVyIGJvb3RpbmcsIGFuZCB0aGVuIGNh
bGwKICAgIGBhZHZhbmNlUmVhZGluZXNzKClgIG9uY2UgYWxsIG9mIHlvdXIgY29kZSBoYXMgZmlu
aXNoZWQKICAgIGxvYWRpbmcuCgogICAgQHByaXZhdGUKICAgIEBtZXRob2Qgc2NoZWR1bGVJbml0
aWFsaXplCiAgKi8KICBzY2hlZHVsZUluaXRpYWxpemU6IGZ1bmN0aW9uKCkgewogICAgdmFyIHNl
bGYgPSB0aGlzOwoKICAgIGlmICghdGhpcy4kIHx8IHRoaXMuJC5pc1JlYWR5KSB7CiAgICAgIEVt
YmVyLnJ1bi5zY2hlZHVsZSgnYWN0aW9ucycsIHNlbGYsICdfaW5pdGlhbGl6ZScpOwogICAgfSBl
bHNlIHsKICAgICAgdGhpcy4kKCkucmVhZHkoZnVuY3Rpb24gcnVuSW5pdGlhbGl6ZSgpIHsKICAg
ICAgICBFbWJlci5ydW4oc2VsZiwgJ19pbml0aWFsaXplJyk7CiAgICAgIH0pOwogICAgfQogIH0s
CgogIC8qKgogICAgVXNlIHRoaXMgdG8gZGVmZXIgcmVhZGluZXNzIHVudGlsIHNvbWUgY29uZGl0
aW9uIGlzIHRydWUuCgogICAgRXhhbXBsZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAgPSBF
bWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoKTsKICAgIEFwcC5kZWZlclJlYWRpbmVzcygpOwoKICAg
IGpRdWVyeS5nZXRKU09OKCIvYXV0aC10b2tlbiIsIGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgIEFw
cC50b2tlbiA9IHRva2VuOwogICAgICBBcHAuYWR2YW5jZVJlYWRpbmVzcygpOwogICAgfSk7CiAg
ICBgYGAKCiAgICBUaGlzIGFsbG93cyB5b3UgdG8gcGVyZm9ybSBhc3luY2hyb25vdXMgc2V0dXAg
bG9naWMgYW5kIGRlZmVyCiAgICBib290aW5nIHlvdXIgYXBwbGljYXRpb24gdW50aWwgdGhlIHNl
dHVwIGhhcyBmaW5pc2hlZC4KCiAgICBIb3dldmVyLCBpZiB0aGUgc2V0dXAgcmVxdWlyZXMgYSBs
b2FkaW5nIFVJLCBpdCBtaWdodCBiZSBiZXR0ZXIKICAgIHRvIHVzZSB0aGUgcm91dGVyIGZvciB0
aGlzIHB1cnBvc2UuCgogICAgQG1ldGhvZCBkZWZlclJlYWRpbmVzcwogICovCiAgZGVmZXJSZWFk
aW5lc3M6IGZ1bmN0aW9uKCkgewogICAgRW1iZXIuYXNzZXJ0KCJZb3UgbXVzdCBjYWxsIGRlZmVy
UmVhZGluZXNzIG9uIGFuIGluc3RhbmNlIG9mIEVtYmVyLkFwcGxpY2F0aW9uIiwgdGhpcyBpbnN0
YW5jZW9mIEVtYmVyLkFwcGxpY2F0aW9uKTsKICAgIEVtYmVyLmFzc2VydCgiWW91IGNhbm5vdCBk
ZWZlciByZWFkaW5lc3Mgc2luY2UgdGhlIGByZWFkeSgpYCBob29rIGhhcyBhbHJlYWR5IGJlZW4g
Y2FsbGVkLiIsIHRoaXMuX3JlYWRpbmVzc0RlZmVycmFscyA+IDApOwogICAgdGhpcy5fcmVhZGlu
ZXNzRGVmZXJyYWxzKys7CiAgfSwKCiAgLyoqCiAgICBDYWxsIGBhZHZhbmNlUmVhZGluZXNzYCBh
ZnRlciBhbnkgYXN5bmNocm9ub3VzIHNldHVwIGxvZ2ljIGhhcyBjb21wbGV0ZWQuCiAgICBFYWNo
IGNhbGwgdG8gYGRlZmVyUmVhZGluZXNzYCBtdXN0IGJlIG1hdGNoZWQgYnkgYSBjYWxsIHRvIGBh
ZHZhbmNlUmVhZGluZXNzYAogICAgb3IgdGhlIGFwcGxpY2F0aW9uIHdpbGwgbmV2ZXIgYmVjb21l
IHJlYWR5IGFuZCByb3V0aW5nIHdpbGwgbm90IGJlZ2luLgoKICAgIEBtZXRob2QgYWR2YW5jZVJl
YWRpbmVzcwogICAgQHNlZSB7RW1iZXIuQXBwbGljYXRpb24jZGVmZXJSZWFkaW5lc3N9CiAgKi8K
ICBhZHZhbmNlUmVhZGluZXNzOiBmdW5jdGlvbigpIHsKICAgIEVtYmVyLmFzc2VydCgiWW91IG11
c3QgY2FsbCBhZHZhbmNlUmVhZGluZXNzIG9uIGFuIGluc3RhbmNlIG9mIEVtYmVyLkFwcGxpY2F0
aW9uIiwgdGhpcyBpbnN0YW5jZW9mIEVtYmVyLkFwcGxpY2F0aW9uKTsKICAgIHRoaXMuX3JlYWRp
bmVzc0RlZmVycmFscy0tOwoKICAgIGlmICh0aGlzLl9yZWFkaW5lc3NEZWZlcnJhbHMgPT09IDAp
IHsKICAgICAgRW1iZXIucnVuLm9uY2UodGhpcywgdGhpcy5kaWRCZWNvbWVSZWFkeSk7CiAgICB9
CiAgfSwKCiAgLyoqCiAgICByZWdpc3RlcnMgYSBmYWN0b3J5IGZvciBsYXRlciBpbmplY3Rpb24K
CiAgICBFeGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcCA9IEVtYmVyLkFwcGxpY2F0
aW9uLmNyZWF0ZSgpOwoKICAgIEFwcC5QZXJzb24gID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7fSk7
CiAgICBBcHAuT3JhbmdlICA9IEVtYmVyLk9iamVjdC5leHRlbmQoe30pOwogICAgQXBwLkVtYWls
ICAgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHt9KTsKICAgIEFwcC5zZXNzaW9uID0gRW1iZXIuT2Jq
ZWN0LmNyZWF0ZSh7fSk7CgogICAgQXBwLnJlZ2lzdGVyKCdtb2RlbDp1c2VyJywgQXBwLlBlcnNv
biwge3NpbmdsZXRvbjogZmFsc2UgfSk7CiAgICBBcHAucmVnaXN0ZXIoJ2ZydWl0OmZhdm9yaXRl
JywgQXBwLk9yYW5nZSk7CiAgICBBcHAucmVnaXN0ZXIoJ2NvbW11bmljYXRpb246bWFpbicsIEFw
cC5FbWFpbCwge3NpbmdsZXRvbjogZmFsc2V9KTsKICAgIEFwcC5yZWdpc3Rlcignc2Vzc2lvbics
IEFwcC5zZXNzaW9uLCB7aW5zdGFudGlhdGU6IGZhbHNlfSk7CiAgICBgYGAKCiAgICBAbWV0aG9k
IHJlZ2lzdGVyCiAgICBAcGFyYW0gIGZ1bGxOYW1lIHtTdHJpbmd9IHR5cGU6bmFtZSAoZS5nLiwg
J21vZGVsOnVzZXInKQogICAgQHBhcmFtICBmYWN0b3J5IHtGdW5jdGlvbn0gKGUuZy4sIEFwcC5Q
ZXJzb24pCiAgICBAcGFyYW0gIG9wdGlvbnMge1N0cmluZ30gKG9wdGlvbmFsKQogICoqLwogIHJl
Z2lzdGVyOiBmdW5jdGlvbigpIHsKICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9fY29udGFpbmVy
X187CiAgICBjb250YWluZXIucmVnaXN0ZXIuYXBwbHkoY29udGFpbmVyLCBhcmd1bWVudHMpOwog
IH0sCiAgLyoqCiAgICBkZWZpbmVzIGFuIGluamVjdGlvbiBvciB0eXBlSW5qZWN0aW9uCgogICAg
RXhhbXBsZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAuaW5qZWN0KDxmdWxsX25hbWUgb3Ig
dHlwZT4sIDxwcm9wZXJ0eSBuYW1lPiwgPGZ1bGxfbmFtZT4pCiAgICBBcHAuaW5qZWN0KCdtb2Rl
bDp1c2VyJywgJ2VtYWlsJywgJ21vZGVsOmVtYWlsJykKICAgIEFwcC5pbmplY3QoJ21vZGVsJywg
J3NvdXJjZScsICdzb3VyY2U6bWFpbicpCiAgICBgYGAKCiAgICBAbWV0aG9kIGluamVjdAogICAg
QHBhcmFtICBmYWN0b3J5TmFtZU9yVHlwZSB7U3RyaW5nfQogICAgQHBhcmFtICBwcm9wZXJ0eSB7
U3RyaW5nfQogICAgQHBhcmFtICBpbmplY3Rpb25OYW1lIHtTdHJpbmd9CiAgKiovCiAgaW5qZWN0
OiBmdW5jdGlvbigpIHsKICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9fY29udGFpbmVyX187CiAg
ICBjb250YWluZXIuaW5qZWN0aW9uLmFwcGx5KGNvbnRhaW5lciwgYXJndW1lbnRzKTsKICB9LAoK
ICAvKioKICAgIENhbGxpbmcgaW5pdGlhbGl6ZSBtYW51YWxseSBpcyBub3Qgc3VwcG9ydGVkLgoK
ICAgIFBsZWFzZSBzZWUgRW1iZXIuQXBwbGljYXRpb24jYWR2YW5jZVJlYWRpbmVzcyBhbmQKICAg
IEVtYmVyLkFwcGxpY2F0aW9uI2RlZmVyUmVhZGluZXNzLgoKICAgIEBwcml2YXRlCiAgICBAZGVw
cmVjYXRlZAogICAgQG1ldGhvZCBpbml0aWFsaXplCiAgICoqLwogIGluaXRpYWxpemU6IGZ1bmN0
aW9uKCkgewogICAgRW1iZXIuZGVwcmVjYXRlKCdDYWxsaW5nIGluaXRpYWxpemUgbWFudWFsbHkg
aXMgbm90IHN1cHBvcnRlZC4gUGxlYXNlIHNlZSBFbWJlci5BcHBsaWNhdGlvbiNhZHZhbmNlUmVh
ZGluZXNzIGFuZCBFbWJlci5BcHBsaWNhdGlvbiNkZWZlclJlYWRpbmVzcycpOwogIH0sCiAgLyoq
CiAgICBJbml0aWFsaXplIHRoZSBhcHBsaWNhdGlvbi4gVGhpcyBoYXBwZW5zIGF1dG9tYXRpY2Fs
bHkuCgogICAgUnVuIGFueSBpbml0aWFsaXplcnMgYW5kIHJ1biB0aGUgYXBwbGljYXRpb24gbG9h
ZCBob29rLiBUaGVzZSBob29rcyBtYXkKICAgIGNob29zZSB0byBkZWZlciByZWFkaW5lc3MuIEZv
ciBleGFtcGxlLCBhbiBhdXRoZW50aWNhdGlvbiBob29rIG1pZ2h0IHdhbnQKICAgIHRvIGRlZmVy
IHJlYWRpbmVzcyB1bnRpbCB0aGUgYXV0aCB0b2tlbiBoYXMgYmVlbiByZXRyaWV2ZWQuCgogICAg
QHByaXZhdGUKICAgIEBtZXRob2QgX2luaXRpYWxpemUKICAqLwogIF9pbml0aWFsaXplOiBmdW5j
dGlvbigpIHsKICAgIGlmICh0aGlzLmlzRGVzdHJveWVkKSB7IHJldHVybjsgfQoKICAgIC8vIEF0
IHRoaXMgcG9pbnQsIHRoZSBBcHAuUm91dGVyIG11c3QgYWxyZWFkeSBiZSBhc3NpZ25lZAogICAg
aWYgKHRoaXMuUm91dGVyKSB7CiAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9fY29udGFpbmVy
X187CiAgICAgIGNvbnRhaW5lci51bnJlZ2lzdGVyKCdyb3V0ZXI6bWFpbicpOwogICAgICBjb250
YWluZXIucmVnaXN0ZXIoJ3JvdXRlcjptYWluJywgdGhpcy5Sb3V0ZXIpOwogICAgfQoKICAgIHRo
aXMucnVuSW5pdGlhbGl6ZXJzKCk7CiAgICBFbWJlci5ydW5Mb2FkSG9va3MoJ2FwcGxpY2F0aW9u
JywgdGhpcyk7CgogICAgLy8gQXQgdGhpcyBwb2ludCwgYW55IGluaXRpYWxpemVycyBvciBsb2Fk
IGhvb2tzIHRoYXQgd291bGQgaGF2ZSB3YW50ZWQKICAgIC8vIHRvIGRlZmVyIHJlYWRpbmVzcyBo
YXZlIGZpcmVkLiBJbiBnZW5lcmFsLCBhZHZhbmNpbmcgcmVhZGluZXNzIGhlcmUKICAgIC8vIHdp
bGwgcHJvY2VlZCB0byBkaWRCZWNvbWVSZWFkeS4KICAgIHRoaXMuYWR2YW5jZVJlYWRpbmVzcygp
OwoKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAgUmVzZXQgdGhlIGFwcGxpY2F0aW9u
LiBUaGlzIGlzIHR5cGljYWxseSB1c2VkIG9ubHkgaW4gdGVzdHMuIEl0IGNsZWFucyB1cAogICAg
dGhlIGFwcGxpY2F0aW9uIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6CgogICAgMS4gRGVhY3RpdmF0
ZSBleGlzdGluZyByb3V0ZXMKICAgIDIuIERlc3Ryb3kgYWxsIG9iamVjdHMgaW4gdGhlIGNvbnRh
aW5lcgogICAgMy4gQ3JlYXRlIGEgbmV3IGFwcGxpY2F0aW9uIGNvbnRhaW5lcgogICAgNC4gUmUt
cm91dGUgdG8gdGhlIGV4aXN0aW5nIHVybAoKICAgIFR5cGljYWwgRXhhbXBsZToKCiAgICBgYGBq
YXZhc2NyaXB0CgogICAgdmFyIEFwcDsKCiAgICBFbWJlci5ydW4oZnVuY3Rpb24oKSB7CiAgICAg
IEFwcCA9IEVtYmVyLkFwcGxpY2F0aW9uLmNyZWF0ZSgpOwogICAgfSk7CgogICAgbW9kdWxlKCJh
Y2NlcHRhbmNlIHRlc3QiLCB7CiAgICAgIHNldHVwOiBmdW5jdGlvbigpIHsKICAgICAgICBBcHAu
cmVzZXQoKTsKICAgICAgfQogICAgfSk7CgogICAgdGVzdCgiZmlyc3QgdGVzdCIsIGZ1bmN0aW9u
KCkgewogICAgICAvLyBBcHAgaXMgZnJlc2hseSByZXNldAogICAgfSk7CgogICAgdGVzdCgiZmly
c3QgdGVzdCIsIGZ1bmN0aW9uKCkgewogICAgICAvLyBBcHAgaXMgYWdhaW4gZnJlc2hseSByZXNl
dAogICAgfSk7CiAgICBgYGAKCiAgICBBZHZhbmNlZCBFeGFtcGxlOgoKICAgIE9jY2FzaW9uYWxs
eSB5b3UgbWF5IHdhbnQgdG8gcHJldmVudCB0aGUgYXBwIGZyb20gaW5pdGlhbGl6aW5nIGR1cmlu
ZwogICAgc2V0dXAuIFRoaXMgY291bGQgZW5hYmxlIGV4dHJhIGNvbmZpZ3VyYXRpb24sIG9yIGVu
YWJsZSBhc3NlcnRpbmcgcHJpb3IKICAgIHRvIHRoZSBhcHAgYmVjb21pbmcgcmVhZHkuCgogICAg
YGBgamF2YXNjcmlwdAoKICAgIHZhciBBcHA7CgogICAgRW1iZXIucnVuKGZ1bmN0aW9uKCkgewog
ICAgICBBcHAgPSBFbWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoKTsKICAgIH0pOwoKICAgIG1vZHVs
ZSgiYWNjZXB0YW5jZSB0ZXN0IiwgewogICAgICBzZXR1cDogZnVuY3Rpb24oKSB7CiAgICAgICAg
RW1iZXIucnVuKGZ1bmN0aW9uKCkgewogICAgICAgICAgQXBwLnJlc2V0KCk7CiAgICAgICAgICBB
cHAuZGVmZXJSZWFkaW5lc3MoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgdGVz
dCgiZmlyc3QgdGVzdCIsIGZ1bmN0aW9uKCkgewogICAgICBvayh0cnVlLCAnc29tZXRoaW5nIGJl
Zm9yZSBhcHAgaXMgaW5pdGlhbGl6ZWQnKTsKCiAgICAgIEVtYmVyLnJ1bihmdW5jdGlvbigpIHsK
ICAgICAgICBBcHAuYWR2YW5jZVJlYWRpbmVzcygpOwogICAgICB9KTsKICAgICAgb2sodHJ1ZSwg
J3NvbWV0aGluZyBhZnRlciBhcHAgaXMgaW5pdGlhbGl6ZWQnKTsKICAgIH0pOwogICAgYGBgCgog
ICAgQG1ldGhvZCByZXNldAogICoqLwogIHJlc2V0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3Jl
YWRpbmVzc0RlZmVycmFscyA9IDE7CgogICAgZnVuY3Rpb24gaGFuZGxlUmVzZXQoKSB7CiAgICAg
IHZhciByb3V0ZXIgPSB0aGlzLl9fY29udGFpbmVyX18ubG9va3VwKCdyb3V0ZXI6bWFpbicpOwog
ICAgICByb3V0ZXIucmVzZXQoKTsKCiAgICAgIEVtYmVyLnJ1bih0aGlzLl9fY29udGFpbmVyX18s
ICdkZXN0cm95Jyk7CgogICAgICB0aGlzLmJ1aWxkQ29udGFpbmVyKCk7CgogICAgICBFbWJlci5y
dW4uc2NoZWR1bGUoJ2FjdGlvbnMnLCB0aGlzLCBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9p
bml0aWFsaXplKCk7CiAgICAgIH0pOwogICAgfQoKICAgIEVtYmVyLnJ1bi5qb2luKHRoaXMsIGhh
bmRsZVJlc2V0KTsKICB9LAoKICAvKioKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIHJ1bkluaXRp
YWxpemVycwogICovCiAgcnVuSW5pdGlhbGl6ZXJzOiBmdW5jdGlvbigpIHsKICAgIHZhciBpbml0
aWFsaXplcnMgPSBnZXQodGhpcy5jb25zdHJ1Y3RvciwgJ2luaXRpYWxpemVycycpLAogICAgICAg
IGNvbnRhaW5lciA9IHRoaXMuX19jb250YWluZXJfXywKICAgICAgICBncmFwaCA9IG5ldyBFbWJl
ci5EQUcoKSwKICAgICAgICBuYW1lc3BhY2UgPSB0aGlzLAogICAgICAgIG5hbWUsIGluaXRpYWxp
emVyOwoKICAgIGZvciAobmFtZSBpbiBpbml0aWFsaXplcnMpIHsKICAgICAgaW5pdGlhbGl6ZXIg
PSBpbml0aWFsaXplcnNbbmFtZV07CiAgICAgIGdyYXBoLmFkZEVkZ2VzKGluaXRpYWxpemVyLm5h
bWUsIGluaXRpYWxpemVyLmluaXRpYWxpemUsIGluaXRpYWxpemVyLmJlZm9yZSwgaW5pdGlhbGl6
ZXIuYWZ0ZXIpOwogICAgfQoKICAgIGdyYXBoLnRvcHNvcnQoZnVuY3Rpb24gKHZlcnRleCkgewog
ICAgICB2YXIgaW5pdGlhbGl6ZXIgPSB2ZXJ0ZXgudmFsdWU7CiAgICAgIEVtYmVyLmFzc2VydCgi
Tm8gYXBwbGljYXRpb24gaW5pdGlhbGl6ZXIgbmFtZWQgJyIrdmVydGV4Lm5hbWUrIiciLCBpbml0
aWFsaXplcik7CiAgICAgIGluaXRpYWxpemVyKGNvbnRhaW5lciwgbmFtZXNwYWNlKTsKICAgIH0p
OwogIH0sCgogIC8qKgogICAgQHByaXZhdGUKICAgIEBtZXRob2QgZGlkQmVjb21lUmVhZHkKICAq
LwogIGRpZEJlY29tZVJlYWR5OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc2V0dXBFdmVudERpc3Bh
dGNoZXIoKTsKICAgIHRoaXMucmVhZHkoKTsgLy8gdXNlciBob29rCiAgICB0aGlzLnN0YXJ0Um91
dGluZygpOwoKICAgIGlmICghRW1iZXIudGVzdGluZykgewogICAgICAvLyBFYWdlcmx5IG5hbWUg
YWxsIGNsYXNzZXMgdGhhdCBhcmUgYWxyZWFkeSBsb2FkZWQKICAgICAgRW1iZXIuTmFtZXNwYWNl
LnByb2Nlc3NBbGwoKTsKICAgICAgRW1iZXIuQk9PVEVEID0gdHJ1ZTsKICAgIH0KCiAgICB0aGlz
LnJlc29sdmUodGhpcyk7CiAgfSwKCiAgLyoqCiAgICBTZXR1cCB1cCB0aGUgZXZlbnQgZGlzcGF0
Y2hlciB0byByZWNlaXZlIGV2ZW50cyBvbiB0aGUKICAgIGFwcGxpY2F0aW9uJ3MgYHJvb3RFbGVt
ZW50YCB3aXRoIGFueSByZWdpc3RlcmVkCiAgICBgY3VzdG9tRXZlbnRzYC4KCiAgICBAcHJpdmF0
ZQogICAgQG1ldGhvZCBzZXR1cEV2ZW50RGlzcGF0Y2hlcgogICovCiAgc2V0dXBFdmVudERpc3Bh
dGNoZXI6IGZ1bmN0aW9uKCkgewogICAgdmFyIGN1c3RvbUV2ZW50cyA9IGdldCh0aGlzLCAnY3Vz
dG9tRXZlbnRzJyksCiAgICAgICAgcm9vdEVsZW1lbnQgPSBnZXQodGhpcywgJ3Jvb3RFbGVtZW50
JyksCiAgICAgICAgZGlzcGF0Y2hlciA9IHRoaXMuX19jb250YWluZXJfXy5sb29rdXAoJ2V2ZW50
X2Rpc3BhdGNoZXI6bWFpbicpOwoKICAgIHNldCh0aGlzLCAnZXZlbnREaXNwYXRjaGVyJywgZGlz
cGF0Y2hlcik7CiAgICBkaXNwYXRjaGVyLnNldHVwKGN1c3RvbUV2ZW50cywgcm9vdEVsZW1lbnQp
OwogIH0sCgogIC8qKgogICAgdHJpZ2dlciBhIG5ldyBjYWxsIHRvIGByb3V0ZWAgd2hlbmV2ZXIg
dGhlIFVSTCBjaGFuZ2VzLgogICAgSWYgdGhlIGFwcGxpY2F0aW9uIGhhcyBhIHJvdXRlciwgdXNl
IGl0IHRvIHJvdXRlIHRvIHRoZSBjdXJyZW50IFVSTCwgYW5kCgogICAgQHByaXZhdGUKICAgIEBt
ZXRob2Qgc3RhcnRSb3V0aW5nCiAgICBAcHJvcGVydHkgcm91dGVyIHtFbWJlci5Sb3V0ZXJ9CiAg
Ki8KICBzdGFydFJvdXRpbmc6IGZ1bmN0aW9uKCkgewogICAgdmFyIHJvdXRlciA9IHRoaXMuX19j
b250YWluZXJfXy5sb29rdXAoJ3JvdXRlcjptYWluJyk7CiAgICBpZiAoIXJvdXRlcikgeyByZXR1
cm47IH0KCiAgICByb3V0ZXIuc3RhcnRSb3V0aW5nKCk7CiAgfSwKCiAgaGFuZGxlVVJMOiBmdW5j
dGlvbih1cmwpIHsKICAgIHZhciByb3V0ZXIgPSB0aGlzLl9fY29udGFpbmVyX18ubG9va3VwKCdy
b3V0ZXI6bWFpbicpOwoKICAgIHJvdXRlci5oYW5kbGVVUkwodXJsKTsKICB9LAoKICAvKioKICAg
IENhbGxlZCB3aGVuIHRoZSBBcHBsaWNhdGlvbiBoYXMgYmVjb21lIHJlYWR5LgogICAgVGhlIGNh
bGwgd2lsbCBiZSBkZWxheWVkIHVudGlsIHRoZSBET00gaGFzIGJlY29tZSByZWFkeS4KCiAgICBA
ZXZlbnQgcmVhZHkKICAqLwogIHJlYWR5OiBFbWJlci5LLAoKICAvKioKICAgIEBkZXByZWNhdGVk
IFVzZSAnUmVzb2x2ZXInIGluc3RlYWQKICAgIFNldCB0aGlzIHRvIHByb3ZpZGUgYW4gYWx0ZXJu
YXRlIGNsYXNzIHRvIGBFbWJlci5EZWZhdWx0UmVzb2x2ZXJgCgoKICAgIEBwcm9wZXJ0eSByZXNv
bHZlcgogICovCiAgcmVzb2x2ZXI6IG51bGwsCgogIC8qKgogICAgU2V0IHRoaXMgdG8gcHJvdmlk
ZSBhbiBhbHRlcm5hdGUgY2xhc3MgdG8gYEVtYmVyLkRlZmF1bHRSZXNvbHZlcmAKCiAgICBAcHJv
cGVydHkgcmVzb2x2ZXIKICAqLwogIFJlc29sdmVyOiBudWxsLAoKICB3aWxsRGVzdHJveTogZnVu
Y3Rpb24oKSB7CiAgICBFbWJlci5CT09URUQgPSBmYWxzZTsKCiAgICB0aGlzLl9fY29udGFpbmVy
X18uZGVzdHJveSgpOwogIH0sCgogIGluaXRpYWxpemVyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAg
ICB0aGlzLmNvbnN0cnVjdG9yLmluaXRpYWxpemVyKG9wdGlvbnMpOwogIH0KfSk7CgpFbWJlci5B
cHBsaWNhdGlvbi5yZW9wZW5DbGFzcyh7CiAgaW5pdGlhbGl6ZXJzOiB7fSwKICBpbml0aWFsaXpl
cjogZnVuY3Rpb24oaW5pdGlhbGl6ZXIpIHsKICAgIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IGlu
aXRpYWxpemVyIGJlaW5nIGFkZGVkIHRvIGEgc3ViY2xhc3MsIHdlIGFyZSBnb2luZyB0byByZW9w
ZW4gdGhlIGNsYXNzCiAgICAvLyB0byBtYWtlIHN1cmUgd2UgaGF2ZSBhIG5ldyBgaW5pdGlhbGl6
ZXJzYCBvYmplY3QsIHdoaWNoIGV4dGVuZHMgZnJvbSB0aGUgcGFyZW50IGNsYXNzJyB1c2luZwog
ICAgLy8gcHJvdG90eXBhbCBpbmhlcml0YW5jZS4gV2l0aG91dCB0aGlzLCBhdHRlbXB0aW5nIHRv
IGFkZCBpbml0aWFsaXplcnMgdG8gdGhlIHN1YmNsYXNzIHdvdWxkCiAgICAvLyBwb2xsdXRlIHRo
ZSBwYXJlbnQgY2xhc3MgYXMgd2VsbCBhcyBvdGhlciBzdWJjbGFzc2VzLgogICAgaWYgKHRoaXMu
c3VwZXJjbGFzcy5pbml0aWFsaXplcnMgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnN1cGVyY2xhc3Mu
aW5pdGlhbGl6ZXJzID09PSB0aGlzLmluaXRpYWxpemVycykgewogICAgICB0aGlzLnJlb3BlbkNs
YXNzKHsKICAgICAgICBpbml0aWFsaXplcnM6IEVtYmVyLmNyZWF0ZSh0aGlzLmluaXRpYWxpemVy
cykKICAgICAgfSk7CiAgICB9CgogICAgRW1iZXIuYXNzZXJ0KCJUaGUgaW5pdGlhbGl6ZXIgJyIg
KyBpbml0aWFsaXplci5uYW1lICsgIicgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkIiwgIXRo
aXMuaW5pdGlhbGl6ZXJzW2luaXRpYWxpemVyLm5hbWVdKTsKICAgIEVtYmVyLmFzc2VydCgiQW4g
aW5pdGlhbGl6ZXIgY2Fubm90IGJlIHJlZ2lzdGVyZWQgd2l0aCBib3RoIGEgYmVmb3JlIGFuZCBh
biBhZnRlciIsICEoaW5pdGlhbGl6ZXIuYmVmb3JlICYmIGluaXRpYWxpemVyLmFmdGVyKSk7CiAg
ICBFbWJlci5hc3NlcnQoIkFuIGluaXRpYWxpemVyIGNhbm5vdCBiZSByZWdpc3RlcmVkIHdpdGhv
dXQgYW4gaW5pdGlhbGl6ZSBmdW5jdGlvbiIsIEVtYmVyLmNhbkludm9rZShpbml0aWFsaXplciwg
J2luaXRpYWxpemUnKSk7CgogICAgdGhpcy5pbml0aWFsaXplcnNbaW5pdGlhbGl6ZXIubmFtZV0g
PSBpbml0aWFsaXplcjsKICB9LAoKICAvKioKICAgIFRoaXMgY3JlYXRlcyBhIGNvbnRhaW5lciB3
aXRoIHRoZSBkZWZhdWx0IEVtYmVyIG5hbWluZyBjb252ZW50aW9ucy4KCiAgICBJdCBhbHNvIGNv
bmZpZ3VyZXMgdGhlIGNvbnRhaW5lcjoKCiAgICAqIHJlZ2lzdGVyZWQgdmlld3MgYXJlIGNyZWF0
ZWQgZXZlcnkgdGltZSB0aGV5IGFyZSBsb29rZWQgdXAgKHRoZXkgYXJlCiAgICAgIG5vdCBzaW5n
bGV0b25zKQogICAgKiByZWdpc3RlcmVkIHRlbXBsYXRlcyBhcmUgbm90IGZhY3RvcmllczsgdGhl
IHJlZ2lzdGVyZWQgdmFsdWUgaXMKICAgICAgcmV0dXJuZWQgZGlyZWN0bHkuCiAgICAqIHRoZSBy
b3V0ZXIgcmVjZWl2ZXMgdGhlIGFwcGxpY2F0aW9uIGFzIGl0cyBgbmFtZXNwYWNlYCBwcm9wZXJ0
eQogICAgKiBhbGwgY29udHJvbGxlcnMgcmVjZWl2ZSB0aGUgcm91dGVyIGFzIHRoZWlyIGB0YXJn
ZXRgIGFuZCBgY29udHJvbGxlcnNgCiAgICAgIHByb3BlcnRpZXMKICAgICogYWxsIGNvbnRyb2xs
ZXJzIHJlY2VpdmUgdGhlIGFwcGxpY2F0aW9uIGFzIHRoZWlyIGBuYW1lc3BhY2VgIHByb3BlcnR5
CiAgICAqIHRoZSBhcHBsaWNhdGlvbiB2aWV3IHJlY2VpdmVzIHRoZSBhcHBsaWNhdGlvbiBjb250
cm9sbGVyIGFzIGl0cwogICAgICBgY29udHJvbGxlcmAgcHJvcGVydHkKICAgICogdGhlIGFwcGxp
Y2F0aW9uIHZpZXcgcmVjZWl2ZXMgdGhlIGFwcGxpY2F0aW9uIHRlbXBsYXRlIGFzIGl0cwogICAg
ICBgZGVmYXVsdFRlbXBsYXRlYCBwcm9wZXJ0eQoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGJ1
aWxkQ29udGFpbmVyCiAgICBAc3RhdGljCiAgICBAcGFyYW0ge0VtYmVyLkFwcGxpY2F0aW9ufSBu
YW1lc3BhY2UgdGhlIGFwcGxpY2F0aW9uIHRvIGJ1aWxkIHRoZQogICAgICBjb250YWluZXIgZm9y
LgogICAgQHJldHVybiB7RW1iZXIuQ29udGFpbmVyfSB0aGUgYnVpbHQgY29udGFpbmVyCiAgKi8K
ICBidWlsZENvbnRhaW5lcjogZnVuY3Rpb24obmFtZXNwYWNlKSB7CiAgICB2YXIgY29udGFpbmVy
ID0gbmV3IEVtYmVyLkNvbnRhaW5lcigpOwoKICAgIEVtYmVyLkNvbnRhaW5lci5kZWZhdWx0Q29u
dGFpbmVyID0gbmV3IERlcHJlY2F0ZWRDb250YWluZXIoY29udGFpbmVyKTsKCiAgICBjb250YWlu
ZXIuc2V0ID0gRW1iZXIuc2V0OwogICAgY29udGFpbmVyLnJlc29sdmVyICA9IHJlc29sdmVyRm9y
KG5hbWVzcGFjZSk7CiAgICBjb250YWluZXIubm9ybWFsaXplID0gY29udGFpbmVyLnJlc29sdmVy
Lm5vcm1hbGl6ZTsKICAgIGNvbnRhaW5lci5kZXNjcmliZSAgPSBjb250YWluZXIucmVzb2x2ZXIu
ZGVzY3JpYmU7CiAgICBjb250YWluZXIubWFrZVRvU3RyaW5nID0gY29udGFpbmVyLnJlc29sdmVy
Lm1ha2VUb1N0cmluZzsKCiAgICBjb250YWluZXIub3B0aW9uc0ZvclR5cGUoJ2NvbXBvbmVudCcs
IHsgc2luZ2xldG9uOiBmYWxzZSB9KTsKICAgIGNvbnRhaW5lci5vcHRpb25zRm9yVHlwZSgndmll
dycsIHsgc2luZ2xldG9uOiBmYWxzZSB9KTsKICAgIGNvbnRhaW5lci5vcHRpb25zRm9yVHlwZSgn
dGVtcGxhdGUnLCB7IGluc3RhbnRpYXRlOiBmYWxzZSB9KTsKICAgIGNvbnRhaW5lci5vcHRpb25z
Rm9yVHlwZSgnaGVscGVyJywgeyBpbnN0YW50aWF0ZTogZmFsc2UgfSk7CgogICAgY29udGFpbmVy
LnJlZ2lzdGVyKCdhcHBsaWNhdGlvbjptYWluJywgbmFtZXNwYWNlLCB7IGluc3RhbnRpYXRlOiBm
YWxzZSB9KTsKCiAgICBjb250YWluZXIucmVnaXN0ZXIoJ2NvbnRyb2xsZXI6YmFzaWMnLCBFbWJl
ci5Db250cm9sbGVyLCB7IGluc3RhbnRpYXRlOiBmYWxzZSB9KTsKICAgIGNvbnRhaW5lci5yZWdp
c3RlcignY29udHJvbGxlcjpvYmplY3QnLCBFbWJlci5PYmplY3RDb250cm9sbGVyLCB7IGluc3Rh
bnRpYXRlOiBmYWxzZSB9KTsKICAgIGNvbnRhaW5lci5yZWdpc3RlcignY29udHJvbGxlcjphcnJh
eScsIEVtYmVyLkFycmF5Q29udHJvbGxlciwgeyBpbnN0YW50aWF0ZTogZmFsc2UgfSk7CiAgICBj
b250YWluZXIucmVnaXN0ZXIoJ3JvdXRlOmJhc2ljJywgRW1iZXIuUm91dGUsIHsgaW5zdGFudGlh
dGU6IGZhbHNlIH0pOwogICAgY29udGFpbmVyLnJlZ2lzdGVyKCdldmVudF9kaXNwYXRjaGVyOm1h
aW4nLCBFbWJlci5FdmVudERpc3BhdGNoZXIpOwoKICAgIGNvbnRhaW5lci5yZWdpc3Rlcigncm91
dGVyOm1haW4nLCAgRW1iZXIuUm91dGVyKTsKICAgIGNvbnRhaW5lci5pbmplY3Rpb24oJ3JvdXRl
cjptYWluJywgJ25hbWVzcGFjZScsICdhcHBsaWNhdGlvbjptYWluJyk7CgogICAgY29udGFpbmVy
LmluamVjdGlvbignY29udHJvbGxlcicsICd0YXJnZXQnLCAncm91dGVyOm1haW4nKTsKICAgIGNv
bnRhaW5lci5pbmplY3Rpb24oJ2NvbnRyb2xsZXInLCAnbmFtZXNwYWNlJywgJ2FwcGxpY2F0aW9u
Om1haW4nKTsKCiAgICBjb250YWluZXIuaW5qZWN0aW9uKCdyb3V0ZScsICdyb3V0ZXInLCAncm91
dGVyOm1haW4nKTsKCiAgICByZXR1cm4gY29udGFpbmVyOwogIH0KfSk7CgovKioKICBUaGlzIGZ1
bmN0aW9uIGRlZmluZXMgdGhlIGRlZmF1bHQgbG9va3VwIHJ1bGVzIGZvciBjb250YWluZXIgbG9v
a3VwczoKCiAgKiB0ZW1wbGF0ZXMgYXJlIGxvb2tlZCB1cCBvbiBgRW1iZXIuVEVNUExBVEVTYAog
ICogb3RoZXIgbmFtZXMgYXJlIGxvb2tlZCB1cCBvbiB0aGUgYXBwbGljYXRpb24gYWZ0ZXIgY2xh
c3NpZnlpbmcgdGhlIG5hbWUuCiAgICBGb3IgZXhhbXBsZSwgYGNvbnRyb2xsZXI6cG9zdGAgbG9v
a3MgdXAgYEFwcC5Qb3N0Q29udHJvbGxlcmAgYnkgZGVmYXVsdC4KICAqIGlmIHRoZSBkZWZhdWx0
IGxvb2t1cCBmYWlscywgbG9vayBmb3IgcmVnaXN0ZXJlZCBjbGFzc2VzIG9uIHRoZSBjb250YWlu
ZXIKCiAgVGhpcyBhbGxvd3MgdGhlIGFwcGxpY2F0aW9uIHRvIHJlZ2lzdGVyIGRlZmF1bHQgaW5q
ZWN0aW9ucyBpbiB0aGUgY29udGFpbmVyCiAgdGhhdCBjb3VsZCBiZSBvdmVycmlkZGVuIGJ5IHRo
ZSBub3JtYWwgbmFtaW5nIGNvbnZlbnRpb24uCgogIEBwcml2YXRlCiAgQG1ldGhvZCByZXNvbHZl
ckZvcgogIEBwYXJhbSB7RW1iZXIuTmFtZXNwYWNlfSBuYW1lc3BhY2UgdGhlIG5hbWVzcGFjZSB0
byBsb29rIGZvciBjbGFzc2VzCiAgQHJldHVybiB7Kn0gdGhlIHJlc29sdmVkIHZhbHVlIGZvciBh
IGdpdmVuIGxvb2t1cAoqLwpmdW5jdGlvbiByZXNvbHZlckZvcihuYW1lc3BhY2UpIHsKICBpZiAo
bmFtZXNwYWNlLmdldCgncmVzb2x2ZXInKSkgewogICAgRW1iZXIuZGVwcmVjYXRlKCdBcHBsaWNh
dGlvbi5yZXNvbHZlciBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIEFwcGxpY2F0aW9uLlJlc29s
dmVyJywgZmFsc2UpOwogIH0KCiAgdmFyIFJlc29sdmVyQ2xhc3MgPSBuYW1lc3BhY2UuZ2V0KCdy
ZXNvbHZlcicpIHx8IG5hbWVzcGFjZS5nZXQoJ1Jlc29sdmVyJykgfHwgRW1iZXIuRGVmYXVsdFJl
c29sdmVyOwogIHZhciByZXNvbHZlciA9IFJlc29sdmVyQ2xhc3MuY3JlYXRlKHsKICAgIG5hbWVz
cGFjZTogbmFtZXNwYWNlCiAgfSk7CgogIGZ1bmN0aW9uIHJlc29sdmUoZnVsbE5hbWUpIHsKICAg
IHJldHVybiByZXNvbHZlci5yZXNvbHZlKGZ1bGxOYW1lKTsKICB9CgogIHJlc29sdmUuZGVzY3Jp
YmUgPSBmdW5jdGlvbihmdWxsTmFtZSkgewogICAgcmV0dXJuIHJlc29sdmVyLmxvb2t1cERlc2Ny
aXB0aW9uKGZ1bGxOYW1lKTsKICB9OwoKICByZXNvbHZlLm1ha2VUb1N0cmluZyA9IGZ1bmN0aW9u
KGZhY3RvcnksIGZ1bGxOYW1lKSB7CiAgICByZXR1cm4gcmVzb2x2ZXIubWFrZVRvU3RyaW5nKGZh
Y3RvcnksIGZ1bGxOYW1lKTsKICB9OwoKICByZXNvbHZlLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKGZ1
bGxOYW1lKSB7CiAgICBpZiAocmVzb2x2ZXIubm9ybWFsaXplKSB7CiAgICAgIHJldHVybiByZXNv
bHZlci5ub3JtYWxpemUoZnVsbE5hbWUpOwogICAgfSBlbHNlIHsKICAgICAgRW1iZXIuZGVwcmVj
YXRlKCdUaGUgUmVzb2x2ZXIgc2hvdWxkIG5vdyBwcm92aWRlIGEgXCdub3JtYWxpemVcJyBmdW5j
dGlvbicsIGZhbHNlKTsKICAgICAgcmV0dXJuIGZ1bGxOYW1lOwogICAgfQogIH07CgogIHJldHVy
biByZXNvbHZlOwp9CgpFbWJlci5ydW5Mb2FkSG9va3MoJ0VtYmVyLkFwcGxpY2F0aW9uJywgRW1i
ZXIuQXBwbGljYXRpb24pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewoKfSkoKTsKCgoKKGZ1bmN0
aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWFwcGxpY2F0aW9uCiov
Cgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LCBzZXQgPSBFbWJlci5zZXQ7CgpmdW5jdGlvbiB2ZXJpZnlO
ZWVkc0RlcGVuZGVuY2llcyhjb250cm9sbGVyLCBjb250YWluZXIsIG5lZWRzKSB7CiAgdmFyIGRl
cGVuZGVuY3ksIGksIGwsIG1pc3NpbmcgPSBbXTsKCiAgZm9yIChpPTAsIGw9bmVlZHMubGVuZ3Ro
OyBpPGw7IGkrKykgewogICAgZGVwZW5kZW5jeSA9IG5lZWRzW2ldOwoKICAgIEVtYmVyLmFzc2Vy
dChFbWJlci5pbnNwZWN0KGNvbnRyb2xsZXIpICsgIiNuZWVkcyBtdXN0IG5vdCBzcGVjaWZ5IGRl
cGVuZGVuY2llcyB3aXRoIHBlcmlvZHMgaW4gdGhlaXIgbmFtZXMgKCIgKyBkZXBlbmRlbmN5ICsg
IikiLCBkZXBlbmRlbmN5LmluZGV4T2YoJy4nKSA9PT0gLTEpOwoKICAgIGlmIChkZXBlbmRlbmN5
LmluZGV4T2YoJzonKSA9PT0gLTEpIHsKICAgICAgZGVwZW5kZW5jeSA9ICJjb250cm9sbGVyOiIg
KyBkZXBlbmRlbmN5OwogICAgfQoKICAgIC8vIFN0cnVjdHVyZSBhc3NlcnQgdG8gc3RpbGwgZG8g
dmVyaWZpY2F0aW9uIGJ1dCBub3Qgc3RyaW5nIGNvbmNhdCBpbiBwcm9kdWN0aW9uCiAgICBpZiAo
IWNvbnRhaW5lci5oYXMoZGVwZW5kZW5jeSkpIHsKICAgICAgbWlzc2luZy5wdXNoKGRlcGVuZGVu
Y3kpOwogICAgfQogIH0KICBpZiAobWlzc2luZy5sZW5ndGgpIHsKICAgIHRocm93IG5ldyBFbWJl
ci5FcnJvcihFbWJlci5pbnNwZWN0KGNvbnRyb2xsZXIpICsgIiBuZWVkcyBbICIgKyBtaXNzaW5n
LmpvaW4oJywgJykgKyAiIF0gYnV0ICIgKyAobWlzc2luZy5sZW5ndGggPiAxID8gJ3RoZXknIDog
J2l0JykgKyAiIGNvdWxkIG5vdCBiZSBmb3VuZCIpOwogIH0KfQoKdmFyIGRlZmF1bHRDb250cm9s
bGVyc0NvbXB1dGVkUHJvcGVydHkgPSBFbWJlci5jb21wdXRlZChmdW5jdGlvbigpIHsKICB2YXIg
Y29udHJvbGxlciA9IHRoaXM7CgogIHJldHVybiB7CiAgICBuZWVkczogZ2V0KGNvbnRyb2xsZXIs
ICduZWVkcycpLAogICAgY29udGFpbmVyOiBnZXQoY29udHJvbGxlciwgJ2NvbnRhaW5lcicpLAog
ICAgdW5rbm93blByb3BlcnR5OiBmdW5jdGlvbihjb250cm9sbGVyTmFtZSkgewogICAgICB2YXIg
bmVlZHMgPSB0aGlzLm5lZWRzLAogICAgICAgIGRlcGVuZGVuY3ksIGksIGw7CiAgICAgIGZvciAo
aT0wLCBsPW5lZWRzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICBkZXBlbmRlbmN5ID0gbmVl
ZHNbaV07CiAgICAgICAgaWYgKGRlcGVuZGVuY3kgPT09IGNvbnRyb2xsZXJOYW1lKSB7CiAgICAg
ICAgICByZXR1cm4gdGhpcy5jb250YWluZXIubG9va3VwKCdjb250cm9sbGVyOicgKyBjb250cm9s
bGVyTmFtZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgZXJyb3JNZXNzYWdlID0gRW1i
ZXIuaW5zcGVjdChjb250cm9sbGVyKSArICcjbmVlZHMgZG9lcyBub3QgaW5jbHVkZSBgJyArIGNv
bnRyb2xsZXJOYW1lICsgJ2AuIFRvIGFjY2VzcyB0aGUgJyArIGNvbnRyb2xsZXJOYW1lICsgJyBj
b250cm9sbGVyIGZyb20gJyArIEVtYmVyLmluc3BlY3QoY29udHJvbGxlcikgKyAnLCAnICsgRW1i
ZXIuaW5zcGVjdChjb250cm9sbGVyKSArICcgc2hvdWxkIGhhdmUgYSBgbmVlZHNgIHByb3BlcnR5
IHRoYXQgaXMgYW4gYXJyYXkgb2YgdGhlIGNvbnRyb2xsZXJzIGl0IGhhcyBhY2Nlc3MgdG8uJzsK
ICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKGVycm9yTWVzc2FnZSk7CiAgICB9LAogICAg
c2V0VW5rbm93blByb3BlcnR5OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICB0aHJvdyBu
ZXcgRXJyb3IoIllvdSBjYW5ub3Qgb3ZlcndyaXRlIHRoZSB2YWx1ZSBvZiBgY29udHJvbGxlcnMu
IiArIGtleSArICJgIG9mICIgKyBFbWJlci5pbnNwZWN0KGNvbnRyb2xsZXIpKTsKICAgIH0KICB9
Owp9KTsKCi8qKgogIEBjbGFzcyBDb250cm9sbGVyTWl4aW4KICBAbmFtZXNwYWNlIEVtYmVyCiov
CkVtYmVyLkNvbnRyb2xsZXJNaXhpbi5yZW9wZW4oewogIGNvbmNhdGVuYXRlZFByb3BlcnRpZXM6
IFsnbmVlZHMnXSwKCiAgLyoqCiAgICBBbiBhcnJheSBvZiBvdGhlciBjb250cm9sbGVyIG9iamVj
dHMgYXZhaWxhYmxlIGluc2lkZQogICAgaW5zdGFuY2VzIG9mIHRoaXMgY29udHJvbGxlciB2aWEg
dGhlIGBjb250cm9sbGVyc2AKICAgIHByb3BlcnR5OgoKICAgIEZvciBleGFtcGxlLCB3aGVuIHlv
dSBkZWZpbmUgYSBjb250cm9sbGVyOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5Db21tZW50
c0NvbnRyb2xsZXIgPSBFbWJlci5BcnJheUNvbnRyb2xsZXIuZXh0ZW5kKHsKICAgICAgbmVlZHM6
IFsncG9zdCddCiAgICB9KTsKICAgIGBgYAoKICAgIFRoZSBhcHBsaWNhdGlvbidzIHNpbmdsZSBp
bnN0YW5jZSBvZiB0aGVzZSBvdGhlcgogICAgY29udHJvbGxlcnMgYXJlIGFjY2Vzc2libGUgYnkg
bmFtZSB0aHJvdWdoIHRoZQogICAgYGNvbnRyb2xsZXJzYCBwcm9wZXJ0eToKCiAgICBgYGBqYXZh
c2NyaXB0CiAgICB0aGlzLmdldCgnY29udHJvbGxlcnMucG9zdCcpOyAvLyBpbnN0YW5jZSBvZiBB
cHAuUG9zdENvbnRyb2xsZXIKICAgIGBgYAoKICAgIEdpdmVuIHRoYXQgeW91IGhhdmUgYSBuZXN0
ZWQgY29udHJvbGxlciAobmVzdGVkIHJlc291cmNlKToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBB
cHAuQ29tbWVudHNOZXdDb250cm9sbGVyID0gRW1iZXIuT2JqZWN0Q29udHJvbGxlci5leHRlbmQo
ewogICAgfSk7CiAgICBgYGAKCiAgICBXaGVuIHlvdSBkZWZpbmUgYSBjb250cm9sbGVyIHRoYXQg
cmVxdWlyZXMgYWNjZXNzIHRvIGEgbmVzdGVkIG9uZToKCiAgICBgYGBqYXZhc2NyaXB0CiAgICBB
cHAuSW5kZXhDb250cm9sbGVyID0gRW1iZXIuT2JqZWN0Q29udHJvbGxlci5leHRlbmQoewogICAg
ICBuZWVkczogWydjb21tZW50c05ldyddCiAgICB9KTsKICAgIGBgYAoKICAgIFlvdSB3aWxsIGJl
IGFibGUgdG8gZ2V0IGFjY2VzcyB0byBpdDoKCiAgICBgYGBqYXZhc2NyaXB0CiAgICB0aGlzLmdl
dCgnY29udHJvbGxlcnMuY29tbWVudHNOZXcnKTsgLy8gaW5zdGFuY2Ugb2YgQXBwLkNvbW1lbnRz
TmV3Q29udHJvbGxlcgogICAgYGBgCgogICAgVGhpcyBpcyBvbmx5IGF2YWlsYWJsZSBmb3Igc2lu
Z2xldG9uIGNvbnRyb2xsZXJzLgoKICAgIEBwcm9wZXJ0eSB7QXJyYXl9IG5lZWRzCiAgICBAZGVm
YXVsdCBbXQogICovCiAgbmVlZHM6IFtdLAoKICBpbml0OiBmdW5jdGlvbigpIHsKICAgIHZhciBu
ZWVkcyA9IGdldCh0aGlzLCAnbmVlZHMnKSwKICAgIGxlbmd0aCA9IGdldChuZWVkcywgJ2xlbmd0
aCcpOwoKICAgIGlmIChsZW5ndGggPiAwKSB7CiAgICAgIEVtYmVyLmFzc2VydCgnIGAnICsgRW1i
ZXIuaW5zcGVjdCh0aGlzKSArICcgc3BlY2lmaWVzIGBuZWVkc2AsIGJ1dCBkb2VzICcgKwogICAg
ICAgICAgICAgICAgICAgIm5vdCBoYXZlIGEgY29udGFpbmVyLiBQbGVhc2UgZW5zdXJlIHRoaXMg
Y29udHJvbGxlciB3YXMgIiArCiAgICAgICAgICAgICAgICAgICAiaW5zdGFudGlhdGVkIHdpdGgg
YSBjb250YWluZXIuIiwKICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyIHx8IEVtYmVy
Lm1ldGEodGhpcywgZmFsc2UpLmRlc2NzLmNvbnRyb2xsZXJzICE9PSBkZWZhdWx0Q29udHJvbGxl
cnNDb21wdXRlZFByb3BlcnR5KTsKCiAgICAgIGlmICh0aGlzLmNvbnRhaW5lcikgewogICAgICAg
IHZlcmlmeU5lZWRzRGVwZW5kZW5jaWVzKHRoaXMsIHRoaXMuY29udGFpbmVyLCBuZWVkcyk7CiAg
ICAgIH0KCiAgICAgIC8vIGlmIG5lZWRzIHRoZW4gaW5pdGlhbGl6ZSBjb250cm9sbGVycyBwcm94
eQogICAgICBnZXQodGhpcywgJ2NvbnRyb2xsZXJzJyk7CiAgICB9CgogICAgdGhpcy5fc3VwZXIu
YXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9LAoKICAvKioKICAgIEBtZXRob2QgY29udHJvbGxl
ckZvcgogICAgQHNlZSB7RW1iZXIuUm91dGUjY29udHJvbGxlckZvcn0KICAgIEBkZXByZWNhdGVk
IFVzZSBgbmVlZHNgIGluc3RlYWQKICAqLwogIGNvbnRyb2xsZXJGb3I6IGZ1bmN0aW9uKGNvbnRy
b2xsZXJOYW1lKSB7CiAgICBFbWJlci5kZXByZWNhdGUoIkNvbnRyb2xsZXIjY29udHJvbGxlckZv
ciBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIENvbnRyb2xsZXIjbmVlZHMgaW5zdGVhZCIpOwog
ICAgcmV0dXJuIEVtYmVyLmNvbnRyb2xsZXJGb3IoZ2V0KHRoaXMsICdjb250YWluZXInKSwgY29u
dHJvbGxlck5hbWUpOwogIH0sCgogIC8qKgogICAgU3RvcmVzIHRoZSBpbnN0YW5jZXMgb2Ygb3Ro
ZXIgY29udHJvbGxlcnMgYXZhaWxhYmxlIGZyb20gd2l0aGluCiAgICB0aGlzIGNvbnRyb2xsZXIu
IEFueSBjb250cm9sbGVyIGxpc3RlZCBieSBuYW1lIGluIHRoZSBgbmVlZHNgCiAgICBwcm9wZXJ0
eSB3aWxsIGJlIGFjY2Vzc2libGUgYnkgbmFtZSB0aHJvdWdoIHRoaXMgcHJvcGVydHkuCgogICAg
YGBgamF2YXNjcmlwdAogICAgQXBwLkNvbW1lbnRzQ29udHJvbGxlciA9IEVtYmVyLkFycmF5Q29u
dHJvbGxlci5leHRlbmQoewogICAgICBuZWVkczogWydwb3N0J10sCiAgICAgIHBvc3RUaXRsZTog
ZnVuY3Rpb24oKXsKICAgICAgICB2YXIgY3VycmVudFBvc3QgPSB0aGlzLmdldCgnY29udHJvbGxl
cnMucG9zdCcpOyAvLyBpbnN0YW5jZSBvZiBBcHAuUG9zdENvbnRyb2xsZXIKICAgICAgICByZXR1
cm4gY3VycmVudFBvc3QuZ2V0KCd0aXRsZScpOwogICAgICB9LnByb3BlcnR5KCdjb250cm9sbGVy
cy5wb3N0LnRpdGxlJykKICAgIH0pOwogICAgYGBgCgogICAgQHNlZSB7RW1iZXIuQ29udHJvbGxl
ck1peGluI25lZWRzfQogICAgQHByb3BlcnR5IHtPYmplY3R9IGNvbnRyb2xsZXJzCiAgICBAZGVm
YXVsdCBudWxsCiAgKi8KICBjb250cm9sbGVyczogZGVmYXVsdENvbnRyb2xsZXJzQ29tcHV0ZWRQ
cm9wZXJ0eQp9KTsKCn0pKCk7CgoKCihmdW5jdGlvbigpIHsKCn0pKCk7CgoKCihmdW5jdGlvbigp
IHsKLyoqCkVtYmVyIEFwcGxpY2F0aW9uCgpAbW9kdWxlIGVtYmVyCkBzdWJtb2R1bGUgZW1iZXIt
YXBwbGljYXRpb24KQHJlcXVpcmVzIGVtYmVyLXZpZXdzLCBlbWJlci1yb3V0aW5nCiovCgp9KSgp
OwoKKGZ1bmN0aW9uKCkgewovKioKQG1vZHVsZSBlbWJlcgpAc3VibW9kdWxlIGVtYmVyLWV4dGVu
c2lvbi1zdXBwb3J0CiovCi8qKgogIFRoZSBgRGF0YUFkYXB0ZXJgIGhlbHBzIGEgZGF0YSBwZXJz
aXN0ZW5jZSBsaWJyYXJ5CiAgaW50ZXJmYWNlIHdpdGggdG9vbHMgdGhhdCBkZWJ1ZyBFbWJlciBz
dWNoCiAgYXMgdGhlIFtFbWJlciBFeHRlbnNpb25dKGh0dHBzOi8vZ2l0aHViLmNvbS90aWxkZWlv
L2VtYmVyLWV4dGVuc2lvbikKICBmb3IgQ2hyb21lIGFuZCBGaXJlZm94LgoKICBUaGlzIGNsYXNz
IHdpbGwgYmUgZXh0ZW5kZWQgYnkgYSBwZXJzaXN0ZW5jZSBsaWJyYXJ5CiAgd2hpY2ggd2lsbCBv
dmVycmlkZSBzb21lIG9mIHRoZSBtZXRob2RzIHdpdGgKICBsaWJyYXJ5LXNwZWNpZmljIGNvZGUu
CgogIFRoZSBtZXRob2RzIGxpa2VseSB0byBiZSBvdmVycmlkZGVuIGFyZToKCiAgKiBgZ2V0Rmls
dGVyc2AKICAqIGBkZXRlY3RgCiAgKiBgY29sdW1uc0ZvclR5cGVgCiAgKiBgZ2V0UmVjb3Jkc2AK
ICAqIGBnZXRSZWNvcmRDb2x1bW5WYWx1ZXNgCiAgKiBgZ2V0UmVjb3JkS2V5d29yZHNgCiAgKiBg
Z2V0UmVjb3JkRmlsdGVyVmFsdWVzYAogICogYGdldFJlY29yZENvbG9yYAogICogYG9ic2VydmVS
ZWNvcmRgCgogIFRoZSBhZGFwdGVyIHdpbGwgbmVlZCB0byBiZSByZWdpc3RlcmVkCiAgaW4gdGhl
IGFwcGxpY2F0aW9uJ3MgY29udGFpbmVyIGFzIGBkYXRhQWRhcHRlcjptYWluYAoKICBFeGFtcGxl
OgoKICBgYGBqYXZhc2NyaXB0CiAgQXBwbGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAgbmFtZTog
ImRhdGFBZGFwdGVyIiwKCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIGFwcGxp
Y2F0aW9uKSB7CiAgICAgIGFwcGxpY2F0aW9uLnJlZ2lzdGVyKCdkYXRhQWRhcHRlcjptYWluJywg
RFMuRGF0YUFkYXB0ZXIpOwogICAgfQogIH0pOwogIGBgYAoKICBAY2xhc3MgRGF0YUFkYXB0ZXIK
ICBAbmFtZXNwYWNlIEVtYmVyCiAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0CiovCkVtYmVyLkRhdGFB
ZGFwdGVyID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICB0
aGlzLl9zdXBlcigpOwogICAgdGhpcy5yZWxlYXNlTWV0aG9kcyA9IEVtYmVyLkEoKTsKICB9LAoK
ICAvKioKICAgIFRoZSBjb250YWluZXIgb2YgdGhlIGFwcGxpY2F0aW9uIGJlaW5nIGRlYnVnZ2Vk
LgogICAgVGhpcyBwcm9wZXJ0eSB3aWxsIGJlIGluamVjdGVkCiAgICBvbiBjcmVhdGlvbi4KCiAg
ICBAcHJvcGVydHkgY29udGFpbmVyCiAgICBAZGVmYXVsdCBudWxsCiAgKi8KICBjb250YWluZXI6
IG51bGwsCgogIC8qKgogICAgTnVtYmVyIG9mIGF0dHJpYnV0ZXMgdG8gc2VuZAogICAgYXMgY29s
dW1ucy4gKEVub3VnaCB0byBtYWtlIHRoZSByZWNvcmQKICAgIGlkZW50aWZpYWJsZSkuCgogICAg
QHByaXZhdGUKICAgIEBwcm9wZXJ0eSBhdHRyaWJ1dGVMaW1pdAogICAgQGRlZmF1bHQgMwogICov
CiAgYXR0cmlidXRlTGltaXQ6IDMsCgogIC8qKgogICAgU3RvcmVzIGFsbCBtZXRob2RzIHRoYXQg
Y2xlYXIgb2JzZXJ2ZXJzLgogICAgVGhlc2UgbWV0aG9kcyB3aWxsIGJlIGNhbGxlZCBvbiBkZXN0
cnVjdGlvbi4KCiAgICBAcHJpdmF0ZQogICAgQHByb3BlcnR5IHJlbGVhc2VNZXRob2RzCiAgKi8K
ICByZWxlYXNlTWV0aG9kczogRW1iZXIuQSgpLAoKICAvKioKICAgIFNwZWNpZmllcyBob3cgcmVj
b3JkcyBjYW4gYmUgZmlsdGVyZWQuCiAgICBSZWNvcmRzIHJldHVybmVkIHdpbGwgbmVlZCB0byBo
YXZlIGEgYGZpbHRlclZhbHVlc2AKICAgIHByb3BlcnR5IHdpdGggYSBrZXkgZm9yIGV2ZXJ5IG5h
bWUgaW4gdGhlIHJldHVybmVkIGFycmF5LgoKICAgIEBwdWJsaWMKICAgIEBtZXRob2QgZ2V0Rmls
dGVycwogICAgQHJldHVybiB7QXJyYXl9IExpc3Qgb2Ygb2JqZWN0cyBkZWZpbmluZyBmaWx0ZXJz
LgogICAgIFRoZSBvYmplY3Qgc2hvdWxkIGhhdmUgYSBgbmFtZWAgYW5kIGBkZXNjYCBwcm9wZXJ0
eS4KICAqLwogIGdldEZpbHRlcnM6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEVtYmVyLkEoKTsK
ICB9LAoKICAvKioKICAgIEZldGNoIHRoZSBtb2RlbCB0eXBlcyBhbmQgb2JzZXJ2ZSB0aGVtIGZv
ciBjaGFuZ2VzLgoKICAgIEBwdWJsaWMKICAgIEBtZXRob2Qgd2F0Y2hNb2RlbFR5cGVzCgogICAg
QHBhcmFtIHtGdW5jdGlvbn0gdHlwZXNBZGRlZCBDYWxsYmFjayB0byBjYWxsIHRvIGFkZCB0eXBl
cy4KICAgIFRha2VzIGFuIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyB3cmFwcGVkIHR5cGVz
IChyZXR1cm5lZCBmcm9tIGB3cmFwTW9kZWxUeXBlYCkuCgogICAgQHBhcmFtIHtGdW5jdGlvbn0g
dHlwZXNVcGRhdGVkIENhbGxiYWNrIHRvIGNhbGwgd2hlbiBhIHR5cGUgaGFzIGNoYW5nZWQuCiAg
ICBUYWtlcyBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgd3JhcHBlZCB0eXBlcy4KCiAg
ICBAcmV0dXJuIHtGdW5jdGlvbn0gTWV0aG9kIHRvIGNhbGwgdG8gcmVtb3ZlIGFsbCBvYnNlcnZl
cnMKICAqLwogIHdhdGNoTW9kZWxUeXBlczogZnVuY3Rpb24odHlwZXNBZGRlZCwgdHlwZXNVcGRh
dGVkKSB7CiAgICB2YXIgbW9kZWxUeXBlcyA9IHRoaXMuZ2V0TW9kZWxUeXBlcygpLAogICAgICAg
IHNlbGYgPSB0aGlzLCB0eXBlc1RvU2VuZCwgcmVsZWFzZU1ldGhvZHMgPSBFbWJlci5BKCk7Cgog
ICAgdHlwZXNUb1NlbmQgPSBtb2RlbFR5cGVzLm1hcChmdW5jdGlvbih0eXBlKSB7CiAgICAgIHZh
ciB3cmFwcGVkID0gc2VsZi53cmFwTW9kZWxUeXBlKHR5cGUpOwogICAgICByZWxlYXNlTWV0aG9k
cy5wdXNoKHNlbGYub2JzZXJ2ZU1vZGVsVHlwZSh0eXBlLCB0eXBlc1VwZGF0ZWQpKTsKICAgICAg
cmV0dXJuIHdyYXBwZWQ7CiAgICB9KTsKCiAgICB0eXBlc0FkZGVkKHR5cGVzVG9TZW5kKTsKCiAg
ICB2YXIgcmVsZWFzZSA9IGZ1bmN0aW9uKCkgewogICAgICByZWxlYXNlTWV0aG9kcy5mb3JFYWNo
KGZ1bmN0aW9uKGZuKSB7IGZuKCk7IH0pOwogICAgICBzZWxmLnJlbGVhc2VNZXRob2RzLnJlbW92
ZU9iamVjdChyZWxlYXNlKTsKICAgIH07CiAgICB0aGlzLnJlbGVhc2VNZXRob2RzLnB1c2hPYmpl
Y3QocmVsZWFzZSk7CiAgICByZXR1cm4gcmVsZWFzZTsKICB9LAoKICAvKioKICAgIEZldGNoIHRo
ZSByZWNvcmRzIG9mIGEgZ2l2ZW4gdHlwZSBhbmQgb2JzZXJ2ZSB0aGVtIGZvciBjaGFuZ2VzLgoK
ICAgIEBwdWJsaWMKICAgIEBtZXRob2Qgd2F0Y2hSZWNvcmRzCgogICAgQHBhcmFtIHtGdW5jdGlv
bn0gcmVjb3Jkc0FkZGVkIENhbGxiYWNrIHRvIGNhbGwgdG8gYWRkIHJlY29yZHMuCiAgICBUYWtl
cyBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgd3JhcHBlZCByZWNvcmRzLgogICAgVGhl
IG9iamVjdCBzaG91bGQgaGF2ZSB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgICAgIGNvbHVt
blZhbHVlczoge09iamVjdH0ga2V5IGFuZCB2YWx1ZSBvZiBhIHRhYmxlIGNlbGwKICAgICAgb2Jq
ZWN0OiB7T2JqZWN0fSB0aGUgYWN0dWFsIHJlY29yZCBvYmplY3QKCiAgICBAcGFyYW0ge0Z1bmN0
aW9ufSByZWNvcmRzVXBkYXRlZCBDYWxsYmFjayB0byBjYWxsIHdoZW4gYSByZWNvcmQgaGFzIGNo
YW5nZWQuCiAgICBUYWtlcyBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgd3JhcHBlZCBy
ZWNvcmRzLgoKICAgIEBwYXJhbSB7RnVuY3Rpb259IHJlY29yZHNSZW1vdmVkIENhbGxiYWNrIHRv
IGNhbGwgd2hlbiBhIHJlY29yZCBoYXMgcmVtb3ZlZC4KICAgIFRha2VzIHRoZSBmb2xsb3dpbmcg
cGFyYW1ldGVyczoKICAgICAgaW5kZXg6IHRoZSBhcnJheSBpbmRleCB3aGVyZSB0aGUgcmVjb3Jk
cyB3ZXJlIHJlbW92ZWQKICAgICAgY291bnQ6IHRoZSBudW1iZXIgb2YgcmVjb3JkcyByZW1vdmVk
CgogICAgQHJldHVybiB7RnVuY3Rpb259IE1ldGhvZCB0byBjYWxsIHRvIHJlbW92ZSBhbGwgb2Jz
ZXJ2ZXJzCiAgKi8KICB3YXRjaFJlY29yZHM6IGZ1bmN0aW9uKHR5cGUsIHJlY29yZHNBZGRlZCwg
cmVjb3Jkc1VwZGF0ZWQsIHJlY29yZHNSZW1vdmVkKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsIHJl
bGVhc2VNZXRob2RzID0gRW1iZXIuQSgpLCByZWNvcmRzID0gdGhpcy5nZXRSZWNvcmRzKHR5cGUp
LCByZWxlYXNlOwoKICAgIHZhciByZWNvcmRVcGRhdGVkID0gZnVuY3Rpb24odXBkYXRlZFJlY29y
ZCkgewogICAgICByZWNvcmRzVXBkYXRlZChbdXBkYXRlZFJlY29yZF0pOwogICAgfTsKCiAgICB2
YXIgcmVjb3Jkc1RvU2VuZCA9IHJlY29yZHMubWFwKGZ1bmN0aW9uKHJlY29yZCkgewogICAgICBy
ZWxlYXNlTWV0aG9kcy5wdXNoKHNlbGYub2JzZXJ2ZVJlY29yZChyZWNvcmQsIHJlY29yZFVwZGF0
ZWQpKTsKICAgICAgcmV0dXJuIHNlbGYud3JhcFJlY29yZChyZWNvcmQpOwogICAgfSk7CgoKICAg
IHZhciBjb250ZW50RGlkQ2hhbmdlID0gZnVuY3Rpb24oYXJyYXksIGlkeCwgcmVtb3ZlZENvdW50
LCBhZGRlZENvdW50KSB7CiAgICAgIGZvciAodmFyIGkgPSBpZHg7IGkgPCBpZHggKyBhZGRlZENv
dW50OyBpKyspIHsKICAgICAgICB2YXIgcmVjb3JkID0gYXJyYXkub2JqZWN0QXQoaSk7CiAgICAg
ICAgdmFyIHdyYXBwZWQgPSBzZWxmLndyYXBSZWNvcmQocmVjb3JkKTsKICAgICAgICByZWxlYXNl
TWV0aG9kcy5wdXNoKHNlbGYub2JzZXJ2ZVJlY29yZChyZWNvcmQsIHJlY29yZFVwZGF0ZWQpKTsK
ICAgICAgICByZWNvcmRzQWRkZWQoW3dyYXBwZWRdKTsKICAgICAgfQoKICAgICAgaWYgKHJlbW92
ZWRDb3VudCkgewogICAgICAgIHJlY29yZHNSZW1vdmVkKGlkeCwgcmVtb3ZlZENvdW50KTsKICAg
ICAgfQogICAgfTsKCiAgICB2YXIgb2JzZXJ2ZXIgPSB7IGRpZENoYW5nZTogY29udGVudERpZENo
YW5nZSwgd2lsbENoYW5nZTogRW1iZXIuSyB9OwogICAgcmVjb3Jkcy5hZGRBcnJheU9ic2VydmVy
KHNlbGYsIG9ic2VydmVyKTsKCiAgICByZWxlYXNlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJlbGVh
c2VNZXRob2RzLmZvckVhY2goZnVuY3Rpb24oZm4pIHsgZm4oKTsgfSk7CiAgICAgIHJlY29yZHMu
cmVtb3ZlQXJyYXlPYnNlcnZlcihzZWxmLCBvYnNlcnZlcik7CiAgICAgIHNlbGYucmVsZWFzZU1l
dGhvZHMucmVtb3ZlT2JqZWN0KHJlbGVhc2UpOwogICAgfTsKCiAgICByZWNvcmRzQWRkZWQocmVj
b3Jkc1RvU2VuZCk7CgogICAgdGhpcy5yZWxlYXNlTWV0aG9kcy5wdXNoT2JqZWN0KHJlbGVhc2Up
OwogICAgcmV0dXJuIHJlbGVhc2U7CiAgfSwKCiAgLyoqCiAgICBDbGVhciBhbGwgb2JzZXJ2ZXJz
IGJlZm9yZSBkZXN0cnVjdGlvbgogICAgQHByaXZhdGUKICAqLwogIHdpbGxEZXN0cm95OiBmdW5j
dGlvbigpIHsKICAgIHRoaXMuX3N1cGVyKCk7CiAgICB0aGlzLnJlbGVhc2VNZXRob2RzLmZvckVh
Y2goZnVuY3Rpb24oZm4pIHsKICAgICAgZm4oKTsKICAgIH0pOwogIH0sCgogIC8qKgogICAgRGV0
ZWN0IHdoZXRoZXIgYSBjbGFzcyBpcyBhIG1vZGVsLgoKICAgIFRlc3QgdGhhdCBhZ2FpbnN0IHRo
ZSBtb2RlbCBjbGFzcwogICAgb2YgeW91ciBwZXJzaXN0ZW5jZSBsaWJyYXJ5CgogICAgQHByaXZh
dGUKICAgIEBtZXRob2QgZGV0ZWN0CiAgICBAcGFyYW0ge0NsYXNzfSBrbGFzcyBUaGUgY2xhc3Mg
dG8gdGVzdAogICAgQHJldHVybiBib29sZWFuIFdoZXRoZXIgdGhlIGNsYXNzIGlzIGEgbW9kZWwg
Y2xhc3Mgb3Igbm90CiAgKi8KICBkZXRlY3Q6IGZ1bmN0aW9uKGtsYXNzKSB7CiAgICByZXR1cm4g
ZmFsc2U7CiAgfSwKCiAgLyoqCiAgICBHZXQgdGhlIGNvbHVtbnMgZm9yIGEgZ2l2ZW4gbW9kZWwg
dHlwZS4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBjb2x1bW5zRm9yVHlwZQogICAgQHBhcmFt
IHtDbGFzc30gdHlwZSBUaGUgbW9kZWwgdHlwZQogICAgQHJldHVybiB7QXJyYXl9IEFuIGFycmF5
IG9mIGNvbHVtbnMgb2YgdGhlIGZvbGxvd2luZyBmb3JtYXQ6CiAgICAgbmFtZToge1N0cmluZ30g
bmFtZSBvZiB0aGUgY29sdW1uCiAgICAgZGVzYzoge1N0cmluZ30gSHVtYW5pemVkIGRlc2NyaXB0
aW9uICh3aGF0IHdvdWxkIHNob3cgaW4gYSB0YWJsZSBjb2x1bW4gbmFtZSkKICAqLwogIGNvbHVt
bnNGb3JUeXBlOiBmdW5jdGlvbih0eXBlKSB7CiAgICByZXR1cm4gRW1iZXIuQSgpOwogIH0sCgog
IC8qKgogICAgQWRkcyBvYnNlcnZlcnMgdG8gYSBtb2RlbCB0eXBlIGNsYXNzLgoKICAgIEBwcml2
YXRlCiAgICBAbWV0aG9kIG9ic2VydmVNb2RlbFR5cGUKICAgIEBwYXJhbSB7Q2xhc3N9IHR5cGUg
VGhlIG1vZGVsIHR5cGUgY2xhc3MKICAgIEBwYXJhbSB7RnVuY3Rpb259IHR5cGVzVXBkYXRlZCBD
YWxsZWQgd2hlbiBhIHR5cGUgaXMgbW9kaWZpZWQuCiAgICBAcmV0dXJuIHtGdW5jdGlvbn0gVGhl
IGZ1bmN0aW9uIHRvIGNhbGwgdG8gcmVtb3ZlIG9ic2VydmVycwogICovCgogIG9ic2VydmVNb2Rl
bFR5cGU6IGZ1bmN0aW9uKHR5cGUsIHR5cGVzVXBkYXRlZCkgewogICAgdmFyIHNlbGYgPSB0aGlz
LCByZWNvcmRzID0gdGhpcy5nZXRSZWNvcmRzKHR5cGUpOwoKICAgIHZhciBvbkNoYW5nZSA9IGZ1
bmN0aW9uKCkgewogICAgICB0eXBlc1VwZGF0ZWQoW3NlbGYud3JhcE1vZGVsVHlwZSh0eXBlKV0p
OwogICAgfTsKICAgIHZhciBvYnNlcnZlciA9IHsKICAgICAgZGlkQ2hhbmdlOiBmdW5jdGlvbigp
IHsKICAgICAgICBFbWJlci5ydW4uc2NoZWR1bGVPbmNlKCdhY3Rpb25zJywgdGhpcywgb25DaGFu
Z2UpOwogICAgICB9LAogICAgICB3aWxsQ2hhbmdlOiBFbWJlci5LCiAgICB9OwoKICAgIHJlY29y
ZHMuYWRkQXJyYXlPYnNlcnZlcih0aGlzLCBvYnNlcnZlcik7CgogICAgdmFyIHJlbGVhc2UgPSBm
dW5jdGlvbigpIHsKICAgICAgcmVjb3Jkcy5yZW1vdmVBcnJheU9ic2VydmVyKHNlbGYsIG9ic2Vy
dmVyKTsKICAgIH07CgogICAgcmV0dXJuIHJlbGVhc2U7CiAgfSwKCgogIC8qKgogICAgV3JhcHMg
YSBnaXZlbiBtb2RlbCB0eXBlIGFuZCBvYnNlcnZlcyBjaGFuZ2VzIHRvIGl0LgoKICAgIEBwcml2
YXRlCiAgICBAbWV0aG9kIHdyYXBNb2RlbFR5cGUKICAgIEBwYXJhbSB7Q2xhc3N9IHR5cGUgQSBt
b2RlbCBjbGFzcwogICAgQHBhcmFtIHtGdW5jdGlvbn0gdHlwZXNVcGRhdGVkIGNhbGxiYWNrIHRv
IGNhbGwgd2hlbiB0aGUgdHlwZSBjaGFuZ2VzCiAgICBAcmV0dXJuIHtPYmplY3R9IGNvbnRhaW5z
IHRoZSB3cmFwcGVkIHR5cGUgYW5kIHRoZSBmdW5jdGlvbiB0byByZW1vdmUgb2JzZXJ2ZXJzCiAg
ICBGb3JtYXQ6CiAgICAgIHR5cGU6IHtPYmplY3R9IHRoZSB3cmFwcGVkIHR5cGUKICAgICAgICBU
aGUgd3JhcHBlZCB0eXBlIGhhcyB0aGUgZm9sbG93aW5nIGZvcm1hdDoKICAgICAgICAgIG5hbWU6
IHtTdHJpbmd9IG5hbWUgb2YgdGhlIHR5cGUKICAgICAgICAgIGNvdW50OiB7SW50ZWdlcn0gbnVt
YmVyIG9mIHJlY29yZHMgYXZhaWxhYmxlCiAgICAgICAgICBjb2x1bW5zOiB7Q29sdW1uc30gYXJy
YXkgb2YgY29sdW1ucyB0byBkZXNjcmliZSB0aGUgcmVjb3JkCiAgICAgICAgICBvYmplY3Q6IHtD
bGFzc30gdGhlIGFjdHVhbCBNb2RlbCB0eXBlIGNsYXNzCiAgICAgIHJlbGVhc2U6IHtGdW5jdGlv
bn0gVGhlIGZ1bmN0aW9uIHRvIHJlbW92ZSBvYnNlcnZlcnMKICAqLwogIHdyYXBNb2RlbFR5cGU6
IGZ1bmN0aW9uKHR5cGUsIHR5cGVzVXBkYXRlZCkgewogICAgdmFyIHJlbGVhc2UsIHJlY29yZHMg
PSB0aGlzLmdldFJlY29yZHModHlwZSksCiAgICAgICAgdHlwZVRvU2VuZCwgc2VsZiA9IHRoaXM7
CgogICAgdHlwZVRvU2VuZCA9IHsKICAgICAgbmFtZTogdHlwZS50b1N0cmluZygpLAogICAgICBj
b3VudDogRW1iZXIuZ2V0KHJlY29yZHMsICdsZW5ndGgnKSwKICAgICAgY29sdW1uczogdGhpcy5j
b2x1bW5zRm9yVHlwZSh0eXBlKSwKICAgICAgb2JqZWN0OiB0eXBlCiAgICB9OwoKCiAgICByZXR1
cm4gdHlwZVRvU2VuZDsKICB9LAoKCiAgLyoqCiAgICBGZXRjaGVzIGFsbCBtb2RlbHMgZGVmaW5l
ZCBpbiB0aGUgYXBwbGljYXRpb24uCgogICAgQHByaXZhdGUKICAgIEBtZXRob2QgZ2V0TW9kZWxU
eXBlcwogICAgQHJldHVybiB7QXJyYXl9IEFycmF5IG9mIG1vZGVsIHR5cGVzCiAgKi8KCiAvLyBU
T0RPOiBVc2UgdGhlIHJlc29sdmVyIGluc3RlYWQgb2YgbG9vcGluZyBvdmVyIG5hbWVzcGFjZXMu
CiAgZ2V0TW9kZWxUeXBlczogZnVuY3Rpb24oKSB7CiAgICB2YXIgbmFtZXNwYWNlcyA9IEVtYmVy
LkEoRW1iZXIuTmFtZXNwYWNlLk5BTUVTUEFDRVMpLCB0eXBlcyA9IEVtYmVyLkEoKSwgc2VsZiA9
IHRoaXM7CgogICAgbmFtZXNwYWNlcy5mb3JFYWNoKGZ1bmN0aW9uKG5hbWVzcGFjZSkgewogICAg
ICBmb3IgKHZhciBrZXkgaW4gbmFtZXNwYWNlKSB7CiAgICAgICAgaWYgKCFuYW1lc3BhY2UuaGFz
T3duUHJvcGVydHkoa2V5KSkgeyBjb250aW51ZTsgfQogICAgICAgIHZhciBrbGFzcyA9IG5hbWVz
cGFjZVtrZXldOwogICAgICAgIGlmIChzZWxmLmRldGVjdChrbGFzcykpIHsKICAgICAgICAgIHR5
cGVzLnB1c2goa2xhc3MpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdHlw
ZXM7CiAgfSwKCiAgLyoqCiAgICBGZXRjaGVzIGFsbCBsb2FkZWQgcmVjb3JkcyBmb3IgYSBnaXZl
biB0eXBlLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGdldFJlY29yZHMKICAgIEByZXR1cm4g
e0FycmF5fSBBbiBhcnJheSBvZiByZWNvcmRzLgogICAgIFRoaXMgYXJyYXkgd2lsbCBiZSBvYnNl
cnZlZCBmb3IgY2hhbmdlcywKICAgICBzbyBpdCBzaG91bGQgdXBkYXRlIHdoZW4gbmV3IHJlY29y
ZHMgYXJlIGFkZGVkL3JlbW92ZWQuCiAgKi8KICBnZXRSZWNvcmRzOiBmdW5jdGlvbih0eXBlKSB7
CiAgICByZXR1cm4gRW1iZXIuQSgpOwogIH0sCgogIC8qKgogICAgV3JhcHMgYSByZWNvcmQgYW5k
IG9ic2VydmVycyBjaGFuZ2VzIHRvIGl0LgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIHdyYXBS
ZWNvcmQKICAgIEBwYXJhbSB7T2JqZWN0fSByZWNvcmQgVGhlIHJlY29yZCBpbnN0YW5jZS4KICAg
IEByZXR1cm4ge09iamVjdH0gVGhlIHdyYXBwZWQgcmVjb3JkLiBGb3JtYXQ6CiAgICBjb2x1bW5W
YWx1ZXM6IHtBcnJheX0KICAgIHNlYXJjaEtleXdvcmRzOiB7QXJyYXl9CiAgKi8KICB3cmFwUmVj
b3JkOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgIHZhciByZWNvcmRUb1NlbmQgPSB7IG9iamVjdDog
cmVjb3JkIH0sIGNvbHVtblZhbHVlcyA9IHt9LCBzZWxmID0gdGhpczsKCiAgICByZWNvcmRUb1Nl
bmQuY29sdW1uVmFsdWVzID0gdGhpcy5nZXRSZWNvcmRDb2x1bW5WYWx1ZXMocmVjb3JkKTsKICAg
IHJlY29yZFRvU2VuZC5zZWFyY2hLZXl3b3JkcyA9IHRoaXMuZ2V0UmVjb3JkS2V5d29yZHMocmVj
b3JkKTsKICAgIHJlY29yZFRvU2VuZC5maWx0ZXJWYWx1ZXMgPSB0aGlzLmdldFJlY29yZEZpbHRl
clZhbHVlcyhyZWNvcmQpOwogICAgcmVjb3JkVG9TZW5kLmNvbG9yID0gdGhpcy5nZXRSZWNvcmRD
b2xvcihyZWNvcmQpOwoKICAgIHJldHVybiByZWNvcmRUb1NlbmQ7CiAgfSwKCiAgLyoqCiAgICBH
ZXRzIHRoZSB2YWx1ZXMgZm9yIGVhY2ggY29sdW1uLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9k
IGdldFJlY29yZENvbHVtblZhbHVlcwogICAgQHJldHVybiB7T2JqZWN0fSBLZXlzIHNob3VsZCBt
YXRjaCBjb2x1bW4gbmFtZXMgZGVmaW5lZAogICAgYnkgdGhlIG1vZGVsIHR5cGUuCiAgKi8KICBn
ZXRSZWNvcmRDb2x1bW5WYWx1ZXM6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgcmV0dXJuIHt9Owog
IH0sCgogIC8qKgogICAgUmV0dXJucyBrZXl3b3JkcyB0byBtYXRjaCB3aGVuIHNlYXJjaGluZyBy
ZWNvcmRzLgoKICAgIEBwcml2YXRlCiAgICBAbWV0aG9kIGdldFJlY29yZEtleXdvcmRzCiAgICBA
cmV0dXJuIHtBcnJheX0gUmVsZXZhbnQga2V5d29yZHMgZm9yIHNlYXJjaC4KICAqLwogIGdldFJl
Y29yZEtleXdvcmRzOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgIHJldHVybiBFbWJlci5BKCk7CiAg
fSwKCiAgLyoqCiAgICBSZXR1cm5zIHRoZSB2YWx1ZXMgb2YgZmlsdGVycyBkZWZpbmVkIGJ5IGBn
ZXRGaWx0ZXJzYC4KCiAgICBAcHJpdmF0ZQogICAgQG1ldGhvZCBnZXRSZWNvcmRGaWx0ZXJWYWx1
ZXMKICAgIEBwYXJhbSB7T2JqZWN0fSByZWNvcmQgVGhlIHJlY29yZCBpbnN0YW5jZQogICAgQHJl
dHVybiB7T2JqZWN0fSBUaGUgZmlsdGVyIHZhbHVlcwogICovCiAgZ2V0UmVjb3JkRmlsdGVyVmFs
dWVzOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgIHJldHVybiB7fTsKICB9LAoKICAvKioKICAgIEVh
Y2ggcmVjb3JkIGNhbiBoYXZlIGEgY29sb3IgdGhhdCByZXByZXNlbnRzIGl0cyBzdGF0ZS4KCiAg
ICBAcHJpdmF0ZQogICAgQG1ldGhvZCBnZXRSZWNvcmRDb2xvcgogICAgQHBhcmFtIHtPYmplY3R9
IHJlY29yZCBUaGUgcmVjb3JkIGluc3RhbmNlCiAgICBAcmV0dXJuIHtTdHJpbmd9IFRoZSByZWNv
cmQncyBjb2xvcgogICAgICBQb3NzaWJsZSBvcHRpb25zOiBibGFjaywgcmVkLCBibHVlLCBncmVl
bgogICovCiAgZ2V0UmVjb3JkQ29sb3I6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgcmV0dXJuIG51
bGw7CiAgfSwKCiAgLyoqCiAgICBPYnNlcnZlcyBhbGwgcmVsZXZhbnQgcHJvcGVydGllcyBhbmQg
cmUtc2VuZHMgdGhlIHdyYXBwZWQgcmVjb3JkCiAgICB3aGVuIGEgY2hhbmdlIG9jY3Vycy4KCiAg
ICBAcHJpdmF0ZQogICAgQG1ldGhvZCBvYnNlcnZlclJlY29yZAogICAgQHBhcmFtIHtPYmplY3R9
IHJlY29yZCBUaGUgcmVjb3JkIGluc3RhbmNlCiAgICBAcGFyYW0ge0Z1bmN0aW9ufSByZWNvcmRV
cGRhdGVkIFRoZSBjYWxsYmFjayB0byBjYWxsIHdoZW4gYSByZWNvcmQgaXMgdXBkYXRlZC4KICAg
IEByZXR1cm4ge0Z1bmN0aW9ufSBUaGUgZnVuY3Rpb24gdG8gY2FsbCB0byByZW1vdmUgYWxsIG9i
c2VydmVycy4KICAqLwogIG9ic2VydmVSZWNvcmQ6IGZ1bmN0aW9uKHJlY29yZCwgcmVjb3JkVXBk
YXRlZCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKCl7fTsKICB9Cgp9KTsKCgp9KSgpOwoKCgooZnVu
Y3Rpb24oKSB7Ci8qKgpFbWJlciBFeHRlbnNpb24gU3VwcG9ydAoKQG1vZHVsZSBlbWJlcgpAc3Vi
bW9kdWxlIGVtYmVyLWV4dGVuc2lvbi1zdXBwb3J0CkByZXF1aXJlcyBlbWJlci1hcHBsaWNhdGlv
bgoqLwoKfSkoKTsKCihmdW5jdGlvbigpIHsKLyoqCiAgQG1vZHVsZSBlbWJlcgogIEBzdWJtb2R1
bGUgZW1iZXItdGVzdGluZwogKi8KdmFyIHNsaWNlID0gW10uc2xpY2UsCiAgICBoZWxwZXJzID0g
e30sCiAgICBpbmplY3RIZWxwZXJzQ2FsbGJhY2tzID0gW107CgovKioKICBUaGlzIGlzIGEgY29u
dGFpbmVyIGZvciBhbiBhc3NvcnRtZW50IG9mIHRlc3RpbmcgcmVsYXRlZCBmdW5jdGlvbmFsaXR5
OgoKICAqIENob29zZSB5b3VyIGRlZmF1bHQgdGVzdCBhZGFwdGVyIChmb3IgeW91ciBmcmFtZXdv
cmsgb2YgY2hvaWNlKS4KICAqIFJlZ2lzdGVyL1VucmVnaXN0ZXIgYWRkaXRpb25hbCB0ZXN0IGhl
bHBlcnMuCiAgKiBTZXR1cCBjYWxsYmFja3MgdG8gYmUgZmlyZWQgd2hlbiB0aGUgdGVzdCBoZWxw
ZXJzIGFyZSBpbmplY3RlZCBpbnRvCiAgICB5b3VyIGFwcGxpY2F0aW9uLgoKICBAY2xhc3MgVGVz
dAogIEBuYW1lc3BhY2UgRW1iZXIKKi8KRW1iZXIuVGVzdCA9IHsKCiAgLyoqCiAgICBgcmVnaXN0
ZXJIZWxwZXJgIGlzIHVzZWQgdG8gcmVnaXN0ZXIgYSB0ZXN0IGhlbHBlciB0aGF0IHdpbGwgYmUg
aW5qZWN0ZWQKICAgIHdoZW4gYEFwcC5pbmplY3RUZXN0SGVscGVyc2AgaXMgY2FsbGVkLgoKICAg
IFRoZSBoZWxwZXIgbWV0aG9kIHdpbGwgYWx3YXlzIGJlIGNhbGxlZCB3aXRoIHRoZSBjdXJyZW50
IEFwcGxpY2F0aW9uIGFzCiAgICB0aGUgZmlyc3QgcGFyYW1ldGVyLgoKICAgIEZvciBleGFtcGxl
OgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLlRlc3QucmVnaXN0ZXJIZWxwZXIoJ2Jvb3Qn
LCBmdW5jdGlvbihhcHApIHsKICAgICAgRW1iZXIucnVuKGFwcCwgYXBwLmFkdmFuY2VSZWFkaW5l
c3MpOwogICAgfSk7CiAgICBgYGAKCiAgICBUaGlzIGhlbHBlciBjYW4gbGF0ZXIgYmUgY2FsbGVk
IHdpdGhvdXQgYXJndW1lbnRzIGJlY2F1c2UgaXQgd2lsbCBiZQogICAgY2FsbGVkIHdpdGggYGFw
cGAgYXMgdGhlIGZpcnN0IHBhcmFtZXRlci4KCiAgICBgYGBqYXZhc2NyaXB0CiAgICBBcHAgPSBF
bWJlci5BcHBsaWNhdGlvbi5jcmVhdGUoKTsKICAgIEFwcC5pbmplY3RUZXN0SGVscGVycygpOwog
ICAgYm9vdCgpOwogICAgYGBgCgogICAgQHB1YmxpYwogICAgQG1ldGhvZCByZWdpc3RlckhlbHBl
cgogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGhlbHBlciBtZXRob2Qg
dG8gYWRkLgogICAgQHBhcmFtIHtGdW5jdGlvbn0gaGVscGVyTWV0aG9kCiAgICBAcGFyYW0gb3B0
aW9ucyB7T2JqZWN0fQogICovCiAgcmVnaXN0ZXJIZWxwZXI6IGZ1bmN0aW9uKG5hbWUsIGhlbHBl
ck1ldGhvZCkgewogICAgaGVscGVyc1tuYW1lXSA9IHsKICAgICAgbWV0aG9kOiBoZWxwZXJNZXRo
b2QsCiAgICAgIG1ldGE6IHsgd2FpdDogZmFsc2UgfQogICAgfTsKICB9LAoKICAvKioKICAgIGBy
ZWdpc3RlckFzeW5jSGVscGVyYCBpcyB1c2VkIHRvIHJlZ2lzdGVyIGFuIGFzeW5jIHRlc3QgaGVs
cGVyIHRoYXQgd2lsbCBiZSBpbmplY3RlZAogICAgd2hlbiBgQXBwLmluamVjdFRlc3RIZWxwZXJz
YCBpcyBjYWxsZWQuCgogICAgVGhlIGhlbHBlciBtZXRob2Qgd2lsbCBhbHdheXMgYmUgY2FsbGVk
IHdpdGggdGhlIGN1cnJlbnQgQXBwbGljYXRpb24gYXMKICAgIHRoZSBmaXJzdCBwYXJhbWV0ZXIu
CgogICAgRm9yIGV4YW1wbGU6CgogICAgYGBgamF2YXNjcmlwdAogICAgRW1iZXIuVGVzdC5yZWdp
c3RlckFzeW5jSGVscGVyKCdib290JywgZnVuY3Rpb24oYXBwKSB7CiAgICAgIEVtYmVyLnJ1bihh
cHAsIGFwcC5hZHZhbmNlUmVhZGluZXNzKTsKICAgIH0pOwogICAgYGBgCgogICAgVGhlIGFkdmFu
dGFnZSBvZiBhbiBhc3luYyBoZWxwZXIgaXMgdGhhdCBpdCB3aWxsIG5vdCBydW4KICAgIHVudGls
IHRoZSBsYXN0IGFzeW5jIGhlbHBlciBoYXMgY29tcGxldGVkLiAgQWxsIGFzeW5jIGhlbHBlcnMK
ICAgIGFmdGVyIGl0IHdpbGwgd2FpdCBmb3IgaXQgY29tcGxldGUgYmVmb3JlIHJ1bm5pbmcuCgoK
ICAgIEZvciBleGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEVtYmVyLlRlc3QucmVnaXN0
ZXJBc3luY0hlbHBlcignZGVsZXRlUG9zdCcsIGZ1bmN0aW9uKGFwcCwgcG9zdElkKSB7CiAgICAg
IGNsaWNrKCcuZGVsZXRlLScgKyBwb3N0SWQpOwogICAgfSk7CgogICAgLy8gLi4uIGluIHlvdXIg
dGVzdAogICAgdmlzaXQoJy9wb3N0LzInKTsKICAgIGRlbGV0ZVBvc3QoMik7CiAgICB2aXNpdCgn
L3Bvc3QvMycpOwogICAgZGVsZXRlUG9zdCgzKTsKICAgIGBgYAoKICAgIEBwdWJsaWMKICAgIEBt
ZXRob2QgcmVnaXN0ZXJBc3luY0hlbHBlcgogICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5h
bWUgb2YgdGhlIGhlbHBlciBtZXRob2QgdG8gYWRkLgogICAgQHBhcmFtIHtGdW5jdGlvbn0gaGVs
cGVyTWV0aG9kCiAgKi8KICByZWdpc3RlckFzeW5jSGVscGVyOiBmdW5jdGlvbihuYW1lLCBoZWxw
ZXJNZXRob2QpIHsKICAgIGhlbHBlcnNbbmFtZV0gPSB7CiAgICAgIG1ldGhvZDogaGVscGVyTWV0
aG9kLAogICAgICBtZXRhOiB7IHdhaXQ6IHRydWUgfQogICAgfTsKICB9LAoKICAvKioKICAgIFJl
bW92ZSBhIHByZXZpb3VzbHkgYWRkZWQgaGVscGVyIG1ldGhvZC4KCiAgICBFeGFtcGxlOgoKICAg
IGBgYAogICAgRW1iZXIuVGVzdC51bnJlZ2lzdGVySGVscGVyKCd3YWl0Jyk7CiAgICBgYGAKCiAg
ICBAcHVibGljCiAgICBAbWV0aG9kIHVucmVnaXN0ZXJIZWxwZXIKICAgIEBwYXJhbSB7U3RyaW5n
fSBuYW1lIFRoZSBoZWxwZXIgdG8gcmVtb3ZlLgogICovCiAgdW5yZWdpc3RlckhlbHBlcjogZnVu
Y3Rpb24obmFtZSkgewogICAgZGVsZXRlIGhlbHBlcnNbbmFtZV07CiAgICBkZWxldGUgRW1iZXIu
VGVzdC5Qcm9taXNlLnByb3RvdHlwZVtuYW1lXTsKICB9LAoKICAvKioKICAgIFVzZWQgdG8gcmVn
aXN0ZXIgY2FsbGJhY2tzIHRvIGJlIGZpcmVkIHdoZW5ldmVyIGBBcHAuaW5qZWN0VGVzdEhlbHBl
cnNgCiAgICBpcyBjYWxsZWQuCgogICAgVGhlIGNhbGxiYWNrIHdpbGwgcmVjZWl2ZSB0aGUgY3Vy
cmVudCBhcHBsaWNhdGlvbiBhcyBhbiBhcmd1bWVudC4KCiAgICBFeGFtcGxlOgogICAgYGBgCiAg
ICBFbWJlci5UZXN0Lm9uSW5qZWN0SGVscGVycyhmdW5jdGlvbigpIHsKICAgICAgRW1iZXIuJChk
b2N1bWVudCkuYWpheFN0YXJ0KGZ1bmN0aW9uKCkgewogICAgICAgIFRlc3QucGVuZGluZ0FqYXhS
ZXF1ZXN0cysrOwogICAgICB9KTsKCiAgICAgIEVtYmVyLiQoZG9jdW1lbnQpLmFqYXhTdG9wKGZ1
bmN0aW9uKCkgewogICAgICAgIFRlc3QucGVuZGluZ0FqYXhSZXF1ZXN0cy0tOwogICAgICB9KTsK
ICAgIH0pOwogICAgYGBgCgogICAgQHB1YmxpYwogICAgQG1ldGhvZCBvbkluamVjdEhlbHBlcnMK
ICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQu
CiAgKi8KICBvbkluamVjdEhlbHBlcnM6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBpbmplY3RI
ZWxwZXJzQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOwogIH0sCgogIC8qKgogICAgVGhpcyByZXR1
cm5zIGEgdGhlbmFibGUgdGFpbG9yZWQgZm9yIHRlc3RpbmcuICBJdCBjYXRjaGVzIGZhaWxlZAog
ICAgYG9uU3VjY2Vzc2AgY2FsbGJhY2tzIGFuZCBpbnZva2VzIHRoZSBgRW1iZXIuVGVzdC5hZGFw
dGVyLmV4Y2VwdGlvbmAKICAgIGNhbGxiYWNrIGluIHRoZSBsYXN0IGNoYWluZWQgdGhlbi4KCiAg
ICBUaGlzIG1ldGhvZCBzaG91bGQgYmUgcmV0dXJuZWQgYnkgYXN5bmMgaGVscGVycyBzdWNoIGFz
IGB3YWl0YC4KCiAgICBAcHVibGljCiAgICBAbWV0aG9kIHByb21pc2UKICAgIEBwYXJhbSB7RnVu
Y3Rpb259IHJlc29sdmVyIFRoZSBmdW5jdGlvbiB1c2VkIHRvIHJlc29sdmUgdGhlIHByb21pc2Uu
CiAgKi8KICBwcm9taXNlOiBmdW5jdGlvbihyZXNvbHZlcikgewogICAgcmV0dXJuIG5ldyBFbWJl
ci5UZXN0LlByb21pc2UocmVzb2x2ZXIpOwogIH0sCgogIC8qKgogICBVc2VkIHRvIGFsbG93IGVt
YmVyLXRlc3RpbmcgdG8gY29tbXVuaWNhdGUgd2l0aCBhIHNwZWNpZmljIHRlc3RpbmcKICAgZnJh
bWV3b3JrLgoKICAgWW91IGNhbiBtYW51YWxseSBzZXQgaXQgYmVmb3JlIGNhbGxpbmcgYEFwcC5z
ZXR1cEZvclRlc3RpbmcoKWAuCgogICBFeGFtcGxlOgoKICAgYGBgCiAgIEVtYmVyLlRlc3QuYWRh
cHRlciA9IE15Q3VzdG9tQWRhcHRlci5jcmVhdGUoKQogICBgYGAKCiAgIElmIHlvdSBkbyBub3Qg
c2V0IGl0LCBlbWJlci10ZXN0aW5nIHdpbGwgZGVmYXVsdCB0byBgRW1iZXIuVGVzdC5RVW5pdEFk
YXB0ZXJgLgoKICAgQHB1YmxpYwogICBAcHJvcGVydHkgYWRhcHRlcgogICBAdHlwZSB7Q2xhc3N9
IFRoZSBhZGFwdGVyIHRvIGJlIHVzZWQuCiAgIEBkZWZhdWx0IEVtYmVyLlRlc3QuUVVuaXRBZGFw
dGVyCiAgKi8KICBhZGFwdGVyOiBudWxsLAoKICAvKioKICAgIFJlcGxhY2VtZW50IGZvciBgRW1i
ZXIuUlNWUC5yZXNvbHZlYAogICAgVGhlIG9ubHkgZGlmZmVyZW5jZSBpcyB0aGlzIHVzZXMKICAg
IGFuZCBpbnN0YW5jZSBvZiBgRW1iZXIuVGVzdC5Qcm9taXNlYAoKICAgIEBwdWJsaWMKICAgIEBt
ZXRob2QgcmVzb2x2ZQogICAgQHBhcmFtIHtNaXhlZH0gVGhlIHZhbHVlIHRvIHJlc29sdmUKICAq
LwogIHJlc29sdmU6IGZ1bmN0aW9uKHZhbCkgewogICAgcmV0dXJuIEVtYmVyLlRlc3QucHJvbWlz
ZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgIHJldHVybiByZXNvbHZlKHZhbCk7CiAgICB9KTsK
ICB9LAoKICAvKioKICAgICBUaGlzIGFsbG93cyBlbWJlci10ZXN0aW5nIHRvIHBsYXkgbmljZWx5
IHdpdGggb3RoZXIgYXN5bmNocm9ub3VzCiAgICAgZXZlbnRzLCBzdWNoIGFzIGFuIGFwcGxpY2F0
aW9uIHRoYXQgaXMgd2FpdGluZyBmb3IgYSBDU1MzCiAgICAgdHJhbnNpdGlvbiBvciBhbiBJbmRl
eERCIHRyYW5zYWN0aW9uLgoKICAgICBGb3IgZXhhbXBsZToKICAgICBgYGBqYXZhc2NyaXB0CiAg
ICAgRW1iZXIuVGVzdC5yZWdpc3RlcldhaXRlcihmdW5jdGlvbigpIHsKICAgICByZXR1cm4gbXlQ
ZW5kaW5nVHJhbnNhY3Rpb25zKCkgPT0gMDsKICAgICB9KTsKICAgICBgYGAKICAgICBUaGUgYGNv
bnRleHRgIGFyZ3VtZW50IGFsbG93cyB5b3UgdG8gb3B0aW9uYWxseSBzcGVjaWZ5IHRoZSBgdGhp
c2AKICAgICB3aXRoIHdoaWNoIHlvdXIgY2FsbGJhY2sgd2lsbCBiZSBpbnZva2VkLgoKICAgICBG
b3IgZXhhbXBsZToKICAgICBgYGBqYXZhc2NyaXB0CiAgICAgRW1iZXIuVGVzdC5yZWdpc3Rlcldh
aXRlcihNeURCLCBNeURCLmhhc1BlbmRpbmdUcmFuc2FjdGlvbnMpOwogICAgIGBgYAogICAgIEBw
dWJsaWMKICAgICBAbWV0aG9kIHJlZ2lzdGVyV2FpdGVyCiAgICAgQHBhcmFtIHtPYmplY3R9IGNv
bnRleHQgKG9wdGlvbmFsKQogICAgIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgKi8KICBy
ZWdpc3RlcldhaXRlcjogZnVuY3Rpb24oY29udGV4dCwgY2FsbGJhY2spIHsKICAgIGlmIChhcmd1
bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIGNhbGxiYWNrID0gY29udGV4dDsKICAgICAgY29u
dGV4dCA9IG51bGw7CiAgICB9CiAgICBpZiAoIXRoaXMud2FpdGVycykgewogICAgICB0aGlzLndh
aXRlcnMgPSBFbWJlci5BKCk7CiAgICB9CiAgICB0aGlzLndhaXRlcnMucHVzaChbY29udGV4dCwg
Y2FsbGJhY2tdKTsKICB9LAogIC8qKgogICAgIGB1bnJlZ2lzdGVyV2FpdGVyYCBpcyB1c2VkIHRv
IHVucmVnaXN0ZXIgYSBjYWxsYmFjayB0aGF0IHdhcwogICAgIHJlZ2lzdGVyZWQgd2l0aCBgcmVn
aXN0ZXJXYWl0ZXJgLgoKICAgICBAcHVibGljCiAgICAgQG1ldGhvZCB1bnJlZ2lzdGVyV2FpdGVy
CiAgICAgQHBhcmFtIHtPYmplY3R9IGNvbnRleHQgKG9wdGlvbmFsKQogICAgIEBwYXJhbSB7RnVu
Y3Rpb259IGNhbGxiYWNrCiAgKi8KICB1bnJlZ2lzdGVyV2FpdGVyOiBmdW5jdGlvbihjb250ZXh0
LCBjYWxsYmFjaykgewogICAgdmFyIHBhaXI7CiAgICBpZiAoIXRoaXMud2FpdGVycykgeyByZXR1
cm47IH0KICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIGNhbGxiYWNrID0g
Y29udGV4dDsKICAgICAgY29udGV4dCA9IG51bGw7CiAgICB9CiAgICBwYWlyID0gW2NvbnRleHQs
IGNhbGxiYWNrXTsKICAgIHRoaXMud2FpdGVycyA9IEVtYmVyLkEodGhpcy53YWl0ZXJzLmZpbHRl
cihmdW5jdGlvbihlbHQpIHsKICAgICAgcmV0dXJuIEVtYmVyLmNvbXBhcmUoZWx0LCBwYWlyKSE9
PTA7CiAgICB9KSk7CiAgfQp9OwoKZnVuY3Rpb24gaGVscGVyKGFwcCwgbmFtZSkgewogIHZhciBm
biA9IGhlbHBlcnNbbmFtZV0ubWV0aG9kLAogICAgICBtZXRhID0gaGVscGVyc1tuYW1lXS5tZXRh
OwoKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1l
bnRzKSwKICAgICAgICBsYXN0UHJvbWlzZSA9IEVtYmVyLlRlc3QubGFzdFByb21pc2U7CgogICAg
YXJncy51bnNoaWZ0KGFwcCk7CgogICAgLy8gc29tZSBoZWxwZXJzIGFyZSBub3QgYXN5bmMgYW5k
CiAgICAvLyBuZWVkIHRvIHJldHVybiBhIHZhbHVlIGltbWVkaWF0ZWx5LgogICAgLy8gZXhhbXBs
ZTogYGZpbmRgCiAgICBpZiAoIW1ldGEud2FpdCkgewogICAgICByZXR1cm4gZm4uYXBwbHkoYXBw
LCBhcmdzKTsKICAgIH0KCiAgICBpZiAoIWxhc3RQcm9taXNlKSB7CiAgICAgIC8vIEl0J3MgdGhl
IGZpcnN0IGFzeW5jIGhlbHBlciBpbiBjdXJyZW50IGNvbnRleHQKICAgICAgbGFzdFByb21pc2Ug
PSBmbi5hcHBseShhcHAsIGFyZ3MpOwogICAgfSBlbHNlIHsKICAgICAgLy8gd2FpdCBmb3IgbGFz
dCBoZWxwZXIncyBwcm9taXNlIHRvIHJlc29sdmUKICAgICAgLy8gYW5kIHRoZW4gZXhlY3V0ZQog
ICAgICBydW4oZnVuY3Rpb24oKSB7CiAgICAgICAgbGFzdFByb21pc2UgPSBFbWJlci5UZXN0LnJl
c29sdmUobGFzdFByb21pc2UpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZm4u
YXBwbHkoYXBwLCBhcmdzKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJu
IGxhc3RQcm9taXNlOwogIH07Cn0KCmZ1bmN0aW9uIHJ1bihmbikgewogIGlmICghRW1iZXIucnVu
LmN1cnJlbnRSdW5Mb29wKSB7CiAgICBFbWJlci5ydW4oZm4pOwogIH0gZWxzZSB7CiAgICBmbigp
OwogIH0KfQoKRW1iZXIuQXBwbGljYXRpb24ucmVvcGVuKHsKICAvKioKICAgVGhpcyBwcm9wZXJ0
eSBjb250YWlucyB0aGUgdGVzdGluZyBoZWxwZXJzIGZvciB0aGUgY3VycmVudCBhcHBsaWNhdGlv
bi4gVGhlc2UKICAgYXJlIGNyZWF0ZWQgb25jZSB5b3UgY2FsbCBgaW5qZWN0VGVzdEhlbHBlcnNg
IG9uIHlvdXIgYEVtYmVyLkFwcGxpY2F0aW9uYAogICBpbnN0YW5jZS4gVGhlIGluY2x1ZGVkIGhl
bHBlcnMgYXJlIGFsc28gYXZhaWxhYmxlIG9uIHRoZSBgd2luZG93YCBvYmplY3QgYnkKICAgZGVm
YXVsdCwgYnV0IGNhbiBiZSB1c2VkIGZyb20gdGhpcyBvYmplY3Qgb24gdGhlIGluZGl2aWR1YWwg
YXBwbGljYXRpb24gYWxzby4KCiAgICBAcHJvcGVydHkgdGVzdEhlbHBlcnMKICAgIEB0eXBlIHtP
YmplY3R9CiAgICBAZGVmYXVsdCB7fQogICovCiAgdGVzdEhlbHBlcnM6IHt9LAoKICAvKioKICAg
VGhpcyBwcm9wZXJ0eSB3aWxsIGNvbnRhaW4gdGhlIG9yaWdpbmFsIG1ldGhvZHMgdGhhdCB3ZXJl
IHJlZ2lzdGVyZWQKICAgb24gdGhlIGBoZWxwZXJDb250YWluZXJgIGJlZm9yZSBgaW5qZWN0VGVz
dEhlbHBlcnNgIGlzIGNhbGxlZC4KCiAgIFdoZW4gYHJlbW92ZVRlc3RIZWxwZXJzYCBpcyBjYWxs
ZWQsIHRoZXNlIG1ldGhvZHMgYXJlIHJlc3RvcmVkIHRvIHRoZQogICBgaGVscGVyQ29udGFpbmVy
YC4KCiAgICBAcHJvcGVydHkgb3JpZ2luYWxNZXRob2RzCiAgICBAdHlwZSB7T2JqZWN0fQogICAg
QGRlZmF1bHQge30KICAgIEBwcml2YXRlCiAgKi8KICBvcmlnaW5hbE1ldGhvZHM6IHt9LAoKCiAg
LyoqCiAgVGhpcyBwcm9wZXJ0eSBpbmRpY2F0ZXMgd2hldGhlciBvciBub3QgdGhpcyBhcHBsaWNh
dGlvbiBpcyBjdXJyZW50bHkgaW4KICB0ZXN0aW5nIG1vZGUuIFRoaXMgaXMgc2V0IHdoZW4gYHNl
dHVwRm9yVGVzdGluZ2AgaXMgY2FsbGVkIG9uIHRoZSBjdXJyZW50CiAgYXBwbGljYXRpb24uCgog
IEBwcm9wZXJ0eSB0ZXN0aW5nCiAgQHR5cGUge0Jvb2xlYW59CiAgQGRlZmF1bHQgZmFsc2UKICAq
LwogIHRlc3Rpbmc6IGZhbHNlLAoKICAvKioKICAgVGhpcyBob29rIGRlZmVycyB0aGUgcmVhZGlu
ZXNzIG9mIHRoZSBhcHBsaWNhdGlvbiwgc28gdGhhdCB5b3UgY2FuIHN0YXJ0CiAgIHRoZSBhcHAg
d2hlbiB5b3VyIHRlc3RzIGFyZSByZWFkeSB0byBydW4uIEl0IGFsc28gc2V0cyB0aGUgcm91dGVy
J3MKICAgbG9jYXRpb24gdG8gJ25vbmUnLCBzbyB0aGF0IHRoZSB3aW5kb3cncyBsb2NhdGlvbiB3
aWxsIG5vdCBiZSBtb2RpZmllZAogICAocHJldmVudGluZyBib3RoIGFjY2lkZW50YWwgbGVha2lu
ZyBvZiBzdGF0ZSBiZXR3ZWVuIHRlc3RzIGFuZCBpbnRlcmZlcmVuY2UKICAgd2l0aCB5b3VyIHRl
c3RpbmcgZnJhbWV3b3JrKS4KCiAgIEV4YW1wbGU6CgogIGBgYAogIEFwcC5zZXR1cEZvclRlc3Rp
bmcoKTsKICBgYGAKCiAgICBAbWV0aG9kIHNldHVwRm9yVGVzdGluZwogICovCiAgc2V0dXBGb3JU
ZXN0aW5nOiBmdW5jdGlvbigpIHsKICAgIEVtYmVyLnRlc3RpbmcgPSB0cnVlOwoKICAgIHRoaXMu
dGVzdGluZyA9IHRydWU7CgogICAgdGhpcy5Sb3V0ZXIucmVvcGVuKHsKICAgICAgbG9jYXRpb246
ICdub25lJwogICAgfSk7CgogICAgLy8gaWYgYWRhcHRlciBpcyBub3QgbWFudWFsbHkgc2V0IGRl
ZmF1bHQgdG8gUVVuaXQKICAgIGlmICghRW1iZXIuVGVzdC5hZGFwdGVyKSB7CiAgICAgICBFbWJl
ci5UZXN0LmFkYXB0ZXIgPSBFbWJlci5UZXN0LlFVbml0QWRhcHRlci5jcmVhdGUoKTsKICAgIH0K
CiAgICAgIH0sCgogIC8qKgogICAgVGhpcyB3aWxsIGJlIHVzZWQgYXMgdGhlIGNvbnRhaW5lciB0
byBpbmplY3QgdGhlIHRlc3QgaGVscGVycyBpbnRvLiBCeQogICAgZGVmYXVsdCB0aGUgaGVscGVy
cyBhcmUgaW5qZWN0ZWQgaW50byBgd2luZG93YC4KCiAgICBAcHJvcGVydHkgaGVscGVyQ29udGFp
bmVyCiAgIEB0eXBlIHtPYmplY3R9IFRoZSBvYmplY3QgdG8gYmUgdXNlZCBmb3IgdGVzdCBoZWxw
ZXJzLgogICBAZGVmYXVsdCB3aW5kb3cKICAqLwogIGhlbHBlckNvbnRhaW5lcjogd2luZG93LAoK
ICAvKioKICAgIFRoaXMgaW5qZWN0cyB0aGUgdGVzdCBoZWxwZXJzIGludG8gdGhlIGBoZWxwZXJD
b250YWluZXJgIG9iamVjdC4gSWYgYW4gb2JqZWN0IGlzIHByb3ZpZGVkCiAgICBpdCB3aWxsIGJl
IHVzZWQgYXMgdGhlIGhlbHBlckNvbnRhaW5lci4gSWYgYGhlbHBlckNvbnRhaW5lcmAgaXMgbm90
IHNldCBpdCB3aWxsIGRlZmF1bHQKICAgIHRvIGB3aW5kb3dgLiBJZiBhIGZ1bmN0aW9uIG9mIHRo
ZSBzYW1lIG5hbWUgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkIGl0IHdpbGwgYmUgY2FjaGVkCiAg
ICAoc28gdGhhdCBpdCBjYW4gYmUgcmVzZXQgaWYgdGhlIGhlbHBlciBpcyByZW1vdmVkIHdpdGgg
YHVucmVnaXN0ZXJIZWxwZXJgIG9yCiAgICBgcmVtb3ZlVGVzdEhlbHBlcnNgKS4KCiAgIEFueSBj
YWxsYmFja3MgcmVnaXN0ZXJlZCB3aXRoIGBvbkluamVjdEhlbHBlcnNgIHdpbGwgYmUgY2FsbGVk
IG9uY2UgdGhlCiAgIGhlbHBlcnMgaGF2ZSBiZWVuIGluamVjdGVkLgoKICBFeGFtcGxlOgogIGBg
YAogIEFwcC5pbmplY3RUZXN0SGVscGVycygpOwogIGBgYAoKICAgIEBtZXRob2QgaW5qZWN0VGVz
dEhlbHBlcnMKICAqLwogIGluamVjdFRlc3RIZWxwZXJzOiBmdW5jdGlvbihoZWxwZXJDb250YWlu
ZXIpIHsKICAgIGlmIChoZWxwZXJDb250YWluZXIpIHsgdGhpcy5oZWxwZXJDb250YWluZXIgPSBo
ZWxwZXJDb250YWluZXI7IH0KCiAgICB0aGlzLnRlc3RIZWxwZXJzID0ge307CiAgICBmb3IgKHZh
ciBuYW1lIGluIGhlbHBlcnMpIHsKICAgICAgdGhpcy5vcmlnaW5hbE1ldGhvZHNbbmFtZV0gPSB0
aGlzLmhlbHBlckNvbnRhaW5lcltuYW1lXTsKICAgICAgdGhpcy50ZXN0SGVscGVyc1tuYW1lXSA9
IHRoaXMuaGVscGVyQ29udGFpbmVyW25hbWVdID0gaGVscGVyKHRoaXMsIG5hbWUpOwogICAgICBw
cm90b1dyYXAoRW1iZXIuVGVzdC5Qcm9taXNlLnByb3RvdHlwZSwgbmFtZSwgaGVscGVyKHRoaXMs
IG5hbWUpLCBoZWxwZXJzW25hbWVdLm1ldGEud2FpdCk7CiAgICB9CgogICAgZm9yKHZhciBpID0g
MCwgbCA9IGluamVjdEhlbHBlcnNDYWxsYmFja3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAg
IGluamVjdEhlbHBlcnNDYWxsYmFja3NbaV0odGhpcyk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICBU
aGlzIHJlbW92ZXMgYWxsIGhlbHBlcnMgdGhhdCBoYXZlIGJlZW4gcmVnaXN0ZXJlZCwgYW5kIHJl
c2V0cyBhbmQgZnVuY3Rpb25zCiAgICB0aGF0IHdlcmUgb3ZlcnJpZGRlbiBieSB0aGUgaGVscGVy
cy4KCiAgICBFeGFtcGxlOgoKICAgIGBgYGphdmFzY3JpcHQKICAgIEFwcC5yZW1vdmVUZXN0SGVs
cGVycygpOwogICAgYGBgCgogICAgQHB1YmxpYwogICAgQG1ldGhvZCByZW1vdmVUZXN0SGVscGVy
cwogICovCiAgcmVtb3ZlVGVzdEhlbHBlcnM6IGZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgbmFt
ZSBpbiBoZWxwZXJzKSB7CiAgICAgIHRoaXMuaGVscGVyQ29udGFpbmVyW25hbWVdID0gdGhpcy5v
cmlnaW5hbE1ldGhvZHNbbmFtZV07CiAgICAgIGRlbGV0ZSB0aGlzLnRlc3RIZWxwZXJzW25hbWVd
OwogICAgICBkZWxldGUgdGhpcy5vcmlnaW5hbE1ldGhvZHNbbmFtZV07CiAgICB9CiAgfQp9KTsK
Ci8vIFRoaXMgbWV0aG9kIGlzIG5vIGxvbmdlciBuZWVkZWQKLy8gQnV0IHN0aWxsIGhlcmUgZm9y
IGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5Ci8vIG9mIGhlbHBlciBjaGFpbmluZwpmdW5jdGlvbiBw
cm90b1dyYXAocHJvdG8sIG5hbWUsIGNhbGxiYWNrLCBpc0FzeW5jKSB7CiAgcHJvdG9bbmFtZV0g
PSBmdW5jdGlvbigpIHsKICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwogICAgaWYgKGlzQXN5bmMp
IHsKICAgICAgcmV0dXJuIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSBlbHNlIHsK
ICAgICAgcmV0dXJuIHRoaXMudGhlbihmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY2FsbGJh
Y2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH0pOwogICAgfQogIH07Cn0KCkVtYmVyLlRlc3Qu
UHJvbWlzZSA9IGZ1bmN0aW9uKCkgewogIEVtYmVyLlJTVlAuUHJvbWlzZS5hcHBseSh0aGlzLCBh
cmd1bWVudHMpOwogIEVtYmVyLlRlc3QubGFzdFByb21pc2UgPSB0aGlzOwp9OwoKRW1iZXIuVGVz
dC5Qcm9taXNlLnByb3RvdHlwZSA9IEVtYmVyLmNyZWF0ZShFbWJlci5SU1ZQLlByb21pc2UucHJv
dG90eXBlKTsKRW1iZXIuVGVzdC5Qcm9taXNlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEVtYmVy
LlRlc3QuUHJvbWlzZTsKCi8vIFBhdGNoIGB0aGVuYCB0byBpc29sYXRlIGFzeW5jIG1ldGhvZHMK
Ly8gc3BlY2lmaWNhbGx5IGBFbWJlci5UZXN0Lmxhc3RQcm9taXNlYAp2YXIgb3JpZ2luYWxUaGVu
ID0gRW1iZXIuUlNWUC5Qcm9taXNlLnByb3RvdHlwZS50aGVuOwpFbWJlci5UZXN0LlByb21pc2Uu
cHJvdG90eXBlLnRoZW4gPSBmdW5jdGlvbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSkgewogIHJldHVy
biBvcmlnaW5hbFRoZW4uY2FsbCh0aGlzLCBmdW5jdGlvbih2YWwpIHsKICAgIHJldHVybiBpc29s
YXRlKG9uU3VjY2VzcywgdmFsKTsKICB9LCBvbkZhaWx1cmUpOwp9OwoKLy8gVGhpcyBtZXRob2Qg
aXNvbGF0ZXMgbmVzdGVkIGFzeW5jIG1ldGhvZHMKLy8gc28gdGhhdCB0aGV5IGRvbid0IGNvbmZs
aWN0IHdpdGggb3RoZXIgbGFzdCBwcm9taXNlcy4KLy8KLy8gMS4gU2V0IGBFbWJlci5UZXN0Lmxh
c3RQcm9taXNlYCB0byBudWxsCi8vIDIuIEludm9rZSBtZXRob2QKLy8gMy4gUmV0dXJuIHRoZSBs
YXN0IHByb21pc2UgY3JlYXRlZCBkdXJpbmcgbWV0aG9kCi8vIDQuIFJlc3RvcmUgYEVtYmVyLlRl
c3QubGFzdFByb21pc2VgIHRvIG9yaWdpbmFsIHZhbHVlCmZ1bmN0aW9uIGlzb2xhdGUoZm4sIHZh
bCkgewogIHZhciB2YWx1ZSwgbGFzdFByb21pc2U7CgogIC8vIFJlc2V0IGxhc3RQcm9taXNlIGZv
ciBuZXN0ZWQgaGVscGVycwogIEVtYmVyLlRlc3QubGFzdFByb21pc2UgPSBudWxsOwoKICB2YWx1
ZSA9IGZuLmNhbGwobnVsbCwgdmFsKTsKCiAgbGFzdFByb21pc2UgPSBFbWJlci5UZXN0Lmxhc3RQ
cm9taXNlOwoKICAvLyBJZiB0aGUgbWV0aG9kIHJldHVybmVkIGEgcHJvbWlzZQogIC8vIHJldHVy
biB0aGF0IHByb21pc2UuIElmIG5vdCwKICAvLyByZXR1cm4gdGhlIGxhc3QgYXN5bmMgaGVscGVy
J3MgcHJvbWlzZQogIGlmICgodmFsdWUgJiYgKHZhbHVlIGluc3RhbmNlb2YgRW1iZXIuVGVzdC5Q
cm9taXNlKSkgfHwgIWxhc3RQcm9taXNlKSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfSBlbHNlIHsK
ICAgIHJ1bihmdW5jdGlvbigpIHsKICAgICAgbGFzdFByb21pc2UgPSBFbWJlci5UZXN0LnJlc29s
dmUobGFzdFByb21pc2UpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwog
ICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIGxhc3RQcm9taXNlOwogIH0KfQoKfSkoKTsKCgoK
KGZ1bmN0aW9uKCkgewpFbWJlci5vbkxvYWQoJ0VtYmVyLkFwcGxpY2F0aW9uJywgZnVuY3Rpb24o
QXBwbGljYXRpb24pIHsKICBBcHBsaWNhdGlvbi5pbml0aWFsaXplcih7CiAgICBuYW1lOiAnZGVm
ZXJSZWFkaW5lc3MgaW4gYHRlc3RpbmdgIG1vZGUnLAoKICAgIGluaXRpYWxpemU6IGZ1bmN0aW9u
KGNvbnRhaW5lciwgYXBwbGljYXRpb24pewogICAgICBpZiAoYXBwbGljYXRpb24udGVzdGluZykg
ewogICAgICAgIGFwcGxpY2F0aW9uLmRlZmVyUmVhZGluZXNzKCk7CiAgICAgIH0KICAgIH0KICB9
KTsKCiAgfSk7Cgp9KSgpOwoKCgooZnVuY3Rpb24oKSB7Ci8qKgogIEBtb2R1bGUgZW1iZXIKICBA
c3VibW9kdWxlIGVtYmVyLXRlc3RpbmcKICovCgp2YXIgJCA9IEVtYmVyLiQ7CgovKioKICBUaGlz
IG1ldGhvZCBjcmVhdGVzIGEgY2hlY2tib3ggYW5kIHRyaWdnZXJzIHRoZSBjbGljayBldmVudCB0
byBmaXJlIHRoZQogIHBhc3NlZCBpbiBoYW5kbGVyLiBJdCBpcyB1c2VkIHRvIGNvcnJlY3QgZm9y
IGEgYnVnIGluIG9sZGVyIHZlcnNpb25zCiAgb2YgalF1ZXJ5IChlLmcgMS44LjMpLgoKICBAcHJp
dmF0ZQogIEBtZXRob2QgdGVzdENoZWNrYm94Q2xpY2sKKi8KZnVuY3Rpb24gdGVzdENoZWNrYm94
Q2xpY2soaGFuZGxlcikgewogICQoJzxpbnB1dCB0eXBlPSJjaGVja2JveCI+JykKICAgIC5jc3Mo
eyBwb3NpdGlvbjogJ2Fic29sdXRlJywgbGVmdDogJy0xMDAwcHgnLCB0b3A6ICctMTAwMHB4JyB9
KQogICAgLmFwcGVuZFRvKCdib2R5JykKICAgIC5vbignY2xpY2snLCBoYW5kbGVyKQogICAgLnRy
aWdnZXIoJ2NsaWNrJykKICAgIC5yZW1vdmUoKTsKfQoKJChmdW5jdGlvbigpIHsKICAvKgogICAg
RGV0ZXJtaW5lIHdoZXRoZXIgYSBjaGVja2JveCBjaGVja2VkIHVzaW5nIGpRdWVyeSdzICJjbGlj
ayIgbWV0aG9kIHdpbGwgaGF2ZQogICAgdGhlIGNvcnJlY3QgdmFsdWUgZm9yIGl0cyBjaGVja2Vk
IHByb3BlcnR5LgoKICAgIElmIHdlIGRldGVybWluZSB0aGF0IHRoZSBjdXJyZW50IGpRdWVyeSB2
ZXJzaW9uIGV4aGliaXRzIHRoaXMgYmVoYXZpb3IsCiAgICBwYXRjaCBpdCB0byB3b3JrIGNvcnJl
Y3RseSBhcyBpbiB0aGUgY29tbWl0IGZvciB0aGUgYWN0dWFsIGZpeDoKICAgIGh0dHBzOi8vZ2l0
aHViLmNvbS9qcXVlcnkvanF1ZXJ5L2NvbW1pdC8xZmIyZjkyLgogICovCiAgdGVzdENoZWNrYm94
Q2xpY2soZnVuY3Rpb24oKSB7CiAgICBpZiAoIXRoaXMuY2hlY2tlZCAmJiAhJC5ldmVudC5zcGVj
aWFsLmNsaWNrKSB7CiAgICAgICQuZXZlbnQuc3BlY2lhbC5jbGljayA9IHsKICAgICAgICAvLyBG
b3IgY2hlY2tib3gsIGZpcmUgbmF0aXZlIGV2ZW50IHNvIGNoZWNrZWQgc3RhdGUgd2lsbCBiZSBy
aWdodAogICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCQubm9kZU5h
bWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5j
bGljaykgewogICAgICAgICAgICB0aGlzLmNsaWNrKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxz
ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIFRyeSBh
Z2FpbiB0byB2ZXJpZnkgdGhhdCB0aGUgcGF0Y2ggdG9vayBlZmZlY3Qgb3IgYmxvdyB1cC4KICB0
ZXN0Q2hlY2tib3hDbGljayhmdW5jdGlvbigpIHsKICAgIEVtYmVyLndhcm4oImNsaWNrZWQgY2hl
Y2tib3hlcyBzaG91bGQgYmUgY2hlY2tlZCEgdGhlIGpRdWVyeSBwYXRjaCBkaWRuJ3Qgd29yayIs
IHRoaXMuY2hlY2tlZCk7CiAgfSk7Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKIEBt
b2R1bGUgZW1iZXIKIEBzdWJtb2R1bGUgZW1iZXItdGVzdGluZwoqLwoKdmFyIFRlc3QgPSBFbWJl
ci5UZXN0OwoKLyoqCiAgVGhlIHByaW1hcnkgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGlzIHRvIGNy
ZWF0ZSBob29rcyB0aGF0IGNhbiBiZSBpbXBsZW1lbnRlZAogIGJ5IGFuIGFkYXB0ZXIgZm9yIHZh
cmlvdXMgdGVzdCBmcmFtZXdvcmtzLgoKICBAY2xhc3MgQWRhcHRlcgogIEBuYW1lc3BhY2UgRW1i
ZXIuVGVzdAoqLwpUZXN0LkFkYXB0ZXIgPSBFbWJlci5PYmplY3QuZXh0ZW5kKHsKICAvKioKICAg
IFRoaXMgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgd2hlbmV2ZXIgYW4gYXN5bmMgb3BlcmF0aW9u
IGlzIGFib3V0IHRvIHN0YXJ0LgoKICAgIE92ZXJyaWRlIHRoaXMgdG8gY2FsbCB5b3VyIGZyYW1l
d29yaydzIG1ldGhvZHMgdGhhdCBoYW5kbGUgYXN5bmMKICAgIG9wZXJhdGlvbnMuCgogICAgQHB1
YmxpYwogICAgQG1ldGhvZCBhc3luY1N0YXJ0CiAgKi8KICBhc3luY1N0YXJ0OiBFbWJlci5LLAoK
ICAvKioKICAgIFRoaXMgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgd2hlbmV2ZXIgYW4gYXN5bmMg
b3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQuCgogICAgQHB1YmxpYwogICAgQG1ldGhvZCBhc3luY0Vu
ZAogICovCiAgYXN5bmNFbmQ6IEVtYmVyLkssCgogIC8qKgogICAgT3ZlcnJpZGUgdGhpcyBtZXRo
b2Qgd2l0aCB5b3VyIHRlc3RpbmcgZnJhbWV3b3JrJ3MgZmFsc2UgYXNzZXJ0aW9uLgogICAgVGhp
cyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgYW4gZXhjZXB0aW9uIG9jY3VycyBjYXVzaW5n
IHRoZSB0ZXN0aW5nCiAgICBwcm9taXNlIHRvIGZhaWwuCgogICAgUVVuaXQgZXhhbXBsZToKCiAg
ICBgYGBqYXZhc2NyaXB0CiAgICAgIGV4Y2VwdGlvbjogZnVuY3Rpb24oZXJyb3IpIHsKICAgICAg
ICBvayhmYWxzZSwgZXJyb3IpOwogICAgICB9OwogICAgYGBgCgogICAgQHB1YmxpYwogICAgQG1l
dGhvZCBleGNlcHRpb24KICAgIEBwYXJhbSB7U3RyaW5nfSBlcnJvciBUaGUgZXhjZXB0aW9uIHRv
IGJlIHJhaXNlZC4KICAqLwogIGV4Y2VwdGlvbjogZnVuY3Rpb24oZXJyb3IpIHsKICAgIHRocm93
IGVycm9yOwogIH0KfSk7CgovKioKICBUaGlzIGNsYXNzIGltcGxlbWVudHMgdGhlIG1ldGhvZHMg
ZGVmaW5lZCBieSBFbWJlci5UZXN0LkFkYXB0ZXIgZm9yIHRoZQogIFFVbml0IHRlc3RpbmcgZnJh
bWV3b3JrLgoKICBAY2xhc3MgUVVuaXRBZGFwdGVyCiAgQG5hbWVzcGFjZSBFbWJlci5UZXN0CiAg
QGV4dGVuZHMgRW1iZXIuVGVzdC5BZGFwdGVyCiovClRlc3QuUVVuaXRBZGFwdGVyID0gVGVzdC5B
ZGFwdGVyLmV4dGVuZCh7CiAgYXN5bmNTdGFydDogZnVuY3Rpb24oKSB7CiAgICBzdG9wKCk7CiAg
fSwKICBhc3luY0VuZDogZnVuY3Rpb24oKSB7CiAgICBzdGFydCgpOwogIH0sCiAgZXhjZXB0aW9u
OiBmdW5jdGlvbihlcnJvcikgewogICAgb2soZmFsc2UsIEVtYmVyLmluc3BlY3QoZXJyb3IpKTsK
ICB9Cn0pOwoKfSkoKTsKCgoKKGZ1bmN0aW9uKCkgewovKioKKiBAbW9kdWxlIGVtYmVyCiogQHN1
Ym1vZHVsZSBlbWJlci10ZXN0aW5nCiovCgp2YXIgZ2V0ID0gRW1iZXIuZ2V0LAogICAgVGVzdCA9
IEVtYmVyLlRlc3QsCiAgICBoZWxwZXIgPSBUZXN0LnJlZ2lzdGVySGVscGVyLAogICAgYXN5bmNI
ZWxwZXIgPSBUZXN0LnJlZ2lzdGVyQXN5bmNIZWxwZXIsCiAgICBjb3VudEFzeW5jID0gMDsKClRl
c3QucGVuZGluZ0FqYXhSZXF1ZXN0cyA9IDA7CgpUZXN0Lm9uSW5qZWN0SGVscGVycyhmdW5jdGlv
bigpIHsKICBFbWJlci4kKGRvY3VtZW50KS5hamF4U3RhcnQoZnVuY3Rpb24oKSB7CiAgICBUZXN0
LnBlbmRpbmdBamF4UmVxdWVzdHMrKzsKICB9KTsKCiAgRW1iZXIuJChkb2N1bWVudCkuYWpheFN0
b3AoZnVuY3Rpb24oKSB7CiAgICBFbWJlci5hc3NlcnQoIkFuIGFqYXhTdG9wIGV2ZW50IHdoaWNo
IHdvdWxkIGNhdXNlIHRoZSBudW1iZXIgb2YgcGVuZGluZyBBSkFYICIgKwogICAgICAgICAgICAg
ICAgICJyZXF1ZXN0cyB0byBiZSBuZWdhdGl2ZSBoYXMgYmVlbiB0cmlnZ2VyZWQuIFRoaXMgaXMg
bW9zdCBsaWtlbHkgIiArCiAgICAgICAgICAgICAgICAgImNhdXNlZCBieSBBSkFYIGV2ZW50cyB0
aGF0IHdlcmUgc3RhcnRlZCBiZWZvcmUgY2FsbGluZyAiICsKICAgICAgICAgICAgICAgICAiYGlu
amVjdFRlc3RIZWxwZXJzKClgLiIsIFRlc3QucGVuZGluZ0FqYXhSZXF1ZXN0cyAhPT0gMCk7CiAg
ICBUZXN0LnBlbmRpbmdBamF4UmVxdWVzdHMtLTsKICB9KTsKfSk7CgpmdW5jdGlvbiBjdXJyZW50
Um91dGVOYW1lKGFwcCl7CiAgdmFyIGFwcENvbnRyb2xsZXIgPSBhcHAuX19jb250YWluZXJfXy5s
b29rdXAoJ2NvbnRyb2xsZXI6YXBwbGljYXRpb24nKTsKCiAgcmV0dXJuIGdldChhcHBDb250cm9s
bGVyLCAnY3VycmVudFJvdXRlTmFtZScpOwp9CgpmdW5jdGlvbiBjdXJyZW50UGF0aChhcHApewog
IHZhciBhcHBDb250cm9sbGVyID0gYXBwLl9fY29udGFpbmVyX18ubG9va3VwKCdjb250cm9sbGVy
OmFwcGxpY2F0aW9uJyk7CgogIHJldHVybiBnZXQoYXBwQ29udHJvbGxlciwgJ2N1cnJlbnRQYXRo
Jyk7Cn0KCmZ1bmN0aW9uIGN1cnJlbnRVUkwoYXBwKXsKICB2YXIgcm91dGVyID0gYXBwLl9fY29u
dGFpbmVyX18ubG9va3VwKCdyb3V0ZXI6bWFpbicpOwoKICByZXR1cm4gZ2V0KHJvdXRlciwgJ2xv
Y2F0aW9uJykuZ2V0VVJMKCk7Cn0KCmZ1bmN0aW9uIHZpc2l0KGFwcCwgdXJsKSB7CiAgRW1iZXIu
cnVuKGFwcCwgJ2FkdmFuY2VSZWFkaW5lc3MnKTsKCiAgYXBwLl9fY29udGFpbmVyX18ubG9va3Vw
KCdyb3V0ZXI6bWFpbicpLmxvY2F0aW9uLnNldFVSTCh1cmwpOwogIEVtYmVyLnJ1bihhcHAsIGFw
cC5oYW5kbGVVUkwsIHVybCk7CiAgcmV0dXJuIHdhaXQoYXBwKTsKfQoKZnVuY3Rpb24gY2xpY2so
YXBwLCBzZWxlY3RvciwgY29udGV4dCkgewogIHZhciAkZWwgPSBmaW5kV2l0aEFzc2VydChhcHAs
IHNlbGVjdG9yLCBjb250ZXh0KTsKICBFbWJlci5ydW4oJGVsLCAnbW91c2Vkb3duJyk7CgogIGlm
ICgkZWwuaXMoJzppbnB1dCcpKSB7CiAgICB2YXIgdHlwZSA9ICRlbC5wcm9wKCd0eXBlJyk7CiAg
ICBpZiAodHlwZSAhPT0gJ2NoZWNrYm94JyAmJiB0eXBlICE9PSAncmFkaW8nICYmIHR5cGUgIT09
ICdoaWRkZW4nKSB7CiAgICAgIEVtYmVyLnJ1bigkZWwsIGZ1bmN0aW9uKCl7CiAgICAgICAgLy8g
RmlyZWZveCBkb2VzIG5vdCB0cmlnZ2VyIHRoZSBgZm9jdXNpbmAgZXZlbnQgaWYgdGhlIHdpbmRv
dwogICAgICAgIC8vIGRvZXMgbm90IGhhdmUgZm9jdXMuIElmIHRoZSBkb2N1bWVudCBkb2Vzbid0
IGhhdmUgZm9jdXMganVzdAogICAgICAgIC8vIHVzZSB0cmlnZ2VyKCdmb2N1c2luJykgaW5zdGVh
ZC4KICAgICAgICBpZiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkp
IHsKICAgICAgICAgIHRoaXMuZm9jdXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhp
cy50cmlnZ2VyKCdmb2N1c2luJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CgogIEVt
YmVyLnJ1bigkZWwsICdtb3VzZXVwJyk7CiAgRW1iZXIucnVuKCRlbCwgJ2NsaWNrJyk7CgogIHJl
dHVybiB3YWl0KGFwcCk7Cn0KCmZ1bmN0aW9uIHRyaWdnZXJFdmVudChhcHAsIHNlbGVjdG9yLCBj
b250ZXh0LCBldmVudCl7CiAgaWYgKHR5cGVvZiBtZXRob2QgPT09ICd1bmRlZmluZWQnKSB7CiAg
ICBldmVudCA9IGNvbnRleHQ7CiAgICBjb250ZXh0ID0gbnVsbDsKICB9CgogIHZhciAkZWwgPSBm
aW5kV2l0aEFzc2VydChhcHAsIHNlbGVjdG9yLCBjb250ZXh0KTsKCiAgRW1iZXIucnVuKCRlbCwg
J3RyaWdnZXInLCBldmVudCk7CgogIHJldHVybiB3YWl0KGFwcCk7Cn0KCmZ1bmN0aW9uIGtleUV2
ZW50KGFwcCwgc2VsZWN0b3IsIGNvbnRleHQsIHR5cGUsIGtleUNvZGUpIHsKICB2YXIgJGVsOwog
IGlmICh0eXBlb2Yga2V5Q29kZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIGtleUNvZGUgPSB0eXBl
OwogICAgdHlwZSA9IGNvbnRleHQ7CiAgICBjb250ZXh0ID0gbnVsbDsKICB9CiAgJGVsID0gZmlu
ZFdpdGhBc3NlcnQoYXBwLCBzZWxlY3RvciwgY29udGV4dCk7CiAgdmFyIGV2ZW50ID0gRW1iZXIu
JC5FdmVudCh0eXBlLCB7IGtleUNvZGU6IGtleUNvZGUgfSk7CiAgRW1iZXIucnVuKCRlbCwgJ3Ry
aWdnZXInLCBldmVudCk7CiAgcmV0dXJuIHdhaXQoYXBwKTsKfQoKZnVuY3Rpb24gZmlsbEluKGFw
cCwgc2VsZWN0b3IsIGNvbnRleHQsIHRleHQpIHsKICB2YXIgJGVsOwogIGlmICh0eXBlb2YgdGV4
dCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIHRleHQgPSBjb250ZXh0OwogICAgY29udGV4dCA9IG51
bGw7CiAgfQogICRlbCA9IGZpbmRXaXRoQXNzZXJ0KGFwcCwgc2VsZWN0b3IsIGNvbnRleHQpOwog
IEVtYmVyLnJ1bihmdW5jdGlvbigpIHsKICAgICRlbC52YWwodGV4dCkuY2hhbmdlKCk7CiAgfSk7
CiAgcmV0dXJuIHdhaXQoYXBwKTsKfQoKZnVuY3Rpb24gZmluZFdpdGhBc3NlcnQoYXBwLCBzZWxl
Y3RvciwgY29udGV4dCkgewogIHZhciAkZWwgPSBmaW5kKGFwcCwgc2VsZWN0b3IsIGNvbnRleHQp
OwogIGlmICgkZWwubGVuZ3RoID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRW1iZXIuRXJyb3IoIkVs
ZW1lbnQgIiArIHNlbGVjdG9yICsgIiBub3QgZm91bmQuIik7CiAgfQogIHJldHVybiAkZWw7Cn0K
CmZ1bmN0aW9uIGZpbmQoYXBwLCBzZWxlY3RvciwgY29udGV4dCkgewogIHZhciAkZWw7CiAgY29u
dGV4dCA9IGNvbnRleHQgfHwgZ2V0KGFwcCwgJ3Jvb3RFbGVtZW50Jyk7CiAgJGVsID0gYXBwLiQo
c2VsZWN0b3IsIGNvbnRleHQpOwoKICByZXR1cm4gJGVsOwp9CgpmdW5jdGlvbiBhbmRUaGVuKGFw
cCwgY2FsbGJhY2spIHsKICByZXR1cm4gd2FpdChhcHAsIGNhbGxiYWNrKGFwcCkpOwp9CgpmdW5j
dGlvbiB3YWl0KGFwcCwgdmFsdWUpIHsKICByZXR1cm4gVGVzdC5wcm9taXNlKGZ1bmN0aW9uKHJl
c29sdmUpIHsKICAgIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IGFzeW5jIHByb21pc2UsIGtpY2sg
b2ZmIHRoZSBhc3luYyB0ZXN0CiAgICBpZiAoKytjb3VudEFzeW5jID09PSAxKSB7CiAgICAgIFRl
c3QuYWRhcHRlci5hc3luY1N0YXJ0KCk7CiAgICB9CgogICAgLy8gRXZlcnkgMTBtcywgcG9sbCBm
b3IgdGhlIGFzeW5jIHRoaW5nIHRvIGhhdmUgZmluaXNoZWQKICAgIHZhciB3YXRjaGVyID0gc2V0
SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgIC8vIDEuIElmIHRoZSByb3V0ZXIgaXMgbG9hZGlu
Zywga2VlcCBwb2xsaW5nCiAgICAgIHZhciByb3V0ZXJJc0xvYWRpbmcgPSBhcHAuX19jb250YWlu
ZXJfXy5sb29rdXAoJ3JvdXRlcjptYWluJykucm91dGVyLmlzTG9hZGluZzsKICAgICAgaWYgKHJv
dXRlcklzTG9hZGluZykgeyByZXR1cm47IH0KCiAgICAgIC8vIDIuIElmIHRoZXJlIGFyZSBwZW5k
aW5nIEFqYXggcmVxdWVzdHMsIGtlZXAgcG9sbGluZwogICAgICBpZiAoVGVzdC5wZW5kaW5nQWph
eFJlcXVlc3RzKSB7IHJldHVybjsgfQoKICAgICAgLy8gMy4gSWYgdGhlcmUgYXJlIHNjaGVkdWxl
ZCB0aW1lcnMgb3Igd2UgYXJlIGluc2lkZSBvZiBhIHJ1biBsb29wLCBrZWVwIHBvbGxpbmcKICAg
ICAgaWYgKEVtYmVyLnJ1bi5oYXNTY2hlZHVsZWRUaW1lcnMoKSB8fCBFbWJlci5ydW4uY3VycmVu
dFJ1bkxvb3ApIHsgcmV0dXJuOyB9CiAgICAgIGlmIChUZXN0LndhaXRlcnMgJiYgVGVzdC53YWl0
ZXJzLmFueShmdW5jdGlvbih3YWl0ZXIpIHsKICAgICAgICB2YXIgY29udGV4dCA9IHdhaXRlclsw
XTsKICAgICAgICB2YXIgY2FsbGJhY2sgPSB3YWl0ZXJbMV07CiAgICAgICAgcmV0dXJuICFjYWxs
YmFjay5jYWxsKGNvbnRleHQpOwogICAgICB9KSkgeyByZXR1cm47IH0KICAgICAgLy8gU3RvcCBw
b2xsaW5nCiAgICAgIGNsZWFySW50ZXJ2YWwod2F0Y2hlcik7CgogICAgICAvLyBJZiB0aGlzIGlz
IHRoZSBsYXN0IGFzeW5jIHByb21pc2UsIGVuZCB0aGUgYXN5bmMgdGVzdAogICAgICBpZiAoLS1j
b3VudEFzeW5jID09PSAwKSB7CiAgICAgICAgVGVzdC5hZGFwdGVyLmFzeW5jRW5kKCk7CiAgICAg
IH0KCiAgICAgIC8vIFN5bmNocm9ub3VzbHkgcmVzb2x2ZSB0aGUgcHJvbWlzZQogICAgICBFbWJl
ci5ydW4obnVsbCwgcmVzb2x2ZSwgdmFsdWUpOwogICAgfSwgMTApOwogIH0pOwoKfQoKCi8qKgoq
IExvYWRzIGEgcm91dGUsIHNldHMgdXAgYW55IGNvbnRyb2xsZXJzLCBhbmQgcmVuZGVycyBhbnkg
dGVtcGxhdGVzIGFzc29jaWF0ZWQKKiB3aXRoIHRoZSByb3V0ZSBhcyB0aG91Z2ggYSByZWFsIHVz
ZXIgaGFkIHRyaWdnZXJlZCB0aGUgcm91dGUgY2hhbmdlIHdoaWxlCiogdXNpbmcgeW91ciBhcHAu
CioKKiBFeGFtcGxlOgoqCiogYGBgamF2YXNjcmlwdAoqIHZpc2l0KCdwb3N0cy9pbmRleCcpLnRo
ZW4oZnVuY3Rpb24oKSB7CiogICAvLyBhc3NlcnQgc29tZXRoaW5nCiogfSk7CiogYGBgCioKKiBA
bWV0aG9kIHZpc2l0CiogQHBhcmFtIHtTdHJpbmd9IHVybCB0aGUgbmFtZSBvZiB0aGUgcm91dGUK
KiBAcmV0dXJuIHtSU1ZQLlByb21pc2V9CiovCmFzeW5jSGVscGVyKCd2aXNpdCcsIHZpc2l0KTsK
Ci8qKgoqIENsaWNrcyBhbiBlbGVtZW50IGFuZCB0cmlnZ2VycyBhbnkgYWN0aW9ucyB0cmlnZ2Vy
ZWQgYnkgdGhlIGVsZW1lbnQncyBgY2xpY2tgCiogZXZlbnQuCioKKiBFeGFtcGxlOgoqCiogYGBg
amF2YXNjcmlwdAoqIGNsaWNrKCcuc29tZS1qUXVlcnktc2VsZWN0b3InKS50aGVuKGZ1bmN0aW9u
KCkgewoqICAvLyBhc3NlcnQgc29tZXRoaW5nCiogfSk7CiogYGBgCioKKiBAbWV0aG9kIGNsaWNr
CiogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBmb3IgZmluZGluZyBl
bGVtZW50IG9uIHRoZSBET00KKiBAcmV0dXJuIHtSU1ZQLlByb21pc2V9CiovCmFzeW5jSGVscGVy
KCdjbGljaycsIGNsaWNrKTsKCi8qKgoqIFNpbXVsYXRlcyBhIGtleSBldmVudCwgZS5nLiBga2V5
cHJlc3NgLCBga2V5ZG93bmAsIGBrZXl1cGAgd2l0aCB0aGUgZGVzaXJlZCBrZXlDb2RlCioKKiBF
eGFtcGxlOgoqCiogYGBgamF2YXNjcmlwdAoqIGtleUV2ZW50KCcuc29tZS1qUXVlcnktc2VsZWN0
b3InLCAna2V5cHJlc3MnLCAxMykudGhlbihmdW5jdGlvbigpIHsKKiAgLy8gYXNzZXJ0IHNvbWV0
aGluZwoqIH0pOwoqIGBgYAoqCiogQG1ldGhvZCBrZXlFdmVudAoqIEBwYXJhbSB7U3RyaW5nfSBz
ZWxlY3RvciBqUXVlcnkgc2VsZWN0b3IgZm9yIGZpbmRpbmcgZWxlbWVudCBvbiB0aGUgRE9NCiog
QHBhcmFtIHtTdHJpbmd9IHRoZSB0eXBlIG9mIGtleSBldmVudCwgZS5nLiBga2V5cHJlc3NgLCBg
a2V5ZG93bmAsIGBrZXl1cGAKKiBAcGFyYW0ge051bWJlcn0gdGhlIGtleUNvZGUgb2YgdGhlIHNp
bXVsYXRlZCBrZXkgZXZlbnQKKiBAcmV0dXJuIHtSU1ZQLlByb21pc2V9CiovCmFzeW5jSGVscGVy
KCdrZXlFdmVudCcsIGtleUV2ZW50KTsKCi8qKgoqIEZpbGxzIGluIGFuIGlucHV0IGVsZW1lbnQg
d2l0aCBzb21lIHRleHQuCioKKiBFeGFtcGxlOgoqCiogYGBgamF2YXNjcmlwdAoqIGZpbGxJbign
I2VtYWlsJywgJ3lvdUBleGFtcGxlLmNvbScpLnRoZW4oZnVuY3Rpb24oKSB7CiogICAvLyBhc3Nl
cnQgc29tZXRoaW5nCiogfSk7CiogYGBgCioKKiBAbWV0aG9kIGZpbGxJbgoqIEBwYXJhbSB7U3Ry
aW5nfSBzZWxlY3RvciBqUXVlcnkgc2VsZWN0b3IgZmluZGluZyBhbiBpbnB1dCBlbGVtZW50IG9u
IHRoZSBET00KKiB0byBmaWxsIHRleHQgd2l0aAoqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IHRleHQg
dG8gcGxhY2UgaW5zaWRlIHRoZSBpbnB1dCBlbGVtZW50CiogQHJldHVybiB7UlNWUC5Qcm9taXNl
fQoqLwphc3luY0hlbHBlcignZmlsbEluJywgZmlsbEluKTsKCi8qKgoqIEZpbmRzIGFuIGVsZW1l
bnQgaW4gdGhlIGNvbnRleHQgb2YgdGhlIGFwcCdzIGNvbnRhaW5lciBlbGVtZW50LiBBIHNpbXBs
ZSBhbGlhcwoqIGZvciBgYXBwLiQoc2VsZWN0b3IpYC4KKgoqIEV4YW1wbGU6CioKKiBgYGBqYXZh
c2NyaXB0CiogdmFyICRlbCA9IGZpbmQoJy5teS1zZWxlY3Rvcik7CiogYGBgCioKKiBAbWV0aG9k
IGZpbmQKKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgalF1ZXJ5IHN0cmluZyBzZWxlY3RvciBm
b3IgZWxlbWVudCBsb29rdXAKKiBAcmV0dXJuIHtPYmplY3R9IGpRdWVyeSBvYmplY3QgcmVwcmVz
ZW50aW5nIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeQoqLwpoZWxwZXIoJ2ZpbmQnLCBmaW5kKTsK
Ci8qKgoqIExpa2UgYGZpbmRgLCBidXQgdGhyb3dzIGFuIGVycm9yIGlmIHRoZSBlbGVtZW50IHNl
bGVjdG9yIHJldHVybnMgbm8gcmVzdWx0cy4KKgoqIEV4YW1wbGU6CioKKiBgYGBqYXZhc2NyaXB0
CiogdmFyICRlbCA9IGZpbmRXaXRoQXNzZXJ0KCcuZG9lc250LWV4aXN0Jyk7IC8vIHRocm93cyBl
cnJvcgoqIGBgYAoqCiogQG1ldGhvZCBmaW5kV2l0aEFzc2VydAoqIEBwYXJhbSB7U3RyaW5nfSBz
ZWxlY3RvciBqUXVlcnkgc2VsZWN0b3Igc3RyaW5nIGZvciBmaW5kaW5nIGFuIGVsZW1lbnQgd2l0
aGluCiogdGhlIERPTQoqIEByZXR1cm4ge09iamVjdH0galF1ZXJ5IG9iamVjdCByZXByZXNlbnRp
bmcgdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5CiogQHRocm93cyB7RXJyb3J9IHRocm93cyBlcnJv
ciBpZiBqUXVlcnkgb2JqZWN0IHJldHVybmVkIGhhcyBhIGxlbmd0aCBvZiAwCiovCmhlbHBlcign
ZmluZFdpdGhBc3NlcnQnLCBmaW5kV2l0aEFzc2VydCk7CgovKioKICBDYXVzZXMgdGhlIHJ1biBs
b29wIHRvIHByb2Nlc3MgYW55IHBlbmRpbmcgZXZlbnRzLiBUaGlzIGlzIHVzZWQgdG8gZW5zdXJl
IHRoYXQKICBhbnkgYXN5bmMgb3BlcmF0aW9ucyBmcm9tIG90aGVyIGhlbHBlcnMgKG9yIHlvdXIg
YXNzZXJ0aW9ucykgaGF2ZSBiZWVuIHByb2Nlc3NlZC4KCiAgVGhpcyBpcyBtb3N0IG9mdGVuIHVz
ZWQgYXMgdGhlIHJldHVybiB2YWx1ZSBmb3IgdGhlIGhlbHBlciBmdW5jdGlvbnMgKHNlZSAnY2xp
Y2snLAogICdmaWxsSW4nLCd2aXNpdCcsZXRjKS4KCiAgRXhhbXBsZToKCiAgYGBgamF2YXNjcmlw
dAogIEVtYmVyLlRlc3QucmVnaXN0ZXJBc3luY0hlbHBlcignbG9naW5Vc2VyJywgZnVuY3Rpb24o
YXBwLCB1c2VybmFtZSwgcGFzc3dvcmQpIHsKICAgIHZpc2l0KCdzZWN1cmVkL3BhdGgvaGVyZScp
CiAgICAuZmlsbEluKCcjdXNlcm5hbWUnLCB1c2VybmFtZSkKICAgIC5maWxsSW4oJyNwYXNzd29y
ZCcsIHVzZXJuYW1lKQogICAgLmNsaWNrKCcuc3VibWl0JykKCiAgICByZXR1cm4gd2FpdCgpOwog
IH0pOwoKICBAbWV0aG9kIHdhaXQKICBAcGFyYW0ge09iamVjdH0gdmFsdWUgVGhlIHZhbHVlIHRv
IGJlIHJldHVybmVkLgogIEByZXR1cm4ge1JTVlAuUHJvbWlzZX0KKi8KYXN5bmNIZWxwZXIoJ3dh
aXQnLCB3YWl0KTsKYXN5bmNIZWxwZXIoJ2FuZFRoZW4nLCBhbmRUaGVuKTsKCgoKCn0pKCk7CgoK
CihmdW5jdGlvbigpIHsKLyoqCiAgRW1iZXIgVGVzdGluZwoKICBAbW9kdWxlIGVtYmVyCiAgQHN1
Ym1vZHVsZSBlbWJlci10ZXN0aW5nCiAgQHJlcXVpcmVzIGVtYmVyLWFwcGxpY2F0aW9uCiovCgp9
KSgpOwoKKGZ1bmN0aW9uKCkgewovKioKRW1iZXIKCkBtb2R1bGUgZW1iZXIKKi8KCmZ1bmN0aW9u
IHRocm93V2l0aE1lc3NhZ2UobXNnKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhyb3cg
bmV3IEVtYmVyLkVycm9yKG1zZyk7CiAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVSZW1vdmVkQ2xh
c3MoY2xhc3NOYW1lKSB7CiAgdmFyIG1zZyA9ICIgaGFzIGJlZW4gbW92ZWQgaW50byBhIHBsdWdp
bjogaHR0cHM6Ly9naXRodWIuY29tL2VtYmVyanMvZW1iZXItc3RhdGVzIjsKCiAgcmV0dXJuIHsK
ICAgIGV4dGVuZDogdGhyb3dXaXRoTWVzc2FnZShjbGFzc05hbWUgKyBtc2cpLAogICAgY3JlYXRl
OiB0aHJvd1dpdGhNZXNzYWdlKGNsYXNzTmFtZSArIG1zZykKICB9Owp9CgpFbWJlci5TdGF0ZU1h
bmFnZXIgPSBnZW5lcmF0ZVJlbW92ZWRDbGFzcygiRW1iZXIuU3RhdGVNYW5hZ2VyIik7CgovKioK
ICBUaGlzIHdhcyBleHBvcnRlZCB0byBlbWJlci1zdGF0ZXMgcGx1Z2luIGZvciB2IDEuMC4wIHJl
bGVhc2UuIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2VtYmVyanMvZW1iZXItc3RhdGVzCiAgCiAg
QGNsYXNzIFN0YXRlTWFuYWdlcgogIEBuYW1lc3BhY2UgRW1iZXIKKi8KCkVtYmVyLlN0YXRlID0g
Z2VuZXJhdGVSZW1vdmVkQ2xhc3MoIkVtYmVyLlN0YXRlIik7CgovKioKICBUaGlzIHdhcyBleHBv
cnRlZCB0byBlbWJlci1zdGF0ZXMgcGx1Z2luIGZvciB2IDEuMC4wIHJlbGVhc2UuIFNlZTogaHR0
cHM6Ly9naXRodWIuY29tL2VtYmVyanMvZW1iZXItc3RhdGVzCiAgCiAgQGNsYXNzIFN0YXRlCiAg
QG5hbWVzcGFjZSBFbWJlcgoqLwoKfSkoKTsKCgp9KSgpOwo=
</content>
  </attachment>
  <attachment>
    <filename>handlebars-v1.2.1.js</filename>
    <filesize>84981</filesize>
    <author>XWiki.Admin</author>
    <date>1391345074000</date>
    <version>1.1</version>
    <comment/>
    <content>LyohCgogaGFuZGxlYmFycyB2MS4yLjEKCkNvcHlyaWdodCAoQykgMjAxMSBieSBZZWh1ZGEgS2F0
egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBw
ZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRv
Y3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdh
cmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUg
cmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwg
c3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBl
cm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywg
c3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0
IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgph
bGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBT
T0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5E
LCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdB
UlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVS
UE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBP
UiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBP
VEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9S
IE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRI
RSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4K
CkBsaWNlbnNlCiovCi8qIGV4cG9ydGVkIEhhbmRsZWJhcnMgKi8KdmFyIEhhbmRsZWJhcnMgPSAo
ZnVuY3Rpb24oKSB7Ci8vIGhhbmRsZWJhcnMvc2FmZS1zdHJpbmcuanMKdmFyIF9fbW9kdWxlNF9f
ID0gKGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX187CiAgLy8g
QnVpbGQgb3V0IG91ciBiYXNpYyBTYWZlU3RyaW5nIHR5cGUKICBmdW5jdGlvbiBTYWZlU3RyaW5n
KHN0cmluZykgewogICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7CiAgfQoKICBTYWZlU3RyaW5nLnBy
b3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICIiICsgdGhpcy5zdHJp
bmc7CiAgfTsKCiAgX19leHBvcnRzX18gPSBTYWZlU3RyaW5nOwogIHJldHVybiBfX2V4cG9ydHNf
XzsKfSkoKTsKCi8vIGhhbmRsZWJhcnMvdXRpbHMuanMKdmFyIF9fbW9kdWxlM19fID0gKGZ1bmN0
aW9uKF9fZGVwZW5kZW5jeTFfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX18g
PSB7fTsKICAvKmpzaGludCAtVzAwNCAqLwogIHZhciBTYWZlU3RyaW5nID0gX19kZXBlbmRlbmN5
MV9fOwoKICB2YXIgZXNjYXBlID0gewogICAgIiYiOiAiJmFtcDsiLAogICAgIjwiOiAiJmx0OyIs
CiAgICAiPiI6ICImZ3Q7IiwKICAgICciJzogIiZxdW90OyIsCiAgICAiJyI6ICImI3gyNzsiLAog
ICAgImAiOiAiJiN4NjA7IgogIH07CgogIHZhciBiYWRDaGFycyA9IC9bJjw+IidgXS9nOwogIHZh
ciBwb3NzaWJsZSA9IC9bJjw+IidgXS87CgogIGZ1bmN0aW9uIGVzY2FwZUNoYXIoY2hyKSB7CiAg
ICByZXR1cm4gZXNjYXBlW2Nocl0gfHwgIiZhbXA7IjsKICB9CgogIGZ1bmN0aW9uIGV4dGVuZChv
YmosIHZhbHVlKSB7CiAgICBmb3IodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICBpZihPYmplY3Qu
cHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpIHsKICAgICAgICBvYmpb
a2V5XSA9IHZhbHVlW2tleV07CiAgICAgIH0KICAgIH0KICB9CgogIF9fZXhwb3J0c19fLmV4dGVu
ZCA9IGV4dGVuZDt2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogIF9f
ZXhwb3J0c19fLnRvU3RyaW5nID0gdG9TdHJpbmc7CiAgLy8gU291cmNlZCBmcm9tIGxvZGFzaAog
IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iZXN0aWVqcy9sb2Rhc2gvYmxvYi9tYXN0ZXIvTElDRU5T
RS50eHQKICB2YXIgaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdHlw
ZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nOwogIH07CiAgLy8gZmFsbGJhY2sgZm9yIG9sZGVyIHZl
cnNpb25zIG9mIENocm9tZSBhbmQgU2FmYXJpCiAgaWYgKGlzRnVuY3Rpb24oL3gvKSkgewogICAg
aXNGdW5jdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUg
PT09ICdmdW5jdGlvbicgJiYgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IEZ1bmN0
aW9uXSc7CiAgICB9OwogIH0KICB2YXIgaXNGdW5jdGlvbjsKICBfX2V4cG9ydHNfXy5pc0Z1bmN0
aW9uID0gaXNGdW5jdGlvbjsKICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rp
b24odmFsdWUpIHsKICAgIHJldHVybiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0
JykgPyB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PT0gJ1tvYmplY3QgQXJyYXldJyA6IGZhbHNlOwog
IH07CiAgX19leHBvcnRzX18uaXNBcnJheSA9IGlzQXJyYXk7CgogIGZ1bmN0aW9uIGVzY2FwZUV4
cHJlc3Npb24oc3RyaW5nKSB7CiAgICAvLyBkb24ndCBlc2NhcGUgU2FmZVN0cmluZ3MsIHNpbmNl
IHRoZXkncmUgYWxyZWFkeSBzYWZlCiAgICBpZiAoc3RyaW5nIGluc3RhbmNlb2YgU2FmZVN0cmlu
ZykgewogICAgICByZXR1cm4gc3RyaW5nLnRvU3RyaW5nKCk7CiAgICB9IGVsc2UgaWYgKCFzdHJp
bmcgJiYgc3RyaW5nICE9PSAwKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KCiAgICAvLyBGb3Jj
ZSBhIHN0cmluZyBjb252ZXJzaW9uIGFzIHRoaXMgd2lsbCBiZSBkb25lIGJ5IHRoZSBhcHBlbmQg
cmVnYXJkbGVzcyBhbmQKICAgIC8vIHRoZSByZWdleCB0ZXN0IHdpbGwgZG8gdGhpcyB0cmFuc3Bh
cmVudGx5IGJlaGluZCB0aGUgc2NlbmVzLCBjYXVzaW5nIGlzc3VlcyBpZgogICAgLy8gYW4gb2Jq
ZWN0J3MgdG8gc3RyaW5nIGhhcyBlc2NhcGVkIGNoYXJhY3RlcnMgaW4gaXQuCiAgICBzdHJpbmcg
PSAiIiArIHN0cmluZzsKCiAgICBpZighcG9zc2libGUudGVzdChzdHJpbmcpKSB7IHJldHVybiBz
dHJpbmc7IH0KICAgIHJldHVybiBzdHJpbmcucmVwbGFjZShiYWRDaGFycywgZXNjYXBlQ2hhcik7
CiAgfQoKICBfX2V4cG9ydHNfXy5lc2NhcGVFeHByZXNzaW9uID0gZXNjYXBlRXhwcmVzc2lvbjtm
dW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7CiAgICBpZiAoIXZhbHVlICYmIHZhbHVlICE9PSAwKSB7
CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSAmJiB2YWx1
ZS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICBy
ZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBfX2V4cG9ydHNfXy5pc0VtcHR5ID0gaXNFbXB0eTsK
ICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlNF9fKTsKCi8vIGhhbmRsZWJhcnMvZXhj
ZXB0aW9uLmpzCnZhciBfX21vZHVsZTVfXyA9IChmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7
CiAgdmFyIF9fZXhwb3J0c19fOwoKICB2YXIgZXJyb3JQcm9wcyA9IFsnZGVzY3JpcHRpb24nLCAn
ZmlsZU5hbWUnLCAnbGluZU51bWJlcicsICdtZXNzYWdlJywgJ25hbWUnLCAnbnVtYmVyJywgJ3N0
YWNrJ107CgogIGZ1bmN0aW9uIEV4Y2VwdGlvbigvKiBtZXNzYWdlICovKSB7CiAgICB2YXIgdG1w
ID0gRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cgog
ICAgLy8gVW5mb3J0dW5hdGVseSBlcnJvcnMgYXJlIG5vdCBlbnVtZXJhYmxlIGluIENocm9tZSAo
YXQgbGVhc3QpLCBzbyBgZm9yIHByb3AgaW4gdG1wYCBkb2Vzbid0IHdvcmsuCiAgICBmb3IgKHZh
ciBpZHggPSAwOyBpZHggPCBlcnJvclByb3BzLmxlbmd0aDsgaWR4KyspIHsKICAgICAgdGhpc1tl
cnJvclByb3BzW2lkeF1dID0gdG1wW2Vycm9yUHJvcHNbaWR4XV07CiAgICB9CiAgfQoKICBFeGNl
cHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CgogIF9fZXhwb3J0c19fID0gRXhjZXB0aW9u
OwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSkoKTsKCi8vIGhhbmRsZWJhcnMvYmFzZS5qcwp2YXIg
X19tb2R1bGUyX18gPSAoZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18p
IHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fID0ge307CiAgdmFyIFV0aWxzID0g
X19kZXBlbmRlbmN5MV9fOwogIHZhciBFeGNlcHRpb24gPSBfX2RlcGVuZGVuY3kyX187CgogIHZh
ciBWRVJTSU9OID0gIjEuMi4xIjsKICBfX2V4cG9ydHNfXy5WRVJTSU9OID0gVkVSU0lPTjt2YXIg
Q09NUElMRVJfUkVWSVNJT04gPSA0OwogIF9fZXhwb3J0c19fLkNPTVBJTEVSX1JFVklTSU9OID0g
Q09NUElMRVJfUkVWSVNJT047CiAgdmFyIFJFVklTSU9OX0NIQU5HRVMgPSB7CiAgICAxOiAnPD0g
MS4wLnJjLjInLCAvLyAxLjAucmMuMiBpcyBhY3R1YWxseSByZXYyIGJ1dCBkb2Vzbid0IHJlcG9y
dCBpdAogICAgMjogJz09IDEuMC4wLXJjLjMnLAogICAgMzogJz09IDEuMC4wLXJjLjQnLAogICAg
NDogJz49IDEuMC4wJwogIH07CiAgX19leHBvcnRzX18uUkVWSVNJT05fQ0hBTkdFUyA9IFJFVklT
SU9OX0NIQU5HRVM7CiAgdmFyIGlzQXJyYXkgPSBVdGlscy5pc0FycmF5LAogICAgICBpc0Z1bmN0
aW9uID0gVXRpbHMuaXNGdW5jdGlvbiwKICAgICAgdG9TdHJpbmcgPSBVdGlscy50b1N0cmluZywK
ICAgICAgb2JqZWN0VHlwZSA9ICdbb2JqZWN0IE9iamVjdF0nOwoKICBmdW5jdGlvbiBIYW5kbGVi
YXJzRW52aXJvbm1lbnQoaGVscGVycywgcGFydGlhbHMpIHsKICAgIHRoaXMuaGVscGVycyA9IGhl
bHBlcnMgfHwge307CiAgICB0aGlzLnBhcnRpYWxzID0gcGFydGlhbHMgfHwge307CgogICAgcmVn
aXN0ZXJEZWZhdWx0SGVscGVycyh0aGlzKTsKICB9CgogIF9fZXhwb3J0c19fLkhhbmRsZWJhcnNF
bnZpcm9ubWVudCA9IEhhbmRsZWJhcnNFbnZpcm9ubWVudDtIYW5kbGViYXJzRW52aXJvbm1lbnQu
cHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IEhhbmRsZWJhcnNFbnZpcm9ubWVudCwKCiAg
ICBsb2dnZXI6IGxvZ2dlciwKICAgIGxvZzogbG9nLAoKICAgIHJlZ2lzdGVySGVscGVyOiBmdW5j
dGlvbihuYW1lLCBmbiwgaW52ZXJzZSkgewogICAgICBpZiAodG9TdHJpbmcuY2FsbChuYW1lKSA9
PT0gb2JqZWN0VHlwZSkgewogICAgICAgIGlmIChpbnZlcnNlIHx8IGZuKSB7IHRocm93IG5ldyBF
eGNlcHRpb24oJ0FyZyBub3Qgc3VwcG9ydGVkIHdpdGggbXVsdGlwbGUgaGVscGVycycpOyB9CiAg
ICAgICAgVXRpbHMuZXh0ZW5kKHRoaXMuaGVscGVycywgbmFtZSk7CiAgICAgIH0gZWxzZSB7CiAg
ICAgICAgaWYgKGludmVyc2UpIHsgZm4ubm90ID0gaW52ZXJzZTsgfQogICAgICAgIHRoaXMuaGVs
cGVyc1tuYW1lXSA9IGZuOwogICAgICB9CiAgICB9LAoKICAgIHJlZ2lzdGVyUGFydGlhbDogZnVu
Y3Rpb24obmFtZSwgc3RyKSB7CiAgICAgIGlmICh0b1N0cmluZy5jYWxsKG5hbWUpID09PSBvYmpl
Y3RUeXBlKSB7CiAgICAgICAgVXRpbHMuZXh0ZW5kKHRoaXMucGFydGlhbHMsICBuYW1lKTsKICAg
ICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhcnRpYWxzW25hbWVdID0gc3RyOwogICAgICB9CiAg
ICB9CiAgfTsKCiAgZnVuY3Rpb24gcmVnaXN0ZXJEZWZhdWx0SGVscGVycyhpbnN0YW5jZSkgewog
ICAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2hlbHBlck1pc3NpbmcnLCBmdW5jdGlvbihhcmcp
IHsKICAgICAgaWYoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgIHJldHVybiB1bmRl
ZmluZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIGhl
bHBlcjogJyIgKyBhcmcgKyAiJyIpOwogICAgICB9CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdp
c3RlckhlbHBlcignYmxvY2tIZWxwZXJNaXNzaW5nJywgZnVuY3Rpb24oY29udGV4dCwgb3B0aW9u
cykgewogICAgICB2YXIgaW52ZXJzZSA9IG9wdGlvbnMuaW52ZXJzZSB8fCBmdW5jdGlvbigpIHt9
LCBmbiA9IG9wdGlvbnMuZm47CgogICAgICBpZiAoaXNGdW5jdGlvbihjb250ZXh0KSkgeyBjb250
ZXh0ID0gY29udGV4dC5jYWxsKHRoaXMpOyB9CgogICAgICBpZihjb250ZXh0ID09PSB0cnVlKSB7
CiAgICAgICAgcmV0dXJuIGZuKHRoaXMpOwogICAgICB9IGVsc2UgaWYoY29udGV4dCA9PT0gZmFs
c2UgfHwgY29udGV4dCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7CiAg
ICAgIH0gZWxzZSBpZiAoaXNBcnJheShjb250ZXh0KSkgewogICAgICAgIGlmKGNvbnRleHQubGVu
Z3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmhlbHBlcnMuZWFjaChjb250ZXh0
LCBvcHRpb25zKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGludmVyc2UodGhp
cyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmbihjb250ZXh0KTsK
ICAgICAgfQogICAgfSk7CgogICAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2VhY2gnLCBmdW5j
dGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAgICAgIHZhciBmbiA9IG9wdGlvbnMuZm4sIGludmVy
c2UgPSBvcHRpb25zLmludmVyc2U7CiAgICAgIHZhciBpID0gMCwgcmV0ID0gIiIsIGRhdGE7Cgog
ICAgICBpZiAoaXNGdW5jdGlvbihjb250ZXh0KSkgeyBjb250ZXh0ID0gY29udGV4dC5jYWxsKHRo
aXMpOyB9CgogICAgICBpZiAob3B0aW9ucy5kYXRhKSB7CiAgICAgICAgZGF0YSA9IGNyZWF0ZUZy
YW1lKG9wdGlvbnMuZGF0YSk7CiAgICAgIH0KCiAgICAgIGlmKGNvbnRleHQgJiYgdHlwZW9mIGNv
bnRleHQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgaWYgKGlzQXJyYXkoY29udGV4dCkpIHsKICAg
ICAgICAgIGZvcih2YXIgaiA9IGNvbnRleHQubGVuZ3RoOyBpPGo7IGkrKykgewogICAgICAgICAg
ICBpZiAoZGF0YSkgewogICAgICAgICAgICAgIGRhdGEuaW5kZXggPSBpOwogICAgICAgICAgICAg
IGRhdGEuZmlyc3QgPSAoaSA9PT0gMCk7CiAgICAgICAgICAgICAgZGF0YS5sYXN0ICA9IChpID09
PSAoY29udGV4dC5sZW5ndGgtMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldCA9IHJl
dCArIGZuKGNvbnRleHRbaV0sIHsgZGF0YTogZGF0YSB9KTsKICAgICAgICAgIH0KICAgICAgICB9
IGVsc2UgewogICAgICAgICAgZm9yKHZhciBrZXkgaW4gY29udGV4dCkgewogICAgICAgICAgICBp
Zihjb250ZXh0Lmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBpZihkYXRhKSB7
IAogICAgICAgICAgICAgICAgZGF0YS5rZXkgPSBrZXk7IAogICAgICAgICAgICAgICAgZGF0YS5p
bmRleCA9IGk7CiAgICAgICAgICAgICAgICBkYXRhLmZpcnN0ID0gKGkgPT09IDApOwogICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICByZXQgPSByZXQgKyBmbihjb250ZXh0W2tleV0sIHtkYXRh
OiBkYXRhfSk7CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAg
ICAgICAgfQogICAgICB9CgogICAgICBpZihpID09PSAwKXsKICAgICAgICByZXQgPSBpbnZlcnNl
KHRoaXMpOwogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfSk7CgogICAgaW5zdGFuY2Uu
cmVnaXN0ZXJIZWxwZXIoJ2lmJywgZnVuY3Rpb24oY29uZGl0aW9uYWwsIG9wdGlvbnMpIHsKICAg
ICAgaWYgKGlzRnVuY3Rpb24oY29uZGl0aW9uYWwpKSB7IGNvbmRpdGlvbmFsID0gY29uZGl0aW9u
YWwuY2FsbCh0aGlzKTsgfQoKICAgICAgLy8gRGVmYXVsdCBiZWhhdmlvciBpcyB0byByZW5kZXIg
dGhlIHBvc2l0aXZlIHBhdGggaWYgdGhlIHZhbHVlIGlzIHRydXRoeSBhbmQgbm90IGVtcHR5Lgog
ICAgICAvLyBUaGUgYGluY2x1ZGVaZXJvYCBvcHRpb24gbWF5IGJlIHNldCB0byB0cmVhdCB0aGUg
Y29uZHRpb25hbCBhcyBwdXJlbHkgbm90IGVtcHR5IGJhc2VkIG9uIHRoZQogICAgICAvLyBiZWhh
dmlvciBvZiBpc0VtcHR5LiBFZmZlY3RpdmVseSB0aGlzIGRldGVybWluZXMgaWYgMCBpcyBoYW5k
bGVkIGJ5IHRoZSBwb3NpdGl2ZSBwYXRoIG9yIG5lZ2F0aXZlLgogICAgICBpZiAoKCFvcHRpb25z
Lmhhc2guaW5jbHVkZVplcm8gJiYgIWNvbmRpdGlvbmFsKSB8fCBVdGlscy5pc0VtcHR5KGNvbmRp
dGlvbmFsKSkgewogICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7CiAgICAgIH0g
ZWxzZSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7CiAgICAgIH0KICAgIH0pOwoK
ICAgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCd1bmxlc3MnLCBmdW5jdGlvbihjb25kaXRpb25h
bCwgb3B0aW9ucykgewogICAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVyc1snaWYnXS5jYWxsKHRo
aXMsIGNvbmRpdGlvbmFsLCB7Zm46IG9wdGlvbnMuaW52ZXJzZSwgaW52ZXJzZTogb3B0aW9ucy5m
biwgaGFzaDogb3B0aW9ucy5oYXNofSk7CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdpc3Rlckhl
bHBlcignd2l0aCcsIGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgaWYgKGlzRnVu
Y3Rpb24oY29udGV4dCkpIHsgY29udGV4dCA9IGNvbnRleHQuY2FsbCh0aGlzKTsgfQoKICAgICAg
aWYgKCFVdGlscy5pc0VtcHR5KGNvbnRleHQpKSByZXR1cm4gb3B0aW9ucy5mbihjb250ZXh0KTsK
ICAgIH0pOwoKICAgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdsb2cnLCBmdW5jdGlvbihjb250
ZXh0LCBvcHRpb25zKSB7CiAgICAgIHZhciBsZXZlbCA9IG9wdGlvbnMuZGF0YSAmJiBvcHRpb25z
LmRhdGEubGV2ZWwgIT0gbnVsbCA/IHBhcnNlSW50KG9wdGlvbnMuZGF0YS5sZXZlbCwgMTApIDog
MTsKICAgICAgaW5zdGFuY2UubG9nKGxldmVsLCBjb250ZXh0KTsKICAgIH0pOwogIH0KCiAgdmFy
IGxvZ2dlciA9IHsKICAgIG1ldGhvZE1hcDogeyAwOiAnZGVidWcnLCAxOiAnaW5mbycsIDI6ICd3
YXJuJywgMzogJ2Vycm9yJyB9LAoKICAgIC8vIFN0YXRlIGVudW0KICAgIERFQlVHOiAwLAogICAg
SU5GTzogMSwKICAgIFdBUk46IDIsCiAgICBFUlJPUjogMywKICAgIGxldmVsOiAzLAoKICAgIC8v
IGNhbiBiZSBvdmVycmlkZGVuIGluIHRoZSBob3N0IGVudmlyb25tZW50CiAgICBsb2c6IGZ1bmN0
aW9uKGxldmVsLCBvYmopIHsKICAgICAgaWYgKGxvZ2dlci5sZXZlbCA8PSBsZXZlbCkgewogICAg
ICAgIHZhciBtZXRob2QgPSBsb2dnZXIubWV0aG9kTWFwW2xldmVsXTsKICAgICAgICBpZiAodHlw
ZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGVbbWV0aG9kXSkgewogICAgICAg
ICAgY29uc29sZVttZXRob2RdLmNhbGwoY29uc29sZSwgb2JqKTsKICAgICAgICB9CiAgICAgIH0K
ICAgIH0KICB9OwogIF9fZXhwb3J0c19fLmxvZ2dlciA9IGxvZ2dlcjsKICBmdW5jdGlvbiBsb2co
bGV2ZWwsIG9iaikgeyBsb2dnZXIubG9nKGxldmVsLCBvYmopOyB9CgogIF9fZXhwb3J0c19fLmxv
ZyA9IGxvZzt2YXIgY3JlYXRlRnJhbWUgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgIHZhciBvYmog
PSB7fTsKICAgIFV0aWxzLmV4dGVuZChvYmosIG9iamVjdCk7CiAgICByZXR1cm4gb2JqOwogIH07
CiAgX19leHBvcnRzX18uY3JlYXRlRnJhbWUgPSBjcmVhdGVGcmFtZTsKICByZXR1cm4gX19leHBv
cnRzX187Cn0pKF9fbW9kdWxlM19fLCBfX21vZHVsZTVfXyk7CgovLyBoYW5kbGViYXJzL3J1bnRp
bWUuanMKdmFyIF9fbW9kdWxlNl9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBl
bmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18pIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhw
b3J0c19fID0ge307CiAgdmFyIFV0aWxzID0gX19kZXBlbmRlbmN5MV9fOwogIHZhciBFeGNlcHRp
b24gPSBfX2RlcGVuZGVuY3kyX187CiAgdmFyIENPTVBJTEVSX1JFVklTSU9OID0gX19kZXBlbmRl
bmN5M19fLkNPTVBJTEVSX1JFVklTSU9OOwogIHZhciBSRVZJU0lPTl9DSEFOR0VTID0gX19kZXBl
bmRlbmN5M19fLlJFVklTSU9OX0NIQU5HRVM7CgogIGZ1bmN0aW9uIGNoZWNrUmV2aXNpb24oY29t
cGlsZXJJbmZvKSB7CiAgICB2YXIgY29tcGlsZXJSZXZpc2lvbiA9IGNvbXBpbGVySW5mbyAmJiBj
b21waWxlckluZm9bMF0gfHwgMSwKICAgICAgICBjdXJyZW50UmV2aXNpb24gPSBDT01QSUxFUl9S
RVZJU0lPTjsKCiAgICBpZiAoY29tcGlsZXJSZXZpc2lvbiAhPT0gY3VycmVudFJldmlzaW9uKSB7
CiAgICAgIGlmIChjb21waWxlclJldmlzaW9uIDwgY3VycmVudFJldmlzaW9uKSB7CiAgICAgICAg
dmFyIHJ1bnRpbWVWZXJzaW9ucyA9IFJFVklTSU9OX0NIQU5HRVNbY3VycmVudFJldmlzaW9uXSwK
ICAgICAgICAgICAgY29tcGlsZXJWZXJzaW9ucyA9IFJFVklTSU9OX0NIQU5HRVNbY29tcGlsZXJS
ZXZpc2lvbl07CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUZW1wbGF0ZSB3YXMgcHJlY29tcGls
ZWQgd2l0aCBhbiBvbGRlciB2ZXJzaW9uIG9mIEhhbmRsZWJhcnMgdGhhbiB0aGUgY3VycmVudCBy
dW50aW1lLiAiKwogICAgICAgICAgICAgICJQbGVhc2UgdXBkYXRlIHlvdXIgcHJlY29tcGlsZXIg
dG8gYSBuZXdlciB2ZXJzaW9uICgiK3J1bnRpbWVWZXJzaW9ucysiKSBvciBkb3duZ3JhZGUgeW91
ciBydW50aW1lIHRvIGFuIG9sZGVyIHZlcnNpb24gKCIrY29tcGlsZXJWZXJzaW9ucysiKS4iKTsK
ICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBVc2UgdGhlIGVtYmVkZGVkIHZlcnNpb24gaW5mbyBz
aW5jZSB0aGUgcnVudGltZSBkb2Vzbid0IGtub3cgYWJvdXQgdGhpcyByZXZpc2lvbiB5ZXQKICAg
ICAgICB0aHJvdyBuZXcgRXJyb3IoIlRlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGEgbmV3
ZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gIisKICAg
ICAgICAgICAgICAiUGxlYXNlIHVwZGF0ZSB5b3VyIHJ1bnRpbWUgdG8gYSBuZXdlciB2ZXJzaW9u
ICgiK2NvbXBpbGVySW5mb1sxXSsiKS4iKTsKICAgICAgfQogICAgfQogIH0KCiAgX19leHBvcnRz
X18uY2hlY2tSZXZpc2lvbiA9IGNoZWNrUmV2aXNpb247Ly8gVE9ETzogUmVtb3ZlIHRoaXMgbGlu
ZSBhbmQgYnJlYWsgdXAgY29tcGlsZVBhcnRpYWwKCiAgZnVuY3Rpb24gdGVtcGxhdGUodGVtcGxh
dGVTcGVjLCBlbnYpIHsKICAgIGlmICghZW52KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8g
ZW52aXJvbm1lbnQgcGFzc2VkIHRvIHRlbXBsYXRlIik7CiAgICB9CgogICAgLy8gTm90ZTogVXNp
bmcgZW52LlZNIHJlZmVyZW5jZXMgcmF0aGVyIHRoYW4gbG9jYWwgdmFyIHJlZmVyZW5jZXMgdGhy
b3VnaG91dCB0aGlzIHNlY3Rpb24gdG8gYWxsb3cKICAgIC8vIGZvciBleHRlcm5hbCB1c2VycyB0
byBvdmVycmlkZSB0aGVzZSBhcyBwc3VlZG8tc3VwcG9ydGVkIEFQSXMuCiAgICB2YXIgaW52b2tl
UGFydGlhbFdyYXBwZXIgPSBmdW5jdGlvbihwYXJ0aWFsLCBuYW1lLCBjb250ZXh0LCBoZWxwZXJz
LCBwYXJ0aWFscywgZGF0YSkgewogICAgICB2YXIgcmVzdWx0ID0gZW52LlZNLmludm9rZVBhcnRp
YWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7IHJl
dHVybiByZXN1bHQ7IH0KCiAgICAgIGlmIChlbnYuY29tcGlsZSkgewogICAgICAgIHZhciBvcHRp
b25zID0geyBoZWxwZXJzOiBoZWxwZXJzLCBwYXJ0aWFsczogcGFydGlhbHMsIGRhdGE6IGRhdGEg
fTsKICAgICAgICBwYXJ0aWFsc1tuYW1lXSA9IGVudi5jb21waWxlKHBhcnRpYWwsIHsgZGF0YTog
ZGF0YSAhPT0gdW5kZWZpbmVkIH0sIGVudik7CiAgICAgICAgcmV0dXJuIHBhcnRpYWxzW25hbWVd
KGNvbnRleHQsIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFeGNl
cHRpb24oIlRoZSBwYXJ0aWFsICIgKyBuYW1lICsgIiBjb3VsZCBub3QgYmUgY29tcGlsZWQgd2hl
biBydW5uaW5nIGluIHJ1bnRpbWUtb25seSBtb2RlIik7CiAgICAgIH0KICAgIH07CgogICAgLy8g
SnVzdCBhZGQgd2F0ZXIKICAgIHZhciBjb250YWluZXIgPSB7CiAgICAgIGVzY2FwZUV4cHJlc3Np
b246IFV0aWxzLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgIGludm9rZVBhcnRpYWw6IGludm9rZVBh
cnRpYWxXcmFwcGVyLAogICAgICBwcm9ncmFtczogW10sCiAgICAgIHByb2dyYW06IGZ1bmN0aW9u
KGksIGZuLCBkYXRhKSB7CiAgICAgICAgdmFyIHByb2dyYW1XcmFwcGVyID0gdGhpcy5wcm9ncmFt
c1tpXTsKICAgICAgICBpZihkYXRhKSB7CiAgICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHByb2dy
YW0oaSwgZm4sIGRhdGEpOwogICAgICAgIH0gZWxzZSBpZiAoIXByb2dyYW1XcmFwcGVyKSB7CiAg
ICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHRoaXMucHJvZ3JhbXNbaV0gPSBwcm9ncmFtKGksIGZu
KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb2dyYW1XcmFwcGVyOwogICAgICB9LAogICAg
ICBtZXJnZTogZnVuY3Rpb24ocGFyYW0sIGNvbW1vbikgewogICAgICAgIHZhciByZXQgPSBwYXJh
bSB8fCBjb21tb247CgogICAgICAgIGlmIChwYXJhbSAmJiBjb21tb24gJiYgKHBhcmFtICE9PSBj
b21tb24pKSB7CiAgICAgICAgICByZXQgPSB7fTsKICAgICAgICAgIFV0aWxzLmV4dGVuZChyZXQs
IGNvbW1vbik7CiAgICAgICAgICBVdGlscy5leHRlbmQocmV0LCBwYXJhbSk7CiAgICAgICAgfQog
ICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0sCiAgICAgIHByb2dyYW1XaXRoRGVwdGg6IGVudi5W
TS5wcm9ncmFtV2l0aERlcHRoLAogICAgICBub29wOiBlbnYuVk0ubm9vcCwKICAgICAgY29tcGls
ZXJJbmZvOiBudWxsCiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25z
KSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB2YXIgbmFtZXNwYWNlID0g
b3B0aW9ucy5wYXJ0aWFsID8gb3B0aW9ucyA6IGVudiwKICAgICAgICAgIGhlbHBlcnMsCiAgICAg
ICAgICBwYXJ0aWFsczsKCiAgICAgIGlmICghb3B0aW9ucy5wYXJ0aWFsKSB7CiAgICAgICAgaGVs
cGVycyA9IG9wdGlvbnMuaGVscGVyczsKICAgICAgICBwYXJ0aWFscyA9IG9wdGlvbnMucGFydGlh
bHM7CiAgICAgIH0KICAgICAgdmFyIHJlc3VsdCA9IHRlbXBsYXRlU3BlYy5jYWxsKAogICAgICAg
ICAgICBjb250YWluZXIsCiAgICAgICAgICAgIG5hbWVzcGFjZSwgY29udGV4dCwKICAgICAgICAg
ICAgaGVscGVycywKICAgICAgICAgICAgcGFydGlhbHMsCiAgICAgICAgICAgIG9wdGlvbnMuZGF0
YSk7CgogICAgICBpZiAoIW9wdGlvbnMucGFydGlhbCkgewogICAgICAgIGVudi5WTS5jaGVja1Jl
dmlzaW9uKGNvbnRhaW5lci5jb21waWxlckluZm8pOwogICAgICB9CgogICAgICByZXR1cm4gcmVz
dWx0OwogICAgfTsKICB9CgogIF9fZXhwb3J0c19fLnRlbXBsYXRlID0gdGVtcGxhdGU7ZnVuY3Rp
b24gcHJvZ3JhbVdpdGhEZXB0aChpLCBmbiwgZGF0YSAvKiwgJGRlcHRoICovKSB7CiAgICB2YXIg
YXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyk7CgogICAgdmFy
IHByb2cgPSBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRp
b25zIHx8IHt9OwoKICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIFtjb250ZXh0LCBvcHRpb25z
LmRhdGEgfHwgZGF0YV0uY29uY2F0KGFyZ3MpKTsKICAgIH07CiAgICBwcm9nLnByb2dyYW0gPSBp
OwogICAgcHJvZy5kZXB0aCA9IGFyZ3MubGVuZ3RoOwogICAgcmV0dXJuIHByb2c7CiAgfQoKICBf
X2V4cG9ydHNfXy5wcm9ncmFtV2l0aERlcHRoID0gcHJvZ3JhbVdpdGhEZXB0aDtmdW5jdGlvbiBw
cm9ncmFtKGksIGZuLCBkYXRhKSB7CiAgICB2YXIgcHJvZyA9IGZ1bmN0aW9uKGNvbnRleHQsIG9w
dGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICByZXR1cm4gZm4o
Y29udGV4dCwgb3B0aW9ucy5kYXRhIHx8IGRhdGEpOwogICAgfTsKICAgIHByb2cucHJvZ3JhbSA9
IGk7CiAgICBwcm9nLmRlcHRoID0gMDsKICAgIHJldHVybiBwcm9nOwogIH0KCiAgX19leHBvcnRz
X18ucHJvZ3JhbSA9IHByb2dyYW07ZnVuY3Rpb24gaW52b2tlUGFydGlhbChwYXJ0aWFsLCBuYW1l
LCBjb250ZXh0LCBoZWxwZXJzLCBwYXJ0aWFscywgZGF0YSkgewogICAgdmFyIG9wdGlvbnMgPSB7
IHBhcnRpYWw6IHRydWUsIGhlbHBlcnM6IGhlbHBlcnMsIHBhcnRpYWxzOiBwYXJ0aWFscywgZGF0
YTogZGF0YSB9OwoKICAgIGlmKHBhcnRpYWwgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyBu
ZXcgRXhjZXB0aW9uKCJUaGUgcGFydGlhbCAiICsgbmFtZSArICIgY291bGQgbm90IGJlIGZvdW5k
Iik7CiAgICB9IGVsc2UgaWYocGFydGlhbCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgIHJl
dHVybiBwYXJ0aWFsKGNvbnRleHQsIG9wdGlvbnMpOwogICAgfQogIH0KCiAgX19leHBvcnRzX18u
aW52b2tlUGFydGlhbCA9IGludm9rZVBhcnRpYWw7ZnVuY3Rpb24gbm9vcCgpIHsgcmV0dXJuICIi
OyB9CgogIF9fZXhwb3J0c19fLm5vb3AgPSBub29wOwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSko
X19tb2R1bGUzX18sIF9fbW9kdWxlNV9fLCBfX21vZHVsZTJfXyk7CgovLyBoYW5kbGViYXJzLnJ1
bnRpbWUuanMKdmFyIF9fbW9kdWxlMV9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19k
ZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXywgX19kZXBlbmRl
bmN5NV9fKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX2V4cG9ydHNfXzsKICAvKmdsb2JhbHMg
SGFuZGxlYmFyczogdHJ1ZSAqLwogIHZhciBiYXNlID0gX19kZXBlbmRlbmN5MV9fOwoKICAvLyBF
YWNoIG9mIHRoZXNlIGF1Z21lbnQgdGhlIEhhbmRsZWJhcnMgb2JqZWN0LiBObyBuZWVkIHRvIHNl
dHVwIGhlcmUuCiAgLy8gKFRoaXMgaXMgZG9uZSB0byBlYXNpbHkgc2hhcmUgY29kZSBiZXR3ZWVu
IGNvbW1vbmpzIGFuZCBicm93c2UgZW52cykKICB2YXIgU2FmZVN0cmluZyA9IF9fZGVwZW5kZW5j
eTJfXzsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5M19fOwogIHZhciBVdGlscyA9IF9f
ZGVwZW5kZW5jeTRfXzsKICB2YXIgcnVudGltZSA9IF9fZGVwZW5kZW5jeTVfXzsKCiAgLy8gRm9y
IGNvbXBhdGliaWxpdHkgYW5kIHVzYWdlIG91dHNpZGUgb2YgbW9kdWxlIHN5c3RlbXMsIG1ha2Ug
dGhlIEhhbmRsZWJhcnMgb2JqZWN0IGEgbmFtZXNwYWNlCiAgdmFyIGNyZWF0ZSA9IGZ1bmN0aW9u
KCkgewogICAgdmFyIGhiID0gbmV3IGJhc2UuSGFuZGxlYmFyc0Vudmlyb25tZW50KCk7CgogICAg
VXRpbHMuZXh0ZW5kKGhiLCBiYXNlKTsKICAgIGhiLlNhZmVTdHJpbmcgPSBTYWZlU3RyaW5nOwog
ICAgaGIuRXhjZXB0aW9uID0gRXhjZXB0aW9uOwogICAgaGIuVXRpbHMgPSBVdGlsczsKCiAgICBo
Yi5WTSA9IHJ1bnRpbWU7CiAgICBoYi50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHNwZWMpIHsKICAgICAg
cmV0dXJuIHJ1bnRpbWUudGVtcGxhdGUoc3BlYywgaGIpOwogICAgfTsKCiAgICByZXR1cm4gaGI7
CiAgfTsKCiAgdmFyIEhhbmRsZWJhcnMgPSBjcmVhdGUoKTsKICBIYW5kbGViYXJzLmNyZWF0ZSA9
IGNyZWF0ZTsKCiAgX19leHBvcnRzX18gPSBIYW5kbGViYXJzOwogIHJldHVybiBfX2V4cG9ydHNf
XzsKfSkoX19tb2R1bGUyX18sIF9fbW9kdWxlNF9fLCBfX21vZHVsZTVfXywgX19tb2R1bGUzX18s
IF9fbW9kdWxlNl9fKTsKCi8vIGhhbmRsZWJhcnMvY29tcGlsZXIvYXN0LmpzCnZhciBfX21vZHVs
ZTdfXyA9IChmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18pIHsKICAidXNlIHN0cmljdCI7CiAgdmFy
IF9fZXhwb3J0c19fOwogIHZhciBFeGNlcHRpb24gPSBfX2RlcGVuZGVuY3kxX187CgogIHZhciBB
U1QgPSB7CiAgICBQcm9ncmFtTm9kZTogZnVuY3Rpb24oc3RhdGVtZW50cywgaW52ZXJzZVN0cmlw
LCBpbnZlcnNlKSB7CiAgICAgIHRoaXMudHlwZSA9ICJwcm9ncmFtIjsKICAgICAgdGhpcy5zdGF0
ZW1lbnRzID0gc3RhdGVtZW50czsKICAgICAgdGhpcy5zdHJpcCA9IHt9OwoKICAgICAgaWYoaW52
ZXJzZSkgewogICAgICAgIHRoaXMuaW52ZXJzZSA9IG5ldyBBU1QuUHJvZ3JhbU5vZGUoaW52ZXJz
ZSwgaW52ZXJzZVN0cmlwKTsKICAgICAgICB0aGlzLnN0cmlwLnJpZ2h0ID0gaW52ZXJzZVN0cmlw
LmxlZnQ7CiAgICAgIH0gZWxzZSBpZiAoaW52ZXJzZVN0cmlwKSB7CiAgICAgICAgdGhpcy5zdHJp
cC5sZWZ0ID0gaW52ZXJzZVN0cmlwLnJpZ2h0OwogICAgICB9CiAgICB9LAoKICAgIE11c3RhY2hl
Tm9kZTogZnVuY3Rpb24ocmF3UGFyYW1zLCBoYXNoLCBvcGVuLCBzdHJpcCkgewogICAgICB0aGlz
LnR5cGUgPSAibXVzdGFjaGUiOwogICAgICB0aGlzLmhhc2ggPSBoYXNoOwogICAgICB0aGlzLnN0
cmlwID0gc3RyaXA7CgogICAgICAvLyBPcGVuIG1heSBiZSBhIHN0cmluZyBwYXJzZWQgZnJvbSB0
aGUgcGFyc2VyIG9yIGEgcGFzc2VkIGJvb2xlYW4gZmxhZwogICAgICBpZiAob3BlbiAhPSBudWxs
ICYmIG9wZW4uY2hhckF0KSB7CiAgICAgICAgLy8gTXVzdCB1c2UgY2hhckF0IHRvIHN1cHBvcnQg
SUUgcHJlLTEwCiAgICAgICAgdmFyIGVzY2FwZUZsYWcgPSBvcGVuLmNoYXJBdCgzKSB8fCBvcGVu
LmNoYXJBdCgyKTsKICAgICAgICB0aGlzLmVzY2FwZWQgPSBlc2NhcGVGbGFnICE9PSAneycgJiYg
ZXNjYXBlRmxhZyAhPT0gJyYnOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXNjYXBlZCA9
ICEhb3BlbjsKICAgICAgfQoKICAgICAgdmFyIGlkID0gdGhpcy5pZCA9IHJhd1BhcmFtc1swXTsK
ICAgICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyYW1zID0gcmF3UGFyYW1zLnNsaWNlKDEpOwoKICAg
ICAgLy8gYSBtdXN0YWNoZSBpcyBhbiBlbGlnaWJsZSBoZWxwZXIgaWY6CiAgICAgIC8vICogaXRz
IGlkIGlzIHNpbXBsZSAoYSBzaW5nbGUgcGFydCwgbm90IGB0aGlzYCBvciBgLi5gKQogICAgICB2
YXIgZWxpZ2libGVIZWxwZXIgPSB0aGlzLmVsaWdpYmxlSGVscGVyID0gaWQuaXNTaW1wbGU7Cgog
ICAgICAvLyBhIG11c3RhY2hlIGlzIGRlZmluaXRlbHkgYSBoZWxwZXIgaWY6CiAgICAgIC8vICog
aXQgaXMgYW4gZWxpZ2libGUgaGVscGVyLCBhbmQKICAgICAgLy8gKiBpdCBoYXMgYXQgbGVhc3Qg
b25lIHBhcmFtZXRlciBvciBoYXNoIHNlZ21lbnQKICAgICAgdGhpcy5pc0hlbHBlciA9IGVsaWdp
YmxlSGVscGVyICYmIChwYXJhbXMubGVuZ3RoIHx8IGhhc2gpOwoKICAgICAgLy8gaWYgYSBtdXN0
YWNoZSBpcyBhbiBlbGlnaWJsZSBoZWxwZXIgYnV0IG5vdCBhIGRlZmluaXRlCiAgICAgIC8vIGhl
bHBlciwgaXQgaXMgYW1iaWd1b3VzLCBhbmQgd2lsbCBiZSByZXNvbHZlZCBpbiBhIGxhdGVyCiAg
ICAgIC8vIHBhc3Mgb3IgYXQgcnVudGltZS4KICAgIH0sCgogICAgUGFydGlhbE5vZGU6IGZ1bmN0
aW9uKHBhcnRpYWxOYW1lLCBjb250ZXh0LCBzdHJpcCkgewogICAgICB0aGlzLnR5cGUgICAgICAg
ICA9ICJwYXJ0aWFsIjsKICAgICAgdGhpcy5wYXJ0aWFsTmFtZSAgPSBwYXJ0aWFsTmFtZTsKICAg
ICAgdGhpcy5jb250ZXh0ICAgICAgPSBjb250ZXh0OwogICAgICB0aGlzLnN0cmlwID0gc3RyaXA7
CiAgICB9LAoKICAgIEJsb2NrTm9kZTogZnVuY3Rpb24obXVzdGFjaGUsIHByb2dyYW0sIGludmVy
c2UsIGNsb3NlKSB7CiAgICAgIGlmKG11c3RhY2hlLmlkLm9yaWdpbmFsICE9PSBjbG9zZS5wYXRo
Lm9yaWdpbmFsKSB7CiAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbihtdXN0YWNoZS5pZC5vcmln
aW5hbCArICIgZG9lc24ndCBtYXRjaCAiICsgY2xvc2UucGF0aC5vcmlnaW5hbCk7CiAgICAgIH0K
CiAgICAgIHRoaXMudHlwZSA9ICJibG9jayI7CiAgICAgIHRoaXMubXVzdGFjaGUgPSBtdXN0YWNo
ZTsKICAgICAgdGhpcy5wcm9ncmFtICA9IHByb2dyYW07CiAgICAgIHRoaXMuaW52ZXJzZSAgPSBp
bnZlcnNlOwoKICAgICAgdGhpcy5zdHJpcCA9IHsKICAgICAgICBsZWZ0OiBtdXN0YWNoZS5zdHJp
cC5sZWZ0LAogICAgICAgIHJpZ2h0OiBjbG9zZS5zdHJpcC5yaWdodAogICAgICB9OwoKICAgICAg
KHByb2dyYW0gfHwgaW52ZXJzZSkuc3RyaXAubGVmdCA9IG11c3RhY2hlLnN0cmlwLnJpZ2h0Owog
ICAgICAoaW52ZXJzZSB8fCBwcm9ncmFtKS5zdHJpcC5yaWdodCA9IGNsb3NlLnN0cmlwLmxlZnQ7
CgogICAgICBpZiAoaW52ZXJzZSAmJiAhcHJvZ3JhbSkgewogICAgICAgIHRoaXMuaXNJbnZlcnNl
ID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICBDb250ZW50Tm9kZTogZnVuY3Rpb24oc3RyaW5n
KSB7CiAgICAgIHRoaXMudHlwZSA9ICJjb250ZW50IjsKICAgICAgdGhpcy5zdHJpbmcgPSBzdHJp
bmc7CiAgICB9LAoKICAgIEhhc2hOb2RlOiBmdW5jdGlvbihwYWlycykgewogICAgICB0aGlzLnR5
cGUgPSAiaGFzaCI7CiAgICAgIHRoaXMucGFpcnMgPSBwYWlyczsKICAgIH0sCgogICAgSWROb2Rl
OiBmdW5jdGlvbihwYXJ0cykgewogICAgICB0aGlzLnR5cGUgPSAiSUQiOwoKICAgICAgdmFyIG9y
aWdpbmFsID0gIiIsCiAgICAgICAgICBkaWcgPSBbXSwKICAgICAgICAgIGRlcHRoID0gMDsKCiAg
ICAgIGZvcih2YXIgaT0wLGw9cGFydHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIHZhciBw
YXJ0ID0gcGFydHNbaV0ucGFydDsKICAgICAgICBvcmlnaW5hbCArPSAocGFydHNbaV0uc2VwYXJh
dG9yIHx8ICcnKSArIHBhcnQ7CgogICAgICAgIGlmIChwYXJ0ID09PSAiLi4iIHx8IHBhcnQgPT09
ICIuIiB8fCBwYXJ0ID09PSAidGhpcyIpIHsKICAgICAgICAgIGlmIChkaWcubGVuZ3RoID4gMCkg
eyB0aHJvdyBuZXcgRXhjZXB0aW9uKCJJbnZhbGlkIHBhdGg6ICIgKyBvcmlnaW5hbCk7IH0KICAg
ICAgICAgIGVsc2UgaWYgKHBhcnQgPT09ICIuLiIpIHsgZGVwdGgrKzsgfQogICAgICAgICAgZWxz
ZSB7IHRoaXMuaXNTY29wZWQgPSB0cnVlOyB9CiAgICAgICAgfQogICAgICAgIGVsc2UgeyBkaWcu
cHVzaChwYXJ0KTsgfQogICAgICB9CgogICAgICB0aGlzLm9yaWdpbmFsID0gb3JpZ2luYWw7CiAg
ICAgIHRoaXMucGFydHMgICAgPSBkaWc7CiAgICAgIHRoaXMuc3RyaW5nICAgPSBkaWcuam9pbign
LicpOwogICAgICB0aGlzLmRlcHRoICAgID0gZGVwdGg7CgogICAgICAvLyBhbiBJRCBpcyBzaW1w
bGUgaWYgaXQgb25seSBoYXMgb25lIHBhcnQsIGFuZCB0aGF0IHBhcnQgaXMgbm90CiAgICAgIC8v
IGAuLmAgb3IgYHRoaXNgLgogICAgICB0aGlzLmlzU2ltcGxlID0gcGFydHMubGVuZ3RoID09PSAx
ICYmICF0aGlzLmlzU2NvcGVkICYmIGRlcHRoID09PSAwOwoKICAgICAgdGhpcy5zdHJpbmdNb2Rl
VmFsdWUgPSB0aGlzLnN0cmluZzsKICAgIH0sCgogICAgUGFydGlhbE5hbWVOb2RlOiBmdW5jdGlv
bihuYW1lKSB7CiAgICAgIHRoaXMudHlwZSA9ICJQQVJUSUFMX05BTUUiOwogICAgICB0aGlzLm5h
bWUgPSBuYW1lLm9yaWdpbmFsOwogICAgfSwKCiAgICBEYXRhTm9kZTogZnVuY3Rpb24oaWQpIHsK
ICAgICAgdGhpcy50eXBlID0gIkRBVEEiOwogICAgICB0aGlzLmlkID0gaWQ7CiAgICB9LAoKICAg
IFN0cmluZ05vZGU6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICB0aGlzLnR5cGUgPSAiU1RSSU5H
IjsKICAgICAgdGhpcy5vcmlnaW5hbCA9CiAgICAgICAgdGhpcy5zdHJpbmcgPQogICAgICAgIHRo
aXMuc3RyaW5nTW9kZVZhbHVlID0gc3RyaW5nOwogICAgfSwKCiAgICBJbnRlZ2VyTm9kZTogZnVu
Y3Rpb24oaW50ZWdlcikgewogICAgICB0aGlzLnR5cGUgPSAiSU5URUdFUiI7CiAgICAgIHRoaXMu
b3JpZ2luYWwgPQogICAgICAgIHRoaXMuaW50ZWdlciA9IGludGVnZXI7CiAgICAgIHRoaXMuc3Ry
aW5nTW9kZVZhbHVlID0gTnVtYmVyKGludGVnZXIpOwogICAgfSwKCiAgICBCb29sZWFuTm9kZTog
ZnVuY3Rpb24oYm9vbCkgewogICAgICB0aGlzLnR5cGUgPSAiQk9PTEVBTiI7CiAgICAgIHRoaXMu
Ym9vbCA9IGJvb2w7CiAgICAgIHRoaXMuc3RyaW5nTW9kZVZhbHVlID0gYm9vbCA9PT0gInRydWUi
OwogICAgfSwKCiAgICBDb21tZW50Tm9kZTogZnVuY3Rpb24oY29tbWVudCkgewogICAgICB0aGlz
LnR5cGUgPSAiY29tbWVudCI7CiAgICAgIHRoaXMuY29tbWVudCA9IGNvbW1lbnQ7CiAgICB9CiAg
fTsKCiAgLy8gTXVzdCBiZSBleHBvcnRlZCBhcyBhbiBvYmplY3QgcmF0aGVyIHRoYW4gdGhlIHJv
b3Qgb2YgdGhlIG1vZHVsZSBhcyB0aGUgamlzb24gbGV4ZXIKICAvLyBtb3N0IG1vZGlmeSB0aGUg
b2JqZWN0IHRvIG9wZXJhdGUgcHJvcGVybHkuCiAgX19leHBvcnRzX18gPSBBU1Q7CiAgcmV0dXJu
IF9fZXhwb3J0c19fOwp9KShfX21vZHVsZTVfXyk7CgovLyBoYW5kbGViYXJzL2NvbXBpbGVyL3Bh
cnNlci5qcwp2YXIgX19tb2R1bGU5X18gPSAoZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwog
IHZhciBfX2V4cG9ydHNfXzsKICAvKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovCiAgLyogSmlzb24g
Z2VuZXJhdGVkIHBhcnNlciAqLwogIHZhciBoYW5kbGViYXJzID0gKGZ1bmN0aW9uKCl7CiAgdmFy
IHBhcnNlciA9IHt0cmFjZTogZnVuY3Rpb24gdHJhY2UoKSB7IH0sCiAgeXk6IHt9LAogIHN5bWJv
bHNfOiB7ImVycm9yIjoyLCJyb290IjozLCJzdGF0ZW1lbnRzIjo0LCJFT0YiOjUsInByb2dyYW0i
OjYsInNpbXBsZUludmVyc2UiOjcsInN0YXRlbWVudCI6OCwib3BlbkludmVyc2UiOjksImNsb3Nl
QmxvY2siOjEwLCJvcGVuQmxvY2siOjExLCJtdXN0YWNoZSI6MTIsInBhcnRpYWwiOjEzLCJDT05U
RU5UIjoxNCwiQ09NTUVOVCI6MTUsIk9QRU5fQkxPQ0siOjE2LCJpbk11c3RhY2hlIjoxNywiQ0xP
U0UiOjE4LCJPUEVOX0lOVkVSU0UiOjE5LCJPUEVOX0VOREJMT0NLIjoyMCwicGF0aCI6MjEsIk9Q
RU4iOjIyLCJPUEVOX1VORVNDQVBFRCI6MjMsIkNMT1NFX1VORVNDQVBFRCI6MjQsIk9QRU5fUEFS
VElBTCI6MjUsInBhcnRpYWxOYW1lIjoyNiwicGFydGlhbF9vcHRpb24wIjoyNywiaW5NdXN0YWNo
ZV9yZXBldGl0aW9uMCI6MjgsImluTXVzdGFjaGVfb3B0aW9uMCI6MjksImRhdGFOYW1lIjozMCwi
cGFyYW0iOjMxLCJTVFJJTkciOjMyLCJJTlRFR0VSIjozMywiQk9PTEVBTiI6MzQsImhhc2giOjM1
LCJoYXNoX3JlcGV0aXRpb25fcGx1czAiOjM2LCJoYXNoU2VnbWVudCI6MzcsIklEIjozOCwiRVFV
QUxTIjozOSwiREFUQSI6NDAsInBhdGhTZWdtZW50cyI6NDEsIlNFUCI6NDIsIiRhY2NlcHQiOjAs
IiRlbmQiOjF9LAogIHRlcm1pbmFsc186IHsyOiJlcnJvciIsNToiRU9GIiwxNDoiQ09OVEVOVCIs
MTU6IkNPTU1FTlQiLDE2OiJPUEVOX0JMT0NLIiwxODoiQ0xPU0UiLDE5OiJPUEVOX0lOVkVSU0Ui
LDIwOiJPUEVOX0VOREJMT0NLIiwyMjoiT1BFTiIsMjM6Ik9QRU5fVU5FU0NBUEVEIiwyNDoiQ0xP
U0VfVU5FU0NBUEVEIiwyNToiT1BFTl9QQVJUSUFMIiwzMjoiU1RSSU5HIiwzMzoiSU5URUdFUiIs
MzQ6IkJPT0xFQU4iLDM4OiJJRCIsMzk6IkVRVUFMUyIsNDA6IkRBVEEiLDQyOiJTRVAifSwKICBw
cm9kdWN0aW9uc186IFswLFszLDJdLFszLDFdLFs2LDJdLFs2LDNdLFs2LDJdLFs2LDFdLFs2LDFd
LFs2LDBdLFs0LDFdLFs0LDJdLFs4LDNdLFs4LDNdLFs4LDFdLFs4LDFdLFs4LDFdLFs4LDFdLFsx
MSwzXSxbOSwzXSxbMTAsM10sWzEyLDNdLFsxMiwzXSxbMTMsNF0sWzcsMl0sWzE3LDNdLFsxNywx
XSxbMzEsMV0sWzMxLDFdLFszMSwxXSxbMzEsMV0sWzMxLDFdLFszNSwxXSxbMzcsM10sWzI2LDFd
LFsyNiwxXSxbMjYsMV0sWzMwLDJdLFsyMSwxXSxbNDEsM10sWzQxLDFdLFsyNywwXSxbMjcsMV0s
WzI4LDBdLFsyOCwyXSxbMjksMF0sWzI5LDFdLFszNiwxXSxbMzYsMl1dLAogIHBlcmZvcm1BY3Rp
b246IGZ1bmN0aW9uIGFub255bW91cyh5eXRleHQseXlsZW5nLHl5bGluZW5vLHl5LHl5c3RhdGUs
JCQsXyQpIHsKCiAgdmFyICQwID0gJCQubGVuZ3RoIC0gMTsKICBzd2l0Y2ggKHl5c3RhdGUpIHsK
ICBjYXNlIDE6IHJldHVybiBuZXcgeXkuUHJvZ3JhbU5vZGUoJCRbJDAtMV0pOyAKICBicmVhazsK
ICBjYXNlIDI6IHJldHVybiBuZXcgeXkuUHJvZ3JhbU5vZGUoW10pOyAKICBicmVhazsKICBjYXNl
IDM6dGhpcy4kID0gbmV3IHl5LlByb2dyYW1Ob2RlKFtdLCAkJFskMC0xXSwgJCRbJDBdKTsKICBi
cmVhazsKICBjYXNlIDQ6dGhpcy4kID0gbmV3IHl5LlByb2dyYW1Ob2RlKCQkWyQwLTJdLCAkJFsk
MC0xXSwgJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDU6dGhpcy4kID0gbmV3IHl5LlByb2dyYW1O
b2RlKCQkWyQwLTFdLCAkJFskMF0sIFtdKTsKICBicmVhazsKICBjYXNlIDY6dGhpcy4kID0gbmV3
IHl5LlByb2dyYW1Ob2RlKCQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSA3OnRoaXMuJCA9IG5ldyB5
eS5Qcm9ncmFtTm9kZShbXSk7CiAgYnJlYWs7CiAgY2FzZSA4OnRoaXMuJCA9IG5ldyB5eS5Qcm9n
cmFtTm9kZShbXSk7CiAgYnJlYWs7CiAgY2FzZSA5OnRoaXMuJCA9IFskJFskMF1dOwogIGJyZWFr
OwogIGNhc2UgMTA6ICQkWyQwLTFdLnB1c2goJCRbJDBdKTsgdGhpcy4kID0gJCRbJDAtMV07IAog
IGJyZWFrOwogIGNhc2UgMTE6dGhpcy4kID0gbmV3IHl5LkJsb2NrTm9kZSgkJFskMC0yXSwgJCRb
JDAtMV0uaW52ZXJzZSwgJCRbJDAtMV0sICQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSAxMjp0aGlz
LiQgPSBuZXcgeXkuQmxvY2tOb2RlKCQkWyQwLTJdLCAkJFskMC0xXSwgJCRbJDAtMV0uaW52ZXJz
ZSwgJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDEzOnRoaXMuJCA9ICQkWyQwXTsKICBicmVhazsK
ICBjYXNlIDE0OnRoaXMuJCA9ICQkWyQwXTsKICBicmVhazsKICBjYXNlIDE1OnRoaXMuJCA9IG5l
dyB5eS5Db250ZW50Tm9kZSgkJFskMF0pOwogIGJyZWFrOwogIGNhc2UgMTY6dGhpcy4kID0gbmV3
IHl5LkNvbW1lbnROb2RlKCQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSAxNzp0aGlzLiQgPSBuZXcg
eXkuTXVzdGFjaGVOb2RlKCQkWyQwLTFdWzBdLCAkJFskMC0xXVsxXSwgJCRbJDAtMl0sIHN0cmlw
RmxhZ3MoJCRbJDAtMl0sICQkWyQwXSkpOwogIGJyZWFrOwogIGNhc2UgMTg6dGhpcy4kID0gbmV3
IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXVswXSwgJCRbJDAtMV1bMV0sICQkWyQwLTJdLCBzdHJp
cEZsYWdzKCQkWyQwLTJdLCAkJFskMF0pKTsKICBicmVhazsKICBjYXNlIDE5OnRoaXMuJCA9IHtw
YXRoOiAkJFskMC0xXSwgc3RyaXA6IHN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSl9OwogIGJy
ZWFrOwogIGNhc2UgMjA6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXVswXSwg
JCRbJDAtMV1bMV0sICQkWyQwLTJdLCBzdHJpcEZsYWdzKCQkWyQwLTJdLCAkJFskMF0pKTsKICBi
cmVhazsKICBjYXNlIDIxOnRoaXMuJCA9IG5ldyB5eS5NdXN0YWNoZU5vZGUoJCRbJDAtMV1bMF0s
ICQkWyQwLTFdWzFdLCAkJFskMC0yXSwgc3RyaXBGbGFncygkJFskMC0yXSwgJCRbJDBdKSk7CiAg
YnJlYWs7CiAgY2FzZSAyMjp0aGlzLiQgPSBuZXcgeXkuUGFydGlhbE5vZGUoJCRbJDAtMl0sICQk
WyQwLTFdLCBzdHJpcEZsYWdzKCQkWyQwLTNdLCAkJFskMF0pKTsKICBicmVhazsKICBjYXNlIDIz
OnRoaXMuJCA9IHN0cmlwRmxhZ3MoJCRbJDAtMV0sICQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSAy
NDp0aGlzLiQgPSBbWyQkWyQwLTJdXS5jb25jYXQoJCRbJDAtMV0pLCAkJFskMF1dOwogIGJyZWFr
OwogIGNhc2UgMjU6dGhpcy4kID0gW1skJFskMF1dLCBudWxsXTsKICBicmVhazsKICBjYXNlIDI2
OnRoaXMuJCA9ICQkWyQwXTsKICBicmVhazsKICBjYXNlIDI3OnRoaXMuJCA9IG5ldyB5eS5TdHJp
bmdOb2RlKCQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSAyODp0aGlzLiQgPSBuZXcgeXkuSW50ZWdl
ck5vZGUoJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDI5OnRoaXMuJCA9IG5ldyB5eS5Cb29sZWFu
Tm9kZSgkJFskMF0pOwogIGJyZWFrOwogIGNhc2UgMzA6dGhpcy4kID0gJCRbJDBdOwogIGJyZWFr
OwogIGNhc2UgMzE6dGhpcy4kID0gbmV3IHl5Lkhhc2hOb2RlKCQkWyQwXSk7CiAgYnJlYWs7CiAg
Y2FzZSAzMjp0aGlzLiQgPSBbJCRbJDAtMl0sICQkWyQwXV07CiAgYnJlYWs7CiAgY2FzZSAzMzp0
aGlzLiQgPSBuZXcgeXkuUGFydGlhbE5hbWVOb2RlKCQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSAz
NDp0aGlzLiQgPSBuZXcgeXkuUGFydGlhbE5hbWVOb2RlKG5ldyB5eS5TdHJpbmdOb2RlKCQkWyQw
XSkpOwogIGJyZWFrOwogIGNhc2UgMzU6dGhpcy4kID0gbmV3IHl5LlBhcnRpYWxOYW1lTm9kZShu
ZXcgeXkuSW50ZWdlck5vZGUoJCRbJDBdKSk7CiAgYnJlYWs7CiAgY2FzZSAzNjp0aGlzLiQgPSBu
ZXcgeXkuRGF0YU5vZGUoJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDM3OnRoaXMuJCA9IG5ldyB5
eS5JZE5vZGUoJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDM4OiAkJFskMC0yXS5wdXNoKHtwYXJ0
OiAkJFskMF0sIHNlcGFyYXRvcjogJCRbJDAtMV19KTsgdGhpcy4kID0gJCRbJDAtMl07IAogIGJy
ZWFrOwogIGNhc2UgMzk6dGhpcy4kID0gW3twYXJ0OiAkJFskMF19XTsKICBicmVhazsKICBjYXNl
IDQyOnRoaXMuJCA9IFtdOwogIGJyZWFrOwogIGNhc2UgNDM6JCRbJDAtMV0ucHVzaCgkJFskMF0p
OwogIGJyZWFrOwogIGNhc2UgNDY6dGhpcy4kID0gWyQkWyQwXV07CiAgYnJlYWs7CiAgY2FzZSA0
NzokJFskMC0xXS5wdXNoKCQkWyQwXSk7CiAgYnJlYWs7CiAgfQogIH0sCiAgdGFibGU6IFt7Mzox
LDQ6Miw1OlsxLDNdLDg6NCw5OjUsMTE6NiwxMjo3LDEzOjgsMTQ6WzEsOV0sMTU6WzEsMTBdLDE2
OlsxLDEyXSwxOTpbMSwxMV0sMjI6WzEsMTNdLDIzOlsxLDE0XSwyNTpbMSwxNV19LHsxOlszXX0s
ezU6WzEsMTZdLDg6MTcsOTo1LDExOjYsMTI6NywxMzo4LDE0OlsxLDldLDE1OlsxLDEwXSwxNjpb
MSwxMl0sMTk6WzEsMTFdLDIyOlsxLDEzXSwyMzpbMSwxNF0sMjU6WzEsMTVdfSx7MTpbMiwyXX0s
ezU6WzIsOV0sMTQ6WzIsOV0sMTU6WzIsOV0sMTY6WzIsOV0sMTk6WzIsOV0sMjA6WzIsOV0sMjI6
WzIsOV0sMjM6WzIsOV0sMjU6WzIsOV19LHs0OjIwLDY6MTgsNzoxOSw4OjQsOTo1LDExOjYsMTI6
NywxMzo4LDE0OlsxLDldLDE1OlsxLDEwXSwxNjpbMSwxMl0sMTk6WzEsMjFdLDIwOlsyLDhdLDIy
OlsxLDEzXSwyMzpbMSwxNF0sMjU6WzEsMTVdfSx7NDoyMCw2OjIyLDc6MTksODo0LDk6NSwxMTo2
LDEyOjcsMTM6OCwxNDpbMSw5XSwxNTpbMSwxMF0sMTY6WzEsMTJdLDE5OlsxLDIxXSwyMDpbMiw4
XSwyMjpbMSwxM10sMjM6WzEsMTRdLDI1OlsxLDE1XX0sezU6WzIsMTNdLDE0OlsyLDEzXSwxNTpb
MiwxM10sMTY6WzIsMTNdLDE5OlsyLDEzXSwyMDpbMiwxM10sMjI6WzIsMTNdLDIzOlsyLDEzXSwy
NTpbMiwxM119LHs1OlsyLDE0XSwxNDpbMiwxNF0sMTU6WzIsMTRdLDE2OlsyLDE0XSwxOTpbMiwx
NF0sMjA6WzIsMTRdLDIyOlsyLDE0XSwyMzpbMiwxNF0sMjU6WzIsMTRdfSx7NTpbMiwxNV0sMTQ6
WzIsMTVdLDE1OlsyLDE1XSwxNjpbMiwxNV0sMTk6WzIsMTVdLDIwOlsyLDE1XSwyMjpbMiwxNV0s
MjM6WzIsMTVdLDI1OlsyLDE1XX0sezU6WzIsMTZdLDE0OlsyLDE2XSwxNTpbMiwxNl0sMTY6WzIs
MTZdLDE5OlsyLDE2XSwyMDpbMiwxNl0sMjI6WzIsMTZdLDIzOlsyLDE2XSwyNTpbMiwxNl19LHsx
NzoyMywyMToyNCwzMDoyNSwzODpbMSwyOF0sNDA6WzEsMjddLDQxOjI2fSx7MTc6MjksMjE6MjQs
MzA6MjUsMzg6WzEsMjhdLDQwOlsxLDI3XSw0MToyNn0sezE3OjMwLDIxOjI0LDMwOjI1LDM4Olsx
LDI4XSw0MDpbMSwyN10sNDE6MjZ9LHsxNzozMSwyMToyNCwzMDoyNSwzODpbMSwyOF0sNDA6WzEs
MjddLDQxOjI2fSx7MjE6MzMsMjY6MzIsMzI6WzEsMzRdLDMzOlsxLDM1XSwzODpbMSwyOF0sNDE6
MjZ9LHsxOlsyLDFdfSx7NTpbMiwxMF0sMTQ6WzIsMTBdLDE1OlsyLDEwXSwxNjpbMiwxMF0sMTk6
WzIsMTBdLDIwOlsyLDEwXSwyMjpbMiwxMF0sMjM6WzIsMTBdLDI1OlsyLDEwXX0sezEwOjM2LDIw
OlsxLDM3XX0sezQ6MzgsODo0LDk6NSwxMTo2LDEyOjcsMTM6OCwxNDpbMSw5XSwxNTpbMSwxMF0s
MTY6WzEsMTJdLDE5OlsxLDExXSwyMDpbMiw3XSwyMjpbMSwxM10sMjM6WzEsMTRdLDI1OlsxLDE1
XX0sezc6MzksODoxNyw5OjUsMTE6NiwxMjo3LDEzOjgsMTQ6WzEsOV0sMTU6WzEsMTBdLDE2Olsx
LDEyXSwxOTpbMSwyMV0sMjA6WzIsNl0sMjI6WzEsMTNdLDIzOlsxLDE0XSwyNTpbMSwxNV19LHsx
NzoyMywxODpbMSw0MF0sMjE6MjQsMzA6MjUsMzg6WzEsMjhdLDQwOlsxLDI3XSw0MToyNn0sezEw
OjQxLDIwOlsxLDM3XX0sezE4OlsxLDQyXX0sezE4OlsyLDQyXSwyNDpbMiw0Ml0sMjg6NDMsMzI6
WzIsNDJdLDMzOlsyLDQyXSwzNDpbMiw0Ml0sMzg6WzIsNDJdLDQwOlsyLDQyXX0sezE4OlsyLDI1
XSwyNDpbMiwyNV19LHsxODpbMiwzN10sMjQ6WzIsMzddLDMyOlsyLDM3XSwzMzpbMiwzN10sMzQ6
WzIsMzddLDM4OlsyLDM3XSw0MDpbMiwzN10sNDI6WzEsNDRdfSx7MjE6NDUsMzg6WzEsMjhdLDQx
OjI2fSx7MTg6WzIsMzldLDI0OlsyLDM5XSwzMjpbMiwzOV0sMzM6WzIsMzldLDM0OlsyLDM5XSwz
ODpbMiwzOV0sNDA6WzIsMzldLDQyOlsyLDM5XX0sezE4OlsxLDQ2XX0sezE4OlsxLDQ3XX0sezI0
OlsxLDQ4XX0sezE4OlsyLDQwXSwyMTo1MCwyNzo0OSwzODpbMSwyOF0sNDE6MjZ9LHsxODpbMiwz
M10sMzg6WzIsMzNdfSx7MTg6WzIsMzRdLDM4OlsyLDM0XX0sezE4OlsyLDM1XSwzODpbMiwzNV19
LHs1OlsyLDExXSwxNDpbMiwxMV0sMTU6WzIsMTFdLDE2OlsyLDExXSwxOTpbMiwxMV0sMjA6WzIs
MTFdLDIyOlsyLDExXSwyMzpbMiwxMV0sMjU6WzIsMTFdfSx7MjE6NTEsMzg6WzEsMjhdLDQxOjI2
fSx7ODoxNyw5OjUsMTE6NiwxMjo3LDEzOjgsMTQ6WzEsOV0sMTU6WzEsMTBdLDE2OlsxLDEyXSwx
OTpbMSwxMV0sMjA6WzIsM10sMjI6WzEsMTNdLDIzOlsxLDE0XSwyNTpbMSwxNV19LHs0OjUyLDg6
NCw5OjUsMTE6NiwxMjo3LDEzOjgsMTQ6WzEsOV0sMTU6WzEsMTBdLDE2OlsxLDEyXSwxOTpbMSwx
MV0sMjA6WzIsNV0sMjI6WzEsMTNdLDIzOlsxLDE0XSwyNTpbMSwxNV19LHsxNDpbMiwyM10sMTU6
WzIsMjNdLDE2OlsyLDIzXSwxOTpbMiwyM10sMjA6WzIsMjNdLDIyOlsyLDIzXSwyMzpbMiwyM10s
MjU6WzIsMjNdfSx7NTpbMiwxMl0sMTQ6WzIsMTJdLDE1OlsyLDEyXSwxNjpbMiwxMl0sMTk6WzIs
MTJdLDIwOlsyLDEyXSwyMjpbMiwxMl0sMjM6WzIsMTJdLDI1OlsyLDEyXX0sezE0OlsyLDE4XSwx
NTpbMiwxOF0sMTY6WzIsMThdLDE5OlsyLDE4XSwyMDpbMiwxOF0sMjI6WzIsMThdLDIzOlsyLDE4
XSwyNTpbMiwxOF19LHsxODpbMiw0NF0sMjE6NTYsMjQ6WzIsNDRdLDI5OjUzLDMwOjYwLDMxOjU0
LDMyOlsxLDU3XSwzMzpbMSw1OF0sMzQ6WzEsNTldLDM1OjU1LDM2OjYxLDM3OjYyLDM4OlsxLDYz
XSw0MDpbMSwyN10sNDE6MjZ9LHszODpbMSw2NF19LHsxODpbMiwzNl0sMjQ6WzIsMzZdLDMyOlsy
LDM2XSwzMzpbMiwzNl0sMzQ6WzIsMzZdLDM4OlsyLDM2XSw0MDpbMiwzNl19LHsxNDpbMiwxN10s
MTU6WzIsMTddLDE2OlsyLDE3XSwxOTpbMiwxN10sMjA6WzIsMTddLDIyOlsyLDE3XSwyMzpbMiwx
N10sMjU6WzIsMTddfSx7NTpbMiwyMF0sMTQ6WzIsMjBdLDE1OlsyLDIwXSwxNjpbMiwyMF0sMTk6
WzIsMjBdLDIwOlsyLDIwXSwyMjpbMiwyMF0sMjM6WzIsMjBdLDI1OlsyLDIwXX0sezU6WzIsMjFd
LDE0OlsyLDIxXSwxNTpbMiwyMV0sMTY6WzIsMjFdLDE5OlsyLDIxXSwyMDpbMiwyMV0sMjI6WzIs
MjFdLDIzOlsyLDIxXSwyNTpbMiwyMV19LHsxODpbMSw2NV19LHsxODpbMiw0MV19LHsxODpbMSw2
Nl19LHs4OjE3LDk6NSwxMTo2LDEyOjcsMTM6OCwxNDpbMSw5XSwxNTpbMSwxMF0sMTY6WzEsMTJd
LDE5OlsxLDExXSwyMDpbMiw0XSwyMjpbMSwxM10sMjM6WzEsMTRdLDI1OlsxLDE1XX0sezE4Olsy
LDI0XSwyNDpbMiwyNF19LHsxODpbMiw0M10sMjQ6WzIsNDNdLDMyOlsyLDQzXSwzMzpbMiw0M10s
MzQ6WzIsNDNdLDM4OlsyLDQzXSw0MDpbMiw0M119LHsxODpbMiw0NV0sMjQ6WzIsNDVdfSx7MTg6
WzIsMjZdLDI0OlsyLDI2XSwzMjpbMiwyNl0sMzM6WzIsMjZdLDM0OlsyLDI2XSwzODpbMiwyNl0s
NDA6WzIsMjZdfSx7MTg6WzIsMjddLDI0OlsyLDI3XSwzMjpbMiwyN10sMzM6WzIsMjddLDM0Olsy
LDI3XSwzODpbMiwyN10sNDA6WzIsMjddfSx7MTg6WzIsMjhdLDI0OlsyLDI4XSwzMjpbMiwyOF0s
MzM6WzIsMjhdLDM0OlsyLDI4XSwzODpbMiwyOF0sNDA6WzIsMjhdfSx7MTg6WzIsMjldLDI0Olsy
LDI5XSwzMjpbMiwyOV0sMzM6WzIsMjldLDM0OlsyLDI5XSwzODpbMiwyOV0sNDA6WzIsMjldfSx7
MTg6WzIsMzBdLDI0OlsyLDMwXSwzMjpbMiwzMF0sMzM6WzIsMzBdLDM0OlsyLDMwXSwzODpbMiwz
MF0sNDA6WzIsMzBdfSx7MTg6WzIsMzFdLDI0OlsyLDMxXSwzNzo2NywzODpbMSw2OF19LHsxODpb
Miw0Nl0sMjQ6WzIsNDZdLDM4OlsyLDQ2XX0sezE4OlsyLDM5XSwyNDpbMiwzOV0sMzI6WzIsMzld
LDMzOlsyLDM5XSwzNDpbMiwzOV0sMzg6WzIsMzldLDM5OlsxLDY5XSw0MDpbMiwzOV0sNDI6WzIs
MzldfSx7MTg6WzIsMzhdLDI0OlsyLDM4XSwzMjpbMiwzOF0sMzM6WzIsMzhdLDM0OlsyLDM4XSwz
ODpbMiwzOF0sNDA6WzIsMzhdLDQyOlsyLDM4XX0sezU6WzIsMjJdLDE0OlsyLDIyXSwxNTpbMiwy
Ml0sMTY6WzIsMjJdLDE5OlsyLDIyXSwyMDpbMiwyMl0sMjI6WzIsMjJdLDIzOlsyLDIyXSwyNTpb
MiwyMl19LHs1OlsyLDE5XSwxNDpbMiwxOV0sMTU6WzIsMTldLDE2OlsyLDE5XSwxOTpbMiwxOV0s
MjA6WzIsMTldLDIyOlsyLDE5XSwyMzpbMiwxOV0sMjU6WzIsMTldfSx7MTg6WzIsNDddLDI0Olsy
LDQ3XSwzODpbMiw0N119LHszOTpbMSw2OV19LHsyMTo1NiwzMDo2MCwzMTo3MCwzMjpbMSw1N10s
MzM6WzEsNThdLDM0OlsxLDU5XSwzODpbMSwyOF0sNDA6WzEsMjddLDQxOjI2fSx7MTg6WzIsMzJd
LDI0OlsyLDMyXSwzODpbMiwzMl19XSwKICBkZWZhdWx0QWN0aW9uczogezM6WzIsMl0sMTY6WzIs
MV0sNTA6WzIsNDFdfSwKICBwYXJzZUVycm9yOiBmdW5jdGlvbiBwYXJzZUVycm9yKHN0ciwgaGFz
aCkgewogICAgICB0aHJvdyBuZXcgRXJyb3Ioc3RyKTsKICB9LAogIHBhcnNlOiBmdW5jdGlvbiBw
YXJzZShpbnB1dCkgewogICAgICB2YXIgc2VsZiA9IHRoaXMsIHN0YWNrID0gWzBdLCB2c3RhY2sg
PSBbbnVsbF0sIGxzdGFjayA9IFtdLCB0YWJsZSA9IHRoaXMudGFibGUsIHl5dGV4dCA9ICIiLCB5
eWxpbmVubyA9IDAsIHl5bGVuZyA9IDAsIHJlY292ZXJpbmcgPSAwLCBURVJST1IgPSAyLCBFT0Yg
PSAxOwogICAgICB0aGlzLmxleGVyLnNldElucHV0KGlucHV0KTsKICAgICAgdGhpcy5sZXhlci55
eSA9IHRoaXMueXk7CiAgICAgIHRoaXMueXkubGV4ZXIgPSB0aGlzLmxleGVyOwogICAgICB0aGlz
Lnl5LnBhcnNlciA9IHRoaXM7CiAgICAgIGlmICh0eXBlb2YgdGhpcy5sZXhlci55eWxsb2MgPT0g
InVuZGVmaW5lZCIpCiAgICAgICAgICB0aGlzLmxleGVyLnl5bGxvYyA9IHt9OwogICAgICB2YXIg
eXlsb2MgPSB0aGlzLmxleGVyLnl5bGxvYzsKICAgICAgbHN0YWNrLnB1c2goeXlsb2MpOwogICAg
ICB2YXIgcmFuZ2VzID0gdGhpcy5sZXhlci5vcHRpb25zICYmIHRoaXMubGV4ZXIub3B0aW9ucy5y
YW5nZXM7CiAgICAgIGlmICh0eXBlb2YgdGhpcy55eS5wYXJzZUVycm9yID09PSAiZnVuY3Rpb24i
KQogICAgICAgICAgdGhpcy5wYXJzZUVycm9yID0gdGhpcy55eS5wYXJzZUVycm9yOwogICAgICBm
dW5jdGlvbiBwb3BTdGFjayhuKSB7CiAgICAgICAgICBzdGFjay5sZW5ndGggPSBzdGFjay5sZW5n
dGggLSAyICogbjsKICAgICAgICAgIHZzdGFjay5sZW5ndGggPSB2c3RhY2subGVuZ3RoIC0gbjsK
ICAgICAgICAgIGxzdGFjay5sZW5ndGggPSBsc3RhY2subGVuZ3RoIC0gbjsKICAgICAgfQogICAg
ICBmdW5jdGlvbiBsZXgoKSB7CiAgICAgICAgICB2YXIgdG9rZW47CiAgICAgICAgICB0b2tlbiA9
IHNlbGYubGV4ZXIubGV4KCkgfHwgMTsKICAgICAgICAgIGlmICh0eXBlb2YgdG9rZW4gIT09ICJu
dW1iZXIiKSB7CiAgICAgICAgICAgICAgdG9rZW4gPSBzZWxmLnN5bWJvbHNfW3Rva2VuXSB8fCB0
b2tlbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0b2tlbjsKICAgICAgfQogICAgICB2
YXIgc3ltYm9sLCBwcmVFcnJvclN5bWJvbCwgc3RhdGUsIGFjdGlvbiwgYSwgciwgeXl2YWwgPSB7
fSwgcCwgbGVuLCBuZXdTdGF0ZSwgZXhwZWN0ZWQ7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAg
ICAgICBzdGF0ZSA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgaWYgKHRoaXMu
ZGVmYXVsdEFjdGlvbnNbc3RhdGVdKSB7CiAgICAgICAgICAgICAgYWN0aW9uID0gdGhpcy5kZWZh
dWx0QWN0aW9uc1tzdGF0ZV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChz
eW1ib2wgPT09IG51bGwgfHwgdHlwZW9mIHN5bWJvbCA9PSAidW5kZWZpbmVkIikgewogICAgICAg
ICAgICAgICAgICBzeW1ib2wgPSBsZXgoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
YWN0aW9uID0gdGFibGVbc3RhdGVdICYmIHRhYmxlW3N0YXRlXVtzeW1ib2xdOwogICAgICAgICAg
fQogICAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09ICJ1bmRlZmluZWQiIHx8ICFhY3Rpb24u
bGVuZ3RoIHx8ICFhY3Rpb25bMF0pIHsKICAgICAgICAgICAgICB2YXIgZXJyU3RyID0gIiI7CiAg
ICAgICAgICAgICAgaWYgKCFyZWNvdmVyaW5nKSB7CiAgICAgICAgICAgICAgICAgIGV4cGVjdGVk
ID0gW107CiAgICAgICAgICAgICAgICAgIGZvciAocCBpbiB0YWJsZVtzdGF0ZV0pCiAgICAgICAg
ICAgICAgICAgICAgICBpZiAodGhpcy50ZXJtaW5hbHNfW3BdICYmIHAgPiAyKSB7CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQucHVzaCgiJyIgKyB0aGlzLnRlcm1pbmFsc19bcF0g
KyAiJyIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAodGhp
cy5sZXhlci5zaG93UG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIGVyclN0ciA9ICJQ
YXJzZSBlcnJvciBvbiBsaW5lICIgKyAoeXlsaW5lbm8gKyAxKSArICI6XG4iICsgdGhpcy5sZXhl
ci5zaG93UG9zaXRpb24oKSArICJcbkV4cGVjdGluZyAiICsgZXhwZWN0ZWQuam9pbigiLCAiKSAr
ICIsIGdvdCAnIiArICh0aGlzLnRlcm1pbmFsc19bc3ltYm9sXSB8fCBzeW1ib2wpICsgIiciOwog
ICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZXJyU3RyID0g
IlBhcnNlIGVycm9yIG9uIGxpbmUgIiArICh5eWxpbmVubyArIDEpICsgIjogVW5leHBlY3RlZCAi
ICsgKHN5bWJvbCA9PSAxPyJlbmQgb2YgaW5wdXQiOiInIiArICh0aGlzLnRlcm1pbmFsc19bc3lt
Ym9sXSB8fCBzeW1ib2wpICsgIiciKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICB0aGlzLnBhcnNlRXJyb3IoZXJyU3RyLCB7dGV4dDogdGhpcy5sZXhlci5tYXRjaCwgdG9r
ZW46IHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCwgbGluZTogdGhpcy5sZXhlci55
eWxpbmVubywgbG9jOiB5eWxvYywgZXhwZWN0ZWQ6IGV4cGVjdGVkfSk7CiAgICAgICAgICAgICAg
fQogICAgICAgICAgfQogICAgICAgICAgaWYgKGFjdGlvblswXSBpbnN0YW5jZW9mIEFycmF5ICYm
IGFjdGlvbi5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJz
ZSBFcnJvcjogbXVsdGlwbGUgYWN0aW9ucyBwb3NzaWJsZSBhdCBzdGF0ZTogIiArIHN0YXRlICsg
IiwgdG9rZW46ICIgKyBzeW1ib2wpOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChhY3Rp
b25bMF0pIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBzdGFjay5wdXNoKHN5bWJv
bCk7CiAgICAgICAgICAgICAgdnN0YWNrLnB1c2godGhpcy5sZXhlci55eXRleHQpOwogICAgICAg
ICAgICAgIGxzdGFjay5wdXNoKHRoaXMubGV4ZXIueXlsbG9jKTsKICAgICAgICAgICAgICBzdGFj
ay5wdXNoKGFjdGlvblsxXSk7CiAgICAgICAgICAgICAgc3ltYm9sID0gbnVsbDsKICAgICAgICAg
ICAgICBpZiAoIXByZUVycm9yU3ltYm9sKSB7CiAgICAgICAgICAgICAgICAgIHl5bGVuZyA9IHRo
aXMubGV4ZXIueXlsZW5nOwogICAgICAgICAgICAgICAgICB5eXRleHQgPSB0aGlzLmxleGVyLnl5
dGV4dDsKICAgICAgICAgICAgICAgICAgeXlsaW5lbm8gPSB0aGlzLmxleGVyLnl5bGluZW5vOwog
ICAgICAgICAgICAgICAgICB5eWxvYyA9IHRoaXMubGV4ZXIueXlsbG9jOwogICAgICAgICAgICAg
ICAgICBpZiAocmVjb3ZlcmluZyA+IDApCiAgICAgICAgICAgICAgICAgICAgICByZWNvdmVyaW5n
LS07CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3ltYm9sID0gcHJl
RXJyb3JTeW1ib2w7CiAgICAgICAgICAgICAgICAgIHByZUVycm9yU3ltYm9sID0gbnVsbDsKICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAg
ICAgICAgICAgbGVuID0gdGhpcy5wcm9kdWN0aW9uc19bYWN0aW9uWzFdXVsxXTsKICAgICAgICAg
ICAgICB5eXZhbC4kID0gdnN0YWNrW3ZzdGFjay5sZW5ndGggLSBsZW5dOwogICAgICAgICAgICAg
IHl5dmFsLl8kID0ge2ZpcnN0X2xpbmU6IGxzdGFja1tsc3RhY2subGVuZ3RoIC0gKGxlbiB8fCAx
KV0uZmlyc3RfbGluZSwgbGFzdF9saW5lOiBsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIDFdLmxhc3Rf
bGluZSwgZmlyc3RfY29sdW1uOiBsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIChsZW4gfHwgMSldLmZp
cnN0X2NvbHVtbiwgbGFzdF9jb2x1bW46IGxzdGFja1tsc3RhY2subGVuZ3RoIC0gMV0ubGFzdF9j
b2x1bW59OwogICAgICAgICAgICAgIGlmIChyYW5nZXMpIHsKICAgICAgICAgICAgICAgICAgeXl2
YWwuXyQucmFuZ2UgPSBbbHN0YWNrW2xzdGFjay5sZW5ndGggLSAobGVuIHx8IDEpXS5yYW5nZVsw
XSwgbHN0YWNrW2xzdGFjay5sZW5ndGggLSAxXS5yYW5nZVsxXV07CiAgICAgICAgICAgICAgfQog
ICAgICAgICAgICAgIHIgPSB0aGlzLnBlcmZvcm1BY3Rpb24uY2FsbCh5eXZhbCwgeXl0ZXh0LCB5
eWxlbmcsIHl5bGluZW5vLCB0aGlzLnl5LCBhY3Rpb25bMV0sIHZzdGFjaywgbHN0YWNrKTsKICAg
ICAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAg
ICAgIHJldHVybiByOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAobGVuKSB7CiAg
ICAgICAgICAgICAgICAgIHN0YWNrID0gc3RhY2suc2xpY2UoMCwgLTEgKiBsZW4gKiAyKTsKICAg
ICAgICAgICAgICAgICAgdnN0YWNrID0gdnN0YWNrLnNsaWNlKDAsIC0xICogbGVuKTsKICAgICAg
ICAgICAgICAgICAgbHN0YWNrID0gbHN0YWNrLnNsaWNlKDAsIC0xICogbGVuKTsKICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICAgc3RhY2sucHVzaCh0aGlzLnByb2R1Y3Rpb25zX1thY3Rpb25b
MV1dWzBdKTsKICAgICAgICAgICAgICB2c3RhY2sucHVzaCh5eXZhbC4kKTsKICAgICAgICAgICAg
ICBsc3RhY2sucHVzaCh5eXZhbC5fJCk7CiAgICAgICAgICAgICAgbmV3U3RhdGUgPSB0YWJsZVtz
dGFja1tzdGFjay5sZW5ndGggLSAyXV1bc3RhY2tbc3RhY2subGVuZ3RoIC0gMV1dOwogICAgICAg
ICAgICAgIHN0YWNrLnB1c2gobmV3U3RhdGUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICB9
CiAgICAgIHJldHVybiB0cnVlOwogIH0KICB9OwoKCiAgZnVuY3Rpb24gc3RyaXBGbGFncyhvcGVu
LCBjbG9zZSkgewogICAgcmV0dXJuIHsKICAgICAgbGVmdDogb3Blbi5jaGFyQXQoMikgPT09ICd+
JywKICAgICAgcmlnaHQ6IGNsb3NlLmNoYXJBdCgwKSA9PT0gJ34nIHx8IGNsb3NlLmNoYXJBdCgx
KSA9PT0gJ34nCiAgICB9OwogIH0KCiAgLyogSmlzb24gZ2VuZXJhdGVkIGxleGVyICovCiAgdmFy
IGxleGVyID0gKGZ1bmN0aW9uKCl7CiAgdmFyIGxleGVyID0gKHtFT0Y6MSwKICBwYXJzZUVycm9y
OmZ1bmN0aW9uIHBhcnNlRXJyb3Ioc3RyLCBoYXNoKSB7CiAgICAgICAgICBpZiAodGhpcy55eS5w
YXJzZXIpIHsKICAgICAgICAgICAgICB0aGlzLnl5LnBhcnNlci5wYXJzZUVycm9yKHN0ciwgaGFz
aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzdHIp
OwogICAgICAgICAgfQogICAgICB9LAogIHNldElucHV0OmZ1bmN0aW9uIChpbnB1dCkgewogICAg
ICAgICAgdGhpcy5faW5wdXQgPSBpbnB1dDsKICAgICAgICAgIHRoaXMuX21vcmUgPSB0aGlzLl9s
ZXNzID0gdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnl5bGluZW5vID0gdGhpcy55
eWxlbmcgPSAwOwogICAgICAgICAgdGhpcy55eXRleHQgPSB0aGlzLm1hdGNoZWQgPSB0aGlzLm1h
dGNoID0gJyc7CiAgICAgICAgICB0aGlzLmNvbmRpdGlvblN0YWNrID0gWydJTklUSUFMJ107CiAg
ICAgICAgICB0aGlzLnl5bGxvYyA9IHtmaXJzdF9saW5lOjEsZmlyc3RfY29sdW1uOjAsbGFzdF9s
aW5lOjEsbGFzdF9jb2x1bW46MH07CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcykg
dGhpcy55eWxsb2MucmFuZ2UgPSBbMCwwXTsKICAgICAgICAgIHRoaXMub2Zmc2V0ID0gMDsKICAg
ICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogIGlucHV0OmZ1bmN0aW9uICgpIHsKICAgICAg
ICAgIHZhciBjaCA9IHRoaXMuX2lucHV0WzBdOwogICAgICAgICAgdGhpcy55eXRleHQgKz0gY2g7
CiAgICAgICAgICB0aGlzLnl5bGVuZysrOwogICAgICAgICAgdGhpcy5vZmZzZXQrKzsKICAgICAg
ICAgIHRoaXMubWF0Y2ggKz0gY2g7CiAgICAgICAgICB0aGlzLm1hdGNoZWQgKz0gY2g7CiAgICAg
ICAgICB2YXIgbGluZXMgPSBjaC5tYXRjaCgvKD86XHJcbj98XG4pLiovZyk7CiAgICAgICAgICBp
ZiAobGluZXMpIHsKICAgICAgICAgICAgICB0aGlzLnl5bGluZW5vKys7CiAgICAgICAgICAgICAg
dGhpcy55eWxsb2MubGFzdF9saW5lKys7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg
IHRoaXMueXlsbG9jLmxhc3RfY29sdW1uKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhp
cy5vcHRpb25zLnJhbmdlcykgdGhpcy55eWxsb2MucmFuZ2VbMV0rKzsKCiAgICAgICAgICB0aGlz
Ll9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKDEpOwogICAgICAgICAgcmV0dXJuIGNoOwogICAg
ICB9LAogIHVucHV0OmZ1bmN0aW9uIChjaCkgewogICAgICAgICAgdmFyIGxlbiA9IGNoLmxlbmd0
aDsKICAgICAgICAgIHZhciBsaW5lcyA9IGNoLnNwbGl0KC8oPzpcclxuP3xcbikvZyk7CgogICAg
ICAgICAgdGhpcy5faW5wdXQgPSBjaCArIHRoaXMuX2lucHV0OwogICAgICAgICAgdGhpcy55eXRl
eHQgPSB0aGlzLnl5dGV4dC5zdWJzdHIoMCwgdGhpcy55eXRleHQubGVuZ3RoLWxlbi0xKTsKICAg
ICAgICAgIC8vdGhpcy55eWxlbmcgLT0gbGVuOwogICAgICAgICAgdGhpcy5vZmZzZXQgLT0gbGVu
OwogICAgICAgICAgdmFyIG9sZExpbmVzID0gdGhpcy5tYXRjaC5zcGxpdCgvKD86XHJcbj98XG4p
L2cpOwogICAgICAgICAgdGhpcy5tYXRjaCA9IHRoaXMubWF0Y2guc3Vic3RyKDAsIHRoaXMubWF0
Y2gubGVuZ3RoLTEpOwogICAgICAgICAgdGhpcy5tYXRjaGVkID0gdGhpcy5tYXRjaGVkLnN1YnN0
cigwLCB0aGlzLm1hdGNoZWQubGVuZ3RoLTEpOwoKICAgICAgICAgIGlmIChsaW5lcy5sZW5ndGgt
MSkgdGhpcy55eWxpbmVubyAtPSBsaW5lcy5sZW5ndGgtMTsKICAgICAgICAgIHZhciByID0gdGhp
cy55eWxsb2MucmFuZ2U7CgogICAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZTogdGhp
cy55eWxsb2MuZmlyc3RfbGluZSwKICAgICAgICAgICAgbGFzdF9saW5lOiB0aGlzLnl5bGluZW5v
KzEsCiAgICAgICAgICAgIGZpcnN0X2NvbHVtbjogdGhpcy55eWxsb2MuZmlyc3RfY29sdW1uLAog
ICAgICAgICAgICBsYXN0X2NvbHVtbjogbGluZXMgPwogICAgICAgICAgICAgICAgKGxpbmVzLmxl
bmd0aCA9PT0gb2xkTGluZXMubGVuZ3RoID8gdGhpcy55eWxsb2MuZmlyc3RfY29sdW1uIDogMCkg
KyBvbGRMaW5lc1tvbGRMaW5lcy5sZW5ndGggLSBsaW5lcy5sZW5ndGhdLmxlbmd0aCAtIGxpbmVz
WzBdLmxlbmd0aDoKICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLmZpcnN0X2NvbHVtbiAtIGxl
bgogICAgICAgICAgICB9OwoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB7CiAg
ICAgICAgICAgICAgdGhpcy55eWxsb2MucmFuZ2UgPSBbclswXSwgclswXSArIHRoaXMueXlsZW5n
IC0gbGVuXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogIG1v
cmU6ZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy5fbW9yZSA9IHRydWU7CiAgICAgICAgICBy
ZXR1cm4gdGhpczsKICAgICAgfSwKICBsZXNzOmZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB0aGlz
LnVucHV0KHRoaXMubWF0Y2guc2xpY2UobikpOwogICAgICB9LAogIHBhc3RJbnB1dDpmdW5jdGlv
biAoKSB7CiAgICAgICAgICB2YXIgcGFzdCA9IHRoaXMubWF0Y2hlZC5zdWJzdHIoMCwgdGhpcy5t
YXRjaGVkLmxlbmd0aCAtIHRoaXMubWF0Y2gubGVuZ3RoKTsKICAgICAgICAgIHJldHVybiAocGFz
dC5sZW5ndGggPiAyMCA/ICcuLi4nOicnKSArIHBhc3Quc3Vic3RyKC0yMCkucmVwbGFjZSgvXG4v
ZywgIiIpOwogICAgICB9LAogIHVwY29taW5nSW5wdXQ6ZnVuY3Rpb24gKCkgewogICAgICAgICAg
dmFyIG5leHQgPSB0aGlzLm1hdGNoOwogICAgICAgICAgaWYgKG5leHQubGVuZ3RoIDwgMjApIHsK
ICAgICAgICAgICAgICBuZXh0ICs9IHRoaXMuX2lucHV0LnN1YnN0cigwLCAyMC1uZXh0Lmxlbmd0
aCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKG5leHQuc3Vic3RyKDAsMjApKyhuZXh0
Lmxlbmd0aCA+IDIwID8gJy4uLic6JycpKS5yZXBsYWNlKC9cbi9nLCAiIik7CiAgICAgIH0sCiAg
c2hvd1Bvc2l0aW9uOmZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBwcmUgPSB0aGlzLnBhc3RJ
bnB1dCgpOwogICAgICAgICAgdmFyIGMgPSBuZXcgQXJyYXkocHJlLmxlbmd0aCArIDEpLmpvaW4o
Ii0iKTsKICAgICAgICAgIHJldHVybiBwcmUgKyB0aGlzLnVwY29taW5nSW5wdXQoKSArICJcbiIg
KyBjKyJeIjsKICAgICAgfSwKICBuZXh0OmZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0aGlz
LmRvbmUpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5FT0Y7CiAgICAgICAgICB9CiAgICAg
ICAgICBpZiAoIXRoaXMuX2lucHV0KSB0aGlzLmRvbmUgPSB0cnVlOwoKICAgICAgICAgIHZhciB0
b2tlbiwKICAgICAgICAgICAgICBtYXRjaCwKICAgICAgICAgICAgICB0ZW1wTWF0Y2gsCiAgICAg
ICAgICAgICAgaW5kZXgsCiAgICAgICAgICAgICAgY29sLAogICAgICAgICAgICAgIGxpbmVzOwog
ICAgICAgICAgaWYgKCF0aGlzLl9tb3JlKSB7CiAgICAgICAgICAgICAgdGhpcy55eXRleHQgPSAn
JzsKICAgICAgICAgICAgICB0aGlzLm1hdGNoID0gJyc7CiAgICAgICAgICB9CiAgICAgICAgICB2
YXIgcnVsZXMgPSB0aGlzLl9jdXJyZW50UnVsZXMoKTsKICAgICAgICAgIGZvciAodmFyIGk9MDtp
IDwgcnVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB0ZW1wTWF0Y2ggPSB0aGlzLl9p
bnB1dC5tYXRjaCh0aGlzLnJ1bGVzW3J1bGVzW2ldXSk7CiAgICAgICAgICAgICAgaWYgKHRlbXBN
YXRjaCAmJiAoIW1hdGNoIHx8IHRlbXBNYXRjaFswXS5sZW5ndGggPiBtYXRjaFswXS5sZW5ndGgp
KSB7CiAgICAgICAgICAgICAgICAgIG1hdGNoID0gdGVtcE1hdGNoOwogICAgICAgICAgICAgICAg
ICBpbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLmZsZXgpIGJy
ZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaCkgewog
ICAgICAgICAgICAgIGxpbmVzID0gbWF0Y2hbMF0ubWF0Y2goLyg/OlxyXG4/fFxuKS4qL2cpOwog
ICAgICAgICAgICAgIGlmIChsaW5lcykgdGhpcy55eWxpbmVubyArPSBsaW5lcy5sZW5ndGg7CiAg
ICAgICAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZTogdGhpcy55eWxsb2MubGFzdF9s
aW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZTogdGhpcy55eWxpbmVu
bysxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0X2NvbHVtbjogdGhpcy55eWxs
b2MubGFzdF9jb2x1bW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9jb2x1bW46
IGxpbmVzID8gbGluZXNbbGluZXMubGVuZ3RoLTFdLmxlbmd0aC1saW5lc1tsaW5lcy5sZW5ndGgt
MV0ubWF0Y2goL1xyP1xuPy8pWzBdLmxlbmd0aCA6IHRoaXMueXlsbG9jLmxhc3RfY29sdW1uICsg
bWF0Y2hbMF0ubGVuZ3RofTsKICAgICAgICAgICAgICB0aGlzLnl5dGV4dCArPSBtYXRjaFswXTsK
ICAgICAgICAgICAgICB0aGlzLm1hdGNoICs9IG1hdGNoWzBdOwogICAgICAgICAgICAgIHRoaXMu
bWF0Y2hlcyA9IG1hdGNoOwogICAgICAgICAgICAgIHRoaXMueXlsZW5nID0gdGhpcy55eXRleHQu
bGVuZ3RoOwogICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB7CiAgICAgICAg
ICAgICAgICAgIHRoaXMueXlsbG9jLnJhbmdlID0gW3RoaXMub2Zmc2V0LCB0aGlzLm9mZnNldCAr
PSB0aGlzLnl5bGVuZ107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuX21vcmUg
PSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLl9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKG1h
dGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgdGhpcy5tYXRjaGVkICs9IG1hdGNoWzBdOwog
ICAgICAgICAgICAgIHRva2VuID0gdGhpcy5wZXJmb3JtQWN0aW9uLmNhbGwodGhpcywgdGhpcy55
eSwgdGhpcywgcnVsZXNbaW5kZXhdLHRoaXMuY29uZGl0aW9uU3RhY2tbdGhpcy5jb25kaXRpb25T
dGFjay5sZW5ndGgtMV0pOwogICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUgJiYgdGhpcy5faW5w
dXQpIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICh0b2tlbikgcmV0dXJuIHRv
a2VuOwogICAgICAgICAgICAgIGVsc2UgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYg
KHRoaXMuX2lucHV0ID09PSAiIikgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLkVPRjsKICAg
ICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFcnJvcignTGV4
aWNhbCBlcnJvciBvbiBsaW5lICcrKHRoaXMueXlsaW5lbm8rMSkrJy4gVW5yZWNvZ25pemVkIHRl
eHQuXG4nK3RoaXMuc2hvd1Bvc2l0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICB7dGV4dDog
IiIsIHRva2VuOiBudWxsLCBsaW5lOiB0aGlzLnl5bGluZW5vfSk7CiAgICAgICAgICB9CiAgICAg
IH0sCiAgbGV4OmZ1bmN0aW9uIGxleCgpIHsKICAgICAgICAgIHZhciByID0gdGhpcy5uZXh0KCk7
CiAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAg
cmV0dXJuIHI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmxl
eCgpOwogICAgICAgICAgfQogICAgICB9LAogIGJlZ2luOmZ1bmN0aW9uIGJlZ2luKGNvbmRpdGlv
bikgewogICAgICAgICAgdGhpcy5jb25kaXRpb25TdGFjay5wdXNoKGNvbmRpdGlvbik7CiAgICAg
IH0sCiAgcG9wU3RhdGU6ZnVuY3Rpb24gcG9wU3RhdGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhp
cy5jb25kaXRpb25TdGFjay5wb3AoKTsKICAgICAgfSwKICBfY3VycmVudFJ1bGVzOmZ1bmN0aW9u
IF9jdXJyZW50UnVsZXMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25zW3RoaXMu
Y29uZGl0aW9uU3RhY2tbdGhpcy5jb25kaXRpb25TdGFjay5sZW5ndGgtMV1dLnJ1bGVzOwogICAg
ICB9LAogIHRvcFN0YXRlOmZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbmRp
dGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoLTJdOwogICAgICB9LAogIHB1c2hT
dGF0ZTpmdW5jdGlvbiBiZWdpbihjb25kaXRpb24pIHsKICAgICAgICAgIHRoaXMuYmVnaW4oY29u
ZGl0aW9uKTsKICAgICAgfX0pOwogIGxleGVyLm9wdGlvbnMgPSB7fTsKICBsZXhlci5wZXJmb3Jt
QWN0aW9uID0gZnVuY3Rpb24gYW5vbnltb3VzKHl5LHl5XywkYXZvaWRpbmdfbmFtZV9jb2xsaXNp
b25zLFlZX1NUQVJUKSB7CgoKICBmdW5jdGlvbiBzdHJpcChzdGFydCwgZW5kKSB7CiAgICByZXR1
cm4geXlfLnl5dGV4dCA9IHl5Xy55eXRleHQuc3Vic3RyKHN0YXJ0LCB5eV8ueXlsZW5nLWVuZCk7
CiAgfQoKCiAgdmFyIFlZU1RBVEU9WVlfU1RBUlQKICBzd2l0Y2goJGF2b2lkaW5nX25hbWVfY29s
bGlzaW9ucykgewogIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGlmKHl5Xy55eXRleHQuc2xpY2UoLTIpID09PSAiXFxcXCIpIHsKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RyaXAoMCwxKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdGhpcy5iZWdpbigibXUiKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIH0gZWxzZSBpZih5eV8ueXl0ZXh0LnNsaWNlKC0xKSA9PT0gIlxcIikgewog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpcCgwLDEpOwogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luKCJlbXUiKTsKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW4oIm11Iik7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpZih5eV8ueXl0ZXh0KSByZXR1cm4gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgCiAgYnJlYWs7CiAgY2FzZSAxOnJldHVybiAxNDsKICBicmVhazsKICBjYXNlIDI6CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcFN0YXRlKCk7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTQ7CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgCiAgYnJlYWs7CiAgY2FzZSAzOnN0cmlwKDAsNCk7IHRoaXMu
cG9wU3RhdGUoKTsgcmV0dXJuIDE1OwogIGJyZWFrOwogIGNhc2UgNDpyZXR1cm4gMjU7CiAgYnJl
YWs7CiAgY2FzZSA1OnJldHVybiAxNjsKICBicmVhazsKICBjYXNlIDY6cmV0dXJuIDIwOwogIGJy
ZWFrOwogIGNhc2UgNzpyZXR1cm4gMTk7CiAgYnJlYWs7CiAgY2FzZSA4OnJldHVybiAxOTsKICBi
cmVhazsKICBjYXNlIDk6cmV0dXJuIDIzOwogIGJyZWFrOwogIGNhc2UgMTA6cmV0dXJuIDIyOwog
IGJyZWFrOwogIGNhc2UgMTE6dGhpcy5wb3BTdGF0ZSgpOyB0aGlzLmJlZ2luKCdjb20nKTsKICBi
cmVhazsKICBjYXNlIDEyOnN0cmlwKDMsNSk7IHRoaXMucG9wU3RhdGUoKTsgcmV0dXJuIDE1Owog
IGJyZWFrOwogIGNhc2UgMTM6cmV0dXJuIDIyOwogIGJyZWFrOwogIGNhc2UgMTQ6cmV0dXJuIDM5
OwogIGJyZWFrOwogIGNhc2UgMTU6cmV0dXJuIDM4OwogIGJyZWFrOwogIGNhc2UgMTY6cmV0dXJu
IDM4OwogIGJyZWFrOwogIGNhc2UgMTc6cmV0dXJuIDQyOwogIGJyZWFrOwogIGNhc2UgMTg6Ly8g
aWdub3JlIHdoaXRlc3BhY2UKICBicmVhazsKICBjYXNlIDE5OnRoaXMucG9wU3RhdGUoKTsgcmV0
dXJuIDI0OwogIGJyZWFrOwogIGNhc2UgMjA6dGhpcy5wb3BTdGF0ZSgpOyByZXR1cm4gMTg7CiAg
YnJlYWs7CiAgY2FzZSAyMTp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwyKS5yZXBsYWNlKC9cXCIvZywn
IicpOyByZXR1cm4gMzI7CiAgYnJlYWs7CiAgY2FzZSAyMjp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwy
KS5yZXBsYWNlKC9cXCcvZywiJyIpOyByZXR1cm4gMzI7CiAgYnJlYWs7CiAgY2FzZSAyMzpyZXR1
cm4gNDA7CiAgYnJlYWs7CiAgY2FzZSAyNDpyZXR1cm4gMzQ7CiAgYnJlYWs7CiAgY2FzZSAyNTpy
ZXR1cm4gMzQ7CiAgYnJlYWs7CiAgY2FzZSAyNjpyZXR1cm4gMzM7CiAgYnJlYWs7CiAgY2FzZSAy
NzpyZXR1cm4gMzg7CiAgYnJlYWs7CiAgY2FzZSAyODp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwyKTsg
cmV0dXJuIDM4OwogIGJyZWFrOwogIGNhc2UgMjk6cmV0dXJuICdJTlZBTElEJzsKICBicmVhazsK
ICBjYXNlIDMwOnJldHVybiA1OwogIGJyZWFrOwogIH0KICB9OwogIGxleGVyLnJ1bGVzID0gWy9e
KD86W15ceDAwXSo/KD89KFx7XHspKSkvLC9eKD86W15ceDAwXSspLywvXig/OlteXHgwMF17Mix9
Pyg/PShce1x7fFxcXHtce3xcXFxcXHtce3wkKSkpLywvXig/Oltcc1xTXSo/LS1cfVx9KS8sL14o
Pzpce1x7KH4pPz4pLywvXig/Olx7XHsofik/IykvLC9eKD86XHtceyh+KT9cLykvLC9eKD86XHtc
eyh+KT9cXikvLC9eKD86XHtceyh+KT9ccyplbHNlXGIpLywvXig/Olx7XHsofik/XHspLywvXig/
Olx7XHsofik/JikvLC9eKD86XHtceyEtLSkvLC9eKD86XHtceyFbXHNcU10qP1x9XH0pLywvXig/
Olx7XHsofik/KS8sL14oPzo9KS8sL14oPzpcLlwuKS8sL14oPzpcLig/PShbPX59XHNcLy5dKSkp
LywvXig/OltcLy5dKS8sL14oPzpccyspLywvXig/Olx9KH4pP1x9XH0pLywvXig/Oih+KT9cfVx9
KS8sL14oPzoiKFxcWyJdfFteIl0pKiIpLywvXig/OicoXFxbJ118W14nXSkqJykvLC9eKD86QCkv
LC9eKD86dHJ1ZSg/PShbfn1cc10pKSkvLC9eKD86ZmFsc2UoPz0oW359XHNdKSkpLywvXig/Oi0/
WzAtOV0rKD89KFt+fVxzXSkpKS8sL14oPzooW15ccyEiIyUtLFwuXC87LT5AXFstXF5gXHstfl0r
KD89KFs9fn1cc1wvLl0pKSkpLywvXig/OlxbW15cXV0qXF0pLywvXig/Oi4pLywvXig/OiQpL107
CiAgbGV4ZXIuY29uZGl0aW9ucyA9IHsibXUiOnsicnVsZXMiOls0LDUsNiw3LDgsOSwxMCwxMSwx
MiwxMywxNCwxNSwxNiwxNywxOCwxOSwyMCwyMSwyMiwyMywyNCwyNSwyNiwyNywyOCwyOSwzMF0s
ImluY2x1c2l2ZSI6ZmFsc2V9LCJlbXUiOnsicnVsZXMiOlsyXSwiaW5jbHVzaXZlIjpmYWxzZX0s
ImNvbSI6eyJydWxlcyI6WzNdLCJpbmNsdXNpdmUiOmZhbHNlfSwiSU5JVElBTCI6eyJydWxlcyI6
WzAsMSwzMF0sImluY2x1c2l2ZSI6dHJ1ZX19OwogIHJldHVybiBsZXhlcjt9KSgpCiAgcGFyc2Vy
LmxleGVyID0gbGV4ZXI7CiAgZnVuY3Rpb24gUGFyc2VyICgpIHsgdGhpcy55eSA9IHt9OyB9UGFy
c2VyLnByb3RvdHlwZSA9IHBhcnNlcjtwYXJzZXIuUGFyc2VyID0gUGFyc2VyOwogIHJldHVybiBu
ZXcgUGFyc2VyOwogIH0pKCk7X19leHBvcnRzX18gPSBoYW5kbGViYXJzOwogIC8qIGpzaGludCBp
Z25vcmU6ZW5kICovCiAgcmV0dXJuIF9fZXhwb3J0c19fOwp9KSgpOwoKLy8gaGFuZGxlYmFycy9j
b21waWxlci9iYXNlLmpzCnZhciBfX21vZHVsZThfXyA9IChmdW5jdGlvbihfX2RlcGVuZGVuY3kx
X18sIF9fZGVwZW5kZW5jeTJfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX18g
PSB7fTsKICB2YXIgcGFyc2VyID0gX19kZXBlbmRlbmN5MV9fOwogIHZhciBBU1QgPSBfX2RlcGVu
ZGVuY3kyX187CgogIF9fZXhwb3J0c19fLnBhcnNlciA9IHBhcnNlcjsKCiAgZnVuY3Rpb24gcGFy
c2UoaW5wdXQpIHsKICAgIC8vIEp1c3QgcmV0dXJuIGlmIGFuIGFscmVhZHktY29tcGlsZSBBU1Qg
d2FzIHBhc3NlZCBpbi4KICAgIGlmKGlucHV0LmNvbnN0cnVjdG9yID09PSBBU1QuUHJvZ3JhbU5v
ZGUpIHsgcmV0dXJuIGlucHV0OyB9CgogICAgcGFyc2VyLnl5ID0gQVNUOwogICAgcmV0dXJuIHBh
cnNlci5wYXJzZShpbnB1dCk7CiAgfQoKICBfX2V4cG9ydHNfXy5wYXJzZSA9IHBhcnNlOwogIHJl
dHVybiBfX2V4cG9ydHNfXzsKfSkoX19tb2R1bGU5X18sIF9fbW9kdWxlN19fKTsKCi8vIGhhbmRs
ZWJhcnMvY29tcGlsZXIvamF2YXNjcmlwdC1jb21waWxlci5qcwp2YXIgX19tb2R1bGUxMV9fID0g
KGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBv
cnRzX187CiAgdmFyIENPTVBJTEVSX1JFVklTSU9OID0gX19kZXBlbmRlbmN5MV9fLkNPTVBJTEVS
X1JFVklTSU9OOwogIHZhciBSRVZJU0lPTl9DSEFOR0VTID0gX19kZXBlbmRlbmN5MV9fLlJFVklT
SU9OX0NIQU5HRVM7CiAgdmFyIGxvZyA9IF9fZGVwZW5kZW5jeTFfXy5sb2c7CgogIGZ1bmN0aW9u
IExpdGVyYWwodmFsdWUpIHsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICB9CgogIGZ1bmN0aW9u
IEphdmFTY3JpcHRDb21waWxlcigpIHt9CgogIEphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUg
PSB7CiAgICAvLyBQVUJMSUMgQVBJOiBZb3UgY2FuIG92ZXJyaWRlIHRoZXNlIG1ldGhvZHMgaW4g
YSBzdWJjbGFzcyB0byBwcm92aWRlCiAgICAvLyBhbHRlcm5hdGl2ZSBjb21waWxlZCBmb3JtcyBm
b3IgbmFtZSBsb29rdXAgYW5kIGJ1ZmZlcmluZyBzZW1hbnRpY3MKICAgIG5hbWVMb29rdXA6IGZ1
bmN0aW9uKHBhcmVudCwgbmFtZSAvKiAsIHR5cGUqLykgewogICAgICB2YXIgd3JhcCwKICAgICAg
ICAgIHJldDsKICAgICAgaWYgKHBhcmVudC5pbmRleE9mKCdkZXB0aCcpID09PSAwKSB7CiAgICAg
ICAgd3JhcCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgvXlswLTldKyQvLnRlc3QobmFtZSkp
IHsKICAgICAgICByZXQgPSBwYXJlbnQgKyAiWyIgKyBuYW1lICsgIl0iOwogICAgICB9IGVsc2Ug
aWYgKEphdmFTY3JpcHRDb21waWxlci5pc1ZhbGlkSmF2YVNjcmlwdFZhcmlhYmxlTmFtZShuYW1l
KSkgewogICAgICAgIHJldCA9IHBhcmVudCArICIuIiArIG5hbWU7CiAgICAgIH0KICAgICAgZWxz
ZSB7CiAgICAgICAgcmV0ID0gcGFyZW50ICsgIlsnIiArIG5hbWUgKyAiJ10iOwogICAgICB9Cgog
ICAgICBpZiAod3JhcCkgewogICAgICAgIHJldHVybiAnKCcgKyBwYXJlbnQgKyAnICYmICcgKyBy
ZXQgKyAnKSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfQogICAg
fSwKCiAgICBjb21waWxlckluZm86IGZ1bmN0aW9uKCkgewogICAgICB2YXIgcmV2aXNpb24gPSBD
T01QSUxFUl9SRVZJU0lPTiwKICAgICAgICAgIHZlcnNpb25zID0gUkVWSVNJT05fQ0hBTkdFU1ty
ZXZpc2lvbl07CiAgICAgIHJldHVybiAidGhpcy5jb21waWxlckluZm8gPSBbIityZXZpc2lvbisi
LCciK3ZlcnNpb25zKyInXTtcbiI7CiAgICB9LAoKICAgIGFwcGVuZFRvQnVmZmVyOiBmdW5jdGlv
bihzdHJpbmcpIHsKICAgICAgaWYgKHRoaXMuZW52aXJvbm1lbnQuaXNTaW1wbGUpIHsKICAgICAg
ICByZXR1cm4gInJldHVybiAiICsgc3RyaW5nICsgIjsiOwogICAgICB9IGVsc2UgewogICAgICAg
IHJldHVybiB7CiAgICAgICAgICBhcHBlbmRUb0J1ZmZlcjogdHJ1ZSwKICAgICAgICAgIGNvbnRl
bnQ6IHN0cmluZywKICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsgcmV0dXJuICJidWZm
ZXIgKz0gIiArIHN0cmluZyArICI7IjsgfQogICAgICAgIH07CiAgICAgIH0KICAgIH0sCgogICAg
aW5pdGlhbGl6ZUJ1ZmZlcjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnF1b3RlZFN0
cmluZygiIik7CiAgICB9LAoKICAgIG5hbWVzcGFjZTogIkhhbmRsZWJhcnMiLAogICAgLy8gRU5E
IFBVQkxJQyBBUEkKCiAgICBjb21waWxlOiBmdW5jdGlvbihlbnZpcm9ubWVudCwgb3B0aW9ucywg
Y29udGV4dCwgYXNPYmplY3QpIHsKICAgICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50
OwogICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgbG9nKCdkZWJ1Zycs
IHRoaXMuZW52aXJvbm1lbnQuZGlzYXNzZW1ibGUoKSArICJcblxuIik7CgogICAgICB0aGlzLm5h
bWUgPSB0aGlzLmVudmlyb25tZW50Lm5hbWU7CiAgICAgIHRoaXMuaXNDaGlsZCA9ICEhY29udGV4
dDsKICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dCB8fCB7CiAgICAgICAgcHJvZ3JhbXM6IFtd
LAogICAgICAgIGVudmlyb25tZW50czogW10sCiAgICAgICAgYWxpYXNlczogeyB9CiAgICAgIH07
CgogICAgICB0aGlzLnByZWFtYmxlKCk7CgogICAgICB0aGlzLnN0YWNrU2xvdCA9IDA7CiAgICAg
IHRoaXMuc3RhY2tWYXJzID0gW107CiAgICAgIHRoaXMucmVnaXN0ZXJzID0geyBsaXN0OiBbXSB9
OwogICAgICB0aGlzLmNvbXBpbGVTdGFjayA9IFtdOwogICAgICB0aGlzLmlubGluZVN0YWNrID0g
W107CgogICAgICB0aGlzLmNvbXBpbGVDaGlsZHJlbihlbnZpcm9ubWVudCwgb3B0aW9ucyk7Cgog
ICAgICB2YXIgb3Bjb2RlcyA9IGVudmlyb25tZW50Lm9wY29kZXMsIG9wY29kZTsKCiAgICAgIHRo
aXMuaSA9IDA7CgogICAgICBmb3IodmFyIGw9b3Bjb2Rlcy5sZW5ndGg7IHRoaXMuaTxsOyB0aGlz
LmkrKykgewogICAgICAgIG9wY29kZSA9IG9wY29kZXNbdGhpcy5pXTsKCiAgICAgICAgaWYob3Bj
b2RlLm9wY29kZSA9PT0gJ0RFQ0xBUkUnKSB7CiAgICAgICAgICB0aGlzW29wY29kZS5uYW1lXSA9
IG9wY29kZS52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpc1tvcGNvZGUub3Bj
b2RlXS5hcHBseSh0aGlzLCBvcGNvZGUuYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXNl
dCB0aGUgc3RyaXBOZXh0IGZsYWcgaWYgaXQgd2FzIG5vdCBzZXQgYnkgdGhpcyBvcGVyYXRpb24u
CiAgICAgICAgaWYgKG9wY29kZS5vcGNvZGUgIT09IHRoaXMuc3RyaXBOZXh0KSB7CiAgICAgICAg
ICB0aGlzLnN0cmlwTmV4dCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gRmx1
c2ggYW55IHRyYWlsaW5nIGNvbnRlbnQgdGhhdCBtaWdodCBiZSBwZW5kaW5nLgogICAgICB0aGlz
LnB1c2hTb3VyY2UoJycpOwoKICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRnVuY3Rpb25Db250ZXh0
KGFzT2JqZWN0KTsKICAgIH0sCgogICAgcHJlYW1ibGU6IGZ1bmN0aW9uKCkgewogICAgICB2YXIg
b3V0ID0gW107CgogICAgICBpZiAoIXRoaXMuaXNDaGlsZCkgewogICAgICAgIHZhciBuYW1lc3Bh
Y2UgPSB0aGlzLm5hbWVzcGFjZTsKCiAgICAgICAgdmFyIGNvcGllcyA9ICJoZWxwZXJzID0gdGhp
cy5tZXJnZShoZWxwZXJzLCAiICsgbmFtZXNwYWNlICsgIi5oZWxwZXJzKTsiOwogICAgICAgIGlm
ICh0aGlzLmVudmlyb25tZW50LnVzZVBhcnRpYWwpIHsgY29waWVzID0gY29waWVzICsgIiBwYXJ0
aWFscyA9IHRoaXMubWVyZ2UocGFydGlhbHMsICIgKyBuYW1lc3BhY2UgKyAiLnBhcnRpYWxzKTsi
OyB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kYXRhKSB7IGNvcGllcyA9IGNvcGllcyArICIg
ZGF0YSA9IGRhdGEgfHwge307IjsgfQogICAgICAgIG91dC5wdXNoKGNvcGllcyk7CiAgICAgIH0g
ZWxzZSB7CiAgICAgICAgb3V0LnB1c2goJycpOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuZW52
aXJvbm1lbnQuaXNTaW1wbGUpIHsKICAgICAgICBvdXQucHVzaCgiLCBidWZmZXIgPSAiICsgdGhp
cy5pbml0aWFsaXplQnVmZmVyKCkpOwogICAgICB9IGVsc2UgewogICAgICAgIG91dC5wdXNoKCIi
KTsKICAgICAgfQoKICAgICAgLy8gdHJhY2sgdGhlIGxhc3QgY29udGV4dCBwdXNoZWQgaW50byBw
bGFjZSB0byBhbGxvdyBza2lwcGluZyB0aGUKICAgICAgLy8gZ2V0Q29udGV4dCBvcGNvZGUgd2hl
biBpdCB3b3VsZCBiZSBhIG5vb3AKICAgICAgdGhpcy5sYXN0Q29udGV4dCA9IDA7CiAgICAgIHRo
aXMuc291cmNlID0gb3V0OwogICAgfSwKCiAgICBjcmVhdGVGdW5jdGlvbkNvbnRleHQ6IGZ1bmN0
aW9uKGFzT2JqZWN0KSB7CiAgICAgIHZhciBsb2NhbHMgPSB0aGlzLnN0YWNrVmFycy5jb25jYXQo
dGhpcy5yZWdpc3RlcnMubGlzdCk7CgogICAgICBpZihsb2NhbHMubGVuZ3RoID4gMCkgewogICAg
ICAgIHRoaXMuc291cmNlWzFdID0gdGhpcy5zb3VyY2VbMV0gKyAiLCAiICsgbG9jYWxzLmpvaW4o
IiwgIik7CiAgICAgIH0KCiAgICAgIC8vIEdlbmVyYXRlIG1pbmltaXplciBhbGlhcyBtYXBwaW5n
cwogICAgICBpZiAoIXRoaXMuaXNDaGlsZCkgewogICAgICAgIGZvciAodmFyIGFsaWFzIGluIHRo
aXMuY29udGV4dC5hbGlhc2VzKSB7CiAgICAgICAgICBpZiAodGhpcy5jb250ZXh0LmFsaWFzZXMu
aGFzT3duUHJvcGVydHkoYWxpYXMpKSB7CiAgICAgICAgICAgIHRoaXMuc291cmNlWzFdID0gdGhp
cy5zb3VyY2VbMV0gKyAnLCAnICsgYWxpYXMgKyAnPScgKyB0aGlzLmNvbnRleHQuYWxpYXNlc1th
bGlhc107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5zb3Vy
Y2VbMV0pIHsKICAgICAgICB0aGlzLnNvdXJjZVsxXSA9ICJ2YXIgIiArIHRoaXMuc291cmNlWzFd
LnN1YnN0cmluZygyKSArICI7IjsKICAgICAgfQoKICAgICAgLy8gTWVyZ2UgY2hpbGRyZW4KICAg
ICAgaWYgKCF0aGlzLmlzQ2hpbGQpIHsKICAgICAgICB0aGlzLnNvdXJjZVsxXSArPSAnXG4nICsg
dGhpcy5jb250ZXh0LnByb2dyYW1zLmpvaW4oJ1xuJykgKyAnXG4nOwogICAgICB9CgogICAgICBp
ZiAoIXRoaXMuZW52aXJvbm1lbnQuaXNTaW1wbGUpIHsKICAgICAgICB0aGlzLnB1c2hTb3VyY2Uo
InJldHVybiBidWZmZXI7Iik7CiAgICAgIH0KCiAgICAgIHZhciBwYXJhbXMgPSB0aGlzLmlzQ2hp
bGQgPyBbImRlcHRoMCIsICJkYXRhIl0gOiBbIkhhbmRsZWJhcnMiLCAiZGVwdGgwIiwgImhlbHBl
cnMiLCAicGFydGlhbHMiLCAiZGF0YSJdOwoKICAgICAgZm9yKHZhciBpPTAsIGw9dGhpcy5lbnZp
cm9ubWVudC5kZXB0aHMubGlzdC5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgcGFyYW1zLnB1
c2goImRlcHRoIiArIHRoaXMuZW52aXJvbm1lbnQuZGVwdGhzLmxpc3RbaV0pOwogICAgICB9Cgog
ICAgICAvLyBQZXJmb3JtIGEgc2Vjb25kIHBhc3Mgb3ZlciB0aGUgb3V0cHV0IHRvIG1lcmdlIGNv
bnRlbnQgd2hlbiBwb3NzaWJsZQogICAgICB2YXIgc291cmNlID0gdGhpcy5tZXJnZVNvdXJjZSgp
OwoKICAgICAgaWYgKCF0aGlzLmlzQ2hpbGQpIHsKICAgICAgICBzb3VyY2UgPSB0aGlzLmNvbXBp
bGVySW5mbygpK3NvdXJjZTsKICAgICAgfQoKICAgICAgaWYgKGFzT2JqZWN0KSB7CiAgICAgICAg
cGFyYW1zLnB1c2goc291cmNlKTsKCiAgICAgICAgcmV0dXJuIEZ1bmN0aW9uLmFwcGx5KHRoaXMs
IHBhcmFtcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZ1bmN0aW9uU291cmNlID0gJ2Z1
bmN0aW9uICcgKyAodGhpcy5uYW1lIHx8ICcnKSArICcoJyArIHBhcmFtcy5qb2luKCcsJykgKyAn
KSB7XG4gICcgKyBzb3VyY2UgKyAnfSc7CiAgICAgICAgbG9nKCdkZWJ1ZycsIGZ1bmN0aW9uU291
cmNlICsgIlxuXG4iKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb25Tb3VyY2U7CiAgICAgIH0KICAg
IH0sCiAgICBtZXJnZVNvdXJjZTogZnVuY3Rpb24oKSB7CiAgICAgIC8vIFdBUk46IFdlIGFyZSBu
b3QgaGFuZGxpbmcgdGhlIGNhc2Ugd2hlcmUgYnVmZmVyIGlzIHN0aWxsIHBvcHVsYXRlZCBhcyB0
aGUgc291cmNlIHNob3VsZAogICAgICAvLyBub3QgaGF2ZSBidWZmZXIgYXBwZW5kIG9wZXJhdGlv
bnMgYXMgdGhlaXIgZmluYWwgYWN0aW9uLgogICAgICB2YXIgc291cmNlID0gJycsCiAgICAgICAg
ICBidWZmZXI7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnNvdXJjZS5sZW5ndGg7
IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBsaW5lID0gdGhpcy5zb3VyY2VbaV07CiAgICAg
ICAgaWYgKGxpbmUuYXBwZW5kVG9CdWZmZXIpIHsKICAgICAgICAgIGlmIChidWZmZXIpIHsKICAg
ICAgICAgICAgYnVmZmVyID0gYnVmZmVyICsgJ1xuICAgICsgJyArIGxpbmUuY29udGVudDsKICAg
ICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1ZmZlciA9IGxpbmUuY29udGVudDsKICAgICAg
ICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGJ1ZmZlcikgewogICAgICAgICAg
ICBzb3VyY2UgKz0gJ2J1ZmZlciArPSAnICsgYnVmZmVyICsgJztcbiAgJzsKICAgICAgICAgICAg
YnVmZmVyID0gdW5kZWZpbmVkOwogICAgICAgICAgfQogICAgICAgICAgc291cmNlICs9IGxpbmUg
KyAnXG4gICc7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBzb3VyY2U7CiAgICB9LAoK
ICAgIC8vIFtibG9ja1ZhbHVlXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gs
IGludmVyc2UsIHByb2dyYW0sIHZhbHVlCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJldHVybiB2
YWx1ZSBvZiBibG9ja0hlbHBlck1pc3NpbmcKICAgIC8vCiAgICAvLyBUaGUgcHVycG9zZSBvZiB0
aGlzIG9wY29kZSBpcyB0byB0YWtlIGEgYmxvY2sgb2YgdGhlIGZvcm0KICAgIC8vIGB7eyNmb299
fS4uLnt7L2Zvb319YCwgcmVzb2x2ZSB0aGUgdmFsdWUgb2YgYGZvb2AsIGFuZAogICAgLy8gcmVw
bGFjZSBpdCBvbiB0aGUgc3RhY2sgd2l0aCB0aGUgcmVzdWx0IG9mIHByb3Blcmx5CiAgICAvLyBp
bnZva2luZyBibG9ja0hlbHBlck1pc3NpbmcuCiAgICBibG9ja1ZhbHVlOiBmdW5jdGlvbigpIHsK
ICAgICAgdGhpcy5jb250ZXh0LmFsaWFzZXMuYmxvY2tIZWxwZXJNaXNzaW5nID0gJ2hlbHBlcnMu
YmxvY2tIZWxwZXJNaXNzaW5nJzsKCiAgICAgIHZhciBwYXJhbXMgPSBbImRlcHRoMCJdOwogICAg
ICB0aGlzLnNldHVwUGFyYW1zKDAsIHBhcmFtcyk7CgogICAgICB0aGlzLnJlcGxhY2VTdGFjayhm
dW5jdGlvbihjdXJyZW50KSB7CiAgICAgICAgcGFyYW1zLnNwbGljZSgxLCAwLCBjdXJyZW50KTsK
ICAgICAgICByZXR1cm4gImJsb2NrSGVscGVyTWlzc2luZy5jYWxsKCIgKyBwYXJhbXMuam9pbigi
LCAiKSArICIpIjsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIFthbWJpZ3VvdXNCbG9ja1ZhbHVl
XQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0s
IHZhbHVlCiAgICAvLyBDb21waWxlciB2YWx1ZSwgYmVmb3JlOiBsYXN0SGVscGVyPXZhbHVlIG9m
IGxhc3QgZm91bmQgaGVscGVyLCBpZiBhbnkKICAgIC8vIE9uIHN0YWNrLCBhZnRlciwgaWYgbm8g
bGFzdEhlbHBlcjogc2FtZSBhcyBbYmxvY2tWYWx1ZV0KICAgIC8vIE9uIHN0YWNrLCBhZnRlciwg
aWYgbGFzdEhlbHBlcjogdmFsdWUKICAgIGFtYmlndW91c0Jsb2NrVmFsdWU6IGZ1bmN0aW9uKCkg
ewogICAgICB0aGlzLmNvbnRleHQuYWxpYXNlcy5ibG9ja0hlbHBlck1pc3NpbmcgPSAnaGVscGVy
cy5ibG9ja0hlbHBlck1pc3NpbmcnOwoKICAgICAgdmFyIHBhcmFtcyA9IFsiZGVwdGgwIl07CiAg
ICAgIHRoaXMuc2V0dXBQYXJhbXMoMCwgcGFyYW1zKTsKCiAgICAgIHZhciBjdXJyZW50ID0gdGhp
cy50b3BTdGFjaygpOwogICAgICBwYXJhbXMuc3BsaWNlKDEsIDAsIGN1cnJlbnQpOwoKICAgICAg
Ly8gVXNlIHRoZSBvcHRpb25zIHZhbHVlIGdlbmVyYXRlZCBmcm9tIHRoZSBpbnZvY2F0aW9uCiAg
ICAgIHBhcmFtc1twYXJhbXMubGVuZ3RoLTFdID0gJ29wdGlvbnMnOwoKICAgICAgdGhpcy5wdXNo
U291cmNlKCJpZiAoISIgKyB0aGlzLmxhc3RIZWxwZXIgKyAiKSB7ICIgKyBjdXJyZW50ICsgIiA9
IGJsb2NrSGVscGVyTWlzc2luZy5jYWxsKCIgKyBwYXJhbXMuam9pbigiLCAiKSArICIpOyB9Iik7
CiAgICB9LAoKICAgIC8vIFthcHBlbmRDb250ZW50XQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBi
ZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KICAgIC8vCiAgICAvLyBBcHBl
bmRzIHRoZSBzdHJpbmcgdmFsdWUgb2YgYGNvbnRlbnRgIHRvIHRoZSBjdXJyZW50IGJ1ZmZlcgog
ICAgYXBwZW5kQ29udGVudDogZnVuY3Rpb24oY29udGVudCkgewogICAgICBpZiAodGhpcy5wZW5k
aW5nQ29udGVudCkgewogICAgICAgIGNvbnRlbnQgPSB0aGlzLnBlbmRpbmdDb250ZW50ICsgY29u
dGVudDsKICAgICAgfQogICAgICBpZiAodGhpcy5zdHJpcE5leHQpIHsKICAgICAgICBjb250ZW50
ID0gY29udGVudC5yZXBsYWNlKC9eXHMrLywgJycpOwogICAgICB9CgogICAgICB0aGlzLnBlbmRp
bmdDb250ZW50ID0gY29udGVudDsKICAgIH0sCgogICAgLy8gW3N0cmlwXQogICAgLy8KICAgIC8v
IE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KICAgIC8v
CiAgICAvLyBSZW1vdmVzIGFueSB0cmFpbGluZyB3aGl0ZXNwYWNlIGZyb20gdGhlIHByaW9yIGNv
bnRlbnQgbm9kZSBhbmQgZmxhZ3MKICAgIC8vIHRoZSBuZXh0IG9wZXJhdGlvbiBmb3Igc3RyaXBw
aW5nIGlmIGl0IGlzIGEgY29udGVudCBub2RlLgogICAgc3RyaXA6IGZ1bmN0aW9uKCkgewogICAg
ICBpZiAodGhpcy5wZW5kaW5nQ29udGVudCkgewogICAgICAgIHRoaXMucGVuZGluZ0NvbnRlbnQg
PSB0aGlzLnBlbmRpbmdDb250ZW50LnJlcGxhY2UoL1xzKyQvLCAnJyk7CiAgICAgIH0KICAgICAg
dGhpcy5zdHJpcE5leHQgPSAnc3RyaXAnOwogICAgfSwKCiAgICAvLyBbYXBwZW5kXQogICAgLy8K
ICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IHZhbHVlLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRl
cjogLi4uCiAgICAvLwogICAgLy8gQ29lcmNlcyBgdmFsdWVgIHRvIGEgU3RyaW5nIGFuZCBhcHBl
bmRzIGl0IHRvIHRoZSBjdXJyZW50IGJ1ZmZlci4KICAgIC8vCiAgICAvLyBJZiBgdmFsdWVgIGlz
IHRydXRoeSwgb3IgMCwgaXQgaXMgY29lcmNlZCBpbnRvIGEgc3RyaW5nIGFuZCBhcHBlbmRlZAog
ICAgLy8gT3RoZXJ3aXNlLCB0aGUgZW1wdHkgc3RyaW5nIGlzIGFwcGVuZGVkCiAgICBhcHBlbmQ6
IGZ1bmN0aW9uKCkgewogICAgICAvLyBGb3JjZSBhbnl0aGluZyB0aGF0IGlzIGlubGluZWQgb250
byB0aGUgc3RhY2sgc28gd2UgZG9uJ3QgaGF2ZSBkdXBsaWNhdGlvbgogICAgICAvLyB3aGVuIHdl
IGV4YW1pbmUgbG9jYWwKICAgICAgdGhpcy5mbHVzaElubGluZSgpOwogICAgICB2YXIgbG9jYWwg
PSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIHRoaXMucHVzaFNvdXJjZSgiaWYoIiArIGxvY2FsICsg
IiB8fCAiICsgbG9jYWwgKyAiID09PSAwKSB7ICIgKyB0aGlzLmFwcGVuZFRvQnVmZmVyKGxvY2Fs
KSArICIgfSIpOwogICAgICBpZiAodGhpcy5lbnZpcm9ubWVudC5pc1NpbXBsZSkgewogICAgICAg
IHRoaXMucHVzaFNvdXJjZSgiZWxzZSB7ICIgKyB0aGlzLmFwcGVuZFRvQnVmZmVyKCInJyIpICsg
IiB9Iik7CiAgICAgIH0KICAgIH0sCgogICAgLy8gW2FwcGVuZEVzY2FwZWRdCiAgICAvLwogICAg
Ly8gT24gc3RhY2ssIGJlZm9yZTogdmFsdWUsIC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAu
Li4KICAgIC8vCiAgICAvLyBFc2NhcGUgYHZhbHVlYCBhbmQgYXBwZW5kIGl0IHRvIHRoZSBidWZm
ZXIKICAgIGFwcGVuZEVzY2FwZWQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNvbnRleHQuYWxp
YXNlcy5lc2NhcGVFeHByZXNzaW9uID0gJ3RoaXMuZXNjYXBlRXhwcmVzc2lvbic7CgogICAgICB0
aGlzLnB1c2hTb3VyY2UodGhpcy5hcHBlbmRUb0J1ZmZlcigiZXNjYXBlRXhwcmVzc2lvbigiICsg
dGhpcy5wb3BTdGFjaygpICsgIikiKSk7CiAgICB9LAoKICAgIC8vIFtnZXRDb250ZXh0XQogICAg
Ly8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAu
Li4KICAgIC8vIENvbXBpbGVyIHZhbHVlLCBhZnRlcjogbGFzdENvbnRleHQ9ZGVwdGgKICAgIC8v
CiAgICAvLyBTZXQgdGhlIHZhbHVlIG9mIHRoZSBgbGFzdENvbnRleHRgIGNvbXBpbGVyIHZhbHVl
IHRvIHRoZSBkZXB0aAogICAgZ2V0Q29udGV4dDogZnVuY3Rpb24oZGVwdGgpIHsKICAgICAgaWYo
dGhpcy5sYXN0Q29udGV4dCAhPT0gZGVwdGgpIHsKICAgICAgICB0aGlzLmxhc3RDb250ZXh0ID0g
ZGVwdGg7CiAgICAgIH0KICAgIH0sCgogICAgLy8gW2xvb2t1cE9uQ29udGV4dF0KICAgIC8vCiAg
ICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogY3VycmVu
dENvbnRleHRbbmFtZV0sIC4uLgogICAgLy8KICAgIC8vIExvb2tzIHVwIHRoZSB2YWx1ZSBvZiBg
bmFtZWAgb24gdGhlIGN1cnJlbnQgY29udGV4dCBhbmQgcHVzaGVzCiAgICAvLyBpdCBvbnRvIHRo
ZSBzdGFjay4KICAgIGxvb2t1cE9uQ29udGV4dDogZnVuY3Rpb24obmFtZSkgewogICAgICB0aGlz
LnB1c2godGhpcy5uYW1lTG9va3VwKCdkZXB0aCcgKyB0aGlzLmxhc3RDb250ZXh0LCBuYW1lLCAn
Y29udGV4dCcpKTsKICAgIH0sCgogICAgLy8gW3B1c2hDb250ZXh0XQogICAgLy8KICAgIC8vIE9u
IHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiBjdXJyZW50Q29udGV4
dCwgLi4uCiAgICAvLwogICAgLy8gUHVzaGVzIHRoZSB2YWx1ZSBvZiB0aGUgY3VycmVudCBjb250
ZXh0IG9udG8gdGhlIHN0YWNrLgogICAgcHVzaENvbnRleHQ6IGZ1bmN0aW9uKCkgewogICAgICB0
aGlzLnB1c2hTdGFja0xpdGVyYWwoJ2RlcHRoJyArIHRoaXMubGFzdENvbnRleHQpOwogICAgfSwK
CiAgICAvLyBbcmVzb2x2ZVBvc3NpYmxlTGFtYmRhXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBi
ZWZvcmU6IHZhbHVlLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmVzb2x2ZWQgdmFsdWUs
IC4uLgogICAgLy8KICAgIC8vIElmIHRoZSBgdmFsdWVgIGlzIGEgbGFtYmRhLCByZXBsYWNlIGl0
IG9uIHRoZSBzdGFjayBieQogICAgLy8gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgbGFtYmRhCiAg
ICByZXNvbHZlUG9zc2libGVMYW1iZGE6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNvbnRleHQu
YWxpYXNlcy5mdW5jdGlvblR5cGUgPSAnImZ1bmN0aW9uIic7CgogICAgICB0aGlzLnJlcGxhY2VT
dGFjayhmdW5jdGlvbihjdXJyZW50KSB7CiAgICAgICAgcmV0dXJuICJ0eXBlb2YgIiArIGN1cnJl
bnQgKyAiID09PSBmdW5jdGlvblR5cGUgPyAiICsgY3VycmVudCArICIuYXBwbHkoZGVwdGgwKSA6
ICIgKyBjdXJyZW50OwogICAgICB9KTsKICAgIH0sCgogICAgLy8gW2xvb2t1cF0KICAgIC8vCiAg
ICAvLyBPbiBzdGFjaywgYmVmb3JlOiB2YWx1ZSwgLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6
IHZhbHVlW25hbWVdLCAuLi4KICAgIC8vCiAgICAvLyBSZXBsYWNlIHRoZSB2YWx1ZSBvbiB0aGUg
c3RhY2sgd2l0aCB0aGUgcmVzdWx0IG9mIGxvb2tpbmcKICAgIC8vIHVwIGBuYW1lYCBvbiBgdmFs
dWVgCiAgICBsb29rdXA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgdGhpcy5yZXBsYWNlU3RhY2so
ZnVuY3Rpb24oY3VycmVudCkgewogICAgICAgIHJldHVybiBjdXJyZW50ICsgIiA9PSBudWxsIHx8
ICIgKyBjdXJyZW50ICsgIiA9PT0gZmFsc2UgPyAiICsgY3VycmVudCArICIgOiAiICsgdGhpcy5u
YW1lTG9va3VwKGN1cnJlbnQsIG5hbWUsICdjb250ZXh0Jyk7CiAgICAgIH0pOwogICAgfSwKCiAg
ICAvLyBbbG9va3VwRGF0YV0KICAgIC8vCiAgICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KICAg
IC8vIE9uIHN0YWNrLCBhZnRlcjogZGF0YSwgLi4uCiAgICAvLwogICAgLy8gUHVzaCB0aGUgZGF0
YSBsb29rdXAgb3BlcmF0b3IKICAgIGxvb2t1cERhdGE6IGZ1bmN0aW9uKCkgewogICAgICB0aGlz
LnB1c2goJ2RhdGEnKTsKICAgIH0sCgogICAgLy8gW3B1c2hTdHJpbmdQYXJhbV0KICAgIC8vCiAg
ICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogc3RyaW5n
LCBjdXJyZW50Q29udGV4dCwgLi4uCiAgICAvLwogICAgLy8gVGhpcyBvcGNvZGUgaXMgZGVzaWdu
ZWQgZm9yIHVzZSBpbiBzdHJpbmcgbW9kZSwgd2hpY2gKICAgIC8vIHByb3ZpZGVzIHRoZSBzdHJp
bmcgdmFsdWUgb2YgYSBwYXJhbWV0ZXIgYWxvbmcgd2l0aCBpdHMKICAgIC8vIGRlcHRoIHJhdGhl
ciB0aGFuIHJlc29sdmluZyBpdCBpbW1lZGlhdGVseS4KICAgIHB1c2hTdHJpbmdQYXJhbTogZnVu
Y3Rpb24oc3RyaW5nLCB0eXBlKSB7CiAgICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbCgnZGVwdGgn
ICsgdGhpcy5sYXN0Q29udGV4dCk7CgogICAgICB0aGlzLnB1c2hTdHJpbmcodHlwZSk7CgogICAg
ICBpZiAodHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLnB1c2hTdHJp
bmcoc3RyaW5nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwo
c3RyaW5nKTsKICAgICAgfQogICAgfSwKCiAgICBlbXB0eUhhc2g6IGZ1bmN0aW9uKCkgewogICAg
ICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoJ3t9Jyk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLnN0
cmluZ1BhcmFtcykgewogICAgICAgIHRoaXMucmVnaXN0ZXIoJ2hhc2hUeXBlcycsICd7fScpOwog
ICAgICAgIHRoaXMucmVnaXN0ZXIoJ2hhc2hDb250ZXh0cycsICd7fScpOwogICAgICB9CiAgICB9
LAogICAgcHVzaEhhc2g6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmhhc2ggPSB7dmFsdWVzOiBb
XSwgdHlwZXM6IFtdLCBjb250ZXh0czogW119OwogICAgfSwKICAgIHBvcEhhc2g6IGZ1bmN0aW9u
KCkgewogICAgICB2YXIgaGFzaCA9IHRoaXMuaGFzaDsKICAgICAgdGhpcy5oYXNoID0gdW5kZWZp
bmVkOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICB0aGlz
LnJlZ2lzdGVyKCdoYXNoQ29udGV4dHMnLCAneycgKyBoYXNoLmNvbnRleHRzLmpvaW4oJywnKSAr
ICd9Jyk7CiAgICAgICAgdGhpcy5yZWdpc3RlcignaGFzaFR5cGVzJywgJ3snICsgaGFzaC50eXBl
cy5qb2luKCcsJykgKyAnfScpOwogICAgICB9CiAgICAgIHRoaXMucHVzaCgne1xuICAgICcgKyBo
YXNoLnZhbHVlcy5qb2luKCcsXG4gICAgJykgKyAnXG4gIH0nKTsKICAgIH0sCgogICAgLy8gW3B1
c2hTdHJpbmddCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAvLyBPbiBz
dGFjaywgYWZ0ZXI6IHF1b3RlZFN0cmluZyhzdHJpbmcpLCAuLi4KICAgIC8vCiAgICAvLyBQdXNo
IGEgcXVvdGVkIHZlcnNpb24gb2YgYHN0cmluZ2Agb250byB0aGUgc3RhY2sKICAgIHB1c2hTdHJp
bmc6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodGhpcy5x
dW90ZWRTdHJpbmcoc3RyaW5nKSk7CiAgICB9LAoKICAgIC8vIFtwdXNoXQogICAgLy8KICAgIC8v
IE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiBleHByLCAuLi4K
ICAgIC8vCiAgICAvLyBQdXNoIGFuIGV4cHJlc3Npb24gb250byB0aGUgc3RhY2sKICAgIHB1c2g6
IGZ1bmN0aW9uKGV4cHIpIHsKICAgICAgdGhpcy5pbmxpbmVTdGFjay5wdXNoKGV4cHIpOwogICAg
ICByZXR1cm4gZXhwcjsKICAgIH0sCgogICAgLy8gW3B1c2hMaXRlcmFsXQogICAgLy8KICAgIC8v
IE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiB2YWx1ZSwgLi4u
CiAgICAvLwogICAgLy8gUHVzaGVzIGEgdmFsdWUgb250byB0aGUgc3RhY2suIFRoaXMgb3BlcmF0
aW9uIHByZXZlbnRzCiAgICAvLyB0aGUgY29tcGlsZXIgZnJvbSBjcmVhdGluZyBhIHRlbXBvcmFy
eSB2YXJpYWJsZSB0byBob2xkCiAgICAvLyBpdC4KICAgIHB1c2hMaXRlcmFsOiBmdW5jdGlvbih2
YWx1ZSkgewogICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodmFsdWUpOwogICAgfSwKCiAgICAv
LyBbcHVzaFByb2dyYW1dCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAv
LyBPbiBzdGFjaywgYWZ0ZXI6IHByb2dyYW0oZ3VpZCksIC4uLgogICAgLy8KICAgIC8vIFB1c2gg
YSBwcm9ncmFtIGV4cHJlc3Npb24gb250byB0aGUgc3RhY2suIFRoaXMgdGFrZXMKICAgIC8vIGEg
Y29tcGlsZS10aW1lIGd1aWQgYW5kIGNvbnZlcnRzIGl0IGludG8gYSBydW50aW1lLWFjY2Vzc2li
bGUKICAgIC8vIGV4cHJlc3Npb24uCiAgICBwdXNoUHJvZ3JhbTogZnVuY3Rpb24oZ3VpZCkgewog
ICAgICBpZiAoZ3VpZCAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKHRo
aXMucHJvZ3JhbUV4cHJlc3Npb24oZ3VpZCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMu
cHVzaFN0YWNrTGl0ZXJhbChudWxsKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBbaW52b2tlSGVs
cGVyXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dy
YW0sIHBhcmFtcy4uLiwgLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJlc3VsdCBvZiBoZWxw
ZXIgaW52b2NhdGlvbgogICAgLy8KICAgIC8vIFBvcHMgb2ZmIHRoZSBoZWxwZXIncyBwYXJhbWV0
ZXJzLCBpbnZva2VzIHRoZSBoZWxwZXIsCiAgICAvLyBhbmQgcHVzaGVzIHRoZSBoZWxwZXIncyBy
ZXR1cm4gdmFsdWUgb250byB0aGUgc3RhY2suCiAgICAvLwogICAgLy8gSWYgdGhlIGhlbHBlciBp
cyBub3QgZm91bmQsIGBoZWxwZXJNaXNzaW5nYCBpcyBjYWxsZWQuCiAgICBpbnZva2VIZWxwZXI6
IGZ1bmN0aW9uKHBhcmFtU2l6ZSwgbmFtZSkgewogICAgICB0aGlzLmNvbnRleHQuYWxpYXNlcy5o
ZWxwZXJNaXNzaW5nID0gJ2hlbHBlcnMuaGVscGVyTWlzc2luZyc7CgogICAgICB2YXIgaGVscGVy
ID0gdGhpcy5sYXN0SGVscGVyID0gdGhpcy5zZXR1cEhlbHBlcihwYXJhbVNpemUsIG5hbWUsIHRy
dWUpOwogICAgICB2YXIgbm9uSGVscGVyID0gdGhpcy5uYW1lTG9va3VwKCdkZXB0aCcgKyB0aGlz
Lmxhc3RDb250ZXh0LCBuYW1lLCAnY29udGV4dCcpOwoKICAgICAgdGhpcy5wdXNoKGhlbHBlci5u
YW1lICsgJyB8fCAnICsgbm9uSGVscGVyKTsKICAgICAgdGhpcy5yZXBsYWNlU3RhY2soZnVuY3Rp
b24obmFtZSkgewogICAgICAgIHJldHVybiBuYW1lICsgJyA/ICcgKyBuYW1lICsgJy5jYWxsKCcg
KwogICAgICAgICAgICBoZWxwZXIuY2FsbFBhcmFtcyArICIpICIgKyAiOiBoZWxwZXJNaXNzaW5n
LmNhbGwoIiArCiAgICAgICAgICAgIGhlbHBlci5oZWxwZXJNaXNzaW5nUGFyYW1zICsgIikiOwog
ICAgICB9KTsKICAgIH0sCgogICAgLy8gW2ludm9rZUtub3duSGVscGVyXQogICAgLy8KICAgIC8v
IE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0sIHBhcmFtcy4uLiwgLi4u
CiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJlc3VsdCBvZiBoZWxwZXIgaW52b2NhdGlvbgogICAg
Ly8KICAgIC8vIFRoaXMgb3BlcmF0aW9uIGlzIHVzZWQgd2hlbiB0aGUgaGVscGVyIGlzIGtub3du
IHRvIGV4aXN0LAogICAgLy8gc28gYSBgaGVscGVyTWlzc2luZ2AgZmFsbGJhY2sgaXMgbm90IHJl
cXVpcmVkLgogICAgaW52b2tlS25vd25IZWxwZXI6IGZ1bmN0aW9uKHBhcmFtU2l6ZSwgbmFtZSkg
ewogICAgICB2YXIgaGVscGVyID0gdGhpcy5zZXR1cEhlbHBlcihwYXJhbVNpemUsIG5hbWUpOwog
ICAgICB0aGlzLnB1c2goaGVscGVyLm5hbWUgKyAiLmNhbGwoIiArIGhlbHBlci5jYWxsUGFyYW1z
ICsgIikiKTsKICAgIH0sCgogICAgLy8gW2ludm9rZUFtYmlndW91c10KICAgIC8vCiAgICAvLyBP
biBzdGFjaywgYmVmb3JlOiBoYXNoLCBpbnZlcnNlLCBwcm9ncmFtLCBwYXJhbXMuLi4sIC4uLgog
ICAgLy8gT24gc3RhY2ssIGFmdGVyOiByZXN1bHQgb2YgZGlzYW1iaWd1YXRpb24KICAgIC8vCiAg
ICAvLyBUaGlzIG9wZXJhdGlvbiBpcyB1c2VkIHdoZW4gYW4gZXhwcmVzc2lvbiBsaWtlIGB7e2Zv
b319YAogICAgLy8gaXMgcHJvdmlkZWQsIGJ1dCB3ZSBkb24ndCBrbm93IGF0IGNvbXBpbGUtdGlt
ZSB3aGV0aGVyIGl0CiAgICAvLyBpcyBhIGhlbHBlciBvciBhIHBhdGguCiAgICAvLwogICAgLy8g
VGhpcyBvcGVyYXRpb24gZW1pdHMgbW9yZSBjb2RlIHRoYW4gdGhlIG90aGVyIG9wdGlvbnMsCiAg
ICAvLyBhbmQgY2FuIGJlIGF2b2lkZWQgYnkgcGFzc2luZyB0aGUgYGtub3duSGVscGVyc2AgYW5k
CiAgICAvLyBga25vd25IZWxwZXJzT25seWAgZmxhZ3MgYXQgY29tcGlsZS10aW1lLgogICAgaW52
b2tlQW1iaWd1b3VzOiBmdW5jdGlvbihuYW1lLCBoZWxwZXJDYWxsKSB7CiAgICAgIHRoaXMuY29u
dGV4dC5hbGlhc2VzLmZ1bmN0aW9uVHlwZSA9ICciZnVuY3Rpb24iJzsKCiAgICAgIHRoaXMucHVz
aFN0YWNrTGl0ZXJhbCgne30nKTsgICAgLy8gSGFzaCB2YWx1ZQogICAgICB2YXIgaGVscGVyID0g
dGhpcy5zZXR1cEhlbHBlcigwLCBuYW1lLCBoZWxwZXJDYWxsKTsKCiAgICAgIHZhciBoZWxwZXJO
YW1lID0gdGhpcy5sYXN0SGVscGVyID0gdGhpcy5uYW1lTG9va3VwKCdoZWxwZXJzJywgbmFtZSwg
J2hlbHBlcicpOwoKICAgICAgdmFyIG5vbkhlbHBlciA9IHRoaXMubmFtZUxvb2t1cCgnZGVwdGgn
ICsgdGhpcy5sYXN0Q29udGV4dCwgbmFtZSwgJ2NvbnRleHQnKTsKICAgICAgdmFyIG5leHRTdGFj
ayA9IHRoaXMubmV4dFN0YWNrKCk7CgogICAgICB0aGlzLnB1c2hTb3VyY2UoJ2lmICgnICsgbmV4
dFN0YWNrICsgJyA9ICcgKyBoZWxwZXJOYW1lICsgJykgeyAnICsgbmV4dFN0YWNrICsgJyA9ICcg
KyBuZXh0U3RhY2sgKyAnLmNhbGwoJyArIGhlbHBlci5jYWxsUGFyYW1zICsgJyk7IH0nKTsKICAg
ICAgdGhpcy5wdXNoU291cmNlKCdlbHNlIHsgJyArIG5leHRTdGFjayArICcgPSAnICsgbm9uSGVs
cGVyICsgJzsgJyArIG5leHRTdGFjayArICcgPSB0eXBlb2YgJyArIG5leHRTdGFjayArICcgPT09
IGZ1bmN0aW9uVHlwZSA/ICcgKyBuZXh0U3RhY2sgKyAnLmNhbGwoJyArIGhlbHBlci5jYWxsUGFy
YW1zICsgJykgOiAnICsgbmV4dFN0YWNrICsgJzsgfScpOwogICAgfSwKCiAgICAvLyBbaW52b2tl
UGFydGlhbF0KICAgIC8vCiAgICAvLyBPbiBzdGFjaywgYmVmb3JlOiBjb250ZXh0LCAuLi4KICAg
IC8vIE9uIHN0YWNrIGFmdGVyOiByZXN1bHQgb2YgcGFydGlhbCBpbnZvY2F0aW9uCiAgICAvLwog
ICAgLy8gVGhpcyBvcGVyYXRpb24gcG9wcyBvZmYgYSBjb250ZXh0LCBpbnZva2VzIGEgcGFydGlh
bCB3aXRoIHRoYXQgY29udGV4dCwKICAgIC8vIGFuZCBwdXNoZXMgdGhlIHJlc3VsdCBvZiB0aGUg
aW52b2NhdGlvbiBiYWNrLgogICAgaW52b2tlUGFydGlhbDogZnVuY3Rpb24obmFtZSkgewogICAg
ICB2YXIgcGFyYW1zID0gW3RoaXMubmFtZUxvb2t1cCgncGFydGlhbHMnLCBuYW1lLCAncGFydGlh
bCcpLCAiJyIgKyBuYW1lICsgIiciLCB0aGlzLnBvcFN0YWNrKCksICJoZWxwZXJzIiwgInBhcnRp
YWxzIl07CgogICAgICBpZiAodGhpcy5vcHRpb25zLmRhdGEpIHsKICAgICAgICBwYXJhbXMucHVz
aCgiZGF0YSIpOwogICAgICB9CgogICAgICB0aGlzLmNvbnRleHQuYWxpYXNlcy5zZWxmID0gInRo
aXMiOwogICAgICB0aGlzLnB1c2goInNlbGYuaW52b2tlUGFydGlhbCgiICsgcGFyYW1zLmpvaW4o
IiwgIikgKyAiKSIpOwogICAgfSwKCiAgICAvLyBbYXNzaWduVG9IYXNoXQogICAgLy8KICAgIC8v
IE9uIHN0YWNrLCBiZWZvcmU6IHZhbHVlLCBoYXNoLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRl
cjogaGFzaCwgLi4uCiAgICAvLwogICAgLy8gUG9wcyBhIHZhbHVlIGFuZCBoYXNoIG9mZiB0aGUg
c3RhY2ssIGFzc2lnbnMgYGhhc2hba2V5XSA9IHZhbHVlYAogICAgLy8gYW5kIHB1c2hlcyB0aGUg
aGFzaCBiYWNrIG9udG8gdGhlIHN0YWNrLgogICAgYXNzaWduVG9IYXNoOiBmdW5jdGlvbihrZXkp
IHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5wb3BTdGFjaygpLAogICAgICAgICAgY29udGV4dCwK
ICAgICAgICAgIHR5cGU7CgogICAgICBpZiAodGhpcy5vcHRpb25zLnN0cmluZ1BhcmFtcykgewog
ICAgICAgIHR5cGUgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgY29udGV4dCA9IHRoaXMucG9w
U3RhY2soKTsKICAgICAgfQoKICAgICAgdmFyIGhhc2ggPSB0aGlzLmhhc2g7CiAgICAgIGlmIChj
b250ZXh0KSB7CiAgICAgICAgaGFzaC5jb250ZXh0cy5wdXNoKCInIiArIGtleSArICInOiAiICsg
Y29udGV4dCk7CiAgICAgIH0KICAgICAgaWYgKHR5cGUpIHsKICAgICAgICBoYXNoLnR5cGVzLnB1
c2goIiciICsga2V5ICsgIic6ICIgKyB0eXBlKTsKICAgICAgfQogICAgICBoYXNoLnZhbHVlcy5w
dXNoKCInIiArIGtleSArICInOiAoIiArIHZhbHVlICsgIikiKTsKICAgIH0sCgogICAgLy8gSEVM
UEVSUwoKICAgIGNvbXBpbGVyOiBKYXZhU2NyaXB0Q29tcGlsZXIsCgogICAgY29tcGlsZUNoaWxk
cmVuOiBmdW5jdGlvbihlbnZpcm9ubWVudCwgb3B0aW9ucykgewogICAgICB2YXIgY2hpbGRyZW4g
PSBlbnZpcm9ubWVudC5jaGlsZHJlbiwgY2hpbGQsIGNvbXBpbGVyOwoKICAgICAgZm9yKHZhciBp
PTAsIGw9Y2hpbGRyZW4ubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIGNoaWxkID0gY2hpbGRy
ZW5baV07CiAgICAgICAgY29tcGlsZXIgPSBuZXcgdGhpcy5jb21waWxlcigpOwoKICAgICAgICB2
YXIgaW5kZXggPSB0aGlzLm1hdGNoRXhpc3RpbmdQcm9ncmFtKGNoaWxkKTsKCiAgICAgICAgaWYg
KGluZGV4ID09IG51bGwpIHsKICAgICAgICAgIHRoaXMuY29udGV4dC5wcm9ncmFtcy5wdXNoKCcn
KTsgICAgIC8vIFBsYWNlaG9sZGVyIHRvIHByZXZlbnQgbmFtZSBjb25mbGljdHMgZm9yIG5lc3Rl
ZCBjaGlsZHJlbgogICAgICAgICAgaW5kZXggPSB0aGlzLmNvbnRleHQucHJvZ3JhbXMubGVuZ3Ro
OwogICAgICAgICAgY2hpbGQuaW5kZXggPSBpbmRleDsKICAgICAgICAgIGNoaWxkLm5hbWUgPSAn
cHJvZ3JhbScgKyBpbmRleDsKICAgICAgICAgIHRoaXMuY29udGV4dC5wcm9ncmFtc1tpbmRleF0g
PSBjb21waWxlci5jb21waWxlKGNoaWxkLCBvcHRpb25zLCB0aGlzLmNvbnRleHQpOwogICAgICAg
ICAgdGhpcy5jb250ZXh0LmVudmlyb25tZW50c1tpbmRleF0gPSBjaGlsZDsKICAgICAgICB9IGVs
c2UgewogICAgICAgICAgY2hpbGQuaW5kZXggPSBpbmRleDsKICAgICAgICAgIGNoaWxkLm5hbWUg
PSAncHJvZ3JhbScgKyBpbmRleDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBtYXRjaEV4
aXN0aW5nUHJvZ3JhbTogZnVuY3Rpb24oY2hpbGQpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxl
biA9IHRoaXMuY29udGV4dC5lbnZpcm9ubWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAg
ICAgICB2YXIgZW52aXJvbm1lbnQgPSB0aGlzLmNvbnRleHQuZW52aXJvbm1lbnRzW2ldOwogICAg
ICAgIGlmIChlbnZpcm9ubWVudCAmJiBlbnZpcm9ubWVudC5lcXVhbHMoY2hpbGQpKSB7CiAgICAg
ICAgICByZXR1cm4gaTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgcHJvZ3JhbUV4cHJl
c3Npb246IGZ1bmN0aW9uKGd1aWQpIHsKICAgICAgdGhpcy5jb250ZXh0LmFsaWFzZXMuc2VsZiA9
ICJ0aGlzIjsKCiAgICAgIGlmKGd1aWQgPT0gbnVsbCkgewogICAgICAgIHJldHVybiAic2VsZi5u
b29wIjsKICAgICAgfQoKICAgICAgdmFyIGNoaWxkID0gdGhpcy5lbnZpcm9ubWVudC5jaGlsZHJl
bltndWlkXSwKICAgICAgICAgIGRlcHRocyA9IGNoaWxkLmRlcHRocy5saXN0LCBkZXB0aDsKCiAg
ICAgIHZhciBwcm9ncmFtUGFyYW1zID0gW2NoaWxkLmluZGV4LCBjaGlsZC5uYW1lLCAiZGF0YSJd
OwoKICAgICAgZm9yKHZhciBpPTAsIGwgPSBkZXB0aHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAg
ICAgIGRlcHRoID0gZGVwdGhzW2ldOwoKICAgICAgICBpZihkZXB0aCA9PT0gMSkgeyBwcm9ncmFt
UGFyYW1zLnB1c2goImRlcHRoMCIpOyB9CiAgICAgICAgZWxzZSB7IHByb2dyYW1QYXJhbXMucHVz
aCgiZGVwdGgiICsgKGRlcHRoIC0gMSkpOyB9CiAgICAgIH0KCiAgICAgIHJldHVybiAoZGVwdGhz
Lmxlbmd0aCA9PT0gMCA/ICJzZWxmLnByb2dyYW0oIiA6ICJzZWxmLnByb2dyYW1XaXRoRGVwdGgo
IikgKyBwcm9ncmFtUGFyYW1zLmpvaW4oIiwgIikgKyAiKSI7CiAgICB9LAoKICAgIHJlZ2lzdGVy
OiBmdW5jdGlvbihuYW1lLCB2YWwpIHsKICAgICAgdGhpcy51c2VSZWdpc3RlcihuYW1lKTsKICAg
ICAgdGhpcy5wdXNoU291cmNlKG5hbWUgKyAiID0gIiArIHZhbCArICI7Iik7CiAgICB9LAoKICAg
IHVzZVJlZ2lzdGVyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmKCF0aGlzLnJlZ2lzdGVyc1tu
YW1lXSkgewogICAgICAgIHRoaXMucmVnaXN0ZXJzW25hbWVdID0gdHJ1ZTsKICAgICAgICB0aGlz
LnJlZ2lzdGVycy5saXN0LnB1c2gobmFtZSk7CiAgICAgIH0KICAgIH0sCgogICAgcHVzaFN0YWNr
TGl0ZXJhbDogZnVuY3Rpb24oaXRlbSkgewogICAgICByZXR1cm4gdGhpcy5wdXNoKG5ldyBMaXRl
cmFsKGl0ZW0pKTsKICAgIH0sCgogICAgcHVzaFNvdXJjZTogZnVuY3Rpb24oc291cmNlKSB7CiAg
ICAgIGlmICh0aGlzLnBlbmRpbmdDb250ZW50KSB7CiAgICAgICAgdGhpcy5zb3VyY2UucHVzaCh0
aGlzLmFwcGVuZFRvQnVmZmVyKHRoaXMucXVvdGVkU3RyaW5nKHRoaXMucGVuZGluZ0NvbnRlbnQp
KSk7CiAgICAgICAgdGhpcy5wZW5kaW5nQ29udGVudCA9IHVuZGVmaW5lZDsKICAgICAgfQoKICAg
ICAgaWYgKHNvdXJjZSkgewogICAgICAgIHRoaXMuc291cmNlLnB1c2goc291cmNlKTsKICAgICAg
fQogICAgfSwKCiAgICBwdXNoU3RhY2s6IGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5mbHVz
aElubGluZSgpOwoKICAgICAgdmFyIHN0YWNrID0gdGhpcy5pbmNyU3RhY2soKTsKICAgICAgaWYg
KGl0ZW0pIHsKICAgICAgICB0aGlzLnB1c2hTb3VyY2Uoc3RhY2sgKyAiID0gIiArIGl0ZW0gKyAi
OyIpOwogICAgICB9CiAgICAgIHRoaXMuY29tcGlsZVN0YWNrLnB1c2goc3RhY2spOwogICAgICBy
ZXR1cm4gc3RhY2s7CiAgICB9LAoKICAgIHJlcGxhY2VTdGFjazogZnVuY3Rpb24oY2FsbGJhY2sp
IHsKICAgICAgdmFyIHByZWZpeCA9ICcnLAogICAgICAgICAgaW5saW5lID0gdGhpcy5pc0lubGlu
ZSgpLAogICAgICAgICAgc3RhY2s7CgogICAgICAvLyBJZiB3ZSBhcmUgY3VycmVudGx5IGlubGlu
ZSB0aGVuIHdlIHdhbnQgdG8gbWVyZ2UgdGhlIGlubGluZSBzdGF0ZW1lbnQgaW50byB0aGUKICAg
ICAgLy8gcmVwbGFjZW1lbnQgc3RhdGVtZW50IHZpYSAnLCcKICAgICAgaWYgKGlubGluZSkgewog
ICAgICAgIHZhciB0b3AgPSB0aGlzLnBvcFN0YWNrKHRydWUpOwoKICAgICAgICBpZiAodG9wIGlu
c3RhbmNlb2YgTGl0ZXJhbCkgewogICAgICAgICAgLy8gTGl0ZXJhbHMgZG8gbm90IG5lZWQgdG8g
YmUgaW5saW5lZAogICAgICAgICAgc3RhY2sgPSB0b3AudmFsdWU7CiAgICAgICAgfSBlbHNlIHsK
ICAgICAgICAgIC8vIEdldCBvciBjcmVhdGUgdGhlIGN1cnJlbnQgc3RhY2sgbmFtZSBmb3IgdXNl
IGJ5IHRoZSBpbmxpbmUKICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5zdGFja1Nsb3QgPyB0aGlz
LnRvcFN0YWNrTmFtZSgpIDogdGhpcy5pbmNyU3RhY2soKTsKCiAgICAgICAgICBwcmVmaXggPSAn
KCcgKyB0aGlzLnB1c2gobmFtZSkgKyAnID0gJyArIHRvcCArICcpLCc7CiAgICAgICAgICBzdGFj
ayA9IHRoaXMudG9wU3RhY2soKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3Rh
Y2sgPSB0aGlzLnRvcFN0YWNrKCk7CiAgICAgIH0KCiAgICAgIHZhciBpdGVtID0gY2FsbGJhY2su
Y2FsbCh0aGlzLCBzdGFjayk7CgogICAgICBpZiAoaW5saW5lKSB7CiAgICAgICAgaWYgKHRoaXMu
aW5saW5lU3RhY2subGVuZ3RoIHx8IHRoaXMuY29tcGlsZVN0YWNrLmxlbmd0aCkgewogICAgICAg
ICAgdGhpcy5wb3BTdGFjaygpOwogICAgICAgIH0KICAgICAgICB0aGlzLnB1c2goJygnICsgcHJl
Zml4ICsgaXRlbSArICcpJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gUHJldmVudCBtb2Rp
ZmljYXRpb24gb2YgdGhlIGNvbnRleHQgZGVwdGggdmFyaWFibGUuIFRocm91Z2ggcmVwbGFjZVN0
YWNrCiAgICAgICAgaWYgKCEvXnN0YWNrLy50ZXN0KHN0YWNrKSkgewogICAgICAgICAgc3RhY2sg
PSB0aGlzLm5leHRTdGFjaygpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wdXNoU291cmNlKHN0
YWNrICsgIiA9ICgiICsgcHJlZml4ICsgaXRlbSArICIpOyIpOwogICAgICB9CiAgICAgIHJldHVy
biBzdGFjazsKICAgIH0sCgogICAgbmV4dFN0YWNrOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJu
IHRoaXMucHVzaFN0YWNrKCk7CiAgICB9LAoKICAgIGluY3JTdGFjazogZnVuY3Rpb24oKSB7CiAg
ICAgIHRoaXMuc3RhY2tTbG90Kys7CiAgICAgIGlmKHRoaXMuc3RhY2tTbG90ID4gdGhpcy5zdGFj
a1ZhcnMubGVuZ3RoKSB7IHRoaXMuc3RhY2tWYXJzLnB1c2goInN0YWNrIiArIHRoaXMuc3RhY2tT
bG90KTsgfQogICAgICByZXR1cm4gdGhpcy50b3BTdGFja05hbWUoKTsKICAgIH0sCiAgICB0b3BT
dGFja05hbWU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gInN0YWNrIiArIHRoaXMuc3RhY2tT
bG90OwogICAgfSwKICAgIGZsdXNoSW5saW5lOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGlubGlu
ZVN0YWNrID0gdGhpcy5pbmxpbmVTdGFjazsKICAgICAgaWYgKGlubGluZVN0YWNrLmxlbmd0aCkg
ewogICAgICAgIHRoaXMuaW5saW5lU3RhY2sgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwg
bGVuID0gaW5saW5lU3RhY2subGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBl
bnRyeSA9IGlubGluZVN0YWNrW2ldOwogICAgICAgICAgaWYgKGVudHJ5IGluc3RhbmNlb2YgTGl0
ZXJhbCkgewogICAgICAgICAgICB0aGlzLmNvbXBpbGVTdGFjay5wdXNoKGVudHJ5KTsKICAgICAg
ICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucHVzaFN0YWNrKGVudHJ5KTsKICAgICAgICAg
IH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpc0lubGluZTogZnVuY3Rpb24oKSB7CiAg
ICAgIHJldHVybiB0aGlzLmlubGluZVN0YWNrLmxlbmd0aDsKICAgIH0sCgogICAgcG9wU3RhY2s6
IGZ1bmN0aW9uKHdyYXBwZWQpIHsKICAgICAgdmFyIGlubGluZSA9IHRoaXMuaXNJbmxpbmUoKSwK
ICAgICAgICAgIGl0ZW0gPSAoaW5saW5lID8gdGhpcy5pbmxpbmVTdGFjayA6IHRoaXMuY29tcGls
ZVN0YWNrKS5wb3AoKTsKCiAgICAgIGlmICghd3JhcHBlZCAmJiAoaXRlbSBpbnN0YW5jZW9mIExp
dGVyYWwpKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAg
ICAgaWYgKCFpbmxpbmUpIHsKICAgICAgICAgIHRoaXMuc3RhY2tTbG90LS07CiAgICAgICAgfQog
ICAgICAgIHJldHVybiBpdGVtOwogICAgICB9CiAgICB9LAoKICAgIHRvcFN0YWNrOiBmdW5jdGlv
bih3cmFwcGVkKSB7CiAgICAgIHZhciBzdGFjayA9ICh0aGlzLmlzSW5saW5lKCkgPyB0aGlzLmlu
bGluZVN0YWNrIDogdGhpcy5jb21waWxlU3RhY2spLAogICAgICAgICAgaXRlbSA9IHN0YWNrW3N0
YWNrLmxlbmd0aCAtIDFdOwoKICAgICAgaWYgKCF3cmFwcGVkICYmIChpdGVtIGluc3RhbmNlb2Yg
TGl0ZXJhbCkpIHsKICAgICAgICByZXR1cm4gaXRlbS52YWx1ZTsKICAgICAgfSBlbHNlIHsKICAg
ICAgICByZXR1cm4gaXRlbTsKICAgICAgfQogICAgfSwKCiAgICBxdW90ZWRTdHJpbmc6IGZ1bmN0
aW9uKHN0cikgewogICAgICByZXR1cm4gJyInICsgc3RyCiAgICAgICAgLnJlcGxhY2UoL1xcL2cs
ICdcXFxcJykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnXFwiJykKICAgICAgICAucmVwbGFjZSgv
XG4vZywgJ1xcbicpCiAgICAgICAgLnJlcGxhY2UoL1xyL2csICdcXHInKQogICAgICAgIC5yZXBs
YWNlKC9cdTIwMjgvZywgJ1xcdTIwMjgnKSAgIC8vIFBlciBFY21hLTI2MiA3LjMgKyA3LjguNAog
ICAgICAgIC5yZXBsYWNlKC9cdTIwMjkvZywgJ1xcdTIwMjknKSArICciJzsKICAgIH0sCgogICAg
c2V0dXBIZWxwZXI6IGZ1bmN0aW9uKHBhcmFtU2l6ZSwgbmFtZSwgbWlzc2luZ1BhcmFtcykgewog
ICAgICB2YXIgcGFyYW1zID0gW107CiAgICAgIHRoaXMuc2V0dXBQYXJhbXMocGFyYW1TaXplLCBw
YXJhbXMsIG1pc3NpbmdQYXJhbXMpOwogICAgICB2YXIgZm91bmRIZWxwZXIgPSB0aGlzLm5hbWVM
b29rdXAoJ2hlbHBlcnMnLCBuYW1lLCAnaGVscGVyJyk7CgogICAgICByZXR1cm4gewogICAgICAg
IHBhcmFtczogcGFyYW1zLAogICAgICAgIG5hbWU6IGZvdW5kSGVscGVyLAogICAgICAgIGNhbGxQ
YXJhbXM6IFsiZGVwdGgwIl0uY29uY2F0KHBhcmFtcykuam9pbigiLCAiKSwKICAgICAgICBoZWxw
ZXJNaXNzaW5nUGFyYW1zOiBtaXNzaW5nUGFyYW1zICYmIFsiZGVwdGgwIiwgdGhpcy5xdW90ZWRT
dHJpbmcobmFtZSldLmNvbmNhdChwYXJhbXMpLmpvaW4oIiwgIikKICAgICAgfTsKICAgIH0sCgog
ICAgLy8gdGhlIHBhcmFtcyBhbmQgY29udGV4dHMgYXJndW1lbnRzIGFyZSBwYXNzZWQgaW4gYXJy
YXlzCiAgICAvLyB0byBmaWxsIGluCiAgICBzZXR1cFBhcmFtczogZnVuY3Rpb24ocGFyYW1TaXpl
LCBwYXJhbXMsIHVzZVJlZ2lzdGVyKSB7CiAgICAgIHZhciBvcHRpb25zID0gW10sIGNvbnRleHRz
ID0gW10sIHR5cGVzID0gW10sIHBhcmFtLCBpbnZlcnNlLCBwcm9ncmFtOwoKICAgICAgb3B0aW9u
cy5wdXNoKCJoYXNoOiIgKyB0aGlzLnBvcFN0YWNrKCkpOwoKICAgICAgaW52ZXJzZSA9IHRoaXMu
cG9wU3RhY2soKTsKICAgICAgcHJvZ3JhbSA9IHRoaXMucG9wU3RhY2soKTsKCiAgICAgIC8vIEF2
b2lkIHNldHRpbmcgZm4gYW5kIGludmVyc2UgaWYgbmVpdGhlciBhcmUgc2V0LiBUaGlzIGFsbG93
cwogICAgICAvLyBoZWxwZXJzIHRvIGRvIGEgY2hlY2sgZm9yIGBpZiAob3B0aW9ucy5mbilgCiAg
ICAgIGlmIChwcm9ncmFtIHx8IGludmVyc2UpIHsKICAgICAgICBpZiAoIXByb2dyYW0pIHsKICAg
ICAgICAgIHRoaXMuY29udGV4dC5hbGlhc2VzLnNlbGYgPSAidGhpcyI7CiAgICAgICAgICBwcm9n
cmFtID0gInNlbGYubm9vcCI7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWludmVyc2UpIHsKICAg
ICAgICAgdGhpcy5jb250ZXh0LmFsaWFzZXMuc2VsZiA9ICJ0aGlzIjsKICAgICAgICAgIGludmVy
c2UgPSAic2VsZi5ub29wIjsKICAgICAgICB9CgogICAgICAgIG9wdGlvbnMucHVzaCgiaW52ZXJz
ZToiICsgaW52ZXJzZSk7CiAgICAgICAgb3B0aW9ucy5wdXNoKCJmbjoiICsgcHJvZ3JhbSk7CiAg
ICAgIH0KCiAgICAgIGZvcih2YXIgaT0wOyBpPHBhcmFtU2l6ZTsgaSsrKSB7CiAgICAgICAgcGFy
YW0gPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgcGFyYW1zLnB1c2gocGFyYW0pOwoKICAgICAg
ICBpZih0aGlzLm9wdGlvbnMuc3RyaW5nUGFyYW1zKSB7CiAgICAgICAgICB0eXBlcy5wdXNoKHRo
aXMucG9wU3RhY2soKSk7CiAgICAgICAgICBjb250ZXh0cy5wdXNoKHRoaXMucG9wU3RhY2soKSk7
CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5vcHRpb25zLnN0cmluZ1BhcmFtcykg
ewogICAgICAgIG9wdGlvbnMucHVzaCgiY29udGV4dHM6WyIgKyBjb250ZXh0cy5qb2luKCIsIikg
KyAiXSIpOwogICAgICAgIG9wdGlvbnMucHVzaCgidHlwZXM6WyIgKyB0eXBlcy5qb2luKCIsIikg
KyAiXSIpOwogICAgICAgIG9wdGlvbnMucHVzaCgiaGFzaENvbnRleHRzOmhhc2hDb250ZXh0cyIp
OwogICAgICAgIG9wdGlvbnMucHVzaCgiaGFzaFR5cGVzOmhhc2hUeXBlcyIpOwogICAgICB9Cgog
ICAgICBpZih0aGlzLm9wdGlvbnMuZGF0YSkgewogICAgICAgIG9wdGlvbnMucHVzaCgiZGF0YTpk
YXRhIik7CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSAieyIgKyBvcHRpb25zLmpvaW4oIiwiKSAr
ICJ9IjsKICAgICAgaWYgKHVzZVJlZ2lzdGVyKSB7CiAgICAgICAgdGhpcy5yZWdpc3Rlcignb3B0
aW9ucycsIG9wdGlvbnMpOwogICAgICAgIHBhcmFtcy5wdXNoKCdvcHRpb25zJyk7CiAgICAgIH0g
ZWxzZSB7CiAgICAgICAgcGFyYW1zLnB1c2gob3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJu
IHBhcmFtcy5qb2luKCIsICIpOwogICAgfQogIH07CgogIHZhciByZXNlcnZlZFdvcmRzID0gKAog
ICAgImJyZWFrIGVsc2UgbmV3IHZhciIgKwogICAgIiBjYXNlIGZpbmFsbHkgcmV0dXJuIHZvaWQi
ICsKICAgICIgY2F0Y2ggZm9yIHN3aXRjaCB3aGlsZSIgKwogICAgIiBjb250aW51ZSBmdW5jdGlv
biB0aGlzIHdpdGgiICsKICAgICIgZGVmYXVsdCBpZiB0aHJvdyIgKwogICAgIiBkZWxldGUgaW4g
dHJ5IiArCiAgICAiIGRvIGluc3RhbmNlb2YgdHlwZW9mIiArCiAgICAiIGFic3RyYWN0IGVudW0g
aW50IHNob3J0IiArCiAgICAiIGJvb2xlYW4gZXhwb3J0IGludGVyZmFjZSBzdGF0aWMiICsKICAg
ICIgYnl0ZSBleHRlbmRzIGxvbmcgc3VwZXIiICsKICAgICIgY2hhciBmaW5hbCBuYXRpdmUgc3lu
Y2hyb25pemVkIiArCiAgICAiIGNsYXNzIGZsb2F0IHBhY2thZ2UgdGhyb3dzIiArCiAgICAiIGNv
bnN0IGdvdG8gcHJpdmF0ZSB0cmFuc2llbnQiICsKICAgICIgZGVidWdnZXIgaW1wbGVtZW50cyBw
cm90ZWN0ZWQgdm9sYXRpbGUiICsKICAgICIgZG91YmxlIGltcG9ydCBwdWJsaWMgbGV0IHlpZWxk
IgogICkuc3BsaXQoIiAiKTsKCiAgdmFyIGNvbXBpbGVyV29yZHMgPSBKYXZhU2NyaXB0Q29tcGls
ZXIuUkVTRVJWRURfV09SRFMgPSB7fTsKCiAgZm9yKHZhciBpPTAsIGw9cmVzZXJ2ZWRXb3Jkcy5s
ZW5ndGg7IGk8bDsgaSsrKSB7CiAgICBjb21waWxlcldvcmRzW3Jlc2VydmVkV29yZHNbaV1dID0g
dHJ1ZTsKICB9CgogIEphdmFTY3JpcHRDb21waWxlci5pc1ZhbGlkSmF2YVNjcmlwdFZhcmlhYmxl
TmFtZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmKCFKYXZhU2NyaXB0Q29tcGlsZXIuUkVTRVJW
RURfV09SRFNbbmFtZV0gJiYgL15bYS16QS1aXyRdWzAtOWEtekEtWl8kXSokLy50ZXN0KG5hbWUp
KSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIF9f
ZXhwb3J0c19fID0gSmF2YVNjcmlwdENvbXBpbGVyOwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSko
X19tb2R1bGUyX18pOwoKLy8gaGFuZGxlYmFycy9jb21waWxlci9jb21waWxlci5qcwp2YXIgX19t
b2R1bGUxMF9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBf
X2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIg
X19leHBvcnRzX18gPSB7fTsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5MV9fOwogIHZh
ciBwYXJzZSA9IF9fZGVwZW5kZW5jeTJfXy5wYXJzZTsKICB2YXIgSmF2YVNjcmlwdENvbXBpbGVy
ID0gX19kZXBlbmRlbmN5M19fOwogIHZhciBBU1QgPSBfX2RlcGVuZGVuY3k0X187CgogIGZ1bmN0
aW9uIENvbXBpbGVyKCkge30KCiAgX19leHBvcnRzX18uQ29tcGlsZXIgPSBDb21waWxlcjsvLyB0
aGUgZm91bmRIZWxwZXIgcmVnaXN0ZXIgd2lsbCBkaXNhbWJpZ3VhdGUgaGVscGVyIGxvb2t1cCBm
cm9tIGZpbmRpbmcgYQogIC8vIGZ1bmN0aW9uIGluIGEgY29udGV4dC4gVGhpcyBpcyBuZWNlc3Nh
cnkgZm9yIG11c3RhY2hlIGNvbXBhdGliaWxpdHksIHdoaWNoCiAgLy8gcmVxdWlyZXMgdGhhdCBj
b250ZXh0IGZ1bmN0aW9ucyBpbiBibG9ja3MgYXJlIGV2YWx1YXRlZCBieSBibG9ja0hlbHBlck1p
c3NpbmcsCiAgLy8gYW5kIHRoZW4gcHJvY2VlZCBhcyBpZiB0aGUgcmVzdWx0aW5nIHZhbHVlIHdh
cyBwcm92aWRlZCB0byBibG9ja0hlbHBlck1pc3NpbmcuCgogIENvbXBpbGVyLnByb3RvdHlwZSA9
IHsKICAgIGNvbXBpbGVyOiBDb21waWxlciwKCiAgICBkaXNhc3NlbWJsZTogZnVuY3Rpb24oKSB7
CiAgICAgIHZhciBvcGNvZGVzID0gdGhpcy5vcGNvZGVzLCBvcGNvZGUsIG91dCA9IFtdLCBwYXJh
bXMsIHBhcmFtOwoKICAgICAgZm9yICh2YXIgaT0wLCBsPW9wY29kZXMubGVuZ3RoOyBpPGw7IGkr
KykgewogICAgICAgIG9wY29kZSA9IG9wY29kZXNbaV07CgogICAgICAgIGlmIChvcGNvZGUub3Bj
b2RlID09PSAnREVDTEFSRScpIHsKICAgICAgICAgIG91dC5wdXNoKCJERUNMQVJFICIgKyBvcGNv
ZGUubmFtZSArICI9IiArIG9wY29kZS52YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg
IHBhcmFtcyA9IFtdOwogICAgICAgICAgZm9yICh2YXIgaj0wOyBqPG9wY29kZS5hcmdzLmxlbmd0
aDsgaisrKSB7CiAgICAgICAgICAgIHBhcmFtID0gb3Bjb2RlLmFyZ3Nbal07CiAgICAgICAgICAg
IGlmICh0eXBlb2YgcGFyYW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcGFyYW0gPSAi
XCIiICsgcGFyYW0ucmVwbGFjZSgiXG4iLCAiXFxuIikgKyAiXCIiOwogICAgICAgICAgICB9CiAg
ICAgICAgICAgIHBhcmFtcy5wdXNoKHBhcmFtKTsKICAgICAgICAgIH0KICAgICAgICAgIG91dC5w
dXNoKG9wY29kZS5vcGNvZGUgKyAiICIgKyBwYXJhbXMuam9pbigiICIpKTsKICAgICAgICB9CiAg
ICAgIH0KCiAgICAgIHJldHVybiBvdXQuam9pbigiXG4iKTsKICAgIH0sCgogICAgZXF1YWxzOiBm
dW5jdGlvbihvdGhlcikgewogICAgICB2YXIgbGVuID0gdGhpcy5vcGNvZGVzLmxlbmd0aDsKICAg
ICAgaWYgKG90aGVyLm9wY29kZXMubGVuZ3RoICE9PSBsZW4pIHsKICAgICAgICByZXR1cm4gZmFs
c2U7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAg
ICB2YXIgb3Bjb2RlID0gdGhpcy5vcGNvZGVzW2ldLAogICAgICAgICAgICBvdGhlck9wY29kZSA9
IG90aGVyLm9wY29kZXNbaV07CiAgICAgICAgaWYgKG9wY29kZS5vcGNvZGUgIT09IG90aGVyT3Bj
b2RlLm9wY29kZSB8fCBvcGNvZGUuYXJncy5sZW5ndGggIT09IG90aGVyT3Bjb2RlLmFyZ3MubGVu
Z3RoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZvciAodmFy
IGogPSAwOyBqIDwgb3Bjb2RlLmFyZ3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChvcGNv
ZGUuYXJnc1tqXSAhPT0gb3RoZXJPcGNvZGUuYXJnc1tqXSkgewogICAgICAgICAgICByZXR1cm4g
ZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBsZW4gPSB0aGlzLmNo
aWxkcmVuLmxlbmd0aDsKICAgICAgaWYgKG90aGVyLmNoaWxkcmVuLmxlbmd0aCAhPT0gbGVuKSB7
CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47
IGkrKykgewogICAgICAgIGlmICghdGhpcy5jaGlsZHJlbltpXS5lcXVhbHMob3RoZXIuY2hpbGRy
ZW5baV0pKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAg
ICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgZ3VpZDogMCwKCiAgICBjb21waWxlOiBmdW5jdGlv
bihwcm9ncmFtLCBvcHRpb25zKSB7CiAgICAgIHRoaXMub3Bjb2RlcyA9IFtdOwogICAgICB0aGlz
LmNoaWxkcmVuID0gW107CiAgICAgIHRoaXMuZGVwdGhzID0ge2xpc3Q6IFtdfTsKICAgICAgdGhp
cy5vcHRpb25zID0gb3B0aW9uczsKCiAgICAgIC8vIFRoZXNlIGNoYW5nZXMgd2lsbCBwcm9wYWdh
dGUgdG8gdGhlIG90aGVyIGNvbXBpbGVyIGNvbXBvbmVudHMKICAgICAgdmFyIGtub3duSGVscGVy
cyA9IHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnM7CiAgICAgIHRoaXMub3B0aW9ucy5rbm93bkhl
bHBlcnMgPSB7CiAgICAgICAgJ2hlbHBlck1pc3NpbmcnOiB0cnVlLAogICAgICAgICdibG9ja0hl
bHBlck1pc3NpbmcnOiB0cnVlLAogICAgICAgICdlYWNoJzogdHJ1ZSwKICAgICAgICAnaWYnOiB0
cnVlLAogICAgICAgICd1bmxlc3MnOiB0cnVlLAogICAgICAgICd3aXRoJzogdHJ1ZSwKICAgICAg
ICAnbG9nJzogdHJ1ZQogICAgICB9OwogICAgICBpZiAoa25vd25IZWxwZXJzKSB7CiAgICAgICAg
Zm9yICh2YXIgbmFtZSBpbiBrbm93bkhlbHBlcnMpIHsKICAgICAgICAgIHRoaXMub3B0aW9ucy5r
bm93bkhlbHBlcnNbbmFtZV0gPSBrbm93bkhlbHBlcnNbbmFtZV07CiAgICAgICAgfQogICAgICB9
CgogICAgICByZXR1cm4gdGhpcy5hY2NlcHQocHJvZ3JhbSk7CiAgICB9LAoKICAgIGFjY2VwdDog
ZnVuY3Rpb24obm9kZSkgewogICAgICB2YXIgc3RyaXAgPSBub2RlLnN0cmlwIHx8IHt9LAogICAg
ICAgICAgcmV0OwogICAgICBpZiAoc3RyaXAubGVmdCkgewogICAgICAgIHRoaXMub3Bjb2RlKCdz
dHJpcCcpOwogICAgICB9CgogICAgICByZXQgPSB0aGlzW25vZGUudHlwZV0obm9kZSk7CgogICAg
ICBpZiAoc3RyaXAucmlnaHQpIHsKICAgICAgICB0aGlzLm9wY29kZSgnc3RyaXAnKTsKICAgICAg
fQoKICAgICAgcmV0dXJuIHJldDsKICAgIH0sCgogICAgcHJvZ3JhbTogZnVuY3Rpb24ocHJvZ3Jh
bSkgewogICAgICB2YXIgc3RhdGVtZW50cyA9IHByb2dyYW0uc3RhdGVtZW50czsKCiAgICAgIGZv
cih2YXIgaT0wLCBsPXN0YXRlbWVudHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIHRoaXMu
YWNjZXB0KHN0YXRlbWVudHNbaV0pOwogICAgICB9CiAgICAgIHRoaXMuaXNTaW1wbGUgPSBsID09
PSAxOwoKICAgICAgdGhpcy5kZXB0aHMubGlzdCA9IHRoaXMuZGVwdGhzLmxpc3Quc29ydChmdW5j
dGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICB9KTsKCiAgICAgIHJldHVy
biB0aGlzOwogICAgfSwKCiAgICBjb21waWxlUHJvZ3JhbTogZnVuY3Rpb24ocHJvZ3JhbSkgewog
ICAgICB2YXIgcmVzdWx0ID0gbmV3IHRoaXMuY29tcGlsZXIoKS5jb21waWxlKHByb2dyYW0sIHRo
aXMub3B0aW9ucyk7CiAgICAgIHZhciBndWlkID0gdGhpcy5ndWlkKyssIGRlcHRoOwoKICAgICAg
dGhpcy51c2VQYXJ0aWFsID0gdGhpcy51c2VQYXJ0aWFsIHx8IHJlc3VsdC51c2VQYXJ0aWFsOwoK
ICAgICAgdGhpcy5jaGlsZHJlbltndWlkXSA9IHJlc3VsdDsKCiAgICAgIGZvcih2YXIgaT0wLCBs
PXJlc3VsdC5kZXB0aHMubGlzdC5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgZGVwdGggPSBy
ZXN1bHQuZGVwdGhzLmxpc3RbaV07CgogICAgICAgIGlmKGRlcHRoIDwgMikgeyBjb250aW51ZTsg
fQogICAgICAgIGVsc2UgeyB0aGlzLmFkZERlcHRoKGRlcHRoIC0gMSk7IH0KICAgICAgfQoKICAg
ICAgcmV0dXJuIGd1aWQ7CiAgICB9LAoKICAgIGJsb2NrOiBmdW5jdGlvbihibG9jaykgewogICAg
ICB2YXIgbXVzdGFjaGUgPSBibG9jay5tdXN0YWNoZSwKICAgICAgICAgIHByb2dyYW0gPSBibG9j
ay5wcm9ncmFtLAogICAgICAgICAgaW52ZXJzZSA9IGJsb2NrLmludmVyc2U7CgogICAgICBpZiAo
cHJvZ3JhbSkgewogICAgICAgIHByb2dyYW0gPSB0aGlzLmNvbXBpbGVQcm9ncmFtKHByb2dyYW0p
OwogICAgICB9CgogICAgICBpZiAoaW52ZXJzZSkgewogICAgICAgIGludmVyc2UgPSB0aGlzLmNv
bXBpbGVQcm9ncmFtKGludmVyc2UpOwogICAgICB9CgogICAgICB2YXIgdHlwZSA9IHRoaXMuY2xh
c3NpZnlNdXN0YWNoZShtdXN0YWNoZSk7CgogICAgICBpZiAodHlwZSA9PT0gImhlbHBlciIpIHsK
ICAgICAgICB0aGlzLmhlbHBlck11c3RhY2hlKG11c3RhY2hlLCBwcm9ncmFtLCBpbnZlcnNlKTsK
ICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAic2ltcGxlIikgewogICAgICAgIHRoaXMuc2ltcGxl
TXVzdGFjaGUobXVzdGFjaGUpOwoKICAgICAgICAvLyBub3cgdGhhdCB0aGUgc2ltcGxlIG11c3Rh
Y2hlIGlzIHJlc29sdmVkLCB3ZSBuZWVkIHRvCiAgICAgICAgLy8gZXZhbHVhdGUgaXQgYnkgZXhl
Y3V0aW5nIGBibG9ja0hlbHBlck1pc3NpbmdgCiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9n
cmFtJywgcHJvZ3JhbSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgaW52ZXJz
ZSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2VtcHR5SGFzaCcpOwogICAgICAgIHRoaXMub3Bjb2Rl
KCdibG9ja1ZhbHVlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hbWJpZ3VvdXNNdXN0
YWNoZShtdXN0YWNoZSwgcHJvZ3JhbSwgaW52ZXJzZSk7CgogICAgICAgIC8vIG5vdyB0aGF0IHRo
ZSBzaW1wbGUgbXVzdGFjaGUgaXMgcmVzb2x2ZWQsIHdlIG5lZWQgdG8KICAgICAgICAvLyBldmFs
dWF0ZSBpdCBieSBleGVjdXRpbmcgYGJsb2NrSGVscGVyTWlzc2luZ2AKICAgICAgICB0aGlzLm9w
Y29kZSgncHVzaFByb2dyYW0nLCBwcm9ncmFtKTsKICAgICAgICB0aGlzLm9wY29kZSgncHVzaFBy
b2dyYW0nLCBpbnZlcnNlKTsKICAgICAgICB0aGlzLm9wY29kZSgnZW1wdHlIYXNoJyk7CiAgICAg
ICAgdGhpcy5vcGNvZGUoJ2FtYmlndW91c0Jsb2NrVmFsdWUnKTsKICAgICAgfQoKICAgICAgdGhp
cy5vcGNvZGUoJ2FwcGVuZCcpOwogICAgfSwKCiAgICBoYXNoOiBmdW5jdGlvbihoYXNoKSB7CiAg
ICAgIHZhciBwYWlycyA9IGhhc2gucGFpcnMsIHBhaXIsIHZhbDsKCiAgICAgIHRoaXMub3Bjb2Rl
KCdwdXNoSGFzaCcpOwoKICAgICAgZm9yKHZhciBpPTAsIGw9cGFpcnMubGVuZ3RoOyBpPGw7IGkr
KykgewogICAgICAgIHBhaXIgPSBwYWlyc1tpXTsKICAgICAgICB2YWwgID0gcGFpclsxXTsKCiAg
ICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICAgIGlmKHZhbC5k
ZXB0aCkgewogICAgICAgICAgICB0aGlzLmFkZERlcHRoKHZhbC5kZXB0aCk7CiAgICAgICAgICB9
CiAgICAgICAgICB0aGlzLm9wY29kZSgnZ2V0Q29udGV4dCcsIHZhbC5kZXB0aCB8fCAwKTsKICAg
ICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoU3RyaW5nUGFyYW0nLCB2YWwuc3RyaW5nTW9kZVZhbHVl
LCB2YWwudHlwZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYWNjZXB0KHZhbCk7
CiAgICAgICAgfQoKICAgICAgICB0aGlzLm9wY29kZSgnYXNzaWduVG9IYXNoJywgcGFpclswXSk7
CiAgICAgIH0KICAgICAgdGhpcy5vcGNvZGUoJ3BvcEhhc2gnKTsKICAgIH0sCgogICAgcGFydGlh
bDogZnVuY3Rpb24ocGFydGlhbCkgewogICAgICB2YXIgcGFydGlhbE5hbWUgPSBwYXJ0aWFsLnBh
cnRpYWxOYW1lOwogICAgICB0aGlzLnVzZVBhcnRpYWwgPSB0cnVlOwoKICAgICAgaWYocGFydGlh
bC5jb250ZXh0KSB7CiAgICAgICAgdGhpcy5JRChwYXJ0aWFsLmNvbnRleHQpOwogICAgICB9IGVs
c2UgewogICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoJywgJ2RlcHRoMCcpOwogICAgICB9CgogICAg
ICB0aGlzLm9wY29kZSgnaW52b2tlUGFydGlhbCcsIHBhcnRpYWxOYW1lLm5hbWUpOwogICAgICB0
aGlzLm9wY29kZSgnYXBwZW5kJyk7CiAgICB9LAoKICAgIGNvbnRlbnQ6IGZ1bmN0aW9uKGNvbnRl
bnQpIHsKICAgICAgdGhpcy5vcGNvZGUoJ2FwcGVuZENvbnRlbnQnLCBjb250ZW50LnN0cmluZyk7
CiAgICB9LAoKICAgIG11c3RhY2hlOiBmdW5jdGlvbihtdXN0YWNoZSkgewogICAgICB2YXIgb3B0
aW9ucyA9IHRoaXMub3B0aW9uczsKICAgICAgdmFyIHR5cGUgPSB0aGlzLmNsYXNzaWZ5TXVzdGFj
aGUobXVzdGFjaGUpOwoKICAgICAgaWYgKHR5cGUgPT09ICJzaW1wbGUiKSB7CiAgICAgICAgdGhp
cy5zaW1wbGVNdXN0YWNoZShtdXN0YWNoZSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImhl
bHBlciIpIHsKICAgICAgICB0aGlzLmhlbHBlck11c3RhY2hlKG11c3RhY2hlKTsKICAgICAgfSBl
bHNlIHsKICAgICAgICB0aGlzLmFtYmlndW91c011c3RhY2hlKG11c3RhY2hlKTsKICAgICAgfQoK
ICAgICAgaWYobXVzdGFjaGUuZXNjYXBlZCAmJiAhb3B0aW9ucy5ub0VzY2FwZSkgewogICAgICAg
IHRoaXMub3Bjb2RlKCdhcHBlbmRFc2NhcGVkJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhp
cy5vcGNvZGUoJ2FwcGVuZCcpOwogICAgICB9CiAgICB9LAoKICAgIGFtYmlndW91c011c3RhY2hl
OiBmdW5jdGlvbihtdXN0YWNoZSwgcHJvZ3JhbSwgaW52ZXJzZSkgewogICAgICB2YXIgaWQgPSBt
dXN0YWNoZS5pZCwKICAgICAgICAgIG5hbWUgPSBpZC5wYXJ0c1swXSwKICAgICAgICAgIGlzQmxv
Y2sgPSBwcm9ncmFtICE9IG51bGwgfHwgaW52ZXJzZSAhPSBudWxsOwoKICAgICAgdGhpcy5vcGNv
ZGUoJ2dldENvbnRleHQnLCBpZC5kZXB0aCk7CgogICAgICB0aGlzLm9wY29kZSgncHVzaFByb2dy
YW0nLCBwcm9ncmFtKTsKICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgaW52ZXJzZSk7
CgogICAgICB0aGlzLm9wY29kZSgnaW52b2tlQW1iaWd1b3VzJywgbmFtZSwgaXNCbG9jayk7CiAg
ICB9LAoKICAgIHNpbXBsZU11c3RhY2hlOiBmdW5jdGlvbihtdXN0YWNoZSkgewogICAgICB2YXIg
aWQgPSBtdXN0YWNoZS5pZDsKCiAgICAgIGlmIChpZC50eXBlID09PSAnREFUQScpIHsKICAgICAg
ICB0aGlzLkRBVEEoaWQpOwogICAgICB9IGVsc2UgaWYgKGlkLnBhcnRzLmxlbmd0aCkgewogICAg
ICAgIHRoaXMuSUQoaWQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNpbXBsaWZpZWQgSUQg
Zm9yIGB0aGlzYAogICAgICAgIHRoaXMuYWRkRGVwdGgoaWQuZGVwdGgpOwogICAgICAgIHRoaXMu
b3Bjb2RlKCdnZXRDb250ZXh0JywgaWQuZGVwdGgpOwogICAgICAgIHRoaXMub3Bjb2RlKCdwdXNo
Q29udGV4dCcpOwogICAgICB9CgogICAgICB0aGlzLm9wY29kZSgncmVzb2x2ZVBvc3NpYmxlTGFt
YmRhJyk7CiAgICB9LAoKICAgIGhlbHBlck11c3RhY2hlOiBmdW5jdGlvbihtdXN0YWNoZSwgcHJv
Z3JhbSwgaW52ZXJzZSkgewogICAgICB2YXIgcGFyYW1zID0gdGhpcy5zZXR1cEZ1bGxNdXN0YWNo
ZVBhcmFtcyhtdXN0YWNoZSwgcHJvZ3JhbSwgaW52ZXJzZSksCiAgICAgICAgICBuYW1lID0gbXVz
dGFjaGUuaWQucGFydHNbMF07CgogICAgICBpZiAodGhpcy5vcHRpb25zLmtub3duSGVscGVyc1tu
YW1lXSkgewogICAgICAgIHRoaXMub3Bjb2RlKCdpbnZva2VLbm93bkhlbHBlcicsIHBhcmFtcy5s
ZW5ndGgsIG5hbWUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnNP
bmx5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJZb3Ugc3BlY2lmaWVkIGtub3duSGVscGVy
c09ubHksIGJ1dCB1c2VkIHRoZSB1bmtub3duIGhlbHBlciAiICsgbmFtZSk7CiAgICAgIH0gZWxz
ZSB7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2ludm9rZUhlbHBlcicsIHBhcmFtcy5sZW5ndGgsIG5h
bWUpOwogICAgICB9CiAgICB9LAoKICAgIElEOiBmdW5jdGlvbihpZCkgewogICAgICB0aGlzLmFk
ZERlcHRoKGlkLmRlcHRoKTsKICAgICAgdGhpcy5vcGNvZGUoJ2dldENvbnRleHQnLCBpZC5kZXB0
aCk7CgogICAgICB2YXIgbmFtZSA9IGlkLnBhcnRzWzBdOwogICAgICBpZiAoIW5hbWUpIHsKICAg
ICAgICB0aGlzLm9wY29kZSgncHVzaENvbnRleHQnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0
aGlzLm9wY29kZSgnbG9va3VwT25Db250ZXh0JywgaWQucGFydHNbMF0pOwogICAgICB9CgogICAg
ICBmb3IodmFyIGk9MSwgbD1pZC5wYXJ0cy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgdGhp
cy5vcGNvZGUoJ2xvb2t1cCcsIGlkLnBhcnRzW2ldKTsKICAgICAgfQogICAgfSwKCiAgICBEQVRB
OiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHRoaXMub3B0aW9ucy5kYXRhID0gdHJ1ZTsKICAgICAg
aWYgKGRhdGEuaWQuaXNTY29wZWQgfHwgZGF0YS5pZC5kZXB0aCkgewogICAgICAgIHRocm93IG5l
dyBFeGNlcHRpb24oJ1Njb3BlZCBkYXRhIHJlZmVyZW5jZXMgYXJlIG5vdCBzdXBwb3J0ZWQ6ICcg
KyBkYXRhLm9yaWdpbmFsKTsKICAgICAgfQoKICAgICAgdGhpcy5vcGNvZGUoJ2xvb2t1cERhdGEn
KTsKICAgICAgdmFyIHBhcnRzID0gZGF0YS5pZC5wYXJ0czsKICAgICAgZm9yKHZhciBpPTAsIGw9
cGFydHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIHRoaXMub3Bjb2RlKCdsb29rdXAnLCBw
YXJ0c1tpXSk7CiAgICAgIH0KICAgIH0sCgogICAgU1RSSU5HOiBmdW5jdGlvbihzdHJpbmcpIHsK
ICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hTdHJpbmcnLCBzdHJpbmcuc3RyaW5nKTsKICAgIH0sCgog
ICAgSU5URUdFUjogZnVuY3Rpb24oaW50ZWdlcikgewogICAgICB0aGlzLm9wY29kZSgncHVzaExp
dGVyYWwnLCBpbnRlZ2VyLmludGVnZXIpOwogICAgfSwKCiAgICBCT09MRUFOOiBmdW5jdGlvbihi
b29sKSB7CiAgICAgIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIGJvb2wuYm9vbCk7CiAgICB9
LAoKICAgIGNvbW1lbnQ6IGZ1bmN0aW9uKCkge30sCgogICAgLy8gSEVMUEVSUwogICAgb3Bjb2Rl
OiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHRoaXMub3Bjb2Rlcy5wdXNoKHsgb3Bjb2RlOiBuYW1l
LCBhcmdzOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkgfSk7CiAgICB9LAoKICAgIGRlY2xh
cmU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgIHRoaXMub3Bjb2Rlcy5wdXNoKHsgb3Bj
b2RlOiAnREVDTEFSRScsIG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSB9KTsKICAgIH0sCgogICAg
YWRkRGVwdGg6IGZ1bmN0aW9uKGRlcHRoKSB7CiAgICAgIGlmKGlzTmFOKGRlcHRoKSkgeyB0aHJv
dyBuZXcgRXJyb3IoIkVXT1QiKTsgfQogICAgICBpZihkZXB0aCA9PT0gMCkgeyByZXR1cm47IH0K
CiAgICAgIGlmKCF0aGlzLmRlcHRoc1tkZXB0aF0pIHsKICAgICAgICB0aGlzLmRlcHRoc1tkZXB0
aF0gPSB0cnVlOwogICAgICAgIHRoaXMuZGVwdGhzLmxpc3QucHVzaChkZXB0aCk7CiAgICAgIH0K
ICAgIH0sCgogICAgY2xhc3NpZnlNdXN0YWNoZTogZnVuY3Rpb24obXVzdGFjaGUpIHsKICAgICAg
dmFyIGlzSGVscGVyICAgPSBtdXN0YWNoZS5pc0hlbHBlcjsKICAgICAgdmFyIGlzRWxpZ2libGUg
PSBtdXN0YWNoZS5lbGlnaWJsZUhlbHBlcjsKICAgICAgdmFyIG9wdGlvbnMgICAgPSB0aGlzLm9w
dGlvbnM7CgogICAgICAvLyBpZiBhbWJpZ3VvdXMsIHdlIGNhbiBwb3NzaWJseSByZXNvbHZlIHRo
ZSBhbWJpZ3VpdHkgbm93CiAgICAgIGlmIChpc0VsaWdpYmxlICYmICFpc0hlbHBlcikgewogICAg
ICAgIHZhciBuYW1lID0gbXVzdGFjaGUuaWQucGFydHNbMF07CgogICAgICAgIGlmIChvcHRpb25z
Lmtub3duSGVscGVyc1tuYW1lXSkgewogICAgICAgICAgaXNIZWxwZXIgPSB0cnVlOwogICAgICAg
IH0gZWxzZSBpZiAob3B0aW9ucy5rbm93bkhlbHBlcnNPbmx5KSB7CiAgICAgICAgICBpc0VsaWdp
YmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoaXNIZWxwZXIpIHsgcmV0
dXJuICJoZWxwZXIiOyB9CiAgICAgIGVsc2UgaWYgKGlzRWxpZ2libGUpIHsgcmV0dXJuICJhbWJp
Z3VvdXMiOyB9CiAgICAgIGVsc2UgeyByZXR1cm4gInNpbXBsZSI7IH0KICAgIH0sCgogICAgcHVz
aFBhcmFtczogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgIHZhciBpID0gcGFyYW1zLmxlbmd0aCwg
cGFyYW07CgogICAgICB3aGlsZShpLS0pIHsKICAgICAgICBwYXJhbSA9IHBhcmFtc1tpXTsKCiAg
ICAgICAgaWYodGhpcy5vcHRpb25zLnN0cmluZ1BhcmFtcykgewogICAgICAgICAgaWYocGFyYW0u
ZGVwdGgpIHsKICAgICAgICAgICAgdGhpcy5hZGREZXB0aChwYXJhbS5kZXB0aCk7CiAgICAgICAg
ICB9CgogICAgICAgICAgdGhpcy5vcGNvZGUoJ2dldENvbnRleHQnLCBwYXJhbS5kZXB0aCB8fCAw
KTsKICAgICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoU3RyaW5nUGFyYW0nLCBwYXJhbS5zdHJpbmdN
b2RlVmFsdWUsIHBhcmFtLnR5cGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzW3Bh
cmFtLnR5cGVdKHBhcmFtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgc2V0dXBNdXN0
YWNoZVBhcmFtczogZnVuY3Rpb24obXVzdGFjaGUpIHsKICAgICAgdmFyIHBhcmFtcyA9IG11c3Rh
Y2hlLnBhcmFtczsKICAgICAgdGhpcy5wdXNoUGFyYW1zKHBhcmFtcyk7CgogICAgICBpZihtdXN0
YWNoZS5oYXNoKSB7CiAgICAgICAgdGhpcy5oYXNoKG11c3RhY2hlLmhhc2gpOwogICAgICB9IGVs
c2UgewogICAgICAgIHRoaXMub3Bjb2RlKCdlbXB0eUhhc2gnKTsKICAgICAgfQoKICAgICAgcmV0
dXJuIHBhcmFtczsKICAgIH0sCgogICAgLy8gdGhpcyB3aWxsIHJlcGxhY2Ugc2V0dXBNdXN0YWNo
ZVBhcmFtcyB3aGVuIHdlJ3JlIGRvbmUKICAgIHNldHVwRnVsbE11c3RhY2hlUGFyYW1zOiBmdW5j
dGlvbihtdXN0YWNoZSwgcHJvZ3JhbSwgaW52ZXJzZSkgewogICAgICB2YXIgcGFyYW1zID0gbXVz
dGFjaGUucGFyYW1zOwogICAgICB0aGlzLnB1c2hQYXJhbXMocGFyYW1zKTsKCiAgICAgIHRoaXMu
b3Bjb2RlKCdwdXNoUHJvZ3JhbScsIHByb2dyYW0pOwogICAgICB0aGlzLm9wY29kZSgncHVzaFBy
b2dyYW0nLCBpbnZlcnNlKTsKCiAgICAgIGlmKG11c3RhY2hlLmhhc2gpIHsKICAgICAgICB0aGlz
Lmhhc2gobXVzdGFjaGUuaGFzaCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5vcGNvZGUo
J2VtcHR5SGFzaCcpOwogICAgICB9CgogICAgICByZXR1cm4gcGFyYW1zOwogICAgfQogIH07Cgog
IGZ1bmN0aW9uIHByZWNvbXBpbGUoaW5wdXQsIG9wdGlvbnMpIHsKICAgIGlmIChpbnB1dCA9PSBu
dWxsIHx8ICh0eXBlb2YgaW5wdXQgIT09ICdzdHJpbmcnICYmIGlucHV0LmNvbnN0cnVjdG9yICE9
PSBBU1QuUHJvZ3JhbU5vZGUpKSB7CiAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIllvdSBtdXN0
IHBhc3MgYSBzdHJpbmcgb3IgSGFuZGxlYmFycyBBU1QgdG8gSGFuZGxlYmFycy5wcmVjb21waWxl
LiBZb3UgcGFzc2VkICIgKyBpbnB1dCk7CiAgICB9CgogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwg
e307CiAgICBpZiAoISgnZGF0YScgaW4gb3B0aW9ucykpIHsKICAgICAgb3B0aW9ucy5kYXRhID0g
dHJ1ZTsKICAgIH0KCiAgICB2YXIgYXN0ID0gcGFyc2UoaW5wdXQpOwogICAgdmFyIGVudmlyb25t
ZW50ID0gbmV3IENvbXBpbGVyKCkuY29tcGlsZShhc3QsIG9wdGlvbnMpOwogICAgcmV0dXJuIG5l
dyBKYXZhU2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGVudmlyb25tZW50LCBvcHRpb25zKTsKICB9
CgogIF9fZXhwb3J0c19fLnByZWNvbXBpbGUgPSBwcmVjb21waWxlO2Z1bmN0aW9uIGNvbXBpbGUo
aW5wdXQsIG9wdGlvbnMsIGVudikgewogICAgaWYgKGlucHV0ID09IG51bGwgfHwgKHR5cGVvZiBp
bnB1dCAhPT0gJ3N0cmluZycgJiYgaW5wdXQuY29uc3RydWN0b3IgIT09IEFTVC5Qcm9ncmFtTm9k
ZSkpIHsKICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiWW91IG11c3QgcGFzcyBhIHN0cmluZyBv
ciBIYW5kbGViYXJzIEFTVCB0byBIYW5kbGViYXJzLmNvbXBpbGUuIFlvdSBwYXNzZWQgIiArIGlu
cHV0KTsKICAgIH0KCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICBpZiAoISgnZGF0
YScgaW4gb3B0aW9ucykpIHsKICAgICAgb3B0aW9ucy5kYXRhID0gdHJ1ZTsKICAgIH0KCiAgICB2
YXIgY29tcGlsZWQ7CgogICAgZnVuY3Rpb24gY29tcGlsZUlucHV0KCkgewogICAgICB2YXIgYXN0
ID0gcGFyc2UoaW5wdXQpOwogICAgICB2YXIgZW52aXJvbm1lbnQgPSBuZXcgQ29tcGlsZXIoKS5j
b21waWxlKGFzdCwgb3B0aW9ucyk7CiAgICAgIHZhciB0ZW1wbGF0ZVNwZWMgPSBuZXcgSmF2YVNj
cmlwdENvbXBpbGVyKCkuY29tcGlsZShlbnZpcm9ubWVudCwgb3B0aW9ucywgdW5kZWZpbmVkLCB0
cnVlKTsKICAgICAgcmV0dXJuIGVudi50ZW1wbGF0ZSh0ZW1wbGF0ZVNwZWMpOwogICAgfQoKICAg
IC8vIFRlbXBsYXRlIGlzIG9ubHkgY29tcGlsZWQgb24gZmlyc3QgdXNlIGFuZCBjYWNoZWQgYWZ0
ZXIgdGhhdCBwb2ludC4KICAgIHJldHVybiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAg
ICAgIGlmICghY29tcGlsZWQpIHsKICAgICAgICBjb21waWxlZCA9IGNvbXBpbGVJbnB1dCgpOwog
ICAgICB9CiAgICAgIHJldHVybiBjb21waWxlZC5jYWxsKHRoaXMsIGNvbnRleHQsIG9wdGlvbnMp
OwogICAgfTsKICB9CgogIF9fZXhwb3J0c19fLmNvbXBpbGUgPSBjb21waWxlOwogIHJldHVybiBf
X2V4cG9ydHNfXzsKfSkoX19tb2R1bGU1X18sIF9fbW9kdWxlOF9fLCBfX21vZHVsZTExX18sIF9f
bW9kdWxlN19fKTsKCi8vIGhhbmRsZWJhcnMuanMKdmFyIF9fbW9kdWxlMF9fID0gKGZ1bmN0aW9u
KF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVw
ZW5kZW5jeTRfXywgX19kZXBlbmRlbmN5NV9fKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX2V4
cG9ydHNfXzsKICAvKmdsb2JhbHMgSGFuZGxlYmFyczogdHJ1ZSAqLwogIHZhciBIYW5kbGViYXJz
ID0gX19kZXBlbmRlbmN5MV9fOwoKICAvLyBDb21waWxlciBpbXBvcnRzCiAgdmFyIEFTVCA9IF9f
ZGVwZW5kZW5jeTJfXzsKICB2YXIgUGFyc2VyID0gX19kZXBlbmRlbmN5M19fLnBhcnNlcjsKICB2
YXIgcGFyc2UgPSBfX2RlcGVuZGVuY3kzX18ucGFyc2U7CiAgdmFyIENvbXBpbGVyID0gX19kZXBl
bmRlbmN5NF9fLkNvbXBpbGVyOwogIHZhciBjb21waWxlID0gX19kZXBlbmRlbmN5NF9fLmNvbXBp
bGU7CiAgdmFyIHByZWNvbXBpbGUgPSBfX2RlcGVuZGVuY3k0X18ucHJlY29tcGlsZTsKICB2YXIg
SmF2YVNjcmlwdENvbXBpbGVyID0gX19kZXBlbmRlbmN5NV9fOwoKICB2YXIgX2NyZWF0ZSA9IEhh
bmRsZWJhcnMuY3JlYXRlOwogIHZhciBjcmVhdGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoYiA9
IF9jcmVhdGUoKTsKCiAgICBoYi5jb21waWxlID0gZnVuY3Rpb24oaW5wdXQsIG9wdGlvbnMpIHsK
ICAgICAgcmV0dXJuIGNvbXBpbGUoaW5wdXQsIG9wdGlvbnMsIGhiKTsKICAgIH07CiAgICBoYi5w
cmVjb21waWxlID0gcHJlY29tcGlsZTsKCiAgICBoYi5BU1QgPSBBU1Q7CiAgICBoYi5Db21waWxl
ciA9IENvbXBpbGVyOwogICAgaGIuSmF2YVNjcmlwdENvbXBpbGVyID0gSmF2YVNjcmlwdENvbXBp
bGVyOwogICAgaGIuUGFyc2VyID0gUGFyc2VyOwogICAgaGIucGFyc2UgPSBwYXJzZTsKCiAgICBy
ZXR1cm4gaGI7CiAgfTsKCiAgSGFuZGxlYmFycyA9IGNyZWF0ZSgpOwogIEhhbmRsZWJhcnMuY3Jl
YXRlID0gY3JlYXRlOwoKICBfX2V4cG9ydHNfXyA9IEhhbmRsZWJhcnM7CiAgcmV0dXJuIF9fZXhw
b3J0c19fOwp9KShfX21vZHVsZTFfXywgX19tb2R1bGU3X18sIF9fbW9kdWxlOF9fLCBfX21vZHVs
ZTEwX18sIF9fbW9kdWxlMTFfXyk7CgogIHJldHVybiBfX21vZHVsZTBfXzsKfSkoKTsK
</content>
  </attachment>
  <object>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>TodoLists.TodoListMacro</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>744f736f-3e5c-4c3f-9786-19023587257e</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>requirejs.config({
    //By default load any module IDs from js/lib
    baseUrl: '${xwiki.getDocument("TodoLists.TodoListMacro").getURL("download")}/',
    //except, if the module ID starts with "app",
    //load it from the js/app directory. paths
    //config is relative to the baseUrl, and
    //never includes a ".js" extension since
    //the paths config could be for a directory.
    paths: {
    },
    shim: {
        'ember-data': {
            deps: ['ember', 'jquery']
        },
        'ember': {
            deps: ['jquery']
        }
    }
});
require(['jquery', 'handlebars-v1.2.1', 'ember-data', 'ember' ], function ($) {

// create app
window.Todos = Ember.Application.create({
  rootElement: '#todoappdiv'
});

// define the todolist store that will write to the TodoListsService
Todos.ApplicationAdapter = DS.Adapter.extend({
  createRecord: function(store, type, record) {
    console.log("createRecord");
    var query = { create: "1", content : JSON.stringify(record) };
    return new Ember.RSVP.Promise(function(resolve, reject) {
      jQuery.getJSON("${xwiki.getURL("TodoLists.TodoListsService")}?page=" + XWiki.currentSpace + "." + XWiki.currentPage + "&amp;xpage=plain&amp;outputSyntax=plain", query).then(function(data) {
        Ember.run(null, resolve, data);
      }, function(jqXHR) {
        jqXHR.then = null; // tame jQuery's ill mannered promises
        Ember.run(null, reject, jqXHR);
      });
    });
  },
  deleteRecord: function(store, type, record) {
    console.log("deleteRecord");
    return this.saveAll(store.recordArrayManager.recordArraysForRecord(record).list[0].content);
  },
  find: function(store, type, id) {
    console.log("find");
    return;
  },
  findAll: function(store, type, sinceToken) {
    console.log("findAll");
    var query = { since: sinceToken };
    return new Ember.RSVP.Promise(function(resolve, reject) {
      jQuery.getJSON("${xwiki.getURL("TodoLists.TodoListsService")}?page=" + XWiki.currentSpace + "." + XWiki.currentPage + "&amp;xpage=plain&amp;outputSyntax=plain", query).then(function(data) {
        Ember.run(null, resolve, data);
      }, function(jqXHR) {
        jqXHR.then = null; // tame jQuery's ill mannered promises
        Ember.run(null, reject, jqXHR);
      });
    });
  },
  updateRecord: function(store, type, record) {
    return this.saveAll(store.recordArrayManager.recordArraysForRecord(record).list[0].content);
  },
  saveAll: function(alldata) {
    console.log("updateRecord");
    var query = { save: "1", content : JSON.stringify(alldata) };
    return new Ember.RSVP.Promise(function(resolve, reject) {
      jQuery.getJSON("${xwiki.getURL("TodoLists.TodoListsService")}?page=" + XWiki.currentSpace + "." + XWiki.currentPage + "&amp;xpage=plain&amp;outputSyntax=plain", query).then(function(data) {
        Ember.run(null, resolve, data);
      }, function(jqXHR) {
        jqXHR.then = null; // tame jQuery's ill mannered promises
        Ember.run(null, reject, jqXHR);
      });
    });
  }
});

// use my own store
Todos.store = DS.Store.create({
  adapter: 'ApplicationAdapter'
});

// Todos.ApplicationAdapter = DS.FixtureAdapter.extend();

// routing
Todos.Router.map(function() {
  this.resource('todos', { path: '' }, function() {
     this.route('active');
     this.route('completed');
  });
});

Todos.TodosRoute = Ember.Route.extend({
  model: function() {
    return this.store.find('todo');
  }
});

Todos.TodosIndexRoute = Ember.Route.extend({
  model: function() {
    return this.modelFor('todos');
  }
});

// ... additional lines truncated for brevity ...
Todos.TodosActiveRoute = Ember.Route.extend({
  model: function(){
    return this.store.filter('todo', function(todo) {
      return !todo.get('isCompleted');
    });
  },
  renderTemplate: function(controller) {
    this.render('todos/index', {controller: controller});
  }
});

Todos.TodosCompletedRoute = Ember.Route.extend({
  model: function(){
    return this.store.filter('todo', function (todo) {
      return todo.get('isCompleted');
    });
  },
  renderTemplate: function(controller){
    this.render('todos/index', {controller: controller});
  }
});

// data model
Todos.Todo = DS.Model.extend({
  title: DS.attr('string'),
  isCompleted: DS.attr('boolean')
});

// ... additional lines truncated for brevity ...
Todos.Todo.FIXTURES = [
 {
   id: 1,
   title: 'Learn Ember.js X',
   isCompleted: true
 },
 {
   id: 2,
   title: '...',
   isCompleted: false
 },
 {
   id: 3,
   title: 'Profit!',
   isCompleted: false
 }
];

// controler
Todos.TodoController = Ember.ObjectController.extend({
  actions: {
    editTodo: function () {
      this.set('isEditing', true);
    },
    acceptChanges: function() {
    this.set('isEditing', false);

    if (Ember.isEmpty(this.get('model.title'))) {
      this.send('removeTodo');
    } else {
      this.get('model').save();
    }
   },
   removeTodo: function() {
    var todo = this.get('model');
    todo.deleteRecord();
    todo.save();
  }
  },

  isEditing: false,

  isCompleted: function(key, value){
    var model = this.get('model');

    if (value === undefined) {
      // property being used as a getter
      return model.get('isCompleted');
    } else {
      // property being used as  setter
      model.set('isCompleted', value);
      model.save();
      return value;
    }
  }.property('model.isCompleted')
});

Todos.TodosController = Ember.ArrayController.extend({
  actions: {
    createTodo: function () {
      // Get the todo title set by the "New Todo" text field
      var title = this.get('newTitle');
      if (!title.trim()) { return; }

      // Create the new Todo model
      var todo = this.store.createRecord('todo', {
        title: title,
        isCompleted: false
      });

      // Clear the "New Todo" text field
      this.set('newTitle', '');

      // Save the new model
      todo.save();
    },
    clearCompleted: function () {
      var completed = this.filterProperty('isCompleted', true);
      completed.invoke('deleteRecord');
      completed.invoke('save');
    }
  },

  remaining: function () {
    return this.filterProperty('isCompleted', false).get('length');
  }.property('@each.isCompleted'),

  inflection: function () {
    var remaining = this.get('remaining');
    return remaining === 1 ? 'item' : 'items';
  }.property('remaining'),
  hasCompleted: function () {
    return this.get('completed') &gt; 0;
  }.property('completed'),

  completed: function () {
    return this.filterProperty('isCompleted', true).get('length');
  }.property('@each.isCompleted'),

 allAreDone: function(key, value) {
  if (value === undefined) {
    return !!this.get('length') &amp;&amp; this.everyProperty('isCompleted', true);
  } else {
    this.setEach('isCompleted', value);
    this.invoke('save');
    return value;
  }
}.property('@each.isCompleted')
});

// editing
Todos.EditTodoView = Ember.TextField.extend({
  didInsertElement: function() {
    this.$().focus();
  }
});

Ember.Handlebars.helper('edit-todo', Todos.EditTodoView);
});</code>
    </property>
    <property>
      <name>js</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>TodoLists.TodoListMacro</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>c5c8b484-e711-4c9d-9a54-61133f496596</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#template('colorThemeInit.vm')

button {
	margin: 0;
	padding: 0;
	border: 0;
	background: none;
	font-size: 100%;
	vertical-align: baseline;
	font-family: inherit;
	color: inherit;
	-webkit-appearance: none;
	/*-moz-appearance: none;*/
	-ms-appearance: none;
	-o-appearance: none;
	appearance: none;
}

#todoapp {
	background: #fff;
	background: rgba(255, 255, 255, 0.9);
	border: 1px solid #ccc;
	position: relative;
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.2),
				0 25px 50px 0 rgba(0, 0, 0, 0.15);
}

#todoapp:before {
	content: '';
	border-left: 1px solid $theme.borderColor;
	border-right: 1px solid $theme.borderColor;
	width: 2px;
	position: absolute;
	top: 0;
	left: 40px;
	height: 100%;
}

#todoapp input::-webkit-input-placeholder {
	font-style: italic;
}

#todoapp input:-moz-placeholder {
	font-style: italic;
	color: #a9a9a9;
}

#header {
	padding-top: 15px;
	border-radius: inherit;
}

#header:before {
	content: '';
	position: absolute;
	top: 0;
	right: 0;
	left: 0;
	height: 15px;
	z-index: 2;
	border-bottom: 1px solid #6c615c;
  #css3_backgroundLinearGradient({
     'to': 'bottom',
     'colors': [
      {'color': $theme.menuGradientColor, 'position': '0%'},
      {'color': $theme.menuBackgroundColor, 'position': '50%'}
    ]
  })
  box-shadow: 0px 1px 2px $theme.menuGradientColor;
	border-top-left-radius: 1px;
	border-top-right-radius: 1px;
}

#new-todo,
.edit {
	position: relative;
	margin: 0;
	width: 100%;
	font-size: 20px;
	font-family: inherit;
	line-height: 1.4em;
	border: 0;
	outline: none;
	color: inherit;
	padding: 6px;
	border: 1px solid #999;
	box-shadow: inset 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	-ms-box-sizing: border-box;
	-o-box-sizing: border-box;
	box-sizing: border-box;
	-webkit-font-smoothing: antialiased;
	-moz-font-smoothing: antialiased;
	-ms-font-smoothing: antialiased;
	-o-font-smoothing: antialiased;
	font-smoothing: antialiased;
}

#new-todo {
	padding: 16px 16px 16px 60px;
	border: none;
	background: rgba(0, 0, 0, 0.02);
	z-index: 2;
	box-shadow: none;
}

#main {
	position: relative;
	z-index: 2;
	border-top: 1px dotted #adadad;
}

label[for='toggle-all'] {
	display: none;
}

#toggle-all {
	position: absolute;
	top: -42px;
	left: -4px;
	width: 40px;
	text-align: center;
	border: none; /* Mobile Safari */
}

#toggle-all:before {
	content: '»';
	font-size: 20px;
	color: #d9d9d9;
	padding: 0 25px 7px;
}

#toggle-all:checked:before {
	color: #737373;
}

#todo-list {
	margin: 0;
	padding: 0;
	list-style: none;
}

#todo-list li {
	position: relative;
	font-size: 20px;
	border-bottom: 1px dotted #ccc;
}

#todo-list li:last-child {
	border-bottom: none;
}

#todo-list li.editing {
	border-bottom: none;
	padding: 0;
}

#todo-list li.editing .edit {
	display: block;
	width: 506px;
	padding: 13px 17px 12px 17px;
	margin: 0 0 0 43px;
}

#todo-list li.editing .view {
	display: none;
}

#todo-list li .toggle {
	text-align: center;
	width: 40px;
	/* auto, since non-WebKit browsers doesn't support input styling */
	height: auto;
	position: absolute;
	top: 0;
	bottom: 0;
	margin: auto 0;
	border: none; /* Mobile Safari */
	-webkit-appearance: none;
	/*-moz-appearance: none;*/
	-ms-appearance: none;
	-o-appearance: none;
	appearance: none;
}

#todo-list li .toggle:after {
	content: '✔';
	line-height: 43px; /* 40 + a couple of pixels visual adjustment */
	font-size: 20px;
	color: #d9d9d9;
	text-shadow: 0 -1px 0 #bfbfbf;
}

#todo-list li .toggle:checked:after {
	color: #85ada7;
	text-shadow: 0 1px 0 #669991;
	bottom: 1px;
	position: relative;
}

#todo-list li label {
	word-break: break-word;
	padding: 15px;
	margin-left: 45px;
	display: block;
	line-height: 1.2;
	-webkit-transition: color 0.4s;
	-moz-transition: color 0.4s;
	-ms-transition: color 0.4s;
	-o-transition: color 0.4s;
	transition: color 0.4s;
}

#todo-list li.completed label {
	color: #a9a9a9;
	text-decoration: line-through;
}

#todo-list li .destroy {
	display: none;
	position: absolute;
	top: 0;
	right: 10px;
	bottom: 0;
	width: 40px;
	height: 40px;
	margin: auto 0;
	font-size: 20px;
	color: #a88a8a;
	-webkit-transition: all 0.2s;
	-moz-transition: all 0.2s;
	-ms-transition: all 0.2s;
	-o-transition: all 0.2s;
	transition: all 0.2s;
}

#todo-list li .destroy:hover {
	text-shadow: 0 0 1px #000,
				 0 0 10px rgba(199, 107, 107, 0.8);
	-webkit-transform: scale(1.3);
	-moz-transform: scale(1.3);
	-ms-transform: scale(1.3);
	-o-transform: scale(1.3);
	transform: scale(1.3);
}

#todo-list li .destroy:after {
	content: '✖';
}

#todo-list li:hover .destroy {
	display: block;
}

#todo-list li .edit {
	display: none;
}

#todo-list li.editing:last-child {
	margin-bottom: -1px;
}

#footer {
	color: #777;
	padding: 0 15px;
	position: absolute;
	right: 0;
	bottom: -31px;
	left: 0;
	height: 20px;
	z-index: 1;
	text-align: center;
}

#footer:before {
	content: '';
	position: absolute;
	right: 0;
	bottom: 31px;
	left: 0;
	height: 50px;
	z-index: -1;
	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3),
				0 6px 0 -3px rgba(255, 255, 255, 0.8),
				0 7px 1px -3px rgba(0, 0, 0, 0.3),
				0 43px 0 -6px rgba(255, 255, 255, 0.8),
				0 44px 2px -6px rgba(0, 0, 0, 0.2);
}

#todo-count {
	float: left;
	text-align: left;
}

#filters {
	margin: 0;
	padding: 0;
	list-style: none;
	position: absolute;
	right: 0;
	left: 0;
}

#filters li {
	display: inline;
}

#filters li a {
	color: #83756f;
	margin: 2px;
	text-decoration: none;
}

#filters li a.selected {
	font-weight: bold;
}

#clear-completed {
	float: right;
	position: relative;
	line-height: 20px;
	text-decoration: none;
	background: rgba(0, 0, 0, 0.1);
	font-size: 11px;
	padding: 0 10px;
	border-radius: 3px;
	box-shadow: 0 -1px 0 0 rgba(0, 0, 0, 0.2);
}

#clear-completed:hover {
	background: rgba(0, 0, 0, 0.15);
	box-shadow: 0 -1px 0 0 rgba(0, 0, 0, 0.3);
}

#info {
	margin: 65px auto 0;
	color: #a6a6a6;
	font-size: 12px;
	text-shadow: 0 1px 0 rgba(255, 255, 255, 0.7);
	text-align: center;
}

#info a {
	color: inherit;
}

/*
	Hack to remove background from Mobile Safari.
	Can't use it globally since it destroys checkboxes in Firefox and Opera
*/
@media screen and (-webkit-min-device-pixel-ratio:0) {
	#toggle-all,
	#todo-list li .toggle {
		background: none;
	}

	#todo-list li .toggle {
		height: 40px;
	}

	#toggle-all {
		top: -56px;
		left: -15px;
		width: 65px;
		height: 41px;
		-webkit-transform: rotate(90deg);
		transform: rotate(90deg);
		-webkit-appearance: none;
		appearance: none;
	}
}

.hidden{
	display:none;
}
</code>
    </property>
    <property>
      <name>css</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>9</number>
        <prettyName>Macro code</prettyName>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <disabled>0</disabled>
        <name>contentDescription</name>
        <number>8</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategory>
        <disabled>0</disabled>
        <name>defaultCategory</name>
        <number>4</number>
        <prettyName>Default category</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultCategory>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <name>TodoLists.TodoListMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>c5210a93-0aad-425e-8bb2-fc48b6dbdaa2</guid>
    <property>
      <code>{{velocity}}
#set($ok = $services.localization.use('document', 'TodoLists.TodoListsTranslations'))
## Add js and css
#set($ok = $xwiki.jsx.use("TodoLists.TodoListMacro", { "minify" : false}))
#set($ok = $xwiki.ssx.use("TodoLists.TodoListMacro"))
{{html clean="false"}}
&lt;div id="todoappdiv"&gt;&lt;/div&gt;
&lt;script type="text/x-handlebars" data-template-name="todos"&gt;
&lt;section id="todoapp"&gt;
      &lt;header id="header"&gt;
        {{input type="text" id="new-todo" placeholder="${services.localization.render('todolists.whatneedstobedone')}" 
              value=newTitle action="createTodo"}}
      &lt;/header&gt;

&lt;section id="main"&gt;
  {{outlet}}
  {{input type="checkbox" id="toggle-all" checked=allAreDone}}
&lt;/section&gt;
     &lt;footer id="footer"&gt;
&lt;span id="todo-count"&gt;
  &lt;strong&gt;{{remaining}}&lt;/strong&gt; {{inflection}} left
&lt;/span&gt;
        &lt;ul id="filters"&gt;
&lt;li&gt;
  {{#link-to "todos.index" activeClass="selected"}}${services.localization.render('todolists.all')}{{/link-to}}
&lt;/li&gt;
&lt;li&gt;
  {{#link-to "todos.active" activeClass="selected"}}${services.localization.render('todolists.active')}{{/link-to}}
&lt;/li&gt;
&lt;li&gt;
  {{#link-to "todos.completed" activeClass="selected"}}${services.localization.render('todolists.completed')}{{/link-to}}
&lt;/li&gt;
        &lt;/ul&gt;
{{\#if hasCompleted}}
  &lt;button id="clear-completed" {{action "clearCompleted"}}&gt;
    ${services.localization.render('todolists.clearcompleted')} ({{completed}})
  &lt;/button&gt;
{{/if}}
      &lt;/footer&gt;
    &lt;/section&gt;
&lt;/script&gt;
&lt;script type="text/x-handlebars" data-template-name="todos/index"&gt;
  &lt;ul id="todo-list"&gt;
    {{#each itemController="todo"}}
      &lt;li {{bind-attr class="isCompleted:completed isEditing:editing"}}&gt;
        {{\#if isEditing}}
          {{edit-todo class="edit" value=title focus-out="acceptChanges" insert-newline="acceptChanges"}}
        {{else}}
          {{input type="checkbox" checked=isCompleted class="toggle"}}
          &lt;label {{action "editTodo" on="doubleClick"}}&gt;{{title}}&lt;/label&gt;&lt;button {{action "removeTodo"}} class="destroy"&gt;&lt;/button&gt;
        {{/if}}
      &lt;/li&gt;
    {{/each}}
  &lt;/ul&gt;
&lt;/script&gt;
&lt;/div&gt;
{{/html}}
{{/velocity}}</code>
    </property>
    <property>
      <contentDescription>List of todos in format 
Text|1
Text|0
Text|0</contentDescription>
    </property>
    <property>
      <contentType>Optional</contentType>
    </property>
    <property>
      <defaultCategory>content</defaultCategory>
    </property>
    <property>
      <description>TodoList with Javascript UI</description>
    </property>
    <property>
      <id>todolist</id>
    </property>
    <property>
      <name>todolist</name>
    </property>
    <property>
      <supportsInlineMode>0</supportsInlineMode>
    </property>
    <property>
      <visibility>Current Wiki</visibility>
    </property>
  </object>
  <content>
Macro to display todo-lists using emberjs. This code is based on the emberjs demo. You can see an example below

{{todolist}}
Install todolists extension|1
Try todo list demo|0
Create a todo list|0
Close on tasks on this todo list|0
{{/todolist}}</content>
</xwikidoc>
